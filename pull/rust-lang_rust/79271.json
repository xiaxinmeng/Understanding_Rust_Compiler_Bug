{"url": "https://api.github.com/repos/rust-lang/rust/pulls/79271", "id": 525163739, "node_id": "MDExOlB1bGxSZXF1ZXN0NTI1MTYzNzM5", "html_url": "https://github.com/rust-lang/rust/pull/79271", "diff_url": "https://github.com/rust-lang/rust/pull/79271.diff", "patch_url": "https://github.com/rust-lang/rust/pull/79271.patch", "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/79271", "number": 79271, "state": "closed", "locked": false, "title": "Add Iterator::find_or_{first,nth,last}", "user": {"login": "z33ky", "id": 289819, "node_id": "MDQ6VXNlcjI4OTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/289819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/z33ky", "html_url": "https://github.com/z33ky", "followers_url": "https://api.github.com/users/z33ky/followers", "following_url": "https://api.github.com/users/z33ky/following{/other_user}", "gists_url": "https://api.github.com/users/z33ky/gists{/gist_id}", "starred_url": "https://api.github.com/users/z33ky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/z33ky/subscriptions", "organizations_url": "https://api.github.com/users/z33ky/orgs", "repos_url": "https://api.github.com/users/z33ky/repos", "events_url": "https://api.github.com/users/z33ky/events{/privacy}", "received_events_url": "https://api.github.com/users/z33ky/received_events", "type": "User", "site_admin": false}, "body": "I'm proposing to add the methods `find_or_{first,nth,last}` to the `Iterator` trait, to facilitate returning an item that is part of the sequence itself in case no item satisfies the predicate.\r\n\r\nExample:\r\n```rust\r\nlet a = [0, 1, 2, 3];\r\n\r\nassert_eq!(a.iter().find_or_first(|&&e| e == 5   ), Some(&0)); // predicate is never satisfied, so `find_or_first` returns the first item (`&0`)\r\nassert_eq!(a.iter().find_or_nth(  |&&e| e == 5, 1), Some(&1)); // predicate is never satisfied, so `find_or_nth` returns the 2nd item (`&1`) (count begins from `0`)\r\nassert_eq!(a.iter().find_or_last( |&&e| e == 5   ), Some(&3)); // predicate is never satisfied, so `find_or_last` returns the last item (`&3`)\r\n```\r\n\r\nSome APIs return different formats or profiles/configurations that it supports and the developer shall choose one from them. Usually these have differing properties, where the developer can choose one according to their requirements or preferences. Examples for such an API can be found in Vulkan, like choosing a color-format where a listing obtained is via [`vkGetPhysicalDeviceSurfaceFormatsKHR`](https://www.khronos.org/registry/vulkan/specs/1.2-extensions/man/html/vkGetPhysicalDeviceSurfaceFormatsKHR.html) ([`Surface::get_physical_device_surface_formats`](https://docs.rs/ash/0.31.0/ash/extensions/khr/struct.Surface.html#method.get_physical_device_surface_formats) in ash, a wrapper library for Rust).\r\n\r\nWith such a list at hand, `Iterator::find` can be used to find a fitting option, and if none is found, any item should be selected instead. By providing additional methods in the `Iterator` trait, this task can be implemented elegantly.\r\n\r\nFor the mentioned use case the sequences that are processed may either have a specific order of preferences, with the most preferred one either first or last, or no communicated preference in the items.  \r\nIn the former case (preference present), one would normally either want the first or last items as default, and in the latter it wouldn't matter. Either way, `find_or_nth` seems to not solve a concrete use case.  \r\nI added it for some semblance of \"symmetry\" with other item-retrieval methods already available on `Iterator`. Likewise, `find_or_min` and `find_or_max` could be added as well, though conceptually these would be like \"find items with this (caller-provided) predicate, or else this other (hard-coded) predicate\", which is a little weird, while the methods I intend to add are more like \"find items with this predicate, or else return the item on this position\", which in my head makes more sense to provide.  \r\nMaybe only `find_or_first` and `find_or_last` are really useful to have though and `find_or_nth` shouldn't be added to libstd.\r\n\r\nI started implementing `DoubleEndedIterator::rfind_or_{first,nth_back,last}`, but again just for some semblance of symmetry. I think I'll see to some feedback first before spending time on those. An argument could perhaps be made for adding `find_or_nth_back` and `rfind_or_nth` in that case, too.", "created_at": "2020-11-21T17:54:33Z", "updated_at": "2021-03-12T17:08:04Z", "closed_at": "2021-03-12T17:08:04Z", "merged_at": null, "merge_commit_sha": "1e95e64ba9dcb5ccaa60667d5f78d68d473140c1", "assignee": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 583436937, "node_id": "MDU6TGFiZWw1ODM0MzY5Mzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-author", "name": "S-waiting-on-author", "color": "d3dddd", "default": false, "description": "Status: This is awaiting some action (such as code changes or more information) from the author."}], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/rust-lang/rust/pulls/79271/commits", "review_comments_url": "https://api.github.com/repos/rust-lang/rust/pulls/79271/comments", "review_comment_url": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79271/comments", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/c83d276bb0f2410553320bab33174a5dd17e3060", "head": {"label": "z33ky:iter-find-or-fnl", "ref": "iter-find-or-fnl", "sha": "c83d276bb0f2410553320bab33174a5dd17e3060", "user": {"login": "z33ky", "id": 289819, "node_id": "MDQ6VXNlcjI4OTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/289819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/z33ky", "html_url": "https://github.com/z33ky", "followers_url": "https://api.github.com/users/z33ky/followers", "following_url": "https://api.github.com/users/z33ky/following{/other_user}", "gists_url": "https://api.github.com/users/z33ky/gists{/gist_id}", "starred_url": "https://api.github.com/users/z33ky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/z33ky/subscriptions", "organizations_url": "https://api.github.com/users/z33ky/orgs", "repos_url": "https://api.github.com/users/z33ky/repos", "events_url": "https://api.github.com/users/z33ky/events{/privacy}", "received_events_url": "https://api.github.com/users/z33ky/received_events", "type": "User", "site_admin": false}, "repo": {"id": 314845532, "node_id": "MDEwOlJlcG9zaXRvcnkzMTQ4NDU1MzI=", "name": "rust", "full_name": "z33ky/rust", "private": false, "owner": {"login": "z33ky", "id": 289819, "node_id": "MDQ6VXNlcjI4OTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/289819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/z33ky", "html_url": "https://github.com/z33ky", "followers_url": "https://api.github.com/users/z33ky/followers", "following_url": "https://api.github.com/users/z33ky/following{/other_user}", "gists_url": "https://api.github.com/users/z33ky/gists{/gist_id}", "starred_url": "https://api.github.com/users/z33ky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/z33ky/subscriptions", "organizations_url": "https://api.github.com/users/z33ky/orgs", "repos_url": "https://api.github.com/users/z33ky/repos", "events_url": "https://api.github.com/users/z33ky/events{/privacy}", "received_events_url": "https://api.github.com/users/z33ky/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/z33ky/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": true, "url": "https://api.github.com/repos/z33ky/rust", "forks_url": "https://api.github.com/repos/z33ky/rust/forks", "keys_url": "https://api.github.com/repos/z33ky/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/z33ky/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/z33ky/rust/teams", "hooks_url": "https://api.github.com/repos/z33ky/rust/hooks", "issue_events_url": "https://api.github.com/repos/z33ky/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/z33ky/rust/events", "assignees_url": "https://api.github.com/repos/z33ky/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/z33ky/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/z33ky/rust/tags", "blobs_url": "https://api.github.com/repos/z33ky/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/z33ky/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/z33ky/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/z33ky/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/z33ky/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/z33ky/rust/languages", "stargazers_url": "https://api.github.com/repos/z33ky/rust/stargazers", "contributors_url": "https://api.github.com/repos/z33ky/rust/contributors", "subscribers_url": "https://api.github.com/repos/z33ky/rust/subscribers", "subscription_url": "https://api.github.com/repos/z33ky/rust/subscription", "commits_url": "https://api.github.com/repos/z33ky/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/z33ky/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/z33ky/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/z33ky/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/z33ky/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/z33ky/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/z33ky/rust/merges", "archive_url": "https://api.github.com/repos/z33ky/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/z33ky/rust/downloads", "issues_url": "https://api.github.com/repos/z33ky/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/z33ky/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/z33ky/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/z33ky/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/z33ky/rust/labels{/name}", "releases_url": "https://api.github.com/repos/z33ky/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/z33ky/rust/deployments", "created_at": "2020-11-21T15:44:17Z", "updated_at": "2020-11-21T15:44:20Z", "pushed_at": "2020-11-21T19:36:01Z", "git_url": "git://github.com/z33ky/rust.git", "ssh_url": "git@github.com:z33ky/rust.git", "clone_url": "https://github.com/z33ky/rust.git", "svn_url": "https://github.com/z33ky/rust", "homepage": "https://www.rust-lang.org", "size": 581289, "stargazers_count": 0, "watchers_count": 0, "language": null, "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "rust-lang:master", "ref": "master", "sha": "539402cb0b0f1639a4be14e40eaf8db61a62ae41", "user": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 724712, "node_id": "MDEwOlJlcG9zaXRvcnk3MjQ3MTI=", "name": "rust", "full_name": "rust-lang/rust", "private": false, "owner": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/rust-lang/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": false, "url": "https://api.github.com/repos/rust-lang/rust", "forks_url": "https://api.github.com/repos/rust-lang/rust/forks", "keys_url": "https://api.github.com/repos/rust-lang/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/rust-lang/rust/teams", "hooks_url": "https://api.github.com/repos/rust-lang/rust/hooks", "issue_events_url": "https://api.github.com/repos/rust-lang/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/rust-lang/rust/events", "assignees_url": "https://api.github.com/repos/rust-lang/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/rust-lang/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/rust-lang/rust/tags", "blobs_url": "https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/rust-lang/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/rust-lang/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/rust-lang/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/rust-lang/rust/languages", "stargazers_url": "https://api.github.com/repos/rust-lang/rust/stargazers", "contributors_url": "https://api.github.com/repos/rust-lang/rust/contributors", "subscribers_url": "https://api.github.com/repos/rust-lang/rust/subscribers", "subscription_url": "https://api.github.com/repos/rust-lang/rust/subscription", "commits_url": "https://api.github.com/repos/rust-lang/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/rust-lang/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/rust-lang/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/rust-lang/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/rust-lang/rust/merges", "archive_url": "https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/rust-lang/rust/downloads", "issues_url": "https://api.github.com/repos/rust-lang/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/rust-lang/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/rust-lang/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/rust-lang/rust/labels{/name}", "releases_url": "https://api.github.com/repos/rust-lang/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/rust-lang/rust/deployments", "created_at": "2010-06-16T20:39:03Z", "updated_at": "2023-06-20T15:42:37Z", "pushed_at": "2023-06-20T15:42:41Z", "git_url": "git://github.com/rust-lang/rust.git", "ssh_url": "git@github.com:rust-lang/rust.git", "clone_url": "https://github.com/rust-lang/rust.git", "svn_url": "https://github.com/rust-lang/rust", "homepage": "https://www.rust-lang.org", "size": 931034, "stargazers_count": 82779, "watchers_count": 82779, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 10968, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 9635, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["compiler", "hacktoberfest", "language", "rust"], "visibility": "public", "forks": 10968, "open_issues": 9635, "watchers": 82779, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/79271"}, "html": {"href": "https://github.com/rust-lang/rust/pull/79271"}, "issue": {"href": "https://api.github.com/repos/rust-lang/rust/issues/79271"}, "comments": {"href": "https://api.github.com/repos/rust-lang/rust/issues/79271/comments"}, "review_comments": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/79271/comments"}, "review_comment": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/79271/commits"}, "statuses": {"href": "https://api.github.com/repos/rust-lang/rust/statuses/c83d276bb0f2410553320bab33174a5dd17e3060"}}, "author_association": "NONE", "auto_merge": null, "active_lock_reason": null, "merged": false, "mergeable": false, "rebaseable": false, "mergeable_state": "dirty", "merged_by": null, "comments": 13, "review_comments": 5, "maintainer_can_modify": false, "commits": 4, "additions": 230, "deletions": 0, "changed_files": 3}