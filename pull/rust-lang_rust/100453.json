{"url": "https://api.github.com/repos/rust-lang/rust/pulls/100453", "id": 1024894798, "node_id": "PR_kwDOAAsO6M49FqdO", "html_url": "https://github.com/rust-lang/rust/pull/100453", "diff_url": "https://github.com/rust-lang/rust/pull/100453.diff", "patch_url": "https://github.com/rust-lang/rust/pull/100453.patch", "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/100453", "number": 100453, "state": "closed", "locked": false, "title": "Loosen shadowing check inside macro contexts (attempt 2).", "user": {"login": "davidv1992", "id": 518970, "node_id": "MDQ6VXNlcjUxODk3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/518970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidv1992", "html_url": "https://github.com/davidv1992", "followers_url": "https://api.github.com/users/davidv1992/followers", "following_url": "https://api.github.com/users/davidv1992/following{/other_user}", "gists_url": "https://api.github.com/users/davidv1992/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidv1992/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidv1992/subscriptions", "organizations_url": "https://api.github.com/users/davidv1992/orgs", "repos_url": "https://api.github.com/users/davidv1992/repos", "events_url": "https://api.github.com/users/davidv1992/events{/privacy}", "received_events_url": "https://api.github.com/users/davidv1992/received_events", "type": "User", "site_admin": false}, "body": "This allows macro code to use identifiers for local variables which are \r\nalso defined as globals outside of the macro, so long as their\r\ndefinition is not ambiguous. This improves predictability of code\r\ncontaining macros, and reduces the leakage of macro implementation\r\ndetails to their surroundings.\r\n\r\nConcretely, constructions such as\r\n```rust\r\nthread_local!(static FOO: usize = 0);\r\nstatic init: usize = 0;\r\n```\r\nno longer generate unexpected error messages on the implementation\r\ndetail that thread_local! defines a function with init as a parameter\r\nname.\r\n\r\nThis fixes #99018\r\n\r\nNote that this is a reworked implementation of #99191. Despite the comments of @petrochenkov I am of the opinion that this is worthwhile to merge, and does not really represent a change in the hygiene rules. However, I agree with the statement there that this will need a lang FCP.\r\n\r\nMy argument for this is that this is not a change in the hygiene rules for consts/statics/etc.., but rather represents a fix for an edge case in local variable and parameter name hygiene. As a developer, the intuition behind macro hygiene for locals is that there is effectively a separate namespace for locals defined fully within the macro. As such, when a variable definition in the macro is not ambiguous, I would expect it to not cause any noticeable side-effects outside of the macro. This patch aimed at ensuring just that.\r\n\r\nSecondarily, the possibly confusing behavior that is at the basis of the error message generated outside of macros also is less of a concern within macros, as the macro probably was never written with the idea in mind that there might be a name collision on a variable name in the first place. (As an aside, I'm not even sure why E0530 is a hard error and not a warning, but let's leave that out of scope for now)\r\n\r\nA nice side effect to this change is that changes of internal variable names used inside macros should no longer be potential breaking changes for the user of the macro, which should help with stability guarantees.\r\n\r\nPS: Apologies that it took me a while to react to the comments made in the previous pull request, I had some personal circumstances that prevented me from putting significant time towards this project.\r\n\r\nr? @petrochenkov", "created_at": "2022-08-12T12:27:39Z", "updated_at": "2022-09-22T15:10:55Z", "closed_at": "2022-09-22T06:39:02Z", "merged_at": null, "merge_commit_sha": "641a79e34042da01c81771d68c4014f75559fe77", "assignee": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 583437099, "node_id": "MDU6TGFiZWw1ODM0MzcwOTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-team", "name": "S-waiting-on-team", "color": "d3dddd", "default": false, "description": "Status: Awaiting decision from the relevant subteam (see the T-<team> label)."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}, {"id": 943968375, "node_id": "MDU6TGFiZWw5NDM5NjgzNzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-close", "name": "disposition-close", "color": "dd0000", "default": false, "description": "This PR / issue is in PFCP or FCP with a disposition to close it."}], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/rust-lang/rust/pulls/100453/commits", "review_comments_url": "https://api.github.com/repos/rust-lang/rust/pulls/100453/comments", "review_comment_url": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100453/comments", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/287edaa3b7be00af1a6224a5f0d87d47865f50d0", "head": {"label": "davidv1992:shadow-macro-hygiene", "ref": "shadow-macro-hygiene", "sha": "287edaa3b7be00af1a6224a5f0d87d47865f50d0", "user": {"login": "davidv1992", "id": 518970, "node_id": "MDQ6VXNlcjUxODk3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/518970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidv1992", "html_url": "https://github.com/davidv1992", "followers_url": "https://api.github.com/users/davidv1992/followers", "following_url": "https://api.github.com/users/davidv1992/following{/other_user}", "gists_url": "https://api.github.com/users/davidv1992/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidv1992/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidv1992/subscriptions", "organizations_url": "https://api.github.com/users/davidv1992/orgs", "repos_url": "https://api.github.com/users/davidv1992/repos", "events_url": "https://api.github.com/users/davidv1992/events{/privacy}", "received_events_url": "https://api.github.com/users/davidv1992/received_events", "type": "User", "site_admin": false}, "repo": {"id": 506186046, "node_id": "R_kgDOHivJPg", "name": "rust", "full_name": "davidv1992/rust", "private": false, "owner": {"login": "davidv1992", "id": 518970, "node_id": "MDQ6VXNlcjUxODk3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/518970?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidv1992", "html_url": "https://github.com/davidv1992", "followers_url": "https://api.github.com/users/davidv1992/followers", "following_url": "https://api.github.com/users/davidv1992/following{/other_user}", "gists_url": "https://api.github.com/users/davidv1992/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidv1992/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidv1992/subscriptions", "organizations_url": "https://api.github.com/users/davidv1992/orgs", "repos_url": "https://api.github.com/users/davidv1992/repos", "events_url": "https://api.github.com/users/davidv1992/events{/privacy}", "received_events_url": "https://api.github.com/users/davidv1992/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/davidv1992/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": true, "url": "https://api.github.com/repos/davidv1992/rust", "forks_url": "https://api.github.com/repos/davidv1992/rust/forks", "keys_url": "https://api.github.com/repos/davidv1992/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/davidv1992/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/davidv1992/rust/teams", "hooks_url": "https://api.github.com/repos/davidv1992/rust/hooks", "issue_events_url": "https://api.github.com/repos/davidv1992/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/davidv1992/rust/events", "assignees_url": "https://api.github.com/repos/davidv1992/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/davidv1992/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/davidv1992/rust/tags", "blobs_url": "https://api.github.com/repos/davidv1992/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/davidv1992/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/davidv1992/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/davidv1992/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/davidv1992/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/davidv1992/rust/languages", "stargazers_url": "https://api.github.com/repos/davidv1992/rust/stargazers", "contributors_url": "https://api.github.com/repos/davidv1992/rust/contributors", "subscribers_url": "https://api.github.com/repos/davidv1992/rust/subscribers", "subscription_url": "https://api.github.com/repos/davidv1992/rust/subscription", "commits_url": "https://api.github.com/repos/davidv1992/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/davidv1992/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/davidv1992/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/davidv1992/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/davidv1992/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/davidv1992/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/davidv1992/rust/merges", "archive_url": "https://api.github.com/repos/davidv1992/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/davidv1992/rust/downloads", "issues_url": "https://api.github.com/repos/davidv1992/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/davidv1992/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/davidv1992/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/davidv1992/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/davidv1992/rust/labels{/name}", "releases_url": "https://api.github.com/repos/davidv1992/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/davidv1992/rust/deployments", "created_at": "2022-06-22T09:44:39Z", "updated_at": "2022-08-12T12:04:11Z", "pushed_at": "2022-08-12T12:02:27Z", "git_url": "git://github.com/davidv1992/rust.git", "ssh_url": "git@github.com:davidv1992/rust.git", "clone_url": "https://github.com/davidv1992/rust.git", "svn_url": "https://github.com/davidv1992/rust", "homepage": "https://www.rust-lang.org", "size": 936529, "stargazers_count": 0, "watchers_count": 0, "language": "Rust", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "rust-lang:master", "ref": "master", "sha": "cc65e1a548abee1d664113abd117b79055532ffa", "user": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 724712, "node_id": "MDEwOlJlcG9zaXRvcnk3MjQ3MTI=", "name": "rust", "full_name": "rust-lang/rust", "private": false, "owner": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/rust-lang/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": false, "url": "https://api.github.com/repos/rust-lang/rust", "forks_url": "https://api.github.com/repos/rust-lang/rust/forks", "keys_url": "https://api.github.com/repos/rust-lang/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/rust-lang/rust/teams", "hooks_url": "https://api.github.com/repos/rust-lang/rust/hooks", "issue_events_url": "https://api.github.com/repos/rust-lang/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/rust-lang/rust/events", "assignees_url": "https://api.github.com/repos/rust-lang/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/rust-lang/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/rust-lang/rust/tags", "blobs_url": "https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/rust-lang/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/rust-lang/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/rust-lang/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/rust-lang/rust/languages", "stargazers_url": "https://api.github.com/repos/rust-lang/rust/stargazers", "contributors_url": "https://api.github.com/repos/rust-lang/rust/contributors", "subscribers_url": "https://api.github.com/repos/rust-lang/rust/subscribers", "subscription_url": "https://api.github.com/repos/rust-lang/rust/subscription", "commits_url": "https://api.github.com/repos/rust-lang/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/rust-lang/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/rust-lang/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/rust-lang/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/rust-lang/rust/merges", "archive_url": "https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/rust-lang/rust/downloads", "issues_url": "https://api.github.com/repos/rust-lang/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/rust-lang/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/rust-lang/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/rust-lang/rust/labels{/name}", "releases_url": "https://api.github.com/repos/rust-lang/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/rust-lang/rust/deployments", "created_at": "2010-06-16T20:39:03Z", "updated_at": "2023-06-20T05:25:49Z", "pushed_at": "2023-06-20T05:32:43Z", "git_url": "git://github.com/rust-lang/rust.git", "ssh_url": "git@github.com:rust-lang/rust.git", "clone_url": "https://github.com/rust-lang/rust.git", "svn_url": "https://github.com/rust-lang/rust", "homepage": "https://www.rust-lang.org", "size": 930404, "stargazers_count": 82763, "watchers_count": 82763, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 10964, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 9633, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["compiler", "hacktoberfest", "language", "rust"], "visibility": "public", "forks": 10964, "open_issues": 9633, "watchers": 82763, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/100453"}, "html": {"href": "https://github.com/rust-lang/rust/pull/100453"}, "issue": {"href": "https://api.github.com/repos/rust-lang/rust/issues/100453"}, "comments": {"href": "https://api.github.com/repos/rust-lang/rust/issues/100453/comments"}, "review_comments": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/100453/comments"}, "review_comment": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/100453/commits"}, "statuses": {"href": "https://api.github.com/repos/rust-lang/rust/statuses/287edaa3b7be00af1a6224a5f0d87d47865f50d0"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": false, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": null, "comments": 7, "review_comments": 1, "maintainer_can_modify": false, "commits": 1, "additions": 176, "deletions": 22, "changed_files": 6}