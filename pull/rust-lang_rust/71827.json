{"url": "https://api.github.com/repos/rust-lang/rust/pulls/71827", "id": 412567473, "node_id": "MDExOlB1bGxSZXF1ZXN0NDEyNTY3NDcz", "html_url": "https://github.com/rust-lang/rust/pull/71827", "diff_url": "https://github.com/rust-lang/rust/pull/71827.diff", "patch_url": "https://github.com/rust-lang/rust/pull/71827.patch", "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/71827", "number": 71827, "state": "closed", "locked": false, "title": "Better method call error messages", "user": {"login": "Quantumplation", "id": 49870, "node_id": "MDQ6VXNlcjQ5ODcw", "avatar_url": "https://avatars.githubusercontent.com/u/49870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Quantumplation", "html_url": "https://github.com/Quantumplation", "followers_url": "https://api.github.com/users/Quantumplation/followers", "following_url": "https://api.github.com/users/Quantumplation/following{/other_user}", "gists_url": "https://api.github.com/users/Quantumplation/gists{/gist_id}", "starred_url": "https://api.github.com/users/Quantumplation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Quantumplation/subscriptions", "organizations_url": "https://api.github.com/users/Quantumplation/orgs", "repos_url": "https://api.github.com/users/Quantumplation/repos", "events_url": "https://api.github.com/users/Quantumplation/events{/privacy}", "received_events_url": "https://api.github.com/users/Quantumplation/received_events", "type": "User", "site_admin": false}, "body": "## Summary\r\n\r\nThis attempts to bring better error messages to invalid method calls, by applying some heuristics to identify common mistakes. Closes #65853.\r\n\r\nSo, as just one example, instead of:\r\n\r\n```\r\nerror[E0061]: this function takes 2 arguments but 3 arguments were supplied\r\n  --> src/main.rs:12:5\r\n   |\r\n10 | fn vec2D(_x: X, _y: Y) {}\r\n   | ---------------------- defined here\r\n11 | fn main() {\r\n12 |     vec2D(X {}, Y {}, Z {});\r\n   |     ^^^^^ ----  ----  ---- supplied 3 arguments\r\n   |     |\r\n   |     expected 2 arguments\r\n```\r\n\r\nWe can provide something along the lines of\r\n```\r\nerror[E0059]: one or more arguments to this function are incorrect\r\n  --> /home/vsonline/workspace/rust/src/test/ui/argument-suggestions/basic.rs:11:5\r\n   |\r\nLL |     vec2D(X {}, Y {}, Z {});\r\n   |     ^^^^^^^^^^^^^^^^^^----^\r\n   |                       |\r\n   |                       this argument appears to be extra\r\n```\r\n\r\n**That being said, the error messages themselves are what I'm seeking the most feedback on**\r\n\r\n## Terminology\r\n\r\nThe thing that will probably help the most when reading this code is being strict about the following terms:\r\n - \"inputs\" refers to the inputs being *expected* by the function,\r\n - \"arguments\" refers to what has been provided at the call site\r\n\r\n## Algorithm\r\n### Overview\r\nThe algorithm is inspired by Levenshtein distance and longest common sub-sequence.   In essence, we treat the types of the function, and the types of the arguments you provided as two \"words\" and compute the edits to get from one to the other.\r\n\r\nWe then extend that algorithm to distinguish 5 cases:\r\n\r\n - A function input is missing\r\n - An extra argument was provided\r\n - The type of an argument is straight up invalid\r\n - Two arguments have been swapped\r\n - A subset of the arguments have been shuffled\r\n\r\n(We detect the last two as separate cases so that we can detect two swaps, instead of 4 parameters permuted.)\r\n\r\n### Details\r\n\r\nThe basic sketch of the algorithm is as follows:\r\n\r\n - Construct a boolean grid, with a row for each argument, and a column for each input.  The cell [i, j] is true if the i'th argument could satisfy the j'th input.\r\n - If we find an argument that could satisfy no inputs, provided for an input that can't be satisfied by any other argument, we consider this an \"invalid type\".\r\n - Extra arguments are those that can't satisfy any input, provided for an input that *could* be satisfied by another argument.\r\n - Missing inputs are inputs that can't be satisfied by any argument, where the provided argument could satisfy another input\r\n - Swapped / Permuted arguments are identified with a cycle detection algorithm.\r\n\r\nAs each issue is found, we remove the relevant inputs / arguments and check for more issues.  If we find no issues, we match up any \"valid\" arguments, and start again.\r\n\r\n### Even more details\r\n\r\nNote that there's a lot of extra complexity:\r\n - We try to stay efficient on the happy path, only computing the diagonal until we find a problem, and then filling in the rest of the matrix.\r\n - Closure arguments are wrapped in a tuple and need to be unwrapped\r\n - We need to resolve closure types after the rest, to allow the most specific type constraints\r\n - We need to handle imported C functions that might be variadic in their inputs.\r\n\r\nI tried to document a lot of this in comments in the code and keep the naming clear.\r\n\r\n## Remaining work for this PR\r\n - Improve the diagnostics A LOT.  The `complex` case from the test I added in particular shows how noisy it can get\r\n - A few small FIXMEs\r\n - I can probably improve the performance further by not allocating the compatibility_matrix until call_appears_satisfied is false, and only use a single vector for the \"diagonal\" copying this into the CM\r\n - I'm rather new to rust, so some of this may be un-idiomatic, and I'm open to suggestions\r\n - Similarly, if anything has existing implementations (or should be implemented elsewhere), I'm happy to switch over to those, I'm just unfamiliar with what's available.\r\n - I was also considering pulling this logic out into it's own file, since it's getting more nuanced, but I wanted to see what other people thought first\r\n - Blessing / reviewing other tests (didn't want to do this until the diagnostics were finalized)\r\n - Lots more test cases (and potentially centralizing some existing tests?)\r\n - Any other feedback welcome!\r\n\r\n## Potential extensions\r\n - Extend the notion of \"compatibility\" to be tolerant to borrow and mutability\r\n - Feed our best guess for argument input assignment into the types table, to help things like trait inference (i.e. if you leave off an argument, don't let that screw up trait inference for everything after it)\r\n\r\nr? @estebank since he helped me a lot with this", "created_at": "2020-05-03T08:18:25Z", "updated_at": "2022-03-01T21:20:50Z", "closed_at": "2022-03-01T21:20:49Z", "merged_at": null, "merge_commit_sha": "82199b5dfcd55703343867480ea60461eb1d0e10", "assignee": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 583436937, "node_id": "MDU6TGFiZWw1ODM0MzY5Mzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-author", "name": "S-waiting-on-author", "color": "d3dddd", "default": false, "description": "Status: This is awaiting some action (such as code changes or more information) from the author."}], "milestone": null, "draft": true, "commits_url": "https://api.github.com/repos/rust-lang/rust/pulls/71827/commits", "review_comments_url": "https://api.github.com/repos/rust-lang/rust/pulls/71827/comments", "review_comment_url": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/71827/comments", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/52672859a031e2c749e11c80b3a8727c781edbc5", "head": {"label": "Quantumplation:65853/param-heuristics", "ref": "65853/param-heuristics", "sha": "52672859a031e2c749e11c80b3a8727c781edbc5", "user": {"login": "Quantumplation", "id": 49870, "node_id": "MDQ6VXNlcjQ5ODcw", "avatar_url": "https://avatars.githubusercontent.com/u/49870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Quantumplation", "html_url": "https://github.com/Quantumplation", "followers_url": "https://api.github.com/users/Quantumplation/followers", "following_url": "https://api.github.com/users/Quantumplation/following{/other_user}", "gists_url": "https://api.github.com/users/Quantumplation/gists{/gist_id}", "starred_url": "https://api.github.com/users/Quantumplation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Quantumplation/subscriptions", "organizations_url": "https://api.github.com/users/Quantumplation/orgs", "repos_url": "https://api.github.com/users/Quantumplation/repos", "events_url": "https://api.github.com/users/Quantumplation/events{/privacy}", "received_events_url": "https://api.github.com/users/Quantumplation/received_events", "type": "User", "site_admin": false}, "repo": {"id": 216959189, "node_id": "MDEwOlJlcG9zaXRvcnkyMTY5NTkxODk=", "name": "rust", "full_name": "Quantumplation/rust", "private": false, "owner": {"login": "Quantumplation", "id": 49870, "node_id": "MDQ6VXNlcjQ5ODcw", "avatar_url": "https://avatars.githubusercontent.com/u/49870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Quantumplation", "html_url": "https://github.com/Quantumplation", "followers_url": "https://api.github.com/users/Quantumplation/followers", "following_url": "https://api.github.com/users/Quantumplation/following{/other_user}", "gists_url": "https://api.github.com/users/Quantumplation/gists{/gist_id}", "starred_url": "https://api.github.com/users/Quantumplation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Quantumplation/subscriptions", "organizations_url": "https://api.github.com/users/Quantumplation/orgs", "repos_url": "https://api.github.com/users/Quantumplation/repos", "events_url": "https://api.github.com/users/Quantumplation/events{/privacy}", "received_events_url": "https://api.github.com/users/Quantumplation/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/Quantumplation/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": true, "url": "https://api.github.com/repos/Quantumplation/rust", "forks_url": "https://api.github.com/repos/Quantumplation/rust/forks", "keys_url": "https://api.github.com/repos/Quantumplation/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/Quantumplation/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/Quantumplation/rust/teams", "hooks_url": "https://api.github.com/repos/Quantumplation/rust/hooks", "issue_events_url": "https://api.github.com/repos/Quantumplation/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/Quantumplation/rust/events", "assignees_url": "https://api.github.com/repos/Quantumplation/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/Quantumplation/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/Quantumplation/rust/tags", "blobs_url": "https://api.github.com/repos/Quantumplation/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/Quantumplation/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/Quantumplation/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/Quantumplation/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/Quantumplation/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/Quantumplation/rust/languages", "stargazers_url": "https://api.github.com/repos/Quantumplation/rust/stargazers", "contributors_url": "https://api.github.com/repos/Quantumplation/rust/contributors", "subscribers_url": "https://api.github.com/repos/Quantumplation/rust/subscribers", "subscription_url": "https://api.github.com/repos/Quantumplation/rust/subscription", "commits_url": "https://api.github.com/repos/Quantumplation/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/Quantumplation/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/Quantumplation/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/Quantumplation/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/Quantumplation/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/Quantumplation/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/Quantumplation/rust/merges", "archive_url": "https://api.github.com/repos/Quantumplation/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/Quantumplation/rust/downloads", "issues_url": "https://api.github.com/repos/Quantumplation/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/Quantumplation/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/Quantumplation/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/Quantumplation/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/Quantumplation/rust/labels{/name}", "releases_url": "https://api.github.com/repos/Quantumplation/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/Quantumplation/rust/deployments", "created_at": "2019-10-23T03:22:28Z", "updated_at": "2020-12-31T03:41:33Z", "pushed_at": "2021-02-07T06:23:33Z", "git_url": "git://github.com/Quantumplation/rust.git", "ssh_url": "git@github.com:Quantumplation/rust.git", "clone_url": "https://github.com/Quantumplation/rust.git", "svn_url": "https://github.com/Quantumplation/rust", "homepage": "https://www.rust-lang.org", "size": 587259, "stargazers_count": 0, "watchers_count": 0, "language": "Rust", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "rust-lang:master", "ref": "master", "sha": "89b9f7b284aacc5f8613438b80e4dd7bdd10549e", "user": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 724712, "node_id": "MDEwOlJlcG9zaXRvcnk3MjQ3MTI=", "name": "rust", "full_name": "rust-lang/rust", "private": false, "owner": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/rust-lang/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": false, "url": "https://api.github.com/repos/rust-lang/rust", "forks_url": "https://api.github.com/repos/rust-lang/rust/forks", "keys_url": "https://api.github.com/repos/rust-lang/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/rust-lang/rust/teams", "hooks_url": "https://api.github.com/repos/rust-lang/rust/hooks", "issue_events_url": "https://api.github.com/repos/rust-lang/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/rust-lang/rust/events", "assignees_url": "https://api.github.com/repos/rust-lang/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/rust-lang/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/rust-lang/rust/tags", "blobs_url": "https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/rust-lang/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/rust-lang/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/rust-lang/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/rust-lang/rust/languages", "stargazers_url": "https://api.github.com/repos/rust-lang/rust/stargazers", "contributors_url": "https://api.github.com/repos/rust-lang/rust/contributors", "subscribers_url": "https://api.github.com/repos/rust-lang/rust/subscribers", "subscription_url": "https://api.github.com/repos/rust-lang/rust/subscription", "commits_url": "https://api.github.com/repos/rust-lang/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/rust-lang/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/rust-lang/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/rust-lang/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/rust-lang/rust/merges", "archive_url": "https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/rust-lang/rust/downloads", "issues_url": "https://api.github.com/repos/rust-lang/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/rust-lang/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/rust-lang/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/rust-lang/rust/labels{/name}", "releases_url": "https://api.github.com/repos/rust-lang/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/rust-lang/rust/deployments", "created_at": "2010-06-16T20:39:03Z", "updated_at": "2023-06-20T05:47:10Z", "pushed_at": "2023-06-20T05:32:43Z", "git_url": "git://github.com/rust-lang/rust.git", "ssh_url": "git@github.com:rust-lang/rust.git", "clone_url": "https://github.com/rust-lang/rust.git", "svn_url": "https://github.com/rust-lang/rust", "homepage": "https://www.rust-lang.org", "size": 930404, "stargazers_count": 82764, "watchers_count": 82764, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 10964, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 9633, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["compiler", "hacktoberfest", "language", "rust"], "visibility": "public", "forks": 10964, "open_issues": 9633, "watchers": 82764, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/71827"}, "html": {"href": "https://github.com/rust-lang/rust/pull/71827"}, "issue": {"href": "https://api.github.com/repos/rust-lang/rust/issues/71827"}, "comments": {"href": "https://api.github.com/repos/rust-lang/rust/issues/71827/comments"}, "review_comments": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/71827/comments"}, "review_comment": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/71827/commits"}, "statuses": {"href": "https://api.github.com/repos/rust-lang/rust/statuses/52672859a031e2c749e11c80b3a8727c781edbc5"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": false, "mergeable": false, "rebaseable": false, "mergeable_state": "dirty", "merged_by": null, "comments": 19, "review_comments": 63, "maintainer_can_modify": false, "commits": 21, "additions": 8723, "deletions": 3583, "changed_files": 241}