{"url": "https://api.github.com/repos/rust-lang/rust/pulls/70999", "id": 402009270, "node_id": "MDExOlB1bGxSZXF1ZXN0NDAyMDA5Mjcw", "html_url": "https://github.com/rust-lang/rust/pull/70999", "diff_url": "https://github.com/rust-lang/rust/pull/70999.diff", "patch_url": "https://github.com/rust-lang/rust/pull/70999.patch", "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/70999", "number": 70999, "state": "closed", "locked": false, "title": "Support building with \"cargo\" directly instead of \"x.py\" for development purposes", "user": {"login": "luca-barbieri", "id": 298418, "node_id": "MDQ6VXNlcjI5ODQxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/298418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luca-barbieri", "html_url": "https://github.com/luca-barbieri", "followers_url": "https://api.github.com/users/luca-barbieri/followers", "following_url": "https://api.github.com/users/luca-barbieri/following{/other_user}", "gists_url": "https://api.github.com/users/luca-barbieri/gists{/gist_id}", "starred_url": "https://api.github.com/users/luca-barbieri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luca-barbieri/subscriptions", "organizations_url": "https://api.github.com/users/luca-barbieri/orgs", "repos_url": "https://api.github.com/users/luca-barbieri/repos", "events_url": "https://api.github.com/users/luca-barbieri/events{/privacy}", "received_events_url": "https://api.github.com/users/luca-barbieri/received_events", "type": "User", "site_admin": false}, "body": "This pull request allows to just use `cargo` in addition to `x.py` for rustc and libstd development.\r\n\r\nThis makes it much simpler for new contributors to contribute to rust since there is no need to learn how `x.py` and bootstrapping works, and makes incremental development faster because this new infrastructure does no bootstrapping at all.\r\n\r\nTo make it work, the user is supposed to install the latest nightly with rustup, and then make changes based on a checkout of the same git commit hash of that nightly: this allows to build a new rustc that works with the standard library from the nightly, and to build a new non-cfg(bootstrap) standard library with the compiler from the nightly.\r\n\r\nTo support this workflow, we check and warn in build.rs if the compiler and repository versions don't match, and we set the compiler release to the same one of the compiler used to build so that artifacts can be shared between them.\r\n\r\nSummary of changes:\r\n- Several changes to make things build without the setup done by `x.py`\r\n- Centralization of code that reads CFG_ environment variables to rustc_session, so they can be set in the build.rs for rustc_session\r\n- build.rs code to detect the rustc version and warn if it is not the correct one, including suggestions on how to fix the issues\r\n\r\nWith these changes, this is currently working:\r\n- Running `cargo check` for single crates\r\n- Running `cargo run` in src/rustc and having a working compiler without any bootstrapping\r\n- Running `cargo build` in src/libstd, src/libcore or src/libtest\r\n- Testing by running `__CARGO_TESTS_ONLY_SRC_ROOT=$(realpath $PWD/../..) cargo test -Z build-std --target x86_64-unknown-linux-gnu` in src/libcore\r\n\r\nWhat is not working and missing:\r\n- Testing libstd\r\n- Checking or building the whole workspace, even with the build-std incantation\r\n- No way to install the built artifacts, even though they work in place\r\n- No easy way to do a full bootstrap other than using `x.py`\r\n\r\nFuture work would be to document this, and modify cargo's std-aware code so that libstd can be tested and the special incantation is no longer needed to run libstd tests, and so that you can just build the whole workspace with \"cargo build\" and have it work as if the pieces were built independently.\r\n", "created_at": "2020-04-10T18:06:40Z", "updated_at": "2020-04-30T11:51:29Z", "closed_at": "2020-04-30T11:51:28Z", "merged_at": null, "merge_commit_sha": "13e3e3578d225141c64773a17cf4fa79aec63b51", "assignee": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 627350354, "node_id": "MDU6TGFiZWw2MjczNTAzNTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-inactive", "name": "S-inactive", "color": "d3dddd", "default": false, "description": "Status: Inactive and waiting on the author. This is often applied to closed PRs."}], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/rust-lang/rust/pulls/70999/commits", "review_comments_url": "https://api.github.com/repos/rust-lang/rust/pulls/70999/comments", "review_comment_url": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/70999/comments", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/8c1303b992100a26e47614ab506b771602ce222c", "head": {"label": "luca-barbieri:cargo_build", "ref": "cargo_build", "sha": "8c1303b992100a26e47614ab506b771602ce222c", "user": {"login": "luca-barbieri", "id": 298418, "node_id": "MDQ6VXNlcjI5ODQxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/298418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luca-barbieri", "html_url": "https://github.com/luca-barbieri", "followers_url": "https://api.github.com/users/luca-barbieri/followers", "following_url": "https://api.github.com/users/luca-barbieri/following{/other_user}", "gists_url": "https://api.github.com/users/luca-barbieri/gists{/gist_id}", "starred_url": "https://api.github.com/users/luca-barbieri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luca-barbieri/subscriptions", "organizations_url": "https://api.github.com/users/luca-barbieri/orgs", "repos_url": "https://api.github.com/users/luca-barbieri/repos", "events_url": "https://api.github.com/users/luca-barbieri/events{/privacy}", "received_events_url": "https://api.github.com/users/luca-barbieri/received_events", "type": "User", "site_admin": false}, "repo": {"id": 197373588, "node_id": "MDEwOlJlcG9zaXRvcnkxOTczNzM1ODg=", "name": "rust", "full_name": "luca-barbieri/rust", "private": false, "owner": {"login": "luca-barbieri", "id": 298418, "node_id": "MDQ6VXNlcjI5ODQxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/298418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luca-barbieri", "html_url": "https://github.com/luca-barbieri", "followers_url": "https://api.github.com/users/luca-barbieri/followers", "following_url": "https://api.github.com/users/luca-barbieri/following{/other_user}", "gists_url": "https://api.github.com/users/luca-barbieri/gists{/gist_id}", "starred_url": "https://api.github.com/users/luca-barbieri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luca-barbieri/subscriptions", "organizations_url": "https://api.github.com/users/luca-barbieri/orgs", "repos_url": "https://api.github.com/users/luca-barbieri/repos", "events_url": "https://api.github.com/users/luca-barbieri/events{/privacy}", "received_events_url": "https://api.github.com/users/luca-barbieri/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/luca-barbieri/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": true, "url": "https://api.github.com/repos/luca-barbieri/rust", "forks_url": "https://api.github.com/repos/luca-barbieri/rust/forks", "keys_url": "https://api.github.com/repos/luca-barbieri/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/luca-barbieri/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/luca-barbieri/rust/teams", "hooks_url": "https://api.github.com/repos/luca-barbieri/rust/hooks", "issue_events_url": "https://api.github.com/repos/luca-barbieri/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/luca-barbieri/rust/events", "assignees_url": "https://api.github.com/repos/luca-barbieri/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/luca-barbieri/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/luca-barbieri/rust/tags", "blobs_url": "https://api.github.com/repos/luca-barbieri/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/luca-barbieri/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/luca-barbieri/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/luca-barbieri/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/luca-barbieri/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/luca-barbieri/rust/languages", "stargazers_url": "https://api.github.com/repos/luca-barbieri/rust/stargazers", "contributors_url": "https://api.github.com/repos/luca-barbieri/rust/contributors", "subscribers_url": "https://api.github.com/repos/luca-barbieri/rust/subscribers", "subscription_url": "https://api.github.com/repos/luca-barbieri/rust/subscription", "commits_url": "https://api.github.com/repos/luca-barbieri/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/luca-barbieri/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/luca-barbieri/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/luca-barbieri/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/luca-barbieri/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/luca-barbieri/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/luca-barbieri/rust/merges", "archive_url": "https://api.github.com/repos/luca-barbieri/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/luca-barbieri/rust/downloads", "issues_url": "https://api.github.com/repos/luca-barbieri/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/luca-barbieri/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/luca-barbieri/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/luca-barbieri/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/luca-barbieri/rust/labels{/name}", "releases_url": "https://api.github.com/repos/luca-barbieri/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/luca-barbieri/rust/deployments", "created_at": "2019-07-17T11:09:36Z", "updated_at": "2020-04-03T18:02:44Z", "pushed_at": "2020-04-10T20:43:31Z", "git_url": "git://github.com/luca-barbieri/rust.git", "ssh_url": "git@github.com:luca-barbieri/rust.git", "clone_url": "https://github.com/luca-barbieri/rust.git", "svn_url": "https://github.com/luca-barbieri/rust", "homepage": "https://www.rust-lang.org", "size": 504618, "stargazers_count": 0, "watchers_count": 0, "language": "Rust", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "rust-lang:master", "ref": "master", "sha": "9682f0e14db95076454559a24c26287bcad57955", "user": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 724712, "node_id": "MDEwOlJlcG9zaXRvcnk3MjQ3MTI=", "name": "rust", "full_name": "rust-lang/rust", "private": false, "owner": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/rust-lang/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": false, "url": "https://api.github.com/repos/rust-lang/rust", "forks_url": "https://api.github.com/repos/rust-lang/rust/forks", "keys_url": "https://api.github.com/repos/rust-lang/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/rust-lang/rust/teams", "hooks_url": "https://api.github.com/repos/rust-lang/rust/hooks", "issue_events_url": "https://api.github.com/repos/rust-lang/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/rust-lang/rust/events", "assignees_url": "https://api.github.com/repos/rust-lang/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/rust-lang/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/rust-lang/rust/tags", "blobs_url": "https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/rust-lang/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/rust-lang/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/rust-lang/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/rust-lang/rust/languages", "stargazers_url": "https://api.github.com/repos/rust-lang/rust/stargazers", "contributors_url": "https://api.github.com/repos/rust-lang/rust/contributors", "subscribers_url": "https://api.github.com/repos/rust-lang/rust/subscribers", "subscription_url": "https://api.github.com/repos/rust-lang/rust/subscription", "commits_url": "https://api.github.com/repos/rust-lang/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/rust-lang/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/rust-lang/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/rust-lang/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/rust-lang/rust/merges", "archive_url": "https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/rust-lang/rust/downloads", "issues_url": "https://api.github.com/repos/rust-lang/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/rust-lang/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/rust-lang/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/rust-lang/rust/labels{/name}", "releases_url": "https://api.github.com/repos/rust-lang/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/rust-lang/rust/deployments", "created_at": "2010-06-16T20:39:03Z", "updated_at": "2023-06-20T04:51:05Z", "pushed_at": "2023-06-20T04:46:31Z", "git_url": "git://github.com/rust-lang/rust.git", "ssh_url": "git@github.com:rust-lang/rust.git", "clone_url": "https://github.com/rust-lang/rust.git", "svn_url": "https://github.com/rust-lang/rust", "homepage": "https://www.rust-lang.org", "size": 930404, "stargazers_count": 82762, "watchers_count": 82762, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 10963, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 9630, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["compiler", "hacktoberfest", "language", "rust"], "visibility": "public", "forks": 10963, "open_issues": 9630, "watchers": 82762, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/70999"}, "html": {"href": "https://github.com/rust-lang/rust/pull/70999"}, "issue": {"href": "https://api.github.com/repos/rust-lang/rust/issues/70999"}, "comments": {"href": "https://api.github.com/repos/rust-lang/rust/issues/70999/comments"}, "review_comments": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/70999/comments"}, "review_comment": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/70999/commits"}, "statuses": {"href": "https://api.github.com/repos/rust-lang/rust/statuses/8c1303b992100a26e47614ab506b771602ce222c"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": false, "mergeable": false, "rebaseable": false, "mergeable_state": "dirty", "merged_by": null, "comments": 9, "review_comments": 0, "maintainer_can_modify": false, "commits": 13, "additions": 695, "deletions": 98, "changed_files": 48}