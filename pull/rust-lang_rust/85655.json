{"url": "https://api.github.com/repos/rust-lang/rust/pulls/85655", "id": 651798045, "node_id": "MDExOlB1bGxSZXF1ZXN0NjUxNzk4MDQ1", "html_url": "https://github.com/rust-lang/rust/pull/85655", "diff_url": "https://github.com/rust-lang/rust/pull/85655.diff", "patch_url": "https://github.com/rust-lang/rust/pull/85655.patch", "issue_url": "https://api.github.com/repos/rust-lang/rust/issues/85655", "number": 85655, "state": "closed", "locked": false, "title": "Change `Ipv6Addr::is_loopback` to include IPv4-mapped loopback addresses", "user": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "body": "This PR addresses one of the issues that came up during the larger efforts of trying to stabilize the `ip` feature, see also the most recent stabilization PR #85585 and issue #85609 where I have tried to summarize all the relevant discussion so far.\r\n\r\nFixes #69772\r\n\r\nEdit: for an alternative to this PR, see #86335 which commits to *not* supporting IPv4-in-IPv6 addresses (so leaving `is_loopback` unchanged).\r\n\r\n## Overview\r\n\r\nThere are two ways of representing an IPv4 address in a IPv6 address:\r\n- As an IPv4-compatible IPv6 address:  `::1.2.3.4`\r\n- As an IPv4-mapped IPv6 address:  `::ffff:1.2.3.4`\r\n\r\n#69772 raised the issue that other languages take IPv4-mapped addresses into account in their equivalent of `is_loopback`, for example `::ffff:127.0.0.1`. This raised the broader question about which (if any) methods of `Ipv6Addr` should consider IPv4-mapped or IPv4-compatible addresses. \r\n\r\nWhile we don't yet have a clear answer in general, for `is_loopback` is seems pretty clear that supporting addresses like `::ffff:127.0.0.1` is a good idea: .NET, Java, Python and Go all follow this behaviour (#69772, https://github.com/rust-lang/rust/pull/76098#discussion_r528738546). This behaviour is also implemented by many real world networking hardware/software (try `ping ::ffff::127.0.0.1`). In short, it is surprising for users that the Rust implementation is different. Regarding IPv4-compatible addresses, those are deprecated and of the tested other languages none took them into account (try also `ping ::127.0.0.1`).\r\n\r\n## Implementation\r\n\r\nThis PR changes the behaviour of `is_loopback` from\r\n\r\n```rust\r\n/// Returns [`true`] if this is a loopback address (::1).\r\n```\r\n\r\nto\r\n\r\n```rust\r\n/// Returns [`true`] if this is either:\r\n/// - the [loopback address] as defined in [IETF RFC 4291 section 2.5.3] (`::1`).\r\n/// - an [IPv4-mapped] address representing an IPv4 loopback address as defined in [IETF RFC 1122] (`::ffff:127.0.0.0/104`).\r\n///\r\n/// Note that this does not return [`true`] for an [IPv4-compatible] address representing an IPv4 loopback address (`::127.0.0.0/104`).\r\n```\r\n\r\nThe documentation of `Ipv6Addr` is expanded to include a section explaining IPv4-compatible and IPv4-mapped addresses:\r\n- IPv4-compatible addresses are called out as officially deprecated and that only conversion to and from such an address is supported (`to_ipv6_compatible`, `to_ipv4`). It is also noted that no special meaning is ascribed to these addresses, so the embedded IPv4 address will never be taken into account. \r\n- IPv4-mapped addresses are explained and it is noted that the embedded IPv4 addresses may be taken into account, `is_loopback` is given as an example. `is_loopback` is specifically mentioned as currently the only method that takes IPv4-mapped addresses into account, and a small explanation is included that this is in line with other languages and real-world hardware.\r\n\r\nThe documentation of the methods `to_ipv6_compatible`, `to_ipv6_mapped`, `to_ipv4` and `to_ipv4_mapped` is updated to refer to this section.\r\n\r\n(Also included are some small improvements to the <s>style consistency of the documentation</s> (pulled out into #85676) and readability of some examples)\r\n\r\n## Unresolved Questions\r\n\r\n### Stability\r\nThis PR changes the behaviour of the stable `is_loopback` from a simple check for equality to `Ipv6Addr::LOCALHOST` to something more complex, although arguable the change makes the behaviour more in line in what users would expect. To what extent is such a change in behaviour covered by stability guarantees; is just a change in documentation enough or should it be called out in compatibility notes?\r\n\r\n### Making `is_loopback` special\r\nIt is expected that in the future some more methods of `Ipv6Addr` will take IPv4-mapped addresses into account, but this is currently blocked on nailing down the exact semantics (#85609). This PR is written to be largely agnostic to such further changes, `is_loopback` is called out as currently the only method that has this behaviour. However, if eventually the decision is made to not apply this behaviour to other methods, is it worth it to have only `is_loopback` have this special behaviour? Do the arguments in favour of supporting IPv4-mapped addresses pull their weight if only `is_loopback` will ever support it.", "created_at": "2021-05-25T02:50:44Z", "updated_at": "2021-07-22T13:54:27Z", "closed_at": "2021-07-21T19:21:17Z", "merged_at": null, "merge_commit_sha": "9be0d6e6c11bb5bcff9194fa04a0495a5c3d402d", "assignee": {"login": "KodrAus", "id": 6721458, "node_id": "MDQ6VXNlcjY3MjE0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6721458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KodrAus", "html_url": "https://github.com/KodrAus", "followers_url": "https://api.github.com/users/KodrAus/followers", "following_url": "https://api.github.com/users/KodrAus/following{/other_user}", "gists_url": "https://api.github.com/users/KodrAus/gists{/gist_id}", "starred_url": "https://api.github.com/users/KodrAus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KodrAus/subscriptions", "organizations_url": "https://api.github.com/users/KodrAus/orgs", "repos_url": "https://api.github.com/users/KodrAus/repos", "events_url": "https://api.github.com/users/KodrAus/events{/privacy}", "received_events_url": "https://api.github.com/users/KodrAus/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "KodrAus", "id": 6721458, "node_id": "MDQ6VXNlcjY3MjE0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6721458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KodrAus", "html_url": "https://github.com/KodrAus", "followers_url": "https://api.github.com/users/KodrAus/followers", "following_url": "https://api.github.com/users/KodrAus/following{/other_user}", "gists_url": "https://api.github.com/users/KodrAus/gists{/gist_id}", "starred_url": "https://api.github.com/users/KodrAus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KodrAus/subscriptions", "organizations_url": "https://api.github.com/users/KodrAus/orgs", "repos_url": "https://api.github.com/users/KodrAus/repos", "events_url": "https://api.github.com/users/KodrAus/events{/privacy}", "received_events_url": "https://api.github.com/users/KodrAus/received_events", "type": "User", "site_admin": false}], "requested_reviewers": [], "requested_teams": [], "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 223796632, "node_id": "MDU6TGFiZWwyMjM3OTY2MzI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/relnotes", "name": "relnotes", "color": "fad8c7", "default": false, "description": "Marks issues that should be documented in the release notes of the next release."}, {"id": 583426710, "node_id": "MDU6TGFiZWw1ODM0MjY3MTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-review", "name": "S-waiting-on-review", "color": "d3dddd", "default": false, "description": "Status: Awaiting review from the assignee but also interested parties."}, {"id": 2238437210, "node_id": "MDU6TGFiZWwyMjM4NDM3MjEw", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-io", "name": "A-io", "color": "f7e101", "default": false, "description": "Area: std::io, std::fs, std::net and std::path"}], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/rust-lang/rust/pulls/85655/commits", "review_comments_url": "https://api.github.com/repos/rust-lang/rust/pulls/85655/comments", "review_comment_url": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85655/comments", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/3d1c1913c469cc9e6ed709e73d2fe329d1e07919", "head": {"label": "CDirkx:is-loopback", "ref": "is-loopback", "sha": "3d1c1913c469cc9e6ed709e73d2fe329d1e07919", "user": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "repo": {"id": 236357890, "node_id": "MDEwOlJlcG9zaXRvcnkyMzYzNTc4OTA=", "name": "rust", "full_name": "CDirkx/rust", "private": false, "owner": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "html_url": "https://github.com/CDirkx/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": true, "url": "https://api.github.com/repos/CDirkx/rust", "forks_url": "https://api.github.com/repos/CDirkx/rust/forks", "keys_url": "https://api.github.com/repos/CDirkx/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/CDirkx/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/CDirkx/rust/teams", "hooks_url": "https://api.github.com/repos/CDirkx/rust/hooks", "issue_events_url": "https://api.github.com/repos/CDirkx/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/CDirkx/rust/events", "assignees_url": "https://api.github.com/repos/CDirkx/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/CDirkx/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/CDirkx/rust/tags", "blobs_url": "https://api.github.com/repos/CDirkx/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/CDirkx/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/CDirkx/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/CDirkx/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/CDirkx/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/CDirkx/rust/languages", "stargazers_url": "https://api.github.com/repos/CDirkx/rust/stargazers", "contributors_url": "https://api.github.com/repos/CDirkx/rust/contributors", "subscribers_url": "https://api.github.com/repos/CDirkx/rust/subscribers", "subscription_url": "https://api.github.com/repos/CDirkx/rust/subscription", "commits_url": "https://api.github.com/repos/CDirkx/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/CDirkx/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/CDirkx/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/CDirkx/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/CDirkx/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/CDirkx/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/CDirkx/rust/merges", "archive_url": "https://api.github.com/repos/CDirkx/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/CDirkx/rust/downloads", "issues_url": "https://api.github.com/repos/CDirkx/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/CDirkx/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/CDirkx/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/CDirkx/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/CDirkx/rust/labels{/name}", "releases_url": "https://api.github.com/repos/CDirkx/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/CDirkx/rust/deployments", "created_at": "2020-01-26T18:38:55Z", "updated_at": "2022-07-30T15:30:25Z", "pushed_at": "2022-08-01T16:59:22Z", "git_url": "git://github.com/CDirkx/rust.git", "ssh_url": "git@github.com:CDirkx/rust.git", "clone_url": "https://github.com/CDirkx/rust.git", "svn_url": "https://github.com/CDirkx/rust", "homepage": "https://www.rust-lang.org", "size": 924727, "stargazers_count": 0, "watchers_count": 0, "language": "Rust", "has_issues": true, "has_projects": false, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "master"}}, "base": {"label": "rust-lang:master", "ref": "master", "sha": "c8381389ee10e3c0505ccb5bac05382de1b9f99d", "user": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "repo": {"id": 724712, "node_id": "MDEwOlJlcG9zaXRvcnk3MjQ3MTI=", "name": "rust", "full_name": "rust-lang/rust", "private": false, "owner": {"login": "rust-lang", "id": 5430905, "node_id": "MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5430905?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rust-lang", "html_url": "https://github.com/rust-lang", "followers_url": "https://api.github.com/users/rust-lang/followers", "following_url": "https://api.github.com/users/rust-lang/following{/other_user}", "gists_url": "https://api.github.com/users/rust-lang/gists{/gist_id}", "starred_url": "https://api.github.com/users/rust-lang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rust-lang/subscriptions", "organizations_url": "https://api.github.com/users/rust-lang/orgs", "repos_url": "https://api.github.com/users/rust-lang/repos", "events_url": "https://api.github.com/users/rust-lang/events{/privacy}", "received_events_url": "https://api.github.com/users/rust-lang/received_events", "type": "Organization", "site_admin": false}, "html_url": "https://github.com/rust-lang/rust", "description": "Empowering everyone to build reliable and efficient software.", "fork": false, "url": "https://api.github.com/repos/rust-lang/rust", "forks_url": "https://api.github.com/repos/rust-lang/rust/forks", "keys_url": "https://api.github.com/repos/rust-lang/rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/rust-lang/rust/teams", "hooks_url": "https://api.github.com/repos/rust-lang/rust/hooks", "issue_events_url": "https://api.github.com/repos/rust-lang/rust/issues/events{/number}", "events_url": "https://api.github.com/repos/rust-lang/rust/events", "assignees_url": "https://api.github.com/repos/rust-lang/rust/assignees{/user}", "branches_url": "https://api.github.com/repos/rust-lang/rust/branches{/branch}", "tags_url": "https://api.github.com/repos/rust-lang/rust/tags", "blobs_url": "https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/rust-lang/rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/rust-lang/rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/rust-lang/rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/rust-lang/rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/rust-lang/rust/languages", "stargazers_url": "https://api.github.com/repos/rust-lang/rust/stargazers", "contributors_url": "https://api.github.com/repos/rust-lang/rust/contributors", "subscribers_url": "https://api.github.com/repos/rust-lang/rust/subscribers", "subscription_url": "https://api.github.com/repos/rust-lang/rust/subscription", "commits_url": "https://api.github.com/repos/rust-lang/rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/rust-lang/rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/rust-lang/rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/rust-lang/rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/{+path}", "compare_url": "https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/rust-lang/rust/merges", "archive_url": "https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/rust-lang/rust/downloads", "issues_url": "https://api.github.com/repos/rust-lang/rust/issues{/number}", "pulls_url": "https://api.github.com/repos/rust-lang/rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/rust-lang/rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/rust-lang/rust/labels{/name}", "releases_url": "https://api.github.com/repos/rust-lang/rust/releases{/id}", "deployments_url": "https://api.github.com/repos/rust-lang/rust/deployments", "created_at": "2010-06-16T20:39:03Z", "updated_at": "2023-06-19T06:07:21Z", "pushed_at": "2023-06-19T06:15:17Z", "git_url": "git://github.com/rust-lang/rust.git", "ssh_url": "git@github.com:rust-lang/rust.git", "clone_url": "https://github.com/rust-lang/rust.git", "svn_url": "https://github.com/rust-lang/rust", "homepage": "https://www.rust-lang.org", "size": 919635, "stargazers_count": 82734, "watchers_count": 82734, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 10953, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 9628, "license": {"key": "other", "name": "Other", "spdx_id": "NOASSERTION", "url": null, "node_id": "MDc6TGljZW5zZTA="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["compiler", "hacktoberfest", "language", "rust"], "visibility": "public", "forks": 10953, "open_issues": 9628, "watchers": 82734, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/85655"}, "html": {"href": "https://github.com/rust-lang/rust/pull/85655"}, "issue": {"href": "https://api.github.com/repos/rust-lang/rust/issues/85655"}, "comments": {"href": "https://api.github.com/repos/rust-lang/rust/issues/85655/comments"}, "review_comments": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/85655/comments"}, "review_comment": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/rust-lang/rust/pulls/85655/commits"}, "statuses": {"href": "https://api.github.com/repos/rust-lang/rust/statuses/3d1c1913c469cc9e6ed709e73d2fe329d1e07919"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": false, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": null, "comments": 22, "review_comments": 3, "maintainer_can_modify": false, "commits": 3, "additions": 122, "deletions": 27, "changed_files": 1}