{"sha": "ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "node_id": "C_kwDOAAsO6NoAKGFkMTNkOWZiYmU3ZDdhM2JjNWU1OWFkMWY4MjllMTMyZDZjYjFiMGE", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-08T01:15:28Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-11T21:35:42Z"}, "message": "Suggest making private tuple struct field public\n\nFix #52144.", "tree": {"sha": "5e6dc195280dbcc0b1d55285a7d81d0af8a61908", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e6dc195280dbcc0b1d55285a7d81d0af8a61908"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "html_url": "https://github.com/rust-lang/rust/commit/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b22c152958eade17a71d899b29a2d39bcc77aa48", "url": "https://api.github.com/repos/rust-lang/rust/commits/b22c152958eade17a71d899b29a2d39bcc77aa48", "html_url": "https://github.com/rust-lang/rust/commit/b22c152958eade17a71d899b29a2d39bcc77aa48"}], "stats": {"total": 55, "additions": 49, "deletions": 6}, "files": [{"sha": "928f372d948dd38fb126a16c0aa9647478023927", "filename": "compiler/rustc_resolve/src/build_reduced_graph.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -331,7 +331,9 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n             .iter()\n             .map(|field| respan(field.span, field.ident.map_or(kw::Empty, |ident| ident.name)))\n             .collect();\n+        let field_vis = vdata.fields().iter().map(|field| field.vis.span).collect();\n         self.r.field_names.insert(def_id, field_names);\n+        self.r.field_visibility_spans.insert(def_id, field_vis);\n     }\n \n     fn insert_field_names_extern(&mut self, def_id: DefId) {"}, {"sha": "a675a1fb78bbc5ff22299c8fb5660e6106aefa21", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -1451,6 +1451,26 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                         .collect();\n \n                     if non_visible_spans.len() > 0 {\n+                        if let Some(visibility_spans) = self.r.field_visibility_spans.get(&def_id) {\n+                            err.multipart_suggestion_verbose(\n+                                &format!(\n+                                    \"consider making the field{} publicly accessible\",\n+                                    pluralize!(visibility_spans.len())\n+                                ),\n+                                visibility_spans\n+                                    .iter()\n+                                    .map(|span| {\n+                                        (\n+                                            *span,\n+                                            if span.lo() == span.hi() { \"pub \" } else { \"pub\" }\n+                                                .to_string(),\n+                                        )\n+                                    })\n+                                    .collect(),\n+                                Applicability::MaybeIncorrect,\n+                            );\n+                        }\n+\n                         let mut m: MultiSpan = non_visible_spans.clone().into();\n                         non_visible_spans\n                             .into_iter()"}, {"sha": "84d9794ccf26671471aab168841bca043c1acdff", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -881,6 +881,10 @@ pub struct Resolver<'a> {\n     /// Used for hints during error reporting.\n     field_names: FxHashMap<DefId, Vec<Spanned<Symbol>>>,\n \n+    /// Span of the privacy modifier in fields of an item `DefId` accessible with dot syntax.\n+    /// Used for hints during error reporting.\n+    field_visibility_spans: FxHashMap<DefId, Vec<Span>>,\n+\n     /// All imports known to succeed or fail.\n     determined_imports: Vec<&'a Import<'a>>,\n \n@@ -1268,6 +1272,7 @@ impl<'a> Resolver<'a> {\n \n             has_self: FxHashSet::default(),\n             field_names: FxHashMap::default(),\n+            field_visibility_spans: FxHashMap::default(),\n \n             determined_imports: Vec::new(),\n             indeterminate_imports: Vec::new(),"}, {"sha": "600dc7c876ff3f22709b2db583f0e9c538d7c1a9", "filename": "tests/ui/privacy/issue-75906.stderr", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75906.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75906.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fprivacy%2Fissue-75906.stderr?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -9,6 +9,10 @@ note: constructor is not visible here due to private fields\n    |\n LL |     pub struct Bar(u8);\n    |                    ^^ private field\n+help: consider making the field publicly accessible\n+   |\n+LL |     pub struct Bar(pub u8);\n+   |                    +++\n \n error: aborting due to previous error\n "}, {"sha": "3bed841d13ea29ec632522fda6830ea886e49c3c", "filename": "tests/ui/privacy/issue-75907.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75907.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75907.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fprivacy%2Fissue-75907.rs?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -2,7 +2,7 @@\n \n mod foo {\n     pub(crate) struct Foo(u8);\n-    pub(crate) struct Bar(pub u8, u8, Foo);\n+    pub(crate) struct Bar(pub u8, pub(in crate::foo) u8, Foo);\n \n     pub(crate) fn make_bar() -> Bar {\n         Bar(1, 12, Foo(10))"}, {"sha": "f7cb874c2cc0d5e05995d4d45d274e167ca10d37", "filename": "tests/ui/privacy/issue-75907.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75907.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fprivacy%2Fissue-75907.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fprivacy%2Fissue-75907.stderr?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -11,6 +11,10 @@ LL |     let Bar(x, y, Foo(z)) = make_bar();\n    |                ^  ^^^^^^ private field\n    |                |\n    |                private field\n+help: consider making the fields publicly accessible\n+   |\n+LL |     pub(crate) struct Bar(pub u8, pub u8, pub Foo);\n+   |                           ~~~     ~~~     +++\n \n error[E0532]: cannot match against a tuple struct which contains private fields\n   --> $DIR/issue-75907.rs:15:19\n@@ -23,6 +27,10 @@ note: constructor is not visible here due to private fields\n    |\n LL |     let Bar(x, y, Foo(z)) = make_bar();\n    |                       ^ private field\n+help: consider making the field publicly accessible\n+   |\n+LL |     pub(crate) struct Foo(pub u8);\n+   |                           +++\n \n error: aborting due to 2 previous errors\n "}, {"sha": "7e439c10b7b8408c08d8a2055a5748757cd50135", "filename": "tests/ui/resolve/issue-42944.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fresolve%2Fissue-42944.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fresolve%2Fissue-42944.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-42944.rs?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -1,5 +1,5 @@\n mod foo {\n-    pub struct Bx(());\n+    pub struct Bx(pub(in crate::foo) ());\n }\n \n mod bar {"}, {"sha": "4ffa9402c667e8892d26b906ca16d3c9185a0a54", "filename": "tests/ui/resolve/issue-42944.stderr", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fresolve%2Fissue-42944.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a/tests%2Fui%2Fresolve%2Fissue-42944.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-42944.stderr?ref=ad13d9fbbe7d7a3bc5e59ad1f829e132d6cb1b0a", "patch": "@@ -7,8 +7,8 @@ LL |         Bx(());\n note: tuple struct `foo::Bx` exists but is inaccessible\n   --> $DIR/issue-42944.rs:2:5\n    |\n-LL |     pub struct Bx(());\n-   |     ^^^^^^^^^^^^^^^^^^ not accessible\n+LL |     pub struct Bx(pub(in crate::foo) ());\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not accessible\n \n error[E0423]: cannot initialize a tuple struct which contains private fields\n   --> $DIR/issue-42944.rs:9:9\n@@ -19,8 +19,12 @@ LL |         Bx(());\n note: constructor is not visible here due to private fields\n   --> $DIR/issue-42944.rs:2:19\n    |\n-LL |     pub struct Bx(());\n-   |                   ^^ private field\n+LL |     pub struct Bx(pub(in crate::foo) ());\n+   |                   ^^^^^^^^^^^^^^^^^^^^^ private field\n+help: consider making the field publicly accessible\n+   |\n+LL |     pub struct Bx(pub ());\n+   |                   ~~~\n \n error: aborting due to 2 previous errors\n "}]}