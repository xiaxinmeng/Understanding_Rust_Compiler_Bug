{"sha": "816cf56b8969e239216cfe8968b1b6931d334574", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxNmNmNTZiODk2OWUyMzkyMTZjZmU4OTY4YjFiNjkzMWQzMzQ1NzQ=", "commit": {"author": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2016-08-28T15:04:54Z"}, "committer": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2016-08-28T15:04:54Z"}, "message": "Tweak HTML version of docs with scroll to lints\n\nUses good old DOM events and wibbly-wobbly timeouts to wait for angular\nto render this huge list of lints.\n\nFixes #1181", "tree": {"sha": "ef8dbe948900399c81cdd90f64897f36e02e88a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef8dbe948900399c81cdd90f64897f36e02e88a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/816cf56b8969e239216cfe8968b1b6931d334574", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/816cf56b8969e239216cfe8968b1b6931d334574", "html_url": "https://github.com/rust-lang/rust/commit/816cf56b8969e239216cfe8968b1b6931d334574", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/816cf56b8969e239216cfe8968b1b6931d334574/comments", "author": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "committer": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2aaa2a51c39df9a985b1a9a77306b147e0505d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2aaa2a51c39df9a985b1a9a77306b147e0505d4", "html_url": "https://github.com/rust-lang/rust/commit/b2aaa2a51c39df9a985b1a9a77306b147e0505d4"}], "stats": {"total": 38, "additions": 33, "deletions": 5}, "files": [{"sha": "c60d1f3df3853b89834b6d063d3c9a4aa03bc3a7", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 33, "deletions": 5, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/816cf56b8969e239216cfe8968b1b6931d334574/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/816cf56b8969e239216cfe8968b1b6931d334574/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=816cf56b8969e239216cfe8968b1b6931d334574", "patch": "@@ -77,11 +77,11 @@ <h2 class=\"panel-title\">\n                         <span ng-if=\"lint.level == 'Deny'\" class=\"label label-danger\">Deny</span>\n                         <span ng-if=\"lint.level == 'Deprecated'\" class=\"label label-default\">Deprecated</span>\n \n-                        <a href=\"#{{lint.id}}\" class=\"anchor label label-default\">&para;</a>\n+                        <a href=\"#{{lint.id}}\" class=\"anchor label label-default\" ng-click=\"open[lint.id] = true; $event.stopPropagation()\">&para;</a>\n                     </h2>\n                 </header>\n \n-                <ul class=\"list-group\" ng-if=\"lint.docs\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n+                <ul class=\"list-group lint-docs\" ng-if=\"lint.docs\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n                     <li class=\"list-group-item\" ng-repeat=\"(title, text) in lint.docs\">\n                         <h4 class=\"list-group-item-heading\">\n                             {{title}}\n@@ -120,6 +120,12 @@ <h4 class=\"list-group-item-heading\">\n             }\n         });\n \n+        function scrollToLint(lintId) {\n+            var target = document.getElementById(lintId);\n+            if (!target) { return; }\n+            document.body.scrollTop = target.offsetTop;\n+        }\n+\n         angular.module(\"clippy\", [])\n         .filter('markdown', function ($sce) {\n             return function (text) {\n@@ -130,9 +136,10 @@ <h4 class=\"list-group-item-heading\">\n                 );\n             };\n         })\n-        .controller(\"lintList\", function ($scope, $http) {\n+        .controller(\"lintList\", function ($scope, $http, $timeout) {\n             // Level filter\n-            $scope.levels = {Allow: true, Warn: true, Deny: true, Deprecated: true};\n+            var LEVEL_FILTERS_DEFAULT = {Allow: true, Warn: true, Deny: true, Deprecated: true};\n+            $scope.levels = LEVEL_FILTERS_DEFAULT;\n             $scope.byLevels = function (lint) {\n                 return $scope.levels[lint.level];\n             };\n@@ -141,16 +148,37 @@ <h4 class=\"list-group-item-heading\">\n             $scope.open = {};\n             $scope.loading = true;\n \n+            if (window.location.hash.length > 1) {\n+                $scope.open[window.location.hash.slice(1)] = true;\n+            }\n+\n             $http.get('./lints.json')\n             .success(function (data) {\n                 $scope.data = data;\n                 $scope.loading = false;\n+\n+                $timeout(function () {\n+                    scrollToLint(window.location.hash.slice(1));\n+                }, 100);\n             })\n             .error(function (data) {\n                 $scope.error = data;\n                 $scope.loading = false;\n             });\n-        })\n+\n+            window.addEventListener('hashchange', function () {\n+                // trigger re-render\n+                $timeout(function () {\n+                    $scope.search = \"\";\n+                    $scope.levels = LEVEL_FILTERS_DEFAULT;\n+                    // quick n dirty: wait for re-render to finish\n+                    $timeout(function () {\n+                        scrollToLint(window.location.hash.slice(1));\n+                    }, 100);\n+                });\n+                return true;\n+            }, false);\n+        });\n     })();\n     </script>\n </body>"}]}