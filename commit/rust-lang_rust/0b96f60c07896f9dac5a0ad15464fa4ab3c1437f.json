{"sha": "0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiOTZmNjBjMDc4OTZmOWRhYzVhMGFkMTU0NjRmYTRhYjNjMTQzN2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-08T07:56:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-08T07:56:04Z"}, "message": "Auto merge of #79245 - ssomers:btree_curb_ord_bound, r=dtolnay\n\nBTree: remove Ord bound where it is absent elsewhere\n\nSome btree methods don't really need an Ord bound and don't have one, while some methods that more obviously don't need it, do have one.\n\nAn example of the former is `iter`, even though it explicitly exposes the work of the Ord implementation ([\"sorted by key\"](https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.iter) - but I'm not suggesting it should have the Ord bound). An example of the latter is `new`, which doesn't involve any keys whatsoever.", "tree": {"sha": "a810a3c8b6015c41d77cc466feadec015204a33c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a810a3c8b6015c41d77cc466feadec015204a33c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "html_url": "https://github.com/rust-lang/rust/commit/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4940dd483a8448c0f1ef28d304fad88a9d983c4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4940dd483a8448c0f1ef28d304fad88a9d983c4e", "html_url": "https://github.com/rust-lang/rust/commit/4940dd483a8448c0f1ef28d304fad88a9d983c4e"}, {"sha": "9066c736a23c24f23fb46846e80a33c02bf4ab82", "url": "https://api.github.com/repos/rust-lang/rust/commits/9066c736a23c24f23fb46846e80a33c02bf4ab82", "html_url": "https://github.com/rust-lang/rust/commit/9066c736a23c24f23fb46846e80a33c02bf4ab82"}], "stats": {"total": 42, "additions": 22, "deletions": 20}, "files": [{"sha": "c26388a1db1f0c82d84f37f1dd6850f99873a460", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "patch": "@@ -500,11 +500,8 @@ impl<K, V> BTreeMap<K, V> {\n     /// assert!(a.is_empty());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    pub fn clear(&mut self)\n-    where\n-        K: Ord,\n-    {\n-        *self = BTreeMap::new();\n+    pub fn clear(&mut self) {\n+        *self = BTreeMap { root: None, length: 0 };\n     }\n \n     /// Returns a reference to the value corresponding to the key.\n@@ -1227,10 +1224,7 @@ impl<K, V> BTreeMap<K, V> {\n     /// ```\n     #[inline]\n     #[unstable(feature = \"map_into_keys_values\", issue = \"75294\")]\n-    pub fn into_keys(self) -> IntoKeys<K, V>\n-    where\n-        K: Ord,\n-    {\n+    pub fn into_keys(self) -> IntoKeys<K, V> {\n         IntoKeys { inner: self.into_iter() }\n     }\n \n@@ -1253,10 +1247,7 @@ impl<K, V> BTreeMap<K, V> {\n     /// ```\n     #[inline]\n     #[unstable(feature = \"map_into_keys_values\", issue = \"75294\")]\n-    pub fn into_values(self) -> IntoValues<K, V>\n-    where\n-        K: Ord,\n-    {\n+    pub fn into_values(self) -> IntoValues<K, V> {\n         IntoValues { inner: self.into_iter() }\n     }\n }"}, {"sha": "1993c6e047d48775ae20811f9b9a10c7fc121ecc", "filename": "library/alloc/src/collections/btree/map/tests.rs", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs?ref=0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "patch": "@@ -1711,12 +1711,19 @@ fn test_ord_absence() {\n     fn map<K>(mut map: BTreeMap<K, ()>) {\n         map.is_empty();\n         map.len();\n+        map.clear();\n         map.iter();\n         map.iter_mut();\n         map.keys();\n         map.values();\n         map.values_mut();\n-        map.into_iter();\n+        if true {\n+            map.into_values();\n+        } else if true {\n+            map.into_iter();\n+        } else {\n+            map.into_keys();\n+        }\n     }\n \n     fn map_debug<K: Debug>(mut map: BTreeMap<K, ()>) {\n@@ -1726,7 +1733,13 @@ fn test_ord_absence() {\n         format!(\"{:?}\", map.keys());\n         format!(\"{:?}\", map.values());\n         format!(\"{:?}\", map.values_mut());\n-        format!(\"{:?}\", map.into_iter());\n+        if true {\n+            format!(\"{:?}\", map.into_iter());\n+        } else if true {\n+            format!(\"{:?}\", map.into_keys());\n+        } else {\n+            format!(\"{:?}\", map.into_values());\n+        }\n     }\n \n     fn map_clone<K: Clone>(mut map: BTreeMap<K, ()>) {"}, {"sha": "c619b5bf8edd10210a774271edc32766aa8f411a", "filename": "library/alloc/src/collections/btree/set.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs?ref=0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "patch": "@@ -457,10 +457,7 @@ impl<T> BTreeSet<T> {\n     /// assert!(v.is_empty());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    pub fn clear(&mut self)\n-    where\n-        T: Ord,\n-    {\n+    pub fn clear(&mut self) {\n         self.map.clear()\n     }\n "}, {"sha": "3762af7236af223122019bacb92b980061a82486", "filename": "library/alloc/src/collections/btree/set/tests.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b96f60c07896f9dac5a0ad15464fa4ab3c1437f/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs?ref=0b96f60c07896f9dac5a0ad15464fa4ab3c1437f", "patch": "@@ -641,9 +641,10 @@ fn test_send() {\n \n #[allow(dead_code)]\n fn test_ord_absence() {\n-    fn set<K>(set: BTreeSet<K>) {\n+    fn set<K>(mut set: BTreeSet<K>) {\n         set.is_empty();\n         set.len();\n+        set.clear();\n         set.iter();\n         set.into_iter();\n     }"}]}