{"sha": "3ae2174fc5bfef0b2220a44d5e371220f3dca532", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhZTIxNzRmYzViZmVmMGIyMjIwYTQ0ZDVlMzcxMjIwZjNkY2E1MzI=", "commit": {"author": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2016-12-16T07:46:21Z"}, "committer": {"name": "Vadim Chugunov", "email": "vadimcn@gmail.com", "date": "2017-01-19T21:53:33Z"}, "message": "Feature gate", "tree": {"sha": "4f663d5d2fc3882750b50abbd303b06b5173e6a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f663d5d2fc3882750b50abbd303b06b5173e6a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ae2174fc5bfef0b2220a44d5e371220f3dca532", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ae2174fc5bfef0b2220a44d5e371220f3dca532", "html_url": "https://github.com/rust-lang/rust/commit/3ae2174fc5bfef0b2220a44d5e371220f3dca532", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ae2174fc5bfef0b2220a44d5e371220f3dca532/comments", "author": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vadimcn", "id": 3203809, "node_id": "MDQ6VXNlcjMyMDM4MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3203809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadimcn", "html_url": "https://github.com/vadimcn", "followers_url": "https://api.github.com/users/vadimcn/followers", "following_url": "https://api.github.com/users/vadimcn/following{/other_user}", "gists_url": "https://api.github.com/users/vadimcn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadimcn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadimcn/subscriptions", "organizations_url": "https://api.github.com/users/vadimcn/orgs", "repos_url": "https://api.github.com/users/vadimcn/repos", "events_url": "https://api.github.com/users/vadimcn/events{/privacy}", "received_events_url": "https://api.github.com/users/vadimcn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "91f8144906137335c3683b99d9c5c4ccaaebcde6", "url": "https://api.github.com/repos/rust-lang/rust/commits/91f8144906137335c3683b99d9c5c4ccaaebcde6", "html_url": "https://github.com/rust-lang/rust/commit/91f8144906137335c3683b99d9c5c4ccaaebcde6"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "550f6eb12a7bd9663fde5c6ae4c833042ff39700", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=3ae2174fc5bfef0b2220a44d5e371220f3dca532", "patch": "@@ -1480,6 +1480,10 @@ pub fn build_session_options_and_crate_config(matches: &getopts::Matches)\n                                                  s));\n             }\n         };\n+        if kind == cstore::NativeStaticNobundle && !nightly_options::is_nightly_build() {\n+            early_error(error_format, &format!(\"the library kind 'static-nobundle' is only \\\n+                                                accepted on the nightly compiler\"));\n+        }\n         let mut name_parts = name.splitn(2, ':');\n         let name = name_parts.next().unwrap();\n         let new_name = name_parts.next();"}, {"sha": "87ba2edbfda7dede56b0947d1862b457dd70e230", "filename": "src/librustc_metadata/creader.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibrustc_metadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibrustc_metadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcreader.rs?ref=3ae2174fc5bfef0b2220a44d5e371220f3dca532", "patch": "@@ -111,6 +111,13 @@ fn register_native_lib(sess: &Session,\n                                        GateIssue::Language,\n                                        \"is feature gated\");\n     }\n+    if lib.kind == cstore::NativeStaticNobundle && !sess.features.borrow().static_nobundle {\n+        feature_gate::emit_feature_err(&sess.parse_sess,\n+                                       \"static_nobundle\",\n+                                       span.unwrap(),\n+                                       GateIssue::Language,\n+                                       \"kind=\\\"static-nobundle\\\" is feature gated\");\n+    }\n     cstore.add_used_library(lib);\n }\n "}, {"sha": "cf2905e913108e1060b99ee0416b5ff12e73f57e", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=3ae2174fc5bfef0b2220a44d5e371220f3dca532", "patch": "@@ -322,6 +322,9 @@ declare_features! (\n     // Allows attributes on struct literal fields.\n     (active, struct_field_attributes, \"1.16.0\", Some(38814)),\n \n+    // Allows #[link(kind=\"static-nobundle\"...]\n+    (active, static_nobundle, \"1.16.0\", Some(37403)),\n+\n     // `extern \"msp430-interrupt\" fn()`\n     (active, abi_msp430_interrupt, \"1.16.0\", Some(38487)),\n );"}, {"sha": "bc0025c7c958118ca2ebcb3c63506a52855cd2e9", "filename": "src/test/compile-fail/feature-gate-static-nobundle.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Ftest%2Fcompile-fail%2Ffeature-gate-static-nobundle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Ftest%2Fcompile-fail%2Ffeature-gate-static-nobundle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-static-nobundle.rs?ref=3ae2174fc5bfef0b2220a44d5e371220f3dca532", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[link(name=\"foo\", kind=\"static-nobundle\")]\n+//~^ ERROR: kind=\"static-nobundle\" is feature gated\n+extern {}"}, {"sha": "c5d6237c9d59466f25e4317b6be8b73f24143fa0", "filename": "src/test/run-make/static-nobundle/bar.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Ftest%2Frun-make%2Fstatic-nobundle%2Fbar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ae2174fc5bfef0b2220a44d5e371220f3dca532/src%2Ftest%2Frun-make%2Fstatic-nobundle%2Fbar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fstatic-nobundle%2Fbar.rs?ref=3ae2174fc5bfef0b2220a44d5e371220f3dca532", "patch": "@@ -9,6 +9,7 @@\n // except according to those terms.\n \n #![crate_type = \"rlib\"]\n+#![feature(static_nobundle)]\n \n #[link(name = \"foo\", kind = \"static-nobundle\")]\n extern {"}]}