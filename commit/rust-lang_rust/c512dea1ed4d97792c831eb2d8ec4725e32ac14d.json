{"sha": "c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1MTJkZWExZWQ0ZDk3NzkyYzgzMWViMmQ4ZWM0NzI1ZTMyYWMxNGQ=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-07-07T14:09:46Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-07-10T10:27:59Z"}, "message": "Fix feature gate for `#[link_args(..)]` attribute so that it will fire\nregardless of context of attribute.\n\nExtend the gating test to include the attribute in \"weird\" places.", "tree": {"sha": "5fecffc4b0f012481f36dfc7164825b829225cb5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5fecffc4b0f012481f36dfc7164825b829225cb5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "html_url": "https://github.com/rust-lang/rust/commit/c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c512dea1ed4d97792c831eb2d8ec4725e32ac14d/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33e353ea51e0b266435143cd88458b59d9051d2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/33e353ea51e0b266435143cd88458b59d9051d2a", "html_url": "https://github.com/rust-lang/rust/commit/33e353ea51e0b266435143cd88458b59d9051d2a"}], "stats": {"total": 31, "additions": 20, "deletions": 11}, "files": [{"sha": "9448d8a20a37629c5469e49ea3b214b12cce869a", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c512dea1ed4d97792c831eb2d8ec4725e32ac14d/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c512dea1ed4d97792c831eb2d8ec4725e32ac14d/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "patch": "@@ -552,7 +552,12 @@ pub const BUILTIN_ATTRIBUTES: &'static [(&'static str, AttributeType, AttributeG\n     (\"ignore\", Normal, Ungated),\n     (\"no_implicit_prelude\", Normal, Ungated),\n     (\"reexport_test_harness_main\", Normal, Ungated),\n-    (\"link_args\", Normal, Ungated),\n+    (\"link_args\", Normal, Gated(Stability::Unstable,\n+                                \"link_args\",\n+                                \"the `link_args` attribute is experimental and not \\\n+                                 portable across platforms, it is recommended to \\\n+                                 use `#[link(name = \\\"foo\\\")] instead\",\n+                                cfg_fn!(link_args))),\n     (\"macro_escape\", Normal, Ungated),\n \n     // RFC #1445.\n@@ -1185,12 +1190,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n             }\n \n             ast::ItemKind::ForeignMod(ref foreign_module) => {\n-                if attr::contains_name(&i.attrs[..], \"link_args\") {\n-                    gate_feature_post!(&self, link_args, i.span,\n-                                      \"the `link_args` attribute is not portable \\\n-                                       across platforms, it is recommended to \\\n-                                       use `#[link(name = \\\"foo\\\")]` instead\")\n-                }\n                 self.check_abi(foreign_module.abi, i.span);\n             }\n "}, {"sha": "82f5db3042b77caef7416669c91d5c24c6ece1c5", "filename": "src/test/compile-fail/gated-link-args.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c512dea1ed4d97792c831eb2d8ec4725e32ac14d/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c512dea1ed4d97792c831eb2d8ec4725e32ac14d/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs?ref=c512dea1ed4d97792c831eb2d8ec4725e32ac14d", "patch": "@@ -9,12 +9,22 @@\n // except according to those terms.\n \n // Test that `#[link_args]` attribute is gated by `link_args`\n-// feature gate.\n+// feature gate, both when it occurs where expected (atop\n+// `extern { }` blocks) and where unexpected.\n \n // gate-test-link_args\n \n-#[link_args = \"aFdEfSeVEEE\"]\n+// sidestep warning (which is correct, but misleading for\n+// purposes of this test)\n+#![allow(unused_attributes)]\n+\n+#![link_args = \"-l unexpected_use_as_inner_attr_on_mod\"]\n+//~^ ERROR the `link_args` attribute is experimental\n+\n+#[link_args = \"-l expected_use_case\"]\n+//~^ ERROR the `link_args` attribute is experimental\n extern {}\n-//~^ ERROR the `link_args` attribute is not portable across platforms\n \n-fn main() { }\n+#[link_args = \"-l unexected_use_on_non_extern_item\"]\n+//~^ ERROR: the `link_args` attribute is experimental\n+fn main() {}"}]}