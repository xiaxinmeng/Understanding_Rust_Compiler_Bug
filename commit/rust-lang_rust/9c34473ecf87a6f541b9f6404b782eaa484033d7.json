{"sha": "9c34473ecf87a6f541b9f6404b782eaa484033d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljMzQ0NzNlY2Y4N2E2ZjU0MWI5ZjY0MDRiNzgyZWFhNDg0MDMzZDc=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-05-25T21:29:18Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-05-28T19:26:51Z"}, "message": "Special-case `.llvm` in mangler to fix segfaults\n\nThis commit special cases `.llvm` in the mangler to print `.llvm$6d$`\ninstead. This will avoid segfaults when names in a user's Rust code are\n`llvm`.", "tree": {"sha": "5e429e71901a4a4640008c240d9e2123331074ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e429e71901a4a4640008c240d9e2123331074ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c34473ecf87a6f541b9f6404b782eaa484033d7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlzti3sACgkQAXYLT59T\n8VSjYA//V+5HkKMqyKu1pLO+xUykBOaHK1YMO3o7MQkcP25FTYd9C4a6rvb67nDL\nJ0st84fb41X6fNxc+NzZUBHZgoOp9oZNYteGAZj3a5S+GXa+xMdI+JV/pnYqFpsI\nwkhq03vW6zlK09Kg0ykR1OnzQFEviJjyJtNdmhoGEMWAvbWR+earfzVSojasVnRf\n6/XarzP5T/n3eSMqcNe/y0tFXTvJz6ZHov5UbIigjPIddih6M474/7YMM/geJZwq\nzJ1zgbtpkV9b0Z6pCh3ZCo4MDKFkKfnVI1zD/WN7f+vLGEN5PuwDFO/lljZ2URyN\nBsXULuUPd0pBIZNkKnMxGCn3E4Faa1ueNVR+8abnJXQfnS6Bwe6bgX1H41LWO2gO\njDMXDQ1xu9MxOtWME3E0PRPXc17n0xkU5Oi68I5G0ngDHNNOlf34UNYPZpn2yvaL\n22njw9OCag2EGK1LJAlq4YsakQMWCbJN/0yV9W7lIMqmyj82zb4u7Kng0CjPWD2a\napJjgfgy2rIc+7VDWGu0I4LuQoYHvyhVqCIBhVLBvZ2xffdBGk5vVAl+WGJwjmeU\njRSfI4rQ4usr9dQ131dqKVeWUhdBXBQopxLiRJoQ5PlHtBBdujAye6xc19gPFBmU\nc7SYQM4DAOlFOiHsEfen7YHzMEdUbMPfh5waXsCcNZwwo5iYPzc=\n=hpZr\n-----END PGP SIGNATURE-----", "payload": "tree 5e429e71901a4a4640008c240d9e2123331074ba\nparent 02f5786a324c40b2d8b2d0df98456e48fb45d30c\nauthor David Wood <david@davidtw.co> 1558819758 +0100\ncommitter David Wood <david@davidtw.co> 1559071611 +0100\n\nSpecial-case `.llvm` in mangler to fix segfaults\n\nThis commit special cases `.llvm` in the mangler to print `.llvm$6d$`\ninstead. This will avoid segfaults when names in a user's Rust code are\n`llvm`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c34473ecf87a6f541b9f6404b782eaa484033d7", "html_url": "https://github.com/rust-lang/rust/commit/9c34473ecf87a6f541b9f6404b782eaa484033d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c34473ecf87a6f541b9f6404b782eaa484033d7/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02f5786a324c40b2d8b2d0df98456e48fb45d30c", "url": "https://api.github.com/repos/rust-lang/rust/commits/02f5786a324c40b2d8b2d0df98456e48fb45d30c", "html_url": "https://github.com/rust-lang/rust/commit/02f5786a324c40b2d8b2d0df98456e48fb45d30c"}], "stats": {"total": 87, "additions": 87, "deletions": 0}, "files": [{"sha": "5a342114fe834d35261c2c98db33698f66b4e90c", "filename": "src/librustc_codegen_utils/symbol_names.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs?ref=9c34473ecf87a6f541b9f6404b782eaa484033d7", "patch": "@@ -613,6 +613,9 @@ impl fmt::Write for SymbolPrinter<'_, '_> {\n                 // for ':' and '-'\n                 '-' | ':' => self.path.temp_buf.push('.'),\n \n+                // Avoid segmentation fault on some platforms, see #60925.\n+                'm' if self.path.temp_buf.ends_with(\".llv\") => self.path.temp_buf.push_str(\"$6d$\"),\n+\n                 // These are legal symbols\n                 'a'..='z' | 'A'..='Z' | '0'..='9' | '_' | '.' | '$' => self.path.temp_buf.push(c),\n "}, {"sha": "d2347c3077cf33a11bc191c161fdea8b4acbc939", "filename": "src/test/ui/issue-53912.rs", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fissue-53912.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fissue-53912.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-53912.rs?ref=9c34473ecf87a6f541b9f6404b782eaa484033d7", "patch": "@@ -0,0 +1,37 @@\n+// compile-pass\n+\n+// This test is the same code as in ui/symbol-names/issue-60925.rs but this checks that the\n+// reproduction compiles successfully and doesn't segfault, whereas that test just checks that the\n+// symbol mangling fix produces the correct result.\n+\n+fn dummy() {}\n+\n+mod llvm {\n+    pub(crate) struct Foo;\n+}\n+mod foo {\n+    pub(crate) struct Foo<T>(T);\n+\n+    impl Foo<::llvm::Foo> {\n+        pub(crate) fn foo() {\n+            for _ in 0..0 {\n+                for _ in &[::dummy()] {\n+                    ::dummy();\n+                    ::dummy();\n+                    ::dummy();\n+                }\n+            }\n+        }\n+    }\n+\n+    pub(crate) fn foo() {\n+        Foo::foo();\n+        Foo::foo();\n+    }\n+}\n+\n+pub fn foo() {\n+    foo::foo();\n+}\n+\n+fn main() {}"}, {"sha": "e9f763ad7cf67ca425d8c2911e5c7e5e803fa4b4", "filename": "src/test/ui/symbol-names/issue-60925.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs?ref=9c34473ecf87a6f541b9f6404b782eaa484033d7", "patch": "@@ -0,0 +1,39 @@\n+#![feature(rustc_attrs)]\n+\n+// This test is the same code as in ui/issue-53912.rs but this test checks that the symbol mangling\n+// fix produces the correct result, whereas that test just checks that the reproduction compiles\n+// successfully and doesn't segfault\n+\n+fn dummy() {}\n+\n+mod llvm {\n+    pub(crate) struct Foo;\n+}\n+mod foo {\n+    pub(crate) struct Foo<T>(T);\n+\n+    impl Foo<::llvm::Foo> {\n+        #[rustc_symbol_name]\n+//~^ ERROR _ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo17h059a991a004536adE\n+        pub(crate) fn foo() {\n+            for _ in 0..0 {\n+                for _ in &[::dummy()] {\n+                    ::dummy();\n+                    ::dummy();\n+                    ::dummy();\n+                }\n+            }\n+        }\n+    }\n+\n+    pub(crate) fn foo() {\n+        Foo::foo();\n+        Foo::foo();\n+    }\n+}\n+\n+pub fn foo() {\n+    foo::foo();\n+}\n+\n+fn main() {}"}, {"sha": "84a18745e2ea7cce95fb722ed783603012bfb70d", "filename": "src/test/ui/symbol-names/issue-60925.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c34473ecf87a6f541b9f6404b782eaa484033d7/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr?ref=9c34473ecf87a6f541b9f6404b782eaa484033d7", "patch": "@@ -0,0 +1,8 @@\n+error: symbol-name(_ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo17h059a991a004536adE)\n+  --> $DIR/issue-60925.rs:16:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}