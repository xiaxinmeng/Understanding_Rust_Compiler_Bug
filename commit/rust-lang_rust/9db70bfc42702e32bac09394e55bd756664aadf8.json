{"sha": "9db70bfc42702e32bac09394e55bd756664aadf8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkYjcwYmZjNDI3MDJlMzJiYWMwOTM5NGU1NWJkNzU2NjY0YWFkZjg=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-18T07:19:45Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-18T07:19:45Z"}, "message": "Add test code that exercises LLVM in rustc. Works.", "tree": {"sha": "b9b3ba8c7ee5fdd9b3260139804d494153cd4f9e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9b3ba8c7ee5fdd9b3260139804d494153cd4f9e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9db70bfc42702e32bac09394e55bd756664aadf8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9db70bfc42702e32bac09394e55bd756664aadf8", "html_url": "https://github.com/rust-lang/rust/commit/9db70bfc42702e32bac09394e55bd756664aadf8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9db70bfc42702e32bac09394e55bd756664aadf8/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f2c39b3d8de09ca4b58a22b5f59115191262fd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f2c39b3d8de09ca4b58a22b5f59115191262fd7", "html_url": "https://github.com/rust-lang/rust/commit/3f2c39b3d8de09ca4b58a22b5f59115191262fd7"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "4b842bd02014746f48949d447dea89ea3d2a2fcc", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9db70bfc42702e32bac09394e55bd756664aadf8/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db70bfc42702e32bac09394e55bd756664aadf8/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=9db70bfc42702e32bac09394e55bd756664aadf8", "patch": "@@ -1,5 +1,20 @@\n // -*- rust -*-\n \n+import std._str;\n+import lib.llvm.llvm;\n+import lib.llvm.builder;\n+\n+fn write_module() {\n+    auto llmod =\n+        llvm.LLVMModuleCreateWithNameInContext(_str.buf(\"rust_out\"),\n+                                               llvm.LLVMGetGlobalContext());\n+\n+    auto b = builder(llvm.LLVMCreateBuilder());\n+\n+    llvm.LLVMWriteBitcodeToFile(llmod, _str.buf(\"rust_out.bc\"));\n+    llvm.LLVMDisposeModule(llmod);\n+}\n+\n fn main(vec[str] args) -> () {\n \n   log \"This is the rust 'self-hosted' compiler.\";\n@@ -19,6 +34,8 @@ fn main(vec[str] args) -> () {\n     i += 1;\n   }\n \n+  // Test LLVM module-writing. Nothing interesting yet.\n+  write_module();\n \n }\n "}]}