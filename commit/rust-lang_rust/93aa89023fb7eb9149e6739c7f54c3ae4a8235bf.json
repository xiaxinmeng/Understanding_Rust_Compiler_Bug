{"sha": "93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzYWE4OTAyM2ZiN2ViOTE0OWU2NzM5YzdmNTRjM2FlNGE4MjM1YmY=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-07-18T15:36:07Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-07-18T15:36:54Z"}, "message": "Extend HIR-based WF checking to associated type defaults\n\nPreviously, we would only look at associated types in `impl` blocks.", "tree": {"sha": "c0a2a1586167681cbc68edb5cc7be9f1f983f271", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0a2a1586167681cbc68edb5cc7be9f1f983f271"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAmD0SpYACgkQtAh+UQ6Y\nsWTtCg/9FPin3OE0PS/x1hpxPeIGR/z35gIS+00nF1DJBTN5DghpkIiBeN52U6C3\n7V7BWPwa3wdi8X19j5p4vEry1PAs2i0BBzC5qhIDC71uMG6Mb9lDaGwTjR3nfexN\nrNaMujxIH63FMpgbbRhttzFXrKW102dgsgwUuOyAH6EDeK4s4XE9LUJmuz5aoQKQ\nQ3pz092U+v2t3rmCTWJuo18ucu8/sACUy3OU2n7bbtMFGlm60bNIY1Wrdxo5nDKI\nPg1c5jDbRlmdTFFLAToSdE9pQBaKPJBIMMe3+8moVdXhtnN+hC2pXxGsJEaebiIK\nkOajW/zVwIyXvFZnqtf5i+Tyt8DwqYziUX+vTHo0uJXCSkaqjVMJaTRt3HyPJQcH\nfmVldykCqN3YnoQ3nIiBbyp70LzxGVwbx15eDq9RUVe+PwnJ5lwV9gIMo0c47kTz\nzz/5iZmA+KRNiSw9tOQpWfoaeqP9s2m+bBZ7dmtspSv4GE1BxqgToizafvPORPOg\nzZVC8CmDGUrYuVLb7fxZd3QKh5uetb7WKTRa8s3EniyDzMliG1Uree3lfd/E4Al8\nDQYohj8b3gNPXConyBPvpdJUNnO0drsN9f5XnhXtvao/gSsIZ4oMF2sX7Eu0Tznh\nvoWvE6Eil1/6DtEb5x/g1f6VyIAoS7lnPwfWK5iDH9tXBQaAEVo=\n=p728\n-----END PGP SIGNATURE-----", "payload": "tree c0a2a1586167681cbc68edb5cc7be9f1f983f271\nparent 5a8a44196b3cf099f8c9b0156bd902eaec0b4e5f\nauthor Aaron Hill <aa1ronham@gmail.com> 1626622567 -0500\ncommitter Aaron Hill <aa1ronham@gmail.com> 1626622614 -0500\n\nExtend HIR-based WF checking to associated type defaults\n\nPreviously, we would only look at associated types in `impl` blocks.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "html_url": "https://github.com/rust-lang/rust/commit/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5a8a44196b3cf099f8c9b0156bd902eaec0b4e5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a8a44196b3cf099f8c9b0156bd902eaec0b4e5f", "html_url": "https://github.com/rust-lang/rust/commit/5a8a44196b3cf099f8c9b0156bd902eaec0b4e5f"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "a8ec7b79e571f284141e7343e525a86ea6faba56", "filename": "compiler/rustc_typeck/src/hir_wf_check.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fhir_wf_check.rs?ref=93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "patch": "@@ -121,7 +121,11 @@ fn diagnostic_hir_wf_check<'tcx>(\n \n     let ty = match tcx.hir().get(hir_id) {\n         hir::Node::ImplItem(item) => match item.kind {\n-            hir::ImplItemKind::TyAlias(ref ty) => Some(ty),\n+            hir::ImplItemKind::TyAlias(ty) => Some(ty),\n+            _ => None,\n+        },\n+        hir::Node::TraitItem(item) => match item.kind {\n+            hir::TraitItemKind::Type(_, ty) => ty,\n             _ => None,\n         },\n         _ => None,"}, {"sha": "73ef567ffae6db158edd31d1f79f17644e2dd4c5", "filename": "src/test/ui/associated-types/defaults-wf.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-types%2Fdefaults-wf.stderr?ref=93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "patch": "@@ -1,8 +1,8 @@\n error[E0277]: the size for values of type `[u8]` cannot be known at compilation time\n-  --> $DIR/defaults-wf.rs:7:5\n+  --> $DIR/defaults-wf.rs:7:15\n    |\n LL |     type Ty = Vec<[u8]>;\n-   |     ^^^^^^^^^^^^^^^^^^^^ doesn't have a size known at compile-time\n+   |               ^^^^^^^^^ doesn't have a size known at compile-time\n    | \n   ::: $SRC_DIR/alloc/src/vec/mod.rs:LL:COL\n    |"}, {"sha": "d67e110edeeee0aabb7406503e707c9615e21df0", "filename": "src/test/ui/wf/wf-trait-associated-type-trait.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.rs?ref=93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "patch": "@@ -8,7 +8,7 @@ struct IsCopy<T:Copy> { x: T }\n \n trait SomeTrait {\n     type Type1;\n-    type Type2 = IsCopy<Self::Type1>;\n+    type Type2 = (IsCopy<Self::Type1>, bool);\n     //~^ ERROR E0277\n }\n "}, {"sha": "d1c2c65043d21b8ee8fe2ec862cc504bd8d4743a", "filename": "src/test/ui/wf/wf-trait-associated-type-trait.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93aa89023fb7eb9149e6739c7f54c3ae4a8235bf/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-trait-associated-type-trait.stderr?ref=93aa89023fb7eb9149e6739c7f54c3ae4a8235bf", "patch": "@@ -1,11 +1,11 @@\n error[E0277]: the trait bound `<Self as SomeTrait>::Type1: Copy` is not satisfied\n-  --> $DIR/wf-trait-associated-type-trait.rs:11:5\n+  --> $DIR/wf-trait-associated-type-trait.rs:11:19\n    |\n LL | struct IsCopy<T:Copy> { x: T }\n    |                 ---- required by this bound in `IsCopy`\n ...\n-LL |     type Type2 = IsCopy<Self::Type1>;\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `<Self as SomeTrait>::Type1`\n+LL |     type Type2 = (IsCopy<Self::Type1>, bool);\n+   |                   ^^^^^^^^^^^^^^^^^^^ the trait `Copy` is not implemented for `<Self as SomeTrait>::Type1`\n    |\n help: consider further restricting the associated type\n    |"}]}