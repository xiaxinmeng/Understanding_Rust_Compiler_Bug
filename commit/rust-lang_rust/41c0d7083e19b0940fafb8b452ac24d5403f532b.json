{"sha": "41c0d7083e19b0940fafb8b452ac24d5403f532b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxYzBkNzA4M2UxOWIwOTQwZmFmYjhiNDUyYWMyNGQ1NDAzZjUzMmI=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-12-15T03:44:07Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-12-15T03:44:07Z"}, "message": "librustc: Fix type_use for generic newtype structs. Closes #4188. rs=bugfix", "tree": {"sha": "0c0b3cea3028b789854530366f3b7a9c6ee3cb25", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c0b3cea3028b789854530366f3b7a9c6ee3cb25"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41c0d7083e19b0940fafb8b452ac24d5403f532b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41c0d7083e19b0940fafb8b452ac24d5403f532b", "html_url": "https://github.com/rust-lang/rust/commit/41c0d7083e19b0940fafb8b452ac24d5403f532b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41c0d7083e19b0940fafb8b452ac24d5403f532b/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a9ccf81b056baf493f22d31f31c642d5ca47fb7", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a9ccf81b056baf493f22d31f31c642d5ca47fb7", "html_url": "https://github.com/rust-lang/rust/commit/8a9ccf81b056baf493f22d31f31c642d5ca47fb7"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "08ee59f5d89fa57d8081f8a3a602452938e4f5cd", "filename": "src/librustc/middle/trans/type_use.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/41c0d7083e19b0940fafb8b452ac24d5403f532b/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c0d7083e19b0940fafb8b452ac24d5403f532b/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs?ref=41c0d7083e19b0940fafb8b452ac24d5403f532b", "patch": "@@ -139,7 +139,18 @@ fn type_uses_for(ccx: @crate_ctxt, fn_id: def_id, n_tps: uint)\n       ast_map::node_dtor(_, dtor, _, _) => {\n         handle_body(cx, dtor.node.body);\n       }\n-      _ => fail ~\"unknown node type in type_use\"\n+      ast_map::node_struct_ctor(*) => {\n+        // Similarly to node_variant, this monomorphized function just uses\n+        // the representations of all of its type parameters.\n+        for uint::range(0, n_tps) |n| { cx.uses[n] |= use_repr; }\n+      }\n+      _ => {\n+        ccx.tcx.sess.bug(fmt!(\"unknown node type in type_use: %s\",\n+                              ast_map::node_id_to_str(\n+                                ccx.tcx.items,\n+                                fn_id_loc.node,\n+                                ccx.tcx.sess.parse_sess.interner)));\n+      }\n     }\n     let uses = vec::from_mut(copy cx.uses);\n     ccx.type_use_cache.insert(fn_id, uses);"}, {"sha": "e4c7768357cd2c6e672addd2ea0e0dcc3933a393", "filename": "src/test/run-pass/generic-newtype-struct.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/41c0d7083e19b0940fafb8b452ac24d5403f532b/src%2Ftest%2Frun-pass%2Fgeneric-newtype-struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c0d7083e19b0940fafb8b452ac24d5403f532b/src%2Ftest%2Frun-pass%2Fgeneric-newtype-struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fgeneric-newtype-struct.rs?ref=41c0d7083e19b0940fafb8b452ac24d5403f532b", "patch": "@@ -0,0 +1,7 @@\n+struct S<T>(T);\n+\n+fn main() {\n+    let s = S(2);\n+    io::println(s.to_str());\n+}\n+"}]}