{"sha": "2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "node_id": "C_kwDOAAsO6NoAKDJlNjVhOGYyY2E5ZTJkN2ZmZDQyZWY4YjJjMjE0MzZkNDk5N2MzNWQ", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-02-13T18:31:49Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-04-29T17:13:41Z"}, "message": "Use -Zcodegen-backend instead of a rustc replacement in cargo-clif", "tree": {"sha": "70d0d9a94a34c6ddc1dbdf966a214257721c9591", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70d0d9a94a34c6ddc1dbdf966a214257721c9591"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "html_url": "https://github.com/rust-lang/rust/commit/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "617171e930cc282ceaa71fd6a6cd18615ad1bf59", "url": "https://api.github.com/repos/rust-lang/rust/commits/617171e930cc282ceaa71fd6a6cd18615ad1bf59", "html_url": "https://github.com/rust-lang/rust/commit/617171e930cc282ceaa71fd6a6cd18615ad1bf59"}], "stats": {"total": 212, "additions": 60, "deletions": 152}, "files": [{"sha": "48faec8bc4b9434f5e9f278d88d3e8a2f5149455", "filename": "build_system/build_backend.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/build_system%2Fbuild_backend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/build_system%2Fbuild_backend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fbuild_backend.rs?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -34,18 +34,6 @@ pub(crate) fn build_backend(\n         _ => unreachable!(),\n     }\n \n-    // Set the rpath to make the cg_clif executable find librustc_codegen_cranelift without changing\n-    // LD_LIBRARY_PATH\n-    if cfg!(unix) {\n-        if cfg!(target_os = \"macos\") {\n-            rustflags += \" -Csplit-debuginfo=unpacked \\\n-                -Clink-arg=-Wl,-rpath,@loader_path/../lib \\\n-                -Zosx-rpath-install-name\";\n-        } else {\n-            rustflags += \" -Clink-arg=-Wl,-rpath=$ORIGIN/../lib \";\n-        }\n-    }\n-\n     cmd.env(\"RUSTFLAGS\", rustflags);\n \n     eprintln!(\"[BUILD] rustc_codegen_cranelift\");"}, {"sha": "06feb7cfbcd783843fa8b55a2fa3a0e4aaeec058", "filename": "build_system/build_sysroot.rs", "status": "modified", "additions": 10, "deletions": 13, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/build_system%2Fbuild_sysroot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/build_system%2Fbuild_sysroot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fbuild_sysroot.rs?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -33,19 +33,16 @@ pub(crate) fn build_sysroot(\n         .join(&cg_clif_dylib);\n     try_hard_link(cg_clif_build_dir.join(cg_clif_dylib), &cg_clif_dylib_path);\n \n-    try_hard_link(\n-        cg_clif_build_dir.join(get_file_name(\"cg_clif\", \"bin\")),\n-        target_dir.join(\"bin\").join(get_file_name(\"cg_clif\", \"bin\")),\n-    );\n-\n-    // Build and copy cargo wrapper\n-    let mut build_cargo_wrapper_cmd = Command::new(\"rustc\");\n-    build_cargo_wrapper_cmd\n-        .arg(\"scripts/cargo-clif.rs\")\n-        .arg(\"-o\")\n-        .arg(target_dir.join(\"cargo-clif\"))\n-        .arg(\"-g\");\n-    spawn_and_wait(build_cargo_wrapper_cmd);\n+    // Build and copy rustc and cargo wrappers\n+    for wrapper in [\"rustc-clif\", \"cargo-clif\"] {\n+        let mut build_cargo_wrapper_cmd = Command::new(\"rustc\");\n+        build_cargo_wrapper_cmd\n+            .arg(PathBuf::from(\"scripts\").join(format!(\"{wrapper}.rs\")))\n+            .arg(\"-o\")\n+            .arg(target_dir.join(wrapper))\n+            .arg(\"-g\");\n+        spawn_and_wait(build_cargo_wrapper_cmd);\n+    }\n \n     let default_sysroot = super::rustc_info::get_default_sysroot();\n "}, {"sha": "33f146e7ba27aec13e57e55d40ebb79e3f28e359", "filename": "docs/usage.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/docs%2Fusage.md", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/docs%2Fusage.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fusage.md?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -19,7 +19,7 @@ This will build your project with rustc_codegen_cranelift instead of the usual L\n > You should prefer using the Cargo method.\n \n ```bash\n-$ $cg_clif_dir/build/bin/cg_clif my_crate.rs\n+$ $cg_clif_dir/build/rustc-clif my_crate.rs\n ```\n \n ## Jit mode\n@@ -38,7 +38,7 @@ $ $cg_clif_dir/build/cargo-clif jit\n or\n \n ```bash\n-$ $cg_clif_dir/build/bin/cg_clif -Zunstable-features -Cllvm-args=mode=jit -Cprefer-dynamic my_crate.rs\n+$ $cg_clif_dir/build/rustc-clif -Zunstable-features -Cllvm-args=mode=jit -Cprefer-dynamic my_crate.rs\n ```\n \n There is also an experimental lazy jit mode. In this mode functions are only compiled once they are\n@@ -54,7 +54,7 @@ These are a few functions that allow you to easily run rust code from the shell\n \n ```bash\n function jit_naked() {\n-    echo \"$@\" | $cg_clif_dir/build/bin/cg_clif - -Zunstable-features -Cllvm-args=mode=jit -Cprefer-dynamic\n+    echo \"$@\" | $cg_clif_dir/build/rustc-clif - -Zunstable-features -Cllvm-args=mode=jit -Cprefer-dynamic\n }\n \n function jit() {"}, {"sha": "20aee5ff81b9de3154d275e6a57fe5e196eeba45", "filename": "scripts/cargo-clif.rs", "status": "modified", "additions": 7, "deletions": 15, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Fcargo-clif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Fcargo-clif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Fcargo-clif.rs?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -5,20 +5,11 @@ use std::path::PathBuf;\n use std::process::Command;\n \n fn main() {\n-    if env::var(\"RUSTC_WRAPPER\").map_or(false, |wrapper| wrapper.contains(\"sccache\")) {\n-        eprintln!(\n-            \"\\x1b[1;93m=== Warning: Unsetting RUSTC_WRAPPER to prevent interference with sccache ===\\x1b[0m\"\n-        );\n-        env::remove_var(\"RUSTC_WRAPPER\");\n-    }\n-\n     let sysroot = PathBuf::from(env::current_exe().unwrap().parent().unwrap());\n \n-    env::set_var(\"RUSTC\", sysroot.join(\"bin/cg_clif\".to_string() + env::consts::EXE_SUFFIX));\n-\n-    let mut rustdoc_flags = env::var(\"RUSTDOCFLAGS\").unwrap_or(String::new());\n-    rustdoc_flags.push_str(\" -Cpanic=abort -Zpanic-abort-tests -Zcodegen-backend=\");\n-    rustdoc_flags.push_str(\n+    let mut rustflags = String::new();\n+    rustflags.push_str(\" -Cpanic=abort -Zpanic-abort-tests -Zcodegen-backend=\");\n+    rustflags.push_str(\n         sysroot\n             .join(if cfg!(windows) { \"bin\" } else { \"lib\" })\n             .join(\n@@ -29,9 +20,10 @@ fn main() {\n             .to_str()\n             .unwrap(),\n     );\n-    rustdoc_flags.push_str(\" --sysroot \");\n-    rustdoc_flags.push_str(sysroot.to_str().unwrap());\n-    env::set_var(\"RUSTDOCFLAGS\", rustdoc_flags);\n+    rustflags.push_str(\" --sysroot \");\n+    rustflags.push_str(sysroot.to_str().unwrap());\n+    env::set_var(\"RUSTFLAGS\", env::var(\"RUSTFLAGS\").unwrap_or(String::new()) + &rustflags);\n+    env::set_var(\"RUSTDOCFLAGS\", env::var(\"RUSTDOCFLAGS\").unwrap_or(String::new()) + &rustflags);\n \n     // Ensure that the right toolchain is used\n     env::set_var(\"RUSTUP_TOOLCHAIN\", env!(\"RUSTUP_TOOLCHAIN\"));"}, {"sha": "53ada369b089a28ee63b3c183603a36153239821", "filename": "scripts/config.sh", "status": "removed", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/617171e930cc282ceaa71fd6a6cd18615ad1bf59/scripts%2Fconfig.sh", "raw_url": "https://github.com/rust-lang/rust/raw/617171e930cc282ceaa71fd6a6cd18615ad1bf59/scripts%2Fconfig.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Fconfig.sh?ref=617171e930cc282ceaa71fd6a6cd18615ad1bf59", "patch": "@@ -1,6 +0,0 @@\n-# Note to people running shellcheck: this file should only be sourced, not executed directly.\n-\n-set -e\n-\n-export LD_LIBRARY_PATH=\"$(rustc --print sysroot)/lib:$LD_LIBRARY_PATH\"\n-export DYLD_LIBRARY_PATH=\"$(rustc --print sysroot)/lib:$DYLD_LIBRARY_PATH\""}, {"sha": "e6f60d1c0cb230985bf85311076b15199291a807", "filename": "scripts/filter_profile.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Ffilter_profile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Ffilter_profile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Ffilter_profile.rs?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -2,8 +2,7 @@\n #![forbid(unsafe_code)]/* This line is ignored by bash\n # This block is ignored by rustc\n pushd $(dirname \"$0\")/../\n-source scripts/config.sh\n-RUSTC=\"$(pwd)/build/bin/cg_clif\"\n+RUSTC=\"$(pwd)/build/rustc-clif\"\n popd\n PROFILE=$1 OUTPUT=$2 exec $RUSTC -Zunstable-options -Cllvm-args=mode=jit -Cprefer-dynamic $0\n #*/"}, {"sha": "3abfcd8ddc824e493c5f3a3f4086c6a9b4c989f4", "filename": "scripts/rustc-clif.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Frustc-clif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Frustc-clif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Frustc-clif.rs?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -0,0 +1,36 @@\n+use std::env;\n+use std::ffi::OsString;\n+#[cfg(unix)]\n+use std::os::unix::process::CommandExt;\n+use std::path::PathBuf;\n+use std::process::Command;\n+\n+fn main() {\n+    let sysroot = PathBuf::from(env::current_exe().unwrap().parent().unwrap());\n+\n+    let cg_clif_dylib_path = sysroot.join(if cfg!(windows) { \"bin\" } else { \"lib\" }).join(\n+        env::consts::DLL_PREFIX.to_string() + \"rustc_codegen_cranelift\" + env::consts::DLL_SUFFIX,\n+    );\n+\n+    let mut args = std::env::args_os().skip(1).collect::<Vec<_>>();\n+    args.push(OsString::from(\"-Cpanic=abort\"));\n+    args.push(OsString::from(\"-Zpanic-abort-tests\"));\n+    let mut codegen_backend_arg = OsString::from(\"-Zcodegen-backend=\");\n+    codegen_backend_arg.push(cg_clif_dylib_path);\n+    args.push(codegen_backend_arg);\n+    if !args.contains(&OsString::from(\"--sysroot\")) {\n+        args.push(OsString::from(\"--sysroot\"));\n+        args.push(OsString::from(sysroot.to_str().unwrap()));\n+    }\n+\n+    // Ensure that the right toolchain is used\n+    env::set_var(\"RUSTUP_TOOLCHAIN\", env!(\"RUSTUP_TOOLCHAIN\"));\n+\n+    #[cfg(unix)]\n+    Command::new(\"rustc\").args(args).exec();\n+\n+    #[cfg(not(unix))]\n+    std::process::exit(\n+        Command::new(\"rustc\").args(args).spawn().unwrap().wait().unwrap().code().unwrap_or(1),\n+    );\n+}"}, {"sha": "4d0dfa16c5ecf88488e6a360b752e65fbb200012", "filename": "scripts/setup_rust_fork.sh", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Fsetup_rust_fork.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Fsetup_rust_fork.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Fsetup_rust_fork.sh?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -2,7 +2,6 @@\n set -e\n \n ./y.rs build --no-unstable-features\n-source scripts/config.sh\n \n echo \"[SETUP] Rust fork\"\n git clone https://github.com/rust-lang/rust.git || true\n@@ -52,7 +51,7 @@ changelog-seen = 2\n ninja = false\n \n [build]\n-rustc = \"$(pwd)/../build/bin/cg_clif\"\n+rustc = \"$(pwd)/../build/rustc-clif\"\n cargo = \"$(rustup which cargo)\"\n full-bootstrap = true\n local-rebuild = true"}, {"sha": "cd6b2181ace2cf4e0b7e0ecd9ee74af64432d7f7", "filename": "scripts/tests.sh", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Ftests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d/scripts%2Ftests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Ftests.sh?ref=2e65a8f2ca9e2d7ffd42ef8b2c21436d4997c35d", "patch": "@@ -2,8 +2,6 @@\n \n set -e\n \n-source scripts/config.sh\n-\n export CG_CLIF_DISPLAY_CG_TIME=1\n export CG_CLIF_DISABLE_INCR_CACHE=1\n \n@@ -31,8 +29,7 @@ if [[ \"$(uname)\" == 'Darwin' ]]; then\n    export RUSTFLAGS=\"$RUSTFLAGS -Clink-arg=-undefined -Clink-arg=dynamic_lookup\"\n fi\n \n-export RUSTC=false # ensure that cg_llvm isn't accidentally used\n-MY_RUSTC=\"$(pwd)/build/bin/cg_clif $RUSTFLAGS -L crate=target/out --out-dir target/out -Cdebuginfo=2\"\n+MY_RUSTC=\"$(pwd)/build/rustc-clif $RUSTFLAGS -L crate=target/out --out-dir target/out -Cdebuginfo=2\"\n \n function no_sysroot_tests() {\n     echo \"[BUILD] mini_core\"\n@@ -124,7 +121,7 @@ function extended_sysroot_tests() {\n     if [[ \"$HOST_TRIPLE\" = \"$TARGET_TRIPLE\" ]]; then\n         echo \"[BENCH COMPILE] ebobby/simple-raytracer\"\n         hyperfine --runs \"${RUN_RUNS:-10}\" --warmup 1 --prepare \"../build/cargo-clif clean\" \\\n-        \"RUSTC=rustc RUSTFLAGS='' cargo build\" \\\n+        \"RUSTFLAGS='' cargo build\" \\\n         \"../build/cargo-clif build\"\n \n         echo \"[BENCH RUN] ebobby/simple-raytracer\""}, {"sha": "5984ec8412ad71acfdf304f10faf98183d929762", "filename": "src/bin/cg_clif.rs", "status": "removed", "additions": 0, "deletions": 94, "changes": 94, "blob_url": "https://github.com/rust-lang/rust/blob/617171e930cc282ceaa71fd6a6cd18615ad1bf59/src%2Fbin%2Fcg_clif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/617171e930cc282ceaa71fd6a6cd18615ad1bf59/src%2Fbin%2Fcg_clif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcg_clif.rs?ref=617171e930cc282ceaa71fd6a6cd18615ad1bf59", "patch": "@@ -1,94 +0,0 @@\n-#![feature(rustc_private)]\n-#![warn(rust_2018_idioms)]\n-#![warn(unused_lifetimes)]\n-#![warn(unreachable_pub)]\n-\n-extern crate rustc_data_structures;\n-extern crate rustc_driver;\n-extern crate rustc_interface;\n-extern crate rustc_session;\n-extern crate rustc_target;\n-\n-use std::panic;\n-\n-use rustc_data_structures::profiling::{get_resident_set_size, print_time_passes_entry};\n-use rustc_interface::interface;\n-use rustc_session::config::{ErrorOutputType, TrimmedDefPaths};\n-use rustc_session::early_error;\n-use rustc_target::spec::PanicStrategy;\n-\n-// FIXME use std::lazy::SyncLazy once it stabilizes\n-use once_cell::sync::Lazy;\n-\n-const BUG_REPORT_URL: &str = \"https://github.com/bjorn3/rustc_codegen_cranelift/issues/new\";\n-\n-static DEFAULT_HOOK: Lazy<Box<dyn Fn(&panic::PanicInfo<'_>) + Sync + Send + 'static>> =\n-    Lazy::new(|| {\n-        let hook = panic::take_hook();\n-        panic::set_hook(Box::new(|info| {\n-            // Invoke the default handler, which prints the actual panic message and optionally a backtrace\n-            (*DEFAULT_HOOK)(info);\n-\n-            // Separate the output with an empty line\n-            eprintln!();\n-\n-            // Print the ICE message\n-            rustc_driver::report_ice(info, BUG_REPORT_URL);\n-        }));\n-        hook\n-    });\n-\n-#[derive(Default)]\n-pub struct CraneliftPassesCallbacks {\n-    time_passes: bool,\n-}\n-\n-impl rustc_driver::Callbacks for CraneliftPassesCallbacks {\n-    fn config(&mut self, config: &mut interface::Config) {\n-        // If a --prints=... option has been given, we don't print the \"total\"\n-        // time because it will mess up the --prints output. See #64339.\n-        self.time_passes = config.opts.prints.is_empty()\n-            && (config.opts.debugging_opts.time_passes || config.opts.debugging_opts.time);\n-\n-        config.opts.cg.panic = Some(PanicStrategy::Abort);\n-        config.opts.debugging_opts.panic_abort_tests = true;\n-        config.opts.maybe_sysroot = Some(config.opts.maybe_sysroot.clone().unwrap_or_else(|| {\n-            std::env::current_exe().unwrap().parent().unwrap().parent().unwrap().to_owned()\n-        }));\n-\n-        config.opts.trimmed_def_paths = TrimmedDefPaths::GoodPath;\n-    }\n-}\n-\n-fn main() {\n-    let start_time = std::time::Instant::now();\n-    let start_rss = get_resident_set_size();\n-    rustc_driver::init_rustc_env_logger();\n-    let mut callbacks = CraneliftPassesCallbacks::default();\n-    Lazy::force(&DEFAULT_HOOK); // Install ice hook\n-    let exit_code = rustc_driver::catch_with_exit_code(|| {\n-        let args = std::env::args_os()\n-            .enumerate()\n-            .map(|(i, arg)| {\n-                arg.into_string().unwrap_or_else(|arg| {\n-                    early_error(\n-                        ErrorOutputType::default(),\n-                        &format!(\"Argument {} is not valid Unicode: {:?}\", i, arg),\n-                    )\n-                })\n-            })\n-            .collect::<Vec<_>>();\n-        let mut run_compiler = rustc_driver::RunCompiler::new(&args, &mut callbacks);\n-        run_compiler.set_make_codegen_backend(Some(Box::new(move |_| {\n-            Box::new(rustc_codegen_cranelift::CraneliftCodegenBackend { config: None })\n-        })));\n-        run_compiler.run()\n-    });\n-\n-    if callbacks.time_passes {\n-        let end_rss = get_resident_set_size();\n-        print_time_passes_entry(\"total\", start_time.elapsed(), start_rss, end_rss);\n-    }\n-\n-    std::process::exit(exit_code)\n-}"}]}