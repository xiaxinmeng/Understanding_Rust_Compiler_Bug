{"sha": "f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1N2NlMzY5ODgwZjk1MmM5N2U4YTA2M2I1ZjBmZTRhYmUxZDg0YTQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-12-10T13:16:34Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-12-10T13:16:34Z"}, "message": "Fix FileId computation in IncorrectCase fix", "tree": {"sha": "aeb3cb34a21785a8d92d2747c059f5d8c47e0c5d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aeb3cb34a21785a8d92d2747c059f5d8c47e0c5d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "html_url": "https://github.com/rust-lang/rust/commit/f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f57ce369880f952c97e8a063b5f0fe4abe1d84a4/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d5da92e4c779e1222023295c3d29b18eafbdb99", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d5da92e4c779e1222023295c3d29b18eafbdb99", "html_url": "https://github.com/rust-lang/rust/commit/8d5da92e4c779e1222023295c3d29b18eafbdb99"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "a900d7bae457fc326b931c28204af60b91b7f623", "filename": "crates/ide/src/diagnostics/fixes.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f57ce369880f952c97e8a063b5f0fe4abe1d84a4/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f57ce369880f952c97e8a063b5f0fe4abe1d84a4/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdiagnostics%2Ffixes.rs?ref=f57ce369880f952c97e8a063b5f0fe4abe1d84a4", "patch": "@@ -6,7 +6,7 @@ use hir::{\n         Diagnostic, IncorrectCase, MissingFields, MissingOkInTailExpr, NoSuchField,\n         UnresolvedModule,\n     },\n-    HasSource, HirDisplay, Semantics, VariantDef,\n+    HasSource, HirDisplay, InFile, Semantics, VariantDef,\n };\n use ide_db::base_db::{AnchoredPathBuf, FileId};\n use ide_db::{\n@@ -110,9 +110,9 @@ impl DiagnosticWithFix for IncorrectCase {\n         let root = sema.db.parse_or_expand(self.file)?;\n         let name_node = self.ident.to_node(&root);\n \n-        let file_id = self.file.original_file(sema.db);\n-        let offset = name_node.syntax().text_range().start();\n-        let file_position = FilePosition { file_id, offset };\n+        let name_node = InFile::new(self.file, name_node.syntax());\n+        let frange = name_node.original_file_range(sema.db);\n+        let file_position = FilePosition { file_id: frange.file_id, offset: frange.range.start() };\n \n         let rename_changes =\n             rename_with_semantics(sema, file_position, &self.suggested_text).ok()?;"}]}