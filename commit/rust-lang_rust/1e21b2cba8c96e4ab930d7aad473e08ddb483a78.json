{"sha": "1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMjFiMmNiYThjOTZlNGFiOTMwZDdhYWQ0NzNlMDhkZGI0ODNhNzg=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-01-30T11:29:22Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-03-01T22:35:35Z"}, "message": "Build newer version of cmake in Docker images\n\nLLVM requires CMake 3.13.4, which is only available as of Ubuntu 20.04.\nOn images using an older version, build it manually.", "tree": {"sha": "0e3ae994d9b102094dc75bc638a8c9fcda9bd9cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e3ae994d9b102094dc75bc638a8c9fcda9bd9cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "html_url": "https://github.com/rust-lang/rust/commit/1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff2111a9052560ef52028b1b9a7b5fb8ff1d031e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff2111a9052560ef52028b1b9a7b5fb8ff1d031e", "html_url": "https://github.com/rust-lang/rust/commit/ff2111a9052560ef52028b1b9a7b5fb8ff1d031e"}], "stats": {"total": 109, "additions": 109, "deletions": 0}, "files": [{"sha": "43cdbbe92e3acfbd787d2092f7d7679d20891733", "filename": "src/ci/docker/host-x86_64/arm-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -36,5 +36,8 @@ ENV SCRIPT python3 ../x.py --stage 2 test --host='' --target $TARGETS\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n COPY scripts/android-start-emulator.sh /scripts/\n ENTRYPOINT [\"/scripts/android-start-emulator.sh\"]"}, {"sha": "e6b6b6e53b99d32126279b32546d09a7fc798c10", "filename": "src/ci/docker/host-x86_64/dist-aarch64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-aarch64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-aarch64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-aarch64-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -24,6 +24,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/aarch64-unknown-linux-gnueabi/bin\n \n ENV CC_aarch64_unknown_linux_gnu=aarch64-unknown-linux-gnueabi-gcc \\"}, {"sha": "ee727359f396189b80abec2fec9bafb73c3f8e95", "filename": "src/ci/docker/host-x86_64/dist-android/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -36,3 +36,6 @@ ENV SCRIPT python3 ../x.py dist --host='' --target $TARGETS\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n+\n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh"}, {"sha": "1be3fecd88ffff3f6df6edb515a93559374906de", "filename": "src/ci/docker/host-x86_64/dist-arm-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -27,6 +27,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/arm-unknown-linux-gnueabi/bin\n \n ENV CC_arm_unknown_linux_gnueabi=arm-unknown-linux-gnueabi-gcc \\"}, {"sha": "66eb4137a87ca1a3cbae0ae01d088f33ee668faa", "filename": "src/ci/docker/host-x86_64/dist-armhf-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armhf-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armhf-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armhf-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -19,6 +19,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/arm-unknown-linux-gnueabihf/bin\n \n ENV CC_arm_unknown_linux_gnueabihf=arm-unknown-linux-gnueabihf-gcc \\"}, {"sha": "c13f63911f8fae06089859ba6ac6dce173ce665c", "filename": "src/ci/docker/host-x86_64/dist-armv7-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armv7-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armv7-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-armv7-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -19,6 +19,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/armv7-unknown-linux-gnueabihf/bin\n \n ENV CC_armv7_unknown_linux_gnueabihf=armv7-unknown-linux-gnueabihf-gcc \\"}, {"sha": "c98fc7dcfff3e803d3edc9407db469c1e3664f95", "filename": "src/ci/docker/host-x86_64/dist-i586-gnu-i586-i686-musl/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i586-gnu-i586-i686-musl%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -30,6 +30,9 @@ RUN CC=gcc CFLAGS=\"-m32 -Wa,-mrelax-relocations=no\" \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV RUST_CONFIGURE_ARGS \\\n       --musl-root-i586=/musl-i586 \\\n       --musl-root-i686=/musl-i686 \\"}, {"sha": "b0f06569a9c21f20192cd72525e2ce63f4f7b1a9", "filename": "src/ci/docker/host-x86_64/dist-mips-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -21,6 +21,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV HOSTS=mips-unknown-linux-gnu\n \n ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs"}, {"sha": "245c28e1fa341efa1b0775ad18658fc9b7367dde", "filename": "src/ci/docker/host-x86_64/dist-mips64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -20,6 +20,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV HOSTS=mips64-unknown-linux-gnuabi64\n \n ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs"}, {"sha": "03998c8880aea3cdefc056163c8074bcc68e6c74", "filename": "src/ci/docker/host-x86_64/dist-mips64el-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64el-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64el-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mips64el-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -21,6 +21,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV HOSTS=mips64el-unknown-linux-gnuabi64\n \n ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs"}, {"sha": "586172706210104606a9cfe441565cf7ffc1e569", "filename": "src/ci/docker/host-x86_64/dist-mipsel-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mipsel-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mipsel-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-mipsel-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -20,6 +20,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV HOSTS=mipsel-unknown-linux-gnu\n \n ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs"}, {"sha": "ecaa495e97aee8859f63a17e0f0951146f944d8c", "filename": "src/ci/docker/host-x86_64/dist-powerpc-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -25,6 +25,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/powerpc-unknown-linux-gnu/bin\n \n ENV \\"}, {"sha": "a22d9a7553ecfbf87b92ce8a313bbcbe94bafb22", "filename": "src/ci/docker/host-x86_64/dist-powerpc64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -26,6 +26,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/powerpc64-unknown-linux-gnu/bin\n \n ENV \\"}, {"sha": "5157dd4c79b4c841c173418a6fea025c034b0029", "filename": "src/ci/docker/host-x86_64/dist-powerpc64le-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64le-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64le-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-powerpc64le-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -25,6 +25,9 @@ RUN ./build-powerpc64le-toolchain.sh\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV \\\n     AR_powerpc64le_unknown_linux_gnu=powerpc64le-linux-gnu-ar \\\n     CC_powerpc64le_unknown_linux_gnu=powerpc64le-linux-gnu-gcc \\"}, {"sha": "80b7793cb7e3caa88a4db03d2ec9df15351c8ebb", "filename": "src/ci/docker/host-x86_64/dist-riscv64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-riscv64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-riscv64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-riscv64-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -19,6 +19,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/riscv64-unknown-linux-gnu/bin\n \n ENV CC_riscv64gc_unknown_linux_gnu=riscv64-unknown-linux-gnu-gcc \\"}, {"sha": "5e62624395210f3b82cdd51e32e9e00bdda52efa", "filename": "src/ci/docker/host-x86_64/dist-s390x-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-s390x-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-s390x-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-s390x-linux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -25,6 +25,9 @@ USER root\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/s390x-ibm-linux-gnu/bin\n \n ENV \\"}, {"sha": "121dd3f455a9e151a4e6120d167167228632c9c2", "filename": "src/ci/docker/host-x86_64/dist-x86_64-freebsd/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-freebsd%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -23,6 +23,9 @@ RUN /tmp/freebsd-toolchain.sh x86_64\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV \\\n     AR_x86_64_unknown_freebsd=x86_64-unknown-freebsd11-ar \\\n     CC_x86_64_unknown_freebsd=x86_64-unknown-freebsd11-clang \\"}, {"sha": "c2e44ead51ee4cdbe9e0a33150c7de5726447221", "filename": "src/ci/docker/host-x86_64/dist-x86_64-illumos/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-illumos%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-illumos%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-illumos%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -22,6 +22,9 @@ RUN bash /tmp/illumos-toolchain.sh x86_64 gcc\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV \\\n     AR_x86_64_unknown_illumos=x86_64-illumos-ar \\\n     CC_x86_64_unknown_illumos=x86_64-illumos-gcc \\"}, {"sha": "d779e8d7b5d5a66a1a8d13f6676a0efc85bdce0c", "filename": "src/ci/docker/host-x86_64/dist-x86_64-musl/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -29,6 +29,9 @@ RUN CFLAGS=\"-Wa,-mrelax-relocations=no -Wa,--compress-debug-sections=none -Wl,--\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV HOSTS=x86_64-unknown-linux-musl\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "92bdc9811fd52140127964b1c016cd1a305d103d", "filename": "src/ci/docker/host-x86_64/dist-x86_64-netbsd/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -9,6 +9,9 @@ RUN /tmp/build-netbsd-toolchain.sh\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV PATH=$PATH:/x-tools/x86_64-unknown-netbsd/bin\n \n ENV \\"}, {"sha": "0182ebb8b597e7249ca12f5fc71b35214d2993ab", "filename": "src/ci/docker/host-x86_64/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -20,6 +20,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n RUN mkdir -p /config\n RUN echo \"[rust]\" > /config/nopt-std-config.toml\n RUN echo \"optimize = false\" >> /config/nopt-std-config.toml"}, {"sha": "feaab819bdda30ab3d7fca2615f96dc29e42b265", "filename": "src/ci/docker/host-x86_64/i686-gnu/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -20,6 +20,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu\n # Exclude some tests that are unlikely to be platform specific, to speed up\n # this slow job."}, {"sha": "00ad7b0a710370986848010f3f226d028f574136", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-aux/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -42,5 +42,8 @@ RUN npm install browser-ui-test -g --unsafe-perm=true\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n ENV RUST_CHECK_TARGET check-aux-and-gui"}, {"sha": "09d9cda02bda65efb072fdf77e71e7929eec0494", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -19,6 +19,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --set rust.ignore-git=false\n ENV SCRIPT python3 ../x.py --stage 2 test distcheck\n ENV DIST_SRC 1"}, {"sha": "d4838c0d6f8e535422ccfb6c6d838ec9daac9cb2", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-tools/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -18,6 +18,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY scripts/cmake.sh /scripts/\n+RUN /scripts/cmake.sh\n+\n COPY host-x86_64/x86_64-gnu-tools/checktools.sh /tmp/\n \n ENV RUST_CONFIGURE_ARGS \\"}, {"sha": "70096173403d787f55074dcbb72f2e806dd18c24", "filename": "src/ci/docker/scripts/cmake.sh", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fscripts%2Fcmake.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1e21b2cba8c96e4ab930d7aad473e08ddb483a78/src%2Fci%2Fdocker%2Fscripts%2Fcmake.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fcmake.sh?ref=1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "patch": "@@ -0,0 +1,34 @@\n+#!/bin/bash\n+set -ex\n+\n+hide_output() {\n+  set +x\n+  on_err=\"\n+echo ERROR: An error was encountered with the build.\n+cat /tmp/build.log\n+exit 1\n+\"\n+  trap \"$on_err\" ERR\n+  bash -c \"while true; do sleep 30; echo \\$(date) - building ...; done\" &\n+  PING_LOOP_PID=$!\n+  \"$@\" &> /tmp/build.log\n+  trap - ERR\n+  kill $PING_LOOP_PID\n+  rm /tmp/build.log\n+  set -x\n+}\n+\n+# LLVM 12 requires CMake 3.13.4 or higher.\n+# This script is not necessary for images using Ubuntu 20.04 or newer.\n+CMAKE=3.13.4\n+curl -L https://github.com/Kitware/CMake/releases/download/v$CMAKE/cmake-$CMAKE.tar.gz | tar xzf -\n+\n+mkdir cmake-build\n+cd cmake-build\n+hide_output ../cmake-$CMAKE/configure\n+hide_output make -j$(nproc)\n+hide_output make install\n+\n+cd ..\n+rm -rf cmake-build\n+rm -rf cmake-$CMAKE"}]}