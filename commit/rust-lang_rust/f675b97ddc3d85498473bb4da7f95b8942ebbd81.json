{"sha": "f675b97ddc3d85498473bb4da7f95b8942ebbd81", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2NzViOTdkZGMzZDg1NDk4NDczYmI0ZGE3Zjk1Yjg5NDJlYmJkODE=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-12-11T05:16:20Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-12-11T05:16:20Z"}, "message": "Merge pull request #4144 from luqmana/deprecated-attribute\n\nAdd deprecated attribute.", "tree": {"sha": "d1d54750a5cbafb8421cd668e4574050734e4cab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d1d54750a5cbafb8421cd668e4574050734e4cab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f675b97ddc3d85498473bb4da7f95b8942ebbd81", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f675b97ddc3d85498473bb4da7f95b8942ebbd81", "html_url": "https://github.com/rust-lang/rust/commit/f675b97ddc3d85498473bb4da7f95b8942ebbd81", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f675b97ddc3d85498473bb4da7f95b8942ebbd81/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7dd3af970b44c09a429d02d60fd44b9f8ec45bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7dd3af970b44c09a429d02d60fd44b9f8ec45bd", "html_url": "https://github.com/rust-lang/rust/commit/e7dd3af970b44c09a429d02d60fd44b9f8ec45bd"}, {"sha": "a0d7b961706f1f808e7dd244e8bbd9515c073196", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0d7b961706f1f808e7dd244e8bbd9515c073196", "html_url": "https://github.com/rust-lang/rust/commit/a0d7b961706f1f808e7dd244e8bbd9515c073196"}], "stats": {"total": 39, "additions": 38, "deletions": 1}, "files": [{"sha": "60dea3858724acedafa7be197425055ef6ad938d", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=f675b97ddc3d85498473bb4da7f95b8942ebbd81", "patch": "@@ -60,6 +60,7 @@ enum lint {\n     unrecognized_lint,\n     non_implicitly_copyable_typarams,\n     vecs_implicitly_copyable,\n+    deprecated_item,\n     deprecated_mode,\n     deprecated_pattern,\n     non_camel_case_types,\n@@ -157,6 +158,11 @@ fn get_lint_dict() -> lint_dict {\n            desc: ~\"implicit copies of non implicitly copyable data\",\n            default: warn}),\n \n+        (~\"deprecated_item\",\n+         @{lint: deprecated_item,\n+           desc: ~\"warn about items marked deprecated\",\n+           default: warn}),\n+\n         (~\"deprecated_mode\",\n          @{lint: deprecated_mode,\n            desc: ~\"warn about deprecated uses of modes\",\n@@ -412,6 +418,7 @@ fn check_item(i: @ast::item, cx: ty::ctxt) {\n     check_item_non_camel_case_types(cx, i);\n     check_item_heap(cx, i);\n     check_item_structural_records(cx, i);\n+    check_item_deprecated(cx, i);\n     check_item_deprecated_modes(cx, i);\n     check_item_type_limits(cx, i);\n }\n@@ -767,6 +774,26 @@ fn check_item_non_camel_case_types(cx: ty::ctxt, it: @ast::item) {\n     }\n }\n \n+fn check_item_deprecated(tcx: ty::ctxt, it: @ast::item) {\n+    let at = attr::find_attrs_by_name(it.attrs, ~\"deprecated\");\n+\n+    if at.is_not_empty() {\n+        for at.each |attr| {\n+            let fmt = match attr.node.value.node {\n+                ast::meta_name_value(_, ref l) =>\n+                    match l.node {\n+                        ast::lit_str(ref reason) =>\n+                            fmt!(\"deprecated: %s\", **reason),\n+                        _ =>  ~\"item is deprecated\" \n+                    },\n+                _ => ~\"item is deprecated\"\n+            };\n+            tcx.sess.span_lint(deprecated_item, it.id, it.id, it.span,\n+                fmt);\n+        }\n+    }\n+}\n+\n fn check_fn(tcx: ty::ctxt, fk: visit::fn_kind, decl: ast::fn_decl,\n             _body: ast::blk, span: span, id: ast::node_id) {\n     debug!(\"lint check_fn fk=%? id=%?\", fk, id);"}, {"sha": "aadea886407cd20d4b42cfc817db2dd3824143f4", "filename": "src/libsyntax/attr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Flibsyntax%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Flibsyntax%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr.rs?ref=f675b97ddc3d85498473bb4da7f95b8942ebbd81", "patch": "@@ -182,7 +182,7 @@ fn find_attrs_by_name(attrs: ~[ast::attribute], name: ~str) ->\n     return vec::filter_map(attrs, filter);\n }\n \n-/// Searcha list of meta items and return only those with a specific name\n+/// Search a list of meta items and return only those with a specific name\n fn find_meta_items_by_name(metas: ~[@ast::meta_item], name: ~str) ->\n    ~[@ast::meta_item] {\n     let filter = fn@(m: &@ast::meta_item) -> Option<@ast::meta_item> {"}, {"sha": "5933ebe861759bbea8693962d630e1a5f1d35bf9", "filename": "src/test/compile-fail/lint-deprecated-items.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Ftest%2Fcompile-fail%2Flint-deprecated-items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f675b97ddc3d85498473bb4da7f95b8942ebbd81/src%2Ftest%2Fcompile-fail%2Flint-deprecated-items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-deprecated-items.rs?ref=f675b97ddc3d85498473bb4da7f95b8942ebbd81", "patch": "@@ -0,0 +1,10 @@\n+#[forbid(deprecated_item)];\n+\n+type Bar = uint;\n+\n+#[deprecated = \"use Bar instead\"]\n+type Foo = int;\n+\n+fn main() {\n+    let _x: Foo = 21;\n+}"}]}