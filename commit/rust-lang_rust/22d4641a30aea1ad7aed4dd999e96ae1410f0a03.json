{"sha": "22d4641a30aea1ad7aed4dd999e96ae1410f0a03", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyZDQ2NDFhMzBhZWExYWQ3YWVkNGRkOTk5ZTk2YWUxNDEwZjBhMDM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-26T21:03:22Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-26T21:03:22Z"}, "message": "Fix invalid reads of cstrs in trans", "tree": {"sha": "c7895152c345f31e9a1d88775a6c4f76a0dd42ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7895152c345f31e9a1d88775a6c4f76a0dd42ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22d4641a30aea1ad7aed4dd999e96ae1410f0a03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22d4641a30aea1ad7aed4dd999e96ae1410f0a03", "html_url": "https://github.com/rust-lang/rust/commit/22d4641a30aea1ad7aed4dd999e96ae1410f0a03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22d4641a30aea1ad7aed4dd999e96ae1410f0a03/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2744bcd693671869d17bc9b8db013d487fe465b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2744bcd693671869d17bc9b8db013d487fe465b1", "html_url": "https://github.com/rust-lang/rust/commit/2744bcd693671869d17bc9b8db013d487fe465b1"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "2eb4c503a5bbe327daa34ace3a6b3aeac6bbd2a7", "filename": "src/comp/middle/trans_common.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/22d4641a30aea1ad7aed4dd999e96ae1410f0a03/src%2Fcomp%2Fmiddle%2Ftrans_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22d4641a30aea1ad7aed4dd999e96ae1410f0a03/src%2Fcomp%2Fmiddle%2Ftrans_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_common.rs?ref=22d4641a30aea1ad7aed4dd999e96ae1410f0a03", "patch": "@@ -843,9 +843,10 @@ fn C_u8(i: uint) -> ValueRef { ret C_integral(T_i8(), i, False); }\n // our boxed-and-length-annotated strings.\n fn C_cstr(cx: &@crate_ctxt, s: &str) -> ValueRef {\n     let sc = llvm::LLVMConstString(str::buf(s), str::byte_len(s), False);\n+    let gname = cx.names.next(\"str\");\n     let g =\n         llvm::LLVMAddGlobal(cx.llmod, val_ty(sc),\n-                            str::buf(cx.names.next(\"str\")));\n+                            str::buf(gname));\n     llvm::LLVMSetInitializer(g, sc);\n     llvm::LLVMSetGlobalConstant(g, True);\n     llvm::LLVMSetLinkage(g, lib::llvm::LLVMInternalLinkage as llvm::Linkage);\n@@ -864,9 +865,9 @@ fn C_str(cx: &@crate_ctxt, s: &str) -> ValueRef {\n         C_struct([C_int(abi::const_refcount as int), C_int(len + 1u as int),\n                   C_int(len + 1u as int), C_int(0),\n                   llvm::LLVMConstString(str::buf(s), len, False)]);\n+    let gname = cx.names.next(\"str\");\n     let g =\n-        llvm::LLVMAddGlobal(cx.llmod, val_ty(box),\n-                            str::buf(cx.names.next(\"str\")));\n+        llvm::LLVMAddGlobal(cx.llmod, val_ty(box), str::buf(gname));\n     llvm::LLVMSetInitializer(g, box);\n     llvm::LLVMSetGlobalConstant(g, True);\n     llvm::LLVMSetLinkage(g, lib::llvm::LLVMInternalLinkage as llvm::Linkage);\n@@ -907,9 +908,9 @@ fn C_bytes(bytes: &[u8]) -> ValueRef {\n \n fn C_shape(ccx: &@crate_ctxt, bytes: &[u8]) -> ValueRef {\n     let llshape = C_bytes(bytes);\n+    let gname = ccx.names.next(\"shape\");\n     let llglobal =\n-        llvm::LLVMAddGlobal(ccx.llmod, val_ty(llshape),\n-                            str::buf(ccx.names.next(\"shape\")));\n+        llvm::LLVMAddGlobal(ccx.llmod, val_ty(llshape), str::buf(gname));\n     llvm::LLVMSetInitializer(llglobal, llshape);\n     llvm::LLVMSetGlobalConstant(llglobal, True);\n     llvm::LLVMSetLinkage(llglobal,"}]}