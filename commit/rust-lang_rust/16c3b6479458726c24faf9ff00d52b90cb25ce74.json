{"sha": "16c3b6479458726c24faf9ff00d52b90cb25ce74", "node_id": "C_kwDOAAsO6NoAKDE2YzNiNjQ3OTQ1ODcyNmMyNGZhZjlmZjAwZDUyYjkwY2IyNWNlNzQ", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-10-22T10:58:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-22T10:58:07Z"}, "message": "Rollup merge of #102602 - WaffleLapkin:linty_action, r=estebank\n\nSlightly tweak comments wrt `lint_overflowing_range_endpoint`\n\nFrom the review: https://github.com/rust-lang/rust/pull/101986#discussion_r975610611\n\nIt _seemed_ that the lint was not emitted when the `if` check failed, but _actually_ this happens already in a special case and the lint is emitted outside of this function, if this function doesn't. I've cleared up the code/comments a bit, so it's more obvious :)\n\nr? ```@estebank```", "tree": {"sha": "778b9b81a8681e7ac6120df4f1039718ccc13fca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/778b9b81a8681e7ac6120df4f1039718ccc13fca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/16c3b6479458726c24faf9ff00d52b90cb25ce74", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjU8y/CRBK7hj4Ov3rIwAAkfoIAKV4JFo9JTqcHmZKmcilLb0f\ne0NLhCZ6YsSf5JllTDoFt9cI4JwKi9FdSV6vT+JLs2/K2k+t4SJrbPEf/E+4dmT8\neZ5L1jXhIh+/HrV3iv5UJG6WTiHWs2Z85VquhYGO3EyijMS8+ztyU2UqK5jmBEap\nBeTBn4LxrgA+JVQd8qykGWmufvgdykNy1tNwhXX5xbAUatKk99L0yAfU8kiLH7sj\nCGn5dcCQx+NAqY2+3mC4MGX+nGbnlIPQbkD2pw9L2D683r58tR1P2bTJqxktcZAB\nWBL2YtMGc2JYDHqSFmYbQ0H2dpgJNJkpHW5I0xFmKH84qd+LhbcS9GmuRmEFKA0=\n=grtN\n-----END PGP SIGNATURE-----\n", "payload": "tree 778b9b81a8681e7ac6120df4f1039718ccc13fca\nparent 26c96e341639102afacbbcad0dc18ad0ac71ab18\nparent 64e7fd952243b6724dcd4e14e177c3e972b342bc\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1666436287 +0530\ncommitter GitHub <noreply@github.com> 1666436287 +0530\n\nRollup merge of #102602 - WaffleLapkin:linty_action, r=estebank\n\nSlightly tweak comments wrt `lint_overflowing_range_endpoint`\n\nFrom the review: https://github.com/rust-lang/rust/pull/101986#discussion_r975610611\n\nIt _seemed_ that the lint was not emitted when the `if` check failed, but _actually_ this happens already in a special case and the lint is emitted outside of this function, if this function doesn't. I've cleared up the code/comments a bit, so it's more obvious :)\n\nr? ```@estebank```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/16c3b6479458726c24faf9ff00d52b90cb25ce74", "html_url": "https://github.com/rust-lang/rust/commit/16c3b6479458726c24faf9ff00d52b90cb25ce74", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/16c3b6479458726c24faf9ff00d52b90cb25ce74/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26c96e341639102afacbbcad0dc18ad0ac71ab18", "url": "https://api.github.com/repos/rust-lang/rust/commits/26c96e341639102afacbbcad0dc18ad0ac71ab18", "html_url": "https://github.com/rust-lang/rust/commit/26c96e341639102afacbbcad0dc18ad0ac71ab18"}, {"sha": "64e7fd952243b6724dcd4e14e177c3e972b342bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/64e7fd952243b6724dcd4e14e177c3e972b342bc", "html_url": "https://github.com/rust-lang/rust/commit/64e7fd952243b6724dcd4e14e177c3e972b342bc"}], "stats": {"total": 78, "additions": 40, "deletions": 38}, "files": [{"sha": "3cdca2178657d78d910186e6848b480d9dcf0a65", "filename": "compiler/rustc_lint/src/types.rs", "status": "modified", "additions": 40, "deletions": 38, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/16c3b6479458726c24faf9ff00d52b90cb25ce74/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16c3b6479458726c24faf9ff00d52b90cb25ce74/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs?ref=16c3b6479458726c24faf9ff00d52b90cb25ce74", "patch": "@@ -116,8 +116,8 @@ impl TypeLimits {\n     }\n }\n \n-/// Attempts to special-case the overflowing literal lint when it occurs as a range endpoint.\n-/// Returns `true` iff the lint was overridden.\n+/// Attempts to special-case the overflowing literal lint when it occurs as a range endpoint (`expr..MAX+1`).\n+/// Returns `true` iff the lint was emitted.\n fn lint_overflowing_range_endpoint<'tcx>(\n     cx: &LateContext<'tcx>,\n     lit: &hir::Lit,\n@@ -140,44 +140,46 @@ fn lint_overflowing_range_endpoint<'tcx>(\n         return false;\n     }\n \n-    let mut overwritten = false;\n     // We can suggest using an inclusive range\n     // (`..=`) instead only if it is the `end` that is\n     // overflowing and only by 1.\n-    if eps[1].expr.hir_id == expr.hir_id && lit_val - 1 == max\n-        && let Ok(start) = cx.sess().source_map().span_to_snippet(eps[0].span)\n-    {\n-        cx.struct_span_lint(\n-            OVERFLOWING_LITERALS,\n-            struct_expr.span,\n-            fluent::lint::range_endpoint_out_of_range,\n-            |lint| {\n-                use ast::{LitIntType, LitKind};\n-\n-                lint.set_arg(\"ty\", ty);\n-\n-                // We need to preserve the literal's suffix,\n-                // as it may determine typing information.\n-                let suffix = match lit.node {\n-                    LitKind::Int(_, LitIntType::Signed(s)) => s.name_str(),\n-                    LitKind::Int(_, LitIntType::Unsigned(s)) => s.name_str(),\n-                    LitKind::Int(_, LitIntType::Unsuffixed) => \"\",\n-                    _ => bug!(),\n-                };\n-                let suggestion = format!(\"{}..={}{}\", start, lit_val - 1, suffix);\n-                lint.span_suggestion(\n-                    struct_expr.span,\n-                    fluent::lint::suggestion,\n-                    suggestion,\n-                    Applicability::MachineApplicable,\n-                );\n-                overwritten = true;\n+    if !(eps[1].expr.hir_id == expr.hir_id && lit_val - 1 == max) {\n+        return false;\n+    };\n+    let Ok(start) = cx.sess().source_map().span_to_snippet(eps[0].span) else { return false };\n \n-                lint\n-            },\n-        );\n-    }\n-    overwritten\n+    cx.struct_span_lint(\n+        OVERFLOWING_LITERALS,\n+        struct_expr.span,\n+        fluent::lint::range_endpoint_out_of_range,\n+        |lint| {\n+            use ast::{LitIntType, LitKind};\n+\n+            lint.set_arg(\"ty\", ty);\n+\n+            // We need to preserve the literal's suffix,\n+            // as it may determine typing information.\n+            let suffix = match lit.node {\n+                LitKind::Int(_, LitIntType::Signed(s)) => s.name_str(),\n+                LitKind::Int(_, LitIntType::Unsigned(s)) => s.name_str(),\n+                LitKind::Int(_, LitIntType::Unsuffixed) => \"\",\n+                _ => bug!(),\n+            };\n+            let suggestion = format!(\"{}..={}{}\", start, lit_val - 1, suffix);\n+            lint.span_suggestion(\n+                struct_expr.span,\n+                fluent::lint::suggestion,\n+                suggestion,\n+                Applicability::MachineApplicable,\n+            );\n+\n+            lint\n+        },\n+    );\n+\n+    // We've just emitted a lint, special cased for `(...)..MAX+1` ranges,\n+    // return `true` so the callers don't also emit a lint\n+    true\n }\n \n // For `isize` & `usize`, be conservative with the warnings, so that the\n@@ -358,7 +360,7 @@ fn lint_int_literal<'tcx>(\n         }\n \n         if lint_overflowing_range_endpoint(cx, lit, v, max, e, t.name_str()) {\n-            // The overflowing literal lint was overridden.\n+            // The overflowing literal lint was emited by `lint_overflowing_range_endpoint`.\n             return;\n         }\n \n@@ -427,7 +429,7 @@ fn lint_uint_literal<'tcx>(\n             }\n         }\n         if lint_overflowing_range_endpoint(cx, lit, lit_val, max, e, t.name_str()) {\n-            // The overflowing literal lint was overridden.\n+            // The overflowing literal lint was emited by `lint_overflowing_range_endpoint`.\n             return;\n         }\n         if let Some(repr_str) = get_bin_hex_repr(cx, lit) {"}]}