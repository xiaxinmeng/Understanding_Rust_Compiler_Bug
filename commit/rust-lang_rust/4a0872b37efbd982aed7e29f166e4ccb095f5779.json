{"sha": "4a0872b37efbd982aed7e29f166e4ccb095f5779", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhMDg3MmIzN2VmYmQ5ODJhZWQ3ZTI5ZjE2NmU0Y2NiMDk1ZjU3Nzk=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-09-01T17:18:16Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-09-01T17:18:16Z"}, "message": "Add `overflow_check` check", "tree": {"sha": "9382dc41f3e20f26cf4bf62848d34dd24d0db8d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9382dc41f3e20f26cf4bf62848d34dd24d0db8d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a0872b37efbd982aed7e29f166e4ccb095f5779", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a0872b37efbd982aed7e29f166e4ccb095f5779", "html_url": "https://github.com/rust-lang/rust/commit/4a0872b37efbd982aed7e29f166e4ccb095f5779", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a0872b37efbd982aed7e29f166e4ccb095f5779/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a6aadaa8c915c3dea42c0b1fb6d96f227166148", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a6aadaa8c915c3dea42c0b1fb6d96f227166148", "html_url": "https://github.com/rust-lang/rust/commit/3a6aadaa8c915c3dea42c0b1fb6d96f227166148"}], "stats": {"total": 14, "additions": 6, "deletions": 8}, "files": [{"sha": "b43323687cda32b58d7b6f01dcd7630e4e96d33a", "filename": "src/librustc_mir/transform/const_prop.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4a0872b37efbd982aed7e29f166e4ccb095f5779/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a0872b37efbd982aed7e29f166e4ccb095f5779/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs?ref=4a0872b37efbd982aed7e29f166e4ccb095f5779", "patch": "@@ -405,11 +405,13 @@ impl<'mir, 'tcx> ConstPropagator<'mir, 'tcx> {\n                 }\n \n                 let arg = self.eval_operand(arg, source_info)?;\n-                let is_release_mode = self.tcx.sess.opts.debugging_opts.mir_opt_level >= 2;\n+                let is_release_mode = self.tcx.sess.overflow_checks();\n                 let val = self.use_ecx(source_info, |this| {\n                     let prim = this.ecx.read_immediate(arg)?;\n                     match op {\n                         UnOp::Neg => {\n+                            // We don't have to check overflow here when we already\n+                            // check it in release mode.\n                             if is_release_mode\n                             && prim.to_bits()? == (1 << (prim.layout.size.bits() - 1)) {\n                                 throw_panic!(OverflowNeg)\n@@ -485,7 +487,9 @@ impl<'mir, 'tcx> ConstPropagator<'mir, 'tcx> {\n                         Scalar::from_bool(overflow).into(),\n                     )\n                 } else {\n-                    if self.tcx.sess.opts.debugging_opts.mir_opt_level >= 2 && overflow {\n+                    // We don't have to check overflow here when we already\n+                    // check it in release mode.\n+                    if self.tcx.sess.overflow_checks() && overflow {\n                         let err = err_panic!(Overflow(op)).into();\n                         let _: Option<()> = self.use_ecx(source_info, |_| Err(err));\n                         return None;"}, {"sha": "5160c9e72a9c4587d0d3fc67773e4e98dfb605c7", "filename": "src/test/ui/issues/issue-8171-default-method-self-inherit-builtin-trait.stderr", "status": "removed", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3a6aadaa8c915c3dea42c0b1fb6d96f227166148/src%2Ftest%2Fui%2Fissues%2Fissue-8171-default-method-self-inherit-builtin-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3a6aadaa8c915c3dea42c0b1fb6d96f227166148/src%2Ftest%2Fui%2Fissues%2Fissue-8171-default-method-self-inherit-builtin-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-8171-default-method-self-inherit-builtin-trait.stderr?ref=3a6aadaa8c915c3dea42c0b1fb6d96f227166148", "patch": "@@ -1,6 +0,0 @@\n-error: failed to remove $TEST_BUILD_DIR/issues/issue-8171-default-method-self-inherit-builtin-trait/issue-8171-default-method-self-inherit-builtin-trait.issue_8171_default_method_self_inherit_builtin_trait.7rcbfp3g-cgu.0.rcgu.o: \u6307\u5b9a\u3055\u308c\u305f\u30d1\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002 (os error 3)\n-\n-error: failed to remove $TEST_BUILD_DIR/issues/issue-8171-default-method-self-inherit-builtin-trait/issue-8171-default-method-self-inherit-builtin-trait.issue_8171_default_method_self_inherit_builtin_trait.7rcbfp3g-cgu.1.rcgu.o: \u6307\u5b9a\u3055\u308c\u305f\u30d1\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002 (os error 3)\n-\n-error: aborting due to 2 previous errors\n-"}]}