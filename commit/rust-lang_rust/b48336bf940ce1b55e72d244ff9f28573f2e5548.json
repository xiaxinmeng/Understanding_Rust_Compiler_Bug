{"sha": "b48336bf940ce1b55e72d244ff9f28573f2e5548", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0ODMzNmJmOTQwY2UxYjU1ZTcyZDI0NGZmOWYyODU3M2YyZTU1NDg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-21T13:12:12Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-21T13:12:12Z"}, "message": "Replace OUT_DIR in project.json with general env\n\nOUT_DIR doesn't make sense here, as this is a cargo-specific concept", "tree": {"sha": "da5fd9e13669d6f9a59baf6ed678c8b807d2c67e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da5fd9e13669d6f9a59baf6ed678c8b807d2c67e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b48336bf940ce1b55e72d244ff9f28573f2e5548", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b48336bf940ce1b55e72d244ff9f28573f2e5548", "html_url": "https://github.com/rust-lang/rust/commit/b48336bf940ce1b55e72d244ff9f28573f2e5548", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b48336bf940ce1b55e72d244ff9f28573f2e5548/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe87aec7b61c7cf4c62162f257655507c4fd9422", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe87aec7b61c7cf4c62162f257655507c4fd9422", "html_url": "https://github.com/rust-lang/rust/commit/fe87aec7b61c7cf4c62162f257655507c4fd9422"}], "stats": {"total": 16, "additions": 7, "deletions": 9}, "files": [{"sha": "2bb156610537d44800dd9e703bc94f4633788c42", "filename": "crates/ra_project_model/src/lib.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b48336bf940ce1b55e72d244ff9f28573f2e5548/crates%2Fra_project_model%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b48336bf940ce1b55e72d244ff9f28573f2e5548/crates%2Fra_project_model%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Flib.rs?ref=b48336bf940ce1b55e72d244ff9f28573f2e5548", "patch": "@@ -259,11 +259,8 @@ impl ProjectWorkspace {\n                         let file_id = load(&file_path)?;\n \n                         let mut env = Env::default();\n-                        if let Some(out_dir) = &krate.out_dir {\n-                            // NOTE: cargo and rustc seem to hide non-UTF-8 strings from env! and option_env!()\n-                            if let Some(out_dir) = out_dir.to_str().map(|s| s.to_owned()) {\n-                                env.set(\"OUT_DIR\", out_dir);\n-                            }\n+                        for (k, v) in &krate.env {\n+                            env.set(k, v.clone());\n                         }\n                         let proc_macro = krate\n                             .proc_macro_dylib_path"}, {"sha": "e9a3331913e00e7d1315c5d2b7705bb90bc7c1d2", "filename": "crates/ra_project_model/src/project_json.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b48336bf940ce1b55e72d244ff9f28573f2e5548/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b48336bf940ce1b55e72d244ff9f28573f2e5548/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs?ref=b48336bf940ce1b55e72d244ff9f28573f2e5548", "patch": "@@ -5,7 +5,7 @@ use std::path::PathBuf;\n use paths::{AbsPath, AbsPathBuf};\n use ra_cfg::CfgOptions;\n use ra_db::{CrateId, CrateName, Dependency, Edition};\n-use rustc_hash::FxHashSet;\n+use rustc_hash::{FxHashMap, FxHashSet};\n use serde::{de, Deserialize};\n use stdx::split_delim;\n \n@@ -24,7 +24,7 @@ pub struct Crate {\n     pub(crate) deps: Vec<Dependency>,\n     pub(crate) cfg: CfgOptions,\n     pub(crate) target: Option<String>,\n-    pub(crate) out_dir: Option<AbsPathBuf>,\n+    pub(crate) env: FxHashMap<String, String>,\n     pub(crate) proc_macro_dylib_path: Option<AbsPathBuf>,\n     pub(crate) is_workspace_member: bool,\n     pub(crate) include: Vec<AbsPathBuf>,\n@@ -78,7 +78,7 @@ impl ProjectJson {\n                             cfg\n                         },\n                         target: crate_data.target,\n-                        out_dir: crate_data.out_dir.map(|it| base.join(it)),\n+                        env: crate_data.env,\n                         proc_macro_dylib_path: crate_data\n                             .proc_macro_dylib_path\n                             .map(|it| base.join(it)),\n@@ -105,7 +105,8 @@ struct CrateData {\n     #[serde(default)]\n     cfg: FxHashSet<String>,\n     target: Option<String>,\n-    out_dir: Option<PathBuf>,\n+    #[serde(default)]\n+    env: FxHashMap<String, String>,\n     proc_macro_dylib_path: Option<PathBuf>,\n     is_workspace_member: Option<bool>,\n     source: Option<CrateSource>,"}]}