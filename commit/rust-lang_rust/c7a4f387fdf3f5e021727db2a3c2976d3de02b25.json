{"sha": "c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "node_id": "C_kwDOAAsO6NoAKGM3YTRmMzg3ZmRmM2Y1ZTAyMTcyN2RiMmEzYzI5NzZkM2RlMDJiMjU", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-02-21T16:11:48Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-02-22T15:27:19Z"}, "message": "Lint dead code in closures", "tree": {"sha": "7f884169695e0f490f70cb41f2a00d1185e1108a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f884169695e0f490f70cb41f2a00d1185e1108a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "html_url": "https://github.com/rust-lang/rust/commit/c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bda32a4023b1d3f96e56e1b2fc7510324f430316", "url": "https://api.github.com/repos/rust-lang/rust/commits/bda32a4023b1d3f96e56e1b2fc7510324f430316", "html_url": "https://github.com/rust-lang/rust/commit/bda32a4023b1d3f96e56e1b2fc7510324f430316"}], "stats": {"total": 39, "additions": 39, "deletions": 0}, "files": [{"sha": "cfc91d636a7d7bd6e0c3f4ad26de8b2a9b328914", "filename": "compiler/rustc_passes/src/dead.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fdead.rs?ref=c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "patch": "@@ -395,6 +395,9 @@ impl<'tcx> Visitor<'tcx> for MarkSymbolVisitor<'tcx> {\n                     self.mark_as_used_if_union(*adt, fields);\n                 }\n             }\n+            hir::ExprKind::Closure(cls) => {\n+                self.insert_def_id(cls.def_id.to_def_id());\n+            }\n             _ => (),\n         }\n "}, {"sha": "c55634405ed7ba5adcb5bbd63f9bf422ed9e5c7f", "filename": "tests/ui/lint/dead-code/in-closure.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.rs?ref=c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "patch": "@@ -0,0 +1,16 @@\n+// edition: 2021\n+\n+#![deny(dead_code)]\n+\n+pub fn foo() {\n+    let closure = || {\n+        fn a() {}   //~ ERROR function `a` is never used\n+    };\n+    closure()\n+}\n+\n+pub async fn async_foo() {\n+    const A: usize = 1; //~ ERROR constant `A` is never used\n+}\n+\n+fn main() {}"}, {"sha": "deb276be7027c32c6b78fa173141fd075cc7a3fe", "filename": "tests/ui/lint/dead-code/in-closure.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c7a4f387fdf3f5e021727db2a3c2976d3de02b25/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fdead-code%2Fin-closure.stderr?ref=c7a4f387fdf3f5e021727db2a3c2976d3de02b25", "patch": "@@ -0,0 +1,20 @@\n+error: function `a` is never used\n+  --> $DIR/in-closure.rs:7:12\n+   |\n+LL |         fn a() {}\n+   |            ^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/in-closure.rs:3:9\n+   |\n+LL | #![deny(dead_code)]\n+   |         ^^^^^^^^^\n+\n+error: constant `A` is never used\n+  --> $DIR/in-closure.rs:13:11\n+   |\n+LL |     const A: usize = 1;\n+   |           ^\n+\n+error: aborting due to 2 previous errors\n+"}]}