{"sha": "91b4a24219f33b7ad28b5ba147d50bc160c6f56c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxYjRhMjQyMTlmMzNiN2FkMjhiNWJhMTQ3ZDUwYmMxNjBjNmY1NmM=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-02-13T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-02-13T00:00:00Z"}, "message": "Enable use after scope detection in the new LLVM pass manager\n\nImplementation of 08a1c566a792dcf9657d293155f7ada87746bb65 for the new\nLLVM pass manager, support for which landed in the meantime.", "tree": {"sha": "81b2726496257baeea1bf37bfd28c982056916c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81b2726496257baeea1bf37bfd28c982056916c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91b4a24219f33b7ad28b5ba147d50bc160c6f56c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91b4a24219f33b7ad28b5ba147d50bc160c6f56c", "html_url": "https://github.com/rust-lang/rust/commit/91b4a24219f33b7ad28b5ba147d50bc160c6f56c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91b4a24219f33b7ad28b5ba147d50bc160c6f56c/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e6eaceedeeda764056eb0e2134735793533770d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e6eaceedeeda764056eb0e2134735793533770d", "html_url": "https://github.com/rust-lang/rust/commit/2e6eaceedeeda764056eb0e2134735793533770d"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "8cebcaccfaad77568ac5ad2776998b556365c71e", "filename": "src/rustllvm/PassWrapper.cpp", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/91b4a24219f33b7ad28b5ba147d50bc160c6f56c/src%2Frustllvm%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/91b4a24219f33b7ad28b5ba147d50bc160c6f56c/src%2Frustllvm%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FPassWrapper.cpp?ref=91b4a24219f33b7ad28b5ba147d50bc160c6f56c", "patch": "@@ -761,14 +761,14 @@ LLVMRustOptimizeWithNewPassManager(\n     }\n \n     if (SanitizerOptions->SanitizeAddress) {\n-      // FIXME: Rust does not expose the UseAfterScope option.\n       PipelineStartEPCallbacks.push_back([&](ModulePassManager &MPM) {\n         MPM.addPass(RequireAnalysisPass<ASanGlobalsMetadataAnalysis, Module>());\n       });\n       OptimizerLastEPCallbacks.push_back(\n         [SanitizerOptions](FunctionPassManager &FPM, PassBuilder::OptimizationLevel Level) {\n           FPM.addPass(AddressSanitizerPass(\n-              /*CompileKernel=*/false, SanitizerOptions->SanitizeRecover));\n+              /*CompileKernel=*/false, SanitizerOptions->SanitizeRecover,\n+              /*UseAfterScope=*/true));\n         }\n       );\n       PipelineStartEPCallbacks.push_back("}]}