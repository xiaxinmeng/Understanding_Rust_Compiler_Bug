{"sha": "f4301a26beb78596b3a877fc36ca76fbd427e33c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0MzAxYTI2YmViNzg1OTZiM2E4NzdmYzM2Y2E3NmZiZDQyN2UzM2M=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-28T14:58:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-28T14:58:19Z"}, "message": "Rollup merge of #79344 - JRF63:fix_install_script_win, r=Mark-Simulacrum\n\nConvert UNC path to local path to satisfy install script on Windows\n\n`mkdir` with the `-p` flag attempts to create `//?` if passed a UNC path. This fails on both MSYS2 and Git Bash.\n\nThe UNC paths come from [canonicalizing](https://github.com/rust-lang/rust/blob/32da90b431919eedb3e281a91caea063ba4edb77/src/bootstrap/install.rs#L79) the install prefix path. `mkdir -p` gets invoked on the [install script](https://github.com/rust-lang/rust-installer/blob/d66f476b4d5e7fdf1ec215c9ac16c923dc292324/install-template.sh#L149).", "tree": {"sha": "235b8e512246edb3b531131a7128af11fd60ea36", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/235b8e512246edb3b531131a7128af11fd60ea36"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4301a26beb78596b3a877fc36ca76fbd427e33c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfwmWLCRBK7hj4Ov3rIwAAdHIIAKigI5feRAP8UotnRCUZVtiq\n6Ycg19aw0aqJCztHA965xNLMj2Nwxj8BoO+thW9usaxIEObtTqVVLDThs6YTciEA\n3vV8wIUCZ8gm+VUubBB2ezXGGcPdU08iIjZl+PiOAoMOQJFXhNF8ze4iLNvJ8dXG\nfkmMJ0pXod0Ei8gWeyPK7qiWBpw2MJJutv/7vpuvLltILUd9qsA1sn4Pj1CF1nvX\ng7WuslwgRw5kE+RGPI9LFS5peRM2o9gpct5BZ8hFk6PGtrEnaGMz63ndVfbyys2+\nNGZynwprJyYx4JYMxM3SEByEqwBvP8ga20ZC6EyzR61IJQAtybqeFUNi5RLtdYw=\n=Yuj+\n-----END PGP SIGNATURE-----\n", "payload": "tree 235b8e512246edb3b531131a7128af11fd60ea36\nparent 93d830ed50ada43ce3c7561d6f98dd3630a11cf9\nparent 6b47920c69fa048331aeb46612b158ded7c6e12e\nauthor Jonas Schievink <jonasschievink@gmail.com> 1606575499 +0100\ncommitter GitHub <noreply@github.com> 1606575499 +0100\n\nRollup merge of #79344 - JRF63:fix_install_script_win, r=Mark-Simulacrum\n\nConvert UNC path to local path to satisfy install script on Windows\n\n`mkdir` with the `-p` flag attempts to create `//?` if passed a UNC path. This fails on both MSYS2 and Git Bash.\n\nThe UNC paths come from [canonicalizing](https://github.com/rust-lang/rust/blob/32da90b431919eedb3e281a91caea063ba4edb77/src/bootstrap/install.rs#L79) the install prefix path. `mkdir -p` gets invoked on the [install script](https://github.com/rust-lang/rust-installer/blob/d66f476b4d5e7fdf1ec215c9ac16c923dc292324/install-template.sh#L149).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4301a26beb78596b3a877fc36ca76fbd427e33c", "html_url": "https://github.com/rust-lang/rust/commit/f4301a26beb78596b3a877fc36ca76fbd427e33c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4301a26beb78596b3a877fc36ca76fbd427e33c/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93d830ed50ada43ce3c7561d6f98dd3630a11cf9", "url": "https://api.github.com/repos/rust-lang/rust/commits/93d830ed50ada43ce3c7561d6f98dd3630a11cf9", "html_url": "https://github.com/rust-lang/rust/commit/93d830ed50ada43ce3c7561d6f98dd3630a11cf9"}, {"sha": "6b47920c69fa048331aeb46612b158ded7c6e12e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b47920c69fa048331aeb46612b158ded7c6e12e", "html_url": "https://github.com/rust-lang/rust/commit/6b47920c69fa048331aeb46612b158ded7c6e12e"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "354be109cf2f1b67f6f7344a82b07d0b86f99e95", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f4301a26beb78596b3a877fc36ca76fbd427e33c/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4301a26beb78596b3a877fc36ca76fbd427e33c/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=f4301a26beb78596b3a877fc36ca76fbd427e33c", "patch": "@@ -1183,7 +1183,11 @@ impl Step for PlainSourceTarball {\n // characters and on `C:\\` paths, so normalize both of them away.\n pub fn sanitize_sh(path: &Path) -> String {\n     let path = path.to_str().unwrap().replace(\"\\\\\", \"/\");\n-    return change_drive(&path).unwrap_or(path);\n+    return change_drive(unc_to_lfs(&path)).unwrap_or(path);\n+\n+    fn unc_to_lfs(s: &str) -> &str {\n+        if s.starts_with(\"//?/\") { &s[4..] } else { s }\n+    }\n \n     fn change_drive(s: &str) -> Option<String> {\n         let mut ch = s.chars();"}]}