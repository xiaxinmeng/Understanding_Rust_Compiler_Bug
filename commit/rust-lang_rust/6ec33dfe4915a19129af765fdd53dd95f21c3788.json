{"sha": "6ec33dfe4915a19129af765fdd53dd95f21c3788", "node_id": "C_kwDOAAsO6NoAKDZlYzMzZGZlNDkxNWExOTEyOWFmNzY1ZmRkNTNkZDk1ZjIxYzM3ODg", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-02-13T09:54:07Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-04-23T07:57:00Z"}, "message": "Drop vis in ImplItem.", "tree": {"sha": "d069640013b3888356e6b9e11457bc00f117ae99", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d069640013b3888356e6b9e11457bc00f117ae99"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ec33dfe4915a19129af765fdd53dd95f21c3788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ec33dfe4915a19129af765fdd53dd95f21c3788", "html_url": "https://github.com/rust-lang/rust/commit/6ec33dfe4915a19129af765fdd53dd95f21c3788", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ec33dfe4915a19129af765fdd53dd95f21c3788/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "abc8eb71e6489b7677da54d082871ff498c6c91f", "url": "https://api.github.com/repos/rust-lang/rust/commits/abc8eb71e6489b7677da54d082871ff498c6c91f", "html_url": "https://github.com/rust-lang/rust/commit/abc8eb71e6489b7677da54d082871ff498c6c91f"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "dd94a8d64901773f951babdd53060c42d83571c2", "filename": "clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6ec33dfe4915a19129af765fdd53dd95f21c3788/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ec33dfe4915a19129af765fdd53dd95f21c3788/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=6ec33dfe4915a19129af765fdd53dd95f21c3788", "patch": "@@ -4,6 +4,7 @@ use clippy_utils::get_attr;\n use rustc_ast::ast::{Attribute, InlineAsmTemplatePiece};\n use rustc_hir as hir;\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n+use rustc_middle::ty;\n use rustc_session::Session;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -45,14 +46,10 @@ impl<'tcx> LateLintPass<'tcx> for DeepCodeInspector {\n             return;\n         }\n         println!(\"impl item `{}`\", item.ident.name);\n-        match item.vis.node {\n-            hir::VisibilityKind::Public => println!(\"public\"),\n-            hir::VisibilityKind::Crate(_) => println!(\"visible crate wide\"),\n-            hir::VisibilityKind::Restricted { path, .. } => println!(\n-                \"visible in module `{}`\",\n-                rustc_hir_pretty::to_string(rustc_hir_pretty::NO_ANN, |s| s.print_path(path, false))\n-            ),\n-            hir::VisibilityKind::Inherited => println!(\"visibility inherited from outer item\"),\n+        match cx.tcx.visibility(item.def_id) {\n+            ty::Visibility::Public => println!(\"public\"),\n+            ty::Visibility::Restricted(def_id) => println!(\"visible in module `{}`\", cx.tcx.def_path_str(def_id)),\n+            ty::Visibility::Invisible => println!(\"invisible\"),\n         }\n         match item.kind {\n             hir::ImplItemKind::Const(_, body_id) => {"}]}