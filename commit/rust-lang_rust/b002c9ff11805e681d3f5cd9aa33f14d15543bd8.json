{"sha": "b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "node_id": "C_kwDOAAsO6NoAKGIwMDJjOWZmMTE4MDVlNjgxZDNmNWNkOWFhMzNmMTRkMTU1NDNiZDg", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2023-05-07T22:49:50Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2023-06-03T01:22:47Z"}, "message": "remove type ascription feature gate", "tree": {"sha": "a0f3a5a9100cfdb8f6b61767fcd26cc654cc1e90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0f3a5a9100cfdb8f6b61767fcd26cc654cc1e90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "html_url": "https://github.com/rust-lang/rust/commit/b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd5d7c729d4e8a59708df64002e09dbcbc4005ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd5d7c729d4e8a59708df64002e09dbcbc4005ba", "html_url": "https://github.com/rust-lang/rust/commit/dd5d7c729d4e8a59708df64002e09dbcbc4005ba"}], "stats": {"total": 45, "additions": 5, "deletions": 40}, "files": [{"sha": "a6fd3b5c9431046bdaa14f6ad226b6301166b241", "filename": "compiler/rustc_ast_passes/src/feature_gate.rs", "status": "modified", "additions": 2, "deletions": 33, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs?ref=b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "patch": "@@ -2,7 +2,7 @@ use rustc_ast as ast;\n use rustc_ast::visit::{self, AssocCtxt, FnCtxt, FnKind, Visitor};\n use rustc_ast::{attr, AssocConstraint, AssocConstraintKind, NodeId};\n use rustc_ast::{PatKind, RangeEnd};\n-use rustc_errors::{Applicability, StashKey};\n+use rustc_errors::StashKey;\n use rustc_feature::{AttributeGate, BuiltinAttribute, Features, GateIssue, BUILTIN_ATTRIBUTE_MAP};\n use rustc_session::parse::{feature_err, feature_err_issue, feature_warn};\n use rustc_session::Session;\n@@ -375,43 +375,13 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n     }\n \n     fn visit_stmt(&mut self, stmt: &'a ast::Stmt) {\n-        if let ast::StmtKind::Semi(expr) = &stmt.kind\n-            && let ast::ExprKind::Assign(lhs, _, _) = &expr.kind\n-            && let ast::ExprKind::Type(..) = lhs.kind\n-            && self.sess.parse_sess.span_diagnostic.err_count() == 0\n-            && !self.features.type_ascription\n-            && !lhs.span.allows_unstable(sym::type_ascription)\n-        {\n-            // When we encounter a statement of the form `foo: Ty = val;`, this will emit a type\n-            // ascription error, but the likely intention was to write a `let` statement. (#78907).\n-            feature_err(\n-                &self.sess.parse_sess,\n-                sym::type_ascription,\n-                lhs.span,\n-                \"type ascription is experimental\",\n-            ).span_suggestion_verbose(\n-                lhs.span.shrink_to_lo(),\n-                \"you might have meant to introduce a new binding\",\n-                \"let \",\n-                Applicability::MachineApplicable,\n-            ).emit();\n-        }\n         visit::walk_stmt(self, stmt);\n     }\n \n     fn visit_expr(&mut self, e: &'a ast::Expr) {\n         match e.kind {\n             ast::ExprKind::Type(..) => {\n-                if self.sess.parse_sess.span_diagnostic.err_count() == 0 {\n-                    // To avoid noise about type ascription in common syntax errors,\n-                    // only emit if it is the *only* error.\n-                    gate_feature_post!(\n-                        &self,\n-                        type_ascription,\n-                        e.span,\n-                        \"type ascription is experimental\"\n-                    );\n-                } else {\n+                if self.sess.parse_sess.span_diagnostic.err_count() > 0 {\n                     // And if it isn't, cancel the early-pass warning.\n                     if let Some(err) = self\n                         .sess\n@@ -629,7 +599,6 @@ pub fn check_crate(krate: &ast::Crate, sess: &Session) {\n     gate_all!(box_patterns, \"box pattern syntax is experimental\");\n     gate_all!(exclusive_range_pattern, \"exclusive range pattern syntax is experimental\");\n     gate_all!(try_blocks, \"`try` blocks are unstable\");\n-    gate_all!(type_ascription, \"type ascription is experimental\");\n \n     visit::walk_crate(&mut visitor, krate);\n }"}, {"sha": "549662a72fa5e01b81d0b13fdbb6bca39ae23a79", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "patch": "@@ -534,8 +534,6 @@ declare_features! (\n     (active, try_blocks, \"1.29.0\", Some(31436), None),\n     /// Allows `impl Trait` to be used inside type aliases (RFC 2515).\n     (active, type_alias_impl_trait, \"1.38.0\", Some(63063), None),\n-    /// Allows the use of type ascription in expressions.\n-    (active, type_ascription, \"1.6.0\", Some(23416), None),\n     /// Allows creation of instances of a struct by moving fields that have\n     /// not changed from prior instances of the same struct (RFC #2528)\n     (active, type_changing_struct_update, \"1.58.0\", Some(86555), None),"}, {"sha": "7a1e830073a721711a0294fe81c1ce5e7011314f", "filename": "compiler/rustc_hir_typeck/src/cast.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_hir_typeck%2Fsrc%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/compiler%2Frustc_hir_typeck%2Fsrc%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fcast.rs?ref=b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "patch": "@@ -689,8 +689,6 @@ impl<'a, 'tcx> CastCheck<'tcx> {\n     fn trivial_cast_lint(&self, fcx: &FnCtxt<'a, 'tcx>) {\n         let t_cast = self.cast_ty;\n         let t_expr = self.expr_ty;\n-        let type_asc_or =\n-            if fcx.tcx.features().type_ascription { \"type ascription or \" } else { \"\" };\n         let (adjective, lint) = if t_cast.is_numeric() && t_expr.is_numeric() {\n             (\"numeric \", lint::builtin::TRIVIAL_NUMERIC_CASTS)\n         } else {\n@@ -711,7 +709,7 @@ impl<'a, 'tcx> CastCheck<'tcx> {\n             |lint| {\n                 lint.help(format!(\n                     \"cast can be replaced by coercion; this might \\\n-                     require {type_asc_or}a temporary variable\"\n+                     require a temporary variable\"\n                 ))\n             },\n         );"}, {"sha": "159a54873cc7021c9c1358508124419c8f8334e4", "filename": "tests/ui/lint/trivial-casts-featuring-type-ascription.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/tests%2Fui%2Flint%2Ftrivial-casts-featuring-type-ascription.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b002c9ff11805e681d3f5cd9aa33f14d15543bd8/tests%2Fui%2Flint%2Ftrivial-casts-featuring-type-ascription.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Ftrivial-casts-featuring-type-ascription.stderr?ref=b002c9ff11805e681d3f5cd9aa33f14d15543bd8", "patch": "@@ -4,7 +4,7 @@ error: trivial numeric cast: `i32` as `i32`\n LL |     let lugubrious = 12i32 as i32;\n    |                      ^^^^^^^^^^^^\n    |\n-   = help: cast can be replaced by coercion; this might require type ascription or a temporary variable\n+   = help: cast can be replaced by coercion; this might require a temporary variable\n note: the lint level is defined here\n   --> $DIR/trivial-casts-featuring-type-ascription.rs:1:24\n    |\n@@ -17,7 +17,7 @@ error: trivial cast: `&u32` as `*const u32`\n LL |     let _ = haunted as *const u32;\n    |             ^^^^^^^^^^^^^^^^^^^^^\n    |\n-   = help: cast can be replaced by coercion; this might require type ascription or a temporary variable\n+   = help: cast can be replaced by coercion; this might require a temporary variable\n note: the lint level is defined here\n   --> $DIR/trivial-casts-featuring-type-ascription.rs:1:9\n    |"}]}