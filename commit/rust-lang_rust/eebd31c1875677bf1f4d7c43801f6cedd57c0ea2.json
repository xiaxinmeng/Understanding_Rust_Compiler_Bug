{"sha": "eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "node_id": "C_kwDOAAsO6NoAKGVlYmQzMWMxODc1Njc3YmYxZjRkN2M0MzgwMWY2Y2VkZDU3YzBlYTI", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-02-17T14:32:08Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-02-17T14:44:58Z"}, "message": "Don't eagerly convert principal to string", "tree": {"sha": "33cd4b7749ab8fd5ac0680afd0b236d47b5b9a2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33cd4b7749ab8fd5ac0680afd0b236d47b5b9a2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "html_url": "https://github.com/rust-lang/rust/commit/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5c8c329a7b4f6a12ae72ae41cb834989228221e", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5c8c329a7b4f6a12ae72ae41cb834989228221e", "html_url": "https://github.com/rust-lang/rust/commit/b5c8c329a7b4f6a12ae72ae41cb834989228221e"}], "stats": {"total": 28, "additions": 24, "deletions": 4}, "files": [{"sha": "ccf95992a6e6e63c44345c44b3172d0a69e06bce", "filename": "compiler/rustc_lint/src/deref_into_dyn_supertrait.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_lint%2Fsrc%2Fderef_into_dyn_supertrait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_lint%2Fsrc%2Fderef_into_dyn_supertrait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fderef_into_dyn_supertrait.rs?ref=eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "patch": "@@ -78,7 +78,7 @@ impl<'tcx> LateLintPass<'tcx> for DerefIntoDynSupertrait {\n             });\n             cx.emit_spanned_lint(DEREF_INTO_DYN_SUPERTRAIT, cx.tcx.def_span(item.owner_id.def_id), SupertraitAsDerefTarget {\n                 t,\n-                target_principal: target_principal.to_string(),\n+                target_principal,\n                 label,\n             });\n         }"}, {"sha": "94a43ab0c4674b11b510d2106a9cc2fcbb38c501", "filename": "compiler/rustc_lint/src/lints.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_lint%2Fsrc%2Flints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flints.rs?ref=eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "patch": "@@ -8,7 +8,7 @@ use rustc_errors::{\n };\n use rustc_hir::def_id::DefId;\n use rustc_macros::{LintDiagnostic, Subdiagnostic};\n-use rustc_middle::ty::{Predicate, Ty, TyCtxt};\n+use rustc_middle::ty::{PolyExistentialTraitRef, Predicate, Ty, TyCtxt};\n use rustc_session::parse::ParseSess;\n use rustc_span::{edition::Edition, sym, symbol::Ident, Span, Symbol};\n \n@@ -556,8 +556,7 @@ pub struct BuiltinUnexpectedCliConfigValue {\n #[diag(lint_supertrait_as_deref_target)]\n pub struct SupertraitAsDerefTarget<'a> {\n     pub t: Ty<'a>,\n-    pub target_principal: String,\n-    // pub target_principal: Binder<'a, ExistentialTraitRef<'b>>,\n+    pub target_principal: PolyExistentialTraitRef<'a>,\n     #[subdiagnostic]\n     pub label: Option<SupertraitAsDerefTargetLabel>,\n }"}, {"sha": "f8d17433cf7701e1f7da8c3bb736a9dac7cbf529", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "patch": "@@ -933,6 +933,12 @@ impl<'tcx> PolyExistentialTraitRef<'tcx> {\n     }\n }\n \n+impl rustc_errors::IntoDiagnosticArg for PolyExistentialTraitRef<'_> {\n+    fn into_diagnostic_arg(self) -> rustc_errors::DiagnosticArgValue<'static> {\n+        self.to_string().into_diagnostic_arg()\n+    }\n+}\n+\n #[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, Hash, Debug, TyEncodable, TyDecodable)]\n #[derive(HashStable)]\n pub enum BoundVariableKind {"}, {"sha": "4ae0cbd92ff162e724540806057ff930d3f0b9ab", "filename": "tests/ui/lint/issue-108155.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/tests%2Fui%2Flint%2Fissue-108155.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eebd31c1875677bf1f4d7c43801f6cedd57c0ea2/tests%2Fui%2Flint%2Fissue-108155.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Fissue-108155.rs?ref=eebd31c1875677bf1f4d7c43801f6cedd57c0ea2", "patch": "@@ -0,0 +1,15 @@\n+// check-pass\n+// check that `deref_into_dyn_supertrait` doesn't cause ICE by eagerly converting\n+// a cancelled lint\n+\n+#![allow(deref_into_dyn_supertrait)]\n+\n+trait Trait {}\n+impl std::ops::Deref for dyn Trait + Send + Sync {\n+    type Target = dyn Trait;\n+    fn deref(&self) -> &Self::Target {\n+        self\n+    }\n+}\n+\n+fn main() {}"}]}