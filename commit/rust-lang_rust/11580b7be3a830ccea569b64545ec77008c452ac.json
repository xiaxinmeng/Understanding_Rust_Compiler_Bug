{"sha": "11580b7be3a830ccea569b64545ec77008c452ac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNTgwYjdiZTNhODMwY2NlYTU2OWI2NDU0NWVjNzcwMDhjNDUyYWM=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T01:15:34Z"}, "committer": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2018-02-11T01:15:34Z"}, "message": "Make exclude and paths relative to root of checkout", "tree": {"sha": "d13b4230efb0b7da1a5bd26f6c6f49cc8bc5bcef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d13b4230efb0b7da1a5bd26f6c6f49cc8bc5bcef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11580b7be3a830ccea569b64545ec77008c452ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11580b7be3a830ccea569b64545ec77008c452ac", "html_url": "https://github.com/rust-lang/rust/commit/11580b7be3a830ccea569b64545ec77008c452ac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11580b7be3a830ccea569b64545ec77008c452ac/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c506f9dae5664fb04bf070f1422df5308d90cb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c506f9dae5664fb04bf070f1422df5308d90cb6", "html_url": "https://github.com/rust-lang/rust/commit/8c506f9dae5664fb04bf070f1422df5308d90cb6"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "8a38fedc6136d736d4f86e88848e151998a03f19", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/11580b7be3a830ccea569b64545ec77008c452ac/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11580b7be3a830ccea569b64545ec77008c452ac/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=11580b7be3a830ccea569b64545ec77008c452ac", "patch": "@@ -275,7 +275,12 @@ Arguments:\n         };\n         // Get any optional paths which occur after the subcommand\n         let cwd = t!(env::current_dir());\n-        let paths = matches.free[1..].iter().map(|p| cwd.join(p)).collect::<Vec<_>>();\n+        let src = matches.opt_str(\"src\").map(PathBuf::from)\n+            .or_else(|| env::var_os(\"SRC\").map(PathBuf::from))\n+            .unwrap_or(cwd.clone());\n+        let paths = matches.free[1..].iter().map(|p| {\n+            cwd.join(p).strip_prefix(&src).expect(\"paths passed to be inside checkout\").into()\n+        }).collect::<Vec<PathBuf>>();\n \n         let cfg_file = matches.opt_str(\"config\").map(PathBuf::from).or_else(|| {\n             if fs::metadata(\"config.toml\").is_ok() {\n@@ -360,10 +365,6 @@ Arguments:\n             stage = Some(1);\n         }\n \n-        let src = matches.opt_str(\"src\").map(PathBuf::from)\n-            .or_else(|| env::var_os(\"SRC\").map(PathBuf::from))\n-            .unwrap_or(cwd.clone());\n-\n         Flags {\n             verbose: matches.opt_count(\"verbose\"),\n             stage,\n@@ -375,12 +376,14 @@ Arguments:\n             target: split(matches.opt_strs(\"target\"))\n                 .into_iter().map(|x| INTERNER.intern_string(x)).collect::<Vec<_>>(),\n             config: cfg_file,\n-            src,\n             jobs: matches.opt_str(\"jobs\").map(|j| j.parse().unwrap()),\n             cmd,\n             incremental: matches.opt_present(\"incremental\"),\n             exclude: split(matches.opt_strs(\"exclude\"))\n-                .into_iter().map(|p| cwd.join(p)).collect::<Vec<_>>(),\n+                .into_iter().map(|p| {\n+                    cwd.join(p).strip_prefix(&src).expect(\"paths to be inside checkout\").into()\n+                }).collect::<Vec<_>>(),\n+            src,\n         }\n     }\n }"}]}