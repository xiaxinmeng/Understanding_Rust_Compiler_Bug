{"sha": "c0b2b15123e500e5af90138646f20024ca746f86", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwYjJiMTUxMjNlNTAwZTVhZjkwMTM4NjQ2ZjIwMDI0Y2E3NDZmODY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-24T18:53:08Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-24T18:53:27Z"}, "message": "Fix metrics", "tree": {"sha": "802deaf00f705e2370c238cfe92935e1100b0706", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/802deaf00f705e2370c238cfe92935e1100b0706"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0b2b15123e500e5af90138646f20024ca746f86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0b2b15123e500e5af90138646f20024ca746f86", "html_url": "https://github.com/rust-lang/rust/commit/c0b2b15123e500e5af90138646f20024ca746f86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0b2b15123e500e5af90138646f20024ca746f86/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc0c8b2882c7a0b00bc30e0c22040f7d4ba9f584", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc0c8b2882c7a0b00bc30e0c22040f7d4ba9f584", "html_url": "https://github.com/rust-lang/rust/commit/cc0c8b2882c7a0b00bc30e0c22040f7d4ba9f584"}], "stats": {"total": 22, "additions": 8, "deletions": 14}, "files": [{"sha": "ea780e8756e7c13cfa9adcafed4f9f26889f2375", "filename": ".github/workflows/metrics.yaml", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c0b2b15123e500e5af90138646f20024ca746f86/.github%2Fworkflows%2Fmetrics.yaml", "raw_url": "https://github.com/rust-lang/rust/raw/c0b2b15123e500e5af90138646f20024ca746f86/.github%2Fworkflows%2Fmetrics.yaml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmetrics.yaml?ref=c0b2b15123e500e5af90138646f20024ca746f86", "patch": "@@ -18,12 +18,6 @@ jobs:\n     - name: Checkout repository\n       uses: actions/checkout@v2\n \n-    - name: Checkout metrics repository\n-      uses: actions/checkout@v2\n-      with:\n-        repository: \"rust-analyzer/metrics\"\n-        path: \"target/metrics\"\n-\n     - name: Install Rust toolchain\n       uses: actions-rs/toolchain@v1\n       with:\n@@ -35,4 +29,4 @@ jobs:\n     - name: Collect metrics\n       run: cargo xtask metrics\n       env:\n-        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        METRICS_TOKEN: ${{ secrets.METRICS_TOKEN }}"}, {"sha": "bb3044f4111cc3e6a173ba2c8fafdb3ca072948f", "filename": "xtask/src/metrics.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c0b2b15123e500e5af90138646f20024ca746f86/xtask%2Fsrc%2Fmetrics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0b2b15123e500e5af90138646f20024ca746f86/xtask%2Fsrc%2Fmetrics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmetrics.rs?ref=c0b2b15123e500e5af90138646f20024ca746f86", "patch": "@@ -17,17 +17,17 @@ pub fn run_metrics() -> Result<()> {\n     metrics.measure_build()?;\n \n     {\n-        let _d = pushd(\"target/metrics\");\n+        let _d = pushd(\"target\");\n+        let api_token = env::var(\"METRICS_TOKEN\").unwrap();\n+        let repo = format!(\"https://{}@github.com/rust-analyzer/metrics.git\", api_token);\n+        run!(\"git clone --depth 1 {}\", repo)?;\n+        let _d = pushd(\"metrics\");\n+\n         let mut file = std::fs::OpenOptions::new().append(true).open(\"metrics.json\")?;\n         writeln!(file, \"{}\", metrics.json())?;\n         run!(\"git add .\")?;\n         run!(\"git -c user.name=Bot -c user.email=dummy@example.com commit --message \ud83d\udcc8\")?;\n-\n-        if let Ok(actor) = env::var(\"GITHUB_ACTOR\") {\n-            let token = env::var(\"GITHUB_TOKEN\").unwrap();\n-            let repo = format!(\"https://{}:{}@github.com/rust-analyzer/metrics.git\", actor, token);\n-            run!(\"git push {}\", repo)?;\n-        }\n+        run!(\"git push origin master\")?;\n     }\n     eprintln!(\"{:#?}\\n\", metrics);\n     eprintln!(\"{}\", metrics.json());"}]}