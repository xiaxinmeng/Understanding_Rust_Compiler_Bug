{"sha": "b172862d21f16095a5cf11a8938f3cea24e9bf58", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxNzI4NjJkMjFmMTYwOTVhNWNmMTFhODkzOGYzY2VhMjRlOWJmNTg=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-07-10T21:59:54Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-07-12T17:40:37Z"}, "message": "Add a ty_children function to enumerate the children of any type", "tree": {"sha": "076d2e3059506aaaa3c88dec13e542f506bdb9dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/076d2e3059506aaaa3c88dec13e542f506bdb9dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b172862d21f16095a5cf11a8938f3cea24e9bf58", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b172862d21f16095a5cf11a8938f3cea24e9bf58", "html_url": "https://github.com/rust-lang/rust/commit/b172862d21f16095a5cf11a8938f3cea24e9bf58", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b172862d21f16095a5cf11a8938f3cea24e9bf58/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3cf793bd90a55a89fbac435538bff1e838ff6b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3cf793bd90a55a89fbac435538bff1e838ff6b4", "html_url": "https://github.com/rust-lang/rust/commit/b3cf793bd90a55a89fbac435538bff1e838ff6b4"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "f00db117a5f5558238d256d049ab70df5e444ef5", "filename": "src/boot/fe/ast.ml", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b172862d21f16095a5cf11a8938f3cea24e9bf58/src%2Fboot%2Ffe%2Fast.ml", "raw_url": "https://github.com/rust-lang/rust/raw/b172862d21f16095a5cf11a8938f3cea24e9bf58/src%2Fboot%2Ffe%2Fast.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Ffe%2Fast.ml?ref=b172862d21f16095a5cf11a8938f3cea24e9bf58", "patch": "@@ -1339,6 +1339,32 @@ and fmt_crate (ff:Format.formatter) (c:crate) : unit =\n   let (view,items) = c.node.crate_items in\n     fmt_mod_view ff view;\n     fmt_mod_items ff items\n+;;\n+\n+let ty_children (ty:ty) : ty array =\n+  let children_of_ty_tag ty_tag = Array.concat (htab_vals ty_tag) in\n+  let children_of_ty_fn ty_fn =\n+    let (ty_sig, _) = ty_fn in\n+    let in_slots = ty_sig.sig_input_slots in\n+    let slots = Array.append in_slots [| ty_sig.sig_output_slot |] in\n+    arr_filter_some (Array.map (fun slot -> slot.slot_ty) slots)\n+  in\n+  match ty with\n+      TY_tup tys -> tys\n+    | TY_vec ty' | TY_chan ty' | TY_port ty' | TY_box ty' | TY_mutable ty'\n+          | TY_constrained (ty', _) ->\n+        [| ty' |]\n+    | TY_rec fields -> Array.map snd fields\n+    | TY_tag ty_tag -> children_of_ty_tag ty_tag\n+    | TY_iso ty_iso -> children_of_ty_tag (ty_iso.iso_group.(ty_iso.iso_index))\n+    | TY_fn ty_fn -> children_of_ty_fn ty_fn\n+    | TY_obj (_, methods) ->\n+        Array.concat (List.map children_of_ty_fn (htab_vals methods))\n+    | TY_any | TY_nil | TY_bool | TY_mach _ | TY_int | TY_uint | TY_char\n+          | TY_str | TY_idx _ | TY_task | TY_native _ | TY_param _\n+          | TY_named _ | TY_type ->\n+        [| |]\n+;;\n \n let sprintf_expr = sprintf_fmt fmt_expr;;\n let sprintf_name = sprintf_fmt fmt_name;;"}, {"sha": "0ea39e2d5b2d34ed1283cf484b4e9bc3e4ed5873", "filename": "src/boot/util/common.ml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b172862d21f16095a5cf11a8938f3cea24e9bf58/src%2Fboot%2Futil%2Fcommon.ml", "raw_url": "https://github.com/rust-lang/rust/raw/b172862d21f16095a5cf11a8938f3cea24e9bf58/src%2Fboot%2Futil%2Fcommon.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Futil%2Fcommon.ml?ref=b172862d21f16095a5cf11a8938f3cea24e9bf58", "patch": "@@ -341,7 +341,6 @@ let bool_of_option x =\n       Some _ -> true\n     | None -> false\n \n-\n (*\n  * Auxiliary stack functions.\n  *)"}]}