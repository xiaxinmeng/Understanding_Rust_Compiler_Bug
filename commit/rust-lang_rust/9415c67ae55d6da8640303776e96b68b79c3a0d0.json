{"sha": "9415c67ae55d6da8640303776e96b68b79c3a0d0", "node_id": "C_kwDOAAsO6NoAKDk0MTVjNjdhZTU1ZDZkYTg2NDAzMDM3NzZlOTZiNjhiNzljM2EwZDA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-19T16:38:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-19T16:38:35Z"}, "message": "Rollup merge of #92029 - nikic:section-flags-fix, r=davidtwco\n\nExplicitly set no ELF flags for .rustc section\n\nFor a data section, the object crate will set the SHF_ALLOC by default, which is exactly what we don't want. Explicitly set sh_flags to zero to avoid this.\n\nI checked with `objdump -h` that this produces the right flags for ELF.\n\nFixes #92013.", "tree": {"sha": "6186457f6f9a872bdd22a7e8ec56288a7aef36a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6186457f6f9a872bdd22a7e8ec56288a7aef36a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9415c67ae55d6da8640303776e96b68b79c3a0d0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhv2AMCRBK7hj4Ov3rIwAAe7oIACPWkEkxHfNjcPA2m5+MkGFz\npG6ER+FMuIByG5ZnEmzH4UYS/i8HJdM05RXUAyhNpig6yfFpOKVsP5E09afweCjE\nk13e/0WgwAbzKr2mk6OIvPPk8KNftt27AfHC03OVSQ6lCHx/cJ6fV31NFOGEoK/g\n4M3GIGmQFBWn3lxGXYTMjeI3pZ7CeEbS/YBnNS/POM7Z8vHBtKPooegIZP4HWp2s\nmKaGYCN31Z2JbO8fAO/TI+ugxJgYMPt5FptRkQ7g2p44E9HxorR60tU7HWhYgaVF\nhelwt/mvYuri94LWQlR9xmbh8EuduBUOmwb9Tl0K4NXEnToK4d51F02wx7yxfN8=\n=qAD9\n-----END PGP SIGNATURE-----\n", "payload": "tree 6186457f6f9a872bdd22a7e8ec56288a7aef36a1\nparent fba0d04d306462b25f7768b39756e7f82fc92318\nparent 79d53096041c05db5f54a0fdf0b0dae4fe48ccec\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1639931915 +0100\ncommitter GitHub <noreply@github.com> 1639931915 +0100\n\nRollup merge of #92029 - nikic:section-flags-fix, r=davidtwco\n\nExplicitly set no ELF flags for .rustc section\n\nFor a data section, the object crate will set the SHF_ALLOC by default, which is exactly what we don't want. Explicitly set sh_flags to zero to avoid this.\n\nI checked with `objdump -h` that this produces the right flags for ELF.\n\nFixes #92013.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9415c67ae55d6da8640303776e96b68b79c3a0d0", "html_url": "https://github.com/rust-lang/rust/commit/9415c67ae55d6da8640303776e96b68b79c3a0d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9415c67ae55d6da8640303776e96b68b79c3a0d0/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fba0d04d306462b25f7768b39756e7f82fc92318", "url": "https://api.github.com/repos/rust-lang/rust/commits/fba0d04d306462b25f7768b39756e7f82fc92318", "html_url": "https://github.com/rust-lang/rust/commit/fba0d04d306462b25f7768b39756e7f82fc92318"}, {"sha": "79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "url": "https://api.github.com/repos/rust-lang/rust/commits/79d53096041c05db5f54a0fdf0b0dae4fe48ccec", "html_url": "https://github.com/rust-lang/rust/commit/79d53096041c05db5f54a0fdf0b0dae4fe48ccec"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "7c97143e80780d97e37fdeef45dce86486f55f66", "filename": "compiler/rustc_codegen_ssa/src/back/metadata.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9415c67ae55d6da8640303776e96b68b79c3a0d0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9415c67ae55d6da8640303776e96b68b79c3a0d0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fmetadata.rs?ref=9415c67ae55d6da8640303776e96b68b79c3a0d0", "patch": "@@ -259,8 +259,15 @@ pub fn create_compressed_metadata_file(\n     let section = file.add_section(\n         file.segment_name(StandardSegment::Data).to_vec(),\n         b\".rustc\".to_vec(),\n-        SectionKind::Data,\n+        SectionKind::ReadOnlyData,\n     );\n+    match file.format() {\n+        BinaryFormat::Elf => {\n+            // Explicitly set no flags to avoid SHF_ALLOC default for data section.\n+            file.section_mut(section).flags = SectionFlags::Elf { sh_flags: 0 };\n+        }\n+        _ => {}\n+    };\n     let offset = file.append_section_data(section, &compressed, 1);\n \n     // For MachO and probably PE this is necessary to prevent the linker from throwing away the"}]}