{"sha": "69a15b2eee671f76f934f1a2b8901c82c2eeee77", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5YTE1YjJlZWU2NzFmNzZmOTM0ZjFhMmI4OTAxYzgyYzJlZWVlNzc=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-12-06T13:51:52Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-12-06T13:51:52Z"}, "message": "Update FmtVisitor::from_codemap()", "tree": {"sha": "5ff24bce21c6b930fb8faf49065a344466a1d3f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ff24bce21c6b930fb8faf49065a344466a1d3f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69a15b2eee671f76f934f1a2b8901c82c2eeee77", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69a15b2eee671f76f934f1a2b8901c82c2eeee77", "html_url": "https://github.com/rust-lang/rust/commit/69a15b2eee671f76f934f1a2b8901c82c2eeee77", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69a15b2eee671f76f934f1a2b8901c82c2eeee77/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09287625626925b30ea0689ef9d051f3a8889149", "url": "https://api.github.com/repos/rust-lang/rust/commits/09287625626925b30ea0689ef9d051f3a8889149", "html_url": "https://github.com/rust-lang/rust/commit/09287625626925b30ea0689ef9d051f3a8889149"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "35a441012d8baf73b837fda6eaee05b1500b2b18", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=69a15b2eee671f76f934f1a2b8901c82c2eeee77", "patch": "@@ -629,7 +629,7 @@ pub fn rewrite_block_with_visitor(\n         return rw;\n     }\n \n-    let mut visitor = FmtVisitor::from_codemap(context.parse_session, context.config);\n+    let mut visitor = FmtVisitor::from_codemap(context.parse_session, context.config, block.span);\n     visitor.block_indent = shape.indent;\n     visitor.is_if_else_block = context.is_if_else_block;\n     match block.rules {"}, {"sha": "8fa1a784c0e55acdc1fd0a4eb8d3e315db6bda83", "filename": "src/items.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=69a15b2eee671f76f934f1a2b8901c82c2eeee77", "patch": "@@ -657,7 +657,8 @@ pub fn format_impl(\n         let open_pos = snippet.find_uncommented(\"{\")? + 1;\n \n         if !items.is_empty() || contains_comment(&snippet[open_pos..]) {\n-            let mut visitor = FmtVisitor::from_codemap(context.parse_session, context.config);\n+            let mut visitor =\n+                FmtVisitor::from_codemap(context.parse_session, context.config, item.span);\n             visitor.block_indent = offset.block_only().block_indent(context.config);\n             visitor.last_pos = item.span.lo() + BytePos(open_pos as u32);\n \n@@ -1055,7 +1056,8 @@ pub fn format_trait(context: &RewriteContext, item: &ast::Item, offset: Indent)\n         let open_pos = snippet.find_uncommented(\"{\")? + 1;\n \n         if !trait_items.is_empty() || contains_comment(&snippet[open_pos..]) {\n-            let mut visitor = FmtVisitor::from_codemap(context.parse_session, context.config);\n+            let mut visitor =\n+                FmtVisitor::from_codemap(context.parse_session, context.config, item.span);\n             visitor.block_indent = offset.block_only().block_indent(context.config);\n             visitor.last_pos = item.span.lo() + BytePos(open_pos as u32);\n "}, {"sha": "72e01a4b1aad108c1358d2e8c32d3ada6c46b3bf", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=69a15b2eee671f76f934f1a2b8901c82c2eeee77", "patch": "@@ -317,7 +317,7 @@ where\n         if config.verbose() {\n             println!(\"Formatting {}\", path_str);\n         }\n-        let mut visitor = FmtVisitor::from_codemap(parse_session, config);\n+        let mut visitor = FmtVisitor::from_codemap(parse_session, config, module.inner);\n         let filemap = visitor.codemap.lookup_char_pos(module.inner.lo()).file;\n         // Format inner attributes if available.\n         if !krate.attrs.is_empty() && path == main_file {"}, {"sha": "fc83ccef3a4ff997de7f27e69b906fa7f1c03801", "filename": "src/visitor.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69a15b2eee671f76f934f1a2b8901c82c2eeee77/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=69a15b2eee671f76f934f1a2b8901c82c2eeee77", "patch": "@@ -530,7 +530,11 @@ impl<'a> FmtVisitor<'a> {\n         self.last_pos = source!(self, span).hi();\n     }\n \n-    pub fn from_codemap(parse_session: &'a ParseSess, config: &'a Config) -> FmtVisitor<'a> {\n+    pub fn from_codemap(\n+        parse_session: &'a ParseSess,\n+        config: &'a Config,\n+        span: Span,\n+    ) -> FmtVisitor<'a> {\n         FmtVisitor {\n             parse_session: parse_session,\n             codemap: parse_session.codemap(),"}]}