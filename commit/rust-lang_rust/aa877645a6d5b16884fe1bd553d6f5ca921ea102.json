{"sha": "aa877645a6d5b16884fe1bd553d6f5ca921ea102", "node_id": "C_kwDOAAsO6NoAKGFhODc3NjQ1YTZkNWIxNjg4NGZlMWJkNTUzZDZmNWNhOTIxZWExMDI", "commit": {"author": {"name": "morine0122", "email": "k0000.m000.job@gmail.com", "date": "2023-02-26T10:04:16Z"}, "committer": {"name": "morine0122", "email": "k0000.m000.job@gmail.com", "date": "2023-02-26T12:50:39Z"}, "message": "Fix resolving types when resolving HIR and add a related test", "tree": {"sha": "35a487222690d512442f6371b6a3267aa2380387", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35a487222690d512442f6371b6a3267aa2380387"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa877645a6d5b16884fe1bd553d6f5ca921ea102", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa877645a6d5b16884fe1bd553d6f5ca921ea102", "html_url": "https://github.com/rust-lang/rust/commit/aa877645a6d5b16884fe1bd553d6f5ca921ea102", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa877645a6d5b16884fe1bd553d6f5ca921ea102/comments", "author": {"login": "Kohei316", "id": 102583166, "node_id": "U_kgDOBh1Lfg", "avatar_url": "https://avatars.githubusercontent.com/u/102583166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kohei316", "html_url": "https://github.com/Kohei316", "followers_url": "https://api.github.com/users/Kohei316/followers", "following_url": "https://api.github.com/users/Kohei316/following{/other_user}", "gists_url": "https://api.github.com/users/Kohei316/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kohei316/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kohei316/subscriptions", "organizations_url": "https://api.github.com/users/Kohei316/orgs", "repos_url": "https://api.github.com/users/Kohei316/repos", "events_url": "https://api.github.com/users/Kohei316/events{/privacy}", "received_events_url": "https://api.github.com/users/Kohei316/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kohei316", "id": 102583166, "node_id": "U_kgDOBh1Lfg", "avatar_url": "https://avatars.githubusercontent.com/u/102583166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kohei316", "html_url": "https://github.com/Kohei316", "followers_url": "https://api.github.com/users/Kohei316/followers", "following_url": "https://api.github.com/users/Kohei316/following{/other_user}", "gists_url": "https://api.github.com/users/Kohei316/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kohei316/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kohei316/subscriptions", "organizations_url": "https://api.github.com/users/Kohei316/orgs", "repos_url": "https://api.github.com/users/Kohei316/repos", "events_url": "https://api.github.com/users/Kohei316/events{/privacy}", "received_events_url": "https://api.github.com/users/Kohei316/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d32a7b7c66450c792dafe162b229d40ab6a1cc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d32a7b7c66450c792dafe162b229d40ab6a1cc8", "html_url": "https://github.com/rust-lang/rust/commit/1d32a7b7c66450c792dafe162b229d40ab6a1cc8"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "ef5434771d943d3ddd72240a792c1effd0dcc3a8", "filename": "crates/hir/src/source_analyzer.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aa877645a6d5b16884fe1bd553d6f5ca921ea102/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa877645a6d5b16884fe1bd553d6f5ca921ea102/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs?ref=aa877645a6d5b16884fe1bd553d6f5ca921ea102", "patch": "@@ -943,17 +943,17 @@ fn resolve_hir_path_(\n                 res.map(|ty_ns| (ty_ns, path.segments().first()))\n             }\n             None => {\n-                let (ty, remaining) =\n+                let (ty, remaining_idx) =\n                     resolver.resolve_path_in_type_ns(db.upcast(), path.mod_path())?;\n-                match remaining {\n-                    Some(remaining) if remaining > 1 => {\n-                        if remaining + 1 == path.segments().len() {\n+                match remaining_idx {\n+                    Some(remaining_idx) => {\n+                        if remaining_idx + 1 == path.segments().len() {\n                             Some((ty, path.segments().last()))\n                         } else {\n                             None\n                         }\n                     }\n-                    _ => Some((ty, path.segments().get(1))),\n+                    None => Some((ty, None)),\n                 }\n             }\n         }?;"}, {"sha": "65d1181d0924493fdac93cfc358548ef26693a32", "filename": "crates/ide/src/goto_definition.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/aa877645a6d5b16884fe1bd553d6f5ca921ea102/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa877645a6d5b16884fe1bd553d6f5ca921ea102/crates%2Fide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fgoto_definition.rs?ref=aa877645a6d5b16884fe1bd553d6f5ca921ea102", "patch": "@@ -1065,6 +1065,23 @@ fn f() -> impl Sub<Item$0 = u8> {}\n         );\n     }\n \n+    #[test]\n+    fn goto_def_for_module_declaration_in_path_if_types_and_values_same_name() {\n+        check(\n+            r#\"\n+mod bar {\n+    pub struct Foo {}\n+             //^^^\n+    pub fn Foo() {}\n+}\n+\n+fn baz() {\n+    let _foo_enum: bar::Foo$0 = bar::Foo {};\n+}\n+        \"#,\n+        )\n+    }\n+\n     #[test]\n     fn unknown_assoc_ty() {\n         check_unresolved("}]}