{"sha": "afc9275928905d2142da027815aac67b81d0a89b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmYzkyNzU5Mjg5MDVkMjE0MmRhMDI3ODE1YWFjNjdiODFkMGE4OWI=", "commit": {"author": {"name": "Yusuke Tanaka", "email": "yusuktan@maguro.dev", "date": "2021-02-10T15:02:21Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2021-03-02T09:37:30Z"}, "message": "Move crosspointer_transmute to its own module", "tree": {"sha": "39d6606843895b1c936d24d951f7475319438a26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/39d6606843895b1c936d24d951f7475319438a26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/afc9275928905d2142da027815aac67b81d0a89b", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmA+B1oACgkQHKDfKvWd\naKWnZQ//bH+29xolTiVKGcKUrgNMkuhxT8D9rg3bRvoTiTwzYeFs+Z9kYBJ7s/21\nxYVI8I0REvqamOkanDAq91qw+wyK1b5+5PZUB3oz3JQfLWauTFQmki4EZdoq5OdL\nOQPz1hLZ6hxJmDMyhlYMWfjqbTic2s8Hdnt3DC88W8KL8ac9lcb5IDnGp7REGekZ\nOjWskFwxvFFBRc5lQGPR0UBEl5u+n7uJ4gRSnujqyOBqMfq/n7URb2chR62IAoJb\ny/mtw7HF3fvuqRLFinKmmTSbUlFIjs7c8vGlVRvBsBeiy5yWYI9Bco+AeMNsUlkT\n5ITb2h50j3/yIVQdyaJyfq2Wj2t5bEo9Zcm2EO5OhqHo7n/KO4Iw4vvGrwICHSLc\nUFYvR5IxLOSzS563apQRSggo4WMEj9zmPabveTyR3Cb0Vuj9u5Mr6zXuJiSIjqYo\nPweNkv98Ywoyu/jnMPC7E9AVrVSlYFI+mkhN03i9G5FTxX8J54MEeReIPc7x0HBT\nDh/VnFkfA2DBi04BEN/IXebRytDRMe0VvTVHGolOQrT3Xl+Ufi3d7TVVkd+HjJvS\nK+KW3yBqIvYRpn7qUMrY9YU75PDb2hw2FXMvI/oe84hliun+EETGwKvLjB9xAjwO\nLgtE/W/X5zsGI8VAhs+b0xG2xj5c/9/AOZ22kwlbWwvZ/2LQSgc=\n=2LVB\n-----END PGP SIGNATURE-----", "payload": "tree 39d6606843895b1c936d24d951f7475319438a26\nparent ef97764dcc45493eebe0332acf4b2410583af5e4\nauthor Yusuke Tanaka <yusuktan@maguro.dev> 1612969341 +0900\ncommitter flip1995 <philipp.krones@embecosm.com> 1614677850 +0100\n\nMove crosspointer_transmute to its own module\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/afc9275928905d2142da027815aac67b81d0a89b", "html_url": "https://github.com/rust-lang/rust/commit/afc9275928905d2142da027815aac67b81d0a89b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/afc9275928905d2142da027815aac67b81d0a89b/comments", "author": {"login": "magurotuna", "id": 23649474, "node_id": "MDQ6VXNlcjIzNjQ5NDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23649474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/magurotuna", "html_url": "https://github.com/magurotuna", "followers_url": "https://api.github.com/users/magurotuna/followers", "following_url": "https://api.github.com/users/magurotuna/following{/other_user}", "gists_url": "https://api.github.com/users/magurotuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/magurotuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/magurotuna/subscriptions", "organizations_url": "https://api.github.com/users/magurotuna/orgs", "repos_url": "https://api.github.com/users/magurotuna/repos", "events_url": "https://api.github.com/users/magurotuna/events{/privacy}", "received_events_url": "https://api.github.com/users/magurotuna/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef97764dcc45493eebe0332acf4b2410583af5e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef97764dcc45493eebe0332acf4b2410583af5e4", "html_url": "https://github.com/rust-lang/rust/commit/ef97764dcc45493eebe0332acf4b2410583af5e4"}], "stats": {"total": 61, "additions": 43, "deletions": 18}, "files": [{"sha": "b570bb3a396e4b5f0929611674ee356f94219148", "filename": "clippy_lints/src/transmute/crosspointer_transmute.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/afc9275928905d2142da027815aac67b81d0a89b/clippy_lints%2Fsrc%2Ftransmute%2Fcrosspointer_transmute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/afc9275928905d2142da027815aac67b81d0a89b/clippy_lints%2Fsrc%2Ftransmute%2Fcrosspointer_transmute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Fcrosspointer_transmute.rs?ref=afc9275928905d2142da027815aac67b81d0a89b", "patch": "@@ -0,0 +1,38 @@\n+use super::CROSSPOINTER_TRANSMUTE;\n+use crate::utils::span_lint;\n+use rustc_hir::Expr;\n+use rustc_lint::LateContext;\n+use rustc_middle::ty;\n+use rustc_middle::ty::Ty;\n+\n+/// Checks for `crosspointer_transmute` lint.\n+/// Returns `true` if it's triggered, otherwise returns `false`.\n+pub(super) fn check<'tcx>(cx: &LateContext<'tcx>, e: &'tcx Expr<'_>, from_ty: Ty<'tcx>, to_ty: Ty<'tcx>) -> bool {\n+    match (&from_ty.kind(), &to_ty.kind()) {\n+        (ty::RawPtr(from_ptr), _) if from_ptr.ty == to_ty => {\n+            span_lint(\n+                cx,\n+                CROSSPOINTER_TRANSMUTE,\n+                e.span,\n+                &format!(\n+                    \"transmute from a type (`{}`) to the type that it points to (`{}`)\",\n+                    from_ty, to_ty\n+                ),\n+            );\n+            true\n+        },\n+        (_, ty::RawPtr(to_ptr)) if to_ptr.ty == from_ty => {\n+            span_lint(\n+                cx,\n+                CROSSPOINTER_TRANSMUTE,\n+                e.span,\n+                &format!(\n+                    \"transmute from a type (`{}`) to a pointer to that type (`{}`)\",\n+                    from_ty, to_ty\n+                ),\n+            );\n+            true\n+        },\n+        _ => false,\n+    }\n+}"}, {"sha": "7e05771c8851c9f1c688bbf17f9dd112dec34010", "filename": "clippy_lints/src/transmute/mod.rs", "status": "modified", "additions": 5, "deletions": 18, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/afc9275928905d2142da027815aac67b81d0a89b/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/afc9275928905d2142da027815aac67b81d0a89b/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftransmute%2Fmod.rs?ref=afc9275928905d2142da027815aac67b81d0a89b", "patch": "@@ -1,3 +1,4 @@\n+mod crosspointer_transmute;\n mod useless_transmute;\n mod utils;\n mod wrong_transmute;\n@@ -355,26 +356,12 @@ impl<'tcx> LateLintPass<'tcx> for Transmute {\n                 if triggered {\n                     return;\n                 }\n+                let triggered = crosspointer_transmute::check(cx, e, from_ty, to_ty);\n+                if triggered {\n+                    return;\n+                }\n \n                 match (&from_ty.kind(), &to_ty.kind()) {\n-                    (ty::RawPtr(from_ptr), _) if from_ptr.ty == to_ty => span_lint(\n-                        cx,\n-                        CROSSPOINTER_TRANSMUTE,\n-                        e.span,\n-                        &format!(\n-                            \"transmute from a type (`{}`) to the type that it points to (`{}`)\",\n-                            from_ty, to_ty\n-                        ),\n-                    ),\n-                    (_, ty::RawPtr(to_ptr)) if to_ptr.ty == from_ty => span_lint(\n-                        cx,\n-                        CROSSPOINTER_TRANSMUTE,\n-                        e.span,\n-                        &format!(\n-                            \"transmute from a type (`{}`) to a pointer to that type (`{}`)\",\n-                            from_ty, to_ty\n-                        ),\n-                    ),\n                     (ty::RawPtr(from_pty), ty::Ref(_, to_ref_ty, mutbl)) => span_lint_and_then(\n                         cx,\n                         TRANSMUTE_PTR_TO_REF,"}]}