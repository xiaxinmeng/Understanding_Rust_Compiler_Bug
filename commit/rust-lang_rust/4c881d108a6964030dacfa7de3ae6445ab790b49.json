{"sha": "4c881d108a6964030dacfa7de3ae6445ab790b49", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjODgxZDEwOGE2OTY0MDMwZGFjZmE3ZGUzYWU2NDQ1YWI3OTBiNDk=", "commit": {"author": {"name": "Cyril Plisko", "email": "cyril.plisko@mountall.com", "date": "2019-09-07T08:00:02Z"}, "committer": {"name": "Cyril Plisko", "email": "cyril.plisko@mountall.com", "date": "2019-09-22T07:49:36Z"}, "message": "clippy::cargo_common_metadata: check for license-file\n\nWhen license property is missing in Cargo.toml check for license-file\nas it may be used instead of the former. The check implemented here is\nvery naive as it only verifies that the field is present and is not\nempty. More scrutiny can be applied by verifying the file is actually\npresent.\n\nFixes #4517", "tree": {"sha": "9c0c0ab5b111ca6c6d0772d287dfb7f898d3e21c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c0c0ab5b111ca6c6d0772d287dfb7f898d3e21c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c881d108a6964030dacfa7de3ae6445ab790b49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c881d108a6964030dacfa7de3ae6445ab790b49", "html_url": "https://github.com/rust-lang/rust/commit/4c881d108a6964030dacfa7de3ae6445ab790b49", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c881d108a6964030dacfa7de3ae6445ab790b49/comments", "author": {"login": "imp", "id": 92535, "node_id": "MDQ6VXNlcjkyNTM1", "avatar_url": "https://avatars.githubusercontent.com/u/92535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imp", "html_url": "https://github.com/imp", "followers_url": "https://api.github.com/users/imp/followers", "following_url": "https://api.github.com/users/imp/following{/other_user}", "gists_url": "https://api.github.com/users/imp/gists{/gist_id}", "starred_url": "https://api.github.com/users/imp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imp/subscriptions", "organizations_url": "https://api.github.com/users/imp/orgs", "repos_url": "https://api.github.com/users/imp/repos", "events_url": "https://api.github.com/users/imp/events{/privacy}", "received_events_url": "https://api.github.com/users/imp/received_events", "type": "User", "site_admin": false}, "committer": {"login": "imp", "id": 92535, "node_id": "MDQ6VXNlcjkyNTM1", "avatar_url": "https://avatars.githubusercontent.com/u/92535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imp", "html_url": "https://github.com/imp", "followers_url": "https://api.github.com/users/imp/followers", "following_url": "https://api.github.com/users/imp/following{/other_user}", "gists_url": "https://api.github.com/users/imp/gists{/gist_id}", "starred_url": "https://api.github.com/users/imp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imp/subscriptions", "organizations_url": "https://api.github.com/users/imp/orgs", "repos_url": "https://api.github.com/users/imp/repos", "events_url": "https://api.github.com/users/imp/events{/privacy}", "received_events_url": "https://api.github.com/users/imp/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d07d001b74f384e34d5f670c34e45bdc9a372ca2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d07d001b74f384e34d5f670c34e45bdc9a372ca2", "html_url": "https://github.com/rust-lang/rust/commit/d07d001b74f384e34d5f670c34e45bdc9a372ca2"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "cfc70de8f21dd35426b8af88f941939fdf8cf2be", "filename": "clippy_lints/src/cargo_common_metadata.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4c881d108a6964030dacfa7de3ae6445ab790b49/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c881d108a6964030dacfa7de3ae6445ab790b49/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs?ref=4c881d108a6964030dacfa7de3ae6445ab790b49", "patch": "@@ -1,5 +1,7 @@\n //! lint on missing cargo common metadata\n \n+use std::path::PathBuf;\n+\n use crate::utils::span_lint;\n use rustc::lint::{EarlyContext, EarlyLintPass, LintArray, LintPass};\n use rustc::{declare_lint_pass, declare_tool_lint};\n@@ -47,6 +49,10 @@ fn is_empty_str(value: &Option<String>) -> bool {\n     value.as_ref().map_or(true, String::is_empty)\n }\n \n+fn is_empty_path(value: &Option<PathBuf>) -> bool {\n+    value.as_ref().and_then(|x| x.to_str()).map_or(true, str::is_empty)\n+}\n+\n fn is_empty_vec(value: &[String]) -> bool {\n     // This works because empty iterators return true\n     value.iter().all(std::string::String::is_empty)\n@@ -72,8 +78,8 @@ impl EarlyLintPass for CargoCommonMetadata {\n                 missing_warning(cx, &package, \"package.description\");\n             }\n \n-            if is_empty_str(&package.license) {\n-                missing_warning(cx, &package, \"package.license\");\n+            if is_empty_str(&package.license) && is_empty_path(&package.license_file) {\n+                missing_warning(cx, &package, \"either package.license or package.license_file\");\n             }\n \n             if is_empty_str(&package.repository) {"}]}