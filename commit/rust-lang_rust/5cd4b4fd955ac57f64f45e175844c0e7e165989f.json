{"sha": "5cd4b4fd955ac57f64f45e175844c0e7e165989f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZDRiNGZkOTU1YWM1N2Y2NGY0NWUxNzU4NDRjMGU3ZTE2NTk4OWY=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-02-05T22:31:56Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-02-05T22:31:56Z"}, "message": "Swapped order of left/right visits to ensure consistency in read/write pass ordering when -O is passed.", "tree": {"sha": "930935518f31e4cc1e111e7615fd04a84a73c2b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/930935518f31e4cc1e111e7615fd04a84a73c2b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5cd4b4fd955ac57f64f45e175844c0e7e165989f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlp421wACgkQAXYLT59T\n8VT3zA//W/Q5R+DdO9rnlSG08IrEqiYEHk+ChcXagy2ZguZK40Ax7EaHf8IyeM4g\nQ3k5tM6DglyiEmN7Qmm/aaOqH7fge83RHXKdWHtFK7rwvj5OC3F/06y196bJcOQ9\ng+YFHDZL0CKs6yYO9UN4hVjU8ughMlPK+6FRfJlCudY+JeRsZ4mX5QcpcvxuHseT\noSaMl6J16bXSbL/ZqHS7mAV97qP0BSNa86MqqM7TwTr2Nluw0HmRSNWzlVAPz8fG\nwl/02KIwR/DOBit4oJoqC4GzCffl2ySc/EuTEQpNl50k43omEqZAtSnx/qWTMqRl\nfvKTeva4LOvaS9oAENukgKKGWtWm0u/dZPwFcw2I95ixugAIwsqYUSryFgBEhWcB\nFpOO33f/w+lLnD7cOxxBat3MN17jlzh5wnuh2sSFKXrLmOAXviWlbma4F6kEj/ZB\n42iyO5cSIu98WMX0Tomai366IWKD7L6z4l/HnZsns/2N6SqB5drofaUuEVKlCjL3\nQKyTPlHsbVAMjwnm40/hAQEcCSi0ENh5vbBEf3Oqpa319dDbfaKuCgW2m9ePfzxR\nRsEGq6bBgu5MXJaTLNuJhc7l5SarTRQHSK51lI6ax5d3iBXVw/1QIC9Uc+POigqE\nWEL+lPCZ9BHz64bwEym+38o9gad4zs6ZfUfLWXwiYOUSuomlnGM=\n=acnT\n-----END PGP SIGNATURE-----", "payload": "tree 930935518f31e4cc1e111e7615fd04a84a73c2b3\nparent 970fb1a77f31e71e16871d22547243f1c98e6d66\nauthor David Wood <david@davidtw.co> 1517869916 +0000\ncommitter David Wood <david@davidtw.co> 1517869916 +0000\n\nSwapped order of left/right visits to ensure consistency in read/write pass ordering when -O is passed.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5cd4b4fd955ac57f64f45e175844c0e7e165989f", "html_url": "https://github.com/rust-lang/rust/commit/5cd4b4fd955ac57f64f45e175844c0e7e165989f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5cd4b4fd955ac57f64f45e175844c0e7e165989f/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "970fb1a77f31e71e16871d22547243f1c98e6d66", "url": "https://api.github.com/repos/rust-lang/rust/commits/970fb1a77f31e71e16871d22547243f1c98e6d66", "html_url": "https://github.com/rust-lang/rust/commit/970fb1a77f31e71e16871d22547243f1c98e6d66"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "07d6ce20821ed4258467c669327a3a68c8206797", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=5cd4b4fd955ac57f64f45e175844c0e7e165989f", "patch": "@@ -347,20 +347,20 @@ impl<'cx, 'gcx, 'tcx> DataflowResultsConsumer<'cx, 'tcx> for MirBorrowckCtxt<'cx\n \n         match stmt.kind {\n             StatementKind::Assign(ref lhs, ref rhs) => {\n+                self.consume_rvalue(\n+                    ContextKind::AssignRhs.new(location),\n+                    (rhs, span),\n+                    location,\n+                    flow_state,\n+                );\n+\n                 self.mutate_place(\n                     ContextKind::AssignLhs.new(location),\n                     (lhs, span),\n                     Shallow(None),\n                     JustWrite,\n                     flow_state,\n                 );\n-\n-                self.consume_rvalue(\n-                    ContextKind::AssignRhs.new(location),\n-                    (rhs, span),\n-                    location,\n-                    flow_state,\n-                );\n             }\n             StatementKind::SetDiscriminant {\n                 ref place,"}, {"sha": "efa6cc273b6f4a66e32623fbcef67d1f92b73f5c", "filename": "src/test/compile-fail/nll/reference-carried-through-struct-field.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fcompile-fail%2Fnll%2Freference-carried-through-struct-field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fcompile-fail%2Fnll%2Freference-carried-through-struct-field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fnll%2Freference-carried-through-struct-field.rs?ref=5cd4b4fd955ac57f64f45e175844c0e7e165989f", "patch": "@@ -19,7 +19,7 @@ fn foo() {\n     let mut x = 22;\n     let wrapper = Wrap { w: &mut x };\n     x += 1; //[ast]~ ERROR cannot assign to `x` because it is borrowed [E0506]\n-    //[mir]~^ ERROR cannot assign to `x` because it is borrowed [E0506]\n+    //[mir]~^ ERROR cannot use `x` because it was mutably borrowed [E0503]\n     *wrapper.w += 1;\n }\n "}, {"sha": "b69ba97cc9b4d56023e0f9642da22c2c021b75a0", "filename": "src/test/ui/issue-45697.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fui%2Fissue-45697.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fui%2Fissue-45697.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-45697.rs?ref=5cd4b4fd955ac57f64f45e175844c0e7e165989f", "patch": "@@ -29,7 +29,7 @@ fn main() {\n         let z = copy_borrowed_ptr(&mut y);\n         *y.pointer += 1;\n         //~^ ERROR cannot assign to `*y.pointer` because it is borrowed (Ast) [E0506]\n-        //~| ERROR cannot assign to `*y.pointer` because it is borrowed (Mir) [E0506]\n+        //~| ERROR cannot use `*y.pointer` because it was mutably borrowed (Mir) [E0503]\n         *z.pointer += 1;\n     }\n }"}, {"sha": "e9b723d57b5073fa98f3209a028905c8837057d3", "filename": "src/test/ui/issue-45697.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fui%2Fissue-45697.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5cd4b4fd955ac57f64f45e175844c0e7e165989f/src%2Ftest%2Fui%2Fissue-45697.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-45697.stderr?ref=5cd4b4fd955ac57f64f45e175844c0e7e165989f", "patch": "@@ -6,13 +6,13 @@ error[E0506]: cannot assign to `*y.pointer` because it is borrowed (Ast)\n 30 |         *y.pointer += 1;\n    |         ^^^^^^^^^^^^^^^ assignment to borrowed `*y.pointer` occurs here\n \n-error[E0506]: cannot assign to `*y.pointer` because it is borrowed (Mir)\n+error[E0503]: cannot use `*y.pointer` because it was mutably borrowed (Mir)\n   --> $DIR/issue-45697.rs:30:9\n    |\n 29 |         let z = copy_borrowed_ptr(&mut y);\n-   |                                   ------ borrow of `*y.pointer` occurs here\n+   |                                   ------ borrow of `y` occurs here\n 30 |         *y.pointer += 1;\n-   |         ^^^^^^^^^^^^^^^ assignment to borrowed `*y.pointer` occurs here\n+   |         ^^^^^^^^^^^^^^^ use of borrowed `y`\n \n error: aborting due to 2 previous errors\n "}]}