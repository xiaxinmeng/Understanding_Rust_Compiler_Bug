{"sha": "ca9d50982d4b2fd5abe09066afdadd57c674ff57", "node_id": "C_kwDOAAsO6NoAKGNhOWQ1MDk4MmQ0YjJmZDVhYmUwOTA2NmFmZGFkZDU3YzY3NGZmNTc", "commit": {"author": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-03-07T02:30:16Z"}, "committer": {"name": "Ben Kimock", "email": "kimockb@gmail.com", "date": "2023-03-09T17:41:17Z"}, "message": "Install binaries to the miri toolchain's sysroot", "tree": {"sha": "9e7e2d3e241a282d8a6ddda250c6f7279759fadc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e7e2d3e241a282d8a6ddda250c6f7279759fadc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca9d50982d4b2fd5abe09066afdadd57c674ff57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca9d50982d4b2fd5abe09066afdadd57c674ff57", "html_url": "https://github.com/rust-lang/rust/commit/ca9d50982d4b2fd5abe09066afdadd57c674ff57", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca9d50982d4b2fd5abe09066afdadd57c674ff57/comments", "author": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f3c3ffaf83f9226f81c200c7bf8a04e4e3d5715", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f3c3ffaf83f9226f81c200c7bf8a04e4e3d5715", "html_url": "https://github.com/rust-lang/rust/commit/9f3c3ffaf83f9226f81c200c7bf8a04e4e3d5715"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "ef52a37fe319fd14483a18399f1bd62251370691", "filename": "src/tools/miri/ci.sh", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ca9d50982d4b2fd5abe09066afdadd57c674ff57/src%2Ftools%2Fmiri%2Fci.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ca9d50982d4b2fd5abe09066afdadd57c674ff57/src%2Ftools%2Fmiri%2Fci.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fci.sh?ref=ca9d50982d4b2fd5abe09066afdadd57c674ff57", "patch": "@@ -62,8 +62,8 @@ function run_tests {\n   if [ \"$HOST_TARGET\" = x86_64-unknown-linux-gnu ]; then\n     # These act up on Windows (`which miri` produces a filename that does not exist?!?),\n     # so let's do this only on Linux. Also makes sure things work without these set.\n-    export RUSTC=$(which rustc)\n-    export MIRI=$(which miri)\n+    export RUSTC=$(which rustc) # Produces a warning unless we also set MIRI\n+    export MIRI=$(rustc +miri --print sysroot)/bin/miri\n   fi\n   mkdir -p .cargo\n   echo 'build.rustc-wrapper = \"thisdoesnotexist\"' > .cargo/config.toml"}, {"sha": "998e0d295243be62d2df28a101f7e2a4dd9c7587", "filename": "src/tools/miri/miri", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ca9d50982d4b2fd5abe09066afdadd57c674ff57/src%2Ftools%2Fmiri%2Fmiri", "raw_url": "https://github.com/rust-lang/rust/raw/ca9d50982d4b2fd5abe09066afdadd57c674ff57/src%2Ftools%2Fmiri%2Fmiri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fmiri?ref=ca9d50982d4b2fd5abe09066afdadd57c674ff57", "patch": "@@ -281,8 +281,9 @@ find_sysroot() {\n case \"$COMMAND\" in\n install)\n     # \"--locked\" to respect the Cargo.lock file if it exists.\n-    $CARGO install $CARGO_EXTRA_FLAGS --path \"$MIRIDIR\" --force --locked \"$@\"\n-    $CARGO install $CARGO_EXTRA_FLAGS --path \"$MIRIDIR\"/cargo-miri --force --locked \"$@\"\n+    # Install binaries to the miri toolchain's sysroot so they do not interact with other toolchains\n+    $CARGO install $CARGO_EXTRA_FLAGS --path \"$MIRIDIR\" --force --locked --root \"$SYSROOT\" \"$@\"\n+    $CARGO install $CARGO_EXTRA_FLAGS --path \"$MIRIDIR\"/cargo-miri --force --locked --root \"$SYSROOT\" \"$@\"\n     ;;\n check)\n     # Check, and let caller control flags."}]}