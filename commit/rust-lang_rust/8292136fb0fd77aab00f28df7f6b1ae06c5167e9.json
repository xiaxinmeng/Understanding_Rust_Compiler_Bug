{"sha": "8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyOTIxMzZmYjBmZDc3YWFiMDBmMjhkZjdmNmIxYWUwNmM1MTY3ZTk=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-05-19T20:16:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-05-19T20:16:14Z"}, "message": "Rollup merge of #41971 - japaric:pre-link-args, r=alexcrichton\n\nadd -Z pre-link-arg{,s} to rustc\n\nThis PR adds two unstable flags to `rustc`: `-Z pre-link-arg` and `-Z\npre-link-args`. These are the counterpart of the existing `-C link-arg{,s}`\nflags and can be used to pass extra arguments at the *beginning* of the linker\ninvocation, before the Rust object files are passed.\n\nI have [started] a discussion on the rust-embedded RFCs repo about settling on a\nconvention for passing extra arguments to the linker and there are two options\non discussion: `.cargo/config`'s `target.$T.rustflags` and custom target\nspecification files (`{pre,,post}-link-args` fields). However, to compare these\ntwo options on equal footing this `-Z pre-link-arg` feature is required.\n\n[started]: https://github.com/rust-embedded/rfcs/pull/24\n\nTherefore I'm requesting landing this `-Z pre-link-arg` flag as an experimental\nfeature to evaluate these two options.\n\ncc @brson\nr? @alexcrichton", "tree": {"sha": "e503370eab830229d113e79fcfa219bb8215fd6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e503370eab830229d113e79fcfa219bb8215fd6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "html_url": "https://github.com/rust-lang/rust/commit/8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8292136fb0fd77aab00f28df7f6b1ae06c5167e9/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04b07798fcc4344e19a5f88d9345c35091557405", "url": "https://api.github.com/repos/rust-lang/rust/commits/04b07798fcc4344e19a5f88d9345c35091557405", "html_url": "https://github.com/rust-lang/rust/commit/04b07798fcc4344e19a5f88d9345c35091557405"}, {"sha": "94d2c43300148d5c0ea8c93cedb94151953dcf83", "url": "https://api.github.com/repos/rust-lang/rust/commits/94d2c43300148d5c0ea8c93cedb94151953dcf83", "html_url": "https://github.com/rust-lang/rust/commit/94d2c43300148d5c0ea8c93cedb94151953dcf83"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "7cb5f2510d5c7acdc363048165bca73f44d2d85d", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8292136fb0fd77aab00f28df7f6b1ae06c5167e9/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8292136fb0fd77aab00f28df7f6b1ae06c5167e9/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "patch": "@@ -824,9 +824,9 @@ options! {CodegenOptions, CodegenSetter, basic_codegen_options,\n     linker: Option<String> = (None, parse_opt_string, [UNTRACKED],\n         \"system linker to link outputs with\"),\n     link_arg: Vec<String> = (vec![], parse_string_push, [UNTRACKED],\n-        \"a single extra argument to pass to the linker (can be used several times)\"),\n+        \"a single extra argument to append to the linker invocation (can be used several times)\"),\n     link_args: Option<Vec<String>> = (None, parse_opt_list, [UNTRACKED],\n-        \"extra arguments to pass to the linker (space separated)\"),\n+        \"extra arguments to append to the linker invocation (space separated)\"),\n     link_dead_code: bool = (false, parse_bool, [UNTRACKED],\n         \"don't let linker strip dead code (turning it on can be used for code coverage)\"),\n     lto: bool = (false, parse_bool, [TRACKED],\n@@ -1029,6 +1029,10 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"add a mapping target to the file path remapping config\"),\n     force_unstable_if_unmarked: bool = (false, parse_bool, [TRACKED],\n         \"force all crates to be `rustc_private` unstable\"),\n+    pre_link_arg: Vec<String> = (vec![], parse_string_push, [UNTRACKED],\n+        \"a single extra argument to prepend the linker invocation (can be used several times)\"),\n+    pre_link_args: Option<Vec<String>> = (None, parse_opt_list, [UNTRACKED],\n+        \"extra arguments to prepend to the linker invocation (space separated)\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "f85d3f9f54dfd7cd8b63ad152089bfa10e10eca0", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8292136fb0fd77aab00f28df7f6b1ae06c5167e9/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8292136fb0fd77aab00f28df7f6b1ae06c5167e9/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=8292136fb0fd77aab00f28df7f6b1ae06c5167e9", "patch": "@@ -715,6 +715,10 @@ fn link_natively(sess: &Session,\n     if let Some(args) = sess.target.target.options.pre_link_args.get(&flavor) {\n         cmd.args(args);\n     }\n+    if let Some(ref args) = sess.opts.debugging_opts.pre_link_args {\n+        cmd.args(args);\n+    }\n+    cmd.args(&sess.opts.debugging_opts.pre_link_arg);\n \n     let pre_link_objects = if crate_type == config::CrateTypeExecutable {\n         &sess.target.target.options.pre_link_objects_exe"}]}