{"sha": "73e2fe0494cd91565f2f836af59b2fa37ab3ebdd", "node_id": "C_kwDOAAsO6NoAKDczZTJmZTA0OTRjZDkxNTY1ZjJmODM2YWY1OWIyZmEzN2FiM2ViZGQ", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-02-28T16:13:31Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2023-03-01T17:13:41Z"}, "message": "Properly implement should_encode_fn_impl_trait_in_trait using new unstable option", "tree": {"sha": "77b9fa7f6942ad048cdf3874b55ba75f7a4145f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77b9fa7f6942ad048cdf3874b55ba75f7a4145f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF0ntrgrd9qf9uuThgTGiTgx5768FAmP/h8cACgkQgTGiTgx5\n76+DnRAAts1bXxSqnkZsHswcrmF9RHu8imnWs7M+CZqGzhNhPJYLdTjl4J+tB4+e\nC2AJVno5KCxb5LyVGyU9klVc/aVqTqEAaH3cAuNIn9Cs2Us5kP0VZxygSoi1gb73\n1biYnMffAi/ODeelg9F1iW/11r0DPiggBSMG3BbSt3439KBAMKkqN2qU7lf73pGW\nv+T2LNbbWKI1rmbL6iJDdqid2BiksTIxRI9UzOx0UvmHKh/72DzuhwJOk5k4l5+q\nYSpC6rx6xtb96vHvT0E+6Ymp4N4bjj5ksL2Dzoz1SfKvgvxjcanbyl7KcyAsgb2W\nZedZLjjYkaXe4SWcePiDtUBSTQWr+SLtfvcS7ctbk1gsECBugvVd1PH6sEUdtzTS\nJac7zanyzkchqF3hwWbHpO/Ib7bleeKvv3bPxb30Oev5wjapL5R/Ls2gHmqlb/3z\ndb12ZCDA6mebUdps8bbp6pU822qHtnLQheUPjPHtNUFPxG3vlauPObVm4x+u2cTk\n2K/XJ2ZER44CG6hlgRxU9MZBeuodoDGCtybrUo6TKSVDKUaQfv60lUwuiTiY63U7\nWVr3zTbMTyIxoPDOYFc0blE+NN18A6fXxQD6fbTPQa1Eg73ou1V2ZwEDDYTDI8R+\nLE5X3uknRO1s27daQxj8sfbvP8HsB791eMFBfD4ol+8xDpBoAac=\n=43gA\n-----END PGP SIGNATURE-----", "payload": "tree 77b9fa7f6942ad048cdf3874b55ba75f7a4145f7\nparent 811a1cabda19ea4d6c6636e43dc760a3fcc685fd\nauthor Santiago Pastorino <spastorino@gmail.com> 1677600811 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1677690821 -0300\n\nProperly implement should_encode_fn_impl_trait_in_trait using new unstable option\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd", "html_url": "https://github.com/rust-lang/rust/commit/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "811a1cabda19ea4d6c6636e43dc760a3fcc685fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/811a1cabda19ea4d6c6636e43dc760a3fcc685fd", "html_url": "https://github.com/rust-lang/rust/commit/811a1cabda19ea4d6c6636e43dc760a3fcc685fd"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "ccb07804b9661d9415965592f86525b77bc3197b", "filename": "compiler/rustc_metadata/src/rmeta/encoder.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73e2fe0494cd91565f2f836af59b2fa37ab3ebdd/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs?ref=73e2fe0494cd91565f2f836af59b2fa37ab3ebdd", "patch": "@@ -1101,9 +1101,18 @@ fn should_encode_const(def_kind: DefKind) -> bool {\n     }\n }\n \n-// Return `false` to avoid encoding impl trait in trait, while we don't use the query.\n-fn should_encode_fn_impl_trait_in_trait<'tcx>(_tcx: TyCtxt<'tcx>, _def_id: DefId) -> bool {\n-    false\n+// We only encode impl trait in trait when using `lower-impl-trait-in-trait-to-assoc-ty` unstable\n+// option.\n+fn should_encode_fn_impl_trait_in_trait<'tcx>(tcx: TyCtxt<'tcx>, def_id: DefId) -> bool {\n+    if tcx.sess.opts.unstable_opts.lower_impl_trait_in_trait_to_assoc_ty\n+        && let Some(assoc_item) = tcx.opt_associated_item(def_id)\n+        && assoc_item.container == ty::AssocItemContainer::TraitContainer\n+        && assoc_item.kind == ty::AssocKind::Fn\n+    {\n+        true\n+    } else {\n+        false\n+    }\n }\n \n impl<'a, 'tcx> EncodeContext<'a, 'tcx> {"}]}