{"sha": "a25f939170bb73d813c5eb4cbed631253ba0cc15", "node_id": "C_kwDOAAsO6NoAKGEyNWY5MzkxNzBiYjczZDgxM2M1ZWI0Y2JlZDYzMTI1M2JhMGNjMTU", "commit": {"author": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-10-04T17:25:13Z"}, "committer": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-10-07T14:03:45Z"}, "message": "Address PR comments\n\n- UPDATE - revert migration of logs\n\n- UPDATE - use derive on LinkRlibError enum\n\n- [Gardening] UPDATE - alphabetically sort fluent_messages\n\n- UPDATE - use PathBuf and unify both AddNativeLibrary to use Display (which is what PathBuf uses when conforming to IntoDiagnosticArg)\n\n- UPDATE - fluent messages sort after rebase", "tree": {"sha": "0b0504b2d0489e200e94b63e2a3949834b4649d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b0504b2d0489e200e94b63e2a3949834b4649d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a25f939170bb73d813c5eb4cbed631253ba0cc15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a25f939170bb73d813c5eb4cbed631253ba0cc15", "html_url": "https://github.com/rust-lang/rust/commit/a25f939170bb73d813c5eb4cbed631253ba0cc15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a25f939170bb73d813c5eb4cbed631253ba0cc15/comments", "author": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12aa84bdf3231f563b7f86186dbece2023d1235a", "url": "https://api.github.com/repos/rust-lang/rust/commits/12aa84bdf3231f563b7f86186dbece2023d1235a", "html_url": "https://github.com/rust-lang/rust/commit/12aa84bdf3231f563b7f86186dbece2023d1235a"}], "stats": {"total": 68, "additions": 15, "deletions": 53}, "files": [{"sha": "e798fb421df3179870486ce416728585f85f15ff", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=a25f939170bb73d813c5eb4cbed631253ba0cc15", "patch": "@@ -362,10 +362,7 @@ fn link_rlib<'a>(\n                 continue;\n             }\n             ab.add_archive(&location, Box::new(|_| false)).unwrap_or_else(|error| {\n-                sess.emit_fatal(errors::AddNativeLibrary {\n-                    library_path: &location.to_string_lossy(),\n-                    error,\n-                });\n+                sess.emit_fatal(errors::AddNativeLibrary { library_path: location, error });\n             });\n         }\n     }\n@@ -381,10 +378,7 @@ fn link_rlib<'a>(\n         );\n \n         ab.add_archive(&output_path, Box::new(|_| false)).unwrap_or_else(|error| {\n-            sess.emit_fatal(errors::AddNativeLibrary {\n-                library_path: &output_path.display().to_string(),\n-                error,\n-            });\n+            sess.emit_fatal(errors::AddNativeLibrary { library_path: output_path, error });\n         });\n     }\n "}, {"sha": "bad22ccb1fedd7dcb105e41acc12c750c73b12e4", "filename": "compiler/rustc_codegen_ssa/src/back/linker.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs?ref=a25f939170bb73d813c5eb4cbed631253ba0cc15", "patch": "@@ -91,13 +91,13 @@ pub fn get_linker<'a>(\n                     arg.push(format!(\"{}\\\\lib\\\\{}\\\\store\", root_lib_path.display(), a));\n                     cmd.arg(&arg);\n                 } else {\n-                    sess.emit_warning(errors::UnsupportedArch);\n+                    warn!(\"arch is not supported\");\n                 }\n             } else {\n-                sess.emit_warning(errors::MsvcPathNotFound);\n+                warn!(\"MSVC root path lib location not found\");\n             }\n         } else {\n-            sess.emit_warning(errors::LinkExeNotFound);\n+            warn!(\"link.exe not found\");\n         }\n     }\n "}, {"sha": "bd399ffb5a6f93511d922fe7499cad22e55542de", "filename": "compiler/rustc_codegen_ssa/src/errors.rs", "status": "modified", "additions": 8, "deletions": 34, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs?ref=a25f939170bb73d813c5eb4cbed631253ba0cc15", "patch": "@@ -30,18 +30,6 @@ pub struct SymbolFileWriteFailure {\n     pub error: Error,\n }\n \n-#[derive(Diagnostic)]\n-#[diag(codegen_ssa::unsupported_arch)]\n-pub struct UnsupportedArch;\n-\n-#[derive(Diagnostic)]\n-#[diag(codegen_ssa::msvc_path_not_found)]\n-pub struct MsvcPathNotFound;\n-\n-#[derive(Diagnostic)]\n-#[diag(codegen_ssa::link_exe_not_found)]\n-pub struct LinkExeNotFound;\n-\n #[derive(Diagnostic)]\n #[diag(codegen_ssa::ld64_unimplemented_modifier)]\n pub struct Ld64UnimplementedModifier;\n@@ -115,8 +103,8 @@ pub struct IncompatibleLinkingModifiers;\n \n #[derive(Diagnostic)]\n #[diag(codegen_ssa::add_native_library)]\n-pub struct AddNativeLibrary<'a> {\n-    pub library_path: &'a str,\n+pub struct AddNativeLibrary {\n+    pub library_path: PathBuf,\n     pub error: Error,\n }\n \n@@ -129,30 +117,16 @@ pub struct MultipleExternalFuncDecl<'a> {\n     pub library_name: &'a str,\n }\n \n+#[derive(Diagnostic)]\n pub enum LinkRlibError {\n+    #[diag(codegen_ssa::rlib_missing_format)]\n     MissingFormat,\n+\n+    #[diag(codegen_ssa::rlib_only_rmeta_found)]\n     OnlyRmetaFound { crate_name: Symbol },\n-    NotFound { crate_name: Symbol },\n-}\n \n-impl IntoDiagnostic<'_, !> for LinkRlibError {\n-    fn into_diagnostic(self, handler: &Handler) -> DiagnosticBuilder<'_, !> {\n-        match self {\n-            LinkRlibError::MissingFormat => {\n-                handler.struct_fatal(fluent::codegen_ssa::rlib_missing_format)\n-            }\n-            LinkRlibError::OnlyRmetaFound { crate_name } => {\n-                let mut diag = handler.struct_fatal(fluent::codegen_ssa::rlib_only_rmeta_found);\n-                diag.set_arg(\"crate_name\", crate_name);\n-                diag\n-            }\n-            LinkRlibError::NotFound { crate_name } => {\n-                let mut diag = handler.struct_fatal(fluent::codegen_ssa::rlib_not_found);\n-                diag.set_arg(\"crate_name\", crate_name);\n-                diag\n-            }\n-        }\n-    }\n+    #[diag(codegen_ssa::rlib_not_found)]\n+    NotFound { crate_name: Symbol },\n }\n \n #[derive(Diagnostic)]"}, {"sha": "99ddf6842dab874fee0908c54b6de1b0aa422efe", "filename": "compiler/rustc_error_messages/locales/en-US/codegen_ssa.ftl", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl?ref=a25f939170bb73d813c5eb4cbed631253ba0cc15", "patch": "@@ -4,12 +4,6 @@ codegen_ssa_version_script_write_failure = failed to write version script: {$err\n \n codegen_ssa_symbol_file_write_failure = failed to write symbols file: {$error}\n \n-codegen_ssa_unsupported_arch = arch is not supported\n-\n-codegen_ssa_msvc_path_not_found = MSVC root path lib location not found\n-\n-codegen_ssa_link_exe_not_found = link.exe not found\n-\n codegen_ssa_ld64_unimplemented_modifier = `as-needed` modifier not implemented yet for ld64\n \n codegen_ssa_linker_unsupported_modifier = `as-needed` modifier not supported for current linker"}, {"sha": "77f87d5b007e3fc2d4a5cdb188da16c59be0e83b", "filename": "compiler/rustc_error_messages/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a25f939170bb73d813c5eb4cbed631253ba0cc15/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs?ref=a25f939170bb73d813c5eb4cbed631253ba0cc15", "patch": "@@ -40,9 +40,10 @@ fluent_messages! {\n     attr => \"../locales/en-US/attr.ftl\",\n     borrowck => \"../locales/en-US/borrowck.ftl\",\n     builtin_macros => \"../locales/en-US/builtin_macros.ftl\",\n+    codegen_gcc => \"../locales/en-US/codegen_gcc.ftl\",\n+    codegen_ssa => \"../locales/en-US/codegen_ssa.ftl\",\n     compiletest => \"../locales/en-US/compiletest.ftl\",\n     const_eval => \"../locales/en-US/const_eval.ftl\",\n-    codegen_gcc => \"../locales/en-US/codegen_gcc.ftl\",\n     driver => \"../locales/en-US/driver.ftl\",\n     expand => \"../locales/en-US/expand.ftl\",\n     hir_analysis => \"../locales/en-US/hir_analysis.ftl\",\n@@ -63,7 +64,6 @@ fluent_messages! {\n     symbol_mangling => \"../locales/en-US/symbol_mangling.ftl\",\n     trait_selection => \"../locales/en-US/trait_selection.ftl\",\n     ty_utils => \"../locales/en-US/ty_utils.ftl\",\n-    codegen_ssa => \"../locales/en-US/codegen_ssa.ftl\",\n }\n \n pub use fluent_generated::{self as fluent, DEFAULT_LOCALE_RESOURCES};"}]}