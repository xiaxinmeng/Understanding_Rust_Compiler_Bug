{"sha": "e67cd766f750ddf377ad13552c68465861b09715", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2N2NkNzY2Zjc1MGRkZjM3N2FkMTM1NTJjNjg0NjU4NjFiMDk3MTU=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-07-15T14:36:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-15T14:36:22Z"}, "message": "Merge #9604\n\n9604: fix: Don't fold consecutive modules with item lists r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "91acf6f5dc90ff5e97593893c5a73fa52953a0e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/91acf6f5dc90ff5e97593893c5a73fa52953a0e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e67cd766f750ddf377ad13552c68465861b09715", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg8EfmCRBK7hj4Ov3rIwAAFpoIAEw2TIQOrjFQr+h9n1MY+C8y\nrDV9LUyWBWqbcETYU3YY/7XFsACDApzDGyUjK4rDyCFcMgUjzEJY52ssyZVkiMas\n2l/c6v+vq5wxMUaHz/OM2VP3NNBtFmQRjtB0pipLG+g4ZPCGwzA8yINX4Tcirt6p\nijo4zjkfYdlb+Zmi99v9CZX0QpthKgwj13tdVtlI+po8XVR0wS304brqinSt7JXe\nOTe9Bl8IZayZvOhmcYqmLP9fU8elBoRcVmOfJVXW67ncTzzgZVLBQUsAs5qAsJ+J\nudqZHOdBgqaIQL9bsMQFYZ69QvP39qQ24EYLEY/12UMk/EiDm8sbGE2ukTWyUr4=\n=38Z7\n-----END PGP SIGNATURE-----\n", "payload": "tree 91acf6f5dc90ff5e97593893c5a73fa52953a0e9\nparent f0da190f17faddd5ebb55ba3d940c334b01bd77f\nparent 658514d378ffcf3c3c028138aede860f75268729\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1626359782 +0000\ncommitter GitHub <noreply@github.com> 1626359782 +0000\n\nMerge #9604\n\n9604: fix: Don't fold consecutive modules with item lists r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e67cd766f750ddf377ad13552c68465861b09715", "html_url": "https://github.com/rust-lang/rust/commit/e67cd766f750ddf377ad13552c68465861b09715", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e67cd766f750ddf377ad13552c68465861b09715/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0da190f17faddd5ebb55ba3d940c334b01bd77f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0da190f17faddd5ebb55ba3d940c334b01bd77f", "html_url": "https://github.com/rust-lang/rust/commit/f0da190f17faddd5ebb55ba3d940c334b01bd77f"}, {"sha": "658514d378ffcf3c3c028138aede860f75268729", "url": "https://api.github.com/repos/rust-lang/rust/commits/658514d378ffcf3c3c028138aede860f75268729", "html_url": "https://github.com/rust-lang/rust/commit/658514d378ffcf3c3c028138aede860f75268729"}], "stats": {"total": 46, "additions": 26, "deletions": 20}, "files": [{"sha": "60f552fd92b0770f4fd74519128a6202c365670e", "filename": "crates/ide/src/folding_ranges.rs", "status": "modified", "additions": 26, "deletions": 20, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/e67cd766f750ddf377ad13552c68465861b09715/crates%2Fide%2Fsrc%2Ffolding_ranges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e67cd766f750ddf377ad13552c68465861b09715/crates%2Fide%2Fsrc%2Ffolding_ranges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Ffolding_ranges.rs?ref=e67cd766f750ddf377ad13552c68465861b09715", "patch": "@@ -92,12 +92,18 @@ pub(crate) fn folding_ranges(file: &SourceFile) -> Vec<Fold> {\n                 }\n \n                 // Fold groups of mods\n-                if node.kind() == MODULE && !has_visibility(&node) && !visited_mods.contains(&node)\n-                {\n-                    if let Some(range) =\n-                        contiguous_range_for_group_unless(&node, has_visibility, &mut visited_mods)\n+                if let Some(module) = ast::Module::cast(node.clone()) {\n+                    if !has_visibility(&node)\n+                        && !visited_mods.contains(&node)\n+                        && module.item_list().is_none()\n                     {\n-                        res.push(Fold { range, kind: FoldKind::Mods })\n+                        if let Some(range) = contiguous_range_for_group_unless(\n+                            &node,\n+                            has_visibility,\n+                            &mut visited_mods,\n+                        ) {\n+                            res.push(Fold { range, kind: FoldKind::Mods })\n+                        }\n                     }\n                 }\n \n@@ -328,7 +334,8 @@ fn main() <fold block>{\n     //! because it has another flavor</fold>\n     <fold comment>/* As does this\n     multiline comment */</fold>\n-}</fold>\"#,\n+}</fold>\n+\"#,\n         );\n     }\n \n@@ -341,9 +348,7 @@ use std::<fold block>{\n     vec,\n     io as iop\n }</fold>;\n-\n-fn main() <fold block>{\n-}</fold>\"#,\n+\"#,\n         );\n     }\n \n@@ -368,8 +373,13 @@ pub not_folding_single_next;\n mod with_attribute;\n mod with_attribute_next;</fold>\n \n-fn main() <fold block>{\n-}</fold>\"#,\n+mod inline0 {}\n+mod inline1 {}\n+\n+mod inline2 <fold block>{\n+\n+}</fold>\n+\"#,\n         );\n     }\n \n@@ -387,9 +397,7 @@ use std::f64;</fold>\n <fold imports>use std::collections::HashMap;\n // Some random comment\n use std::collections::VecDeque;</fold>\n-\n-fn main() <fold block>{\n-}</fold>\"#,\n+\"#,\n         );\n     }\n \n@@ -409,9 +417,7 @@ use std::collections::<fold block>{\n     VecDeque,\n }</fold>;\n // Some random comment\n-\n-fn main() <fold block>{\n-}</fold>\"#,\n+\"#,\n         );\n     }\n \n@@ -531,7 +537,7 @@ calling_function(x,y);\n             r#\"\n <fold consts>const FIRST_CONST: &str = \"first\";\n const SECOND_CONST: &str = \"second\";</fold>\n-            \"#,\n+\"#,\n         )\n     }\n \n@@ -541,7 +547,7 @@ const SECOND_CONST: &str = \"second\";</fold>\n             r#\"\n <fold statics>static FIRST_STATIC: &str = \"first\";\n static SECOND_STATIC: &str = \"second\";</fold>\n-            \"#,\n+\"#,\n         )\n     }\n \n@@ -574,7 +580,7 @@ fn foo()<fold returntype>-> (\n )</fold> { (true, true) }\n \n fn bar() -> (bool, bool) { (true, true) }\n-            \"#,\n+\"#,\n         )\n     }\n }"}]}