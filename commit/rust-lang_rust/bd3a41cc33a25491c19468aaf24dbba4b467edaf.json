{"sha": "bd3a41cc33a25491c19468aaf24dbba4b467edaf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkM2E0MWNjMzNhMjU0OTFjMTk0NjhhYWYyNGRiYmE0YjQ2N2VkYWY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-14T14:29:19Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-14T14:29:19Z"}, "message": "Prevent auto-update of dev extension", "tree": {"sha": "59475c5142ee1c1a76f7f087f3646529eb7adfe2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59475c5142ee1c1a76f7f087f3646529eb7adfe2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd3a41cc33a25491c19468aaf24dbba4b467edaf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd3a41cc33a25491c19468aaf24dbba4b467edaf", "html_url": "https://github.com/rust-lang/rust/commit/bd3a41cc33a25491c19468aaf24dbba4b467edaf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd3a41cc33a25491c19468aaf24dbba4b467edaf/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52dcf3243e979bed92413108864a62bad7b83f15", "url": "https://api.github.com/repos/rust-lang/rust/commits/52dcf3243e979bed92413108864a62bad7b83f15", "html_url": "https://github.com/rust-lang/rust/commit/52dcf3243e979bed92413108864a62bad7b83f15"}], "stats": {"total": 30, "additions": 24, "deletions": 6}, "files": [{"sha": "a7a1829dd5cf387392d4597a7dba8c52b81572d2", "filename": "editors/code/package-lock.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bd3a41cc33a25491c19468aaf24dbba4b467edaf/editors%2Fcode%2Fpackage-lock.json", "raw_url": "https://github.com/rust-lang/rust/raw/bd3a41cc33a25491c19468aaf24dbba4b467edaf/editors%2Fcode%2Fpackage-lock.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage-lock.json?ref=bd3a41cc33a25491c19468aaf24dbba4b467edaf", "patch": "@@ -1,6 +1,6 @@\n {\n     \"name\": \"rust-analyzer\",\n-    \"version\": \"0.1.0\",\n+    \"version\": \"0.2.0-dev\",\n     \"lockfileVersion\": 1,\n     \"requires\": true,\n     \"dependencies\": {"}, {"sha": "2b8e5aec5e3b76d4ed23bb4459fc6f233f9cad2b", "filename": "editors/code/package.json", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bd3a41cc33a25491c19468aaf24dbba4b467edaf/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/bd3a41cc33a25491c19468aaf24dbba4b467edaf/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=bd3a41cc33a25491c19468aaf24dbba4b467edaf", "patch": "@@ -5,7 +5,8 @@\n     \"preview\": true,\n     \"private\": true,\n     \"icon\": \"icon.png\",\n-    \"version\": \"0.1.0\",\n+    \"//\": \"The real version is in release.yaml, this one just needs to be bigger\",\n+    \"version\": \"0.2.0-dev\",\n     \"publisher\": \"matklad\",\n     \"repository\": {\n         \"url\": \"https://github.com/rust-analyzer/rust-analyzer.git\","}, {"sha": "9bddc8d7f923d189e637de0ce381f1d8ec18d27e", "filename": "xtask/src/install.rs", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/bd3a41cc33a25491c19468aaf24dbba4b467edaf/xtask%2Fsrc%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd3a41cc33a25491c19468aaf24dbba4b467edaf/xtask%2Fsrc%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Finstall.rs?ref=bd3a41cc33a25491c19468aaf24dbba4b467edaf", "patch": "@@ -1,8 +1,9 @@\n //! Installs rust-analyzer language server and/or editor plugin.\n \n-use std::{env, path::PathBuf, str};\n+use std::{env, fs, path::PathBuf, str};\n \n use anyhow::{bail, format_err, Context, Result};\n+use walkdir::WalkDir;\n \n use crate::cmd::{run, run_with_output, Cmd};\n \n@@ -95,13 +96,29 @@ fn install_client(ClientOpt::VsCode: ClientOpt) -> Result<()> {\n \n     Cmd { unix: r\"npm install\", windows: r\"cmd.exe /c npm install\", work_dir: \"./editors/code\" }\n         .run()?;\n+\n+    let vsixes = || {\n+        WalkDir::new(\"./editors/code\")\n+            .max_depth(1)\n+            .into_iter()\n+            .map(|it| it.unwrap())\n+            .map(|it| it.path().to_owned())\n+            .filter(|it| it.file_name().unwrap_or_default().to_string_lossy().ends_with(\".vsix\"))\n+    };\n+\n+    for path in vsixes() {\n+        fs::remove_file(path)?\n+    }\n+\n     Cmd {\n         unix: r\"npm run package --scripts-prepend-node-path\",\n         windows: r\"cmd.exe /c npm run package\",\n         work_dir: \"./editors/code\",\n     }\n     .run()?;\n \n+    let extension = vsixes().next().unwrap().file_name().unwrap().to_string_lossy().to_string();\n+\n     let code_binary = [\"code\", \"code-insiders\", \"codium\", \"code-oss\"]\n         .iter()\n         .find(|bin| {\n@@ -118,10 +135,10 @@ fn install_client(ClientOpt::VsCode: ClientOpt) -> Result<()> {\n         })?;\n \n     Cmd {\n-        unix: &format!(r\"{} --install-extension ./rust-analyzer-0.1.0.vsix --force\", code_binary),\n+        unix: &format!(r\"{} --install-extension ./{} --force\", code_binary, extension),\n         windows: &format!(\n-            r\"cmd.exe /c {}.cmd --install-extension ./rust-analyzer-0.1.0.vsix --force\",\n-            code_binary\n+            r\"cmd.exe /c {}.cmd --install-extension ./{} --force\",\n+            code_binary, extension\n         ),\n         work_dir: \"./editors/code\",\n     }"}]}