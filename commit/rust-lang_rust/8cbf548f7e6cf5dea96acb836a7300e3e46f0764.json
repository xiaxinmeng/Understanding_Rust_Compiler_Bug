{"sha": "8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjYmY1NDhmN2U2Y2Y1ZGVhOTZhY2I4MzZhNzMwMGUzZTQ2ZjA3NjQ=", "commit": {"author": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2017-01-28T13:02:49Z"}, "committer": {"name": "Pascal Hertleif", "email": "killercup@gmail.com", "date": "2017-01-28T13:02:49Z"}, "message": "Add suggestions to `EXPLICIT_[INTO_]ITER_LOOP`\n\nAlso reduces the highlighted span to the expr containing the\n`.[into_]iter()` call (so the suggestion is probably applicable by\nrustfix.)\n\nFixes #1484", "tree": {"sha": "19a0c392aec5d3744671647a9388f0d58df579e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/19a0c392aec5d3744671647a9388f0d58df579e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "html_url": "https://github.com/rust-lang/rust/commit/8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8cbf548f7e6cf5dea96acb836a7300e3e46f0764/comments", "author": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "committer": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d825f194fdc1f1f9ccdf87bffdc79aacf98fc975", "url": "https://api.github.com/repos/rust-lang/rust/commits/d825f194fdc1f1f9ccdf87bffdc79aacf98fc975", "html_url": "https://github.com/rust-lang/rust/commit/d825f194fdc1f1f9ccdf87bffdc79aacf98fc975"}], "stats": {"total": 123, "additions": 90, "deletions": 33}, "files": [{"sha": "e3492fd00f75cfd7c4b451dfc05ceb229f257e24", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 29, "deletions": 19, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/8cbf548f7e6cf5dea96acb836a7300e3e46f0764/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8cbf548f7e6cf5dea96acb836a7300e3e46f0764/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "patch": "@@ -588,28 +588,38 @@ fn check_for_loop_arg(cx: &LateContext, pat: &Pat, arg: &Expr, expr: &Expr) {\n             if &*method_name.as_str() == \"iter\" || &*method_name.as_str() == \"iter_mut\" {\n                 if is_ref_iterable_type(cx, &args[0]) {\n                     let object = snippet(cx, args[0].span, \"_\");\n-                    span_lint(cx,\n-                              EXPLICIT_ITER_LOOP,\n-                              expr.span,\n-                              &format!(\"it is more idiomatic to loop over `&{}{}` instead of `{}.{}()`\",\n-                                       if &*method_name.as_str() == \"iter_mut\" {\n-                                           \"mut \"\n-                                       } else {\n-                                           \"\"\n-                                       },\n-                                       object,\n-                                       object,\n-                                       method_name));\n+                    let suggestion = format!(\"&{}{}\",\n+                                             if &*method_name.as_str() == \"iter_mut\" {\n+                                                 \"mut \"\n+                                             } else {\n+                                                 \"\"\n+                                             },\n+                                             object);\n+                    span_lint_and_then(cx,\n+                                       EXPLICIT_ITER_LOOP,\n+                                       arg.span,\n+                                       &format!(\"it is more idiomatic to loop over `{}` instead of `{}.{}()`\",\n+                                                suggestion,\n+                                                object,\n+                                                method_name),\n+                                       |db| {\n+                        db.span_suggestion(arg.span, \"to write this more concisely, try looping over\", suggestion);\n+                    });\n                 }\n             } else if &*method_name.as_str() == \"into_iter\" && match_trait_method(cx, arg, &paths::INTO_ITERATOR) {\n                 let object = snippet(cx, args[0].span, \"_\");\n-                span_lint(cx,\n-                          EXPLICIT_INTO_ITER_LOOP,\n-                          expr.span,\n-                          &format!(\"it is more idiomatic to loop over `{}` instead of `{}.{}()`\",\n-                                   object,\n-                                   object,\n-                                   method_name));\n+                span_lint_and_then(cx,\n+                                   EXPLICIT_INTO_ITER_LOOP,\n+                                   arg.span,\n+                                   &format!(\"it is more idiomatic to loop over `{}` instead of `{}.{}()`\",\n+                                            object,\n+                                            object,\n+                                            method_name),\n+                                   |db| {\n+                    db.span_suggestion(arg.span,\n+                                       \"to write this more concisely, try looping over\",\n+                                       object.to_string());\n+                });\n \n             } else if &*method_name.as_str() == \"next\" && match_trait_method(cx, arg, &paths::ITERATOR) {\n                 span_lint(cx,"}, {"sha": "5e13b7783291fa3182ad83ee4350bf5ea4c9965f", "filename": "tests/compile-fail/for_loop.rs", "status": "modified", "additions": 61, "deletions": 14, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/8cbf548f7e6cf5dea96acb836a7300e3e46f0764/tests%2Fcompile-fail%2Ffor_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8cbf548f7e6cf5dea96acb836a7300e3e46f0764/tests%2Fcompile-fail%2Ffor_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Ffor_loop.rs?ref=8cbf548f7e6cf5dea96acb836a7300e3e46f0764", "patch": "@@ -286,39 +286,86 @@ fn main() {\n         id_col[i] = 1f64;\n     }\n \n-    /*\n+    // This is fine.\n     for i in (10..0).map(|x| x * 2) {\n         println!(\"{}\", i);\n-    }*/\n+    }\n \n-    for _v in vec.iter() { } //~ERROR it is more idiomatic to loop over `&vec`\n-    for _v in vec.iter_mut() { } //~ERROR it is more idiomatic to loop over `&mut vec`\n+    for _v in vec.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&vec`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &vec\n \n+    for _v in vec.iter_mut() { }\n+    //~^ ERROR it is more idiomatic to loop over `&mut vec`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION vec\n \n     let out_vec = vec![1,2,3];\n-    for _v in out_vec.into_iter() { } //~ERROR it is more idiomatic to loop over `out_vec` instead of `out_vec.into_iter()`\n+    for _v in out_vec.into_iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `out_vec` instead of `out_vec.into_iter()`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION out_vec\n \n     for _v in &vec { } // these are fine\n     for _v in &mut vec { } // these are fine\n \n-    for _v in [1, 2, 3].iter() { } //~ERROR it is more idiomatic to loop over `&[\n+    for _v in [1, 2, 3].iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&[\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &[1, 2, 3]\n+\n     for _v in (&mut [1, 2, 3]).iter() { } // no error\n-    for _v in [0; 32].iter() {} //~ERROR it is more idiomatic to loop over `&[\n+\n+    for _v in [0; 32].iter() {}\n+    //~^ ERROR it is more idiomatic to loop over `&[\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &[0; 32]\n+\n     for _v in [0; 33].iter() {} // no error\n+\n     let ll: LinkedList<()> = LinkedList::new();\n-    for _v in ll.iter() { } //~ERROR it is more idiomatic to loop over `&ll`\n+    for _v in ll.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&ll`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &ll\n+\n     let vd: VecDeque<()> = VecDeque::new();\n-    for _v in vd.iter() { } //~ERROR it is more idiomatic to loop over `&vd`\n+    for _v in vd.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&vd`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &vd\n+\n     let bh: BinaryHeap<()> = BinaryHeap::new();\n-    for _v in bh.iter() { } //~ERROR it is more idiomatic to loop over `&bh`\n+    for _v in bh.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&bh`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &bh\n+\n     let hm: HashMap<(), ()> = HashMap::new();\n-    for _v in hm.iter() { } //~ERROR it is more idiomatic to loop over `&hm`\n+    for _v in hm.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&hm`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &hm\n+\n     let bt: BTreeMap<(), ()> = BTreeMap::new();\n-    for _v in bt.iter() { } //~ERROR it is more idiomatic to loop over `&bt`\n+    for _v in bt.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&bt`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &bt\n+\n     let hs: HashSet<()> = HashSet::new();\n-    for _v in hs.iter() { } //~ERROR it is more idiomatic to loop over `&hs`\n+    for _v in hs.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&hs`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &hs\n+\n     let bs: BTreeSet<()> = BTreeSet::new();\n-    for _v in bs.iter() { } //~ERROR it is more idiomatic to loop over `&bs`\n+    for _v in bs.iter() { }\n+    //~^ ERROR it is more idiomatic to loop over `&bs`\n+    //~| HELP to write this more concisely, try looping over\n+    //~| SUGGESTION &bs\n+\n \n     for _v in vec.iter().next() { } //~ERROR you are iterating over `Iterator::next()`\n "}]}