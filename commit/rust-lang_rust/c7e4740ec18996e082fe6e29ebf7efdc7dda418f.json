{"sha": "c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "node_id": "C_kwDOAAsO6NoAKGM3ZTQ3NDBlYzE4OTk2ZTA4MmZlNmUyOWViZjdlZmRjN2RkYTQxOGY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-31T15:45:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-31T15:45:39Z"}, "message": "Auto merge of #86336 - camsteffen:char-array-pattern, r=joshtriplett\n\nimpl Pattern for char array\n\nCloses #39511\nCloses #86329", "tree": {"sha": "ce985db1c3f3cb7ef1b5ffb73d573ee9d3157dc4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce985db1c3f3cb7ef1b5ffb73d573ee9d3157dc4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "html_url": "https://github.com/rust-lang/rust/commit/c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7e4740ec18996e082fe6e29ebf7efdc7dda418f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68b554e6af18726fe6fa8de2134c59c441e0b019", "url": "https://api.github.com/repos/rust-lang/rust/commits/68b554e6af18726fe6fa8de2134c59c441e0b019", "html_url": "https://github.com/rust-lang/rust/commit/68b554e6af18726fe6fa8de2134c59c441e0b019"}, {"sha": "28f7890a29bd9531fb91295bc130a911820e9fb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/28f7890a29bd9531fb91295bc130a911820e9fb6", "html_url": "https://github.com/rust-lang/rust/commit/28f7890a29bd9531fb91295bc130a911820e9fb6"}], "stats": {"total": 73, "additions": 73, "deletions": 0}, "files": [{"sha": "031fb8e8b21fb8f853c859faf75b11ff801a438a", "filename": "library/core/src/str/pattern.rs", "status": "modified", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/c7e4740ec18996e082fe6e29ebf7efdc7dda418f/library%2Fcore%2Fsrc%2Fstr%2Fpattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e4740ec18996e082fe6e29ebf7efdc7dda418f/library%2Fcore%2Fsrc%2Fstr%2Fpattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fstr%2Fpattern.rs?ref=c7e4740ec18996e082fe6e29ebf7efdc7dda418f", "patch": "@@ -22,6 +22,8 @@\n //! assert_eq!(s.find(\"you\"), Some(4));\n //! // char pattern\n //! assert_eq!(s.find('n'), Some(2));\n+//! // array of chars pattern\n+//! assert_eq!(s.find(&['a', 'e', 'i', 'o', 'u']), Some(1));\n //! // slice of chars pattern\n //! assert_eq!(s.find(&['a', 'e', 'i', 'o', 'u'][..]), Some(1));\n //! // closure pattern\n@@ -79,6 +81,11 @@ use crate::slice::memchr;\n /// assert_eq!(\"abaaa\".find('b'), Some(1));\n /// assert_eq!(\"abaaa\".find('c'), None);\n ///\n+/// // &[char; N]\n+/// assert_eq!(\"ab\".find(&['b', 'a']), Some(0));\n+/// assert_eq!(\"abaaa\".find(&['a', 'z']), Some(0));\n+/// assert_eq!(\"abaaa\".find(&['c', 'd']), None);\n+///\n /// // &[char]\n /// assert_eq!(\"ab\".find(&['b', 'a'][..]), Some(0));\n /// assert_eq!(\"abaaa\".find(&['a', 'z'][..]), Some(0));\n@@ -601,6 +608,20 @@ where\n     }\n }\n \n+impl<const N: usize> MultiCharEq for [char; N] {\n+    #[inline]\n+    fn matches(&mut self, c: char) -> bool {\n+        self.iter().any(|&m| m == c)\n+    }\n+}\n+\n+impl<const N: usize> MultiCharEq for &[char; N] {\n+    #[inline]\n+    fn matches(&mut self, c: char) -> bool {\n+        self.iter().any(|&m| m == c)\n+    }\n+}\n+\n impl MultiCharEq for &[char] {\n     #[inline]\n     fn matches(&mut self, c: char) -> bool {\n@@ -752,6 +773,58 @@ macro_rules! searcher_methods {\n     };\n }\n \n+/// Associated type for `<[char; N] as Pattern<'a>>::Searcher`.\n+#[derive(Clone, Debug)]\n+pub struct CharArraySearcher<'a, const N: usize>(\n+    <MultiCharEqPattern<[char; N]> as Pattern<'a>>::Searcher,\n+);\n+\n+/// Associated type for `<&[char; N] as Pattern<'a>>::Searcher`.\n+#[derive(Clone, Debug)]\n+pub struct CharArrayRefSearcher<'a, 'b, const N: usize>(\n+    <MultiCharEqPattern<&'b [char; N]> as Pattern<'a>>::Searcher,\n+);\n+\n+/// Searches for chars that are equal to any of the [`char`]s in the array.\n+///\n+/// # Examples\n+///\n+/// ```\n+/// assert_eq!(\"Hello world\".find(['l', 'l']), Some(2));\n+/// assert_eq!(\"Hello world\".find(['l', 'l']), Some(2));\n+/// ```\n+impl<'a, const N: usize> Pattern<'a> for [char; N] {\n+    pattern_methods!(CharArraySearcher<'a, N>, MultiCharEqPattern, CharArraySearcher);\n+}\n+\n+unsafe impl<'a, const N: usize> Searcher<'a> for CharArraySearcher<'a, N> {\n+    searcher_methods!(forward);\n+}\n+\n+unsafe impl<'a, const N: usize> ReverseSearcher<'a> for CharArraySearcher<'a, N> {\n+    searcher_methods!(reverse);\n+}\n+\n+/// Searches for chars that are equal to any of the [`char`]s in the array.\n+///\n+/// # Examples\n+///\n+/// ```\n+/// assert_eq!(\"Hello world\".find(&['l', 'l']), Some(2));\n+/// assert_eq!(\"Hello world\".find(&['l', 'l']), Some(2));\n+/// ```\n+impl<'a, 'b, const N: usize> Pattern<'a> for &'b [char; N] {\n+    pattern_methods!(CharArrayRefSearcher<'a, 'b, N>, MultiCharEqPattern, CharArrayRefSearcher);\n+}\n+\n+unsafe impl<'a, 'b, const N: usize> Searcher<'a> for CharArrayRefSearcher<'a, 'b, N> {\n+    searcher_methods!(forward);\n+}\n+\n+unsafe impl<'a, 'b, const N: usize> ReverseSearcher<'a> for CharArrayRefSearcher<'a, 'b, N> {\n+    searcher_methods!(reverse);\n+}\n+\n /////////////////////////////////////////////////////////////////////////////\n // Impl for &[char]\n /////////////////////////////////////////////////////////////////////////////"}]}