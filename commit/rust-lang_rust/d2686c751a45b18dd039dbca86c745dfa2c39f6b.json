{"sha": "d2686c751a45b18dd039dbca86c745dfa2c39f6b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyNjg2Yzc1MWE0NWIxOGRkMDM5ZGJjYTg2Yzc0NWRmYTJjMzlmNmI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-31T07:05:41Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-03-31T07:10:13Z"}, "message": "mk: Workaround distcheck failure on mac. #13224\n\nMac can't actually build our source tarballs because it's `tar`\ncommand doesn't support the --exclude-vcs flag. This is just\na workaround to make our mac nightlies work (we get our source\ntarballs from the linux bot).", "tree": {"sha": "f8dc4a69ec29e186829c6d21c474c6030ace3daf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8dc4a69ec29e186829c6d21c474c6030ace3daf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2686c751a45b18dd039dbca86c745dfa2c39f6b", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2686c751a45b18dd039dbca86c745dfa2c39f6b", "html_url": "https://github.com/rust-lang/rust/commit/d2686c751a45b18dd039dbca86c745dfa2c39f6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2686c751a45b18dd039dbca86c745dfa2c39f6b/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84e9c0692ab7b42fb3b25ab602a766c0e74a3c71", "url": "https://api.github.com/repos/rust-lang/rust/commits/84e9c0692ab7b42fb3b25ab602a766c0e74a3c71", "html_url": "https://github.com/rust-lang/rust/commit/84e9c0692ab7b42fb3b25ab602a766c0e74a3c71"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "8679aeed04f69584a5f27fb6221463bae76560b6", "filename": "mk/dist.mk", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d2686c751a45b18dd039dbca86c745dfa2c39f6b/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/d2686c751a45b18dd039dbca86c745dfa2c39f6b/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=d2686c751a45b18dd039dbca86c745dfa2c39f6b", "patch": "@@ -79,6 +79,7 @@ $(PKG_TAR): $(PKG_FILES)\n          --exclude=*/llvm/test/*/*/*.td \\\n          --exclude=*/llvm/test/*/*/*.s \\\n          -c $(UNROOTED_PKG_FILES) | tar -x -C tmp/dist/$(PKG_NAME)\n+\t@$(call E, making $@)\n \t$(Q)tar -czf $(PKG_TAR) -C tmp/dist $(PKG_NAME)\n \t$(Q)rm -Rf tmp/dist/$(PKG_NAME)\n \n@@ -282,9 +283,19 @@ distcheck: distcheck-win\n \n else\n \n-dist: dist-tar-src dist-osx dist-tar-bins dist-docs\n+# FIXME #13224: On OS X don't produce tarballs simply because --exclude-vcs don't work.\n+# This is a huge hack because I just don't have time to figure out another solution.\n+ifeq ($(CFG_OSTYPE), apple-darwin)\n+MAYBE_DIST_TAR_SRC=\n+MAYBE_DISTCHECK_TAR_SRC=\n+else\n+MAYBE_DIST_TAR_SRC=dist-tar-src\n+MAYBE_DISTCHECK_TAR_SRC=distcheck-tar-src\n+endif\n+\n+dist: $(MAYBE_DIST_TAR_SRC) dist-osx dist-tar-bins dist-docs\n \n-distcheck: distcheck-tar-src distcheck-osx distcheck-tar-bins distcheck-docs\n+distcheck: $(MAYBE_DISTCHECK_TAR_SRC) distcheck-osx distcheck-tar-bins distcheck-docs\n \t$(Q)rm -Rf tmp/distcheck\n \t@echo\n \t@echo -----------------------------------------------"}]}