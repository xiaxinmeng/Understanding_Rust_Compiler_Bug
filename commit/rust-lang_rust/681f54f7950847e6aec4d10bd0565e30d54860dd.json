{"sha": "681f54f7950847e6aec4d10bd0565e30d54860dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MWY1NGY3OTUwODQ3ZTZhZWM0ZDEwYmQwNTY1ZTMwZDU0ODYwZGQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-11-17T19:08:47Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-12-07T10:28:01Z"}, "message": "fix filter to support `&` and `|`", "tree": {"sha": "2943798820c7035ba4b6aae7df6c282d5e7415b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2943798820c7035ba4b6aae7df6c282d5e7415b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/681f54f7950847e6aec4d10bd0565e30d54860dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/681f54f7950847e6aec4d10bd0565e30d54860dd", "html_url": "https://github.com/rust-lang/rust/commit/681f54f7950847e6aec4d10bd0565e30d54860dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/681f54f7950847e6aec4d10bd0565e30d54860dd/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4d71ea6f8165b326f065c5db8c7c07ad61bafd3", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4d71ea6f8165b326f065c5db8c7c07ad61bafd3", "html_url": "https://github.com/rust-lang/rust/commit/b4d71ea6f8165b326f065c5db8c7c07ad61bafd3"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "37f59773cd6f03b2295c4395b5b985b32349624f", "filename": "src/librustc_mir/util/pretty.rs", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/681f54f7950847e6aec4d10bd0565e30d54860dd/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681f54f7950847e6aec4d10bd0565e30d54860dd/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fpretty.rs?ref=681f54f7950847e6aec4d10bd0565e30d54860dd", "patch": "@@ -57,9 +57,19 @@ pub enum PassWhere {\n /// where `<filter>` takes the following forms:\n ///\n /// - `all` -- dump MIR for all fns, all passes, all everything\n-/// - `substring1&substring2,...` -- `&`-separated list of substrings\n-///   that can appear in the pass-name or the `item_path_str` for the given\n-///   node-id. If any one of the substrings match, the data is dumped out.\n+/// - a filter defined by a set of substrings combined with `&` and `|`\n+///   (`&` has higher precedence). At least one of the `|`-separated groups\n+///   must match; an `|`-separated group matches if all of its `&`-separated\n+///   substrings are matched.\n+///\n+/// Example:\n+///\n+/// - `nll` == match if `nll` appears in the name\n+/// - `foo & nll` == match if `foo` and `nll` both appear in the name\n+/// - `foo & nll | typeck` == match if `foo` and `nll` both appear in the name\n+///   or `typeck` appears in the name.\n+/// - `foo & nll | bar & typeck` == match if `foo` and `nll` both appear in the name\n+///   or `typeck` and `bar` both appear in the name.\n pub fn dump_mir<'a, 'gcx, 'tcx, F>(\n     tcx: TyCtxt<'a, 'gcx, 'tcx>,\n     pass_num: Option<&Display>,\n@@ -104,8 +114,10 @@ pub fn dump_enabled<'a, 'gcx, 'tcx>(\n         // see notes on #41697 below\n         tcx.item_path_str(source.def_id)\n     });\n-    filters.split(\"&\").any(|filter| {\n-        filter == \"all\" || pass_name.contains(filter) || node_path.contains(filter)\n+    filters.split(\"|\").any(|or_filter| {\n+        or_filter.split(\"&\").all(|and_filter| {\n+            and_filter == \"all\" || pass_name.contains(and_filter) || node_path.contains(and_filter)\n+        })\n     })\n }\n \n@@ -357,7 +369,8 @@ fn write_extra<'cx, 'gcx, 'tcx, F>(\n     write: &mut Write,\n     mut visit_op: F,\n ) -> io::Result<()>\n-where F: FnMut(&mut ExtraComments<'cx, 'gcx, 'tcx>)\n+where\n+    F: FnMut(&mut ExtraComments<'cx, 'gcx, 'tcx>),\n {\n     let mut extra_comments = ExtraComments {\n         _tcx: tcx,"}]}