{"sha": "f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3NGQwMWNmMjlhZGMxMWIxYmRhM2NhNzM1MzdjNDlkY2JiNjBjNTI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-03-23T14:27:18Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-03-23T17:16:08Z"}, "message": "Rollup merge of #49028 - QuietMisdreavus:the-dark-forbidden-corners-of-rustdoc, r=frewsxcv\n\nadd an \"unstable features\" chapter to the rustdoc book\n\nThere are several rustdoc features that currently are undocumented, but also don't fit with the rest of the Rustdoc Book since they're also unstable. Some of these have corresponding feature gates and chapters in the Unstable Book, but many don't, and i wanted a place to talk about them officially.\n\nGoal: talk about everything rustdoc can do that needs nightly\n\n- [x] Feature gates (extensions to the doc attribute that can be caught by the compiler)\n  - [x] doc(cfg)\n  - [x] doc(masked)\n  - [x] doc(spotlight)\n  - [x] doc(include)\n- [x] Command-line flags (features that require a CLI flag to use, where the flag itself is a `-Z` command or otherwise requires `-Z unstable-options` before rustdoc will accept it)\n  - [x] markdown-before-content/markdown-after-content\n  - [x] playground-url\n  - [x] display-warnings\n  - [x] crate-version\n  - [x] linker\n  - [x] sort-modules-by-appearance\n  - [x] themes/theme-checker\n  - [x] resource-suffix\n  - [x] `-Z force-unstable-if-unmarked`\n- [x] Nightly-gated functionality (features that are gated by requiring a nightly build without needing a CLI flag or a feature gate to unlock)\n  - [x] intra-links\n  - [x] error numbers for `compile_fail` doctests", "tree": {"sha": "4d3a89cb76792b538084cf03d41cb62b85c6cc5f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4d3a89cb76792b538084cf03d41cb62b85c6cc5f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "html_url": "https://github.com/rust-lang/rust/commit/f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f74d01cf29adc11b1bda3ca73537c49dcbb60c52/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c0c7ef330fd87e8b169f0afc832d15bf098d0f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c0c7ef330fd87e8b169f0afc832d15bf098d0f0", "html_url": "https://github.com/rust-lang/rust/commit/7c0c7ef330fd87e8b169f0afc832d15bf098d0f0"}, {"sha": "b996f9d60fdb1db6bd870fc7f600be4c7660f3a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/b996f9d60fdb1db6bd870fc7f600be4c7660f3a2", "html_url": "https://github.com/rust-lang/rust/commit/b996f9d60fdb1db6bd870fc7f600be4c7660f3a2"}], "stats": {"total": 363, "additions": 363, "deletions": 0}, "files": [{"sha": "46528187c11754eecbf2be1e59434bb2a3acaec5", "filename": "src/doc/rustdoc/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f74d01cf29adc11b1bda3ca73537c49dcbb60c52/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/f74d01cf29adc11b1bda3ca73537c49dcbb60c52/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2FSUMMARY.md?ref=f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "patch": "@@ -5,3 +5,4 @@\n - [The `#[doc]` attribute](the-doc-attribute.md)\n - [Documentation tests](documentation-tests.md)\n - [Passes](passes.md)\n+- [Unstable features](unstable-features.md)"}, {"sha": "16356c20c70694470af16bb752a96d95d7fc9253", "filename": "src/doc/rustdoc/src/unstable-features.md", "status": "added", "additions": 362, "deletions": 0, "changes": 362, "blob_url": "https://github.com/rust-lang/rust/blob/f74d01cf29adc11b1bda3ca73537c49dcbb60c52/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md", "raw_url": "https://github.com/rust-lang/rust/raw/f74d01cf29adc11b1bda3ca73537c49dcbb60c52/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustdoc%2Fsrc%2Funstable-features.md?ref=f74d01cf29adc11b1bda3ca73537c49dcbb60c52", "patch": "@@ -0,0 +1,362 @@\n+# Unstable features\n+\n+Rustdoc is under active developement, and like the Rust compiler, some features are only available\n+on the nightly releases. Some of these are new and need some more testing before they're able to get\n+released to the world at large, and some of them are tied to features in the Rust compiler that are\n+themselves unstable. Several features here require a matching `#![feature(...)]` attribute to\n+enable, and thus are more fully documented in the [Unstable Book]. Those sections will link over\n+there as necessary.\n+\n+[Unstable Book]: ../unstable-book/index.html\n+\n+## Nightly-gated functionality\n+\n+These features just require a nightly build to operate. Unlike the other features on this page,\n+these don't need to be \"turned on\" with a command-line flag or a `#![feature(...)]` attribute in\n+your crate. This can give them some subtle fallback modes when used on a stable release, so be\n+careful!\n+\n+### Error numbers for `compile-fail` doctests\n+\n+As detailed in [the chapter on documentation tests][doctest-attributes], you can add a\n+`compile_fail` attribute to a doctest to state that the test should fail to compile. However, on\n+nightly, you can optionally add an error number to state that a doctest should emit a specific error\n+number:\n+\n+[doctest-attributes]: documentation-tests.html#attributes\n+\n+``````markdown\n+```compile_fail,E0044\n+extern { fn some_func<T>(x: T); }\n+```\n+``````\n+\n+This is used by the error index to ensure that the samples that correspond to a given error number\n+properly emit that error code. However, these error codes aren't guaranteed to be the only thing\n+that a piece of code emits from version to version, so this is unlikely to be stabilized in the\n+future.\n+\n+Attempting to use these error numbers on stable will result in the code sample being interpreted as\n+plain text.\n+\n+### Linking to items by type\n+\n+As designed in [RFC 1946], Rustdoc can parse paths to items when you use them as links. To resolve\n+these type names, it uses the items currently in-scope, either by declaration or by `use` statement.\n+For modules, the \"active scope\" depends on whether the documentation is written outside the module\n+(as `///` comments on the `mod` statement) or inside the module (at `//!` comments inside the file\n+or block). For all other items, it uses the enclosing module's scope.\n+\n+[RFC 1946]: https://github.com/rust-lang/rfcs/pull/1946\n+\n+For example, in the following code:\n+\n+```rust\n+/// Does the thing.\n+pub fn do_the_thing(_: SomeType) {\n+\tprintln!(\"Let's do the thing!\");\n+}\n+\n+/// Token you use to [`do_the_thing`].\n+pub struct SomeType;\n+```\n+\n+The link to ``[`do_the_thing`]`` in `SomeType`'s docs will properly link to the page for `fn\n+do_the_thing`. Note that here, rustdoc will insert the link target for you, but manually writing the\n+target out also works:\n+\n+```rust\n+pub mod some_module {\n+\t/// Token you use to do the thing.\n+\tpub struct SomeStruct;\n+}\n+\n+/// Does the thing. Requires one [`SomeStruct`] for the thing to work.\n+///\n+/// [`SomeStruct`]: some_module::SomeStruct\n+pub fn do_the_thing(_: some_module::SomeStruct) {\n+\tprintln!(\"Let's do the thing!\");\n+}\n+```\n+\n+For more details, check out [the RFC][RFC 1946], and see [the tracking issue][43466] for more\n+information about what parts of the feature are available.\n+\n+[43466]: https://github.com/rust-lang/rust/issues/43466\n+\n+## Extensions to the `#[doc]` attribute\n+\n+These features operate by extending the `#[doc]` attribute, and thus can be caught by the compiler\n+and enabled with a `#![feature(...)]` attribute in your crate.\n+\n+### Documenting platform-/feature-specific information\n+\n+Because of the way Rustdoc documents a crate, the documentation it creates is specific to the target\n+rustc compiles for. Anything that's specific to any other target is dropped via `#[cfg]` attribute\n+processing early in the compilation process. However, Rustdoc has a trick up its sleeve to handle\n+platform-specific code if it *does* receive it.\n+\n+Because Rustdoc doesn't need to fully compile a crate to binary, it replaces function bodies with\n+`loop {}` to prevent having to process more than necessary. This means that any code within a\n+function that requires platform-specific pieces is ignored. Combined with a special attribute,\n+`#[doc(cfg(...))]`, you can tell Rustdoc exactly which platform something is supposed to run on,\n+ensuring that doctests are only run on the appropriate platforms.\n+\n+The `#[doc(cfg(...))]` attribute has another effect: When Rustdoc renders documentation for that\n+item, it will be accompanied by a banner explaining that the item is only available on certain\n+platforms.\n+\n+As mentioned earlier, getting the items to Rustdoc requires some extra preparation. The standard\n+library adds a `--cfg dox` flag to every Rustdoc command, but the same thing can be accomplished by\n+adding a feature to your Cargo.toml and adding `--feature dox` (or whatever you choose to name the\n+feature) to your `cargo doc` calls.\n+\n+Either way, once you create an environment for the documentation, you can start to augment your\n+`#[cfg]` attributes to allow both the target platform *and* the documentation configuration to leave\n+the item in. For example, `#[cfg(any(windows, feature = \"dox\"))]` will preserve the item either on\n+Windows or during the documentation process. Then, adding a new attribute `#[doc(cfg(windows))]`\n+will tell Rustdoc that the item is supposed to be used on Windows. For example:\n+\n+```rust\n+#![feature(doc_cfg)]\n+\n+/// Token struct that can only be used on Windows.\n+#[cfg(any(windows, feature = \"dox\"))]\n+#[doc(cfg(windows))]\n+pub struct WindowsToken;\n+\n+/// Token struct that can only be used on Unix.\n+#[cfg(any(unix, feature = \"dox\"))]\n+#[doc(cfg(unix))]\n+pub struct UnixToken;\n+```\n+\n+In this sample, the tokens will only appear on their respective platforms, but they will both appear\n+in documentation.\n+\n+`#[doc(cfg(...))]` was introduced to be used by the standard library and currently requires the\n+`#![feature(doc_cfg)]` feature gate. For more information, see [its chapter in the Unstable\n+Book][unstable-doc-cfg] and [its tracking issue][issue-doc-cfg].\n+\n+[unstable-doc-cfg]: ../unstable-book/language-features/doc-cfg.html\n+[issue-doc-cfg]: https://github.com/rust-lang/rust/issues/43781\n+\n+### Adding your trait to the \"Important Traits\" dialog\n+\n+Rustdoc keeps a list of a few traits that are believed to be \"fundamental\" to a given type when\n+implemented on it. These traits are intended to be the primary interface for their types, and are\n+often the only thing available to be documented on their types. For this reason, Rustdoc will track\n+when a given type implements one of these traits and call special attention to it when a function\n+returns one of these types. This is the \"Important Traits\" dialog, visible as a circle-i button next\n+to the function, which, when clicked, shows the dialog.\n+\n+In the standard library, the traits that qualify for inclusion are `Iterator`, `io::Read`, and\n+`io::Write`. However, rather than being implemented as a hard-coded list, these traits have a\n+special marker attribute on them: `#[doc(spotlight)]`. This means that you could apply this\n+attribute to your own trait to include it in the \"Important Traits\" dialog in documentation.\n+\n+The `#[doc(spotlight)]` attribute currently requires the `#![feature(doc_spotlight)]` feature gate.\n+For more information, see [its chapter in the Unstable Book][unstable-spotlight] and [its tracking\n+issue][issue-spotlight].\n+\n+[unstable-spotlight]: ../unstable-book/language-features/doc-spotlight.html\n+[issue-spotlight]: https://github.com/rust-lang/rust/issues/45040\n+\n+### Exclude certain dependencies from documentation\n+\n+The standard library uses several dependencies which, in turn, use several types and traits from the\n+standard library. In addition, there are several compiler-internal crates that are not considered to\n+be part of the official standard library, and thus would be a distraction to include in\n+documentation. It's not enough to exclude their crate documentation, since information about trait\n+implementations appears on the pages for both the type and the trait, which can be in different\n+crates!\n+\n+To prevent internal types from being included in documentation, the standard library adds an\n+attribute to their `extern crate` declarations: `#[doc(masked)]`. This causes Rustdoc to \"mask out\"\n+types from these crates when building lists of trait implementations.\n+\n+The `#[doc(masked)]` attribute is intended to be used internally, and requires the\n+`#![feature(doc_masked)]` feature gate.  For more information, see [its chapter in the Unstable\n+Book][unstable-masked] and [its tracking issue][issue-masked].\n+\n+[unstable-masked]: ../unstable-book/language-features/doc-masked.html\n+[issue-masked]: https://github.com/rust-lang/rust/issues/44027\n+\n+### Include external files as API documentation\n+\n+As designed in [RFC 1990], Rustdoc can read an external file to use as a type's documentation. This\n+is useful if certain documentation is so long that it would break the flow of reading the source.\n+Instead of writing it all inline, writing `#[doc(include = \"sometype.md\")]` (where `sometype.md` is\n+a file adjacent to the `lib.rs` for the crate) will ask Rustdoc to instead read that file and use it\n+as if it were written inline.\n+\n+[RFC 1990]: https://github.com/rust-lang/rfcs/pull/1990\n+\n+`#[doc(include = \"...\")]` currently requires the `#![feature(external_doc)]` feature gate. For more\n+information, see [its chapter in the Unstable Book][unstable-include] and [its tracking\n+issue][issue-include].\n+\n+[unstable-include]: ../unstable-book/language-features/external-doc.html\n+[issue-include]: https://github.com/rust-lang/rust/issues/44732\n+\n+## Unstable command-line arguments\n+\n+These features are enabled by passing a command-line flag to Rustdoc, but the flags in question are\n+themselves marked as unstable. To use any of these options, pass `-Z unstable-options` as well as\n+the flag in question to Rustdoc on the command-line. To do this from Cargo, you can either use the\n+`RUSTDOCFLAGS` environment variable or the `cargo rustdoc` command.\n+\n+### `--markdown-before-content`: include rendered Markdown before the content\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --markdown-before-content extra.md\n+$ rustdoc README.md -Z unstable-options --markdown-before-content extra.md\n+```\n+\n+Just like `--html-before-content`, this allows you to insert extra content inside the `<body>` tag\n+but before the other content `rustdoc` would normally produce in the rendered documentation.\n+However, instead of directly inserting the file verbatim, `rustdoc` will pass the files through a\n+Markdown renderer before inserting the result into the file.\n+\n+### `--markdown-after-content`: include rendered Markdown after the content\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --markdown-after-content extra.md\n+$ rustdoc README.md -Z unstable-options --markdown-after-content extra.md\n+```\n+\n+Just like `--html-after-content`, this allows you to insert extra content before the `</body>` tag\n+but after the other content `rustdoc` would normally produce in the rendered documentation.\n+However, instead of directly inserting the file verbatim, `rustdoc` will pass the files through a\n+Markdown renderer before inserting the result into the file.\n+\n+### `--playground-url`: control the location of the playground\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --playground-url https://play.rust-lang.org/\n+```\n+\n+When rendering a crate's docs, this flag gives the base URL of the Rust Playground, to use for\n+generating `Run` buttons. Unlike `--markdown-playground-url`, this argument works for standalone\n+Markdown files *and* Rust crates. This works the same way as adding `#![doc(html_playground_url =\n+\"url\")]` to your crate root, as mentioned in [the chapter about the `#[doc]`\n+attribute][doc-playground]. Please be aware that the official Rust Playground at\n+https://play.rust-lang.org does not have every crate available, so if your examples require your\n+crate, make sure the playground you provide has your crate available.\n+\n+[doc-playground]: the-doc-attribute.html#html_playground_url\n+\n+If both `--playground-url` and `--markdown-playground-url` are present when rendering a standalone\n+Markdown file, the URL given to `--markdown-playground-url` will take precedence. If both\n+`--playground-url` and `#![doc(html_playground_url = \"url\")]` are present when rendering crate docs,\n+the attribute will take precedence.\n+\n+### `--crate-version`: control the crate version\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --crate-version 1.3.37\n+```\n+\n+When `rustdoc` receives this flag, it will print an extra \"Version (version)\" into the sidebar of\n+the crate root's docs. You can use this flag to differentiate between different versions of your\n+library's documentation.\n+\n+### `--linker`: control the linker used for documentation tests\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc --test src/lib.rs -Z unstable-options --linker foo\n+$ rustdoc --test README.md -Z unstable-options --linker foo\n+```\n+\n+When `rustdoc` runs your documentation tests, it needs to compile and link the tests as executables\n+before running them. This flag can be used to change the linker used on these executables. It's\n+equivalent to passing `-C linker=foo` to `rustc`.\n+\n+### `--sort-modules-by-appearance`: control how items on module pages are sorted\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --sort-modules-by-appearance\n+```\n+\n+Ordinarily, when `rustdoc` prints items in module pages, it will sort them alphabetically (taking\n+some consideration for their stability, and names that end in a number). Giving this flag to\n+`rustdoc` will disable this sorting and instead make it print the items in the order they appear in\n+the source.\n+\n+### `--themes`: provide additional themes\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --themes theme.css\n+```\n+\n+Giving this flag to `rustdoc` will make it copy your theme into the generated crate docs and enable\n+it in the theme selector. Note that `rustdoc` will reject your theme file if it doesn't style\n+everything the \"main\" theme does. See `--theme-checker` below for details.\n+\n+### `--theme-checker`: verify theme CSS for validity\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc -Z unstable-options --theme-checker theme.css\n+```\n+\n+Before including your theme in crate docs, `rustdoc` will compare all the CSS rules it contains\n+against the \"main\" theme included by default. Using this flag will allow you to see which rules are\n+missing if `rustdoc` rejects your theme.\n+\n+### `--resource-suffix`: modifying the name of CSS/JavaScript in crate docs\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --resource-suffix suf\n+```\n+\n+When rendering docs, `rustdoc` creates several CSS and JavaScript files as part of the output. Since\n+all these files are linked from every page, changing where they are can be cumbersome if you need to\n+specially cache them. This flag will rename all these files in the output to include the suffix in\n+the filename. For example, `main.css` would become `main-suf.css` with the above command.\n+\n+### `--display-warnings`: display warnings when documenting or running documentation tests\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z unstable-options --display-warnings\n+$ rustdoc --test src/lib.rs -Z unstable-options --display-warnings\n+```\n+\n+The intent behind this flag is to allow the user to see warnings that occur within their library or\n+their documentation tests, which are usually suppressed. However, [due to a\n+bug][issue-display-warnings], this flag doesn't 100% work as intended. See the linked issue for\n+details.\n+\n+[issue-display-warnings]: https://github.com/rust-lang/rust/issues/41574\n+\n+### `-Z force-unstable-if-unmarked`\n+\n+Using this flag looks like this:\n+\n+```bash\n+$ rustdoc src/lib.rs -Z force-unstable-if-unmarked\n+```\n+\n+This is an internal flag intended for the standard library and compiler that applies an\n+`#[unstable]` attribute to any dependent crate that doesn't have another stability attribute. This\n+allows `rustdoc` to be able to generate documentation for the compiler crates and the standard\n+library, as an equivalent command-line argument is provided to `rustc` when building those crates."}]}