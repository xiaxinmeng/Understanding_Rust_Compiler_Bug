{"sha": "a554b743164332223d3746ec3664908017f1e4e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1NTRiNzQzMTY0MzMyMjIzZDM3NDZlYzM2NjQ5MDgwMTdmMWU0ZTY=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-06-01T04:09:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-06-01T04:09:25Z"}, "message": "Rollup merge of #42314 - jannic:patch-1, r=japaric\n\nARMv5 needs +strict-align\n\nWithout that flag, LLVM generates unaligned memory access instructions, which are not allowed on ARMv5.\n\nFor example, the 'hello world' example from `cargo --new` failed with:\n```\n$ ./hello\nHello, world!\nthread 'main' panicked at 'assertion failed: end <= len', src/libcollections/vec.rs:1113\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n```\n\nI traced this error back to the following assembler code in `BufWriter::flush_buf`:\n```\n    6f44:       e28d0018        add     r0, sp, #24\n[...]\n    6f54:       e280b005        add     fp, r0, #5\n[...]\n    7018:       e5cd001c        strb    r0, [sp, #28]\n    701c:       e1a0082a        lsr     r0, sl, #16\n    7020:       03a01001        moveq   r1, #1\n    7024:       e5cb0002        strb    r0, [fp, #2]\n    7028:       e1cba0b0        strh    sl, [fp]\n```\n\nNote that `fp` points to `sp + 29`, so the three `str*`-instructions should fill up a 32bit - value at `sp + 28`, which is later used as the value `n` in `Ok(n) => written += n`. This doesn't work on ARMv5 as the `strh` can't write to the unaligned contents of `fp`, so the upper bits of `n` won't get cleared, leading to the assertion failure in Vec::drain.\n\nWith `+strict-align`, the code works as expected.", "tree": {"sha": "003c49b7ed7e9671deaab4396415c835035f9112", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/003c49b7ed7e9671deaab4396415c835035f9112"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a554b743164332223d3746ec3664908017f1e4e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a554b743164332223d3746ec3664908017f1e4e6", "html_url": "https://github.com/rust-lang/rust/commit/a554b743164332223d3746ec3664908017f1e4e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a554b743164332223d3746ec3664908017f1e4e6/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2221f9c6b9436a45b6d87cbf2725f694e65dd183", "url": "https://api.github.com/repos/rust-lang/rust/commits/2221f9c6b9436a45b6d87cbf2725f694e65dd183", "html_url": "https://github.com/rust-lang/rust/commit/2221f9c6b9436a45b6d87cbf2725f694e65dd183"}, {"sha": "4450807ead1c5f9a5f8d44ffee6ed0f968c68c34", "url": "https://api.github.com/repos/rust-lang/rust/commits/4450807ead1c5f9a5f8d44ffee6ed0f968c68c34", "html_url": "https://github.com/rust-lang/rust/commit/4450807ead1c5f9a5f8d44ffee6ed0f968c68c34"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "ef00c9a3278b925d07190053dc7c5fb34b97ee3d", "filename": "src/librustc_back/target/armv5te_unknown_linux_gnueabi.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a554b743164332223d3746ec3664908017f1e4e6/src%2Flibrustc_back%2Ftarget%2Farmv5te_unknown_linux_gnueabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a554b743164332223d3746ec3664908017f1e4e6/src%2Flibrustc_back%2Ftarget%2Farmv5te_unknown_linux_gnueabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Farmv5te_unknown_linux_gnueabi.rs?ref=a554b743164332223d3746ec3664908017f1e4e6", "patch": "@@ -25,7 +25,7 @@ pub fn target() -> TargetResult {\n         linker_flavor: LinkerFlavor::Gcc,\n \n         options: TargetOptions {\n-            features: \"+soft-float\".to_string(),\n+            features: \"+soft-float,+strict-align\".to_string(),\n             // No atomic instructions on ARMv5\n             max_atomic_width: Some(0),\n             abi_blacklist: super::arm_base::abi_blacklist(),"}]}