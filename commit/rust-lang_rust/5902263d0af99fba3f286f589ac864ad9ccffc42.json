{"sha": "5902263d0af99fba3f286f589ac864ad9ccffc42", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5MDIyNjNkMGFmOTlmYmEzZjI4NmY1ODlhYzg2NGFkOWNjZmZjNDI=", "commit": {"author": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2014-01-14T17:01:24Z"}, "committer": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2014-01-14T18:22:23Z"}, "message": "Fix the representation of C void pointers in LLVM IR\n\nCurrently, we have c_void defined to be represented as an empty struct,\nbut LLVM expects C's void* to be represented as i8*. That means we\ncurrently generate code in which LLVM doesn't recognize malloc() and\nfree() and can't apply certain optimization that would remove calls to\nthose functions.", "tree": {"sha": "930a5e0243edd9bc3cfebc595ee44ccd56a10e96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/930a5e0243edd9bc3cfebc595ee44ccd56a10e96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5902263d0af99fba3f286f589ac864ad9ccffc42", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5902263d0af99fba3f286f589ac864ad9ccffc42", "html_url": "https://github.com/rust-lang/rust/commit/5902263d0af99fba3f286f589ac864ad9ccffc42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5902263d0af99fba3f286f589ac864ad9ccffc42/comments", "author": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "77eeddaa481fa083dfa857e5d7dd7f5ab784a9f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/77eeddaa481fa083dfa857e5d7dd7f5ab784a9f1", "html_url": "https://github.com/rust-lang/rust/commit/77eeddaa481fa083dfa857e5d7dd7f5ab784a9f1"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "6b54a176e8904152c8832b07cd1ce702f844c7cd", "filename": "src/libstd/libc.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5902263d0af99fba3f286f589ac864ad9ccffc42/src%2Flibstd%2Flibc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5902263d0af99fba3f286f589ac864ad9ccffc42/src%2Flibstd%2Flibc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flibc.rs?ref=5902263d0af99fba3f286f589ac864ad9ccffc42", "patch": "@@ -194,8 +194,19 @@ pub mod types {\n             This type is only useful as a pointer target. Do not use it as a\n             return type for FFI functions which have the `void` return type in\n             C. Use the unit type `()` or omit the return type instead.\n+\n+            For LLVM to recognize the void pointer type and by extension\n+            functions like malloc(), we need to have it represented as i8* in\n+            LLVM bitcode. The enum used here ensures this and prevents misuse\n+            of the \"raw\" type by only having private variants.. We need two\n+            variants, because the compiler complains about the repr attribute\n+            otherwise.\n             */\n-            pub enum c_void {}\n+            #[repr(u8)]\n+            pub enum c_void {\n+                priv variant1,\n+                priv variant2\n+            }\n             pub enum FILE {}\n             pub enum fpos_t {}\n         }"}]}