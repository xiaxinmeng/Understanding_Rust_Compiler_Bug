{"sha": "7a145250c6b23cb1bc361e1a8dae465720c46706", "node_id": "C_kwDOAAsO6NoAKDdhMTQ1MjUwYzZiMjNjYjFiYzM2MWUxYThkYWU0NjU3MjBjNDY3MDY", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-12-02T13:52:35Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-12-02T14:17:58Z"}, "message": "Document Windows TLS drop behaviour", "tree": {"sha": "2f6b23058e7d67c29edff793c8f95a391231a917", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f6b23058e7d67c29edff793c8f95a391231a917"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a145250c6b23cb1bc361e1a8dae465720c46706", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmGo1ZcACgkQcTRy8vRW\nJ94E8hAAmKTJn8HEaBpBRLevVbG6uTZ24SfA5/34Ro/AV9NS5uq464Ex+5U/RHnv\n1munQ6sSSONUU1rVoorhB4dO683sZrwQLa0UIQGvT+VU7suDy9em9YbcqcaiAty+\nPCnDRxye8CYHFKnSwJ6p1tRxvupB+SnWQFnDv9wtpUQS2LdZVQJjZuuIhnvZcCfB\n9jghjQ95IDY3GLNI0GVx1kpH5CMoWh9x9W2RcKy+W5B3kq6FtmFRBQIS21kMUp/s\n9laNPYYYhnak41uxUf0uRo49kMV5kcBDt1KLJRHa8TioGjGNurx781GZokXQnsTi\n9x4WCodaWFgjxam+MbQlhq3jA8SDeKQTlAnzGWAvsdDYTdsgLCqjHaQ0M+7nAXss\n5REnKSrTdmFT6ToOTNzyYF2YYAKgXo4oew7GrDP7CtWDRI80F8gJMXsdPhviVAbT\nhi8oniqRdztXnh/D/+CpurRzUYSRyD62zpiRyOeY4J+ERePqNzIICPbDCUfOD6p9\nq010z1CB1vaZqGT+q1oCo+wsoRKVzhkmdIhCdRX/2C3fwGvpMpu6wLHPwCjLPMCP\nFjyClI/MY6s5AOqdXIsO1Nm9SGIHtB5de+vxQYFSXn9mN8RRJucmj5d8BLBfpDlK\nzowtI2PCN6w+6X9rY/Z0J5RAYULcASe4BkRKh3TLUgYk/4yN010=\n=gny0\n-----END PGP SIGNATURE-----", "payload": "tree 2f6b23058e7d67c29edff793c8f95a391231a917\nparent d9baa361902b172be716f96619b909f340802dea\nauthor Chris Denton <christophersdenton@gmail.com> 1638453155 +0000\ncommitter Chris Denton <christophersdenton@gmail.com> 1638454678 +0000\n\nDocument Windows TLS drop behaviour\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a145250c6b23cb1bc361e1a8dae465720c46706", "html_url": "https://github.com/rust-lang/rust/commit/7a145250c6b23cb1bc361e1a8dae465720c46706", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a145250c6b23cb1bc361e1a8dae465720c46706/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9baa361902b172be716f96619b909f340802dea", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9baa361902b172be716f96619b909f340802dea", "html_url": "https://github.com/rust-lang/rust/commit/d9baa361902b172be716f96619b909f340802dea"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "64c8416b61c79ec4b955f85184e9db5d5ec266a3", "filename": "library/std/src/thread/local.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7a145250c6b23cb1bc361e1a8dae465720c46706/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a145250c6b23cb1bc361e1a8dae465720c46706/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs?ref=7a145250c6b23cb1bc361e1a8dae465720c46706", "patch": "@@ -76,7 +76,21 @@ use crate::fmt;\n ///    destroyed, but not all platforms have this guard. Those platforms that do\n ///    not guard typically have a synthetic limit after which point no more\n ///    destructors are run.\n+/// 3. When the process exits on Windows systems, TLS destructors may only be\n+///    run on the thread that causes the process to exit. This is because the\n+///    other threads may be forcibly terminated.\n ///\n+/// ## Synchronization in thread-local destructors\n+///\n+/// On Windows, synchronization operations (such as [`JoinHandle::join`]) in\n+/// thread local destructors are prone to deadlocks and so should be avoided.\n+/// This is because the [loader lock] is held while a destructor is run. The\n+/// lock is acquired whenever a thread starts or exits or when a DLL is loaded\n+/// or unloaded. Therefore these events are blocked for as long as a thread\n+/// local destructor is running.\n+///\n+/// [loader lock]: https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-best-practices\n+/// [`JoinHandle::join`]: crate::thread::JoinHandle::join\n /// [`with`]: LocalKey::with\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub struct LocalKey<T: 'static> {"}]}