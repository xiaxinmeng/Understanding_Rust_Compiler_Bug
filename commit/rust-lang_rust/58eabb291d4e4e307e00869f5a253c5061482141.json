{"sha": "58eabb291d4e4e307e00869f5a253c5061482141", "node_id": "C_kwDOAAsO6NoAKDU4ZWFiYjI5MWQ0ZTRlMzA3ZTAwODY5ZjVhMjUzYzUwNjE0ODIxNDE", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-25T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-25T08:38:00Z"}, "message": "Add method that applies DefUse effect", "tree": {"sha": "1eae3771cf2557c10fad42d9abcc4494a6c0f059", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1eae3771cf2557c10fad42d9abcc4494a6c0f059"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58eabb291d4e4e307e00869f5a253c5061482141", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58eabb291d4e4e307e00869f5a253c5061482141", "html_url": "https://github.com/rust-lang/rust/commit/58eabb291d4e4e307e00869f5a253c5061482141", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58eabb291d4e4e307e00869f5a253c5061482141/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4462b4af52e753e79de737857ff620fd267fb58f", "url": "https://api.github.com/repos/rust-lang/rust/commits/4462b4af52e753e79de737857ff620fd267fb58f", "html_url": "https://github.com/rust-lang/rust/commit/4462b4af52e753e79de737857ff620fd267fb58f"}], "stats": {"total": 26, "additions": 11, "deletions": 15}, "files": [{"sha": "483c1e274aa7809d6b3cffeb5ab5be003072d642", "filename": "compiler/rustc_mir_dataflow/src/impls/liveness.rs", "status": "modified", "additions": 11, "deletions": 15, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/58eabb291d4e4e307e00869f5a253c5061482141/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58eabb291d4e4e307e00869f5a253c5061482141/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_dataflow%2Fsrc%2Fimpls%2Fliveness.rs?ref=58eabb291d4e4e307e00869f5a253c5061482141", "patch": "@@ -122,11 +122,7 @@ where\n     }\n \n     fn visit_local(&mut self, local: Local, context: PlaceContext, _: Location) {\n-        match DefUse::for_place(local.into(), context) {\n-            Some(DefUse::Def) => self.0.kill(local),\n-            Some(DefUse::Use) => self.0.gen(local),\n-            None => {}\n-        }\n+        DefUse::apply(self.0, local.into(), context);\n     }\n }\n \n@@ -137,20 +133,12 @@ where\n     T: GenKill<Local>,\n {\n     fn visit_place(&mut self, place: &mir::Place<'tcx>, context: PlaceContext, location: Location) {\n-        match DefUse::for_place(*place, context) {\n-            Some(DefUse::Def) => self.0.kill(place.local),\n-            Some(DefUse::Use) => self.0.gen(place.local),\n-            None => {}\n-        }\n+        DefUse::apply(self.0, *place, context);\n         self.visit_projection(place.as_ref(), context, location);\n     }\n \n     fn visit_local(&mut self, local: Local, context: PlaceContext, _: Location) {\n-        match DefUse::for_place(local.into(), context) {\n-            Some(DefUse::Def) => self.0.kill(local),\n-            Some(DefUse::Use) => self.0.gen(local),\n-            None => {}\n-        }\n+        DefUse::apply(self.0, local.into(), context);\n     }\n }\n \n@@ -161,6 +149,14 @@ enum DefUse {\n }\n \n impl DefUse {\n+    fn apply<'tcx>(trans: &mut impl GenKill<Local>, place: Place<'tcx>, context: PlaceContext) {\n+        match DefUse::for_place(place, context) {\n+            Some(DefUse::Def) => trans.kill(place.local),\n+            Some(DefUse::Use) => trans.gen(place.local),\n+            None => {}\n+        }\n+    }\n+\n     fn for_place<'tcx>(place: Place<'tcx>, context: PlaceContext) -> Option<DefUse> {\n         match context {\n             PlaceContext::NonUse(_) => None,"}]}