{"sha": "6368b40dd98b208da3758d4d1eed34cf276e3b09", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzNjhiNDBkZDk4YjIwOGRhMzc1OGQ0ZDFlZWQzNGNmMjc2ZTNiMDk=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-12-31T17:38:22Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-12-31T17:38:22Z"}, "message": "Work around synchrnonisation issue", "tree": {"sha": "3efa5daf54fe08cd1b310fa42c2ef469503fcedd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3efa5daf54fe08cd1b310fa42c2ef469503fcedd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6368b40dd98b208da3758d4d1eed34cf276e3b09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6368b40dd98b208da3758d4d1eed34cf276e3b09", "html_url": "https://github.com/rust-lang/rust/commit/6368b40dd98b208da3758d4d1eed34cf276e3b09", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6368b40dd98b208da3758d4d1eed34cf276e3b09/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "087af54069d34eef5197e04d64ac322d9ee98085", "url": "https://api.github.com/repos/rust-lang/rust/commits/087af54069d34eef5197e04d64ac322d9ee98085", "html_url": "https://github.com/rust-lang/rust/commit/087af54069d34eef5197e04d64ac322d9ee98085"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "51dedd5efc7a9e96aacd805a999ef53c30aeed7e", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6368b40dd98b208da3758d4d1eed34cf276e3b09/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/6368b40dd98b208da3758d4d1eed34cf276e3b09/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=6368b40dd98b208da3758d4d1eed34cf276e3b09", "patch": "@@ -11,6 +11,17 @@ let ctx!: Ctx;\n export async function activate(context: vscode.ExtensionContext) {\n     ctx = new Ctx(context);\n \n+    // Note: we try to start the server before we register various commands, so\n+    // that it registers its `onDidChangeDocument` handler before us.\n+    //\n+    // This a horribly, horribly wrong way to deal with this problem.\n+    try {\n+        await ctx.restartServer();\n+    } catch (e) {\n+        vscode.window.showErrorMessage(e.message);\n+    }\n+\n+\n     // Commands which invokes manually via command pallet, shortcut, etc.\n     ctx.registerCommand('analyzerStatus', commands.analyzerStatus);\n     ctx.registerCommand('collectGarbage', commands.collectGarbage);\n@@ -33,12 +44,6 @@ export async function activate(context: vscode.ExtensionContext) {\n     activateStatusDisplay(ctx);\n     activateHighlighting(ctx);\n     activateInlayHints(ctx);\n-    // Start the language server, finally!\n-    try {\n-        await ctx.restartServer();\n-    } catch (e) {\n-        vscode.window.showErrorMessage(e.message);\n-    }\n }\n \n export async function deactivate() {"}]}