{"sha": "4933be9e2f7bec805980342f882c235c92755a7c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5MzNiZTllMmY3YmVjODA1OTgwMzQyZjg4MmMyMzVjOTI3NTVhN2M=", "commit": {"author": {"name": "danakj", "email": "danakj@chromium.org", "date": "2021-09-15T15:49:12Z"}, "committer": {"name": "danakj", "email": "danakj@chromium.org", "date": "2021-09-15T15:49:12Z"}, "message": "Verify bin crates are not deterministic on Windows\n\nThis disables the remap_cwd_bin test which is failing on windows,\nand adds a test for --remap-path-prefix making a bin crate\ninstead, to see if it will fail the same way.", "tree": {"sha": "a29bda9bdc4f98d5b6473321f6efd858548cb523", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a29bda9bdc4f98d5b6473321f6efd858548cb523"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4933be9e2f7bec805980342f882c235c92755a7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4933be9e2f7bec805980342f882c235c92755a7c", "html_url": "https://github.com/rust-lang/rust/commit/4933be9e2f7bec805980342f882c235c92755a7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4933be9e2f7bec805980342f882c235c92755a7c/comments", "author": {"login": "danakj", "id": 342377, "node_id": "MDQ6VXNlcjM0MjM3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/342377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danakj", "html_url": "https://github.com/danakj", "followers_url": "https://api.github.com/users/danakj/followers", "following_url": "https://api.github.com/users/danakj/following{/other_user}", "gists_url": "https://api.github.com/users/danakj/gists{/gist_id}", "starred_url": "https://api.github.com/users/danakj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danakj/subscriptions", "organizations_url": "https://api.github.com/users/danakj/orgs", "repos_url": "https://api.github.com/users/danakj/repos", "events_url": "https://api.github.com/users/danakj/events{/privacy}", "received_events_url": "https://api.github.com/users/danakj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "danakj", "id": 342377, "node_id": "MDQ6VXNlcjM0MjM3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/342377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danakj", "html_url": "https://github.com/danakj", "followers_url": "https://api.github.com/users/danakj/followers", "following_url": "https://api.github.com/users/danakj/following{/other_user}", "gists_url": "https://api.github.com/users/danakj/gists{/gist_id}", "starred_url": "https://api.github.com/users/danakj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danakj/subscriptions", "organizations_url": "https://api.github.com/users/danakj/orgs", "repos_url": "https://api.github.com/users/danakj/repos", "events_url": "https://api.github.com/users/danakj/events{/privacy}", "received_events_url": "https://api.github.com/users/danakj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a687deee872917b09519519290521fa8dd472b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a687deee872917b09519519290521fa8dd472b7", "html_url": "https://github.com/rust-lang/rust/commit/2a687deee872917b09519519290521fa8dd472b7"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "76318ab7cb922fcbceb28833617b9a7c20645617", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4933be9e2f7bec805980342f882c235c92755a7c/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/4933be9e2f7bec805980342f882c235c92755a7c/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=4933be9e2f7bec805980342f882c235c92755a7c", "patch": "@@ -534,6 +534,11 @@ jobs:\n     strategy:\n       matrix:\n         include:\n+          - name: x86_64-msvc-1\n+            env:\n+              RUST_CONFIGURE_ARGS: \"--build=x86_64-pc-windows-msvc --enable-profiler\"\n+              SCRIPT: make ci-subset-1\n+            os: windows-latest-xl\n           - name: dist-x86_64-linux\n             os: ubuntu-latest-xl\n             env: {}"}, {"sha": "e4c402b417e6b3a3f1eb8af3d46c3cd6a5ff3015", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4933be9e2f7bec805980342f882c235c92755a7c/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/4933be9e2f7bec805980342f882c235c92755a7c/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=4933be9e2f7bec805980342f882c235c92755a7c", "patch": "@@ -668,6 +668,11 @@ jobs:\n     strategy:\n       matrix:\n         include:\n+          - name: x86_64-msvc-1\n+            env:\n+              RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n+              SCRIPT: make ci-subset-1\n+            <<: *job-windows-xl\n           - *dist-x86_64-linux\n \n   master:"}, {"sha": "46885fdb7df848e09dfdb14be2d13253a45505db", "filename": "src/test/run-make-fulldeps/reproducible-build/Makefile", "status": "modified", "additions": 21, "deletions": 3, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4933be9e2f7bec805980342f882c235c92755a7c/src%2Ftest%2Frun-make-fulldeps%2Freproducible-build%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/4933be9e2f7bec805980342f882c235c92755a7c/src%2Ftest%2Frun-make-fulldeps%2Freproducible-build%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Freproducible-build%2FMakefile?ref=4933be9e2f7bec805980342f882c235c92755a7c", "patch": "@@ -9,12 +9,18 @@ all:  \\\n \topt \\\n \tlink_paths \\\n \tremap_paths \\\n-\tdifferent_source_dirs \\\n-\tremap_cwd_bin \\\n+\tdifferent_source_dirs_bin \\\n+\tdifferent_source_dirs_rlib \\\n \tremap_cwd_rlib \\\n \tremap_cwd_to_empty \\\n \textern_flags\n \n+# TODO: Deterministic builds of `bin` crate types are not deterministic with\n+# debuginfo=2 on Windows.\n+# See https://github.com/rust-lang/rust/pull/87320#issuecomment-920105533\n+#\tdifferent_source_dirs_bin \\\n+#\tremap_cwd_bin \\\n+\n smoke:\n \trm -rf $(TMPDIR) && mkdir $(TMPDIR)\n \t$(RUSTC) linker.rs -O\n@@ -55,7 +61,19 @@ remap_paths:\n \t$(RUSTC) reproducible-build.rs --crate-type rlib --remap-path-prefix=/b=/c\n \tcmp \"$(TMPDIR)/libreproducible_build.rlib\" \"$(TMPDIR)/libfoo.rlib\" || exit 1\n \n-different_source_dirs:\n+different_source_dirs_bin:\n+\trm -rf $(TMPDIR) && mkdir $(TMPDIR)\n+\t$(RUSTC) reproducible-build-aux.rs\n+\tmkdir $(TMPDIR)/test\n+\tcp reproducible-build.rs $(TMPDIR)/test\n+\t$(RUSTC) reproducible-build.rs --crate-type bin --remap-path-prefix=$$PWD=/b\n+\tcp $(TMPDIR)/reproducible-build $(TMPDIR)/foo\n+\t(cd $(TMPDIR)/test && $(RUSTC) reproducible-build.rs \\\n+\t\t--remap-path-prefix=$(TMPDIR)/test=/b \\\n+\t\t--crate-type bin)\n+\tcmp \"$(TMPDIR)/reproducible-build\" \"$(TMPDIR)/foo\" || exit 1\n+\n+different_source_dirs_rlib:\n \trm -rf $(TMPDIR) && mkdir $(TMPDIR)\n \t$(RUSTC) reproducible-build-aux.rs\n \tmkdir $(TMPDIR)/test"}]}