{"sha": "e1ea006701f99455647a007546eafe45a0cfe162", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxZWEwMDY3MDFmOTk0NTU2NDdhMDA3NTQ2ZWFmZTQ1YTBjZmUxNjI=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-06-05T10:36:09Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-07-03T07:34:29Z"}, "message": "ci: include the architecture in the docker cache key\n\nWe're starting to include native aarch64 machines in our CI, but before\nthis commit the architecture wasn't included in the cache key for our\nDocker images. This means there could be conflicts between images\nproduced on different architectures, hurting our CI times.\n\nThis commit fixes the problem by including the output of `uname -m` in\nthe cache key.", "tree": {"sha": "9049d8c5560066ff84694a8ccb05f0cd4aedbe21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9049d8c5560066ff84694a8ccb05f0cd4aedbe21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1ea006701f99455647a007546eafe45a0cfe162", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl7+34UACgkQPgar6Auq\n8ZzgZA/9EbNDMFPGEg+jjYITUyZPPBUHBt0K4LWtGNmxnp3phds68lCUSvh1cn5o\nBcbndQ4yvt+mjeLoD7lA+Dt0XYo+ccesLXXrEI2HHxhDqiZ8K/vVYEJDcNPMAW0B\nEf61mmgIr/d6Dvy/B+BYIF8drkUm0y0bpF0h0ascyfazhZGGIq4ao/xAmhI6Cfh5\nlpW6KbSl7CNLB1CS8oO1h4Iw+om7oJozrEArSZ2p8otZOEEoU2LjcnMdOE0GaRkZ\n4hCICPjEY+2xHzEjoNbQVZ0XFn9zUoK4pOsOxpHMolnbZC0SDWyiOr5htDtFy4ml\n1xONa7WnHOHaisUZibOtYenzsF3bQAhw56eZ19ose/2mRGxBpU0xIKLe9oKdbman\nVPxLKkgI19edO6v7WCMOarpKpJjAlUZm3q6BoBTNrgPTE9OzPlc9ZvMBsiNg5D/s\nNvWE+uxXAqVyJq5UXf3j9HFWLGXWXsgZymzvqCTb5chqhZjRDy9rWYq1/v1BpiIm\n2SvT1Rd71P99+JevumNRnF6ks2p7ToiUZ/4ZdfoegHyvBYjFt/3kDr7VKYTZ7WQr\nAXV+cAbvn0ISv9Ay7nLa5QpozO/+AHWqRMKoniX3Ilublnm9XnNAl3rQMOxOd8O9\nXa4MHvBF/P6M6T1Y2HPJtUjO35nWdpRvuGsRCRSCDlVbGaO3wts=\n=PkBK\n-----END PGP SIGNATURE-----", "payload": "tree 9049d8c5560066ff84694a8ccb05f0cd4aedbe21\nparent 1149cf04de68f45a596c5a9479a525a2efb88214\nauthor Pietro Albini <pietro@pietroalbini.org> 1591353369 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1593761669 +0200\n\nci: include the architecture in the docker cache key\n\nWe're starting to include native aarch64 machines in our CI, but before\nthis commit the architecture wasn't included in the cache key for our\nDocker images. This means there could be conflicts between images\nproduced on different architectures, hurting our CI times.\n\nThis commit fixes the problem by including the output of `uname -m` in\nthe cache key.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1ea006701f99455647a007546eafe45a0cfe162", "html_url": "https://github.com/rust-lang/rust/commit/e1ea006701f99455647a007546eafe45a0cfe162", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1ea006701f99455647a007546eafe45a0cfe162/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1149cf04de68f45a596c5a9479a525a2efb88214", "url": "https://api.github.com/repos/rust-lang/rust/commits/1149cf04de68f45a596c5a9479a525a2efb88214", "html_url": "https://github.com/rust-lang/rust/commit/1149cf04de68f45a596c5a9479a525a2efb88214"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "9bc61b56efbb2be77345062cd6905a0f1eb7d47c", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e1ea006701f99455647a007546eafe45a0cfe162/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/e1ea006701f99455647a007546eafe45a0cfe162/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=e1ea006701f99455647a007546eafe45a0cfe162", "patch": "@@ -57,6 +57,10 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       # Sort the file names and cat the content into the hash key\n       sort $copied_files | xargs cat >> $hash_key\n \n+      # Include the architecture in the hash key, since our Linux CI does not\n+      # only run in x86_64 machines.\n+      uname -m >> $hash_key\n+\n       docker --version >> $hash_key\n       cksum=$(sha512sum $hash_key | \\\n         awk '{print $1}')"}]}