{"sha": "200032852be0c66b978c875a8edf0eca1f08b901", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMDAzMjg1MmJlMGM2NmI5NzhjODc1YThlZGYwZWNhMWYwOGI5MDE=", "commit": {"author": {"name": "Andrea Pretto", "email": "eulerdisk@gmail.com", "date": "2019-04-21T21:55:47Z"}, "committer": {"name": "Andrea Pretto", "email": "eulerdisk@gmail.com", "date": "2019-04-21T22:48:43Z"}, "message": "complete_import: prevent panic when the anchor is the completion source range\n(fix rebase mess)\n\n Please enter the commit message for your changes. Lines starting", "tree": {"sha": "11d45b4470c104f44b237540164bef54cdb55cd9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11d45b4470c104f44b237540164bef54cdb55cd9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/200032852be0c66b978c875a8edf0eca1f08b901", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/200032852be0c66b978c875a8edf0eca1f08b901", "html_url": "https://github.com/rust-lang/rust/commit/200032852be0c66b978c875a8edf0eca1f08b901", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/200032852be0c66b978c875a8edf0eca1f08b901/comments", "author": {"login": "eulerdisk", "id": 10089822, "node_id": "MDQ6VXNlcjEwMDg5ODIy", "avatar_url": "https://avatars.githubusercontent.com/u/10089822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eulerdisk", "html_url": "https://github.com/eulerdisk", "followers_url": "https://api.github.com/users/eulerdisk/followers", "following_url": "https://api.github.com/users/eulerdisk/following{/other_user}", "gists_url": "https://api.github.com/users/eulerdisk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eulerdisk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eulerdisk/subscriptions", "organizations_url": "https://api.github.com/users/eulerdisk/orgs", "repos_url": "https://api.github.com/users/eulerdisk/repos", "events_url": "https://api.github.com/users/eulerdisk/events{/privacy}", "received_events_url": "https://api.github.com/users/eulerdisk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eulerdisk", "id": 10089822, "node_id": "MDQ6VXNlcjEwMDg5ODIy", "avatar_url": "https://avatars.githubusercontent.com/u/10089822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eulerdisk", "html_url": "https://github.com/eulerdisk", "followers_url": "https://api.github.com/users/eulerdisk/followers", "following_url": "https://api.github.com/users/eulerdisk/following{/other_user}", "gists_url": "https://api.github.com/users/eulerdisk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eulerdisk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eulerdisk/subscriptions", "organizations_url": "https://api.github.com/users/eulerdisk/orgs", "repos_url": "https://api.github.com/users/eulerdisk/repos", "events_url": "https://api.github.com/users/eulerdisk/events{/privacy}", "received_events_url": "https://api.github.com/users/eulerdisk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "914421495835380b96e0016763fda6eff31a8179", "url": "https://api.github.com/repos/rust-lang/rust/commits/914421495835380b96e0016763fda6eff31a8179", "html_url": "https://github.com/rust-lang/rust/commit/914421495835380b96e0016763fda6eff31a8179"}], "stats": {"total": 34, "additions": 18, "deletions": 16}, "files": [{"sha": "ce80be17fed2c1e118fe7b57a955519d2ad092f8", "filename": "crates/ra_hir/src/resolve.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_hir%2Fsrc%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_hir%2Fsrc%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fresolve.rs?ref=200032852be0c66b978c875a8edf0eca1f08b901", "patch": "@@ -14,12 +14,8 @@ use crate::{\n     generics::GenericParams,\n     expr::{scope::{ExprScopes, ScopeId}, PatId},\n     impl_block::ImplBlock,\n-<<<<<<< HEAD\n     path::Path,\n     Trait\n-=======\n-    path::Path, Trait,\n->>>>>>> complete_import: add new import resolver infrastructure with some hardcoded importable name.\n };\n \n #[derive(Debug, Clone, Default)]"}, {"sha": "42399622adb5746370d910970edcc7dc7482b549", "filename": "crates/ra_hir/src/source_binder.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs?ref=200032852be0c66b978c875a8edf0eca1f08b901", "patch": "@@ -19,11 +19,7 @@ use ra_syntax::{\n \n use crate::{\n     HirDatabase, Function, Struct, Enum, Const, Static, Either, DefWithBody, PerNs, Name,\n-<<<<<<< HEAD\n-    AsName, Module, HirFileId, Crate, Trait, Resolver, Ty,\n-=======\n-    AsName, Module, HirFileId, Crate, Trait, Resolver, ImportResolver,\n->>>>>>> complete_import: add new import resolver infrastructure with some hardcoded importable name.\n+    AsName, Module, HirFileId, Crate, Trait, Resolver, Ty, ImportResolver,\n     expr::{BodySourceMap, scope::{ScopeId, ExprScopes}},\n     ids::LocationCtx,\n     expr, AstId,"}, {"sha": "5bd5376c92c932338837ff938ea4729e59d9a279", "filename": "crates/ra_ide_api/src/completion/complete_scope.rs", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/200032852be0c66b978c875a8edf0eca1f08b901/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=200032852be0c66b978c875a8edf0eca1f08b901", "patch": "@@ -23,13 +23,23 @@ pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) {\n                 );\n                 builder.finish()\n             };\n-            CompletionItem::new(\n-                CompletionKind::Reference,\n-                ctx.source_range(),\n-                build_import_label(&name, &path),\n-            )\n-            .text_edit(edit)\n-            .add_to(acc)\n+\n+            // Hack: copied this check form conv.rs beacause auto import can produce edits\n+            // that invalidate assert in conv_with.\n+            if edit\n+                .as_atoms()\n+                .iter()\n+                .filter(|atom| !ctx.source_range().is_subrange(&atom.delete))\n+                .all(|atom| ctx.source_range().intersection(&atom.delete).is_none())\n+            {\n+                CompletionItem::new(\n+                    CompletionKind::Reference,\n+                    ctx.source_range(),\n+                    build_import_label(&name, &path),\n+                )\n+                .text_edit(edit)\n+                .add_to(acc);\n+            }\n         });\n     }\n }"}]}