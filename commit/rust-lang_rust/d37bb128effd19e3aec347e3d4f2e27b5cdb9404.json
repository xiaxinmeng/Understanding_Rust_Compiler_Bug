{"sha": "d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzN2JiMTI4ZWZmZDE5ZTNhZWMzNDdlM2Q0ZjJlMjdiNWNkYjk0MDQ=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-13T20:12:36Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-19T15:02:06Z"}, "message": "Collect generic args in struct variant paths as well", "tree": {"sha": "e038fa676e1cce04fa6a757b66077d42e6a07fec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e038fa676e1cce04fa6a757b66077d42e6a07fec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "html_url": "https://github.com/rust-lang/rust/commit/d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d37bb128effd19e3aec347e3d4f2e27b5cdb9404/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc4562ab6ecfced33f5d7a2e428c8caca8f9c3f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc4562ab6ecfced33f5d7a2e428c8caca8f9c3f1", "html_url": "https://github.com/rust-lang/rust/commit/cc4562ab6ecfced33f5d7a2e428c8caca8f9c3f1"}], "stats": {"total": 39, "additions": 24, "deletions": 15}, "files": [{"sha": "1d2d1b90681fceeb93a5c9f9115fd3835d0a7fde", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/d37bb128effd19e3aec347e3d4f2e27b5cdb9404/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d37bb128effd19e3aec347e3d4f2e27b5cdb9404/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "patch": "@@ -1054,25 +1054,34 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n     }\n \n     fn resolve_variant(&mut self, path: Option<&Path>) -> (Ty, Option<DefId>) {\n-        let path = if let Some(path) = path {\n-            path\n-        } else {\n-            return (Ty::Unknown, None);\n+        let path = match path {\n+            Some(path) => path,\n+            None => return (Ty::Unknown, None),\n         };\n-        let def_id = if let Some(def_id) = self.module.resolve_path(self.db, &path).take_types() {\n-            def_id\n-        } else {\n-            return (Ty::Unknown, None);\n+        let def_id = match self.module.resolve_path(self.db, &path).take_types() {\n+            Some(def_id) => def_id,\n+            _ => return (Ty::Unknown, None),\n         };\n+        // TODO remove the duplication between here and `Ty::from_path`?\n+        // TODO provide generics of function\n+        let generics = Generics::default();\n+        let substs = Ty::substs_from_path(\n+            self.db,\n+            &self.module,\n+            self.impl_block.as_ref(),\n+            &generics,\n+            path,\n+            def_id,\n+        );\n         match def_id.resolve(self.db) {\n             Def::Struct(s) => {\n                 let ty = type_for_struct(self.db, s);\n-                let ty = self.insert_type_vars(ty);\n+                let ty = self.insert_type_vars(ty.apply_substs(substs));\n                 (ty, Some(def_id))\n             }\n             Def::EnumVariant(ev) => {\n                 let ty = type_for_enum_variant(self.db, ev);\n-                let ty = self.insert_type_vars(ty);\n+                let ty = self.insert_type_vars(ty.apply_substs(substs));\n                 (ty, Some(def_id))\n             }\n             _ => (Ty::Unknown, None),"}, {"sha": "1024a39a96d65636946f98d21a263910a705d3f2", "filename": "crates/ra_hir/src/ty/tests/data/struct_generics.txt", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d37bb128effd19e3aec347e3d4f2e27b5cdb9404/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fstruct_generics.txt", "raw_url": "https://github.com/rust-lang/rust/raw/d37bb128effd19e3aec347e3d4f2e27b5cdb9404/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fstruct_generics.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fstruct_generics.txt?ref=d37bb128effd19e3aec347e3d4f2e27b5cdb9404", "patch": "@@ -8,8 +8,8 @@\n [88; 89) 'i': i32\n [97; 99) 'a2': A<i32>\n [97; 101) 'a2.x': i32\n-[111; 113) 'a3': A<i32>\n-[116; 134) 'A::<i1...x: 1 }': A<i32>\n-[131; 132) '1': i32\n-[140; 142) 'a3': A<i32>\n-[140; 144) 'a3.x': i32\n+[111; 113) 'a3': A<i128>\n+[116; 134) 'A::<i1...x: 1 }': A<i128>\n+[131; 132) '1': i128\n+[140; 142) 'a3': A<i128>\n+[140; 144) 'a3.x': i128"}]}