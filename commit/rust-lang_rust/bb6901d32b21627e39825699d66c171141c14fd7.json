{"sha": "bb6901d32b21627e39825699d66c171141c14fd7", "node_id": "C_kwDOAAsO6NoAKGJiNjkwMWQzMmIyMTYyN2UzOTgyNTY5OWQ2NmMxNzExNDFjMTRmZDc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-01T02:33:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-01T02:33:06Z"}, "message": "Rollup merge of #90333 - jsha:flashy-searchbar, r=GuillaumeGomez\n\nrustdoc: remove flicker during page load\n\nThe search bar has a `:disabled` style that makes it grey, which creates a distracting flicker from grey to white when the page finishes loading. The search bar should stay the same color throughout page load.\n\nA blank white search bar might create an incorrect impression for users with JS turned off. Since they can't use the search functionality, I've hidden the search bar in noscript.css.\n\nFixes #90246\nr? `@GuillaumeGomez`\n\nDemo: https://rustdoc.crud.net/jsha/flashy-searchbar/std/string/struct.String.html", "tree": {"sha": "7a8c97cc1a45894c6754579153e64e9f0172fe79", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a8c97cc1a45894c6754579153e64e9f0172fe79"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb6901d32b21627e39825699d66c171141c14fd7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhf1HiCRBK7hj4Ov3rIwAAnFEIAEnJ3adbbql/RRZRNVwxEL1l\nvgxonh8QoNx3HfwDzfkzT9Y+/TXLI5kiaGOFfzVn3knMztVrkrBo/PSK5Bh4U3cE\nflcsO3GjGas4luOwOpdajwCU4X3PqH18moxxlS+r5k4eJLrlSrsSOvmpN+w4qT4R\nOq9bybCbWmpTt3JEdoJDHsubrYizCW17doPu1KVBLqbyLiq3Dwk23x05IQUTMN+3\nNPRltAVju7HrRK2DX4T6DInC7MhqIsHXWLGG6S3SIQTAZcwmu4CCZY+fhoApuyFu\nSttnXY4DqKG8dBUn/sGcO4bJ4UVMfy6gle17+3uASnDPLKbd7oHT04l/n/VMyi0=\n=eHMi\n-----END PGP SIGNATURE-----\n", "payload": "tree 7a8c97cc1a45894c6754579153e64e9f0172fe79\nparent b7be4fc99fc824f06ea86587643d3f5ffb1304ea\nparent a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1635733986 +0100\ncommitter GitHub <noreply@github.com> 1635733986 +0100\n\nRollup merge of #90333 - jsha:flashy-searchbar, r=GuillaumeGomez\n\nrustdoc: remove flicker during page load\n\nThe search bar has a `:disabled` style that makes it grey, which creates a distracting flicker from grey to white when the page finishes loading. The search bar should stay the same color throughout page load.\n\nA blank white search bar might create an incorrect impression for users with JS turned off. Since they can't use the search functionality, I've hidden the search bar in noscript.css.\n\nFixes #90246\nr? `@GuillaumeGomez`\n\nDemo: https://rustdoc.crud.net/jsha/flashy-searchbar/std/string/struct.String.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb6901d32b21627e39825699d66c171141c14fd7", "html_url": "https://github.com/rust-lang/rust/commit/bb6901d32b21627e39825699d66c171141c14fd7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb6901d32b21627e39825699d66c171141c14fd7/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "html_url": "https://github.com/rust-lang/rust/commit/b7be4fc99fc824f06ea86587643d3f5ffb1304ea"}, {"sha": "a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "url": "https://api.github.com/repos/rust-lang/rust/commits/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60", "html_url": "https://github.com/rust-lang/rust/commit/a4fe76ff7cd66d4cad19c0f32a5d3c9efd1d4a60"}], "stats": {"total": 32, "additions": 18, "deletions": 14}, "files": [{"sha": "37ea7b000339f0de6d57ed9b62afc5298eaa6f5d", "filename": "src/librustdoc/html/static/css/noscript.css", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fnoscript.css?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -13,3 +13,12 @@ rules.\n \t/* It requires JS to work so no need to display it in this case. */\n \tdisplay: none;\n }\n+\n+.sub {\n+\t/* The search bar and related controls don't work without JS */\n+\tdisplay: none;\n+}\n+\n+#theme-picker {\n+\tdisplay: none;\n+}"}, {"sha": "ba7fb3b5456a55425d76939bab0e56775f9da13e", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -255,10 +255,6 @@ details.undocumented > summary::before {\n \tbox-shadow: 0 0 0 1px #148099,0 0 0 2px transparent;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #3e3e3e;\n-}\n-\n .module-item .stab,\n .import-item .stab {\n \tcolor: #000;"}, {"sha": "77ac217e6f41dd9f76efc9b9c298ab4bc38d2889", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -219,10 +219,6 @@ details.undocumented > summary::before {\n \tborder-color: #008dfd;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #c5c4c4;\n-}\n-\n #crate-search + .search-input:focus {\n \tbox-shadow: 0 0 8px 4px #078dd8;\n }"}, {"sha": "6df137e39141508a88674a94a53c516efc79d9f1", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -209,10 +209,6 @@ details.undocumented > summary::before {\n \tborder-color: #66afe9;\n }\n \n-.search-input:disabled {\n-\tbackground-color: #e6e6e6;\n-}\n-\n #crate-search + .search-input:focus {\n \tbox-shadow: 0 0 8px #078dd8;\n }"}, {"sha": "c421c6e9dc16ea733be039e9ac71832635790830", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -263,7 +263,9 @@ function hideThemeButtonState() {\n                 search_input.placeholder = searchState.input.origPlaceholder;\n             });\n \n-            search_input.removeAttribute('disabled');\n+            if (search_input.value != '') {\n+                loadSearch();\n+            }\n \n             // `crates{version}.js` should always be loaded before this script, so we can use it\n             // safely."}, {"sha": "cead54412bbbd2f43ae1ced3649a27cf7b570f80", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -85,7 +85,6 @@\n                     <input {# -#}\n                         class=\"search-input\" {# -#}\n                         name=\"search\" {# -#}\n-                        disabled {# -#}\n                         autocomplete=\"off\" {# -#}\n                         spellcheck=\"false\" {# -#}\n                         placeholder=\"Click or press \u2018S\u2019 to search, \u2018?\u2019 for more options\u2026\" {# -#}"}, {"sha": "1693f7b645f1baec352f0f809f55bf278f907a88", "filename": "src/test/rustdoc-gui/javascript-disabled.goml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bb6901d32b21627e39825699d66c171141c14fd7/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6901d32b21627e39825699d66c171141c14fd7/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fjavascript-disabled.goml?ref=bb6901d32b21627e39825699d66c171141c14fd7", "patch": "@@ -0,0 +1,6 @@\n+// When JavaScript is disabled, we hide the search bar, because it\n+// can't be used without JS.\n+javascript: false\n+\n+goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n+assert-css: (\".sub\", {\"display\": \"none\"})"}]}