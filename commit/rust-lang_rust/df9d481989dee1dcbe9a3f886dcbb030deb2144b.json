{"sha": "df9d481989dee1dcbe9a3f886dcbb030deb2144b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmOWQ0ODE5ODlkZWUxZGNiZTlhM2Y4ODZkY2JiMDMwZGViMjE0NGI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-07-25T12:19:57Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-07-25T12:21:06Z"}, "message": "tell users how to disable the leak check", "tree": {"sha": "f7aa2c475940b5090ba9561e9869a7e625e4ab93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f7aa2c475940b5090ba9561e9869a7e625e4ab93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df9d481989dee1dcbe9a3f886dcbb030deb2144b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df9d481989dee1dcbe9a3f886dcbb030deb2144b", "html_url": "https://github.com/rust-lang/rust/commit/df9d481989dee1dcbe9a3f886dcbb030deb2144b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df9d481989dee1dcbe9a3f886dcbb030deb2144b/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71efd950d17faabc4025acb460c4000bf97978f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/71efd950d17faabc4025acb460c4000bf97978f7", "html_url": "https://github.com/rust-lang/rust/commit/71efd950d17faabc4025acb460c4000bf97978f7"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "e559dfedf933bfc462ea183eec15969dd1aca31b", "filename": "src/eval.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/df9d481989dee1dcbe9a3f886dcbb030deb2144b/src%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df9d481989dee1dcbe9a3f886dcbb030deb2144b/src%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Feval.rs?ref=df9d481989dee1dcbe9a3f886dcbb030deb2144b", "patch": "@@ -302,14 +302,18 @@ pub fn eval_main<'tcx>(tcx: TyCtxt<'tcx>, main_id: DefId, config: MiriConfig) ->\n             if !ignore_leaks {\n                 // Check for thread leaks.\n                 if !ecx.have_all_terminated() {\n-                    tcx.sess.err(\"the main thread terminated without waiting for all remaining threads\");\n+                    tcx.sess.err(\n+                        \"the main thread terminated without waiting for all remaining threads\",\n+                    );\n+                    tcx.sess.note_without_error(\"pass `-Zmiri-ignore-leaks` to disable this check\");\n                     return None;\n                 }\n                 // Check for memory leaks.\n                 info!(\"Additonal static roots: {:?}\", ecx.machine.static_roots);\n                 let leaks = ecx.memory.leak_report(&ecx.machine.static_roots);\n                 if leaks != 0 {\n                     tcx.sess.err(\"the evaluated program leaked memory\");\n+                    tcx.sess.note_without_error(\"pass `-Zmiri-ignore-leaks` to disable this check\");\n                     // Ignore the provided return code - let the reported error\n                     // determine the return code.\n                     return None;"}]}