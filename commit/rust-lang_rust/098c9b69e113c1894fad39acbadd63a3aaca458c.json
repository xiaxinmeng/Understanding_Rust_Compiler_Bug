{"sha": "098c9b69e113c1894fad39acbadd63a3aaca458c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5OGM5YjY5ZTExM2MxODk0ZmFkMzlhY2JhZGQ2M2EzYWFjYTQ1OGM=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-12-22T08:27:26Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-12-22T08:58:10Z"}, "message": "Fix non-termination in `resolve`.", "tree": {"sha": "fe8ef511beff75af49007f04a7c7e3f815da751f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe8ef511beff75af49007f04a7c7e3f815da751f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/098c9b69e113c1894fad39acbadd63a3aaca458c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/098c9b69e113c1894fad39acbadd63a3aaca458c", "html_url": "https://github.com/rust-lang/rust/commit/098c9b69e113c1894fad39acbadd63a3aaca458c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/098c9b69e113c1894fad39acbadd63a3aaca458c/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c217ab6c8dc1a305304b00a414be5f39ea6a2c81", "url": "https://api.github.com/repos/rust-lang/rust/commits/c217ab6c8dc1a305304b00a414be5f39ea6a2c81", "html_url": "https://github.com/rust-lang/rust/commit/c217ab6c8dc1a305304b00a414be5f39ea6a2c81"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "091dc9fd4bc7f36ea95f19ac90354898d43ba015", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/098c9b69e113c1894fad39acbadd63a3aaca458c/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/098c9b69e113c1894fad39acbadd63a3aaca458c/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=098c9b69e113c1894fad39acbadd63a3aaca458c", "patch": "@@ -2943,6 +2943,7 @@ impl<'a> Resolver<'a> {\n \n         let mut lookup_results = Vec::new();\n         let mut worklist = Vec::new();\n+        let mut seen_modules = FxHashSet();\n         worklist.push((self.graph_root, Vec::new(), false));\n \n         while let Some((in_module,\n@@ -2989,7 +2990,7 @@ impl<'a> Resolver<'a> {\n                     if !in_module_is_extern || name_binding.vis == ty::Visibility::Public {\n                         // add the module to the lookup\n                         let is_extern = in_module_is_extern || name_binding.is_extern_crate();\n-                        if !worklist.iter().any(|&(m, ..)| m.def() == module.def()) {\n+                        if seen_modules.insert(module.def_id().unwrap()) {\n                             worklist.push((module, path_segments, is_extern));\n                         }\n                     }"}, {"sha": "aa444d45eeb7a1dbb56eb8ef38371cad49abfef2", "filename": "src/test/compile-fail/recursive-reexports.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/098c9b69e113c1894fad39acbadd63a3aaca458c/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/098c9b69e113c1894fad39acbadd63a3aaca458c/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frecursive-reexports.rs?ref=098c9b69e113c1894fad39acbadd63a3aaca458c", "patch": "@@ -10,6 +10,8 @@\n \n // aux-build:recursive_reexports.rs\n \n-fn f() -> recursive_reexports::S {} //~ ERROR undeclared\n+extern crate recursive_reexports;\n+\n+fn f() -> recursive_reexports::S {} //~ ERROR type name `recursive_reexports::S` is undefined\n \n fn main() {}"}]}