{"sha": "bdff9463a0afbbdcd52825ead6b6f9f1245652db", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkZmY5NDYzYTBhZmJiZGNkNTI4MjVlYWQ2YjZmOWYxMjQ1NjUyZGI=", "commit": {"author": {"name": "Christopher Vittal", "email": "christopher.vittal@gmail.com", "date": "2017-11-10T17:58:52Z"}, "committer": {"name": "Christopher Vittal", "email": "christopher.vittal@gmail.com", "date": "2017-11-15T20:46:01Z"}, "message": "Add universal_impl_trait feature gate\n\nMove feature gate check to inside HIR lowering. Change error messages\nand update tests.", "tree": {"sha": "c0fe98cd7611f0311268b9392a786e5990f0e21b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0fe98cd7611f0311268b9392a786e5990f0e21b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdff9463a0afbbdcd52825ead6b6f9f1245652db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdff9463a0afbbdcd52825ead6b6f9f1245652db", "html_url": "https://github.com/rust-lang/rust/commit/bdff9463a0afbbdcd52825ead6b6f9f1245652db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdff9463a0afbbdcd52825ead6b6f9f1245652db/comments", "author": {"login": "chrisvittal", "id": 15916123, "node_id": "MDQ6VXNlcjE1OTE2MTIz", "avatar_url": "https://avatars.githubusercontent.com/u/15916123?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisvittal", "html_url": "https://github.com/chrisvittal", "followers_url": "https://api.github.com/users/chrisvittal/followers", "following_url": "https://api.github.com/users/chrisvittal/following{/other_user}", "gists_url": "https://api.github.com/users/chrisvittal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisvittal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisvittal/subscriptions", "organizations_url": "https://api.github.com/users/chrisvittal/orgs", "repos_url": "https://api.github.com/users/chrisvittal/repos", "events_url": "https://api.github.com/users/chrisvittal/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisvittal/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chrisvittal", "id": 15916123, "node_id": "MDQ6VXNlcjE1OTE2MTIz", "avatar_url": "https://avatars.githubusercontent.com/u/15916123?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisvittal", "html_url": "https://github.com/chrisvittal", "followers_url": "https://api.github.com/users/chrisvittal/followers", "following_url": "https://api.github.com/users/chrisvittal/following{/other_user}", "gists_url": "https://api.github.com/users/chrisvittal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisvittal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisvittal/subscriptions", "organizations_url": "https://api.github.com/users/chrisvittal/orgs", "repos_url": "https://api.github.com/users/chrisvittal/repos", "events_url": "https://api.github.com/users/chrisvittal/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisvittal/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "109f2dd36b38d0642246ad50101bba21f5c0fba9", "url": "https://api.github.com/repos/rust-lang/rust/commits/109f2dd36b38d0642246ad50101bba21f5c0fba9", "html_url": "https://github.com/rust-lang/rust/commit/109f2dd36b38d0642246ad50101bba21f5c0fba9"}], "stats": {"total": 37, "additions": 32, "deletions": 5}, "files": [{"sha": "723f50faa85641e2300a91fb7bbded8822082036", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=bdff9463a0afbbdcd52825ead6b6f9f1245652db", "patch": "@@ -771,9 +771,21 @@ impl<'a> LoweringContext<'a> {\n                 use syntax::feature_gate::{emit_feature_err, GateIssue};\n                 match itctx {\n                     ImplTraitContext::Existential => {\n+                        let has_feature = self.sess.features.borrow().conservative_impl_trait;\n+                        if !t.span.allows_unstable() && !has_feature {\n+                            emit_feature_err(&self.sess.parse_sess, \"conservative_impl_trait\",\n+                                             t.span, GateIssue::Language,\n+                                             \"`impl Trait` in return position is experimental\");\n+                        }\n                         hir::TyImplTraitExistential(self.lower_bounds(bounds, itctx))\n                     },\n                     ImplTraitContext::Universal(def_id) => {\n+                        let has_feature = self.sess.features.borrow().universal_impl_trait;\n+                        if !t.span.allows_unstable() && !has_feature {\n+                            emit_feature_err(&self.sess.parse_sess, \"universal_impl_trait\",\n+                                             t.span, GateIssue::Language,\n+                                             \"`impl Trait` in argument position is experimental\");\n+                        }\n                         hir::TyImplTraitUniversal(def_id, self.lower_bounds(bounds, itctx))\n                     },\n                     ImplTraitContext::Disallowed => {"}, {"sha": "97eec3a21e9d16629d8cb28890761e2fa4da68bc", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=bdff9463a0afbbdcd52825ead6b6f9f1245652db", "patch": "@@ -275,6 +275,9 @@ declare_features! (\n     // Allows `impl Trait` in function return types.\n     (active, conservative_impl_trait, \"1.12.0\", Some(34511)),\n \n+    // Allows `impl Trait` in function arguments.\n+    (active, universal_impl_trait, \"1.23.0\", Some(34511)),\n+\n     // The `!` type\n     (active, never_type, \"1.13.0\", Some(35121)),\n \n@@ -1451,10 +1454,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n             ast::TyKind::BareFn(ref bare_fn_ty) => {\n                 self.check_abi(bare_fn_ty.abi, ty.span);\n             }\n-            ast::TyKind::ImplTrait(..) => {\n-                gate_feature_post!(&self, conservative_impl_trait, ty.span,\n-                                   \"`impl Trait` is experimental\");\n-            }\n             ast::TyKind::Never => {\n                 gate_feature_post!(&self, never_type, ty.span,\n                                    \"The `!` type is experimental\");"}, {"sha": "e5bdf3a42eb3e6b0d1ad5a170830d258833125aa", "filename": "src/test/compile-fail/impl-trait/feature-gate-universal.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate-universal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate-universal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate-universal.rs?ref=bdff9463a0afbbdcd52825ead6b6f9f1245652db", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// gate-test-universal_impl_trait\n+\n+fn foo(x: impl std::fmt::Debug) { print!(\"{:?}\", x); }\n+//~^ ERROR `impl Trait` in argument position is experimental\n+\n+fn main() {}"}, {"sha": "d46a16450db5228b8667f1c82f026151fc93feea", "filename": "src/test/compile-fail/impl-trait/feature-gate.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdff9463a0afbbdcd52825ead6b6f9f1245652db/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fimpl-trait%2Ffeature-gate.rs?ref=bdff9463a0afbbdcd52825ead6b6f9f1245652db", "patch": "@@ -11,6 +11,6 @@\n // gate-test-conservative_impl_trait\n \n fn foo() -> impl Fn() { || {} }\n-//~^ ERROR `impl Trait` is experimental\n+//~^ ERROR `impl Trait` in return position is experimental\n \n fn main() {}"}]}