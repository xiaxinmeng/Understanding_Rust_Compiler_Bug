{"sha": "d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "node_id": "C_kwDOAAsO6NoAKGQ3NmE5Mzk0YmFlM2EyZmY0NWM2MzYwMDU1YTFhNDNlMTViYzQyZWM", "commit": {"author": {"name": "est31", "email": "MTest31@outlook.com", "date": "2022-04-17T13:54:04Z"}, "committer": {"name": "est31", "email": "MTest31@outlook.com", "date": "2022-05-05T17:13:00Z"}, "message": "Add tests\n\nAlso rename the test files for the unused_macros lint to avoid confusion.\nThe test files now follow a <lint_name><-maybe-decl>.rs scheme.", "tree": {"sha": "5ed866d9e6c3d2eca791f572fc5a78418eb904e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ed866d9e6c3d2eca791f572fc5a78418eb904e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "html_url": "https://github.com/rust-lang/rust/commit/d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/comments", "author": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "committer": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5646e9a172698edb4ff39f6c47d314aaa437b0fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/5646e9a172698edb4ff39f6c47d314aaa437b0fb", "html_url": "https://github.com/rust-lang/rust/commit/5646e9a172698edb4ff39f6c47d314aaa437b0fb"}], "stats": {"total": 238, "additions": 195, "deletions": 43}, "files": [{"sha": "537c84940fd019f30d25636800dc130347b31631", "filename": "src/test/ui/lint/unused/unused-macro-rules-decl.rs", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.rs?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -0,0 +1,49 @@\n+#![feature(decl_macro)]\n+#![deny(unused_macro_rules)]\n+// To make sure we are not hitting this\n+#![deny(unused_macros)]\n+\n+// Most simple case\n+macro num {\n+    (one) => { 1 },\n+    (two) => { 2 }, //~ ERROR: 2nd rule of macro\n+    (three) => { 3 },\n+    (four) => { 4 }, //~ ERROR: 4th rule of macro\n+}\n+const _NUM: u8 = num!(one) + num!(three);\n+\n+// Check that allowing the lint works\n+#[allow(unused_macro_rules)]\n+macro num_allowed {\n+    (one) => { 1 },\n+    (two) => { 2 },\n+    (three) => { 3 },\n+    (four) => { 4 },\n+}\n+const _NUM_ALLOWED: u8 = num_allowed!(one) + num_allowed!(three);\n+\n+// Check that macro calls inside the macro trigger as usage\n+macro num_rec {\n+    (one) => { 1 },\n+    (two) => {\n+        num_rec!(one) + num_rec!(one)\n+    },\n+    (three) => { //~ ERROR: 3rd rule of macro\n+        num_rec!(one) + num_rec!(two)\n+    },\n+    (four) => {\n+        num_rec!(two) + num_rec!(two)\n+    },\n+}\n+const _NUM_RECURSIVE: u8 = num_rec!(four);\n+\n+// No error if the macro is public\n+pub macro num_public {\n+    (one) => { 1 },\n+    (two) => { 2 },\n+    (three) => { 3 },\n+    (four) => { 4 },\n+}\n+const _NUM_PUBLIC: u8 = num_public!(one) + num_public!(three);\n+\n+fn main() {}"}, {"sha": "4d9b22feda2a2f2b409700c0e6fab353a381b3e4", "filename": "src/test/ui/lint/unused/unused-macro-rules-decl.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules-decl.stderr?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -0,0 +1,26 @@\n+error: 4th rule of macro `num` is never used\n+  --> $DIR/unused-macro-rules-decl.rs:11:5\n+   |\n+LL |     (four) => { 4 },\n+   |     ^^^^^^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/unused-macro-rules-decl.rs:2:9\n+   |\n+LL | #![deny(unused_macro_rules)]\n+   |         ^^^^^^^^^^^^^^^^^^\n+\n+error: 2nd rule of macro `num` is never used\n+  --> $DIR/unused-macro-rules-decl.rs:9:5\n+   |\n+LL |     (two) => { 2 },\n+   |     ^^^^^\n+\n+error: 3rd rule of macro `num_rec` is never used\n+  --> $DIR/unused-macro-rules-decl.rs:31:5\n+   |\n+LL |     (three) => {\n+   |     ^^^^^^^\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "eeaf4d1b0a9ce31b99d9cfad758a496be991d356", "filename": "src/test/ui/lint/unused/unused-macro-rules.rs", "status": "modified", "additions": 36, "deletions": 18, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.rs?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -1,29 +1,47 @@\n+#![deny(unused_macro_rules)]\n+// To make sure we are not hitting this\n #![deny(unused_macros)]\n \n // Most simple case\n-macro_rules! unused { //~ ERROR: unused macro definition\n-    () => {};\n+macro_rules! num {\n+    (one) => { 1 };\n+    (two) => { 2 }; //~ ERROR: 2nd rule of macro\n+    (three) => { 3 };\n+    (four) => { 4 }; //~ ERROR: 4th rule of macro\n }\n+const _NUM: u8 = num!(one) + num!(three);\n \n-// Test macros created by macros\n-macro_rules! create_macro {\n-    () => {\n-        macro_rules! m { //~ ERROR: unused macro definition\n-            () => {};\n-        }\n-    };\n+// Check that allowing the lint works\n+#[allow(unused_macro_rules)]\n+macro_rules! num_allowed {\n+    (one) => { 1 };\n+    (two) => { 2 };\n+    (three) => { 3 };\n+    (four) => { 4 };\n }\n-create_macro!();\n+const _NUM_ALLOWED: u8 = num_allowed!(one) + num_allowed!(three);\n \n-#[allow(unused_macros)]\n-mod bar {\n-    // Test that putting the #[deny] close to the macro's definition\n-    // works.\n+// Check that macro calls inside the macro trigger as usage\n+macro_rules! num_rec {\n+    (one) => { 1 };\n+    (two) => {\n+        num_rec!(one) + num_rec!(one)\n+    };\n+    (three) => { //~ ERROR: 3rd rule of macro\n+        num_rec!(one) + num_rec!(two)\n+    };\n+    (four) => { num_rec!(two) + num_rec!(two) };\n+}\n+const _NUM_RECURSIVE: u8 = num_rec!(four);\n \n-    #[deny(unused_macros)]\n-    macro_rules! unused { //~ ERROR: unused macro definition\n-        () => {};\n-    }\n+// No error if the macro is being exported\n+#[macro_export]\n+macro_rules! num_exported {\n+    (one) => { 1 };\n+    (two) => { 2 };\n+    (three) => { 3 };\n+    (four) => { 4 };\n }\n+const _NUM_EXPORTED: u8 = num_exported!(one) + num_exported!(three);\n \n fn main() {}"}, {"sha": "2b3098a5128d458668569303ad8f626d031e2885", "filename": "src/test/ui/lint/unused/unused-macro-rules.stderr", "status": "modified", "additions": 14, "deletions": 20, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macro-rules.stderr?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -1,32 +1,26 @@\n-error: unused macro definition: `unused`\n-  --> $DIR/unused-macro-rules.rs:4:14\n+error: 4th rule of macro `num` is never used\n+  --> $DIR/unused-macro-rules.rs:10:5\n    |\n-LL | macro_rules! unused {\n-   |              ^^^^^^\n+LL |     (four) => { 4 };\n+   |     ^^^^^^\n    |\n note: the lint level is defined here\n   --> $DIR/unused-macro-rules.rs:1:9\n    |\n-LL | #![deny(unused_macros)]\n-   |         ^^^^^^^^^^^^^\n+LL | #![deny(unused_macro_rules)]\n+   |         ^^^^^^^^^^^^^^^^^^\n \n-error: unused macro definition: `m`\n-  --> $DIR/unused-macro-rules.rs:11:22\n+error: 2nd rule of macro `num` is never used\n+  --> $DIR/unused-macro-rules.rs:8:5\n    |\n-LL |         macro_rules! m {\n-   |                      ^\n+LL |     (two) => { 2 };\n+   |     ^^^^^\n \n-error: unused macro definition: `unused`\n-  --> $DIR/unused-macro-rules.rs:24:18\n+error: 3rd rule of macro `num_rec` is never used\n+  --> $DIR/unused-macro-rules.rs:30:5\n    |\n-LL |     macro_rules! unused {\n-   |                  ^^^^^^\n-   |\n-note: the lint level is defined here\n-  --> $DIR/unused-macro-rules.rs:23:12\n-   |\n-LL |     #[deny(unused_macros)]\n-   |            ^^^^^^^^^^^^^\n+LL |     (three) => {\n+   |     ^^^^^^^\n \n error: aborting due to 3 previous errors\n "}, {"sha": "21f6108b18ad5b67b4396d20221a59b3215a8276", "filename": "src/test/ui/lint/unused/unused-macros-decl.rs", "status": "renamed", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.rs?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -1,5 +1,7 @@\n #![feature(decl_macro)]\n #![deny(unused_macros)]\n+// To make sure we are not hitting this\n+#![deny(unused_macro_rules)]\n \n // Most simple case\n macro unused { //~ ERROR: unused macro definition", "previous_filename": "src/test/ui/lint/unused/unused-macro.rs"}, {"sha": "1f426b9d91a610e51a9e8906ee23452618ced202", "filename": "src/test/ui/lint/unused/unused-macros-decl.stderr", "status": "renamed", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros-decl.stderr?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -1,29 +1,29 @@\n error: unused macro definition: `unused`\n-  --> $DIR/unused-macro.rs:5:7\n+  --> $DIR/unused-macros-decl.rs:7:7\n    |\n LL | macro unused {\n    |       ^^^^^^\n    |\n note: the lint level is defined here\n-  --> $DIR/unused-macro.rs:2:9\n+  --> $DIR/unused-macros-decl.rs:2:9\n    |\n LL | #![deny(unused_macros)]\n    |         ^^^^^^^^^^^^^\n \n error: unused macro definition: `unused`\n-  --> $DIR/unused-macro.rs:15:11\n+  --> $DIR/unused-macros-decl.rs:17:11\n    |\n LL |     macro unused {\n    |           ^^^^^^\n    |\n note: the lint level is defined here\n-  --> $DIR/unused-macro.rs:14:12\n+  --> $DIR/unused-macros-decl.rs:16:12\n    |\n LL |     #[deny(unused_macros)]\n    |            ^^^^^^^^^^^^^\n \n error: unused macro definition: `unused`\n-  --> $DIR/unused-macro.rs:21:22\n+  --> $DIR/unused-macros-decl.rs:23:22\n    |\n LL |     pub(crate) macro unused {\n    |                      ^^^^^^", "previous_filename": "src/test/ui/lint/unused/unused-macro.stderr"}, {"sha": "70b50b2082b36069d78f5710e125edf1c4729d7f", "filename": "src/test/ui/lint/unused/unused-macros.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.rs?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -0,0 +1,31 @@\n+#![deny(unused_macros)]\n+// To make sure we are not hitting this\n+#![deny(unused_macro_rules)]\n+\n+// Most simple case\n+macro_rules! unused { //~ ERROR: unused macro definition\n+    () => {};\n+}\n+\n+// Test macros created by macros\n+macro_rules! create_macro {\n+    () => {\n+        macro_rules! m { //~ ERROR: unused macro definition\n+            () => {};\n+        }\n+    };\n+}\n+create_macro!();\n+\n+#[allow(unused_macros)]\n+mod bar {\n+    // Test that putting the #[deny] close to the macro's definition\n+    // works.\n+\n+    #[deny(unused_macros)]\n+    macro_rules! unused { //~ ERROR: unused macro definition\n+        () => {};\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "d0baf5becec4c3594bdfcfb222167a2bbde2195e", "filename": "src/test/ui/lint/unused/unused-macros.stderr", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d76a9394bae3a2ff45c6360055a1a43e15bc42ec/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-macros.stderr?ref=d76a9394bae3a2ff45c6360055a1a43e15bc42ec", "patch": "@@ -0,0 +1,32 @@\n+error: unused macro definition: `unused`\n+  --> $DIR/unused-macros.rs:6:14\n+   |\n+LL | macro_rules! unused {\n+   |              ^^^^^^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/unused-macros.rs:1:9\n+   |\n+LL | #![deny(unused_macros)]\n+   |         ^^^^^^^^^^^^^\n+\n+error: unused macro definition: `m`\n+  --> $DIR/unused-macros.rs:13:22\n+   |\n+LL |         macro_rules! m {\n+   |                      ^\n+\n+error: unused macro definition: `unused`\n+  --> $DIR/unused-macros.rs:26:18\n+   |\n+LL |     macro_rules! unused {\n+   |                  ^^^^^^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/unused-macros.rs:25:12\n+   |\n+LL |     #[deny(unused_macros)]\n+   |            ^^^^^^^^^^^^^\n+\n+error: aborting due to 3 previous errors\n+"}]}