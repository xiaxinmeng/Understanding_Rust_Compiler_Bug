{"sha": "ce97479a159c4185b48269c321b72bde03592ea5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlOTc0NzlhMTU5YzQxODViNDgyNjljMzIxYjcyYmRlMDM1OTJlYTU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2015-11-26T18:14:36Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2015-11-26T18:14:36Z"}, "message": "rustdoc: only show macro arm's lhs", "tree": {"sha": "27ce6d6e826b20bb13f3b972549f8cf5beaef78c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27ce6d6e826b20bb13f3b972549f8cf5beaef78c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce97479a159c4185b48269c321b72bde03592ea5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce97479a159c4185b48269c321b72bde03592ea5", "html_url": "https://github.com/rust-lang/rust/commit/ce97479a159c4185b48269c321b72bde03592ea5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce97479a159c4185b48269c321b72bde03592ea5/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b9a13e6ba83a5619b628c1534b1c6d566157f62", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b9a13e6ba83a5619b628c1534b1c6d566157f62", "html_url": "https://github.com/rust-lang/rust/commit/1b9a13e6ba83a5619b628c1534b1c6d566157f62"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "2bab56791872811912267df3411b09023ac6a436", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=ce97479a159c4185b48269c321b72bde03592ea5", "patch": "@@ -2665,15 +2665,18 @@ pub struct Macro {\n \n impl Clean<Item> for doctree::Macro {\n     fn clean(&self, cx: &DocContext) -> Item {\n+        let name = format!(\"{}!\", self.name.clean(cx));\n         Item {\n-            name: Some(format!(\"{}!\", self.name.clean(cx))),\n+            name: Some(name.clone()),\n             attrs: self.attrs.clean(cx),\n             source: self.whence.clean(cx),\n             visibility: hir::Public.clean(cx),\n             stability: self.stab.clean(cx),\n             def_id: cx.map.local_def_id(self.id),\n             inner: MacroItem(Macro {\n-                source: self.whence.to_src(cx),\n+                source: format!(\"macro_rules! {} {{\\n{}}}\",\n+                    name.trim_right_matches('!'), self.matchers.iter().map(|span|\n+                        format!(\"    {} => {{ ... }}\\n\", span.to_src(cx))).collect::<String>()),\n                 imported_from: self.imported_from.clean(cx),\n             }),\n         }"}, {"sha": "91da906f56df92519ca6ad35a4123b89e396ed11", "filename": "src/librustdoc/doctree.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fdoctree.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fdoctree.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctree.rs?ref=ce97479a159c4185b48269c321b72bde03592ea5", "patch": "@@ -213,6 +213,7 @@ pub struct Macro {\n     pub id: ast::NodeId,\n     pub attrs: Vec<ast::Attribute>,\n     pub whence: Span,\n+    pub matchers: Vec<Span>,\n     pub stab: Option<attr::Stability>,\n     pub imported_from: Option<Name>,\n }"}, {"sha": "17291233e114aa3ceedb60551fdc80b5cc27e3af", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce97479a159c4185b48269c321b72bde03592ea5/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=ce97479a159c4185b48269c321b72bde03592ea5", "patch": "@@ -400,11 +400,15 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n \n     // convert each exported_macro into a doc item\n     fn visit_macro(&self, def: &hir::MacroDef) -> Macro {\n+        // Extract the spans of all matchers. They represent the \"interface\" of the macro.\n+        let matchers = def.body.chunks(4).map(|arm| arm[0].get_span()).collect();\n+\n         Macro {\n             id: def.id,\n             attrs: def.attrs.clone(),\n             name: def.name,\n             whence: def.span,\n+            matchers: matchers,\n             stab: self.stability(def.id),\n             imported_from: def.imported_from,\n         }"}]}