{"sha": "da779988d586690094cefc5091b44befeb90085f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhNzc5OTg4ZDU4NjY5MDA5NGNlZmM1MDkxYjQ0YmVmZWI5MDA4NWY=", "commit": {"author": {"name": "Jeff Olson", "email": "olson.jeffery@gmail.com", "date": "2012-03-22T13:45:06Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-06T22:35:48Z"}, "message": "impl of rustrt::rust_uv_write in c++ and whitespace cleanup", "tree": {"sha": "102c3a741cee335adfae8ae98469ee4e3ac8766c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/102c3a741cee335adfae8ae98469ee4e3ac8766c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da779988d586690094cefc5091b44befeb90085f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da779988d586690094cefc5091b44befeb90085f", "html_url": "https://github.com/rust-lang/rust/commit/da779988d586690094cefc5091b44befeb90085f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da779988d586690094cefc5091b44befeb90085f/comments", "author": {"login": "olsonjeffery", "id": 10408, "node_id": "MDQ6VXNlcjEwNDA4", "avatar_url": "https://avatars.githubusercontent.com/u/10408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olsonjeffery", "html_url": "https://github.com/olsonjeffery", "followers_url": "https://api.github.com/users/olsonjeffery/followers", "following_url": "https://api.github.com/users/olsonjeffery/following{/other_user}", "gists_url": "https://api.github.com/users/olsonjeffery/gists{/gist_id}", "starred_url": "https://api.github.com/users/olsonjeffery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olsonjeffery/subscriptions", "organizations_url": "https://api.github.com/users/olsonjeffery/orgs", "repos_url": "https://api.github.com/users/olsonjeffery/repos", "events_url": "https://api.github.com/users/olsonjeffery/events{/privacy}", "received_events_url": "https://api.github.com/users/olsonjeffery/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05e2c131c46a835f0de2cd03208cddb310877ed2", "url": "https://api.github.com/repos/rust-lang/rust/commits/05e2c131c46a835f0de2cd03208cddb310877ed2", "html_url": "https://github.com/rust-lang/rust/commit/05e2c131c46a835f0de2cd03208cddb310877ed2"}], "stats": {"total": 83, "additions": 46, "deletions": 37}, "files": [{"sha": "52a857a7791179813149486768c60ed5f5da569e", "filename": "src/rt/rust_uv.cpp", "status": "modified", "additions": 46, "deletions": 37, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/da779988d586690094cefc5091b44befeb90085f/src%2Frt%2Frust_uv.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/da779988d586690094cefc5091b44befeb90085f/src%2Frt%2Frust_uv.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_uv.cpp?ref=da779988d586690094cefc5091b44befeb90085f", "patch": "@@ -196,115 +196,124 @@ rust_uv_timer_start(uv_timer_t* the_timer, uint32_t timeout,\n \n extern \"C\" void\n rust_uv_timer_stop(uv_timer_t* the_timer) {\n-  uv_timer_stop(the_timer);\n+\tuv_timer_stop(the_timer); \n }\n \n extern \"C\" int\n rust_uv_tcp_init(uv_loop_t* loop, uv_tcp_t* handle) {\n-  return uv_tcp_init(loop, handle);\n+\treturn uv_tcp_init(loop, handle);\n }\n \n extern \"C\" size_t\n rust_uv_helper_uv_tcp_t_size() {\n-  return sizeof(uv_tcp_t);\n+\treturn sizeof(uv_tcp_t);\n }\n extern \"C\" size_t\n rust_uv_helper_uv_connect_t_size() {\n-  return sizeof(uv_connect_t);\n+\treturn sizeof(uv_connect_t);\n }\n extern \"C\" size_t\n rust_uv_helper_uv_buf_t_size() {\n-  return sizeof(uv_buf_t);\n+\treturn sizeof(uv_buf_t);\n }\n extern \"C\" size_t\n rust_uv_helper_uv_write_t_size() {\n-  return sizeof(uv_write_t);\n+\treturn sizeof(uv_write_t);\n }\n extern \"C\" size_t\n rust_uv_helper_uv_err_t_size() {\n-  return sizeof(uv_err_t);\n+\treturn sizeof(uv_err_t);\n }\n extern \"C\" size_t\n rust_uv_helper_sockaddr_in_size() {\n-  return sizeof(sockaddr_in);\n+\treturn sizeof(sockaddr_in);\n }\n \n extern \"C\" uv_stream_t*\n rust_uv_get_stream_handle_for_connect(uv_connect_t* connect) {\n-  return connect->handle;\n+\treturn connect->handle;\n }\n \n-static uv_buf_t\n+extern \"C\" uv_buf_t\n current_kernel_malloc_alloc_cb(uv_handle_t* handle,\n \t\t\t\t\t\t\t   size_t suggested_size) {\n-  char* base_ptr = (char*)current_kernel_malloc(sizeof(char)\n-\t\t\t\t\t\t\t\t\t\t\t* suggested_size,\n-\t\t\t\t\t\t\t\t\t\t \"uv_buf_t_base_val\");\n-  return uv_buf_init(base_ptr, suggested_size);\n+\tchar* base_ptr = (char*)current_kernel_malloc(sizeof(char)\n+\t\t\t\t\t\t\t\t\t\t\t  * suggested_size,\n+\t\t\t\t\t\t\t\t\t\t   \"uv_buf_t_base_val\");\n+\treturn uv_buf_init(base_ptr, suggested_size);\n }\n \n // FIXME see issue #1402\n extern \"C\" void*\n rust_uv_buf_init(char* base, size_t len) {\n-  uv_buf_t* buf_ptr = current_kernel_malloc(sizeof(uv_buf_t),\n-\t\t\t\t\t\t\t\t\t\t\t\"uv_buf_t_1402\");\n-  *buf_ptr = uv_buf_init(base, len);\n-  return buf_ptr;\n+\tuv_buf_t* buf_ptr = (uv_buf_t*)current_kernel_malloc(\n+\t\t\t\t\t\t\t\t\t sizeof(uv_buf_t),\n+\t\t\t\t\t\t\t\t\t \"uv_buf_t_1402\");\n+\t*buf_ptr = uv_buf_init(base, len);\n+\treturn buf_ptr;\n }\n \n extern \"C\" uv_loop_t*\n rust_uv_get_loop_for_uv_handle(uv_handle_t* handle) {\n-  return handle->loop;\n+\treturn handle->loop;\n }\n \n extern \"C\" void*\n rust_uv_get_data_for_uv_handle(uv_handle_t* handle) {\n-  return handle->data;\n+\treturn handle->data;\n }\n \n extern \"C\" void\n rust_uv_set_data_for_uv_handle(uv_handle_t* handle,\n \t\t\t\t\t\t\t   void* data) {\n-  handle->data = data;\n+\thandle->data = data;\n }\n \n extern \"C\" void*\n rust_uv_get_data_for_req(uv_req_t* req) {\n-  return req->data;\n+\treturn req->data;\n }\n \n extern \"C\" void\n rust_uv_set_data_for_req(uv_req_t* req, void* data) {\n-  req->data = data;\n+\treq->data = data;\n }\n \n extern \"C\" uv_err_t\n rust_uv_last_error(uv_loop_t* loop) {\n-  return uv_last_error(loop);\n+\treturn uv_last_error(loop);\n }\n \n extern \"C\" int\n rust_uv_tcp_connect(uv_connect_t* connect_ptr,\n \t\t\t\t\tuv_tcp_t* tcp_ptr,\n \t\t\t\t\tvoid* addr_ptr,\n \t\t\t\t\tuv_connect_cb cb) {\n-  //return uv_tcp_connect(connect_ptr, tcp_ptr, addr, cb);\n-  printf(\"inside rust_uv_tcp_connect\\n\");\n-  sockaddr_in addr_tmp = *((sockaddr_in*)addr_ptr);\n-  sockaddr_in addr = addr_tmp;\n-  printf(\"before tcp_connect .. port: %d\\n\", addr.sin_port);\n-  int result = uv_tcp_connect(connect_ptr, tcp_ptr, addr, cb);\n-  printf (\"leaving rust_uv_tcp_connect.. and result: %d\\n\", result);\n-  return result;\n+\t//return uv_tcp_connect(connect_ptr, tcp_ptr, addr, cb);\n+\tprintf(\"inside rust_uv_tcp_connect\\n\");\n+\tsockaddr_in addr_tmp = *((sockaddr_in*)addr_ptr);\n+\tsockaddr_in addr = addr_tmp;\n+\tprintf(\"before tcp_connect .. port: %d\\n\", addr.sin_port);\n+\tint result = uv_tcp_connect(connect_ptr, tcp_ptr, addr, cb);\n+\tprintf (\"leaving rust_uv_tcp_connect.. and result: %d\\n\",\n+\t\t\tresult);\n+\treturn result;\n+}\n+\n+extern \"C\" int\n+rust_uv_write(uv_write_t* req, uv_stream_t* handle,\n+\t\t\t  uv_buf_t* bufs, int buf_cnt,\n+\t\t\t  uv_write_cb cb) {\n+\treturn uv_write(req, handle, bufs, buf_cnt, cb);\n }\n \n extern \"C\" void*\n rust_uv_ip4_addr(const char* ip, int port) {\n-  sockaddr_in* addr_ptr = (sockaddr_in*)current_kernel_malloc(\n+\tsockaddr_in* addr_ptr = (sockaddr_in*)current_kernel_malloc(\n \t\t\t\t\t\t\t  sizeof(sockaddr_in),\n \t\t\t\t\t\t\t  \"sockaddr_in\");\n-  printf(\"before creating addr_ptr.. ip %s port %d\\n\", ip, port);\n-  *addr_ptr = uv_ip4_addr(\"173.194.33.40\", 80);\n-  printf(\"after creating .. port: %d\\n\", addr_ptr->sin_port);\n-  return (void*)addr_ptr;\n+\tprintf(\"before creating addr_ptr.. ip %s port %d\\n\", ip, port);\n+\t*addr_ptr = uv_ip4_addr(\"173.194.33.40\", 80);\n+\tprintf(\"after creating .. port: %d\\n\", addr_ptr->sin_port);\n+\treturn (void*)addr_ptr;\n }"}]}