{"sha": "edb3cf57dcca77f31a019a8453d591c867b14eee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkYjNjZjU3ZGNjYTc3ZjMxYTAxOWE4NDUzZDU5MWM4NjdiMTRlZWU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-01T06:29:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-01T06:29:12Z"}, "message": "Rollup merge of #60366 - lzutao:patch-1, r=pietroalbini\n\nbuild-gcc: Create missing cc symlink\n\nThis PR mostly fixes build error caused by using rustc docker images\nto build [rustup][1] (with the error: ``linker `cc` not found``).\n\nI don't know why gcc build script doesn't install cc hard link by default.\nIn build log, with `make SHELL='sh -x' install`, gcc build script installs c++\nhard link but not `cc` one:\n\n```bash\nif test \"\" != \"yes\" ; then \\\n  rm -f /rustroot/bin/g++; \\\n  /usr/bin/install -c xg++ /rustroot/bin/g++; \\\n  chmod a+x /rustroot/bin/g++; \\\n  rm -f /rustroot/bin/c++; \\\n  ( cd /rustroot/bin && \\\n    ln g++ c++ ); \\\n  if [ -f cc1plus ] ; then \\\n    if [ ! -f g++-cross ] ; then \\\n      rm -f /rustroot/bin/x86_64-unknown-linux-gnu-g++; \\\n      ( cd /rustroot/bin && \\\n        ln g++ x86_64-unknown-linux-gnu-g++ ); \\\n      rm -f /rustroot/bin/x86_64-unknown-linux-gnu-c++; \\\n      ( cd /rustroot/bin && \\\n        ln c++ x86_64-unknown-linux-gnu-c++ ); \\\n    fi ; \\\n  fi; \\\nfi\n```\n\nThis might be fixed downstream by manually creating cc hard link\nor setting `RUSTFLAGS=\"-C linker=gcc\"` as [suggested by @mati865][2].\nBut I find it better to fix it upstream in this PR.\n\n[1]: https://github.com/rust-lang/rustup.rs/pull/1815\n[2]: https://github.com/rust-lang/rustup.rs/pull/1815#discussion_r279192797", "tree": {"sha": "f205d8a73121af4646cde833e52e83023c8b3919", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f205d8a73121af4646cde833e52e83023c8b3919"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edb3cf57dcca77f31a019a8453d591c867b14eee", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcyTy5CRBK7hj4Ov3rIwAAdHIIAHl83no3QdzvEa114FugOn7/\nfWMh8Vi1joLNFfDv3Exddcob9OjH37BFDw0xmLPvFzFZuBpkdd0q3jLcK9SXxqqB\nNYU2dpsBhP+8dUyF5pWGA2h+1StULnVFJ6w380W26LVgKhjZkfbAvnwzIjQuQXE9\nwUC1cNHwzIQyu69Qi+Q+irNOoF1zg20J4ihvgbeWcbWDOpbiaIhGdUQoZGuvzbl6\nEmX0C7Yb8SxcBZZXtb3jVmsDg0nCBcB6VJFCGBupMw7Qnjn24Jb8sJmHqEZhx+YC\nD3lGkGWMCVoi5k20hlDw3gjwTn8VTLk+fnjKLGHwC0N6zbcjTc4yEio6F1K22Xg=\n=FW8I\n-----END PGP SIGNATURE-----\n", "payload": "tree f205d8a73121af4646cde833e52e83023c8b3919\nparent 6d78142bf05ae8848101190cf5410ea02ef47226\nparent 484b304eb4b363eb31c2c35480a527b78929423f\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1556692152 +0200\ncommitter GitHub <noreply@github.com> 1556692152 +0200\n\nRollup merge of #60366 - lzutao:patch-1, r=pietroalbini\n\nbuild-gcc: Create missing cc symlink\n\nThis PR mostly fixes build error caused by using rustc docker images\nto build [rustup][1] (with the error: ``linker `cc` not found``).\n\nI don't know why gcc build script doesn't install cc hard link by default.\nIn build log, with `make SHELL='sh -x' install`, gcc build script installs c++\nhard link but not `cc` one:\n\n```bash\nif test \"\" != \"yes\" ; then \\\n  rm -f /rustroot/bin/g++; \\\n  /usr/bin/install -c xg++ /rustroot/bin/g++; \\\n  chmod a+x /rustroot/bin/g++; \\\n  rm -f /rustroot/bin/c++; \\\n  ( cd /rustroot/bin && \\\n    ln g++ c++ ); \\\n  if [ -f cc1plus ] ; then \\\n    if [ ! -f g++-cross ] ; then \\\n      rm -f /rustroot/bin/x86_64-unknown-linux-gnu-g++; \\\n      ( cd /rustroot/bin && \\\n        ln g++ x86_64-unknown-linux-gnu-g++ ); \\\n      rm -f /rustroot/bin/x86_64-unknown-linux-gnu-c++; \\\n      ( cd /rustroot/bin && \\\n        ln c++ x86_64-unknown-linux-gnu-c++ ); \\\n    fi ; \\\n  fi; \\\nfi\n```\n\nThis might be fixed downstream by manually creating cc hard link\nor setting `RUSTFLAGS=\"-C linker=gcc\"` as [suggested by @mati865][2].\nBut I find it better to fix it upstream in this PR.\n\n[1]: https://github.com/rust-lang/rustup.rs/pull/1815\n[2]: https://github.com/rust-lang/rustup.rs/pull/1815#discussion_r279192797\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edb3cf57dcca77f31a019a8453d591c867b14eee", "html_url": "https://github.com/rust-lang/rust/commit/edb3cf57dcca77f31a019a8453d591c867b14eee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edb3cf57dcca77f31a019a8453d591c867b14eee/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d78142bf05ae8848101190cf5410ea02ef47226", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d78142bf05ae8848101190cf5410ea02ef47226", "html_url": "https://github.com/rust-lang/rust/commit/6d78142bf05ae8848101190cf5410ea02ef47226"}, {"sha": "484b304eb4b363eb31c2c35480a527b78929423f", "url": "https://api.github.com/repos/rust-lang/rust/commits/484b304eb4b363eb31c2c35480a527b78929423f", "html_url": "https://github.com/rust-lang/rust/commit/484b304eb4b363eb31c2c35480a527b78929423f"}], "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "ddc2066537cefa7f69d0b6599695a7da8defa5df", "filename": "src/ci/docker/dist-x86_64-linux/build-gcc.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/edb3cf57dcca77f31a019a8453d591c867b14eee/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "raw_url": "https://github.com/rust-lang/rust/raw/edb3cf57dcca77f31a019a8453d591c867b14eee/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh?ref=edb3cf57dcca77f31a019a8453d591c867b14eee", "patch": "@@ -32,6 +32,7 @@ hide_output ../gcc-$GCC/configure \\\n     --enable-languages=c,c++\n hide_output make -j10\n hide_output make install\n+ln -s gcc /rustroot/bin/cc\n \n cd ..\n rm -rf gcc-build"}]}