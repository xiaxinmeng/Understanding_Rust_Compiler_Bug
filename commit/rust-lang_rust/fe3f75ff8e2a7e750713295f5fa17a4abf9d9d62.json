{"sha": "fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlM2Y3NWZmOGUyYTdlNzUwNzEzMjk1ZjVmYTE3YTRhYmY5ZDlkNjI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-21T22:28:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-21T22:28:38Z"}, "message": "auto merge of #7932 : blake2-ppc/rust/str-clear, r=huonw\n\n~str and @str need separate implementations for use in generic\r\nfunctions, where it will not automatically use the impl on &str.\r\n\r\nfixes issue #7900", "tree": {"sha": "57fd8decc50d57cf0a7f0663df3962dadb5c00c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57fd8decc50d57cf0a7f0663df3962dadb5c00c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62", "html_url": "https://github.com/rust-lang/rust/commit/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e336cbf8f9e26758a2ef98ec6b7715e083fdcced", "url": "https://api.github.com/repos/rust-lang/rust/commits/e336cbf8f9e26758a2ef98ec6b7715e083fdcced", "html_url": "https://github.com/rust-lang/rust/commit/e336cbf8f9e26758a2ef98ec6b7715e083fdcced"}, {"sha": "3509f9d5ae927781f190dda5e623d30ce34e87e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/3509f9d5ae927781f190dda5e623d30ce34e87e0", "html_url": "https://github.com/rust-lang/rust/commit/3509f9d5ae927781f190dda5e623d30ce34e87e0"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "97fc56d007db782c7c6a1feef1d3bf7140dc38ab", "filename": "src/libstd/str.rs", "status": "modified", "additions": 51, "deletions": 1, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62/src%2Flibstd%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62/src%2Flibstd%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstr.rs?ref=fe3f75ff8e2a7e750713295f5fa17a4abf9d9d62", "patch": "@@ -22,7 +22,7 @@ use cast;\n use char;\n use char::Char;\n use clone::Clone;\n-use container::Container;\n+use container::{Container, Mutable};\n use iter::Times;\n use iterator::{Iterator, IteratorUtil, FilterIterator, AdditiveIterator, MapIterator};\n use libc;\n@@ -1214,6 +1214,31 @@ impl<'self> Container for &'self str {\n     }\n }\n \n+impl Container for ~str {\n+    #[inline]\n+    fn len(&self) -> uint { self.as_slice().len() }\n+    #[inline]\n+    fn is_empty(&self) -> bool { self.len() == 0 }\n+}\n+\n+impl Container for @str {\n+    #[inline]\n+    fn len(&self) -> uint { self.as_slice().len() }\n+    #[inline]\n+    fn is_empty(&self) -> bool { self.len() == 0 }\n+}\n+\n+impl Mutable for ~str {\n+    /// Remove all content, make the string empty\n+    #[inline]\n+    fn clear(&mut self) {\n+        unsafe {\n+            raw::set_len(self, 0)\n+        }\n+    }\n+}\n+\n+\n #[allow(missing_doc)]\n pub trait StrSlice<'self> {\n     fn contains<'a>(&self, needle: &'a str) -> bool;\n@@ -2502,6 +2527,18 @@ mod tests {\n         assert_eq!(~\"\u534e\u0e1b\u0e23\u0e30\u0e40\u0e17\u0e28\u0e44\u0e17\u0e22\u4e2d\", data);\n     }\n \n+    #[test]\n+    fn test_clear() {\n+        let mut empty = ~\"\";\n+        empty.clear();\n+        assert_eq!(\"\", empty.as_slice());\n+        let mut data = ~\"\u0e1b\u0e23\u0e30\u0e40\u0e17\u0e28\u0e44\u0e17\u0e22\u4e2d\";\n+        data.clear();\n+        assert_eq!(\"\", data.as_slice());\n+        data.push_char('\u534e');\n+        assert_eq!(\"\u534e\", data.as_slice());\n+    }\n+\n     #[test]\n     fn test_split_within() {\n         fn t(s: &str, i: uint, u: &[~str]) {\n@@ -3494,4 +3531,17 @@ mod tests {\n         t::<@str>();\n         t::<~str>();\n     }\n+\n+    #[test]\n+    fn test_str_container() {\n+        fn sum_len<S: Container>(v: &[S]) -> uint {\n+            v.iter().transform(|x| x.len()).sum()\n+        }\n+\n+        let s = ~\"01234\";\n+        assert_eq!(5, sum_len([\"012\", \"\", \"34\"]));\n+        assert_eq!(5, sum_len([@\"01\", @\"2\", @\"34\", @\"\"]));\n+        assert_eq!(5, sum_len([~\"01\", ~\"2\", ~\"34\", ~\"\"]));\n+        assert_eq!(5, sum_len([s.as_slice()]));\n+    }\n }"}]}