{"sha": "6826a9606738e99c1b5e818061ea622492636baa", "node_id": "C_kwDOAAsO6NoAKDY4MjZhOTYwNjczOGU5OWMxYjVlODE4MDYxZWE2MjI0OTI2MzZiYWE", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-02-24T06:32:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-24T06:32:41Z"}, "message": "Rollup merge of #106923 - mejrs:fluent_err, r=davidtwco\n\nRestore behavior when primary bundle is missing\n\nFixes https://github.com/rust-lang/rust/issues/106755 by restoring some of the behavior prior to https://github.com/rust-lang/rust/pull/106427\n\nStill, I have no idea how this debug assertion can even hit while using `en-US` as primary  bundle.\n\nr? ```@davidtwco```", "tree": {"sha": "aae6fe419e6af00617285aac79985cc30a6d0ab2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aae6fe419e6af00617285aac79985cc30a6d0ab2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6826a9606738e99c1b5e818061ea622492636baa", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj+FoJCRBK7hj4Ov3rIwAA24AIADH0TIcC//r1ukdRRxhHgmQv\nzuanVcnUYyiNsoEdCxBKwf642i7yUmoGGLLhHbrLPvbeoHWCdzoTZToyOJ4QSmpu\nqSioJiRzJybBND6QVL++PDjodGep0Ew4WFPo804XJZbF3mCCen3vI5E3sUei1FBM\n5GfpxPVl33cMS5TEfaTOti3nxLIPpBdO90KUKN5MMFmJWpN+nXlSVifCSiodLUjq\nWCBz35hPXvmuYUUipbyjF9o3HqIQpAtN3FRZW+aVWQ+TeVnjqAfsigsYOxaREP8y\nStr1CqmAIP4qWA4n4+lctfCWafcHRAUd5M9sC3F9YkZJZSnV5/husiShCaaCMzI=\n=sTbO\n-----END PGP SIGNATURE-----\n", "payload": "tree aae6fe419e6af00617285aac79985cc30a6d0ab2\nparent b3657f92d1e18770afb3bb873b30abd6e6ee9050\nparent 4c13a2157a8f7c1e261efbc93b5b69d60d85719b\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1677220361 +0530\ncommitter GitHub <noreply@github.com> 1677220361 +0530\n\nRollup merge of #106923 - mejrs:fluent_err, r=davidtwco\n\nRestore behavior when primary bundle is missing\n\nFixes https://github.com/rust-lang/rust/issues/106755 by restoring some of the behavior prior to https://github.com/rust-lang/rust/pull/106427\n\nStill, I have no idea how this debug assertion can even hit while using `en-US` as primary  bundle.\n\nr? ```@davidtwco```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6826a9606738e99c1b5e818061ea622492636baa", "html_url": "https://github.com/rust-lang/rust/commit/6826a9606738e99c1b5e818061ea622492636baa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6826a9606738e99c1b5e818061ea622492636baa/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3657f92d1e18770afb3bb873b30abd6e6ee9050", "url": "https://api.github.com/repos/rust-lang/rust/commits/b3657f92d1e18770afb3bb873b30abd6e6ee9050", "html_url": "https://github.com/rust-lang/rust/commit/b3657f92d1e18770afb3bb873b30abd6e6ee9050"}, {"sha": "4c13a2157a8f7c1e261efbc93b5b69d60d85719b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c13a2157a8f7c1e261efbc93b5b69d60d85719b", "html_url": "https://github.com/rust-lang/rust/commit/4c13a2157a8f7c1e261efbc93b5b69d60d85719b"}], "stats": {"total": 65, "additions": 59, "deletions": 6}, "files": [{"sha": "010e5f060bf0b86df7b34be46ed728363b2babdc", "filename": "compiler/rustc_error_messages/src/lib.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6826a9606738e99c1b5e818061ea622492636baa/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6826a9606738e99c1b5e818061ea622492636baa/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Fsrc%2Flib.rs?ref=6826a9606738e99c1b5e818061ea622492636baa", "patch": "@@ -135,7 +135,10 @@ pub fn fluent_bundle(\n \n     let fallback_locale = langid!(\"en-US\");\n     let requested_fallback_locale = requested_locale.as_ref() == Some(&fallback_locale);\n-\n+    trace!(?requested_fallback_locale);\n+    if requested_fallback_locale && additional_ftl_path.is_none() {\n+        return Ok(None);\n+    }\n     // If there is only `-Z additional-ftl-path`, assume locale is \"en-US\", otherwise use user\n     // provided locale.\n     let locale = requested_locale.clone().unwrap_or(fallback_locale);\n@@ -153,7 +156,7 @@ pub fn fluent_bundle(\n     bundle.set_use_isolating(with_directionality_markers);\n \n     // If the user requests the default locale then don't try to load anything.\n-    if !requested_fallback_locale && let Some(requested_locale) = requested_locale {\n+    if let Some(requested_locale) = requested_locale {\n         let mut found_resources = false;\n         for sysroot in user_provided_sysroot.iter_mut().chain(sysroot_candidates.iter_mut()) {\n             sysroot.push(\"share\");"}, {"sha": "ed35eb1b6c4ad8f567180cc9119ff7aa8c097938", "filename": "compiler/rustc_errors/src/translation.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6826a9606738e99c1b5e818061ea622492636baa/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6826a9606738e99c1b5e818061ea622492636baa/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Ftranslation.rs?ref=6826a9606738e99c1b5e818061ea622492636baa", "patch": "@@ -1,4 +1,4 @@\n-use crate::error::TranslateError;\n+use crate::error::{TranslateError, TranslateErrorKind};\n use crate::snippet::Style;\n use crate::{DiagnosticArg, DiagnosticMessage, FluentBundle};\n use rustc_data_structures::sync::Lrc;\n@@ -95,6 +95,16 @@ pub trait Translate {\n                 // The primary bundle was present and translation succeeded\n                 Some(Ok(t)) => t,\n \n+                // If `translate_with_bundle` returns `Err` with the primary bundle, this is likely\n+                // just that the primary bundle doesn't contain the message being translated, so\n+                // proceed to the fallback bundle.\n+                Some(Err(\n+                    primary @ TranslateError::One {\n+                        kind: TranslateErrorKind::MessageMissing, ..\n+                    },\n+                )) => translate_with_bundle(self.fallback_fluent_bundle())\n+                    .map_err(|fallback| primary.and(fallback))?,\n+\n                 // Always yeet out for errors on debug (unless\n                 // `RUSTC_TRANSLATION_NO_DEBUG_ASSERT` is set in the environment - this allows\n                 // local runs of the test suites, of builds with debug assertions, to test the\n@@ -106,9 +116,8 @@ pub trait Translate {\n                     do yeet primary\n                 }\n \n-                // If `translate_with_bundle` returns `Err` with the primary bundle, this is likely\n-                // just that the primary bundle doesn't contain the message being translated or\n-                // something else went wrong) so proceed to the fallback bundle.\n+                // ..otherwise, for end users, an error about this wouldn't be useful or actionable, so\n+                // just hide it and try with the fallback bundle.\n                 Some(Err(primary)) => translate_with_bundle(self.fallback_fluent_bundle())\n                     .map_err(|fallback| primary.and(fallback))?,\n "}, {"sha": "46ece725fb7c10197b8069715b1e274f4c2b1804", "filename": "tests/ui/issues/issue-106755.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/6826a9606738e99c1b5e818061ea622492636baa/tests%2Fui%2Fissues%2Fissue-106755.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6826a9606738e99c1b5e818061ea622492636baa/tests%2Fui%2Fissues%2Fissue-106755.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fissues%2Fissue-106755.rs?ref=6826a9606738e99c1b5e818061ea622492636baa", "patch": "@@ -0,0 +1,19 @@\n+// compile-flags:-Ztranslate-lang=en_US\n+\n+#![feature(negative_impls)]\n+#![feature(marker_trait_attr)]\n+\n+#[marker]\n+trait MyTrait {}\n+\n+struct TestType<T>(::std::marker::PhantomData<T>);\n+\n+unsafe impl<T: MyTrait + 'static> Send for TestType<T> {}\n+\n+impl<T: MyTrait> !Send for TestType<T> {} //~ ERROR found both positive and negative implementation\n+\n+unsafe impl<T: 'static> Send for TestType<T> {} //~ ERROR conflicting implementations\n+\n+impl !Send for TestType<i32> {}\n+\n+fn main() {}"}, {"sha": "543970340620da20ab88611ebc184ad1e53ea401", "filename": "tests/ui/issues/issue-106755.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/6826a9606738e99c1b5e818061ea622492636baa/tests%2Fui%2Fissues%2Fissue-106755.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6826a9606738e99c1b5e818061ea622492636baa/tests%2Fui%2Fissues%2Fissue-106755.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fissues%2Fissue-106755.stderr?ref=6826a9606738e99c1b5e818061ea622492636baa", "patch": "@@ -0,0 +1,22 @@\n+error[E0751]: found both positive and negative implementation of trait `Send` for type `TestType<_>`:\n+  --> $DIR/issue-106755.rs:13:1\n+   |\n+LL | unsafe impl<T: MyTrait + 'static> Send for TestType<T> {}\n+   | ------------------------------------------------------ positive implementation here\n+LL |\n+LL | impl<T: MyTrait> !Send for TestType<T> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ negative implementation here\n+\n+error[E0119]: conflicting implementations of trait `Send` for type `TestType<_>`\n+  --> $DIR/issue-106755.rs:15:1\n+   |\n+LL | unsafe impl<T: MyTrait + 'static> Send for TestType<T> {}\n+   | ------------------------------------------------------ first implementation here\n+...\n+LL | unsafe impl<T: 'static> Send for TestType<T> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `TestType<_>`\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0119, E0751.\n+For more information about an error, try `rustc --explain E0119`."}]}