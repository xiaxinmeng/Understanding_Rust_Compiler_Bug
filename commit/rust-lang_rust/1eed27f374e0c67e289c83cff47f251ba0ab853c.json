{"sha": "1eed27f374e0c67e289c83cff47f251ba0ab853c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlZWQyN2YzNzRlMGM2N2UyODljODNjZmY0N2YyNTFiYTBhYjg1M2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-11T16:49:32Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-11T16:49:32Z"}, "message": "Auto merge of #6575 - flip1995:stop_linting_deps, r=Manishearth\n\nChange env var used for testing Clippy\n\nThis changes the variable used for testing Clippy in the internal test\nsuite:\n\n```\nCLIPPY_TESTS -> __CLIPPY_INTERNAL_TESTS\n```\n\n`CLIPPY_TESTS` is understandably used in environments of Clippy users,\nso we shouldn't use it in our test suite.\n\nchangelog: Fix oversight which caused Clippy to lint deps in some environments.\n\nOnce again fixes https://github.com/rust-lang/rust-clippy/issues/3874", "tree": {"sha": "7253e0d6de15040430dcf698ff4565f0f3ee3477", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7253e0d6de15040430dcf698ff4565f0f3ee3477"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1eed27f374e0c67e289c83cff47f251ba0ab853c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1eed27f374e0c67e289c83cff47f251ba0ab853c", "html_url": "https://github.com/rust-lang/rust/commit/1eed27f374e0c67e289c83cff47f251ba0ab853c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1eed27f374e0c67e289c83cff47f251ba0ab853c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "583715f583bd28ec759a5d0737b4ec400f0814cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/583715f583bd28ec759a5d0737b4ec400f0814cd", "html_url": "https://github.com/rust-lang/rust/commit/583715f583bd28ec759a5d0737b4ec400f0814cd"}, {"sha": "547ce0db274c68869a300b5162c126f95f768dac", "url": "https://api.github.com/repos/rust-lang/rust/commits/547ce0db274c68869a300b5162c126f95f768dac", "html_url": "https://github.com/rust-lang/rust/commit/547ce0db274c68869a300b5162c126f95f768dac"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "1a7a30c61be5b8fb9fc8987fc4fdc32667765165", "filename": "doc/adding_lints.md", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1eed27f374e0c67e289c83cff47f251ba0ab853c/doc%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/1eed27f374e0c67e289c83cff47f251ba0ab853c/doc%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Fadding_lints.md?ref=1eed27f374e0c67e289c83cff47f251ba0ab853c", "patch": "@@ -147,10 +147,14 @@ add `// edition:2018` at the top of the test file (note that it's space-sensitiv\n \n Manually testing against an example file can be useful if you have added some\n `println!`s and the test suite output becomes unreadable. To try Clippy with\n-your local modifications, run `env CLIPPY_TESTS=true cargo run --bin\n-clippy-driver -- -L ./target/debug input.rs` from the working copy root.\n+your local modifications, run\n \n-With tests in place, let's have a look at implementing our lint now.\n+```\n+env __CLIPPY_INTERNAL_TESTS=true cargo run --bin clippy-driver -- -L ./target/debug input.rs\n+```\n+\n+from the working copy root. With tests in place, let's have a look at\n+implementing our lint now.\n \n ## Lint declaration\n "}, {"sha": "f5f6c09ed8e940e71b70469405950c3b9fe1f61d", "filename": "src/driver.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1eed27f374e0c67e289c83cff47f251ba0ab853c/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1eed27f374e0c67e289c83cff47f251ba0ab853c/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=1eed27f374e0c67e289c83cff47f251ba0ab853c", "patch": "@@ -298,7 +298,7 @@ pub fn main() {\n         // - IF Clippy is run on the main crate, not on deps (`!cap_lints_allow`) THEN\n         //    - IF `--no-deps` is not set (`!no_deps`) OR\n         //    - IF `--no-deps` is set and Clippy is run on the specified primary package\n-        let clippy_tests_set = env::var(\"CLIPPY_TESTS\").map_or(false, |val| val == \"true\");\n+        let clippy_tests_set = env::var(\"__CLIPPY_INTERNAL_TESTS\").map_or(false, |val| val == \"true\");\n         let cap_lints_allow = arg_value(&orig_args, \"--cap-lints\", |val| val == \"allow\").is_some();\n         let in_primary_package = env::var(\"CARGO_PRIMARY_PACKAGE\").is_ok();\n "}, {"sha": "ea800336ef55046f489b47ccc80c58e38334f492", "filename": "tests/compile-test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1eed27f374e0c67e289c83cff47f251ba0ab853c/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1eed27f374e0c67e289c83cff47f251ba0ab853c/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=1eed27f374e0c67e289c83cff47f251ba0ab853c", "patch": "@@ -254,7 +254,7 @@ fn run_ui_cargo(config: &mut compiletest::Config) {\n \n fn prepare_env() {\n     set_var(\"CLIPPY_DISABLE_DOCS_LINKS\", \"true\");\n-    set_var(\"CLIPPY_TESTS\", \"true\");\n+    set_var(\"__CLIPPY_INTERNAL_TESTS\", \"true\");\n     //set_var(\"RUST_BACKTRACE\", \"0\");\n }\n "}]}