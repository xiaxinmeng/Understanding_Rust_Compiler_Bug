{"sha": "e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1ZGUwYjEzZmViZmU5YTlhM2YwZGMwNzQ4OWE3ZDE5ZDU1MjVlM2I=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-03-16T00:30:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-16T00:30:24Z"}, "message": "Rollup merge of #69686 - varkor:rustdoc-attributes, r=GuillaumeGomez\n\nUse `pprust` to print attributes in rustdoc\n\nFixes https://github.com/rust-lang/rust/issues/69559.\n\nI'm not sure what the original motivation was for the `render_attribute`, so I may be missing something, but replacing it with `pprust::attribute_to_string` seems to give the intended output (modulo some spacing idiosyncrasies).\n\nr? @GuillaumeGomez", "tree": {"sha": "22a31c8d13c99431db2a81b9d059608a8cbfdf67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/22a31c8d13c99431db2a81b9d059608a8cbfdf67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJebsigCRBK7hj4Ov3rIwAAdHIIABHTMToHBkH4LvC+Z+lUg23D\noOJYzUVS40freNpP/TYWobTBCsb3ombMKZR8qUKOr3ox82uAwl3+Atqm5t0U39Mf\n17evt5MUZCZvmUBw4J3pp0dpw99JAILOlHOhBcdz0eXs1QegvF51inT5QGuTBVlI\nt9I+LWq6I8nDYqyIM9gpU3NhvzQSEoVum3zVKNt99yAfi/RWBWjP//143BUn8J5F\n3IUlk/AbDKegQBwlC5q8bRmCPUPMIGIg77b6m7s6MGbtp0lUXFQoncChfievCgm9\ndLsRp+RYaePcGZ8dOrGZapy1xc9Mg6BRhMD27VJjucIAKWNOS0HTAp31sfv9WBE=\n=pNUa\n-----END PGP SIGNATURE-----\n", "payload": "tree 22a31c8d13c99431db2a81b9d059608a8cbfdf67\nparent 45ebd5808afd3df7ba842797c0fcd4447ddf30fb\nparent c599ec4460f17c43f5df1d4df269f3811ece4bd7\nauthor Dylan DPC <dylan.dpc@gmail.com> 1584318624 +0100\ncommitter GitHub <noreply@github.com> 1584318624 +0100\n\nRollup merge of #69686 - varkor:rustdoc-attributes, r=GuillaumeGomez\n\nUse `pprust` to print attributes in rustdoc\n\nFixes https://github.com/rust-lang/rust/issues/69559.\n\nI'm not sure what the original motivation was for the `render_attribute`, so I may be missing something, but replacing it with `pprust::attribute_to_string` seems to give the intended output (modulo some spacing idiosyncrasies).\n\nr? @GuillaumeGomez\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "html_url": "https://github.com/rust-lang/rust/commit/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45ebd5808afd3df7ba842797c0fcd4447ddf30fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/45ebd5808afd3df7ba842797c0fcd4447ddf30fb", "html_url": "https://github.com/rust-lang/rust/commit/45ebd5808afd3df7ba842797c0fcd4447ddf30fb"}, {"sha": "c599ec4460f17c43f5df1d4df269f3811ece4bd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/c599ec4460f17c43f5df1d4df269f3811ece4bd7", "html_url": "https://github.com/rust-lang/rust/commit/c599ec4460f17c43f5df1d4df269f3811ece4bd7"}], "stats": {"total": 30, "additions": 7, "deletions": 23}, "files": [{"sha": "b3d70475bf3c382f12e0fc7c5c0a98912df8472b", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 3, "deletions": 23, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "patch": "@@ -44,7 +44,6 @@ use std::sync::Arc;\n \n use rustc::middle::privacy::AccessLevels;\n use rustc::middle::stability;\n-use rustc_ast::ast;\n use rustc_ast_pretty::pprust;\n use rustc_data_structures::flock;\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n@@ -3126,25 +3125,6 @@ fn item_enum(w: &mut Buffer, cx: &Context, it: &clean::Item, e: &clean::Enum) {\n     render_assoc_items(w, cx, it, it.def_id, AssocItemRender::All)\n }\n \n-fn render_attribute(attr: &ast::MetaItem) -> Option<String> {\n-    let path = pprust::path_to_string(&attr.path);\n-\n-    if attr.is_word() {\n-        Some(path)\n-    } else if let Some(v) = attr.value_str() {\n-        Some(format!(\"{} = {:?}\", path, v))\n-    } else if let Some(values) = attr.meta_item_list() {\n-        let display: Vec<_> = values\n-            .iter()\n-            .filter_map(|attr| attr.meta_item().and_then(|mi| render_attribute(mi)))\n-            .collect();\n-\n-        if !display.is_empty() { Some(format!(\"{}({})\", path, display.join(\", \"))) } else { None }\n-    } else {\n-        None\n-    }\n-}\n-\n const ATTRIBUTE_WHITELIST: &[Symbol] = &[\n     sym::export_name,\n     sym::lang,\n@@ -3170,9 +3150,9 @@ fn render_attributes(w: &mut Buffer, it: &clean::Item, top: bool) {\n         if !ATTRIBUTE_WHITELIST.contains(&attr.name_or_empty()) {\n             continue;\n         }\n-        if let Some(s) = render_attribute(&attr.meta().unwrap()) {\n-            attrs.push_str(&format!(\"#[{}]\\n\", s));\n-        }\n+\n+        // FIXME: this currently renders too many spaces as in: `#[repr(C, align (8))]`.\n+        attrs.push_str(&pprust::attribute_to_string(&attr));\n     }\n     if !attrs.is_empty() {\n         write!("}, {"sha": "d5772e183bcb2f387a2dae04b935ef51d6819896", "filename": "src/test/rustdoc/attributes.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b/src%2Ftest%2Frustdoc%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b/src%2Ftest%2Frustdoc%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fattributes.rs?ref=e5de0b13febfe9a9a3f0dc07489a7d19d5525e3b", "patch": "@@ -15,3 +15,7 @@ pub extern \"C\" fn g() {}\n pub enum Foo {\n     Bar,\n }\n+\n+// @has foo/struct.Repr.html '//*[@class=\"docblock attributes top-attr\"]' '#[repr(C, align (8))]'\n+#[repr(C, align(8))]\n+pub struct Repr;"}]}