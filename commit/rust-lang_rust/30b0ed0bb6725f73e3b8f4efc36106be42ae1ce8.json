{"sha": "30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwYjBlZDBiYjY3MjVmNzNlM2I4ZjRlZmMzNjEwNmJlNDJhZTFjZTg=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-23T15:04:29Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-23T15:04:29Z"}, "message": "rustbuild: Retry downloads by default\n\nDon't rely on curl's --retry, it appears to not work for some errors like SSL\nerrors.", "tree": {"sha": "fddc872437e537758e55094a48401e4e33dba955", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fddc872437e537758e55094a48401e4e33dba955"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "html_url": "https://github.com/rust-lang/rust/commit/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fc6f092c21a7a7249a9f8860f3cd10160aa36c02", "url": "https://api.github.com/repos/rust-lang/rust/commits/fc6f092c21a7a7249a9f8860f3cd10160aa36c02", "html_url": "https://github.com/rust-lang/rust/commit/fc6f092c21a7a7249a9f8860f3cd10160aa36c02"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "6b1b8ddf56f2a55f4cfcd22114d60398fd9a36de", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=30b0ed0bb6725f73e3b8f4efc36106be42ae1ce8", "patch": "@@ -59,20 +59,33 @@ def delete_if_present(path, verbose):\n \n \n def download(path, url, probably_big, verbose):\n+    for x in range(0, 4):\n+        try:\n+            _download(path, url, probably_big, verbose, True)\n+            return\n+        except RuntimeError:\n+            print(\"\\nspurious failure, trying again\")\n+    _download(path, url, probably_big, verbose, False)\n+\n+\n+def _download(path, url, probably_big, verbose, exception):\n     if probably_big or verbose:\n         print(\"downloading {}\".format(url))\n     # see http://serverfault.com/questions/301128/how-to-download\n     if sys.platform == 'win32':\n         run([\"PowerShell.exe\", \"/nologo\", \"-Command\",\n              \"(New-Object System.Net.WebClient)\"\n              \".DownloadFile('{}', '{}')\".format(url, path)],\n-            verbose=verbose)\n+            verbose=verbose,\n+            exception=exception)\n     else:\n         if probably_big or verbose:\n             option = \"-#\"\n         else:\n             option = \"-s\"\n-        run([\"curl\", option, \"--retry\", \"3\", \"-Sf\", \"-o\", path, url], verbose=verbose)\n+        run([\"curl\", option, \"--retry\", \"3\", \"-Sf\", \"-o\", path, url],\n+            verbose=verbose,\n+            exception=exception)\n \n \n def verify(path, sha_path, verbose):\n@@ -112,7 +125,7 @@ def unpack(tarball, dst, verbose=False, match=None):\n             shutil.move(tp, fp)\n     shutil.rmtree(os.path.join(dst, fname))\n \n-def run(args, verbose=False):\n+def run(args, verbose=False, exception=False):\n     if verbose:\n         print(\"running: \" + ' '.join(args))\n     sys.stdout.flush()\n@@ -122,7 +135,7 @@ def run(args, verbose=False):\n     code = ret.wait()\n     if code != 0:\n         err = \"failed to run: \" + ' '.join(args)\n-        if verbose:\n+        if verbose or exception:\n             raise RuntimeError(err)\n         sys.exit(err)\n "}]}