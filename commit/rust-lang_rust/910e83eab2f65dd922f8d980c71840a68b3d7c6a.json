{"sha": "910e83eab2f65dd922f8d980c71840a68b3d7c6a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxMGU4M2VhYjJmNjVkZDkyMmY4ZDk4MGM3MTg0MGE2OGIzZDdjNmE=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-12-02T08:34:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-02T08:34:15Z"}, "message": "Rollup merge of #66834 - infinity0:master, r=Mark-Simulacrum\n\nrustbuild fixes\n\nWhen upgrading Debian's rustc to 1.38 I needed these patches:\n\n(1) In order to cross-compile rustc 1.38 and take it through the full rustbuild process including install, I needed the first patch.\n\n(2) In order to build rustc 1.38 using rustc 1.38 itself I need to set --cap-lints warn, otherwise I get this error:\n\n~~~~\nerror: unnecessary `unsafe` block\n   --> src/bootstrap/builder.rs:148:19\n    |\n148 |             name: unsafe { ::std::intrinsics::type_name::<S>() },\n    |                   ^^^^^^ unnecessary `unsafe` block\n    |\nnote: lint level defined here\n   --> src/bootstrap/lib.rs:107:9\n    |\n107 | #![deny(warnings, rust_2018_idioms, unused_lifetimes)]\n    |         ^^^^^^^^\n    = note: `#[deny(unused_unsafe)]` implied by `#[deny(warnings)]`\n\nerror: aborting due to previous error\n\nerror: could not compile `bootstrap`.\n\n~~~~\n\nIn order to set --cap-lints warn however, I need bootstrap.py not to clobber RUSTFLAGS. (This worked previously, not sure if it was broken intentionally but we would like support for it.)", "tree": {"sha": "8631bfc4d4f6746bdc573f206f8f5edf4bbdfc74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8631bfc4d4f6746bdc573f206f8f5edf4bbdfc74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/910e83eab2f65dd922f8d980c71840a68b3d7c6a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd5MyHCRBK7hj4Ov3rIwAAdHIIAKPj7JWXwsPJHjU1BXQ9PVqZ\n5ncBD/bJkjMI3ck+k40NgrmaGmeihuCTy5kqLMxgFXHBl5UTd2EoYcpOIn3ytwwU\naT31W/sWEYVFcSp58rcz08SrRikzXUOpn0NFW6rqnGtoRfB2OsVKYfk+E/WYCleq\nhOybI6bblYpPj5rHa/k9XZU/TfF6zt2sXqqI843jWM9A2EMDxN31rsI3cf0YcQKr\nC55lPFnUeGr20HXOZ1ksRRDdRu42U6lCKjkF/Pj1dY2M/nJOQW9LYzWXMlYpPrHI\nkIldrEz0Yu3/5ABvavY1FwGQEKcA6435jCm8RaczsIWk9ikRFFhikoje3PtHTOo=\n=DFBH\n-----END PGP SIGNATURE-----\n", "payload": "tree 8631bfc4d4f6746bdc573f206f8f5edf4bbdfc74\nparent 313436807b7db2d6f31cf5b33fa556260eabda15\nparent 0533249fd7950a34a8046956c5bb1737e620198f\nauthor Ralf Jung <post@ralfj.de> 1575275655 +0100\ncommitter GitHub <noreply@github.com> 1575275655 +0100\n\nRollup merge of #66834 - infinity0:master, r=Mark-Simulacrum\n\nrustbuild fixes\n\nWhen upgrading Debian's rustc to 1.38 I needed these patches:\n\n(1) In order to cross-compile rustc 1.38 and take it through the full rustbuild process including install, I needed the first patch.\n\n(2) In order to build rustc 1.38 using rustc 1.38 itself I need to set --cap-lints warn, otherwise I get this error:\n\n~~~~\nerror: unnecessary `unsafe` block\n   --> src/bootstrap/builder.rs:148:19\n    |\n148 |             name: unsafe { ::std::intrinsics::type_name::<S>() },\n    |                   ^^^^^^ unnecessary `unsafe` block\n    |\nnote: lint level defined here\n   --> src/bootstrap/lib.rs:107:9\n    |\n107 | #![deny(warnings, rust_2018_idioms, unused_lifetimes)]\n    |         ^^^^^^^^\n    = note: `#[deny(unused_unsafe)]` implied by `#[deny(warnings)]`\n\nerror: aborting due to previous error\n\nerror: could not compile `bootstrap`.\n\n~~~~\n\nIn order to set --cap-lints warn however, I need bootstrap.py not to clobber RUSTFLAGS. (This worked previously, not sure if it was broken intentionally but we would like support for it.)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/910e83eab2f65dd922f8d980c71840a68b3d7c6a", "html_url": "https://github.com/rust-lang/rust/commit/910e83eab2f65dd922f8d980c71840a68b3d7c6a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/910e83eab2f65dd922f8d980c71840a68b3d7c6a/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "313436807b7db2d6f31cf5b33fa556260eabda15", "url": "https://api.github.com/repos/rust-lang/rust/commits/313436807b7db2d6f31cf5b33fa556260eabda15", "html_url": "https://github.com/rust-lang/rust/commit/313436807b7db2d6f31cf5b33fa556260eabda15"}, {"sha": "0533249fd7950a34a8046956c5bb1737e620198f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0533249fd7950a34a8046956c5bb1737e620198f", "html_url": "https://github.com/rust-lang/rust/commit/0533249fd7950a34a8046956c5bb1737e620198f"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "bb169414886de2da6e0c37c50928b47fe0e604ef", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/910e83eab2f65dd922f8d980c71840a68b3d7c6a/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/910e83eab2f65dd922f8d980c71840a68b3d7c6a/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=910e83eab2f65dd922f8d980c71840a68b3d7c6a", "patch": "@@ -643,7 +643,9 @@ def build_bootstrap(self):\n         env[\"LIBRARY_PATH\"] = os.path.join(self.bin_root(), \"lib\") + \\\n             (os.pathsep + env[\"LIBRARY_PATH\"]) \\\n             if \"LIBRARY_PATH\" in env else \"\"\n-        env[\"RUSTFLAGS\"] = \"-Cdebuginfo=2 \"\n+        # preserve existing RUSTFLAGS\n+        env.setdefault(\"RUSTFLAGS\", \"\")\n+        env[\"RUSTFLAGS\"] += \" -Cdebuginfo=2\"\n \n         build_section = \"target.{}\".format(self.build_triple())\n         target_features = []\n@@ -652,13 +654,13 @@ def build_bootstrap(self):\n         elif self.get_toml(\"crt-static\", build_section) == \"false\":\n             target_features += [\"-crt-static\"]\n         if target_features:\n-            env[\"RUSTFLAGS\"] += \"-C target-feature=\" + (\",\".join(target_features)) + \" \"\n+            env[\"RUSTFLAGS\"] += \" -C target-feature=\" + (\",\".join(target_features))\n         target_linker = self.get_toml(\"linker\", build_section)\n         if target_linker is not None:\n-            env[\"RUSTFLAGS\"] += \"-C linker=\" + target_linker + \" \"\n-        env[\"RUSTFLAGS\"] += \" -Wrust_2018_idioms -Wunused_lifetimes \"\n+            env[\"RUSTFLAGS\"] += \" -C linker=\" + target_linker\n+        env[\"RUSTFLAGS\"] += \" -Wrust_2018_idioms -Wunused_lifetimes\"\n         if self.get_toml(\"deny-warnings\", \"rust\") != \"false\":\n-            env[\"RUSTFLAGS\"] += \"-Dwarnings \"\n+            env[\"RUSTFLAGS\"] += \" -Dwarnings\"\n \n         env[\"PATH\"] = os.path.join(self.bin_root(), \"bin\") + \\\n             os.pathsep + env[\"PATH\"]"}, {"sha": "f8734ebdf4254213b743dfa125fbc701250addba", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/910e83eab2f65dd922f8d980c71840a68b3d7c6a/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/910e83eab2f65dd922f8d980c71840a68b3d7c6a/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=910e83eab2f65dd922f8d980c71840a68b3d7c6a", "patch": "@@ -260,7 +260,7 @@ install!((self, builder, _config),\n     };\n     Rustc, \"src/librustc\", true, only_hosts: true, {\n         builder.ensure(dist::Rustc {\n-            compiler: self.compiler,\n+            compiler: builder.compiler(builder.top_stage, self.target),\n         });\n         install_rustc(builder, self.compiler.stage, self.target);\n     };"}]}