{"sha": "fddef249a23018737b27b91e33129a0ac8a400ce", "node_id": "C_kwDOAAsO6NoAKGZkZGVmMjQ5YTIzMDE4NzM3YjI3YjkxZTMzMTI5YTBhYzhhNDAwY2U", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-03T00:23:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-03T00:23:59Z"}, "message": "Auto merge of #8067 - frobiac:8060-backslash_escaped_in_single_char_pattern, r=giraffate\n\nEscape backslash in single_char_pattern.rs\n\nEscape backslash in single_char_pattern.\n\nPreviously, the proposed clippy fix for a single backslash in raw strings ```r\"\\\"``` or ```r#\"\\\"#``` was also only an unescaped, *single* ```'\\'```:\n```shell\nwarning: single-character string constant used as pattern\n2 |     let s = r#\"abc\\xyz/\"#.find(r\"\\\");\n  |                                ^^^^ help: try using a `char` instead: `'\\'`\n  |\n  = note: `#[warn(clippy::single_char_pattern)]` on by default\n```\n\nThis PR corrects this to a properly escaped *double* backslash ```'\\\\'```.\nI haven't come up with any other problematic cases, a single quote was already handled.\n\nCloses: #8060\n\nchangelog:  Escape backslash in ``[`single_char_pattern`]``", "tree": {"sha": "49b806b1f0eeccd9bc6af3d6dbdbed4483eb0f05", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49b806b1f0eeccd9bc6af3d6dbdbed4483eb0f05"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fddef249a23018737b27b91e33129a0ac8a400ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fddef249a23018737b27b91e33129a0ac8a400ce", "html_url": "https://github.com/rust-lang/rust/commit/fddef249a23018737b27b91e33129a0ac8a400ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fddef249a23018737b27b91e33129a0ac8a400ce/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5d830a50f0a0211bd0820aa8403df8d47f109c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5d830a50f0a0211bd0820aa8403df8d47f109c3", "html_url": "https://github.com/rust-lang/rust/commit/d5d830a50f0a0211bd0820aa8403df8d47f109c3"}, {"sha": "5cc451bc6cb9fc74c85e44be4a510e9c14f03914", "url": "https://api.github.com/repos/rust-lang/rust/commits/5cc451bc6cb9fc74c85e44be4a510e9c14f03914", "html_url": "https://github.com/rust-lang/rust/commit/5cc451bc6cb9fc74c85e44be4a510e9c14f03914"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "11ad881ee7b95bf1d29b58b89111e85a58b575b7", "filename": "clippy_lints/src/methods/utils.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fddef249a23018737b27b91e33129a0ac8a400ce/clippy_lints%2Fsrc%2Fmethods%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fddef249a23018737b27b91e33129a0ac8a400ce/clippy_lints%2Fsrc%2Fmethods%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Futils.rs?ref=fddef249a23018737b27b91e33129a0ac8a400ce", "patch": "@@ -66,7 +66,13 @@ pub(super) fn get_hint_if_single_char_arg(\n                 // for regular string: \"a\"\n                 &snip[1..(snip.len() - 1)]\n             };\n-            let hint = format!(\"'{}'\", if ch == \"'\" { \"\\\\'\" } else { ch });\n+\n+            let hint = format!(\"'{}'\", match ch {\n+                \"'\" => \"\\\\'\" ,\n+                r\"\\\" => \"\\\\\\\\\",\n+                _ => ch,\n+            });\n+\n             Some(hint)\n         } else {\n             None"}, {"sha": "ea26defd3d570f0587fa3dbba2d032bf59763b0e", "filename": "tests/ui/single_char_pattern.fixed", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.fixed?ref=fddef249a23018737b27b91e33129a0ac8a400ce", "patch": "@@ -56,4 +56,7 @@ fn main() {\n     x.split('a');\n     x.split('\\'');\n     x.split('#');\n+    // Must escape backslash in raw strings when converting to char #8060\n+    x.split('\\\\');\n+    x.split('\\\\');\n }"}, {"sha": "eb2d0274fa20ccaae28164097ca686c02f2b3bc7", "filename": "tests/ui/single_char_pattern.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.rs?ref=fddef249a23018737b27b91e33129a0ac8a400ce", "patch": "@@ -56,4 +56,7 @@ fn main() {\n     x.split(r###\"a\"###);\n     x.split(r###\"'\"###);\n     x.split(r###\"#\"###);\n+    // Must escape backslash in raw strings when converting to char #8060\n+    x.split(r#\"\\\"#);\n+    x.split(r\"\\\");\n }"}, {"sha": "f438d3da8ee4ed8cab26036d380545201e1263bb", "filename": "tests/ui/single_char_pattern.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fddef249a23018737b27b91e33129a0ac8a400ce/tests%2Fui%2Fsingle_char_pattern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.stderr?ref=fddef249a23018737b27b91e33129a0ac8a400ce", "patch": "@@ -192,5 +192,17 @@ error: single-character string constant used as pattern\n LL |     x.split(r###\"#\"###);\n    |             ^^^^^^^^^^ help: try using a `char` instead: `'#'`\n \n-error: aborting due to 32 previous errors\n+error: single-character string constant used as pattern\n+  --> $DIR/single_char_pattern.rs:60:13\n+   |\n+LL |     x.split(r#\"/\"#);\n+   |             ^^^^^^ help: try using a `char` instead: `'/'`\n+\n+error: single-character string constant used as pattern\n+  --> $DIR/single_char_pattern.rs:61:13\n+   |\n+LL |     x.split(r\"/\");\n+   |             ^^^^ help: try using a `char` instead: `'/'`\n+\n+error: aborting due to 34 previous errors\n "}]}