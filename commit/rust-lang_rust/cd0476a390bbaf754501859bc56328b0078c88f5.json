{"sha": "cd0476a390bbaf754501859bc56328b0078c88f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkMDQ3NmEzOTBiYmFmNzU0NTAxODU5YmM1NjMyOGIwMDc4Yzg4ZjU=", "commit": {"author": {"name": "Masaki Hara", "email": "ackie.h.gmai@gmail.com", "date": "2018-05-28T15:07:23Z"}, "committer": {"name": "Masaki Hara", "email": "ackie.h.gmai@gmail.com", "date": "2018-08-18T23:06:42Z"}, "message": "Add Builder::array_alloca.", "tree": {"sha": "0544ceb783c0a5c5003bee743542f9ab0f7b2fc8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0544ceb783c0a5c5003bee743542f9ab0f7b2fc8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cd0476a390bbaf754501859bc56328b0078c88f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cd0476a390bbaf754501859bc56328b0078c88f5", "html_url": "https://github.com/rust-lang/rust/commit/cd0476a390bbaf754501859bc56328b0078c88f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cd0476a390bbaf754501859bc56328b0078c88f5/comments", "author": {"login": "qnighy", "id": 41755, "node_id": "MDQ6VXNlcjQxNzU1", "avatar_url": "https://avatars.githubusercontent.com/u/41755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qnighy", "html_url": "https://github.com/qnighy", "followers_url": "https://api.github.com/users/qnighy/followers", "following_url": "https://api.github.com/users/qnighy/following{/other_user}", "gists_url": "https://api.github.com/users/qnighy/gists{/gist_id}", "starred_url": "https://api.github.com/users/qnighy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qnighy/subscriptions", "organizations_url": "https://api.github.com/users/qnighy/orgs", "repos_url": "https://api.github.com/users/qnighy/repos", "events_url": "https://api.github.com/users/qnighy/events{/privacy}", "received_events_url": "https://api.github.com/users/qnighy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "qnighy", "id": 41755, "node_id": "MDQ6VXNlcjQxNzU1", "avatar_url": "https://avatars.githubusercontent.com/u/41755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qnighy", "html_url": "https://github.com/qnighy", "followers_url": "https://api.github.com/users/qnighy/followers", "following_url": "https://api.github.com/users/qnighy/following{/other_user}", "gists_url": "https://api.github.com/users/qnighy/gists{/gist_id}", "starred_url": "https://api.github.com/users/qnighy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qnighy/subscriptions", "organizations_url": "https://api.github.com/users/qnighy/orgs", "repos_url": "https://api.github.com/users/qnighy/repos", "events_url": "https://api.github.com/users/qnighy/events{/privacy}", "received_events_url": "https://api.github.com/users/qnighy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f0168a9f3bc546f12d07018bdacbb1798c571e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f0168a9f3bc546f12d07018bdacbb1798c571e9", "html_url": "https://github.com/rust-lang/rust/commit/9f0168a9f3bc546f12d07018bdacbb1798c571e9"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "cfbc2ab90072ddee7c4a217a7951517741c43b0e", "filename": "src/librustc_codegen_llvm/builder.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cd0476a390bbaf754501859bc56328b0078c88f5/src%2Flibrustc_codegen_llvm%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd0476a390bbaf754501859bc56328b0078c88f5/src%2Flibrustc_codegen_llvm%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fbuilder.rs?ref=cd0476a390bbaf754501859bc56328b0078c88f5", "patch": "@@ -445,6 +445,25 @@ impl Builder<'a, 'll, 'tcx> {\n         }\n     }\n \n+    pub fn array_alloca(&self,\n+                        ty: &'ll Type,\n+                        len: &'ll Value,\n+                        name: &str,\n+                        align: Align) -> &'ll Value {\n+        self.count_insn(\"alloca\");\n+        unsafe {\n+            let alloca = if name.is_empty() {\n+                llvm::LLVMBuildArrayAlloca(self.llbuilder, ty, len, noname())\n+            } else {\n+                let name = SmallCStr::new(name);\n+                llvm::LLVMBuildArrayAlloca(self.llbuilder, ty, len,\n+                                           name.as_ptr())\n+            };\n+            llvm::LLVMSetAlignment(alloca, align.abi() as c_uint);\n+            alloca\n+        }\n+    }\n+\n     pub fn load(&self, ptr: &'ll Value, align: Align) -> &'ll Value {\n         self.count_insn(\"load\");\n         unsafe {"}, {"sha": "d3039a05b6db84d070e8eed5f7ce4ba2a6c608f8", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cd0476a390bbaf754501859bc56328b0078c88f5/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd0476a390bbaf754501859bc56328b0078c88f5/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=cd0476a390bbaf754501859bc56328b0078c88f5", "patch": "@@ -875,6 +875,11 @@ extern \"C\" {\n \n     // Memory\n     pub fn LLVMBuildAlloca(B: &Builder<'a>, Ty: &'a Type, Name: *const c_char) -> &'a Value;\n+    pub fn LLVMBuildArrayAlloca(B: &Builder<'a>,\n+                                Ty: &'a Type,\n+                                Val: &'a Value,\n+                                Name: *const c_char)\n+                                -> &'a Value;\n     pub fn LLVMBuildLoad(B: &Builder<'a>, PointerVal: &'a Value, Name: *const c_char) -> &'a Value;\n \n     pub fn LLVMBuildStore(B: &Builder<'a>, Val: &'a Value, Ptr: &'a Value) -> &'a Value;"}]}