{"sha": "96179cd8fe44cf6c60161d0a6e78ae01c6929654", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2MTc5Y2Q4ZmU0NGNmNmM2MDE2MWQwYTZlNzhhZTAxYzY5Mjk2NTQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-04T06:35:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-08-04T06:35:49Z"}, "message": "Rollup merge of #52940 - kennytm:move-checktool-protection-week, r=alexcrichton\n\nAlign 6-week cycle check with beta promotion instead of stable release.\n\nThe regression check is to make beta promotion easier, so it makes more\nsense to use the Tuesday of the release week (T-2) as the end point of the\nregression prevention, instead of Thursday (T-0). But since the beta\npromotion PR is sent at Tuesday evening at UTC, the protection should\ninclude the whole Tuesday as well, meaning the 6-week cycle will start from\nWednesdays.\n\nThis will also move the start of the regression protection week one day\nearlier.", "tree": {"sha": "cad43af39d2205ae579eb889723e1f2c4947b9cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cad43af39d2205ae579eb889723e1f2c4947b9cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96179cd8fe44cf6c60161d0a6e78ae01c6929654", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbZUlFCRBK7hj4Ov3rIwAAdHIIAFjEo7OgDHyHVOHGyPdgCmsc\n+i+MKVU5kAYSzIjTV8bXoQ1JV4cYiJQ+TeermFnmGZyVMDw9uuieMTXbwa/AHLHL\nO87Nczrb2UdqJ5tAq/SSqyRJuDwXW0VWsntSTVLEVbSov+oPbJfRagBUQiVRcfwQ\nETCHV97RA9C0ZkHr0Bz/9hsvRG2EJIfkEcfo0oPH4f+HNOI2n9mNC+XSiRJ5ZM64\nEfKgaVZ/23k/bWAmgi4hjvU3nFv1S9Gf0aZdXsE6Gjd5sJSszsIY9wMM4YJY5D08\n/lHbng91NOCq4EQFQGTIaB2QbCsrP4pHnLSR79a2NorE+UW/zw2ISQHJUJ14/wE=\n=D87M\n-----END PGP SIGNATURE-----\n", "payload": "tree cad43af39d2205ae579eb889723e1f2c4947b9cd\nparent 579adf8c727861841b4819b4913385c2782977fb\nparent 0da7da8391cfb27a809b3fea7e0f50dd64d018c8\nauthor kennytm <kennytm@gmail.com> 1533364549 +0800\ncommitter GitHub <noreply@github.com> 1533364549 +0800\n\nRollup merge of #52940 - kennytm:move-checktool-protection-week, r=alexcrichton\n\nAlign 6-week cycle check with beta promotion instead of stable release.\n\nThe regression check is to make beta promotion easier, so it makes more\nsense to use the Tuesday of the release week (T-2) as the end point of the\nregression prevention, instead of Thursday (T-0). But since the beta\npromotion PR is sent at Tuesday evening at UTC, the protection should\ninclude the whole Tuesday as well, meaning the 6-week cycle will start from\nWednesdays.\n\nThis will also move the start of the regression protection week one day\nearlier.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96179cd8fe44cf6c60161d0a6e78ae01c6929654", "html_url": "https://github.com/rust-lang/rust/commit/96179cd8fe44cf6c60161d0a6e78ae01c6929654", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96179cd8fe44cf6c60161d0a6e78ae01c6929654/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "579adf8c727861841b4819b4913385c2782977fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/579adf8c727861841b4819b4913385c2782977fb", "html_url": "https://github.com/rust-lang/rust/commit/579adf8c727861841b4819b4913385c2782977fb"}, {"sha": "0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0da7da8391cfb27a809b3fea7e0f50dd64d018c8", "html_url": "https://github.com/rust-lang/rust/commit/0da7da8391cfb27a809b3fea7e0f50dd64d018c8"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "d876cb7f37a41b91dea2148a05f95818f55bb8ae", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/96179cd8fe44cf6c60161d0a6e78ae01c6929654/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/96179cd8fe44cf6c60161d0a6e78ae01c6929654/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=96179cd8fe44cf6c60161d0a6e78ae01c6929654", "patch": "@@ -17,9 +17,11 @@ TOOLSTATE_FILE=\"$(realpath $2)\"\n OS=\"$3\"\n COMMIT=\"$(git rev-parse HEAD)\"\n CHANGED_FILES=\"$(git diff --name-status HEAD HEAD^)\"\n-SIX_WEEK_CYCLE=\"$(( ($(date +%s) / 604800 - 3) % 6 ))\"\n-# ^ 1970 Jan 1st is a Thursday, and our release dates are also on Thursdays,\n-#   thus we could divide by 604800 (7 days in seconds) directly.\n+SIX_WEEK_CYCLE=\"$(( ($(date +%s) / 86400 - 20) % 42 ))\"\n+# ^ Number of days after the last promotion of beta.\n+#   Its value is 41 on the Tuesday where \"Promote master to beta (T-2)\" happens.\n+#   The Wednesday after this has value 0.\n+#   We track this value to prevent regressing tools in the last week of the 6-week cycle.\n \n touch \"$TOOLSTATE_FILE\"\n \n@@ -98,7 +100,7 @@ change_toolstate() {\n     if python2.7 \"$CHECK_NOT\" \"$OS\" \"$TOOLSTATE_FILE\" \"_data/latest.json\" changed; then\n         echo 'Toolstate is not changed. Not updating.'\n     else\n-        if [ $SIX_WEEK_CYCLE -eq 5 ]; then\n+        if [ $SIX_WEEK_CYCLE -ge 35 ]; then\n             python2.7 \"$CHECK_NOT\" \"$OS\" \"$TOOLSTATE_FILE\" \"_data/latest.json\" regressed\n         fi\n         sed -i \"1 a\\\\"}]}