{"sha": "e846643d23ab20ca7fc194e358053ebf0f74d47e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4NDY2NDNkMjNhYjIwY2E3ZmMxOTRlMzU4MDUzZWJmMGY3NGQ0N2U=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-25T00:23:09Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-25T00:23:09Z"}, "message": "Fix mod-bug in std.map, work around bug in closure typaram capture, enable insert-tests in lib-map.rs.", "tree": {"sha": "54ff082ed5f446ff057524c92509edefb7fd35e7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54ff082ed5f446ff057524c92509edefb7fd35e7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e846643d23ab20ca7fc194e358053ebf0f74d47e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e846643d23ab20ca7fc194e358053ebf0f74d47e", "html_url": "https://github.com/rust-lang/rust/commit/e846643d23ab20ca7fc194e358053ebf0f74d47e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e846643d23ab20ca7fc194e358053ebf0f74d47e/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ea37bd47bc0804ce58863da09a3ba3490daede3", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ea37bd47bc0804ce58863da09a3ba3490daede3", "html_url": "https://github.com/rust-lang/rust/commit/9ea37bd47bc0804ce58863da09a3ba3490daede3"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "b6162e02b3131af44a2530a3e86ef22b376e2ea1", "filename": "src/lib/map.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e846643d23ab20ca7fc194e358053ebf0f74d47e/src%2Flib%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e846643d23ab20ca7fc194e358053ebf0f74d47e/src%2Flib%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fmap.rs?ref=e846643d23ab20ca7fc194e358053ebf0f74d47e", "patch": "@@ -47,18 +47,17 @@ fn mk_hashmap[K, V](&hashfn[K] hasher, &eqfn[K] eqer) -> hashmap[K, V] {\n   // fixed key.\n \n   fn hashl[K](&hashfn[K] hasher, uint nbkts, &K key) -> uint {\n-    ret (hasher(key) >>> (sys.rustrt.size_of[uint]() * 8u / 2u))\n-      % nbkts;\n+    ret (hasher(key) >>> (sys.rustrt.size_of[uint]() * 8u / 2u));\n   }\n \n   fn hashr[K](&hashfn[K] hasher, uint nbkts, &K key) -> uint {\n     ret ((((~ 0u) >>> (sys.rustrt.size_of[uint]() * 8u / 2u))\n-          & hasher(key)) * 2u + 1u)\n-      % nbkts;\n+          & hasher(key)) * 2u + 1u);\n   }\n \n   fn hash[K](&hashfn[K] hasher, uint nbkts, &K key, uint i) -> uint {\n-    ret hashl[K](hasher, nbkts, key) + i * hashr[K](hasher, nbkts, key);\n+    ret (hashl[K](hasher, nbkts, key)\n+         + i * hashr[K](hasher, nbkts, key)) % nbkts;\n   }\n \n   /**"}, {"sha": "4f96578947c55261f680eb8631f72ccf49b2537f", "filename": "src/test/run-pass/lib-map.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e846643d23ab20ca7fc194e358053ebf0f74d47e/src%2Ftest%2Frun-pass%2Flib-map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e846643d23ab20ca7fc194e358053ebf0f74d47e/src%2Ftest%2Frun-pass%2Flib-map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-map.rs?ref=e846643d23ab20ca7fc194e358053ebf0f74d47e", "patch": "@@ -7,11 +7,18 @@ fn test_simple() {\n   log \"*** starting test_simple\";\n \n   fn eq(&uint x, &uint y) -> bool { ret x == y; }\n+  fn hash(&uint u) -> uint {\n+    // FIXME: can't use std.util.id since we'd be capturing a type param,\n+    // and presently we can't close items over type params.\n+    ret u;\n+  }\n \n-  let map.hashfn[uint] hasher = std.util.id[uint];\n+  let map.hashfn[uint] hasher = hash;\n   let map.eqfn[uint] eqer = eq;\n   let map.hashmap[uint, uint] hm = map.mk_hashmap[uint, uint](hasher, eqer);\n-\n+  hm.insert(10u, 12u);\n+  hm.insert(11u, 13u);\n+  hm.insert(12u, 14u);\n   log \"*** finished test_simple\";\n }\n "}]}