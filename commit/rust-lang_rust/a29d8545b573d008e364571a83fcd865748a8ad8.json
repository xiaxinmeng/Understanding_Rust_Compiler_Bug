{"sha": "a29d8545b573d008e364571a83fcd865748a8ad8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyOWQ4NTQ1YjU3M2QwMDhlMzY0NTcxYTgzZmNkODY1NzQ4YThhZDg=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2017-11-16T09:08:19Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-02-05T14:56:44Z"}, "message": "Make inline assembly volatile if it has no outputs. Fixes #46026", "tree": {"sha": "a172464bae2104117c4eeacbed5e4fc3bd1efb55", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a172464bae2104117c4eeacbed5e4fc3bd1efb55"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a29d8545b573d008e364571a83fcd865748a8ad8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a29d8545b573d008e364571a83fcd865748a8ad8", "html_url": "https://github.com/rust-lang/rust/commit/a29d8545b573d008e364571a83fcd865748a8ad8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a29d8545b573d008e364571a83fcd865748a8ad8/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8385fc062dbb57c32d96d16e59d244c168103946", "url": "https://api.github.com/repos/rust-lang/rust/commits/8385fc062dbb57c32d96d16e59d244c168103946", "html_url": "https://github.com/rust-lang/rust/commit/8385fc062dbb57c32d96d16e59d244c168103946"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "d1de4dccd00430b4d3885c3635d7d556b1c1eb00", "filename": "src/libsyntax_ext/asm.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a29d8545b573d008e364571a83fcd865748a8ad8/src%2Flibsyntax_ext%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a29d8545b573d008e364571a83fcd865748a8ad8/src%2Flibsyntax_ext%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fasm.rs?ref=a29d8545b573d008e364571a83fcd865748a8ad8", "patch": "@@ -239,6 +239,12 @@ pub fn expand_asm<'cx>(cx: &'cx mut ExtCtxt,\n         }\n     }\n \n+    // If there are no outputs, the inline assembly is executed just for its side effects,\n+    // so ensure that it is volatile\n+    if outputs.is_empty() {\n+        volatile = true;\n+    }\n+\n     MacEager::expr(P(ast::Expr {\n         id: ast::DUMMY_NODE_ID,\n         node: ast::ExprKind::InlineAsm(P(ast::InlineAsm {"}, {"sha": "457d706a8ffef21f6c6cbf9834cffa47596e7964", "filename": "src/test/codegen/no-output-asm-is-volatile.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/a29d8545b573d008e364571a83fcd865748a8ad8/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a29d8545b573d008e364571a83fcd865748a8ad8/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs?ref=a29d8545b573d008e364571a83fcd865748a8ad8", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -O\n+\n+// ignore-asmjs\n+\n+#![feature(asm)]\n+#![crate_type = \"lib\"]\n+\n+// Check that inline assembly expressions without any outputs\n+// are marked as having side effects / being volatile\n+\n+// CHECK-LABEL: @assembly\n+#[no_mangle]\n+pub fn assembly() {\n+    unsafe { asm!(\"\") }\n+// CHECK: tail call void asm sideeffect \"\", {{.*}}\n+}"}]}