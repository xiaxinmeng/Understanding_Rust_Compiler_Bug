{"sha": "f693d339f175b3aa23a91c62632c5f0c86886059", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2OTNkMzM5ZjE3NWIzYWEyM2E5MWM2MjYzMmM1ZjBjODY4ODYwNTk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-20T17:57:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-06-20T17:57:04Z"}, "message": "Auto merge of #61827 - golddranks:lldb_fix, r=nikomatsakis\n\nFix rust-lldb wrapper scripts.\n\nCurrently the `rust-lldb` wrapper provided by Rust project is broken. The error messages it produces on launch are as follows:\n```\nwarning: ignoring unknown option: --one-line-before-file=command script import \"/Users/kon/.rustup/toolchains/nightly-2019-05-02-x86_64-apple-darwin/lib/rustlib/etc/lldb_rust_formatters.py\"\nwarning: ignoring unknown option: --one-line-before-file=type summary add --no-value --python-function lldb_rust_formatters.print_val -x \".*\" --category Rust\nwarning: ignoring unknown option: --one-line-before-file=type category enable Rust\n(lldb) target create \"target/debug/nagare\"\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/Users/kon/.rustup/toolchains/nightly-2019-05-02-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/python2.7/site-packages/lldb/__init__.py\", line 1481, in <module>\n    class SBAddress(object):\n  File \"/Users/kon/.rustup/toolchains/nightly-2019-05-02-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/python2.7/site-packages/lldb/__init__.py\", line 1647, in SBAddress\n    __swig_getmethods__[\"module\"] = GetModule\nNameError: name '__swig_getmethods__' is not defined\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nNameError: name 'run_one_line' is not defined\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nNameError: name 'run_one_line' is not defined\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nNameError: name 'run_one_line' is not defined\n...etc.\n```\n\nThe errors stem from two regressions: one caused by an LLVM upgrade and one caused by unintended upgrade to SWIG 4.0 (SWIG is a wrapper generator that is used to generate Python bindings for LLVM and LLDB.)\n\n(Edit: found the exact dates) The SWIG breakage happened because of a Homebrew version upgrade on `nightly-2019-05-01-x86_64-apple-darwin` and the LLVM breakage happened on `nightly-2019-01-27-x86_64-apple-darwin` (likely to have been caused by https://github.com/rust-lang/rust/pull/57675 ).\n\nThe fix is to update the LLVM parameter syntax and to \"downgrade\" to SWIG 3.0.x. SWIG 3.0.x is not going to be supported by Homebrew forever, but should be good for now, until LLDB upgrades to  support SWIG 4.0.0. Here's some more info about Homebrew support: https://github.com/Homebrew/homebrew-core/pull/39929 & https://github.com/Homebrew/homebrew-core/pull/40882 I'm going to send a bug & fix to LLDB about SWIG 4.0.0 to get the situation fixed in the future.\n\nIt would be good to also backport this to beta, since it's such a small change, and will fix an obvious regression.", "tree": {"sha": "0753945549b11d212da7c8dda87597941f264cbc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0753945549b11d212da7c8dda87597941f264cbc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f693d339f175b3aa23a91c62632c5f0c86886059", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f693d339f175b3aa23a91c62632c5f0c86886059", "html_url": "https://github.com/rust-lang/rust/commit/f693d339f175b3aa23a91c62632c5f0c86886059", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f693d339f175b3aa23a91c62632c5f0c86886059/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0c2bdf52e0c8bce258f1bbb5652c9691b7f3193", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0c2bdf52e0c8bce258f1bbb5652c9691b7f3193", "html_url": "https://github.com/rust-lang/rust/commit/f0c2bdf52e0c8bce258f1bbb5652c9691b7f3193"}, {"sha": "2d6e1df51c7a8ebbe642e2c763249f73eb8f4df6", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d6e1df51c7a8ebbe642e2c763249f73eb8f4df6", "html_url": "https://github.com/rust-lang/rust/commit/2d6e1df51c7a8ebbe642e2c763249f73eb8f4df6"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "271f9d382ff64f87d9c4290e0539d81a30335f55", "filename": ".azure-pipelines/steps/run.yml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f693d339f175b3aa23a91c62632c5f0c86886059/.azure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/f693d339f175b3aa23a91c62632c5f0c86886059/.azure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fsteps%2Frun.yml?ref=f693d339f175b3aa23a91c62632c5f0c86886059", "patch": "@@ -37,7 +37,8 @@ steps:\n     set -e\n     brew update\n     brew install xz\n-    brew install swig\n+    brew install swig@3\n+    brew link --force swig@3\n   displayName: Install build dependencies (OSX)\n   condition: and(succeeded(), eq(variables['Agent.OS'], 'Darwin'), eq(variables['SCRIPT'],'./x.py dist'))\n "}, {"sha": "3d185b4f0c9ff6bc56b12442f4c653be4b0e6920", "filename": ".travis.yml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f693d339f175b3aa23a91c62632c5f0c86886059/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/f693d339f175b3aa23a91c62632c5f0c86886059/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=f693d339f175b3aa23a91c62632c5f0c86886059", "patch": "@@ -263,7 +263,8 @@ install:\n           if [[ \"$SCRIPT\" == \"./x.py dist\" ]]; then\n             travis_retry brew update &&\n             travis_retry brew install xz &&\n-            travis_retry brew install swig;\n+            travis_retry brew install swig@3 &&\n+            brew link --force swig@3;\n           fi &&\n           travis_retry curl -fo /usr/local/bin/sccache https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-apple-darwin &&\n             chmod +x /usr/local/bin/sccache &&"}, {"sha": "0eb99423df576783912f0f25a1cccfefd435116c", "filename": "src/etc/rust-lldb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f693d339f175b3aa23a91c62632c5f0c86886059/src%2Fetc%2Frust-lldb", "raw_url": "https://github.com/rust-lang/rust/raw/f693d339f175b3aa23a91c62632c5f0c86886059/src%2Fetc%2Frust-lldb", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Frust-lldb?ref=f693d339f175b3aa23a91c62632c5f0c86886059", "patch": "@@ -31,7 +31,7 @@ category_definition=\"type summary add --no-value --python-function lldb_rust_for\n category_enable=\"type category enable Rust\"\n \n # Call LLDB with the commands added to the argument list\n-exec \"$lldb\" --one-line-before-file=\"$script_import\" \\\n-    --one-line-before-file=\"$category_definition\" \\\n-    --one-line-before-file=\"$category_enable\" \\\n+exec \"$lldb\" --one-line-before-file \"$script_import\" \\\n+    --one-line-before-file \"$category_definition\" \\\n+    --one-line-before-file \"$category_enable\" \\\n     \"$@\""}]}