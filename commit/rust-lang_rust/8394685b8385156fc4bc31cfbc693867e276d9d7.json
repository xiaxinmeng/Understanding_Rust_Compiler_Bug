{"sha": "8394685b8385156fc4bc31cfbc693867e276d9d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzOTQ2ODViODM4NTE1NmZjNGJjMzFjZmJjNjkzODY3ZTI3NmQ5ZDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-09-16T11:01:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-16T11:01:01Z"}, "message": "Auto merge of #36441 - alexcrichton:rustbuild-target, r=brson\n\nrustbuild: Fix cross-compiles to MinGW on Linux\n\nCloses #36290\nCloses #36291", "tree": {"sha": "1ce201fd010be57e767bd462e67aeaef50c9deb8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ce201fd010be57e767bd462e67aeaef50c9deb8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8394685b8385156fc4bc31cfbc693867e276d9d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8394685b8385156fc4bc31cfbc693867e276d9d7", "html_url": "https://github.com/rust-lang/rust/commit/8394685b8385156fc4bc31cfbc693867e276d9d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8394685b8385156fc4bc31cfbc693867e276d9d7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89500e934134d19b09e51a1f45430ded65e291b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/89500e934134d19b09e51a1f45430ded65e291b4", "html_url": "https://github.com/rust-lang/rust/commit/89500e934134d19b09e51a1f45430ded65e291b4"}, {"sha": "5841678f51b9fcb085dba148639a21d95ef91423", "url": "https://api.github.com/repos/rust-lang/rust/commits/5841678f51b9fcb085dba148639a21d95ef91423", "html_url": "https://github.com/rust-lang/rust/commit/5841678f51b9fcb085dba148639a21d95ef91423"}], "stats": {"total": 40, "additions": 33, "deletions": 7}, "files": [{"sha": "9de438cfa7d504756e1211fdcf2c8733c9ce57d2", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -128,14 +128,16 @@ fn build_startup_objects(build: &Build, target: &str, into: &Path) {\n         return\n     }\n     let compiler = Compiler::new(0, &build.config.build);\n-    let compiler = build.compiler_path(&compiler);\n+    let compiler_path = build.compiler_path(&compiler);\n \n     for file in t!(fs::read_dir(build.src.join(\"src/rtstartup\"))) {\n         let file = t!(file);\n-        build.run(Command::new(&compiler)\n-                          .arg(\"--emit=obj\")\n-                          .arg(\"--out-dir\").arg(into)\n-                          .arg(file.path()));\n+        let mut cmd = Command::new(&compiler_path);\n+        build.add_bootstrap_key(&compiler, &mut cmd);\n+        build.run(cmd.arg(\"--target\").arg(target)\n+                     .arg(\"--emit=obj\")\n+                     .arg(\"--out-dir\").arg(into)\n+                     .arg(file.path()));\n     }\n \n     for obj in [\"crt2.o\", \"dllcrt2.o\"].iter() {"}, {"sha": "b57b7e8432167b7c442540c920cecbdac708aacb", "filename": "src/rtstartup/rsbegin.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frtstartup%2Frsbegin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frtstartup%2Frsbegin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frtstartup%2Frsbegin.rs?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -22,10 +22,19 @@\n // object (usually called `crtX.o), which then invokes initialization callbacks\n // of other runtime components (registered via yet another special image section).\n \n+#![feature(no_core, lang_items)]\n #![crate_type=\"rlib\"]\n-#![no_std]\n+#![no_core]\n #![allow(non_camel_case_types)]\n \n+#[lang = \"sized\"]\n+trait Sized {}\n+#[lang = \"sync\"]\n+trait Sync {}\n+#[lang = \"copy\"]\n+trait Copy {}\n+impl<T> Sync for T {}\n+\n #[cfg(all(target_os=\"windows\", target_arch = \"x86\", target_env=\"gnu\"))]\n pub mod eh_frames {\n     #[no_mangle]"}, {"sha": "4c48d9af0e1f442df4fb6f68a7944163d158e75a", "filename": "src/rtstartup/rsend.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frtstartup%2Frsend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frtstartup%2Frsend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frtstartup%2Frsend.rs?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -10,8 +10,15 @@\n \n // See rsbegin.rs for details.\n \n+#![feature(no_core, lang_items)]\n #![crate_type=\"rlib\"]\n-#![no_std]\n+#![no_core]\n+\n+#[lang = \"sized\"]\n+trait Sized {}\n+#[lang = \"sync\"]\n+trait Sync {}\n+impl<T> Sync for T {}\n \n #[cfg(all(target_os=\"windows\", target_arch = \"x86\", target_env=\"gnu\"))]\n pub mod eh_frames {"}, {"sha": "b460235545759a118b7eb8132945e2142bb65aaf", "filename": "src/rustc/std_shim/Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fstd_shim%2FCargo.lock?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -2,6 +2,7 @@\n name = \"std_shim\"\n version = \"0.1.0\"\n dependencies = [\n+ \"core 0.0.0\",\n  \"std 0.0.0\",\n ]\n "}, {"sha": "58a7bd8a1cb7519fa31ce820b44c0c0686ea2dc0", "filename": "src/rustc/std_shim/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fstd_shim%2FCargo.toml?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -41,6 +41,7 @@ debug-assertions = false\n \n [dependencies]\n std = { path = \"../../libstd\" }\n+core = { path = \"../../libcore\" }\n \n # Reexport features from std\n [features]"}, {"sha": "2fc5d8d6e53218c37322e9ad8f79ea46b7f24400", "filename": "src/rustc/std_shim/lib.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8394685b8385156fc4bc31cfbc693867e276d9d7/src%2Frustc%2Fstd_shim%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fstd_shim%2Flib.rs?ref=8394685b8385156fc4bc31cfbc693867e276d9d7", "patch": "@@ -9,3 +9,9 @@\n // except according to those terms.\n \n // See comments in Cargo.toml for why this exists\n+\n+// There's a bug right now where if we pass --extern std=... and we're cross\n+// compiling then this doesn't work with `#[macro_use] extern crate std;`. Work\n+// around this by not having `#[macro_use] extern crate std;`\n+#![no_std]\n+extern crate std;"}]}