{"sha": "f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NmRlZWY1YjYwNTliOWEwYTc2ZDlmMGRhZmI5NWNlZDg1Zjc0NDk=", "commit": {"author": {"name": "Stjepan Glavina", "email": "stjepang@gmail.com", "date": "2018-04-06T13:02:21Z"}, "committer": {"name": "Stjepan Glavina", "email": "stjepang@gmail.com", "date": "2018-04-06T13:15:28Z"}, "message": "Add Cell::update", "tree": {"sha": "d94f5bccb1bb443a0c2bc9cddf83daed6248ef62", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d94f5bccb1bb443a0c2bc9cddf83daed6248ef62"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "html_url": "https://github.com/rust-lang/rust/commit/f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f86deef5b6059b9a0a76d9f0dafb95ced85f7449/comments", "author": null, "committer": null, "parents": [{"sha": "a143462783cec88b7b733e8aa09990bfeb59f754", "url": "https://api.github.com/repos/rust-lang/rust/commits/a143462783cec88b7b733e8aa09990bfeb59f754", "html_url": "https://github.com/rust-lang/rust/commit/a143462783cec88b7b733e8aa09990bfeb59f754"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "2ea1b84d0340169643fcafc255a850f5cc02e6cb", "filename": "src/libcore/cell.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f86deef5b6059b9a0a76d9f0dafb95ced85f7449/src%2Flibcore%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86deef5b6059b9a0a76d9f0dafb95ced85f7449/src%2Flibcore%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcell.rs?ref=f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "patch": "@@ -256,6 +256,30 @@ impl<T:Copy> Cell<T> {\n     pub fn get(&self) -> T {\n         unsafe{ *self.value.get() }\n     }\n+\n+    /// Applies a function to the contained value.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// use std::cell::Cell;\n+    ///\n+    /// let c = Cell::new(5);\n+    /// c.update(|x| x + 1);\n+    ///\n+    /// assert_eq!(c.get(), 6);\n+    /// ```\n+    #[inline]\n+    #[unstable(feature = \"cell_update\", issue = \"0\")] // TODO: issue\n+    pub fn update<F>(&self, f: F) -> T\n+    where\n+        F: FnOnce(T) -> T,\n+    {\n+        let old = self.get();\n+        let new = f(old);\n+        self.set(new);\n+        new\n+    }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]"}, {"sha": "962fb2f0e027b3924507205b43145beccef82485", "filename": "src/libcore/tests/cell.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f86deef5b6059b9a0a76d9f0dafb95ced85f7449/src%2Flibcore%2Ftests%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86deef5b6059b9a0a76d9f0dafb95ced85f7449/src%2Flibcore%2Ftests%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fcell.rs?ref=f86deef5b6059b9a0a76d9f0dafb95ced85f7449", "patch": "@@ -26,6 +26,17 @@ fn smoketest_cell() {\n     assert!(y.get() == (30, 40));\n }\n \n+#[test]\n+fn cell_update() {\n+    let x = Cell::new(10);\n+\n+    assert_eq!(x.update(|x| x + 5), 15);\n+    assert_eq!(x.get(), 15);\n+\n+    assert_eq!(x.update(|x| x / 3), 5);\n+    assert_eq!(x.get(), 5);\n+}\n+\n #[test]\n fn cell_has_sensible_show() {\n     let x = Cell::new(\"foo bar\");"}]}