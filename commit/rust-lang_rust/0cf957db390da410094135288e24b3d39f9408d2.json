{"sha": "0cf957db390da410094135288e24b3d39f9408d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjZjk1N2RiMzkwZGE0MTAwOTQxMzUyODhlMjRiM2QzOWY5NDA4ZDI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-30T10:55:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-30T10:55:30Z"}, "message": "Rollup merge of #55473 - ljedrz:transitive/elaborate_bounds_impl_iterator, r=estebank\n\nTake advantage of impl Iterator in (transitive/elaborate)_bounds\n\nOther than for `debug!`ging purposes, `bounds` are only iterated over, so they don't need to be collected into vectors.", "tree": {"sha": "e2a553481ec91833ccb47f50c8c0d38f23f519c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2a553481ec91833ccb47f50c8c0d38f23f519c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0cf957db390da410094135288e24b3d39f9408d2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb2DijCRBK7hj4Ov3rIwAAdHIIAHd7YfdG7Ri0XOfQz4Kkj0r0\nXXUFhXYwgYC/gUFV08SbH/vkHEKmjjj/GHEoD28O7Ck5jMC+IIkggRWKXmd6WPhF\nWosFV6jNGNvZzIKgKeTrEVvEuMvDLRsS/3xE0xTo2vFaW6PuohM9gZyzFiYliV1N\nQtTq/Fabrm4vPhLvHW2xMeNfF5pAoagiya4n5G623jCaNrYj2eE08Hakr5nWsMDk\nNh99ZGrI+uubqU1HE8gARHpqHJrl9/GIUU49x3mueKJDAcU4dpFR85Qgilo3gHIt\nPHKBSdvAGA/lNQ4SXYaMAfQI8MrcSwectzPx39CNXSt8fq/HuUE6pSAGxTX5BwE=\n=u9Mz\n-----END PGP SIGNATURE-----\n", "payload": "tree e2a553481ec91833ccb47f50c8c0d38f23f519c9\nparent dc04aaf77747583597d1a76a9668ecdeace753ca\nparent 40079ac42df61958ce6b719df08f08b9799c1be4\nauthor kennytm <kennytm@gmail.com> 1540896930 +0800\ncommitter GitHub <noreply@github.com> 1540896930 +0800\n\nRollup merge of #55473 - ljedrz:transitive/elaborate_bounds_impl_iterator, r=estebank\n\nTake advantage of impl Iterator in (transitive/elaborate)_bounds\n\nOther than for `debug!`ging purposes, `bounds` are only iterated over, so they don't need to be collected into vectors.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0cf957db390da410094135288e24b3d39f9408d2", "html_url": "https://github.com/rust-lang/rust/commit/0cf957db390da410094135288e24b3d39f9408d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0cf957db390da410094135288e24b3d39f9408d2/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc04aaf77747583597d1a76a9668ecdeace753ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc04aaf77747583597d1a76a9668ecdeace753ca", "html_url": "https://github.com/rust-lang/rust/commit/dc04aaf77747583597d1a76a9668ecdeace753ca"}, {"sha": "40079ac42df61958ce6b719df08f08b9799c1be4", "url": "https://api.github.com/repos/rust-lang/rust/commits/40079ac42df61958ce6b719df08f08b9799c1be4", "html_url": "https://github.com/rust-lang/rust/commit/40079ac42df61958ce6b719df08f08b9799c1be4"}], "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "940cf736012ec0c0e2a9bde0ffdce2c34b5a0270", "filename": "src/librustc/traits/util.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc%2Ftraits%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc%2Ftraits%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Futil.rs?ref=0cf957db390da410094135288e24b3d39f9408d2", "patch": "@@ -103,11 +103,10 @@ pub fn elaborate_trait_ref<'cx, 'gcx, 'tcx>(\n \n pub fn elaborate_trait_refs<'cx, 'gcx, 'tcx>(\n     tcx: TyCtxt<'cx, 'gcx, 'tcx>,\n-    trait_refs: &[ty::PolyTraitRef<'tcx>])\n+    trait_refs: impl Iterator<Item = ty::PolyTraitRef<'tcx>>)\n     -> Elaborator<'cx, 'gcx, 'tcx>\n {\n-    let predicates = trait_refs.iter()\n-                               .map(|trait_ref| trait_ref.to_predicate())\n+    let predicates = trait_refs.map(|trait_ref| trait_ref.to_predicate())\n                                .collect();\n     elaborate_predicates(tcx, predicates)\n }\n@@ -271,7 +270,7 @@ pub fn supertraits<'cx, 'gcx, 'tcx>(tcx: TyCtxt<'cx, 'gcx, 'tcx>,\n }\n \n pub fn transitive_bounds<'cx, 'gcx, 'tcx>(tcx: TyCtxt<'cx, 'gcx, 'tcx>,\n-                                          bounds: &[ty::PolyTraitRef<'tcx>])\n+                                          bounds: impl Iterator<Item = ty::PolyTraitRef<'tcx>>)\n                                           -> Supertraits<'cx, 'gcx, 'tcx>\n {\n     elaborate_trait_refs(tcx, bounds).filter_to_traits()"}, {"sha": "7ddc56974d816157abbf594c8c15c24f7d52765e", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=0cf957db390da410094135288e24b3d39f9408d2", "patch": "@@ -1112,12 +1112,12 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx>+'o {\n     {\n         let tcx = self.tcx();\n \n-        let bounds: Vec<_> = self.get_type_parameter_bounds(span, ty_param_def_id)\n-            .predicates.into_iter().filter_map(|(p, _)| p.to_opt_poly_trait_ref()).collect();\n+        let bounds = self.get_type_parameter_bounds(span, ty_param_def_id)\n+            .predicates.into_iter().filter_map(|(p, _)| p.to_opt_poly_trait_ref());\n \n         // Check that there is exactly one way to find an associated type with the\n         // correct name.\n-        let suitable_bounds = traits::transitive_bounds(tcx, &bounds)\n+        let suitable_bounds = traits::transitive_bounds(tcx, bounds)\n             .filter(|b| self.trait_defines_associated_type_named(b.def_id(), assoc_name));\n \n         let param_node_id = tcx.hir.as_local_node_id(ty_param_def_id).unwrap();"}, {"sha": "5a8a9632350f2621959bd8d811a3a36b98574c24", "filename": "src/librustc_typeck/check/method/probe.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0cf957db390da410094135288e24b3d39f9408d2/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fprobe.rs?ref=0cf957db390da410094135288e24b3d39f9408d2", "patch": "@@ -31,6 +31,7 @@ use rustc::middle::stability;\n use syntax::ast;\n use syntax::util::lev_distance::{lev_distance, find_best_match_for_name};\n use syntax_pos::{Span, symbol::Symbol};\n+use std::iter;\n use std::mem;\n use std::ops::Deref;\n use std::rc::Rc;\n@@ -627,7 +628,7 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n         // itself. Hence, a `&self` method will wind up with an\n         // argument type like `&Trait`.\n         let trait_ref = principal.with_self_ty(self.tcx, self_ty);\n-        self.elaborate_bounds(&[trait_ref], |this, new_trait_ref, item| {\n+        self.elaborate_bounds(iter::once(trait_ref), |this, new_trait_ref, item| {\n             let new_trait_ref = this.erase_late_bound_regions(&new_trait_ref);\n \n             let (xform_self_ty, xform_ret_ty) =\n@@ -645,7 +646,7 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n                                                param_ty: ty::ParamTy) {\n         // FIXME -- Do we want to commit to this behavior for param bounds?\n \n-        let bounds: Vec<_> = self.param_env\n+        let bounds = self.param_env\n             .caller_bounds\n             .iter()\n             .filter_map(|predicate| {\n@@ -667,10 +668,9 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n                     ty::Predicate::TypeOutlives(..) |\n                     ty::Predicate::ConstEvaluatable(..) => None,\n                 }\n-            })\n-            .collect();\n+            });\n \n-        self.elaborate_bounds(&bounds, |this, poly_trait_ref, item| {\n+        self.elaborate_bounds(bounds, |this, poly_trait_ref, item| {\n             let trait_ref = this.erase_late_bound_regions(&poly_trait_ref);\n \n             let (xform_self_ty, xform_ret_ty) =\n@@ -693,15 +693,16 @@ impl<'a, 'gcx, 'tcx> ProbeContext<'a, 'gcx, 'tcx> {\n \n     // Do a search through a list of bounds, using a callback to actually\n     // create the candidates.\n-    fn elaborate_bounds<F>(&mut self, bounds: &[ty::PolyTraitRef<'tcx>], mut mk_cand: F)\n+    fn elaborate_bounds<F>(&mut self,\n+                           bounds: impl Iterator<Item = ty::PolyTraitRef<'tcx>>,\n+                           mut mk_cand: F)\n         where F: for<'b> FnMut(&mut ProbeContext<'b, 'gcx, 'tcx>,\n                                ty::PolyTraitRef<'tcx>,\n                                ty::AssociatedItem)\n     {\n-        debug!(\"elaborate_bounds(bounds={:?})\", bounds);\n-\n         let tcx = self.tcx;\n         for bound_trait_ref in traits::transitive_bounds(tcx, bounds) {\n+            debug!(\"elaborate_bounds(bound_trait_ref={:?})\", bound_trait_ref);\n             for item in self.impl_or_trait_item(bound_trait_ref.def_id()) {\n                 if !self.has_applicable_self(&item) {\n                     self.record_static_candidate(TraitSource(bound_trait_ref.def_id()));"}]}