{"sha": "3622fb645632fcf81af82919259be4b0012a3939", "node_id": "C_kwDOAAsO6NoAKDM2MjJmYjY0NTYzMmZjZjgxYWY4MjkxOTI1OWJlNGIwMDEyYTM5Mzk", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-03-20T20:24:53Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-03-25T13:14:12Z"}, "message": "Fix lints", "tree": {"sha": "9d1ec3af7e5c1e2e9bcb511b92fdbcc6bd5c56f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9d1ec3af7e5c1e2e9bcb511b92fdbcc6bd5c56f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3622fb645632fcf81af82919259be4b0012a3939", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3622fb645632fcf81af82919259be4b0012a3939", "html_url": "https://github.com/rust-lang/rust/commit/3622fb645632fcf81af82919259be4b0012a3939", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3622fb645632fcf81af82919259be4b0012a3939/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66636939a63237fb7a6d1198dd9f92514807621e", "url": "https://api.github.com/repos/rust-lang/rust/commits/66636939a63237fb7a6d1198dd9f92514807621e", "html_url": "https://github.com/rust-lang/rust/commit/66636939a63237fb7a6d1198dd9f92514807621e"}], "stats": {"total": 79, "additions": 37, "deletions": 42}, "files": [{"sha": "4ca6601a6aadb376df2595031e5dd702dc2568e4", "filename": "editors/code/src/client.ts", "status": "modified", "additions": 35, "deletions": 40, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/3622fb645632fcf81af82919259be4b0012a3939/editors%2Fcode%2Fsrc%2Fclient.ts", "raw_url": "https://github.com/rust-lang/rust/raw/3622fb645632fcf81af82919259be4b0012a3939/editors%2Fcode%2Fsrc%2Fclient.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fclient.ts?ref=3622fb645632fcf81af82919259be4b0012a3939", "patch": "@@ -121,59 +121,54 @@ export async function createClient(\n                 const preview = config.previewRustcOutput;\n                 const errorCode = config.useRustcErrorCode;\n                 diagnosticList.forEach((diag, idx) => {\n-                    let value =\n+                    const value =\n                         typeof diag.code === \"string\" || typeof diag.code === \"number\"\n                             ? diag.code\n                             : diag.code?.value;\n                     if (value === \"unlinked-file\" && !unlinkedFiles.includes(uri)) {\n-                        let config = vscode.workspace.getConfiguration(\"rust-analyzer\");\n+                        const config = vscode.workspace.getConfiguration(\"rust-analyzer\");\n                         if (config.get(\"showUnlinkedFileNotification\")) {\n                             unlinkedFiles.push(uri);\n-                            let folder = vscode.workspace.getWorkspaceFolder(uri)?.uri.fsPath;\n+                            const folder = vscode.workspace.getWorkspaceFolder(uri)?.uri.fsPath;\n                             if (folder) {\n-                                let parent_backslash = uri.fsPath.lastIndexOf(\n+                                const parentBackslash = uri.fsPath.lastIndexOf(\n                                     pathSeparator + \"src\"\n                                 );\n-                                let parent = uri.fsPath.substring(0, parent_backslash);\n+                                const parent = uri.fsPath.substring(0, parentBackslash);\n \n                                 if (parent.startsWith(folder)) {\n-                                    let path = vscode.Uri.file(\n+                                    const path = vscode.Uri.file(\n                                         parent + pathSeparator + \"Cargo.toml\"\n                                     );\n-                                    void vscode.workspace.fs.stat(path).then(() => {\n-                                        vscode.window\n-                                            .showInformationMessage(\n-                                                `This rust file does not belong to a loaded cargo project. It looks like it might belong to the workspace at ${path}, do you want to add it to the linked Projects?`,\n-                                                \"Yes\",\n-                                                \"No\",\n-                                                \"Don't show this again\"\n-                                            )\n-                                            .then((choice) => {\n-                                                switch (choice) {\n-                                                    case \"Yes\":\n-                                                        break;\n-                                                    case \"No\":\n-                                                        config.update(\n-                                                            \"linkedProjects\",\n-                                                            config\n-                                                                .get<any[]>(\"linkedProjects\")\n-                                                                ?.concat(\n-                                                                    path.fsPath.substring(\n-                                                                        folder!.length\n-                                                                    )\n-                                                                ),\n-                                                            false\n-                                                        );\n-                                                        break;\n-                                                    case \"Don't show this again\":\n-                                                        config.update(\n-                                                            \"showUnlinkedFileNotification\",\n-                                                            false,\n-                                                            false\n-                                                        );\n-                                                        break;\n-                                                }\n-                                            });\n+                                    void vscode.workspace.fs.stat(path).then(async () => {\n+                                        const choice = await vscode.window.showInformationMessage(\n+                                            `This rust file does not belong to a loaded cargo project. It looks like it might belong to the workspace at ${path}, do you want to add it to the linked Projects?`,\n+                                            \"Yes\",\n+                                            \"No\",\n+                                            \"Don't show this again\"\n+                                        );\n+                                        switch (choice) {\n+                                            case \"Yes\":\n+                                                break;\n+                                            case \"No\":\n+                                                await config.update(\n+                                                    \"linkedProjects\",\n+                                                    config\n+                                                        .get<any[]>(\"linkedProjects\")\n+                                                        ?.concat(\n+                                                            path.fsPath.substring(folder.length)\n+                                                        ),\n+                                                    false\n+                                                );\n+                                                break;\n+                                            case \"Don't show this again\":\n+                                                await config.update(\n+                                                    \"showUnlinkedFileNotification\",\n+                                                    false,\n+                                                    false\n+                                                );\n+                                                break;\n+                                        }\n                                     });\n                                 }\n                             }"}, {"sha": "8a0f4ea47732f99d732193623d88827d6ef0c043", "filename": "editors/code/src/ctx.ts", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3622fb645632fcf81af82919259be4b0012a3939/editors%2Fcode%2Fsrc%2Fctx.ts", "raw_url": "https://github.com/rust-lang/rust/raw/3622fb645632fcf81af82919259be4b0012a3939/editors%2Fcode%2Fsrc%2Fctx.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fctx.ts?ref=3622fb645632fcf81af82919259be4b0012a3939", "patch": "@@ -95,7 +95,6 @@ export class Ctx {\n     ) {\n         extCtx.subscriptions.push(this);\n         this.statusBar = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Left);\n-        this.statusBar.show();\n         this.workspace = workspace;\n         this.clientSubscriptions = [];\n         this.commandDisposables = [];\n@@ -338,6 +337,7 @@ export class Ctx {\n     setServerStatus(status: ServerStatusParams | { health: \"stopped\" }) {\n         let icon = \"\";\n         const statusBar = this.statusBar;\n+        statusBar.show();\n         statusBar.tooltip = new vscode.MarkdownString(\"\", true);\n         statusBar.tooltip.isTrusted = true;\n         switch (status.health) {\n@@ -386,7 +386,7 @@ export class Ctx {\n         );\n         statusBar.tooltip.appendMarkdown(\"\\n\\n[Open logs](command:rust-analyzer.openLogs)\");\n         statusBar.tooltip.appendMarkdown(\"\\n\\n[Restart server](command:rust-analyzer.startServer)\");\n-        statusBar.tooltip.appendMarkdown(\"[Stop server](command:rust-analyzer.stopServer)\");\n+        statusBar.tooltip.appendMarkdown(\"\\n\\n[Stop server](command:rust-analyzer.stopServer)\");\n         if (!status.quiescent) icon = \"$(sync~spin) \";\n         statusBar.text = `${icon}rust-analyzer`;\n     }"}]}