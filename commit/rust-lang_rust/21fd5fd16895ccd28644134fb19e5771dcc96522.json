{"sha": "21fd5fd16895ccd28644134fb19e5771dcc96522", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxZmQ1ZmQxNjg5NWNjZDI4NjQ0MTM0ZmIxOWU1NzcxZGNjOTY1MjI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-12-03T08:13:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-03T08:13:12Z"}, "message": "Merge pull request #561 from solson/rustup\n\nWe don't need no whitelist", "tree": {"sha": "0df9a855529237eddee60e14d2ab16c9abd42b44", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0df9a855529237eddee60e14d2ab16c9abd42b44"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21fd5fd16895ccd28644134fb19e5771dcc96522", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcBOWYCRBK7hj4Ov3rIwAAdHIIAB37eGAaXoxQV0cf33yHPjwR\nUriVpYCxphVlwTRsaJSZErBXetgs9aPc/nRN/m8i3fxZuQs98fWG3xbX4b0d4zsB\nxou9FpblfisKX7fA9GCpbFBhgHDDb23EjS1Di/m+iQZLO5FtFNOseTmWXlJCrWk+\n1jrNZxMPefSGFSlghCrKdM+TV+sBVK2lPvUtAkcG8NiYhpaIfHjfC0rutOX7LKdj\nlDHFDOxW91YOG0bx040q27QVjqtJHG2MybjJr5NMURljdpzRBwnSHwrmg5pd4Vrb\nTtmWfcGmvMvtRUaXiHFhaRmvaZJ6XBQvLoDYmtNyGYuAQVS1rIerFNIClIq69ss=\n=eBQy\n-----END PGP SIGNATURE-----\n", "payload": "tree 0df9a855529237eddee60e14d2ab16c9abd42b44\nparent c9bb212caecf2a4070bb060d3d3546ea1b6dc02a\nparent 6df89de68a21f538173fa833f5965ac4d5da7f23\nauthor Ralf Jung <post@ralfj.de> 1543824792 +0100\ncommitter GitHub <noreply@github.com> 1543824792 +0100\n\nMerge pull request #561 from solson/rustup\n\nWe don't need no whitelist"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21fd5fd16895ccd28644134fb19e5771dcc96522", "html_url": "https://github.com/rust-lang/rust/commit/21fd5fd16895ccd28644134fb19e5771dcc96522", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21fd5fd16895ccd28644134fb19e5771dcc96522/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9bb212caecf2a4070bb060d3d3546ea1b6dc02a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9bb212caecf2a4070bb060d3d3546ea1b6dc02a", "html_url": "https://github.com/rust-lang/rust/commit/c9bb212caecf2a4070bb060d3d3546ea1b6dc02a"}, {"sha": "6df89de68a21f538173fa833f5965ac4d5da7f23", "url": "https://api.github.com/repos/rust-lang/rust/commits/6df89de68a21f538173fa833f5965ac4d5da7f23", "html_url": "https://github.com/rust-lang/rust/commit/6df89de68a21f538173fa833f5965ac4d5da7f23"}], "stats": {"total": 21, "additions": 2, "deletions": 19}, "files": [{"sha": "ec4e621a24a91b503f288cec09c734cba5ab12eb", "filename": "src/lib.rs", "status": "modified", "additions": 2, "deletions": 19, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/21fd5fd16895ccd28644134fb19e5771dcc96522/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21fd5fd16895ccd28644134fb19e5771dcc96522/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=21fd5fd16895ccd28644134fb19e5771dcc96522", "patch": "@@ -310,26 +310,9 @@ impl<'a, 'mir, 'tcx> Machine<'a, 'mir, 'tcx> for Evaluator<'tcx> {\n \n     const STATIC_KIND: Option<MiriMemoryKind> = Some(MiriMemoryKind::MutStatic);\n \n+    #[inline(always)]\n     fn enforce_validity(ecx: &EvalContext<'a, 'mir, 'tcx, Self>) -> bool {\n-        if !ecx.machine.validate {\n-            return false;\n-        }\n-\n-        // Some functions are whitelisted until we figure out how to fix them.\n-        // We walk up the stack a few frames to also cover their callees.\n-        const WHITELIST: &[(&str, &str)] = &[\n-            // Uses mem::uninitialized\n-            (\"std::sys::windows::mutex::Mutex::\", \"\"),\n-        ];\n-        for frame in ecx.stack().iter()\n-            .rev().take(3)\n-        {\n-            let name = frame.instance.to_string();\n-            if WHITELIST.iter().any(|(prefix, suffix)| name.starts_with(prefix) && name.ends_with(suffix)) {\n-                return false;\n-            }\n-        }\n-        true\n+        ecx.machine.validate\n     }\n \n     /// Returns Ok() when the function was handled, fail otherwise"}]}