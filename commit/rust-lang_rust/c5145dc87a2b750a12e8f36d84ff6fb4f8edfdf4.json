{"sha": "c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4", "node_id": "C_kwDOAAsO6NoAKGM1MTQ1ZGM4N2EyYjc1MGExMmU4ZjM2ZDg0ZmY2ZmI0ZjhlZGZkZjQ", "commit": {"author": {"name": "Simon Farre", "email": "simon.farre.cx@gmail.com", "date": "2023-05-25T20:22:00Z"}, "committer": {"name": "Simon Farre", "email": "simon.farre.cx@gmail.com", "date": "2023-06-05T11:56:31Z"}, "message": "Fix #111961 r=Mark-Simulacrum\n\nMakes the Python pretty printer library source'able from within\nGDB after spawn.\n\nThis makes `rust-gdb` not the required approach. It also provides the possibility\nfor GUI:s that wrap GDB, to debug Rust using the pretty printer library; as well\nas other projects such as for instance Pernosco, which previously was not possible.\n\nThis won't introduce any new unexpected behaviors for users of `rust-gdb`", "tree": {"sha": "f971777d76cf4d1561abd1d8ee69cf9d3f7637d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f971777d76cf4d1561abd1d8ee69cf9d3f7637d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4", "html_url": "https://github.com/rust-lang/rust/commit/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4/comments", "author": {"login": "theIDinside", "id": 25328813, "node_id": "MDQ6VXNlcjI1MzI4ODEz", "avatar_url": "https://avatars.githubusercontent.com/u/25328813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theIDinside", "html_url": "https://github.com/theIDinside", "followers_url": "https://api.github.com/users/theIDinside/followers", "following_url": "https://api.github.com/users/theIDinside/following{/other_user}", "gists_url": "https://api.github.com/users/theIDinside/gists{/gist_id}", "starred_url": "https://api.github.com/users/theIDinside/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theIDinside/subscriptions", "organizations_url": "https://api.github.com/users/theIDinside/orgs", "repos_url": "https://api.github.com/users/theIDinside/repos", "events_url": "https://api.github.com/users/theIDinside/events{/privacy}", "received_events_url": "https://api.github.com/users/theIDinside/received_events", "type": "User", "site_admin": false}, "committer": {"login": "theIDinside", "id": 25328813, "node_id": "MDQ6VXNlcjI1MzI4ODEz", "avatar_url": "https://avatars.githubusercontent.com/u/25328813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theIDinside", "html_url": "https://github.com/theIDinside", "followers_url": "https://api.github.com/users/theIDinside/followers", "following_url": "https://api.github.com/users/theIDinside/following{/other_user}", "gists_url": "https://api.github.com/users/theIDinside/gists{/gist_id}", "starred_url": "https://api.github.com/users/theIDinside/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theIDinside/subscriptions", "organizations_url": "https://api.github.com/users/theIDinside/orgs", "repos_url": "https://api.github.com/users/theIDinside/repos", "events_url": "https://api.github.com/users/theIDinside/events{/privacy}", "received_events_url": "https://api.github.com/users/theIDinside/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cade26637fe1c23965ce644299ed5200db7c92dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/cade26637fe1c23965ce644299ed5200db7c92dd", "html_url": "https://github.com/rust-lang/rust/commit/cade26637fe1c23965ce644299ed5200db7c92dd"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "491b6ba9e9e695b0f70fab3bc0b221da1390d1e3", "filename": "src/etc/gdb_load_rust_pretty_printers.py", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4/src%2Fetc%2Fgdb_load_rust_pretty_printers.py", "raw_url": "https://github.com/rust-lang/rust/raw/c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4/src%2Fetc%2Fgdb_load_rust_pretty_printers.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_load_rust_pretty_printers.py?ref=c5145dc87a2b750a12e8f36d84ff6fb4f8edfdf4", "patch": "@@ -1,3 +1,14 @@\n+# Add this folder to the python sys path; GDB Python-interpreter will now find modules in this path\n+import sys\n+from os import path\n+self_dir = path.dirname(path.realpath(__file__))\n+sys.path.append(self_dir)\n+\n import gdb\n import gdb_lookup\n-gdb_lookup.register_printers(gdb.current_objfile())\n+\n+# current_objfile can be none; even with `gdb foo-app`; sourcing this file after gdb init now works\n+try:\n+    gdb_lookup.register_printers(gdb.current_objfile())\n+except Exception:\n+    gdb_lookup.register_printers(gdb.selected_inferior().progspace)"}]}