{"sha": "0438e6e924f09453dceff010bb4264568afa35a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0MzhlNmU5MjRmMDk0NTNkY2VmZjAxMGJiNDI2NDU2OGFmYTM1YTA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-15T19:52:43Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-15T19:52:43Z"}, "message": "bench: Add a test for task concurrency", "tree": {"sha": "9fa8f3c44b85f8ddd38c80b875e944c5547a0e47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fa8f3c44b85f8ddd38c80b875e944c5547a0e47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0438e6e924f09453dceff010bb4264568afa35a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0438e6e924f09453dceff010bb4264568afa35a0", "html_url": "https://github.com/rust-lang/rust/commit/0438e6e924f09453dceff010bb4264568afa35a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0438e6e924f09453dceff010bb4264568afa35a0/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1248c250d86af96a9c4f3ee1468d9dead10ac41b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1248c250d86af96a9c4f3ee1468d9dead10ac41b", "html_url": "https://github.com/rust-lang/rust/commit/1248c250d86af96a9c4f3ee1468d9dead10ac41b"}], "stats": {"total": 68, "additions": 68, "deletions": 0}, "files": [{"sha": "98eefbaf06f26d73d62286aecda34750c3ff710f", "filename": "src/test/bench/task-perf-one-million.rs", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/0438e6e924f09453dceff010bb4264568afa35a0/src%2Ftest%2Fbench%2Ftask-perf-one-million.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0438e6e924f09453dceff010bb4264568afa35a0/src%2Ftest%2Fbench%2Ftask-perf-one-million.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Ftask-perf-one-million.rs?ref=0438e6e924f09453dceff010bb4264568afa35a0", "patch": "@@ -0,0 +1,68 @@\n+// Test for concurrent tasks\n+\n+enum msg {\n+    ready(comm::chan<msg>),\n+    start,\n+    done(int),\n+}\n+\n+fn calc(children: uint, parent_ch: comm::chan<msg>) {\n+    let port = comm::port();\n+    let chan = comm::chan(port);\n+    let child_chs = [];\n+    let sum = 0;\n+\n+    iter::repeat (children) {||\n+        task::spawn {||\n+            calc(0u, chan);\n+        };\n+    }\n+\n+    iter::repeat (children) {||\n+        alt check comm::recv(port) {\n+          ready(child_ch) {\n+            child_chs += [child_ch];\n+          }\n+        }\n+    }\n+\n+    comm::send(parent_ch, ready(chan));\n+\n+    alt check comm::recv(port) {\n+        start {\n+          vec::iter (child_chs) { |child_ch|\n+              comm::send(child_ch, start);\n+          }\n+        }\n+    }\n+\n+    iter::repeat (children) {||\n+        alt check comm::recv(port) {\n+          done(child_sum) { sum += child_sum; }\n+        }\n+    }\n+\n+    comm::send(parent_ch, done(sum + 1));\n+}\n+\n+fn main(args: [str]) {\n+    let children = if vec::len(args) == 2u {\n+        uint::from_str(args[1])\n+    } else {\n+        100u\n+    };\n+    let port = comm::port();\n+    let chan = comm::chan(port);\n+    task::spawn {||\n+        calc(children, chan);\n+    };\n+    alt check comm::recv(port) {\n+      ready(chan) {\n+        comm::send(chan, start);\n+      }\n+    }\n+    let sum = alt check comm::recv(port) {\n+      done(sum) { sum }\n+    };\n+    #error(\"How many tasks? %d tasks.\", sum);\n+}\n\\ No newline at end of file"}]}