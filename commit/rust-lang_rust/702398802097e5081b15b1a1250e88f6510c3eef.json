{"sha": "702398802097e5081b15b1a1250e88f6510c3eef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwMjM5ODgwMjA5N2U1MDgxYjE1YjFhMTI1MGU4OGY2NTEwYzNlZWY=", "commit": {"author": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-06-29T20:37:10Z"}, "committer": {"name": "mcarton", "email": "cartonmartin+git@gmail.com", "date": "2016-07-01T15:12:48Z"}, "message": "Use `utils::sugg` in `TOPLEVEL_REF_ARG`", "tree": {"sha": "3365c2487d2a875e739d3e3c3a52403b4485dc21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3365c2487d2a875e739d3e3c3a52403b4485dc21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/702398802097e5081b15b1a1250e88f6510c3eef", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJXdohwAAoJEF5CfHlMukXoLqQP/0EginvK3c6iMUX+hYIpUng/\nkSauBXSJTDyW+9UYjESPoT/DGtSXunXrV3PjOWhlv0uKaVcWgcFLk9ZgqR4AqLb4\nqu71/uphlb479Ydl1J7qC2K/2mwiNa3GpY69GVswwG/Ug1T2ig5KNE3I2kAKBjOI\njVf0pnI/DGuxfvn/D33Eg4Q9OgqR0g0nmWOw60nlZCkP3GDTRs8dxc6rXwKxDPKO\nnlZwukyfsuQ9/XQIQW8HhXJ5bzOyv9XFZRKliKR/gnstfJk9SOCZGjp5N1p401Vb\nXlHUtONT6kWljue7QMZjhJyH15/PKUKlff+YoOGpIrANBAkZuTFAulh/EkEQi5CA\nBoHqLM6gSETScksODLCq9ZtGaNfaYVpd8WQ+wSC8f/h+66BkJYLmVkMAbNn6pW8n\nZ8JcCesUHjQe+B7ljYlnFuGsO3iUJOiNrik3tSuVF7KIn9hvQpe9LmFCe/IrDtii\nnRLB9P1fVc40RX2+LSpySEu1GJf8jUN/Z+67zqPbgtuPCeN2woTzRFpncPVCBJWB\n5X6F8QGL8qRd35c6QJF29GZEg/I1pCeSW3fsWUQEZm2MLxSH9opSWsU03EwKHP5j\nkrzm3x3ZYwOh9M3CCmFZSJsMldiPLnKafPHslDIqB1tFFgsqj6RUd9YsXY2k4LC2\n+tgo8wb+ZR+ZKKjZKjWR\n=AuCi\n-----END PGP SIGNATURE-----", "payload": "tree 3365c2487d2a875e739d3e3c3a52403b4485dc21\nparent a3c505551fc1d5ed4270357e6a616b01b45e9a7d\nauthor mcarton <cartonmartin+git@gmail.com> 1467232630 +0200\ncommitter mcarton <cartonmartin+git@gmail.com> 1467385968 +0200\n\nUse `utils::sugg` in `TOPLEVEL_REF_ARG`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/702398802097e5081b15b1a1250e88f6510c3eef", "html_url": "https://github.com/rust-lang/rust/commit/702398802097e5081b15b1a1250e88f6510c3eef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/702398802097e5081b15b1a1250e88f6510c3eef/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3c505551fc1d5ed4270357e6a616b01b45e9a7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3c505551fc1d5ed4270357e6a616b01b45e9a7d", "html_url": "https://github.com/rust-lang/rust/commit/a3c505551fc1d5ed4270357e6a616b01b45e9a7d"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "e5bfc3c34b1c3944a6f870843bdb2655202dc5e9", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/702398802097e5081b15b1a1250e88f6510c3eef/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/702398802097e5081b15b1a1250e88f6510c3eef/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=702398802097e5081b15b1a1250e88f6510c3eef", "patch": "@@ -72,12 +72,13 @@ impl LateLintPass for TopLevelRefPass {\n                 l.pat.span,\n                 \"`ref` on an entire `let` pattern is discouraged, take a reference with & instead\",\n                 |db| {\n+                    let init = &Sugg::hir(cx, init, \"..\");\n                     db.span_suggestion(s.span,\n                                        \"try\",\n-                                       format!(\"let {}{} = &{};\",\n+                                       format!(\"let {}{} = {};\",\n                                                snippet(cx, i.span, \"_\"),\n                                                tyopt,\n-                                               snippet(cx, init.span, \"_\")));\n+                                               init.addr()));\n                 }\n             );\n         }}"}, {"sha": "a28c00efcae57c6e1bc57e7fede99db3bfd8abb9", "filename": "clippy_lints/src/utils/sugg.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/702398802097e5081b15b1a1250e88f6510c3eef/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/702398802097e5081b15b1a1250e88f6510c3eef/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fsugg.rs?ref=702398802097e5081b15b1a1250e88f6510c3eef", "patch": "@@ -114,6 +114,11 @@ impl<'a> Sugg<'a> {\n     pub fn and(&self, rhs: &Self) -> Sugg<'static> {\n         make_binop(ast::BinOpKind::And, self, rhs)\n     }\n+\n+    /// Convenience method to create the `&<expr>` suggestion.\n+    pub fn addr(&self) -> Sugg<'static> {\n+        make_unop(\"&\", self)\n+    }\n }\n \n impl<'a, 'b> std::ops::Sub<&'b Sugg<'b>> for &'a Sugg<'a> {"}, {"sha": "b2240cffb1a6638058fec7b45ab7682d4cb21aed", "filename": "tests/compile-fail/toplevel_ref_arg.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/702398802097e5081b15b1a1250e88f6510c3eef/tests%2Fcompile-fail%2Ftoplevel_ref_arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/702398802097e5081b15b1a1250e88f6510c3eef/tests%2Fcompile-fail%2Ftoplevel_ref_arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Ftoplevel_ref_arg.rs?ref=702398802097e5081b15b1a1250e88f6510c3eef", "patch": "@@ -20,11 +20,16 @@ fn main() {\n   //~| HELP try\n   //~| SUGGESTION let x = &1;\n \n-  let ref y : (&_, u8) = (&1, 2);\n+  let ref y: (&_, u8) = (&1, 2);\n   //~^ ERROR `ref` on an entire `let` pattern is discouraged\n   //~| HELP try\n   //~| SUGGESTION let y: (&_, u8) = &(&1, 2);\n \n+  let ref z = 1 + 2;\n+  //~^ ERROR `ref` on an entire `let` pattern is discouraged\n+  //~| HELP try\n+  //~| SUGGESTION let z = &(1 + 2);\n+\n   let (ref x, _) = (1,2); // okay, not top level\n   println!(\"The answer is {}.\", x);\n }"}]}