{"sha": "472dfe74b32bfa855b70bf8ec59beddbd0514be1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3MmRmZTc0YjMyYmZhODU1YjcwYmY4ZWM1OWJlZGRiZDA1MTRiZTE=", "commit": {"author": {"name": "Brendan Zabarauskas", "email": "bjzaba@yahoo.com.au", "date": "2014-01-17T21:53:00Z"}, "committer": {"name": "Brendan Zabarauskas", "email": "bjzaba@yahoo.com.au", "date": "2014-01-17T22:12:53Z"}, "message": "Simplify std::num::Primitive trait definition\n\nThis removes the `Primitive::{bits, bytes, is_signed}` methods and removes the operator trait constraints, for the reasons outlined below:\n\n- The `Primitive::{bits, bytes}` associated functions were originally added to reflect the existing `BITS` and `BYTES` statics included in the numeric modules. These statics are only exist as a workaround for Rust's lack of CTFE, and should probably be deprecated in the future in favor of using the `std::mem::size_of` function (see #11621).\n\n- `Primitive::is_signed` seems to be of little utility and does not seem to be used anywhere in the Rust compiler or libraries. It is also rather ugly to call due to the `Option<Self>` workaround for #8888.\n\n- The operator trait constraints are already covered by the `Num` trait.", "tree": {"sha": "15c18502fdbf22fdf3a80bda2a8968aaa39ada5c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15c18502fdbf22fdf3a80bda2a8968aaa39ada5c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/472dfe74b32bfa855b70bf8ec59beddbd0514be1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/472dfe74b32bfa855b70bf8ec59beddbd0514be1", "html_url": "https://github.com/rust-lang/rust/commit/472dfe74b32bfa855b70bf8ec59beddbd0514be1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/472dfe74b32bfa855b70bf8ec59beddbd0514be1/comments", "author": {"login": "brendanzab", "id": 695077, "node_id": "MDQ6VXNlcjY5NTA3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/695077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brendanzab", "html_url": "https://github.com/brendanzab", "followers_url": "https://api.github.com/users/brendanzab/followers", "following_url": "https://api.github.com/users/brendanzab/following{/other_user}", "gists_url": "https://api.github.com/users/brendanzab/gists{/gist_id}", "starred_url": "https://api.github.com/users/brendanzab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brendanzab/subscriptions", "organizations_url": "https://api.github.com/users/brendanzab/orgs", "repos_url": "https://api.github.com/users/brendanzab/repos", "events_url": "https://api.github.com/users/brendanzab/events{/privacy}", "received_events_url": "https://api.github.com/users/brendanzab/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brendanzab", "id": 695077, "node_id": "MDQ6VXNlcjY5NTA3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/695077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brendanzab", "html_url": "https://github.com/brendanzab", "followers_url": "https://api.github.com/users/brendanzab/followers", "following_url": "https://api.github.com/users/brendanzab/following{/other_user}", "gists_url": "https://api.github.com/users/brendanzab/gists{/gist_id}", "starred_url": "https://api.github.com/users/brendanzab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brendanzab/subscriptions", "organizations_url": "https://api.github.com/users/brendanzab/orgs", "repos_url": "https://api.github.com/users/brendanzab/repos", "events_url": "https://api.github.com/users/brendanzab/events{/privacy}", "received_events_url": "https://api.github.com/users/brendanzab/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80a3f453db387d02dcb596745731031e7a8c9048", "url": "https://api.github.com/repos/rust-lang/rust/commits/80a3f453db387d02dcb596745731031e7a8c9048", "html_url": "https://github.com/rust-lang/rust/commit/80a3f453db387d02dcb596745731031e7a8c9048"}], "stats": {"total": 93, "additions": 9, "deletions": 84}, "files": [{"sha": "696862535628422525b93f61aad829495859744e", "filename": "src/libstd/num/f32.rs", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Ff32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Ff32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Ff32.rs?ref=472dfe74b32bfa855b70bf8ec59beddbd0514be1", "patch": "@@ -554,16 +554,7 @@ impl Bounded for f32 {\n     fn max_value() -> f32 { 3.40282347e+38 }\n }\n \n-impl Primitive for f32 {\n-    #[inline]\n-    fn bits(_: Option<f32>) -> uint { 32 }\n-\n-    #[inline]\n-    fn bytes(_: Option<f32>) -> uint { Primitive::bits(Some(0f32)) / 8 }\n-\n-    #[inline]\n-    fn is_signed(_: Option<f32>) -> bool { true }\n-}\n+impl Primitive for f32 {}\n \n impl Float for f32 {\n     #[inline]\n@@ -1173,13 +1164,6 @@ mod tests {\n         assert!(!NAN.is_negative());\n     }\n \n-    #[test]\n-    fn test_primitive() {\n-        let none: Option<f32> = None;\n-        assert_eq!(Primitive::bits(none), mem::size_of::<f32>() * 8);\n-        assert_eq!(Primitive::bytes(none), mem::size_of::<f32>());\n-    }\n-\n     #[test]\n     fn test_is_normal() {\n         let nan: f32 = Float::nan();"}, {"sha": "bdfb42b4b88dd2e7cce4beb53a8c551d9457a95b", "filename": "src/libstd/num/f64.rs", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Ff64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Ff64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Ff64.rs?ref=472dfe74b32bfa855b70bf8ec59beddbd0514be1", "patch": "@@ -556,16 +556,7 @@ impl Bounded for f64 {\n     fn max_value() -> f64 { 1.7976931348623157e+308 }\n }\n \n-impl Primitive for f64 {\n-    #[inline]\n-    fn bits(_: Option<f64>) -> uint { 64 }\n-\n-    #[inline]\n-    fn bytes(_: Option<f64>) -> uint { Primitive::bits(Some(0f64)) / 8 }\n-\n-    #[inline]\n-    fn is_signed(_: Option<f64>) -> bool { true }\n-}\n+impl Primitive for f64 {}\n \n impl Float for f64 {\n     #[inline]\n@@ -1178,13 +1169,6 @@ mod tests {\n         assert!(!NAN.is_negative());\n     }\n \n-    #[test]\n-    fn test_primitive() {\n-        let none: Option<f64> = None;\n-        assert_eq!(Primitive::bits(none), mem::size_of::<f64>() * 8);\n-        assert_eq!(Primitive::bytes(none), mem::size_of::<f64>());\n-    }\n-\n     #[test]\n     fn test_is_normal() {\n         let nan: f64 = Float::nan();"}, {"sha": "80bc24e2d62582eac0eb3cbcafa63dc061751335", "filename": "src/libstd/num/int_macros.rs", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Fint_macros.rs?ref=472dfe74b32bfa855b70bf8ec59beddbd0514be1", "patch": "@@ -361,16 +361,7 @@ impl Bounded for $T {\n \n impl Int for $T {}\n \n-impl Primitive for $T {\n-    #[inline]\n-    fn bits(_: Option<$T>) -> uint { bits }\n-\n-    #[inline]\n-    fn bytes(_: Option<$T>) -> uint { bits / 8 }\n-\n-    #[inline]\n-    fn is_signed(_: Option<$T>) -> bool { true }\n-}\n+impl Primitive for $T {}\n \n // String conversion functions and impl str -> num\n \n@@ -639,13 +630,6 @@ mod tests {\n         assert_eq!((0b010101 as $T).population_count(), 3);\n     }\n \n-    #[test]\n-    fn test_primitive() {\n-        let none: Option<$T> = None;\n-        assert_eq!(Primitive::bits(none), mem::size_of::<$T>() * 8);\n-        assert_eq!(Primitive::bytes(none), mem::size_of::<$T>());\n-    }\n-\n     #[test]\n     fn test_from_str() {\n         assert_eq!(from_str::<$T>(\"0\"), Some(0 as $T));"}, {"sha": "ab2604ee196bb90349728c50df58a0861199caee", "filename": "src/libstd/num/mod.rs", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Fmod.rs?ref=472dfe74b32bfa855b70bf8ec59beddbd0514be1", "patch": "@@ -17,6 +17,7 @@\n \n use clone::{Clone, DeepClone};\n use cmp::{Eq, Ord};\n+use mem::size_of;\n use ops::{Add, Sub, Mul, Div, Rem, Neg};\n use ops::{Not, BitAnd, BitOr, BitXor, Shl, Shr};\n use option::{Option, Some, None};\n@@ -381,19 +382,7 @@ pub trait Primitive: Clone\n                    + Num\n                    + NumCast\n                    + Orderable\n-                   + Bounded\n-                   + Neg<Self>\n-                   + Add<Self,Self>\n-                   + Sub<Self,Self>\n-                   + Mul<Self,Self>\n-                   + Div<Self,Self>\n-                   + Rem<Self,Self> {\n-    // FIXME (#5527): These should be associated constants\n-    // FIXME (#8888): Removing `unused_self` requires #8888 to be fixed.\n-    fn bits(unused_self: Option<Self>) -> uint;\n-    fn bytes(unused_self: Option<Self>) -> uint;\n-    fn is_signed(unused_self: Option<Self>) -> bool;\n-}\n+                   + Bounded {}\n \n /// A collection of traits relevant to primitive signed and unsigned integers\n pub trait Int: Integer\n@@ -536,7 +525,7 @@ pub trait ToPrimitive {\n macro_rules! impl_to_primitive_int_to_int(\n     ($SrcT:ty, $DstT:ty) => (\n         {\n-            if Primitive::bits(None::<$SrcT>) <= Primitive::bits(None::<$DstT>) {\n+            if size_of::<$SrcT>() <= size_of::<$DstT>() {\n                 Some(*self as $DstT)\n             } else {\n                 let n = *self as i64;\n@@ -621,7 +610,7 @@ macro_rules! impl_to_primitive_uint_to_int(\n macro_rules! impl_to_primitive_uint_to_uint(\n     ($SrcT:ty, $DstT:ty) => (\n         {\n-            if Primitive::bits(None::<$SrcT>) <= Primitive::bits(None::<$DstT>) {\n+            if size_of::<$SrcT>() <= size_of::<$DstT>() {\n                 Some(*self as $DstT)\n             } else {\n                 let zero: $SrcT = Zero::zero();\n@@ -677,7 +666,7 @@ impl_to_primitive_uint!(u64)\n \n macro_rules! impl_to_primitive_float_to_float(\n     ($SrcT:ty, $DstT:ty) => (\n-        if Primitive::bits(None::<$SrcT>) <= Primitive::bits(None::<$DstT>) {\n+        if size_of::<$SrcT>() <= size_of::<$DstT>() {\n             Some(*self as $DstT)\n         } else {\n             let n = *self as f64;"}, {"sha": "1b822a491c6f38c7da87984be3646c752727bdc8", "filename": "src/libstd/num/uint_macros.rs", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fuint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/472dfe74b32bfa855b70bf8ec59beddbd0514be1/src%2Flibstd%2Fnum%2Fuint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Fuint_macros.rs?ref=472dfe74b32bfa855b70bf8ec59beddbd0514be1", "patch": "@@ -285,16 +285,7 @@ impl ToStrRadix for $T {\n     }\n }\n \n-impl Primitive for $T {\n-    #[inline]\n-    fn bits(_: Option<$T>) -> uint { bits }\n-\n-    #[inline]\n-    fn bytes(_: Option<$T>) -> uint { bits / 8 }\n-\n-    #[inline]\n-    fn is_signed(_: Option<$T>) -> bool { false }\n-}\n+impl Primitive for $T {}\n \n impl Bitwise for $T {\n     /// Counts the number of bits set. Wraps LLVM's `ctpop` intrinsic.\n@@ -415,13 +406,6 @@ mod tests {\n         assert_eq!((0b010101 as $T).population_count(), 3);\n     }\n \n-    #[test]\n-    fn test_primitive() {\n-        let none: Option<$T> = None;\n-        assert_eq!(Primitive::bits(none), mem::size_of::<$T>() * 8);\n-        assert_eq!(Primitive::bytes(none), mem::size_of::<$T>());\n-    }\n-\n     #[test]\n     pub fn test_to_str() {\n         assert_eq!((0 as $T).to_str_radix(10u), ~\"0\");"}]}