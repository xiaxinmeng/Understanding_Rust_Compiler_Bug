{"sha": "fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjMWMyZjVmMWFhZDczZDU4NjczZmM2NDk1MmZjMTQ0ZTNlNTBiZjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-20T17:21:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-20T17:21:20Z"}, "message": "Auto merge of #4005 - phansch:rustfix_match_as_ref, r=flip1995\n\nAdd run-rustfix for match_as_ref lint\n\n* Extracts `match_as_ref` into separate file\n* Adds `// run-rustfix` to `tests/ui/match_as_ref.rs`\n\ncc #3630\n\nchangelog: none", "tree": {"sha": "cd15a12d0a420fbedde72de97ae935d9f30eb71e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd15a12d0a420fbedde72de97ae935d9f30eb71e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "html_url": "https://github.com/rust-lang/rust/commit/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a6d5c00d3fb4f5963c368f361a8c4af1d2d970c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a6d5c00d3fb4f5963c368f361a8c4af1d2d970c", "html_url": "https://github.com/rust-lang/rust/commit/7a6d5c00d3fb4f5963c368f361a8c4af1d2d970c"}, {"sha": "9a6c82094fb6d26084d641696873bb55f9e61cc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a6c82094fb6d26084d641696873bb55f9e61cc8", "html_url": "https://github.com/rust-lang/rust/commit/9a6c82094fb6d26084d641696873bb55f9e61cc8"}], "stats": {"total": 98, "additions": 60, "deletions": 38}, "files": [{"sha": "75085367f961f39d7945d80faeef0cf05f1adff2", "filename": "tests/ui/match_as_ref.fixed", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_as_ref.fixed?ref=fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "patch": "@@ -0,0 +1,14 @@\n+// run-rustfix\n+\n+#![allow(unused)]\n+#![warn(clippy::match_as_ref)]\n+\n+fn match_as_ref() {\n+    let owned: Option<()> = None;\n+    let borrowed: Option<&()> = owned.as_ref();\n+\n+    let mut mut_owned: Option<()> = None;\n+    let borrow_mut: Option<&mut ()> = mut_owned.as_mut();\n+}\n+\n+fn main() {}"}, {"sha": "62c06f352514156cec330fe4c1724115a2953cab", "filename": "tests/ui/match_as_ref.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_as_ref.rs?ref=fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "patch": "@@ -0,0 +1,20 @@\n+// run-rustfix\n+\n+#![allow(unused)]\n+#![warn(clippy::match_as_ref)]\n+\n+fn match_as_ref() {\n+    let owned: Option<()> = None;\n+    let borrowed: Option<&()> = match owned {\n+        None => None,\n+        Some(ref v) => Some(v),\n+    };\n+\n+    let mut mut_owned: Option<()> = None;\n+    let borrow_mut: Option<&mut ()> = match mut_owned {\n+        None => None,\n+        Some(ref mut v) => Some(v),\n+    };\n+}\n+\n+fn main() {}"}, {"sha": "09115b85d35b8563aea5a07c8760f5d7a30a54c7", "filename": "tests/ui/match_as_ref.stderr", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatch_as_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_as_ref.stderr?ref=fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "patch": "@@ -0,0 +1,24 @@\n+error: use as_ref() instead\n+  --> $DIR/match_as_ref.rs:8:33\n+   |\n+LL |       let borrowed: Option<&()> = match owned {\n+   |  _________________________________^\n+LL | |         None => None,\n+LL | |         Some(ref v) => Some(v),\n+LL | |     };\n+   | |_____^ help: try this: `owned.as_ref()`\n+   |\n+   = note: `-D clippy::match-as-ref` implied by `-D warnings`\n+\n+error: use as_mut() instead\n+  --> $DIR/match_as_ref.rs:14:39\n+   |\n+LL |       let borrow_mut: Option<&mut ()> = match mut_owned {\n+   |  _______________________________________^\n+LL | |         None => None,\n+LL | |         Some(ref mut v) => Some(v),\n+LL | |     };\n+   | |_____^ help: try this: `mut_owned.as_mut()`\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "0360cc739c8142298e5c0bade56ef42f2419aef5", "filename": "tests/ui/matches.rs", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatches.rs?ref=fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "patch": "@@ -136,20 +136,6 @@ fn match_wild_err_arm() {\n     }\n }\n \n-fn match_as_ref() {\n-    let owned: Option<()> = None;\n-    let borrowed: Option<&()> = match owned {\n-        None => None,\n-        Some(ref v) => Some(v),\n-    };\n-\n-    let mut mut_owned: Option<()> = None;\n-    let borrow_mut: Option<&mut ()> = match mut_owned {\n-        None => None,\n-        Some(ref mut v) => Some(v),\n-    };\n-}\n-\n macro_rules! foo_variant(\n     ($idx:expr) => (Foo::get($idx).unwrap())\n );"}, {"sha": "27438258d2325d024e73982c28ccf382c5eaa574", "filename": "tests/ui/matches.stderr", "status": "modified", "additions": 2, "deletions": 24, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatches.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fc1c2f5f1aad73d58673fc64952fc144e3e50bf7/tests%2Fui%2Fmatches.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatches.stderr?ref=fc1c2f5f1aad73d58673fc64952fc144e3e50bf7", "patch": "@@ -256,30 +256,8 @@ LL |         Ok(3) => println!(\"ok\"),\n    |                  ^^^^^^^^^^^^^^\n    = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n \n-error: use as_ref() instead\n-  --> $DIR/matches.rs:141:33\n-   |\n-LL |       let borrowed: Option<&()> = match owned {\n-   |  _________________________________^\n-LL | |         None => None,\n-LL | |         Some(ref v) => Some(v),\n-LL | |     };\n-   | |_____^ help: try this: `owned.as_ref()`\n-   |\n-   = note: `-D clippy::match-as-ref` implied by `-D warnings`\n-\n-error: use as_mut() instead\n-  --> $DIR/matches.rs:147:39\n-   |\n-LL |       let borrow_mut: Option<&mut ()> = match mut_owned {\n-   |  _______________________________________^\n-LL | |         None => None,\n-LL | |         Some(ref mut v) => Some(v),\n-LL | |     };\n-   | |_____^ help: try this: `mut_owned.as_mut()`\n-\n error: you don't need to add `&` to all patterns\n-  --> $DIR/matches.rs:174:5\n+  --> $DIR/matches.rs:160:5\n    |\n LL | /     match foo_variant!(0) {\n LL | |         &Foo::A => println!(\"A\"),\n@@ -292,5 +270,5 @@ LL |     match *foo_variant!(0) {\n LL |         Foo::A => println!(\"A\"),\n    |\n \n-error: aborting due to 20 previous errors\n+error: aborting due to 18 previous errors\n "}]}