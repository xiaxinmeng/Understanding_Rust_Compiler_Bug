{"sha": "5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkMjBlMWFhMDNjNmQ4NmZjZjkxOTdjY2VjMTZhZDVmYWE5NGJlZWU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-12T11:48:45Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-12T11:50:31Z"}, "message": "Improve lint level handling", "tree": {"sha": "5bf4b0065792b7671b9fb66aa906f8eae7076abc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5bf4b0065792b7671b9fb66aa906f8eae7076abc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "html_url": "https://github.com/rust-lang/rust/commit/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22465b35a608487773f960574a798262b23c4abd", "url": "https://api.github.com/repos/rust-lang/rust/commits/22465b35a608487773f960574a798262b23c4abd", "html_url": "https://github.com/rust-lang/rust/commit/22465b35a608487773f960574a798262b23c4abd"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "ced26fcf5b0e95b33dbf40d09d355fd120bafd23", "filename": "src/librustdoc/passes/calculate_doc_coverage.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs?ref=5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "patch": "@@ -254,8 +254,10 @@ impl<'a, 'b> fold::DocFolder for CoverageCalculator<'a, 'b> {\n                 let has_doc_example = tests.found_tests != 0;\n                 let hir_id = self.ctx.tcx.hir().local_def_id_to_hir_id(i.def_id.expect_local());\n                 let (level, source) = self.ctx.tcx.lint_level_at_node(MISSING_DOCS, hir_id);\n+                // `missing_docs` is allow-by-default, so don't treat this as ignoring the item\n+                // unless the user had an explicit `allow`\n                 let should_have_docs =\n-                    level != lint::Level::Allow || !matches!(source, LintSource::Node(..));\n+                    level != lint::Level::Allow || matches!(source, LintSource::Default);\n                 debug!(\"counting {:?} {:?} in {}\", i.type_(), i.name, i.source.filename);\n                 self.items.entry(i.source.filename.clone()).or_default().count_item(\n                     has_docs,"}, {"sha": "686ec51fb0604025705c86cd49b9c2d4e0cef5a5", "filename": "src/librustdoc/passes/doc_test_lints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d20e1aa03c6d86fcf9197ccec16ad5faa94beee/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs?ref=5d20e1aa03c6d86fcf9197ccec16ad5faa94beee", "patch": "@@ -76,7 +76,7 @@ pub fn should_have_doc_example(cx: &DocContext<'_>, item: &clean::Item) -> bool\n     let hir_id = cx.tcx.hir().local_def_id_to_hir_id(item.def_id.expect_local());\n     let (level, source) =\n         cx.tcx.lint_level_at_node(lint::builtin::MISSING_DOC_CODE_EXAMPLES, hir_id);\n-    level != lint::Level::Allow || !matches!(source, LintSource::Node(..))\n+    level != lint::Level::Allow || matches!(source, LintSource::Default)\n }\n \n pub fn look_for_tests<'tcx>(cx: &DocContext<'tcx>, dox: &str, item: &Item) {"}]}