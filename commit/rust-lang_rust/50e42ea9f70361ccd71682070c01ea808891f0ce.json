{"sha": "50e42ea9f70361ccd71682070c01ea808891f0ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwZTQyZWE5ZjcwMzYxY2NkNzE2ODIwNzBjMDFlYTgwODg5MWYwY2U=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-09-12T13:10:12Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-09-17T11:13:12Z"}, "message": "Correctly walk import lists in AST visitors", "tree": {"sha": "2cd554300fc90df2e2432f6384b86bb1b2f069da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2cd554300fc90df2e2432f6384b86bb1b2f069da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50e42ea9f70361ccd71682070c01ea808891f0ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50e42ea9f70361ccd71682070c01ea808891f0ce", "html_url": "https://github.com/rust-lang/rust/commit/50e42ea9f70361ccd71682070c01ea808891f0ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50e42ea9f70361ccd71682070c01ea808891f0ce/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3fc6e1858f6882bc9bd14641420bf3c4f7ee86b", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3fc6e1858f6882bc9bd14641420bf3c4f7ee86b", "html_url": "https://github.com/rust-lang/rust/commit/d3fc6e1858f6882bc9bd14641420bf3c4f7ee86b"}], "stats": {"total": 172, "additions": 122, "deletions": 50}, "files": [{"sha": "66de5d7bea84eab0cacb0571ffd32dc1dcc17d55", "filename": "src/liballoc/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Fliballoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Fliballoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Flib.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -100,7 +100,7 @@\n #![cfg_attr(stage0, feature(alloc_system))]\n #![cfg_attr(not(stage0), feature(needs_allocator))]\n \n-#![cfg_attr(test, feature(test, rustc_private))]\n+#![cfg_attr(test, feature(test, rustc_private, box_heap))]\n \n #[cfg(stage0)]\n extern crate alloc_system;"}, {"sha": "34bd1345fcb3b24bac59adea1ef5c4cb95cbb18c", "filename": "src/libcollections/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibcollections%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibcollections%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Flib.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -38,6 +38,8 @@\n #![feature(core_intrinsics)]\n #![feature(core_slice_ext)]\n #![feature(core_str_ext)]\n+#![feature(fmt_internals)]\n+#![feature(fmt_radix)]\n #![feature(heap_api)]\n #![feature(iter_order)]\n #![feature(iter_arith)]\n@@ -47,6 +49,8 @@\n #![feature(oom)]\n #![feature(pattern)]\n #![feature(ptr_as_ref)]\n+#![feature(ref_slice)]\n+#![feature(slice_bytes)]\n #![feature(slice_patterns)]\n #![feature(staged_api)]\n #![feature(step_by)]"}, {"sha": "23c21a732b5202085b2ed2b40181e1fea7a60457", "filename": "src/libcollections/str.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibcollections%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibcollections%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fstr.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -38,6 +38,7 @@ use slice::SliceConcatExt;\n use boxed::Box;\n \n pub use core::str::{FromStr, Utf8Error};\n+#[allow(deprecated)]\n pub use core::str::{Lines, LinesAny, CharRange};\n pub use core::str::{Split, RSplit};\n pub use core::str::{SplitN, RSplitN};"}, {"sha": "138acde64764dcea4e347b3afeda2a2bf27bfb1e", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -915,6 +915,11 @@ impl<'a, 'v> ast_visit::Visitor<'v> for EarlyContext<'a> {\n         ast_visit::walk_path(self, p);\n     }\n \n+    fn visit_path_list_item(&mut self, prefix: &hir::Path, item: &hir::PathListItem) {\n+        run_lints!(self, check_path_list_item, item);\n+        visit::walk_path_list_item(self, prefix, item);\n+    }\n+\n     fn visit_attribute(&mut self, attr: &ast::Attribute) {\n         run_lints!(self, check_attribute, early_passes, attr);\n     }"}, {"sha": "a1e7ffd3c7b14a4e7d2a2b0200bee6c3f85d90f5", "filename": "src/librustc/lint/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Flint%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Flint%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fmod.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -165,6 +165,7 @@ pub trait LateLintPass: LintPass {\n     // because then your lint will be called twice. Prefer check_ast_mac.\n     fn check_mac(&mut self, _: &LateContext, _: &ast::Mac) { }\n     fn check_path(&mut self, _: &LateContext, _: &hir::Path, _: ast::NodeId) { }\n+    fn check_path_list_item(&mut self, _: &LateContext, _: &hir::PathListItem) { }\n     fn check_attribute(&mut self, _: &LateContext, _: &ast::Attribute) { }\n \n     /// Called when entering a syntax node that can have lint attributes such\n@@ -211,6 +212,7 @@ pub trait EarlyLintPass: LintPass {\n     fn check_explicit_self(&mut self, _: &EarlyContext, _: &ast::ExplicitSelf) { }\n     fn check_mac(&mut self, _: &EarlyContext, _: &ast::Mac) { }\n     fn check_path(&mut self, _: &EarlyContext, _: &ast::Path, _: ast::NodeId) { }\n+    fn check_path_list_item(&mut self, _: &EarlyContext, _: &ast::PathListItem) { }\n     fn check_attribute(&mut self, _: &EarlyContext, _: &ast::Attribute) { }\n \n     /// Called when entering a syntax node that can have lint attributes such"}, {"sha": "e077d6d35c74f8e32f5c01f9bcc552563fe61c81", "filename": "src/librustc/middle/dead.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Fmiddle%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Fmiddle%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fdead.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -279,6 +279,11 @@ impl<'a, 'tcx, 'v> Visitor<'v> for MarkSymbolVisitor<'a, 'tcx> {\n         visit::walk_path(self, path);\n     }\n \n+    fn visit_path_list_item(&mut self, path: &hir::Path, item: &hir::PathListItem) {\n+        self.lookup_and_handle_definition(&item.node.id());\n+        visit::walk_path_list_item(self, path, item);\n+    }\n+\n     fn visit_item(&mut self, _: &hir::Item) {\n         // Do not recurse into items. These items will be added to the\n         // worklist and recursed into manually if necessary."}, {"sha": "c8ed90ec5d11b407aa93daf9c604c6cbf7599d4d", "filename": "src/librustc/middle/stability.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fstability.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -355,6 +355,12 @@ impl<'a, 'v, 'tcx> Visitor<'v> for Checker<'a, 'tcx> {\n         visit::walk_path(self, path)\n     }\n \n+    fn visit_path_list_item(&mut self, prefix: &hir::Path, item: &hir::PathListItem) {\n+        check_path_list_item(self.tcx, item,\n+                   &mut |id, sp, stab| self.check(id, sp, stab));\n+        visit::walk_path_list_item(self, prefix, item)\n+    }\n+\n     fn visit_pat(&mut self, pat: &hir::Pat) {\n         check_pat(self.tcx, pat,\n                   &mut |id, sp, stab| self.check(id, sp, stab));\n@@ -470,7 +476,17 @@ pub fn check_path(tcx: &ty::ctxt, path: &hir::Path, id: ast::NodeId,\n         }\n         None => {}\n     }\n+}\n \n+pub fn check_path_list_item(tcx: &ty::ctxt, item: &hir::PathListItem,\n+                  cb: &mut FnMut(DefId, Span, &Option<&Stability>)) {\n+    match tcx.def_map.borrow().get(&item.node.id()).map(|d| d.full_def()) {\n+        Some(def::DefPrimTy(..)) => {}\n+        Some(def) => {\n+            maybe_do_stability_check(tcx, def.def_id(), item.span, cb);\n+        }\n+        None => {}\n+    }\n }\n \n pub fn check_pat(tcx: &ty::ctxt, pat: &hir::Pat,"}, {"sha": "27d63d8a539af161d263a99821ad293e0279adaa", "filename": "src/librustc_back/svh.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_back%2Fsvh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_back%2Fsvh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Fsvh.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -423,6 +423,10 @@ mod svh_visitor {\n             SawPath.hash(self.st); visit::walk_path(self, path)\n         }\n \n+        fn visit_path_list_item(&mut self, prefix: &Path, item: &'v PathListItem) {\n+            SawPath.hash(self.st); visit::walk_path_list_item(self, prefix, item)\n+        }\n+\n         fn visit_block(&mut self, b: &Block) {\n             SawBlock.hash(self.st); visit::walk_block(self, b)\n         }"}, {"sha": "89c9818efbf011df9df577145d0317279753af4a", "filename": "src/librustc_front/visit.rs", "status": "modified", "additions": 21, "deletions": 12, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_front%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_front%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_front%2Fvisit.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -121,6 +121,9 @@ pub trait Visitor<'v> : Sized {\n     fn visit_path(&mut self, path: &'v Path, _id: NodeId) {\n         walk_path(self, path)\n     }\n+    fn visit_path_list_item(&mut self, prefix: &'v Path, item: &'v PathListItem) {\n+        walk_path_list_item(self, prefix, item)\n+    }\n     fn visit_path_segment(&mut self, path_span: Span, path_segment: &'v PathSegment) {\n         walk_path_segment(self, path_span, path_segment)\n     }\n@@ -203,26 +206,21 @@ pub fn walk_item<'v, V: Visitor<'v>>(visitor: &mut V, item: &'v Item) {\n         ItemExternCrate(..) => {}\n         ItemUse(ref vp) => {\n             match vp.node {\n-                ViewPathSimple(ident, ref path) => {\n-                    visitor.visit_ident(vp.span, ident);\n+                ViewPathSimple(_ident, ref path) => {\n                     visitor.visit_path(path, item.id);\n                 }\n                 ViewPathGlob(ref path) => {\n                     visitor.visit_path(path, item.id);\n                 }\n                 ViewPathList(ref prefix, ref list) => {\n-                    for id in list {\n-                        match id.node {\n-                            PathListIdent { name, .. } => {\n-                                visitor.visit_ident(id.span, name);\n-                            }\n-                            PathListMod { .. } => ()\n+                    if !list.is_empty() {\n+                        for item in list {\n+                            visitor.visit_path_list_item(prefix, item)\n                         }\n+                    } else {\n+                        // FIXME: uncomment this and fix the resulting ICE\n+                        // visitor.visit_path(prefix, item.id);\n                     }\n-\n-                    // Note that the `prefix` here is not a complete\n-                    // path, so we don't use `visit_path`.\n-                    walk_path(visitor, prefix);\n                 }\n             }\n         }\n@@ -400,6 +398,17 @@ pub fn walk_path<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v Path) {\n     }\n }\n \n+pub fn walk_path_list_item<'v, V: Visitor<'v>>(visitor: &mut V, prefix: &'v Path,\n+                                               item: &'v PathListItem) {\n+    for segment in &prefix.segments {\n+        visitor.visit_path_segment(prefix.span, segment);\n+    }\n+\n+    if let PathListIdent { name, .. } = item.node {\n+        visitor.visit_ident(item.span, name);\n+    }\n+}\n+\n pub fn walk_path_segment<'v, V: Visitor<'v>>(visitor: &mut V,\n                                              path_span: Span,\n                                              segment: &'v PathSegment) {"}, {"sha": "dc7de6b285331fa7fb3a168e15097ee0c80aa4d4", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -2173,6 +2173,13 @@ impl LateLintPass for Stability {\n                                           &stab.map(|s| hir_to_ast_stability(s)).as_ref()));\n     }\n \n+    fn check_path_list_item(&mut self, cx: &LateContext, item: &hir::PathListItem) {\n+        stability::check_path_list_item(cx.tcx, item,\n+                                         &mut |id, sp, stab|\n+                                           self.lint(cx, id, sp,\n+                                                &stab.map(|s| hir_to_ast_stability(s)).as_ref()));\n+    }\n+\n     fn check_pat(&mut self, cx: &LateContext, pat: &hir::Pat) {\n         stability::check_pat(cx.tcx, pat,\n                              &mut |id, sp, stab|"}, {"sha": "1a07877066e69d69b90f370433d6dcb8457c5efd", "filename": "src/librustc_privacy/lib.rs", "status": "modified", "additions": 10, "deletions": 17, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_privacy%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibrustc_privacy%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_privacy%2Flib.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -859,23 +859,6 @@ impl<'a, 'tcx> PrivacyVisitor<'a, 'tcx> {\n \n impl<'a, 'tcx, 'v> Visitor<'v> for PrivacyVisitor<'a, 'tcx> {\n     fn visit_item(&mut self, item: &hir::Item) {\n-        if let hir::ItemUse(ref vpath) = item.node {\n-            if let hir::ViewPathList(ref prefix, ref list) = vpath.node {\n-                for pid in list {\n-                    match pid.node {\n-                        hir::PathListIdent { id, name, .. } => {\n-                            debug!(\"privacy - ident item {}\", id);\n-                            self.check_path(pid.span, id, name.name);\n-                        }\n-                        hir::PathListMod { id, .. } => {\n-                            debug!(\"privacy - mod item {}\", id);\n-                            let name = prefix.segments.last().unwrap().identifier.name;\n-                            self.check_path(pid.span, id, name);\n-                        }\n-                    }\n-                }\n-            }\n-        }\n         let orig_curitem = replace(&mut self.curitem, item.id);\n         visit::walk_item(self, item);\n         self.curitem = orig_curitem;\n@@ -1000,6 +983,16 @@ impl<'a, 'tcx, 'v> Visitor<'v> for PrivacyVisitor<'a, 'tcx> {\n         self.check_path(path.span, id, path.segments.last().unwrap().identifier.name);\n         visit::walk_path(self, path);\n     }\n+\n+    fn visit_path_list_item(&mut self, prefix: &hir::Path, item: &hir::PathListItem) {\n+        let name = if let hir::PathListIdent { name, .. } = item.node {\n+            name.name\n+        } else {\n+            prefix.segments.last().unwrap().identifier.name\n+        };\n+        self.check_path(item.span, item.node.id(), name);\n+        visit::walk_path_list_item(self, prefix, item);\n+    }\n }\n \n ////////////////////////////////////////////////////////////////////////////////"}, {"sha": "6eabf5d69a2cd0f6426db5e1bbc503cb6f954c39", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -201,6 +201,7 @@\n \n #![feature(alloc)]\n #![feature(allow_internal_unstable)]\n+#![feature(arc_weak)]\n #![feature(associated_consts)]\n #![feature(borrow_state)]\n #![feature(box_syntax)]"}, {"sha": "2a2f5c0f2c16ef3f57e48d0d50bf78d62a70725e", "filename": "src/libsyntax/visit.rs", "status": "modified", "additions": 21, "deletions": 19, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Flibsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fvisit.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -127,6 +127,9 @@ pub trait Visitor<'v> : Sized {\n     fn visit_path(&mut self, path: &'v Path, _id: ast::NodeId) {\n         walk_path(self, path)\n     }\n+    fn visit_path_list_item(&mut self, prefix: &'v Path, item: &'v PathListItem) {\n+        walk_path_list_item(self, prefix, item)\n+    }\n     fn visit_path_segment(&mut self, path_span: Span, path_segment: &'v PathSegment) {\n         walk_path_segment(self, path_span, path_segment)\n     }\n@@ -209,33 +212,21 @@ pub fn walk_item<'v, V: Visitor<'v>>(visitor: &mut V, item: &'v Item) {\n         ItemExternCrate(..) => {}\n         ItemUse(ref vp) => {\n             match vp.node {\n-                ViewPathSimple(ident, ref path) => {\n-                    visitor.visit_ident(vp.span, ident);\n+                ViewPathSimple(_ident, ref path) => {\n                     visitor.visit_path(path, item.id);\n                 }\n                 ViewPathGlob(ref path) => {\n                     visitor.visit_path(path, item.id);\n                 }\n                 ViewPathList(ref prefix, ref list) => {\n-                    for id in list {\n-                        match id.node {\n-                            PathListIdent { name, rename, .. } => {\n-                                visitor.visit_ident(id.span, name);\n-                                if let Some(ident) = rename {\n-                                    visitor.visit_ident(id.span, ident);\n-                                }\n-                            }\n-                            PathListMod { rename, .. } => {\n-                                if let Some(ident) = rename {\n-                                    visitor.visit_ident(id.span, ident);\n-                                }\n-                            }\n+                    if !list.is_empty() {\n+                        for item in list {\n+                            visitor.visit_path_list_item(prefix, item)\n                         }\n+                    } else {\n+                        // FIXME: uncomment this and fix the resulting ICE\n+                        // visitor.visit_path(prefix, item.id);\n                     }\n-\n-                    // Note that the `prefix` here is not a complete\n-                    // path, so we don't use `visit_path`.\n-                    walk_path(visitor, prefix);\n                 }\n             }\n         }\n@@ -417,6 +408,17 @@ pub fn walk_path<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v Path) {\n     }\n }\n \n+pub fn walk_path_list_item<'v, V: Visitor<'v>>(visitor: &mut V, prefix: &'v Path,\n+                                               item: &'v PathListItem) {\n+    for segment in &prefix.segments {\n+        visitor.visit_path_segment(prefix.span, segment);\n+    }\n+\n+    if let PathListIdent { name, .. } = item.node {\n+        visitor.visit_ident(item.span, name);\n+    }\n+}\n+\n pub fn walk_path_segment<'v, V: Visitor<'v>>(visitor: &mut V,\n                                              path_span: Span,\n                                              segment: &'v PathSegment) {"}, {"sha": "74a241e819f313ff5773c94a09f96ca9d8f0cf0f", "filename": "src/test/compile-fail/issue-28075.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Ftest%2Fcompile-fail%2Fissue-28075.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Ftest%2Fcompile-fail%2Fissue-28075.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-28075.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Unstable entities should be caught in import lists\n+\n+#![allow(unused_imports)]\n+\n+use std::thread::{catch_panic, sleep}; //~ ERROR use of unstable library feature 'catch_panic'\n+//~^ ERROR use of unstable library feature 'thread_sleep'\n+\n+use std::rt::{self}; //~ ERROR use of unstable library feature 'rt'\n+use std::rt::{};\n+\n+fn main() {\n+}"}, {"sha": "3febacca73f25afff69f538881efa2fb25f70606", "filename": "src/test/compile-fail/lint-output-format.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Ftest%2Fcompile-fail%2Flint-output-format.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50e42ea9f70361ccd71682070c01ea808891f0ce/src%2Ftest%2Fcompile-fail%2Flint-output-format.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-output-format.rs?ref=50e42ea9f70361ccd71682070c01ea808891f0ce", "patch": "@@ -14,7 +14,8 @@\n #![feature(foo)] //~ ERROR unused or unknown feature\n \n extern crate lint_output_format; //~ ERROR use of unstable library feature\n-use lint_output_format::{foo, bar};\n+use lint_output_format::{foo, bar}; //~ ERROR use of unstable library feature\n+//~^ WARNING use of deprecated item,\n \n fn main() {\n     let _x = foo(); //~ WARNING #[warn(deprecated)] on by default"}]}