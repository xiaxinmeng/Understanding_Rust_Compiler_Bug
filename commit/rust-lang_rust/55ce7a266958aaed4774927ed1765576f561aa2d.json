{"sha": "55ce7a266958aaed4774927ed1765576f561aa2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1Y2U3YTI2Njk1OGFhZWQ0Nzc0OTI3ZWQxNzY1NTc2ZjU2MWFhMmQ=", "commit": {"author": {"name": "scalexm", "email": "alexandre@scalexm.fr", "date": "2018-10-13T15:10:56Z"}, "committer": {"name": "scalexm", "email": "alexandre@scalexm.fr", "date": "2018-10-17T12:12:46Z"}, "message": "Re-use memory in `program_clauses_for_env`", "tree": {"sha": "ce220ddc655a78264575163e9d4552040ad4c3ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce220ddc655a78264575163e9d4552040ad4c3ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55ce7a266958aaed4774927ed1765576f561aa2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55ce7a266958aaed4774927ed1765576f561aa2d", "html_url": "https://github.com/rust-lang/rust/commit/55ce7a266958aaed4774927ed1765576f561aa2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55ce7a266958aaed4774927ed1765576f561aa2d/comments", "author": {"login": "scalexm", "id": 1173131, "node_id": "MDQ6VXNlcjExNzMxMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1173131?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scalexm", "html_url": "https://github.com/scalexm", "followers_url": "https://api.github.com/users/scalexm/followers", "following_url": "https://api.github.com/users/scalexm/following{/other_user}", "gists_url": "https://api.github.com/users/scalexm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scalexm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scalexm/subscriptions", "organizations_url": "https://api.github.com/users/scalexm/orgs", "repos_url": "https://api.github.com/users/scalexm/repos", "events_url": "https://api.github.com/users/scalexm/events{/privacy}", "received_events_url": "https://api.github.com/users/scalexm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scalexm", "id": 1173131, "node_id": "MDQ6VXNlcjExNzMxMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1173131?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scalexm", "html_url": "https://github.com/scalexm", "followers_url": "https://api.github.com/users/scalexm/followers", "following_url": "https://api.github.com/users/scalexm/following{/other_user}", "gists_url": "https://api.github.com/users/scalexm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scalexm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scalexm/subscriptions", "organizations_url": "https://api.github.com/users/scalexm/orgs", "repos_url": "https://api.github.com/users/scalexm/repos", "events_url": "https://api.github.com/users/scalexm/events{/privacy}", "received_events_url": "https://api.github.com/users/scalexm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ec8269d0aead891c25a20b4e4c4cc5d73eccf79", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ec8269d0aead891c25a20b4e4c4cc5d73eccf79", "html_url": "https://github.com/rust-lang/rust/commit/7ec8269d0aead891c25a20b4e4c4cc5d73eccf79"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "43448ad0d15ad21a4e470127dc9d143fd4cd2e06", "filename": "src/librustc/ich/impls_ty.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/55ce7a266958aaed4774927ed1765576f561aa2d/src%2Flibrustc%2Fich%2Fimpls_ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55ce7a266958aaed4774927ed1765576f561aa2d/src%2Flibrustc%2Fich%2Fimpls_ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fich%2Fimpls_ty.rs?ref=55ce7a266958aaed4774927ed1765576f561aa2d", "patch": "@@ -1424,15 +1424,12 @@ impl_stable_hash_for!(enum traits::QuantifierKind {\n     Existential\n });\n \n-<<<<<<< HEAD\n impl_stable_hash_for!(struct ty::subst::UserSubsts<'tcx> { substs, user_self_ty });\n \n impl_stable_hash_for!(struct ty::subst::UserSelfTy<'tcx> { impl_def_id, self_ty });\n \n-=======\n impl_stable_hash_for!(\n     impl<'tcx> for struct traits::Environment<'tcx> {\n         clauses,\n     }\n );\n->>>>>>> Use `Environment` instead of `ty::ParamEnv` in chalk context"}, {"sha": "3d1e7cf17a65964895156da7accbf923acd542ed", "filename": "src/librustc_traits/lowering/environment.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/55ce7a266958aaed4774927ed1765576f561aa2d/src%2Flibrustc_traits%2Flowering%2Fenvironment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55ce7a266958aaed4774927ed1765576f561aa2d/src%2Flibrustc_traits%2Flowering%2Fenvironment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_traits%2Flowering%2Fenvironment.rs?ref=55ce7a266958aaed4774927ed1765576f561aa2d", "patch": "@@ -21,7 +21,7 @@ use rustc::ty::{self, TyCtxt, Ty};\n use rustc::hir::def_id::DefId;\n use rustc_data_structures::fx::FxHashSet;\n \n-struct ClauseVisitor<'set, 'a, 'tcx: 'a> {\n+struct ClauseVisitor<'set, 'a, 'tcx: 'a + 'set> {\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     round: &'set mut FxHashSet<Clause<'tcx>>,\n }\n@@ -154,12 +154,12 @@ crate fn program_clauses_for_env<'a, 'tcx>(\n     let mut next_round = FxHashSet();\n     while !last_round.is_empty() {\n         let mut visitor = ClauseVisitor::new(tcx, &mut next_round);\n-        for clause in last_round {\n+        for clause in last_round.drain() {\n             visitor.visit_clause(clause);\n         }\n-        last_round = next_round.drain()\n-            .filter(|&clause| closure.insert(clause))\n-            .collect();\n+        last_round.extend(\n+            next_round.drain().filter(|&clause| closure.insert(clause))\n+        );\n     }\n \n     debug!(\"program_clauses_for_env: closure = {:#?}\", closure);"}]}