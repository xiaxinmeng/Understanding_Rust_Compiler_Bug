{"sha": "825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyNTIwN2RkMmVkMmZjZjFmOWViNDM5ZjcyZmE1ZmFlMWU4ODg0N2I=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-10-22T21:35:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-22T21:35:32Z"}, "message": "Merge pull request #3126 from topecongiro/issue-3117\n\nUse correct width when formatting type on local statement", "tree": {"sha": "281d0231d4001ea068299235e2ad70134dbddbb6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/281d0231d4001ea068299235e2ad70134dbddbb6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbzkKkCRBK7hj4Ov3rIwAAdHIIAB/xfIGoyBNXeHNWuth8UePq\nwV0JzEUZoWw6UfVVSwIwPz/1UVcVDoXh+OeTi/pIwkE1N0ayjSNjE801aCMLv2GI\netV9pNZe3TtUDN7pZuxSNsyb+5Fv/M1+O4OYAIsEHCucpctMGhqf3bv21KWxWsAN\nQbMF9J9IGHgdye2Ebn5hHiwshgzrZu5Rycx5DrQjqtubgaafYba8t9oe3E8XosUa\nxiEgS2EQKVQJLP3z69rMo9gutSvfyK1XLV6qJM1X6/ZCflqZLt+zpeXatwNQodFa\nELh0KlTa8vjrxofOMgsB6aTCEHUznP/iBs3jXYj5l3M/XGKvcAmWsAa/EAqkMsQ=\n=VK2U\n-----END PGP SIGNATURE-----\n", "payload": "tree 281d0231d4001ea068299235e2ad70134dbddbb6\nparent a8d687499eda40f23d96d26c7ee63d28e82b0d06\nparent 086c1834479b3c437b36a975d1ef54dcd9b58b2a\nauthor Nick Cameron <nrc@ncameron.org> 1540244132 +1300\ncommitter GitHub <noreply@github.com> 1540244132 +1300\n\nMerge pull request #3126 from topecongiro/issue-3117\n\nUse correct width when formatting type on local statement "}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "html_url": "https://github.com/rust-lang/rust/commit/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8d687499eda40f23d96d26c7ee63d28e82b0d06", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8d687499eda40f23d96d26c7ee63d28e82b0d06", "html_url": "https://github.com/rust-lang/rust/commit/a8d687499eda40f23d96d26c7ee63d28e82b0d06"}, {"sha": "086c1834479b3c437b36a975d1ef54dcd9b58b2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/086c1834479b3c437b36a975d1ef54dcd9b58b2a", "html_url": "https://github.com/rust-lang/rust/commit/086c1834479b3c437b36a975d1ef54dcd9b58b2a"}], "stats": {"total": 58, "additions": 54, "deletions": 4}, "files": [{"sha": "66fdaf50e5aaa00add34da5f0f2d488aea395095", "filename": "src/items.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "patch": "@@ -94,10 +94,16 @@ impl Rewrite for ast::Local {\n \n             if let Some(ref ty) = self.ty {\n                 let separator = type_annotation_separator(context.config);\n-                let indent = shape.indent + last_line_width(&result) + separator.len();\n-                // 1 = ;\n-                let budget = shape.width.checked_sub(indent.width() + 1)?;\n-                let rewrite = ty.rewrite(context, Shape::legacy(budget, indent))?;\n+                let ty_shape = if pat_str.contains('\\n') {\n+                    shape.with_max_width(context.config)\n+                } else {\n+                    shape\n+                }\n+                .offset_left(last_line_width(&result) + separator.len())?\n+                // 2 = ` =`\n+                .sub_width(2)?;\n+\n+                let rewrite = ty.rewrite(context, ty_shape)?;\n \n                 infix.push_str(separator);\n                 infix.push_str(&rewrite);"}, {"sha": "b622d4363f53de91124fb8907a082d6d4953d574", "filename": "tests/source/type.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/tests%2Fsource%2Ftype.rs", "raw_url": "https://github.com/rust-lang/rust/raw/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/tests%2Fsource%2Ftype.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ftype.rs?ref=825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "patch": "@@ -91,3 +91,25 @@ macro_rules! foo {\n }\n \n type Target = ( FooAPI ) + 'static;\n+\n+// #3117\n+fn issue3117() {\n+    {\n+        {\n+            {\n+                {\n+                    {\n+                        {\n+                            {\n+                                {\n+                                    let opt: &mut Option<MyLongTypeHere> =\n+                                        unsafe { &mut *self.future.get() };\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "d2c09cc354ad7307aaedc81ebb2a6f5daac59a91", "filename": "tests/target/type.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/tests%2Ftarget%2Ftype.rs", "raw_url": "https://github.com/rust-lang/rust/raw/825207dd2ed2fcf1f9eb439f72fa5fae1e88847b/tests%2Ftarget%2Ftype.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftype.rs?ref=825207dd2ed2fcf1f9eb439f72fa5fae1e88847b", "patch": "@@ -90,3 +90,25 @@ macro_rules! foo {\n }\n \n type Target = (FooAPI) + 'static;\n+\n+// #3117\n+fn issue3117() {\n+    {\n+        {\n+            {\n+                {\n+                    {\n+                        {\n+                            {\n+                                {\n+                                    let opt: &mut Option<MyLongTypeHere> =\n+                                        unsafe { &mut *self.future.get() };\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}]}