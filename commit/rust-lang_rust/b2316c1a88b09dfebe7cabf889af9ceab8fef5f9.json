{"sha": "b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "node_id": "C_kwDOAAsO6NoAKGIyMzE2YzFhODhiMDlkZmViZTdjYWJmODg5YWY5Y2VhYjhmZWY1Zjk", "commit": {"author": {"name": "Collin Baker", "email": "collinbaker@chromium.org", "date": "2022-04-27T21:11:14Z"}, "committer": {"name": "Collin Baker", "email": "collinbaker@chromium.org", "date": "2022-05-10T14:29:48Z"}, "message": "Add test skip support\n\nlibtest already supports a \"--skip SUBSTRING\" arg which excludes any\ntest names matching SUBSTRING.\n\nThis adds a \"--skip\" argument to compiletest and bootstrap which is\nforwarded to libtest.", "tree": {"sha": "f16125baa6e9521cdc3587963a9945ced31c0c10", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f16125baa6e9521cdc3587963a9945ced31c0c10"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "html_url": "https://github.com/rust-lang/rust/commit/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/comments", "author": {"login": "chbaker0", "id": 6291976, "node_id": "MDQ6VXNlcjYyOTE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6291976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chbaker0", "html_url": "https://github.com/chbaker0", "followers_url": "https://api.github.com/users/chbaker0/followers", "following_url": "https://api.github.com/users/chbaker0/following{/other_user}", "gists_url": "https://api.github.com/users/chbaker0/gists{/gist_id}", "starred_url": "https://api.github.com/users/chbaker0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chbaker0/subscriptions", "organizations_url": "https://api.github.com/users/chbaker0/orgs", "repos_url": "https://api.github.com/users/chbaker0/repos", "events_url": "https://api.github.com/users/chbaker0/events{/privacy}", "received_events_url": "https://api.github.com/users/chbaker0/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chbaker0", "id": 6291976, "node_id": "MDQ6VXNlcjYyOTE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6291976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chbaker0", "html_url": "https://github.com/chbaker0", "followers_url": "https://api.github.com/users/chbaker0/followers", "following_url": "https://api.github.com/users/chbaker0/following{/other_user}", "gists_url": "https://api.github.com/users/chbaker0/gists{/gist_id}", "starred_url": "https://api.github.com/users/chbaker0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chbaker0/subscriptions", "organizations_url": "https://api.github.com/users/chbaker0/orgs", "repos_url": "https://api.github.com/users/chbaker0/repos", "events_url": "https://api.github.com/users/chbaker0/events{/privacy}", "received_events_url": "https://api.github.com/users/chbaker0/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e013f9e0ca4055930f931a30171c355de42f9f92", "url": "https://api.github.com/repos/rust-lang/rust/commits/e013f9e0ca4055930f931a30171c355de42f9f92", "html_url": "https://github.com/rust-lang/rust/commit/e013f9e0ca4055930f931a30171c355de42f9f92"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "b3ccba2e48d6da13e1ae4fd25a5161a147fbac03", "filename": "src/bootstrap/builder/tests.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Fbootstrap%2Fbuilder%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Fbootstrap%2Fbuilder%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder%2Ftests.rs?ref=b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "patch": "@@ -495,6 +495,7 @@ mod dist {\n         config.stage = 0;\n         config.cmd = Subcommand::Test {\n             paths: vec![\"library/std\".into()],\n+            skip: vec![],\n             test_args: vec![],\n             rustc_args: vec![],\n             fail_fast: true,\n@@ -565,6 +566,7 @@ mod dist {\n         let mut config = configure(&[\"A\"], &[\"A\"]);\n         config.cmd = Subcommand::Test {\n             paths: vec![],\n+            skip: vec![],\n             test_args: vec![],\n             rustc_args: vec![],\n             fail_fast: true,"}, {"sha": "4cd835ade6421128f0efe6d463c2f092bf65442b", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "patch": "@@ -111,6 +111,7 @@ pub enum Subcommand {\n         compare_mode: Option<String>,\n         pass: Option<String>,\n         run: Option<String>,\n+        skip: Vec<String>,\n         test_args: Vec<String>,\n         rustc_args: Vec<String>,\n         fail_fast: bool,\n@@ -261,6 +262,7 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\",\n         match subcommand {\n             Kind::Test => {\n                 opts.optflag(\"\", \"no-fail-fast\", \"Run all tests regardless of failure\");\n+                opts.optmulti(\"\", \"skip\", \"skips tests matching SUBSTRING, if supported by test tool. May be passed multiple times\", \"SUBSTRING\");\n                 opts.optmulti(\n                     \"\",\n                     \"test-args\",\n@@ -545,6 +547,7 @@ Arguments:\n                 compare_mode: matches.opt_str(\"compare-mode\"),\n                 pass: matches.opt_str(\"pass\"),\n                 run: matches.opt_str(\"run\"),\n+                skip: matches.opt_strs(\"skip\"),\n                 test_args: matches.opt_strs(\"test-args\"),\n                 rustc_args: matches.opt_strs(\"rustc-args\"),\n                 fail_fast: !matches.opt_present(\"no-fail-fast\"),\n@@ -689,12 +692,26 @@ impl Subcommand {\n     }\n \n     pub fn test_args(&self) -> Vec<&str> {\n+        let mut args = vec![];\n+\n+        match *self {\n+            Subcommand::Test { ref skip, .. } => {\n+                for s in skip {\n+                    args.push(\"--skip\");\n+                    args.push(s.as_str());\n+                }\n+            }\n+            _ => (),\n+        };\n+\n         match *self {\n             Subcommand::Test { ref test_args, .. } | Subcommand::Bench { ref test_args, .. } => {\n-                test_args.iter().flat_map(|s| s.split_whitespace()).collect()\n+                args.extend(test_args.iter().flat_map(|s| s.split_whitespace()))\n             }\n-            _ => Vec::new(),\n+            _ => (),\n         }\n+\n+        args\n     }\n \n     pub fn rustc_args(&self) -> Vec<&str> {"}, {"sha": "ea13ae13208ada66dc0008bbc38845d3a7dbc607", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "patch": "@@ -246,6 +246,10 @@ pub struct Config {\n     /// Only run tests that match these filters\n     pub filters: Vec<String>,\n \n+    /// Skip tests tests matching these substrings. Corresponds to\n+    /// `test::TestOpts::skip`. `filter_exact` does not apply to these flags.\n+    pub skip: Vec<String>,\n+\n     /// Exactly match the filter, rather than a substring\n     pub filter_exact: bool,\n "}, {"sha": "e23cccf6cd1294320f0aa9ead725fb2e1318fe89", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2316c1a88b09dfebe7cabf889af9ceab8fef5f9/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=b2316c1a88b09dfebe7cabf889af9ceab8fef5f9", "patch": "@@ -91,6 +91,7 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         )\n         .optopt(\"\", \"run\", \"whether to execute run-* tests\", \"auto | always | never\")\n         .optflag(\"\", \"ignored\", \"run tests marked as ignored\")\n+        .optmulti(\"\", \"skip\", \"skip tests matching SUBSTRING. Can be passed multiple times\", \"SUBSTRING\")\n         .optflag(\"\", \"exact\", \"filters match exactly\")\n         .optopt(\n             \"\",\n@@ -236,6 +237,7 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         debugger: None,\n         run_ignored,\n         filters: matches.free.clone(),\n+        skip: matches.opt_strs(\"skip\"),\n         filter_exact: matches.opt_present(\"exact\"),\n         force_pass_mode: matches.opt_str(\"pass\").map(|mode| {\n             mode.parse::<PassMode>()\n@@ -312,6 +314,7 @@ pub fn log_config(config: &Config) {\n     logv(c, format!(\"mode: {}\", config.mode));\n     logv(c, format!(\"run_ignored: {}\", config.run_ignored));\n     logv(c, format!(\"filters: {:?}\", config.filters));\n+    logv(c, format!(\"skip: {:?}\", config.skip));\n     logv(c, format!(\"filter_exact: {}\", config.filter_exact));\n     logv(\n         c,\n@@ -506,7 +509,7 @@ pub fn test_opts(config: &Config) -> test::TestOpts {\n         shuffle: false,\n         shuffle_seed: None,\n         test_threads: None,\n-        skip: vec![],\n+        skip: config.skip.clone(),\n         list: false,\n         options: test::Options::new(),\n         time_options: None,\n@@ -595,6 +598,7 @@ fn collect_tests_from_dir(\n             debug!(\"found test file: {:?}\", file_path.display());\n             let paths =\n                 TestPaths { file: file_path, relative_dir: relative_dir_path.to_path_buf() };\n+\n             tests.extend(make_test(config, &paths, inputs))\n         } else if file_path.is_dir() {\n             let relative_file_path = relative_dir_path.join(file.file_name());"}]}