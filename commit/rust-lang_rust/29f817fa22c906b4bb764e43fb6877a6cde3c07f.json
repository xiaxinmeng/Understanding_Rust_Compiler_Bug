{"sha": "29f817fa22c906b4bb764e43fb6877a6cde3c07f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5ZjgxN2ZhMjJjOTA2YjRiYjc2NGU0M2ZiNjg3N2E2Y2RlM2MwN2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-11T07:15:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-11T07:15:46Z"}, "message": "auto merge of #17139 : brson/rust/lualatex, r=alexcrichton\n\nBugs in pdflatex (#12804) are preventing the guide from landing (https://github.com/rust-lang/rust/pull/16657). This solves the immediate problem by changing the build system to prefer lualatex, xelatex to pdflatex (which is apparently obsolete). Because the xelatex on the snapshot bot seems to completely ignore the `-output-directory` option, I also had to frob the makefiles a bit for that case.", "tree": {"sha": "8b70b7785f301dc030fb94db98feae217827fac4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b70b7785f301dc030fb94db98feae217827fac4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29f817fa22c906b4bb764e43fb6877a6cde3c07f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29f817fa22c906b4bb764e43fb6877a6cde3c07f", "html_url": "https://github.com/rust-lang/rust/commit/29f817fa22c906b4bb764e43fb6877a6cde3c07f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29f817fa22c906b4bb764e43fb6877a6cde3c07f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f4117f5182249d91c52cc3e384e4577356e1634", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f4117f5182249d91c52cc3e384e4577356e1634", "html_url": "https://github.com/rust-lang/rust/commit/1f4117f5182249d91c52cc3e384e4577356e1634"}, {"sha": "7864243380254fdd93435ef076f78d960f403a82", "url": "https://api.github.com/repos/rust-lang/rust/commits/7864243380254fdd93435ef076f78d960f403a82", "html_url": "https://github.com/rust-lang/rust/commit/7864243380254fdd93435ef076f78d960f403a82"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "db0de4bde5b8a20df66618aaa4c3ca3435cf2dfb", "filename": "mk/docs.mk", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/29f817fa22c906b4bb764e43fb6877a6cde3c07f/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/29f817fa22c906b4bb764e43fb6877a6cde3c07f/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=29f817fa22c906b4bb764e43fb6877a6cde3c07f", "patch": "@@ -76,21 +76,22 @@ endif\n \n # Check for the various external utilities for the EPUB/PDF docs:\n \n-ifeq ($(CFG_PDFLATEX),)\n-  $(info cfg: no pdflatex found, deferring to xelatex)\n+ifeq ($(CFG_LUALATEX),)\n+  $(info cfg: no lualatex found, deferring to xelatex)\n   ifeq ($(CFG_XELATEX),)\n-    $(info cfg: no xelatex found, deferring to lualatex)\n-    ifeq ($(CFG_LUALATEX),)\n-      $(info cfg: no lualatex found, disabling LaTeX docs)\n+    $(info cfg: no xelatex found, deferring to pdflatex)\n+    ifeq ($(CFG_PDFLATEX),)\n+      $(info cfg: no pdflatex found, disabling LaTeX docs)\n       NO_PDF_DOCS = 1\n \telse\n-      CFG_LATEX := $(CFG_LUALATEX)\n+      CFG_LATEX := $(CFG_PDFLATEX)\n     endif\n   else\n     CFG_LATEX := $(CFG_XELATEX)\n+    XELATEX = 1\n   endif\n else\n-  CFG_LATEX := $(CFG_PDFLATEX)\n+  CFG_LATEX := $(CFG_LUALATEX)\n endif\n \n \n@@ -187,12 +188,25 @@ doc/$(1).tex: $$(D)/$(1).md doc/footer.tex doc/version.tex | doc/\n ifneq ($(NO_PDF_DOCS),1)\n ifeq ($$(SHOULD_BUILD_PDF_DOC_$(1)),1)\n DOC_TARGETS += doc/$(1).pdf\n+ifneq ($(XELATEX),1)\n doc/$(1).pdf: doc/$(1).tex\n \t@$$(call E, latex compiler: $$@)\n \t$$(Q)$$(CFG_LATEX) \\\n \t-interaction=batchmode \\\n \t-output-directory=doc \\\n \t$$<\n+else\n+# The version of xelatex on the snap bots seemingly ingores -output-directory\n+# So we'll output to . and move to the doc directory manually.\n+# This will leave some intermediate files in the build directory.\n+doc/$(1).pdf: doc/$(1).tex\n+\t@$$(call E, latex compiler: $$@)\n+\t$$(Q)$$(CFG_LATEX) \\\n+\t-interaction=batchmode \\\n+\t-output-directory=. \\\n+\t$$<\n+\t$$(Q)mv ./$(1).pdf $$@\n+endif # XELATEX\n endif # SHOULD_BUILD_PDF_DOCS_$(1)\n endif # NO_PDF_DOCS\n "}]}