{"sha": "4eea1a4e5e28a9a84579ee6a52f115375adefde6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlZWExYTRlNWUyOGE5YTg0NTc5ZWU2YTUyZjExNTM3NWFkZWZkZTY=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-06-27T11:36:30Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-06-28T09:04:25Z"}, "message": "Don't const propagate the body of constants", "tree": {"sha": "e1cb8479f2e57b83a38e83060cf33025c08d5cb7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1cb8479f2e57b83a38e83060cf33025c08d5cb7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4eea1a4e5e28a9a84579ee6a52f115375adefde6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4eea1a4e5e28a9a84579ee6a52f115375adefde6", "html_url": "https://github.com/rust-lang/rust/commit/4eea1a4e5e28a9a84579ee6a52f115375adefde6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4eea1a4e5e28a9a84579ee6a52f115375adefde6/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bb9648b27e2c9f9efdb9e29a0d90b229aaff562", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bb9648b27e2c9f9efdb9e29a0d90b229aaff562", "html_url": "https://github.com/rust-lang/rust/commit/4bb9648b27e2c9f9efdb9e29a0d90b229aaff562"}], "stats": {"total": 273, "additions": 94, "deletions": 179}, "files": [{"sha": "95bac24a77bd5413f31dd4c861e03004219148a2", "filename": "src/librustc_mir/transform/const_prop.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -45,8 +45,11 @@ impl MirPass for ConstProp {\n             return;\n         }\n         match tcx.describe_def(source.def_id) {\n-            // skip statics because they'll be evaluated by miri anyway\n+            // skip statics/consts because they'll be evaluated by miri anyway\n+            Some(Def::Const(..)) |\n             Some(Def::Static(..)) => return,\n+            // we still run on associated constants, because they might not get evaluated\n+            // within the current crate\n             _ => {},\n         }\n         trace!(\"ConstProp starting for {:?}\", source.def_id);"}, {"sha": "39b1b342eac3149752718d55ad5d48e24e3669c9", "filename": "src/test/compile-fail/const-err-early.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-err-early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-err-early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-err-early.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -11,16 +11,10 @@\n #![deny(const_err)]\n \n pub const A: i8 = -std::i8::MIN; //~ ERROR const_err\n-//~^ ERROR this constant cannot be used\n-//~| ERROR this expression will panic at runtime\n pub const B: u8 = 200u8 + 200u8; //~ ERROR const_err\n-//~^ ERROR this constant cannot be used\n pub const C: u8 = 200u8 * 4; //~ ERROR const_err\n-//~^ ERROR this constant cannot be used\n pub const D: u8 = 42u8 - (42u8 + 1); //~ ERROR const_err\n-//~^ ERROR this constant cannot be used\n pub const E: u8 = [5u8][1]; //~ ERROR const_err\n-//~| ERROR this constant cannot be used\n \n fn main() {\n     let _a = A;"}, {"sha": "f2ee8a7078c7c0d9f94dbeb3a2c874be32da4055", "filename": "src/test/compile-fail/const-err-multi.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-err-multi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-err-multi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-err-multi.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -11,24 +11,16 @@\n #![deny(const_err)]\n \n pub const A: i8 = -std::i8::MIN;\n-//~^ ERROR attempt to negate with overflow\n-//~| ERROR this expression will panic at runtime\n-//~| ERROR this constant cannot be used\n+//~^ ERROR this constant cannot be used\n pub const B: i8 = A;\n //~^ ERROR const_err\n //~| ERROR const_err\n-//~| ERROR const_err\n-//~| ERROR const_err\n pub const C: u8 = A as u8;\n //~^ ERROR const_err\n //~| ERROR const_err\n-//~| ERROR const_err\n-//~| ERROR const_err\n pub const D: i8 = 50 - A;\n //~^ ERROR const_err\n //~| ERROR const_err\n-//~| ERROR const_err\n-//~| ERROR const_err\n \n fn main() {\n     let _ = (A, B, C, D);"}, {"sha": "88fc51827753532d7107dc574df8d298f8b086fa", "filename": "src/test/compile-fail/const-eval-overflow2.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -25,54 +25,46 @@ const VALS_I8: (i8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i8::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_I16: (i16,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i16::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_I32: (i32,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i32::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_I64: (i64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i64::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_U8: (u8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u8::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_U16: (u16,) = (\n      //~^ ERROR this constant cannot be used\n      u16::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_U32: (u32,) = (\n      //~^ ERROR this constant cannot be used\n      u32::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n const VALS_U64: (u64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u64::MIN - 1,\n-     //~^ ERROR attempt to subtract with overflow\n      );\n \n fn main() {"}, {"sha": "1878daea93198a40cf169e407b43f3c33fd2cc2a", "filename": "src/test/compile-fail/const-eval-overflow2b.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2b.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2b.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2b.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -25,54 +25,46 @@ const VALS_I8: (i8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i8::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_I16: (i16,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i16::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_I32: (i32,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i32::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_I64: (i64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i64::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_U8: (u8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u8::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_U16: (u16,) = (\n      //~^ ERROR this constant cannot be used\n      u16::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_U32: (u32,) = (\n      //~^ ERROR this constant cannot be used\n      u32::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n const VALS_U64: (u64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u64::MAX + 1,\n-     //~^ ERROR attempt to add with overflow\n      );\n \n fn main() {"}, {"sha": "f3d28295bf81ce19a0116590d5d796c3884aad62", "filename": "src/test/compile-fail/const-eval-overflow2c.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2c.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2c.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-eval-overflow2c.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -25,54 +25,46 @@ const VALS_I8: (i8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i8::MIN * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_I16: (i16,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i16::MIN * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_I32: (i32,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i32::MIN * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_I64: (i64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      i64::MIN * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_U8: (u8,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u8::MAX * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_U16: (u16,) = (\n      //~^ ERROR this constant cannot be used\n      u16::MAX * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_U32: (u32,) = (\n      //~^ ERROR this constant cannot be used\n      u32::MAX * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n const VALS_U64: (u64,) =\n      //~^ ERROR this constant cannot be used\n     (\n      u64::MAX * 2,\n-     //~^ ERROR attempt to multiply with overflow\n      );\n \n fn main() {"}, {"sha": "7be9202a2f5654ce4a0f88486065f99ca608d152", "filename": "src/test/ui/const-eval/conditional_array_execution.nll.stderr", "status": "modified", "additions": 11, "deletions": 17, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.nll.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,25 +1,19 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/conditional_array_execution.rs:15:19\n+warning: this constant cannot be used\n+  --> $DIR/conditional_array_execution.rs:15:1\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n-   |                   ^^^^^\n+   | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |                   |\n+   |                   attempt to subtract with overflow\n    |\n note: lint level defined here\n   --> $DIR/conditional_array_execution.rs:11:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n-warning: this constant cannot be used\n-  --> $DIR/conditional_array_execution.rs:15:1\n-   |\n-LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n-   | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |                   |\n-   |                   attempt to subtract with overflow\n-\n warning: referenced constant\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ----- attempt to subtract with overflow\n@@ -28,13 +22,13 @@ LL |     println!(\"{}\", FOO);\n    |                    ^^^\n \n warning: this expression will panic at runtime\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL |     println!(\"{}\", FOO);\n    |                    ^^^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/conditional_array_execution.rs:20:5\n+  --> $DIR/conditional_array_execution.rs:19:5\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ----- attempt to subtract with overflow\n@@ -45,7 +39,7 @@ LL |     println!(\"{}\", FOO);\n    = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n \n error[E0080]: erroneous constant used\n-  --> $DIR/conditional_array_execution.rs:20:5\n+  --> $DIR/conditional_array_execution.rs:19:5\n    |\n LL |     println!(\"{}\", FOO);\n    |     ^^^^^^^^^^^^^^^---^^\n@@ -55,7 +49,7 @@ LL |     println!(\"{}\", FOO);\n    = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n \n error[E0080]: referenced constant\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ----- attempt to subtract with overflow\n@@ -64,7 +58,7 @@ LL |     println!(\"{}\", FOO);\n    |                    ^^^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL |     println!(\"{}\", FOO);\n    |                    ^^^ referenced constant has errors"}, {"sha": "99487eb49792324137d03fea2eae59ee674e757a", "filename": "src/test/ui/const-eval/conditional_array_execution.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -13,8 +13,7 @@\n const X: u32 = 5;\n const Y: u32 = 6;\n const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n-//~^ WARN attempt to subtract with overflow\n-//~| WARN this constant cannot be used\n+//~^ WARN this constant cannot be used\n \n fn main() {\n     println!(\"{}\", FOO);"}, {"sha": "8a1b75721798f90394b2f83502bacb3be1ccb3fe", "filename": "src/test/ui/const-eval/conditional_array_execution.stderr", "status": "modified", "additions": 9, "deletions": 15, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fconditional_array_execution.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,25 +1,19 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/conditional_array_execution.rs:15:19\n+warning: this constant cannot be used\n+  --> $DIR/conditional_array_execution.rs:15:1\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n-   |                   ^^^^^\n+   | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |                   |\n+   |                   attempt to subtract with overflow\n    |\n note: lint level defined here\n   --> $DIR/conditional_array_execution.rs:11:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n-warning: this constant cannot be used\n-  --> $DIR/conditional_array_execution.rs:15:1\n-   |\n-LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n-   | ^^^^^^^^^^^^^^^^^^-----^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |                   |\n-   |                   attempt to subtract with overflow\n-\n warning: referenced constant\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ----- attempt to subtract with overflow\n@@ -28,13 +22,13 @@ LL |     println!(\"{}\", FOO);\n    |                    ^^^\n \n warning: this expression will panic at runtime\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL |     println!(\"{}\", FOO);\n    |                    ^^^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL | const FOO: u32 = [X - Y, Y - X][(X < Y) as usize];\n    |                   ----- attempt to subtract with overflow\n@@ -43,7 +37,7 @@ LL |     println!(\"{}\", FOO);\n    |                    ^^^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/conditional_array_execution.rs:20:20\n+  --> $DIR/conditional_array_execution.rs:19:20\n    |\n LL |     println!(\"{}\", FOO);\n    |                    ^^^ referenced constant has errors"}, {"sha": "6437369214b3fdfd87f75b47b8ea69243f093ffc", "filename": "src/test/ui/const-eval/issue-43197.nll.stderr", "status": "modified", "additions": 18, "deletions": 30, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.nll.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,39 +1,27 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:20:20\n-   |\n-LL |     const X: u32 = 0-1;\n-   |                    ^^^\n-   |\n-note: lint level defined here\n-  --> $DIR/issue-43197.rs:11:9\n-   |\n-LL | #![warn(const_err)]\n-   |         ^^^^^^^^^\n-\n warning: this constant cannot be used\n   --> $DIR/issue-43197.rs:20:5\n    |\n LL |     const X: u32 = 0-1;\n    |     ^^^^^^^^^^^^^^^---^\n    |                    |\n    |                    attempt to subtract with overflow\n-\n-warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:23:24\n    |\n-LL |     const Y: u32 = foo(0-1);\n-   |                        ^^^\n+note: lint level defined here\n+  --> $DIR/issue-43197.rs:11:9\n+   |\n+LL | #![warn(const_err)]\n+   |         ^^^^^^^^^\n \n warning: this constant cannot be used\n-  --> $DIR/issue-43197.rs:23:5\n+  --> $DIR/issue-43197.rs:22:5\n    |\n LL |     const Y: u32 = foo(0-1);\n    |     ^^^^^^^^^^^^^^^^^^^---^^\n    |                        |\n    |                        attempt to subtract with overflow\n \n warning: referenced constant\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     const X: u32 = 0-1;\n    |                    --- attempt to subtract with overflow\n@@ -42,28 +30,28 @@ LL |     println!(\"{} {}\", X, Y);\n    |                       ^\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                       ^ referenced constant has errors\n \n warning: referenced constant\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     const Y: u32 = foo(0-1);\n    |                        --- attempt to subtract with overflow\n-...\n+LL |     //~^ WARN this constant cannot be used\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/issue-43197.rs:26:5\n+  --> $DIR/issue-43197.rs:24:5\n    |\n LL |     const X: u32 = 0-1;\n    |                    --- attempt to subtract with overflow\n@@ -74,7 +62,7 @@ LL |     println!(\"{} {}\", X, Y);\n    = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n \n error[E0080]: erroneous constant used\n-  --> $DIR/issue-43197.rs:26:5\n+  --> $DIR/issue-43197.rs:24:5\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |     ^^^^^^^^^^^^^^^^^^-^^^^^\n@@ -84,22 +72,22 @@ LL |     println!(\"{} {}\", X, Y);\n    = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n \n error[E0080]: referenced constant\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     const Y: u32 = foo(0-1);\n    |                        --- attempt to subtract with overflow\n-...\n+LL |     //~^ WARN this constant cannot be used\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     const X: u32 = 0-1;\n    |                    --- attempt to subtract with overflow\n@@ -108,7 +96,7 @@ LL |     println!(\"{} {}\", X, Y);\n    |                       ^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                       ^ referenced constant has errors"}, {"sha": "9304af7b811cf7832ce7f494a96f63140fe878c2", "filename": "src/test/ui/const-eval/issue-43197.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -18,11 +18,9 @@ const fn foo(x: u32) -> u32 {\n \n fn main() {\n     const X: u32 = 0-1;\n-    //~^ WARN attempt to subtract with overflow\n-    //~| WARN this constant cannot be used\n+    //~^ WARN this constant cannot be used\n     const Y: u32 = foo(0-1);\n-    //~^ WARN attempt to subtract with overflow\n-    //~| WARN this constant cannot be used\n+    //~^ WARN this constant cannot be used\n     println!(\"{} {}\", X, Y);\n     //~^ WARN this expression will panic at runtime\n     //~| WARN this expression will panic at runtime"}, {"sha": "3cb8b345c673ce51c808982bd3be869c38fb55dc", "filename": "src/test/ui/const-eval/issue-43197.stderr", "status": "modified", "additions": 16, "deletions": 28, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fissue-43197.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,39 +1,27 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:20:20\n-   |\n-LL |     const X: u32 = 0-1;\n-   |                    ^^^\n-   |\n-note: lint level defined here\n-  --> $DIR/issue-43197.rs:11:9\n-   |\n-LL | #![warn(const_err)]\n-   |         ^^^^^^^^^\n-\n warning: this constant cannot be used\n   --> $DIR/issue-43197.rs:20:5\n    |\n LL |     const X: u32 = 0-1;\n    |     ^^^^^^^^^^^^^^^---^\n    |                    |\n    |                    attempt to subtract with overflow\n-\n-warning: attempt to subtract with overflow\n-  --> $DIR/issue-43197.rs:23:24\n    |\n-LL |     const Y: u32 = foo(0-1);\n-   |                        ^^^\n+note: lint level defined here\n+  --> $DIR/issue-43197.rs:11:9\n+   |\n+LL | #![warn(const_err)]\n+   |         ^^^^^^^^^\n \n warning: this constant cannot be used\n-  --> $DIR/issue-43197.rs:23:5\n+  --> $DIR/issue-43197.rs:22:5\n    |\n LL |     const Y: u32 = foo(0-1);\n    |     ^^^^^^^^^^^^^^^^^^^---^^\n    |                        |\n    |                        attempt to subtract with overflow\n \n warning: referenced constant\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     const X: u32 = 0-1;\n    |                    --- attempt to subtract with overflow\n@@ -42,43 +30,43 @@ LL |     println!(\"{} {}\", X, Y);\n    |                       ^\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                       ^ referenced constant has errors\n \n warning: referenced constant\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     const Y: u32 = foo(0-1);\n    |                        --- attempt to subtract with overflow\n-...\n+LL |     //~^ WARN this constant cannot be used\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^\n \n warning: this expression will panic at runtime\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     const Y: u32 = foo(0-1);\n    |                        --- attempt to subtract with overflow\n-...\n+LL |     //~^ WARN this constant cannot be used\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/issue-43197.rs:26:26\n+  --> $DIR/issue-43197.rs:24:26\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                          ^ referenced constant has errors\n \n error[E0080]: referenced constant\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     const X: u32 = 0-1;\n    |                    --- attempt to subtract with overflow\n@@ -87,7 +75,7 @@ LL |     println!(\"{} {}\", X, Y);\n    |                       ^\n \n error[E0080]: erroneous constant used\n-  --> $DIR/issue-43197.rs:26:23\n+  --> $DIR/issue-43197.rs:24:23\n    |\n LL |     println!(\"{} {}\", X, Y);\n    |                       ^ referenced constant has errors"}, {"sha": "b7cfa949bac957f76432f4be129acd12838f1bad", "filename": "src/test/ui/const-eval/pub_const_err.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -14,8 +14,7 @@\n #![crate_type = \"lib\"]\n \n pub const Z: u32 = 0 - 1;\n-//~^ WARN attempt to subtract with overflow\n-//~| WARN this constant cannot be used\n+//~^ WARN this constant cannot be used\n \n pub type Foo = [i32; 0 - 1];\n //~^ WARN attempt to subtract with overflow"}, {"sha": "fa3a79a5f1790b09de082fbcb3e3b21d5c8875dc", "filename": "src/test/ui/const-eval/pub_const_err.stderr", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,31 +1,25 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/pub_const_err.rs:16:20\n+warning: this constant cannot be used\n+  --> $DIR/pub_const_err.rs:16:1\n    |\n LL | pub const Z: u32 = 0 - 1;\n-   |                    ^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^-----^\n+   |                    |\n+   |                    attempt to subtract with overflow\n    |\n note: lint level defined here\n   --> $DIR/pub_const_err.rs:12:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n-warning: this constant cannot be used\n-  --> $DIR/pub_const_err.rs:16:1\n-   |\n-LL | pub const Z: u32 = 0 - 1;\n-   | ^^^^^^^^^^^^^^^^^^^-----^\n-   |                    |\n-   |                    attempt to subtract with overflow\n-\n warning: attempt to subtract with overflow\n-  --> $DIR/pub_const_err.rs:20:22\n+  --> $DIR/pub_const_err.rs:19:22\n    |\n LL | pub type Foo = [i32; 0 - 1];\n    |                      ^^^^^\n \n warning: this array length cannot be used\n-  --> $DIR/pub_const_err.rs:20:22\n+  --> $DIR/pub_const_err.rs:19:22\n    |\n LL | pub type Foo = [i32; 0 - 1];\n    |                      ^^^^^ attempt to subtract with overflow"}, {"sha": "bafa5b2f4da12ffa0efd556ac84d7bff591170ef", "filename": "src/test/ui/const-eval/pub_const_err_bin.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -12,8 +12,7 @@\n #![warn(const_err)]\n \n pub const Z: u32 = 0 - 1;\n-//~^ WARN attempt to subtract with overflow\n-//~| WARN this constant cannot be used\n+//~^ WARN this constant cannot be used\n \n pub type Foo = [i32; 0 - 1];\n //~^ WARN attempt to subtract with overflow"}, {"sha": "73229c60d14dbe45a07d7d2be07afc3b25ac6ed8", "filename": "src/test/ui/const-eval/pub_const_err_bin.stderr", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-eval%2Fpub_const_err_bin.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,31 +1,25 @@\n-warning: attempt to subtract with overflow\n-  --> $DIR/pub_const_err_bin.rs:14:20\n+warning: this constant cannot be used\n+  --> $DIR/pub_const_err_bin.rs:14:1\n    |\n LL | pub const Z: u32 = 0 - 1;\n-   |                    ^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^-----^\n+   |                    |\n+   |                    attempt to subtract with overflow\n    |\n note: lint level defined here\n   --> $DIR/pub_const_err_bin.rs:12:9\n    |\n LL | #![warn(const_err)]\n    |         ^^^^^^^^^\n \n-warning: this constant cannot be used\n-  --> $DIR/pub_const_err_bin.rs:14:1\n-   |\n-LL | pub const Z: u32 = 0 - 1;\n-   | ^^^^^^^^^^^^^^^^^^^-----^\n-   |                    |\n-   |                    attempt to subtract with overflow\n-\n warning: attempt to subtract with overflow\n-  --> $DIR/pub_const_err_bin.rs:18:22\n+  --> $DIR/pub_const_err_bin.rs:17:22\n    |\n LL | pub type Foo = [i32; 0 - 1];\n    |                      ^^^^^\n \n warning: this array length cannot be used\n-  --> $DIR/pub_const_err_bin.rs:18:22\n+  --> $DIR/pub_const_err_bin.rs:17:22\n    |\n LL | pub type Foo = [i32; 0 - 1];\n    |                      ^^^^^ attempt to subtract with overflow"}, {"sha": "242561da9d54cb1eb720d1101a71eb81e631ab26", "filename": "src/test/ui/const-len-underflow-separate-spans.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.rs?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -15,12 +15,12 @@\n const ONE: usize = 1;\n const TWO: usize = 2;\n const LEN: usize = ONE - TWO;\n-//~^ ERROR attempt to subtract with overflow\n \n fn main() {\n     let a: [i8; LEN] = unimplemented!();\n //~^ ERROR E0080\n //~| ERROR E0080\n //~| ERROR const_err\n //~| ERROR const_err\n+//~| ERROR const_err\n }"}, {"sha": "a941b0c703fe87e8a5af92f265e386bac19f9786", "filename": "src/test/ui/const-len-underflow-separate-spans.stderr", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4eea1a4e5e28a9a84579ee6a52f115375adefde6/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-len-underflow-separate-spans.stderr?ref=4eea1a4e5e28a9a84579ee6a52f115375adefde6", "patch": "@@ -1,28 +1,31 @@\n-error: attempt to subtract with overflow\n-  --> $DIR/const-len-underflow-separate-spans.rs:17:20\n-   |\n-LL | const LEN: usize = ONE - TWO;\n-   |                    ^^^^^^^^^\n-   |\n-   = note: #[deny(const_err)] on by default\n-\n error: referenced constant\n-  --> $DIR/const-len-underflow-separate-spans.rs:21:17\n+  --> $DIR/const-len-underflow-separate-spans.rs:20:17\n    |\n LL | const LEN: usize = ONE - TWO;\n    |                    --------- attempt to subtract with overflow\n ...\n LL |     let a: [i8; LEN] = unimplemented!();\n    |                 ^^^\n+   |\n+   = note: #[deny(const_err)] on by default\n \n error: this expression will panic at runtime\n-  --> $DIR/const-len-underflow-separate-spans.rs:21:17\n+  --> $DIR/const-len-underflow-separate-spans.rs:20:17\n    |\n LL |     let a: [i8; LEN] = unimplemented!();\n    |                 ^^^ referenced constant has errors\n \n+error: referenced constant\n+  --> $DIR/const-len-underflow-separate-spans.rs:20:17\n+   |\n+LL | const LEN: usize = ONE - TWO;\n+   |                    --------- attempt to subtract with overflow\n+...\n+LL |     let a: [i8; LEN] = unimplemented!();\n+   |                 ^^^\n+\n error[E0080]: referenced constant\n-  --> $DIR/const-len-underflow-separate-spans.rs:21:12\n+  --> $DIR/const-len-underflow-separate-spans.rs:20:12\n    |\n LL | const LEN: usize = ONE - TWO;\n    |                    --------- attempt to subtract with overflow\n@@ -31,7 +34,7 @@ LL |     let a: [i8; LEN] = unimplemented!();\n    |            ^^^^^^^^^\n \n error[E0080]: could not evaluate constant expression\n-  --> $DIR/const-len-underflow-separate-spans.rs:21:12\n+  --> $DIR/const-len-underflow-separate-spans.rs:20:12\n    |\n LL |     let a: [i8; LEN] = unimplemented!();\n    |            ^^^^^---^"}]}