{"sha": "4e8d1b229217c7c83ce96b44410ccae9470db973", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlOGQxYjIyOTIxN2M3YzgzY2U5NmI0NDQxMGNjYWU5NDcwZGI5NzM=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-10-22T20:53:28Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-10-22T20:53:28Z"}, "message": "Add some documentation", "tree": {"sha": "1ed442ba2b1abe9a515cb283881bc6e0233fa125", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ed442ba2b1abe9a515cb283881bc6e0233fa125"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e8d1b229217c7c83ce96b44410ccae9470db973", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e8d1b229217c7c83ce96b44410ccae9470db973", "html_url": "https://github.com/rust-lang/rust/commit/4e8d1b229217c7c83ce96b44410ccae9470db973", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e8d1b229217c7c83ce96b44410ccae9470db973/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6be0a7081a9aafc4e0b39cae266fbed5eabd8993", "url": "https://api.github.com/repos/rust-lang/rust/commits/6be0a7081a9aafc4e0b39cae266fbed5eabd8993", "html_url": "https://github.com/rust-lang/rust/commit/6be0a7081a9aafc4e0b39cae266fbed5eabd8993"}], "stats": {"total": 31, "additions": 23, "deletions": 8}, "files": [{"sha": "595b715c02ef6a0b7b6f5fa88af9e85bb9d426f5", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=4e8d1b229217c7c83ce96b44410ccae9470db973", "patch": "@@ -155,23 +155,31 @@ impl LintStore {\n             .collect()\n     }\n \n-    pub fn register_early_pass(&mut self,\n-        pass: impl Fn() -> EarlyLintPassObject + 'static + sync::Send + sync::Sync) {\n+    pub fn register_early_pass(\n+        &mut self,\n+        pass: impl Fn() -> EarlyLintPassObject + 'static + sync::Send + sync::Sync\n+    ) {\n         self.early_passes.push(Box::new(pass));\n     }\n \n-    pub fn register_pre_expansion_pass(&mut self,\n-        pass: impl Fn() -> EarlyLintPassObject + 'static + sync::Send + sync::Sync) {\n+    pub fn register_pre_expansion_pass(\n+        &mut self,\n+        pass: impl Fn() -> EarlyLintPassObject + 'static + sync::Send + sync::Sync,\n+    ) {\n         self.pre_expansion_passes.push(Box::new(pass));\n     }\n \n-    pub fn register_late_pass(&mut self,\n-        pass: impl Fn() -> LateLintPassObject + 'static + sync::Send + sync::Sync) {\n+    pub fn register_late_pass(\n+        &mut self,\n+        pass: impl Fn() -> LateLintPassObject + 'static + sync::Send + sync::Sync,\n+    ) {\n         self.late_passes.push(Box::new(pass));\n     }\n \n-    pub fn register_late_mod_pass(&mut self,\n-        pass: impl Fn() -> LateLintPassObject + 'static + sync::Send + sync::Sync) {\n+    pub fn register_late_mod_pass(\n+        &mut self,\n+        pass: impl Fn() -> LateLintPassObject + 'static + sync::Send + sync::Sync,\n+    ) {\n         self.late_module_passes.push(Box::new(pass));\n     }\n "}, {"sha": "a18ef014b4dc02d07732ff150d146765f3357d58", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=4e8d1b229217c7c83ce96b44410ccae9470db973", "patch": "@@ -106,6 +106,7 @@ pub fn abort_on_err<T>(result: Result<T, ErrorReported>, sess: &Session) -> T {\n pub trait Callbacks {\n     /// Called before creating the compiler instance\n     fn config(&mut self, _config: &mut interface::Config) {}\n+    /// Called early during compilation to allow other drivers to easily register lints.\n     fn extra_lints(&mut self, _ls: &mut lint::LintStore) {}\n     /// Called after parsing. Return value instructs the compiler whether to\n     /// continue the compilation afterwards (defaults to `Compilation::Continue`)"}, {"sha": "3f832f95bd408de0d267ab60d95f13790550f2a9", "filename": "src/librustc_interface/interface.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_interface%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_interface%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Finterface.rs?ref=4e8d1b229217c7c83ce96b44410ccae9470db973", "patch": "@@ -82,6 +82,11 @@ pub struct Config {\n     pub crate_name: Option<String>,\n     pub lint_caps: FxHashMap<lint::LintId, lint::Level>,\n \n+    /// This is a callback from the driver that is called when we're registering lints;\n+    /// it is called during plugin registration when we have the LintStore in a non-shared state.\n+    ///\n+    /// Note that if you find a Some here you probably want to call that function in the new\n+    /// function being registered.\n     pub register_lints: Option<Box<dyn Fn(&Session, &mut lint::LintStore) + Send + Sync>>,\n }\n "}, {"sha": "2e23b8c870cfcbb68d0609fec81ec3f5793a661a", "filename": "src/librustc_plugin/registry.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_plugin%2Fregistry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e8d1b229217c7c83ce96b44410ccae9470db973/src%2Flibrustc_plugin%2Fregistry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_plugin%2Fregistry.rs?ref=4e8d1b229217c7c83ce96b44410ccae9470db973", "patch": "@@ -25,6 +25,7 @@ pub struct Registry<'a> {\n     /// from the plugin registrar.\n     pub sess: &'a Session,\n \n+    /// The `LintStore` allows plugins to register new lints.\n     pub lint_store: &'a mut LintStore,\n \n     #[doc(hidden)]"}]}