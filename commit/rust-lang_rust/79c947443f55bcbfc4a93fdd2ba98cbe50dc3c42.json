{"sha": "79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "node_id": "C_kwDOAAsO6NoAKDc5Yzk0NzQ0M2Y1NWJjYmZjNGE5M2ZkZDJiYTk4Y2JlNTBkYzNjNDI", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-07-30T15:09:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-30T15:09:49Z"}, "message": "Rollup merge of #99900 - lcnr:hash-stable-fun, r=cjgillot\n\nremove some manual hash stable impls", "tree": {"sha": "45282072d1e95399c230a05622273971f559a5aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45282072d1e95399c230a05622273971f559a5aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi5Um+CRBK7hj4Ov3rIwAA6z8IAJNyR9G3ZOdZzD/H6tg0MEAJ\nACACQTU5V6kRDjEOaLGg8NbcI6vffDpJHhOGxENab1HQ3hGtUSSlgFF0A5bq9b5v\nf76bgyhoIgDGQ9ZHpc3ZhE6XIerV06c4z3+zrWB+ObIZkMAyNHjmCnoqlJUxQ2mf\n/GmSK949MhppNIaDdykcg6F/TeVEivBvEVjOIl3ZmOqUF5FSRi5Um1M1/FRhx7Q9\nJineSMPmDnLX6XA3Pzs7V7QqrnoheP1lA9XQpMA8qyAstnmGYxXnUbqmdO4+dwNZ\nQ7nHE60N7+utQhDfINaPQsWr4RW8ikd9e51os/8EFaFAPvKyQ8VLBX0ktPRlgaM=\n=K3d+\n-----END PGP SIGNATURE-----\n", "payload": "tree 45282072d1e95399c230a05622273971f559a5aa\nparent cfd231a0cbcdbc39543c6f9e5fa2216244a89858\nparent d3ad264a91d9efba20c59753d88bc350f99dd952\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1659193789 +0530\ncommitter GitHub <noreply@github.com> 1659193789 +0530\n\nRollup merge of #99900 - lcnr:hash-stable-fun, r=cjgillot\n\nremove some manual hash stable impls\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "html_url": "https://github.com/rust-lang/rust/commit/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cfd231a0cbcdbc39543c6f9e5fa2216244a89858", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfd231a0cbcdbc39543c6f9e5fa2216244a89858", "html_url": "https://github.com/rust-lang/rust/commit/cfd231a0cbcdbc39543c6f9e5fa2216244a89858"}, {"sha": "d3ad264a91d9efba20c59753d88bc350f99dd952", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3ad264a91d9efba20c59753d88bc350f99dd952", "html_url": "https://github.com/rust-lang/rust/commit/d3ad264a91d9efba20c59753d88bc350f99dd952"}], "stats": {"total": 104, "additions": 15, "deletions": 89}, "files": [{"sha": "ce8591734188077a14b3d8b3c8d2db460d720217", "filename": "compiler/rustc_data_structures/src/stable_hasher.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fstable_hasher.rs?ref=79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "patch": "@@ -3,6 +3,7 @@ use rustc_index::bit_set;\n use rustc_index::vec;\n use smallvec::SmallVec;\n use std::hash::{BuildHasher, Hash, Hasher};\n+use std::marker::PhantomData;\n use std::mem;\n \n #[cfg(test)]\n@@ -261,6 +262,10 @@ impl<CTX> HashStable<CTX> for ! {\n     }\n }\n \n+impl<CTX, T> HashStable<CTX> for PhantomData<T> {\n+    fn hash_stable(&self, _ctx: &mut CTX, _hasher: &mut StableHasher) {}\n+}\n+\n impl<CTX> HashStable<CTX> for ::std::num::NonZeroU32 {\n     #[inline]\n     fn hash_stable(&self, ctx: &mut CTX, hasher: &mut StableHasher) {"}, {"sha": "1f9b474ade12b79a0ca4de6775a619c910da7f83", "filename": "compiler/rustc_middle/src/traits/query.rs", "status": "modified", "additions": 1, "deletions": 25, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fquery.rs?ref=79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "patch": "@@ -9,13 +9,9 @@ use crate::infer::canonical::{Canonical, QueryResponse};\n use crate::ty::error::TypeError;\n use crate::ty::subst::GenericArg;\n use crate::ty::{self, Ty, TyCtxt};\n-\n-use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_errors::struct_span_err;\n-use rustc_query_system::ich::StableHashingContext;\n use rustc_span::source_map::Span;\n use std::iter::FromIterator;\n-use std::mem;\n \n pub mod type_op {\n     use crate::ty::fold::TypeFoldable;\n@@ -226,29 +222,9 @@ pub struct NormalizationResult<'tcx> {\n /// case they are called implied bounds). They are fed to the\n /// `OutlivesEnv` which in turn is supplied to the region checker and\n /// other parts of the inference system.\n-#[derive(Clone, Debug, TypeFoldable, TypeVisitable, Lift)]\n+#[derive(Clone, Debug, TypeFoldable, TypeVisitable, Lift, HashStable)]\n pub enum OutlivesBound<'tcx> {\n     RegionSubRegion(ty::Region<'tcx>, ty::Region<'tcx>),\n     RegionSubParam(ty::Region<'tcx>, ty::ParamTy),\n     RegionSubProjection(ty::Region<'tcx>, ty::ProjectionTy<'tcx>),\n }\n-\n-impl<'a, 'tcx> HashStable<StableHashingContext<'a>> for OutlivesBound<'tcx> {\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        mem::discriminant(self).hash_stable(hcx, hasher);\n-        match *self {\n-            OutlivesBound::RegionSubRegion(ref a, ref b) => {\n-                a.hash_stable(hcx, hasher);\n-                b.hash_stable(hcx, hasher);\n-            }\n-            OutlivesBound::RegionSubParam(ref a, ref b) => {\n-                a.hash_stable(hcx, hasher);\n-                b.hash_stable(hcx, hasher);\n-            }\n-            OutlivesBound::RegionSubProjection(ref a, ref b) => {\n-                a.hash_stable(hcx, hasher);\n-                b.hash_stable(hcx, hasher);\n-            }\n-        }\n-    }\n-}"}, {"sha": "cd00b26b8def0b77d72455ecb6fe07dcd4631747", "filename": "compiler/rustc_middle/src/ty/impls_ty.rs", "status": "modified", "additions": 0, "deletions": 40, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs?ref=79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "patch": "@@ -101,46 +101,6 @@ impl<'a, 'tcx> HashStable<StableHashingContext<'a>> for ty::subst::GenericArgKin\n     }\n }\n \n-impl<'a> HashStable<StableHashingContext<'a>> for ty::EarlyBoundRegion {\n-    #[inline]\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        self.def_id.hash_stable(hcx, hasher);\n-        self.index.hash_stable(hcx, hasher);\n-        self.name.hash_stable(hcx, hasher);\n-    }\n-}\n-\n-impl<'a> HashStable<StableHashingContext<'a>> for ty::RegionVid {\n-    #[inline]\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        self.index().hash_stable(hcx, hasher);\n-    }\n-}\n-\n-impl<'a, 'tcx> HashStable<StableHashingContext<'a>> for ty::ConstVid<'tcx> {\n-    #[inline]\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        self.index.hash_stable(hcx, hasher);\n-    }\n-}\n-\n-impl<'tcx> HashStable<StableHashingContext<'tcx>> for ty::BoundVar {\n-    #[inline]\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'tcx>, hasher: &mut StableHasher) {\n-        self.index().hash_stable(hcx, hasher);\n-    }\n-}\n-\n-impl<'a, 'tcx, T> HashStable<StableHashingContext<'a>> for ty::Binder<'tcx, T>\n-where\n-    T: HashStable<StableHashingContext<'a>>,\n-{\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        self.as_ref().skip_binder().hash_stable(hcx, hasher);\n-        self.bound_vars().hash_stable(hcx, hasher);\n-    }\n-}\n-\n // AllocIds get resolved to whatever they point to (to be stable)\n impl<'a> HashStable<StableHashingContext<'a>> for mir::interpret::AllocId {\n     fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {"}, {"sha": "da9d51a29b18c45d79caa7a03597dff9118cd403", "filename": "compiler/rustc_middle/src/ty/mod.rs", "status": "modified", "additions": 3, "deletions": 23, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fmod.rs?ref=79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "patch": "@@ -1182,22 +1182,13 @@ impl<'tcx> OpaqueHiddenType<'tcx> {\n /// identified by both a universe, as well as a name residing within that universe. Distinct bound\n /// regions/types/consts within the same universe simply have an unknown relationship to one\n /// another.\n-#[derive(Copy, Clone, Debug, PartialEq, Eq, Hash, TyEncodable, TyDecodable, PartialOrd, Ord)]\n+#[derive(Copy, Clone, Debug, PartialEq, Eq, Hash, PartialOrd, Ord)]\n+#[derive(HashStable, TyEncodable, TyDecodable)]\n pub struct Placeholder<T> {\n     pub universe: UniverseIndex,\n     pub name: T,\n }\n \n-impl<'a, T> HashStable<StableHashingContext<'a>> for Placeholder<T>\n-where\n-    T: HashStable<StableHashingContext<'a>>,\n-{\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        self.universe.hash_stable(hcx, hasher);\n-        self.name.hash_stable(hcx, hasher);\n-    }\n-}\n-\n pub type PlaceholderRegion = Placeholder<BoundRegionKind>;\n \n pub type PlaceholderType = Placeholder<BoundVar>;\n@@ -1581,6 +1572,7 @@ impl<'tcx> PolyTraitRef<'tcx> {\n }\n \n #[derive(Copy, Clone, Debug, PartialEq, Eq, Hash, TypeFoldable, TypeVisitable)]\n+#[derive(HashStable)]\n pub struct ParamEnvAnd<'tcx, T> {\n     pub param_env: ParamEnv<'tcx>,\n     pub value: T,\n@@ -1598,18 +1590,6 @@ impl<'tcx, T> ParamEnvAnd<'tcx, T> {\n     }\n }\n \n-impl<'a, 'tcx, T> HashStable<StableHashingContext<'a>> for ParamEnvAnd<'tcx, T>\n-where\n-    T: HashStable<StableHashingContext<'a>>,\n-{\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        let ParamEnvAnd { ref param_env, ref value } = *self;\n-\n-        param_env.hash_stable(hcx, hasher);\n-        value.hash_stable(hcx, hasher);\n-    }\n-}\n-\n #[derive(Copy, Clone, Debug, HashStable, Encodable, Decodable)]\n pub struct Destructor {\n     /// The `DefId` of the destructor method"}, {"sha": "411d5c55829bd9c1df666247865de40e232a1198", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=79c947443f55bcbfc4a93fdd2ba98cbe50dc3c42", "patch": "@@ -1009,6 +1009,7 @@ impl BoundVariableKind {\n ///\n /// `Decodable` and `Encodable` are implemented for `Binder<T>` using the `impl_binder_encode_decode!` macro.\n #[derive(Copy, Clone, PartialEq, Eq, PartialOrd, Ord, Hash, Debug)]\n+#[derive(HashStable)]\n pub struct Binder<'tcx, T>(T, &'tcx List<BoundVariableKind>);\n \n impl<'tcx, T> Binder<'tcx, T>\n@@ -1355,6 +1356,7 @@ impl<'tcx> fmt::Debug for Region<'tcx> {\n }\n \n #[derive(Copy, Clone, PartialEq, Eq, Hash, TyEncodable, TyDecodable, PartialOrd, Ord)]\n+#[derive(HashStable)]\n pub struct EarlyBoundRegion {\n     pub def_id: DefId,\n     pub index: u32,\n@@ -1368,14 +1370,16 @@ impl fmt::Debug for EarlyBoundRegion {\n }\n \n /// A **`const`** **v**ariable **ID**.\n-#[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash, TyEncodable, TyDecodable)]\n+#[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]\n+#[derive(HashStable, TyEncodable, TyDecodable)]\n pub struct ConstVid<'tcx> {\n     pub index: u32,\n     pub phantom: PhantomData<&'tcx ()>,\n }\n \n rustc_index::newtype_index! {\n     /// A **region** (lifetime) **v**ariable **ID**.\n+    #[derive(HashStable)]\n     pub struct RegionVid {\n         DEBUG_FORMAT = custom,\n     }\n@@ -1388,6 +1392,7 @@ impl Atom for RegionVid {\n }\n \n rustc_index::newtype_index! {\n+    #[derive(HashStable)]\n     pub struct BoundVar { .. }\n }\n "}]}