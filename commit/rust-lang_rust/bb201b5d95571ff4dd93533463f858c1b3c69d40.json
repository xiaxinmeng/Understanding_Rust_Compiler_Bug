{"sha": "bb201b5d95571ff4dd93533463f858c1b3c69d40", "node_id": "C_kwDOAAsO6NoAKGJiMjAxYjVkOTU1NzFmZjRkZDkzNTMzNDYzZjg1OGMxYjNjNjlkNDA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-02T21:06:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-02T21:06:28Z"}, "message": "Rollup merge of #103875 - oli-obk:ast_conv_simplification, r=spastorino\n\nSimplify astconv item def id handling", "tree": {"sha": "4a3e949381ba06da307b6ad4c49f05078ad5de31", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a3e949381ba06da307b6ad4c49f05078ad5de31"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb201b5d95571ff4dd93533463f858c1b3c69d40", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjYtvUCRBK7hj4Ov3rIwAAVv8IAK2oUJGrNyol7tk0x0oWbXoU\nlsza/bLj/n14akI5/58XvnMqg4Q/PhEG0sZxpOT4t8oyCDYAG62+Ex6/MV7A10jA\nJmYMTlcWOtqA0qgJSp+SblSilIO0h2ebP4NhPbK3FgPTAiRn6PYIVP9gnGiXEQiP\nf4/pz9a1C5qjOkm/1tFEW8eUtWMYl8PBWS+PBxNbNHDSxgAN+qLyC92ecxc5d4sy\niAHM7qeNclNjiqQwSzlZb82C2WCM+DM1Zwcruah1WCEO2I97Yrz+JrzVWp6mkAXq\nPzFo9uREfmtqwa7Tpxb6HPKYUr5qZYhX74uPipi4lXHJ5CjyG7LoMKu17/2W2c8=\n=ff+v\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a3e949381ba06da307b6ad4c49f05078ad5de31\nparent 5784a038fb28eaf078c56fe5ab2484c3bf0b673b\nparent ecea6160525367568e8333ad71d4c1fadbe5f8f7\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1667423188 +0100\ncommitter GitHub <noreply@github.com> 1667423188 +0100\n\nRollup merge of #103875 - oli-obk:ast_conv_simplification, r=spastorino\n\nSimplify astconv item def id handling\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb201b5d95571ff4dd93533463f858c1b3c69d40", "html_url": "https://github.com/rust-lang/rust/commit/bb201b5d95571ff4dd93533463f858c1b3c69d40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb201b5d95571ff4dd93533463f858c1b3c69d40/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5784a038fb28eaf078c56fe5ab2484c3bf0b673b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5784a038fb28eaf078c56fe5ab2484c3bf0b673b", "html_url": "https://github.com/rust-lang/rust/commit/5784a038fb28eaf078c56fe5ab2484c3bf0b673b"}, {"sha": "ecea6160525367568e8333ad71d4c1fadbe5f8f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/ecea6160525367568e8333ad71d4c1fadbe5f8f7", "html_url": "https://github.com/rust-lang/rust/commit/ecea6160525367568e8333ad71d4c1fadbe5f8f7"}], "stats": {"total": 24, "additions": 9, "deletions": 15}, "files": [{"sha": "e6465d641f1e64552af60f0775a5bbf4564b0666", "filename": "compiler/rustc_hir_analysis/src/astconv/errors.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Ferrors.rs?ref=bb201b5d95571ff4dd93533463f858c1b3c69d40", "patch": "@@ -177,11 +177,8 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             .all_traits()\n             .filter(|trait_def_id| {\n                 let viz = self.tcx().visibility(*trait_def_id);\n-                if let Some(def_id) = self.item_def_id() {\n-                    viz.is_accessible_from(def_id, self.tcx())\n-                } else {\n-                    viz.is_visible_locally()\n-                }\n+                let def_id = self.item_def_id();\n+                viz.is_accessible_from(def_id, self.tcx())\n             })\n             .collect();\n "}, {"sha": "9dd9bf05540fbfe6d8c4c716a4fd0bb2def7141c", "filename": "compiler/rustc_hir_analysis/src/astconv/mod.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs?ref=bb201b5d95571ff4dd93533463f858c1b3c69d40", "patch": "@@ -54,7 +54,7 @@ pub struct PathSeg(pub DefId, pub usize);\n pub trait AstConv<'tcx> {\n     fn tcx<'a>(&'a self) -> TyCtxt<'tcx>;\n \n-    fn item_def_id(&self) -> Option<DefId>;\n+    fn item_def_id(&self) -> DefId;\n \n     /// Returns predicates in scope of the form `X: Foo<T>`, where `X`\n     /// is a type parameter `X` with the given id `def_id` and T\n@@ -2082,17 +2082,14 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n \n             debug!(\"qpath_to_ty: self.item_def_id()={:?}\", def_id);\n \n-            let parent_def_id = def_id\n-                .and_then(|def_id| {\n-                    def_id.as_local().map(|def_id| tcx.hir().local_def_id_to_hir_id(def_id))\n-                })\n+            let parent_def_id = def_id.as_local().map(|def_id| tcx.hir().local_def_id_to_hir_id(def_id))\n                 .map(|hir_id| tcx.hir().get_parent_item(hir_id).to_def_id());\n \n             debug!(\"qpath_to_ty: parent_def_id={:?}\", parent_def_id);\n \n             // If the trait in segment is the same as the trait defining the item,\n             // use the `<Self as ..>` syntax in the error.\n-            let is_part_of_self_trait_constraints = def_id == Some(trait_def_id);\n+            let is_part_of_self_trait_constraints = def_id == trait_def_id;\n             let is_part_of_fn_in_self_trait = parent_def_id == Some(trait_def_id);\n \n             let type_name = if is_part_of_self_trait_constraints || is_part_of_fn_in_self_trait {"}, {"sha": "25faacadf3d0c18a8ca572277481c4106561dd40", "filename": "compiler/rustc_hir_analysis/src/collect.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs?ref=bb201b5d95571ff4dd93533463f858c1b3c69d40", "patch": "@@ -379,8 +379,8 @@ impl<'tcx> AstConv<'tcx> for ItemCtxt<'tcx> {\n         self.tcx\n     }\n \n-    fn item_def_id(&self) -> Option<DefId> {\n-        Some(self.item_def_id)\n+    fn item_def_id(&self) -> DefId {\n+        self.item_def_id\n     }\n \n     fn get_type_parameter_bounds("}, {"sha": "c36c01e1b46d07b5905cd8ebe2124729431406c3", "filename": "compiler/rustc_hir_typeck/src/fn_ctxt/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb201b5d95571ff4dd93533463f858c1b3c69d40/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs?ref=bb201b5d95571ff4dd93533463f858c1b3c69d40", "patch": "@@ -194,8 +194,8 @@ impl<'a, 'tcx> AstConv<'tcx> for FnCtxt<'a, 'tcx> {\n         self.tcx\n     }\n \n-    fn item_def_id(&self) -> Option<DefId> {\n-        None\n+    fn item_def_id(&self) -> DefId {\n+        self.body_id.owner.to_def_id()\n     }\n \n     fn get_type_parameter_bounds("}]}