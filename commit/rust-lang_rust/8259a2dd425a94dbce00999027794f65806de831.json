{"sha": "8259a2dd425a94dbce00999027794f65806de831", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyNTlhMmRkNDI1YTk0ZGJjZTAwOTk5MDI3Nzk0ZjY1ODA2ZGU4MzE=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-07-13T01:37:57Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-07-13T01:55:01Z"}, "message": "Do not emit type errors after parse error in last statement of block\n\nWhen recovering from a parse error inside a block, do not emit type\nerrors generating on that block's recovered return expression.\n\nFix #57383.", "tree": {"sha": "fcb29eb7da79e1885831a6ebc9e6af0a26671443", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fcb29eb7da79e1885831a6ebc9e6af0a26671443"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8259a2dd425a94dbce00999027794f65806de831", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8259a2dd425a94dbce00999027794f65806de831", "html_url": "https://github.com/rust-lang/rust/commit/8259a2dd425a94dbce00999027794f65806de831", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8259a2dd425a94dbce00999027794f65806de831/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71f9384e3bec467158a628e2d11e77ffada16a90", "url": "https://api.github.com/repos/rust-lang/rust/commits/71f9384e3bec467158a628e2d11e77ffada16a90", "html_url": "https://github.com/rust-lang/rust/commit/71f9384e3bec467158a628e2d11e77ffada16a90"}], "stats": {"total": 103, "additions": 42, "deletions": 61}, "files": [{"sha": "6864bd0efc2f46ab18425c055b511a10abd1e7c7", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -4678,6 +4678,9 @@ impl<'a> Parser<'a> {\n                     {\n                         e.emit();\n                         self.recover_stmt();\n+                        // Don't complain about type errors in body tail after parse error (#57383).\n+                        let sp = expr.span.to(self.prev_span);\n+                        stmt.node = StmtKind::Expr(DummyResult::raw_expr(sp, true));\n                     }\n                 }\n             }\n@@ -4695,8 +4698,7 @@ impl<'a> Parser<'a> {\n         if self.eat(&token::Semi) {\n             stmt = stmt.add_trailing_semicolon();\n         }\n-\n-        stmt.span = stmt.span.with_hi(self.prev_span.hi());\n+        stmt.span = stmt.span.to(self.prev_span);\n         Ok(Some(stmt))\n     }\n "}, {"sha": "3530862f76787708d3100b3e8c0d88ae1ebb88da", "filename": "src/test/ui/obsolete-in-place/bad.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.rs?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -3,7 +3,6 @@\n fn foo() {\n     let (x, y) = (0, 0);\n     x <- y; //~ ERROR expected one of\n-    //~^ ERROR mismatched types\n }\n \n fn main() {"}, {"sha": "373b7ea42183dcbe3dfccc1dde5323db1290c7bf", "filename": "src/test/ui/obsolete-in-place/bad.stderr", "status": "modified", "additions": 2, "deletions": 15, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fobsolete-in-place%2Fbad.stderr?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -5,23 +5,10 @@ LL |     x <- y;\n    |       ^^ expected one of 8 possible tokens here\n \n error: expected expression, found keyword `in`\n-  --> $DIR/bad.rs:11:5\n+  --> $DIR/bad.rs:10:5\n    |\n LL |     in(foo) { bar };\n    |     ^^ expected expression\n \n-error[E0308]: mismatched types\n-  --> $DIR/bad.rs:5:5\n-   |\n-LL | fn foo() {\n-   |          - possibly return type missing here?\n-LL |     let (x, y) = (0, 0);\n-LL |     x <- y;\n-   |     ^ expected (), found integer\n-   |\n-   = note: expected type `()`\n-              found type `{integer}`\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0308`."}, {"sha": "c5bfd10ee5e66b6ef10751a50b530f604d36bf68", "filename": "src/test/ui/parser/issue-19096.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fissue-19096.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fissue-19096.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-19096.rs?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -1,5 +1,10 @@\n-fn main() {\n+fn main() { // we don't complain about the return type being `{integer}`\n     let t = (42, 42);\n     t.0::<isize>; //~ ERROR expected one of `.`, `;`, `?`, `}`, or an operator, found `::`\n-                  //~| ERROR mismatched types\n+}\n+\n+fn foo() -> usize { // we don't complain about the return type being unit\n+    let t = (42, 42);\n+    t.0::<isize>; //~ ERROR expected one of `.`, `;`, `?`, `}`, or an operator, found `::`\n+    42;\n }"}, {"sha": "957b40dbd5e6c64f746b515398b0632620077f27", "filename": "src/test/ui/parser/issue-19096.stderr", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fissue-19096.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fissue-19096.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-19096.stderr?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -4,18 +4,11 @@ error: expected one of `.`, `;`, `?`, `}`, or an operator, found `::`\n LL |     t.0::<isize>;\n    |        ^^ expected one of `.`, `;`, `?`, `}`, or an operator here\n \n-error[E0308]: mismatched types\n-  --> $DIR/issue-19096.rs:3:5\n+error: expected one of `.`, `;`, `?`, `}`, or an operator, found `::`\n+  --> $DIR/issue-19096.rs:8:8\n    |\n-LL | fn main() {\n-   |           - expected `()` because of default return type\n-LL |     let t = (42, 42);\n LL |     t.0::<isize>;\n-   |     ^^^ expected (), found integer\n-   |\n-   = note: expected type `()`\n-              found type `{integer}`\n+   |        ^^ expected one of `.`, `;`, `?`, `}`, or an operator here\n \n error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0308`."}, {"sha": "6b055fbb117496416ea14d8028fc110cf21de8d7", "filename": "src/test/ui/parser/raw/raw-literal-keywords.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.rs?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -1,16 +1,25 @@\n fn test_if() {\n     r#if true { } //~ ERROR found `true`\n-                  //~| ERROR cannot find value `if` in this scope\n }\n \n fn test_struct() {\n     r#struct Test; //~ ERROR found `Test`\n-                   //~| ERROR cannot find value `struct` in this scope\n }\n \n fn test_union() {\n     r#union Test; //~ ERROR found `Test`\n-                  //~| ERROR cannot find value `union` in this scope\n+}\n+\n+fn test_if_2() {\n+    let _ = r#if; //~ ERROR cannot find value `if` in this scope\n+}\n+\n+fn test_struct_2() {\n+    let _ = r#struct; //~ ERROR cannot find value `struct` in this scope\n+}\n+\n+fn test_union_2() {\n+    let _ = r#union; //~ ERROR cannot find value `union` in this scope\n }\n \n fn main() {}"}, {"sha": "f39e29cfaa800702aed2b729249dd29490f0f2ed", "filename": "src/test/ui/parser/raw/raw-literal-keywords.stderr", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fraw%2Fraw-literal-keywords.stderr?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -5,34 +5,34 @@ LL |     r#if true { }\n    |          ^^^^ expected one of 8 possible tokens here\n \n error: expected one of `!`, `.`, `::`, `;`, `?`, `{`, `}`, or an operator, found `Test`\n-  --> $DIR/raw-literal-keywords.rs:7:14\n+  --> $DIR/raw-literal-keywords.rs:6:14\n    |\n LL |     r#struct Test;\n    |              ^^^^ expected one of 8 possible tokens here\n \n error: expected one of `!`, `.`, `::`, `;`, `?`, `{`, `}`, or an operator, found `Test`\n-  --> $DIR/raw-literal-keywords.rs:12:13\n+  --> $DIR/raw-literal-keywords.rs:10:13\n    |\n LL |     r#union Test;\n    |             ^^^^ expected one of 8 possible tokens here\n \n error[E0425]: cannot find value `if` in this scope\n-  --> $DIR/raw-literal-keywords.rs:2:5\n+  --> $DIR/raw-literal-keywords.rs:14:13\n    |\n-LL |     r#if true { }\n-   |     ^^^^ not found in this scope\n+LL |     let _ = r#if;\n+   |             ^^^^ not found in this scope\n \n error[E0425]: cannot find value `struct` in this scope\n-  --> $DIR/raw-literal-keywords.rs:7:5\n+  --> $DIR/raw-literal-keywords.rs:18:13\n    |\n-LL |     r#struct Test;\n-   |     ^^^^^^^^ not found in this scope\n+LL |     let _ = r#struct;\n+   |             ^^^^^^^^ not found in this scope\n \n error[E0425]: cannot find value `union` in this scope\n-  --> $DIR/raw-literal-keywords.rs:12:5\n+  --> $DIR/raw-literal-keywords.rs:22:13\n    |\n-LL |     r#union Test;\n-   |     ^^^^^^^ not found in this scope\n+LL |     let _ = r#union;\n+   |             ^^^^^^^ not found in this scope\n \n error: aborting due to 6 previous errors\n "}, {"sha": "5b08234c0adc5e4b070048eebae2793e2d4797f7", "filename": "src/test/ui/resolve/token-error-correct-3.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.rs?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -15,7 +15,6 @@ pub mod raw {\n             callback(path.as_ref();\n             //~^ ERROR expected one of\n             fs::create_dir_all(path.as_ref()).map(|()| true)\n-            //~^ ERROR mismatched types\n         } else {\n             //~^ ERROR expected one of `.`, `;`, `?`, `}`, or an operator, found `)`\n             Ok(false);"}, {"sha": "57dd7c9f034337b7b2bbdfcf4153f76eb8c84e7c", "filename": "src/test/ui/resolve/token-error-correct-3.stderr", "status": "modified", "additions": 3, "deletions": 16, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8259a2dd425a94dbce00999027794f65806de831/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Ftoken-error-correct-3.stderr?ref=8259a2dd425a94dbce00999027794f65806de831", "patch": "@@ -7,11 +7,10 @@ LL |             callback(path.as_ref();\n    |                     unclosed delimiter\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `)`\n-  --> $DIR/token-error-correct-3.rs:19:9\n+  --> $DIR/token-error-correct-3.rs:18:9\n    |\n LL |             fs::create_dir_all(path.as_ref()).map(|()| true)\n    |                                                             - expected one of `.`, `;`, `?`, `}`, or an operator here\n-LL |\n LL |         } else {\n    |         ^ unexpected token\n \n@@ -21,18 +20,6 @@ error[E0425]: cannot find function `is_directory` in this scope\n LL |         if !is_directory(path.as_ref()) {\n    |             ^^^^^^^^^^^^ not found in this scope\n \n-error[E0308]: mismatched types\n-  --> $DIR/token-error-correct-3.rs:17:13\n-   |\n-LL |             fs::create_dir_all(path.as_ref()).map(|()| true)\n-   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^- help: try adding a semicolon: `;`\n-   |             |\n-   |             expected (), found enum `std::result::Result`\n-   |\n-   = note: expected type `()`\n-              found type `std::result::Result<bool, std::io::Error>`\n-\n-error: aborting due to 4 previous errors\n+error: aborting due to 3 previous errors\n \n-Some errors have detailed explanations: E0308, E0425.\n-For more information about an error, try `rustc --explain E0308`.\n+For more information about this error, try `rustc --explain E0425`."}]}