{"sha": "7721accebf5e2c39bd4cb984346b11b72c12ba56", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3MjFhY2NlYmY1ZTJjMzliZDRjYjk4NDM0NmIxMWI3MmMxMmJhNTY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-08-25T08:57:51Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-08-25T09:00:32Z"}, "message": "Cleanup invert-if\n\n* stick to trivial factory functions in make\n* compress the logic for inverting Option/Result", "tree": {"sha": "f23650fe42fdc32d81108ff891d17d0bb7b60b6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f23650fe42fdc32d81108ff891d17d0bb7b60b6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7721accebf5e2c39bd4cb984346b11b72c12ba56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7721accebf5e2c39bd4cb984346b11b72c12ba56", "html_url": "https://github.com/rust-lang/rust/commit/7721accebf5e2c39bd4cb984346b11b72c12ba56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7721accebf5e2c39bd4cb984346b11b72c12ba56/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef9cea945d5767e7c60d5931a7649a73caea23ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef9cea945d5767e7c60d5931a7649a73caea23ad", "html_url": "https://github.com/rust-lang/rust/commit/ef9cea945d5767e7c60d5931a7649a73caea23ad"}], "stats": {"total": 42, "additions": 17, "deletions": 25}, "files": [{"sha": "daa7b64f7da08e1b396bc9e554e926dfa09130e4", "filename": "crates/assists/src/utils.rs", "status": "modified", "additions": 14, "deletions": 19, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/7721accebf5e2c39bd4cb984346b11b72c12ba56/crates%2Fassists%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7721accebf5e2c39bd4cb984346b11b72c12ba56/crates%2Fassists%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Futils.rs?ref=7721accebf5e2c39bd4cb984346b11b72c12ba56", "patch": "@@ -8,10 +8,10 @@ use ide_db::RootDatabase;\n use itertools::Itertools;\n use rustc_hash::FxHashSet;\n use syntax::{\n-    ast::{self, make, NameOwner},\n+    ast::{self, make, ArgListOwner, NameOwner},\n     AstNode, Direction,\n     SyntaxKind::*,\n-    SyntaxNode, SyntaxText, TextSize, T,\n+    SyntaxNode, TextSize, T,\n };\n \n use crate::assist_config::SnippetCap;\n@@ -180,23 +180,18 @@ fn invert_special_case(expr: &ast::Expr) -> Option<ast::Expr> {\n             _ => None,\n         },\n         ast::Expr::MethodCallExpr(mce) => {\n-            const IS_SOME_TEXT: &str = \"is_some\";\n-            const IS_NONE_TEXT: &str = \"is_none\";\n-            const IS_OK_TEXT: &str = \"is_ok\";\n-            const IS_ERR_TEXT: &str = \"is_err\";\n-\n-            let name = mce.name_ref()?;\n-            let name_text = name.text();\n-\n-            let caller = || -> Option<SyntaxText> { Some(mce.receiver()?.syntax().text()) };\n-\n-            match name_text {\n-                x if x == IS_SOME_TEXT => make::expr_method_call(IS_NONE_TEXT, caller),\n-                x if x == IS_NONE_TEXT => make::expr_method_call(IS_SOME_TEXT, caller),\n-                x if x == IS_OK_TEXT => make::expr_method_call(IS_ERR_TEXT, caller),\n-                x if x == IS_ERR_TEXT => make::expr_method_call(IS_OK_TEXT, caller),\n-                _ => None,\n-            }\n+            let receiver = mce.receiver()?;\n+            let method = mce.name_ref()?;\n+            let arg_list = mce.arg_list()?;\n+\n+            let method = match method.text().as_str() {\n+                \"is_some\" => \"is_none\",\n+                \"is_none\" => \"is_some\",\n+                \"is_ok\" => \"is_err\",\n+                \"is_err\" => \"is_ok\",\n+                _ => return None,\n+            };\n+            Some(make::expr_method_call(receiver, method, arg_list))\n         }\n         ast::Expr::PrefixExpr(pe) if pe.op_kind()? == ast::PrefixOp::Not => pe.expr(),\n         // FIXME:"}, {"sha": "7ba6259900146a3242f27a17e775c74be90f95ca", "filename": "crates/syntax/src/ast/make.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7721accebf5e2c39bd4cb984346b11b72c12ba56/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7721accebf5e2c39bd4cb984346b11b72c12ba56/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs?ref=7721accebf5e2c39bd4cb984346b11b72c12ba56", "patch": "@@ -7,7 +7,7 @@\n use itertools::Itertools;\n use stdx::format_to;\n \n-use crate::{ast, AstNode, SourceFile, SyntaxKind, SyntaxNode, SyntaxText, SyntaxToken};\n+use crate::{ast, AstNode, SourceFile, SyntaxKind, SyntaxNode, SyntaxToken};\n \n pub fn name(text: &str) -> ast::Name {\n     ast_from_text(&format!(\"mod {};\", text))\n@@ -137,11 +137,8 @@ pub fn expr_prefix(op: SyntaxKind, expr: ast::Expr) -> ast::Expr {\n pub fn expr_call(f: ast::Expr, arg_list: ast::ArgList) -> ast::Expr {\n     expr_from_text(&format!(\"{}{}\", f, arg_list))\n }\n-pub fn expr_method_call<F>(text: &str, caller: F) -> Option<ast::Expr>\n-where\n-    F: FnOnce() -> Option<SyntaxText>,\n-{\n-    try_expr_from_text(&format!(\"{}.{}()\", caller()?, text))\n+pub fn expr_method_call(receiver: ast::Expr, method: &str, arg_list: ast::ArgList) -> ast::Expr {\n+    expr_from_text(&format!(\"{}.{}{}\", receiver, method, arg_list))\n }\n fn expr_from_text(text: &str) -> ast::Expr {\n     ast_from_text(&format!(\"const C: () = {};\", text))"}]}