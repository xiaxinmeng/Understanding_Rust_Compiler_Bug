{"sha": "411c0df1d09813e58e009db4cd0e0161b0de1d03", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxMWMwZGYxZDA5ODEzZTU4ZTAwOWRiNGNkMGUwMTYxYjBkZTFkMDM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-04-12T14:16:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-04-12T14:16:17Z"}, "message": "Auto merge of #7064 - ThibsG:WrongSelfFix, r=giraffate\n\nFix FP in `wrong_self_convention` lint\n\nPreviously, this lint didn't check into impl block when it was implementing a trait.\nRecent improvements (#6924) have moved this check and some impl blocks are now checked but they shouldn't, such as in #7032.\n\nFixes #7032\n\nchangelog: Fix FP when not taking `self` in impl block for `wrong_self_convention` lint", "tree": {"sha": "aa63cb93329c8e1707f8423d48550259d04d8a7b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa63cb93329c8e1707f8423d48550259d04d8a7b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/411c0df1d09813e58e009db4cd0e0161b0de1d03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/411c0df1d09813e58e009db4cd0e0161b0de1d03", "html_url": "https://github.com/rust-lang/rust/commit/411c0df1d09813e58e009db4cd0e0161b0de1d03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/411c0df1d09813e58e009db4cd0e0161b0de1d03/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3ef58532852921f5a4dca5ede8d945c89421216", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3ef58532852921f5a4dca5ede8d945c89421216", "html_url": "https://github.com/rust-lang/rust/commit/c3ef58532852921f5a4dca5ede8d945c89421216"}, {"sha": "3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "html_url": "https://github.com/rust-lang/rust/commit/3ce6f0d022014ba13ed328a372c1ac1f37d9045e"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "6e2bcb113c2c1baf6ba899e59a135db8482c7fa3", "filename": "clippy_lints/src/methods/wrong_self_convention.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/411c0df1d09813e58e009db4cd0e0161b0de1d03/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs", "raw_url": "https://github.com/rust-lang/rust/raw/411c0df1d09813e58e009db4cd0e0161b0de1d03/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs?ref=411c0df1d09813e58e009db4cd0e0161b0de1d03", "patch": "@@ -102,6 +102,14 @@ pub(super) fn check<'tcx>(\n             .iter()\n             .all(|conv| conv.check(cx, self_ty, item_name, implements_trait, is_trait_item))\n     }) {\n+        // don't lint if it implements a trait but not willing to check `Copy` types conventions (see #7032)\n+        if implements_trait\n+            && !conventions\n+                .iter()\n+                .any(|conv| matches!(conv, Convention::IsSelfTypeCopy(_)))\n+        {\n+            return;\n+        }\n         if !self_kinds.iter().any(|k| k.matches(cx, self_ty, first_arg_ty)) {\n             let suggestion = {\n                 if conventions.len() > 1 {"}, {"sha": "ae3a740d405d6fc103c8b2f33f8381cb6d6584cf", "filename": "tests/ui/wrong_self_convention2.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/411c0df1d09813e58e009db4cd0e0161b0de1d03/tests%2Fui%2Fwrong_self_convention2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/411c0df1d09813e58e009db4cd0e0161b0de1d03/tests%2Fui%2Fwrong_self_convention2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.rs?ref=411c0df1d09813e58e009db4cd0e0161b0de1d03", "patch": "@@ -30,3 +30,15 @@ mod issue6983 {\n         }\n     }\n }\n+\n+mod issue7032 {\n+    trait Foo {\n+        fn from_usize(x: usize) -> Self;\n+    }\n+    // don't trigger\n+    impl Foo for usize {\n+        fn from_usize(x: usize) -> Self {\n+            x\n+        }\n+    }\n+}"}]}