{"sha": "b5782bad743f596061e9c75d0a3f8a8ed8213b03", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1NzgyYmFkNzQzZjU5NjA2MWU5Yzc1ZDBhM2Y4YThlZDgyMTNiMDM=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-01T01:45:42Z"}, "committer": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-01T01:45:42Z"}, "message": "Catch a bad placeholder type error for statics in `extern`s", "tree": {"sha": "3168939ff1263d2f0cb4e2e3f34bc35b04c4e574", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3168939ff1263d2f0cb4e2e3f34bc35b04c4e574"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5782bad743f596061e9c75d0a3f8a8ed8213b03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5782bad743f596061e9c75d0a3f8a8ed8213b03", "html_url": "https://github.com/rust-lang/rust/commit/b5782bad743f596061e9c75d0a3f8a8ed8213b03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5782bad743f596061e9c75d0a3f8a8ed8213b03/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5029ac0ab372aec515db2e718da6d7787f3d122", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5029ac0ab372aec515db2e718da6d7787f3d122", "html_url": "https://github.com/rust-lang/rust/commit/a5029ac0ab372aec515db2e718da6d7787f3d122"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "479098a5a7acbfa525f3862ec644eecdc347102b", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b5782bad743f596061e9c75d0a3f8a8ed8213b03/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5782bad743f596061e9c75d0a3f8a8ed8213b03/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=b5782bad743f596061e9c75d0a3f8a8ed8213b03", "patch": "@@ -735,8 +735,14 @@ fn convert_item(tcx: TyCtxt<'_>, item_id: hir::ItemId) {\n                 tcx.ensure().generics_of(item.def_id);\n                 tcx.ensure().type_of(item.def_id);\n                 tcx.ensure().predicates_of(item.def_id);\n-                if let hir::ForeignItemKind::Fn(..) = item.kind {\n-                    tcx.ensure().fn_sig(item.def_id);\n+                match item.kind {\n+                    hir::ForeignItemKind::Fn(..) => tcx.ensure().fn_sig(item.def_id),\n+                    hir::ForeignItemKind::Static(..) => {\n+                        let mut visitor = PlaceholderHirTyCollector::default();\n+                        visitor.visit_foreign_item(item);\n+                        placeholder_type_error(tcx, None, &[], visitor.0, false, None);\n+                    }\n+                    _ => (),\n                 }\n             }\n         }"}, {"sha": "16ec2a546434c20fbe79ebfb10d1445eb65841ea", "filename": "src/test/ui/typeck/issue-83621-placeholder-static-in-extern.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b5782bad743f596061e9c75d0a3f8a8ed8213b03/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5782bad743f596061e9c75d0a3f8a8ed8213b03/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.rs?ref=b5782bad743f596061e9c75d0a3f8a8ed8213b03", "patch": "@@ -0,0 +1,7 @@\n+// Regression test for #83621.\n+\n+extern \"C\" {\n+    static x: _; //~ ERROR: [E0121]\n+}\n+\n+fn main() {}"}, {"sha": "b1bec4c0827f9255077a5e8112a504c7847782d9", "filename": "src/test/ui/typeck/issue-83621-placeholder-static-in-extern.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b5782bad743f596061e9c75d0a3f8a8ed8213b03/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b5782bad743f596061e9c75d0a3f8a8ed8213b03/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-83621-placeholder-static-in-extern.stderr?ref=b5782bad743f596061e9c75d0a3f8a8ed8213b03", "patch": "@@ -0,0 +1,9 @@\n+error[E0121]: the type placeholder `_` is not allowed within types on item signatures\n+  --> $DIR/issue-83621-placeholder-static-in-extern.rs:4:15\n+   |\n+LL |     static x: _;\n+   |               ^ not allowed in type signatures\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0121`."}]}