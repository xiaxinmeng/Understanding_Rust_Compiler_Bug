{"sha": "db113b1c2bc1b09eb370407e7b217249cd5d263b", "node_id": "C_kwDOAAsO6NoAKGRiMTEzYjFjMmJjMWIwOWViMzcwNDA3ZTdiMjE3MjQ5Y2Q1ZDI2M2I", "commit": {"author": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2023-06-01T06:29:19Z"}, "committer": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2023-06-01T06:29:19Z"}, "message": "Do not build components unneeded for perf bot in try builds", "tree": {"sha": "f77f459a2525c2553116ae3da5e138205c1895cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f77f459a2525c2553116ae3da5e138205c1895cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db113b1c2bc1b09eb370407e7b217249cd5d263b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEzFQynJm4WzBnfhz8kJzQ0mSDUWsFAmR4Or8ACgkQkJzQ0mSD\nUWuoOAwAlhs7ZNXl27TnebnY5rz8hDHa/DTGZcGUINN8/YQOql9LHMAmNxL/eCa6\nWKGX4eZERkky+r1QPTs+zCCbKO2krjs7EZXA7AUIKCmnkPHage3MJIDYoEqVJH/Q\nJGQ7772rgJk7Yss2JhiGqezimuVpRHh6RRy7UXkuT/aqjFTShyMcwL+Mw/gUh5UQ\nbY/yKvDpkkezVDAGs0j14gZYwPnI6a881g1+Bf8yzCc3RlF2h6M5cnENOhZwMAIQ\n97CmVzNmKc1YN1bMP/aF+AlX2i5Jb7lQdr83HJSdKr1Y3i3aEpbxDKcgG5UH8tBt\nlBa8CIkN0095jXXlIiAj2uE9m7Wcj3NcUgdDgEsstvLf5a6OEdi/XOLSrdTf1DIC\nKlYuNQxRTLmD0jnrq2E/s4s1ugC7U/gz57p+sRWgtjBLejgEfc/vWDMgdwMX0YRR\n6Qnt8kejiLNJoWfqTKcilUzBVvzrB3yj4W0pQ3ywpDJHN+C6QNIqJiB0ZCdkmZa7\nDaJpNBw3\n=JVsR\n-----END PGP SIGNATURE-----", "payload": "tree f77f459a2525c2553116ae3da5e138205c1895cf\nparent 871b5952023139738f72eba235063575062bc2e9\nauthor Jakub Ber\u00e1nek <berykubik@gmail.com> 1685600959 +0200\ncommitter Jakub Ber\u00e1nek <berykubik@gmail.com> 1685600959 +0200\n\nDo not build components unneeded for perf bot in try builds\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db113b1c2bc1b09eb370407e7b217249cd5d263b", "html_url": "https://github.com/rust-lang/rust/commit/db113b1c2bc1b09eb370407e7b217249cd5d263b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db113b1c2bc1b09eb370407e7b217249cd5d263b/comments", "author": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "871b5952023139738f72eba235063575062bc2e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/871b5952023139738f72eba235063575062bc2e9", "html_url": "https://github.com/rust-lang/rust/commit/871b5952023139738f72eba235063575062bc2e9"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "210ec72a11e0bc02bed73d36ccda1ec44e67b025", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/db113b1c2bc1b09eb370407e7b217249cd5d263b/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/db113b1c2bc1b09eb370407e7b217249cd5d263b/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=db113b1c2bc1b09eb370407e7b217249cd5d263b", "patch": "@@ -578,6 +578,7 @@ jobs:\n       actions: write\n     name: \"try - ${{ matrix.name }}\"\n     env:\n+      DIST_TRY_BUILD: 1\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n       CARGO_REGISTRIES_CRATES_IO_PROTOCOL: sparse\n       SCCACHE_BUCKET: rust-lang-ci-sccache2"}, {"sha": "2fe3438e0fe8a81bee3cc56ed10c30010b8162f7", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=db113b1c2bc1b09eb370407e7b217249cd5d263b", "patch": "@@ -264,6 +264,7 @@ docker \\\n   --env RUST_CI_OVERRIDE_RELEASE_CHANNEL \\\n   --env CI_JOB_NAME=\"${CI_JOB_NAME-$IMAGE}\" \\\n   --env BASE_COMMIT=\"$BASE_COMMIT\" \\\n+  --env DIST_TRY_BUILD \\\n   --init \\\n   --rm \\\n   rust-ci \\"}, {"sha": "d3cb6b6ed522031fc7b2ddbc0ba74bf0f782f60b", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=db113b1c2bc1b09eb370407e7b217249cd5d263b", "patch": "@@ -757,6 +757,7 @@ jobs:\n     <<: *base-ci-job\n     name: try - ${{ matrix.name }}\n     env:\n+      DIST_TRY_BUILD: 1\n       <<: [*shared-ci-variables, *prod-variables]\n     if: github.event_name == 'push' && (github.ref == 'refs/heads/try' || github.ref == 'refs/heads/try-perf') && github.repository == 'rust-lang-ci/rust'\n     strategy:"}, {"sha": "bf0ef15f5eacfa6f0fb2830128d59973c2a3482e", "filename": "src/ci/stage-build.py", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fstage-build.py", "raw_url": "https://github.com/rust-lang/rust/raw/db113b1c2bc1b09eb370407e7b217249cd5d263b/src%2Fci%2Fstage-build.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fstage-build.py?ref=db113b1c2bc1b09eb370407e7b217249cd5d263b", "patch": "@@ -48,6 +48,11 @@\n \n LLVM_BOLT_CRATES = LLVM_PGO_CRATES\n \n+\n+def is_try_build() -> bool:\n+    return os.environ.get(\"DIST_TRY_BUILD\", \"0\") != \"0\"\n+\n+\n class Pipeline:\n     # Paths\n     def checkout_path(self) -> Path:\n@@ -851,6 +856,13 @@ def run(runner: BenchmarkRunner):\n \n     build_args = sys.argv[1:]\n \n+    # Skip components that are not needed for try builds to speed them up\n+    if is_try_build():\n+        LOGGER.info(\"Skipping building of unimportant components for a try build\")\n+        for target in (\"rust-docs\", \"rustc-docs\", \"rust-docs-json\", \"rust-analyzer\",\n+                       \"rustc-src\", \"clippy\", \"miri\", \"rustfmt\"):\n+            build_args.extend([\"--exclude\", target])\n+\n     timer = Timer()\n     pipeline = create_pipeline()\n \n@@ -865,6 +877,7 @@ def run(runner: BenchmarkRunner):\n \n     print_binary_sizes(pipeline)\n \n+\n if __name__ == \"__main__\":\n     runner = DefaultBenchmarkRunner()\n     run(runner)"}]}