{"sha": "69d68f90964a46e479eec02a4d9c45aaaa45b411", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5ZDY4ZjkwOTY0YTQ2ZTQ3OWVlYzAyYTRkOWM0NWFhYWE0NWI0MTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-22T13:40:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-22T13:40:55Z"}, "message": "Auto merge of #74620 - rust-lang:remove-most-azure, r=Mark-Simulacrum\n\nDisable Azure Pipelines except for macOS\n\nFollowing up on https://github.com/rust-lang/rust/pull/74565, this PR disables most of Azure Pipelines except for macOS auto builds, practically switching us to GitHub Actions :tada:\n\nr? @Mark-Simulacrum", "tree": {"sha": "675f8c66d87d0b73647259016b12fad11e4393da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/675f8c66d87d0b73647259016b12fad11e4393da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69d68f90964a46e479eec02a4d9c45aaaa45b411", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69d68f90964a46e479eec02a4d9c45aaaa45b411", "html_url": "https://github.com/rust-lang/rust/commit/69d68f90964a46e479eec02a4d9c45aaaa45b411", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69d68f90964a46e479eec02a4d9c45aaaa45b411/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e22b61bff0bdd08be7665607cb7be3748c8a35d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e22b61bff0bdd08be7665607cb7be3748c8a35d2", "html_url": "https://github.com/rust-lang/rust/commit/e22b61bff0bdd08be7665607cb7be3748c8a35d2"}, {"sha": "ffd112250e254a46255ebc7e94c7e9a9a7d9c905", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffd112250e254a46255ebc7e94c7e9a9a7d9c905", "html_url": "https://github.com/rust-lang/rust/commit/ffd112250e254a46255ebc7e94c7e9a9a7d9c905"}], "stats": {"total": 301, "additions": 3, "deletions": 298}, "files": [{"sha": "06e284c763c1509f7c34b38d3edc5e0198ff158c", "filename": "src/ci/azure-pipelines/auto.yml", "status": "modified", "additions": 1, "deletions": 168, "changes": 169, "blob_url": "https://github.com/rust-lang/rust/blob/69d68f90964a46e479eec02a4d9c45aaaa45b411/src%2Fci%2Fazure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/69d68f90964a46e479eec02a4d9c45aaaa45b411/src%2Fci%2Fazure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fauto.yml?ref=69d68f90964a46e479eec02a4d9c45aaaa45b411", "patch": "@@ -10,69 +10,14 @@\n #####################################\n \n #\n-# Azure Pipelines \"auto\" branch build for Rust on Linux, macOS, and Windows.\n+# Azure Pipelines \"auto\" branch build for Rust on macOS\n #\n \n pr: none\n trigger:\n   - auto\n \n-variables:\n-- group: dummy-credentials\n-\n jobs:\n-- job: Linux\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: ubuntu-16.04\n-  steps:\n-  - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      x86_64-gnu-llvm-8:\n-        RUST_BACKTRACE: 1\n-      dist-x86_64-linux: {}\n-      dist-x86_64-linux-alt:\n-        IMAGE: dist-x86_64-linux\n-      arm-android: {}\n-      armhf-gnu: {}\n-      dist-various-1: {}\n-      dist-various-2: {}\n-      dist-aarch64-linux: {}\n-      dist-android: {}\n-      dist-arm-linux: {}\n-      dist-armhf-linux: {}\n-      dist-armv7-linux: {}\n-      dist-i586-gnu-i586-i686-musl: {}\n-      dist-i686-freebsd: {}\n-      dist-i686-linux: {}\n-      dist-mips-linux: {}\n-      dist-mips64-linux: {}\n-      dist-mips64el-linux: {}\n-      dist-mipsel-linux: {}\n-      dist-powerpc-linux: {}\n-      dist-powerpc64-linux: {}\n-      dist-powerpc64le-linux: {}\n-      dist-riscv64-linux: {}\n-      dist-s390x-linux: {}\n-      dist-x86_64-freebsd: {}\n-      dist-x86_64-illumos: {}\n-      dist-x86_64-musl: {}\n-      dist-x86_64-netbsd: {}\n-      i686-gnu: {}\n-      i686-gnu-nopt: {}\n-      test-various: {}\n-      wasm32: {}\n-      x86_64-gnu: {}\n-      x86_64-gnu-full-bootstrap: {}\n-      x86_64-gnu-aux: {}\n-      x86_64-gnu-tools:\n-        DEPLOY_TOOLSTATES_JSON: toolstates-linux.json\n-      x86_64-gnu-debug: {}\n-      x86_64-gnu-nopt: {}\n-      x86_64-gnu-distcheck: {}\n-      mingw-check: {}\n-\n - job: macOS\n   timeoutInMinutes: 600\n   pool:\n@@ -115,115 +60,3 @@ jobs:\n         MACOSX_DEPLOYMENT_TARGET: 10.7\n         NO_LLVM_ASSERTIONS: 1\n         NO_DEBUG_ASSERTIONS: 1\n-\n-\n-- job: Windows\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: 'vs2017-win2016'\n-  steps:\n-  - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      # 32/64 bit MSVC tests\n-      x86_64-msvc-1:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n-        SCRIPT: make ci-subset-1\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      x86_64-msvc-2:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n-        SCRIPT: make ci-subset-2\n-      i686-msvc-1:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n-        SCRIPT: make ci-subset-1\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      i686-msvc-2:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n-        SCRIPT: make ci-subset-2\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      x86_64-msvc-cargo:\n-        SCRIPT: python x.py test src/tools/cargotest src/tools/cargo\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-lld\n-        VCVARS_BAT: vcvars64.bat\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      # MSVC tools tests\n-      x86_64-msvc-tools:\n-        SCRIPT: src/ci/docker/host-x86_64/x86_64-gnu-tools/checktools.sh x.py\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --save-toolstates=/tmp/toolstate/toolstates.json\n-\n-      # 32/64-bit MinGW builds.\n-      #\n-      # We are using MinGW with posix threads since LLVM does not compile with\n-      # the win32 threads version due to missing support for C++'s std::thread.\n-      #\n-      # Instead of relying on the MinGW version installed on appveryor we download\n-      # and install one ourselves so we won't be surprised by changes to appveyor's\n-      # build image.\n-      #\n-      # Finally, note that the downloads below are all in the `rust-lang-ci` S3\n-      # bucket, but they cleraly didn't originate there! The downloads originally\n-      # came from the mingw-w64 SourceForge download site. Unfortunately\n-      # SourceForge is notoriously flaky, so we mirror it on our own infrastructure.\n-      i686-mingw-1:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n-        SCRIPT: make ci-mingw-subset-1\n-        CUSTOM_MINGW: 1\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      i686-mingw-2:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n-        SCRIPT: make ci-mingw-subset-2\n-        CUSTOM_MINGW: 1\n-      x86_64-mingw-1:\n-        SCRIPT: make ci-mingw-subset-1\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n-        CUSTOM_MINGW: 1\n-        # FIXME(#59637)\n-        NO_DEBUG_ASSERTIONS: 1\n-        NO_LLVM_ASSERTIONS: 1\n-      x86_64-mingw-2:\n-        SCRIPT: make ci-mingw-subset-2\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu\n-        CUSTOM_MINGW: 1\n-\n-      # 32/64 bit MSVC and GNU deployment\n-      dist-x86_64-msvc:\n-        INITIAL_RUST_CONFIGURE_ARGS: >-\n-          --build=x86_64-pc-windows-msvc\n-          --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n-          --enable-full-tools\n-          --enable-profiler\n-        SCRIPT: python x.py dist\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-      dist-i686-msvc:\n-        INITIAL_RUST_CONFIGURE_ARGS: >-\n-          --build=i686-pc-windows-msvc\n-          --target=i586-pc-windows-msvc\n-          --enable-full-tools\n-          --enable-profiler\n-        SCRIPT: python x.py dist\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-      dist-i686-mingw:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu --enable-full-tools --enable-profiler\n-        SCRIPT: python x.py dist\n-        CUSTOM_MINGW: 1\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-      dist-x86_64-mingw:\n-        SCRIPT: python x.py dist\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-full-tools --enable-profiler\n-        CUSTOM_MINGW: 1\n-        DIST_REQUIRE_ALL_TOOLS: 1\n-\n-      # \"alternate\" deployment, see .travis.yml for more info\n-      dist-x86_64-msvc-alt:\n-        INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended --enable-profiler\n-        SCRIPT: python x.py dist"}, {"sha": "13c55610e1a46afb6fecf64c2a6c4ff93df36c64", "filename": "src/ci/azure-pipelines/master.yml", "status": "removed", "additions": 0, "deletions": 33, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/e22b61bff0bdd08be7665607cb7be3748c8a35d2/src%2Fci%2Fazure-pipelines%2Fmaster.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e22b61bff0bdd08be7665607cb7be3748c8a35d2/src%2Fci%2Fazure-pipelines%2Fmaster.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fmaster.yml?ref=e22b61bff0bdd08be7665607cb7be3748c8a35d2", "patch": "@@ -1,33 +0,0 @@\n-#####################################\n-##    READ BEFORE CHANGING THIS    ##\n-#####################################\n-\n-# We're in the process of evaluating GitHub Actions as a possible replacement\n-# for Azure Pipelines, and at the moment the configuration is duplicated\n-# between the two CI providers. Be sure to also change the configuration in\n-# src/ci/github-actions when changing this file.\n-\n-#####################################\n-\n-#\n-# Azure Pipelines job to publish toolstate. Only triggers on pushes to master.\n-#\n-\n-pr: none\n-trigger:\n-  - master\n-\n-variables:\n-- group: dummy-credentials\n-\n-pool:\n-  vmImage: ubuntu-16.04\n-\n-steps:\n-- checkout: self\n-  fetchDepth: 2\n-\n-- script: src/ci/publish_toolstate.sh\n-  displayName: Publish toolstate\n-  env:\n-    TOOLSTATE_REPO_ACCESS_TOKEN: $(TOOLSTATE_REPO_ACCESS_TOKEN)"}, {"sha": "1fc8d187242f8cacc16df7c7c6f170e83cb7b733", "filename": "src/ci/azure-pipelines/pr.yml", "status": "removed", "additions": 0, "deletions": 35, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/e22b61bff0bdd08be7665607cb7be3748c8a35d2/src%2Fci%2Fazure-pipelines%2Fpr.yml", "raw_url": "https://github.com/rust-lang/rust/raw/e22b61bff0bdd08be7665607cb7be3748c8a35d2/src%2Fci%2Fazure-pipelines%2Fpr.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fpr.yml?ref=e22b61bff0bdd08be7665607cb7be3748c8a35d2", "patch": "@@ -1,35 +0,0 @@\n-#####################################\n-##    READ BEFORE CHANGING THIS    ##\n-#####################################\n-\n-# We're in the process of evaluating GitHub Actions as a possible replacement\n-# for Azure Pipelines, and at the moment the configuration is duplicated\n-# between the two CI providers. Be sure to also change the configuration in\n-# src/ci/github-actions when changing this file.\n-\n-#####################################\n-\n-#\n-# Azure Pipelines pull request build for Rust\n-#\n-\n-trigger: none\n-pr:\n-- master\n-\n-variables:\n-- group: public-credentials\n-\n-jobs:\n-- job: Linux\n-  timeoutInMinutes: 600\n-  pool:\n-    vmImage: ubuntu-16.04\n-  steps:\n-    - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      x86_64-gnu-llvm-8: {}\n-      mingw-check: {}\n-      x86_64-gnu-tools:\n-        CI_ONLY_WHEN_SUBMODULES_CHANGED: 1"}, {"sha": "62bb6f47334123f79f34d6d77bd552ba99ea2900", "filename": "src/ci/azure-pipelines/try.yml", "status": "modified", "additions": 2, "deletions": 62, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/69d68f90964a46e479eec02a4d9c45aaaa45b411/src%2Fci%2Fazure-pipelines%2Ftry.yml", "raw_url": "https://github.com/rust-lang/rust/raw/69d68f90964a46e479eec02a4d9c45aaaa45b411/src%2Fci%2Fazure-pipelines%2Ftry.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Ftry.yml?ref=69d68f90964a46e479eec02a4d9c45aaaa45b411", "patch": "@@ -13,70 +13,10 @@ pr: none\n trigger:\n - try\n \n-variables:\n-- group: dummy-credentials\n-\n jobs:\n-- job: Linux\n+- job: Dummy\n   timeoutInMinutes: 600\n   pool:\n     vmImage: ubuntu-16.04\n   steps:\n-  - template: steps/run.yml\n-  strategy:\n-    matrix:\n-      dist-x86_64-linux: {}\n-\n-# The macOS and Windows builds here are currently disabled due to them not being\n-# overly necessary on `try` builds. We also don't actually have anything that\n-# consumes the artifacts currently. Perhaps one day we can re-enable, but for now\n-# it helps free up capacity on Azure.\n-# - job: macOS\n-#   timeoutInMinutes: 600\n-#   pool:\n-#     vmImage: macos-10.15\n-#   steps:\n-#   - template: steps/run.yml\n-#   strategy:\n-#     matrix:\n-#       dist-x86_64-apple:\n-#         SCRIPT: ./x.py dist\n-#         INITIAL_RUST_CONFIGURE_ARGS: --target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios --enable-full-tools --enable-sanitizers --enable-profiler --set rust.jemalloc\n-#         DEPLOY: 1\n-#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-#         MACOSX_DEPLOYMENT_TARGET: 10.7\n-#         NO_LLVM_ASSERTIONS: 1\n-#         NO_DEBUG_ASSERTIONS: 1\n-#         DIST_REQUIRE_ALL_TOOLS: 1\n-#\n-#       dist-x86_64-apple-alt:\n-#         SCRIPT: ./x.py dist\n-#         INITIAL_RUST_CONFIGURE_ARGS: --enable-extended --enable-profiler --set rust.jemalloc\n-#         DEPLOY_ALT: 1\n-#         RUSTC_RETRY_LINKER_ON_SEGFAULT: 1\n-#         MACOSX_DEPLOYMENT_TARGET: 10.7\n-#         NO_LLVM_ASSERTIONS: 1\n-#         NO_DEBUG_ASSERTIONS: 1\n-#\n-# - job: Windows\n-#   timeoutInMinutes: 600\n-#   pool:\n-#     vmImage: 'vs2017-win2016'\n-#   steps:\n-#   - template: steps/run.yml\n-#   strategy:\n-#     matrix:\n-#       dist-x86_64-msvc:\n-#         INITIAL_RUST_CONFIGURE_ARGS: >\n-#           --build=x86_64-pc-windows-msvc\n-#           --target=x86_64-pc-windows-msvc,aarch64-pc-windows-msvc\n-#           --enable-full-tools\n-#           --enable-profiler\n-#         SCRIPT: python x.py dist\n-#         DIST_REQUIRE_ALL_TOOLS: 1\n-#         DEPLOY: 1\n-#\n-#       dist-x86_64-msvc-alt:\n-#         INITIAL_RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended --enable-profiler\n-#         SCRIPT: python x.py dist\n-#         DEPLOY_ALT: 1\n+  - bash: echo \"We're running this job since bors is still gating on Azure\""}]}