{"sha": "e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxYzU5ODI4YjRmZDFmMjA0OWI5ZWMyMWQ2NTdjMmFkZGEyZmU1NWQ=", "commit": {"author": {"name": "Niels langager Ellegaard", "email": "niels.ellegaard@gmail.com", "date": "2014-01-05T09:24:08Z"}, "committer": {"name": "Niels langager Ellegaard", "email": "niels.ellegaard@gmail.com", "date": "2014-01-05T10:25:12Z"}, "message": "Move syslog to BuildContext", "tree": {"sha": "263319aa6d186016737ee38d1755e9ece313c962", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/263319aa6d186016737ee38d1755e9ece313c962"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "html_url": "https://github.com/rust-lang/rust/commit/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/comments", "author": {"login": "nielsle", "id": 292118, "node_id": "MDQ6VXNlcjI5MjExOA==", "avatar_url": "https://avatars.githubusercontent.com/u/292118?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nielsle", "html_url": "https://github.com/nielsle", "followers_url": "https://api.github.com/users/nielsle/followers", "following_url": "https://api.github.com/users/nielsle/following{/other_user}", "gists_url": "https://api.github.com/users/nielsle/gists{/gist_id}", "starred_url": "https://api.github.com/users/nielsle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nielsle/subscriptions", "organizations_url": "https://api.github.com/users/nielsle/orgs", "repos_url": "https://api.github.com/users/nielsle/repos", "events_url": "https://api.github.com/users/nielsle/events{/privacy}", "received_events_url": "https://api.github.com/users/nielsle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nielsle", "id": 292118, "node_id": "MDQ6VXNlcjI5MjExOA==", "avatar_url": "https://avatars.githubusercontent.com/u/292118?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nielsle", "html_url": "https://github.com/nielsle", "followers_url": "https://api.github.com/users/nielsle/followers", "following_url": "https://api.github.com/users/nielsle/following{/other_user}", "gists_url": "https://api.github.com/users/nielsle/gists{/gist_id}", "starred_url": "https://api.github.com/users/nielsle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nielsle/subscriptions", "organizations_url": "https://api.github.com/users/nielsle/orgs", "repos_url": "https://api.github.com/users/nielsle/repos", "events_url": "https://api.github.com/users/nielsle/events{/privacy}", "received_events_url": "https://api.github.com/users/nielsle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "177f740311639165fb1464688752c01a039fa577", "url": "https://api.github.com/repos/rust-lang/rust/commits/177f740311639165fb1464688752c01a039fa577", "html_url": "https://github.com/rust-lang/rust/commit/177f740311639165fb1464688752c01a039fa577"}], "stats": {"total": 52, "additions": 20, "deletions": 32}, "files": [{"sha": "45c37a93e3e1e767efd036ec8d3ac7230f23b86c", "filename": "src/librustpkg/api.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Fapi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Fapi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fapi.rs?ref=e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "patch": "@@ -49,8 +49,8 @@ pub fn new_default_context(c: workcache::Context, p: Path) -> BuildContext {\n             cfgs: ~[],\n             rustc_flags: RustcFlags::default(),\n             use_rust_path_hack: false,\n-            sysroot: p\n         },\n+        sysroot: p,\n         workcache_context: c\n     }\n }"}, {"sha": "fddfa02032cc465df16b1429c9316baa5154bc8f", "filename": "src/librustpkg/context.rs", "status": "modified", "additions": 16, "deletions": 28, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fcontext.rs?ref=e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "patch": "@@ -26,25 +26,35 @@ pub struct Context {\n     // FOO/src/bar-0.1 instead of FOO). The flag doesn't affect where\n     // rustpkg stores build artifacts.\n     use_rust_path_hack: bool,\n-    // The root directory containing the Rust standard libraries\n-    sysroot: Path\n }\n \n #[deriving(Clone)]\n pub struct BuildContext {\n     // Context for workcache\n     workcache_context: workcache::Context,\n-    // Everything else\n-    context: Context\n+    // Parsed command line options\n+    context: Context,\n+    // The root directory containing the Rust standard libraries\n+    sysroot: Path\n }\n \n impl BuildContext {\n     pub fn sysroot(&self) -> Path {\n-        self.context.sysroot.clone()\n+        self.sysroot.clone()\n     }\n \n+    // Hack so that rustpkg can run either out of a rustc target dir,\n+    // or the host dir\n     pub fn sysroot_to_use(&self) -> Path {\n-        self.context.sysroot_to_use()\n+        if !in_target(&self.sysroot) {\n+            self.sysroot.clone()\n+        } else {\n+            let mut p = self.sysroot.clone();\n+            p.pop();\n+            p.pop();\n+            p.pop();\n+            p\n+        }\n     }\n \n     /// Returns the flags to pass to rustc, as a vector of strings\n@@ -131,28 +141,6 @@ pub enum StopBefore {\n }\n \n impl Context {\n-    pub fn sysroot(&self) -> Path {\n-        self.sysroot.clone()\n-    }\n-\n-    /// Debugging\n-    pub fn sysroot_str(&self) -> ~str {\n-        self.sysroot.as_str().unwrap().to_owned()\n-    }\n-\n-    // Hack so that rustpkg can run either out of a rustc target dir,\n-    // or the host dir\n-    pub fn sysroot_to_use(&self) -> Path {\n-        if !in_target(&self.sysroot) {\n-            self.sysroot.clone()\n-        } else {\n-            let mut p = self.sysroot.clone();\n-            p.pop();\n-            p.pop();\n-            p.pop();\n-            p\n-        }\n-    }\n \n     /// Returns the flags to pass to rustc, as a vector of strings\n     pub fn flag_strs(&self) -> ~[~str] {"}, {"sha": "39bc4c7570e524fe53bd82323b917f226a448cfc", "filename": "src/librustpkg/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Flib.rs?ref=e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "patch": "@@ -913,8 +913,8 @@ pub fn main_args(args: &[~str]) -> int {\n                 cfgs: cfgs.clone(),\n                 rustc_flags: rustc_flags.clone(),\n                 use_rust_path_hack: use_rust_path_hack,\n-                sysroot: sroot.clone(), // Currently, only tests override this\n             },\n+            sysroot: sroot.clone(), // Currently, only tests override this\n             workcache_context: api::default_context(sroot.clone(),\n                                                     default_workspace()).workcache_context\n         }.run(command, rm_args.clone())"}, {"sha": "aa6dab05addd537003cb5ce66684479c776983c3", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1c59828b4fd1f2049b9ec21d657c2adda2fe55d/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=e1c59828b4fd1f2049b9ec21d657c2adda2fe55d", "patch": "@@ -54,8 +54,8 @@ fn fake_ctxt(sysroot: Path, workspace: &Path) -> BuildContext {\n             rustc_flags: RustcFlags::default(),\n \n             use_rust_path_hack: false,\n-            sysroot: sysroot\n-        }\n+        },\n+        sysroot: sysroot\n     }\n }\n "}]}