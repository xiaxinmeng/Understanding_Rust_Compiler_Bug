{"sha": "04f425d2c31ea0ef022793a3fdcb8af84d471b86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZjQyNWQyYzMxZWEwZWYwMjI3OTNhM2ZkY2I4YWY4NGQ0NzFiODY=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2019-02-01T14:15:43Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2019-02-12T14:10:29Z"}, "message": "Stabilize linker-plugin based LTO.", "tree": {"sha": "a57c5d535bf6cdbed732223013da3f9907ea6b78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a57c5d535bf6cdbed732223013da3f9907ea6b78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04f425d2c31ea0ef022793a3fdcb8af84d471b86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04f425d2c31ea0ef022793a3fdcb8af84d471b86", "html_url": "https://github.com/rust-lang/rust/commit/04f425d2c31ea0ef022793a3fdcb8af84d471b86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04f425d2c31ea0ef022793a3fdcb8af84d471b86/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a54b5c7a645ead203d77e78245362f9e0f00dd3c", "url": "https://api.github.com/repos/rust-lang/rust/commits/a54b5c7a645ead203d77e78245362f9e0f00dd3c", "html_url": "https://github.com/rust-lang/rust/commit/a54b5c7a645ead203d77e78245362f9e0f00dd3c"}], "stats": {"total": 120, "additions": 61, "deletions": 59}, "files": [{"sha": "2130314b5eae6f7c62e7cd0b27560b6dd65b700e", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 23, "deletions": 21, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -96,18 +96,18 @@ pub enum LtoCli {\n }\n \n #[derive(Clone, PartialEq, Hash)]\n-pub enum CrossLangLto {\n+pub enum LinkerPluginLto {\n     LinkerPlugin(PathBuf),\n     LinkerPluginAuto,\n     Disabled\n }\n \n-impl CrossLangLto {\n+impl LinkerPluginLto {\n     pub fn enabled(&self) -> bool {\n         match *self {\n-            CrossLangLto::LinkerPlugin(_) |\n-            CrossLangLto::LinkerPluginAuto => true,\n-            CrossLangLto::Disabled => false,\n+            LinkerPluginLto::LinkerPlugin(_) |\n+            LinkerPluginLto::LinkerPluginAuto => true,\n+            LinkerPluginLto::Disabled => false,\n         }\n     }\n }\n@@ -812,7 +812,7 @@ macro_rules! options {\n         pub const parse_lto: Option<&str> =\n             Some(\"either a boolean (`yes`, `no`, `on`, `off`, etc), `thin`, \\\n                   `fat`, or omitted\");\n-        pub const parse_cross_lang_lto: Option<&str> =\n+        pub const parse_linker_plugin_lto: Option<&str> =\n             Some(\"either a boolean (`yes`, `no`, `on`, `off`, etc), \\\n                   or the path to the linker plugin\");\n         pub const parse_merge_functions: Option<&str> =\n@@ -821,7 +821,7 @@ macro_rules! options {\n \n     #[allow(dead_code)]\n     mod $mod_set {\n-        use super::{$struct_name, Passes, Sanitizer, LtoCli, CrossLangLto};\n+        use super::{$struct_name, Passes, Sanitizer, LtoCli, LinkerPluginLto};\n         use rustc_target::spec::{LinkerFlavor, MergeFunctions, PanicStrategy, RelroLevel};\n         use std::path::PathBuf;\n         use std::str::FromStr;\n@@ -1037,22 +1037,22 @@ macro_rules! options {\n             true\n         }\n \n-        fn parse_cross_lang_lto(slot: &mut CrossLangLto, v: Option<&str>) -> bool {\n+        fn parse_linker_plugin_lto(slot: &mut LinkerPluginLto, v: Option<&str>) -> bool {\n             if v.is_some() {\n                 let mut bool_arg = None;\n                 if parse_opt_bool(&mut bool_arg, v) {\n                     *slot = if bool_arg.unwrap() {\n-                        CrossLangLto::LinkerPluginAuto\n+                        LinkerPluginLto::LinkerPluginAuto\n                     } else {\n-                        CrossLangLto::Disabled\n+                        LinkerPluginLto::Disabled\n                     };\n                     return true\n                 }\n             }\n \n             *slot = match v {\n-                None => CrossLangLto::LinkerPluginAuto,\n-                Some(path) => CrossLangLto::LinkerPlugin(PathBuf::from(path)),\n+                None => LinkerPluginLto::LinkerPluginAuto,\n+                Some(path) => LinkerPluginLto::LinkerPlugin(PathBuf::from(path)),\n             };\n             true\n         }\n@@ -1145,6 +1145,10 @@ options! {CodegenOptions, CodegenSetter, basic_codegen_options,\n         \"allow the linker to link its default libraries\"),\n     linker_flavor: Option<LinkerFlavor> = (None, parse_linker_flavor, [UNTRACKED],\n                                            \"Linker flavor\"),\n+    linker_plugin_lto: LinkerPluginLto = (LinkerPluginLto::Disabled,\n+        parse_linker_plugin_lto, [TRACKED],\n+        \"generate build artifacts that are compatible with linker-based LTO.\"),\n+\n }\n \n options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n@@ -1383,8 +1387,6 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"make the current crate share its generic instantiations\"),\n     chalk: bool = (false, parse_bool, [TRACKED],\n         \"enable the experimental Chalk-based trait solving engine\"),\n-    cross_lang_lto: CrossLangLto = (CrossLangLto::Disabled, parse_cross_lang_lto, [TRACKED],\n-        \"generate build artifacts that are compatible with linker-based LTO.\"),\n     no_parallel_llvm: bool = (false, parse_bool, [UNTRACKED],\n         \"don't run LLVM in parallel (while keeping codegen-units and ThinLTO)\"),\n     no_leak_check: bool = (false, parse_bool, [UNTRACKED],\n@@ -2440,7 +2442,7 @@ mod dep_tracking {\n     use std::path::PathBuf;\n     use std::collections::hash_map::DefaultHasher;\n     use super::{CrateType, DebugInfo, ErrorOutputType, OptLevel, OutputTypes,\n-                Passes, Sanitizer, LtoCli, CrossLangLto};\n+                Passes, Sanitizer, LtoCli, LinkerPluginLto};\n     use syntax::feature_gate::UnstableFeatures;\n     use rustc_target::spec::{MergeFunctions, PanicStrategy, RelroLevel, TargetTriple};\n     use syntax::edition::Edition;\n@@ -2507,7 +2509,7 @@ mod dep_tracking {\n     impl_dep_tracking_hash_via_hash!(Option<Sanitizer>);\n     impl_dep_tracking_hash_via_hash!(TargetTriple);\n     impl_dep_tracking_hash_via_hash!(Edition);\n-    impl_dep_tracking_hash_via_hash!(CrossLangLto);\n+    impl_dep_tracking_hash_via_hash!(LinkerPluginLto);\n \n     impl_dep_tracking_hash_for_sortable_vec_of!(String);\n     impl_dep_tracking_hash_for_sortable_vec_of!(PathBuf);\n@@ -2572,7 +2574,7 @@ mod tests {\n     use crate::lint;\n     use crate::middle::cstore;\n     use crate::session::config::{build_configuration, build_session_options_and_crate_config};\n-    use crate::session::config::{LtoCli, CrossLangLto};\n+    use crate::session::config::{LtoCli, LinkerPluginLto};\n     use crate::session::build_session;\n     use crate::session::search_paths::SearchPath;\n     use std::collections::{BTreeMap, BTreeSet};\n@@ -3105,6 +3107,10 @@ mod tests {\n         opts = reference.clone();\n         opts.cg.panic = Some(PanicStrategy::Abort);\n         assert!(reference.dep_tracking_hash() != opts.dep_tracking_hash());\n+\n+        opts = reference.clone();\n+        opts.cg.linker_plugin_lto = LinkerPluginLto::LinkerPluginAuto;\n+        assert!(reference.dep_tracking_hash() != opts.dep_tracking_hash());\n     }\n \n     #[test]\n@@ -3231,10 +3237,6 @@ mod tests {\n         opts.debugging_opts.relro_level = Some(RelroLevel::Full);\n         assert!(reference.dep_tracking_hash() != opts.dep_tracking_hash());\n \n-        opts = reference.clone();\n-        opts.debugging_opts.cross_lang_lto = CrossLangLto::LinkerPluginAuto;\n-        assert!(reference.dep_tracking_hash() != opts.dep_tracking_hash());\n-\n         opts = reference.clone();\n         opts.debugging_opts.merge_functions = Some(MergeFunctions::Disabled);\n         assert!(reference.dep_tracking_hash() != opts.dep_tracking_hash());"}, {"sha": "e4b293558e5922da8f9d1228f26d424af99a6d30", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -1267,7 +1267,7 @@ fn validate_commandline_args_with_session_available(sess: &Session) {\n     // bitcode during ThinLTO. Therefore we disallow dynamic linking on MSVC\n     // when compiling for LLD ThinLTO. This way we can validly just not generate\n     // the `dllimport` attributes and `__imp_` symbols in that case.\n-    if sess.opts.debugging_opts.cross_lang_lto.enabled() &&\n+    if sess.opts.cg.linker_plugin_lto.enabled() &&\n        sess.opts.cg.prefer_dynamic &&\n        sess.target.target.options.is_like_msvc {\n         sess.err(\"Linker plugin based LTO is not supported together with \\"}, {"sha": "8bb985ecc25fa7676a3ae77decbcaeac24e8b25e", "filename": "src/librustc_codegen_llvm/back/link.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -857,7 +857,7 @@ fn link_args(cmd: &mut dyn Linker,\n              codegen_results: &CodegenResults) {\n \n     // Linker plugins should be specified early in the list of arguments\n-    cmd.cross_lang_lto();\n+    cmd.linker_plugin_lto();\n \n     // The default library location, we need this to find the runtime.\n     // The location of crates will be determined as needed.\n@@ -1491,7 +1491,7 @@ fn are_upstream_rust_objects_already_included(sess: &Session) -> bool {\n         Lto::Thin => {\n             // If we defer LTO to the linker, we haven't run LTO ourselves, so\n             // any upstream object files have not been copied yet.\n-            !sess.opts.debugging_opts.cross_lang_lto.enabled()\n+            !sess.opts.cg.linker_plugin_lto.enabled()\n         }\n         Lto::No |\n         Lto::ThinLocal => false,"}, {"sha": "b6b880c7ec4aceda3019365bf35f401371a4e032", "filename": "src/librustc_codegen_llvm/back/lto.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flto.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -159,7 +159,7 @@ pub(crate) fn run_thin(cgcx: &CodegenContext<LlvmCodegenBackend>,\n     let symbol_white_list = symbol_white_list.iter()\n                                              .map(|c| c.as_ptr())\n                                              .collect::<Vec<_>>();\n-    if cgcx.opts.debugging_opts.cross_lang_lto.enabled() {\n+    if cgcx.opts.cg.linker_plugin_lto.enabled() {\n         unreachable!(\"We should never reach this case if the LTO step \\\n                       is deferred to the linker\");\n     }"}, {"sha": "e78715319727b4b158cf6f9d54d06956dbdd6640", "filename": "src/librustc_codegen_llvm/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -366,7 +366,7 @@ pub(crate) unsafe fn optimize(cgcx: &CodegenContext<LlvmCodegenBackend>,\n                 let opt_level = config.opt_level.map(|x| to_llvm_opt_settings(x).0)\n                     .unwrap_or(llvm::CodeGenOptLevel::None);\n                 let prepare_for_thin_lto = cgcx.lto == Lto::Thin || cgcx.lto == Lto::ThinLocal ||\n-                    (cgcx.lto != Lto::Fat && cgcx.opts.debugging_opts.cross_lang_lto.enabled());\n+                    (cgcx.lto != Lto::Fat && cgcx.opts.cg.linker_plugin_lto.enabled());\n                 with_llvm_pmb(llmod, &config, opt_level, prepare_for_thin_lto, &mut |b| {\n                     llvm::LLVMPassManagerBuilderPopulateFunctionPassManager(b, fpm);\n                     llvm::LLVMPassManagerBuilderPopulateModulePassManager(b, mpm);"}, {"sha": "ca9e2c87be2374ffbc34f2eb7a216c20f2b894e3", "filename": "src/librustc_codegen_llvm/consts.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_llvm%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fconsts.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -275,12 +275,12 @@ impl CodegenCx<'ll, 'tcx> {\n                 self.use_dll_storage_attrs && !self.tcx.is_foreign_item(def_id) &&\n                 // ThinLTO can't handle this workaround in all cases, so we don't\n                 // emit the attrs. Instead we make them unnecessary by disallowing\n-                // dynamic linking when cross-language LTO is enabled.\n-                !self.tcx.sess.opts.debugging_opts.cross_lang_lto.enabled();\n+                // dynamic linking when linker plugin based LTO is enabled.\n+                !self.tcx.sess.opts.cg.linker_plugin_lto.enabled();\n \n             // If this assertion triggers, there's something wrong with commandline\n             // argument validation.\n-            debug_assert!(!(self.tcx.sess.opts.debugging_opts.cross_lang_lto.enabled() &&\n+            debug_assert!(!(self.tcx.sess.opts.cg.linker_plugin_lto.enabled() &&\n                             self.tcx.sess.target.target.options.is_like_msvc &&\n                             self.tcx.sess.opts.cg.prefer_dynamic));\n "}, {"sha": "4b34bf704d588592acf799aab0565de52dc6e035", "filename": "src/librustc_codegen_ssa/back/linker.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flinker.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -13,7 +13,7 @@ use rustc::hir::def_id::{LOCAL_CRATE, CrateNum};\n use rustc::middle::dependency_format::Linkage;\n use rustc::session::Session;\n use rustc::session::config::{self, CrateType, OptLevel, DebugInfo,\n-                             CrossLangLto, Lto};\n+                             LinkerPluginLto, Lto};\n use rustc::ty::TyCtxt;\n use rustc_target::spec::{LinkerFlavor, LldFlavor};\n use serialize::{json, Encoder};\n@@ -127,7 +127,7 @@ pub trait Linker {\n     fn subsystem(&mut self, subsystem: &str);\n     fn group_start(&mut self);\n     fn group_end(&mut self);\n-    fn cross_lang_lto(&mut self);\n+    fn linker_plugin_lto(&mut self);\n     // Should have been finalize(self), but we don't support self-by-value on trait objects (yet?).\n     fn finalize(&mut self) -> Command;\n }\n@@ -183,7 +183,7 @@ impl<'a> GccLinker<'a> {\n         }\n     }\n \n-    fn push_cross_lang_lto_args(&mut self, plugin_path: Option<&OsStr>) {\n+    fn push_linker_plugin_lto_args(&mut self, plugin_path: Option<&OsStr>) {\n         if let Some(plugin_path) = plugin_path {\n             let mut arg = OsString::from(\"-plugin=\");\n             arg.push(plugin_path);\n@@ -454,16 +454,16 @@ impl<'a> Linker for GccLinker<'a> {\n         }\n     }\n \n-    fn cross_lang_lto(&mut self) {\n-        match self.sess.opts.debugging_opts.cross_lang_lto {\n-            CrossLangLto::Disabled => {\n+    fn linker_plugin_lto(&mut self) {\n+        match self.sess.opts.cg.linker_plugin_lto {\n+            LinkerPluginLto::Disabled => {\n                 // Nothing to do\n             }\n-            CrossLangLto::LinkerPluginAuto => {\n-                self.push_cross_lang_lto_args(None);\n+            LinkerPluginLto::LinkerPluginAuto => {\n+                self.push_linker_plugin_lto_args(None);\n             }\n-            CrossLangLto::LinkerPlugin(ref path) => {\n-                self.push_cross_lang_lto_args(Some(path.as_os_str()));\n+            LinkerPluginLto::LinkerPlugin(ref path) => {\n+                self.push_linker_plugin_lto_args(Some(path.as_os_str()));\n             }\n         }\n     }\n@@ -697,7 +697,7 @@ impl<'a> Linker for MsvcLinker<'a> {\n     fn group_start(&mut self) {}\n     fn group_end(&mut self) {}\n \n-    fn cross_lang_lto(&mut self) {\n+    fn linker_plugin_lto(&mut self) {\n         // Do nothing\n     }\n }\n@@ -865,7 +865,7 @@ impl<'a> Linker for EmLinker<'a> {\n     fn group_start(&mut self) {}\n     fn group_end(&mut self) {}\n \n-    fn cross_lang_lto(&mut self) {\n+    fn linker_plugin_lto(&mut self) {\n         // Do nothing\n     }\n }\n@@ -1047,7 +1047,7 @@ impl<'a> Linker for WasmLd<'a> {\n     fn group_start(&mut self) {}\n     fn group_end(&mut self) {}\n \n-    fn cross_lang_lto(&mut self) {\n+    fn linker_plugin_lto(&mut self) {\n         // Do nothing for now\n     }\n }"}, {"sha": "81952c9c820b0b8e2dca25807738612536421770", "filename": "src/librustc_codegen_ssa/back/write.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -126,7 +126,7 @@ impl ModuleConfig {\n         self.time_passes = sess.time_passes();\n         self.inline_threshold = sess.opts.cg.inline_threshold;\n         self.obj_is_bitcode = sess.target.target.options.obj_is_bitcode ||\n-                              sess.opts.debugging_opts.cross_lang_lto.enabled();\n+                              sess.opts.cg.linker_plugin_lto.enabled();\n         let embed_bitcode = sess.target.target.options.embed_bitcode ||\n                             sess.opts.debugging_opts.embed_bitcode;\n         if embed_bitcode {\n@@ -737,7 +737,7 @@ fn execute_optimize_work_item<B: ExtraBackendMethods>(\n     // If the linker does LTO, we don't have to do it. Note that we\n     // keep doing full LTO, if it is requested, as not to break the\n     // assumption that the output will be a single module.\n-    let linker_does_lto = cgcx.opts.debugging_opts.cross_lang_lto.enabled();\n+    let linker_does_lto = cgcx.opts.cg.linker_plugin_lto.enabled();\n \n     // When we're automatically doing ThinLTO for multi-codegen-unit\n     // builds we don't actually want to LTO the allocator modules if\n@@ -1883,14 +1883,14 @@ pub fn pre_lto_bitcode_filename(module_name: &str) -> String {\n fn msvc_imps_needed(tcx: TyCtxt) -> bool {\n     // This should never be true (because it's not supported). If it is true,\n     // something is wrong with commandline arg validation.\n-    assert!(!(tcx.sess.opts.debugging_opts.cross_lang_lto.enabled() &&\n+    assert!(!(tcx.sess.opts.cg.linker_plugin_lto.enabled() &&\n               tcx.sess.target.target.options.is_like_msvc &&\n               tcx.sess.opts.cg.prefer_dynamic));\n \n     tcx.sess.target.target.options.is_like_msvc &&\n         tcx.sess.crate_types.borrow().iter().any(|ct| *ct == config::CrateType::Rlib) &&\n     // ThinLTO can't handle this workaround in all cases, so we don't\n     // emit the `__imp_` symbols. Instead we make them unnecessary by disallowing\n-    // dynamic linking when cross-language LTO is enabled.\n-    !tcx.sess.opts.debugging_opts.cross_lang_lto.enabled()\n+    // dynamic linking when linker plugin LTO is enabled.\n+    !tcx.sess.opts.cg.linker_plugin_lto.enabled()\n }"}, {"sha": "33fc2bc1540d3f5831631239dd54ea45ed3b12e4", "filename": "src/test/codegen/no-dllimport-w-cross-lang-lto.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Fcodegen%2Fno-dllimport-w-cross-lang-lto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Fcodegen%2Fno-dllimport-w-cross-lang-lto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fno-dllimport-w-cross-lang-lto.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -3,7 +3,7 @@\n \n // no-prefer-dynamic\n // only-msvc\n-// compile-flags: -Z cross-lang-lto\n+// compile-flags: -C linker-plugin-lto\n \n #![crate_type = \"rlib\"]\n "}, {"sha": "3fdf6ab6d002f409fc610ed7da018e8bcb3cfdd9", "filename": "src/test/codegen/target-cpu-on-functions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Fcodegen%2Ftarget-cpu-on-functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Fcodegen%2Ftarget-cpu-on-functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Ftarget-cpu-on-functions.rs?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -3,7 +3,7 @@\n \n // no-prefer-dynamic\n // ignore-tidy-linelength\n-// compile-flags: -C no-prepopulate-passes -C panic=abort -Z cross-lang-lto -Cpasses=name-anon-globals\n+// compile-flags: -C no-prepopulate-passes -C panic=abort -C linker-plugin-lto -Cpasses=name-anon-globals\n \n #![crate_type = \"staticlib\"]\n "}, {"sha": "b3c5fb2d79647bffde8f7bb8add1530e9e9c2727", "filename": "src/test/run-make-fulldeps/cross-lang-lto-clang/Makefile", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-clang%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-clang%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-clang%2FMakefile?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -8,7 +8,7 @@\n all: cpp-executable rust-executable\n \n cpp-executable:\n-\t$(RUSTC) -Zcross-lang-lto=on -o $(TMPDIR)/librustlib-xlto.a -Copt-level=2 -Ccodegen-units=1 ./rustlib.rs\n+\t$(RUSTC) -Clinker-plugin-lto=on -o $(TMPDIR)/librustlib-xlto.a -Copt-level=2 -Ccodegen-units=1 ./rustlib.rs\n \t$(CLANG) -flto=thin -fuse-ld=lld -L $(TMPDIR) -lrustlib-xlto -o $(TMPDIR)/cmain ./cmain.c -O3\n \t# Make sure we don't find a call instruction to the function we expect to\n \t# always be inlined.\n@@ -20,6 +20,6 @@ cpp-executable:\n rust-executable:\n \t$(CLANG) ./clib.c -flto=thin -c -o $(TMPDIR)/clib.o -O2\n \t(cd $(TMPDIR); $(AR) crus ./libxyz.a ./clib.o)\n-\t$(RUSTC) -Zcross-lang-lto=on -L$(TMPDIR) -Copt-level=2 -Clinker=$(CLANG) -Clink-arg=-fuse-ld=lld ./main.rs -o $(TMPDIR)/rsmain\n+\t$(RUSTC) -Clinker-plugin-lto=on -L$(TMPDIR) -Copt-level=2 -Clinker=$(CLANG) -Clink-arg=-fuse-ld=lld ./main.rs -o $(TMPDIR)/rsmain\n \tllvm-objdump -d $(TMPDIR)/rsmain | $(CGREP) -e \"call.*c_never_inlined\"\n \tllvm-objdump -d $(TMPDIR)/rsmain | $(CGREP) -v -e \"call.*c_always_inlined\""}, {"sha": "c9da06ff93f868356b47e6b4318979cc8b1261cf", "filename": "src/test/run-make-fulldeps/cross-lang-lto-upstream-rlibs/Makefile", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-upstream-rlibs%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-upstream-rlibs%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto-upstream-rlibs%2FMakefile?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -5,13 +5,13 @@\n ifndef IS_WINDOWS\n \n # This test makes sure that we don't loose upstream object files when compiling\n-# staticlibs with -Zcross-lang-lto\n+# staticlibs with -C linker-plugin-lto\n \n all: staticlib.rs upstream.rs\n-\t$(RUSTC) upstream.rs -Z cross-lang-lto -Ccodegen-units=1\n+\t$(RUSTC) upstream.rs -C linker-plugin-lto -Ccodegen-units=1\n \n \t# Check No LTO\n-\t$(RUSTC) staticlib.rs -Z cross-lang-lto -Ccodegen-units=1 -L. -o $(TMPDIR)/staticlib.a\n+\t$(RUSTC) staticlib.rs -C linker-plugin-lto -Ccodegen-units=1 -L. -o $(TMPDIR)/staticlib.a\n \t(cd $(TMPDIR); $(LD_LIB_PATH_ENVVAR)=$(REAL_LD_LIBRARY_PATH) llvm-ar x ./staticlib.a)\n \t# Make sure the upstream object file was included\n \tls $(TMPDIR)/upstream.*.rcgu.o\n@@ -20,8 +20,8 @@ all: staticlib.rs upstream.rs\n \trm $(TMPDIR)/*\n \n \t# Check ThinLTO\n-\t$(RUSTC) upstream.rs -Z cross-lang-lto -Ccodegen-units=1 -Clto=thin\n-\t$(RUSTC) staticlib.rs -Z cross-lang-lto -Ccodegen-units=1 -Clto=thin -L. -o $(TMPDIR)/staticlib.a\n+\t$(RUSTC) upstream.rs -C linker-plugin-lto -Ccodegen-units=1 -Clto=thin\n+\t$(RUSTC) staticlib.rs -C linker-plugin-lto -Ccodegen-units=1 -Clto=thin -L. -o $(TMPDIR)/staticlib.a\n \t(cd $(TMPDIR); $(LD_LIB_PATH_ENVVAR)=$(REAL_LD_LIBRARY_PATH) llvm-ar x ./staticlib.a)\n \tls $(TMPDIR)/upstream.*.rcgu.o\n "}, {"sha": "43bd05a73592c75cab1243016e0edfc52a5a6b81", "filename": "src/test/run-make-fulldeps/cross-lang-lto/Makefile", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/04f425d2c31ea0ef022793a3fdcb8af84d471b86/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile?ref=04f425d2c31ea0ef022793a3fdcb8af84d471b86", "patch": "@@ -7,14 +7,14 @@ ifndef IS_WINDOWS\n \n # This test makes sure that the object files we generate are actually\n # LLVM bitcode files (as used by linker LTO plugins) when compiling with\n-# -Z cross-lang-lto.\n+# -Clinker-plugin-lto.\n \n # this only succeeds for bitcode files\n ASSERT_IS_BITCODE_OBJ=($(LD_LIB_PATH_ENVVAR)=$(REAL_LD_LIBRARY_PATH) llvm-bcanalyzer $(1))\n EXTRACT_OBJS=(cd $(TMPDIR); rm -f ./*.o; $(LD_LIB_PATH_ENVVAR)=$(REAL_LD_LIBRARY_PATH) llvm-ar x $(1))\n \n-BUILD_LIB=$(RUSTC) lib.rs -Copt-level=2 -Z cross-lang-lto=on -Ccodegen-units=1\n-BUILD_EXE=$(RUSTC) main.rs -Copt-level=2 -Z cross-lang-lto=on -Ccodegen-units=1 --emit=obj\n+BUILD_LIB=$(RUSTC) lib.rs -Copt-level=2 -Clinker-plugin-lto -Ccodegen-units=1\n+BUILD_EXE=$(RUSTC) main.rs -Copt-level=2 -Clinker-plugin-lto -Ccodegen-units=1 --emit=obj\n \n all: staticlib staticlib-fat-lto staticlib-thin-lto rlib exe cdylib rdylib\n "}]}