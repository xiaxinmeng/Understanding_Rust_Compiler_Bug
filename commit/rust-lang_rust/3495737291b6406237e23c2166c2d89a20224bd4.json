{"sha": "3495737291b6406237e23c2166c2d89a20224bd4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0OTU3MzcyOTFiNjQwNjIzN2UyM2MyMTY2YzJkODlhMjAyMjRiZDQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-17T00:48:58Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-06-17T00:48:58Z"}, "message": "auto merge of #7157 : sstewartgallus/rust/master, r=brson\n\nI did a little bit of cleanup work in driver.rs. It's not much but hey little steps.", "tree": {"sha": "bb5390ac84a74c4205c573c440f2ccd86490640f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb5390ac84a74c4205c573c440f2ccd86490640f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3495737291b6406237e23c2166c2d89a20224bd4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3495737291b6406237e23c2166c2d89a20224bd4", "html_url": "https://github.com/rust-lang/rust/commit/3495737291b6406237e23c2166c2d89a20224bd4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3495737291b6406237e23c2166c2d89a20224bd4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a4cc34fa120cacde411ccdc6b62cc8b6f5f14e24", "url": "https://api.github.com/repos/rust-lang/rust/commits/a4cc34fa120cacde411ccdc6b62cc8b6f5f14e24", "html_url": "https://github.com/rust-lang/rust/commit/a4cc34fa120cacde411ccdc6b62cc8b6f5f14e24"}, {"sha": "f22580dd294fde86c399741cdd1d3519a74004d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/f22580dd294fde86c399741cdd1d3519a74004d6", "html_url": "https://github.com/rust-lang/rust/commit/f22580dd294fde86c399741cdd1d3519a74004d6"}], "stats": {"total": 86, "additions": 39, "deletions": 47}, "files": [{"sha": "cc1eb37365269eb69e709d5e563284626b60ac4e", "filename": "src/librustc/driver/driver.rs", "status": "modified", "additions": 39, "deletions": 47, "changes": 86, "blob_url": "https://github.com/rust-lang/rust/blob/3495737291b6406237e23c2166c2d89a20224bd4/src%2Flibrustc%2Fdriver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3495737291b6406237e23c2166c2d89a20224bd4/src%2Flibrustc%2Fdriver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fdriver.rs?ref=3495737291b6406237e23c2166c2d89a20224bd4", "patch": "@@ -65,34 +65,24 @@ pub fn source_name(input: &input) -> @str {\n \n pub fn default_configuration(sess: Session, argv0: @str, input: &input) ->\n    ast::crate_cfg {\n-    let libc = match sess.targ_cfg.os {\n-      session::os_win32 => @\"msvcrt.dll\",\n-      session::os_macos => @\"libc.dylib\",\n-      session::os_linux => @\"libc.so.6\",\n-      session::os_android => @\"libc.so\",\n-      session::os_freebsd => @\"libc.so.7\"\n-      // _ { \"libc.so\" }\n+    let (libc, tos) = match sess.targ_cfg.os {\n+        session::os_win32 =>   (@\"msvcrt.dll\", @\"win32\"),\n+        session::os_macos =>   (@\"libc.dylib\", @\"macos\"),\n+        session::os_linux =>   (@\"libc.so.6\",  @\"linux\"),\n+        session::os_android => (@\"libc.so\",    @\"android\"),\n+        session::os_freebsd => (@\"libc.so.7\",  @\"freebsd\")\n     };\n-    let tos = match sess.targ_cfg.os {\n-      session::os_win32 => @\"win32\",\n-      session::os_macos => @\"macos\",\n-      session::os_linux => @\"linux\",\n-      session::os_android => @\"android\",\n-      session::os_freebsd => @\"freebsd\"\n-      // _ { \"libc.so\" }\n-    };\n-\n-    let mk = attr::mk_name_value_item_str;\n \n     // ARM is bi-endian, however using NDK seems to default\n     // to little-endian unless a flag is provided.\n     let (end,arch,wordsz) = match sess.targ_cfg.arch {\n-        abi::X86 => (@\"little\",@\"x86\",@\"32\"),\n-        abi::X86_64 => (@\"little\",@\"x86_64\",@\"64\"),\n-        abi::Arm => (@\"little\",@\"arm\",@\"32\"),\n-        abi::Mips => (@\"big\",@\"mips\",@\"32\")\n+        abi::X86 =>    (@\"little\", @\"x86\",    @\"32\"),\n+        abi::X86_64 => (@\"little\", @\"x86_64\", @\"64\"),\n+        abi::Arm =>    (@\"little\", @\"arm\",    @\"32\"),\n+        abi::Mips =>   (@\"big\",    @\"mips\",   @\"32\")\n     };\n \n+    let mk = attr::mk_name_value_item_str;\n     return ~[ // Target bindings.\n          attr::mk_word_item(os::FAMILY.to_managed()),\n          mk(@\"target_os\", tos),\n@@ -463,36 +453,38 @@ pub fn pretty_print_input(sess: Session, cfg: ast::crate_cfg, input: &input,\n }\n \n pub fn get_os(triple: &str) -> Option<session::os> {\n-    if triple.contains(\"win32\") ||\n-               triple.contains(\"mingw32\") {\n-            Some(session::os_win32)\n-        } else if triple.contains(\"darwin\") {\n-            Some(session::os_macos)\n-        } else if triple.contains(\"android\") {\n-            Some(session::os_android)\n-        } else if triple.contains(\"linux\") {\n-            Some(session::os_linux)\n-        } else if triple.contains(\"freebsd\") {\n-            Some(session::os_freebsd)\n-        } else { None }\n+    for os_names.each |&(name, os)| {\n+        if triple.contains(name) { return Some(os) }\n+    }\n+    None\n }\n+static os_names : &'static [(&'static str, session::os)] = &'static [\n+    (\"mingw32\", session::os_win32),\n+    (\"win32\",   session::os_win32),\n+    (\"darwin\",  session::os_macos),\n+    (\"android\", session::os_android),\n+    (\"linux\",   session::os_linux),\n+    (\"freebsd\", session::os_freebsd)];\n \n pub fn get_arch(triple: &str) -> Option<abi::Architecture> {\n-    if triple.contains(\"i386\") ||\n-        triple.contains(\"i486\") ||\n-               triple.contains(\"i586\") ||\n-               triple.contains(\"i686\") ||\n-               triple.contains(\"i786\") {\n-            Some(abi::X86)\n-        } else if triple.contains(\"x86_64\") {\n-            Some(abi::X86_64)\n-        } else if triple.contains(\"arm\") ||\n-                      triple.contains(\"xscale\") {\n-            Some(abi::Arm)\n-        } else if triple.contains(\"mips\") {\n-            Some(abi::Mips)\n-        } else { None }\n+    for architecture_abis.each |&(arch, abi)| {\n+        if triple.contains(arch) { return Some(abi) }\n+    }\n+    None\n }\n+static architecture_abis : &'static [(&'static str, abi::Architecture)] = &'static [\n+    (\"i386\",   abi::X86),\n+    (\"i486\",   abi::X86),\n+    (\"i586\",   abi::X86),\n+    (\"i686\",   abi::X86),\n+    (\"i786\",   abi::X86),\n+\n+    (\"x86_64\", abi::X86_64),\n+\n+    (\"arm\",    abi::Arm),\n+    (\"xscale\", abi::Arm),\n+\n+    (\"mips\",   abi::Mips)];\n \n pub fn build_target_config(sopts: @session::options,\n                            demitter: diagnostic::Emitter)"}]}