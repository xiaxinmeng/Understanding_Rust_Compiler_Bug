{"sha": "1aa43af37018f285544b234d65b24efb465d18cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhYTQzYWYzNzAxOGYyODU1NDRiMjM0ZDY1YjI0ZWZiNDY1ZDE4Y2I=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-09T23:14:22Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-17T00:47:57Z"}, "message": "parse full visibility when recovering", "tree": {"sha": "4340918c78915f7baea36a750e4655c6506591fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4340918c78915f7baea36a750e4655c6506591fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1aa43af37018f285544b234d65b24efb465d18cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1aa43af37018f285544b234d65b24efb465d18cb", "html_url": "https://github.com/rust-lang/rust/commit/1aa43af37018f285544b234d65b24efb465d18cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1aa43af37018f285544b234d65b24efb465d18cb/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7", "html_url": "https://github.com/rust-lang/rust/commit/b2b9555f95851cd24bcda6801a41ad9a1dfa4ae7"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "0ec8cb51fa75c1065ff8f92504de6a1e46ee8526", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1aa43af37018f285544b234d65b24efb465d18cb/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1aa43af37018f285544b234d65b24efb465d18cb/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=1aa43af37018f285544b234d65b24efb465d18cb", "patch": "@@ -8623,11 +8623,15 @@ impl<'a> Parser<'a> {\n     /// Recover from `pub` keyword in places where it seems _reasonable_ but isn't valid.\n     fn eat_bad_pub(&mut self) {\n         if self.token.is_keyword(keywords::Pub) {\n-            self.bump();\n-            let mut err = self.diagnostic()\n-                .struct_span_err(self.prev_span, \"unnecessary visibility qualifier\");\n-            err.span_label(self.prev_span, \"`pub` not permitted here\");\n-            err.emit();\n+            match self.parse_visibility(false) {\n+                Ok(vis) => {\n+                    let mut err = self.diagnostic()\n+                        .struct_span_err(vis.span, \"unnecessary visibility qualifier\");\n+                    err.span_label(vis.span, \"`pub` not permitted here\");\n+                    err.emit();\n+                }\n+                Err(mut err) => err.emit(),\n+            }\n         }\n     }\n }"}, {"sha": "2bbb32bf2b3725855ec0d86156a8b5c3bc668ab5", "filename": "src/test/ui/issues/issue-28433.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1aa43af37018f285544b234d65b24efb465d18cb/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1aa43af37018f285544b234d65b24efb465d18cb/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-28433.rs?ref=1aa43af37018f285544b234d65b24efb465d18cb", "patch": "@@ -3,7 +3,9 @@\n enum Bird {\n     pub Duck,\n     //~^ ERROR unnecessary visibility qualifier\n-    Goose\n+    Goose,\n+    pub(crate) Dove\n+    //~^ ERROR unnecessary visibility qualifier\n }\n \n "}, {"sha": "cfdbf6c7287263daaf590339307b1157dd510d36", "filename": "src/test/ui/issues/issue-28433.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1aa43af37018f285544b234d65b24efb465d18cb/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1aa43af37018f285544b234d65b24efb465d18cb/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-28433.stderr?ref=1aa43af37018f285544b234d65b24efb465d18cb", "patch": "@@ -4,5 +4,11 @@ error: unnecessary visibility qualifier\n LL |     pub Duck,\n    |     ^^^ `pub` not permitted here\n \n-error: aborting due to previous error\n+error: unnecessary visibility qualifier\n+  --> $DIR/issue-28433.rs:7:5\n+   |\n+LL |     pub(crate) Dove\n+   |     ^^^^^^^^^^ `pub` not permitted here\n+\n+error: aborting due to 2 previous errors\n "}]}