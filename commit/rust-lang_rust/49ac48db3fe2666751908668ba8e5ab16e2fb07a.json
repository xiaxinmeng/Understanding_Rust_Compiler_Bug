{"sha": "49ac48db3fe2666751908668ba8e5ab16e2fb07a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5YWM0OGRiM2ZlMjY2Njc1MTkwODY2OGJhOGU1YWIxNmUyZmIwN2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-09T06:31:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-02-09T06:31:27Z"}, "message": "auto merge of #12034 : dguenther/rust/fourcc, r=alexcrichton\n\nI was looking into #9303 and was curious if this would still be valuable. @kballard had already done 99% of the work, so I brought the branch up to date and added a feature gate. Any feedback would be appreciated; I wasn't sure if this should be set up as a syntax extension with `#[macro_registrar]`, and if so, where it should be located.\r\n\r\nOriginal PR is here: #9255\r\n\r\nTODO:\r\n* [x] Convert to loadable syntax extension\r\n* [x] Default to big endian\r\n* [x] Add `target` identifier\r\n* [x] Expand to include code points 128-255", "tree": {"sha": "2b0d9a462eb32fde6cc7e6c837502797d80e02c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b0d9a462eb32fde6cc7e6c837502797d80e02c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/49ac48db3fe2666751908668ba8e5ab16e2fb07a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/49ac48db3fe2666751908668ba8e5ab16e2fb07a", "html_url": "https://github.com/rust-lang/rust/commit/49ac48db3fe2666751908668ba8e5ab16e2fb07a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/49ac48db3fe2666751908668ba8e5ab16e2fb07a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "58985e168be7d271cba4d3fd1d95e10ee8839d51", "url": "https://api.github.com/repos/rust-lang/rust/commits/58985e168be7d271cba4d3fd1d95e10ee8839d51", "html_url": "https://github.com/rust-lang/rust/commit/58985e168be7d271cba4d3fd1d95e10ee8839d51"}, {"sha": "337e62e4d65e24682ba323b65283a59715a0c8af", "url": "https://api.github.com/repos/rust-lang/rust/commits/337e62e4d65e24682ba323b65283a59715a0c8af", "html_url": "https://github.com/rust-lang/rust/commit/337e62e4d65e24682ba323b65283a59715a0c8af"}], "stats": {"total": 326, "additions": 323, "deletions": 3}, "files": [{"sha": "81b2b390fa42587fee2c16600f410ad8fb28d2a9", "filename": "mk/crates.mk", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/mk%2Fcrates.mk", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/mk%2Fcrates.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcrates.mk?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -50,7 +50,7 @@\n ################################################################################\n \n TARGET_CRATES := std extra green rustuv native flate arena glob term semver \\\n-                 uuid serialize sync getopts collections\n+                 uuid serialize sync getopts collections fourcc\n HOST_CRATES := syntax rustc rustdoc\n CRATES := $(TARGET_CRATES) $(HOST_CRATES)\n TOOLS := compiletest rustdoc rustc\n@@ -74,6 +74,7 @@ DEPS_uuid := std serialize\n DEPS_sync := std\n DEPS_getopts := std\n DEPS_collections := std serialize\n+DEPS_fourcc := syntax std\n \n TOOL_DEPS_compiletest := extra green rustuv getopts\n TOOL_DEPS_rustdoc := rustdoc green rustuv"}, {"sha": "ea82d31bbe7306ec601c0078589f53d38213598f", "filename": "src/libfourcc/lib.rs", "status": "added", "additions": 160, "deletions": 0, "changes": 160, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibfourcc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibfourcc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibfourcc%2Flib.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,160 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+/*!\n+Syntax extension to generate FourCCs.\n+\n+Once loaded, fourcc!() is called with a single 4-character string,\n+and an optional ident that is either `big`, `little`, or `target`.\n+The ident represents endianness, and specifies in which direction\n+the characters should be read. If the ident is omitted, it is assumed\n+to be `big`, i.e. left-to-right order. It returns a u32.\n+\n+# Examples\n+\n+To load the extension and use it:\n+\n+```rust,ignore\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let val = fourcc!(\"\\xC0\\xFF\\xEE!\")\n+    // val is 0xC0FFEE21\n+    let big_val = fourcc!(\"foo \", big);\n+    // big_val is 0x21EEFFC0\n+}\n+ ```\n+\n+# References\n+\n+* [Wikipedia: FourCC](http://en.wikipedia.org/wiki/FourCC)\n+\n+*/\n+\n+#[crate_id = \"fourcc#0.10-pre\"];\n+#[crate_type = \"rlib\"];\n+#[crate_type = \"dylib\"];\n+#[license = \"MIT/ASL2\"];\n+\n+#[feature(macro_registrar, managed_boxes)];\n+\n+extern mod syntax;\n+\n+use syntax::ast;\n+use syntax::ast::Name;\n+use syntax::attr::contains;\n+use syntax::codemap::{Span, mk_sp};\n+use syntax::ext::base;\n+use syntax::ext::base::{SyntaxExtension, BasicMacroExpander, NormalTT, ExtCtxt, MRExpr};\n+use syntax::ext::build::AstBuilder;\n+use syntax::parse;\n+use syntax::parse::token;\n+use syntax::parse::token::InternedString;\n+\n+#[macro_registrar]\n+#[cfg(not(test))]\n+pub fn macro_registrar(register: |Name, SyntaxExtension|) {\n+    register(token::intern(\"fourcc\"),\n+        NormalTT(~BasicMacroExpander {\n+            expander: expand_syntax_ext,\n+            span: None,\n+        },\n+        None));\n+}\n+\n+pub fn expand_syntax_ext(cx: &mut ExtCtxt, sp: Span, tts: &[ast::TokenTree]) -> base::MacResult {\n+    let (expr, endian) = parse_tts(cx, tts);\n+\n+    let little = match endian {\n+        None => false,\n+        Some(Ident{ident, span}) => match token::get_ident(ident.name).get() {\n+            \"little\" => true,\n+            \"big\" => false,\n+            \"target\" => target_endian_little(cx, sp),\n+            _ => {\n+                cx.span_err(span, \"invalid endian directive in fourcc!\");\n+                target_endian_little(cx, sp)\n+            }\n+        }\n+    };\n+\n+    let s = match expr.node {\n+        // expression is a literal\n+        ast::ExprLit(lit) => match lit.node {\n+            // string literal\n+            ast::LitStr(ref s, _) => {\n+                if s.get().char_len() != 4 {\n+                    cx.span_err(expr.span, \"string literal with len != 4 in fourcc!\");\n+                }\n+                s\n+            }\n+            _ => {\n+                cx.span_err(expr.span, \"unsupported literal in fourcc!\");\n+                return MRExpr(cx.expr_lit(sp, ast::LitUint(0u64, ast::TyU32)));\n+            }\n+        },\n+        _ => {\n+            cx.span_err(expr.span, \"non-literal in fourcc!\");\n+            return MRExpr(cx.expr_lit(sp, ast::LitUint(0u64, ast::TyU32)));\n+        }\n+    };\n+\n+    let mut val = 0u32;\n+    for codepoint in s.get().chars().take(4) {\n+        let byte = if codepoint as u32 > 0xFF {\n+            cx.span_err(expr.span, \"fourcc! literal character out of range 0-255\");\n+            0u8\n+        } else {\n+            codepoint as u8\n+        };\n+\n+        val = if little {\n+            (val >> 8) | ((byte as u32) << 24)\n+        } else {\n+            (val << 8) | (byte as u32)\n+        };\n+    }\n+    let e = cx.expr_lit(sp, ast::LitUint(val as u64, ast::TyU32));\n+    MRExpr(e)\n+}\n+\n+struct Ident {\n+    ident: ast::Ident,\n+    span: Span\n+}\n+\n+fn parse_tts(cx: &ExtCtxt, tts: &[ast::TokenTree]) -> (@ast::Expr, Option<Ident>) {\n+    let p = &mut parse::new_parser_from_tts(cx.parse_sess(), cx.cfg(), tts.to_owned());\n+    let ex = p.parse_expr();\n+    let id = if p.token == token::EOF {\n+        None\n+    } else {\n+        p.expect(&token::COMMA);\n+        let lo = p.span.lo;\n+        let ident = p.parse_ident();\n+        let hi = p.last_span.hi;\n+        Some(Ident{ident: ident, span: mk_sp(lo, hi)})\n+    };\n+    if p.token != token::EOF {\n+        p.unexpected();\n+    }\n+    (ex, id)\n+}\n+\n+fn target_endian_little(cx: &ExtCtxt, sp: Span) -> bool {\n+    let meta = cx.meta_name_value(sp, InternedString::new(\"target_endian\"),\n+        ast::LitStr(InternedString::new(\"little\"), ast::CookedStr));\n+    contains(cx.cfg(), meta)\n+}\n+\n+// Fixes LLVM assert on Windows\n+#[test]\n+fn dummy_test() { }"}, {"sha": "f2e525932ad8b0c747299584decd72900537a174", "filename": "src/librustc/front/feature_gate.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibrustc%2Ffront%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibrustc%2Ffront%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Ffeature_gate.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -210,10 +210,13 @@ impl Visitor<()> for Context {\n             self.gate_feature(\"log_syntax\", path.span, \"`log_syntax!` is not \\\n                 stable enough for use and is subject to change\");\n         }\n+\n         else if id == self.sess.ident_of(\"trace_macros\") {\n             self.gate_feature(\"trace_macros\", path.span, \"`trace_macros` is not \\\n                 stable enough for use and is subject to change\");\n-        } else {\n+        }\n+\n+        else {\n             for &quote in quotes.iter() {\n                 if id == self.sess.ident_of(quote) {\n                   self.gate_feature(\"quote\", path.span, quote + msg);"}, {"sha": "d22a1d697fcb4569f7b755b897803b9de6bb5ff3", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2012-2014 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //"}, {"sha": "1fa198bb7064568cc087a39b1de1086b476c7bb1", "filename": "src/test/compile-fail/syntax-extension-fourcc-bad-len.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-bad-len.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-bad-len.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-bad-len.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let val = fourcc!(\"foo\"); //~ ERROR string literal with len != 4 in fourcc!\n+    let val2 = fourcc!(\"fooba\"); //~ ERROR string literal with len != 4 in fourcc!\n+}"}, {"sha": "75a5483c6d73c48fbd966d5cfe26acc10eeb5c71", "filename": "src/test/compile-fail/syntax-extension-fourcc-invalid-endian.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-invalid-endian.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-invalid-endian.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-invalid-endian.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let val = fourcc!(\"foo \", bork); //~ ERROR invalid endian directive in fourcc!\n+}"}, {"sha": "5cc29b9d49fac3b9519b8dccc3c1eac9b6fd5884", "filename": "src/test/compile-fail/syntax-extension-fourcc-non-ascii-str.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-ascii-str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-ascii-str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-ascii-str.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let v = fourcc!(\"foo\u03bb\"); //~ ERROR fourcc! literal character out of range 0-255\n+}"}, {"sha": "8e9dba302769923183d1d89d2aef0294641ecc5f", "filename": "src/test/compile-fail/syntax-extension-fourcc-non-literal.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-non-literal.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let val = fourcc!(foo); //~ ERROR non-literal in fourcc!\n+}"}, {"sha": "65cc048bfb749c700b3eeeb89516ba0849b2b426", "filename": "src/test/compile-fail/syntax-extension-fourcc-unsupported-literal.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-unsupported-literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-unsupported-literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fsyntax-extension-fourcc-unsupported-literal.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+fn main() {\n+    let val = fourcc!(45f32); //~ ERROR unsupported literal in fourcc!\n+}"}, {"sha": "f22626fb3a1a21012b2fe7c136ae3aa6501c92c5", "filename": "src/test/run-pass-fulldeps/syntax-extension-fourcc.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Frun-pass-fulldeps%2Fsyntax-extension-fourcc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49ac48db3fe2666751908668ba8e5ab16e2fb07a/src%2Ftest%2Frun-pass-fulldeps%2Fsyntax-extension-fourcc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fsyntax-extension-fourcc.rs?ref=49ac48db3fe2666751908668ba8e5ab16e2fb07a", "patch": "@@ -0,0 +1,45 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast Feature gating doesn't work\n+// xfail-stage1\n+// xfail-pretty\n+// xfail-android\n+\n+#[feature(phase)];\n+\n+#[phase(syntax)]\n+extern mod fourcc;\n+\n+static static_val: u32 = fourcc!(\"foo \");\n+static static_val_be: u32 = fourcc!(\"foo \", big);\n+static static_val_le: u32 = fourcc!(\"foo \", little);\n+static static_val_target: u32 = fourcc!(\"foo \", target);\n+\n+fn main() {\n+    let val = fourcc!(\"foo \", big);\n+    assert_eq!(val, 0x666f6f20u32);\n+    assert_eq!(val, fourcc!(\"foo \"));\n+\n+    let val = fourcc!(\"foo \", little);\n+    assert_eq!(val, 0x206f6f66u32);\n+\n+    let val = fourcc!(\"foo \", target);\n+    let exp = if cfg!(target_endian = \"big\") { 0x666f6f20u32 } else { 0x206f6f66u32 };\n+    assert_eq!(val, exp);\n+\n+    assert_eq!(static_val_be, 0x666f6f20u32);\n+    assert_eq!(static_val, static_val_be);\n+    assert_eq!(static_val_le, 0x206f6f66u32);\n+    let exp = if cfg!(target_endian = \"big\") { 0x666f6f20u32 } else { 0x206f6f66u32 };\n+    assert_eq!(static_val_target, exp);\n+\n+    assert_eq!(fourcc!(\"\\xC0\\xFF\\xEE!\"), 0xC0FFEE21);\n+}"}]}