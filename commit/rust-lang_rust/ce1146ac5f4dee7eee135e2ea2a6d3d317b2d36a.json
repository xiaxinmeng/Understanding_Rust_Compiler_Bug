{"sha": "ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlMTE0NmFjNWY0ZGVlN2VlZTEzNWUyZWEyYTZkM2QzMTdiMmQzNmE=", "commit": {"author": {"name": "Will Crichton", "email": "wcrichto@stanford.edu", "date": "2016-06-30T20:32:13Z"}, "committer": {"name": "Will Crichton", "email": "wcrichto@stanford.edu", "date": "2016-07-04T06:47:19Z"}, "message": "Moved LLVM cleanup to after `after_llvm` phase", "tree": {"sha": "f37e847ac5ca4e262f816dbcbfc50666072010fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f37e847ac5ca4e262f816dbcbfc50666072010fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "html_url": "https://github.com/rust-lang/rust/commit/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a/comments", "author": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bbdbe99c7a6773cba8d0210e6b0a8826f1618d64", "url": "https://api.github.com/repos/rust-lang/rust/commits/bbdbe99c7a6773cba8d0210e6b0a8826f1618d64", "html_url": "https://github.com/rust-lang/rust/commit/bbdbe99c7a6773cba8d0210e6b0a8826f1618d64"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "351f82d3a0b33ab59cc1b2c7a9816f6be4ab530f", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "patch": "@@ -225,6 +225,8 @@ pub fn compile_input(sess: &Session,\n                             phase5_result);\n     phase5_result?;\n \n+    write::cleanup_llvm(&trans);\n+\n     phase_6_link_output(sess, &trans, &outputs);\n \n     Ok(())"}, {"sha": "ec20381d1890d1f55f5d6e543104503ac4542ae5", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=ce1146ac5f4dee7eee135e2ea2a6d3d317b2d36a", "patch": "@@ -616,11 +616,19 @@ unsafe fn optimize_and_codegen(cgcx: &CodegenContext,\n         }\n     }\n \n-    llvm::LLVMDisposeModule(llmod);\n-    llvm::LLVMContextDispose(llcx);\n     llvm::LLVMRustDisposeTargetMachine(tm);\n }\n \n+\n+pub fn cleanup_llvm(trans: &CrateTranslation) {\n+    for module in trans.modules.iter() {\n+        unsafe {\n+            llvm::LLVMDisposeModule(module.llmod);\n+            llvm::LLVMContextDispose(module.llcx);\n+        }\n+    }\n+}\n+\n pub fn run_passes(sess: &Session,\n                   trans: &CrateTranslation,\n                   output_types: &HashMap<OutputType, Option<PathBuf>>,"}]}