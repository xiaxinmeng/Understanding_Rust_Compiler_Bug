{"sha": "606c985a50c588a320efb1441471589211744f56", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwNmM5ODVhNTBjNTg4YTMyMGVmYjE0NDE0NzE1ODkyMTE3NDRmNTY=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo.net", "date": "2016-02-12T17:43:13Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-03-25T18:07:17Z"}, "message": "Make CrateStore::crate_name() return an InternedString to avoid unnecessary allocations.", "tree": {"sha": "0c91f71b6a4cd7a10557ca23dbb23494594253c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c91f71b6a4cd7a10557ca23dbb23494594253c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/606c985a50c588a320efb1441471589211744f56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/606c985a50c588a320efb1441471589211744f56", "html_url": "https://github.com/rust-lang/rust/commit/606c985a50c588a320efb1441471589211744f56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/606c985a50c588a320efb1441471589211744f56/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5027a79279353ca86d7ebb1f3fb9cc03361b84b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/5027a79279353ca86d7ebb1f3fb9cc03361b84b4", "html_url": "https://github.com/rust-lang/rust/commit/5027a79279353ca86d7ebb1f3fb9cc03361b84b4"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "b89fd92e3c59a67ab550ba9b538460174ae5eed2", "filename": "src/librustc/middle/cstore.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcstore.rs?ref=606c985a50c588a320efb1441471589211744f56", "patch": "@@ -42,6 +42,7 @@ use syntax::ast_util::{IdVisitingOperation};\n use syntax::attr;\n use syntax::codemap::Span;\n use syntax::ptr::P;\n+use syntax::parse::token::InternedString;\n use rustc_back::target::Target;\n use rustc_front::hir;\n use rustc_front::intravisit::Visitor;\n@@ -203,7 +204,7 @@ pub trait CrateStore<'tcx> : Any {\n     fn is_explicitly_linked(&self, cnum: ast::CrateNum) -> bool;\n     fn is_allocator(&self, cnum: ast::CrateNum) -> bool;\n     fn crate_attrs(&self, cnum: ast::CrateNum) -> Vec<ast::Attribute>;\n-    fn crate_name(&self, cnum: ast::CrateNum) -> String;\n+    fn crate_name(&self, cnum: ast::CrateNum) -> InternedString;\n     fn crate_hash(&self, cnum: ast::CrateNum) -> Svh;\n     fn crate_struct_field_attrs(&self, cnum: ast::CrateNum)\n                                 -> FnvHashMap<DefId, Vec<ast::Attribute>>;\n@@ -382,7 +383,7 @@ impl<'tcx> CrateStore<'tcx> for DummyCrateStore {\n     fn is_allocator(&self, cnum: ast::CrateNum) -> bool { unimplemented!() }\n     fn crate_attrs(&self, cnum: ast::CrateNum) -> Vec<ast::Attribute>\n         { unimplemented!() }\n-    fn crate_name(&self, cnum: ast::CrateNum) -> String { unimplemented!() }\n+    fn crate_name(&self, cnum: ast::CrateNum) -> InternedString { unimplemented!() }\n     fn crate_hash(&self, cnum: ast::CrateNum) -> Svh { unimplemented!() }\n     fn crate_struct_field_attrs(&self, cnum: ast::CrateNum)\n                                 -> FnvHashMap<DefId, Vec<ast::Attribute>>"}, {"sha": "d36112daa032d96522dcd327402e4831156053ef", "filename": "src/librustc/middle/ty/mod.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc%2Fmiddle%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc%2Fmiddle%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty%2Fmod.rs?ref=606c985a50c588a320efb1441471589211744f56", "patch": "@@ -2680,14 +2680,15 @@ impl<'tcx> TyCtxt<'tcx> {\n     {\n         dep_graph::visit_all_items_in_krate(self, dep_node_fn, visitor);\n     }\n+\n     /// Looks up the span of `impl_did` if the impl is local; otherwise returns `Err`\n     /// with the name of the crate containing the impl.\n-    pub fn span_of_impl(&self, impl_did: DefId) -> Result<Span, String> {\n+    pub fn span_of_impl(&self, impl_did: DefId) -> Result<Span, InternedString> {\n         if impl_did.is_local() {\n             let node_id = self.map.as_local_node_id(impl_did).unwrap();\n             Ok(self.map.span(node_id))\n         } else {\n-            Err(self.sess.cstore.crate_name(impl_did.krate))\n+            Err(self.crate_name(impl_did.krate))\n         }\n     }\n }"}, {"sha": "9514317056ab3bbfacbee4e18b63c91747a153c2", "filename": "src/librustc_metadata/csearch.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc_metadata%2Fcsearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc_metadata%2Fcsearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcsearch.rs?ref=606c985a50c588a320efb1441471589211744f56", "patch": "@@ -334,9 +334,9 @@ impl<'tcx> CrateStore<'tcx> for cstore::CStore {\n         decoder::get_crate_attributes(self.get_crate_data(cnum).data())\n     }\n \n-    fn crate_name(&self, cnum: ast::CrateNum) -> String\n+    fn crate_name(&self, cnum: ast::CrateNum) -> token::InternedString\n     {\n-        self.get_crate_data(cnum).name.clone()\n+        token::intern_and_get_ident(&self.get_crate_data(cnum).name[..])\n     }\n \n     fn crate_hash(&self, cnum: ast::CrateNum) -> Svh"}, {"sha": "4bbb762469373bdd0db246773f9786f46c943c7b", "filename": "src/librustc_trans/save/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/606c985a50c588a320efb1441471589211744f56/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fsave%2Fmod.rs?ref=606c985a50c588a320efb1441471589211744f56", "patch": "@@ -90,7 +90,7 @@ impl<'l, 'tcx: 'l> SaveContext<'l, 'tcx> {\n \n         for n in self.tcx.sess.cstore.crates() {\n             result.push(CrateData {\n-                name: self.tcx.sess.cstore.crate_name(n),\n+                name: (&self.tcx.sess.cstore.crate_name(n)[..]).to_owned(),\n                 number: n,\n             });\n         }"}, {"sha": "aab5c960df3530898711f9ee5779dd32ee9f2668", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/606c985a50c588a320efb1441471589211744f56/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/606c985a50c588a320efb1441471589211744f56/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=606c985a50c588a320efb1441471589211744f56", "patch": "@@ -241,7 +241,7 @@ impl Clean<ExternalCrate> for CrateNum {\n             }\n         });\n         ExternalCrate {\n-            name: cx.sess().cstore.crate_name(self.0),\n+            name: (&cx.sess().cstore.crate_name(self.0)[..]).to_owned(),\n             attrs: cx.sess().cstore.crate_attrs(self.0).clean(cx),\n             primitives: primitives,\n         }"}]}