{"sha": "3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "node_id": "C_kwDOAAsO6NoAKDNhZDZkMTI4MjcxZjIzZjM5MGM0YTkzNGU3ZmVjOWM5Nzc4ZDhjN2E", "commit": {"author": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2021-11-04T20:57:09Z"}, "committer": {"name": "Will Crichton", "email": "wcrichto@cs.stanford.edu", "date": "2021-11-04T20:57:09Z"}, "message": "Sort scraped call locations before serializing", "tree": {"sha": "2928f1c43ab0d4a0e6a38b9b6496e571426cbd36", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2928f1c43ab0d4a0e6a38b9b6496e571426cbd36"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "html_url": "https://github.com/rust-lang/rust/commit/3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/comments", "author": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "willcrichton", "id": 663326, "node_id": "MDQ6VXNlcjY2MzMyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/663326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willcrichton", "html_url": "https://github.com/willcrichton", "followers_url": "https://api.github.com/users/willcrichton/followers", "following_url": "https://api.github.com/users/willcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/willcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/willcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willcrichton/subscriptions", "organizations_url": "https://api.github.com/users/willcrichton/orgs", "repos_url": "https://api.github.com/users/willcrichton/repos", "events_url": "https://api.github.com/users/willcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/willcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce943d26f8f1449a40c70a48ead48e351fd1b128", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce943d26f8f1449a40c70a48ead48e351fd1b128", "html_url": "https://github.com/rust-lang/rust/commit/ce943d26f8f1449a40c70a48ead48e351fd1b128"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "e177a11303643d645ef0a9aac29cfaff9bc54047", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "patch": "@@ -270,12 +270,18 @@ struct Decorations {\n \n impl Decorations {\n     fn new(info: DecorationInfo) -> Self {\n-        let (starts, ends) = info\n+        // Extract tuples (start, end, kind) into separate sequences of (start, kind) and (end).\n+        let (mut starts, mut ends): (Vec<_>, Vec<_>) = info\n             .0\n             .into_iter()\n             .map(|(kind, ranges)| ranges.into_iter().map(move |(lo, hi)| ((lo, kind), hi)))\n             .flatten()\n             .unzip();\n+\n+        // Sort the sequences in document order.\n+        starts.sort_by_key(|(lo, _)| *lo);\n+        ends.sort();\n+\n         Decorations { starts, ends }\n     }\n }"}, {"sha": "c39c1b46534509da54f1434120a61357f1a7126f", "filename": "src/librustdoc/scrape_examples.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Flibrustdoc%2Fscrape_examples.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Flibrustdoc%2Fscrape_examples.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fscrape_examples.rs?ref=3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "patch": "@@ -240,6 +240,13 @@ crate fn run(\n         let mut finder = FindCalls { calls: &mut calls, tcx, map: tcx.hir(), cx, target_crates };\n         tcx.hir().visit_all_item_likes(&mut finder.as_deep_visitor());\n \n+        // Sort call locations within a given file in document order\n+        for fn_calls in calls.values_mut() {\n+            for file_calls in fn_calls.values_mut() {\n+                file_calls.locations.sort_by_key(|loc| loc.call_expr.byte_span.0);\n+            }\n+        }\n+\n         // Save output to provided path\n         let mut encoder = FileEncoder::new(options.output_path).map_err(|e| e.to_string())?;\n         calls.encode(&mut encoder).map_err(|e| e.to_string())?;"}, {"sha": "05c18007b0c718bfe72aadf237fc18ae89c197f2", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/examples/ex1.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex1.rs?ref=3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "patch": "@@ -1,8 +1,10 @@\n fn main() {\n-    foobar::ok();\n+    foobar::ok(0);\n \n     // this is a\n \n+    //  ..\n+\n     // BIG\n \n     // item"}, {"sha": "de21d9061f8dcc4c49cc76d2b1263f46d3f19acf", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/examples/ex2.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fexamples%2Fex2.rs?ref=3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "patch": "@@ -1,4 +1,8 @@\n fn main() {\n-    foobar::ok();\n+    foobar::ok(1);\n     // small item\n }\n+\n+fn f() {\n+    foobar::ok(2);\n+}"}, {"sha": "5afffffdf9976f84854352224888f49ea786889c", "filename": "src/test/run-make/rustdoc-scrape-examples-ordering/src/lib.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ad6d128271f23f390c4a934e7fec9c9778d8c7a/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-scrape-examples-ordering%2Fsrc%2Flib.rs?ref=3ad6d128271f23f390c4a934e7fec9c9778d8c7a", "patch": "@@ -1,4 +1,7 @@\n // @has foobar/fn.ok.html '//*[@class=\"docblock scraped-example-list\"]' 'ex2'\n // @has foobar/fn.ok.html '//*[@class=\"more-scraped-examples\"]' 'ex1'\n+// @has foobar/fn.ok.html '//*[@class=\"highlight focus\"]' '1'\n+// @has foobar/fn.ok.html '//*[@class=\"highlight\"]' '2'\n+// @has foobar/fn.ok.html '//*[@class=\"highlight focus\"]' '0'\n \n-pub fn ok() {}\n+pub fn ok(_x: i32) {}"}]}