{"sha": "eb3c23588df888454b943bb6feb82a7e97ce1a9b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViM2MyMzU4OGRmODg4NDU0Yjk0M2JiNmZlYjgyYTdlOTdjZTFhOWI=", "commit": {"author": {"name": "Denys Zadorozhnyi", "email": "denys@zadorozhnyi.com", "date": "2021-02-26T17:12:53Z"}, "committer": {"name": "Denys Zadorozhnyi", "email": "denys@zadorozhnyi.com", "date": "2021-02-26T17:12:53Z"}, "message": "Disable \"Flip comma\" assist inside a macro call", "tree": {"sha": "da8ac119f7c6caee49fda4bcd2cdb593e9f2b22b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da8ac119f7c6caee49fda4bcd2cdb593e9f2b22b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb3c23588df888454b943bb6feb82a7e97ce1a9b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEfdnI76YLjjqYYIjUGYFQZv0K78YFAmA5LHAACgkQGYFQZv0K\n78YyHQ//TsXVHZ6sDAUnzVltMRj8HP3QZeMZD88CnWehbRcWNoW2moxUfvtpxCpi\nirnioBISPCisJA8ANVI1Yi4B9ifCKaousPoDVp1ccCJZO/RbC5tA9UWyHpO818E5\nYqnEI9+37MxSLJW1Prfig6exPTfUOBu/CUGwDaGx2WTlnqOcqJczgseumZfLjiis\nnpL05n52JdCC5Uj9HEV1Hf7LBv1sSYotNtd1PQ9IDPrw3EpqtTKlJ2/3CufX3/YS\nZ66Cm2Mw354GcBzdqxe5UcuYsXGCNcIxDu2/tQ4p1qNCi3iie7QTZUC36SV4Ubqe\ne96ZLYqtm50SMyYt10BRcO9qqgqsA/JuTgTiS2Ey1PcbfNAHFlQz6oz1Zd+BfZp6\nAd/d8AxZjTUIc0GYb494zO2GLqvWT5OG0ALwrrzx302Yf+0c/NKjIyhMBcAB9LXg\ni+xuqRFWa3r6H01x4noe1GJm8h5VO4cdVlsI4C3dibzYn4HPy7LOe+gHKTQjWUsk\nHrAE2AjxP1d1FFP/o3Hyd+9U/NfajBm6ATlx4yHj2lpq+pUe+XXYCULdPdCuRXP4\nribZhk+KlA1Fh/n+V4u1b84wasDMxpeEFsDxrY2SCTHwKKoB3gk6/GseC/CeF2dl\nP6zKCsdZatMvjuN7A0Z3ACwrjPYpPoJlyJydm7qYwhVb/yFOgaQ=\n=q5PA\n-----END PGP SIGNATURE-----", "payload": "tree da8ac119f7c6caee49fda4bcd2cdb593e9f2b22b\nparent d5b8a401f38f88ecb0d894c88dcbab3d338a0ef2\nauthor Denys Zadorozhnyi <denys@zadorozhnyi.com> 1614359573 +0200\ncommitter Denys Zadorozhnyi <denys@zadorozhnyi.com> 1614359573 +0200\n\nDisable \"Flip comma\" assist inside a macro call\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb3c23588df888454b943bb6feb82a7e97ce1a9b", "html_url": "https://github.com/rust-lang/rust/commit/eb3c23588df888454b943bb6feb82a7e97ce1a9b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb3c23588df888454b943bb6feb82a7e97ce1a9b/comments", "author": {"login": "greenhat", "id": 180349, "node_id": "MDQ6VXNlcjE4MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/180349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greenhat", "html_url": "https://github.com/greenhat", "followers_url": "https://api.github.com/users/greenhat/followers", "following_url": "https://api.github.com/users/greenhat/following{/other_user}", "gists_url": "https://api.github.com/users/greenhat/gists{/gist_id}", "starred_url": "https://api.github.com/users/greenhat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greenhat/subscriptions", "organizations_url": "https://api.github.com/users/greenhat/orgs", "repos_url": "https://api.github.com/users/greenhat/repos", "events_url": "https://api.github.com/users/greenhat/events{/privacy}", "received_events_url": "https://api.github.com/users/greenhat/received_events", "type": "User", "site_admin": false}, "committer": {"login": "greenhat", "id": 180349, "node_id": "MDQ6VXNlcjE4MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/180349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greenhat", "html_url": "https://github.com/greenhat", "followers_url": "https://api.github.com/users/greenhat/followers", "following_url": "https://api.github.com/users/greenhat/following{/other_user}", "gists_url": "https://api.github.com/users/greenhat/gists{/gist_id}", "starred_url": "https://api.github.com/users/greenhat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greenhat/subscriptions", "organizations_url": "https://api.github.com/users/greenhat/orgs", "repos_url": "https://api.github.com/users/greenhat/repos", "events_url": "https://api.github.com/users/greenhat/events{/privacy}", "received_events_url": "https://api.github.com/users/greenhat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5b8a401f38f88ecb0d894c88dcbab3d338a0ef2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5b8a401f38f88ecb0d894c88dcbab3d338a0ef2", "html_url": "https://github.com/rust-lang/rust/commit/d5b8a401f38f88ecb0d894c88dcbab3d338a0ef2"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "7f5e75d34506981ca5ae18f2f7b0871570320d27", "filename": "crates/ide_assists/src/handlers/flip_comma.rs", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/eb3c23588df888454b943bb6feb82a7e97ce1a9b/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb3c23588df888454b943bb6feb82a7e97ce1a9b/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fflip_comma.rs?ref=eb3c23588df888454b943bb6feb82a7e97ce1a9b", "patch": "@@ -1,4 +1,4 @@\n-use syntax::{algo::non_trivia_sibling, Direction, T};\n+use syntax::{algo::non_trivia_sibling, Direction, SyntaxKind, T};\n \n use crate::{AssistContext, AssistId, AssistKind, Assists};\n \n@@ -28,6 +28,12 @@ pub(crate) fn flip_comma(acc: &mut Assists, ctx: &AssistContext) -> Option<()> {\n         return None;\n     }\n \n+    // Don't apply a \"flip\" inside the macro call\n+    // since macro input are just mere tokens\n+    if comma.ancestors().any(|it| it.kind() == SyntaxKind::MACRO_CALL) {\n+        return None;\n+    }\n+\n     acc.add(\n         AssistId(\"flip_comma\", AssistKind::RefactorRewrite),\n         \"Flip comma\",\n@@ -43,7 +49,7 @@ pub(crate) fn flip_comma(acc: &mut Assists, ctx: &AssistContext) -> Option<()> {\n mod tests {\n     use super::*;\n \n-    use crate::tests::{check_assist, check_assist_target};\n+    use crate::tests::{check_assist, check_assist_not_applicable, check_assist_target};\n \n     #[test]\n     fn flip_comma_works_for_function_parameters() {\n@@ -81,4 +87,20 @@ mod tests {\n             \",\",\n         );\n     }\n+\n+    #[test]\n+    fn flip_comma_works() {\n+        check_assist(\n+            flip_comma,\n+            r#\"fn main() {((1, 2),$0 (3, 4));}\"#,\n+            r#\"fn main() {((3, 4), (1, 2));}\"#,\n+        )\n+    }\n+\n+    #[test]\n+    fn flip_comma_not_applicable_for_macro_input() {\n+        // \"Flip comma\" assist shouldn't be applicable inside the macro call\n+        // See https://github.com/rust-analyzer/rust-analyzer/issues/7693\n+        check_assist_not_applicable(flip_comma, r#\"bar!(a,$0 b)\"#);\n+    }\n }"}]}