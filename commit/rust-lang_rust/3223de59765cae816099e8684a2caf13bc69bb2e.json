{"sha": "3223de59765cae816099e8684a2caf13bc69bb2e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyMjNkZTU5NzY1Y2FlODE2MDk5ZTg2ODRhMmNhZjEzYmM2OWJiMmU=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-26T08:17:05Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-26T08:17:05Z"}, "message": "move ide queries to ide db", "tree": {"sha": "d9164a4180a15be5ae58b779989161c2541ac195", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9164a4180a15be5ae58b779989161c2541ac195"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3223de59765cae816099e8684a2caf13bc69bb2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3223de59765cae816099e8684a2caf13bc69bb2e", "html_url": "https://github.com/rust-lang/rust/commit/3223de59765cae816099e8684a2caf13bc69bb2e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3223de59765cae816099e8684a2caf13bc69bb2e/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be1a005ebd02298feb8d272278354411d16acdee", "url": "https://api.github.com/repos/rust-lang/rust/commits/be1a005ebd02298feb8d272278354411d16acdee", "html_url": "https://github.com/rust-lang/rust/commit/be1a005ebd02298feb8d272278354411d16acdee"}], "stats": {"total": 33, "additions": 14, "deletions": 19}, "files": [{"sha": "cab47dcacce0d6b54d08d21b7b935d1c4dee4c77", "filename": "crates/ra_db/src/lib.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_db%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_db%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_db%2Fsrc%2Flib.rs?ref=3223de59765cae816099e8684a2caf13bc69bb2e", "patch": "@@ -80,14 +80,6 @@ pub trait FilesDatabase: salsa::Database + CheckCanceled {\n     #[salsa::input]\n     fn source_root(&self, id: SourceRootId) -> Arc<SourceRoot>;\n     fn source_root_crates(&self, id: SourceRootId) -> Arc<Vec<CrateId>>;\n-    /// The set of \"local\" (that is, from the current workspace) roots.\n-    /// Files in local roots are assumed to change frequently.\n-    #[salsa::input]\n-    fn local_roots(&self) -> Arc<Vec<SourceRootId>>;\n-    /// The set of roots for crates.io libraries.\n-    /// Files in libraries are assumed to never change.\n-    #[salsa::input]\n-    fn library_roots(&self) -> Arc<Vec<SourceRootId>>;\n     /// The crate graph.\n     #[salsa::input]\n     fn crate_graph(&self) -> Arc<CrateGraph>;"}, {"sha": "cfbe652b0ab4ff24869c7b6364f2610f6775c9d3", "filename": "crates/ra_hir/src/mock.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_hir%2Fsrc%2Fmock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_hir%2Fsrc%2Fmock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fmock.rs?ref=3223de59765cae816099e8684a2caf13bc69bb2e", "patch": "@@ -140,8 +140,6 @@ impl Default for MockDatabase {\n             file_counter: 0,\n         };\n         db.set_crate_graph(Default::default());\n-        db.set_local_roots(Default::default());\n-        db.set_library_roots(Default::default());\n         db\n     }\n }"}, {"sha": "119190e0aa558d9ac52be1ea08d970e62c8bd70d", "filename": "crates/ra_ide_api/src/db.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_ide_api%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_ide_api%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fdb.rs?ref=3223de59765cae816099e8684a2caf13bc69bb2e", "patch": "@@ -1,11 +1,11 @@\n use std::sync::Arc;\n \n use ra_db::{\n-    CheckCanceled, FileId, Canceled,\n-    salsa::{self, Database},\n+    CheckCanceled, FileId, Canceled, FilesDatabase,\n+    salsa,\n };\n \n-use crate::{symbol_index, LineIndex};\n+use crate::{LineIndex, symbol_index::{self, SymbolsDatabase}};\n \n #[salsa::database(\n     ra_db::FilesDatabaseStorage,\n@@ -34,12 +34,9 @@ impl Default for RootDatabase {\n             runtime: salsa::Runtime::default(),\n             interner: Default::default(),\n         };\n-        db.query_mut(ra_db::CrateGraphQuery)\n-            .set((), Default::default());\n-        db.query_mut(ra_db::LocalRootsQuery)\n-            .set((), Default::default());\n-        db.query_mut(ra_db::LibraryRootsQuery)\n-            .set((), Default::default());\n+        db.set_crate_graph(Default::default());\n+        db.set_local_roots(Default::default());\n+        db.set_library_roots(Default::default());\n         db\n     }\n }"}, {"sha": "4d81d14b3f070f93201d880a8673527d0474a9a1", "filename": "crates/ra_ide_api/src/symbol_index.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3223de59765cae816099e8684a2caf13bc69bb2e/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs?ref=3223de59765cae816099e8684a2caf13bc69bb2e", "patch": "@@ -49,6 +49,14 @@ pub(crate) trait SymbolsDatabase: hir::db::HirDatabase {\n     fn file_symbols(&self, file_id: FileId) -> Arc<SymbolIndex>;\n     #[salsa::input]\n     fn library_symbols(&self, id: SourceRootId) -> Arc<SymbolIndex>;\n+    /// The set of \"local\" (that is, from the current workspace) roots.\n+    /// Files in local roots are assumed to change frequently.\n+    #[salsa::input]\n+    fn local_roots(&self) -> Arc<Vec<SourceRootId>>;\n+    /// The set of roots for crates.io libraries.\n+    /// Files in libraries are assumed to never change.\n+    #[salsa::input]\n+    fn library_roots(&self) -> Arc<Vec<SourceRootId>>;\n }\n \n fn file_symbols(db: &impl SymbolsDatabase, file_id: FileId) -> Arc<SymbolIndex> {"}]}