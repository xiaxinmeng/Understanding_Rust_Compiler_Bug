{"sha": "e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzYzQ3Y2NlZmNhMjA2OWRhNzBhOTUxM2JjMmI3ZjZmYmQwZjg5NGM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-04-06T10:10:50Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-04-06T10:10:50Z"}, "message": "Use autoreload config to gate execution rather that staleness", "tree": {"sha": "05957628c651905e5a242aa355486f4009aa7453", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05957628c651905e5a242aa355486f4009aa7453"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "html_url": "https://github.com/rust-lang/rust/commit/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3698b3eab870706e6db075b3dcae7f095086c18c", "url": "https://api.github.com/repos/rust-lang/rust/commits/3698b3eab870706e6db075b3dcae7f095086c18c", "html_url": "https://github.com/rust-lang/rust/commit/3698b3eab870706e6db075b3dcae7f095086c18c"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "7e96f3c4a079bf722434d74283f379acc2b03b7f", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "patch": "@@ -454,7 +454,9 @@ impl GlobalState {\n             }\n         }\n \n-        self.fetch_workspaces_if_needed();\n+        if self.config.cargo_autoreload() {\n+            self.fetch_workspaces_if_needed();\n+        }\n         self.fetch_build_data_if_needed();\n \n         let loop_duration = loop_start.elapsed();\n@@ -494,7 +496,10 @@ impl GlobalState {\n         }\n \n         RequestDispatcher { req: Some(req), global_state: self }\n-            .on_sync::<lsp_ext::ReloadWorkspace>(|s, ()| Ok(s.fetch_workspaces_request()))?\n+            .on_sync::<lsp_ext::ReloadWorkspace>(|s, ()| {\n+                self.fetch_workspaces_request();\n+                self.fetch_workspaces_if_needed();\n+            })?\n             .on_sync::<lsp_ext::JoinLines>(|s, p| handlers::handle_join_lines(s.snapshot(), p))?\n             .on_sync::<lsp_ext::OnEnter>(|s, p| handlers::handle_on_enter(s.snapshot(), p))?\n             .on_sync::<lsp_types::request::Shutdown>(|s, ()| {"}, {"sha": "5ff60c22aae5d760fd3dc0d61345616e8b396a05", "filename": "crates/rust-analyzer/src/reload.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3c47ccefca2069da70a9513bc2b7f6fbd0f894c/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Freload.rs?ref=e3c47ccefca2069da70a9513bc2b7f6fbd0f894c", "patch": "@@ -60,11 +60,7 @@ impl GlobalState {\n                 \", \"\n             )\n         );\n-        if self.config.cargo_autoreload() {\n-            self.fetch_workspaces_request();\n-        } else {\n-            self.transition(Status::NeedsReload);\n-        }\n+        self.fetch_workspaces_request();\n \n         fn is_interesting(path: &AbsPath, change_kind: ChangeKind) -> bool {\n             const IMPLICIT_TARGET_FILES: &[&str] = &[\"build.rs\", \"src/main.rs\", \"src/lib.rs\"];"}]}