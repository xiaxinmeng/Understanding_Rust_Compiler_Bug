{"sha": "9b74129a4f2d3edd4502dd263b54535aa67780a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliNzQxMjlhNGYyZDNlZGQ0NTAyZGQyNjNiNTQ1MzVhYTY3NzgwYTA=", "commit": {"author": {"name": "Michael Bebenita", "email": "mbebenita@mozilla.com", "date": "2010-09-08T01:05:42Z"}, "committer": {"name": "Michael Bebenita", "email": "mbebenita@mozilla.com", "date": "2010-09-08T01:41:07Z"}, "message": "Added a thread utility class to factor out operations on threads.", "tree": {"sha": "daa65eaa3a178bd27e5a97d41be0b81774f7405d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/daa65eaa3a178bd27e5a97d41be0b81774f7405d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b74129a4f2d3edd4502dd263b54535aa67780a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b74129a4f2d3edd4502dd263b54535aa67780a0", "html_url": "https://github.com/rust-lang/rust/commit/9b74129a4f2d3edd4502dd263b54535aa67780a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b74129a4f2d3edd4502dd263b54535aa67780a0/comments", "author": {"login": "mbebenita", "id": 311082, "node_id": "MDQ6VXNlcjMxMTA4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/311082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbebenita", "html_url": "https://github.com/mbebenita", "followers_url": "https://api.github.com/users/mbebenita/followers", "following_url": "https://api.github.com/users/mbebenita/following{/other_user}", "gists_url": "https://api.github.com/users/mbebenita/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbebenita/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbebenita/subscriptions", "organizations_url": "https://api.github.com/users/mbebenita/orgs", "repos_url": "https://api.github.com/users/mbebenita/repos", "events_url": "https://api.github.com/users/mbebenita/events{/privacy}", "received_events_url": "https://api.github.com/users/mbebenita/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mbebenita", "id": 311082, "node_id": "MDQ6VXNlcjMxMTA4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/311082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbebenita", "html_url": "https://github.com/mbebenita", "followers_url": "https://api.github.com/users/mbebenita/followers", "following_url": "https://api.github.com/users/mbebenita/following{/other_user}", "gists_url": "https://api.github.com/users/mbebenita/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbebenita/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbebenita/subscriptions", "organizations_url": "https://api.github.com/users/mbebenita/orgs", "repos_url": "https://api.github.com/users/mbebenita/repos", "events_url": "https://api.github.com/users/mbebenita/events{/privacy}", "received_events_url": "https://api.github.com/users/mbebenita/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b8d647af3cf743e22468de44c49bebf4270c8a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b8d647af3cf743e22468de44c49bebf4270c8a6", "html_url": "https://github.com/rust-lang/rust/commit/9b8d647af3cf743e22468de44c49bebf4270c8a6"}], "stats": {"total": 64, "additions": 64, "deletions": 0}, "files": [{"sha": "70e5077cf98a8b0b26dec0e10d7f3402a615850b", "filename": "src/rt/sync/sync.cpp", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/9b74129a4f2d3edd4502dd263b54535aa67780a0/src%2Frt%2Fsync%2Fsync.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/9b74129a4f2d3edd4502dd263b54535aa67780a0/src%2Frt%2Fsync%2Fsync.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Fsync%2Fsync.cpp?ref=9b74129a4f2d3edd4502dd263b54535aa67780a0", "patch": "@@ -10,3 +10,46 @@ void sync::yield() {\n     pthread_yield();\n #endif\n }\n+\n+#if defined(__WIN32__)\n+static DWORD WINAPI\n+#elif defined(__GNUC__)\n+static void *\n+#else\n+#error \"Platform not supported\"\n+#endif\n+rust_thread_start(void *ptr) {\n+    rust_thread *thread = (rust_thread *) ptr;\n+    thread->run();\n+    thread->thread = 0;\n+    return 0;\n+}\n+\n+void\n+rust_thread::start() {\n+#if defined(__WIN32__)\n+   thread = CreateThread(NULL, 0, rust_thread_start, this, 0, NULL);\n+#else\n+   pthread_attr_t attr;\n+   pthread_attr_init(&attr);\n+   pthread_attr_setstacksize(&attr, 1024 * 1024);\n+   pthread_attr_setdetachstate(&attr, PTHREAD_CREATE_JOINABLE);\n+   pthread_create(&thread, &attr, rust_thread_start, (void *) this);\n+#endif\n+}\n+\n+void\n+rust_thread::join() {\n+#if defined(__WIN32__)\n+   WaitForSingleObject(thread, INFINITE);\n+#else\n+   pthread_join(thread, NULL);\n+#endif\n+   thread = 0;\n+}\n+\n+bool\n+rust_thread::is_running() {\n+    // TODO: This may be broken because of possible races.\n+    return thread;\n+}"}, {"sha": "562d2a1b7cdc8e6d82e78ac8e4c0d16b8a105e07", "filename": "src/rt/sync/sync.h", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/9b74129a4f2d3edd4502dd263b54535aa67780a0/src%2Frt%2Fsync%2Fsync.h", "raw_url": "https://github.com/rust-lang/rust/raw/9b74129a4f2d3edd4502dd263b54535aa67780a0/src%2Frt%2Fsync%2Fsync.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Fsync%2Fsync.h?ref=9b74129a4f2d3edd4502dd263b54535aa67780a0", "patch": "@@ -11,4 +11,25 @@ class sync {\n     }\n };\n \n+/**\n+ * Thread utility class. Derive and implement your own run() method.\n+ */\n+class rust_thread {\n+public:\n+#if defined(__WIN32__)\n+    HANDLE thread;\n+#else\n+    pthread_t thread;\n+#endif\n+    void start();\n+\n+    virtual void run() {\n+        return;\n+    }\n+\n+    void join();\n+\n+    bool is_running();\n+};\n+\n #endif /* SYNC_H */"}]}