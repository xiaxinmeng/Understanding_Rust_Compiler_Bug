{"sha": "cd2f5f7d977936c409f4bec28075c8918e239f4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkMmY1ZjdkOTc3OTM2YzQwOWY0YmVjMjgwNzVjODkxOGUyMzlmNGM=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2018-05-01T20:26:23Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2018-05-01T21:02:05Z"}, "message": "Reduce the maximum alignment to repr(align(1 << 29))\n\nThis brings it into line with LLVM's maximum permitted alignment.", "tree": {"sha": "f6b1812708b34cf85208f86e2165e9bbf299f115", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6b1812708b34cf85208f86e2165e9bbf299f115"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cd2f5f7d977936c409f4bec28075c8918e239f4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cd2f5f7d977936c409f4bec28075c8918e239f4c", "html_url": "https://github.com/rust-lang/rust/commit/cd2f5f7d977936c409f4bec28075c8918e239f4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cd2f5f7d977936c409f4bec28075c8918e239f4c/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1607f80b3d57b66386c1cab4b2b6ae069d4caba", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1607f80b3d57b66386c1cab4b2b6ae069d4caba", "html_url": "https://github.com/rust-lang/rust/commit/c1607f80b3d57b66386c1cab4b2b6ae069d4caba"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "fd1f779f9ecc06168ee635e11907d2b576ed2dda", "filename": "src/librustc_target/abi/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Flibrustc_target%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Flibrustc_target%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fabi%2Fmod.rs?ref=cd2f5f7d977936c409f4bec28075c8918e239f4c", "patch": "@@ -326,9 +326,9 @@ impl AddAssign for Size {\n }\n \n /// Alignment of a type in bytes, both ABI-mandated and preferred.\n-/// Each field is a power of two, giving the alignment a maximum value of\n-/// 2<sup>(2<sup>8</sup> - 1)</sup>, which is limited by LLVM to a i32,\n-/// with a maximum capacity of 2<sup>31</sup> - 1 or 2147483647.\n+/// Each field is a power of two, giving the alignment a maximum value\n+/// of 2<sup>(2<sup>8</sup> - 1)</sup>, which is limited by LLVM to a\n+/// maximum capacity of 2<sup>29</sup> or 536870912.\n #[derive(Copy, Clone, PartialEq, Eq, Hash, Debug, RustcEncodable, RustcDecodable)]\n pub struct Align {\n     abi_pow2: u8,\n@@ -356,7 +356,7 @@ impl Align {\n             }\n             if bytes != 1 {\n                 Err(format!(\"`{}` is not a power of 2\", align))\n-            } else if pow > 30 {\n+            } else if pow > 29 {\n                 Err(format!(\"`{}` is too large\", align))\n             } else {\n                 Ok(pow)"}, {"sha": "13f8bb9a31831afbd3c31e9459dd318247b1bfb9", "filename": "src/libsyntax/attr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Flibsyntax%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Flibsyntax%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr.rs?ref=cd2f5f7d977936c409f4bec28075c8918e239f4c", "patch": "@@ -1012,11 +1012,11 @@ pub fn find_repr_attrs(diagnostic: &Handler, attr: &Attribute) -> Vec<ReprAttr>\n                     let parse_alignment = |node: &ast::LitKind| -> Result<u32, &'static str> {\n                         if let ast::LitKind::Int(literal, ast::LitIntType::Unsuffixed) = node {\n                             if literal.is_power_of_two() {\n-                                // rustc::ty::layout::Align restricts align to <= 2147483647\n-                                if *literal <= 2147483647 {\n+                                // rustc::ty::layout::Align restricts align to <= 2^29\n+                                if *literal <= 1 << 29 {\n                                     Ok(*literal as u32)\n                                 } else {\n-                                    Err(\"larger than 2147483647\")\n+                                    Err(\"larger than 2^29\")\n                                 }\n                             } else {\n                                 Err(\"not a power of two\")"}, {"sha": "9b0408de2a4fc8628fc4e9e8e78691debeedf08a", "filename": "src/test/compile-fail/repr-align.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Ftest%2Fcompile-fail%2Frepr-align.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd2f5f7d977936c409f4bec28075c8918e239f4c/src%2Ftest%2Fcompile-fail%2Frepr-align.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Frepr-align.rs?ref=cd2f5f7d977936c409f4bec28075c8918e239f4c", "patch": "@@ -15,7 +15,10 @@ struct A(i32);\n #[repr(align(15))] //~ ERROR: invalid `repr(align)` attribute: not a power of two\n struct B(i32);\n \n-#[repr(align(4294967296))] //~ ERROR: invalid `repr(align)` attribute: larger than 2147483647\n+#[repr(align(4294967296))] //~ ERROR: invalid `repr(align)` attribute: larger than 2^29\n struct C(i32);\n \n+#[repr(align(536870912))] // ok: this is the largest accepted alignment\n+struct D(i32);\n+\n fn main() {}"}]}