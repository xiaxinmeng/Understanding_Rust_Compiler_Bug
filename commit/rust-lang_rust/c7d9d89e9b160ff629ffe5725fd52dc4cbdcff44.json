{"sha": "c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZDlkODllOWIxNjBmZjYyOWZmZTU3MjVmZDUyZGM0Y2JkY2ZmNDQ=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-03-31T22:41:40Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-03-31T22:41:40Z"}, "message": "Hide `task_context` when lowering body", "tree": {"sha": "2d840ff35b937c36ea5d6d0bfa9a34ef8a2e71f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d840ff35b937c36ea5d6d0bfa9a34ef8a2e71f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "html_url": "https://github.com/rust-lang/rust/commit/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75ff3110ac6d8a0259023b83fd20d7ab295f8dd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/75ff3110ac6d8a0259023b83fd20d7ab295f8dd6", "html_url": "https://github.com/rust-lang/rust/commit/75ff3110ac6d8a0259023b83fd20d7ab295f8dd6"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "6005b607026fb4d006f32ecc26639c072d606157", "filename": "src/librustc_ast_lowering/item.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Flibrustc_ast_lowering%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Flibrustc_ast_lowering%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_lowering%2Fitem.rs?ref=c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "patch": "@@ -972,8 +972,10 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         f: impl FnOnce(&mut Self) -> (&'hir [hir::Param<'hir>], hir::Expr<'hir>),\n     ) -> hir::BodyId {\n         let prev_gen_kind = self.generator_kind.take();\n+        let task_context = self.task_context.take();\n         let (parameters, result) = f(self);\n         let body_id = self.record_body(parameters, result);\n+        self.task_context = task_context;\n         self.generator_kind = prev_gen_kind;\n         body_id\n     }"}, {"sha": "e78231a68512daf1f306cb1e24f6f19ee5841551", "filename": "src/test/ui/async-await/issue-70594.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs?ref=c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "patch": "@@ -0,0 +1,12 @@\n+// edition:2018\n+\n+async fn fun() {\n+    [1; ().await];\n+    //~^ error: `await` is only allowed inside `async` functions and blocks\n+    //~| error: `.await` is not allowed in a `const`\n+    //~| error: `loop` is not allowed in a `const`\n+    //~| error: `.await` is not allowed in a `const`\n+    //~| error: the trait bound `(): std::future::Future` is not satisfied\n+}\n+\n+fn main() {}"}, {"sha": "d2fa7e58f6a9b7ec5e0ef540a071452959f53a5e", "filename": "src/test/ui/async-await/issue-70594.stderr", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr?ref=c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "patch": "@@ -0,0 +1,44 @@\n+error[E0728]: `await` is only allowed inside `async` functions and blocks\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL | async fn fun() {\n+   |          --- this is not `async`\n+LL |     [1; ().await];\n+   |         ^^^^^^^^ only allowed inside `async` functions and blocks\n+\n+error[E0744]: `.await` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+\n+error[E0658]: `loop` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+   |\n+   = note: see issue #52000 <https://github.com/rust-lang/rust/issues/52000> for more information\n+   = help: add `#![feature(const_loop)]` to the crate attributes to enable\n+\n+error[E0744]: `.await` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+\n+error[E0277]: the trait bound `(): std::future::Future` is not satisfied\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^ the trait `std::future::Future` is not implemented for `()`\n+   | \n+  ::: $SRC_DIR/libcore/future/mod.rs:LL:COL\n+   |\n+LL |     F: Future,\n+   |        ------ required by this bound in `std::future::poll_with_context`\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0277, E0658, E0728, E0744.\n+For more information about an error, try `rustc --explain E0277`."}]}