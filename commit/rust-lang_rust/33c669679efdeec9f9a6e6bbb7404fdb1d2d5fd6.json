{"sha": "33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzYzY2OTY3OWVmZGVlYzlmOWE2ZTZiYmI3NDA0ZmRiMWQyZDVmZDY=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-09-12T10:52:14Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-09-17T15:33:47Z"}, "message": "test 'harness=false' tests", "tree": {"sha": "6122451558b2f5c297083a7d3a44f31bf55a58b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6122451558b2f5c297083a7d3a44f31bf55a58b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "html_url": "https://github.com/rust-lang/rust/commit/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "174a92c39ae67243a775953781ad60044054b12f", "url": "https://api.github.com/repos/rust-lang/rust/commits/174a92c39ae67243a775953781ad60044054b12f", "html_url": "https://github.com/rust-lang/rust/commit/174a92c39ae67243a775953781ad60044054b12f"}], "stats": {"total": 35, "additions": 22, "deletions": 13}, "files": [{"sha": "f514f4e3e5c37f7d8228d0d53cb18289064df201", "filename": "cargo-miri/bin.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -502,7 +502,7 @@ fn phase_cargo_rustc(args: env::Args) {\n     /// Cargo does not give us this information directly, so we need to check\n     /// various command-line flags.\n     fn is_runnable_crate() -> bool {\n-        let is_bin = get_arg_flag_value(\"--crate-type\").as_deref() == Some(\"bin\");\n+        let is_bin = get_arg_flag_value(\"--crate-type\").as_deref().unwrap_or(\"bin\") == \"bin\";\n         let is_test = has_arg_flag(\"--test\");\n         let print = get_arg_flag_value(\"--print\").is_some();\n         (is_bin || is_test) && !print"}, {"sha": "f4847270ba409742f7f73397e73fed830a2eb6ba", "filename": "test-cargo-miri/Cargo.toml", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.toml?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -13,3 +13,7 @@ num_cpus = \"1.10.1\"\n \n [lib]\n test = false # test that this is respected (will show in the output)\n+\n+[[test]]\n+name = \"no-harness\"\n+harness = false"}, {"sha": "665e9834e8e566db4da3960762d5ff6ffb893962", "filename": "test-cargo-miri/run-test.py", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frun-test.py?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -22,7 +22,7 @@ def cargo_miri(cmd):\n     return args\n \n def test(name, cmd, stdout_ref, stderr_ref, stdin=b'', env={}):\n-    print(\"==> Testing `{}` <==\".format(name))\n+    print(\"==> Testing {} <==\".format(name))\n     ## Call `cargo miri`, capture all output\n     p_env = os.environ.copy()\n     p_env.update(env)\n@@ -50,41 +50,41 @@ def test(name, cmd, stdout_ref, stderr_ref, stdin=b'', env={}):\n         fail(\"stderr does not match reference\")\n \n def test_cargo_miri_run():\n-    test(\"cargo miri run\",\n+    test(\"`cargo miri run`\",\n         cargo_miri(\"run\"),\n-        \"stdout.ref\", \"stderr.ref\",\n+        \"stdout.ref1\", \"stderr.ref1\",\n         stdin=b'12\\n21\\n',\n         env={'MIRIFLAGS': \"-Zmiri-disable-isolation\"},\n     )\n-    test(\"cargo miri run (with arguments and target)\",\n+    test(\"`cargo miri run` (with arguments and target)\",\n         cargo_miri(\"run\") + [\"--bin\", \"cargo-miri-test\", \"--\", \"hello world\", '\"hello world\"'],\n         \"stdout.ref2\", \"stderr.ref2\"\n     )\n \n def test_cargo_miri_test():\n     # rustdoc is not run on foreign targets\n     is_foreign = 'MIRI_TEST_TARGET' in os.environ\n-    rustdoc_ref = \"test.stderr.ref2\" if is_foreign else \"test.stderr.ref\"\n+    rustdoc_ref = \"test.stderr.ref2\" if is_foreign else \"test.stderr.ref1\"\n \n-    test(\"cargo miri test\",\n+    test(\"`cargo miri test`\",\n         cargo_miri(\"test\"),\n-        \"test.stdout.ref\",rustdoc_ref,\n+        \"test.stdout.ref1\",rustdoc_ref,\n         env={'MIRIFLAGS': \"-Zmiri-seed=feed\"},\n     )\n-    test(\"cargo miri test (with filter)\",\n+    test(\"`cargo miri test` (with filter)\",\n         cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"le1\"],\n         \"test.stdout.ref2\", rustdoc_ref\n     )\n-    test(\"cargo miri test (without isolation)\",\n+    test(\"`cargo miri test` (without isolation)\",\n         cargo_miri(\"test\") + [\"--\", \"--format=pretty\", \"num_cpus\"],\n         \"test.stdout.ref3\", rustdoc_ref,\n         env={'MIRIFLAGS': \"-Zmiri-disable-isolation\"},\n     )\n-    test(\"cargo miri test (test target)\",\n+    test(\"`cargo miri test` (test target)\",\n         cargo_miri(\"test\") + [\"--test\", \"test\", \"--\", \"--format=pretty\"],\n         \"test.stdout.ref4\", \"test.stderr.ref2\"\n     )\n-    test(\"cargo miri test (bin target)\",\n+    test(\"`cargo miri test` (bin target)\",\n         cargo_miri(\"test\") + [\"--bin\", \"cargo-miri-test\", \"--\", \"--format=pretty\"],\n         \"test.stdout.ref5\", \"test.stderr.ref2\"\n     )"}, {"sha": "17808f57061ef40b37262acf0d1f613c910d65cb", "filename": "test-cargo-miri/src/main.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Fmain.rs?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -28,7 +28,6 @@ fn main() {\n             println!(\"42\");\n         }\n     }\n-\n }\n \n #[cfg(test)]"}, {"sha": "ba2906d0666cf726c7eaadd2cd3db615dedfdf3a", "filename": "test-cargo-miri/stderr.ref1", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fstderr.ref1", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fstderr.ref1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fstderr.ref1?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "previous_filename": "test-cargo-miri/stderr.ref"}, {"sha": "2eab8df967d5fc613a3085920c1a0cc81971da78", "filename": "test-cargo-miri/stdout.ref1", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fstdout.ref1", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Fstdout.ref1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fstdout.ref1?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "previous_filename": "test-cargo-miri/stdout.ref"}, {"sha": "a310169e305ee1828c2d5ae38ae37987cdb308fd", "filename": "test-cargo-miri/test.stderr.ref1", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stderr.ref1", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stderr.ref1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stderr.ref1?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "previous_filename": "test-cargo-miri/test.stderr.ref"}, {"sha": "76144513c54897e2a69ef85e3c24928af848f677", "filename": "test-cargo-miri/test.stdout.ref1", "status": "renamed", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref1", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stdout.ref1?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -3,6 +3,7 @@ running 1 test\n .\n test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n \n+no-harness test\n \n running 8 tests\n ..i.....", "previous_filename": "test-cargo-miri/test.stdout.ref"}, {"sha": "1264c6da7ff8cf9a2985e0ce1e84805bf32ebe1d", "filename": "test-cargo-miri/test.stdout.ref2", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref2", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref2", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stdout.ref2?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -3,6 +3,7 @@ running 0 tests\n \n test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out\n \n+no-harness test\n \n running 1 test\n test simple1 ... ok"}, {"sha": "a5edee2c5f13b2eed395c3327ec0ef7a3a64a621", "filename": "test-cargo-miri/test.stdout.ref3", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref3", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftest.stdout.ref3", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stdout.ref3?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -3,6 +3,7 @@ running 0 tests\n \n test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out\n \n+no-harness test\n \n running 1 test\n test num_cpus ... ok"}, {"sha": "8d1c5c3462660b17c28703cd5c43f5118b1a373b", "filename": "test-cargo-miri/tests/no-harness.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftests%2Fno-harness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6/test-cargo-miri%2Ftests%2Fno-harness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftests%2Fno-harness.rs?ref=33c669679efdeec9f9a6e6bbb7404fdb1d2d5fd6", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    println!(\"no-harness test\");\n+}"}]}