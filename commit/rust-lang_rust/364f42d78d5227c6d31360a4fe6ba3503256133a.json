{"sha": "364f42d78d5227c6d31360a4fe6ba3503256133a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2NGY0MmQ3OGQ1MjI3YzZkMzEzNjBhNGZlNmJhMzUwMzI1NjEzM2E=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-05-13T08:11:52Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-05-13T09:32:33Z"}, "message": "Fix build script for dev channel", "tree": {"sha": "32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/364f42d78d5227c6d31360a4fe6ba3503256133a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJa+AYxAAoJELb6Bqbg4mZb8TEP/0hK5HA+xhXsC/G3SGlTbimj\nSOK1F9H1rrvVayClw+eEalKi+RQrIFYUG5pX5itncKAmgXfttpG6fBKZLhn4rLU3\nbMhUtNOVxav3e87II1fBTDgLFhFI05z3f1NvrQXS5SHGmftpZd+4EmgJPg/aXdJD\nyZgPKFJPSZ7Ppzfs8j59rDNIHEYsvts72yWHtNY1NNgcz+gzjy3Kk4uxkrnT8GEz\nc8TzHrzM4inwcjgBccjE7OFHmEZpqgtqt/auo4pYDJWQLujnG132q/Qza4dMEH+N\nYAUxDUp8a6XRlCkTCpCX2QP0PRI7+l+ORAWjzs+8Q6mMFTPlig8Sa7OyIMzcQWnW\nSvlq8rdqfm/urQ8Db30gDMnbeNAO5aLbn13Q1RZsgaMsmn7ewyv0PiH9AVyfRjYi\nSKL/TssoClA/Ru0I1Yqtffpt7uNyJtzBCEhXNqVdOfJx9LUUsbRtQRgWNffz2xvu\n2aPK8RGCQGEPjwjtgluTPqhPedaaxyFTaSlgtvYNNq9Vy8rtaU4cU7rFZTlh0pcr\nwZ+aQPOB17Pg32NxV0qVKTBSYYoaaxf7upTanAWMfadDErVpRaeUMGmK9Ku7eURt\nAPrxq6Kw2nDokXUsI2Sq2td9WfA23O1q+Lrx2Os1lT/dwyhYiI72ahifT6FoZNh0\nbxBbRfv/V1sQCdMnfHB8\n=mU9Y\n-----END PGP SIGNATURE-----", "payload": "tree 32fdbce86ed6bf89d74ec41c1ab5ac0a5e596073\nparent 29a900d9165607492f1c7c9322278bc1f0239e1b\nauthor Philipp Hansch <dev@phansch.net> 1526199112 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1526203953 +0200\n\nFix build script for dev channel\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/364f42d78d5227c6d31360a4fe6ba3503256133a", "html_url": "https://github.com/rust-lang/rust/commit/364f42d78d5227c6d31360a4fe6ba3503256133a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/364f42d78d5227c6d31360a4fe6ba3503256133a/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29a900d9165607492f1c7c9322278bc1f0239e1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/29a900d9165607492f1c7c9322278bc1f0239e1b", "html_url": "https://github.com/rust-lang/rust/commit/29a900d9165607492f1c7c9322278bc1f0239e1b"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "913f7b4ee89864e0f21eb1c84c0f8accb6d6ef35", "filename": "build.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/364f42d78d5227c6d31360a4fe6ba3503256133a/build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/364f42d78d5227c6d31360a4fe6ba3503256133a/build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.rs?ref=364f42d78d5227c6d31360a4fe6ba3503256133a", "patch": "@@ -21,6 +21,15 @@ use rustc_version::{version_meta, version_meta_for, Channel, Version, VersionMet\n use ansi_term::Colour::Red;\n \n fn main() {\n+    check_rustc_version();\n+\n+    // Forward the profile to the main compilation\n+    println!(\"cargo:rustc-env=PROFILE={}\", env::var(\"PROFILE\").unwrap());\n+    // Don't rebuild even if nothing changed\n+    println!(\"cargo:rerun-if-changed=build.rs\");\n+}\n+\n+fn check_rustc_version() {\n     let string = include_str!(\"min_version.txt\");\n     let min_version_meta = version_meta_for(string)\n         .expect(\"Could not parse version string in min_version.txt\");\n@@ -31,6 +40,12 @@ fn main() {\n     let min_date_str = min_version_meta.clone().commit_date\n         .expect(\"min_version.txt does not contain a rustc commit date\");\n \n+    // Dev channel (rustc built from git) does not have any date or commit information in rustc -vV\n+    // `current_version_meta.commit_date` would crash, so we return early here.\n+    if current_version_meta.channel == Channel::Dev {\n+        return\n+    }\n+\n     let current_version = current_version_meta.clone().semver;\n     let current_date_str = current_version_meta.clone().commit_date\n         .expect(\"current rustc version information does not contain a rustc commit date\");\n@@ -69,11 +84,6 @@ fn main() {\n         print_version_err(&current_version, &*current_date_str);\n         panic!(\"Aborting compilation due to incompatible compiler.\")\n     }\n-\n-    // Forward the profile to the main compilation\n-    println!(\"cargo:rustc-env=PROFILE={}\", env::var(\"PROFILE\").unwrap());\n-    // Don't rebuild even if nothing changed\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n }\n \n fn correct_channel(version_meta: &VersionMeta) -> bool {"}]}