{"sha": "2fd401d38fb2880d2bc655fbf801fd3f4d151869", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmZDQwMWQzOGZiMjg4MGQyYmM2NTVmYmY4MDFmZDNmNGQxNTE4Njk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-01-19T23:49:43Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-01-20T16:35:49Z"}, "message": "Rollup merge of #39157 - michaelwoerister:debug-lto, r=alexcrichton\n\nAdd regression test for debuginfo + LTO\n\nFixes #25270, which cannot be reproduced with the current nightly version of the compiler anymore (due to various fixes to debuginfo generation in the past).\n\nShould we run into the \"possible ODR violation\" again, the test added by this PR can be extend with the new case.\n\nr? @alexcrichton", "tree": {"sha": "af3e1bf4adbac2f4fa156b08e3cb9bfacdd5a9bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af3e1bf4adbac2f4fa156b08e3cb9bfacdd5a9bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2fd401d38fb2880d2bc655fbf801fd3f4d151869", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2fd401d38fb2880d2bc655fbf801fd3f4d151869", "html_url": "https://github.com/rust-lang/rust/commit/2fd401d38fb2880d2bc655fbf801fd3f4d151869", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2fd401d38fb2880d2bc655fbf801fd3f4d151869/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "254380e2f31a943d60ff0d7b6dc2993c85552fbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/254380e2f31a943d60ff0d7b6dc2993c85552fbb", "html_url": "https://github.com/rust-lang/rust/commit/254380e2f31a943d60ff0d7b6dc2993c85552fbb"}, {"sha": "deeba3443e186628fca98e7b74a0ac0616c5fa2d", "url": "https://api.github.com/repos/rust-lang/rust/commits/deeba3443e186628fca98e7b74a0ac0616c5fa2d", "html_url": "https://github.com/rust-lang/rust/commit/deeba3443e186628fca98e7b74a0ac0616c5fa2d"}], "stats": {"total": 76, "additions": 74, "deletions": 2}, "files": [{"sha": "88e54d30172bc59a1c4669ff0ae66701eb65e16b", "filename": "src/test/run-pass/auxiliary/debuginfo-lto-aux.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fauxiliary%2Fdebuginfo-lto-aux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fauxiliary%2Fdebuginfo-lto-aux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fauxiliary%2Fdebuginfo-lto-aux.rs?ref=2fd401d38fb2880d2bc655fbf801fd3f4d151869", "patch": "@@ -0,0 +1,39 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -g --crate-type=rlib\n+\n+pub struct StructWithLifetime<'a>(&'a i32);\n+pub fn mk_struct_with_lt<'a>(x: &'a i32) -> StructWithLifetime<'a> {\n+    StructWithLifetime(x)\n+}\n+\n+pub struct RegularStruct(u32);\n+pub fn mk_regular_struct(x: u32) -> RegularStruct {\n+    RegularStruct(x)\n+}\n+\n+pub fn take_fn(f: fn(i32) -> i32, x: i32) -> i32 {\n+    f(x)\n+}\n+\n+pub fn with_closure(x: i32) -> i32 {\n+    let closure = |i| { x + i };\n+\n+    closure(1) + closure(2)\n+}\n+\n+pub fn generic_fn<T>(x: T) -> (T, u32) {\n+    (x, 1)\n+}\n+\n+pub fn user_of_generic_fn(x: f32) -> (f32, u32) {\n+    generic_fn(x)\n+}"}, {"sha": "6f48978a0000d6a712365e8b1a80c320946ff30a", "filename": "src/test/run-pass/auxiliary/sepcomp_lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fauxiliary%2Fsepcomp_lib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fauxiliary%2Fsepcomp_lib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fauxiliary%2Fsepcomp_lib.rs?ref=2fd401d38fb2880d2bc655fbf801fd3f4d151869", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// compile-flags: -C codegen-units=3 --crate-type=rlib,dylib\n+// compile-flags: -C codegen-units=3 --crate-type=rlib,dylib -g\n \n pub mod a {\n     pub fn one() -> usize {"}, {"sha": "c29cfafe438ca86dc3047b5d4a33b54deb5b2539", "filename": "src/test/run-pass/debuginfo-lto.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fdebuginfo-lto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fdebuginfo-lto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fdebuginfo-lto.rs?ref=2fd401d38fb2880d2bc655fbf801fd3f4d151869", "patch": "@@ -0,0 +1,33 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// This test case makes sure that we don't run into LLVM's dreaded\n+// \"possible ODR violation\" assertion when compiling with LTO + Debuginfo.\n+// It covers cases that have traditionally been prone to cause this error.\n+// If new cases emerge, add them to this file.\n+\n+// aux-build:debuginfo-lto-aux.rs\n+// compile-flags: -C lto -g\n+// no-prefer-dynamic\n+\n+extern crate debuginfo_lto_aux;\n+\n+fn some_fn(x: i32) -> i32 {\n+    x + 1\n+}\n+\n+fn main() {\n+    let i = 0;\n+    let _ = debuginfo_lto_aux::mk_struct_with_lt(&i);\n+    let _ = debuginfo_lto_aux::mk_regular_struct(1);\n+    let _ = debuginfo_lto_aux::take_fn(some_fn, 1);\n+    let _ = debuginfo_lto_aux::with_closure(22);\n+    let _ = debuginfo_lto_aux::generic_fn(0f32);\n+}"}, {"sha": "f3e52fbd32f3e92d0ff2d1fcedf59ec9f9c75879", "filename": "src/test/run-pass/sepcomp-lib-lto.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fsepcomp-lib-lto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd401d38fb2880d2bc655fbf801fd3f4d151869/src%2Ftest%2Frun-pass%2Fsepcomp-lib-lto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsepcomp-lib-lto.rs?ref=2fd401d38fb2880d2bc655fbf801fd3f4d151869", "patch": "@@ -12,7 +12,7 @@\n // separately compiled.\n \n // aux-build:sepcomp_lib.rs\n-// compile-flags: -C lto\n+// compile-flags: -C lto -g\n // no-prefer-dynamic\n // ignore-android FIXME #18800\n "}]}