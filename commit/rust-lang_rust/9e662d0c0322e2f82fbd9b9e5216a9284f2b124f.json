{"sha": "9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "node_id": "C_kwDOAAsO6NoAKDllNjYyZDBjMDMyMmUyZjgyZmJkOWI5ZTUyMTZhOTI4NGYyYjEyNGY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-12T23:20:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-12T23:20:10Z"}, "message": "Rollup merge of #91824 - woppopo:const_ptr_write_bytes, r=oli-obk\n\nMake `(*mut T)::write_bytes` `const`\n\nTracking issue: #86302", "tree": {"sha": "716b9e9f038c4125a3ed040706d5fe78b8dec11b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/716b9e9f038c4125a3ed040706d5fe78b8dec11b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhtoOqCRBK7hj4Ov3rIwAApOcIADw1gkqILJNCMZBNH2Elddlk\nKvThA4Gc6umgb2ZK1b1ZpSbDaFGdi4RS5Q7m6L0fs7mdD14sJdoMx7MJiaSQWrtb\nsDzF55F8LRZmM83y5nzrlQ5XQvowskY8FP7HvQaw1u0NswPx9i+CqmQyGkx5H6Al\nzAS5Rmzkw+Bia+Z9sdL2mhQ+rglY2VgzZGjXnotkaOpSUkfTFAOCAxWetJ6U4C4c\nrc0bEoTpA2E5eEC1BRkLlGgSj7MHMbbaYJ1Bo1m9lF5X+/d6TJHfrae1EX3I1n04\nFRTl0ii27Q0je3aa3XW5PauobwWlSnQ5/iBcuuuIV+9wjCuR9iMfmdhdDRLZd1I=\n=DLgx\n-----END PGP SIGNATURE-----\n", "payload": "tree 716b9e9f038c4125a3ed040706d5fe78b8dec11b\nparent 3b79d4f0b7d0c9ef9a018809a26be03818adff06\nparent 7f5dc0f6090eaad75fadf75b1cf2449294a15f52\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1639351210 +0100\ncommitter GitHub <noreply@github.com> 1639351210 +0100\n\nRollup merge of #91824 - woppopo:const_ptr_write_bytes, r=oli-obk\n\nMake `(*mut T)::write_bytes` `const`\n\nTracking issue: #86302\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "html_url": "https://github.com/rust-lang/rust/commit/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b79d4f0b7d0c9ef9a018809a26be03818adff06", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b79d4f0b7d0c9ef9a018809a26be03818adff06", "html_url": "https://github.com/rust-lang/rust/commit/3b79d4f0b7d0c9ef9a018809a26be03818adff06"}, {"sha": "7f5dc0f6090eaad75fadf75b1cf2449294a15f52", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f5dc0f6090eaad75fadf75b1cf2449294a15f52", "html_url": "https://github.com/rust-lang/rust/commit/7f5dc0f6090eaad75fadf75b1cf2449294a15f52"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "f3655edb3d080c6eeed20943af2db96e0a192d3d", "filename": "library/core/src/ptr/mut_ptr.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f/library%2Fcore%2Fsrc%2Fptr%2Fmut_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f/library%2Fcore%2Fsrc%2Fptr%2Fmut_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fptr%2Fmut_ptr.rs?ref=9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "patch": "@@ -1069,8 +1069,9 @@ impl<T: ?Sized> *mut T {\n     ///\n     /// [`ptr::write_bytes`]: crate::ptr::write_bytes()\n     #[stable(feature = \"pointer_methods\", since = \"1.26.0\")]\n+    #[rustc_const_unstable(feature = \"const_ptr_write\", issue = \"86302\")]\n     #[inline(always)]\n-    pub unsafe fn write_bytes(self, val: u8, count: usize)\n+    pub const unsafe fn write_bytes(self, val: u8, count: usize)\n     where\n         T: Sized,\n     {"}, {"sha": "b9c0d75b702e5ffb8d284a284fa80a19617659ac", "filename": "library/core/tests/ptr.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f/library%2Fcore%2Ftests%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e662d0c0322e2f82fbd9b9e5216a9284f2b124f/library%2Fcore%2Ftests%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fptr.rs?ref=9e662d0c0322e2f82fbd9b9e5216a9284f2b124f", "patch": "@@ -250,6 +250,21 @@ fn test_set_memory() {\n     assert!(xs == [5u8; 20]);\n }\n \n+#[test]\n+#[cfg(not(bootstrap))]\n+fn test_set_memory_const() {\n+    const XS: [u8; 20] = {\n+        let mut xs = [0u8; 20];\n+        let ptr = xs.as_mut_ptr();\n+        unsafe {\n+            ptr.write_bytes(5u8, xs.len());\n+        }\n+        xs\n+    };\n+\n+    assert!(XS == [5u8; 20]);\n+}\n+\n #[test]\n fn test_unsized_nonnull() {\n     let xs: &[i32] = &[1, 2, 3];"}]}