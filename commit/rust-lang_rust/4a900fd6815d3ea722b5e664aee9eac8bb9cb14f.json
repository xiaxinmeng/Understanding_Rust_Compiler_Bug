{"sha": "4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhOTAwZmQ2ODE1ZDNlYTcyMmI1ZTY2NGFlZTllYWM4YmI5Y2IxNGY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-09T18:27:44Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-09T18:27:44Z"}, "message": "Split diagnostics", "tree": {"sha": "48dddd52ed4ed5e9cf28504d2c3b8d8a1dd8c27e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48dddd52ed4ed5e9cf28504d2c3b8d8a1dd8c27e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "html_url": "https://github.com/rust-lang/rust/commit/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "afa94d4f37b9a0a1e723edffcc79c3d48799bad1", "url": "https://api.github.com/repos/rust-lang/rust/commits/afa94d4f37b9a0a1e723edffcc79c3d48799bad1", "html_url": "https://github.com/rust-lang/rust/commit/afa94d4f37b9a0a1e723edffcc79c3d48799bad1"}], "stats": {"total": 48, "additions": 38, "deletions": 10}, "files": [{"sha": "5ebb4913973e0e7e785564130387826f33cc29cc", "filename": "libeditor/src/lib.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/libeditor%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/libeditor%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/libeditor%2Fsrc%2Flib.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -19,6 +19,12 @@ pub struct HighlightedRange {\n     pub tag: &'static str,\n }\n \n+#[derive(Debug)]\n+pub struct Diagnostic {\n+    pub range: TextRange,\n+    pub msg: String,\n+}\n+\n #[derive(Debug)]\n pub struct Symbol {\n     // pub parent: ???,\n@@ -69,6 +75,25 @@ impl File {\n         res\n     }\n \n+    pub fn diagnostics(&self) -> Vec<Diagnostic> {\n+        let syntax = self.inner.syntax();\n+        let mut res = Vec::new();\n+\n+        for node in walk::preorder(syntax.as_ref()) {\n+            if node.kind() == ERROR {\n+                res.push(Diagnostic {\n+                    range: node.range(),\n+                    msg: \"Syntax Error\".to_string(),\n+                });\n+            }\n+        }\n+        res.extend(self.inner.errors().into_iter().map(|err| Diagnostic {\n+            range: TextRange::offset_len(err.offset, 1.into()),\n+            msg: err.msg,\n+        }));\n+        res\n+    }\n+\n     pub fn syntax_tree(&self) -> String {\n         ::libsyntax2::utils::dump_tree(&self.inner.syntax())\n     }"}, {"sha": "eeb7ae6f63fd9e1305a4e371c846d02bf7e137f4", "filename": "src/ast/mod.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fast%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fast%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fast%2Fmod.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -2,7 +2,7 @@ mod generated;\n \n use std::sync::Arc;\n use {\n-    SyntaxNode, SyntaxRoot, TreeRoot,\n+    SyntaxNode, SyntaxRoot, TreeRoot, SyntaxError,\n     SyntaxKind::*,\n };\n pub use self::generated::*;\n@@ -19,6 +19,10 @@ impl File<Arc<SyntaxRoot>> {\n }\n \n impl<R: TreeRoot> File<R> {\n+    pub fn errors(&self) -> Vec<SyntaxError> {\n+        self.syntax().root.errors.clone()\n+    }\n+\n     pub fn functions<'a>(&'a self) -> impl Iterator<Item = Function<R>> + 'a {\n         self.syntax()\n             .children()"}, {"sha": "ca33618a0abfff343c58be892a5b88c08bcb6761", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -45,7 +45,7 @@ pub use {\n     lexer::{tokenize, Token},\n     syntax_kinds::SyntaxKind,\n     text_unit::{TextRange, TextUnit},\n-    yellow::{SyntaxNode, SyntaxNodeRef, SyntaxRoot, TreeRoot},\n+    yellow::{SyntaxNode, SyntaxNodeRef, SyntaxRoot, TreeRoot, SyntaxError},\n };\n \n "}, {"sha": "1fbb872a534f058e2cbf4ef0552eaff59c5ccc53", "filename": "src/utils.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -29,7 +29,7 @@ pub fn dump_tree(syntax: &SyntaxNode) -> String {\n                     let off = node.range().end();\n                     while err_pos < errors.len() && errors[err_pos].offset <= off {\n                         indent!();\n-                        writeln!(buf, \"err: `{}`\", errors[err_pos].message).unwrap();\n+                        writeln!(buf, \"err: `{}`\", errors[err_pos].msg).unwrap();\n                         err_pos += 1;\n                     }\n                 }\n@@ -41,7 +41,7 @@ pub fn dump_tree(syntax: &SyntaxNode) -> String {\n \n     assert_eq!(level, 0);\n     for err in errors[err_pos..].iter() {\n-        writeln!(buf, \"err: `{}`\", err.message).unwrap();\n+        writeln!(buf, \"err: `{}`\", err.msg).unwrap();\n     }\n \n     return buf;"}, {"sha": "5e94e50554ff20831ab2652242994cb9f96e472a", "filename": "src/yellow/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fyellow%2Fbuilder.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -51,7 +51,7 @@ impl<'a> Sink<'a> for GreenBuilder<'a> {\n \n     fn error(&mut self, message: String) {\n         self.errors.push(SyntaxError {\n-            message,\n+            msg: message,\n             offset: self.pos,\n         })\n     }"}, {"sha": "6129ecb99e1a6e8c7c66e47027a38f5344e02fbf", "filename": "src/yellow/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fyellow%2Fmod.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -3,10 +3,9 @@ mod green;\n mod red;\n mod syntax;\n \n-pub use self::syntax::{SyntaxNode, SyntaxNodeRef, SyntaxRoot, TreeRoot};\n+pub use self::syntax::{SyntaxNode, SyntaxNodeRef, SyntaxRoot, TreeRoot, SyntaxError};\n pub(crate) use self::{\n     builder::GreenBuilder,\n     green::GreenNode,\n     red::RedNode,\n-    syntax::SyntaxError,\n };"}, {"sha": "2ba9281fc257e9bf3834962ca7b9d4bcf1b02944", "filename": "src/yellow/syntax.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fsyntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a900fd6815d3ea722b5e664aee9eac8bb9cb14f/src%2Fyellow%2Fsyntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fyellow%2Fsyntax.rs?ref=4a900fd6815d3ea722b5e664aee9eac8bb9cb14f", "patch": "@@ -46,9 +46,9 @@ impl SyntaxRoot {\n }\n \n #[derive(Debug, Clone, PartialEq, Eq, Hash, Ord, PartialOrd)]\n-pub(crate) struct SyntaxError {\n-    pub(crate) message: String,\n-    pub(crate) offset: TextUnit,\n+pub struct SyntaxError {\n+    pub msg: String,\n+    pub offset: TextUnit,\n }\n \n impl SyntaxNode<Arc<SyntaxRoot>> {"}]}