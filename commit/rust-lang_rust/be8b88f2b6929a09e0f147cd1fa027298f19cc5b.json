{"sha": "be8b88f2b6929a09e0f147cd1fa027298f19cc5b", "node_id": "C_kwDOAAsO6NoAKGJlOGI4OGYyYjY5MjlhMDllMGYxNDdjZDFmYTAyNzI5OGYxOWNjNWI", "commit": {"author": {"name": "AzureMarker", "email": "mark.drobnak@gmail.com", "date": "2021-12-29T22:53:55Z"}, "committer": {"name": "Mark Drobnak", "email": "mark.drobnak@gmail.com", "date": "2022-06-14T03:44:56Z"}, "message": "Lower listen backlog to fix accept crashes\n\nSee https://github.com/Meziu/rust-horizon/pull/1", "tree": {"sha": "976024421189bdc4ac7650ababc70cc0c08c369c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/976024421189bdc4ac7650ababc70cc0c08c369c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be8b88f2b6929a09e0f147cd1fa027298f19cc5b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEJn5ZTY8tfNoIJXFiR6Ez87+dA9MFAmKoBDgACgkQR6Ez87+d\nA9OpywgAgZcp2CFIDRoDlsOFJlVtD+emlZOjgiSvjWr/X4cVwq98xqbf6xQDCKOY\nsfkuxRjKwxDwSBIjWiAZGjmnu9tztTkBxJllDFkHHcyxKZDmOu7JNCYy/fxoMX+A\n0L0uwrfegGmYA38pXP2bjPc4pZX7t8FntdsAk4eViPZMa9HwK35fvM4GLsrzK+7h\n0YssZic1qVRmqQuQiLTiFjU9jlz0fErZOGsd9mAymfRd362y+pVL08Ns5p3BmWxJ\nET3IAd60P1+BC8Y3uSWoJ9ZVMB86Kq+/2qagVpSObTLh+Lo2IWBQk9g+JrPhiaSW\nF7iFohZYP34GGCmC74tLM7FeLvwEYw==\n=VAoY\n-----END PGP SIGNATURE-----", "payload": "tree 976024421189bdc4ac7650ababc70cc0c08c369c\nparent 4e808f87ccb706d339c9ea10c3c9a9c9fd7fc6cb\nauthor AzureMarker <mark.drobnak@gmail.com> 1640818435 -0500\ncommitter Mark Drobnak <mark.drobnak@gmail.com> 1655178296 -0700\n\nLower listen backlog to fix accept crashes\n\nSee https://github.com/Meziu/rust-horizon/pull/1\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be8b88f2b6929a09e0f147cd1fa027298f19cc5b", "html_url": "https://github.com/rust-lang/rust/commit/be8b88f2b6929a09e0f147cd1fa027298f19cc5b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be8b88f2b6929a09e0f147cd1fa027298f19cc5b/comments", "author": {"login": "AzureMarker", "id": 4417660, "node_id": "MDQ6VXNlcjQ0MTc2NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4417660?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AzureMarker", "html_url": "https://github.com/AzureMarker", "followers_url": "https://api.github.com/users/AzureMarker/followers", "following_url": "https://api.github.com/users/AzureMarker/following{/other_user}", "gists_url": "https://api.github.com/users/AzureMarker/gists{/gist_id}", "starred_url": "https://api.github.com/users/AzureMarker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AzureMarker/subscriptions", "organizations_url": "https://api.github.com/users/AzureMarker/orgs", "repos_url": "https://api.github.com/users/AzureMarker/repos", "events_url": "https://api.github.com/users/AzureMarker/events{/privacy}", "received_events_url": "https://api.github.com/users/AzureMarker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "AzureMarker", "id": 4417660, "node_id": "MDQ6VXNlcjQ0MTc2NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4417660?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AzureMarker", "html_url": "https://github.com/AzureMarker", "followers_url": "https://api.github.com/users/AzureMarker/followers", "following_url": "https://api.github.com/users/AzureMarker/following{/other_user}", "gists_url": "https://api.github.com/users/AzureMarker/gists{/gist_id}", "starred_url": "https://api.github.com/users/AzureMarker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AzureMarker/subscriptions", "organizations_url": "https://api.github.com/users/AzureMarker/orgs", "repos_url": "https://api.github.com/users/AzureMarker/repos", "events_url": "https://api.github.com/users/AzureMarker/events{/privacy}", "received_events_url": "https://api.github.com/users/AzureMarker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e808f87ccb706d339c9ea10c3c9a9c9fd7fc6cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e808f87ccb706d339c9ea10c3c9a9c9fd7fc6cb", "html_url": "https://github.com/rust-lang/rust/commit/4e808f87ccb706d339c9ea10c3c9a9c9fd7fc6cb"}], "stats": {"total": 19, "additions": 13, "deletions": 6}, "files": [{"sha": "f5730a2cea52b5b4c469428f8fe156990b66c9bc", "filename": "library/std/src/sys_common/net.rs", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/be8b88f2b6929a09e0f147cd1fa027298f19cc5b/library%2Fstd%2Fsrc%2Fsys_common%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be8b88f2b6929a09e0f147cd1fa027298f19cc5b/library%2Fstd%2Fsrc%2Fsys_common%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Fnet.rs?ref=be8b88f2b6929a09e0f147cd1fa027298f19cc5b", "patch": "@@ -398,13 +398,20 @@ impl TcpListener {\n         let (addrp, len) = addr.into_inner();\n         cvt(unsafe { c::bind(sock.as_raw(), addrp, len as _) })?;\n \n-        // Start listening\n-        #[cfg(not(target_os = \"horizon\"))]\n-        cvt(unsafe { c::listen(sock.as_raw(), 128) })?;\n-        // 40 is the maximum for Horizon OS\n-        #[cfg(target_os = \"horizon\")]\n-        cvt(unsafe { c::listen(sock.as_raw(), 40) })?;\n+        cfg_if::cfg_if! {\n+            if #[cfg(target_os = \"horizon\")] {\n+                // The 3DS doesn't support a big connection backlog. Sometimes\n+                // it allows up to about 37, but other times it doesn't even\n+                // accept 32. There may be a global limitation causing this.\n+                let backlog = 20;\n+            } else {\n+                // The default for all other platforms\n+                let backlog = 128;\n+            }\n+        }\n \n+        // Start listening\n+        cvt(unsafe { c::listen(sock.as_raw(), backlog) })?;\n         Ok(TcpListener { inner: sock })\n     }\n "}]}