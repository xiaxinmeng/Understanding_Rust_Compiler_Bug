{"sha": "c9636158d91dda241eca5a729fcb7e2a45d7a950", "node_id": "C_kwDOAAsO6NoAKGM5NjM2MTU4ZDkxZGRhMjQxZWNhNWE3MjlmY2I3ZTJhNDVkN2E5NTA", "commit": {"author": {"name": "Jacob Lifshay", "email": "programmerjake@gmail.com", "date": "2022-06-06T19:16:17Z"}, "committer": {"name": "Jacob Lifshay", "email": "programmerjake@gmail.com", "date": "2022-06-06T19:16:17Z"}, "message": "Change `Simd::splat` to not generate a loop\n\nThis fixes poor codegen in some circumstances for `u16x8::splat` on x86_64\nhttps://rust-lang.zulipchat.com/#narrow/stream/257879-project-portable-simd/topic/Very.20bad.20.60u16x8.3A.3Asplat.60.20codegen.20on.20x86_64", "tree": {"sha": "f690714998694d2736d2a172e44097ae7dddbb16", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f690714998694d2736d2a172e44097ae7dddbb16"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9636158d91dda241eca5a729fcb7e2a45d7a950", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9636158d91dda241eca5a729fcb7e2a45d7a950", "html_url": "https://github.com/rust-lang/rust/commit/c9636158d91dda241eca5a729fcb7e2a45d7a950", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9636158d91dda241eca5a729fcb7e2a45d7a950/comments", "author": {"login": "programmerjake", "id": 4584340, "node_id": "MDQ6VXNlcjQ1ODQzNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4584340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/programmerjake", "html_url": "https://github.com/programmerjake", "followers_url": "https://api.github.com/users/programmerjake/followers", "following_url": "https://api.github.com/users/programmerjake/following{/other_user}", "gists_url": "https://api.github.com/users/programmerjake/gists{/gist_id}", "starred_url": "https://api.github.com/users/programmerjake/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/programmerjake/subscriptions", "organizations_url": "https://api.github.com/users/programmerjake/orgs", "repos_url": "https://api.github.com/users/programmerjake/repos", "events_url": "https://api.github.com/users/programmerjake/events{/privacy}", "received_events_url": "https://api.github.com/users/programmerjake/received_events", "type": "User", "site_admin": false}, "committer": {"login": "programmerjake", "id": 4584340, "node_id": "MDQ6VXNlcjQ1ODQzNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4584340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/programmerjake", "html_url": "https://github.com/programmerjake", "followers_url": "https://api.github.com/users/programmerjake/followers", "following_url": "https://api.github.com/users/programmerjake/following{/other_user}", "gists_url": "https://api.github.com/users/programmerjake/gists{/gist_id}", "starred_url": "https://api.github.com/users/programmerjake/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/programmerjake/subscriptions", "organizations_url": "https://api.github.com/users/programmerjake/orgs", "repos_url": "https://api.github.com/users/programmerjake/repos", "events_url": "https://api.github.com/users/programmerjake/events{/privacy}", "received_events_url": "https://api.github.com/users/programmerjake/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f237f133c1c0c0025ac3d162c07a36cb18112051", "url": "https://api.github.com/repos/rust-lang/rust/commits/f237f133c1c0c0025ac3d162c07a36cb18112051", "html_url": "https://github.com/rust-lang/rust/commit/f237f133c1c0c0025ac3d162c07a36cb18112051"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "8379135826d1362bfd4dd952a17bc455e78d559c", "filename": "crates/core_simd/src/vector.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c9636158d91dda241eca5a729fcb7e2a45d7a950/crates%2Fcore_simd%2Fsrc%2Fvector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9636158d91dda241eca5a729fcb7e2a45d7a950/crates%2Fcore_simd%2Fsrc%2Fvector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fvector.rs?ref=c9636158d91dda241eca5a729fcb7e2a45d7a950", "patch": "@@ -9,8 +9,9 @@ pub use uint::*;\n // Vectors of pointers are not for public use at the current time.\n pub(crate) mod ptr;\n \n-use crate::simd::intrinsics;\n-use crate::simd::{LaneCount, Mask, MaskElement, SimdPartialOrd, SupportedLaneCount};\n+use crate::simd::{\n+    intrinsics, LaneCount, Mask, MaskElement, SimdPartialOrd, SupportedLaneCount, Swizzle,\n+};\n \n /// A SIMD vector of `LANES` elements of type `T`. `Simd<T, N>` has the same shape as [`[T; N]`](array), but operates like `T`.\n ///\n@@ -123,8 +124,12 @@ where\n     /// let v = u32x4::splat(8);\n     /// assert_eq!(v.as_array(), &[8, 8, 8, 8]);\n     /// ```\n-    pub const fn splat(value: T) -> Self {\n-        Self([value; LANES])\n+    pub fn splat(value: T) -> Self {\n+        struct Splat;\n+        impl<const LANES: usize> Swizzle<1, LANES> for Splat {\n+            const INDEX: [usize; LANES] = [0; LANES];\n+        }\n+        Splat::swizzle(Simd::<T, 1>::from([value]))\n     }\n \n     /// Returns an array reference containing the entire SIMD vector."}]}