{"sha": "b10aed0084e3fb32b365dba06a1b644c3b0f438b", "node_id": "C_kwDOAAsO6NoAKGIxMGFlZDAwODRlM2ZiMzJiMzY1ZGJhMDZhMWI2NDRjM2IwZjQzOGI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-02T05:32:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-02T05:32:57Z"}, "message": "Auto merge of #100935 - cuviper:upgrade-android-ci, r=Mark-Simulacrum\n\nci: Upgrade android containers from ubuntu:16.04 to 22.04\n\nThe main goal of updating to 22.04 is to get away from `llvm.allow-old-toolchain`.\nThese containers are not building LLVM for android, so only the host version matters.\nA side benefit is that they can also use the system `cmake` instead of building one.", "tree": {"sha": "2c07f6779095b1815236e3236a3dd189ef225388", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c07f6779095b1815236e3236a3dd189ef225388"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b10aed0084e3fb32b365dba06a1b644c3b0f438b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b10aed0084e3fb32b365dba06a1b644c3b0f438b", "html_url": "https://github.com/rust-lang/rust/commit/b10aed0084e3fb32b365dba06a1b644c3b0f438b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b10aed0084e3fb32b365dba06a1b644c3b0f438b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "301348077d364d536d5f7cb57a72b85d9966ded6", "url": "https://api.github.com/repos/rust-lang/rust/commits/301348077d364d536d5f7cb57a72b85d9966ded6", "html_url": "https://github.com/rust-lang/rust/commit/301348077d364d536d5f7cb57a72b85d9966ded6"}, {"sha": "9e5bc44be45b53e71af45d66613d2fdb62f4d523", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e5bc44be45b53e71af45d66613d2fdb62f4d523", "html_url": "https://github.com/rust-lang/rust/commit/9e5bc44be45b53e71af45d66613d2fdb62f4d523"}], "stats": {"total": 24, "additions": 7, "deletions": 17}, "files": [{"sha": "7a875c960e13312d77d11983c0f4bab304b4c554", "filename": "src/ci/docker/host-x86_64/arm-android/Dockerfile", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Farm-android%2FDockerfile?ref=b10aed0084e3fb32b365dba06a1b644c3b0f438b", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n COPY scripts/android-base-apt-get.sh /scripts/\n RUN sh /scripts/android-base-apt-get.sh\n \n@@ -13,7 +14,7 @@ RUN dpkg --add-architecture i386 && \\\n   libgl1-mesa-glx \\\n   libpulse0 \\\n   libstdc++6:i386 \\\n-  openjdk-9-jre-headless \\\n+  openjdk-8-jre-headless \\\n   tzdata \\\n   wget \\\n   python3\n@@ -29,20 +30,12 @@ ENV PATH=$PATH:/android/sdk/platform-tools\n \n ENV TARGETS=arm-linux-androideabi\n \n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n-ENV NO_DOWNLOAD_CI_LLVM 1\n-\n-ENV RUST_CONFIGURE_ARGS --arm-linux-androideabi-ndk=/android/ndk/arm-14 \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --arm-linux-androideabi-ndk=/android/ndk/arm-14\n \n ENV SCRIPT python3 ../x.py --stage 2 test --host='' --target $TARGETS\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n COPY scripts/android-start-emulator.sh /scripts/\n ENTRYPOINT [\"/scripts/android-start-emulator.sh\"]"}, {"sha": "2328db4ab8b1d126dd774a67a744afb990bde1e0", "filename": "src/ci/docker/host-x86_64/dist-android/Dockerfile", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-android%2FDockerfile?ref=b10aed0084e3fb32b365dba06a1b644c3b0f438b", "patch": "@@ -1,4 +1,4 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n COPY scripts/android-base-apt-get.sh /scripts/\n RUN sh /scripts/android-base-apt-get.sh\n@@ -32,13 +32,9 @@ ENV RUST_CONFIGURE_ARGS \\\n       --i686-linux-android-ndk=/android/ndk/x86-14 \\\n       --aarch64-linux-android-ndk=/android/ndk/arm64-21 \\\n       --x86_64-linux-android-ndk=/android/ndk/x86_64-21 \\\n-      --disable-docs \\\n-      --set llvm.allow-old-toolchain\n+      --disable-docs\n \n ENV SCRIPT python3 ../x.py dist --host='' --target $TARGETS\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n-\n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh"}, {"sha": "22e2e243e430a0d7a9d103b3bcdb63ed697c2691", "filename": "src/ci/docker/scripts/android-base-apt-get.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b10aed0084e3fb32b365dba06a1b644c3b0f438b/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fandroid-base-apt-get.sh?ref=b10aed0084e3fb32b365dba06a1b644c3b0f438b", "patch": "@@ -10,6 +10,7 @@ apt-get install -y --no-install-recommends \\\n   g++ \\\n   git \\\n   libssl-dev \\\n+  libncurses5 \\\n   make \\\n   ninja-build \\\n   pkg-config \\"}]}