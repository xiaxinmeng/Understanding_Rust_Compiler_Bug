{"sha": "c433d542cf64304d2f701c42165bbb4ae55c0309", "node_id": "C_kwDOAAsO6NoAKGM0MzNkNTQyY2Y2NDMwNGQyZjcwMWM0MjE2NWJiYjRhZTU1YzAzMDk", "commit": {"author": {"name": "kraktus", "email": "kraktus@users.noreply.github.com", "date": "2022-09-10T09:36:31Z"}, "committer": {"name": "kraktus", "email": "kraktus@users.noreply.github.com", "date": "2022-09-10T09:42:37Z"}, "message": "Do not lint `use_self` in proc macro expansion", "tree": {"sha": "293fa61a3ba0c365357b9f0a18e3f518cb9d76fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/293fa61a3ba0c365357b9f0a18e3f518cb9d76fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c433d542cf64304d2f701c42165bbb4ae55c0309", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c433d542cf64304d2f701c42165bbb4ae55c0309", "html_url": "https://github.com/rust-lang/rust/commit/c433d542cf64304d2f701c42165bbb4ae55c0309", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c433d542cf64304d2f701c42165bbb4ae55c0309/comments", "author": {"login": "kraktus", "id": 56031107, "node_id": "MDQ6VXNlcjU2MDMxMTA3", "avatar_url": "https://avatars.githubusercontent.com/u/56031107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kraktus", "html_url": "https://github.com/kraktus", "followers_url": "https://api.github.com/users/kraktus/followers", "following_url": "https://api.github.com/users/kraktus/following{/other_user}", "gists_url": "https://api.github.com/users/kraktus/gists{/gist_id}", "starred_url": "https://api.github.com/users/kraktus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kraktus/subscriptions", "organizations_url": "https://api.github.com/users/kraktus/orgs", "repos_url": "https://api.github.com/users/kraktus/repos", "events_url": "https://api.github.com/users/kraktus/events{/privacy}", "received_events_url": "https://api.github.com/users/kraktus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kraktus", "id": 56031107, "node_id": "MDQ6VXNlcjU2MDMxMTA3", "avatar_url": "https://avatars.githubusercontent.com/u/56031107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kraktus", "html_url": "https://github.com/kraktus", "followers_url": "https://api.github.com/users/kraktus/followers", "following_url": "https://api.github.com/users/kraktus/following{/other_user}", "gists_url": "https://api.github.com/users/kraktus/gists{/gist_id}", "starred_url": "https://api.github.com/users/kraktus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kraktus/subscriptions", "organizations_url": "https://api.github.com/users/kraktus/orgs", "repos_url": "https://api.github.com/users/kraktus/repos", "events_url": "https://api.github.com/users/kraktus/events{/privacy}", "received_events_url": "https://api.github.com/users/kraktus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5652ccbc0ff4e3895caca34a147db04c40d734c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/5652ccbc0ff4e3895caca34a147db04c40d734c6", "html_url": "https://github.com/rust-lang/rust/commit/5652ccbc0ff4e3895caca34a147db04c40d734c6"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "d1c00341818c33aa3196662b18be23c943a4f38e", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c433d542cf64304d2f701c42165bbb4ae55c0309/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c433d542cf64304d2f701c42165bbb4ae55c0309/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=c433d542cf64304d2f701c42165bbb4ae55c0309", "patch": "@@ -1,6 +1,6 @@\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::ty::same_type_and_consts;\n-use clippy_utils::{meets_msrv, msrvs};\n+use clippy_utils::{is_from_proc_macro, meets_msrv, msrvs};\n use if_chain::if_chain;\n use rustc_data_structures::fx::FxHashSet;\n use rustc_errors::Applicability;\n@@ -87,7 +87,7 @@ impl_lint_pass!(UseSelf => [USE_SELF]);\n const SEGMENTS_MSG: &str = \"segments should be composed of at least 1 element\";\n \n impl<'tcx> LateLintPass<'tcx> for UseSelf {\n-    fn check_item(&mut self, _cx: &LateContext<'_>, item: &Item<'_>) {\n+    fn check_item(&mut self, cx: &LateContext<'tcx>, item: &Item<'tcx>) {\n         if matches!(item.kind, ItemKind::OpaqueTy(_)) {\n             // skip over `ItemKind::OpaqueTy` in order to lint `foo() -> impl <..>`\n             return;\n@@ -103,6 +103,7 @@ impl<'tcx> LateLintPass<'tcx> for UseSelf {\n             if parameters.as_ref().map_or(true, |params| {\n                 !params.parenthesized && !params.args.iter().any(|arg| matches!(arg, GenericArg::Lifetime(_)))\n             });\n+            if !is_from_proc_macro(cx, item); // expensive, should be last check\n             then {\n                 StackItem::Check {\n                     impl_id: item.def_id,"}, {"sha": "37986187da179b6acd40a6a006596a48343ae28a", "filename": "tests/ui/use_self.fixed", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c433d542cf64304d2f701c42165bbb4ae55c0309/tests%2Fui%2Fuse_self.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c433d542cf64304d2f701c42165bbb4ae55c0309/tests%2Fui%2Fuse_self.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.fixed?ref=c433d542cf64304d2f701c42165bbb4ae55c0309", "patch": "@@ -608,3 +608,12 @@ mod issue8845 {\n         }\n     }\n }\n+\n+mod issue6902 {\n+    use serde::Serialize;\n+\n+    #[derive(Serialize)]\n+    pub enum Foo {\n+        Bar = 1,\n+    }\n+}"}, {"sha": "1b2b3337c92ed00fc30a08d00bb405c9dd4abe8d", "filename": "tests/ui/use_self.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c433d542cf64304d2f701c42165bbb4ae55c0309/tests%2Fui%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c433d542cf64304d2f701c42165bbb4ae55c0309/tests%2Fui%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.rs?ref=c433d542cf64304d2f701c42165bbb4ae55c0309", "patch": "@@ -608,3 +608,12 @@ mod issue8845 {\n         }\n     }\n }\n+\n+mod issue6902 {\n+    use serde::Serialize;\n+\n+    #[derive(Serialize)]\n+    pub enum Foo {\n+        Bar = 1,\n+    }\n+}"}]}