{"sha": "64a27880de6dc7362cb5453807859324d9ce34b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0YTI3ODgwZGU2ZGM3MzYyY2I1NDUzODA3ODU5MzI0ZDljZTM0Yjc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-15T18:01:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-15T18:01:24Z"}, "message": "Rollup merge of #74294 - msirringhaus:master, r=pietroalbini\n\nUpdate cross-compilation README\n\nREADME seemed rather out of date. I hope the information in my PR is now correct (it was more or less assembled by asking in zulip and learning-by-doing).", "tree": {"sha": "5f4634554c1b5383d8986937a59b3da4553af1dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f4634554c1b5383d8986937a59b3da4553af1dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64a27880de6dc7362cb5453807859324d9ce34b7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfD0R0CRBK7hj4Ov3rIwAAdHIIAECD/3EdPtwZENkfAzXsYEHi\n21Z80Y9+yoDPyj/NSHlJK77g1lO70sdhT9gHozGeiMkWWHhcvu0MXmBAcQqMRZy1\nQcIe4OJj8Z/McnMY57yQ/RvD4fwxnfnZOxowjZZYSPEyF8ZqC/fnYPMKwdHrIXVA\nTP6kv70EGCEXEEfjiSTwYe0axIXxfeUGp1rtZJxw4eXrzkrnTwvKsuSIJFl1gOcb\nDbWP7IzhxX2XlE+S5MWqamzMSZTCHKvgUdjrXPm1sZU9IXu5LggMOxNiRSNpUD1m\ngxzKenoCjiV+yUGbkIEfu6rnrG5L6ozgKvbKL+uDrohWC8xbV1WiD1BNmLtHj/g=\n=Fk86\n-----END PGP SIGNATURE-----\n", "payload": "tree 5f4634554c1b5383d8986937a59b3da4553af1dc\nparent b7cf2cbd78ea5e5f6a4514cb631942dc6516c6f4\nparent 92e010e4a16769def3014bf6f1d3fa821a02f7a9\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594836084 -0700\ncommitter GitHub <noreply@github.com> 1594836084 -0700\n\nRollup merge of #74294 - msirringhaus:master, r=pietroalbini\n\nUpdate cross-compilation README\n\nREADME seemed rather out of date. I hope the information in my PR is now correct (it was more or less assembled by asking in zulip and learning-by-doing).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64a27880de6dc7362cb5453807859324d9ce34b7", "html_url": "https://github.com/rust-lang/rust/commit/64a27880de6dc7362cb5453807859324d9ce34b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64a27880de6dc7362cb5453807859324d9ce34b7/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7cf2cbd78ea5e5f6a4514cb631942dc6516c6f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7cf2cbd78ea5e5f6a4514cb631942dc6516c6f4", "html_url": "https://github.com/rust-lang/rust/commit/b7cf2cbd78ea5e5f6a4514cb631942dc6516c6f4"}, {"sha": "92e010e4a16769def3014bf6f1d3fa821a02f7a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/92e010e4a16769def3014bf6f1d3fa821a02f7a9", "html_url": "https://github.com/rust-lang/rust/commit/92e010e4a16769def3014bf6f1d3fa821a02f7a9"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "ff28f4f603c9dcc97fe4bbdb0ba6378e3080b8db", "filename": "src/ci/docker/README.md", "status": "modified", "additions": 31, "deletions": 8, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/64a27880de6dc7362cb5453807859324d9ce34b7/src%2Fci%2Fdocker%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/64a27880de6dc7362cb5453807859324d9ce34b7/src%2Fci%2Fdocker%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2FREADME.md?ref=64a27880de6dc7362cb5453807859324d9ce34b7", "patch": "@@ -16,6 +16,11 @@ for example:\n \n Images will output artifacts in an `obj` dir at the root of a repository.\n \n+To match conditions in rusts CI, also set the environment variable `DEPLOY=1`, e.g.:\n+```\n+DEPLOY=1 ./src/ci/docker/run.sh x86_64-gnu\n+```\n+\n **NOTE**: Re-using the same `obj` dir with different docker images with\n the same target triple (e.g. `dist-x86_64-linux` and `dist-various-1`)\n may result in strange linker errors, due shared library versions differing between platforms.\n@@ -85,42 +90,60 @@ how to generate them, and how the existing ones were generated.\n \n ### Generating a `.config` file\n \n+**NOTE:** Existing Dockerfiles can also be a good guide for the process and order\n+of script execution.\n+\n If you have a `linux-cross` image lying around you can use that and skip the\n next two steps.\n \n-- First we spin up a container and copy `build_toolchain_root.sh` into it. All\n+- First we spin up a container and copy all scripts into it. All\n   these steps are outside the container:\n \n ```\n-# Note: We use ubuntu:15.10 because that's the \"base\" of linux-cross Docker\n-# image\n-$ docker run -it ubuntu:15.10 bash\n+# Note: We use ubuntu:16.04 because that's the \"base\" of linux-cross Docker\n+# image, or simply run ./src/ci/docker/run.sh once, which will download the correct\n+# one and you can check it out with `docker images`\n+$ docker run -it ubuntu:16.04 bash\n+# in another terminal:\n $ docker ps\n CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n-cfbec05ed730        ubuntu:15.10        \"bash\"              16 seconds ago      Up 15 seconds                           drunk_murdock\n-$ docker cp build_toolchain_root.sh drunk_murdock:/\n+cfbec05ed730        ubuntu:16.04        \"bash\"              16 seconds ago      Up 15 seconds                           drunk_murdock\n+$ docker cp src/ci/docker/scripts drunk_murdock:/tmp/\n ```\n \n - Then inside the container we build crosstool-ng by simply calling the bash\n   script we copied in the previous step:\n \n ```\n-$ bash build_toolchain_root.sh\n+$ cd /tmp/scripts\n+# Download packages necessary for building\n+$ bash ./cross-apt-packages.sh\n+# Download and build crosstool-ng\n+$ bash ./crosstool-ng.sh\n+```\n+\n+- In case you want to adjust or start from an existing config, copy that\n+  to the container. `crosstool-ng` will automatically load `./.config` if\n+  present. Otherwise one can use the TUI to load any config-file.\n+\n+```\n+$ docker cp arm-linux-gnueabi.config drunk_murdock:/tmp/.config\n ```\n \n - Now, inside the container run the following command to configure the\n   toolchain. To get a clue of which options need to be changed check the next\n   section and come back.\n \n ```\n+$ cd /tmp/\n $ ct-ng menuconfig\n ```\n \n - Finally, we retrieve the `.config` file from the container and give it a\n   meaningful name. This is done outside the container.\n \n ```\n-$ docker drunk_murdock:/.config arm-linux-gnueabi.config\n+$ docker cp drunk_murdock:/tmp/.config arm-linux-gnueabi.config\n ```\n \n - Now you can shutdown the container or repeat the two last steps to generate a"}]}