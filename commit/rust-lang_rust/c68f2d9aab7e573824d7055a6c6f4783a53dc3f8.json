{"sha": "c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2OGYyZDlhYWI3ZTU3MzgyNGQ3MDU1YTZjNmY0NzgzYTUzZGMzZjg=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-07-25T04:53:43Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-07-25T17:22:43Z"}, "message": "Remove notification channels in runtime (closes #1078)", "tree": {"sha": "b82238e4f030415a8ff1dfe035aa896548ed0090", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b82238e4f030415a8ff1dfe035aa896548ed0090"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "html_url": "https://github.com/rust-lang/rust/commit/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9e8efca1946b658546d4973250dc4a34f914b94", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9e8efca1946b658546d4973250dc4a34f914b94", "html_url": "https://github.com/rust-lang/rust/commit/d9e8efca1946b658546d4973250dc4a34f914b94"}], "stats": {"total": 37, "additions": 0, "deletions": 37}, "files": [{"sha": "f9d1f71f0ac94c543df605531a992c0cfa4057fe", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "patch": "@@ -637,11 +637,6 @@ rust_new_task_in_sched(rust_sched_id id) {\n     return new_task_common(sched, task);\n }\n \n-extern \"C\" CDECL void\n-rust_task_config_notify(rust_task *target, rust_port_id *port) {\n-    target->config_notify(*port);\n-}\n-\n extern \"C\" rust_task *\n rust_get_task() {\n     return rust_get_current_task();"}, {"sha": "ab07f317550ce7497f1037842f03e3fd09cd9d11", "filename": "src/rt/rust_task.cpp", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_task.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_task.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_task.cpp?ref=c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "patch": "@@ -15,7 +15,6 @@ rust_task::rust_task(rust_sched_loop *sched_loop, rust_task_state state,\n                      const char *name, size_t init_stack_sz) :\n     ref_count(1),\n     id(0),\n-    notify_enabled(false),\n     stk(NULL),\n     runtime_sp(0),\n     sched(sched_loop->sched),\n@@ -141,8 +140,6 @@ cleanup_task(cleanup_args *args) {\n \n     task->die();\n \n-    task->notify(!threw_exception);\n-\n #ifdef __WIN32__\n     assert(!threw_exception && \"No exception-handling yet on windows builds\");\n #endif\n@@ -454,23 +451,6 @@ rust_task::calloc(size_t size, const char *tag) {\n     return local_region.calloc(size, tag);\n }\n \n-void\n-rust_task::notify(bool success) {\n-    // FIXME (#1078) Do this in rust code\n-    if(notify_enabled) {\n-        rust_port *target_port =\n-            kernel->get_port_by_id(notify_port);\n-        if(target_port) {\n-            task_notification msg;\n-            msg.id = id;\n-            msg.result = !success ? tr_failure : tr_success;\n-\n-            target_port->send(&msg);\n-            target_port->deref();\n-        }\n-    }\n-}\n-\n size_t\n rust_task::get_next_stack_size(size_t min, size_t current, size_t requested) {\n     LOG(this, mem, \"calculating new stack size for 0x%\" PRIxPTR, this);\n@@ -636,12 +616,6 @@ rust_task::delete_all_stacks() {\n     }\n }\n \n-void\n-rust_task::config_notify(rust_port_id port) {\n-    notify_enabled = true;\n-    notify_port = port;\n-}\n-\n /*\n Returns true if we're currently running on the Rust stack\n  */"}, {"sha": "3b8e78cf1dd0310ff6b4377b9ad65247a35343e4", "filename": "src/rt/rust_task.h", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_task.h", "raw_url": "https://github.com/rust-lang/rust/raw/c68f2d9aab7e573824d7055a6c6f4783a53dc3f8/src%2Frt%2Frust_task.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_task.h?ref=c68f2d9aab7e573824d7055a6c6f4783a53dc3f8", "patch": "@@ -125,8 +125,6 @@ rust_task : public kernel_owned<rust_task>\n     RUST_ATOMIC_REFCOUNT();\n \n     rust_task_id id;\n-    bool notify_enabled;\n-    rust_port_id notify_port;\n \n     context ctx;\n     stk_seg *stk;\n@@ -285,8 +283,6 @@ rust_task : public kernel_owned<rust_task>\n     // not at all safe.\n     intptr_t get_ref_count() const { return ref_count; }\n \n-    void notify(bool success);\n-\n     void *next_stack(size_t stk_sz, void *args_addr, size_t args_sz);\n     void prev_stack();\n     void record_stack_limit();\n@@ -296,8 +292,6 @@ rust_task : public kernel_owned<rust_task>\n     void check_stack_canary();\n     void delete_all_stacks();\n \n-    void config_notify(rust_port_id port);\n-\n     void call_on_c_stack(void *args, void *fn_ptr);\n     void call_on_rust_stack(void *args, void *fn_ptr);\n     bool have_c_stack() { return c_stack != NULL; }"}]}