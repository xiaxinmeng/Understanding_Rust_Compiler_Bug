{"sha": "1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMGRiNGNmZWRjYjllY2RjOGRmNjJhYWMyMmJlYzAwYTVjM2MxYjU=", "commit": {"author": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2021-06-24T23:38:32Z"}, "committer": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2021-07-06T22:50:10Z"}, "message": "Parse tool name for command line lint options", "tree": {"sha": "1a1f730f67b7091eb04266b16f4b52704f4a4dbf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a1f730f67b7091eb04266b16f4b52704f4a4dbf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "html_url": "https://github.com/rust-lang/rust/commit/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "65b28a987bfce11c37634fff2be129ffc16096d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/65b28a987bfce11c37634fff2be129ffc16096d5", "html_url": "https://github.com/rust-lang/rust/commit/65b28a987bfce11c37634fff2be129ffc16096d5"}], "stats": {"total": 47, "additions": 44, "deletions": 3}, "files": [{"sha": "76ac4cfdf84e5bcc6fa37d435fa119e14139e412", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "patch": "@@ -334,9 +334,16 @@ impl LintStore {\n         }\n     }\n \n-    /// Checks the validity of lint names derived from the command line\n-    pub fn check_lint_name_cmdline(&self, sess: &Session, lint_name: &str, level: Level) {\n-        let db = match self.check_lint_name(lint_name, None) {\n+    /// Checks the validity of lint names derived from the command line. Returns\n+    /// true if the lint is valid, false otherwise.\n+    pub fn check_lint_name_cmdline(\n+        &self,\n+        sess: &Session,\n+        lint_name: &str,\n+        level: Option<Level>,\n+    ) -> bool {\n+        let (tool_name, lint_name) = parse_lint_and_tool_name(lint_name);\n+        let db = match self.check_lint_name(lint_name, tool_name) {\n             CheckLintNameResult::Ok(_) => None,\n             CheckLintNameResult::Warning(ref msg, _) => Some(sess.struct_warn(msg)),\n             CheckLintNameResult::NoLint(suggestion) => {\n@@ -1018,3 +1025,10 @@ impl<'tcx> LayoutOf for LateContext<'tcx> {\n         self.tcx.layout_of(self.param_env.and(ty))\n     }\n }\n+\n+pub fn parse_lint_and_tool_name(lint_name: &str) -> (Option<Symbol>, &str) {\n+    match lint_name.split_once(\"::\") {\n+        Some((tool_name, lint_name)) => (Some(Symbol::intern(tool_name)), lint_name),\n+        None => (None, lint_name),\n+    }\n+}"}, {"sha": "6f0cedca90c00fda98735ac9fd55ce07c96ab840", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "patch": "@@ -494,3 +494,6 @@ fn register_internals(store: &mut LintStore) {\n         ],\n     );\n }\n+\n+#[cfg(test)]\n+mod tests;"}, {"sha": "a50c88aa0f736df4ff5e0d67d251e63ffd0319b3", "filename": "compiler/rustc_lint/src/tests.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5/compiler%2Frustc_lint%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftests.rs?ref=1e0db4cfedcb9ecdc8df62aac22bec00a5c3c1b5", "patch": "@@ -0,0 +1,24 @@\n+use crate::context::parse_lint_and_tool_name;\n+use rustc_span::{with_default_session_globals, Symbol};\n+\n+#[test]\n+fn parse_lint_no_tool() {\n+    with_default_session_globals(|| assert_eq!(parse_lint_and_tool_name(\"foo\"), (None, \"foo\")));\n+}\n+\n+#[test]\n+fn parse_lint_with_tool() {\n+    with_default_session_globals(|| {\n+        assert_eq!(parse_lint_and_tool_name(\"clippy::foo\"), (Some(Symbol::intern(\"clippy\")), \"foo\"))\n+    });\n+}\n+\n+#[test]\n+fn parse_lint_multiple_path() {\n+    with_default_session_globals(|| {\n+        assert_eq!(\n+            parse_lint_and_tool_name(\"clippy::foo::bar\"),\n+            (Some(Symbol::intern(\"clippy\")), \"foo::bar\")\n+        )\n+    });\n+}"}]}