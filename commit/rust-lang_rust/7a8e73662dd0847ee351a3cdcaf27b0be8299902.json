{"sha": "7a8e73662dd0847ee351a3cdcaf27b0be8299902", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhOGU3MzY2MmRkMDg0N2VlMzUxYTNjZGNhZjI3YjBiZTgyOTk5MDI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-12T01:50:12Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-12-12T02:49:04Z"}, "message": "rt: Make unwinding through __morestack work on mac\n\nHad to bump the min stack size in some of the tests from 256 bytes\nto 1024 bytes. Not sure why yet.", "tree": {"sha": "bfa9403e403d1e418a8c0f9a3853333df2411d9e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bfa9403e403d1e418a8c0f9a3853333df2411d9e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a8e73662dd0847ee351a3cdcaf27b0be8299902", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a8e73662dd0847ee351a3cdcaf27b0be8299902", "html_url": "https://github.com/rust-lang/rust/commit/7a8e73662dd0847ee351a3cdcaf27b0be8299902", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a8e73662dd0847ee351a3cdcaf27b0be8299902/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7bc34f63d85ee7d351b90320239fc48860f01da2", "url": "https://api.github.com/repos/rust-lang/rust/commits/7bc34f63d85ee7d351b90320239fc48860f01da2", "html_url": "https://github.com/rust-lang/rust/commit/7bc34f63d85ee7d351b90320239fc48860f01da2"}], "stats": {"total": 30, "additions": 9, "deletions": 21}, "files": [{"sha": "b30a5af21525f86c0258eef23883c58f27fe2c36", "filename": "src/rt/arch/i386/morestack.S", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Frt%2Farch%2Fi386%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fi386%2Fmorestack.S?ref=7a8e73662dd0847ee351a3cdcaf27b0be8299902", "patch": "@@ -47,17 +47,17 @@\n #endif\n \n MORESTACK:\n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t.cfi_startproc\n #endif\n \n \tpushl %ebp\n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t.cfi_def_cfa_offset 8\n \t.cfi_offset %ebp, -8\n #endif\n \tmovl %esp, %ebp\n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t.cfi_def_cfa_register %ebp\n #endif\n \n@@ -69,7 +69,7 @@ MORESTACK:\n \tjz .L$bail\n \n \t// During unwinding we want to skip our caller.\n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t// Don't understand this line. I think it means that\n \t// the next frame's pc is the return address of our caller.\n \t.cfi_offset 8, 8\n@@ -134,7 +134,7 @@ MORESTACK:\n \taddl $16,%esp\n \n \tpopl %ebp\n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t.cfi_restore %ebp\n \t.cfi_def_cfa %esp, 4\n #endif\n@@ -150,7 +150,7 @@ MORESTACK:\n \t\n \tjmpl *%edx\n \n-#ifdef __linux__\n+#if defined(__linux__) || defined(__APPLE__)\n \t.cfi_endproc\n #endif\n "}, {"sha": "6686071361b966b4da6cca68c7cc9bab6529af1d", "filename": "src/rt/arch/x86_64/morestack.S", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S?ref=7a8e73662dd0847ee351a3cdcaf27b0be8299902", "patch": "@@ -50,30 +50,22 @@\n \n #if defined(__linux__) || defined(__APPLE__)\n MORESTACK:\n-#if defined(__ELF__)\n \t.cfi_startproc\n-#endif\n \t\n \t// Set up a normal backtrace\n \tpushq %rbp\n-#if defined(__ELF__)\n \t.cfi_def_cfa_offset 16\n \t.cfi_offset %rbp, -16\n-#endif\n \tmovq %rsp, %rbp\n-#if defined(__ELF__)\n \t.cfi_def_cfa_register %rbp\n-#endif\n \n \t// During unwinding we want to skip our caller since it's not\n \t// a complete frame and will make the unwinder sad\n-#if defined(__linux__)\n \t// Don't understand this line\n \t.cfi_offset 16, 0\n \t// Tell the unwinding where to get the stack pointer for\n \t// our grandparent frame\n \t.cfi_offset %rsp, -24\n-#endif\n \n \t// Save the grandparent stack pointer for the unwinder\n \tleaq 16(%rbp), %rax\n@@ -147,15 +139,11 @@ MORESTACK:\n \n \taddq $8, %rsp\n \tpopq %rbp\n-#ifdef __linux__\n \t.cfi_restore %rbp\n \t.cfi_def_cfa %rsp, 8\n-#endif\n \tret\n \t\n-#if defined(__ELF__)\n \t.cfi_endproc\n-#endif\n \n #else\n MORESTACK:"}, {"sha": "b47108ba026da4ab8c36745c76028a073e875ab6", "filename": "src/test/run-fail/morestack2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Ftest%2Frun-fail%2Fmorestack2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Ftest%2Frun-fail%2Fmorestack2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fmorestack2.rs?ref=7a8e73662dd0847ee351a3cdcaf27b0be8299902", "patch": "@@ -33,7 +33,7 @@ resource and_then_get_big_again(_i: ()) {\n }\n \n fn main() {\n-    rustrt::set_min_stack(256u);\n+    rustrt::set_min_stack(1024u);\n     std::task::spawn((), fn (&&_i: ()) {\n         let r = and_then_get_big_again(());\n         getbig_call_c_and_fail(10000);"}, {"sha": "93faea60a52ae92a068c6faf30705f9b1438619d", "filename": "src/test/run-fail/morestack3.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Ftest%2Frun-fail%2Fmorestack3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a8e73662dd0847ee351a3cdcaf27b0be8299902/src%2Ftest%2Frun-fail%2Fmorestack3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fmorestack3.rs?ref=7a8e73662dd0847ee351a3cdcaf27b0be8299902", "patch": "@@ -29,6 +29,6 @@ resource and_then_get_big_again(_i: @int) {\n }\n \n fn main() {\n-    rustrt::set_min_stack(256u);\n-    std::task::spawn(100, getbig_and_fail);\n+    rustrt::set_min_stack(1024u);\n+    std::task::spawn(400, getbig_and_fail);\n }\n\\ No newline at end of file"}]}