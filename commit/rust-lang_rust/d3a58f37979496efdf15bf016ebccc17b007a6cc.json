{"sha": "d3a58f37979496efdf15bf016ebccc17b007a6cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzYTU4ZjM3OTc5NDk2ZWZkZjE1YmYwMTZlYmNjYzE3YjAwN2E2Y2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-04-19T02:45:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-04-19T02:45:48Z"}, "message": "auto merge of #5943 : brson/rust/struct-return, r=graydon\n\nMac appears to follow the same ABI as MSVC. This fixes one case\r\nbut leaves others broken, like windows.", "tree": {"sha": "7dee88a2a46cd2e3d48c502251fd3fd0ca17ac80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7dee88a2a46cd2e3d48c502251fd3fd0ca17ac80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d3a58f37979496efdf15bf016ebccc17b007a6cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d3a58f37979496efdf15bf016ebccc17b007a6cc", "html_url": "https://github.com/rust-lang/rust/commit/d3a58f37979496efdf15bf016ebccc17b007a6cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d3a58f37979496efdf15bf016ebccc17b007a6cc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9618e5b459198865ab70ba7cf3a3edffdef1f7f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9618e5b459198865ab70ba7cf3a3edffdef1f7f5", "html_url": "https://github.com/rust-lang/rust/commit/9618e5b459198865ab70ba7cf3a3edffdef1f7f5"}, {"sha": "8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "html_url": "https://github.com/rust-lang/rust/commit/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0"}], "stats": {"total": 14, "additions": 5, "deletions": 9}, "files": [{"sha": "08b8c3db3cabfc312e1f0961910f9f25b18793fc", "filename": "src/librustc/middle/trans/cabi_x86.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs?ref=d3a58f37979496efdf15bf016ebccc17b007a6cc", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use driver::session::os_win32;\n+use driver::session::{os_win32, os_macos};\n use core::option::*;\n use lib::llvm::*;\n use lib::llvm::llvm::*;\n@@ -38,12 +38,12 @@ impl ABIInfo for X86_ABIInfo {\n \n         // Rules for returning structs taken from\n         // http://www.angelcode.com/dev/callconv/callconv.html\n+        // Clang's ABI handling is in lib/CodeGen/TargetInfo.cpp\n         let sret = {\n             let returning_a_struct = unsafe { LLVMGetTypeKind(rty) == Struct && ret_def };\n-            let big_struct = if self.ccx.sess.targ_cfg.os != os_win32 {\n-                true\n-            } else {\n-                llsize_of_alloc(self.ccx, rty) > 8\n+            let big_struct = match self.ccx.sess.targ_cfg.os {\n+                os_win32 | os_macos => llsize_of_alloc(self.ccx, rty) > 8,\n+                _ => true\n             };\n             returning_a_struct && big_struct\n         };"}, {"sha": "16d14a96cfe4f64cd2089b83f549ead34c7a1d63", "filename": "src/test/run-pass/extern-pass-TwoU32s.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs?ref=d3a58f37979496efdf15bf016ebccc17b007a6cc", "patch": "@@ -11,8 +11,6 @@\n // Test a foreign function that accepts and returns a struct\n // by value.\n \n-// xfail-macos Broken on mac i686\n-\n #[deriving(Eq)]\n struct TwoU32s {\n     one: u32, two: u32"}, {"sha": "9e374687855b0aea2c6fbad15b4ab94df15ec07e", "filename": "src/test/run-pass/extern-return-TwoU32s.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3a58f37979496efdf15bf016ebccc17b007a6cc/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs?ref=d3a58f37979496efdf15bf016ebccc17b007a6cc", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// xfail-macos Broken on mac i686\n-\n struct TwoU32s {\n     one: u32, two: u32\n }"}]}