{"sha": "f70af91e51709cbffe195aa698e287be56eeaa47", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3MGFmOTFlNTE3MDljYmZmZTE5NWFhNjk4ZTI4N2JlNTZlZWFhNDc=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-03-21T18:47:52Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-03-24T07:27:46Z"}, "message": "bless; add test for mutating a static", "tree": {"sha": "52914afa130cc39b0c82e0f231eb3303dd331aea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52914afa130cc39b0c82e0f231eb3303dd331aea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f70af91e51709cbffe195aa698e287be56eeaa47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f70af91e51709cbffe195aa698e287be56eeaa47", "html_url": "https://github.com/rust-lang/rust/commit/f70af91e51709cbffe195aa698e287be56eeaa47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f70af91e51709cbffe195aa698e287be56eeaa47/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d9649adea5d1bb745b86814791e5fb72589a005", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d9649adea5d1bb745b86814791e5fb72589a005", "html_url": "https://github.com/rust-lang/rust/commit/9d9649adea5d1bb745b86814791e5fb72589a005"}], "stats": {"total": 52, "additions": 48, "deletions": 4}, "files": [{"sha": "bf5e476d80045711821a4f014efab4ed776bb231", "filename": "src/test/ui/consts/const-eval/assign-to-static-within-other-static.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fassign-to-static-within-other-static.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fassign-to-static-within-other-static.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fassign-to-static-within-other-static.stderr?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -2,7 +2,7 @@ error[E0080]: could not evaluate static initializer\n   --> $DIR/assign-to-static-within-other-static.rs:10:5\n    |\n LL |     FOO = 5;\n-   |     ^^^^^^^ tried to modify a static's initial value from another static's initializer\n+   |     ^^^^^^^ modifying a static's initial value from another static's initializer\n \n error: aborting due to previous error\n "}, {"sha": "29a13b18e5ba319518d9bada666d89594e729701", "filename": "src/test/ui/consts/miri_unleashed/mutable_const.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutable_const.stderr?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -11,7 +11,7 @@ LL | / const MUTATING_BEHIND_RAW: () = {\n LL | |     // Test that `MUTABLE_BEHIND_RAW` is actually immutable, by doing this at const time.\n LL | |     unsafe {\n LL | |         *MUTABLE_BEHIND_RAW = 99\n-   | |         ^^^^^^^^^^^^^^^^^^^^^^^^ writing to alloc1 which is read-only\n+   | |         ^^^^^^^^^^^^^^^^^^^^^^^^ modifying a static's initial value from another static's initializer\n LL | |     }\n LL | | };\n    | |__-"}, {"sha": "acc6fb026cd696352e91f36eea106f3612343070", "filename": "src/test/ui/consts/miri_unleashed/mutating_global.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.rs?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -0,0 +1,15 @@\n+// compile-flags: -Zunleash-the-miri-inside-of-you\n+\n+// Make sure we cannot mutate globals.\n+\n+static mut GLOBAL: i32 = 0;\n+\n+const MUTATING_GLOBAL: () = {\n+    unsafe {\n+        GLOBAL = 99 //~ ERROR any use of this value will cause an error\n+        //~^ WARN skipping const checks\n+        //~| WARN skipping const checks\n+    }\n+};\n+\n+fn main() {}"}, {"sha": "4e67d2c0fb85e88721f290c0c482c20b39004f0c", "filename": "src/test/ui/consts/miri_unleashed/mutating_global.stderr", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fmutating_global.stderr?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -0,0 +1,29 @@\n+warning: skipping const checks\n+  --> $DIR/mutating_global.rs:9:9\n+   |\n+LL |         GLOBAL = 99\n+   |         ^^^^^^\n+\n+warning: skipping const checks\n+  --> $DIR/mutating_global.rs:9:9\n+   |\n+LL |         GLOBAL = 99\n+   |         ^^^^^^\n+\n+error: any use of this value will cause an error\n+  --> $DIR/mutating_global.rs:9:9\n+   |\n+LL | / const MUTATING_GLOBAL: () = {\n+LL | |     unsafe {\n+LL | |         GLOBAL = 99\n+   | |         ^^^^^^^^^^^ modifying a static's initial value from another static's initializer\n+LL | |\n+LL | |\n+LL | |     }\n+LL | | };\n+   | |__-\n+   |\n+   = note: `#[deny(const_err)]` on by default\n+\n+error: aborting due to previous error\n+"}, {"sha": "8db75dd63cf2a0e5357f7e65bf3ee69bd4d52a98", "filename": "src/test/ui/consts/static_mut_containing_mut_ref2.mut_refs.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref2.mut_refs.stderr?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -2,7 +2,7 @@ error[E0080]: could not evaluate static initializer\n   --> $DIR/static_mut_containing_mut_ref2.rs:7:45\n    |\n LL | pub static mut STDERR_BUFFER: () = unsafe { *(&mut STDERR_BUFFER_SPACE) = 42; };\n-   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ tried to modify a static's initial value from another static's initializer\n+   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ modifying a static's initial value from another static's initializer\n \n error: aborting due to previous error\n "}, {"sha": "91f9dbd8d0b9efc8b1e385eebc9b604455af2daf", "filename": "src/test/ui/consts/static_mut_containing_mut_ref3.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f70af91e51709cbffe195aa698e287be56eeaa47/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstatic_mut_containing_mut_ref3.stderr?ref=f70af91e51709cbffe195aa698e287be56eeaa47", "patch": "@@ -2,7 +2,7 @@ error[E0080]: could not evaluate static initializer\n   --> $DIR/static_mut_containing_mut_ref3.rs:3:31\n    |\n LL | static mut BAR: () = unsafe { FOO.0 = 99; };\n-   |                               ^^^^^^^^^^ tried to modify a static's initial value from another static's initializer\n+   |                               ^^^^^^^^^^ modifying a static's initial value from another static's initializer\n \n error: aborting due to previous error\n "}]}