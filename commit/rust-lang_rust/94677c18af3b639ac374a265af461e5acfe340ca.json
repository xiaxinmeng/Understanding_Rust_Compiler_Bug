{"sha": "94677c18af3b639ac374a265af461e5acfe340ca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0Njc3YzE4YWYzYjYzOWFjMzc0YTI2NWFmNDYxZTVhY2ZlMzQwY2E=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-04T06:56:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-04T06:56:01Z"}, "message": "auto merge of #10254 : sfackler/rust/rustpkg-test-failure, r=alexcrichton\n\nIt previously set the exit status, but the main wrapper paved over that\r\nwith an exit code of 0.\r\n\r\nCloses #9761", "tree": {"sha": "d093c26050b75c9b82b61fa62fd08a5aaa6b95b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d093c26050b75c9b82b61fa62fd08a5aaa6b95b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94677c18af3b639ac374a265af461e5acfe340ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94677c18af3b639ac374a265af461e5acfe340ca", "html_url": "https://github.com/rust-lang/rust/commit/94677c18af3b639ac374a265af461e5acfe340ca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94677c18af3b639ac374a265af461e5acfe340ca/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "556088cfb115b5aa39050043058eb345a55e3764", "url": "https://api.github.com/repos/rust-lang/rust/commits/556088cfb115b5aa39050043058eb345a55e3764", "html_url": "https://github.com/rust-lang/rust/commit/556088cfb115b5aa39050043058eb345a55e3764"}, {"sha": "ff859edb8579be4694fe490249e9800cefe50c8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff859edb8579be4694fe490249e9800cefe50c8c", "html_url": "https://github.com/rust-lang/rust/commit/ff859edb8579be4694fe490249e9800cefe50c8c"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "80f1dc2fe93859a8edbfde2072e546594911c76c", "filename": "src/librustpkg/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/94677c18af3b639ac374a265af461e5acfe340ca/src%2Flibrustpkg%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94677c18af3b639ac374a265af461e5acfe340ca/src%2Flibrustpkg%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Flib.rs?ref=94677c18af3b639ac374a265af461e5acfe340ca", "patch": "@@ -699,7 +699,9 @@ impl CtxMethods for BuildContext {\n                 debug!(\"test: test_exec = {}\", test_exec.display());\n                 // FIXME (#9639): This needs to handle non-utf8 paths\n                 let status = run::process_status(test_exec.as_str().unwrap(), [~\"--test\"]);\n-                os::set_exit_status(status);\n+                if status != 0 {\n+                    fail!(\"Some tests failed\");\n+                }\n             }\n             None => {\n                 error(format!(\"Internal error: test executable for package ID {} in workspace {} \\"}, {"sha": "072c165cd96e730aa9ad0b948aee0165ea0fd6c6", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/94677c18af3b639ac374a265af461e5acfe340ca/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94677c18af3b639ac374a265af461e5acfe340ca/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=94677c18af3b639ac374a265af461e5acfe340ca", "patch": "@@ -2097,6 +2097,20 @@ fn test_rustpkg_test_output() {\n     assert!(output_str.contains(\"1 passed; 0 failed; 0 ignored; 0 measured\"));\n }\n \n+#[test]\n+fn test_rustpkg_test_failure_exit_status() {\n+    let foo_id = PkgId::new(\"foo\");\n+    let foo_workspace = create_local_package(&foo_id);\n+    let foo_workspace = foo_workspace.path();\n+    writeFile(&foo_workspace.join_many([\"src\", \"foo-0.1\", \"test.rs\"]),\n+              \"#[test] fn f() { assert!('a' != 'a'); }\");\n+    let res = command_line_test_partial([~\"test\", ~\"foo\"], foo_workspace);\n+    match res {\n+        Fail(_) => {},\n+        Success(*) => fail!(\"Expected test failure but got success\")\n+    }\n+}\n+\n #[test]\n fn test_rebuild_when_needed() {\n     let foo_id = PkgId::new(\"foo\");\n@@ -2118,6 +2132,7 @@ fn test_rebuild_when_needed() {\n }\n \n #[test]\n+#[ignore] // FIXME (#10257): This doesn't work as is since a read only file can't execute\n fn test_no_rebuilding() {\n     let foo_id = PkgId::new(\"foo\");\n     let foo_workspace = create_local_package(&foo_id);"}]}