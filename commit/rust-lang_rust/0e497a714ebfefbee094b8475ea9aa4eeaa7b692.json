{"sha": "0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "node_id": "C_kwDOAAsO6NoAKDBlNDk3YTcxNGViZmVmYmVlMDk0Yjg0NzVlYTlhYTRlZWFhN2I2OTI", "commit": {"author": {"name": "Luis Cardoso", "email": "61982523+LuisCardosoOliveira@users.noreply.github.com", "date": "2022-09-08T06:15:37Z"}, "committer": {"name": "Luis Cardoso", "email": "61982523+LuisCardosoOliveira@users.noreply.github.com", "date": "2022-09-08T10:22:51Z"}, "message": "translations(rustc_session): migrates two diagnostics in session.rs", "tree": {"sha": "765b0cc3bea0410594f7c8668bd1b703cd21d7d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/765b0cc3bea0410594f7c8668bd1b703cd21d7d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "html_url": "https://github.com/rust-lang/rust/commit/0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/comments", "author": {"login": "LuisCardosoOliveira", "id": 61982523, "node_id": "MDQ6VXNlcjYxOTgyNTIz", "avatar_url": "https://avatars.githubusercontent.com/u/61982523?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LuisCardosoOliveira", "html_url": "https://github.com/LuisCardosoOliveira", "followers_url": "https://api.github.com/users/LuisCardosoOliveira/followers", "following_url": "https://api.github.com/users/LuisCardosoOliveira/following{/other_user}", "gists_url": "https://api.github.com/users/LuisCardosoOliveira/gists{/gist_id}", "starred_url": "https://api.github.com/users/LuisCardosoOliveira/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LuisCardosoOliveira/subscriptions", "organizations_url": "https://api.github.com/users/LuisCardosoOliveira/orgs", "repos_url": "https://api.github.com/users/LuisCardosoOliveira/repos", "events_url": "https://api.github.com/users/LuisCardosoOliveira/events{/privacy}", "received_events_url": "https://api.github.com/users/LuisCardosoOliveira/received_events", "type": "User", "site_admin": false}, "committer": {"login": "LuisCardosoOliveira", "id": 61982523, "node_id": "MDQ6VXNlcjYxOTgyNTIz", "avatar_url": "https://avatars.githubusercontent.com/u/61982523?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LuisCardosoOliveira", "html_url": "https://github.com/LuisCardosoOliveira", "followers_url": "https://api.github.com/users/LuisCardosoOliveira/followers", "following_url": "https://api.github.com/users/LuisCardosoOliveira/following{/other_user}", "gists_url": "https://api.github.com/users/LuisCardosoOliveira/gists{/gist_id}", "starred_url": "https://api.github.com/users/LuisCardosoOliveira/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LuisCardosoOliveira/subscriptions", "organizations_url": "https://api.github.com/users/LuisCardosoOliveira/orgs", "repos_url": "https://api.github.com/users/LuisCardosoOliveira/repos", "events_url": "https://api.github.com/users/LuisCardosoOliveira/events{/privacy}", "received_events_url": "https://api.github.com/users/LuisCardosoOliveira/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "24de9435e2d4efe2bde043f389579a72fb532c6f", "url": "https://api.github.com/repos/rust-lang/rust/commits/24de9435e2d4efe2bde043f389579a72fb532c6f", "html_url": "https://github.com/rust-lang/rust/commit/24de9435e2d4efe2bde043f389579a72fb532c6f"}], "stats": {"total": 43, "additions": 30, "deletions": 13}, "files": [{"sha": "d2a2958f62436180cee3436fec51d91694485772", "filename": "compiler/rustc_error_messages/locales/en-US/session.ftl", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsession.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsession.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsession.ftl?ref=0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "patch": "@@ -15,8 +15,6 @@ session_feature_diagnostic_for_issue =\n session_feature_diagnostic_help =\n     add `#![feature({$feature})]` to the crate attributes to enable\n \n-session_target_data_layout_parse_error = {$err}\n-\n session_not_circumvent_feature = `-Zunleash-the-miri-inside-of-you` may not be used to circumvent feature gates, except when testing error paths in the CTFE engine\n \n session_profile_use_file_does_not_exist = file `{$path}` passed to `-C profile-use` does not exist.\n@@ -54,3 +52,7 @@ session_target_inconsistent_architecture = inconsistent target specification: \"d\n session_target_inconsistent_pointer_width = inconsistent target specification: \"data-layout\" claims pointers are {$pointer_size}-bit, while \"target-pointer-width\" is `{$target}`\n \n session_target_invalid_bits_size = {$err}\n+\n+session_target_stack_protector_not_supported = `-Z stack-protector={$stack_protector}` is not supported for target {$target_triple} and will be ignored\n+\n+session_split_debuginfo_unstable_platform = `-Csplit-debuginfo={$debuginfo}` is unstable on this platform"}, {"sha": "a774b52c8a592e75a321efa8b377c04167b2fd92", "filename": "compiler/rustc_errors/src/diagnostic.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs?ref=0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "patch": "@@ -10,7 +10,7 @@ use rustc_lint_defs::{Applicability, LintExpectationId};\n use rustc_span::edition::LATEST_STABLE_EDITION;\n use rustc_span::symbol::{Ident, MacroRulesNormalizedIdent, Symbol};\n use rustc_span::{edition::Edition, Span, DUMMY_SP};\n-use rustc_target::spec::PanicStrategy;\n+use rustc_target::spec::{PanicStrategy, SplitDebuginfo, StackProtector, TargetTriple};\n use std::borrow::Cow;\n use std::fmt;\n use std::hash::{Hash, Hasher};\n@@ -93,6 +93,9 @@ into_diagnostic_arg_using_display!(\n     Ident,\n     MacroRulesNormalizedIdent,\n     ParseIntError,\n+    StackProtector,\n+    &TargetTriple,\n+    SplitDebuginfo\n );\n \n impl IntoDiagnosticArg for bool {"}, {"sha": "3c93cfab183d24206e796c2ebd9e0e808fc00e0a", "filename": "compiler/rustc_session/src/errors.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_session%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_session%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Ferrors.rs?ref=0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "patch": "@@ -6,6 +6,7 @@ use rustc_errors::{fluent, DiagnosticBuilder, Handler, MultiSpan};\n use rustc_macros::SessionDiagnostic;\n use rustc_span::{Span, Symbol};\n use rustc_target::abi::TargetDataLayoutErrors;\n+use rustc_target::spec::{SplitDebuginfo, StackProtector, TargetTriple};\n \n #[derive(SessionDiagnostic)]\n #[diag(session::incorrect_cgu_reuse_type)]\n@@ -156,3 +157,16 @@ pub struct UnstableVirtualFunctionElimination;\n pub struct UnsupportedDwarfVersion {\n     pub dwarf_version: u32,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[diag(session::target_stack_protector_not_supported)]\n+pub struct StackProtectorNotSupportedForTarget<'a> {\n+    pub stack_protector: StackProtector,\n+    pub target_triple: &'a TargetTriple,\n+}\n+\n+#[derive(SessionDiagnostic)]\n+#[diag(session::split_debuginfo_unstable_platform)]\n+pub struct SplitDebugInfoUnstablePlatform {\n+    pub debuginfo: SplitDebuginfo,\n+}"}, {"sha": "caf9d582ab09970db94218b3da91b47994f89fe6", "filename": "compiler/rustc_session/src/session.rs", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_session%2Fsrc%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e497a714ebfefbee094b8475ea9aa4eeaa7b692/compiler%2Frustc_session%2Fsrc%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fsession.rs?ref=0e497a714ebfefbee094b8475ea9aa4eeaa7b692", "patch": "@@ -5,8 +5,9 @@ use crate::config::{self, CrateType, InstrumentCoverage, OptLevel, OutputType, S\n use crate::errors::{\n     CannotEnableCrtStaticLinux, CannotMixAndMatchSanitizers, LinkerPluginToWindowsNotSupported,\n     NotCircumventFeature, ProfileSampleUseFileDoesNotExist, ProfileUseFileDoesNotExist,\n-    SanitizerCfiEnabled, SanitizerNotSupported, SanitizersNotSupported, TargetRequiresUnwindTables,\n-    UnstableVirtualFunctionElimination, UnsupportedDwarfVersion,\n+    SanitizerCfiEnabled, SanitizerNotSupported, SanitizersNotSupported,\n+    SplitDebugInfoUnstablePlatform, StackProtectorNotSupportedForTarget,\n+    TargetRequiresUnwindTables, UnstableVirtualFunctionElimination, UnsupportedDwarfVersion,\n };\n use crate::parse::{add_feature_diagnostics, ParseSess};\n use crate::search_paths::{PathKind, SearchPath};\n@@ -1544,10 +1545,10 @@ fn validate_commandline_args_with_session_available(sess: &Session) {\n \n     if sess.opts.unstable_opts.stack_protector != StackProtector::None {\n         if !sess.target.options.supports_stack_protector {\n-            sess.warn(&format!(\n-                \"`-Z stack-protector={}` is not supported for target {} and will be ignored\",\n-                sess.opts.unstable_opts.stack_protector, sess.opts.target_triple\n-            ))\n+            sess.emit_warning(StackProtectorNotSupportedForTarget {\n+                stack_protector: sess.opts.unstable_opts.stack_protector,\n+                target_triple: &sess.opts.target_triple,\n+            });\n         }\n     }\n \n@@ -1560,10 +1561,7 @@ fn validate_commandline_args_with_session_available(sess: &Session) {\n     if !sess.target.options.supported_split_debuginfo.contains(&sess.split_debuginfo())\n         && !sess.opts.unstable_opts.unstable_options\n     {\n-        sess.err(&format!(\n-            \"`-Csplit-debuginfo={}` is unstable on this platform\",\n-            sess.split_debuginfo()\n-        ));\n+        sess.emit_err(SplitDebugInfoUnstablePlatform { debuginfo: sess.split_debuginfo() });\n     }\n }\n "}]}