{"sha": "04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZWNlZTE1OGMyYzU2ZjRhNmQ4MWFkMTdhYzM1NDc4NDhlYzFlNGM=", "commit": {"author": {"name": "Austin Bonander", "email": "austin.bonander@gmail.com", "date": "2017-01-16T06:58:17Z"}, "committer": {"name": "Austin Bonander", "email": "austin.bonander@gmail.com", "date": "2017-01-17T06:41:23Z"}, "message": "Move \"completed feature gate checking\" pass to after \"name resolution\" pass so proc-macro-attribute feature gate check can use resolve", "tree": {"sha": "fa4cad5272cd06c30a025603b3e5476202554cf8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa4cad5272cd06c30a025603b3e5476202554cf8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "html_url": "https://github.com/rust-lang/rust/commit/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/comments", "author": {"login": "abonander", "id": 3198595, "node_id": "MDQ6VXNlcjMxOTg1OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonander", "html_url": "https://github.com/abonander", "followers_url": "https://api.github.com/users/abonander/followers", "following_url": "https://api.github.com/users/abonander/following{/other_user}", "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonander/subscriptions", "organizations_url": "https://api.github.com/users/abonander/orgs", "repos_url": "https://api.github.com/users/abonander/repos", "events_url": "https://api.github.com/users/abonander/events{/privacy}", "received_events_url": "https://api.github.com/users/abonander/received_events", "type": "User", "site_admin": false}, "committer": {"login": "abonander", "id": 3198595, "node_id": "MDQ6VXNlcjMxOTg1OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonander", "html_url": "https://github.com/abonander", "followers_url": "https://api.github.com/users/abonander/followers", "following_url": "https://api.github.com/users/abonander/following{/other_user}", "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonander/subscriptions", "organizations_url": "https://api.github.com/users/abonander/orgs", "repos_url": "https://api.github.com/users/abonander/repos", "events_url": "https://api.github.com/users/abonander/events{/privacy}", "received_events_url": "https://api.github.com/users/abonander/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68439614bad206570f0958fc672a3e11cccebf53", "url": "https://api.github.com/repos/rust-lang/rust/commits/68439614bad206570f0958fc672a3e11cccebf53", "html_url": "https://github.com/rust-lang/rust/commit/68439614bad206570f0958fc672a3e11cccebf53"}], "stats": {"total": 27, "additions": 16, "deletions": 11}, "files": [{"sha": "d8c68c340b68f5a16faa20eb21b8964bb24a65a4", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "patch": "@@ -737,17 +737,6 @@ pub fn phase_2_configure_and_expand<F>(sess: &Session,\n          \"checking for inline asm in case the target doesn't support it\",\n          || no_asm::check_crate(sess, &krate));\n \n-    // Needs to go *after* expansion to be able to check the results of macro expansion.\n-    time(time_passes, \"complete gated feature checking\", || {\n-        sess.track_errors(|| {\n-            syntax::feature_gate::check_crate(&krate,\n-                                              &sess.parse_sess,\n-                                              &sess.features.borrow(),\n-                                              &attributes,\n-                                              sess.opts.unstable_features);\n-        })\n-    })?;\n-\n     time(sess.time_passes(),\n          \"early lint checks\",\n          || lint::check_ast_crate(sess, &krate));\n@@ -765,6 +754,17 @@ pub fn phase_2_configure_and_expand<F>(sess: &Session,\n         Ok(())\n     })?;\n \n+    // Needs to go *after* expansion to be able to check the results of macro expansion.\n+    time(time_passes, \"complete gated feature checking\", || {\n+        sess.track_errors(|| {\n+            syntax::feature_gate::check_crate(&krate,\n+                                              &sess.parse_sess,\n+                                              &sess.features.borrow(),\n+                                              &attributes,\n+                                              sess.opts.unstable_features);\n+        })\n+    })?;\n+\n     // Lower ast -> hir.\n     let hir_forest = time(sess.time_passes(), \"lowering ast -> hir\", || {\n         let hir_crate = lower_crate(sess, &krate, &mut resolver);"}, {"sha": "d093364497a9234988d65ecd2d10857ae74fc988", "filename": "src/test/compile-fail/const-fn-stability.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Ftest%2Fcompile-fail%2Fconst-fn-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Ftest%2Fcompile-fail%2Fconst-fn-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fconst-fn-stability.rs?ref=04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "patch": "@@ -16,7 +16,9 @@ const fn foo() -> usize { 0 } //~ ERROR const fn is unstable\n \n trait Foo {\n     const fn foo() -> u32; //~ ERROR const fn is unstable\n+                           //~| ERROR trait fns cannot be declared const\n     const fn bar() -> u32 { 0 } //~ ERROR const fn is unstable\n+                                //~| ERROR trait fns cannot be declared const\n }\n \n impl Foo {\n@@ -25,6 +27,7 @@ impl Foo {\n \n impl Foo for u32 {\n     const fn foo() -> u32 { 0 } //~ ERROR const fn is unstable\n+                                //~| ERROR trait fns cannot be declared const\n }\n \n static FOO: usize = foo();"}, {"sha": "9815db6550d66cc99751050870bde7dc91efc7b9", "filename": "src/test/compile-fail/feature-gate-no-debug.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Ftest%2Fcompile-fail%2Ffeature-gate-no-debug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04ecee158c2c56f4a6d81ad17ac3547848ec1e4c/src%2Ftest%2Fcompile-fail%2Ffeature-gate-no-debug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-no-debug.rs?ref=04ecee158c2c56f4a6d81ad17ac3547848ec1e4c", "patch": "@@ -8,5 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![allow(deprecated)]\n+\n #[no_debug] //~ ERROR the `#[no_debug]` attribute is\n fn main() {}"}]}