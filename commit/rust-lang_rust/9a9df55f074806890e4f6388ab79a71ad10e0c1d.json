{"sha": "9a9df55f074806890e4f6388ab79a71ad10e0c1d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhOWRmNTVmMDc0ODA2ODkwZTRmNjM4OGFiNzlhNzFhZDEwZTBjMWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-18T15:07:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-18T15:07:38Z"}, "message": "Auto merge of #60252 - davidtwco:issue-57672, r=Mark-Simulacrum\n\nDon't suggest changing extern crate w/ alias to use.\n\nFixes #57672.", "tree": {"sha": "df0ce03501267f4b2cf6eafc1b4a5f155e6a7d21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df0ce03501267f4b2cf6eafc1b4a5f155e6a7d21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a9df55f074806890e4f6388ab79a71ad10e0c1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a9df55f074806890e4f6388ab79a71ad10e0c1d", "html_url": "https://github.com/rust-lang/rust/commit/9a9df55f074806890e4f6388ab79a71ad10e0c1d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a9df55f074806890e4f6388ab79a71ad10e0c1d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8aa422a788c45c67d747346276d229d08925fe1", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8aa422a788c45c67d747346276d229d08925fe1", "html_url": "https://github.com/rust-lang/rust/commit/b8aa422a788c45c67d747346276d229d08925fe1"}, {"sha": "8869bc5adade466e9eca01172dfd257f14ab3392", "url": "https://api.github.com/repos/rust-lang/rust/commits/8869bc5adade466e9eca01172dfd257f14ab3392", "html_url": "https://github.com/rust-lang/rust/commit/8869bc5adade466e9eca01172dfd257f14ab3392"}], "stats": {"total": 105, "additions": 54, "deletions": 51}, "files": [{"sha": "3c3509f24ce1eb97000433d6245363ec14f114dd", "filename": "src/librustc_typeck/check_unused.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Flibrustc_typeck%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Flibrustc_typeck%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck_unused.rs?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -158,6 +158,13 @@ fn unused_crates_lint<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>) {\n             continue;\n         }\n \n+        // If the extern crate is renamed, then we cannot suggest replacing it with a use as this\n+        // would not insert the new name into the prelude, where other imports in the crate may be\n+        // expecting it.\n+        if extern_crate.orig_name.is_some() {\n+            continue;\n+        }\n+\n         // If the extern crate has any attributes, they may have funky\n         // semantics we can't faithfully represent using `use` (most\n         // notably `#[macro_use]`). Ignore it."}, {"sha": "26150c7d4a16b77de5f4a76803006e4b48e3bf24", "filename": "src/test/ui/imports/extern-crate-used.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.rs?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -5,10 +5,14 @@\n \n #![deny(unused_extern_crates)]\n \n-extern crate core as iso1; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso2; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso3; //~ ERROR `extern crate` is not idiomatic in the new edition\n-extern crate core as iso4; //~ ERROR `extern crate` is not idiomatic in the new edition\n+// Shouldn't suggest changing to `use`, as new name\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use the new name in\n+// other modules. See #57672.\n+extern crate core as iso1;\n+extern crate core as iso2;\n+extern crate core as iso3;\n+extern crate core as iso4;\n \n // Doesn't introduce its extern prelude entry, so it's still considered unused.\n extern crate core; //~ ERROR unused extern crate"}, {"sha": "397bfa02902c94df7528429b07a8e60dfd17e853", "filename": "src/test/ui/imports/extern-crate-used.stderr", "status": "modified", "additions": 5, "deletions": 29, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fextern-crate-used.stderr?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -1,38 +1,14 @@\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:8:1\n+error: unused extern crate\n+  --> $DIR/extern-crate-used.rs:18:1\n    |\n-LL | extern crate core as iso1;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n+LL | extern crate core;\n+   | ^^^^^^^^^^^^^^^^^^ help: remove it\n    |\n note: lint level defined here\n   --> $DIR/extern-crate-used.rs:6:9\n    |\n LL | #![deny(unused_extern_crates)]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:9:1\n-   |\n-LL | extern crate core as iso2;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:10:1\n-   |\n-LL | extern crate core as iso3;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-used.rs:11:1\n-   |\n-LL | extern crate core as iso4;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: unused extern crate\n-  --> $DIR/extern-crate-used.rs:14:1\n-   |\n-LL | extern crate core;\n-   | ^^^^^^^^^^^^^^^^^^ help: remove it\n-\n-error: aborting due to 5 previous errors\n+error: aborting due to previous error\n "}, {"sha": "e51ce5d1d5b83e48bfc48e65be4538175ec9178b", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.fixed", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.fixed?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -12,8 +12,11 @@\n \n //~^ ERROR unused extern crate\n \n-use edition_lint_paths as bar;\n-//~^ ERROR `extern crate` is not idiomatic in the new edition\n+// Shouldn't suggest changing to `use`, as `bar`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `bar` in other\n+// modules. See #57672.\n+extern crate edition_lint_paths as bar;\n \n fn main() {\n     // This is not considered to *use* the `extern crate` in Rust 2018:"}, {"sha": "debbf085d618293d1ed901a4e535cf6f21414fbc", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.rs?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -12,8 +12,11 @@\n extern crate edition_lint_paths;\n //~^ ERROR unused extern crate\n \n+// Shouldn't suggest changing to `use`, as `bar`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `bar` in other\n+// modules. See #57672.\n extern crate edition_lint_paths as bar;\n-//~^ ERROR `extern crate` is not idiomatic in the new edition\n \n fn main() {\n     // This is not considered to *use* the `extern crate` in Rust 2018:"}, {"sha": "13980c70a82aa219082d4271dd59b17112c8f498", "filename": "src/test/ui/rust-2018/extern-crate-idiomatic-in-2018.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fextern-crate-idiomatic-in-2018.stderr?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -11,11 +11,5 @@ LL | #![deny(rust_2018_idioms)]\n    |         ^^^^^^^^^^^^^^^^\n    = note: #[deny(unused_extern_crates)] implied by #[deny(rust_2018_idioms)]\n \n-error: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/extern-crate-idiomatic-in-2018.rs:15:1\n-   |\n-LL | extern crate edition_lint_paths as bar;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n "}, {"sha": "14575d18c236aa3275b669bdaae93c6bd1f1c887", "filename": "src/test/ui/rust-2018/remove-extern-crate.fixed", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.fixed?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -7,7 +7,11 @@\n #![warn(rust_2018_idioms)]\n \n \n-use core as another_name;\n+// Shouldn't suggest changing to `use`, as `another_name`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `another_name` in other\n+// modules. See #57672.\n+extern crate core as another_name;\n use remove_extern_crate;\n #[macro_use]\n extern crate remove_extern_crate as something_else;"}, {"sha": "0ee85f34e40d99c98bbdb9bbc1649af77bcec8b5", "filename": "src/test/ui/rust-2018/remove-extern-crate.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.rs?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -7,6 +7,10 @@\n #![warn(rust_2018_idioms)]\n \n extern crate core;\n+// Shouldn't suggest changing to `use`, as `another_name`\n+// would no longer be added to the prelude which could cause\n+// compilation errors for imports that use `another_name` in other\n+// modules. See #57672.\n extern crate core as another_name;\n use remove_extern_crate;\n #[macro_use]"}, {"sha": "5de0dfe961338701d99e17fa1cfac2b5d848cf08", "filename": "src/test/ui/rust-2018/remove-extern-crate.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fremove-extern-crate.stderr?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -12,13 +12,7 @@ LL | #![warn(rust_2018_idioms)]\n    = note: #[warn(unused_extern_crates)] implied by #[warn(rust_2018_idioms)]\n \n warning: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/remove-extern-crate.rs:10:1\n-   |\n-LL | extern crate core as another_name;\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert it to a `use`\n-\n-warning: `extern crate` is not idiomatic in the new edition\n-  --> $DIR/remove-extern-crate.rs:28:5\n+  --> $DIR/remove-extern-crate.rs:32:5\n    |\n LL |     extern crate core;\n    |     ^^^^^^^^^^^^^^^^^^ help: convert it to a `use`"}, {"sha": "1773f72fc741c4476a7507f3d20b31abacaf83ea", "filename": "src/test/ui/suggestions/issue-57672.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a9df55f074806890e4f6388ab79a71ad10e0c1d/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-57672.rs?ref=9a9df55f074806890e4f6388ab79a71ad10e0c1d", "patch": "@@ -0,0 +1,14 @@\n+// aux-build:foo.rs\n+// compile-flags:--extern foo\n+// compile-pass\n+// edition:2018\n+\n+#![deny(unused_extern_crates)]\n+\n+extern crate foo as foo_renamed;\n+\n+pub mod m {\n+    pub use foo_renamed::Foo;\n+}\n+\n+fn main() {}"}]}