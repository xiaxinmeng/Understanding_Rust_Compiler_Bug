{"sha": "df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "node_id": "C_kwDOAAsO6NoAKGRmOGIwZGZjMjc3ZTMwMjg4MmQ1MDUyZTIwYjdlYjdiNzI1ZDJiZGY", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-05-22T19:02:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-22T19:02:18Z"}, "message": "Rollup merge of #111612 - ChayimFriedman2:collect-into-slice-ref, r=petrochenkov\n\nGive better error when collecting into `&[T]`\n\nThe detection of slice reference of `{integral}` in `rustc_on_unimplemented` is hacky, but a proper solution requires changing `FmtPrinter` to add a parameter to print integers as `{integral}` and I didn't want to change it just for `rustc_on_unimplemented`. I can do that if requested, though.\n\nI'm open to better wording; this is the best I could come up with.", "tree": {"sha": "74c14e69f9c3cb06f5cf38fe36c2577382c5fb45", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/74c14e69f9c3cb06f5cf38fe36c2577382c5fb45"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJka7w6CRBK7hj4Ov3rIwAA6IQIAHvh1HH87l4kxHWMVhnuk8St\nOHpvrTZJHfrdiYyw6kTcQPCcYJPxGdmbYgPCTACzcNB4z9nBZoyt6JeF4hwjV6uc\nRjNXTxk7aqGlueNEG4qE2RA+7dNiXSH4l46ZdW4N0P1NOYUBUKPKUNigK4iyUq4O\nPffz2SVn/8Q6PfJXG1iGegXL2J2lxcbjV5wYWKNqvK05os7bsCOf85/P2yWZPNpI\nKkADhfPHINp/OCRq9qcQwgCvHzZTA51XMEuMuLVk65Zfyr4Q6lKttiQzOBOXKjVo\nHdEV0Qu613wqV5E5uorVyarXNj7G3F8mBtl6zZ+Az/XJmfeLnQeS0j/YDpge5x8=\n=htip\n-----END PGP SIGNATURE-----\n", "payload": "tree 74c14e69f9c3cb06f5cf38fe36c2577382c5fb45\nparent 47fe1a3e1f625f0e15baeb742e476977de26e6f3\nparent 83930ecdea7eee3191316770071cc6e5019a8e3e\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1684782138 +0530\ncommitter GitHub <noreply@github.com> 1684782138 +0530\n\nRollup merge of #111612 - ChayimFriedman2:collect-into-slice-ref, r=petrochenkov\n\nGive better error when collecting into `&[T]`\n\nThe detection of slice reference of `{integral}` in `rustc_on_unimplemented` is hacky, but a proper solution requires changing `FmtPrinter` to add a parameter to print integers as `{integral}` and I didn't want to change it just for `rustc_on_unimplemented`. I can do that if requested, though.\n\nI'm open to better wording; this is the best I could come up with.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "html_url": "https://github.com/rust-lang/rust/commit/df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47fe1a3e1f625f0e15baeb742e476977de26e6f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/47fe1a3e1f625f0e15baeb742e476977de26e6f3", "html_url": "https://github.com/rust-lang/rust/commit/47fe1a3e1f625f0e15baeb742e476977de26e6f3"}, {"sha": "83930ecdea7eee3191316770071cc6e5019a8e3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/83930ecdea7eee3191316770071cc6e5019a8e3e", "html_url": "https://github.com/rust-lang/rust/commit/83930ecdea7eee3191316770071cc6e5019a8e3e"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "10bd027b6848a1600da45c9f404e9a98cd08f8ba", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/on_unimplemented.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fon_unimplemented.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fon_unimplemented.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fon_unimplemented.rs?ref=df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "patch": "@@ -306,6 +306,14 @@ impl<'tcx> TypeErrCtxtExt<'tcx> for TypeErrCtxt<'_, 'tcx> {\n                     }\n                 }\n             }\n+\n+            // `&[{integral}]` - `FromIterator` needs that.\n+            if let ty::Ref(_, ref_ty, rustc_ast::Mutability::Not) = self_ty.kind()\n+                && let ty::Slice(sty) = ref_ty.kind()\n+                && sty.is_integral()\n+            {\n+                flags.push((sym::_Self, Some(\"&[{integral}]\".to_owned())));\n+            }\n         });\n \n         if let Ok(Some(command)) = OnUnimplementedDirective::of_item(self.tcx, def_id) {"}, {"sha": "0675e56358f9bd76b9cedaa9d875c1ef6f0837c6", "filename": "library/core/src/iter/traits/collect.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Ftraits%2Fcollect.rs?ref=df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "patch": "@@ -94,6 +94,16 @@\n /// ```\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[rustc_on_unimplemented(\n+    on(\n+        _Self = \"&[{A}]\",\n+        message = \"a slice of type `{Self}` cannot be built since we need to store the elements somewhere\",\n+        label = \"try explicitly collecting into a `Vec<{A}>`\",\n+    ),\n+    on(\n+        all(A = \"{integer}\", any(_Self = \"&[{integral}]\",)),\n+        message = \"a slice of type `{Self}` cannot be built since we need to store the elements somewhere\",\n+        label = \"try explicitly collecting into a `Vec<{A}>`\",\n+    ),\n     on(\n         _Self = \"[{A}]\",\n         message = \"a slice of type `{Self}` cannot be built since `{Self}` has no definite size\","}, {"sha": "045d40a6f71ae61b22cb0a53fd82e51bd674a850", "filename": "tests/ui/iterators/collect-into-slice.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/tests%2Fui%2Fiterators%2Fcollect-into-slice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/tests%2Fui%2Fiterators%2Fcollect-into-slice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiterators%2Fcollect-into-slice.rs?ref=df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "patch": "@@ -14,4 +14,10 @@ fn main() {\n     //~| NOTE doesn't have a size known at compile-time\n     //~| NOTE doesn't have a size known at compile-time\n     process_slice(&some_generated_vec);\n+\n+    let some_generated_vec = (0..10).collect();\n+    //~^ ERROR a slice of type `&[i32]` cannot be built since we need to store the elements somewhere\n+    //~| NOTE try explicitly collecting into a `Vec<{integer}>`\n+    //~| NOTE required by a bound in `collect`\n+    process_slice(some_generated_vec);\n }"}, {"sha": "07dc561f06a690009a37fac5e6e547fc77e78f6b", "filename": "tests/ui/iterators/collect-into-slice.stderr", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/tests%2Fui%2Fiterators%2Fcollect-into-slice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/df8b0dfc277e302882d5052e20b7eb7b725d2bdf/tests%2Fui%2Fiterators%2Fcollect-into-slice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiterators%2Fcollect-into-slice.stderr?ref=df8b0dfc277e302882d5052e20b7eb7b725d2bdf", "patch": "@@ -28,6 +28,16 @@ LL |     let some_generated_vec = (0..10).collect();\n note: required by a bound in `collect`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n-error: aborting due to 3 previous errors\n+error[E0277]: a slice of type `&[i32]` cannot be built since we need to store the elements somewhere\n+  --> $DIR/collect-into-slice.rs:18:38\n+   |\n+LL |     let some_generated_vec = (0..10).collect();\n+   |                                      ^^^^^^^ try explicitly collecting into a `Vec<{integer}>`\n+   |\n+   = help: the trait `FromIterator<{integer}>` is not implemented for `&[i32]`\n+note: required by a bound in `collect`\n+  --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n+\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0277`."}]}