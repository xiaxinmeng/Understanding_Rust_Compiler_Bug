{"sha": "c2436d54d0a4482fe073a8f40686471e89305a44", "node_id": "C_kwDOAAsO6NoAKGMyNDM2ZDU0ZDBhNDQ4MmZlMDczYThmNDA2ODY0NzFlODkzMDVhNDQ", "commit": {"author": {"name": "Obei Sideg", "email": "obei.sideg@gmail.com", "date": "2022-07-08T11:01:30Z"}, "committer": {"name": "Obei Sideg", "email": "obei.sideg@gmail.com", "date": "2022-07-08T11:06:50Z"}, "message": "Check if E0530 is `rustc_resolve::late::PatternSource::Match` to emit suggestion", "tree": {"sha": "85b13698eedacb51513f364da412ad2be7425d0c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85b13698eedacb51513f364da412ad2be7425d0c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2436d54d0a4482fe073a8f40686471e89305a44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2436d54d0a4482fe073a8f40686471e89305a44", "html_url": "https://github.com/rust-lang/rust/commit/c2436d54d0a4482fe073a8f40686471e89305a44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2436d54d0a4482fe073a8f40686471e89305a44/comments", "author": {"login": "obeis", "id": 54103142, "node_id": "MDQ6VXNlcjU0MTAzMTQy", "avatar_url": "https://avatars.githubusercontent.com/u/54103142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/obeis", "html_url": "https://github.com/obeis", "followers_url": "https://api.github.com/users/obeis/followers", "following_url": "https://api.github.com/users/obeis/following{/other_user}", "gists_url": "https://api.github.com/users/obeis/gists{/gist_id}", "starred_url": "https://api.github.com/users/obeis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/obeis/subscriptions", "organizations_url": "https://api.github.com/users/obeis/orgs", "repos_url": "https://api.github.com/users/obeis/repos", "events_url": "https://api.github.com/users/obeis/events{/privacy}", "received_events_url": "https://api.github.com/users/obeis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "obeis", "id": 54103142, "node_id": "MDQ6VXNlcjU0MTAzMTQy", "avatar_url": "https://avatars.githubusercontent.com/u/54103142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/obeis", "html_url": "https://github.com/obeis", "followers_url": "https://api.github.com/users/obeis/followers", "following_url": "https://api.github.com/users/obeis/following{/other_user}", "gists_url": "https://api.github.com/users/obeis/gists{/gist_id}", "starred_url": "https://api.github.com/users/obeis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/obeis/subscriptions", "organizations_url": "https://api.github.com/users/obeis/orgs", "repos_url": "https://api.github.com/users/obeis/repos", "events_url": "https://api.github.com/users/obeis/events{/privacy}", "received_events_url": "https://api.github.com/users/obeis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea46e7a47e67c5ca9c147380d288d0c76451b5c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea46e7a47e67c5ca9c147380d288d0c76451b5c2", "html_url": "https://github.com/rust-lang/rust/commit/ea46e7a47e67c5ca9c147380d288d0c76451b5c2"}], "stats": {"total": 25, "additions": 14, "deletions": 11}, "files": [{"sha": "58361146342d5a786a8b61966d7cab5f32931cca", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=c2436d54d0a4482fe073a8f40686471e89305a44", "patch": "@@ -28,7 +28,7 @@ use rustc_span::{BytePos, Span};\n use tracing::debug;\n \n use crate::imports::{Import, ImportKind, ImportResolver};\n-use crate::late::Rib;\n+use crate::late::{PatternSource, Rib};\n use crate::path_names_to_string;\n use crate::{AmbiguityError, AmbiguityErrorMisc, AmbiguityKind, BindingError, Finalize};\n use crate::{HasGenericParams, MacroRulesScope, Module, ModuleKind, ModuleOrUniformRoot};\n@@ -896,7 +896,7 @@ impl<'a> Resolver<'a> {\n                 err\n             }\n             ResolutionError::BindingShadowsSomethingUnacceptable {\n-                shadowing_binding_descr,\n+                shadowing_binding,\n                 name,\n                 participle,\n                 article,\n@@ -909,15 +909,18 @@ impl<'a> Resolver<'a> {\n                     span,\n                     E0530,\n                     \"{}s cannot shadow {}s\",\n-                    shadowing_binding_descr,\n+                    shadowing_binding.descr(),\n                     shadowed_binding_descr,\n                 );\n                 err.span_label(\n                     span,\n                     format!(\"cannot be named the same as {} {}\", article, shadowed_binding_descr),\n                 );\n-                match shadowed_binding {\n-                    Res::Def(DefKind::Ctor(CtorOf::Variant | CtorOf::Struct, CtorKind::Fn), _) => {\n+                match (shadowing_binding, shadowed_binding) {\n+                    (\n+                        PatternSource::Match,\n+                        Res::Def(DefKind::Ctor(CtorOf::Variant | CtorOf::Struct, CtorKind::Fn), _),\n+                    ) => {\n                         err.span_suggestion(\n                             span,\n                             \"try specify the pattern arguments\","}, {"sha": "f37acca3d9f276b17c5298822c478f6859e48b04", "filename": "compiler/rustc_resolve/src/late.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate.rs?ref=c2436d54d0a4482fe073a8f40686471e89305a44", "patch": "@@ -50,7 +50,7 @@ struct BindingInfo {\n }\n \n #[derive(Copy, Clone, PartialEq, Eq, Debug)]\n-enum PatternSource {\n+pub enum PatternSource {\n     Match,\n     Let,\n     For,\n@@ -64,7 +64,7 @@ enum IsRepeatExpr {\n }\n \n impl PatternSource {\n-    fn descr(self) -> &'static str {\n+    pub fn descr(self) -> &'static str {\n         match self {\n             PatternSource::Match => \"match binding\",\n             PatternSource::Let => \"let binding\",\n@@ -2845,7 +2845,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                 self.report_error(\n                     ident.span,\n                     ResolutionError::BindingShadowsSomethingUnacceptable {\n-                        shadowing_binding_descr: pat_src.descr(),\n+                        shadowing_binding: pat_src,\n                         name: ident.name,\n                         participle: if binding.is_import() { \"imported\" } else { \"defined\" },\n                         article: binding.res().article(),\n@@ -2861,7 +2861,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                 self.report_error(\n                     ident.span,\n                     ResolutionError::BindingShadowsSomethingUnacceptable {\n-                        shadowing_binding_descr: pat_src.descr(),\n+                        shadowing_binding: pat_src,\n                         name: ident.name,\n                         participle: \"defined\",\n                         article: res.article(),"}, {"sha": "8968179c92e4b69a0e9f970197a69ff155e54e46", "filename": "compiler/rustc_resolve/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2436d54d0a4482fe073a8f40686471e89305a44/compiler%2Frustc_resolve%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flib.rs?ref=c2436d54d0a4482fe073a8f40686471e89305a44", "patch": "@@ -61,7 +61,7 @@ use tracing::debug;\n \n use diagnostics::{ImportSuggestion, LabelSuggestion, Suggestion};\n use imports::{Import, ImportKind, ImportResolver, NameResolution};\n-use late::{HasGenericParams, PathSource};\n+use late::{HasGenericParams, PathSource, PatternSource};\n use macros::{MacroRulesBinding, MacroRulesScope, MacroRulesScopeRef};\n \n use crate::access_levels::AccessLevelsVisitor;\n@@ -230,7 +230,7 @@ enum ResolutionError<'a> {\n     ),\n     /// Error E0530: `X` bindings cannot shadow `Y`s.\n     BindingShadowsSomethingUnacceptable {\n-        shadowing_binding_descr: &'static str,\n+        shadowing_binding: PatternSource,\n         name: Symbol,\n         participle: &'static str,\n         article: &'static str,"}]}