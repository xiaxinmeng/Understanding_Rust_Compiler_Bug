{"sha": "fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiOTM5ZWQ5MWQxYTZmMWYxOWY0NDM5Yjk2YzQxNzQyZmZmOGZkMjU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2021-08-02T15:15:13Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2021-08-03T14:06:19Z"}, "message": "Make simplify_cfg test more consistent\n\nForce it to always use panic=abort which means that all targets should\nproduce the same MIR now.", "tree": {"sha": "c445c2a0a5147f5ad32260cf0979f51cf533f47f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c445c2a0a5147f5ad32260cf0979f51cf533f47f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "html_url": "https://github.com/rust-lang/rust/commit/fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0168dfec6d8ec4dcb037401ae0c9c9ec8efcc173", "url": "https://api.github.com/repos/rust-lang/rust/commits/0168dfec6d8ec4dcb037401ae0c9c9ec8efcc173", "html_url": "https://github.com/rust-lang/rust/commit/0168dfec6d8ec4dcb037401ae0c9c9ec8efcc173"}], "stats": {"total": 97, "additions": 50, "deletions": 47}, "files": [{"sha": "f72a12a5be0bca7852fa387310b4356a8253ea3b", "filename": "src/test/mir-opt/simplify_cfg.main.SimplifyCfg-early-opt.diff", "status": "modified", "additions": 21, "deletions": 20, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff", "raw_url": "https://github.com/rust-lang/rust/raw/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-early-opt.diff?ref=fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "patch": "@@ -2,46 +2,47 @@\n + // MIR for `main` after SimplifyCfg-early-opt\n   \n   fn main() -> () {\n-      let mut _0: ();                      // return place in scope 0 at $DIR/simplify_cfg.rs:5:11: 5:11\n-      let mut _1: ();                      // in scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n-      let mut _2: bool;                    // in scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n-      let mut _3: !;                       // in scope 0 at $DIR/simplify_cfg.rs:7:18: 9:10\n+      let mut _0: ();                      // return place in scope 0 at $DIR/simplify_cfg.rs:7:11: 7:11\n+      let mut _1: ();                      // in scope 0 at $DIR/simplify_cfg.rs:7:1: 13:2\n+      let mut _2: bool;                    // in scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n+      let mut _3: !;                       // in scope 0 at $DIR/simplify_cfg.rs:9:18: 11:10\n   \n       bb0: {\n--         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+-         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n -     }\n - \n -     bb1: {\n-          StorageLive(_2);                 // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n--         _2 = bar() -> bb2;               // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n-+         _2 = bar() -> bb1;               // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n+          StorageLive(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n+-         _2 = bar() -> [return: bb2, unwind: bb5]; // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n++         _2 = bar() -> [return: bb1, unwind: bb4]; // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n                                            // mir::Constant\n-                                           // + span: $DIR/simplify_cfg.rs:7:12: 7:15\n+                                           // + span: $DIR/simplify_cfg.rs:9:12: 9:15\n                                            // + literal: Const { ty: fn() -> bool {bar}, val: Value(Scalar(<ZST>)) }\n       }\n   \n -     bb2: {\n--         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+-         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n +     bb1: {\n-+         switchInt(move _2) -> [false: bb3, otherwise: bb2]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n++         switchInt(move _2) -> [false: bb3, otherwise: bb2]; // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n       }\n   \n -     bb3: {\n +     bb2: {\n-          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n-          return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n+          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:10:13: 10:18\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:11:9: 11:10\n+          return;                          // scope 0 at $DIR/simplify_cfg.rs:13:2: 13:2\n       }\n   \n -     bb4: {\n +     bb3: {\n-          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:9:10: 9:10\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n-          goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n--     }\n-- \n+          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:11:10: 11:10\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:11:9: 11:10\n+          goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n+      }\n+  \n -     bb5 (cleanup): {\n--         resume;                          // scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n++     bb4 (cleanup): {\n+          resume;                          // scope 0 at $DIR/simplify_cfg.rs:7:1: 13:2\n       }\n   }\n   "}, {"sha": "9857322053ff93572ad0d7bb1ecee4e4021cfd6e", "filename": "src/test/mir-opt/simplify_cfg.main.SimplifyCfg-initial.diff", "status": "modified", "additions": 27, "deletions": 27, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff", "raw_url": "https://github.com/rust-lang/rust/raw/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.main.SimplifyCfg-initial.diff?ref=fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "patch": "@@ -2,71 +2,71 @@\n + // MIR for `main` after SimplifyCfg-initial\n   \n   fn main() -> () {\n-      let mut _0: ();                      // return place in scope 0 at $DIR/simplify_cfg.rs:5:11: 5:11\n-      let mut _1: ();                      // in scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n-      let mut _2: bool;                    // in scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n-      let mut _3: !;                       // in scope 0 at $DIR/simplify_cfg.rs:7:18: 9:10\n+      let mut _0: ();                      // return place in scope 0 at $DIR/simplify_cfg.rs:7:11: 7:11\n+      let mut _1: ();                      // in scope 0 at $DIR/simplify_cfg.rs:7:1: 13:2\n+      let mut _2: bool;                    // in scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n+      let mut _3: !;                       // in scope 0 at $DIR/simplify_cfg.rs:9:18: 11:10\n   \n       bb0: {\n--         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n-+         falseUnwind -> [real: bb1, cleanup: bb5]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+-         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n++         falseUnwind -> [real: bb1, cleanup: bb5]; // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n       }\n   \n       bb1: {\n--         falseUnwind -> [real: bb2, cleanup: bb10]; // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+-         falseUnwind -> [real: bb2, cleanup: bb10]; // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n -     }\n - \n -     bb2: {\n-          StorageLive(_2);                 // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n--         _2 = bar() -> [return: bb3, unwind: bb10]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n-+         _2 = bar() -> [return: bb2, unwind: bb5]; // scope 0 at $DIR/simplify_cfg.rs:7:12: 7:17\n+          StorageLive(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n+-         _2 = bar() -> [return: bb3, unwind: bb10]; // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n++         _2 = bar() -> [return: bb2, unwind: bb5]; // scope 0 at $DIR/simplify_cfg.rs:9:12: 9:17\n                                            // mir::Constant\n-                                           // + span: $DIR/simplify_cfg.rs:7:12: 7:15\n+                                           // + span: $DIR/simplify_cfg.rs:9:12: 9:15\n                                            // + literal: Const { ty: fn() -> bool {bar}, val: Value(Scalar(<ZST>)) }\n       }\n   \n -     bb3: {\n--         switchInt(move _2) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+-         switchInt(move _2) -> [false: bb5, otherwise: bb4]; // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n +     bb2: {\n-+         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n++         switchInt(move _2) -> [false: bb4, otherwise: bb3]; // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n       }\n   \n -     bb4: {\n +     bb3: {\n-          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n--         goto -> bb9;                     // scope 0 at $DIR/simplify_cfg.rs:8:13: 8:18\n-+         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n-+         return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n+          _0 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:10:13: 10:18\n+-         goto -> bb9;                     // scope 0 at $DIR/simplify_cfg.rs:10:13: 10:18\n++         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:11:9: 11:10\n++         return;                          // scope 0 at $DIR/simplify_cfg.rs:13:2: 13:2\n       }\n   \n -     bb5: {\n +     bb4: {\n-          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:9:10: 9:10\n--         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+          _1 = const ();                   // scope 0 at $DIR/simplify_cfg.rs:11:10: 11:10\n+-         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n -     }\n - \n -     bb6: {\n--         unreachable;                     // scope 0 at $DIR/simplify_cfg.rs:7:18: 9:10\n+-         unreachable;                     // scope 0 at $DIR/simplify_cfg.rs:9:18: 11:10\n -     }\n - \n -     bb7: {\n--         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:7:9: 9:10\n+-         goto -> bb8;                     // scope 0 at $DIR/simplify_cfg.rs:9:9: 11:10\n -     }\n - \n -     bb8: {\n-          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n--         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n-+         goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:6:5: 10:6\n+          StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:11:9: 11:10\n+-         goto -> bb1;                     // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n++         goto -> bb0;                     // scope 0 at $DIR/simplify_cfg.rs:8:5: 12:6\n       }\n   \n -     bb9: {\n--         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:9:9: 9:10\n--         return;                          // scope 0 at $DIR/simplify_cfg.rs:11:2: 11:2\n+-         StorageDead(_2);                 // scope 0 at $DIR/simplify_cfg.rs:11:9: 11:10\n+-         return;                          // scope 0 at $DIR/simplify_cfg.rs:13:2: 13:2\n -     }\n - \n -     bb10 (cleanup): {\n +     bb5 (cleanup): {\n-          resume;                          // scope 0 at $DIR/simplify_cfg.rs:5:1: 11:2\n+          resume;                          // scope 0 at $DIR/simplify_cfg.rs:7:1: 13:2\n       }\n   }\n   "}, {"sha": "cf7eac4403a284530add300a15e06f49f1285f65", "filename": "src/test/mir-opt/simplify_cfg.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb939ed91d1a6f1f19f4439b96c41742fff8fd25/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify_cfg.rs?ref=fb939ed91d1a6f1f19f4439b96c41742fff8fd25", "patch": "@@ -1,4 +1,6 @@\n // Test that the goto chain starting from bb0 is collapsed.\n+// compile-flags: -Cpanic=abort\n+// no-prefer-dynamic\n \n // EMIT_MIR simplify_cfg.main.SimplifyCfg-initial.diff\n // EMIT_MIR simplify_cfg.main.SimplifyCfg-early-opt.diff"}]}