{"sha": "21f278a6877b3a66f665d86402c6ae057827a610", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxZjI3OGE2ODc3YjNhNjZmNjY1ZDg2NDAyYzZhZTA1NzgyN2E2MTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-04-23T23:44:40Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-04-23T23:44:40Z"}, "message": "Auto merge of #24633 - rapha:master, r=alexcrichton", "tree": {"sha": "29f87c823972eb17d595c0765f6f3d5714b87f63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29f87c823972eb17d595c0765f6f3d5714b87f63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21f278a6877b3a66f665d86402c6ae057827a610", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21f278a6877b3a66f665d86402c6ae057827a610", "html_url": "https://github.com/rust-lang/rust/commit/21f278a6877b3a66f665d86402c6ae057827a610", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21f278a6877b3a66f665d86402c6ae057827a610/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90bed3f9479f9f63746f227d5fc4ddecdd37642a", "url": "https://api.github.com/repos/rust-lang/rust/commits/90bed3f9479f9f63746f227d5fc4ddecdd37642a", "html_url": "https://github.com/rust-lang/rust/commit/90bed3f9479f9f63746f227d5fc4ddecdd37642a"}, {"sha": "47ebc48140f45f93057ad764e34f1f2223ece5aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/47ebc48140f45f93057ad764e34f1f2223ece5aa", "html_url": "https://github.com/rust-lang/rust/commit/47ebc48140f45f93057ad764e34f1f2223ece5aa"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "b3cc133d229465bf1a3a1b0bdfe988c800c1f02c", "filename": "src/libstd/sync/mpsc/mod.rs", "status": "modified", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/21f278a6877b3a66f665d86402c6ae057827a610/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21f278a6877b3a66f665d86402c6ae057827a610/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fmpsc%2Fmod.rs?ref=21f278a6877b3a66f665d86402c6ae057827a610", "patch": "@@ -306,6 +306,14 @@ pub struct Iter<'a, T: 'a> {\n     rx: &'a Receiver<T>\n }\n \n+/// An owning iterator over messages on a receiver, this iterator will block\n+/// whenever `next` is called, waiting for a new message, and `None` will be\n+/// returned when the corresponding channel has hung up.\n+#[stable(feature = \"receiver_into_iter\", since = \"1.1.0\")]\n+pub struct IntoIter<T> {\n+    rx: Receiver<T>\n+}\n+\n /// The sending-half of Rust's asynchronous channel type. This half can only be\n /// owned by one task, but it can be cloned to send to other tasks.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n@@ -899,6 +907,29 @@ impl<'a, T> Iterator for Iter<'a, T> {\n     fn next(&mut self) -> Option<T> { self.rx.recv().ok() }\n }\n \n+#[stable(feature = \"receiver_into_iter\", since = \"1.1.0\")]\n+impl<'a, T> IntoIterator for &'a Receiver<T> {\n+    type Item = T;\n+    type IntoIter = Iter<'a, T>;\n+\n+    fn into_iter(self) -> Iter<'a, T> { self.iter() }\n+}\n+\n+impl<T> Iterator for IntoIter<T> {\n+    type Item = T;\n+    fn next(&mut self) -> Option<T> { self.rx.recv().ok() }\n+}\n+\n+#[stable(feature = \"receiver_into_iter\", since = \"1.1.0\")]\n+impl <T> IntoIterator for Receiver<T> {\n+    type Item = T;\n+    type IntoIter = IntoIter<T>;\n+\n+    fn into_iter(self) -> IntoIter<T> {\n+        IntoIter { rx: self }\n+    }\n+}\n+\n #[unsafe_destructor]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<T> Drop for Receiver<T> {\n@@ -1507,6 +1538,32 @@ mod test {\n         assert_eq!(count_rx.recv().unwrap(), 4);\n     }\n \n+    #[test]\n+    fn test_recv_into_iter_owned() {\n+        let mut iter = {\n+          let (tx, rx) = channel::<i32>();\n+          tx.send(1).unwrap();\n+          tx.send(2).unwrap();\n+\n+          rx.into_iter()\n+        };\n+        assert_eq!(iter.next().unwrap(), 1);\n+        assert_eq!(iter.next().unwrap(), 2);\n+        assert_eq!(iter.next().is_none(), true);\n+    }\n+\n+    #[test]\n+    fn test_recv_into_iter_borrowed() {\n+        let (tx, rx) = channel::<i32>();\n+        tx.send(1).unwrap();\n+        tx.send(2).unwrap();\n+        drop(tx);\n+        let mut iter = (&rx).into_iter();\n+        assert_eq!(iter.next().unwrap(), 1);\n+        assert_eq!(iter.next().unwrap(), 2);\n+        assert_eq!(iter.next().is_none(), true);\n+    }\n+\n     #[test]\n     fn try_recv_states() {\n         let (tx1, rx1) = channel::<i32>();"}]}