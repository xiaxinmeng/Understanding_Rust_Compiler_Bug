{"sha": "758834d3e2b2589f73b62df386780c8096ed7ae1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1ODgzNGQzZTJiMjU4OWY3M2I2MmRmMzg2NzgwYzgwOTZlZDdhZTE=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-11-25T21:52:24Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-11-26T22:08:35Z"}, "message": "Only eat semicolons for statements that need them\n\nWhen parsing a statement (e.g. inside a function body),\nwe now consider `struct Foo {};` and `$stmt;` to each consist\nof two statements: `struct Foo {}` and `;`, and `$stmt` and `;`.\n\nAs a result, an attribute macro invoke as\n`fn foo() { #[attr] struct Bar{}; }` will see `struct Bar{}` as its\ninput. Additionally, the 'unused semicolon' lint now fires in more\nplaces.", "tree": {"sha": "6842676a02f7c1a941aa9c6df3be0ea697b42be3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6842676a02f7c1a941aa9c6df3be0ea697b42be3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/758834d3e2b2589f73b62df386780c8096ed7ae1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl/AJ2MACgkQtAh+UQ6Y\nsWTMPA//alJ43gnWoW0ISo8qE9Ii3vPN0gZ4YpdjPiuKnAqKJVpKZG2Ttj7GqM7R\nGWShqA8S35UcVvJ19etbqHJxjzgrNQgTJ6cJrmai9pd6xpXbW6E22+0Zm4T7KezI\nBBaab8RUmCakaNIu7aVEdHQXfEHKaHMNTee++WTpoTj1P6pq9UOVh/vJQoICZA2b\n/FNJwvQNFoC6PyjTCn5RmoWK4NbCtw9XI+JNvQvaIrubDxLboj0ievw3E/2TrT76\nQjWwTAYcWlcGkHpG82ZgpW/j9Jr7yVKlk9QpsAl/lcHoEisTXg7I7PlVbcEWYKP2\ncIdapZ8FBDQdBHggzlZYlk2U9ZsiMIQDMAiQTsVc9ojBhRXpcARY9K3urk3J5TT6\nRrZBADGTIcxnkrfQ2oJOER8RyI1v6+I49GjGMEezzrUFaJiEbt4HY1SebgjanfO/\nVcxGtAFLFE+qsvr+Fq53JdiM43S3sdHS+wPznUwO9ipZO8pSKlc6QWfffRRHj0Bj\nK/bZ7Otn4tgnFWCrUMik3IlSE27xBAWROuJn33et6gibj1XFwCzCmIXb4Pwwr2i+\n85q95vGrtvuWYBy5X6nCpuhgFUNRAn5BTSr9JKSEhw2x6Bb+5Wq8H1A7jgFukV2r\nMFdVeDUxZ+r6gnVpxne0Uilb5NPeWHiiNwyXvRe+bw/C3tvqQB4=\n=45Ra\n-----END PGP SIGNATURE-----", "payload": "tree 6842676a02f7c1a941aa9c6df3be0ea697b42be3\nparent de88bf148b122b27ce48a4a6679c41c834d33019\nauthor Aaron Hill <aa1ronham@gmail.com> 1606341144 -0500\ncommitter Aaron Hill <aa1ronham@gmail.com> 1606428515 -0500\n\nOnly eat semicolons for statements that need them\n\nWhen parsing a statement (e.g. inside a function body),\nwe now consider `struct Foo {};` and `$stmt;` to each consist\nof two statements: `struct Foo {}` and `;`, and `$stmt` and `;`.\n\nAs a result, an attribute macro invoke as\n`fn foo() { #[attr] struct Bar{}; }` will see `struct Bar{}` as its\ninput. Additionally, the 'unused semicolon' lint now fires in more\nplaces.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/758834d3e2b2589f73b62df386780c8096ed7ae1", "html_url": "https://github.com/rust-lang/rust/commit/758834d3e2b2589f73b62df386780c8096ed7ae1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/758834d3e2b2589f73b62df386780c8096ed7ae1/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "de88bf148b122b27ce48a4a6679c41c834d33019", "url": "https://api.github.com/repos/rust-lang/rust/commits/de88bf148b122b27ce48a4a6679c41c834d33019", "html_url": "https://github.com/rust-lang/rust/commit/de88bf148b122b27ce48a4a6679c41c834d33019"}], "stats": {"total": 10, "additions": 2, "deletions": 8}, "files": [{"sha": "e974556f43a49eb7f30306f177665efa5eaf8302", "filename": "compiler/rustc_parse/src/parser/stmt.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/758834d3e2b2589f73b62df386780c8096ed7ae1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/758834d3e2b2589f73b62df386780c8096ed7ae1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs?ref=758834d3e2b2589f73b62df386780c8096ed7ae1", "patch": "@@ -473,8 +473,7 @@ impl<'a> Parser<'a> {\n                 // so capture it\n                 add_semi_token(local.tokens.as_mut());\n             }\n-            StmtKind::Empty => eat_semi = false,\n-            _ => {}\n+            StmtKind::Empty | StmtKind::Item(_) | StmtKind::Semi(_) => eat_semi = false,\n         }\n \n         if eat_semi && self.eat(&token::Semi) {"}, {"sha": "0b9ce8cdfdb3b24e1aebe39ef739d40b25c521fd", "filename": "src/test/ui/proc-macro/allowed-attr-stmt-expr.stdout", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/758834d3e2b2589f73b62df386780c8096ed7ae1/src%2Ftest%2Fui%2Fproc-macro%2Fallowed-attr-stmt-expr.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/758834d3e2b2589f73b62df386780c8096ed7ae1/src%2Ftest%2Fui%2Fproc-macro%2Fallowed-attr-stmt-expr.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fallowed-attr-stmt-expr.stdout?ref=758834d3e2b2589f73b62df386780c8096ed7ae1", "patch": "@@ -261,7 +261,7 @@ PRINT-ATTR INPUT (DEBUG): TokenStream [\n         span: $DIR/allowed-attr-stmt-expr.rs:53:54: 53:56 (#0),\n     },\n ]\n-PRINT-ATTR INPUT (DISPLAY): #[rustc_dummy] struct Other { } ;\n+PRINT-ATTR INPUT (DISPLAY): #[rustc_dummy] struct Other { }\n PRINT-ATTR INPUT (DEBUG): TokenStream [\n     Punct {\n         ch: '#',\n@@ -291,9 +291,4 @@ PRINT-ATTR INPUT (DEBUG): TokenStream [\n         stream: TokenStream [],\n         span: $DIR/allowed-attr-stmt-expr.rs:57:18: 57:20 (#0),\n     },\n-    Punct {\n-        ch: ';',\n-        spacing: Alone,\n-        span: $DIR/allowed-attr-stmt-expr.rs:57:20: 57:21 (#0),\n-    },\n ]"}]}