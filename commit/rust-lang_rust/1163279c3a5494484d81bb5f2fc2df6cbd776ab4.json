{"sha": "1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "node_id": "C_kwDOAAsO6NoAKDExNjMyNzljM2E1NDk0NDg0ZDgxYmI1ZjJmYzJkZjZjYmQ3NzZhYjQ", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-01-27T15:23:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-27T15:23:11Z"}, "message": "Rollup merge of #106806 - m-ou-se:format-args-flags, r=oli-obk\n\nReplace format flags u32 by enums and bools.\n\nThis gets rid of the `flags: u32` field where each bit has a special meaning, and replaces it by simple enums and booleans.\n\nPart of #99012", "tree": {"sha": "0cf36dd790b45ea077bdd28363f3eb11f25e434a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cf36dd790b45ea077bdd28363f3eb11f25e434a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj0+xfCRBK7hj4Ov3rIwAAL3wIALFE9gdTrwtGawRQ4h+yoj9H\nA+aGHOLNu1O2h0lcXDS0mflN7esjQYwcljrre5SYUc742Hgt5EEaTFLK3RtAfaG5\nwkc7WawBhxZhHCJ71U9QGAlCcPJwt2gWeYt8F0arBoLwsvvcgaT6EQMuMasqUpbq\nmtaGfqBnzgrnT1fTTFNvY9aVKK1Og60pPzSaMcsWssZgrQ9zpR698zitns5gozEX\nXzZAo38lWRYy11W3b7ItMsOoh8y2dg57c0xWws7NbE/mjihiRPLEIM4saKANDlwm\nirb5SBipl8JeQbOVNCRi3u8yvg7VoTXj2CdRjnB2p9gXIQJEQacXZMM5djrVEvE=\n=60kV\n-----END PGP SIGNATURE-----\n", "payload": "tree 0cf36dd790b45ea077bdd28363f3eb11f25e434a\nparent 6874f4e3fc2a16be7c78e702d068bbc1daa90e16\nparent 21cf9dbc8540656cb137ef31f9db8fd9f1398fd9\nauthor Yuki Okushi <jtitor@2k36.org> 1674832991 +0900\ncommitter GitHub <noreply@github.com> 1674832991 +0900\n\nRollup merge of #106806 - m-ou-se:format-args-flags, r=oli-obk\n\nReplace format flags u32 by enums and bools.\n\nThis gets rid of the `flags: u32` field where each bit has a special meaning, and replaces it by simple enums and booleans.\n\nPart of #99012\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "html_url": "https://github.com/rust-lang/rust/commit/1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6874f4e3fc2a16be7c78e702d068bbc1daa90e16", "url": "https://api.github.com/repos/rust-lang/rust/commits/6874f4e3fc2a16be7c78e702d068bbc1daa90e16", "html_url": "https://github.com/rust-lang/rust/commit/6874f4e3fc2a16be7c78e702d068bbc1daa90e16"}, {"sha": "21cf9dbc8540656cb137ef31f9db8fd9f1398fd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/21cf9dbc8540656cb137ef31f9db8fd9f1398fd9", "html_url": "https://github.com/rust-lang/rust/commit/21cf9dbc8540656cb137ef31f9db8fd9f1398fd9"}], "stats": {"total": 244, "additions": 173, "deletions": 71}, "files": [{"sha": "d021bea5ecacb94c7b616a8ffeca10a0c1369c87", "filename": "compiler/rustc_ast/src/format.rs", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast%2Fsrc%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast%2Fsrc%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fformat.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -227,8 +227,30 @@ pub struct FormatOptions {\n     pub alignment: Option<FormatAlignment>,\n     /// The fill character. E.g. the `.` in `{:.>10}`.\n     pub fill: Option<char>,\n-    /// The `+`, `-`, `0`, `#`, `x?` and `X?` flags.\n-    pub flags: u32,\n+    /// The `+` or `-` flag.\n+    pub sign: Option<FormatSign>,\n+    /// The `#` flag.\n+    pub alternate: bool,\n+    /// The `0` flag. E.g. the `0` in `{:02x}`.\n+    pub zero_pad: bool,\n+    /// The `x` or `X` flag (for `Debug` only). E.g. the `x` in `{:x?}`.\n+    pub debug_hex: Option<FormatDebugHex>,\n+}\n+\n+#[derive(Copy, Clone, Encodable, Decodable, Debug, PartialEq, Eq)]\n+pub enum FormatSign {\n+    /// The `+` flag.\n+    Plus,\n+    /// The `-` flag.\n+    Minus,\n+}\n+\n+#[derive(Copy, Clone, Encodable, Decodable, Debug, PartialEq, Eq)]\n+pub enum FormatDebugHex {\n+    /// The `x` flag in `{:x?}`.\n+    Lower,\n+    /// The `X` flag in `{:X?}`.\n+    Upper,\n }\n \n #[derive(Copy, Clone, Encodable, Decodable, Debug, PartialEq, Eq)]"}, {"sha": "e7dd0b18a03b9adc0743c423611b2f758414e3e9", "filename": "compiler/rustc_ast_lowering/src/format.rs", "status": "modified", "additions": 23, "deletions": 6, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast_lowering%2Fsrc%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast_lowering%2Fsrc%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fformat.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -137,26 +137,43 @@ fn make_format_spec<'hir>(\n         }\n         Err(_) => ctx.expr(sp, hir::ExprKind::Err),\n     };\n-    let fill = ctx.expr_char(sp, placeholder.format_options.fill.unwrap_or(' '));\n+    let &FormatOptions {\n+        ref width,\n+        ref precision,\n+        alignment,\n+        fill,\n+        sign,\n+        alternate,\n+        zero_pad,\n+        debug_hex,\n+    } = &placeholder.format_options;\n+    let fill = ctx.expr_char(sp, fill.unwrap_or(' '));\n     let align = ctx.expr_lang_item_type_relative(\n         sp,\n         hir::LangItem::FormatAlignment,\n-        match placeholder.format_options.alignment {\n+        match alignment {\n             Some(FormatAlignment::Left) => sym::Left,\n             Some(FormatAlignment::Right) => sym::Right,\n             Some(FormatAlignment::Center) => sym::Center,\n             None => sym::Unknown,\n         },\n     );\n-    let flags = ctx.expr_u32(sp, placeholder.format_options.flags);\n-    let prec = make_count(ctx, sp, &placeholder.format_options.precision, argmap);\n-    let width = make_count(ctx, sp, &placeholder.format_options.width, argmap);\n+    // This needs to match `FlagV1` in library/core/src/fmt/mod.rs.\n+    let flags: u32 = ((sign == Some(FormatSign::Plus)) as u32)\n+        | ((sign == Some(FormatSign::Minus)) as u32) << 1\n+        | (alternate as u32) << 2\n+        | (zero_pad as u32) << 3\n+        | ((debug_hex == Some(FormatDebugHex::Lower)) as u32) << 4\n+        | ((debug_hex == Some(FormatDebugHex::Upper)) as u32) << 5;\n+    let flags = ctx.expr_u32(sp, flags);\n+    let precision = make_count(ctx, sp, &precision, argmap);\n+    let width = make_count(ctx, sp, &width, argmap);\n     let format_placeholder_new = ctx.arena.alloc(ctx.expr_lang_item_type_relative(\n         sp,\n         hir::LangItem::FormatPlaceholder,\n         sym::new,\n     ));\n-    let args = ctx.arena.alloc_from_iter([position, fill, align, flags, prec, width]);\n+    let args = ctx.arena.alloc_from_iter([position, fill, align, flags, precision, width]);\n     ctx.expr_call_mut(sp, format_placeholder_new, args)\n }\n "}, {"sha": "cacfe9eb2f10745f8add02cecd528b90ab3a5b0c", "filename": "compiler/rustc_ast_pretty/src/pprust/state/expr.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -6,7 +6,10 @@ use rustc_ast::token;\n use rustc_ast::util::literal::escape_byte_str_symbol;\n use rustc_ast::util::parser::{self, AssocOp, Fixity};\n use rustc_ast::{self as ast, BlockCheckMode};\n-use rustc_ast::{FormatAlignment, FormatArgPosition, FormatArgsPiece, FormatCount, FormatTrait};\n+use rustc_ast::{\n+    FormatAlignment, FormatArgPosition, FormatArgsPiece, FormatCount, FormatDebugHex, FormatSign,\n+    FormatTrait,\n+};\n use std::fmt::Write;\n \n impl<'a> State<'a> {\n@@ -675,17 +678,15 @@ pub fn reconstruct_format_args_template_string(pieces: &[FormatArgsPiece]) -> St\n                     Some(FormatAlignment::Center) => template.push_str(\"^\"),\n                     None => {}\n                 }\n-                let flags = p.format_options.flags;\n-                if flags >> (rustc_parse_format::FlagSignPlus as usize) & 1 != 0 {\n-                    template.push('+');\n-                }\n-                if flags >> (rustc_parse_format::FlagSignMinus as usize) & 1 != 0 {\n-                    template.push('-');\n+                match p.format_options.sign {\n+                    Some(FormatSign::Plus) => template.push('+'),\n+                    Some(FormatSign::Minus) => template.push('-'),\n+                    None => {}\n                 }\n-                if flags >> (rustc_parse_format::FlagAlternate as usize) & 1 != 0 {\n+                if p.format_options.alternate {\n                     template.push('#');\n                 }\n-                if flags >> (rustc_parse_format::FlagSignAwareZeroPad as usize) & 1 != 0 {\n+                if p.format_options.zero_pad {\n                     template.push('0');\n                 }\n                 if let Some(width) = &p.format_options.width {\n@@ -709,11 +710,10 @@ pub fn reconstruct_format_args_template_string(pieces: &[FormatArgsPiece]) -> St\n                         }\n                     }\n                 }\n-                if flags >> (rustc_parse_format::FlagDebugLowerHex as usize) & 1 != 0 {\n-                    template.push('x');\n-                }\n-                if flags >> (rustc_parse_format::FlagDebugUpperHex as usize) & 1 != 0 {\n-                    template.push('X');\n+                match p.format_options.debug_hex {\n+                    Some(FormatDebugHex::Lower) => template.push('x'),\n+                    Some(FormatDebugHex::Upper) => template.push('X'),\n+                    None => {}\n                 }\n                 template.push_str(match p.format_trait {\n                     FormatTrait::Display => \"\","}, {"sha": "e93a23394c03ff9b9f74ea87e72c6d1ef27ee539", "filename": "compiler/rustc_builtin_macros/src/format.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_builtin_macros%2Fsrc%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_builtin_macros%2Fsrc%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fformat.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -4,7 +4,7 @@ use rustc_ast::tokenstream::TokenStream;\n use rustc_ast::{\n     Expr, ExprKind, FormatAlignment, FormatArgPosition, FormatArgPositionKind, FormatArgs,\n     FormatArgsPiece, FormatArgument, FormatArgumentKind, FormatArguments, FormatCount,\n-    FormatOptions, FormatPlaceholder, FormatTrait,\n+    FormatDebugHex, FormatOptions, FormatPlaceholder, FormatSign, FormatTrait,\n };\n use rustc_data_structures::fx::FxHashSet;\n use rustc_errors::{pluralize, Applicability, MultiSpan, PResult};\n@@ -435,7 +435,16 @@ pub fn make_format_args(\n                     format_options: FormatOptions {\n                         fill: format.fill,\n                         alignment,\n-                        flags: format.flags,\n+                        sign: format.sign.map(|s| match s {\n+                            parse::Sign::Plus => FormatSign::Plus,\n+                            parse::Sign::Minus => FormatSign::Minus,\n+                        }),\n+                        alternate: format.alternate,\n+                        zero_pad: format.zero_pad,\n+                        debug_hex: format.debug_hex.map(|s| match s {\n+                            parse::DebugHex::Lower => FormatDebugHex::Lower,\n+                            parse::DebugHex::Upper => FormatDebugHex::Upper,\n+                        }),\n                         precision,\n                         width,\n                     },"}, {"sha": "a6dfcd29762474933a31022e2f09f409d3e35865", "filename": "compiler/rustc_parse_format/src/lib.rs", "status": "modified", "additions": 37, "deletions": 28, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse_format%2Fsrc%2Flib.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -16,7 +16,6 @@\n \n pub use Alignment::*;\n pub use Count::*;\n-pub use Flag::*;\n pub use Piece::*;\n pub use Position::*;\n \n@@ -111,8 +110,14 @@ pub struct FormatSpec<'a> {\n     pub fill: Option<char>,\n     /// Optionally specified alignment.\n     pub align: Alignment,\n-    /// Packed version of various flags provided.\n-    pub flags: u32,\n+    /// The `+` or `-` flag.\n+    pub sign: Option<Sign>,\n+    /// The `#` flag.\n+    pub alternate: bool,\n+    /// The `0` flag.\n+    pub zero_pad: bool,\n+    /// The `x` or `X` flag. (Only for `Debug`.)\n+    pub debug_hex: Option<DebugHex>,\n     /// The integer precision to use.\n     pub precision: Count<'a>,\n     /// The span of the precision formatting flag (for diagnostics).\n@@ -162,24 +167,22 @@ pub enum Alignment {\n     AlignUnknown,\n }\n \n-/// Various flags which can be applied to format strings. The meaning of these\n-/// flags is defined by the formatters themselves.\n+/// Enum for the sign flags.\n #[derive(Copy, Clone, Debug, PartialEq)]\n-pub enum Flag {\n-    /// A `+` will be used to denote positive numbers.\n-    FlagSignPlus,\n-    /// A `-` will be used to denote negative numbers. This is the default.\n-    FlagSignMinus,\n-    /// An alternate form will be used for the value. In the case of numbers,\n-    /// this means that the number will be prefixed with the supplied string.\n-    FlagAlternate,\n-    /// For numbers, this means that the number will be padded with zeroes,\n-    /// and the sign (`+` or `-`) will precede them.\n-    FlagSignAwareZeroPad,\n-    /// For Debug / `?`, format integers in lower-case hexadecimal.\n-    FlagDebugLowerHex,\n-    /// For Debug / `?`, format integers in upper-case hexadecimal.\n-    FlagDebugUpperHex,\n+pub enum Sign {\n+    /// The `+` flag.\n+    Plus,\n+    /// The `-` flag.\n+    Minus,\n+}\n+\n+/// Enum for the debug hex flags.\n+#[derive(Copy, Clone, Debug, PartialEq)]\n+pub enum DebugHex {\n+    /// The `x` flag in `{:x?}`.\n+    Lower,\n+    /// The `X` flag in `{:X?}`.\n+    Upper,\n }\n \n /// A count is used for the precision and width parameters of an integer, and\n@@ -597,7 +600,10 @@ impl<'a> Parser<'a> {\n         let mut spec = FormatSpec {\n             fill: None,\n             align: AlignUnknown,\n-            flags: 0,\n+            sign: None,\n+            alternate: false,\n+            zero_pad: false,\n+            debug_hex: None,\n             precision: CountImplied,\n             precision_span: None,\n             width: CountImplied,\n@@ -626,13 +632,13 @@ impl<'a> Parser<'a> {\n         }\n         // Sign flags\n         if self.consume('+') {\n-            spec.flags |= 1 << (FlagSignPlus as u32);\n+            spec.sign = Some(Sign::Plus);\n         } else if self.consume('-') {\n-            spec.flags |= 1 << (FlagSignMinus as u32);\n+            spec.sign = Some(Sign::Minus);\n         }\n         // Alternate marker\n         if self.consume('#') {\n-            spec.flags |= 1 << (FlagAlternate as u32);\n+            spec.alternate = true;\n         }\n         // Width and precision\n         let mut havewidth = false;\n@@ -647,7 +653,7 @@ impl<'a> Parser<'a> {\n                 spec.width_span = Some(self.span(end - 1, end + 1));\n                 havewidth = true;\n             } else {\n-                spec.flags |= 1 << (FlagSignAwareZeroPad as u32);\n+                spec.zero_pad = true;\n             }\n         }\n \n@@ -678,14 +684,14 @@ impl<'a> Parser<'a> {\n         // Optional radix followed by the actual format specifier\n         if self.consume('x') {\n             if self.consume('?') {\n-                spec.flags |= 1 << (FlagDebugLowerHex as u32);\n+                spec.debug_hex = Some(DebugHex::Lower);\n                 spec.ty = \"?\";\n             } else {\n                 spec.ty = \"x\";\n             }\n         } else if self.consume('X') {\n             if self.consume('?') {\n-                spec.flags |= 1 << (FlagDebugUpperHex as u32);\n+                spec.debug_hex = Some(DebugHex::Upper);\n                 spec.ty = \"?\";\n             } else {\n                 spec.ty = \"X\";\n@@ -708,7 +714,10 @@ impl<'a> Parser<'a> {\n         let mut spec = FormatSpec {\n             fill: None,\n             align: AlignUnknown,\n-            flags: 0,\n+            sign: None,\n+            alternate: false,\n+            zero_pad: false,\n+            debug_hex: None,\n             precision: CountImplied,\n             precision_span: None,\n             width: CountImplied,"}, {"sha": "45314e2fb5500ec4ebd395719e00d7ba68044a98", "filename": "compiler/rustc_parse_format/src/tests.rs", "status": "modified", "additions": 60, "deletions": 15, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_parse_format%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/compiler%2Frustc_parse_format%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse_format%2Fsrc%2Ftests.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -10,7 +10,10 @@ fn fmtdflt() -> FormatSpec<'static> {\n     return FormatSpec {\n         fill: None,\n         align: AlignUnknown,\n-        flags: 0,\n+        sign: None,\n+        alternate: false,\n+        zero_pad: false,\n+        debug_hex: None,\n         precision: CountImplied,\n         width: CountImplied,\n         precision_span: None,\n@@ -126,7 +129,10 @@ fn format_type() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -147,7 +153,10 @@ fn format_align_fill() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignRight,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -165,7 +174,10 @@ fn format_align_fill() {\n             format: FormatSpec {\n                 fill: Some('0'),\n                 align: AlignLeft,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -183,7 +195,10 @@ fn format_align_fill() {\n             format: FormatSpec {\n                 fill: Some('*'),\n                 align: AlignLeft,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -204,7 +219,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 precision_span: None,\n                 width: CountIs(10),\n@@ -222,7 +240,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIs(10),\n                 precision_span: Some(InnerSpan { start: 6, end: 9 }),\n                 width: CountIsParam(10),\n@@ -240,7 +261,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIs(10),\n                 precision_span: Some(InnerSpan { start: 6, end: 9 }),\n                 width: CountIsParam(0),\n@@ -258,7 +282,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIsStar(0),\n                 precision_span: Some(InnerSpan { start: 3, end: 5 }),\n                 width: CountImplied,\n@@ -276,7 +303,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIsParam(10),\n                 width: CountImplied,\n                 precision_span: Some(InnerSpan::new(3, 7)),\n@@ -294,7 +324,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIsName(\"b\", InnerSpan { start: 6, end: 7 }),\n                 precision_span: Some(InnerSpan { start: 5, end: 8 }),\n                 width: CountIsName(\"a\", InnerSpan { start: 3, end: 4 }),\n@@ -312,7 +345,10 @@ fn format_counts() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: 0,\n+                sign: None,\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountIs(4),\n                 precision_span: Some(InnerSpan { start: 3, end: 5 }),\n                 width: CountImplied,\n@@ -333,7 +369,10 @@ fn format_flags() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: (1 << FlagSignMinus as u32),\n+                sign: Some(Sign::Minus),\n+                alternate: false,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -351,7 +390,10 @@ fn format_flags() {\n             format: FormatSpec {\n                 fill: None,\n                 align: AlignUnknown,\n-                flags: (1 << FlagSignPlus as u32) | (1 << FlagAlternate as u32),\n+                sign: Some(Sign::Plus),\n+                alternate: true,\n+                zero_pad: false,\n+                debug_hex: None,\n                 precision: CountImplied,\n                 width: CountImplied,\n                 precision_span: None,\n@@ -374,7 +416,10 @@ fn format_mixture() {\n                 format: FormatSpec {\n                     fill: None,\n                     align: AlignUnknown,\n-                    flags: 0,\n+                    sign: None,\n+                    alternate: false,\n+                    zero_pad: false,\n+                    debug_hex: None,\n                     precision: CountImplied,\n                     width: CountImplied,\n                     precision_span: None,"}, {"sha": "659063b97e74a3559907622019f3ad85c4e38a5c", "filename": "src/tools/clippy/clippy_utils/src/macros.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1163279c3a5494484d81bb5f2fc2df6cbd776ab4/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fmacros.rs?ref=1163279c3a5494484d81bb5f2fc2df6cbd776ab4", "patch": "@@ -711,8 +711,8 @@ pub struct FormatSpec<'tcx> {\n     pub fill: Option<char>,\n     /// Optionally specified alignment.\n     pub align: Alignment,\n-    /// Packed version of various flags provided, see [`rustc_parse_format::Flag`].\n-    pub flags: u32,\n+    /// Whether all flag options are set to default (no flags specified).\n+    pub no_flags: bool,\n     /// Represents either the maximum width or the integer precision.\n     pub precision: Count<'tcx>,\n     /// The minimum width, will be padded according to `width`/`align`\n@@ -728,7 +728,7 @@ impl<'tcx> FormatSpec<'tcx> {\n         Some(Self {\n             fill: spec.fill,\n             align: spec.align,\n-            flags: spec.flags,\n+            no_flags: spec.sign.is_none() && !spec.alternate && !spec.zero_pad && spec.debug_hex.is_none(),\n             precision: Count::new(\n                 FormatParamUsage::Precision,\n                 spec.precision,\n@@ -773,7 +773,7 @@ impl<'tcx> FormatSpec<'tcx> {\n         self.width.is_implied()\n             && self.precision.is_implied()\n             && self.align == Alignment::AlignUnknown\n-            && self.flags == 0\n+            && self.no_flags\n     }\n }\n "}]}