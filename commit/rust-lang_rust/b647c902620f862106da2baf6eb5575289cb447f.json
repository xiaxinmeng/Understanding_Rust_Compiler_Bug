{"sha": "b647c902620f862106da2baf6eb5575289cb447f", "node_id": "C_kwDOAAsO6NoAKGI2NDdjOTAyNjIwZjg2MjEwNmRhMmJhZjZlYjU1NzUyODljYjQ0N2Y", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-11-29T09:20:11Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-11-30T21:53:20Z"}, "message": "Improve code by replacing &str with Symbol in render_stability_since_raw", "tree": {"sha": "a800ff9f8c1eb9603011a2eec268a9536697c557", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a800ff9f8c1eb9603011a2eec268a9536697c557"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b647c902620f862106da2baf6eb5575289cb447f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b647c902620f862106da2baf6eb5575289cb447f", "html_url": "https://github.com/rust-lang/rust/commit/b647c902620f862106da2baf6eb5575289cb447f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b647c902620f862106da2baf6eb5575289cb447f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c1b0f77576fe9b539a53322298dc26b75e255e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c1b0f77576fe9b539a53322298dc26b75e255e8", "html_url": "https://github.com/rust-lang/rust/commit/0c1b0f77576fe9b539a53322298dc26b75e255e8"}], "stats": {"total": 34, "additions": 15, "deletions": 19}, "files": [{"sha": "aac7dbaca2b816cbf71e195c6dd96d86cc43acd7", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=b647c902620f862106da2baf6eb5575289cb447f", "patch": "@@ -602,16 +602,16 @@ impl Item {\n         })\n     }\n \n-    crate fn stable_since(&self, tcx: TyCtxt<'_>) -> Option<SymbolStr> {\n+    crate fn stable_since(&self, tcx: TyCtxt<'_>) -> Option<Symbol> {\n         match self.stability(tcx)?.level {\n-            StabilityLevel::Stable { since, .. } => Some(since.as_str()),\n+            StabilityLevel::Stable { since, .. } => Some(since),\n             StabilityLevel::Unstable { .. } => None,\n         }\n     }\n \n-    crate fn const_stable_since(&self, tcx: TyCtxt<'_>) -> Option<SymbolStr> {\n+    crate fn const_stable_since(&self, tcx: TyCtxt<'_>) -> Option<Symbol> {\n         match self.const_stability(tcx)?.level {\n-            StabilityLevel::Stable { since, .. } => Some(since.as_str()),\n+            StabilityLevel::Stable { since, .. } => Some(since),\n             StabilityLevel::Unstable { .. } => None,\n         }\n     }"}, {"sha": "eaeda4d178bb1583736ead122626b6ad7e113f13", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=b647c902620f862106da2baf6eb5575289cb447f", "patch": "@@ -804,17 +804,17 @@ fn assoc_type(\n \n fn render_stability_since_raw(\n     w: &mut Buffer,\n-    ver: Option<&str>,\n+    ver: Option<Symbol>,\n     const_stability: Option<&ConstStability>,\n-    containing_ver: Option<&str>,\n-    containing_const_ver: Option<&str>,\n+    containing_ver: Option<Symbol>,\n+    containing_const_ver: Option<Symbol>,\n ) {\n     let ver = ver.filter(|inner| !inner.is_empty());\n \n     match (ver, const_stability) {\n         // stable and const stable\n         (Some(v), Some(ConstStability { level: StabilityLevel::Stable { since }, .. }))\n-            if Some(since.as_str()).as_deref() != containing_const_ver =>\n+            if Some(*since) != containing_const_ver =>\n         {\n             write!(\n                 w,\n@@ -1651,23 +1651,19 @@ fn render_rightside(\n ) {\n     let tcx = cx.tcx();\n \n-    let const_stable_since;\n     // FIXME: Once https://github.com/rust-lang/rust/issues/67792 is implemented, we can remove\n     // this condition.\n     let (const_stability, const_stable_since) = match render_mode {\n-        RenderMode::Normal => {\n-            const_stable_since = containing_item.const_stable_since(tcx);\n-            (item.const_stability(tcx), const_stable_since.as_deref())\n-        }\n+        RenderMode::Normal => (item.const_stability(tcx), containing_item.const_stable_since(tcx)),\n         RenderMode::ForDeref { .. } => (None, None),\n     };\n \n     write!(w, \"<div class=\\\"rightside\\\">\");\n     render_stability_since_raw(\n         w,\n-        item.stable_since(tcx).as_deref(),\n+        item.stable_since(tcx),\n         const_stability,\n-        containing_item.stable_since(tcx).as_deref(),\n+        containing_item.stable_since(tcx),\n         const_stable_since,\n     );\n "}, {"sha": "da66cd20d62b231e59e24b683ed23e30308cbfad", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b647c902620f862106da2baf6eb5575289cb447f/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=b647c902620f862106da2baf6eb5575289cb447f", "patch": "@@ -101,7 +101,7 @@ pub(super) fn print_item(\n     let mut stability_since_raw = Buffer::new();\n     render_stability_since_raw(\n         &mut stability_since_raw,\n-        item.stable_since(cx.tcx()).as_deref(),\n+        item.stable_since(cx.tcx()),\n         item.const_stability(cx.tcx()),\n         None,\n         None,\n@@ -1462,10 +1462,10 @@ fn render_stability_since(\n ) {\n     render_stability_since_raw(\n         w,\n-        item.stable_since(tcx).as_deref(),\n+        item.stable_since(tcx),\n         item.const_stability(tcx),\n-        containing_item.stable_since(tcx).as_deref(),\n-        containing_item.const_stable_since(tcx).as_deref(),\n+        containing_item.stable_since(tcx),\n+        containing_item.const_stable_since(tcx),\n     )\n }\n "}]}