{"sha": "f5b97e52c97fe6cc12aba3587c12e37b403deea4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1Yjk3ZTUyYzk3ZmU2Y2MxMmFiYTM1ODdjMTJlMzdiNDAzZGVlYTQ=", "commit": {"author": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-01-19T15:43:06Z"}, "committer": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-01-22T11:06:45Z"}, "message": "Fix broken link in intra-doc", "tree": {"sha": "2d188dcac4e5164483f1c66cf1bc214b8035dc93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d188dcac4e5164483f1c66cf1bc214b8035dc93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5b97e52c97fe6cc12aba3587c12e37b403deea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5b97e52c97fe6cc12aba3587c12e37b403deea4", "html_url": "https://github.com/rust-lang/rust/commit/f5b97e52c97fe6cc12aba3587c12e37b403deea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5b97e52c97fe6cc12aba3587c12e37b403deea4/comments", "author": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2472851ccf22762065670e1cf00a9c39db869aac", "url": "https://api.github.com/repos/rust-lang/rust/commits/2472851ccf22762065670e1cf00a9c39db869aac", "html_url": "https://github.com/rust-lang/rust/commit/2472851ccf22762065670e1cf00a9c39db869aac"}], "stats": {"total": 71, "additions": 68, "deletions": 3}, "files": [{"sha": "9e6a3e15596ddb670f52736d3f8066c2333f3687", "filename": "crates/hir/src/attrs.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fhir%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fhir%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fattrs.rs?ref=f5b97e52c97fe6cc12aba3587c12e37b403deea4", "patch": "@@ -2,6 +2,7 @@\n use hir_def::{\n     attr::{Attrs, Documentation},\n     path::ModPath,\n+    per_ns::PerNs,\n     resolver::HasResolver,\n     AttrDefId, GenericParamId, ModuleDefId,\n };\n@@ -112,6 +113,11 @@ fn resolve_doc_path(\n     let path = ast::Path::parse(link).ok()?;\n     let modpath = ModPath::from_src(path, &Hygiene::new_unhygienic()).unwrap();\n     let resolved = resolver.resolve_module_path_in_items(db.upcast(), &modpath);\n+    if resolved == PerNs::none() {\n+        if let Some(trait_id) = resolver.resolve_module_path_in_trait_items(db.upcast(), &modpath) {\n+            return Some(ModuleDefId::TraitId(trait_id));\n+        };\n+    }\n     let def = match ns {\n         Some(Namespace::Types) => resolved.take_types()?,\n         Some(Namespace::Values) => resolved.take_values()?,"}, {"sha": "b2f5776497daea599aa9f8ba57cb063d918c1c69", "filename": "crates/hir_def/src/resolver.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fhir_def%2Fsrc%2Fresolver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fhir_def%2Fsrc%2Fresolver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fresolver.rs?ref=f5b97e52c97fe6cc12aba3587c12e37b403deea4", "patch": "@@ -146,6 +146,19 @@ impl Resolver {\n         self.resolve_module_path(db, path, BuiltinShadowMode::Module)\n     }\n \n+    pub fn resolve_module_path_in_trait_items(\n+        &self,\n+        db: &dyn DefDatabase,\n+        path: &ModPath,\n+    ) -> Option<TraitId> {\n+        let (item_map, module) = self.module_scope()?;\n+        let (module_res, ..) = item_map.resolve_path(db, module, &path, BuiltinShadowMode::Module);\n+        match module_res.take_types()? {\n+            ModuleDefId::TraitId(it) => Some(it),\n+            _ => None,\n+        }\n+    }\n+\n     pub fn resolve_path_in_type_ns(\n         &self,\n         db: &dyn DefDatabase,"}, {"sha": "730e0dd0aea344338225273d2829d29356ce20ee", "filename": "crates/ide/src/doc_links.rs", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fide%2Fsrc%2Fdoc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fide%2Fsrc%2Fdoc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdoc_links.rs?ref=f5b97e52c97fe6cc12aba3587c12e37b403deea4", "patch": "@@ -221,14 +221,31 @@ fn rewrite_intra_doc_link(\n     }?;\n     let krate = resolved.module(db)?.krate();\n     let canonical_path = resolved.canonical_path(db)?;\n-    let new_target = get_doc_url(db, &krate)?\n+    let mut new_url = get_doc_url(db, &krate)?\n         .join(&format!(\"{}/\", krate.display_name(db)?))\n         .ok()?\n         .join(&canonical_path.replace(\"::\", \"/\"))\n         .ok()?\n         .join(&get_symbol_filename(db, &resolved)?)\n-        .ok()?\n-        .into_string();\n+        .ok()?;\n+\n+    if let ModuleDef::Trait(t) = resolved {\n+        let items = t.items(db);\n+        if let Some(field_or_assoc_item) = items.iter().find_map(|assoc_item| {\n+            if let Some(name) = assoc_item.name(db) {\n+                if link.to_string() == format!(\"{}::{}\", canonical_path, name) {\n+                    return Some(FieldOrAssocItem::AssocItem(*assoc_item));\n+                }\n+            }\n+            None\n+        }) {\n+            if let Some(fragment) = get_symbol_fragment(db, &field_or_assoc_item) {\n+                new_url = new_url.join(&fragment).ok()?;\n+            }\n+        };\n+    }\n+\n+    let new_target = new_url.into_string();\n     let new_title = strip_prefixes_suffixes(title);\n     Some((new_target, new_title.to_string()))\n }"}, {"sha": "d47a4cb0f1b98aecf87d646a886def52f984259a", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5b97e52c97fe6cc12aba3587c12e37b403deea4/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=f5b97e52c97fe6cc12aba3587c12e37b403deea4", "patch": "@@ -1826,6 +1826,35 @@ pub struct B$0ar\n             \"#]],\n         );\n     }\n+    #[test]\n+    fn test_hover_intra_link_reference_to_trait_method() {\n+        check(\n+            r#\"\n+pub trait Foo {\n+    fn buzz() -> usize;\n+}\n+/// [Foo][buzz]\n+///\n+/// [buzz]: Foo::buzz\n+pub struct B$0ar\n+\"#,\n+            expect![[r#\"\n+                *Bar*\n+\n+                ```rust\n+                test\n+                ```\n+\n+                ```rust\n+                pub struct Bar\n+                ```\n+\n+                ---\n+\n+                [Foo](https://docs.rs/test/*/test/trait.Foo.html#tymethod.buzz)\n+            \"#]],\n+        );\n+    }\n \n     #[test]\n     fn test_hover_external_url() {"}]}