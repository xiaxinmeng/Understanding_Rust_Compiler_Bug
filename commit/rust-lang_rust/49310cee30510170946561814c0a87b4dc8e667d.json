{"sha": "49310cee30510170946561814c0a87b4dc8e667d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5MzEwY2VlMzA1MTAxNzA5NDY1NjE4MTRjMGE4N2I0ZGM4ZTY2N2Q=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-02-11T18:37:31Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-02-11T19:30:05Z"}, "message": "Add test for \"const stability on macro\"", "tree": {"sha": "52ea4998ae4bc4afe7f097975330aa067eedac9b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52ea4998ae4bc4afe7f097975330aa067eedac9b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/49310cee30510170946561814c0a87b4dc8e667d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/49310cee30510170946561814c0a87b4dc8e667d", "html_url": "https://github.com/rust-lang/rust/commit/49310cee30510170946561814c0a87b4dc8e667d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/49310cee30510170946561814c0a87b4dc8e667d/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19806e451476d9a97175d2ca0c095545e8894421", "url": "https://api.github.com/repos/rust-lang/rust/commits/19806e451476d9a97175d2ca0c095545e8894421", "html_url": "https://github.com/rust-lang/rust/commit/19806e451476d9a97175d2ca0c095545e8894421"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "5652d779908952631bbe5b749115c2c5cc3d5880", "filename": "compiler/rustc_expand/src/base.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/49310cee30510170946561814c0a87b4dc8e667d/compiler%2Frustc_expand%2Fsrc%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49310cee30510170946561814c0a87b4dc8e667d/compiler%2Frustc_expand%2Fsrc%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fbase.rs?ref=49310cee30510170946561814c0a87b4dc8e667d", "patch": "@@ -774,8 +774,11 @@ impl SyntaxExtension {\n             sess.parse_sess\n                 .span_diagnostic\n                 .struct_span_err(sp, \"macros cannot have const stability attributes\")\n-                .span_label(sp, \"invalid stability attribute\")\n-                .span_label(span, \"in this macro\")\n+                .span_label(sp, \"invalid const stability attribute\")\n+                .span_label(\n+                    sess.source_map().guess_head_span(span),\n+                    \"const stability attribute affects this macro\",\n+                )\n                 .emit();\n         }\n "}, {"sha": "3fc60f7ce48c2154c686a218e960411ffded2267", "filename": "src/test/ui/attributes/const-stability-on-macro.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/49310cee30510170946561814c0a87b4dc8e667d/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49310cee30510170946561814c0a87b4dc8e667d/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.rs?ref=49310cee30510170946561814c0a87b4dc8e667d", "patch": "@@ -0,0 +1,13 @@\n+#[rustc_const_stable(feature = \"foo\", since = \"0\")]\n+//~^ ERROR macros cannot have const stability attributes\n+macro_rules! foo {\n+    () => {};\n+}\n+\n+#[rustc_const_unstable(feature = \"bar\", issue=\"none\")]\n+//~^ ERROR macros cannot have const stability attributes\n+macro_rules! bar {\n+    () => {};\n+}\n+\n+fn main() {}"}, {"sha": "ef24e44d1908bd19e48cb88e0e84daf67791e948", "filename": "src/test/ui/attributes/const-stability-on-macro.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/49310cee30510170946561814c0a87b4dc8e667d/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/49310cee30510170946561814c0a87b4dc8e667d/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fconst-stability-on-macro.stderr?ref=49310cee30510170946561814c0a87b4dc8e667d", "patch": "@@ -0,0 +1,20 @@\n+error: macros cannot have const stability attributes\n+  --> $DIR/const-stability-on-macro.rs:1:1\n+   |\n+LL | #[rustc_const_stable(feature = \"foo\", since = \"0\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ invalid const stability attribute\n+LL |\n+LL | macro_rules! foo {\n+   | ---------------- const stability attribute affects this macro\n+\n+error: macros cannot have const stability attributes\n+  --> $DIR/const-stability-on-macro.rs:7:1\n+   |\n+LL | #[rustc_const_unstable(feature = \"bar\", issue=\"none\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ invalid const stability attribute\n+LL |\n+LL | macro_rules! bar {\n+   | ---------------- const stability attribute affects this macro\n+\n+error: aborting due to 2 previous errors\n+"}]}