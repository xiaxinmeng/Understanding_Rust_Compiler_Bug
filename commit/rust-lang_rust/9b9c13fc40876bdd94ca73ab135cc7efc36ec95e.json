{"sha": "9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "node_id": "C_kwDOAAsO6NoAKDliOWMxM2ZjNDA4NzZiZGQ5NGNhNzNhYjEzNWNjN2VmYzM2ZWM5NWU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-06-13T09:57:33Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-06-13T09:57:33Z"}, "message": "feat: On assoc item name hover, render trait decl docs", "tree": {"sha": "1c257969e761b56f041b07d0ed120108716e4f22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c257969e761b56f041b07d0ed120108716e4f22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "html_url": "https://github.com/rust-lang/rust/commit/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10e9f47dce5c049ab58fcd6b964e1764f8033f0b", "url": "https://api.github.com/repos/rust-lang/rust/commits/10e9f47dce5c049ab58fcd6b964e1764f8033f0b", "html_url": "https://github.com/rust-lang/rust/commit/10e9f47dce5c049ab58fcd6b964e1764f8033f0b"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "1cb67c6657a83400d2a59fc2c725224af69292f5", "filename": "crates/ide/src/hover/render.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e/crates%2Fide%2Fsrc%2Fhover%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Frender.rs?ref=9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "patch": "@@ -372,7 +372,20 @@ pub(super) fn definition(\n         Definition::ToolModule(it) => return Some(Markup::fenced_block(&it.name(db))),\n     };\n \n-    markup(docs.filter(|_| config.documentation.is_some()).map(Into::into), label, mod_path)\n+    let docs = match config.documentation {\n+        Some(_) => docs.or_else(|| {\n+            // docs are missing, for assoc items of trait impls try to fall back to the docs of the\n+            // original item of the trait\n+            let assoc = def.as_assoc_item(db)?;\n+            let trait_ = assoc.containing_trait_impl(db)?;\n+            let name = Some(assoc.name(db)?);\n+            let item = trait_.items(db).into_iter().find(|it| it.name(db) == name)?;\n+            item.docs(db)\n+        }),\n+        None => None,\n+    };\n+    let docs = docs.filter(|_| config.documentation.is_some()).map(Into::into);\n+    markup(docs, label, mod_path)\n }\n \n fn render_builtin_attr(db: &RootDatabase, attr: hir::BuiltinAttr) -> Option<Markup> {"}, {"sha": "8eb16aab29392b390aa56dca50306fd626edf49e", "filename": "crates/ide/src/hover/tests.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b9c13fc40876bdd94ca73ab135cc7efc36ec95e/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs?ref=9b9c13fc40876bdd94ca73ab135cc7efc36ec95e", "patch": "@@ -4888,3 +4888,33 @@ enum Enum {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn hover_trait_impl_assoc_item_def_doc_forwarding() {\n+    check(\n+        r#\"\n+trait T {\n+    /// Trait docs\n+    fn func() {}\n+}\n+impl T for () {\n+    fn func$0() {}\n+}\n+\"#,\n+        expect![[r#\"\n+            *func*\n+\n+            ```rust\n+            test\n+            ```\n+\n+            ```rust\n+            fn func()\n+            ```\n+\n+            ---\n+\n+            Trait docs\n+        \"#]],\n+    );\n+}"}]}