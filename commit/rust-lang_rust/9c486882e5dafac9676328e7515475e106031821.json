{"sha": "9c486882e5dafac9676328e7515475e106031821", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNDg2ODgyZTVkYWZhYzk2NzYzMjhlNzUxNTQ3NWUxMDYwMzE4MjE=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-10T13:45:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-10T13:45:17Z"}, "message": "Rollup merge of #78847 - tmiasko:inline-return-place, r=matthewjasper\n\nAssert that a return place is not used for indexing during integration\n\nThe inliner integrates call destination place with callee return place\nby remapping the local and adding extra projections as necessary.\n\nIf a call destination place contains any projections (which is already\npossible) and a return place is used in an indexing projection (most\nlikely doesn't happen yet) the end result would be incorrect.\n\nAdd an assertion to ensure that potential issue won't go unnoticed in\nthe presence of more sophisticated copy propagation scheme.", "tree": {"sha": "5889a4ee6317445f1fb2c94364aa7e7e9185603a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5889a4ee6317445f1fb2c94364aa7e7e9185603a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c486882e5dafac9676328e7515475e106031821", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfqpltCRBK7hj4Ov3rIwAAdHIIAJ/0ewMiYRGDycELfQXcjRuT\nn8Yz/DpblWd25Q5MefP6RbJ8SbGNymtbDoNZ3nAf7CEqOA4CqCIJwOX8gF/qBtgV\nHfU4DDCm35ztCO044slXlocUiEQ18Q4JI8o+b8xGNTpbVEu5eszXJ+PqFN9m11VW\nkXBWGJaMYTP8Oxg0mg6u3xJwgalLAw3/lvJLkHZEgHPWO/DuIQmtWXKYc475Vnpa\n6I+lWsczo4cyRqs8n3RdIXTrHJVbGClQ58FIXjvo4VNIaXuJZ8zlyXFY4GFZCQh6\nycgV7Vk4WddPsMskgPog4rRrfIBvOEZH3WEqQD4dsznoEPmT8Q/vPmUT/ZbUz3M=\n=QJhp\n-----END PGP SIGNATURE-----\n", "payload": "tree 5889a4ee6317445f1fb2c94364aa7e7e9185603a\nparent 3a2cbe6b830c28709076a5ce632fbfd447c5fe31\nparent 89c3582d599a8ed26b429329ca6e8976d82f0efc\nauthor Jonas Schievink <jonasschievink@gmail.com> 1605015917 +0100\ncommitter GitHub <noreply@github.com> 1605015917 +0100\n\nRollup merge of #78847 - tmiasko:inline-return-place, r=matthewjasper\n\nAssert that a return place is not used for indexing during integration\n\nThe inliner integrates call destination place with callee return place\nby remapping the local and adding extra projections as necessary.\n\nIf a call destination place contains any projections (which is already\npossible) and a return place is used in an indexing projection (most\nlikely doesn't happen yet) the end result would be incorrect.\n\nAdd an assertion to ensure that potential issue won't go unnoticed in\nthe presence of more sophisticated copy propagation scheme.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c486882e5dafac9676328e7515475e106031821", "html_url": "https://github.com/rust-lang/rust/commit/9c486882e5dafac9676328e7515475e106031821", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c486882e5dafac9676328e7515475e106031821/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a2cbe6b830c28709076a5ce632fbfd447c5fe31", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a2cbe6b830c28709076a5ce632fbfd447c5fe31", "html_url": "https://github.com/rust-lang/rust/commit/3a2cbe6b830c28709076a5ce632fbfd447c5fe31"}, {"sha": "89c3582d599a8ed26b429329ca6e8976d82f0efc", "url": "https://api.github.com/repos/rust-lang/rust/commits/89c3582d599a8ed26b429329ca6e8976d82f0efc", "html_url": "https://github.com/rust-lang/rust/commit/89c3582d599a8ed26b429329ca6e8976d82f0efc"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "bb17df8dd0bd0b9a21200ac4405c177a4401da88", "filename": "compiler/rustc_mir/src/transform/inline.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9c486882e5dafac9676328e7515475e106031821/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c486882e5dafac9676328e7515475e106031821/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finline.rs?ref=9c486882e5dafac9676328e7515475e106031821", "patch": "@@ -729,6 +729,12 @@ impl<'a, 'tcx> MutVisitor<'tcx> for Integrator<'a, 'tcx> {\n     }\n \n     fn visit_place(&mut self, place: &mut Place<'tcx>, context: PlaceContext, location: Location) {\n+        for elem in place.projection {\n+            // FIXME: Make sure that return place is not used in an indexing projection, since it\n+            // won't be rebased as it is supposed to be.\n+            assert_ne!(ProjectionElem::Index(RETURN_PLACE), elem);\n+        }\n+\n         // If this is the `RETURN_PLACE`, we need to rebase any projections onto it.\n         let dest_proj_len = self.destination.projection.len();\n         if place.local == RETURN_PLACE && dest_proj_len > 0 {"}]}