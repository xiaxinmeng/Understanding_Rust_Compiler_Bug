{"sha": "c47e2ef8d49f0140086d187ee3528a50454be394", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0N2UyZWY4ZDQ5ZjAxNDAwODZkMTg3ZWUzNTI4YTUwNDU0YmUzOTQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-13T15:14:02Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-13T15:18:37Z"}, "message": "Destabilize the `Error::type_id` function\n\nThis commit destabilizes the `Error::type_id` function in the standard library.\nThis does so by effectively reverting #58048, restoring the `#[unstable]`\nattribute. The security mailing list has recently been notified of a\nvulnerability relating to the stabilization of this function. First stabilized\nin Rust 1.34.0, a stable function here allows users to implement a custom\nreturn value for this function:\n\n    struct MyType;\n\n    impl Error for MyType {\n\tfn type_id(&self) -> TypeId {\n\t    // Enable safe casting to `String` by accident.\n\t    TypeId::of::<String>()\n\t}\n    }\n\nThis, when combined with the `Error::downcast` family of functions, allows\nsafely casting a type to any other type, clearly a memory safety issue! A\nsecurity announcement will be shortly posted to the security mailing list as\nwell as the Rust Blog, and when those links are available they'll be filled in\nfor this PR as well.\n\nThis commit simply destabilizes the `Error::type_id` which, although breaking\nfor users since Rust 1.34.0, is hoped to have little impact and has been deemed\nsufficient to mitigate this issue for the stable channel. The long-term fate of\nthe `Error::type_id` API will be discussed at #60784.", "tree": {"sha": "a1049ab551f7e5a7caa516efc3ad8852bd197dd4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1049ab551f7e5a7caa516efc3ad8852bd197dd4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c47e2ef8d49f0140086d187ee3528a50454be394", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c47e2ef8d49f0140086d187ee3528a50454be394", "html_url": "https://github.com/rust-lang/rust/commit/c47e2ef8d49f0140086d187ee3528a50454be394", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c47e2ef8d49f0140086d187ee3528a50454be394/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9ec99f4201ec33026a468ef1289f98a95b4d71a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9ec99f4201ec33026a468ef1289f98a95b4d71a", "html_url": "https://github.com/rust-lang/rust/commit/a9ec99f4201ec33026a468ef1289f98a95b4d71a"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "7cb830e751a77653295b4bcb0f6f6e8d9bb8d48c", "filename": "src/libstd/error.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c47e2ef8d49f0140086d187ee3528a50454be394/src%2Flibstd%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c47e2ef8d49f0140086d187ee3528a50454be394/src%2Flibstd%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ferror.rs?ref=c47e2ef8d49f0140086d187ee3528a50454be394", "patch": "@@ -197,7 +197,10 @@ pub trait Error: Debug + Display {\n     fn source(&self) -> Option<&(dyn Error + 'static)> { None }\n \n     /// Gets the `TypeId` of `self`\n-    #[stable(feature = \"error_type_id\", since = \"1.34.0\")]\n+    #[doc(hidden)]\n+    #[unstable(feature = \"error_type_id\",\n+               reason = \"this is memory unsafe to override in user code\",\n+               issue = \"60784\")]\n     fn type_id(&self) -> TypeId where Self: 'static {\n         TypeId::of::<Self>()\n     }"}]}