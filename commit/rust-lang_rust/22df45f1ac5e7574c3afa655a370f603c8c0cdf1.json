{"sha": "22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyZGY0NWYxYWM1ZTc1NzRjM2FmYTY1NWEzNzBmNjAzYzhjMGNkZjE=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2018-04-07T11:17:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-04-07T11:17:04Z"}, "message": "Merge pull request #2644 from phansch/fix_nonminimal_bool_false_positive\n\nFix nonminimal_bool false positive", "tree": {"sha": "fc9d2f7fb79e0da6a29baaf910759f06bf8f0f2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc9d2f7fb79e0da6a29baaf910759f06bf8f0f2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJayKiwCRBK7hj4Ov3rIwAAdHIIAG63RQbCvzWrdXQnHDHYlx2O\n1NcYd0/TJwP298CwhG/+TQzDYv2hdI29PR9lEp0Chaa9rcgE2ppthCP6XS+IrP+v\n3MV8+vh32LnbM79/FUxcjZpoS62ytQEV9S+yZQea1n6HSBpUyJL3FKt7bt2J+3A3\nI8DZ8zC/IO7kxrjriQ3k1A4rIXW5kR0KBxeKdZOYQ0jrqXcjGX34YQ+q1JTzBZ2G\nWvsUZ3IVGraQUzGVxR6oRmcrmeQNxm4fgN+jf4PZm+XEoXgr0Pcs0udfvrysDmt1\nUy0lZ15BKRfZgHYCpM+n1CAPYR/CS+fZ4dBXmHmxgzpg2K5JBTnu0cZfd32cfYQ=\n=8I6Z\n-----END PGP SIGNATURE-----\n", "payload": "tree fc9d2f7fb79e0da6a29baaf910759f06bf8f0f2c\nparent 1ce5ec8d13145ecc2ce308cc69eefd9506de0290\nparent 90e7d93d6cb333fea13383aa34d93b4fde7fbffc\nauthor Oliver Schneider <oli-obk@users.noreply.github.com> 1523099824 +0200\ncommitter GitHub <noreply@github.com> 1523099824 +0200\n\nMerge pull request #2644 from phansch/fix_nonminimal_bool_false_positive\n\nFix nonminimal_bool false positive"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "html_url": "https://github.com/rust-lang/rust/commit/22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ce5ec8d13145ecc2ce308cc69eefd9506de0290", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ce5ec8d13145ecc2ce308cc69eefd9506de0290", "html_url": "https://github.com/rust-lang/rust/commit/1ce5ec8d13145ecc2ce308cc69eefd9506de0290"}, {"sha": "90e7d93d6cb333fea13383aa34d93b4fde7fbffc", "url": "https://api.github.com/repos/rust-lang/rust/commits/90e7d93d6cb333fea13383aa34d93b4fde7fbffc", "html_url": "https://github.com/rust-lang/rust/commit/90e7d93d6cb333fea13383aa34d93b4fde7fbffc"}], "stats": {"total": 90, "additions": 88, "deletions": 2}, "files": [{"sha": "c8478c47a3548585cfc1c226b83394f3dee0506f", "filename": "clippy_lints/src/booleans.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/clippy_lints%2Fsrc%2Fbooleans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/clippy_lints%2Fsrc%2Fbooleans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbooleans.rs?ref=22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "patch": "@@ -4,7 +4,7 @@ use rustc::hir::intravisit::*;\n use syntax::ast::{LitKind, NodeId, DUMMY_NODE_ID};\n use syntax::codemap::{dummy_spanned, Span, DUMMY_SP};\n use syntax::util::ThinVec;\n-use utils::{in_macro, snippet_opt, span_lint_and_then, SpanlessEq};\n+use utils::{in_macro, paths, match_type, snippet_opt, span_lint_and_then, SpanlessEq};\n \n /// **What it does:** Checks for boolean expressions that can be written more\n /// concisely.\n@@ -185,6 +185,11 @@ impl<'a, 'tcx, 'v> SuggestContext<'a, 'tcx, 'v> {\n                 }.and_then(|op| Some(format!(\"{}{}{}\", self.snip(lhs)?, op, self.snip(rhs)?)))\n             },\n             ExprMethodCall(ref path, _, ref args) if args.len() == 1 => {\n+                let type_of_receiver = self.cx.tables.expr_ty(&args[0]);\n+                if !match_type(self.cx, type_of_receiver, &paths::OPTION) &&\n+                    !match_type(self.cx, type_of_receiver, &paths::RESULT) {\n+                        return None;\n+                }\n                 METHODS_WITH_NEGATION\n                     .iter().cloned()\n                     .flat_map(|(a, b)| vec![(a, b), (b, a)])"}, {"sha": "78e876e518226814ea9b6595cee16e6a9baa2085", "filename": "tests/ui/booleans.rs", "status": "modified", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/tests%2Fui%2Fbooleans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/tests%2Fui%2Fbooleans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbooleans.rs?ref=22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "patch": "@@ -57,3 +57,60 @@ fn methods_with_negation() {\n     let _ = (!c ^ c) || !a.is_some();\n     let _ = !c ^ c || !a.is_some();\n }\n+\n+// Simplified versions of https://github.com/rust-lang-nursery/rust-clippy/issues/2638\n+// nonminimal_bool should only check the built-in Result and Some type, not\n+// any other types like the following.\n+enum CustomResultOk<E> { Ok, Err(E) }\n+enum CustomResultErr<E> { Ok, Err(E) }\n+enum CustomSomeSome<T> { Some(T), None }\n+enum CustomSomeNone<T> { Some(T), None }\n+\n+impl<E> CustomResultOk<E> {\n+    pub fn is_ok(&self) -> bool { true }\n+}\n+\n+impl<E> CustomResultErr<E> {\n+    pub fn is_err(&self) -> bool { true }\n+}\n+\n+impl<T> CustomSomeSome<T> {\n+    pub fn is_some(&self) -> bool { true }\n+}\n+\n+impl<T> CustomSomeNone<T> {\n+    pub fn is_none(&self) -> bool { true }\n+}\n+\n+fn dont_warn_for_custom_methods_with_negation() {\n+    let res = CustomResultOk::Err(\"Error\");\n+    // Should not warn and suggest 'is_err()' because the type does not\n+    // implement is_err().\n+    if !res.is_ok() { }\n+\n+    let res = CustomResultErr::Err(\"Error\");\n+    // Should not warn and suggest 'is_ok()' because the type does not\n+    // implement is_ok().\n+    if !res.is_err() { }\n+\n+    let res = CustomSomeSome::Some(\"thing\");\n+    // Should not warn and suggest 'is_none()' because the type does not\n+    // implement is_none().\n+    if !res.is_some() { }\n+\n+    let res = CustomSomeNone::Some(\"thing\");\n+    // Should not warn and suggest 'is_some()' because the type does not\n+    // implement is_some().\n+    if !res.is_none() { }\n+}\n+\n+// Only Built-in Result and Some types should suggest the negated alternative\n+fn warn_for_built_in_methods_with_negation() {\n+    let res: Result<usize, usize> = Ok(1);\n+    if !res.is_ok() { }\n+    if !res.is_err() { }\n+\n+    let res = Some(1);\n+    if !res.is_some() { }\n+    if !res.is_none() { }\n+}"}, {"sha": "f1996e8a26e462e6220d6f70f53a883d64ef3fc9", "filename": "tests/ui/booleans.stderr", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/tests%2Fui%2Fbooleans.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/22df45f1ac5e7574c3afa655a370f603c8c0cdf1/tests%2Fui%2Fbooleans.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbooleans.stderr?ref=22df45f1ac5e7574c3afa655a370f603c8c0cdf1", "patch": "@@ -175,5 +175,29 @@ error: this boolean expression can be simplified\n 58 |     let _ = !c ^ c || !a.is_some();\n    |             ^^^^^^^^^^^^^^^^^^^^^^ help: try: `!c ^ c || a.is_none()`\n \n-error: aborting due to 21 previous errors\n+error: this boolean expression can be simplified\n+   --> $DIR/booleans.rs:110:8\n+    |\n+110 |     if !res.is_ok() { }\n+    |        ^^^^^^^^^^^^ help: try: `res.is_err()`\n+\n+error: this boolean expression can be simplified\n+   --> $DIR/booleans.rs:111:8\n+    |\n+111 |     if !res.is_err() { }\n+    |        ^^^^^^^^^^^^^ help: try: `res.is_ok()`\n+\n+error: this boolean expression can be simplified\n+   --> $DIR/booleans.rs:114:8\n+    |\n+114 |     if !res.is_some() { }\n+    |        ^^^^^^^^^^^^^^ help: try: `res.is_none()`\n+\n+error: this boolean expression can be simplified\n+   --> $DIR/booleans.rs:115:8\n+    |\n+115 |     if !res.is_none() { }\n+    |        ^^^^^^^^^^^^^^ help: try: `res.is_some()`\n+\n+error: aborting due to 25 previous errors\n "}]}