{"sha": "e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "node_id": "C_kwDOAAsO6NoAKGU3MmVkOTIzMGEwNmQ1YmY4OWZlNWNhNDY1YjlkMTM3N2E1M2ZjM2U", "commit": {"author": {"name": "Jeroen Vannevel", "email": "jer_vannevel@outlook.com", "date": "2022-02-01T00:21:35Z"}, "committer": {"name": "Jeroen Vannevel", "email": "jer_vannevel@outlook.com", "date": "2022-02-01T00:21:35Z"}, "message": "no longer support comments on their own", "tree": {"sha": "4a862c356d11923f93fbb7be7b96ca72b4ca4ac3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a862c356d11923f93fbb7be7b96ca72b4ca4ac3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEEzoFOOQgvfPzrDpfeO9fUvOMSb0FAmH4fRAACgkQeO9fUvOM\nSb3rAwv+P/13EnFRrFnoy9/FZ3l+HLFjnJKO14S59rGXBBNajOkWfg1t3g2zPzgk\nJf1PTiOba5+Kz8IYBgEKWTmL7NG67nWYv0UNwhf9a21iGrPZRub0uSo5AZRGazL6\n0CYfbBNhT1HisQm0HsDSN3EGUu19qscIMKT5MpC2mN+K9ug3eSKqsIDJMTexvjBh\nZC6ARcLk7E4RNWpD5i9ONaqPrKc4XuJIrFylp+DKK8FBSqjHkooQh7oiyJ6n2Ejc\neCUwNoUKx1DDTBC382Um7nfUAArx04mA1DQw1lNzYLWCAehI7ra3hjgrIwRI/WeC\nQShKMm4dYhJ/RwmF5K0idNPypliihQoGQsN6Jm1tnUmVSnGDSlGkFw8ZfnZe9acs\nAEFSAvDp52vnsL8WTEM2mJdTAdHYZbS69HOVJcZeJJePYBEKa5eecLp/WgWKCp48\noXa/25f5mdntNHLW/3/zzTjyOpeGvz1TVmFLVcPV/+QjtnKfwAywmS/firXPhxPQ\nty/foLYJ\n=cItX\n-----END PGP SIGNATURE-----", "payload": "tree 4a862c356d11923f93fbb7be7b96ca72b4ca4ac3\nparent 8f09e13c06f626cd5ce376aaf375834578dbdde5\nauthor Jeroen Vannevel <jer_vannevel@outlook.com> 1643674895 +0000\ncommitter Jeroen Vannevel <jer_vannevel@outlook.com> 1643674895 +0000\n\nno longer support comments on their own\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "html_url": "https://github.com/rust-lang/rust/commit/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e/comments", "author": {"login": "Vannevelj", "id": 2777107, "node_id": "MDQ6VXNlcjI3NzcxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2777107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vannevelj", "html_url": "https://github.com/Vannevelj", "followers_url": "https://api.github.com/users/Vannevelj/followers", "following_url": "https://api.github.com/users/Vannevelj/following{/other_user}", "gists_url": "https://api.github.com/users/Vannevelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vannevelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vannevelj/subscriptions", "organizations_url": "https://api.github.com/users/Vannevelj/orgs", "repos_url": "https://api.github.com/users/Vannevelj/repos", "events_url": "https://api.github.com/users/Vannevelj/events{/privacy}", "received_events_url": "https://api.github.com/users/Vannevelj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Vannevelj", "id": 2777107, "node_id": "MDQ6VXNlcjI3NzcxMDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2777107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vannevelj", "html_url": "https://github.com/Vannevelj", "followers_url": "https://api.github.com/users/Vannevelj/followers", "following_url": "https://api.github.com/users/Vannevelj/following{/other_user}", "gists_url": "https://api.github.com/users/Vannevelj/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vannevelj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vannevelj/subscriptions", "organizations_url": "https://api.github.com/users/Vannevelj/orgs", "repos_url": "https://api.github.com/users/Vannevelj/repos", "events_url": "https://api.github.com/users/Vannevelj/events{/privacy}", "received_events_url": "https://api.github.com/users/Vannevelj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f09e13c06f626cd5ce376aaf375834578dbdde5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f09e13c06f626cd5ce376aaf375834578dbdde5", "html_url": "https://github.com/rust-lang/rust/commit/8f09e13c06f626cd5ce376aaf375834578dbdde5"}], "stats": {"total": 50, "additions": 16, "deletions": 34}, "files": [{"sha": "640c3554096d84a6d91d99915c645722d4d6a640", "filename": "crates/ide_assists/src/handlers/extract_function.rs", "status": "modified", "additions": 16, "deletions": 34, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs?ref=e72ed9230a06d5bf89fe5ca465b9d1377a53fc3e", "patch": "@@ -22,8 +22,9 @@ use syntax::{\n         edit::{AstNodeEdit, IndentLevel},\n         AstNode,\n     },\n-    match_ast, ted, SyntaxElement, SyntaxKind, SyntaxNode, SyntaxToken, TextRange, TextSize,\n-    TokenAtOffset, WalkEvent, T,\n+    match_ast, ted, SyntaxElement,\n+    SyntaxKind::{self, COMMENT},\n+    SyntaxNode, SyntaxToken, TextRange, TextSize, TokenAtOffset, WalkEvent, T,\n };\n \n use crate::{\n@@ -64,7 +65,13 @@ pub(crate) fn extract_function(acc: &mut Assists, ctx: &AssistContext) -> Option\n         return None;\n     }\n \n-    let node = match ctx.covering_element() {\n+    let node = ctx.covering_element();\n+    if node.kind() == COMMENT {\n+        cov_mark::hit!(extract_function_in_comment_is_not_applicable);\n+        return None;\n+    }\n+\n+    let node = match node {\n         syntax::NodeOrToken::Node(n) => n,\n         syntax::NodeOrToken::Token(t) => t.parent()?,\n     };\n@@ -2202,6 +2209,12 @@ fn $0fun_name(n: u32) -> u32 {\n         )\n     }\n \n+    #[test]\n+    fn in_comment_is_not_applicable() {\n+        cov_mark::check!(extract_function_in_comment_is_not_applicable);\n+        check_assist_not_applicable(extract_function, r\"fn main() { 1 + /* $0comment$0 */ 1; }\");\n+    }\n+\n     #[test]\n     fn part_of_expr_stmt() {\n         check_assist(\n@@ -4590,37 +4603,6 @@ fn $0fun_name() {\n     */\n     let x = 0;\n }\n-\"#,\n-        );\n-    }\n-\n-    #[test]\n-    fn extract_function_long_form_comment_multiline_alone() {\n-        check_assist(\n-            extract_function,\n-            r#\"\n-fn func() {\n-    let i = 0;\n-    $0/*\n-    a\n-    comment\n-    */\n-    $0let x = 0;\n-}\n-\"#,\n-            r#\"\n-fn func() {\n-    let i = 0;\n-    fun_name();\n-    let x = 0;\n-}\n-\n-fn $0fun_name() {\n-    /*\n-    a\n-    comment\n-    */\n-}\n \"#,\n         );\n     }"}]}