{"sha": "681ea25b2016723cac03bc4f1682f50860d560d3", "node_id": "C_kwDOAAsO6NoAKDY4MWVhMjViMjAxNjcyM2NhYzAzYmM0ZjE2ODJmNTA4NjBkNTYwZDM", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-03-25T15:12:21Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2022-03-25T16:24:27Z"}, "message": "Remove usage of panic_update_hook feature gate", "tree": {"sha": "9f876ec6c3c3305e5a7766b6b0bfb6d24df7e1d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f876ec6c3c3305e5a7766b6b0bfb6d24df7e1d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/681ea25b2016723cac03bc4f1682f50860d560d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/681ea25b2016723cac03bc4f1682f50860d560d3", "html_url": "https://github.com/rust-lang/rust/commit/681ea25b2016723cac03bc4f1682f50860d560d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/681ea25b2016723cac03bc4f1682f50860d560d3/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e85722946af6ae7d6ba8b6c7459d6ae6c5554216", "url": "https://api.github.com/repos/rust-lang/rust/commits/e85722946af6ae7d6ba8b6c7459d6ae6c5554216", "html_url": "https://github.com/rust-lang/rust/commit/e85722946af6ae7d6ba8b6c7459d6ae6c5554216"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "83a2ac6f0d4f14e77b1de2aae54f059addf166a4", "filename": "library/proc_macro/src/bridge/client.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/681ea25b2016723cac03bc4f1682f50860d560d3/library%2Fproc_macro%2Fsrc%2Fbridge%2Fclient.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681ea25b2016723cac03bc4f1682f50860d560d3/library%2Fproc_macro%2Fsrc%2Fbridge%2Fclient.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fproc_macro%2Fsrc%2Fbridge%2Fclient.rs?ref=681ea25b2016723cac03bc4f1682f50860d560d3", "patch": "@@ -310,15 +310,16 @@ impl Bridge<'_> {\n         // NB. the server can't do this because it may use a different libstd.\n         static HIDE_PANICS_DURING_EXPANSION: Once = Once::new();\n         HIDE_PANICS_DURING_EXPANSION.call_once(|| {\n-            panic::update_hook(move |prev, info| {\n+            let prev = panic::take_hook();\n+            panic::set_hook(Box::new(move |info| {\n                 let show = BridgeState::with(|state| match state {\n                     BridgeState::NotConnected => true,\n                     BridgeState::Connected(_) | BridgeState::InUse => force_show_panics,\n                 });\n                 if show {\n                     prev(info)\n                 }\n-            });\n+            }));\n         });\n \n         BRIDGE_STATE.with(|state| state.set(BridgeState::Connected(self), f))"}, {"sha": "088d32ed16f9b54a6530e538f282b6b19b3ec16c", "filename": "library/proc_macro/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/681ea25b2016723cac03bc4f1682f50860d560d3/library%2Fproc_macro%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681ea25b2016723cac03bc4f1682f50860d560d3/library%2Fproc_macro%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fproc_macro%2Fsrc%2Flib.rs?ref=681ea25b2016723cac03bc4f1682f50860d560d3", "patch": "@@ -29,7 +29,6 @@\n #![feature(restricted_std)]\n #![feature(rustc_attrs)]\n #![feature(min_specialization)]\n-#![feature(panic_update_hook)]\n #![recursion_limit = \"256\"]\n \n #[unstable(feature = \"proc_macro_internals\", issue = \"27812\")]"}]}