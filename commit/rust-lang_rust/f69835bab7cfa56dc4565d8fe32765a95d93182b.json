{"sha": "f69835bab7cfa56dc4565d8fe32765a95d93182b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2OTgzNWJhYjdjZmE1NmRjNDU2NWQ4ZmUzMjc2NWE5NWQ5MzE4MmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-29T16:29:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-29T16:29:05Z"}, "message": "Auto merge of #5058 - xiongmao86:issue4903, r=flip1995\n\nCloses Issue4903\n\nfixes #4903.\n\nCheck list:\n- [x] Followed [lint naming conventions][lint_naming]\n- [x] Added passing UI tests (including committed `.stderr` file)\n- [x] `cargo test` passes locally\n- [x] Executed `./util/dev update_lints`\n- [x] Added lint documentation\n- [x] Run `./util/dev fmt`\n\n[lint_naming]: https://rust-lang.github.io/rfcs/0344-conventions-galore.html#lints\n---\n\nchangelog: implement lint that warn about single component path imports(`use ident;`).", "tree": {"sha": "a974f2bcbe87f3190fc7c2b6d64271c7a99c5221", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a974f2bcbe87f3190fc7c2b6d64271c7a99c5221"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f69835bab7cfa56dc4565d8fe32765a95d93182b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f69835bab7cfa56dc4565d8fe32765a95d93182b", "html_url": "https://github.com/rust-lang/rust/commit/f69835bab7cfa56dc4565d8fe32765a95d93182b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f69835bab7cfa56dc4565d8fe32765a95d93182b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0f39cfb466202a1dbe8368ca177848083dc34cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0f39cfb466202a1dbe8368ca177848083dc34cb", "html_url": "https://github.com/rust-lang/rust/commit/c0f39cfb466202a1dbe8368ca177848083dc34cb"}, {"sha": "ac9f019fbf68631eb947c3b7fcc5563c3506d040", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac9f019fbf68631eb947c3b7fcc5563c3506d040", "html_url": "https://github.com/rust-lang/rust/commit/ac9f019fbf68631eb947c3b7fcc5563c3506d040"}], "stats": {"total": 122, "additions": 115, "deletions": 7}, "files": [{"sha": "d5dbbabb3c5cfbafac70c66ddfe8a633dbdc3eb4", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -1284,6 +1284,7 @@ Released 2018-09-13\n [`should_implement_trait`]: https://rust-lang.github.io/rust-clippy/master/index.html#should_implement_trait\n [`similar_names`]: https://rust-lang.github.io/rust-clippy/master/index.html#similar_names\n [`single_char_pattern`]: https://rust-lang.github.io/rust-clippy/master/index.html#single_char_pattern\n+[`single_component_path_imports`]: https://rust-lang.github.io/rust-clippy/master/index.html#single_component_path_imports\n [`single_match`]: https://rust-lang.github.io/rust-clippy/master/index.html#single_match\n [`single_match_else`]: https://rust-lang.github.io/rust-clippy/master/index.html#single_match_else\n [`skip_while_next`]: https://rust-lang.github.io/rust-clippy/master/index.html#skip_while_next"}, {"sha": "0cb14eda6a8812f8aea8e7b6cd4734db1a363ce3", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -6,7 +6,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 349 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 350 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "7008c6d6839de6692347ae87cbc7e4c59c9ea08f", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -284,6 +284,7 @@ pub mod replace_consts;\n pub mod returns;\n pub mod serde_api;\n pub mod shadow;\n+pub mod single_component_path_imports;\n pub mod slow_vector_initialization;\n pub mod strings;\n pub mod suspicious_trait_impl;\n@@ -741,6 +742,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &shadow::SHADOW_REUSE,\n         &shadow::SHADOW_SAME,\n         &shadow::SHADOW_UNRELATED,\n+        &single_component_path_imports::SINGLE_COMPONENT_PATH_IMPORTS,\n         &slow_vector_initialization::SLOW_VECTOR_INITIALIZATION,\n         &strings::STRING_ADD,\n         &strings::STRING_ADD_ASSIGN,\n@@ -993,6 +995,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_early_pass(|| box utils::internal_lints::ProduceIce);\n     store.register_late_pass(|| box let_underscore::LetUnderscore);\n     store.register_late_pass(|| box atomic_ordering::AtomicOrdering);\n+    store.register_early_pass(|| box single_component_path_imports::SingleComponentPathImports);\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),\n@@ -1296,6 +1299,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&returns::NEEDLESS_RETURN),\n         LintId::of(&returns::UNUSED_UNIT),\n         LintId::of(&serde_api::SERDE_API_MISUSE),\n+        LintId::of(&single_component_path_imports::SINGLE_COMPONENT_PATH_IMPORTS),\n         LintId::of(&slow_vector_initialization::SLOW_VECTOR_INITIALIZATION),\n         LintId::of(&strings::STRING_LIT_AS_BYTES),\n         LintId::of(&suspicious_trait_impl::SUSPICIOUS_ARITHMETIC_IMPL),\n@@ -1431,6 +1435,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&returns::LET_AND_RETURN),\n         LintId::of(&returns::NEEDLESS_RETURN),\n         LintId::of(&returns::UNUSED_UNIT),\n+        LintId::of(&single_component_path_imports::SINGLE_COMPONENT_PATH_IMPORTS),\n         LintId::of(&strings::STRING_LIT_AS_BYTES),\n         LintId::of(&tabs_in_doc_comments::TABS_IN_DOC_COMMENTS),\n         LintId::of(&to_digit_is_some::TO_DIGIT_IS_SOME),"}, {"sha": "6e5015eb84496da0528c6c5d0c816fac9111aeb9", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -2310,7 +2310,7 @@ fn lint_unwrap(cx: &LateContext<'_, '_>, expr: &hir::Expr<'_>, unwrap_args: &[hi\n             &format!(\"used `unwrap()` on `{}` value\", kind,),\n             &format!(\n                 \"if you don't want to handle the `{}` case gracefully, consider \\\n-                using `expect()` to provide a better panic message\",\n+                 using `expect()` to provide a better panic message\",\n                 none_value,\n             ),\n         );\n@@ -2679,7 +2679,7 @@ fn lint_filter_flat_map<'a, 'tcx>(\n     if match_trait_method(cx, expr, &paths::ITERATOR) {\n         let msg = \"called `filter(p).flat_map(q)` on an `Iterator`\";\n         let hint = \"this is more succinctly expressed by calling `.flat_map(..)` \\\n-            and filtering by returning `iter::empty()`\";\n+                    and filtering by returning `iter::empty()`\";\n         span_lint_and_help(cx, FILTER_MAP, expr.span, msg, hint);\n     }\n }\n@@ -2695,7 +2695,7 @@ fn lint_filter_map_flat_map<'a, 'tcx>(\n     if match_trait_method(cx, expr, &paths::ITERATOR) {\n         let msg = \"called `filter_map(p).flat_map(q)` on an `Iterator`\";\n         let hint = \"this is more succinctly expressed by calling `.flat_map(..)` \\\n-            and filtering by returning `iter::empty()`\";\n+                    and filtering by returning `iter::empty()`\";\n         span_lint_and_help(cx, FILTER_MAP, expr.span, msg, hint);\n     }\n }\n@@ -3148,7 +3148,7 @@ fn lint_option_as_ref_deref<'a, 'tcx>(\n \n         let msg = format!(\n             \"called `{0}` (or with one of deref aliases) on an Option value. \\\n-                        This can be done more directly by calling `{1}` instead\",\n+             This can be done more directly by calling `{1}` instead\",\n             current_method, hint\n         );\n         span_lint_and_sugg("}, {"sha": "eb3261bebe31573be548e0838109e2aa1dc8dd13", "filename": "clippy_lints/src/single_component_path_imports.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -0,0 +1,61 @@\n+use crate::utils::span_lint_and_sugg;\n+use if_chain::if_chain;\n+use rustc_errors::Applicability;\n+use rustc_lint::{EarlyContext, EarlyLintPass};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+use rustc_span::edition::Edition;\n+use syntax::ast::{Item, ItemKind, UseTreeKind};\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checking for imports with single component use path.\n+    ///\n+    /// **Why is this bad?** Import with single component use path such as `use cratename;`\n+    /// is not necessary, and thus should be removed.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    ///\n+    /// ```rust, ignore\n+    /// use regex;\n+    ///\n+    /// fn main() {\n+    ///     regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+    /// }\n+    /// ```\n+    /// Better as\n+    /// ```rust, ignore\n+    /// fn main() {\n+    ///     regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+    /// }\n+    /// ```\n+    pub SINGLE_COMPONENT_PATH_IMPORTS,\n+    style,\n+    \"imports with single component path are redundant\"\n+}\n+\n+declare_lint_pass!(SingleComponentPathImports => [SINGLE_COMPONENT_PATH_IMPORTS]);\n+\n+impl EarlyLintPass for SingleComponentPathImports {\n+    fn check_item(&mut self, cx: &EarlyContext<'_>, item: &Item) {\n+        if_chain! {\n+            if cx.sess.opts.edition == Edition::Edition2018;\n+            if !item.vis.node.is_pub();\n+            if let ItemKind::Use(use_tree) = &item.kind;\n+            if let segments = &use_tree.prefix.segments;\n+            if segments.len() == 1;\n+            if let UseTreeKind::Simple(None, _, _) = use_tree.kind;\n+            then {\n+                span_lint_and_sugg(\n+                    cx,\n+                    SINGLE_COMPONENT_PATH_IMPORTS,\n+                    item.span,\n+                    \"this import is redundant\",\n+                    \"remove it entirely\",\n+                    String::new(),\n+                    Applicability::MachineApplicable\n+                );\n+            }\n+        }\n+    }\n+}"}, {"sha": "e47f2480a541d87881b1752a63e229a95cac6957", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -316,7 +316,7 @@ impl Types {\n                                 OPTION_OPTION,\n                                 hir_ty.span,\n                                 \"consider using `Option<T>` instead of `Option<Option<T>>` or a custom \\\n-                                enum if you need to distinguish all 3 cases\",\n+                                 enum if you need to distinguish all 3 cases\",\n                             );\n                             return; // don't recurse into the type\n                         }"}, {"sha": "b762c8d139514fb09ffc6359bb6c52cf373f3e25", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -6,7 +6,7 @@ pub use lint::Lint;\n pub use lint::LINT_LEVELS;\n \n // begin lint list, do not remove this comment, it\u2019s used in `update_lints`\n-pub const ALL_LINTS: [Lint; 349] = [\n+pub const ALL_LINTS: [Lint; 350] = [\n     Lint {\n         name: \"absurd_extreme_comparisons\",\n         group: \"correctness\",\n@@ -1855,6 +1855,13 @@ pub const ALL_LINTS: [Lint; 349] = [\n         deprecation: None,\n         module: \"methods\",\n     },\n+    Lint {\n+        name: \"single_component_path_imports\",\n+        group: \"style\",\n+        desc: \"imports with single component path are redundant\",\n+        deprecation: None,\n+        module: \"single_component_path_imports\",\n+    },\n     Lint {\n         name: \"single_match\",\n         group: \"style\","}, {"sha": "7a882efc4d18ae387729bfddfe9357a03670ef2d", "filename": "tests/ui/single_component_path_imports.fixed", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.fixed?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -0,0 +1,12 @@\n+// run-rustfix\n+// compile-flags: --edition 2018\n+#![warn(clippy::single_component_path_imports)]\n+#![allow(unused_imports)]\n+\n+\n+use serde as edres;\n+pub use serde;\n+\n+fn main() {\n+    regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+}"}, {"sha": "d084425cd70f3623c9abcab2a2d8c4378aa7e8f0", "filename": "tests/ui/single_component_path_imports.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.rs?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -0,0 +1,12 @@\n+// run-rustfix\n+// compile-flags: --edition 2018\n+#![warn(clippy::single_component_path_imports)]\n+#![allow(unused_imports)]\n+\n+use regex;\n+use serde as edres;\n+pub use serde;\n+\n+fn main() {\n+    regex::Regex::new(r\"^\\d{4}-\\d{2}-\\d{2}$\").unwrap();\n+}"}, {"sha": "519ada0169a6d89ee87e2f37db80790d19512c30", "filename": "tests/ui/single_component_path_imports.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f69835bab7cfa56dc4565d8fe32765a95d93182b/tests%2Fui%2Fsingle_component_path_imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.stderr?ref=f69835bab7cfa56dc4565d8fe32765a95d93182b", "patch": "@@ -0,0 +1,10 @@\n+error: this import is redundant\n+  --> $DIR/single_component_path_imports.rs:6:1\n+   |\n+LL | use regex;\n+   | ^^^^^^^^^^ help: remove it entirely\n+   |\n+   = note: `-D clippy::single-component-path-imports` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}