{"sha": "58e56cca567921350f376cb3e2155029fc0df226", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4ZTU2Y2NhNTY3OTIxMzUwZjM3NmNiM2UyMTU1MDI5ZmMwZGYyMjY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-01-25T14:52:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-25T14:52:18Z"}, "message": "Rollup merge of #47726 - pietroalbini:fix-nested-empty-groups-span, r=petrochenkov\n\nFix spans in unused import lint for nested groups\n\nThis fixes an inconsistency for empty nested groups, and adds a test for all the possible cases of the lint.\n\n```\nwarning: unused imports: `*`, `Foo`, `baz::{}`, `foobar::*`\n  --> test.rs:16:11\n   |\n16 | use foo::{Foo, bar::{baz::{}, foobar::*}, *};\n   |           ^^^        ^^^^^^^  ^^^^^^^^^   ^\n   |\n   = note: #[warn(unused_imports)] on by default\n\nwarning: unused import: `*`\n  --> test.rs:17:24\n   |\n17 | use foo::bar::baz::{*, *};\n   |                        ^\n\nwarning: unused import: `use foo::{};`\n  --> test.rs:18:1\n   |\n18 | use foo::{};\n   | ^^^^^^^^^^^^\n```\n\ncc #44494", "tree": {"sha": "2b58b6c1d498c3963d6541640a4fb426a0415bce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b58b6c1d498c3963d6541640a4fb426a0415bce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58e56cca567921350f376cb3e2155029fc0df226", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58e56cca567921350f376cb3e2155029fc0df226", "html_url": "https://github.com/rust-lang/rust/commit/58e56cca567921350f376cb3e2155029fc0df226", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58e56cca567921350f376cb3e2155029fc0df226/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f2a0c6f689797e9c2c876109b5acb4926c28634", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f2a0c6f689797e9c2c876109b5acb4926c28634", "html_url": "https://github.com/rust-lang/rust/commit/6f2a0c6f689797e9c2c876109b5acb4926c28634"}, {"sha": "0847ac026568b70f0927b85a1a2e3d2f79a6b48f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0847ac026568b70f0927b85a1a2e3d2f79a6b48f", "html_url": "https://github.com/rust-lang/rust/commit/0847ac026568b70f0927b85a1a2e3d2f79a6b48f"}], "stats": {"total": 68, "additions": 50, "deletions": 18}, "files": [{"sha": "5a321053b7ae8a2ece1c295d1ad67755455faf2a", "filename": "src/librustc_resolve/check_unused.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/58e56cca567921350f376cb3e2155029fc0df226/src%2Flibrustc_resolve%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58e56cca567921350f376cb3e2155029fc0df226/src%2Flibrustc_resolve%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fcheck_unused.rs?ref=58e56cca567921350f376cb3e2155029fc0df226", "patch": "@@ -102,11 +102,18 @@ impl<'a, 'b> Visitor<'a> for UnusedImportCheckVisitor<'a, 'b> {\n         }\n \n         if let ast::UseTreeKind::Nested(ref items) = use_tree.kind {\n+            // If it's the parent group, cover the entire use item\n+            let span = if nested {\n+                use_tree.span\n+            } else {\n+                self.item_span\n+            };\n+\n             if items.len() == 0 {\n                 self.unused_imports\n                     .entry(self.base_id)\n                     .or_insert_with(NodeMap)\n-                    .insert(id, self.item_span);\n+                    .insert(id, span);\n             }\n         } else {\n             let base_id = self.base_id;"}, {"sha": "79089b2a93c7340e5bda63c953be4e11905e137d", "filename": "src/test/ui/owl-import-generates-unused-import-lint.stderr", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6f2a0c6f689797e9c2c876109b5acb4926c28634/src%2Ftest%2Fui%2Fowl-import-generates-unused-import-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6f2a0c6f689797e9c2c876109b5acb4926c28634/src%2Ftest%2Fui%2Fowl-import-generates-unused-import-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fowl-import-generates-unused-import-lint.stderr?ref=6f2a0c6f689797e9c2c876109b5acb4926c28634", "patch": "@@ -1,14 +0,0 @@\n-error: unused import: `*`\n-  --> $DIR/owl-import-generates-unused-import-lint.rs:18:14\n-   |\n-18 | use foo::{*, *}; //~ ERROR unused import: `*`\n-   |              ^\n-   |\n-note: lint level defined here\n-  --> $DIR/owl-import-generates-unused-import-lint.rs:12:9\n-   |\n-12 | #![deny(unused_imports)]\n-   |         ^^^^^^^^^^^^^^\n-\n-error: aborting due to previous error\n-"}, {"sha": "ddbf54fdd48b1150273b96fbd687427e825205a5", "filename": "src/test/ui/use-nested-groups-unused-imports.rs", "status": "renamed", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/58e56cca567921350f376cb3e2155029fc0df226/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58e56cca567921350f376cb3e2155029fc0df226/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.rs?ref=58e56cca567921350f376cb3e2155029fc0df226", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -9,13 +9,26 @@\n // except according to those terms.\n \n #![feature(use_nested_groups)]\n+#![allow(dead_code)]\n #![deny(unused_imports)]\n \n mod foo {\n-    pub enum Bar {}\n+    pub mod bar {\n+        pub mod baz {\n+            pub struct Bar();\n+        }\n+        pub mod foobar {}\n+    }\n+\n+    pub struct Foo();\n }\n \n-use foo::{*, *}; //~ ERROR unused import: `*`\n+use foo::{Foo, bar::{baz::{}, foobar::*}, *};\n+    //~^ ERROR unused imports: `*`, `Foo`, `baz::{}`, `foobar::*`\n+use foo::bar::baz::{*, *};\n+    //~^ ERROR unused import: `*`\n+use foo::{};\n+    //~^ ERROR unused import: `use foo::{};`\n \n fn main() {\n     let _: Bar;", "previous_filename": "src/test/ui/owl-import-generates-unused-import-lint.rs"}, {"sha": "0686310dbf53a1c58bd9e4f6769992c0969d0759", "filename": "src/test/ui/use-nested-groups-unused-imports.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/58e56cca567921350f376cb3e2155029fc0df226/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/58e56cca567921350f376cb3e2155029fc0df226/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse-nested-groups-unused-imports.stderr?ref=58e56cca567921350f376cb3e2155029fc0df226", "patch": "@@ -0,0 +1,26 @@\n+error: unused imports: `*`, `Foo`, `baz::{}`, `foobar::*`\n+  --> $DIR/use-nested-groups-unused-imports.rs:26:11\n+   |\n+26 | use foo::{Foo, bar::{baz::{}, foobar::*}, *};\n+   |           ^^^        ^^^^^^^  ^^^^^^^^^   ^\n+   |\n+note: lint level defined here\n+  --> $DIR/use-nested-groups-unused-imports.rs:13:9\n+   |\n+13 | #![deny(unused_imports)]\n+   |         ^^^^^^^^^^^^^^\n+\n+error: unused import: `*`\n+  --> $DIR/use-nested-groups-unused-imports.rs:28:24\n+   |\n+28 | use foo::bar::baz::{*, *};\n+   |                        ^\n+\n+error: unused import: `use foo::{};`\n+  --> $DIR/use-nested-groups-unused-imports.rs:30:1\n+   |\n+30 | use foo::{};\n+   | ^^^^^^^^^^^^\n+\n+error: aborting due to 3 previous errors\n+"}]}