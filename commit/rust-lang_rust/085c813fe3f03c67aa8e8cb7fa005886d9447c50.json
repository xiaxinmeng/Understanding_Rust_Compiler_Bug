{"sha": "085c813fe3f03c67aa8e8cb7fa005886d9447c50", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4NWM4MTNmZTNmMDNjNjdhYThlOGNiN2ZhMDA1ODg2ZDk0NDdjNTA=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-12-21T04:59:03Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-12-21T04:59:03Z"}, "message": "Merge pull request #1365 from elly/cargo\n\ncargo: allow 'ref' package key for git packages.", "tree": {"sha": "8865168b706b9efe73c7420ee8e1bf40ed2c6282", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8865168b706b9efe73c7420ee8e1bf40ed2c6282"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/085c813fe3f03c67aa8e8cb7fa005886d9447c50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/085c813fe3f03c67aa8e8cb7fa005886d9447c50", "html_url": "https://github.com/rust-lang/rust/commit/085c813fe3f03c67aa8e8cb7fa005886d9447c50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/085c813fe3f03c67aa8e8cb7fa005886d9447c50/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dedfef4c4c7a5e2d3f36d4301bfd9f7e1af21640", "url": "https://api.github.com/repos/rust-lang/rust/commits/dedfef4c4c7a5e2d3f36d4301bfd9f7e1af21640", "html_url": "https://github.com/rust-lang/rust/commit/dedfef4c4c7a5e2d3f36d4301bfd9f7e1af21640"}, {"sha": "bbc534bcccfc1904104a1fa275a6a873a7675cd1", "url": "https://api.github.com/repos/rust-lang/rust/commits/bbc534bcccfc1904104a1fa275a6a873a7675cd1", "html_url": "https://github.com/rust-lang/rust/commit/bbc534bcccfc1904104a1fa275a6a873a7675cd1"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "99109f5d48968710bfe5c9a6a8063eeef5875db8", "filename": "src/cargo/cargo.rs", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/085c813fe3f03c67aa8e8cb7fa005886d9447c50/src%2Fcargo%2Fcargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/085c813fe3f03c67aa8e8cb7fa005886d9447c50/src%2Fcargo%2Fcargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcargo%2Fcargo.rs?ref=085c813fe3f03c67aa8e8cb7fa005886d9447c50", "patch": "@@ -31,6 +31,7 @@ type package = {\n     uuid: str,\n     url: str,\n     method: str,\n+    ref: option::t<str>,\n     tags: [str]\n };\n \n@@ -242,6 +243,11 @@ fn load_one_source_package(&src: source, p: map::hashmap<str, json::json>) {\n         }\n     };\n \n+    let ref = alt p.find(\"ref\") {\n+        some(json::string(_n)) { some(_n) }\n+        _ { none }\n+    };\n+\n     let tags = [];\n     alt p.find(\"tags\") {\n         some(json::list(js)) {\n@@ -260,6 +266,7 @@ fn load_one_source_package(&src: source, p: map::hashmap<str, json::json>) {\n         uuid: uuid,\n         url: url,\n         method: method,\n+        ref: ref,\n         tags: tags\n     });\n     log \"  Loaded package: \" + src.name + \"/\" + name;\n@@ -398,8 +405,14 @@ fn install_source(c: cargo, path: str) {\n     }\n }\n \n-fn install_git(c: cargo, wd: str, url: str) {\n+fn install_git(c: cargo, wd: str, url: str, ref: option::t<str>) {\n     run::run_program(\"git\", [\"clone\", url, wd]);\n+    if option::is_some::<str>(ref) {\n+        let r = option::get::<str>(ref);\n+        fs::change_dir(wd);\n+        run::run_program(\"git\", [\"checkout\", r]);\n+    }\n+\n     install_source(c, wd);\n }\n \n@@ -424,7 +437,7 @@ fn install_file(c: cargo, wd: str, path: str) {\n fn install_package(c: cargo, wd: str, pkg: package) {\n     info(\"Installing with \" + pkg.method + \" from \" + pkg.url + \"...\");\n     if pkg.method == \"git\" {\n-        install_git(c, wd, pkg.url);\n+        install_git(c, wd, pkg.url, pkg.ref);\n     } else if pkg.method == \"http\" {\n         install_curl(c, wd, pkg.url);\n     } else if pkg.method == \"file\" {"}]}