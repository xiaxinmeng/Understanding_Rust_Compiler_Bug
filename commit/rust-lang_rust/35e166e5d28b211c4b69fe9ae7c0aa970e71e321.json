{"sha": "35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1ZTE2NmU1ZDI4YjIxMWM0YjY5ZmU5YWU3YzBhYTk3MGU3MWUzMjE=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-08-24T04:51:32Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-08-24T04:51:32Z"}, "message": "Account for async functions when suggesting new named lifetime\n\nFix #75850.", "tree": {"sha": "cf9e5c8d86dc2c6676e5f69047f5c6331cf8adfe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf9e5c8d86dc2c6676e5f69047f5c6331cf8adfe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "html_url": "https://github.com/rust-lang/rust/commit/35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "663d2f5cd3163f17eddb74ee1e028d542255f21a", "url": "https://api.github.com/repos/rust-lang/rust/commits/663d2f5cd3163f17eddb74ee1e028d542255f21a", "html_url": "https://github.com/rust-lang/rust/commit/663d2f5cd3163f17eddb74ee1e028d542255f21a"}], "stats": {"total": 51, "additions": 39, "deletions": 12}, "files": [{"sha": "d392967af385627ddf9ffe32c0f563a203d505fc", "filename": "src/librustc_resolve/late/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Flibrustc_resolve%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Flibrustc_resolve%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flate%2Fdiagnostics.rs?ref=35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "patch": "@@ -1222,6 +1222,9 @@ impl<'tcx> LifetimeContext<'_, 'tcx> {\n                                 synthetic: Some(hir::SyntheticTyParamKind::ImplTrait),\n                                 ..\n                             } => false,\n+                            hir::GenericParamKind::Lifetime {\n+                                kind: hir::LifetimeParamKind::Elided,\n+                            } => false,\n                             _ => true,\n                         }) {\n                         (param.span.shrink_to_lo(), format!(\"{}, \", lifetime_ref))"}, {"sha": "b8f50a40c45237cdd552f134d68e0b9871e0ad68", "filename": "src/test/ui/regions/regions-name-undeclared.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.rs?ref=35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "patch": "@@ -1,3 +1,4 @@\n+// edition:2018\n // Check that lifetime resolver enforces the lifetime name scoping\n // rules correctly in various scenarios.\n \n@@ -47,4 +48,11 @@ fn fn_types(a: &'a isize, //~ ERROR undeclared lifetime\n {\n }\n \n+struct Bug {}\n+impl Bug {\n+    async fn buggy(&self) -> &'a str { //~ ERROR use of undeclared lifetime name `'a`\n+        todo!()\n+    }\n+}\n+\n pub fn main() {}"}, {"sha": "ad0e7bd5afbc0ec46d9193a20164e8c9bdd4fd80", "filename": "src/test/ui/regions/regions-name-undeclared.stderr", "status": "modified", "additions": 28, "deletions": 12, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/35e166e5d28b211c4b69fe9ae7c0aa970e71e321/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fregions-name-undeclared.stderr?ref=35e166e5d28b211c4b69fe9ae7c0aa970e71e321", "patch": "@@ -1,5 +1,5 @@\n error[E0261]: use of undeclared lifetime name `'b`\n-  --> $DIR/regions-name-undeclared.rs:15:24\n+  --> $DIR/regions-name-undeclared.rs:16:24\n    |\n LL |     fn m4(&self, arg: &'b isize) { }\n    |                        ^^ undeclared lifetime\n@@ -15,7 +15,7 @@ LL |     fn m4<'b>(&self, arg: &'b isize) { }\n    |          ^^^^\n \n error[E0261]: use of undeclared lifetime name `'b`\n-  --> $DIR/regions-name-undeclared.rs:16:12\n+  --> $DIR/regions-name-undeclared.rs:17:12\n    |\n LL |     fn m5(&'b self) { }\n    |            ^^ undeclared lifetime\n@@ -31,7 +31,7 @@ LL |     fn m5<'b>(&'b self) { }\n    |          ^^^^\n \n error[E0261]: use of undeclared lifetime name `'b`\n-  --> $DIR/regions-name-undeclared.rs:17:27\n+  --> $DIR/regions-name-undeclared.rs:18:27\n    |\n LL |     fn m6(&self, arg: Foo<'b>) { }\n    |                           ^^ undeclared lifetime\n@@ -47,7 +47,7 @@ LL |     fn m6<'b>(&self, arg: Foo<'b>) { }\n    |          ^^^^\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:25:22\n+  --> $DIR/regions-name-undeclared.rs:26:22\n    |\n LL |     type X = Option<&'a isize>;\n    |           -          ^^ undeclared lifetime\n@@ -57,7 +57,7 @@ LL |     type X = Option<&'a isize>;\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:27:13\n+  --> $DIR/regions-name-undeclared.rs:28:13\n    |\n LL |     enum E {\n    |           - help: consider introducing lifetime `'a` here: `<'a>`\n@@ -67,7 +67,7 @@ LL |         E1(&'a isize)\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:30:13\n+  --> $DIR/regions-name-undeclared.rs:31:13\n    |\n LL |     struct S {\n    |             - help: consider introducing lifetime `'a` here: `<'a>`\n@@ -77,7 +77,7 @@ LL |         f: &'a isize\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:32:14\n+  --> $DIR/regions-name-undeclared.rs:33:14\n    |\n LL |     fn f(a: &'a isize) { }\n    |         -    ^^ undeclared lifetime\n@@ -87,7 +87,7 @@ LL |     fn f(a: &'a isize) { }\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:40:17\n+  --> $DIR/regions-name-undeclared.rs:41:17\n    |\n LL | fn fn_types(a: &'a isize,\n    |            -    ^^ undeclared lifetime\n@@ -97,7 +97,7 @@ LL | fn fn_types(a: &'a isize,\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n error[E0261]: use of undeclared lifetime name `'b`\n-  --> $DIR/regions-name-undeclared.rs:42:36\n+  --> $DIR/regions-name-undeclared.rs:43:36\n    |\n LL | ...                   &'b isize,\n    |                        ^^ undeclared lifetime\n@@ -114,7 +114,7 @@ LL |             b: Box<dyn for<'a, 'b> FnOnce(&'a isize,\n    |                              ^^^^\n \n error[E0261]: use of undeclared lifetime name `'b`\n-  --> $DIR/regions-name-undeclared.rs:45:36\n+  --> $DIR/regions-name-undeclared.rs:46:36\n    |\n LL | ...                   &'b isize)>,\n    |                        ^^ undeclared lifetime\n@@ -131,7 +131,7 @@ LL |             b: Box<dyn for<'a, 'b> FnOnce(&'a isize,\n    |                              ^^^^\n \n error[E0261]: use of undeclared lifetime name `'a`\n-  --> $DIR/regions-name-undeclared.rs:46:17\n+  --> $DIR/regions-name-undeclared.rs:47:17\n    |\n LL | fn fn_types(a: &'a isize,\n    |            - help: consider introducing lifetime `'a` here: `<'a>`\n@@ -141,6 +141,22 @@ LL |             c: &'a isize)\n    |\n    = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n \n-error: aborting due to 11 previous errors\n+error[E0261]: use of undeclared lifetime name `'a`\n+  --> $DIR/regions-name-undeclared.rs:53:31\n+   |\n+LL |     async fn buggy(&self) -> &'a str {\n+   |                               ^^ undeclared lifetime\n+   |\n+   = help: if you want to experiment with in-band lifetime bindings, add `#![feature(in_band_lifetimes)]` to the crate attributes\n+help: consider introducing lifetime `'a` here\n+   |\n+LL | impl<'a> Bug {\n+   |     ^^^^\n+help: consider introducing lifetime `'a` here\n+   |\n+LL |     async fn buggy<'a>(&self) -> &'a str {\n+   |                   ^^^^\n+\n+error: aborting due to 12 previous errors\n \n For more information about this error, try `rustc --explain E0261`."}]}