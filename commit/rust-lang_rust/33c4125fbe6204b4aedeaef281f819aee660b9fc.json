{"sha": "33c4125fbe6204b4aedeaef281f819aee660b9fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzYzQxMjVmYmU2MjA0YjRhZWRlYWVmMjgxZjgxOWFlZTY2MGI5ZmM=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-09-10T17:13:07Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-10-07T20:20:17Z"}, "message": "Rebase rustc-rayon on rayon-1.2\n\nSee also https://github.com/rust-lang/rustc-rayon/pull/3", "tree": {"sha": "397b85390654a7a2b281ad27ca49cf9a42e823b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/397b85390654a7a2b281ad27ca49cf9a42e823b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/33c4125fbe6204b4aedeaef281f819aee660b9fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/33c4125fbe6204b4aedeaef281f819aee660b9fc", "html_url": "https://github.com/rust-lang/rust/commit/33c4125fbe6204b4aedeaef281f819aee660b9fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/33c4125fbe6204b4aedeaef281f819aee660b9fc/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59a31c8c676bdc9f50490d5798b1b4e884b7d7ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/59a31c8c676bdc9f50490d5798b1b4e884b7d7ae", "html_url": "https://github.com/rust-lang/rust/commit/59a31c8c676bdc9f50490d5798b1b4e884b7d7ae"}], "stats": {"total": 72, "additions": 53, "deletions": 19}, "files": [{"sha": "35fb4187ab60d1839a1dfb2bd09fec8eb2a451dd", "filename": "Cargo.lock", "status": "modified", "additions": 43, "deletions": 9, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -659,6 +659,16 @@ dependencies = [\n  \"crossbeam-utils 0.6.5\",\n ]\n \n+[[package]]\n+name = \"crossbeam-deque\"\n+version = \"0.7.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"b18cd2e169ad86297e6bc0ad9aa679aee9daa4f19e8163860faf7c164e4f5a71\"\n+dependencies = [\n+ \"crossbeam-epoch 0.7.2\",\n+ \"crossbeam-utils 0.6.5\",\n+]\n+\n [[package]]\n name = \"crossbeam-epoch\"\n version = \"0.3.1\"\n@@ -3074,8 +3084,8 @@ dependencies = [\n  \"num_cpus\",\n  \"parking_lot 0.9.0\",\n  \"polonius-engine\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.3.0\",\n+ \"rustc-rayon-core 0.3.0\",\n  \"rustc_apfloat\",\n  \"rustc_data_structures\",\n  \"rustc_errors\",\n@@ -3123,8 +3133,8 @@ dependencies = [\n  \"rustc-ap-graphviz\",\n  \"rustc-ap-serialize\",\n  \"rustc-hash\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.2.0\",\n+ \"rustc-rayon-core 0.2.0\",\n  \"smallvec\",\n  \"stable_deref_trait\",\n ]\n@@ -3263,7 +3273,18 @@ checksum = \"0d2e07e19601f21c59aad953c2632172ba70cb27e685771514ea66e4062b3363\"\n dependencies = [\n  \"crossbeam-deque 0.2.0\",\n  \"either\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon-core 0.2.0\",\n+]\n+\n+[[package]]\n+name = \"rustc-rayon\"\n+version = \"0.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f32767f90d938f1b7199a174ef249ae1924f6e5bbdb9d112fea141e016f25b3a\"\n+dependencies = [\n+ \"crossbeam-deque 0.7.1\",\n+ \"either\",\n+ \"rustc-rayon-core 0.3.0\",\n ]\n \n [[package]]\n@@ -3278,6 +3299,19 @@ dependencies = [\n  \"num_cpus\",\n ]\n \n+[[package]]\n+name = \"rustc-rayon-core\"\n+version = \"0.3.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ea2427831f0053ea3ea73559c8eabd893133a51b251d142bacee53c62a288cb3\"\n+dependencies = [\n+ \"crossbeam-deque 0.7.1\",\n+ \"crossbeam-queue\",\n+ \"crossbeam-utils 0.6.5\",\n+ \"lazy_static 1.3.0\",\n+ \"num_cpus\",\n+]\n+\n [[package]]\n name = \"rustc-serialize\"\n version = \"0.3.24\"\n@@ -3398,8 +3432,8 @@ dependencies = [\n  \"log\",\n  \"parking_lot 0.9.0\",\n  \"rustc-hash\",\n- \"rustc-rayon\",\n- \"rustc-rayon-core\",\n+ \"rustc-rayon 0.3.0\",\n+ \"rustc-rayon-core 0.3.0\",\n  \"rustc_index\",\n  \"serialize\",\n  \"smallvec\",\n@@ -3479,7 +3513,7 @@ dependencies = [\n  \"log\",\n  \"once_cell\",\n  \"rustc\",\n- \"rustc-rayon\",\n+ \"rustc-rayon 0.3.0\",\n  \"rustc_codegen_ssa\",\n  \"rustc_codegen_utils\",\n  \"rustc_data_structures\",\n@@ -3758,7 +3792,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"minifier\",\n  \"pulldown-cmark 0.5.3\",\n- \"rustc-rayon\",\n+ \"rustc-rayon 0.3.0\",\n  \"tempfile\",\n ]\n "}, {"sha": "9b3609eca3e621be41054851cd692a9bf2d87ebd", "filename": "src/librustc/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2FCargo.toml?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -18,8 +18,8 @@ jobserver = \"0.1\"\n num_cpus = \"1.0\"\n scoped-tls = \"1.0\"\n log = { version = \"0.4\", features = [\"release_max_level_info\", \"std\"] }\n-rustc-rayon = \"0.2.0\"\n-rustc-rayon-core = \"0.2.0\"\n+rustc-rayon = \"0.3.0\"\n+rustc-rayon-core = \"0.3.0\"\n polonius-engine  = \"0.10.0\"\n rustc_apfloat = { path = \"../librustc_apfloat\" }\n rustc_target = { path = \"../librustc_target\" }"}, {"sha": "065c8436ae06aa54fc5c19e9e727e94cf7873177", "filename": "src/librustc_data_structures/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2FCargo.toml?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -20,8 +20,8 @@ graphviz = { path = \"../libgraphviz\" }\n cfg-if = \"0.1.2\"\n crossbeam-utils = { version = \"0.6.5\", features = [\"nightly\"] }\n stable_deref_trait = \"1.0.0\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n-rayon-core = { version = \"0.2.0\", package = \"rustc-rayon-core\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n+rayon-core = { version = \"0.3.0\", package = \"rustc-rayon-core\" }\n rustc-hash = \"1.0.1\"\n smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }\n rustc_index = { path = \"../librustc_index\", package = \"rustc_index\" }"}, {"sha": "bed5febb72ede4421f20f27f589da22fdb0ed39a", "filename": "src/librustc_interface/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_interface%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_interface%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2FCargo.toml?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -11,7 +11,7 @@ doctest = false\n \n [dependencies]\n log = \"0.4\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n smallvec = { version = \"0.6.7\", features = [\"union\", \"may_dangle\"] }\n syntax = { path = \"../libsyntax\" }\n syntax_ext = { path = \"../libsyntax_ext\" }"}, {"sha": "35c325c1aa4576b16b6438667cb7da7442989a5f", "filename": "src/librustc_interface/util.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_interface%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustc_interface%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Futil.rs?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -202,7 +202,7 @@ pub fn spawn_thread_pool<F: FnOnce() -> R + Send, R: Send>(\n     stderr: &Option<Arc<Mutex<Vec<u8>>>>,\n     f: F,\n ) -> R {\n-    use rayon::{ThreadPool, ThreadPoolBuilder};\n+    use rayon::{ThreadBuilder, ThreadPool, ThreadPoolBuilder};\n \n     let gcx_ptr = &Lock::new(0);\n \n@@ -225,20 +225,20 @@ pub fn spawn_thread_pool<F: FnOnce() -> R + Send, R: Send>(\n                 // the thread local rustc uses. syntax_globals and syntax_pos_globals are\n                 // captured and set on the new threads. ty::tls::with_thread_locals sets up\n                 // thread local callbacks from libsyntax\n-                let main_handler = move |worker: &mut dyn FnMut()| {\n+                let main_handler = move |thread: ThreadBuilder| {\n                     syntax::GLOBALS.set(syntax_globals, || {\n                         syntax_pos::GLOBALS.set(syntax_pos_globals, || {\n                             if let Some(stderr) = stderr {\n                                 io::set_panic(Some(box Sink(stderr.clone())));\n                             }\n                             ty::tls::with_thread_locals(|| {\n-                                ty::tls::GCX_PTR.set(gcx_ptr, || worker())\n+                                ty::tls::GCX_PTR.set(gcx_ptr, || thread.run())\n                             })\n                         })\n                     })\n                 };\n \n-                ThreadPool::scoped_pool(config, main_handler, with_pool).unwrap()\n+                config.build_scoped(main_handler, with_pool).unwrap()\n             })\n         })\n     })"}, {"sha": "e3de7fe20493e8353dbb0f729ab2390a58d47f37", "filename": "src/librustdoc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustdoc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/33c4125fbe6204b4aedeaef281f819aee660b9fc/src%2Flibrustdoc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2FCargo.toml?ref=33c4125fbe6204b4aedeaef281f819aee660b9fc", "patch": "@@ -11,5 +11,5 @@ path = \"lib.rs\"\n [dependencies]\n pulldown-cmark = { version = \"0.5.3\", default-features = false }\n minifier = \"0.0.33\"\n-rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n+rayon = { version = \"0.3.0\", package = \"rustc-rayon\" }\n tempfile = \"3\""}]}