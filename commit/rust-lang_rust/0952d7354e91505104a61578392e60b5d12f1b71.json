{"sha": "0952d7354e91505104a61578392e60b5d12f1b71", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5NTJkNzM1NGU5MTUwNTEwNGE2MTU3ODM5MmU2MGI1ZDEyZjFiNzE=", "commit": {"author": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2015-09-20T15:42:23Z"}, "committer": {"name": "Marcus Klaas de Vries", "email": "mail@marcusklaas.nl", "date": "2015-09-20T15:42:23Z"}, "message": "Merge pull request #335 from Kha/struct-lit-base\n\nFix negative overflow and missing '..' on struct lit base exprs", "tree": {"sha": "79991b6ccaf86058185167604c77365c7c526394", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79991b6ccaf86058185167604c77365c7c526394"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0952d7354e91505104a61578392e60b5d12f1b71", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0952d7354e91505104a61578392e60b5d12f1b71", "html_url": "https://github.com/rust-lang/rust/commit/0952d7354e91505104a61578392e60b5d12f1b71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0952d7354e91505104a61578392e60b5d12f1b71/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce2c4f6be61305c8bb487e0f7cae760f5918fe07", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce2c4f6be61305c8bb487e0f7cae760f5918fe07", "html_url": "https://github.com/rust-lang/rust/commit/ce2c4f6be61305c8bb487e0f7cae760f5918fe07"}, {"sha": "9bd502ad54a1ccea30d79e1cf5667fa9705fc221", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bd502ad54a1ccea30d79e1cf5667fa9705fc221", "html_url": "https://github.com/rust-lang/rust/commit/9bd502ad54a1ccea30d79e1cf5667fa9705fc221"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "155553a7615744a2e931a0e7f4d017788ec07c58", "filename": "src/expr.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0952d7354e91505104a61578392e60b5d12f1b71/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0952d7354e91505104a61578392e60b5d12f1b71/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=0952d7354e91505104a61578392e60b5d12f1b71", "patch": "@@ -1108,9 +1108,14 @@ fn rewrite_struct_lit<'a>(context: &RewriteContext,\n                                      }\n                                      StructLitField::Base(ref expr) => {\n                                          // 2 = ..\n-                                         expr.rewrite(inner_context, h_budget - 2, indent + 2)\n-                                             .map(|s| format!(\"..{}\", s))\n-                                             .unwrap_or(context.snippet(expr.span))\n+                                         format!(\"..{}\",\n+                                                 h_budget.checked_sub(2)\n+                                                         .and_then(|h_budget| {\n+                                                             expr.rewrite(inner_context,\n+                                                                          h_budget,\n+                                                                          indent + 2)\n+                                                         })\n+                                                         .unwrap_or(context.snippet(expr.span)))\n                                      }\n                                  }\n                              },"}, {"sha": "4b5e262bd26dfc68881e4cf867a02cd9454f712e", "filename": "tests/source/expr.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0952d7354e91505104a61578392e60b5d12f1b71/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0952d7354e91505104a61578392e60b5d12f1b71/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=0952d7354e91505104a61578392e60b5d12f1b71", "patch": "@@ -173,3 +173,11 @@ fn arrays() {\n \n     [ 1 +   3, 4 ,  5, 6, 7, 7, fncall::<Vec<_>>(3-1)]\n }\n+\n+fn struct_exprs() {\n+    Foo\n+    { a :  1, b:f( 2)};\n+    Foo{a:1,b:f(2),..g(3)};\n+    // FIXME: should be wrapped (#231)\n+    LoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooongStruct { ..base };\n+}"}, {"sha": "7b579960d5368106fbf56924020a24489b7c9f94", "filename": "tests/target/expr.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0952d7354e91505104a61578392e60b5d12f1b71/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0952d7354e91505104a61578392e60b5d12f1b71/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=0952d7354e91505104a61578392e60b5d12f1b71", "patch": "@@ -183,3 +183,10 @@ fn arrays() {\n \n     [1 + 3, 4, 5, 6, 7, 7, fncall::<Vec<_>>(3 - 1)]\n }\n+\n+fn struct_exprs() {\n+    Foo { a: 1, b: f(2) };\n+    Foo { a: 1, b: f(2), ..g(3) };\n+    // FIXME: should be wrapped (#231)\n+    LoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooongStruct { ..base };\n+}"}]}