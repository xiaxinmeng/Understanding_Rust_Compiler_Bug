{"sha": "46412876287e2f6ad2c7058c42ddc2cd6299483f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2NDEyODc2Mjg3ZTJmNmFkMmM3MDU4YzQyZGRjMmNkNjI5OTQ4M2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-05T05:31:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-05T05:31:51Z"}, "message": "auto merge of #11314 : adridu59/rust/patch-license, r=brson\n\n- don't check for an hardcoded copyright claim year, check the 2 surrounding strings instead\r\n- logic: if either the `//` or `#`-style copyright patterns are found, don't invalidate\r\n- cleanup hardcoded content and streamline the few files with different line breaks\r\n\r\nr? @brson", "tree": {"sha": "2507bc477a6e857a5aa252b0c1b203f9a8d2db52", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2507bc477a6e857a5aa252b0c1b203f9a8d2db52"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46412876287e2f6ad2c7058c42ddc2cd6299483f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46412876287e2f6ad2c7058c42ddc2cd6299483f", "html_url": "https://github.com/rust-lang/rust/commit/46412876287e2f6ad2c7058c42ddc2cd6299483f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46412876287e2f6ad2c7058c42ddc2cd6299483f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf9a9afc7ca086f7ef2fafa7eb791c2ca92e0ddf", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf9a9afc7ca086f7ef2fafa7eb791c2ca92e0ddf", "html_url": "https://github.com/rust-lang/rust/commit/bf9a9afc7ca086f7ef2fafa7eb791c2ca92e0ddf"}, {"sha": "24f9a93872eb572bbe1574669c40c9b003e8c473", "url": "https://api.github.com/repos/rust-lang/rust/commits/24f9a93872eb572bbe1574669c40c9b003e8c473", "html_url": "https://github.com/rust-lang/rust/commit/24f9a93872eb572bbe1574669c40c9b003e8c473"}], "stats": {"total": 79, "additions": 20, "deletions": 59}, "files": [{"sha": "b76238ca388bb8ef09c1f25d35d8c5ecdce58b0b", "filename": "src/compiletest/common.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fcommon.rs?ref=46412876287e2f6ad2c7058c42ddc2cd6299483f", "patch": "@@ -1,5 +1,5 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the\n-// COPYRIGHT file at the top-level directory of this distribution and at\n+// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n // Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or"}, {"sha": "d4a4f38cc63baca38560f6e610058c5e739374ff", "filename": "src/compiletest/header.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fheader.rs?ref=46412876287e2f6ad2c7058c42ddc2cd6299483f", "patch": "@@ -1,5 +1,5 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the\n-// COPYRIGHT file at the top-level directory of this distribution and at\n+// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n // Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or"}, {"sha": "6136c39bb7390d1faac457d0cd98d9e364fd1334", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=46412876287e2f6ad2c7058c42ddc2cd6299483f", "patch": "@@ -1,5 +1,5 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the\n-// COPYRIGHT file at the top-level directory of this distribution and at\n+// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n // Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or"}, {"sha": "b5a721c03ff099149bf22a51c12bb1767f9951d6", "filename": "src/etc/licenseck.py", "status": "modified", "additions": 12, "deletions": 51, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fetc%2Flicenseck.py", "raw_url": "https://github.com/rust-lang/rust/raw/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Fetc%2Flicenseck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Flicenseck.py?ref=46412876287e2f6ad2c7058c42ddc2cd6299483f", "patch": "@@ -8,20 +8,8 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n-license0 = \"\"\"\\\n-// Copyright 2012-2013 The Rust Project Developers. See the\n-// COPYRIGHT file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\"\"\"\n-\n-license1 = \"\"\"\\\n-// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+license1 = \"\"\"// Copyright \"\"\"\n+license2 = \"\"\" The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -32,20 +20,8 @@\n // except according to those terms.\n \"\"\"\n \n-license2 = \"\"\"\\\n-// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\"\"\"\n-\n-license3 = \"\"\"\\\n-# Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+license3 = \"\"\"# Copyright \"\"\"\n+license4 = \"\"\" The Rust Project Developers. See the COPYRIGHT\n # file at the top-level directory of this distribution and at\n # http://rust-lang.org/COPYRIGHT.\n #\n@@ -56,20 +32,6 @@\n # except according to those terms.\n \"\"\"\n \n-license4 = \"\"\"\\\n-// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\"\"\"\n-\n-licenses = [license0, license1, license2, license3, license4]\n-\n exceptions = [\n     \"rt/rust_android_dummy.cpp\", # BSD, chromium\n     \"rt/rust_android_dummy.h\", # BSD, chromium\n@@ -82,20 +44,19 @@\n ]\n \n def check_license(name, contents):\n-    valid_license = False\n-    for a_valid_license in licenses:\n-        if contents.startswith(a_valid_license):\n-            valid_license = True\n-            break\n-    if valid_license:\n-        return True\n-\n+    # Whitelist check\n     for exception in exceptions:\n         if name.endswith(exception):\n             return True\n \n+    # Xfail check\n     firstlineish = contents[:100]\n     if firstlineish.find(\"xfail-license\") != -1:\n         return True\n \n-    return False\n+    # License check\n+    boilerplate = contents[:500]\n+    if (boilerplate.find(license1) == -1 or boilerplate.find(license2) == -1) and \\\n+       (boilerplate.find(license3) == -1 or boilerplate.find(license4) == -1):\n+        return False\n+    return True\n\\ No newline at end of file"}, {"sha": "57da01ccad0fe8c42c6f3647917ddf1c14a50853", "filename": "src/libsyntax/ext/source_util.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Flibsyntax%2Fext%2Fsource_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46412876287e2f6ad2c7058c42ddc2cd6299483f/src%2Flibsyntax%2Fext%2Fsource_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fsource_util.rs?ref=46412876287e2f6ad2c7058c42ddc2cd6299483f", "patch": "@@ -1,5 +1,5 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the\n-// COPYRIGHT file at the top-level directory of this distribution and at\n+// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n // Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or"}]}