{"sha": "41212792c605ee4dcc50031cb187b39f9f0f56fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxMjEyNzkyYzYwNWVlNGRjYzUwMDMxY2IxODdiMzlmOWYwZjU2ZmM=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-07-20T03:15:27Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-07-20T03:16:03Z"}, "message": "Add missing case in tyencode for ty_constr\n\nFixes the Windoze breakage, I hope.", "tree": {"sha": "8b4edc3a60fd560eab945f9658e640a90df073de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b4edc3a60fd560eab945f9658e640a90df073de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41212792c605ee4dcc50031cb187b39f9f0f56fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41212792c605ee4dcc50031cb187b39f9f0f56fc", "html_url": "https://github.com/rust-lang/rust/commit/41212792c605ee4dcc50031cb187b39f9f0f56fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41212792c605ee4dcc50031cb187b39f9f0f56fc/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a2a8b6b1746241c8781b89c5974d6fcb0148774", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a2a8b6b1746241c8781b89c5974d6fcb0148774", "html_url": "https://github.com/rust-lang/rust/commit/1a2a8b6b1746241c8781b89c5974d6fcb0148774"}], "stats": {"total": 66, "additions": 66, "deletions": 0}, "files": [{"sha": "4992dc8871a8fb65a0b3b7ea2e285369ed70be81", "filename": "src/comp/metadata/tydecode.rs", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmetadata%2Ftydecode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmetadata%2Ftydecode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Ftydecode.rs?ref=41212792c605ee4dcc50031cb187b39f9f0f56fc", "patch": "@@ -82,6 +82,23 @@ fn parse_constrs(@pstate st, str_def sd) -> (@ty::constr)[] {\n     ret rslt;\n }\n \n+// FIXME less copy-and-paste\n+fn parse_ty_constrs(@pstate st, str_def sd) -> (@ty::type_constr)[] {\n+    let (@ty::type_constr)[] rslt = ~[];\n+    alt (peek(st) as char) {\n+        case (':') {\n+            do {\n+                next(st);\n+                let @ty::type_constr one = parse_constr[path](st, sd,\n+                                                  parse_ty_constr_arg);\n+                rslt += ~[one];\n+            } while (peek(st) as char == ';')\n+        }\n+        case (_) { }\n+    }\n+    ret rslt;\n+}\n+\n fn parse_path(@pstate st, str_def sd) -> ast::path {\n     let ast::ident[] idents = ~[];\n     fn is_last(char c) -> bool {\n@@ -136,6 +153,19 @@ fn parse_constr_arg(@pstate st, str_def sd) -> ast::fn_constr_arg {\n     }\n }\n \n+fn parse_ty_constr_arg(@pstate st, str_def sd)\n+    -> ast::constr_arg_general_[path] {\n+     alt (peek(st) as char) {\n+      case ('*') {\n+        st.pos += 1u;\n+        ret ast::carg_base;\n+      }\n+      case (?c) {\n+          ret ast::carg_ident(parse_path(st, sd));\n+      }\n+    }\n+}\n+\n fn parse_constr[T](@pstate st, str_def sd, arg_parser[T] pser)\n     -> @ty::constr_general[T] {\n     auto sp = rec(lo=0u,hi=0u); // FIXME: use a real span\n@@ -294,6 +324,13 @@ fn parse_ty(@pstate st, str_def sd) -> ty::t {\n                 }\n             }\n         }\n+        case ('A') {\n+            assert (next(st) as char == '[');\n+            auto tt = parse_ty(st, sd);\n+            auto tcs = parse_ty_constrs(st, sd);\n+            assert (next(st) as char == ']');\n+            ret ty::mk_constr(st.tcx, tt, tcs);\n+        }\n         case (?c) {\n             log_err \"unexpected char in type string: \";\n             log_err c;"}, {"sha": "873ec5c549f57204a3f966a8382ba4fe523f2eca", "filename": "src/comp/metadata/tyencode.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmetadata%2Ftyencode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmetadata%2Ftyencode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Ftyencode.rs?ref=41212792c605ee4dcc50031cb187b39f9f0f56fc", "patch": "@@ -191,6 +191,14 @@ fn enc_sty(&ioivec::writer w, &@ctxt cx, &ty::sty st) {\n         }\n         case (ty::ty_type) { w.write_char('Y'); }\n         case (ty::ty_task) { w.write_char('a'); }\n+        case (ty::ty_constr(?ty, ?cs)) {\n+            w.write_str(\"A[\");\n+            enc_ty(w, cx, ty);\n+            for (@ty::type_constr tc in cs) {\n+                enc_ty_constr(w, cx, tc);\n+            }\n+            w.write_char(']');\n+        }\n     }\n }\n fn enc_proto(&ioivec::writer w, proto proto) {\n@@ -229,6 +237,7 @@ fn enc_ty_fn(&ioivec::writer w, &@ctxt cx, &ty::arg[] args, &ty::t out,\n \n }\n \n+// FIXME less copy-and-paste\n fn enc_constr(&ioivec::writer w, &@ctxt cx, &@ty::constr c) {\n     w.write_str(path_to_str(c.node.path));\n     w.write_char('(');\n@@ -248,6 +257,25 @@ fn enc_constr(&ioivec::writer w, &@ctxt cx, &@ty::constr c) {\n     w.write_char(')');\n }\n \n+fn enc_ty_constr(&ioivec::writer w, &@ctxt cx, &@ty::type_constr c) {\n+    w.write_str(path_to_str(c.node.path));\n+    w.write_char('(');\n+    w.write_str(cx.ds(c.node.id));\n+    w.write_char('|');\n+    auto semi = false;\n+    for (@ty::ty_constr_arg a in c.node.args) {\n+        if (semi) { w.write_char(';'); } else { semi = true; }\n+        alt (a.node) {\n+            case (carg_base) { w.write_char('*'); }\n+            case (carg_ident(?p)) {\n+                w.write_str(path_to_str(p));\n+            }\n+            case (carg_lit(?l)) { w.write_str(lit_to_str(l)); }\n+        }\n+    }\n+    w.write_char(')');\n+}\n+\n \n //\n // Local Variables:"}, {"sha": "4717bd56efe8913c402b0ef7541c3618305ac249", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41212792c605ee4dcc50031cb187b39f9f0f56fc/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=41212792c605ee4dcc50031cb187b39f9f0f56fc", "patch": "@@ -122,6 +122,7 @@ export ty_box;\n export ty_chan;\n export ty_char;\n export ty_constr;\n+export ty_constr_arg;\n export ty_float;\n export ty_fn;\n export ty_fn_abi;"}]}