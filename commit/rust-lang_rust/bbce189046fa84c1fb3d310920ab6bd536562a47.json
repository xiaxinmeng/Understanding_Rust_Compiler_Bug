{"sha": "bbce189046fa84c1fb3d310920ab6bd536562a47", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiY2UxODkwNDZmYTg0YzFmYjNkMzEwOTIwYWI2YmQ1MzY1NjJhNDc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-12-16T20:11:19Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-12-16T21:21:23Z"}, "message": "rustc: Update Clang used to build LLVM on LInux\n\nThis commit updates from LLVM 7.0.0 to git revisions of clang/llvm/lld\nto build LLVM on our dist builders for Linux. The goal of this is to\nfix #56849 by picking up a fix [1] in LLD.\n\nCloses #56849\n\n[1]: https://github.com/llvm-mirror/lld/commit/3be4e82db78b46a8ca349b2b799dec620a6f159f", "tree": {"sha": "05e3a124bd67550c354fed8910c5536d3df23045", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05e3a124bd67550c354fed8910c5536d3df23045"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bbce189046fa84c1fb3d310920ab6bd536562a47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bbce189046fa84c1fb3d310920ab6bd536562a47", "html_url": "https://github.com/rust-lang/rust/commit/bbce189046fa84c1fb3d310920ab6bd536562a47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bbce189046fa84c1fb3d310920ab6bd536562a47/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c811915eafb349759d2bba9d7a39a53aef02bb3d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c811915eafb349759d2bba9d7a39a53aef02bb3d", "html_url": "https://github.com/rust-lang/rust/commit/c811915eafb349759d2bba9d7a39a53aef02bb3d"}], "stats": {"total": 31, "additions": 14, "deletions": 17}, "files": [{"sha": "a7a8719b5357ea4191a2a8fbe7f092832193f23c", "filename": "src/ci/docker/dist-x86_64-linux/build-clang.sh", "status": "modified", "additions": 14, "deletions": 17, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/bbce189046fa84c1fb3d310920ab6bd536562a47/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/bbce189046fa84c1fb3d310920ab6bd536562a47/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-clang.sh?ref=bbce189046fa84c1fb3d310920ab6bd536562a47", "patch": "@@ -13,31 +13,28 @@ set -ex\n \n source shared.sh\n \n-LLVM=7.0.0\n+# Currently these commits are all tip-of-tree as of 2018-12-16, used to pick up\n+# a fix for rust-lang/rust#56849\n+LLVM=032b00a5404865765cda7db3039f39d54964d8b0\n+LLD=3e4aa4e8671523321af51449e0569f455ef3ad43\n+CLANG=a6b9739069763243020f4ea6fe586bc135fde1f9\n \n mkdir clang\n cd clang\n \n-curl https://releases.llvm.org/$LLVM/llvm-$LLVM.src.tar.xz | \\\n-  xz -d | \\\n-  tar xf -\n-\n-cd llvm-$LLVM.src\n+curl -L https://github.com/llvm-mirror/llvm/archive/$LLVM.tar.gz | \\\n+  tar xzf - --strip-components=1\n \n mkdir -p tools/clang\n-\n-curl https://releases.llvm.org/$LLVM/cfe-$LLVM.src.tar.xz | \\\n-  xz -d | \\\n-  tar xf - -C tools/clang --strip-components=1\n+curl -L https://github.com/llvm-mirror/clang/archive/$CLANG.tar.gz | \\\n+  tar xzf - --strip-components=1 -C tools/clang\n \n mkdir -p tools/lld\n+curl -L https://github.com/llvm-mirror/lld/archive/$LLD.tar.gz | \\\n+  tar zxf - --strip-components=1 -C tools/lld\n \n-curl https://releases.llvm.org/$LLVM/lld-$LLVM.src.tar.xz | \\\n-  xz -d | \\\n-  tar xf - -C tools/lld --strip-components=1\n-\n-mkdir ../clang-build\n-cd ../clang-build\n+mkdir clang-build\n+cd clang-build\n \n # For whatever reason the default set of include paths for clang is different\n # than that of gcc. As a result we need to manually include our sysroot's\n@@ -55,7 +52,7 @@ INC=\"$INC:/rustroot/lib/gcc/x86_64-unknown-linux-gnu/4.8.5/include-fixed\"\n INC=\"$INC:/usr/include\"\n \n hide_output \\\n-    cmake ../llvm-$LLVM.src \\\n+    cmake .. \\\n       -DCMAKE_C_COMPILER=/rustroot/bin/gcc \\\n       -DCMAKE_CXX_COMPILER=/rustroot/bin/g++ \\\n       -DCMAKE_BUILD_TYPE=Release \\"}]}