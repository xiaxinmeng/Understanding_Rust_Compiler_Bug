{"sha": "9eac7bdd098d4d55e7322056e040dd3cca40ba67", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllYWM3YmRkMDk4ZDRkNTVlNzMyMjA1NmUwNDBkZDNjY2E0MGJhNjc=", "commit": {"author": {"name": "Jonathan Turner", "email": "jonathandturner@users.noreply.github.com", "date": "2016-09-16T16:29:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-16T16:29:48Z"}, "message": "Rollup merge of #36383 - GuillaumeGomez:e0049, r=jonathandturner\n\nUpdate E0049 to new error format\n\nFixes #35210.\nPart of #35233.\n\nr? @jonathandturner", "tree": {"sha": "bf8ddccdb6a0b2a702d9f4931633e439b64068b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf8ddccdb6a0b2a702d9f4931633e439b64068b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9eac7bdd098d4d55e7322056e040dd3cca40ba67", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9eac7bdd098d4d55e7322056e040dd3cca40ba67", "html_url": "https://github.com/rust-lang/rust/commit/9eac7bdd098d4d55e7322056e040dd3cca40ba67", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9eac7bdd098d4d55e7322056e040dd3cca40ba67/comments", "author": {"login": "jonathandturner", "id": 111457284, "node_id": "O_kgDOBqS0BA", "avatar_url": "https://avatars.githubusercontent.com/u/111457284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathandturner", "html_url": "https://github.com/jonathandturner", "followers_url": "https://api.github.com/users/jonathandturner/followers", "following_url": "https://api.github.com/users/jonathandturner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathandturner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathandturner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathandturner/subscriptions", "organizations_url": "https://api.github.com/users/jonathandturner/orgs", "repos_url": "https://api.github.com/users/jonathandturner/repos", "events_url": "https://api.github.com/users/jonathandturner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathandturner/received_events", "type": "Organization", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8394685b8385156fc4bc31cfbc693867e276d9d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/8394685b8385156fc4bc31cfbc693867e276d9d7", "html_url": "https://github.com/rust-lang/rust/commit/8394685b8385156fc4bc31cfbc693867e276d9d7"}, {"sha": "35584629f4f8ad1eb32c4363fb9b5437e1052e5e", "url": "https://api.github.com/repos/rust-lang/rust/commits/35584629f4f8ad1eb32c4363fb9b5437e1052e5e", "html_url": "https://github.com/rust-lang/rust/commit/35584629f4f8ad1eb32c4363fb9b5437e1052e5e"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "faad3f9b000cc0a08b40a7c27770dc895c865d91", "filename": "src/librustc_typeck/check/compare_method.rs", "status": "modified", "additions": 32, "deletions": 3, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs?ref=9eac7bdd098d4d55e7322056e040dd3cca40ba67", "patch": "@@ -38,7 +38,8 @@ pub fn compare_impl_method<'a, 'tcx>(ccx: &CrateCtxt<'a, 'tcx>,\n                                      impl_m_span: Span,\n                                      impl_m_body_id: ast::NodeId,\n                                      trait_m: &ty::Method<'tcx>,\n-                                     impl_trait_ref: &ty::TraitRef<'tcx>) {\n+                                     impl_trait_ref: &ty::TraitRef<'tcx>,\n+                                     trait_item_span: Option<Span>) {\n     debug!(\"compare_impl_method(impl_trait_ref={:?})\",\n            impl_trait_ref);\n \n@@ -97,14 +98,42 @@ pub fn compare_impl_method<'a, 'tcx>(ccx: &CrateCtxt<'a, 'tcx>,\n     let num_impl_m_type_params = impl_m.generics.types.len();\n     let num_trait_m_type_params = trait_m.generics.types.len();\n     if num_impl_m_type_params != num_trait_m_type_params {\n-        span_err!(tcx.sess, impl_m_span, E0049,\n+        let impl_m_node_id = tcx.map.as_local_node_id(impl_m.def_id).unwrap();\n+        let span = match tcx.map.expect_impl_item(impl_m_node_id).node {\n+            ImplItemKind::Method(ref impl_m_sig, _) => {\n+                if impl_m_sig.generics.is_parameterized() {\n+                    impl_m_sig.generics.span\n+                } else {\n+                    impl_m_span\n+                }\n+            }\n+            _ => bug!(\"{:?} is not a method\", impl_m)\n+        };\n+\n+        struct_span_err!(tcx.sess, span, E0049,\n             \"method `{}` has {} type parameter{} \\\n              but its trait declaration has {} type parameter{}\",\n             trait_m.name,\n             num_impl_m_type_params,\n             if num_impl_m_type_params == 1 {\"\"} else {\"s\"},\n             num_trait_m_type_params,\n-            if num_trait_m_type_params == 1 {\"\"} else {\"s\"});\n+            if num_trait_m_type_params == 1 {\"\"} else {\"s\"})\n+            .span_label(trait_item_span.unwrap(),\n+                        &format!(\"expected {}\",\n+                                 &if num_trait_m_type_params != 1 {\n+                                     format!(\"{} type parameters\",\n+                                             num_trait_m_type_params)\n+                                 } else {\n+                                     format!(\"{} type parameter\",\n+                                             num_trait_m_type_params)\n+                                 }))\n+            .span_label(span, &format!(\"found {}\",\n+                                       &if num_impl_m_type_params != 1 {\n+                                           format!(\"{} type parameters\", num_impl_m_type_params)\n+                                       } else {\n+                                           format!(\"1 type parameter\")\n+                                       }))\n+            .emit();\n         return;\n     }\n "}, {"sha": "baa084212a2d952753effd3c9eeaabf76d4987a0", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=9eac7bdd098d4d55e7322056e040dd3cca40ba67", "patch": "@@ -1015,13 +1015,15 @@ fn check_impl_items_against_trait<'a, 'tcx>(ccx: &CrateCtxt<'a, 'tcx>,\n                         _ => span_bug!(impl_item.span, \"non-method impl-item for method\")\n                     };\n \n+                    let trait_span = tcx.map.span_if_local(ty_trait_item.def_id());\n                     if let &ty::MethodTraitItem(ref trait_method) = ty_trait_item {\n                         compare_impl_method(ccx,\n                                             &impl_method,\n                                             impl_item.span,\n                                             body.id,\n                                             &trait_method,\n-                                            &impl_trait_ref);\n+                                            &impl_trait_ref,\n+                                            trait_span);\n                     } else {\n                         let mut err = struct_span_err!(tcx.sess, impl_item.span, E0324,\n                                   \"item `{}` is an associated method, \\"}, {"sha": "33ebd3f7aca5e345d4d6f8018fd8cd9c7cd6129b", "filename": "src/test/compile-fail/E0049.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Ftest%2Fcompile-fail%2FE0049.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9eac7bdd098d4d55e7322056e040dd3cca40ba67/src%2Ftest%2Fcompile-fail%2FE0049.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0049.rs?ref=9eac7bdd098d4d55e7322056e040dd3cca40ba67", "patch": "@@ -9,13 +9,14 @@\n // except according to those terms.\n \n trait Foo {\n-    fn foo<T: Default>(x: T) -> Self;\n+    fn foo<T: Default>(x: T) -> Self; //~ NOTE expected 1 type parameter\n }\n \n struct Bar;\n \n impl Foo for Bar {\n     fn foo(x: bool) -> Self { Bar } //~ ERROR E0049\n+                                    //~| NOTE found 0 type parameters\n }\n \n fn main() {"}]}