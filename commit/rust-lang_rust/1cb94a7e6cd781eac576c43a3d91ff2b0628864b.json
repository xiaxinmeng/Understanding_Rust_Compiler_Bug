{"sha": "1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjYjk0YTdlNmNkNzgxZWFjNTc2YzQzYTNkOTFmZjJiMDYyODg2NGI=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-05-08T07:19:08Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-05-08T07:24:24Z"}, "message": "Split while_loop.rs tests\n\nSplit out while_let_loop tests into separate file.\nSplit ice-360 out into separate file.", "tree": {"sha": "d986745a4e3fdebf1bfde3bfddeb18f64522f857", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d986745a4e3fdebf1bfde3bfddeb18f64522f857"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "html_url": "https://github.com/rust-lang/rust/commit/1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/comments", "author": null, "committer": null, "parents": [{"sha": "089a7beb7d7094c3fe8152c7a7c7c739c186fd62", "url": "https://api.github.com/repos/rust-lang/rust/commits/089a7beb7d7094c3fe8152c7a7c7c739c186fd62", "html_url": "https://github.com/rust-lang/rust/commit/089a7beb7d7094c3fe8152c7a7c7c739c186fd62"}], "stats": {"total": 434, "additions": 224, "deletions": 210}, "files": [{"sha": "6555c19ca6a26b5c79711eb925cd1d6b6a4cf9bb", "filename": "tests/ui/ice-360.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fice-360.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fice-360.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fice-360.rs?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -0,0 +1,12 @@\n+fn main() {}\n+\n+fn no_panic<T>(slice: &[T]) {\n+    let mut iter = slice.iter();\n+    loop {\n+        let _ = match iter.next() {\n+            Some(ele) => ele,\n+            None => break,\n+        };\n+        loop {}\n+    }\n+}"}, {"sha": "84e31eaf2e9f8d420fef2ea67486ce7dfc1ce32a", "filename": "tests/ui/ice-360.stderr", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fice-360.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fice-360.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fice-360.stderr?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -0,0 +1,24 @@\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/ice-360.rs:5:5\n+   |\n+LL | /     loop {\n+LL | |         let _ = match iter.next() {\n+LL | |             Some(ele) => ele,\n+LL | |             None => break,\n+LL | |         };\n+LL | |         loop {}\n+LL | |     }\n+   | |_____^ help: try: `while let Some(ele) = iter.next() { .. }`\n+   |\n+   = note: `-D clippy::while-let-loop` implied by `-D warnings`\n+\n+error: empty `loop {}` detected. You may want to either use `panic!()` or add `std::thread::sleep(..);` to the loop body.\n+  --> $DIR/ice-360.rs:10:9\n+   |\n+LL |         loop {}\n+   |         ^^^^^^^\n+   |\n+   = note: `-D clippy::empty-loop` implied by `-D warnings`\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "3ce699f551b209c122e9bc3eb3b59f3c9ce41698", "filename": "tests/ui/while_let_loop.rs", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_let_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_let_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwhile_let_loop.rs?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -0,0 +1,119 @@\n+#![warn(clippy::while_let_loop)]\n+\n+fn main() {\n+    let y = Some(true);\n+    loop {\n+        if let Some(_x) = y {\n+            let _v = 1;\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    #[allow(clippy::never_loop)]\n+    loop {\n+        // no error, break is not in else clause\n+        if let Some(_x) = y {\n+            let _v = 1;\n+        }\n+        break;\n+    }\n+\n+    loop {\n+        match y {\n+            Some(_x) => true,\n+            None => break,\n+        };\n+    }\n+\n+    loop {\n+        let x = match y {\n+            Some(x) => x,\n+            None => break,\n+        };\n+        let _x = x;\n+        let _str = \"foo\";\n+    }\n+\n+    loop {\n+        let x = match y {\n+            Some(x) => x,\n+            None => break,\n+        };\n+        {\n+            let _a = \"bar\";\n+        };\n+        {\n+            let _b = \"foobar\";\n+        }\n+    }\n+\n+    loop {\n+        // no error, else branch does something other than break\n+        match y {\n+            Some(_x) => true,\n+            _ => {\n+                let _z = 1;\n+                break;\n+            },\n+        };\n+    }\n+\n+    while let Some(x) = y {\n+        // no error, obviously\n+        println!(\"{}\", x);\n+    }\n+\n+    // #675, this used to have a wrong suggestion\n+    loop {\n+        let (e, l) = match \"\".split_whitespace().next() {\n+            Some(word) => (word.is_empty(), word.len()),\n+            None => break,\n+        };\n+\n+        let _ = (e, l);\n+    }\n+}\n+\n+fn issue771() {\n+    let mut a = 100;\n+    let b = Some(true);\n+    loop {\n+        if a > 10 {\n+            break;\n+        }\n+\n+        match b {\n+            Some(_) => a = 0,\n+            None => break,\n+        }\n+    }\n+}\n+\n+fn issue1017() {\n+    let r: Result<u32, u32> = Ok(42);\n+    let mut len = 1337;\n+\n+    loop {\n+        match r {\n+            Err(_) => len = 0,\n+            Ok(length) => {\n+                len = length;\n+                break;\n+            },\n+        }\n+    }\n+}\n+\n+#[allow(clippy::never_loop)]\n+fn issue1948() {\n+    // should not trigger clippy::while_let_loop lint because break passes an expression\n+    let a = Some(10);\n+    let b = loop {\n+        if let Some(c) = a {\n+            break Some(c);\n+        } else {\n+            break None;\n+        }\n+    };\n+}"}, {"sha": "13dd0ee224c10e74ca3f6a4254dcef94338c5c7e", "filename": "tests/ui/while_let_loop.stderr", "status": "added", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_let_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_let_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwhile_let_loop.stderr?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -0,0 +1,63 @@\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/while_let_loop.rs:5:5\n+   |\n+LL | /     loop {\n+LL | |         if let Some(_x) = y {\n+LL | |             let _v = 1;\n+LL | |         } else {\n+LL | |             break;\n+LL | |         }\n+LL | |     }\n+   | |_____^ help: try: `while let Some(_x) = y { .. }`\n+   |\n+   = note: `-D clippy::while-let-loop` implied by `-D warnings`\n+\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/while_let_loop.rs:22:5\n+   |\n+LL | /     loop {\n+LL | |         match y {\n+LL | |             Some(_x) => true,\n+LL | |             None => break,\n+LL | |         };\n+LL | |     }\n+   | |_____^ help: try: `while let Some(_x) = y { .. }`\n+\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/while_let_loop.rs:29:5\n+   |\n+LL | /     loop {\n+LL | |         let x = match y {\n+LL | |             Some(x) => x,\n+LL | |             None => break,\n+...  |\n+LL | |         let _str = \"foo\";\n+LL | |     }\n+   | |_____^ help: try: `while let Some(x) = y { .. }`\n+\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/while_let_loop.rs:38:5\n+   |\n+LL | /     loop {\n+LL | |         let x = match y {\n+LL | |             Some(x) => x,\n+LL | |             None => break,\n+...  |\n+LL | |         }\n+LL | |     }\n+   | |_____^ help: try: `while let Some(x) = y { .. }`\n+\n+error: this loop could be written as a `while let` loop\n+  --> $DIR/while_let_loop.rs:68:5\n+   |\n+LL | /     loop {\n+LL | |         let (e, l) = match \"\".split_whitespace().next() {\n+LL | |             Some(word) => (word.is_empty(), word.len()),\n+LL | |             None => break,\n+...  |\n+LL | |         let _ = (e, l);\n+LL | |     }\n+   | |_____^ help: try: `while let Some(word) = \"\".split_whitespace().next() { .. }`\n+\n+error: aborting due to 5 previous errors\n+"}, {"sha": "ecc3fa37144fde70f6175d96e731c9a706acd6db", "filename": "tests/ui/while_loop.rs", "status": "modified", "additions": 0, "deletions": 123, "changes": 123, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwhile_loop.rs?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -2,72 +2,6 @@\n #![allow(dead_code, clippy::never_loop, unused, clippy::cognitive_complexity)]\n \n fn main() {\n-    let y = Some(true);\n-    loop {\n-        if let Some(_x) = y {\n-            let _v = 1;\n-        } else {\n-            break;\n-        }\n-    }\n-    loop {\n-        // no error, break is not in else clause\n-        if let Some(_x) = y {\n-            let _v = 1;\n-        }\n-        break;\n-    }\n-    loop {\n-        match y {\n-            Some(_x) => true,\n-            None => break,\n-        };\n-    }\n-    loop {\n-        let x = match y {\n-            Some(x) => x,\n-            None => break,\n-        };\n-        let _x = x;\n-        let _str = \"foo\";\n-    }\n-    loop {\n-        let x = match y {\n-            Some(x) => x,\n-            None => break,\n-        };\n-        {\n-            let _a = \"bar\";\n-        };\n-        {\n-            let _b = \"foobar\";\n-        }\n-    }\n-    loop {\n-        // no error, else branch does something other than break\n-        match y {\n-            Some(_x) => true,\n-            _ => {\n-                let _z = 1;\n-                break;\n-            },\n-        };\n-    }\n-    while let Some(x) = y {\n-        // no error, obviously\n-        println!(\"{}\", x);\n-    }\n-\n-    // #675, this used to have a wrong suggestion\n-    loop {\n-        let (e, l) = match \"\".split_whitespace().next() {\n-            Some(word) => (word.is_empty(), word.len()),\n-            None => break,\n-        };\n-\n-        let _ = (e, l);\n-    }\n-\n     let mut iter = 1..20;\n     while let Option::Some(x) = iter.next() {\n         println!(\"{}\", x);\n@@ -116,36 +50,6 @@ fn main() {\n     }\n }\n \n-// regression test (#360)\n-// this should not panic\n-// it's ok if further iterations of the lint\n-// cause this function to trigger it\n-fn no_panic<T>(slice: &[T]) {\n-    let mut iter = slice.iter();\n-    loop {\n-        let _ = match iter.next() {\n-            Some(ele) => ele,\n-            None => break,\n-        };\n-        loop {}\n-    }\n-}\n-\n-fn issue1017() {\n-    let r: Result<u32, u32> = Ok(42);\n-    let mut len = 1337;\n-\n-    loop {\n-        match r {\n-            Err(_) => len = 0,\n-            Ok(length) => {\n-                len = length;\n-                break;\n-            },\n-        }\n-    }\n-}\n-\n // Issue #1188\n fn refutable() {\n     let a = [42, 1337];\n@@ -194,18 +98,6 @@ fn nested_loops() {\n     }\n }\n \n-fn issue1948() {\n-    // should not trigger clippy::while_let_loop lint because break passes an expression\n-    let a = Some(10);\n-    let b = loop {\n-        if let Some(c) = a {\n-            break Some(c);\n-        } else {\n-            break None;\n-        }\n-    };\n-}\n-\n fn issue1121() {\n     use std::collections::HashSet;\n     let mut values = HashSet::new();\n@@ -238,18 +130,3 @@ fn issue3670() {\n         let _ = elem.or_else(|| *iter.next()?);\n     }\n }\n-\n-fn issue771() {\n-    let mut a = 100;\n-    let b = Some(true);\n-    loop {\n-        if a > 10 {\n-            break;\n-        }\n-\n-        match b {\n-            Some(_) => a = 0,\n-            None => break,\n-        }\n-    }\n-}"}, {"sha": "36ada4e542ea3e14810f1147343d7407988d612c", "filename": "tests/ui/while_loop.stderr", "status": "modified", "additions": 6, "deletions": 87, "changes": 93, "blob_url": "https://github.com/rust-lang/rust/blob/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1cb94a7e6cd781eac576c43a3d91ff2b0628864b/tests%2Fui%2Fwhile_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwhile_loop.stderr?ref=1cb94a7e6cd781eac576c43a3d91ff2b0628864b", "patch": "@@ -1,115 +1,34 @@\n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:6:5\n-   |\n-LL | /     loop {\n-LL | |         if let Some(_x) = y {\n-LL | |             let _v = 1;\n-LL | |         } else {\n-LL | |             break;\n-LL | |         }\n-LL | |     }\n-   | |_____^ help: try: `while let Some(_x) = y { .. }`\n-   |\n-   = note: `-D clippy::while-let-loop` implied by `-D warnings`\n-\n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:20:5\n-   |\n-LL | /     loop {\n-LL | |         match y {\n-LL | |             Some(_x) => true,\n-LL | |             None => break,\n-LL | |         };\n-LL | |     }\n-   | |_____^ help: try: `while let Some(_x) = y { .. }`\n-\n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:26:5\n-   |\n-LL | /     loop {\n-LL | |         let x = match y {\n-LL | |             Some(x) => x,\n-LL | |             None => break,\n-...  |\n-LL | |         let _str = \"foo\";\n-LL | |     }\n-   | |_____^ help: try: `while let Some(x) = y { .. }`\n-\n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:34:5\n-   |\n-LL | /     loop {\n-LL | |         let x = match y {\n-LL | |             Some(x) => x,\n-LL | |             None => break,\n-...  |\n-LL | |         }\n-LL | |     }\n-   | |_____^ help: try: `while let Some(x) = y { .. }`\n-\n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:62:5\n-   |\n-LL | /     loop {\n-LL | |         let (e, l) = match \"\".split_whitespace().next() {\n-LL | |             Some(word) => (word.is_empty(), word.len()),\n-LL | |             None => break,\n-...  |\n-LL | |         let _ = (e, l);\n-LL | |     }\n-   | |_____^ help: try: `while let Some(word) = \"\".split_whitespace().next() { .. }`\n-\n error: this loop could be written as a `for` loop\n-  --> $DIR/while_loop.rs:72:33\n+  --> $DIR/while_loop.rs:6:33\n    |\n LL |     while let Option::Some(x) = iter.next() {\n    |                                 ^^^^^^^^^^^ help: try: `for x in iter { .. }`\n    |\n    = note: `-D clippy::while-let-on-iterator` implied by `-D warnings`\n \n error: this loop could be written as a `for` loop\n-  --> $DIR/while_loop.rs:77:25\n+  --> $DIR/while_loop.rs:11:25\n    |\n LL |     while let Some(x) = iter.next() {\n    |                         ^^^^^^^^^^^ help: try: `for x in iter { .. }`\n \n error: this loop could be written as a `for` loop\n-  --> $DIR/while_loop.rs:82:25\n+  --> $DIR/while_loop.rs:16:25\n    |\n LL |     while let Some(_) = iter.next() {}\n    |                         ^^^^^^^^^^^ help: try: `for _ in iter { .. }`\n \n-error: this loop could be written as a `while let` loop\n-  --> $DIR/while_loop.rs:125:5\n-   |\n-LL | /     loop {\n-LL | |         let _ = match iter.next() {\n-LL | |             Some(ele) => ele,\n-LL | |             None => break,\n-LL | |         };\n-LL | |         loop {}\n-LL | |     }\n-   | |_____^ help: try: `while let Some(ele) = iter.next() { .. }`\n-\n-error: empty `loop {}` detected. You may want to either use `panic!()` or add `std::thread::sleep(..);` to the loop body.\n-  --> $DIR/while_loop.rs:130:9\n-   |\n-LL |         loop {}\n-   |         ^^^^^^^\n-   |\n-   = note: `-D clippy::empty-loop` implied by `-D warnings`\n-\n error: this loop could be written as a `for` loop\n-  --> $DIR/while_loop.rs:191:29\n+  --> $DIR/while_loop.rs:95:29\n    |\n LL |         while let Some(v) = y.next() {\n    |                             ^^^^^^^^ help: try: `for v in y { .. }`\n \n error: this loop could be written as a `for` loop\n-  --> $DIR/while_loop.rs:228:26\n+  --> $DIR/while_loop.rs:120:26\n    |\n LL |     while let Some(..) = values.iter().next() {\n    |                          ^^^^^^^^^^^^^^^^^^^^ help: try: `for _ in values.iter() { .. }`\n \n-error: aborting due to 12 previous errors\n+error: aborting due to 5 previous errors\n "}]}