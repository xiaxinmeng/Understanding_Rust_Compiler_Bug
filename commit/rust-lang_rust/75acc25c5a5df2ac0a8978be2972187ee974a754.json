{"sha": "75acc25c5a5df2ac0a8978be2972187ee974a754", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1YWNjMjVjNWE1ZGYyYWMwYTg5NzhiZTI5NzIxODdlZTk3NGE3NTQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-12-30T09:49:43Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-12-30T09:49:43Z"}, "message": "Merge #362\n\n362: Complete call parens r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "6298a2c7fe4e63d81f6d2fd54de51d914205013a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6298a2c7fe4e63d81f6d2fd54de51d914205013a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75acc25c5a5df2ac0a8978be2972187ee974a754", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75acc25c5a5df2ac0a8978be2972187ee974a754", "html_url": "https://github.com/rust-lang/rust/commit/75acc25c5a5df2ac0a8978be2972187ee974a754", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75acc25c5a5df2ac0a8978be2972187ee974a754/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "e2bc57e3c89e469eee772aa8e42df1d453fea922", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2bc57e3c89e469eee772aa8e42df1d453fea922", "html_url": "https://github.com/rust-lang/rust/commit/e2bc57e3c89e469eee772aa8e42df1d453fea922"}, {"sha": "e29f53f6261b18e759add87f8f3dc4633bc21ec2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e29f53f6261b18e759add87f8f3dc4633bc21ec2", "html_url": "https://github.com/rust-lang/rust/commit/e29f53f6261b18e759add87f8f3dc4633bc21ec2"}], "stats": {"total": 59, "additions": 44, "deletions": 15}, "files": [{"sha": "2fb9936895c881810dc59bde3e190c1710651572", "filename": "Cargo.lock", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/75acc25c5a5df2ac0a8978be2972187ee974a754/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/75acc25c5a5df2ac0a8978be2972187ee974a754/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=75acc25c5a5df2ac0a8978be2972187ee974a754", "patch": "@@ -696,7 +696,7 @@ dependencies = [\n  \"rayon 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"salsa 0.9.0 (git+https://github.com/matklad/salsa.git?branch=transitive-untracked)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -722,7 +722,7 @@ dependencies = [\n  \"ra_syntax 0.1.0\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"salsa 0.9.0 (git+https://github.com/matklad/salsa.git?branch=transitive-untracked)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -755,7 +755,7 @@ dependencies = [\n  \"ra_syntax 0.1.0\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"salsa 0.9.0 (git+https://github.com/matklad/salsa.git?branch=transitive-untracked)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -1059,7 +1059,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n [[package]]\n name = \"salsa\"\n version = \"0.9.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+source = \"git+https://github.com/matklad/salsa.git?branch=transitive-untracked#a2198f1f8a1d09894b842035a1af6b0b4c133c93\"\n dependencies = [\n  \"derive-new 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"indexmap 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1631,7 +1631,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum rusty-fork 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9591f190d2852720b679c21f66ad929f9f1d7bb09d1193c26167586029d8489c\"\n \"checksum ryu 0.2.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eb9e9b8cde282a9fe6a42dd4681319bfb63f121b8a8ee9439c6f4107e58a46f7\"\n \"checksum safemem 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8dca453248a96cb0749e36ccdfe2b0b4e54a61bfef89fb97ec621eb8e0a93dd9\"\n-\"checksum salsa 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1b0246018bf824f282cb89c2ba9b9ef81093c563487c29ffafe20e1c129a6850\"\n+\"checksum salsa 0.9.0 (git+https://github.com/matklad/salsa.git?branch=transitive-untracked)\" = \"<none>\"\n \"checksum same-file 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8f20c4be53a8a1ff4c1f1b2bd14570d2f634628709752f0702ecdd2b3f9a5267\"\n \"checksum scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"94258f53601af11e6a49f722422f6e3425c52b06245a5cf9bc09908b174f5e27\"\n \"checksum semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\""}, {"sha": "cd98efe956d9d6234ed1c36b5035aed59e5131be", "filename": "crates/ra_analysis/src/completion/complete_scope.rs", "status": "modified", "additions": 28, "deletions": 8, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/75acc25c5a5df2ac0a8978be2972187ee974a754/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75acc25c5a5df2ac0a8978be2972187ee974a754/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=75acc25c5a5df2ac0a8978be2972187ee974a754", "patch": "@@ -74,7 +74,7 @@ mod tests {\n                 let z = ();\n             }\n             \",\n-            \"y;x;quux\",\n+            r#\"y;x;quux \"quux($0)\"\"#,\n         );\n     }\n \n@@ -92,7 +92,7 @@ mod tests {\n                 }\n             }\n             \",\n-            \"b;a;quux\",\n+            r#\"b;a;quux \"quux()$0\"\"#,\n         );\n     }\n \n@@ -106,7 +106,7 @@ mod tests {\n                 }\n             }\n             \",\n-            \"x;quux\",\n+            r#\"x;quux \"quux()$0\"\"#,\n         );\n     }\n \n@@ -120,7 +120,7 @@ mod tests {\n                 <|>\n             }\n             \",\n-            \"quux;Foo;Baz\",\n+            r#\"quux \"quux()$0\";Foo;Baz\"#,\n         );\n     }\n \n@@ -134,7 +134,7 @@ mod tests {\n                 fn quux() { <|> }\n             }\n             \",\n-            \"quux;Bar\",\n+            r#\"quux \"quux()$0\";Bar\"#,\n         );\n     }\n \n@@ -145,12 +145,12 @@ mod tests {\n             struct Foo;\n             fn x() -> <|>\n             \",\n-            \"Foo;x\",\n+            r#\"Foo;x \"x()$0\"\"#,\n         )\n     }\n \n     #[test]\n-    fn dont_show_to_completions_for_shadowing() {\n+    fn dont_show_both_completions_for_shadowing() {\n         check_reference_completion(\n             r\"\n             fn foo() -> {\n@@ -161,12 +161,32 @@ mod tests {\n                 }\n             }\n             \",\n-            \"bar;foo\",\n+            r#\"bar;foo \"foo()$0\"\"#,\n         )\n     }\n \n     #[test]\n     fn completes_self_in_methods() {\n         check_reference_completion(r\"impl S { fn foo(&self) { <|> } }\", \"self\")\n     }\n+\n+    #[test]\n+    fn inserts_parens_for_function_calls() {\n+        check_reference_completion(\n+            r\"\n+            fn no_args() {}\n+            fn main() { no_<|> }\n+            \",\n+            r#\"no_args \"no_args()$0\"\n+               main \"main()$0\"\"#,\n+        );\n+        check_reference_completion(\n+            r\"\n+            fn with_args(x: i32, y: String) {}\n+            fn main() { with_<|> }\n+            \",\n+            r#\"main \"main()$0\"\n+               with_args \"with_args($0)\"\"#,\n+        );\n+    }\n }"}, {"sha": "b8fa39ae3dd2983eb124720264eced67c4b7d9c9", "filename": "crates/ra_analysis/src/completion/completion_item.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/75acc25c5a5df2ac0a8978be2972187ee974a754/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75acc25c5a5df2ac0a8978be2972187ee974a754/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=75acc25c5a5df2ac0a8978be2972187ee974a754", "patch": "@@ -138,9 +138,18 @@ impl Builder {\n                 ..\n             } => CompletionItemKind::Enum,\n             PerNs {\n-                values: Some(hir::Def::Function(..)),\n+                values: Some(hir::Def::Function(function)),\n                 ..\n-            } => CompletionItemKind::Function,\n+            } => {\n+                if let Some(sig_info) = function.signature_info(db) {\n+                    if sig_info.params.is_empty() {\n+                        self.snippet = Some(format!(\"{}()$0\", self.label));\n+                    } else {\n+                        self.snippet = Some(format!(\"{}($0)\", self.label));\n+                    }\n+                }\n+                CompletionItemKind::Function\n+            }\n             _ => return self,\n         };\n         self.kind = Some(kind);"}]}