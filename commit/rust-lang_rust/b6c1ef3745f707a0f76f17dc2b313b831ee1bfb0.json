{"sha": "b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2YzFlZjM3NDVmNzA3YTBmNzZmMTdkYzJiMzEzYjgzMWVlMWJmYjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-07-15T03:29:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-07-15T03:29:54Z"}, "message": "Auto merge of #34801 - TimNN:rustbuild-doc-fixes, r=alexcrichton\n\nrustbuild: doc fixes\n\nThis fixes two issues rustbuild currently has when building documentation:\n\n1. It fixes standalone builds of `doc-test` and `doc-rustc`.\n2. It actually builds the compiler docs if requested in the config.\n\nCloses #34275.", "tree": {"sha": "11ce8f022b6ba6c9e32c49895b28186331ad816b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11ce8f022b6ba6c9e32c49895b28186331ad816b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "html_url": "https://github.com/rust-lang/rust/commit/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e15fcc55e028bf10aa60cb849f3aca4f2ead20c", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e15fcc55e028bf10aa60cb849f3aca4f2ead20c", "html_url": "https://github.com/rust-lang/rust/commit/3e15fcc55e028bf10aa60cb849f3aca4f2ead20c"}, {"sha": "3c0c663b0e0b66b61471aac34894a3fb78aa10fa", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c0c663b0e0b66b61471aac34894a3fb78aa10fa", "html_url": "https://github.com/rust-lang/rust/commit/3c0c663b0e0b66b61471aac34894a3fb78aa10fa"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "c2636384dbb2b447967ad6917e452cf9976d177a", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "patch": "@@ -155,6 +155,7 @@ pub fn std(build: &Build, stage: u32, target: &str, out: &Path) {\n /// is largely just a wrapper around `cargo doc`.\n pub fn test(build: &Build, stage: u32, target: &str, out: &Path) {\n     println!(\"Documenting stage{} test ({})\", stage, target);\n+    t!(fs::create_dir_all(out));\n     let compiler = Compiler::new(stage, &build.config.build);\n     let out_dir = build.stage_out(&compiler, Mode::Libtest)\n                        .join(target).join(\"doc\");\n@@ -175,11 +176,12 @@ pub fn test(build: &Build, stage: u32, target: &str, out: &Path) {\n /// dependencies. This is largely just a wrapper around `cargo doc`.\n pub fn rustc(build: &Build, stage: u32, target: &str, out: &Path) {\n     println!(\"Documenting stage{} compiler ({})\", stage, target);\n+    t!(fs::create_dir_all(out));\n     let compiler = Compiler::new(stage, &build.config.build);\n     let out_dir = build.stage_out(&compiler, Mode::Librustc)\n                        .join(target).join(\"doc\");\n     let rustdoc = build.rustdoc(&compiler);\n-    if !up_to_date(&rustdoc, &out_dir.join(\"rustc/index.html\")) {\n+    if !up_to_date(&rustdoc, &out_dir.join(\"rustc/index.html\")) && out_dir.exists() {\n         t!(fs::remove_dir_all(&out_dir));\n     }\n     let mut cargo = build.cargo(&compiler, Mode::Librustc, target, \"doc\");"}, {"sha": "82ae70d22ca060336d9088f20cba8834552ea3a9", "filename": "src/bootstrap/step.rs", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0/src%2Fbootstrap%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0/src%2Fbootstrap%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fstep.rs?ref=b6c1ef3745f707a0f76f17dc2b313b831ee1bfb0", "patch": "@@ -380,10 +380,18 @@ impl<'a> Step<'a> {\n                 vec![self.doc_test(stage)]\n             }\n             Source::Doc { stage } => {\n-                vec![self.doc_book(stage), self.doc_nomicon(stage),\n-                     self.doc_style(stage), self.doc_standalone(stage),\n-                     self.doc_std(stage),\n-                     self.doc_error_index(stage)]\n+                let mut deps = vec![\n+                    self.doc_book(stage), self.doc_nomicon(stage),\n+                    self.doc_style(stage), self.doc_standalone(stage),\n+                    self.doc_std(stage),\n+                    self.doc_error_index(stage),\n+                ];\n+\n+                if build.config.compiler_docs {\n+                    deps.push(self.doc_rustc(stage));\n+                }\n+\n+                deps\n             }\n             Source::Check { stage, compiler } => {\n                 // Check is just a pseudo step which means check all targets,"}]}