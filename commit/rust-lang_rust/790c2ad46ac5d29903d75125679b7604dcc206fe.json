{"sha": "790c2ad46ac5d29903d75125679b7604dcc206fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5MGMyYWQ0NmFjNWQyOTkwM2Q3NTEyNTY3OWI3NjA0ZGNjMjA2ZmU=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-03-22T01:20:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-22T01:20:33Z"}, "message": "Rollup merge of #83350 - jyn514:llvm-version, r=Mark-Simulacrum\n\nDownload a more recent LLVM version if `src/version` is modified\n\nWhen bumping the bootstrap version, the name of the generated LLVM\nshared object file is changed, even though it's the same contents as\nbefore. If bootstrap tries to use an older version, it will get linking\nerrors:\n\n```\nBuilding rustdoc for stage1 (x86_64-unknown-linux-gnu)\n   Compiling rustdoc-tool v0.0.0 (/home/joshua/rustc/src/tools/rustdoc)\nerror: linking with `cc` failed: exit code: 1\n  |\n  = note: \"cc\" \"-Wl,--as-needed\" ... lots of args ...\n  = note: /usr/bin/ld: cannot find -lLLVM-12-rust-1.53.0-nightly\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nerror: could not compile `rustdoc-tool`\n```\n\nHelps with https://github.com/rust-lang/rust/issues/81930.", "tree": {"sha": "187ee85ef8de6548d3f418b43f95502014781607", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/187ee85ef8de6548d3f418b43f95502014781607"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/790c2ad46ac5d29903d75125679b7604dcc206fe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgV/DiCRBK7hj4Ov3rIwAAdHIIAIEnmByAWgP3hPQpEktPdS8o\nfEW9eaotDggJQ9/AXSlM+tT4m6XYtiNaDq+8ZsOTGIaO4IR9Wy2egVuj8rChKI1N\nijlpJObKxT8CU1Ql0STY2XKzy2xJFJQLOwLxPwpHg8edzc0JSEC9jp/cFoy5A6TQ\nb74OYZELj+tlIt/jm2Hb6Cy2F9+PYpJxLRfvbyvZVgCy6/emS4aTe7CQ9hXsDFQF\nzimUuUol1VNlVdiNR/Xa0ZHl2wZc4ZnWk8EsgT+LBDCvN/jO3mIPKcJQPnolICWh\nNuXUZeNNuoS4vEwgRnVmh8dcWY45haIyKBVkiSuOmXLy/5tKC3HVQqLwonwDcAo=\n=7xr7\n-----END PGP SIGNATURE-----\n", "payload": "tree 187ee85ef8de6548d3f418b43f95502014781607\nparent ea5ba76d1cdbc1f3cbe5f5d8582349fcf7373ed6\nparent 4002171315bb294d9c518dd1f053072ced66e282\nauthor Dylan DPC <dylan.dpc@gmail.com> 1616376033 +0100\ncommitter GitHub <noreply@github.com> 1616376033 +0100\n\nRollup merge of #83350 - jyn514:llvm-version, r=Mark-Simulacrum\n\nDownload a more recent LLVM version if `src/version` is modified\n\nWhen bumping the bootstrap version, the name of the generated LLVM\nshared object file is changed, even though it's the same contents as\nbefore. If bootstrap tries to use an older version, it will get linking\nerrors:\n\n```\nBuilding rustdoc for stage1 (x86_64-unknown-linux-gnu)\n   Compiling rustdoc-tool v0.0.0 (/home/joshua/rustc/src/tools/rustdoc)\nerror: linking with `cc` failed: exit code: 1\n  |\n  = note: \"cc\" \"-Wl,--as-needed\" ... lots of args ...\n  = note: /usr/bin/ld: cannot find -lLLVM-12-rust-1.53.0-nightly\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nerror: could not compile `rustdoc-tool`\n```\n\nHelps with https://github.com/rust-lang/rust/issues/81930.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/790c2ad46ac5d29903d75125679b7604dcc206fe", "html_url": "https://github.com/rust-lang/rust/commit/790c2ad46ac5d29903d75125679b7604dcc206fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/790c2ad46ac5d29903d75125679b7604dcc206fe/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea5ba76d1cdbc1f3cbe5f5d8582349fcf7373ed6", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea5ba76d1cdbc1f3cbe5f5d8582349fcf7373ed6", "html_url": "https://github.com/rust-lang/rust/commit/ea5ba76d1cdbc1f3cbe5f5d8582349fcf7373ed6"}, {"sha": "4002171315bb294d9c518dd1f053072ced66e282", "url": "https://api.github.com/repos/rust-lang/rust/commits/4002171315bb294d9c518dd1f053072ced66e282", "html_url": "https://github.com/rust-lang/rust/commit/4002171315bb294d9c518dd1f053072ced66e282"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "075756b73ba820ea256a3c45e1c66fb3abf21c70", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/790c2ad46ac5d29903d75125679b7604dcc206fe/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/790c2ad46ac5d29903d75125679b7604dcc206fe/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=790c2ad46ac5d29903d75125679b7604dcc206fe", "patch": "@@ -463,6 +463,8 @@ def download_stage0(self):\n                 \"--\",\n                 \"{}/src/llvm-project\".format(top_level),\n                 \"{}/src/bootstrap/download-ci-llvm-stamp\".format(top_level),\n+                # the LLVM shared object file is named `LLVM-12-rust-{version}-nightly`\n+                \"{}/src/version\".format(top_level)\n             ]).decode(sys.getdefaultencoding()).strip()\n             llvm_assertions = self.get_toml('assertions', 'llvm') == 'true'\n             llvm_root = self.llvm_root()"}]}