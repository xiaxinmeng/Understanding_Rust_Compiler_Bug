{"sha": "2997ea3ceffaadd1061153e3e17959190bbde24a", "node_id": "C_kwDOAAsO6NoAKDI5OTdlYTNjZWZmYWFkZDEwNjExNTNlM2UxNzk1OTE5MGJiZGUyNGE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-10T11:09:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-10T11:09:59Z"}, "message": "Rollup merge of #93808 - GuillaumeGomez:headings-indent, r=jsha\n\nRemove first headings indent\n\nFixes https://github.com/rust-lang/rust/issues/92975.\n\nI removed the anchors displayed on hover because the cursor changes when you hover them in any case, removing the need for the indent altogether.\n\n[Demo](https://rustdoc.crud.net/imperio/headings-indent/std/index.html).\n\nScreenshot of the result:\n\n![Screenshot from 2022-02-09 14-46-12](https://user-images.githubusercontent.com/3050060/153213824-74ef0b62-4f2b-4816-8912-6f2f3beacd29.png)\n\nr? `@jsha`", "tree": {"sha": "d6446824fc48298ce22357d2b276403f74e52ded", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6446824fc48298ce22357d2b276403f74e52ded"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2997ea3ceffaadd1061153e3e17959190bbde24a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiBPKHCRBK7hj4Ov3rIwAAxXIIAA2184Wa+fGFX0Njphgg1MP8\nSGTvtQExvHnLaCTzVInfI6LsRX3vKxMjdO3j7x7Rbtt2TR8qOCcl7jVA1xY0e1yJ\nw+4vfR7QXcqu15lSGtJM2gozotJ1KVN5XlWMzWBl8IdXRdI83GpmplUCxBF7uQg8\nItUJ2JYNbPCOpQSVuCXhPfsIY/22vXj5BINlGuEoEbRcByHvaTvsFCFsyQF50jea\nN57bjkQmLoJGj2MPtE1JROlqqg2aIcgE0VpwQOi0ClEk85oFF0ajy0JCywRHcaw0\nZttXijLgwLob7DjB1EO1Ohm0aSL4g6zYVsDY3LuMbrjZbogFNVphL8gshZJoLEM=\n=+Ku/\n-----END PGP SIGNATURE-----\n", "payload": "tree d6446824fc48298ce22357d2b276403f74e52ded\nparent f3f41d76ad3f64ffc5ff22cb510bfd64c50e8d79\nparent e8d5ae41a118364bc9897d01fa67a3838712b7c2\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1644491399 +0100\ncommitter GitHub <noreply@github.com> 1644491399 +0100\n\nRollup merge of #93808 - GuillaumeGomez:headings-indent, r=jsha\n\nRemove first headings indent\n\nFixes https://github.com/rust-lang/rust/issues/92975.\n\nI removed the anchors displayed on hover because the cursor changes when you hover them in any case, removing the need for the indent altogether.\n\n[Demo](https://rustdoc.crud.net/imperio/headings-indent/std/index.html).\n\nScreenshot of the result:\n\n![Screenshot from 2022-02-09 14-46-12](https://user-images.githubusercontent.com/3050060/153213824-74ef0b62-4f2b-4816-8912-6f2f3beacd29.png)\n\nr? `@jsha`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2997ea3ceffaadd1061153e3e17959190bbde24a", "html_url": "https://github.com/rust-lang/rust/commit/2997ea3ceffaadd1061153e3e17959190bbde24a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2997ea3ceffaadd1061153e3e17959190bbde24a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3f41d76ad3f64ffc5ff22cb510bfd64c50e8d79", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3f41d76ad3f64ffc5ff22cb510bfd64c50e8d79", "html_url": "https://github.com/rust-lang/rust/commit/f3f41d76ad3f64ffc5ff22cb510bfd64c50e8d79"}, {"sha": "e8d5ae41a118364bc9897d01fa67a3838712b7c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8d5ae41a118364bc9897d01fa67a3838712b7c2", "html_url": "https://github.com/rust-lang/rust/commit/e8d5ae41a118364bc9897d01fa67a3838712b7c2"}], "stats": {"total": 123, "additions": 18, "deletions": 105}, "files": [{"sha": "1c0448828a2795344528f6550f9e88d6e70cc044", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -565,7 +565,7 @@ impl<'a, 'b, 'ids, I: Iterator<Item = SpannedEvent<'a>>> Iterator\n             self.buf.push_back((Event::Html(format!(\"</a></h{}>\", level).into()), 0..0));\n \n             let start_tags = format!(\n-                \"<h{level} id=\\\"{id}\\\" class=\\\"section-header\\\">\\\n+                \"<h{level} id=\\\"{id}\\\">\\\n                     <a href=\\\"#{id}\\\">\",\n                 id = id,\n                 level = level"}, {"sha": "5c0bf0ed942f4169ffde9eae363db910791b9323", "filename": "src/librustdoc/html/markdown/tests.rs", "status": "modified", "additions": 10, "deletions": 37, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown%2Ftests.rs?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -159,25 +159,22 @@ fn test_header() {\n         assert_eq!(output, expect, \"original: {}\", input);\n     }\n \n-    t(\n-        \"# Foo bar\",\n-        \"<h2 id=\\\"foo-bar\\\" class=\\\"section-header\\\"><a href=\\\"#foo-bar\\\">Foo bar</a></h2>\",\n-    );\n+    t(\"# Foo bar\", \"<h2 id=\\\"foo-bar\\\"><a href=\\\"#foo-bar\\\">Foo bar</a></h2>\");\n     t(\n         \"## Foo-bar_baz qux\",\n-        \"<h3 id=\\\"foo-bar_baz-qux\\\" class=\\\"section-header\\\">\\\n+        \"<h3 id=\\\"foo-bar_baz-qux\\\">\\\n          <a href=\\\"#foo-bar_baz-qux\\\">Foo-bar_baz qux</a></h3>\",\n     );\n     t(\n         \"### **Foo** *bar* baz!?!& -_qux_-%\",\n-        \"<h4 id=\\\"foo-bar-baz--qux-\\\" class=\\\"section-header\\\">\\\n+        \"<h4 id=\\\"foo-bar-baz--qux-\\\">\\\n             <a href=\\\"#foo-bar-baz--qux-\\\"><strong>Foo</strong> \\\n             <em>bar</em> baz!?!&amp; -<em>qux</em>-%</a>\\\n          </h4>\",\n     );\n     t(\n         \"#### **Foo?** & \\\\*bar?!*  _`baz`_ \u2764 #qux\",\n-        \"<h5 id=\\\"foo--bar--baz--qux\\\" class=\\\"section-header\\\">\\\n+        \"<h5 id=\\\"foo--bar--baz--qux\\\">\\\n              <a href=\\\"#foo--bar--baz--qux\\\"><strong>Foo?</strong> &amp; *bar?!*  \\\n              <em><code>baz</code></em> \u2764 #qux</a>\\\n          </h5>\",\n@@ -201,36 +198,12 @@ fn test_header_ids_multiple_blocks() {\n         assert_eq!(output, expect, \"original: {}\", input);\n     }\n \n-    t(\n-        &mut map,\n-        \"# Example\",\n-        \"<h2 id=\\\"example\\\" class=\\\"section-header\\\"><a href=\\\"#example\\\">Example</a></h2>\",\n-    );\n-    t(\n-        &mut map,\n-        \"# Panics\",\n-        \"<h2 id=\\\"panics\\\" class=\\\"section-header\\\"><a href=\\\"#panics\\\">Panics</a></h2>\",\n-    );\n-    t(\n-        &mut map,\n-        \"# Example\",\n-        \"<h2 id=\\\"example-1\\\" class=\\\"section-header\\\"><a href=\\\"#example-1\\\">Example</a></h2>\",\n-    );\n-    t(\n-        &mut map,\n-        \"# Search\",\n-        \"<h2 id=\\\"search-1\\\" class=\\\"section-header\\\"><a href=\\\"#search-1\\\">Search</a></h2>\",\n-    );\n-    t(\n-        &mut map,\n-        \"# Example\",\n-        \"<h2 id=\\\"example-2\\\" class=\\\"section-header\\\"><a href=\\\"#example-2\\\">Example</a></h2>\",\n-    );\n-    t(\n-        &mut map,\n-        \"# Panics\",\n-        \"<h2 id=\\\"panics-1\\\" class=\\\"section-header\\\"><a href=\\\"#panics-1\\\">Panics</a></h2>\",\n-    );\n+    t(&mut map, \"# Example\", \"<h2 id=\\\"example\\\"><a href=\\\"#example\\\">Example</a></h2>\");\n+    t(&mut map, \"# Panics\", \"<h2 id=\\\"panics\\\"><a href=\\\"#panics\\\">Panics</a></h2>\");\n+    t(&mut map, \"# Example\", \"<h2 id=\\\"example-1\\\"><a href=\\\"#example-1\\\">Example</a></h2>\");\n+    t(&mut map, \"# Search\", \"<h2 id=\\\"search-1\\\"><a href=\\\"#search-1\\\">Search</a></h2>\");\n+    t(&mut map, \"# Example\", \"<h2 id=\\\"example-2\\\"><a href=\\\"#example-2\\\">Example</a></h2>\");\n+    t(&mut map, \"# Panics\", \"<h2 id=\\\"panics-1\\\"><a href=\\\"#panics-1\\\">Panics</a></h2>\");\n }\n \n #[test]"}, {"sha": "19b5fef4e092e60fa9465c8b26cd36f58f062b42", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -2567,7 +2567,7 @@ fn render_call_locations(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item) {\n         w,\n         \"<div class=\\\"docblock scraped-example-list\\\">\\\n           <span></span>\\\n-          <h5 id=\\\"{id}\\\" class=\\\"section-header\\\">\\\n+          <h5 id=\\\"{id}\\\">\\\n              <a href=\\\"#{id}\\\">Examples found in repository</a>\\\n           </h5>\",\n         id = id"}, {"sha": "78e7c97d71d258ea951263fd03a7f034c07d83da", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -1141,16 +1141,6 @@ a.test-arrow {\n a.test-arrow:hover{\n \ttext-decoration: none;\n }\n-.section-header:hover a:before {\n-\tposition: absolute;\n-\tleft: -25px;\n-\tpadding-right: 10px; /* avoid gap that causes hover to disappear */\n-\tcontent: '\\2002\\00a7\\2002';\n-}\n-\n-.section-header:hover a {\n-\ttext-decoration: none;\n-}\n \n .code-attribute {\n \tfont-weight: 300;\n@@ -1196,17 +1186,6 @@ h3.variant {\n \tmargin-top: 3px;\n }\n \n-.top-doc .docblock > .section-header:first-child {\n-\tmargin-left: 15px;\n-}\n-.top-doc .docblock > .section-header:first-child:hover > a:before {\n-\tleft: -10px;\n-}\n-\n-.docblock > .section-header:first-child {\n-\tmargin-top: 0;\n-}\n-\n :target > code, :target > .code-header {\n \topacity: 1;\n }"}, {"sha": "ddfb23a4f86ba555a3cf20f84c2111e68a02356f", "filename": "src/test/rustdoc-gui/anchors.goml", "status": "modified", "additions": 0, "deletions": 42, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fanchors.goml?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -31,46 +31,4 @@ assert-css: (\"h2#implementations a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n move-cursor-to: \"#impl\"\n assert-css: (\"#impl a.anchor\", {\"color\": \"rgb(0, 0, 0)\"})\n \n-// Now we check the positions: only the first heading of the top doc comment should\n-// have a different position.\n-move-cursor-to: \".top-doc .docblock .section-header:first-child\"\n-assert-css: (\n-    \".top-doc .docblock .section-header:first-child > a::before\",\n-    {\"left\": \"-10px\", \"padding-right\": \"10px\"},\n-)\n-// We also check that the heading itself has a different indent.\n-assert-css: (\".top-doc .docblock .section-header:first-child\", {\"margin-left\": \"15px\"})\n-\n-move-cursor-to: \".top-doc .docblock .section-header:not(:first-child)\"\n-assert-css: (\n-    \".top-doc .docblock .section-header:not(:first-child) > a::before\",\n-    {\"left\": \"-25px\", \"padding-right\": \"10px\"},\n-)\n-assert-css: (\".top-doc .docblock .section-header:not(:first-child)\", {\"margin-left\": \"0px\"})\n-\n-// Now let's check some other docblock headings...\n-// First the impl block docs.\n-move-cursor-to: \"#title-for-struct-impl-doc\"\n-assert-css: (\n-    \"#title-for-struct-impl-doc > a::before\",\n-    {\"left\": \"-25px\", \"padding-right\": \"10px\"},\n-)\n-assert-css: (\"#title-for-struct-impl-doc\", {\"margin-left\": \"0px\"})\n-// Now a method docs.\n-move-cursor-to: \"#title-for-struct-impl-item-doc\"\n-assert-css: (\n-    \"#title-for-struct-impl-item-doc > a::before\",\n-    {\"left\": \"-25px\", \"padding-right\": \"10px\"},\n-)\n assert-css: (\"#title-for-struct-impl-item-doc\", {\"margin-left\": \"0px\"})\n-\n-// Finally, we want to ensure that if the first element of the doc block isn't a heading,\n-// if there is a heading afterwards, it won't have the indent.\n-goto: file://|DOC_PATH|/test_docs/enum.WhoLetTheDogOut.html\n-\n-move-cursor-to: \".top-doc .docblock .section-header\"\n-assert-css: (\n-    \".top-doc .docblock .section-header > a::before\",\n-    {\"left\": \"-25px\", \"padding-right\": \"10px\"},\n-)\n-assert-css: (\".top-doc .docblock .section-header\", {\"margin-left\": \"0px\"})"}, {"sha": "cf9caa2d5866a150ad2da9e3d88fe02a500c1682", "filename": "src/test/rustdoc-gui/headers-color.goml", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml", "raw_url": "https://github.com/rust-lang/rust/raw/2997ea3ceffaadd1061153e3e17959190bbde24a/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheaders-color.goml?ref=2997ea3ceffaadd1061153e3e17959190bbde24a", "patch": "@@ -40,7 +40,8 @@ goto: file://|DOC_PATH|/test_docs/index.html\n assert-css: (\".small-section-header a\", {\"color\": \"rgb(197, 197, 197)\"}, ALL)\n \n goto: file://|DOC_PATH|/test_docs/struct.HeavilyDocumentedStruct.html\n-assert-css: (\".section-header a\", {\"color\": \"rgb(57, 175, 215)\"}, ALL)\n+// We select headings (h2, h3, h...).\n+assert-css: (\".docblock > :not(p) > a\", {\"color\": \"rgb(57, 175, 215)\"}, ALL)\n \n // Dark theme\n local-storage: {\n@@ -78,7 +79,8 @@ goto: file://|DOC_PATH|/test_docs/index.html\n assert-css: (\".small-section-header a\", {\"color\": \"rgb(221, 221, 221)\"}, ALL)\n \n goto: file://|DOC_PATH|/test_docs/struct.HeavilyDocumentedStruct.html\n-assert-css: (\".section-header a\", {\"color\": \"rgb(210, 153, 29)\"}, ALL)\n+// We select headings (h2, h3, h...).\n+assert-css: (\".docblock > :not(p) > a\", {\"color\": \"rgb(210, 153, 29)\"}, ALL)\n \n // Light theme\n local-storage: {\"rustdoc-theme\": \"light\", \"rustdoc-use-system-theme\": \"false\"}\n@@ -111,4 +113,5 @@ goto: file://|DOC_PATH|/test_docs/index.html\n assert-css: (\".small-section-header a\", {\"color\": \"rgb(0, 0, 0)\"}, ALL)\n \n goto: file://|DOC_PATH|/test_docs/struct.HeavilyDocumentedStruct.html\n-assert-css: (\".section-header a\", {\"color\": \"rgb(56, 115, 173)\"}, ALL)\n+// We select headings (h2, h3, h...).\n+assert-css: (\".docblock > :not(p) > a\", {\"color\": \"rgb(56, 115, 173)\"}, ALL)"}]}