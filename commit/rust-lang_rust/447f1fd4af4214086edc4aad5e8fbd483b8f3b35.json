{"sha": "447f1fd4af4214086edc4aad5e8fbd483b8f3b35", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0N2YxZmQ0YWY0MjE0MDg2ZWRjNGFhZDVlOGZiZDQ4M2I4ZjNiMzU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-17T02:08:17Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-17T05:12:35Z"}, "message": "rustdoc: Add a pass type and a run_passes function", "tree": {"sha": "5428172426e8355d50a1b0c4579e6b38bc92fa78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5428172426e8355d50a1b0c4579e6b38bc92fa78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/447f1fd4af4214086edc4aad5e8fbd483b8f3b35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/447f1fd4af4214086edc4aad5e8fbd483b8f3b35", "html_url": "https://github.com/rust-lang/rust/commit/447f1fd4af4214086edc4aad5e8fbd483b8f3b35", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/447f1fd4af4214086edc4aad5e8fbd483b8f3b35/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74d4989876df49d5f3504d9196aa3d8b8392ab79", "url": "https://api.github.com/repos/rust-lang/rust/commits/74d4989876df49d5f3504d9196aa3d8b8392ab79", "html_url": "https://github.com/rust-lang/rust/commit/74d4989876df49d5f3504d9196aa3d8b8392ab79"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "1c55b1a38ec2dd0ab7b00486639ffde0f93bc5d5", "filename": "src/rustdoc/rustdoc.rs", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/447f1fd4af4214086edc4aad5e8fbd483b8f3b35/src%2Frustdoc%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/447f1fd4af4214086edc4aad5e8fbd483b8f3b35/src%2Frustdoc%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rs?ref=447f1fd4af4214086edc4aad5e8fbd483b8f3b35", "patch": "@@ -5,6 +5,53 @@\n use std;\n use rustc;\n \n+type pass = fn~(srv: astsrv::seq_srv, doc: doc::cratedoc) -> doc::cratedoc;\n+\n+fn run_passes(\n+    srv: astsrv::seq_srv,\n+    doc: doc::cratedoc,\n+    passes: [pass]\n+) -> doc::cratedoc {\n+    vec::foldl(doc, passes) {|doc, pass|\n+        pass(srv, doc)\n+    }\n+}\n+\n+#[test]\n+fn test_run_passes() {\n+    import astsrv::seq_srv;\n+    fn pass1(\n+        _srv: astsrv::seq_srv,\n+        doc: doc::cratedoc\n+    ) -> doc::cratedoc {\n+        ~{\n+            topmod: ~{\n+                name: doc.topmod.name + \"two\",\n+                mods: doc::modlist([]),\n+                fns: doc::fnlist([])\n+            }\n+        }\n+    }\n+    fn pass2(\n+        _srv: astsrv::seq_srv,\n+        doc: doc::cratedoc\n+    ) -> doc::cratedoc {\n+        ~{\n+            topmod: ~{\n+                name: doc.topmod.name + \"three\",\n+                mods: doc::modlist([]),\n+                fns: doc::fnlist([])\n+            }\n+        }\n+    }\n+    let source = \"\";\n+    let srv = astsrv::mk_seq_srv_from_str(source);\n+    let passes = [pass1, pass2];\n+    let doc = extract::from_srv(srv, \"one\");\n+    let doc = run_passes(srv, doc, passes);\n+    assert doc.topmod.name == \"onetwothree\";\n+}\n+\n #[doc(\n   brief = \"Main function.\",\n   desc = \"Command-line arguments:"}]}