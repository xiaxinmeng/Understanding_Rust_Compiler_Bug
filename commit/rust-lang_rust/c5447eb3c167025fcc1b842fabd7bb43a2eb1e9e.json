{"sha": "c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1NDQ3ZWIzYzE2NzAyNWZjYzFiODQyZmFiZDdiYjQzYTJlYjFlOWU=", "commit": {"author": {"name": "Hirochika Matsumoto", "email": "matsujika@gmail.com", "date": "2020-10-18T08:17:45Z"}, "committer": {"name": "Hirochika Matsumoto", "email": "matsujika@gmail.com", "date": "2020-11-17T16:28:37Z"}, "message": "Make lint skip macros", "tree": {"sha": "d4da3646d8aa352530c0795407321c6a9a2cc9cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4da3646d8aa352530c0795407321c6a9a2cc9cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "html_url": "https://github.com/rust-lang/rust/commit/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/comments", "author": {"login": "hkmatsumoto", "id": 57856193, "node_id": "MDQ6VXNlcjU3ODU2MTkz", "avatar_url": "https://avatars.githubusercontent.com/u/57856193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkmatsumoto", "html_url": "https://github.com/hkmatsumoto", "followers_url": "https://api.github.com/users/hkmatsumoto/followers", "following_url": "https://api.github.com/users/hkmatsumoto/following{/other_user}", "gists_url": "https://api.github.com/users/hkmatsumoto/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkmatsumoto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkmatsumoto/subscriptions", "organizations_url": "https://api.github.com/users/hkmatsumoto/orgs", "repos_url": "https://api.github.com/users/hkmatsumoto/repos", "events_url": "https://api.github.com/users/hkmatsumoto/events{/privacy}", "received_events_url": "https://api.github.com/users/hkmatsumoto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hkmatsumoto", "id": 57856193, "node_id": "MDQ6VXNlcjU3ODU2MTkz", "avatar_url": "https://avatars.githubusercontent.com/u/57856193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkmatsumoto", "html_url": "https://github.com/hkmatsumoto", "followers_url": "https://api.github.com/users/hkmatsumoto/followers", "following_url": "https://api.github.com/users/hkmatsumoto/following{/other_user}", "gists_url": "https://api.github.com/users/hkmatsumoto/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkmatsumoto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkmatsumoto/subscriptions", "organizations_url": "https://api.github.com/users/hkmatsumoto/orgs", "repos_url": "https://api.github.com/users/hkmatsumoto/repos", "events_url": "https://api.github.com/users/hkmatsumoto/events{/privacy}", "received_events_url": "https://api.github.com/users/hkmatsumoto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "12474c62ff89ab122c2e6881b00680913fdf1d35", "url": "https://api.github.com/repos/rust-lang/rust/commits/12474c62ff89ab122c2e6881b00680913fdf1d35", "html_url": "https://github.com/rust-lang/rust/commit/12474c62ff89ab122c2e6881b00680913fdf1d35"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "7ec523293c8e99e7e947125460aea8b0d470b58b", "filename": "clippy_lints/src/unnecessary_wrap.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/clippy_lints%2Fsrc%2Funnecessary_wrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/clippy_lints%2Fsrc%2Funnecessary_wrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funnecessary_wrap.rs?ref=c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::{\n-    is_type_diagnostic_item, match_qpath, paths, return_ty, snippet, span_lint_and_then,\n+    in_macro, is_type_diagnostic_item, match_qpath, paths, return_ty, snippet, span_lint_and_then,\n     visitors::find_all_ret_expressions,\n };\n use if_chain::if_chain;\n@@ -84,6 +84,7 @@ impl<'tcx> LateLintPass<'tcx> for UnnecessaryWrap {\n         let mut suggs = Vec::new();\n         let can_sugg = find_all_ret_expressions(cx, &body.value, |ret_expr| {\n             if_chain! {\n+                if !in_macro(ret_expr.span);\n                 if let ExprKind::Call(ref func, ref args) = ret_expr.kind;\n                 if let ExprKind::Path(ref qpath) = func.kind;\n                 if match_qpath(qpath, path);"}, {"sha": "618c452065b9461db53cab89661bec9af49e9c44", "filename": "tests/ui/unnecessary_wrap.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/tests%2Fui%2Funnecessary_wrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/tests%2Fui%2Funnecessary_wrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_wrap.rs?ref=c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "patch": "@@ -76,16 +76,21 @@ fn func9(a: bool) -> Result<i32, ()> {\n     Err(())\n }\n \n+// should not be linted\n+fn func10() -> Option<()> {\n+    unimplemented!()\n+}\n+\n struct A;\n \n impl A {\n     // should not be linted\n-    pub fn func10() -> Option<i32> {\n+    pub fn func11() -> Option<i32> {\n         Some(1)\n     }\n \n     // should be linted\n-    fn func11() -> Option<i32> {\n+    fn func12() -> Option<i32> {\n         Some(1)\n     }\n }"}, {"sha": "5f21b74bc7600ec905737bae21751bf4d820c1f3", "filename": "tests/ui/unnecessary_wrap.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/tests%2Fui%2Funnecessary_wrap.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e/tests%2Fui%2Funnecessary_wrap.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_wrap.stderr?ref=c5447eb3c167025fcc1b842fabd7bb43a2eb1e9e", "patch": "@@ -86,16 +86,16 @@ LL |     1\n    |\n \n error: this function's return value is unnecessarily wrapped by `Option`\n-  --> $DIR/unnecessary_wrap.rs:88:5\n+  --> $DIR/unnecessary_wrap.rs:93:5\n    |\n-LL | /     fn func11() -> Option<i32> {\n+LL | /     fn func12() -> Option<i32> {\n LL | |         Some(1)\n LL | |     }\n    | |_____^\n    |\n help: remove `Option` from the return type...\n    |\n-LL |     fn func11() -> i32 {\n+LL |     fn func12() -> i32 {\n    |                    ^^^\n help: ...and change the returning expressions\n    |"}]}