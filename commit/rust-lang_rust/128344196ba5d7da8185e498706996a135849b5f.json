{"sha": "128344196ba5d7da8185e498706996a135849b5f", "node_id": "C_kwDOAAsO6NoAKDEyODM0NDE5NmJhNWQ3ZGE4MTg1ZTQ5ODcwNjk5NmExMzU4NDliNWY", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2022-10-07T18:24:02Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2022-10-07T18:24:02Z"}, "message": "Let llvm-config tell us where to find its tools", "tree": {"sha": "f237ceaa24f35f3ea14276ce7101bbb92e72360b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f237ceaa24f35f3ea14276ce7101bbb92e72360b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/128344196ba5d7da8185e498706996a135849b5f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/128344196ba5d7da8185e498706996a135849b5f", "html_url": "https://github.com/rust-lang/rust/commit/128344196ba5d7da8185e498706996a135849b5f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/128344196ba5d7da8185e498706996a135849b5f/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43c22af267fd9337bc05382b2771dde49d2e9f26", "url": "https://api.github.com/repos/rust-lang/rust/commits/43c22af267fd9337bc05382b2771dde49d2e9f26", "html_url": "https://github.com/rust-lang/rust/commit/43c22af267fd9337bc05382b2771dde49d2e9f26"}], "stats": {"total": 13, "additions": 4, "deletions": 9}, "files": [{"sha": "fcd4148145163bee6dfb6eefb559d99422d749d7", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/128344196ba5d7da8185e498706996a135849b5f/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/128344196ba5d7da8185e498706996a135849b5f/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=128344196ba5d7da8185e498706996a135849b5f", "patch": "@@ -497,18 +497,13 @@ impl Step for Llvm {\n \n         // https://llvm.org/docs/HowToCrossCompileLLVM.html\n         if target != builder.config.build {\n-            builder.ensure(Llvm { target: builder.config.build });\n-            // FIXME: if the llvm root for the build triple is overridden then we\n-            //        should use llvm-tblgen from there, also should verify that it\n-            //        actually exists most of the time in normal installs of LLVM.\n-            let host_bin = builder.llvm_out(builder.config.build).join(\"bin\");\n+            let llvm_config = builder.ensure(Llvm { target: builder.config.build });\n+            let llvm_bindir = output(Command::new(&llvm_config).arg(\"--bindir\"));\n+            let host_bin = Path::new(llvm_bindir.trim());\n             cfg.define(\"LLVM_TABLEGEN\", host_bin.join(\"llvm-tblgen\").with_extension(EXE_EXTENSION));\n             // LLVM_NM is required for cross compiling using MSVC\n             cfg.define(\"LLVM_NM\", host_bin.join(\"llvm-nm\").with_extension(EXE_EXTENSION));\n-            cfg.define(\n-                \"LLVM_CONFIG_PATH\",\n-                host_bin.join(\"llvm-config\").with_extension(EXE_EXTENSION),\n-            );\n+            cfg.define(\"LLVM_CONFIG_PATH\", llvm_config);\n             if builder.config.llvm_clang {\n                 let build_bin = builder.llvm_out(builder.config.build).join(\"build\").join(\"bin\");\n                 let clang_tblgen = build_bin.join(\"clang-tblgen\").with_extension(EXE_EXTENSION);"}]}