{"sha": "8541435e8d238c93cd9c72dae406f4135c162d25", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1NDE0MzVlOGQyMzhjOTNjZDljNzJkYWU0MDZmNDEzNWMxNjJkMjU=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-02-23T01:51:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-23T01:51:54Z"}, "message": "Rollup merge of #82234 - GuillaumeGomez:remove-query-param-on-esc, r=Nemo157\n\nRemove query parameters when skipping search results\n\nFixes #81330.\n\nThis PR changes the following: when pressing ESC and that no other \"action\" was performed (understand: no closing the search result, or hiding a menu or something along the line), then we discard the URL query parameters (the `?whatever=dsjfs`). What do you think about this change ```@rust-lang/rustdoc``` ?\n\nEDIT: finally we're simply removing the query parameter when we're skipping the search results.\n\nr? ```@Nemo157```", "tree": {"sha": "8fae6be31930a319f1f24c0cf2f933551fe19def", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8fae6be31930a319f1f24c0cf2f933551fe19def"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8541435e8d238c93cd9c72dae406f4135c162d25", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgNF+6CRBK7hj4Ov3rIwAAdHIIAIZKzYZ1zzmmgCd9oCmmQMpE\nAi7g4XW/0ujWk/z2GpOuEmXmtAJ7v273COuQvPbiHmyoMLdw15QAOIwR8EpGBO88\nJsAzNtrx9F9GXEKzErj/zskuxwCB/BDpur5kN4GTXZmYnh6OjGAT8Ftm5xKsQj70\n7b+/j5roG7ExAjm3jCGprRL+c9QsnU8pepKZahl8KFSMcWfyHparzIy8fWHCi5Io\nnpb0wa4TdKBaYk864+QWc4DJf/IeWiGpqGsM9CbsnR2qiDBE2/81+tmipIISQ4IB\ncXW09srI6FivMdp0cCx75cCWe7mQefzNKoRYh87xnYyPfun1E1/CseW+we14EeY=\n=lf42\n-----END PGP SIGNATURE-----\n", "payload": "tree 8fae6be31930a319f1f24c0cf2f933551fe19def\nparent 8979fd42379628201896a5c0dd478c0a5dbd3405\nparent eeb555266764069937491a26e817d4bcfea5da3a\nauthor Dylan DPC <dylan.dpc@gmail.com> 1614045114 +0100\ncommitter GitHub <noreply@github.com> 1614045114 +0100\n\nRollup merge of #82234 - GuillaumeGomez:remove-query-param-on-esc, r=Nemo157\n\nRemove query parameters when skipping search results\n\nFixes #81330.\n\nThis PR changes the following: when pressing ESC and that no other \"action\" was performed (understand: no closing the search result, or hiding a menu or something along the line), then we discard the URL query parameters (the `?whatever=dsjfs`). What do you think about this change ```@rust-lang/rustdoc``` ?\n\nEDIT: finally we're simply removing the query parameter when we're skipping the search results.\n\nr? ```@Nemo157```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8541435e8d238c93cd9c72dae406f4135c162d25", "html_url": "https://github.com/rust-lang/rust/commit/8541435e8d238c93cd9c72dae406f4135c162d25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8541435e8d238c93cd9c72dae406f4135c162d25/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8979fd42379628201896a5c0dd478c0a5dbd3405", "url": "https://api.github.com/repos/rust-lang/rust/commits/8979fd42379628201896a5c0dd478c0a5dbd3405", "html_url": "https://github.com/rust-lang/rust/commit/8979fd42379628201896a5c0dd478c0a5dbd3405"}, {"sha": "eeb555266764069937491a26e817d4bcfea5da3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/eeb555266764069937491a26e817d4bcfea5da3a", "html_url": "https://github.com/rust-lang/rust/commit/eeb555266764069937491a26e817d4bcfea5da3a"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "6da3b54289b2a50e06420aefe355fe5b68baf788", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8541435e8d238c93cd9c72dae406f4135c162d25/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/8541435e8d238c93cd9c72dae406f4135c162d25/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=8541435e8d238c93cd9c72dae406f4135c162d25", "patch": "@@ -101,7 +101,7 @@ function focusSearchBar() {\n     getSearchInput().focus();\n }\n \n-// Removes the focus from the search bar\n+// Removes the focus from the search bar.\n function defocusSearchBar() {\n     getSearchInput().blur();\n }\n@@ -220,6 +220,11 @@ function defocusSearchBar() {\n         addClass(search, \"hidden\");\n         removeClass(main, \"hidden\");\n         document.title = titleBeforeSearch;\n+        // We also remove the query parameter from the URL.\n+        if (browserSupportsHistoryApi()) {\n+            history.replaceState(\"\", window.currentCrate + \" - Rust\",\n+                getNakedUrl() + window.location.hash);\n+        }\n     }\n \n     // used for special search precedence"}]}