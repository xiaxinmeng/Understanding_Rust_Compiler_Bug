{"sha": "f13adc5f9d50f66b3b86589c35e49c92af807f23", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxM2FkYzVmOWQ1MGY2NmIzYjg2NTg5YzM1ZTQ5YzkyYWY4MDdmMjM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-10-01T23:47:36Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-10-03T22:12:29Z"}, "message": "metadata: Remove `CrateMetadata::host_lib`\n\nIt was only used for retreiving edition, which was a bug.\nIn case of dual proc macros the edition should be taken from the target crate version, like any other metadata.", "tree": {"sha": "7e531ea1ad62f207f3938a9e1b3eb292527b98e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e531ea1ad62f207f3938a9e1b3eb292527b98e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f13adc5f9d50f66b3b86589c35e49c92af807f23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f13adc5f9d50f66b3b86589c35e49c92af807f23", "html_url": "https://github.com/rust-lang/rust/commit/f13adc5f9d50f66b3b86589c35e49c92af807f23", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f13adc5f9d50f66b3b86589c35e49c92af807f23/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "92386a7ff37a2a7a01b187afefc51f326e923377", "url": "https://api.github.com/repos/rust-lang/rust/commits/92386a7ff37a2a7a01b187afefc51f326e923377", "html_url": "https://github.com/rust-lang/rust/commit/92386a7ff37a2a7a01b187afefc51f326e923377"}], "stats": {"total": 10, "additions": 1, "deletions": 9}, "files": [{"sha": "f2980941082f45b6e196b3c0d02bec536ccb8510", "filename": "src/librustc_metadata/creader.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcreader.rs?ref=f13adc5f9d50f66b3b86589c35e49c92af807f23", "patch": "@@ -271,7 +271,6 @@ impl<'a> CrateLoader<'a> {\n             },\n             private_dep,\n             span,\n-            host_lib,\n             raw_proc_macros\n         };\n "}, {"sha": "d8bbe23b8ecbca7f7a6dd855ed83c7ccfe6d61f0", "filename": "src/librustc_metadata/cstore.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcstore.rs?ref=f13adc5f9d50f66b3b86589c35e49c92af807f23", "patch": "@@ -28,7 +28,6 @@ pub use crate::cstore_impl::{provide, provide_extern};\n pub type CrateNumMap = IndexVec<CrateNum, CrateNum>;\n \n pub use rustc_data_structures::sync::MetadataRef;\n-use crate::creader::Library;\n use syntax_pos::Span;\n use proc_macro::bridge::client::ProcMacro;\n \n@@ -85,7 +84,6 @@ pub struct CrateMetadata {\n     /// for purposes of the 'exported_private_dependencies' lint\n     pub private_dep: bool,\n \n-    pub host_lib: Option<Library>,\n     pub span: Span,\n \n     pub raw_proc_macros: Option<&'static [ProcMacro]>,"}, {"sha": "6681cf3052f2bd33fb3bf3bd5abc8c6920ac00d7", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f13adc5f9d50f66b3b86589c35e49c92af807f23/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=f13adc5f9d50f66b3b86589c35e49c92af807f23", "patch": "@@ -543,18 +543,13 @@ impl<'a, 'tcx> CrateMetadata {\n                 name, SyntaxExtensionKind::Bang(Box::new(BangProcMacro { client })), Vec::new()\n             )\n         };\n-        let edition = if sess.opts.debugging_opts.dual_proc_macros {\n-            self.host_lib.as_ref().unwrap().metadata.get_root().edition\n-        } else {\n-            self.root.edition\n-        };\n \n         SyntaxExtension::new(\n             &sess.parse_sess,\n             kind,\n             self.get_span(id, sess),\n             helper_attrs,\n-            edition,\n+            self.root.edition,\n             Symbol::intern(name),\n             &self.get_attributes(&self.entry(id), sess),\n         )"}]}