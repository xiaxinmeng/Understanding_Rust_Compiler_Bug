{"sha": "c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0YWJkY2YwYWM4ZmQ5NjQzZjFjMTk2YTQxOGUwMzJlODVjMTk4OGM=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-17T09:06:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-17T09:06:27Z"}, "message": "Rollup merge of #79097 - GuillaumeGomez:code-block-invalid-html-tag-lint, r=jyn514\n\nCode block invalid html tag lint\n\nFixes #79095\n\nr? ``@jyn514``", "tree": {"sha": "434c88de803d86f55de167e00001d2a23cb2beae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/434c88de803d86f55de167e00001d2a23cb2beae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfs5KTCRBK7hj4Ov3rIwAAdHIIAAT+t0MYN4uqr0s2sSx5b9jd\n5yKGmOeGtG0XWV+KcNJ8yyQByHwreXRMvZhxREai1ZVmVlPNMASECTUIO5PlfMmH\ncN3LJX2SAHFsIU+U1tQHpHcdj5kO4F2DbQ8vasn8ocD/N1EgSFZ2JEhbmW2H4PPF\nzHNUfiCDlY9Bo2XAQzY20hpQcfztFy5vVYN+QSgoNN5znFPO4AYPeyDEMi3J2uIF\n2GXLNhoWVHgN0o8NN+h7L4Ikg6RVW2CczzuoOKd/RqvuCHkIYU76jfzV0LfHQd1j\nqSowMIu4vjp3ysfnanseAdIQqwxO3C03AdZ1wGDOJtuWXUAchuE3uUax1tkZge4=\n=orGq\n-----END PGP SIGNATURE-----\n", "payload": "tree 434c88de803d86f55de167e00001d2a23cb2beae\nparent c459ab3a0f6ddb980d03abf68ed08ffd1bf41307\nparent bbd302bab469a1da3804a4b998817ccbf15c874e\nauthor Mara Bos <m-ou.se@m-ou.se> 1605603987 +0100\ncommitter GitHub <noreply@github.com> 1605603987 +0100\n\nRollup merge of #79097 - GuillaumeGomez:code-block-invalid-html-tag-lint, r=jyn514\n\nCode block invalid html tag lint\n\nFixes #79095\n\nr? ``@jyn514``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "html_url": "https://github.com/rust-lang/rust/commit/c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4abdcf0ac8fd9643f1c196a418e032e85c1988c/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c459ab3a0f6ddb980d03abf68ed08ffd1bf41307", "url": "https://api.github.com/repos/rust-lang/rust/commits/c459ab3a0f6ddb980d03abf68ed08ffd1bf41307", "html_url": "https://github.com/rust-lang/rust/commit/c459ab3a0f6ddb980d03abf68ed08ffd1bf41307"}, {"sha": "bbd302bab469a1da3804a4b998817ccbf15c874e", "url": "https://api.github.com/repos/rust-lang/rust/commits/bbd302bab469a1da3804a4b998817ccbf15c874e", "html_url": "https://github.com/rust-lang/rust/commit/bbd302bab469a1da3804a4b998817ccbf15c874e"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "70748633117fb27e2bf0185b0dcb27f2920712e5", "filename": "src/librustdoc/passes/html_tags.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c4abdcf0ac8fd9643f1c196a418e032e85c1988c/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4abdcf0ac8fd9643f1c196a418e032e85c1988c/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs?ref=c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "patch": "@@ -4,7 +4,7 @@ use crate::core::DocContext;\n use crate::fold::DocFolder;\n use crate::html::markdown::opts;\n use core::ops::Range;\n-use pulldown_cmark::{Event, Parser};\n+use pulldown_cmark::{Event, Parser, Tag};\n use rustc_session::lint;\n use std::iter::Peekable;\n use std::str::CharIndices;\n@@ -196,14 +196,17 @@ impl<'a, 'tcx> DocFolder for InvalidHtmlTagsLinter<'a, 'tcx> {\n \n             let mut tags = Vec::new();\n             let mut is_in_comment = None;\n+            let mut in_code_block = false;\n \n             let p = Parser::new_ext(&dox, opts()).into_offset_iter();\n \n             for (event, range) in p {\n                 match event {\n-                    Event::Html(text) | Event::Text(text) => {\n+                    Event::Start(Tag::CodeBlock(_)) => in_code_block = true,\n+                    Event::Html(text) | Event::Text(text) if !in_code_block => {\n                         extract_tags(&mut tags, &text, range, &mut is_in_comment, &report_diag)\n                     }\n+                    Event::End(Tag::CodeBlock(_)) => in_code_block = false,\n                     _ => {}\n                 }\n             }"}, {"sha": "9c2fc4beb5eb1fff379e6bb1e5bf6a2a67a92d18", "filename": "src/test/rustdoc-ui/invalid-html-tags.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c4abdcf0ac8fd9643f1c196a418e032e85c1988c/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4abdcf0ac8fd9643f1c196a418e032e85c1988c/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs?ref=c4abdcf0ac8fd9643f1c196a418e032e85c1988c", "patch": "@@ -87,3 +87,24 @@ pub fn h() {}\n /// <!--\n //~^ ERROR Unclosed HTML comment\n pub fn i() {}\n+\n+/// hello\n+///\n+/// ```\n+/// uiapp.run(&env::args().collect::<Vec<_>>());\n+/// ```\n+pub fn j() {}\n+\n+// Check that nested codeblocks are working as well\n+/// hello\n+///\n+/// ``````markdown\n+/// normal markdown\n+///\n+/// ```\n+/// uiapp.run(&env::args().collect::<Vec<_>>());\n+/// ```\n+///\n+/// <Vec<_> shouldn't warn!\n+/// ``````\n+pub fn k() {}"}]}