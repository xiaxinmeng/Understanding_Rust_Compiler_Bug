{"sha": "9db8e183dc17896ce5f307f6de19c261d746a9bc", "node_id": "C_kwDOAAsO6NoAKDlkYjhlMTgzZGMxNzg5NmNlNWYzMDdmNmRlMTljMjYxZDc0NmE5YmM", "commit": {"author": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-11-11T20:22:47Z"}, "committer": {"name": "yukang", "email": "moorekang@gmail.com", "date": "2022-11-15T00:58:19Z"}, "message": "fix #104088, Slightly improve error message for invalid identifier", "tree": {"sha": "b3c6e8b4903ff4d7d55a3d3721e259c97f39921d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3c6e8b4903ff4d7d55a3d3721e259c97f39921d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9db8e183dc17896ce5f307f6de19c261d746a9bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9db8e183dc17896ce5f307f6de19c261d746a9bc", "html_url": "https://github.com/rust-lang/rust/commit/9db8e183dc17896ce5f307f6de19c261d746a9bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9db8e183dc17896ce5f307f6de19c261d746a9bc/comments", "author": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "101e1822c3e54e63996c8aaa014d55716f3937eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/101e1822c3e54e63996c8aaa014d55716f3937eb", "html_url": "https://github.com/rust-lang/rust/commit/101e1822c3e54e63996c8aaa014d55716f3937eb"}], "stats": {"total": 83, "additions": 81, "deletions": 2}, "files": [{"sha": "4c7ce30097c95f324050b0d93ae2cc2770e1615c", "filename": "compiler/rustc_error_messages/locales/en-US/parser.ftl", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fparser.ftl?ref=9db8e183dc17896ce5f307f6de19c261d746a9bc", "patch": "@@ -384,3 +384,6 @@ parser_fn_ptr_with_generics = function pointer types may not have generic parame\n         [true] the\n         *[false] a\n     } `for` parameter list\n+\n+parser_invalid_identifier_with_leading_number = expected identifier, found number literal\n+    .label = identifiers cannot start with a number"}, {"sha": "2b17cea97949a2cdfd1cecfcd17a56af5387dea6", "filename": "compiler/rustc_parse/src/errors.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Ferrors.rs?ref=9db8e183dc17896ce5f307f6de19c261d746a9bc", "patch": "@@ -1205,6 +1205,14 @@ pub(crate) struct SelfParamNotFirst {\n     pub span: Span,\n }\n \n+#[derive(Diagnostic)]\n+#[diag(parser_invalid_identifier_with_leading_number)]\n+pub(crate) struct InvalidIdentiferStartsWithNumber {\n+    #[primary_span]\n+    #[label]\n+    pub span: Span,\n+}\n+\n #[derive(Diagnostic)]\n #[diag(parser_const_generic_without_braces)]\n pub(crate) struct ConstGenericWithoutBraces {"}, {"sha": "c2c3ff64ec70139618d17f00e2749042f8861e67", "filename": "compiler/rustc_parse/src/parser/stmt.rs", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db8e183dc17896ce5f307f6de19c261d746a9bc/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs?ref=9db8e183dc17896ce5f307f6de19c261d746a9bc", "patch": "@@ -10,8 +10,8 @@ use super::{\n use crate::errors::{\n     AssignmentElseNotAllowed, CompoundAssignmentExpressionInLet, ConstLetMutuallyExclusive,\n     DocCommentDoesNotDocumentAnything, ExpectedStatementAfterOuterAttr, InvalidCurlyInLetElse,\n-    InvalidExpressionInLetElse, InvalidVariableDeclaration, InvalidVariableDeclarationSub,\n-    WrapExpressionInParentheses,\n+    InvalidExpressionInLetElse, InvalidIdentiferStartsWithNumber, InvalidVariableDeclaration,\n+    InvalidVariableDeclarationSub, WrapExpressionInParentheses,\n };\n use crate::maybe_whole;\n \n@@ -264,6 +264,7 @@ impl<'a> Parser<'a> {\n             self.bump();\n         }\n \n+        self.report_invalid_identifier_error()?;\n         let (pat, colon) = self.parse_pat_before_ty(None, RecoverComma::Yes, \"`let` bindings\")?;\n \n         let (err, ty) = if colon {\n@@ -355,6 +356,18 @@ impl<'a> Parser<'a> {\n         Ok(P(ast::Local { ty, pat, kind, id: DUMMY_NODE_ID, span: lo.to(hi), attrs, tokens: None }))\n     }\n \n+    /// report error for `let 1x = 123`\n+    pub fn report_invalid_identifier_error(&mut self) -> PResult<'a, ()> {\n+        if let token::Literal(lit) = self.token.uninterpolate().kind &&\n+            let Err(_) = rustc_ast::Lit::from_token(&self.token) &&\n+            (lit.kind == token::LitKind::Integer || lit.kind == token::LitKind::Float) &&\n+            self.look_ahead(1, |t| matches!(t.kind, token::Eq) || matches!(t.kind, token::Colon ) ) {\n+                let err = self.sess.create_err(InvalidIdentiferStartsWithNumber { span: self.token.span });\n+                return Err(err);\n+        }\n+        Ok(())\n+    }\n+\n     fn check_let_else_init_bool_expr(&self, init: &ast::Expr) {\n         if let ast::ExprKind::Binary(op, ..) = init.kind {\n             if op.node.lazy() {"}, {"sha": "5f794fe2dc924500ba36f4a77bfccf864b5a2ecd", "filename": "src/test/ui/parser/issues/issue-104088.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9db8e183dc17896ce5f307f6de19c261d746a9bc/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9db8e183dc17896ce5f307f6de19c261d746a9bc/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.rs?ref=9db8e183dc17896ce5f307f6de19c261d746a9bc", "patch": "@@ -0,0 +1,26 @@\n+fn test() {\n+    if let 123 = 123 { println!(\"yes\"); }\n+}\n+\n+fn test_2() {\n+    let 1x = 123;\n+    //~^ ERROR expected identifier, found number literal\n+}\n+\n+fn test_3() {\n+    let 2x: i32 = 123;\n+    //~^ ERROR expected identifier, found number literal\n+}\n+\n+fn test_4() {\n+    if let 2e1 = 123 {\n+        //~^ ERROR mismatched types\n+    }\n+}\n+\n+fn test_5() {\n+    let 23name = 123;\n+    //~^ ERROR expected identifier, found number literal\n+}\n+\n+fn main() {}"}, {"sha": "ff4b4bdb6953e13673c1814b56f755c6e9f69462", "filename": "src/test/ui/parser/issues/issue-104088.stderr", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/9db8e183dc17896ce5f307f6de19c261d746a9bc/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9db8e183dc17896ce5f307f6de19c261d746a9bc/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-104088.stderr?ref=9db8e183dc17896ce5f307f6de19c261d746a9bc", "patch": "@@ -0,0 +1,29 @@\n+error: expected identifier, found number literal\n+  --> $DIR/issue-104088.rs:6:9\n+   |\n+LL |     let 1x = 123;\n+   |         ^^ identifiers cannot start with a number\n+\n+error: expected identifier, found number literal\n+  --> $DIR/issue-104088.rs:11:9\n+   |\n+LL |     let 2x: i32 = 123;\n+   |         ^^ identifiers cannot start with a number\n+\n+error: expected identifier, found number literal\n+  --> $DIR/issue-104088.rs:22:9\n+   |\n+LL |     let 23name = 123;\n+   |         ^^^^^^ identifiers cannot start with a number\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-104088.rs:16:12\n+   |\n+LL |     if let 2e1 = 123 {\n+   |            ^^^   --- this expression has type `{integer}`\n+   |            |\n+   |            expected integer, found floating-point number\n+\n+error: aborting due to 4 previous errors\n+\n+For more information about this error, try `rustc --explain E0308`."}]}