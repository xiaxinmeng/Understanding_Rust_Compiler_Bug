{"sha": "6a64d3c4df53ceac10c270de43738d8e547dfd2a", "node_id": "C_kwDOAAsO6NoAKDZhNjRkM2M0ZGY1M2NlYWMxMGMyNzBkZTQzNzM4ZDhlNTQ3ZGZkMmE", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-01-19T10:31:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-19T10:31:27Z"}, "message": "Merge #11314\n\n11314: fix: Don't load auxiliary crates outside the workspace r=jonas-schievink a=jonas-schievink\n\nI'm a bit unsure about this change since this might have unanticipated consequences, but this does fix https://github.com/rust-analyzer/rust-analyzer/issues/11300.\n\nCo-authored-by: Jonas Schievink <jonas.schievink@ferrous-systems.com>", "tree": {"sha": "da9d9a0ab1a3787e403dd526db9de871623a19cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da9d9a0ab1a3787e403dd526db9de871623a19cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a64d3c4df53ceac10c270de43738d8e547dfd2a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh5+h/CRBK7hj4Ov3rIwAAhkYIAEkNlc+NiBfI9o3D11Q0U3nm\noc1roeWzTG12ICMfRVftnYWOsPs7XkhSwgGpi47s55+ImuvcxslbtXnoYGe5tEdn\nllpUy+qopB0x0QW6/tDwvw50/KLbZ9aYTxalmWjUgnkQyUlRHpp/j+Ut4Zlr6sU1\nygpD3rolsnDOqf9Wwa4QsI5OFadYgKb57df1TjVIJtXgEFvdCqeVPj6BLeUZzExg\nUY3pD7x13+zXCR70p72EOmdj3TUjOtzYvwjKbCvqfvpUqYiznU2M6uN6A4GLZylN\ne78h+FsCVJelVD3+NuChP2mbfwB2DvgZDw76Kmbpiqnio7l5Wjvtop25fCYUsc4=\n=2pc5\n-----END PGP SIGNATURE-----\n", "payload": "tree da9d9a0ab1a3787e403dd526db9de871623a19cd\nparent ac8806df0846ccc62ee396f38de41310ed1d9934\nparent c714c139a4506dd5f2c6e0ec5e45de8c3efe7967\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1642588287 +0000\ncommitter GitHub <noreply@github.com> 1642588287 +0000\n\nMerge #11314\n\n11314: fix: Don't load auxiliary crates outside the workspace r=jonas-schievink a=jonas-schievink\n\nI'm a bit unsure about this change since this might have unanticipated consequences, but this does fix https://github.com/rust-analyzer/rust-analyzer/issues/11300.\n\nCo-authored-by: Jonas Schievink <jonas.schievink@ferrous-systems.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a64d3c4df53ceac10c270de43738d8e547dfd2a", "html_url": "https://github.com/rust-lang/rust/commit/6a64d3c4df53ceac10c270de43738d8e547dfd2a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a64d3c4df53ceac10c270de43738d8e547dfd2a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac8806df0846ccc62ee396f38de41310ed1d9934", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac8806df0846ccc62ee396f38de41310ed1d9934", "html_url": "https://github.com/rust-lang/rust/commit/ac8806df0846ccc62ee396f38de41310ed1d9934"}, {"sha": "c714c139a4506dd5f2c6e0ec5e45de8c3efe7967", "url": "https://api.github.com/repos/rust-lang/rust/commits/c714c139a4506dd5f2c6e0ec5e45de8c3efe7967", "html_url": "https://github.com/rust-lang/rust/commit/c714c139a4506dd5f2c6e0ec5e45de8c3efe7967"}], "stats": {"total": 427, "additions": 9, "deletions": 418}, "files": [{"sha": "f87528fbae2a507def423f78252d11a66ecf1c22", "filename": "crates/project_model/src/tests.rs", "status": "modified", "additions": 0, "deletions": 418, "changes": 418, "blob_url": "https://github.com/rust-lang/rust/blob/6a64d3c4df53ceac10c270de43738d8e547dfd2a/crates%2Fproject_model%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a64d3c4df53ceac10c270de43738d8e547dfd2a/crates%2Fproject_model%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Ftests.rs?ref=6a64d3c4df53ceac10c270de43738d8e547dfd2a", "patch": "@@ -177,80 +177,6 @@ fn cargo_hello_world_project_model_with_wildcard_overrides() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        5,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            6,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"const_fn\",\n-                                ),\n-                                canonical_name: \"const_fn\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [\n-                            Dependency {\n-                                crate_id: CrateId(\n-                                    4,\n-                                ),\n-                                name: CrateName(\n-                                    \"libc\",\n-                                ),\n-                                prelude: true,\n-                            },\n-                        ],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         2,\n                     ): CrateData {\n@@ -459,70 +385,6 @@ fn cargo_hello_world_project_model_with_wildcard_overrides() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        6,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            7,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"build_script_build\",\n-                                ),\n-                                canonical_name: \"build-script-build\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         3,\n                     ): CrateData {\n@@ -682,80 +544,6 @@ fn cargo_hello_world_project_model_with_selective_overrides() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        5,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            6,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"const_fn\",\n-                                ),\n-                                canonical_name: \"const_fn\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [\n-                            Dependency {\n-                                crate_id: CrateId(\n-                                    4,\n-                                ),\n-                                name: CrateName(\n-                                    \"libc\",\n-                                ),\n-                                prelude: true,\n-                            },\n-                        ],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         2,\n                     ): CrateData {\n@@ -968,70 +756,6 @@ fn cargo_hello_world_project_model_with_selective_overrides() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        6,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            7,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"build_script_build\",\n-                                ),\n-                                canonical_name: \"build-script-build\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         3,\n                     ): CrateData {\n@@ -1184,82 +908,6 @@ fn cargo_hello_world_project_model() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        5,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            6,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"const_fn\",\n-                                ),\n-                                canonical_name: \"const_fn\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                                \"test\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                                \"test\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [\n-                            Dependency {\n-                                crate_id: CrateId(\n-                                    4,\n-                                ),\n-                                name: CrateName(\n-                                    \"libc\",\n-                                ),\n-                                prelude: true,\n-                            },\n-                        ],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         2,\n                     ): CrateData {\n@@ -1474,72 +1122,6 @@ fn cargo_hello_world_project_model() {\n                             repo: None,\n                         },\n                     },\n-                    CrateId(\n-                        6,\n-                    ): CrateData {\n-                        root_file_id: FileId(\n-                            7,\n-                        ),\n-                        edition: Edition2015,\n-                        version: Some(\n-                            \"0.2.98\",\n-                        ),\n-                        display_name: Some(\n-                            CrateDisplayName {\n-                                crate_name: CrateName(\n-                                    \"build_script_build\",\n-                                ),\n-                                canonical_name: \"build-script-build\",\n-                            },\n-                        ),\n-                        cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=default\",\n-                                \"feature=std\",\n-                                \"test\",\n-                            ],\n-                        ),\n-                        potential_cfg_options: CfgOptions(\n-                            [\n-                                \"debug_assertions\",\n-                                \"feature=align\",\n-                                \"feature=const-extern-fn\",\n-                                \"feature=default\",\n-                                \"feature=extra_traits\",\n-                                \"feature=rustc-dep-of-std\",\n-                                \"feature=std\",\n-                                \"feature=use_std\",\n-                                \"test\",\n-                            ],\n-                        ),\n-                        env: Env {\n-                            entries: {\n-                                \"CARGO_PKG_LICENSE\": \"\",\n-                                \"CARGO_PKG_VERSION_MAJOR\": \"0\",\n-                                \"CARGO_MANIFEST_DIR\": \"$ROOT$.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.98\",\n-                                \"CARGO_PKG_VERSION\": \"0.2.98\",\n-                                \"CARGO_PKG_AUTHORS\": \"\",\n-                                \"CARGO_CRATE_NAME\": \"libc\",\n-                                \"CARGO_PKG_LICENSE_FILE\": \"\",\n-                                \"CARGO_PKG_HOMEPAGE\": \"\",\n-                                \"CARGO_PKG_DESCRIPTION\": \"\",\n-                                \"CARGO_PKG_NAME\": \"libc\",\n-                                \"CARGO_PKG_VERSION_PATCH\": \"98\",\n-                                \"CARGO\": \"cargo\",\n-                                \"CARGO_PKG_REPOSITORY\": \"\",\n-                                \"CARGO_PKG_VERSION_MINOR\": \"2\",\n-                                \"CARGO_PKG_VERSION_PRE\": \"\",\n-                            },\n-                        },\n-                        dependencies: [],\n-                        proc_macro: [],\n-                        origin: CratesIo {\n-                            repo: Some(\n-                                \"https://github.com/rust-lang/libc\",\n-                            ),\n-                        },\n-                    },\n                     CrateId(\n                         3,\n                     ): CrateData {"}, {"sha": "96522bf070a4ccc1dddef77d689bb985d5d0b423", "filename": "crates/project_model/src/workspace.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6a64d3c4df53ceac10c270de43738d8e547dfd2a/crates%2Fproject_model%2Fsrc%2Fworkspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a64d3c4df53ceac10c270de43738d8e547dfd2a/crates%2Fproject_model%2Fsrc%2Fworkspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Fworkspace.rs?ref=6a64d3c4df53ceac10c270de43738d8e547dfd2a", "patch": "@@ -574,6 +574,15 @@ fn cargo_to_crate_graph(\n         has_private |= cargo[pkg].metadata.rustc_private;\n         let mut lib_tgt = None;\n         for &tgt in cargo[pkg].targets.iter() {\n+            if cargo[tgt].kind != TargetKind::Lib && !cargo[pkg].is_member {\n+                // For non-workspace-members, Cargo does not resolve dev-dependencies, so we don't\n+                // add any targets except the library target, since those will not work correctly if\n+                // they use dev-dependencies.\n+                // In fact, they can break quite badly if multiple client workspaces get merged:\n+                // https://github.com/rust-analyzer/rust-analyzer/issues/11300\n+                continue;\n+            }\n+\n             if let Some(file_id) = load(&cargo[tgt].root) {\n                 let crate_id = add_target_crate_root(\n                     &mut crate_graph,"}]}