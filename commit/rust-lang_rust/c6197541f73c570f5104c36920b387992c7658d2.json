{"sha": "c6197541f73c570f5104c36920b387992c7658d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2MTk3NTQxZjczYzU3MGY1MTA0YzM2OTIwYjM4Nzk5MmM3NjU4ZDI=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2019-05-06T13:05:26Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2019-05-06T13:05:26Z"}, "message": "Implement TypeFoldable for InferConst\n\nCo-Authored-By: Gabriel Smith <yodaldevoid@users.noreply.github.com>", "tree": {"sha": "b5fefc93b2ebd0ac946f25d316ac406cebd32027", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5fefc93b2ebd0ac946f25d316ac406cebd32027"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6197541f73c570f5104c36920b387992c7658d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6197541f73c570f5104c36920b387992c7658d2", "html_url": "https://github.com/rust-lang/rust/commit/c6197541f73c570f5104c36920b387992c7658d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6197541f73c570f5104c36920b387992c7658d2/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad78fcf5246c9accb2a35ced91d85b710648abc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad78fcf5246c9accb2a35ced91d85b710648abc9", "html_url": "https://github.com/rust-lang/rust/commit/ad78fcf5246c9accb2a35ced91d85b710648abc9"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "f81394a878f5aed061cc976597966fb54656d119", "filename": "src/librustc/ty/structural_impls.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c6197541f73c570f5104c36920b387992c7658d2/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6197541f73c570f5104c36920b387992c7658d2/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fstructural_impls.rs?ref=c6197541f73c570f5104c36920b387992c7658d2", "patch": "@@ -6,7 +6,7 @@\n use crate::hir::def::Namespace;\n use crate::mir::ProjectionKind;\n use crate::mir::interpret::ConstValue;\n-use crate::ty::{self, Lift, Ty, TyCtxt, ConstVid};\n+use crate::ty::{self, Lift, Ty, TyCtxt, ConstVid, InferConst};\n use crate::ty::fold::{TypeFoldable, TypeFolder, TypeVisitor};\n use crate::ty::print::{FmtPrinter, Printer};\n use rustc_data_structures::indexed_vec::{IndexVec, Idx};\n@@ -1352,8 +1352,7 @@ impl<'tcx> TypeFoldable<'tcx> for ConstValue<'tcx> {\n     fn super_fold_with<'gcx: 'tcx, F: TypeFolder<'gcx, 'tcx>>(&self, folder: &mut F) -> Self {\n         match *self {\n             ConstValue::ByRef(ptr, alloc) => ConstValue::ByRef(ptr, alloc),\n-            // FIXME(const_generics): implement TypeFoldable for InferConst\n-            ConstValue::Infer(ic) => ConstValue::Infer(ic),\n+            ConstValue::Infer(ic) => ConstValue::Infer(ic.fold_with(folder)),\n             ConstValue::Param(p) => ConstValue::Param(p.fold_with(folder)),\n             ConstValue::Placeholder(p) => ConstValue::Placeholder(p),\n             ConstValue::Scalar(a) => ConstValue::Scalar(a),\n@@ -1366,8 +1365,7 @@ impl<'tcx> TypeFoldable<'tcx> for ConstValue<'tcx> {\n     fn super_visit_with<V: TypeVisitor<'tcx>>(&self, visitor: &mut V) -> bool {\n         match *self {\n             ConstValue::ByRef(..) => false,\n-            // FIXME(const_generics): implement TypeFoldable for InferConst\n-            ConstValue::Infer(_) => false,\n+            ConstValue::Infer(ic) => ic.visit_with(visitor),\n             ConstValue::Param(p) => p.visit_with(visitor),\n             ConstValue::Placeholder(_) => false,\n             ConstValue::Scalar(_) => false,\n@@ -1376,3 +1374,13 @@ impl<'tcx> TypeFoldable<'tcx> for ConstValue<'tcx> {\n         }\n     }\n }\n+\n+impl<'tcx> TypeFoldable<'tcx> for InferConst<'tcx> {\n+    fn super_fold_with<'gcx: 'tcx, F: TypeFolder<'gcx, 'tcx>>(&self, _folder: &mut F) -> Self {\n+        *self\n+    }\n+\n+    fn super_visit_with<V: TypeVisitor<'tcx>>(&self, _visitor: &mut V) -> bool {\n+        false\n+    }\n+}"}]}