{"sha": "168238246fa6a6aa1da7e38d38a1977a96f43430", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2ODIzODI0NmZhNmE2YWExZGE3ZTM4ZDM4YTE5NzdhOTZmNDM0MzA=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-07-28T09:28:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-28T09:28:21Z"}, "message": "Rollup merge of #87513 - hudson-ayers:bootstrap-py-fix, r=jyn514\n\nbootstrap.py: change `git log` option to indicate desired behavior\n\nWhen determining which LLVM artifacts to download, bootstrap.py calls: `git log --author=bors --format=%H -n1 -m --first-parent --\nsrc/llvm-project src/bootstrap/download-ci-llvm-stamp src/version`. However, the `-m` option has no effect, per the `git log` help:\n\n> -m\n> This option makes diff output for merge commits to be shown in the\n> default format. -m will produce the output only if -p is given as\n> well. The default format could be changed using log.diffMerges\n> configuration parameter, which default value is separate.\n\nAccordingly, this commit removes use of the -m option in favor of ~~`--diff-merges=off`~~ `--no-patch`, since no diff information is needed, and in fact the presence of a diff breaks the command. Tested using git 2.32, this does not change the output of the command.\n\nThe motivation for this change is that some patched versions of git change the behavior of the `-m` flag to imply `-p`, rather than to do nothing unless `-p` is passed. These patched versions of git lead to this script not working. Google's corp-provided git is one such example.", "tree": {"sha": "69da23bd6905bc1b0747840c25657b2f4aa3a286", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69da23bd6905bc1b0747840c25657b2f4aa3a286"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/168238246fa6a6aa1da7e38d38a1977a96f43430", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhASM2CRBK7hj4Ov3rIwAAwx8IAKcTl6HDRbfViyQVR2Fqq0p0\nZgh9pEGkZMDZc+0920WcF8rGBzxSTwN1yxQ+CNC9FItcYL+jLkFpXjJYeu7XvXSz\nWWSVBc1nf9gHfedYt5wOpJ+yK6CsrhtMedLYzbp2yW9CKwZYY9LHVXVAfqTol/U1\nArOyqFiD/4Ywoxjk88k7GcgZRONSSQNWdHuRSdgKHlQlR2XYVV+/3eRkvfxqUvy4\nG0JdbdSYR95unvpwi3fpCnd/XksdOYhnumlZwjtwadB9OgHDnETZRJ0EKuTdvEaM\nLGBvXMg9nA9r8cZ/VzJixj20dVa8jTcBRmgi+4ZGfKpFeIwK/sBag70mV4scH3M=\n=6XYe\n-----END PGP SIGNATURE-----\n", "payload": "tree 69da23bd6905bc1b0747840c25657b2f4aa3a286\nparent 8bc7ec1316b841211ce8fa724fecb38554d80137\nparent 12597428658fc7b72244e8717d0ca6fc83fca11c\nauthor Yuki Okushi <jtitor@2k36.org> 1627464501 +0900\ncommitter GitHub <noreply@github.com> 1627464501 +0900\n\nRollup merge of #87513 - hudson-ayers:bootstrap-py-fix, r=jyn514\n\nbootstrap.py: change `git log` option to indicate desired behavior\n\nWhen determining which LLVM artifacts to download, bootstrap.py calls: `git log --author=bors --format=%H -n1 -m --first-parent --\nsrc/llvm-project src/bootstrap/download-ci-llvm-stamp src/version`. However, the `-m` option has no effect, per the `git log` help:\n\n> -m\n> This option makes diff output for merge commits to be shown in the\n> default format. -m will produce the output only if -p is given as\n> well. The default format could be changed using log.diffMerges\n> configuration parameter, which default value is separate.\n\nAccordingly, this commit removes use of the -m option in favor of ~~`--diff-merges=off`~~ `--no-patch`, since no diff information is needed, and in fact the presence of a diff breaks the command. Tested using git 2.32, this does not change the output of the command.\n\nThe motivation for this change is that some patched versions of git change the behavior of the `-m` flag to imply `-p`, rather than to do nothing unless `-p` is passed. These patched versions of git lead to this script not working. Google's corp-provided git is one such example.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/168238246fa6a6aa1da7e38d38a1977a96f43430", "html_url": "https://github.com/rust-lang/rust/commit/168238246fa6a6aa1da7e38d38a1977a96f43430", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/168238246fa6a6aa1da7e38d38a1977a96f43430/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8bc7ec1316b841211ce8fa724fecb38554d80137", "url": "https://api.github.com/repos/rust-lang/rust/commits/8bc7ec1316b841211ce8fa724fecb38554d80137", "html_url": "https://github.com/rust-lang/rust/commit/8bc7ec1316b841211ce8fa724fecb38554d80137"}, {"sha": "12597428658fc7b72244e8717d0ca6fc83fca11c", "url": "https://api.github.com/repos/rust-lang/rust/commits/12597428658fc7b72244e8717d0ca6fc83fca11c", "html_url": "https://github.com/rust-lang/rust/commit/12597428658fc7b72244e8717d0ca6fc83fca11c"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "f2e38a7eab6bc8c92f7de53d4f935bb74c61d035", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/168238246fa6a6aa1da7e38d38a1977a96f43430/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/168238246fa6a6aa1da7e38d38a1977a96f43430/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=168238246fa6a6aa1da7e38d38a1977a96f43430", "patch": "@@ -473,7 +473,7 @@ def download_toolchain(self, stage0=True, rustc_channel=None):\n             ]).decode(sys.getdefaultencoding()).strip()\n             llvm_sha = subprocess.check_output([\n                 \"git\", \"log\", \"--author=bors\", \"--format=%H\", \"-n1\",\n-                \"-m\", \"--first-parent\",\n+                \"--no-patch\", \"--first-parent\",\n                 \"--\",\n                 \"{}/src/llvm-project\".format(top_level),\n                 \"{}/src/bootstrap/download-ci-llvm-stamp\".format(top_level),"}]}