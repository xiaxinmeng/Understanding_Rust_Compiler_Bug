{"sha": "9fefe36737a1ebc35f96e46df3591b1ed74362a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmZWZlMzY3MzdhMWViYzM1Zjk2ZTQ2ZGYzNTkxYjFlZDc0MzYyYTU=", "commit": {"author": {"name": "Mateusz Miku\u0142a", "email": "mati865@gmail.com", "date": "2019-06-02T16:30:40Z"}, "committer": {"name": "Mateusz Miku\u0142a", "email": "mati865@gmail.com", "date": "2019-06-02T16:30:40Z"}, "message": "Rustup for https://github.com/rust-lang/rust/pull/61276", "tree": {"sha": "d937a26a6e7ddfafe37275f07882f648003da89b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d937a26a6e7ddfafe37275f07882f648003da89b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fefe36737a1ebc35f96e46df3591b1ed74362a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fefe36737a1ebc35f96e46df3591b1ed74362a5", "html_url": "https://github.com/rust-lang/rust/commit/9fefe36737a1ebc35f96e46df3591b1ed74362a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fefe36737a1ebc35f96e46df3591b1ed74362a5/comments", "author": {"login": "mati865", "id": 1174646, "node_id": "MDQ6VXNlcjExNzQ2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mati865", "html_url": "https://github.com/mati865", "followers_url": "https://api.github.com/users/mati865/followers", "following_url": "https://api.github.com/users/mati865/following{/other_user}", "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}", "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mati865/subscriptions", "organizations_url": "https://api.github.com/users/mati865/orgs", "repos_url": "https://api.github.com/users/mati865/repos", "events_url": "https://api.github.com/users/mati865/events{/privacy}", "received_events_url": "https://api.github.com/users/mati865/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mati865", "id": 1174646, "node_id": "MDQ6VXNlcjExNzQ2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mati865", "html_url": "https://github.com/mati865", "followers_url": "https://api.github.com/users/mati865/followers", "following_url": "https://api.github.com/users/mati865/following{/other_user}", "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}", "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mati865/subscriptions", "organizations_url": "https://api.github.com/users/mati865/orgs", "repos_url": "https://api.github.com/users/mati865/repos", "events_url": "https://api.github.com/users/mati865/events{/privacy}", "received_events_url": "https://api.github.com/users/mati865/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5d680491139f53c444c952d17e426c6e7d7844f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5d680491139f53c444c952d17e426c6e7d7844f", "html_url": "https://github.com/rust-lang/rust/commit/f5d680491139f53c444c952d17e426c6e7d7844f"}], "stats": {"total": 52, "additions": 21, "deletions": 31}, "files": [{"sha": "d0ebf881d7bab029e310d8fcd07289f4228c6c08", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=9fefe36737a1ebc35f96e46df3591b1ed74362a5", "patch": "@@ -79,7 +79,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for BoxedLocal {\n \n         let fn_def_id = cx.tcx.hir().local_def_id_from_hir_id(hir_id);\n         let region_scope_tree = &cx.tcx.region_scope_tree(fn_def_id);\n-        ExprUseVisitor::new(&mut v, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).consume_body(body);\n+        ExprUseVisitor::new(&mut v, cx.tcx, fn_def_id, cx.param_env, region_scope_tree, cx.tables, None).consume_body(body);\n \n         for node in v.set {\n             span_lint("}, {"sha": "ff88b6f782276cfeaa82c4f4dfa96056ed216f57", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 9, "deletions": 20, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=9fefe36737a1ebc35f96e46df3591b1ed74362a5", "patch": "@@ -1662,7 +1662,7 @@ fn check_for_mutation(\n     };\n     let def_id = def_id::DefId::local(body.hir_id.owner);\n     let region_scope_tree = &cx.tcx.region_scope_tree(def_id);\n-    ExprUseVisitor::new(&mut delegate, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).walk_expr(body);\n+    ExprUseVisitor::new(&mut delegate, cx.tcx, def_id, cx.param_env, region_scope_tree, cx.tables, None).walk_expr(body);\n     delegate.mutation_span()\n }\n \n@@ -1769,7 +1769,7 @@ impl<'a, 'tcx> VarVisitor<'a, 'tcx> {\n                     }\n                     let res = self.cx.tables.qpath_res(seqpath, seqexpr.hir_id);\n                     match res {\n-                        Res::Local(hir_id) | Res::Upvar(hir_id, ..) => {\n+                        Res::Local(hir_id) => {\n                             let parent_id = self.cx.tcx.hir().get_parent_item(expr.hir_id);\n                             let parent_def_id = self.cx.tcx.hir().local_def_id_from_hir_id(parent_id);\n                             let extent = self.cx.tcx.region_scope_tree(parent_def_id).var_scope(hir_id.local_id);\n@@ -1829,24 +1829,13 @@ impl<'a, 'tcx> Visitor<'tcx> for VarVisitor<'a, 'tcx> {\n             if let QPath::Resolved(None, ref path) = *qpath;\n             if path.segments.len() == 1;\n             then {\n-                match self.cx.tables.qpath_res(qpath, expr.hir_id) {\n-                    Res::Upvar(local_id, ..) => {\n-                        if local_id == self.var {\n-                            // we are not indexing anything, record that\n-                            self.nonindex = true;\n-                        }\n-                    }\n-                    Res::Local(local_id) =>\n-                    {\n-\n-                        if local_id == self.var {\n-                            self.nonindex = true;\n-                        } else {\n-                            // not the correct variable, but still a variable\n-                            self.referenced.insert(path.segments[0].ident.name);\n-                        }\n+                if let Res::Local(local_id) = self.cx.tables.qpath_res(qpath, expr.hir_id) {\n+                    if local_id == self.var {\n+                        self.nonindex = true;\n+                    } else {\n+                        // not the correct variable, but still a variable\n+                        self.referenced.insert(path.segments[0].ident.name);\n                     }\n-                    _ => {}\n                 }\n             }\n         }\n@@ -2378,7 +2367,7 @@ impl<'a, 'tcx> VarCollectorVisitor<'a, 'tcx> {\n             let res = self.cx.tables.qpath_res(qpath, ex.hir_id);\n             then {\n                 match res {\n-                    Res::Local(node_id) | Res::Upvar(node_id, ..) => {\n+                    Res::Local(node_id) => {\n                         self.ids.insert(node_id);\n                     },\n                     Res::Def(DefKind::Static, def_id) => {"}, {"sha": "74368446d991298e23906b4177afff5cb8f6060b", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=9fefe36737a1ebc35f96e46df3591b1ed74362a5", "patch": "@@ -600,9 +600,10 @@ fn in_attributes_expansion(expr: &Expr) -> bool {\n \n /// Tests whether `res` is a variable defined outside a macro.\n fn non_macro_local(cx: &LateContext<'_, '_>, res: def::Res) -> bool {\n-    match res {\n-        def::Res::Local(id) | def::Res::Upvar(id, ..) => !in_macro_or_desugar(cx.tcx.hir().span_by_hir_id(id)),\n-        _ => false,\n+    if let def::Res::Local(id) = res {\n+        !in_macro_or_desugar(cx.tcx.hir().span_by_hir_id(id))\n+    } else {\n+        false\n     }\n }\n "}, {"sha": "6aa941304a9191aa4fb50724b2670a7786ee50a9", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=9fefe36737a1ebc35f96e46df3591b1ed74362a5", "patch": "@@ -137,7 +137,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n         } = {\n             let mut ctx = MovedVariablesCtxt::new(cx);\n             let region_scope_tree = &cx.tcx.region_scope_tree(fn_def_id);\n-            euv::ExprUseVisitor::new(&mut ctx, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None)\n+            euv::ExprUseVisitor::new(&mut ctx, cx.tcx, fn_def_id, cx.param_env, region_scope_tree, cx.tables, None)\n                 .consume_body(body);\n             ctx\n         };"}, {"sha": "3b9cabcef813d97b8ef78e17a31a9c6d83f410d5", "filename": "clippy_lints/src/utils/usage.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Futils%2Fusage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fefe36737a1ebc35f96e46df3591b1ed74362a5/clippy_lints%2Fsrc%2Futils%2Fusage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fusage.rs?ref=9fefe36737a1ebc35f96e46df3591b1ed74362a5", "patch": "@@ -16,7 +16,7 @@ pub fn mutated_variables<'a, 'tcx: 'a>(expr: &'tcx Expr, cx: &'a LateContext<'a,\n     };\n     let def_id = def_id::DefId::local(expr.hir_id.owner);\n     let region_scope_tree = &cx.tcx.region_scope_tree(def_id);\n-    ExprUseVisitor::new(&mut delegate, cx.tcx, cx.param_env, region_scope_tree, cx.tables, None).walk_expr(expr);\n+    ExprUseVisitor::new(&mut delegate, cx.tcx, def_id, cx.param_env, region_scope_tree, cx.tables, None).walk_expr(expr);\n \n     if delegate.skip {\n         return None;\n@@ -29,11 +29,11 @@ pub fn is_potentially_mutated<'a, 'tcx: 'a>(\n     expr: &'tcx Expr,\n     cx: &'a LateContext<'a, 'tcx>,\n ) -> bool {\n-    let id = match variable.res {\n-        Res::Local(id) | Res::Upvar(id, ..) => id,\n-        _ => return true,\n-    };\n-    mutated_variables(expr, cx).map_or(true, |mutated| mutated.contains(&id))\n+    if let Res::Local(id) = variable.res {\n+        mutated_variables(expr, cx).map_or(true, |mutated| mutated.contains(&id))\n+    } else {\n+        return true\n+    }\n }\n \n struct MutVarsDelegate {"}]}