{"sha": "e47e91013ed69e967bb3a07145e86a789c28a1b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0N2U5MTAxM2VkNjllOTY3YmIzYTA3MTQ1ZTg2YTc4OWMyOGExYjQ=", "commit": {"author": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2015-07-16T14:29:28Z"}, "committer": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2015-07-18T10:25:41Z"}, "message": "Format while loops, including labels", "tree": {"sha": "bb0df9839ce21e6a6b07c5f56857cee5b3bea45c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bb0df9839ce21e6a6b07c5f56857cee5b3bea45c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e47e91013ed69e967bb3a07145e86a789c28a1b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e47e91013ed69e967bb3a07145e86a789c28a1b4", "html_url": "https://github.com/rust-lang/rust/commit/e47e91013ed69e967bb3a07145e86a789c28a1b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e47e91013ed69e967bb3a07145e86a789c28a1b4/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "979d0c975636cd87a27dd020c1ace644aa1aa4e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/979d0c975636cd87a27dd020c1ace644aa1aa4e9", "html_url": "https://github.com/rust-lang/rust/commit/979d0c975636cd87a27dd020c1ace644aa1aa4e9"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "e0a76308b4423bd87c6177aae448bce222cbe345", "filename": "src/expr.rs", "status": "modified", "additions": 23, "deletions": 3, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/e47e91013ed69e967bb3a07145e86a789c28a1b4/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e47e91013ed69e967bb3a07145e86a789c28a1b4/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=e47e91013ed69e967bb3a07145e86a789c28a1b4", "patch": "@@ -56,11 +56,24 @@ impl Rewrite for ast::Expr {\n             ast::Expr_::ExprTup(ref items) => {\n                 rewrite_tuple_lit(context, items, self.span, width, offset)\n             }\n-            ast::Expr_::ExprLoop(ref block, _) => {\n+            ast::Expr_::ExprWhile(ref subexpr, ref block, label) => {\n+                let label_string = rewrite_label(label);\n+                // 6 = \"while \"\n+                // 2 = \" {\"\n+                let expr_width = width - 6 - 2 - label_string.len();\n+                let expr_offset = offset + 6 + label_string.len();\n+\n+                subexpr.rewrite(context, expr_width, expr_offset).and_then(|expr_string| {\n+                    // FIXME: this drops any comment between \"loop\" and the block.\n+                    block.rewrite(context, width, offset).map(|result| {\n+                        format!(\"{}while {} {}\", rewrite_label(label), expr_string, result)\n+                    })\n+                })\n+            }\n+            ast::Expr_::ExprLoop(ref block, label) => {\n                 // FIXME: this drops any comment between \"loop\" and the block.\n-                // TODO: format label\n                 block.rewrite(context, width, offset).map(|result| {\n-                    format!(\"loop {}\", result)\n+                    format!(\"{}loop {}\", rewrite_label(label), result)\n                 })\n             }\n             _ => context.codemap.span_to_snippet(self.span).ok()\n@@ -88,6 +101,13 @@ impl Rewrite for ast::Block {\n     }\n }\n \n+fn rewrite_label(label: Option<ast::Ident>) -> String {\n+    match label {\n+        Some(ident) => format!(\"{}: \", ident.as_str()),\n+        None => \"\".to_owned()\n+    }\n+}\n+\n fn rewrite_string_lit(context: &RewriteContext,\n                       s: &str,\n                       span: Span,"}, {"sha": "143a3a237605d106d7b36a40d9e87c5994b75475", "filename": "tests/source/loop.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e47e91013ed69e967bb3a07145e86a789c28a1b4/tests%2Fsource%2Floop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e47e91013ed69e967bb3a07145e86a789c28a1b4/tests%2Fsource%2Floop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Floop.rs?ref=e47e91013ed69e967bb3a07145e86a789c28a1b4", "patch": "@@ -5,7 +5,12 @@ fn main() {\n \n let x = loop { do_forever(); };\n \n-         loop {\n+       'label :  loop {\n         // Just comments\n     }\n+\n+    'a: while loooooooooooooooooooooooooooooooooong_variable_name + another_value > some_other_value{}\n+\n+   while aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa > bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb {\n+   }\n }"}, {"sha": "cec8b2bff6156c952b1bea07174c73f4f360efe5", "filename": "tests/target/loop.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e47e91013ed69e967bb3a07145e86a789c28a1b4/tests%2Ftarget%2Floop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e47e91013ed69e967bb3a07145e86a789c28a1b4/tests%2Ftarget%2Floop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Floop.rs?ref=e47e91013ed69e967bb3a07145e86a789c28a1b4", "patch": "@@ -8,7 +8,14 @@ fn main() {\n         do_forever();\n     };\n \n-    loop {\n+    'label: loop {\n         // Just comments\n     }\n+\n+    'a: while loooooooooooooooooooooooooooooooooong_variable_name + another_value >\n+              some_other_value {\n+    }\n+\n+    while aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa > bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb {\n+    }\n }"}]}