{"sha": "a8bb2458e1798891112e53b08fe72477fdb75070", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4YmIyNDU4ZTE3OTg4OTExMTJlNTNiMDhmZTcyNDc3ZmRiNzUwNzA=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-16T18:18:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-16T18:18:26Z"}, "message": "Rollup merge of #73771 - alexcrichton:ignore-unstable, r=estebank,GuillaumeGomez\n\nDon't pollute docs/suggestions with libstd deps\n\nCurrently dependency crates of the standard library can sometimes leak\ninto error messages such as when traits to import are suggested.\nAdditionally they can leak into documentation such as in the list of\n\"all traits implemented by `u32`\". The dependencies of the standard\nlibrary, however, are intended to be private.\n\nThe dependencies of the standard library can't actually be stabl-y\nimported nor is the documentation that relevant since you can't import\nthem on stable either. This commit updates both the compiler and rustdoc\nto ignore unstable traits in these two scenarios.\n\nSpecifically the suggestion for traits to import ignore unstable traits,\nand similarly the list of traits implemented by a type excludes unstable\ntraits.\n\nThis commit is extracted from #73441 where the addition of some new\ndependencies to the standard library was showed to leak into various\nerror messages and documentation. The intention here is to go ahead and\nland these changes ahead of that since it will likely take some time to\nland.", "tree": {"sha": "9086fd8439deff7aa665120abbd4c4b8e693939b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9086fd8439deff7aa665120abbd4c4b8e693939b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a8bb2458e1798891112e53b08fe72477fdb75070", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfEJnyCRBK7hj4Ov3rIwAAdHIIADA4RX7rRvQBhY/vSNjoUloD\n+Mmuyojwk2bGrpfvJC3OihA97VX7f6xLpwZJqLzCOotK4HRFNAQg69UP4qKU7Rsl\nJ10md+fYKc6CDBra3UksDesbvIRBiwtZS1H6J0chb/e8GDMCrbMmJFJuFYXvdpv+\nXCKgjM6vjXQSbAkMi4Hnfti5ZahTPIeuNMkpNEZU7rOm8FAZJYVxMDRyIYjPxc8b\nBkq6Wnwdo0bILch9E5/E1N23cbD1/bMIY9snq/j9uGahpmdhH6bo4KAqsKRX5BP+\nuPUyrI+aSZw2/r4Rhn6ZV62jRr5Q059NEyCkYeoY467okAfgJ31BHDLhsLhmOaU=\n=0aka\n-----END PGP SIGNATURE-----\n", "payload": "tree 9086fd8439deff7aa665120abbd4c4b8e693939b\nparent c23f045a8b10c92eef5b1fbefea7696065e5977c\nparent fde8d11ca12e83fe2b07a536956f4a2725b24485\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594923506 -0700\ncommitter GitHub <noreply@github.com> 1594923506 -0700\n\nRollup merge of #73771 - alexcrichton:ignore-unstable, r=estebank,GuillaumeGomez\n\nDon't pollute docs/suggestions with libstd deps\n\nCurrently dependency crates of the standard library can sometimes leak\ninto error messages such as when traits to import are suggested.\nAdditionally they can leak into documentation such as in the list of\n\"all traits implemented by `u32`\". The dependencies of the standard\nlibrary, however, are intended to be private.\n\nThe dependencies of the standard library can't actually be stabl-y\nimported nor is the documentation that relevant since you can't import\nthem on stable either. This commit updates both the compiler and rustdoc\nto ignore unstable traits in these two scenarios.\n\nSpecifically the suggestion for traits to import ignore unstable traits,\nand similarly the list of traits implemented by a type excludes unstable\ntraits.\n\nThis commit is extracted from #73441 where the addition of some new\ndependencies to the standard library was showed to leak into various\nerror messages and documentation. The intention here is to go ahead and\nland these changes ahead of that since it will likely take some time to\nland.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a8bb2458e1798891112e53b08fe72477fdb75070", "html_url": "https://github.com/rust-lang/rust/commit/a8bb2458e1798891112e53b08fe72477fdb75070", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a8bb2458e1798891112e53b08fe72477fdb75070/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c23f045a8b10c92eef5b1fbefea7696065e5977c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c23f045a8b10c92eef5b1fbefea7696065e5977c", "html_url": "https://github.com/rust-lang/rust/commit/c23f045a8b10c92eef5b1fbefea7696065e5977c"}, {"sha": "fde8d11ca12e83fe2b07a536956f4a2725b24485", "url": "https://api.github.com/repos/rust-lang/rust/commits/fde8d11ca12e83fe2b07a536956f4a2725b24485", "html_url": "https://github.com/rust-lang/rust/commit/fde8d11ca12e83fe2b07a536956f4a2725b24485"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "f6ebf8b56bd4cb1ce286131fcdb3434818551ae5", "filename": "src/librustc_typeck/check/method/suggest.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a8bb2458e1798891112e53b08fe72477fdb75070/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8bb2458e1798891112e53b08fe72477fdb75070/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs?ref=a8bb2458e1798891112e53b08fe72477fdb75070", "patch": "@@ -937,6 +937,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         // legal to implement.\n         let mut candidates = all_traits(self.tcx)\n             .into_iter()\n+            // Don't issue suggestions for unstable traits since they're\n+            // unlikely to be implementable anyway\n+            .filter(|info| match self.tcx.lookup_stability(info.def_id) {\n+                Some(attr) => attr.level.is_stable(),\n+                None => true,\n+            })\n             .filter(|info| {\n                 // We approximate the coherence rules to only suggest\n                 // traits that are legal to implement by requiring that"}, {"sha": "ee1c17bad9f938862eaf0ca5faa33fb4712d4eb7", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a8bb2458e1798891112e53b08fe72477fdb75070/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8bb2458e1798891112e53b08fe72477fdb75070/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=a8bb2458e1798891112e53b08fe72477fdb75070", "patch": "@@ -339,6 +339,16 @@ pub fn build_impl(\n                 return;\n             }\n         }\n+\n+        // Skip foreign unstable traits from lists of trait implementations and\n+        // such. This helps prevent dependencies of the standard library, for\n+        // example, from getting documented as \"traits `u32` implements\" which\n+        // isn't really too helpful.\n+        if let Some(stab) = cx.tcx.lookup_stability(did) {\n+            if stab.level.is_unstable() {\n+                return;\n+            }\n+        }\n     }\n \n     let for_ = if let Some(did) = did.as_local() {"}]}