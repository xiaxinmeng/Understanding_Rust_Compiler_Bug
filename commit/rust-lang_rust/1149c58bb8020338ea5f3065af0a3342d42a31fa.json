{"sha": "1149c58bb8020338ea5f3065af0a3342d42a31fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNDljNThiYjgwMjAzMzhlYTVmMzA2NWFmMGEzMzQyZDQyYTMxZmE=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-12-06T14:47:30Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-12-06T14:47:30Z"}, "message": "Add test for #46589.\n\nThis commit adds the test for writing into a projection of a local to\nconfirm there are no remaining borrows.", "tree": {"sha": "401738a87e379066d21af97b5cc4058017a3a69c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/401738a87e379066d21af97b5cc4058017a3a69c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1149c58bb8020338ea5f3065af0a3342d42a31fa", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlwJNrAACgkQAXYLT59T\n8VRbfRAArh7d8h2KjRVf6lD2qq6/IdJeEdmMYPhNoFguZq2igiXtaQioiR7b8M+N\nyZQTTkJik6N7JCeysriPtSWZ8CR/fd/h6+AzvIG7eIoXM7UKcu3HVYDQyU0hFr7M\nYnC8+StEZcutOLWKr84oLVJJFxmOSErjLXX9I8QEAej09xLzDmv/Cp4iCT0+ylq9\nauZ+//Fito2pIyI19FE/J031UE8uupan+7zAzxoDD58MWcvlk0jbAw8dF/0LdgLJ\n85hKxwSU1xZMk91XpK6gdoAdRspTVskXDh3fGG87orRdrdW18zAHmYBc/DS+HvzK\nlLxYjebmniAufP2wHSxnCgWhwlSmYhQSPU61KxQ78oic0cTcxDnYAMYTDgv92zmk\nes1kd6hxKjf3I2mWO2LDtIWUfq6IMI8XLsHF3+MRDxHeQWNeeHXSk8VACvZ9ZKw9\ntoiNtO74iKt/d9SFDSMSQZLg+M3DBmrwny3RKEFJh79+mzrrqqAnjHr8UF1skHjs\nyPYOLqDB3YttkTJzA/061t/SZ6r4sK5CkgS5KTM05ZMDPlxUgb9CRYuj0W4dh0Dv\n3SlOyDT8wgTzuyVI9Sq8YPSEbqr5ff1w5JtfhckjbmF/Hazx7JlC+etunXUL9pxj\ngDnTWAFU4kGFGZOWsvAQuFirxgxDctZxsmuNd27Gt0Kg61BdcLg=\n=7UF0\n-----END PGP SIGNATURE-----", "payload": "tree 401738a87e379066d21af97b5cc4058017a3a69c\nparent 77a6a61f066af3dd693d8527a8a1bf5a446d295c\nauthor David Wood <david@davidtw.co> 1544107650 +0100\ncommitter David Wood <david@davidtw.co> 1544107650 +0100\n\nAdd test for #46589.\n\nThis commit adds the test for writing into a projection of a local to\nconfirm there are no remaining borrows.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1149c58bb8020338ea5f3065af0a3342d42a31fa", "html_url": "https://github.com/rust-lang/rust/commit/1149c58bb8020338ea5f3065af0a3342d42a31fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1149c58bb8020338ea5f3065af0a3342d42a31fa/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "77a6a61f066af3dd693d8527a8a1bf5a446d295c", "url": "https://api.github.com/repos/rust-lang/rust/commits/77a6a61f066af3dd693d8527a8a1bf5a446d295c", "html_url": "https://github.com/rust-lang/rust/commit/77a6a61f066af3dd693d8527a8a1bf5a446d295c"}], "stats": {"total": 66, "additions": 66, "deletions": 0}, "files": [{"sha": "0099e44ec38506e43c1a190005d1c358d25613a7", "filename": "src/test/ui/nll/issue-46589.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/1149c58bb8020338ea5f3065af0a3342d42a31fa/src%2Ftest%2Fui%2Fnll%2Fissue-46589.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1149c58bb8020338ea5f3065af0a3342d42a31fa/src%2Ftest%2Fui%2Fnll%2Fissue-46589.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-46589.rs?ref=1149c58bb8020338ea5f3065af0a3342d42a31fa", "patch": "@@ -0,0 +1,38 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(nll)]\n+\n+struct Foo;\n+\n+impl Foo {\n+    fn get_self(&mut self) -> Option<&mut Self> {\n+        Some(self)\n+    }\n+\n+    fn new_self(&mut self) -> &mut Self {\n+        self\n+    }\n+\n+    fn trigger_bug(&mut self) {\n+        let other = &mut (&mut *self);\n+\n+        *other = match (*other).get_self() {\n+            Some(s) => s,\n+            None => (*other).new_self()\n+            //~^ ERROR cannot borrow `**other` as mutable more than once at a time [E0499]\n+        };\n+\n+        let c = other;\n+        //~^ ERROR cannot move out of `other` because it is borrowed [E0505]\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "ef656912b0f1d9b363d4ea9f9e653e83fe6b8169", "filename": "src/test/ui/nll/issue-46589.stderr", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/1149c58bb8020338ea5f3065af0a3342d42a31fa/src%2Ftest%2Fui%2Fnll%2Fissue-46589.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1149c58bb8020338ea5f3065af0a3342d42a31fa/src%2Ftest%2Fui%2Fnll%2Fissue-46589.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-46589.stderr?ref=1149c58bb8020338ea5f3065af0a3342d42a31fa", "patch": "@@ -0,0 +1,28 @@\n+error[E0499]: cannot borrow `**other` as mutable more than once at a time\n+  --> $DIR/issue-46589.rs:29:21\n+   |\n+LL |         *other = match (*other).get_self() {\n+   |                        -------- first mutable borrow occurs here\n+LL |             Some(s) => s,\n+LL |             None => (*other).new_self()\n+   |                     ^^^^^^^^\n+   |                     |\n+   |                     second mutable borrow occurs here\n+   |                     first borrow later used here\n+\n+error[E0505]: cannot move out of `other` because it is borrowed\n+  --> $DIR/issue-46589.rs:33:17\n+   |\n+LL |         *other = match (*other).get_self() {\n+   |                        -------- borrow of `**other` occurs here\n+...\n+LL |         let c = other;\n+   |                 ^^^^^\n+   |                 |\n+   |                 move out of `other` occurs here\n+   |                 borrow later used here\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors occurred: E0499, E0505.\n+For more information about an error, try `rustc --explain E0499`."}]}