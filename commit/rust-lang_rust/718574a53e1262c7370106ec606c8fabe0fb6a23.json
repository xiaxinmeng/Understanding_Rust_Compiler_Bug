{"sha": "718574a53e1262c7370106ec606c8fabe0fb6a23", "node_id": "C_kwDOAAsO6NoAKDcxODU3NGE1M2UxMjYyYzczNzAxMDZlYzYwNmM4ZmFiZTBmYjZhMjM", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-02-17T17:55:51Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2023-02-17T17:55:51Z"}, "message": "Support updating to specific dates in rustup.sh\n\nFixes #1294", "tree": {"sha": "1ef9bdd9edffcb1b8e563a775dcdfc1c2c84b9fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ef9bdd9edffcb1b8e563a775dcdfc1c2c84b9fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/718574a53e1262c7370106ec606c8fabe0fb6a23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/718574a53e1262c7370106ec606c8fabe0fb6a23", "html_url": "https://github.com/rust-lang/rust/commit/718574a53e1262c7370106ec606c8fabe0fb6a23", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/718574a53e1262c7370106ec606c8fabe0fb6a23/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c5d5bab967c2ce5e05dac7c30543a8a0c5abd43", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c5d5bab967c2ce5e05dac7c30543a8a0c5abd43", "html_url": "https://github.com/rust-lang/rust/commit/3c5d5bab967c2ce5e05dac7c30543a8a0c5abd43"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "75219c82e82e0cb444ad59a6579eb5fea158752a", "filename": "scripts/rustup.sh", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/718574a53e1262c7370106ec606c8fabe0fb6a23/scripts%2Frustup.sh", "raw_url": "https://github.com/rust-lang/rust/raw/718574a53e1262c7370106ec606c8fabe0fb6a23/scripts%2Frustup.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Frustup.sh?ref=718574a53e1262c7370106ec606c8fabe0fb6a23", "patch": "@@ -2,10 +2,10 @@\n \n set -e\n \n+TOOLCHAIN=${TOOLCHAIN:-$(date +%Y-%m-%d)}\n+\n case $1 in\n     \"prepare\")\n-        TOOLCHAIN=$(date +%Y-%m-%d)\n-\n         echo \"=> Installing new nightly\"\n         rustup toolchain install --profile minimal \"nightly-${TOOLCHAIN}\" # Sanity check to see if the nightly exists\n         sed -i \"s/\\\"nightly-.*\\\"/\\\"nightly-${TOOLCHAIN}\\\"/\" rust-toolchain\n@@ -42,13 +42,16 @@ case $1 in\n         git merge sync_from_rust\n \t;;\n     \"pull\")\n+        RUST_VERS=$(curl \"https://static.rust-lang.org/dist/$TOOLCHAIN/channel-rust-nightly-git-commit-hash.txt\")\n+        echo \"Pulling $RUST_VERS ($TOOLCHAIN)\"\n+\n         cg_clif=$(pwd)\n         pushd ../rust\n-        git pull origin master\n-        rust_vers=\"$(git rev-parse HEAD)\"\n+        git fetch origin master\n+        git checkout \"$RUST_VERS\"\n         git subtree push --prefix=compiler/rustc_codegen_cranelift/ \"$cg_clif\" sync_from_rust\n         popd\n-        git merge sync_from_rust -m \"Sync from rust $rust_vers\"\n+        git merge sync_from_rust -m \"Sync from rust $RUST_VERS\"\n         git branch -d sync_from_rust\n         ;;\n     *)"}]}