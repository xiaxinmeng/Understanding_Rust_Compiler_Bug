{"sha": "d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzZjNhZTNhYTI1NzFiZGYwMjUwZTAxOWRjNGNkYjBkZjA1YWJkYmU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-12-22T20:47:34Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-12-22T20:47:34Z"}, "message": "rollup merge of #20084: barosl/struct-variant-field-err\n\nFixes #19922.", "tree": {"sha": "ef8679cb76b7fbb448fdd517e60c201b041a3ed3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef8679cb76b7fbb448fdd517e60c201b041a3ed3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "html_url": "https://github.com/rust-lang/rust/commit/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4baeacef5a539fa29b88c951d6eca996d6101148", "url": "https://api.github.com/repos/rust-lang/rust/commits/4baeacef5a539fa29b88c951d6eca996d6101148", "html_url": "https://github.com/rust-lang/rust/commit/4baeacef5a539fa29b88c951d6eca996d6101148"}, {"sha": "c9010bff6c5d8ccc8d3009d377f1cb5826b25d69", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9010bff6c5d8ccc8d3009d377f1cb5826b25d69", "html_url": "https://github.com/rust-lang/rust/commit/c9010bff6c5d8ccc8d3009d377f1cb5826b25d69"}], "stats": {"total": 52, "additions": 42, "deletions": 10}, "files": [{"sha": "7020ca4b542ad53b99a9d61e9fc18d52328b6cbb", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 24, "deletions": 10, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "patch": "@@ -3418,7 +3418,8 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n                                                 substitutions: subst::Substs<'tcx>,\n                                                 field_types: &[ty::field_ty],\n                                                 ast_fields: &[ast::Field],\n-                                                check_completeness: bool)  {\n+                                                check_completeness: bool,\n+                                                enum_id_opt: Option<ast::DefId>)  {\n         let tcx = fcx.ccx.tcx;\n \n         let mut class_field_map = FnvHashMap::new();\n@@ -3437,13 +3438,24 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n             match pair {\n                 None => {\n                     fcx.type_error_message(\n-                      field.ident.span,\n-                      |actual| {\n-                          format!(\"structure `{}` has no field named `{}`\",\n-                                  actual, token::get_ident(field.ident.node))\n-                      },\n-                      struct_ty,\n-                      None);\n+                        field.ident.span,\n+                        |actual| match enum_id_opt {\n+                            Some(enum_id) => {\n+                                let variant_type = ty::enum_variant_with_id(tcx,\n+                                                                            enum_id,\n+                                                                            class_id);\n+                                format!(\"struct variant `{}::{}` has no field named `{}`\",\n+                                        actual, variant_type.name.as_str(),\n+                                        token::get_ident(field.ident.node))\n+                            }\n+                            None => {\n+                                format!(\"structure `{}` has no field named `{}`\",\n+                                        actual,\n+                                        token::get_ident(field.ident.node))\n+                            }\n+                        },\n+                        struct_ty,\n+                        None);\n                     error_happened = true;\n                 }\n                 Some((_, true)) => {\n@@ -3524,7 +3536,8 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n                                        struct_substs,\n                                        class_fields[],\n                                        fields,\n-                                       base_expr.is_none());\n+                                       base_expr.is_none(),\n+                                       None);\n         if ty::type_is_error(fcx.node_ty(id)) {\n             struct_type = ty::mk_err();\n         }\n@@ -3566,7 +3579,8 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n                                        substitutions,\n                                        variant_fields[],\n                                        fields,\n-                                       true);\n+                                       true,\n+                                       Some(enum_id));\n         fcx.write_ty(id, enum_type);\n     }\n "}, {"sha": "e3ced3028098bf08e27006a140d40a6ff00405d8", "filename": "src/test/compile-fail/issue-19922.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe/src%2Ftest%2Fcompile-fail%2Fissue-19922.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe/src%2Ftest%2Fcompile-fail%2Fissue-19922.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-19922.rs?ref=d3f3ae3aa2571bdf0250e019dc4cdb0df05abdbe", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+enum Homura {\n+    Akemi { madoka: () }\n+}\n+\n+fn main() {\n+    let homura = Homura::Akemi { kaname: () };\n+    //~^ ERROR struct variant `Homura::Akemi` has no field named `kaname`\n+}"}]}