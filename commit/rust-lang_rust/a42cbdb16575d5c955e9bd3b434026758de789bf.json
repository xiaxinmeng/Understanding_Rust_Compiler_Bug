{"sha": "a42cbdb16575d5c955e9bd3b434026758de789bf", "node_id": "C_kwDOAAsO6NoAKGE0MmNiZGIxNjU3NWQ1Yzk1NWU5YmQzYjQzNDAyNjc1OGRlNzg5YmY", "commit": {"author": {"name": "Ali MJ Al-Nasrawy", "email": "alimjalnasrawy@gmail.com", "date": "2023-03-15T12:51:34Z"}, "committer": {"name": "Ali MJ Al-Nasrawy", "email": "alimjalnasrawy@gmail.com", "date": "2023-03-31T14:53:42Z"}, "message": "allow ReError in CanonicalUserTypeAnnotation", "tree": {"sha": "191022de4082491d7778e94f53a317f4398cba5b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/191022de4082491d7778e94f53a317f4398cba5b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a42cbdb16575d5c955e9bd3b434026758de789bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a42cbdb16575d5c955e9bd3b434026758de789bf", "html_url": "https://github.com/rust-lang/rust/commit/a42cbdb16575d5c955e9bd3b434026758de789bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a42cbdb16575d5c955e9bd3b434026758de789bf/comments", "author": {"login": "aliemjay", "id": 28497461, "node_id": "MDQ6VXNlcjI4NDk3NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/28497461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliemjay", "html_url": "https://github.com/aliemjay", "followers_url": "https://api.github.com/users/aliemjay/followers", "following_url": "https://api.github.com/users/aliemjay/following{/other_user}", "gists_url": "https://api.github.com/users/aliemjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliemjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliemjay/subscriptions", "organizations_url": "https://api.github.com/users/aliemjay/orgs", "repos_url": "https://api.github.com/users/aliemjay/repos", "events_url": "https://api.github.com/users/aliemjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aliemjay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aliemjay", "id": 28497461, "node_id": "MDQ6VXNlcjI4NDk3NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/28497461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliemjay", "html_url": "https://github.com/aliemjay", "followers_url": "https://api.github.com/users/aliemjay/followers", "following_url": "https://api.github.com/users/aliemjay/following{/other_user}", "gists_url": "https://api.github.com/users/aliemjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliemjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliemjay/subscriptions", "organizations_url": "https://api.github.com/users/aliemjay/orgs", "repos_url": "https://api.github.com/users/aliemjay/repos", "events_url": "https://api.github.com/users/aliemjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aliemjay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82bfda848e28d7616c7045d7ced8cee88d2d1a8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/82bfda848e28d7616c7045d7ced8cee88d2d1a8f", "html_url": "https://github.com/rust-lang/rust/commit/82bfda848e28d7616c7045d7ced8cee88d2d1a8f"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "3bbd01f82736381331b6efd1ef87032b3de62f38", "filename": "compiler/rustc_infer/src/infer/canonical/canonicalizer.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a42cbdb16575d5c955e9bd3b434026758de789bf/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a42cbdb16575d5c955e9bd3b434026758de789bf/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fcanonicalizer.rs?ref=a42cbdb16575d5c955e9bd3b434026758de789bf", "patch": "@@ -230,9 +230,9 @@ impl CanonicalizeMode for CanonicalizeUserTypeAnnotation {\n         r: ty::Region<'tcx>,\n     ) -> ty::Region<'tcx> {\n         match *r {\n-            ty::ReEarlyBound(_) | ty::ReFree(_) | ty::ReErased | ty::ReStatic => r,\n+            ty::ReEarlyBound(_) | ty::ReFree(_) | ty::ReErased | ty::ReStatic | ty::ReError(_) => r,\n             ty::ReVar(_) => canonicalizer.canonical_var_for_region_in_root_universe(r),\n-            _ => {\n+            ty::RePlaceholder(..) | ty::ReLateBound(..) => {\n                 // We only expect region names that the user can type.\n                 bug!(\"unexpected region in query response: `{:?}`\", r)\n             }"}, {"sha": "3f2ad3ccbf582d575d3f22b69c74aa7d2dc589ed", "filename": "tests/ui/nll/user-annotations/region-error-ice-109072.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a42cbdb16575d5c955e9bd3b434026758de789bf/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a42cbdb16575d5c955e9bd3b434026758de789bf/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.rs?ref=a42cbdb16575d5c955e9bd3b434026758de789bf", "patch": "@@ -0,0 +1,14 @@\n+// Regression test for #109072.\n+// Check that we don't ICE when canonicalizing user annotation.\n+\n+trait Lt<'a> {\n+    type T;\n+}\n+\n+impl Lt<'missing> for () { //~ ERROR undeclared lifetime\n+    type T = &'missing (); //~ ERROR undeclared lifetime\n+}\n+\n+fn main() {\n+    let _: <() as Lt<'_>>::T = &();\n+}"}, {"sha": "d90971bed25ba31c4f095b50f475968adbcf293e", "filename": "tests/ui/nll/user-annotations/region-error-ice-109072.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/a42cbdb16575d5c955e9bd3b434026758de789bf/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a42cbdb16575d5c955e9bd3b434026758de789bf/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnll%2Fuser-annotations%2Fregion-error-ice-109072.stderr?ref=a42cbdb16575d5c955e9bd3b434026758de789bf", "patch": "@@ -0,0 +1,26 @@\n+error[E0261]: use of undeclared lifetime name `'missing`\n+  --> $DIR/region-error-ice-109072.rs:8:9\n+   |\n+LL | impl Lt<'missing> for () {\n+   |     -   ^^^^^^^^ undeclared lifetime\n+   |     |\n+   |     help: consider introducing lifetime `'missing` here: `<'missing>`\n+\n+error[E0261]: use of undeclared lifetime name `'missing`\n+  --> $DIR/region-error-ice-109072.rs:9:15\n+   |\n+LL |     type T = &'missing ();\n+   |               ^^^^^^^^ undeclared lifetime\n+   |\n+help: consider introducing lifetime `'missing` here\n+   |\n+LL |     type T<'missing> = &'missing ();\n+   |           ++++++++++\n+help: consider introducing lifetime `'missing` here\n+   |\n+LL | impl<'missing> Lt<'missing> for () {\n+   |     ++++++++++\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0261`."}]}