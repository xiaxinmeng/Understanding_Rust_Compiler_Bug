{"sha": "fdc9a649fffa5662571b27bb2353f55dca53277c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkYzlhNjQ5ZmZmYTU2NjI1NzFiMjdiYjIzNTNmNTVkY2E1MzI3N2M=", "commit": {"author": {"name": "sinkuu", "email": "sinkuu@sinkuu.xyz", "date": "2017-10-08T09:04:45Z"}, "committer": {"name": "sinkuu", "email": "sinkuu@sinkuu.xyz", "date": "2017-10-08T09:04:45Z"}, "message": "Exclude Fn traits", "tree": {"sha": "4a12796568428a6a9dbd28599e41578948e76337", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a12796568428a6a9dbd28599e41578948e76337"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fdc9a649fffa5662571b27bb2353f55dca53277c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fdc9a649fffa5662571b27bb2353f55dca53277c", "html_url": "https://github.com/rust-lang/rust/commit/fdc9a649fffa5662571b27bb2353f55dca53277c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fdc9a649fffa5662571b27bb2353f55dca53277c/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2be62451799456eb2b7c07aa173b800264e41bdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/2be62451799456eb2b7c07aa173b800264e41bdb", "html_url": "https://github.com/rust-lang/rust/commit/2be62451799456eb2b7c07aa173b800264e41bdb"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "29598a20f0d1a2f506ab6f7dbe9bc0548d4afe4c", "filename": "clippy_lints/src/needless_pass_by_value.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/fdc9a649fffa5662571b27bb2353f55dca53277c/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fdc9a649fffa5662571b27bb2353f55dca53277c/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_pass_by_value.rs?ref=fdc9a649fffa5662571b27bb2353f55dca53277c", "patch": "@@ -75,8 +75,13 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n             _ => return,\n         }\n \n+        // Allow `Borrow` or functions to be taken by value\n         let borrow_trait = need!(get_trait_def_id(cx, &paths::BORROW_TRAIT));\n-        let fn_trait = need!(cx.tcx.lang_items().fn_trait());\n+        let fn_traits = [\n+            need!(cx.tcx.lang_items().fn_trait()),\n+            need!(cx.tcx.lang_items().fn_once_trait()),\n+            need!(cx.tcx.lang_items().fn_mut_trait()),\n+        ];\n \n         let sized_trait = need!(cx.tcx.lang_items().sized_trait());\n \n@@ -119,7 +124,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n         {\n             // * Exclude a type that is specifically bounded by `Borrow`.\n             // * Exclude a type whose reference also fulfills its bound.\n-            //   (e.g. `std::borrow::Borrow`, `serde::Serialize`)\n+            //   (e.g. `std::convert::AsRef`, `serde::Serialize`)\n             let (implements_borrow_trait, all_borrowable_trait) = {\n                 let preds = preds\n                     .iter()\n@@ -143,7 +148,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessPassByValue {\n                 !is_self(arg),\n                 !ty.is_mutable_pointer(),\n                 !is_copy(cx, ty),\n-                !implements_trait(cx, ty, fn_trait, &[]),\n+                !fn_traits.iter().any(|&t| implements_trait(cx, ty, t, &[])),\n                 !implements_borrow_trait,\n                 !all_borrowable_trait,\n "}]}