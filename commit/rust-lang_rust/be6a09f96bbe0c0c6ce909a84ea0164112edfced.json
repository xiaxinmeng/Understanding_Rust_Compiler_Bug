{"sha": "be6a09f96bbe0c0c6ce909a84ea0164112edfced", "node_id": "C_kwDOAAsO6NoAKGJlNmEwOWY5NmJiZTBjMGM2Y2U5MDlhODRlYTAxNjQxMTJlZGZjZWQ", "commit": {"author": {"name": "Daniil Belov", "email": "70999565+BelovDV@users.noreply.github.com", "date": "2023-03-28T09:13:42Z"}, "committer": {"name": "Daniil Belov", "email": "70999565+BelovDV@users.noreply.github.com", "date": "2023-03-28T14:22:30Z"}, "message": "[fix] don't panic on failure to acquire jobserver token", "tree": {"sha": "a1b41e1d7bdd65e88f5f4ba844d16ecd3c2e213b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1b41e1d7bdd65e88f5f4ba844d16ecd3c2e213b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be6a09f96bbe0c0c6ce909a84ea0164112edfced", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be6a09f96bbe0c0c6ce909a84ea0164112edfced", "html_url": "https://github.com/rust-lang/rust/commit/be6a09f96bbe0c0c6ce909a84ea0164112edfced", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be6a09f96bbe0c0c6ce909a84ea0164112edfced/comments", "author": {"login": "belovdv", "id": 70999565, "node_id": "MDQ6VXNlcjcwOTk5NTY1", "avatar_url": "https://avatars.githubusercontent.com/u/70999565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/belovdv", "html_url": "https://github.com/belovdv", "followers_url": "https://api.github.com/users/belovdv/followers", "following_url": "https://api.github.com/users/belovdv/following{/other_user}", "gists_url": "https://api.github.com/users/belovdv/gists{/gist_id}", "starred_url": "https://api.github.com/users/belovdv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/belovdv/subscriptions", "organizations_url": "https://api.github.com/users/belovdv/orgs", "repos_url": "https://api.github.com/users/belovdv/repos", "events_url": "https://api.github.com/users/belovdv/events{/privacy}", "received_events_url": "https://api.github.com/users/belovdv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "belovdv", "id": 70999565, "node_id": "MDQ6VXNlcjcwOTk5NTY1", "avatar_url": "https://avatars.githubusercontent.com/u/70999565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/belovdv", "html_url": "https://github.com/belovdv", "followers_url": "https://api.github.com/users/belovdv/followers", "following_url": "https://api.github.com/users/belovdv/following{/other_user}", "gists_url": "https://api.github.com/users/belovdv/gists{/gist_id}", "starred_url": "https://api.github.com/users/belovdv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/belovdv/subscriptions", "organizations_url": "https://api.github.com/users/belovdv/orgs", "repos_url": "https://api.github.com/users/belovdv/repos", "events_url": "https://api.github.com/users/belovdv/events{/privacy}", "received_events_url": "https://api.github.com/users/belovdv/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cbc064b341be231403d181402a786cce7f1c73f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbc064b341be231403d181402a786cce7f1c73f1", "html_url": "https://github.com/rust-lang/rust/commit/cbc064b341be231403d181402a786cce7f1c73f1"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "2dda4cd169410e878690c3d94c3ced52599f66d3", "filename": "compiler/rustc_codegen_ssa/src/back/write.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/be6a09f96bbe0c0c6ce909a84ea0164112edfced/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be6a09f96bbe0c0c6ce909a84ea0164112edfced/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs?ref=be6a09f96bbe0c0c6ce909a84ea0164112edfced", "patch": "@@ -1452,8 +1452,8 @@ fn start_executing_work<B: ExtraBackendMethods>(\n                         Err(e) => {\n                             let msg = &format!(\"failed to acquire jobserver token: {}\", e);\n                             shared_emitter.fatal(msg);\n-                            // Exit the coordinator thread\n-                            panic!(\"{}\", msg)\n+                            codegen_done = true;\n+                            codegen_aborted = true;\n                         }\n                     }\n                 }"}, {"sha": "3b9104fc35484d504403ae3b6cddd6079007b0ed", "filename": "tests/run-make/jobserver-error/Makefile", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/be6a09f96bbe0c0c6ce909a84ea0164112edfced/tests%2Frun-make%2Fjobserver-error%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/be6a09f96bbe0c0c6ce909a84ea0164112edfced/tests%2Frun-make%2Fjobserver-error%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-make%2Fjobserver-error%2FMakefile?ref=be6a09f96bbe0c0c6ce909a84ea0164112edfced", "patch": "@@ -0,0 +1,8 @@\n+include ../../run-make-fulldeps/tools.mk\n+\n+# only-linux\n+\n+# Test compiler behavior in case: `jobserver-auth` points to correct pipe which is not jobserver.\n+\n+all:\n+\tbash -c 'echo \"fn main() {}\" | MAKEFLAGS=\"--jobserver-auth=3,3\" $(RUSTC) - 3</dev/null' 2>&1 | diff jobserver.stderr -"}, {"sha": "d18e15a2628892834dab1a42dc04bbf41fb75753", "filename": "tests/run-make/jobserver-error/jobserver.stderr", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/be6a09f96bbe0c0c6ce909a84ea0164112edfced/tests%2Frun-make%2Fjobserver-error%2Fjobserver.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/be6a09f96bbe0c0c6ce909a84ea0164112edfced/tests%2Frun-make%2Fjobserver-error%2Fjobserver.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-make%2Fjobserver-error%2Fjobserver.stderr?ref=be6a09f96bbe0c0c6ce909a84ea0164112edfced", "patch": "@@ -0,0 +1,4 @@\n+error: failed to acquire jobserver token: early EOF on jobserver pipe\n+\n+error: aborting due to previous error\n+"}]}