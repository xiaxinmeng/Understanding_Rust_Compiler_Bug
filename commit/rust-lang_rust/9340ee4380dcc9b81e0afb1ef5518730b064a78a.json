{"sha": "9340ee4380dcc9b81e0afb1ef5518730b064a78a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzNDBlZTQzODBkY2M5YjgxZTBhZmIxZWY1NTE4NzMwYjA2NGE3OGE=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-09-27T21:06:58Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-09-29T08:42:27Z"}, "message": "Ensure that all LLVM components requested by tests are available on CI", "tree": {"sha": "35973b7b10014163e1bc179787c93ce63472a770", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35973b7b10014163e1bc179787c93ce63472a770"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9340ee4380dcc9b81e0afb1ef5518730b064a78a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9340ee4380dcc9b81e0afb1ef5518730b064a78a", "html_url": "https://github.com/rust-lang/rust/commit/9340ee4380dcc9b81e0afb1ef5518730b064a78a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9340ee4380dcc9b81e0afb1ef5518730b064a78a/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26373fb4baa9c5b8a7a1e2821fcfa930a85d327d", "url": "https://api.github.com/repos/rust-lang/rust/commits/26373fb4baa9c5b8a7a1e2821fcfa930a85d327d", "html_url": "https://github.com/rust-lang/rust/commit/26373fb4baa9c5b8a7a1e2821fcfa930a85d327d"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "181a7fcb732661cffec9e8c9cf3233470ce922ac", "filename": "src/ci/run.sh", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9340ee4380dcc9b81e0afb1ef5518730b064a78a/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9340ee4380dcc9b81e0afb1ef5518730b064a78a/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=9340ee4380dcc9b81e0afb1ef5518730b064a78a", "patch": "@@ -104,6 +104,8 @@ if [ \"$RUST_RELEASE_CHANNEL\" = \"nightly\" ] || [ \"$DIST_REQUIRE_ALL_TOOLS\" = \"\" ]\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-missing-tools\"\n fi\n \n+export COMPILETEST_NEEDS_ALL_LLVM_COMPONENTS=1\n+\n # Print the date from the local machine and the date from an external source to\n # check for clock drifts. An HTTP URL is used instead of HTTPS since on Azure\n # Pipelines it happened that the certificates were marked as expired."}, {"sha": "59f64e7df0f41a219d23ed8c81d60a9d4ba0663f", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9340ee4380dcc9b81e0afb1ef5518730b064a78a/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9340ee4380dcc9b81e0afb1ef5518730b064a78a/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=9340ee4380dcc9b81e0afb1ef5518730b064a78a", "patch": "@@ -208,10 +208,13 @@ impl EarlyProps {\n                 config.parse_name_value_directive(line, \"needs-llvm-components\")\n             {\n                 let components: HashSet<_> = config.llvm_components.split_whitespace().collect();\n-                if !needed_components\n+                if let Some(missing_component) = needed_components\n                     .split_whitespace()\n-                    .all(|needed_component| components.contains(needed_component))\n+                    .find(|needed_component| !components.contains(needed_component))\n                 {\n+                    if env::var_os(\"COMPILETEST_NEEDS_ALL_LLVM_COMPONENTS\").is_some() {\n+                        panic!(\"missing LLVM component: {}\", missing_component);\n+                    }\n                     return true;\n                 }\n             }"}]}