{"sha": "32188d77ed8671f280722f72555c34d1bd096a86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyMTg4ZDc3ZWQ4NjcxZjI4MDcyMmY3MjU1NWMzNGQxYmQwOTZhODY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-09-08T13:08:11Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-09-08T13:08:11Z"}, "message": "Wrap <table> elements into <div> to prevent breaking layout and width", "tree": {"sha": "c9507bef8dba133f1dd5560b5baa0de7148eb87a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c9507bef8dba133f1dd5560b5baa0de7148eb87a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/32188d77ed8671f280722f72555c34d1bd096a86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/32188d77ed8671f280722f72555c34d1bd096a86", "html_url": "https://github.com/rust-lang/rust/commit/32188d77ed8671f280722f72555c34d1bd096a86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/32188d77ed8671f280722f72555c34d1bd096a86/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c858ba5bf7bd06c1a970efbf77053c8380b3151", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c858ba5bf7bd06c1a970efbf77053c8380b3151", "html_url": "https://github.com/rust-lang/rust/commit/1c858ba5bf7bd06c1a970efbf77053c8380b3151"}], "stats": {"total": 51, "additions": 48, "deletions": 3}, "files": [{"sha": "bb2bc5008e3403c2c63ae3cd073017f3edc83ff3", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 41, "deletions": 2, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=32188d77ed8671f280722f72555c34d1bd096a86", "patch": "@@ -441,6 +441,42 @@ impl<'a, I: Iterator<Item = Event<'a>>> Iterator for LinkReplacer<'a, I> {\n     }\n }\n \n+/// Wrap HTML tables into `<div>` to prevent having the doc blocks width being too big.\n+struct TableWrapper<'a, I: Iterator<Item = Event<'a>>> {\n+    inner: I,\n+    stored_events: VecDeque<Event<'a>>,\n+}\n+\n+impl<'a, I: Iterator<Item = Event<'a>>> TableWrapper<'a, I> {\n+    fn new(iter: I) -> Self {\n+        Self { inner: iter, stored_events: VecDeque::new() }\n+    }\n+}\n+\n+impl<'a, I: Iterator<Item = Event<'a>>> Iterator for TableWrapper<'a, I> {\n+    type Item = Event<'a>;\n+\n+    fn next(&mut self) -> Option<Self::Item> {\n+        if let Some(first) = self.stored_events.pop_front() {\n+            return Some(first);\n+        }\n+\n+        let event = self.inner.next()?;\n+\n+        Some(match event {\n+            Event::Start(Tag::Table(t)) => {\n+                self.stored_events.push_back(Event::Start(Tag::Table(t)));\n+                Event::Html(CowStr::Borrowed(\"<div>\"))\n+            }\n+            Event::End(Tag::Table(t)) => {\n+                self.stored_events.push_back(Event::Html(CowStr::Borrowed(\"</div>\")));\n+                Event::End(Tag::Table(t))\n+            }\n+            e => e,\n+        })\n+    }\n+}\n+\n type SpannedEvent<'a> = (Event<'a>, Range<usize>);\n \n /// Make headings links with anchor IDs and build up TOC.\n@@ -983,6 +1019,7 @@ impl Markdown<'_> {\n         let p = HeadingLinks::new(p, None, &mut ids);\n         let p = Footnotes::new(p);\n         let p = LinkReplacer::new(p.map(|(ev, _)| ev), links);\n+        let p = TableWrapper::new(p);\n         let p = CodeBlocks::new(p, codes, edition, playground);\n         html::push_html(&mut s, p);\n \n@@ -1003,7 +1040,8 @@ impl MarkdownWithToc<'_> {\n         {\n             let p = HeadingLinks::new(p, Some(&mut toc), &mut ids);\n             let p = Footnotes::new(p);\n-            let p = CodeBlocks::new(p.map(|(ev, _)| ev), codes, edition, playground);\n+            let p = TableWrapper::new(p.map(|(ev, _)| ev));\n+            let p = CodeBlocks::new(p, codes, edition, playground);\n             html::push_html(&mut s, p);\n         }\n \n@@ -1031,7 +1069,8 @@ impl MarkdownHtml<'_> {\n \n         let p = HeadingLinks::new(p, None, &mut ids);\n         let p = Footnotes::new(p);\n-        let p = CodeBlocks::new(p.map(|(ev, _)| ev), codes, edition, playground);\n+        let p = TableWrapper::new(p.map(|(ev, _)| ev));\n+        let p = CodeBlocks::new(p, codes, edition, playground);\n         html::push_html(&mut s, p);\n \n         s"}, {"sha": "6da60533b1ccd83c74e44bf295bf1c4e80a99e43", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=32188d77ed8671f280722f72555c34d1bd096a86", "patch": "@@ -273,7 +273,8 @@ fn item_module(w: &mut Buffer, cx: &Context<'_>, item: &clean::Item, items: &[cl\n             write!(\n                 w,\n                 \"<h2 id=\\\"{id}\\\" class=\\\"section-header\\\">\\\n-                       <a href=\\\"#{id}\\\">{name}</a></h2>\\n{}\",\n+                    <a href=\\\"#{id}\\\">{name}</a>\\\n+                 </h2>\\n{}\",\n                 ITEM_TABLE_OPEN,\n                 id = cx.derive_id(short.to_owned()),\n                 name = name"}, {"sha": "2d4bfc62af68e94e5fa26c8c14ba306b2953a903", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/32188d77ed8671f280722f72555c34d1bd096a86/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=32188d77ed8671f280722f72555c34d1bd096a86", "patch": "@@ -522,6 +522,11 @@ nav.sub {\n \tposition: relative;\n }\n \n+.docblock > * {\n+\tmax-width: 100%;\n+\toverflow-x: auto;\n+}\n+\n .content .out-of-band {\n \tflex-grow: 0;\n \ttext-align: right;"}]}