{"sha": "da2ed6f768452777c467a0d1e1a77fb92d9165c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhMmVkNmY3Njg0NTI3NzdjNDY3YTBkMWUxYTc3ZmI5MmQ5MTY1YzA=", "commit": {"author": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-06-14T12:56:03Z"}, "committer": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-06-14T12:58:54Z"}, "message": "Don't report UB for `#[no_mangle]` on associated functions", "tree": {"sha": "5d0de1026be73348384db6005e30f51acf569fe9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d0de1026be73348384db6005e30f51acf569fe9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da2ed6f768452777c467a0d1e1a77fb92d9165c0", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIsEABYIADMWIQRJ2jPMDdiQ+U4U42Z0+n/VuNoUuAUCYMdTHhUceWQtaHVhbmdA\nb3V0bG9vay5jb20ACgkQdPp/1bjaFLisCAD8CnEtSNwfTq9EY/+pD2AVmUFmmEjR\nQovSCpf3rtld7XUA/RSzpnnmeXm1M/b6x7ufuqQEP/EyG2vrK2tbcWio8C0B\n=LOEA\n-----END PGP SIGNATURE-----", "payload": "tree 5d0de1026be73348384db6005e30f51acf569fe9\nparent 99467349f2eb730ee90fabf758bc8068720ef392\nauthor hyd-dev <yd-huang@outlook.com> 1623675363 +0800\ncommitter hyd-dev <yd-huang@outlook.com> 1623675534 +0800\n\nDon't report UB for `#[no_mangle]` on associated functions\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da2ed6f768452777c467a0d1e1a77fb92d9165c0", "html_url": "https://github.com/rust-lang/rust/commit/da2ed6f768452777c467a0d1e1a77fb92d9165c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da2ed6f768452777c467a0d1e1a77fb92d9165c0/comments", "author": null, "committer": null, "parents": [{"sha": "99467349f2eb730ee90fabf758bc8068720ef392", "url": "https://api.github.com/repos/rust-lang/rust/commits/99467349f2eb730ee90fabf758bc8068720ef392", "html_url": "https://github.com/rust-lang/rust/commit/99467349f2eb730ee90fabf758bc8068720ef392"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "bcb2d262e858960c1aaf0f93c2c23edb339b2f6e", "filename": "src/shims/foreign_items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/da2ed6f768452777c467a0d1e1a77fb92d9165c0/src%2Fshims%2Fforeign_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da2ed6f768452777c467a0d1e1a77fb92d9165c0/src%2Fshims%2Fforeign_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fforeign_items.rs?ref=da2ed6f768452777c467a0d1e1a77fb92d9165c0", "patch": "@@ -177,7 +177,7 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                                 second_crate: tcx.crate_name(cnum),\n                             });\n                         }\n-                        if tcx.def_kind(def_id) != DefKind::Fn {\n+                        if !matches!(tcx.def_kind(def_id), DefKind::Fn | DefKind::AssocFn) {\n                             throw_ub_format!(\n                                 \"attempt to call an exported symbol that is not defined as a function\"\n                             );"}, {"sha": "db257dcb22c477e5e8d9092d1cfa0ecc2a9b9af6", "filename": "test-cargo-miri/exported-symbol-dep/src/lib.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/da2ed6f768452777c467a0d1e1a77fb92d9165c0/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da2ed6f768452777c467a0d1e1a77fb92d9165c0/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs?ref=da2ed6f768452777c467a0d1e1a77fb92d9165c0", "patch": "@@ -2,3 +2,12 @@\n fn exported_symbol() -> i32 {\n     123456\n }\n+\n+pub struct AssocFn;\n+\n+impl AssocFn {\n+    #[no_mangle]\n+    pub fn assoc_fn_as_exported_symbol() -> i32 {\n+        -123456\n+    }\n+}"}, {"sha": "cb1512d0502092e3f59931c7d7964b246e664f2b", "filename": "test-cargo-miri/src/main.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/da2ed6f768452777c467a0d1e1a77fb92d9165c0/test-cargo-miri%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da2ed6f768452777c467a0d1e1a77fb92d9165c0/test-cargo-miri%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Fmain.rs?ref=da2ed6f768452777c467a0d1e1a77fb92d9165c0", "patch": "@@ -62,15 +62,22 @@ mod test {\n     fn exported_symbol() {\n         extern crate cargo_miri_test;\n         extern crate exported_symbol;\n+        extern crate issue_rust_86261;\n         // Test calling exported symbols in (transitive) dependencies.\n         // Repeat calls to make sure the `Instance` cache is not broken.\n         for _ in 0..3 {\n             extern \"Rust\" {\n                 fn exported_symbol() -> i32;\n+                fn assoc_fn_as_exported_symbol() -> i32;\n                 fn make_true() -> bool;\n+                fn NoMangleStruct();\n+                fn no_mangle_generic();\n             }\n             assert_eq!(unsafe { exported_symbol() }, 123456);\n+            assert_eq!(unsafe { assoc_fn_as_exported_symbol() }, -123456);\n             assert!(unsafe { make_true() });\n+            unsafe { NoMangleStruct() }\n+            unsafe { no_mangle_generic() }\n         }\n     }\n }"}]}