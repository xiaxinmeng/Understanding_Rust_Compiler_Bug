{"sha": "5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhZTM4YmJjN2M2Yzc5YzRiYmRiMmYwOThiZjc3MGMyNDA4N2Y0MDM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-08-27T00:48:48Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-09-30T18:59:35Z"}, "message": "Stabilize proc macros in type positions", "tree": {"sha": "b830af373e756c684869bdfdbfe2a712c4c3da1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b830af373e756c684869bdfdbfe2a712c4c3da1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "html_url": "https://github.com/rust-lang/rust/commit/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "349259d55f9b006fe871a26eaa2481b4103dc9d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/349259d55f9b006fe871a26eaa2481b4103dc9d7", "html_url": "https://github.com/rust-lang/rust/commit/349259d55f9b006fe871a26eaa2481b4103dc9d7"}], "stats": {"total": 50, "additions": 23, "deletions": 27}, "files": [{"sha": "0540c95d3ded382b1192e67965f3d2ef56ea524c", "filename": "src/librustc_macros/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Flibrustc_macros%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Flibrustc_macros%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_macros%2Fsrc%2Flib.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -1,4 +1,3 @@\n-#![feature(proc_macro_hygiene)]\n #![allow(rustc::default_hash_types)]\n \n #![recursion_limit=\"128\"]"}, {"sha": "581ef5d4da9b31fe8e0866e348b33b63279b112f", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -749,14 +749,14 @@ impl<'a, 'b> MacroExpander<'a, 'b> {\n \n     fn gate_proc_macro_expansion_kind(&self, span: Span, kind: AstFragmentKind) {\n         let kind = match kind {\n-            AstFragmentKind::Expr => \"expressions\",\n+            AstFragmentKind::Expr |\n             AstFragmentKind::OptExpr => \"expressions\",\n             AstFragmentKind::Pat => \"patterns\",\n-            AstFragmentKind::Ty => \"types\",\n             AstFragmentKind::Stmts => \"statements\",\n-            AstFragmentKind::Items => return,\n-            AstFragmentKind::TraitItems => return,\n-            AstFragmentKind::ImplItems => return,\n+            AstFragmentKind::Ty |\n+            AstFragmentKind::Items |\n+            AstFragmentKind::TraitItems |\n+            AstFragmentKind::ImplItems |\n             AstFragmentKind::ForeignItems => return,\n             AstFragmentKind::Arms\n             | AstFragmentKind::Fields"}, {"sha": "223c4047cb2b1e2548b9dd2fb86fcf23ad00c3a7", "filename": "src/test/ui/proc-macro/dollar-crate-issue-62325.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fdollar-crate-issue-62325.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fdollar-crate-issue-62325.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fdollar-crate-issue-62325.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -7,8 +7,6 @@\n // normalize-stdout-test \"bytes\\([^0]\\w*\\.\\.(\\w+)\\)\" -> \"bytes(LO..$1)\"\n // normalize-stdout-test \"bytes\\((\\w+)\\.\\.[^0]\\w*\\)\" -> \"bytes($1..HI)\"\n \n-#![feature(proc_macro_hygiene)]\n-\n #[macro_use]\n extern crate test_macros;\n extern crate dollar_crate_external;"}, {"sha": "5605696715e34223efd00528a90d061e0ad7aad6", "filename": "src/test/ui/proc-macro/lifetimes.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -1,7 +1,5 @@\n // aux-build:lifetimes.rs\n \n-#![feature(proc_macro_hygiene)]\n-\n extern crate lifetimes;\n \n use lifetimes::*;"}, {"sha": "10acd4304aa231a9536879065ee6cf631d26d03b", "filename": "src/test/ui/proc-macro/lifetimes.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Flifetimes.stderr?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -1,5 +1,5 @@\n error: expected type, found `'`\n-  --> $DIR/lifetimes.rs:9:10\n+  --> $DIR/lifetimes.rs:7:10\n    |\n LL | type A = single_quote_alone!();\n    |          ^^^^^^^^^^^^^^^^^^^^^ this macro call doesn't expand to a type"}, {"sha": "19ed58eceb9647d3e342cead2f4af6ddb39afc39", "filename": "src/test/ui/proc-macro/macros-in-type.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fmacros-in-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fmacros-in-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fmacros-in-type.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -0,0 +1,11 @@\n+// check-pass\n+// aux-build:test-macros.rs\n+\n+#[macro_use]\n+extern crate test_macros;\n+\n+const C: identity!(u8) = 10;\n+\n+fn main() {\n+    let c: u8 = C;\n+}"}, {"sha": "0096a84f14c3490a865bcfa723a6082e0ba7bf99", "filename": "src/test/ui/proc-macro/proc-macro-gates.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.rs?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -50,7 +50,6 @@ fn attrs() {\n }\n \n fn main() {\n-    let _x: identity!(u32) = 3; //~ ERROR: procedural macros cannot be expanded to types\n     if let identity!(Some(_x)) = Some(3) {}\n     //~^ ERROR: procedural macros cannot be expanded to patterns\n "}, {"sha": "14a4f8c0fbca2ba265b9577fcf15b6a46b48db19", "filename": "src/test/ui/proc-macro/proc-macro-gates.stderr", "status": "modified", "additions": 6, "deletions": 15, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5ae38bbc7c6c79c4bbdb2f098bf770c24087f403/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fproc-macro-gates.stderr?ref=5ae38bbc7c6c79c4bbdb2f098bf770c24087f403", "patch": "@@ -94,17 +94,8 @@ LL |     let _x = #[identity_attr] println!();\n    = note: for more information, see https://github.com/rust-lang/rust/issues/54727\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n-error[E0658]: procedural macros cannot be expanded to types\n-  --> $DIR/proc-macro-gates.rs:53:13\n-   |\n-LL |     let _x: identity!(u32) = 3;\n-   |             ^^^^^^^^^^^^^^\n-   |\n-   = note: for more information, see https://github.com/rust-lang/rust/issues/54727\n-   = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n-\n error[E0658]: procedural macros cannot be expanded to patterns\n-  --> $DIR/proc-macro-gates.rs:54:12\n+  --> $DIR/proc-macro-gates.rs:53:12\n    |\n LL |     if let identity!(Some(_x)) = Some(3) {}\n    |            ^^^^^^^^^^^^^^^^^^^\n@@ -113,7 +104,7 @@ LL |     if let identity!(Some(_x)) = Some(3) {}\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n error[E0658]: procedural macros cannot be expanded to statements\n-  --> $DIR/proc-macro-gates.rs:57:5\n+  --> $DIR/proc-macro-gates.rs:56:5\n    |\n LL |     empty!(struct S;);\n    |     ^^^^^^^^^^^^^^^^^^\n@@ -122,7 +113,7 @@ LL |     empty!(struct S;);\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n error[E0658]: procedural macros cannot be expanded to statements\n-  --> $DIR/proc-macro-gates.rs:58:5\n+  --> $DIR/proc-macro-gates.rs:57:5\n    |\n LL |     empty!(let _x = 3;);\n    |     ^^^^^^^^^^^^^^^^^^^^\n@@ -131,7 +122,7 @@ LL |     empty!(let _x = 3;);\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n error[E0658]: procedural macros cannot be expanded to expressions\n-  --> $DIR/proc-macro-gates.rs:60:14\n+  --> $DIR/proc-macro-gates.rs:59:14\n    |\n LL |     let _x = identity!(3);\n    |              ^^^^^^^^^^^^\n@@ -140,14 +131,14 @@ LL |     let _x = identity!(3);\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n error[E0658]: procedural macros cannot be expanded to expressions\n-  --> $DIR/proc-macro-gates.rs:61:15\n+  --> $DIR/proc-macro-gates.rs:60:15\n    |\n LL |     let _x = [empty!(3)];\n    |               ^^^^^^^^^\n    |\n    = note: for more information, see https://github.com/rust-lang/rust/issues/54727\n    = help: add `#![feature(proc_macro_hygiene)]` to the crate attributes to enable\n \n-error: aborting due to 17 previous errors\n+error: aborting due to 16 previous errors\n \n For more information about this error, try `rustc --explain E0658`."}]}