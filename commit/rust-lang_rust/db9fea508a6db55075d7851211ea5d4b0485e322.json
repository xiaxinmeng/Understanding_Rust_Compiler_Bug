{"sha": "db9fea508a6db55075d7851211ea5d4b0485e322", "node_id": "C_kwDOAAsO6NoAKGRiOWZlYTUwOGE2ZGI1NTA3NWQ3ODUxMjExZWE1ZDRiMDQ4NWUzMjI", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-09-11T23:11:22Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-09-29T21:16:47Z"}, "message": "Avoid more invocations of hir_crate query.", "tree": {"sha": "76dd7a3c95269991994e12a73d020aed197fd592", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76dd7a3c95269991994e12a73d020aed197fd592"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db9fea508a6db55075d7851211ea5d4b0485e322", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db9fea508a6db55075d7851211ea5d4b0485e322", "html_url": "https://github.com/rust-lang/rust/commit/db9fea508a6db55075d7851211ea5d4b0485e322", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db9fea508a6db55075d7851211ea5d4b0485e322/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11491938f80988c7261a1179cf71a25c379c8783", "url": "https://api.github.com/repos/rust-lang/rust/commits/11491938f80988c7261a1179cf71a25c379c8783", "html_url": "https://github.com/rust-lang/rust/commit/11491938f80988c7261a1179cf71a25c379c8783"}], "stats": {"total": 264, "additions": 123, "deletions": 141}, "files": [{"sha": "21089b0208d0b943dcd508d558864c17d1dbae40", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 2, "deletions": 49, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -1,7 +1,7 @@\n use crate::def::{CtorKind, DefKind, Res};\n use crate::def_id::{DefId, CRATE_DEF_ID};\n crate use crate::hir_id::{HirId, ItemLocalId};\n-use crate::{itemlikevisit, LangItem};\n+use crate::LangItem;\n \n use rustc_ast::util::parser::ExprPrecedence;\n use rustc_ast::{self as ast, CrateSugar, LlvmAsmDialect};\n@@ -10,7 +10,6 @@ pub use rustc_ast::{BorrowKind, ImplPolarity, IsAuto};\n pub use rustc_ast::{CaptureBy, Movability, Mutability};\n use rustc_ast::{InlineAsmOptions, InlineAsmTemplatePiece};\n use rustc_data_structures::fx::FxHashMap;\n-use rustc_data_structures::sync::{par_for_each_in, Send, Sync};\n use rustc_index::vec::IndexVec;\n use rustc_macros::HashStable_Generic;\n use rustc_span::source_map::Spanned;\n@@ -672,7 +671,7 @@ pub struct Crate<'hir> {\n     pub attrs: BTreeMap<HirId, &'hir [Attribute]>,\n }\n \n-impl Crate<'hir> {\n+impl<'hir> Crate<'hir> {\n     pub fn module(&self) -> &'hir Mod<'hir> {\n         if let Some(OwnerNode::Crate(m)) = self.owners[CRATE_DEF_ID] { m } else { panic!() }\n     }\n@@ -698,52 +697,6 @@ impl Crate<'hir> {\n     }\n }\n \n-impl Crate<'_> {\n-    /// Visits all items in the crate in some deterministic (but\n-    /// unspecified) order. If you just need to process every item,\n-    /// but don't care about nesting, this method is the best choice.\n-    ///\n-    /// If you do care about nesting -- usually because your algorithm\n-    /// follows lexical scoping rules -- then you want a different\n-    /// approach. You should override `visit_nested_item` in your\n-    /// visitor and then call `intravisit::walk_crate` instead.\n-    pub fn visit_all_item_likes<'hir, V>(&'hir self, visitor: &mut V)\n-    where\n-        V: itemlikevisit::ItemLikeVisitor<'hir>,\n-    {\n-        for owner in self.owners.iter().filter_map(Option::as_ref) {\n-            match owner {\n-                OwnerNode::Item(item) => visitor.visit_item(item),\n-                OwnerNode::ForeignItem(item) => visitor.visit_foreign_item(item),\n-                OwnerNode::ImplItem(item) => visitor.visit_impl_item(item),\n-                OwnerNode::TraitItem(item) => visitor.visit_trait_item(item),\n-                OwnerNode::Crate(_) => {}\n-            }\n-        }\n-    }\n-\n-    /// A parallel version of `visit_all_item_likes`.\n-    pub fn par_visit_all_item_likes<'hir, V>(&'hir self, visitor: &V)\n-    where\n-        V: itemlikevisit::ParItemLikeVisitor<'hir> + Sync + Send,\n-    {\n-        par_for_each_in(&self.owners.raw, |owner| match owner {\n-            Some(OwnerNode::Item(item)) => visitor.visit_item(item),\n-            Some(OwnerNode::ForeignItem(item)) => visitor.visit_foreign_item(item),\n-            Some(OwnerNode::ImplItem(item)) => visitor.visit_impl_item(item),\n-            Some(OwnerNode::TraitItem(item)) => visitor.visit_trait_item(item),\n-            Some(OwnerNode::Crate(_)) | None => {}\n-        })\n-    }\n-\n-    pub fn items<'hir>(&'hir self) -> impl Iterator<Item = &'hir Item<'hir>> + 'hir {\n-        self.owners.iter().filter_map(|owner| match owner {\n-            Some(OwnerNode::Item(item)) => Some(*item),\n-            _ => None,\n-        })\n-    }\n-}\n-\n /// A block of statements `{ .. }`, which may have a label (in this case the\n /// `targeted_by_break` field will be `true`) and may be `unsafe` by means of\n /// the `rules` being anything but `DefaultBlock`."}, {"sha": "9196344cb3ffd0a7082747f95742ace62944cf17", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -51,19 +51,6 @@ pub struct NoAnn;\n impl PpAnn for NoAnn {}\n pub const NO_ANN: &dyn PpAnn = &NoAnn;\n \n-impl PpAnn for hir::Crate<'_> {\n-    fn nested(&self, state: &mut State<'_>, nested: Nested) {\n-        match nested {\n-            Nested::Item(id) => state.print_item(self.item(id)),\n-            Nested::TraitItem(id) => state.print_trait_item(self.trait_item(id)),\n-            Nested::ImplItem(id) => state.print_impl_item(self.impl_item(id)),\n-            Nested::ForeignItem(id) => state.print_foreign_item(self.foreign_item(id)),\n-            Nested::Body(id) => state.print_expr(&self.body(id).value),\n-            Nested::BodyParamPat(id, i) => state.print_pat(&self.body(id).params[i].pat),\n-        }\n-    }\n-}\n-\n /// Identical to the `PpAnn` implementation for `hir::Crate`,\n /// except it avoids creating a dependency on the whole crate.\n impl PpAnn for &dyn rustc_hir::intravisit::Map<'_> {"}, {"sha": "d42e2f7a99c8a233dea069c8743b4013ef0391d0", "filename": "compiler/rustc_incremental/src/assert_dep_graph.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_incremental%2Fsrc%2Fassert_dep_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_incremental%2Fsrc%2Fassert_dep_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_incremental%2Fsrc%2Fassert_dep_graph.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -74,7 +74,7 @@ pub fn assert_dep_graph(tcx: TyCtxt<'_>) {\n             let mut visitor =\n                 IfThisChanged { tcx, if_this_changed: vec![], then_this_would_need: vec![] };\n             visitor.process_attrs(hir::CRATE_HIR_ID);\n-            tcx.hir().krate().visit_all_item_likes(&mut visitor.as_deep_visitor());\n+            tcx.hir().visit_all_item_likes(&mut visitor.as_deep_visitor());\n             (visitor.if_this_changed, visitor.then_this_would_need)\n         };\n "}, {"sha": "55286384de359522b3855c3ad7216bbc8a98a7b1", "filename": "compiler/rustc_incremental/src/persist/dirty_clean.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -137,9 +137,8 @@ pub fn check_dirty_clean_annotations(tcx: TyCtxt<'_>) {\n     }\n \n     tcx.dep_graph.with_ignore(|| {\n-        let krate = tcx.hir().krate();\n         let mut dirty_clean_visitor = DirtyCleanVisitor { tcx, checked_attrs: Default::default() };\n-        krate.visit_all_item_likes(&mut dirty_clean_visitor);\n+        tcx.hir().visit_all_item_likes(&mut dirty_clean_visitor);\n \n         let mut all_attrs = FindAllAttrs { tcx, found_attrs: vec![] };\n         tcx.hir().walk_attributes(&mut all_attrs);"}, {"sha": "c0316ce58d26e7ea12e9f93fb864ac83b0760886", "filename": "compiler/rustc_interface/src/proc_macro_decls.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_interface%2Fsrc%2Fproc_macro_decls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_interface%2Fsrc%2Fproc_macro_decls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Fproc_macro_decls.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -7,7 +7,7 @@ use rustc_span::symbol::sym;\n \n fn proc_macro_decls_static(tcx: TyCtxt<'_>, (): ()) -> Option<LocalDefId> {\n     let mut finder = Finder { tcx, decls: None };\n-    tcx.hir().krate().visit_all_item_likes(&mut finder);\n+    tcx.hir().visit_all_item_likes(&mut finder);\n \n     finder.decls.map(|id| tcx.hir().local_def_id(id))\n }"}, {"sha": "a24f346fb943dd14c8680731354fcf79e70d1a2c", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -584,8 +584,14 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n         self.doc_hidden_stack.pop().expect(\"empty doc_hidden_stack\");\n     }\n \n-    fn check_crate(&mut self, cx: &LateContext<'_>, krate: &hir::Crate<'_>) {\n-        self.check_missing_docs_attrs(cx, CRATE_DEF_ID, krate.module().inner, \"the\", \"crate\");\n+    fn check_crate(&mut self, cx: &LateContext<'_>, _: &hir::Crate<'_>) {\n+        self.check_missing_docs_attrs(\n+            cx,\n+            CRATE_DEF_ID,\n+            cx.tcx.def_span(CRATE_DEF_ID),\n+            \"the\",\n+            \"crate\",\n+        );\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'_>, it: &hir::Item<'_>) {"}, {"sha": "9eac4c9f69b5c559966220c7757b0933107759bc", "filename": "compiler/rustc_metadata/src/foreign_modules.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Fforeign_modules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Fforeign_modules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Fforeign_modules.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -5,7 +5,7 @@ use rustc_middle::ty::TyCtxt;\n \n crate fn collect(tcx: TyCtxt<'_>) -> Vec<ForeignModule> {\n     let mut collector = Collector { modules: Vec::new() };\n-    tcx.hir().krate().visit_all_item_likes(&mut collector);\n+    tcx.hir().visit_all_item_likes(&mut collector);\n     collector.modules\n }\n "}, {"sha": "39709e1bd0716916eee7f355ddd56153567f41f1", "filename": "compiler/rustc_metadata/src/native_libs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Fnative_libs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Fnative_libs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Fnative_libs.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -14,7 +14,7 @@ use rustc_target::spec::abi::Abi;\n \n crate fn collect(tcx: TyCtxt<'_>) -> Vec<NativeLib> {\n     let mut collector = Collector { tcx, libs: Vec::new() };\n-    tcx.hir().krate().visit_all_item_likes(&mut collector);\n+    tcx.hir().visit_all_item_likes(&mut collector);\n     collector.process_command_line();\n     collector.libs\n }"}, {"sha": "c0f3228767e56f8f50a47b7331c6a501c906ef3b", "filename": "compiler/rustc_metadata/src/rmeta/encoder.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -440,16 +440,15 @@ impl<'a, 'tcx> EncodeContext<'a, 'tcx> {\n     }\n \n     fn encode_info_for_items(&mut self) {\n-        let krate = self.tcx.hir().krate();\n-        self.encode_info_for_mod(CRATE_DEF_ID, krate.module());\n+        self.encode_info_for_mod(CRATE_DEF_ID, self.tcx.hir().root_module());\n \n         // Proc-macro crates only export proc-macro items, which are looked\n         // up using `proc_macro_data`\n         if self.is_proc_macro {\n             return;\n         }\n \n-        krate.visit_all_item_likes(&mut self.as_deep_visitor());\n+        self.tcx.hir().visit_all_item_likes(&mut self.as_deep_visitor());\n     }\n \n     fn encode_def_path_table(&mut self) {\n@@ -1782,7 +1781,7 @@ impl EncodeContext<'a, 'tcx> {\n         debug!(\"EncodeContext::encode_impls()\");\n         let tcx = self.tcx;\n         let mut visitor = ImplVisitor { tcx, impls: FxHashMap::default() };\n-        tcx.hir().krate().visit_all_item_likes(&mut visitor);\n+        tcx.hir().visit_all_item_likes(&mut visitor);\n \n         let mut all_impls: Vec<_> = visitor.impls.into_iter().collect();\n "}, {"sha": "dfa738652a5c181df1c86e8e9763125878874595", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -6,6 +6,7 @@ use rustc_ast as ast;\n use rustc_data_structures::fingerprint::Fingerprint;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_data_structures::svh::Svh;\n+use rustc_data_structures::sync::{par_for_each_in, Send, Sync};\n use rustc_hir::def::{DefKind, Res};\n use rustc_hir::def_id::{CrateNum, DefId, LocalDefId, CRATE_DEF_ID, LOCAL_CRATE};\n use rustc_hir::definitions::{DefKey, DefPath, DefPathHash};\n@@ -156,6 +157,21 @@ impl<'hir> Map<'hir> {\n         self.tcx.hir_crate(())\n     }\n \n+    pub fn root_module(&self) -> &'hir Mod<'hir> {\n+        match self.tcx.hir_owner(CRATE_DEF_ID).map(|o| o.node) {\n+            Some(OwnerNode::Crate(item)) => item,\n+            _ => panic!(),\n+        }\n+    }\n+\n+    crate fn items(&self) -> impl Iterator<Item = &'hir Item<'hir>> + 'hir {\n+        let krate = self.krate();\n+        krate.owners.iter().filter_map(|owner| match owner.as_ref()? {\n+            OwnerNode::Item(item) => Some(*item),\n+            _ => None,\n+        })\n+    }\n+\n     pub fn def_key(&self, def_id: LocalDefId) -> DefKey {\n         // Accessing the DefKey is ok, since it is part of DefPathHash.\n         self.tcx.untracked_resolutions.definitions.def_key(def_id)\n@@ -531,6 +547,45 @@ impl<'hir> Map<'hir> {\n         }\n     }\n \n+    /// Visits all items in the crate in some deterministic (but\n+    /// unspecified) order. If you just need to process every item,\n+    /// but don't care about nesting, this method is the best choice.\n+    ///\n+    /// If you do care about nesting -- usually because your algorithm\n+    /// follows lexical scoping rules -- then you want a different\n+    /// approach. You should override `visit_nested_item` in your\n+    /// visitor and then call `intravisit::walk_crate` instead.\n+    pub fn visit_all_item_likes<V>(&self, visitor: &mut V)\n+    where\n+        V: itemlikevisit::ItemLikeVisitor<'hir>,\n+    {\n+        let krate = self.krate();\n+        for owner in krate.owners.iter().filter_map(Option::as_ref) {\n+            match owner {\n+                OwnerNode::Item(item) => visitor.visit_item(item),\n+                OwnerNode::ForeignItem(item) => visitor.visit_foreign_item(item),\n+                OwnerNode::ImplItem(item) => visitor.visit_impl_item(item),\n+                OwnerNode::TraitItem(item) => visitor.visit_trait_item(item),\n+                OwnerNode::Crate(_) => {}\n+            }\n+        }\n+    }\n+\n+    /// A parallel version of `visit_all_item_likes`.\n+    pub fn par_visit_all_item_likes<V>(&self, visitor: &V)\n+    where\n+        V: itemlikevisit::ParItemLikeVisitor<'hir> + Sync + Send,\n+    {\n+        let krate = self.krate();\n+        par_for_each_in(&krate.owners.raw, |owner| match owner.as_ref() {\n+            Some(OwnerNode::Item(item)) => visitor.visit_item(item),\n+            Some(OwnerNode::ForeignItem(item)) => visitor.visit_foreign_item(item),\n+            Some(OwnerNode::ImplItem(item)) => visitor.visit_impl_item(item),\n+            Some(OwnerNode::TraitItem(item)) => visitor.visit_trait_item(item),\n+            Some(OwnerNode::Crate(_)) | None => {}\n+        })\n+    }\n+\n     pub fn visit_item_likes_in_module<V>(&self, module: LocalDefId, visitor: &mut V)\n     where\n         V: ItemLikeVisitor<'hir>,"}, {"sha": "a2211f4c3b2b4ba4969a124270e939b1e4ef3a0f", "filename": "compiler/rustc_middle/src/ty/print/pretty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fprint%2Fpretty.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -2340,7 +2340,7 @@ define_print_and_forward_display! {\n fn for_each_def(tcx: TyCtxt<'_>, mut collect_fn: impl for<'b> FnMut(&'b Ident, Namespace, DefId)) {\n     // Iterate all local crate items no matter where they are defined.\n     let hir = tcx.hir();\n-    for item in hir.krate().items() {\n+    for item in hir.items() {\n         if item.ident.name.as_str().is_empty() || matches!(item.kind, ItemKind::Use(_, _)) {\n             continue;\n         }"}, {"sha": "fadb701457000bb3860be1b223786e80165b9726", "filename": "compiler/rustc_mir_transform/src/lib.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Flib.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -160,9 +160,7 @@ fn mir_keys(tcx: TyCtxt<'_>, (): ()) -> FxHashSet<LocalDefId> {\n             NestedVisitorMap::None\n         }\n     }\n-    tcx.hir()\n-        .krate()\n-        .visit_all_item_likes(&mut GatherCtors { tcx, set: &mut set }.as_deep_visitor());\n+    tcx.hir().visit_all_item_likes(&mut GatherCtors { tcx, set: &mut set }.as_deep_visitor());\n \n     set\n }"}, {"sha": "f06426308a2287d58e263066f3f046a6452b732b", "filename": "compiler/rustc_monomorphize/src/collector.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_monomorphize%2Fsrc%2Fcollector.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -330,7 +330,7 @@ fn collect_roots(tcx: TyCtxt<'_>, mode: MonoItemCollectionMode) -> Vec<MonoItem<\n \n         let mut visitor = RootCollector { tcx, mode, entry_fn, output: &mut roots };\n \n-        tcx.hir().krate().visit_all_item_likes(&mut visitor);\n+        tcx.hir().visit_all_item_likes(&mut visitor);\n \n         visitor.push_extra_entry_roots();\n     }"}, {"sha": "d05961b7e3741e065afe59d86d7b1d19c7c947f9", "filename": "compiler/rustc_passes/src/dead.rs", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fdead.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -510,15 +510,14 @@ fn has_allow_dead_code_or_lang_attr(tcx: TyCtxt<'_>, id: hir::HirId) -> bool {\n //   or\n //   2) We are not sure to be live or not\n //     * Implementations of traits and trait methods\n-struct LifeSeeder<'k, 'tcx> {\n+struct LifeSeeder<'tcx> {\n     worklist: Vec<LocalDefId>,\n-    krate: &'k hir::Crate<'k>,\n     tcx: TyCtxt<'tcx>,\n     // see `MarkSymbolVisitor::struct_constructors`\n     struct_constructors: FxHashMap<LocalDefId, LocalDefId>,\n }\n \n-impl<'v, 'k, 'tcx> ItemLikeVisitor<'v> for LifeSeeder<'k, 'tcx> {\n+impl<'v, 'tcx> ItemLikeVisitor<'v> for LifeSeeder<'tcx> {\n     fn visit_item(&mut self, item: &hir::Item<'_>) {\n         let allow_dead_code = has_allow_dead_code_or_lang_attr(self.tcx, item.hir_id());\n         if allow_dead_code {\n@@ -545,7 +544,7 @@ impl<'v, 'k, 'tcx> ItemLikeVisitor<'v> for LifeSeeder<'k, 'tcx> {\n                     self.worklist.push(item.def_id);\n                 }\n                 for impl_item_ref in items {\n-                    let impl_item = self.krate.impl_item(impl_item_ref.id);\n+                    let impl_item = self.tcx.hir().impl_item(impl_item_ref.id);\n                     if of_trait.is_some()\n                         || has_allow_dead_code_or_lang_attr(self.tcx, impl_item.hir_id())\n                     {\n@@ -589,7 +588,6 @@ impl<'v, 'k, 'tcx> ItemLikeVisitor<'v> for LifeSeeder<'k, 'tcx> {\n fn create_and_seed_worklist<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     access_levels: &privacy::AccessLevels,\n-    krate: &hir::Crate<'_>,\n ) -> (Vec<LocalDefId>, FxHashMap<LocalDefId, LocalDefId>) {\n     let worklist = access_levels\n         .map\n@@ -604,19 +602,17 @@ fn create_and_seed_worklist<'tcx>(\n         .collect::<Vec<_>>();\n \n     // Seed implemented trait items\n-    let mut life_seeder =\n-        LifeSeeder { worklist, krate, tcx, struct_constructors: Default::default() };\n-    krate.visit_all_item_likes(&mut life_seeder);\n+    let mut life_seeder = LifeSeeder { worklist, tcx, struct_constructors: Default::default() };\n+    tcx.hir().visit_all_item_likes(&mut life_seeder);\n \n     (life_seeder.worklist, life_seeder.struct_constructors)\n }\n \n fn find_live<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     access_levels: &privacy::AccessLevels,\n-    krate: &hir::Crate<'_>,\n ) -> FxHashSet<LocalDefId> {\n-    let (worklist, struct_constructors) = create_and_seed_worklist(tcx, access_levels, krate);\n+    let (worklist, struct_constructors) = create_and_seed_worklist(tcx, access_levels);\n     let mut symbol_visitor = MarkSymbolVisitor {\n         worklist,\n         tcx,\n@@ -834,8 +830,7 @@ impl Visitor<'tcx> for DeadVisitor<'tcx> {\n \n pub fn check_crate(tcx: TyCtxt<'_>) {\n     let access_levels = &tcx.privacy_access_levels(());\n-    let krate = tcx.hir().krate();\n-    let live_symbols = find_live(tcx, access_levels, krate);\n+    let live_symbols = find_live(tcx, access_levels);\n     let mut visitor = DeadVisitor { tcx, live_symbols };\n     tcx.hir().walk_toplevel_module(&mut visitor);\n }"}, {"sha": "d35a1cc293ecf75c10d05f7ed30121b2351f0b0c", "filename": "compiler/rustc_passes/src/diagnostic_items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fdiagnostic_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fdiagnostic_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fdiagnostic_items.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -105,7 +105,7 @@ fn diagnostic_items<'tcx>(tcx: TyCtxt<'tcx>, cnum: CrateNum) -> FxHashMap<Symbol\n     let mut collector = DiagnosticItemCollector::new(tcx);\n \n     // Collect diagnostic items in this crate.\n-    tcx.hir().krate().visit_all_item_likes(&mut collector);\n+    tcx.hir().visit_all_item_likes(&mut collector);\n \n     collector.items\n }"}, {"sha": "63f9b3ed6b15c6c7b5828ab8e41da567621b94bc", "filename": "compiler/rustc_passes/src/entry.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fentry.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -1,6 +1,6 @@\n use rustc_ast::entry::EntryPointType;\n use rustc_errors::struct_span_err;\n-use rustc_hir::def_id::{DefId, CRATE_DEF_INDEX, LOCAL_CRATE};\n+use rustc_hir::def_id::{DefId, CRATE_DEF_ID, CRATE_DEF_INDEX, LOCAL_CRATE};\n use rustc_hir::itemlikevisit::ItemLikeVisitor;\n use rustc_hir::{ForeignItem, HirId, ImplItem, Item, ItemKind, Node, TraitItem, CRATE_HIR_ID};\n use rustc_middle::hir::map::Map;\n@@ -68,7 +68,7 @@ fn entry_fn(tcx: TyCtxt<'_>, (): ()) -> Option<(DefId, EntryFnType)> {\n         non_main_fns: Vec::new(),\n     };\n \n-    tcx.hir().krate().visit_all_item_likes(&mut ctxt);\n+    tcx.hir().visit_all_item_likes(&mut ctxt);\n \n     configure_main(tcx, &ctxt)\n }\n@@ -183,7 +183,7 @@ fn configure_main(tcx: TyCtxt<'_>, visitor: &EntryContext<'_, '_>) -> Option<(De\n }\n \n fn no_main_err(tcx: TyCtxt<'_>, visitor: &EntryContext<'_, '_>) {\n-    let sp = tcx.hir().krate().module().inner;\n+    let sp = tcx.def_span(CRATE_DEF_ID);\n     if *tcx.sess.parse_sess.reached_eof.borrow() {\n         // There's an unclosed brace that made the parser reach `Eof`, we shouldn't complain about\n         // the missing `fn main()` then as it might have been hidden inside an unclosed block."}, {"sha": "c14f4460a31360dc745505c7aafc515982540ac0", "filename": "compiler/rustc_passes/src/lang_items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Flang_items.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -262,7 +262,7 @@ fn get_lang_items(tcx: TyCtxt<'_>, (): ()) -> LanguageItems {\n     }\n \n     // Collect lang items in this crate.\n-    tcx.hir().krate().visit_all_item_likes(&mut collector);\n+    tcx.hir().visit_all_item_likes(&mut collector);\n \n     // Extract out the found lang items.\n     let LanguageItemCollector { mut items, .. } = collector;"}, {"sha": "558d8958b13588bbf7b48783d9c02cf41ab768bc", "filename": "compiler/rustc_passes/src/layout_test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Flayout_test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Flayout_test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Flayout_test.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -12,7 +12,7 @@ use rustc_target::abi::{HasDataLayout, TargetDataLayout};\n pub fn test_layout(tcx: TyCtxt<'_>) {\n     if tcx.features().rustc_attrs {\n         // if the `rustc_attrs` feature is not enabled, don't bother testing layout\n-        tcx.hir().krate().visit_all_item_likes(&mut LayoutTest { tcx });\n+        tcx.hir().visit_all_item_likes(&mut LayoutTest { tcx });\n     }\n }\n "}, {"sha": "bd1e9520ee9fe40cac3f6bae237469b21cb262df", "filename": "compiler/rustc_passes/src/reachable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Freachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Freachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Freachable.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -427,7 +427,7 @@ fn reachable_set<'tcx>(tcx: TyCtxt<'tcx>, (): ()) -> FxHashSet<LocalDefId> {\n             access_levels,\n             worklist: &mut reachable_context.worklist,\n         };\n-        tcx.hir().krate().visit_all_item_likes(&mut collect_private_impl_items);\n+        tcx.hir().visit_all_item_likes(&mut collect_private_impl_items);\n     }\n \n     // Step 2: Mark all symbols that the symbols on the worklist touch."}, {"sha": "8c9f04bef13769ac3cc65aa9da5a49283cd4d2af", "filename": "compiler/rustc_passes/src/stability.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fstability.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -906,11 +906,10 @@ pub fn check_unused_or_stable_features(tcx: TyCtxt<'_>) {\n     let access_levels = &tcx.privacy_access_levels(());\n \n     if tcx.stability().staged_api[&LOCAL_CRATE] {\n-        let krate = tcx.hir().krate();\n         let mut missing = MissingStabilityAnnotations { tcx, access_levels };\n         missing.check_missing_stability(CRATE_DEF_ID, tcx.hir().span(CRATE_HIR_ID));\n         tcx.hir().walk_toplevel_module(&mut missing);\n-        krate.visit_all_item_likes(&mut missing.as_deep_visitor());\n+        tcx.hir().visit_all_item_likes(&mut missing.as_deep_visitor());\n     }\n \n     let declared_lang_features = &tcx.features().declared_lang_features;"}, {"sha": "bb5be90cd404b3e30dab1318cbb048e70e323715", "filename": "compiler/rustc_passes/src/weak_lang_items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -33,7 +33,7 @@ pub fn check_crate<'tcx>(tcx: TyCtxt<'tcx>, items: &mut lang_items::LanguageItem\n \n     {\n         let mut cx = Context { tcx, items };\n-        tcx.hir().krate().visit_all_item_likes(&mut cx.as_deep_visitor());\n+        tcx.hir().visit_all_item_likes(&mut cx.as_deep_visitor());\n     }\n     verify(tcx, items);\n }"}, {"sha": "719d4134ab8f1f9d69bd98be5d4972de4cff4efe", "filename": "compiler/rustc_privacy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_privacy%2Fsrc%2Flib.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -2189,8 +2189,6 @@ fn privacy_access_levels(tcx: TyCtxt<'_>, (): ()) -> &AccessLevels {\n fn check_private_in_public(tcx: TyCtxt<'_>, (): ()) {\n     let access_levels = tcx.privacy_access_levels(());\n \n-    let krate = tcx.hir().krate();\n-\n     let mut visitor = ObsoleteVisiblePrivateTypesVisitor {\n         tcx,\n         access_levels: &access_levels,\n@@ -2230,5 +2228,5 @@ fn check_private_in_public(tcx: TyCtxt<'_>, (): ()) {\n             .filter_map(|hir_id| tcx.hir().opt_local_def_id(hir_id))\n             .collect(),\n     };\n-    krate.visit_all_item_likes(&mut DeepVisitor::new(&mut visitor));\n+    tcx.hir().visit_all_item_likes(&mut DeepVisitor::new(&mut visitor));\n }"}, {"sha": "c47d8b934cf2a452a29994e71a20e14bb06df53e", "filename": "compiler/rustc_save_analysis/src/dump_visitor.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Fdump_visitor.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -18,7 +18,7 @@ use rustc_ast::walk_list;\n use rustc_data_structures::fx::FxHashSet;\n use rustc_hir as hir;\n use rustc_hir::def::{DefKind as HirDefKind, Res};\n-use rustc_hir::def_id::{DefId, LocalDefId};\n+use rustc_hir::def_id::{DefId, LocalDefId, CRATE_DEF_ID};\n use rustc_hir::intravisit::{self, Visitor};\n use rustc_hir_pretty::{bounds_to_string, fn_to_string, generic_params_to_string, ty_to_string};\n use rustc_middle::hir::map::Map;\n@@ -128,7 +128,7 @@ impl<'tcx> DumpVisitor<'tcx> {\n         self.save_ctxt.lookup_def_id(ref_id)\n     }\n \n-    pub fn dump_crate_info(&mut self, name: &str, krate: &hir::Crate<'_>) {\n+    pub fn dump_crate_info(&mut self, name: &str) {\n         let source_file = self.tcx.sess.local_crate_source_file.as_ref();\n         let crate_root = source_file.map(|source_file| {\n             let source_file = Path::new(source_file);\n@@ -146,7 +146,7 @@ impl<'tcx> DumpVisitor<'tcx> {\n             },\n             crate_root: crate_root.unwrap_or_else(|| \"<no source>\".to_owned()),\n             external_crates: self.save_ctxt.get_external_crates(),\n-            span: self.span_from_span(krate.module().inner),\n+            span: self.span_from_span(self.tcx.def_span(CRATE_DEF_ID)),\n         };\n \n         self.dumper.crate_prelude(data);\n@@ -1090,13 +1090,13 @@ impl<'tcx> DumpVisitor<'tcx> {\n         }\n     }\n \n-    pub(crate) fn process_crate(&mut self, krate: &'tcx hir::Crate<'tcx>) {\n+    pub(crate) fn process_crate(&mut self) {\n         let id = hir::CRATE_HIR_ID;\n         let qualname =\n             format!(\"::{}\", self.tcx.def_path_str(self.tcx.hir().local_def_id(id).to_def_id()));\n \n         let sm = self.tcx.sess.source_map();\n-        let krate_mod = krate.module();\n+        let krate_mod = self.tcx.hir().root_module();\n         let filename = sm.span_to_filename(krate_mod.inner);\n         let data_id = id_from_hir_id(id, &self.save_ctxt);\n         let children ="}, {"sha": "d69d7daa55517fbfb8dce2e2366b4e64e56006a0", "filename": "compiler/rustc_save_analysis/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Flib.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -1003,9 +1003,9 @@ pub fn process_crate<'l, 'tcx, H: SaveHandler>(\n \n             let mut visitor = DumpVisitor::new(save_ctxt);\n \n-            visitor.dump_crate_info(cratename, tcx.hir().krate());\n+            visitor.dump_crate_info(cratename);\n             visitor.dump_compilation_options(input, cratename);\n-            visitor.process_crate(tcx.hir().krate());\n+            visitor.process_crate();\n \n             handler.save(&visitor.save_ctxt, &visitor.analysis())\n         })"}, {"sha": "f7d68b5cc70611a1121cb016d256584fa3b87127", "filename": "compiler/rustc_symbol_mangling/src/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -23,7 +23,7 @@ pub fn report_symbol_names(tcx: TyCtxt<'_>) {\n \n     tcx.dep_graph.with_ignore(|| {\n         let mut visitor = SymbolNamesTest { tcx };\n-        tcx.hir().krate().visit_all_item_likes(&mut visitor);\n+        tcx.hir().visit_all_item_likes(&mut visitor);\n     })\n }\n "}, {"sha": "47da8e9572b7cfd298f22c64f6406a6db336c7f7", "filename": "compiler/rustc_typeck/src/check/check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -31,7 +31,7 @@ use std::ops::ControlFlow;\n \n pub fn check_wf_new(tcx: TyCtxt<'_>) {\n     let visit = wfcheck::CheckTypeWellFormedVisitor::new(tcx);\n-    tcx.hir().krate().par_visit_all_item_likes(&visit);\n+    tcx.hir().par_visit_all_item_likes(&visit);\n }\n \n pub(super) fn check_abi(tcx: TyCtxt<'_>, hir_id: hir::HirId, span: Span, abi: Abi) {"}, {"sha": "0071fd2c494c0bea4648a4d2c34b63e0ae95a2c0", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -1646,7 +1646,7 @@ fn compute_all_traits(tcx: TyCtxt<'_>, (): ()) -> &[DefId] {\n         fn visit_foreign_item(&mut self, _foreign_item: &hir::ForeignItem<'_>) {}\n     }\n \n-    tcx.hir().krate().visit_all_item_likes(&mut Visitor { traits: &mut traits });\n+    tcx.hir().visit_all_item_likes(&mut Visitor { traits: &mut traits });\n \n     // Cross-crate:\n "}, {"sha": "048f48b035194c370f1022401ca7804f19d73fb1", "filename": "compiler/rustc_typeck/src/check_unused.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck_unused.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -16,7 +16,7 @@ pub fn check_crate(tcx: TyCtxt<'_>) {\n     }\n \n     let mut visitor = CheckVisitor { tcx, used_trait_imports };\n-    tcx.hir().krate().visit_all_item_likes(&mut visitor);\n+    tcx.hir().visit_all_item_likes(&mut visitor);\n \n     unused_crates_lint(tcx);\n }\n@@ -111,7 +111,7 @@ fn unused_crates_lint(tcx: TyCtxt<'_>) {\n \n     // Collect all the extern crates (in a reliable order).\n     let mut crates_to_lint = vec![];\n-    tcx.hir().krate().visit_all_item_likes(&mut CollectExternCrateVisitor {\n+    tcx.hir().visit_all_item_likes(&mut CollectExternCrateVisitor {\n         crates_to_lint: &mut crates_to_lint,\n     });\n "}, {"sha": "0b6d0a539b53bb3fa24f7c64ccd639b8b33d567a", "filename": "compiler/rustc_typeck/src/coherence/inherent_impls.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -17,9 +17,8 @@ use rustc_span::Span;\n \n /// On-demand query: yields a map containing all types mapped to their inherent impls.\n pub fn crate_inherent_impls(tcx: TyCtxt<'_>, (): ()) -> CrateInherentImpls {\n-    let krate = tcx.hir().krate();\n     let mut collect = InherentCollect { tcx, impls_map: Default::default() };\n-    krate.visit_all_item_likes(&mut collect);\n+    tcx.hir().visit_all_item_likes(&mut collect);\n     collect.impls_map\n }\n "}, {"sha": "11ffd61cb2ebda16b6919c045cb7ec390446227b", "filename": "compiler/rustc_typeck/src/coherence/inherent_impls_overlap.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -10,8 +10,7 @@ use smallvec::SmallVec;\n use std::collections::hash_map::Entry;\n \n pub fn crate_inherent_impls_overlap_check(tcx: TyCtxt<'_>, (): ()) {\n-    let krate = tcx.hir().krate();\n-    krate.visit_all_item_likes(&mut InherentOverlapChecker { tcx });\n+    tcx.hir().visit_all_item_likes(&mut InherentOverlapChecker { tcx });\n }\n \n struct InherentOverlapChecker<'tcx> {"}, {"sha": "0326d1fd74f62c0548718e1a5033b28d3d5f3652", "filename": "compiler/rustc_typeck/src/coherence/orphan.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Forphan.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -10,7 +10,7 @@ use rustc_trait_selection::traits;\n \n pub fn check(tcx: TyCtxt<'_>) {\n     let mut orphan = OrphanChecker { tcx };\n-    tcx.hir().krate().visit_all_item_likes(&mut orphan);\n+    tcx.hir().visit_all_item_likes(&mut orphan);\n }\n \n struct OrphanChecker<'tcx> {"}, {"sha": "e7b03fa3ac68a9d83e05ccf15e8c84b70a34100f", "filename": "compiler/rustc_typeck/src/coherence/unsafety.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Funsafety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Funsafety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Funsafety.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -9,7 +9,7 @@ use rustc_middle::ty::TyCtxt;\n \n pub fn check(tcx: TyCtxt<'_>) {\n     let mut unsafety = UnsafetyChecker { tcx };\n-    tcx.hir().krate().visit_all_item_likes(&mut unsafety);\n+    tcx.hir().visit_all_item_likes(&mut unsafety);\n }\n \n struct UnsafetyChecker<'tcx> {"}, {"sha": "86d712e2d792258ec4372bc14f6610b9266c29ad", "filename": "compiler/rustc_typeck/src/outlives/implicit_infer.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Fimplicit_infer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Fimplicit_infer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Fimplicit_infer.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -37,7 +37,7 @@ pub fn infer_predicates<'tcx>(\n         };\n \n         // Visit all the crates and infer predicates\n-        tcx.hir().krate().visit_all_item_likes(&mut visitor);\n+        tcx.hir().visit_all_item_likes(&mut visitor);\n     }\n \n     global_inferred_outlives"}, {"sha": "ec4fa9cd4b577e64c6444e5a53839ddcbae506b0", "filename": "compiler/rustc_typeck/src/outlives/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Foutlives%2Ftest.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -5,7 +5,7 @@ use rustc_middle::ty::TyCtxt;\n use rustc_span::symbol::sym;\n \n pub fn test_inferred_outlives(tcx: TyCtxt<'_>) {\n-    tcx.hir().krate().visit_all_item_likes(&mut OutlivesTest { tcx });\n+    tcx.hir().visit_all_item_likes(&mut OutlivesTest { tcx });\n }\n \n struct OutlivesTest<'tcx> {"}, {"sha": "708c0cf4a64008954bed34a143e9dcf88723f170", "filename": "compiler/rustc_typeck/src/variance/constraints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fconstraints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fconstraints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fconstraints.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -62,7 +62,7 @@ pub fn add_constraints_from_crate<'a, 'tcx>(\n         constraints: Vec::new(),\n     };\n \n-    tcx.hir().krate().visit_all_item_likes(&mut constraint_cx);\n+    tcx.hir().visit_all_item_likes(&mut constraint_cx);\n \n     constraint_cx\n }"}, {"sha": "d7f9df668bf36d08c3b24775bbaac2a51fd7f6eb", "filename": "compiler/rustc_typeck/src/variance/terms.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fterms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fterms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Fterms.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -79,7 +79,7 @@ pub fn determine_parameters_to_be_inferred<'a, 'tcx>(\n     //\n     // - https://rustc-dev-guide.rust-lang.org/query.html\n     // - https://rustc-dev-guide.rust-lang.org/variance.html\n-    tcx.hir().krate().visit_all_item_likes(&mut terms_cx);\n+    tcx.hir().visit_all_item_likes(&mut terms_cx);\n \n     terms_cx\n }"}, {"sha": "7be3c68e8f617c5228154afcbab96fe04db80627", "filename": "compiler/rustc_typeck/src/variance/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fvariance%2Ftest.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -5,7 +5,7 @@ use rustc_middle::ty::TyCtxt;\n use rustc_span::symbol::sym;\n \n pub fn test_variance(tcx: TyCtxt<'_>) {\n-    tcx.hir().krate().visit_all_item_likes(&mut VarianceTest { tcx });\n+    tcx.hir().visit_all_item_likes(&mut VarianceTest { tcx });\n }\n \n struct VarianceTest<'tcx> {"}, {"sha": "206e8f91bd204025655b9a8703a53738f2b52934", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -230,8 +230,7 @@ impl ExternalCrate {\n         };\n         if root.is_local() {\n             tcx.hir()\n-                .krate()\n-                .module()\n+                .root_module()\n                 .item_ids\n                 .iter()\n                 .filter_map(|&id| {\n@@ -297,8 +296,7 @@ impl ExternalCrate {\n \n         if root.is_local() {\n             tcx.hir()\n-                .krate()\n-                .module()\n+                .root_module()\n                 .item_ids\n                 .iter()\n                 .filter_map(|&id| {"}, {"sha": "2a05787e40cf98abb6fb7917a1fffbad22436a85", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -26,8 +26,7 @@ mod tests;\n crate fn krate(cx: &mut DocContext<'_>) -> Crate {\n     use crate::visit_lib::LibEmbargoVisitor;\n \n-    let krate = cx.tcx.hir().krate();\n-    let module = crate::visit_ast::RustdocVisitor::new(cx).visit(krate);\n+    let module = crate::visit_ast::RustdocVisitor::new(cx).visit();\n \n     let mut externs = Vec::new();\n     for &cnum in cx.tcx.crates(()).iter() {"}, {"sha": "4f5495a176dfc0e9598cab47f566267ca7f1e5de", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -71,12 +71,12 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n         self.exact_paths.entry(did).or_insert_with(|| def_id_to_path(tcx, did));\n     }\n \n-    crate fn visit(mut self, krate: &'tcx hir::Crate<'_>) -> Module<'tcx> {\n-        let span = krate.module().inner;\n+    crate fn visit(mut self) -> Module<'tcx> {\n+        let span = self.cx.tcx.def_span(CRATE_DEF_ID);\n         let mut top_level_module = self.visit_mod_contents(\n             &Spanned { span, node: hir::VisibilityKind::Public },\n             hir::CRATE_HIR_ID,\n-            &krate.module(),\n+            self.cx.tcx.hir().root_module(),\n             self.cx.tcx.crate_name(LOCAL_CRATE),\n         );\n "}, {"sha": "578fddbd7728e5c6904c4bbc45722b0fd3153a60", "filename": "src/tools/clippy/clippy_lints/src/missing_doc.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db9fea508a6db55075d7851211ea5d4b0485e322/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_doc.rs?ref=db9fea508a6db55075d7851211ea5d4b0485e322", "patch": "@@ -78,9 +78,7 @@ impl MissingDoc {\n             return;\n         }\n \n-        let has_doc = attrs\n-            .iter()\n-            .any(|a| a.doc_str().is_some());\n+        let has_doc = attrs.iter().any(|a| a.doc_str().is_some());\n         if !has_doc {\n             span_lint(\n                 cx,\n@@ -104,9 +102,9 @@ impl<'tcx> LateLintPass<'tcx> for MissingDoc {\n         self.doc_hidden_stack.pop().expect(\"empty doc_hidden_stack\");\n     }\n \n-    fn check_crate(&mut self, cx: &LateContext<'tcx>, krate: &'tcx hir::Crate<'_>) {\n+    fn check_crate(&mut self, cx: &LateContext<'tcx>, _: &'tcx hir::Crate<'_>) {\n         let attrs = cx.tcx.hir().attrs(hir::CRATE_HIR_ID);\n-        self.check_missing_docs_attrs(cx, attrs, krate.module().inner, \"the\", \"crate\");\n+        self.check_missing_docs_attrs(cx, attrs, cx.tcx.hir().root_module().inner, \"the\", \"crate\");\n     }\n \n     fn check_item(&mut self, cx: &LateContext<'tcx>, it: &'tcx hir::Item<'_>) {"}]}