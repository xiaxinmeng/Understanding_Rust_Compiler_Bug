{"sha": "e6889933e3d76c38034f0db688af37b7551da600", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2ODg5OTMzZTNkNzZjMzgwMzRmMGRiNjg4YWYzN2I3NTUxZGE2MDA=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-27T06:16:46Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-27T08:23:26Z"}, "message": "Rollup merge of #50229 - GuillaumeGomez:search-one-result, r=QuietMisdreavus\n\nAdd setting to go to item if there is only one result\n\nFixes #50216.\n\nr? @QuietMisdreavus", "tree": {"sha": "b0d0f8631437266021ea4d4bc0688abfb485e49a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0d0f8631437266021ea4d4bc0688abfb485e49a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e6889933e3d76c38034f0db688af37b7551da600", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlri3f4ACgkQ/vbIBR0O\nATzeeQ//aUynsdQXLNsRAZKyVYy3YXjnyjQRTba35ggNWRpurf1uEr6ZMI1zKO/J\n8J3/Dqssrqvx99DsyXq+vgAaGFQyyVpM+oSlFXFN1aUJJS67Pejf8AxCLGuo+nxX\nrR+g1D/CKBv//YrmLLA3unXgfN6VaIlKzcBqk+we3JJx6nwNxzIlLCJfN3/hpF0k\neyfLLUCb0W1oi11XHrcHV354F1S8mmSL/jKLJNS46hQxW2hayiXT214nNgxrXjsj\n5ZywAx2aQigiEOHp8/6DXOY48pm95uR7IGQLl7nUYqcJdRaVmrQfhnnMYqQADaBL\nF8OyFNHLmundEOjxW/VDeYBU9TQYXAxDJ5yo3SV1loSTRucqMWTjXBozlNOXmCxH\npxCJ5GUasRp/8clOvP5nucHBV7L04zs88zSR9QPuuT+/tMo2iWyBO2jTGM53S7zU\nflUOsWQJTruMP8A6qT6Ekh0wGLZZAPC32FrnF+wpJD47BlepewrcqOf7QMg0N1lT\nKw69gJB200Rqj8tdOqk4ffHyuT8nLz0YKHMpBISGzjh6LwxMpEo5kJf3s1G24nH4\n3bnRBDeWs5VKIeh6zGjyuQcZTXnYL2nZyoeNYPkuahDc6ue5vFFLfLzSV2Wx+LAi\noT08ZBiq828qVmDGfoWxuxOTCEUDj3sycwzkNfK2MgHdnZ54q3Y=\n=rM9c\n-----END PGP SIGNATURE-----", "payload": "tree b0d0f8631437266021ea4d4bc0688abfb485e49a\nparent 3f4e5b28b9d78c6863a93e5b2982defd47dd33c6\nparent acf0adf7984d7bfc9bf5f81465471976c0f6b626\nauthor kennytm <kennytm@gmail.com> 1524809806 +0800\ncommitter kennytm <kennytm@gmail.com> 1524817406 +0800\n\nRollup merge of #50229 - GuillaumeGomez:search-one-result, r=QuietMisdreavus\n\nAdd setting to go to item if there is only one result\n\nFixes #50216.\n\nr? @QuietMisdreavus\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e6889933e3d76c38034f0db688af37b7551da600", "html_url": "https://github.com/rust-lang/rust/commit/e6889933e3d76c38034f0db688af37b7551da600", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e6889933e3d76c38034f0db688af37b7551da600/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f4e5b28b9d78c6863a93e5b2982defd47dd33c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f4e5b28b9d78c6863a93e5b2982defd47dd33c6", "html_url": "https://github.com/rust-lang/rust/commit/3f4e5b28b9d78c6863a93e5b2982defd47dd33c6"}, {"sha": "acf0adf7984d7bfc9bf5f81465471976c0f6b626", "url": "https://api.github.com/repos/rust-lang/rust/commits/acf0adf7984d7bfc9bf5f81465471976c0f6b626", "html_url": "https://github.com/rust-lang/rust/commit/acf0adf7984d7bfc9bf5f81465471976c0f6b626"}], "stats": {"total": 90, "additions": 59, "deletions": 31}, "files": [{"sha": "4e9781cc56080c3972e87a93d91f346b1ea5e0ce", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e6889933e3d76c38034f0db688af37b7551da600/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6889933e3d76c38034f0db688af37b7551da600/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=e6889933e3d76c38034f0db688af37b7551da600", "patch": "@@ -1595,6 +1595,8 @@ impl<'a> Settings<'a> {\n             settings: vec![\n                 (\"item-declarations\", \"Auto-hide item declarations.\", true),\n                 (\"item-attributes\", \"Auto-hide item attributes.\", true),\n+                (\"go-to-only-result\", \"Directly go to item in search if there is only one result\",\n+                 false),\n             ],\n             root_path,\n             suffix,"}, {"sha": "bcad2eb19f57496aa401e6e81044d7fb0a4b4330", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 57, "deletions": 31, "changes": 88, "blob_url": "https://github.com/rust-lang/rust/blob/e6889933e3d76c38034f0db688af37b7551da600/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/e6889933e3d76c38034f0db688af37b7551da600/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=e6889933e3d76c38034f0db688af37b7551da600", "patch": "@@ -1013,7 +1013,8 @@\n                 'returned': sortResults(results_returned, true),\n                 'others': sortResults(results),\n             };\n-            if (ALIASES[window.currentCrate][query.raw]) {\n+            if (ALIASES && ALIASES[window.currentCrate] &&\n+                    ALIASES[window.currentCrate][query.raw]) {\n                 var aliases = ALIASES[window.currentCrate][query.raw];\n                 for (var i = 0; i < aliases.length; ++i) {\n                     ret['others'].unshift(aliases[i]);\n@@ -1188,6 +1189,44 @@\n             return '<span>' + path.replace(/::/g, '::</span><span>');\n         }\n \n+        function buildHrefAndPath(item) {\n+            var displayPath;\n+            var href;\n+            var type = itemTypes[item.ty];\n+            var name = item.name;\n+\n+            if (type === 'mod') {\n+                displayPath = item.path + '::';\n+                href = rootPath + item.path.replace(/::/g, '/') + '/' +\n+                       name + '/index.html';\n+            } else if (type === \"primitive\") {\n+                displayPath = \"\";\n+                href = rootPath + item.path.replace(/::/g, '/') +\n+                       '/' + type + '.' + name + '.html';\n+            } else if (type === \"externcrate\") {\n+                displayPath = \"\";\n+                href = rootPath + name + '/index.html';\n+            } else if (item.parent !== undefined) {\n+                var myparent = item.parent;\n+                var anchor = '#' + type + '.' + name;\n+                var parentType = itemTypes[myparent.ty];\n+                if (parentType === \"primitive\") {\n+                    displayPath = myparent.name + '::';\n+                } else {\n+                    displayPath = item.path + '::' + myparent.name + '::';\n+                }\n+                href = rootPath + item.path.replace(/::/g, '/') +\n+                       '/' + parentType +\n+                       '.' + myparent.name +\n+                       '.html' + anchor;\n+            } else {\n+                displayPath = item.path + '::';\n+                href = rootPath + item.path.replace(/::/g, '/') +\n+                       '/' + type + '.' + name + '.html';\n+            }\n+            return [displayPath, href];\n+        }\n+\n         function addTab(array, query, display) {\n             var extraStyle = '';\n             if (display === false) {\n@@ -1211,35 +1250,9 @@\n                     name = item.name;\n                     type = itemTypes[item.ty];\n \n-                    if (type === 'mod') {\n-                        displayPath = item.path + '::';\n-                        href = rootPath + item.path.replace(/::/g, '/') + '/' +\n-                               name + '/index.html';\n-                    } else if (type === \"primitive\") {\n-                        displayPath = \"\";\n-                        href = rootPath + item.path.replace(/::/g, '/') +\n-                               '/' + type + '.' + name + '.html';\n-                    } else if (type === \"externcrate\") {\n-                        displayPath = \"\";\n-                        href = rootPath + name + '/index.html';\n-                    } else if (item.parent !== undefined) {\n-                        var myparent = item.parent;\n-                        var anchor = '#' + type + '.' + name;\n-                        var parentType = itemTypes[myparent.ty];\n-                        if (parentType === \"primitive\") {\n-                            displayPath = myparent.name + '::';\n-                        } else {\n-                            displayPath = item.path + '::' + myparent.name + '::';\n-                        }\n-                        href = rootPath + item.path.replace(/::/g, '/') +\n-                               '/' + parentType +\n-                               '.' + myparent.name +\n-                               '.html' + anchor;\n-                    } else {\n-                        displayPath = item.path + '::';\n-                        href = rootPath + item.path.replace(/::/g, '/') +\n-                               '/' + type + '.' + name + '.html';\n-                    }\n+                    var res = buildHrefAndPath(item);\n+                    var href = res[1];\n+                    var displayPath = res[0];\n \n                     output += '<tr class=\"' + type + ' result\"><td>' +\n                               '<a href=\"' + href + '\">' +\n@@ -1268,6 +1281,16 @@\n         }\n \n         function showResults(results) {\n+            if (results['others'].length === 1 &&\n+                getCurrentValue('rustdoc-go-to-only-result') === \"true\") {\n+                var elem = document.createElement('a');\n+                var res = buildHrefAndPath(results['others'][0]);\n+                elem.href = res[1];\n+                elem.style.display = 'none';\n+                // For firefox, we need the element to be in the DOM so it can be clicked.\n+                document.body.appendChild(elem);\n+                elem.click();\n+            }\n             var output, query = getQuery(search_input.value);\n \n             currentResults = query.id;\n@@ -1721,6 +1744,9 @@\n \n     function toggleAllDocs(pageId) {\n         var toggle = document.getElementById(\"toggle-all-docs\");\n+        if (!toggle) {\n+            return;\n+        }\n         if (hasClass(toggle, \"will-expand\")) {\n             updateLocalStorage(\"rustdoc-collapse\", \"false\");\n             removeClass(toggle, \"will-expand\");\n@@ -1977,7 +2003,7 @@\n                 collapseDocs(e.previousSibling.childNodes[0], \"toggle\");\n             }\n         }\n-    })\n+    });\n \n     autoCollapseAllImpls(getPageId());\n "}]}