{"sha": "f90471e4e31747533ae37712ad5841dce5bbd5d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5MDQ3MWU0ZTMxNzQ3NTMzYWUzNzcxMmFkNTg0MWRjZTViYmQ1ZDc=", "commit": {"author": {"name": "Jakub Bukaj", "email": "jakub@jakub.cc", "date": "2014-11-23T19:11:47Z"}, "committer": {"name": "Jakub Bukaj", "email": "jakub@jakub.cc", "date": "2014-11-23T19:11:47Z"}, "message": "rollup merge of #19161: jmesmon/mk-fixes\n\nThis is a collection of misc issues I've run into while adding bindir & libdir support that aren't really bindir & libdir specific.\n\nWhile I continue to fiddle with bindir and libdir bugs, I figured these might be useful for others to have merged.", "tree": {"sha": "77d8bf92a62ed573c15d67d28a76af8acae139ef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77d8bf92a62ed573c15d67d28a76af8acae139ef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f90471e4e31747533ae37712ad5841dce5bbd5d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f90471e4e31747533ae37712ad5841dce5bbd5d7", "html_url": "https://github.com/rust-lang/rust/commit/f90471e4e31747533ae37712ad5841dce5bbd5d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f90471e4e31747533ae37712ad5841dce5bbd5d7/comments", "author": null, "committer": null, "parents": [{"sha": "220b99b148559e8996a1dbd279e8ca190bf94b2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/220b99b148559e8996a1dbd279e8ca190bf94b2e", "html_url": "https://github.com/rust-lang/rust/commit/220b99b148559e8996a1dbd279e8ca190bf94b2e"}, {"sha": "12749fc8ec3f110d3fb8057b955c7fab98f85730", "url": "https://api.github.com/repos/rust-lang/rust/commits/12749fc8ec3f110d3fb8057b955c7fab98f85730", "html_url": "https://github.com/rust-lang/rust/commit/12749fc8ec3f110d3fb8057b955c7fab98f85730"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "8ca2e2b5b5e3160fc02ac4447320f5951dc1cc40", "filename": "configure", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/configure", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -711,11 +711,6 @@ then\n     fi\n     step_msg \"using rustc at: ${CFG_LOCAL_RUST_ROOT} with version: $LRV\"\n     putvar CFG_LOCAL_RUST_ROOT\n-else\n-    if [ ! -z \"$CFG_LOCAL_RUST_ROOT\" ]\n-    then\n-       warn \"Use of --local-rust-root without --enable-local-rust\"\n-    fi\n fi\n \n # Force freebsd to build with clang; gcc doesn't like us there"}, {"sha": "a9a99f132fba4ade0391aeeeb12f2e749da62058", "filename": "mk/main.mk", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -190,11 +190,14 @@ endif\n # Target-and-rule \"utility variables\"\n ######################################################################\n \n-define DEF_X\n+define DEF_FOR_TARGET\n X_$(1) := $(CFG_EXE_SUFFIX_$(1))\n+ifndef CFG_LLVM_TARGET_$(1)\n+CFG_LLVM_TARGET_$(1) := $(1)\n+endif\n endef\n $(foreach target,$(CFG_TARGET), \\\n-  $(eval $(call DEF_X,$(target))))\n+  $(eval $(call DEF_FOR_TARGET,$(target))))\n \n # \"Source\" files we generate in builddir along the way.\n GENERATED :="}, {"sha": "38aec83631605f188374861e871c3c5789119816", "filename": "mk/rt.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -75,7 +75,7 @@ $$(RT_OUTPUT_DIR_$(1))/%.o: $(S)src/rt/%.ll $$(MKFILE_DEPS) \\\n \t@mkdir -p $$(@D)\n \t@$$(call E, compile: $$@)\n \t$$(Q)$$(LLC_$$(CFG_BUILD)) $$(CFG_LLC_FLAGS_$(1)) \\\n-\t    -filetype=obj -mtriple=$(1) -relocation-model=pic -o $$@ $$<\n+\t    -filetype=obj -mtriple=$$(CFG_LLVM_TARGET_$(1)) -relocation-model=pic -o $$@ $$<\n \n $$(RT_OUTPUT_DIR_$(1))/%.o: $(S)src/rt/%.c $$(MKFILE_DEPS)\n \t@mkdir -p $$(@D)"}, {"sha": "460a4a7f445e36419bed34826710950850e9a0a1", "filename": "mk/stage0.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Fstage0.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Fstage0.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fstage0.mk?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -22,7 +22,7 @@ ifdef CFG_ENABLE_LOCAL_RUST\n else\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/get-snapshot.py $(CFG_BUILD) $(SNAPSHOT_FILE)\n endif\n-\t$(Q)touch $@\n+\t$(Q)if [ -e \"$@\" ]; then touch \"$@\"; else echo \"ERROR: snapshot $@ not found\"; exit 1; fi\n \n # For other targets, let the host build the target:\n "}, {"sha": "acdf780f105454cf9d77830b61f18dce344b3b75", "filename": "mk/target.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -116,7 +116,7 @@ $$(TBIN$(1)_T_$(2)_H_$(3))/$(4)$$(X_$(2)): \\\n \t\t$$(foreach dep,$$(TOOL_DEPS_$(4)), \\\n \t\t    $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(dep)) \\\n \t\t$$(TSREQ$(1)_T_$(2)_H_$(3)) \\\n-\t\t| $$(TBIN$(1)_T_$(4)_H_$(3))/\n+\t\t| $$(TBIN$(1)_T_$(2)_H_$(3))/\n \t@$$(call E, rustc: $$@)\n \t$$(STAGE$(1)_T_$(2)_H_$(3)) -o $$@ $$< --cfg $(4)\n "}, {"sha": "b040a4bfd2a09f4076562c4e96e179c48711f5a7", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f90471e4e31747533ae37712ad5841dce5bbd5d7/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f90471e4e31747533ae37712ad5841dce5bbd5d7/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=f90471e4e31747533ae37712ad5841dce5bbd5d7", "patch": "@@ -18,7 +18,6 @@ use rustc_trans::back::link;\n use syntax::{ast, ast_map, codemap, diagnostic};\n \n use std::cell::RefCell;\n-use std::os;\n use std::collections::{HashMap, HashSet};\n use arena::TypedArena;\n \n@@ -89,7 +88,7 @@ pub fn run_core(libs: Vec<Path>, cfgs: Vec<String>, externs: Externs,\n     let warning_lint = lint::builtin::WARNINGS.name_lower();\n \n     let sessopts = config::Options {\n-        maybe_sysroot: Some(os::self_exe_path().unwrap().dir_path()),\n+        maybe_sysroot: None,\n         addl_lib_search_paths: RefCell::new(libs),\n         crate_types: vec!(config::CrateTypeRlib),\n         lint_opts: vec!((warning_lint, lint::Allow)),"}]}