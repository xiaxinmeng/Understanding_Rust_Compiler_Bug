{"sha": "5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmYjMzOTRjYmRmMDYyMmM5ZDBjMjkyZmViNTVkYjBmNGM4MjhkYzM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-29T09:35:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-29T09:35:23Z"}, "message": "Auto merge of #86664 - m-ou-se:uninit-track-caller, r=JohnTitor\n\nAdd #[track_caller] for some function in core::mem.\n\nThese functions can panic for some types. This makes the panic point to the code that calls e.g. mem::uninitialized(), instead of inside the definition of mem::uninitialized.", "tree": {"sha": "e1521a5f4ca5e5e8b6e971c7635c10e979974911", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1521a5f4ca5e5e8b6e971c7635c10e979974911"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "html_url": "https://github.com/rust-lang/rust/commit/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e0a8bf7901a3fe2e073b1e702e80f58b76d5087", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e0a8bf7901a3fe2e073b1e702e80f58b76d5087", "html_url": "https://github.com/rust-lang/rust/commit/6e0a8bf7901a3fe2e073b1e702e80f58b76d5087"}, {"sha": "3f6dc9a8abe9ffd804fed2ddaabb1c67de4c8fbd", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f6dc9a8abe9ffd804fed2ddaabb1c67de4c8fbd", "html_url": "https://github.com/rust-lang/rust/commit/3f6dc9a8abe9ffd804fed2ddaabb1c67de4c8fbd"}], "stats": {"total": 17, "additions": 7, "deletions": 10}, "files": [{"sha": "9c88a6233616175e3e3215ab0a59f7d3d91ebcc2", "filename": "library/core/src/mem/maybe_uninit.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/library%2Fcore%2Fsrc%2Fmem%2Fmaybe_uninit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/library%2Fcore%2Fsrc%2Fmem%2Fmaybe_uninit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmem%2Fmaybe_uninit.rs?ref=5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "patch": "@@ -619,6 +619,7 @@ impl<T> MaybeUninit<T> {\n     #[rustc_const_unstable(feature = \"const_maybe_uninit_assume_init\", issue = \"none\")]\n     #[inline(always)]\n     #[rustc_diagnostic_item = \"assume_init\"]\n+    #[track_caller]\n     pub const unsafe fn assume_init(self) -> T {\n         // SAFETY: the caller must guarantee that `self` is initialized.\n         // This also means that `self` must be a `value` variant.\n@@ -690,6 +691,7 @@ impl<T> MaybeUninit<T> {\n     #[unstable(feature = \"maybe_uninit_extra\", issue = \"63567\")]\n     #[rustc_const_unstable(feature = \"maybe_uninit_extra\", issue = \"63567\")]\n     #[inline(always)]\n+    #[track_caller]\n     pub const unsafe fn assume_init_read(&self) -> T {\n         // SAFETY: the caller must guarantee that `self` is initialized.\n         // Reading from `self.as_ptr()` is safe since `self` should be initialized.\n@@ -937,6 +939,7 @@ impl<T> MaybeUninit<T> {\n     /// ```\n     #[unstable(feature = \"maybe_uninit_array_assume_init\", issue = \"80908\")]\n     #[inline(always)]\n+    #[track_caller]\n     pub unsafe fn array_assume_init<const N: usize>(array: [Self; N]) -> [T; N] {\n         // SAFETY:\n         // * The caller guarantees that all elements of the array are initialized"}, {"sha": "aeb5d238162c813d7716f74bac4737998e2026cb", "filename": "library/core/src/mem/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/library%2Fcore%2Fsrc%2Fmem%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/library%2Fcore%2Fsrc%2Fmem%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmem%2Fmod.rs?ref=5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "patch": "@@ -622,6 +622,7 @@ pub const fn needs_drop<T>() -> bool {\n #[allow(deprecated_in_future)]\n #[allow(deprecated)]\n #[rustc_diagnostic_item = \"mem_zeroed\"]\n+#[track_caller]\n pub unsafe fn zeroed<T>() -> T {\n     // SAFETY: the caller must guarantee that an all-zero value is valid for `T`.\n     unsafe {\n@@ -657,6 +658,7 @@ pub unsafe fn zeroed<T>() -> T {\n #[allow(deprecated_in_future)]\n #[allow(deprecated)]\n #[rustc_diagnostic_item = \"mem_uninitialized\"]\n+#[track_caller]\n pub unsafe fn uninitialized<T>() -> T {\n     // SAFETY: the caller must guarantee that an unitialized value is valid for `T`.\n     unsafe {"}, {"sha": "e660730396fa1c97e8e0ca197a9a04f13585ad34", "filename": "src/test/ui/consts/assume-type-intrinsics.stderr", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/src%2Ftest%2Fui%2Fconsts%2Fassume-type-intrinsics.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5fb3394cbdf0622c9d0c292feb55db0f4c828dc3/src%2Ftest%2Fui%2Fconsts%2Fassume-type-intrinsics.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fassume-type-intrinsics.stderr?ref=5fb3394cbdf0622c9d0c292feb55db0f4c828dc3", "patch": "@@ -1,17 +1,9 @@\n error: any use of this value will cause an error\n-  --> $SRC_DIR/core/src/mem/maybe_uninit.rs:LL:COL\n-   |\n-LL |               intrinsics::assert_inhabited::<T>();\n-   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |               |\n-   |               aborted execution: attempted to instantiate uninhabited type `!`\n-   |               inside `MaybeUninit::<!>::assume_init` at $SRC_DIR/core/src/mem/maybe_uninit.rs:LL:COL\n-   |               inside `_BAD` at $DIR/assume-type-intrinsics.rs:11:9\n-   | \n-  ::: $DIR/assume-type-intrinsics.rs:10:5\n+  --> $DIR/assume-type-intrinsics.rs:11:9\n    |\n LL | /     const _BAD: () = unsafe {\n LL | |         MaybeUninit::<!>::uninit().assume_init();\n+   | |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ aborted execution: attempted to instantiate uninhabited type `!`\n LL | |     };\n    | |______-\n    |"}]}