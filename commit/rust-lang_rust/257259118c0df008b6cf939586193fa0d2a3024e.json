{"sha": "257259118c0df008b6cf939586193fa0d2a3024e", "node_id": "C_kwDOAAsO6NoAKDI1NzI1OTExOGMwZGYwMDhiNmNmOTM5NTg2MTkzZmEwZDJhMzAyNGU", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-07-25T12:02:39Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-07-27T10:24:27Z"}, "message": "lint: add bad opt access internal lint\n\nSome command-line options accessible through `sess.opts` are best\naccessed through wrapper functions on `Session`, `TyCtxt` or otherwise,\nrather than through field access on the option struct in the `Session`.\n\nAdds a new lint which triggers on those options that should be accessed\nthrough a wrapper function so that this is prohibited. Options are\nannotated with a new attribute `rustc_lint_opt_deny_field_access` which\ncan specify the error message (i.e. \"use this other function instead\")\nto be emitted.\n\nA simpler alternative would be to simply rename the options in the\noption type so that it is clear they should not be used, however this\ndoesn't prevent uses, just discourages them. Another alternative would\nbe to make the option fields private, and adding accessor functions on\nthe option types, however the wrapper functions sometimes rely on\nadditional state from `Session` or `TyCtxt` which wouldn't be available\nin an function on the option type, so the accessor would simply make the\nfield available and its use would be discouraged too.\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "7d74d83dc1a35231275d40df9f428399a2ee0624", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d74d83dc1a35231275d40df9f428399a2ee0624"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/257259118c0df008b6cf939586193fa0d2a3024e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/257259118c0df008b6cf939586193fa0d2a3024e", "html_url": "https://github.com/rust-lang/rust/commit/257259118c0df008b6cf939586193fa0d2a3024e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/257259118c0df008b6cf939586193fa0d2a3024e/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6654aabb0f4b30d0beba402758ad11f91c4103e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/6654aabb0f4b30d0beba402758ad11f91c4103e1", "html_url": "https://github.com/rust-lang/rust/commit/6654aabb0f4b30d0beba402758ad11f91c4103e1"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "c1ec2bd5bd665c659475866d3ba817ff37189aef", "filename": "src/driver.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/257259118c0df008b6cf939586193fa0d2a3024e/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/257259118c0df008b6cf939586193fa0d2a3024e/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=257259118c0df008b6cf939586193fa0d2a3024e", "patch": "@@ -94,6 +94,8 @@ struct ClippyCallbacks {\n }\n \n impl rustc_driver::Callbacks for ClippyCallbacks {\n+    // JUSTIFICATION: necessary in clippy driver to set `mir_opt_level`\n+    #[cfg_attr(not(bootstrap), allow(rustc::bad_opt_access))]\n     fn config(&mut self, config: &mut interface::Config) {\n         let previous = config.register_lints.take();\n         let clippy_args_var = self.clippy_args_var.take();"}]}