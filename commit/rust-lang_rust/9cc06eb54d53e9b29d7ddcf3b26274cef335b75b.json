{"sha": "9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "node_id": "C_kwDOAAsO6NoAKDljYzA2ZWI1NGQ1M2U5YjI5ZDdkZGNmM2IyNjI3NGNlZjMzNWI3NWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-31T21:39:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-31T21:39:40Z"}, "message": "Rollup merge of #99620 - hudson-ayers:fix-location-detail, r=davidtwco\n\n`-Z location-detail`: provide option to disable all location details\n\nAs reported [here](https://github.com/rust-lang/rust/pull/89920#issuecomment-1190598924), when I first implemented the `-Z location-detail` flag there was a bug, where passing an empty list was not correctly supported, and instead rejected by the compiler. This PR fixes that such that passing an empty list results in no location details being tracked, as originally specified in https://github.com/rust-lang/rfcs/pull/2091 .\n\nThis PR also adds a test case to verify that this option continues to work as intended.", "tree": {"sha": "9bd12b88cfaae3fc36b698e9a5ff4f700b64c3ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9bd12b88cfaae3fc36b698e9a5ff4f700b64c3ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi5vacCRBK7hj4Ov3rIwAAyycIAFhKUuP9EYKTS8AwEWeE0wEV\nUEe7mte1U+qPkd6rDX/G8YjvVF3lm8biZK1v8VJ6sKWjv6lrvvTWG3W1fMOdGS+K\n+5MiWU76heg2EjdKQEjC4CKmwYaE3z8pE6WKiJz70Vk5bbmLNyXEkywXAN5UP3ME\nIb3wgE0q90R/u86lusiRANtFq0xNGPq1u18H2rwCdP/FWHnrz+TLPFiUff5Rp9xI\n/cqslCvuS3ETB8poNQ0wxrWIJAgezxrMinvHg3BPDBcb9DgVNSNXCDV2ntDMsvKi\n4aipaqxpj7Udr8fjdFQ90Alb9JEuWzmxLk5xw0FlGBtV0fC6ymuAMm2gyf0uXgk=\n=79Hl\n-----END PGP SIGNATURE-----\n", "payload": "tree 9bd12b88cfaae3fc36b698e9a5ff4f700b64c3ac\nparent e820ecdba115e56d3d1cb0df169463a23a28fabd\nparent 6dea21a4a255fc246243fabc54436352b5f12c80\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1659303580 +0200\ncommitter GitHub <noreply@github.com> 1659303580 +0200\n\nRollup merge of #99620 - hudson-ayers:fix-location-detail, r=davidtwco\n\n`-Z location-detail`: provide option to disable all location details\n\nAs reported [here](https://github.com/rust-lang/rust/pull/89920#issuecomment-1190598924), when I first implemented the `-Z location-detail` flag there was a bug, where passing an empty list was not correctly supported, and instead rejected by the compiler. This PR fixes that such that passing an empty list results in no location details being tracked, as originally specified in https://github.com/rust-lang/rfcs/pull/2091 .\n\nThis PR also adds a test case to verify that this option continues to work as intended.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "html_url": "https://github.com/rust-lang/rust/commit/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e820ecdba115e56d3d1cb0df169463a23a28fabd", "url": "https://api.github.com/repos/rust-lang/rust/commits/e820ecdba115e56d3d1cb0df169463a23a28fabd", "html_url": "https://github.com/rust-lang/rust/commit/e820ecdba115e56d3d1cb0df169463a23a28fabd"}, {"sha": "6dea21a4a255fc246243fabc54436352b5f12c80", "url": "https://api.github.com/repos/rust-lang/rust/commits/6dea21a4a255fc246243fabc54436352b5f12c80", "html_url": "https://github.com/rust-lang/rust/commit/6dea21a4a255fc246243fabc54436352b5f12c80"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "1827f1c208de7a5648040c2cf0a82fa6a3afe267", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "patch": "@@ -393,8 +393,7 @@ mod desc {\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), `thin`, `fat`, or omitted\";\n     pub const parse_linker_plugin_lto: &str =\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), or the path to the linker plugin\";\n-    pub const parse_location_detail: &str =\n-        \"comma separated list of location details to track: `file`, `line`, or `column`\";\n+    pub const parse_location_detail: &str = \"either `none`, or a comma separated list of location details to track: `file`, `line`, or `column`\";\n     pub const parse_switch_with_opt_path: &str =\n         \"an optional path to the profiling data output directory\";\n     pub const parse_merge_functions: &str = \"one of: `disabled`, `trampolines`, or `aliases`\";\n@@ -551,6 +550,9 @@ mod parse {\n             ld.line = false;\n             ld.file = false;\n             ld.column = false;\n+            if v == \"none\" {\n+                return true;\n+            }\n             for s in v.split(',') {\n                 match s {\n                     \"file\" => ld.file = true,\n@@ -1374,8 +1376,9 @@ options! {\n     llvm_time_trace: bool = (false, parse_bool, [UNTRACKED],\n         \"generate JSON tracing data file from LLVM data (default: no)\"),\n     location_detail: LocationDetail = (LocationDetail::all(), parse_location_detail, [TRACKED],\n-        \"comma separated list of location details to be tracked when using caller_location \\\n-        valid options are `file`, `line`, and `column` (default: all)\"),\n+        \"what location details should be tracked when using caller_location, either \\\n+        `none`, or a comma separated list of location details, for which \\\n+        valid options are `file`, `line`, and `column` (default: `file,line,column`)\"),\n     ls: bool = (false, parse_bool, [UNTRACKED],\n         \"list the symbols defined by a library crate (default: no)\"),\n     macro_backtrace: bool = (false, parse_bool, [UNTRACKED],"}, {"sha": "db070619969649034ba4f531cb47a65289afe07e", "filename": "src/doc/unstable-book/src/compiler-flags/location-detail.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "raw_url": "https://github.com/rust-lang/rust/raw/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md?ref=9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "patch": "@@ -17,8 +17,9 @@ within this list are:\n - `line` - the source line of the panic will be included in the panic output\n - `column` - the source column of the panic will be included in the panic output\n \n-Any combination of these three options are supported. If this option is not specified,\n-all three are included by default.\n+Any combination of these three options are supported. Alternatively, you can pass\n+`none` to this option, which results in no location details being tracked.\n+If this option is not specified, all three are included by default.\n \n An example of a panic output when using `-Z location-detail=line`:\n ```text"}, {"sha": "6dc41231559c0dc25d2440e772b477f4fed1fc72", "filename": "src/test/rustdoc-ui/z-help.stdout", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fz-help.stdout?ref=9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "patch": "@@ -69,7 +69,7 @@\n     -Z                               link-only=val -- link the `.rlink` file generated by `-Z no-link` (default: no)\n     -Z                            llvm-plugins=val -- a list LLVM plugins to enable (space separated)\n     -Z                         llvm-time-trace=val -- generate JSON tracing data file from LLVM data (default: no)\n-    -Z                         location-detail=val -- comma separated list of location details to be tracked when using caller_location valid options are `file`, `line`, and `column` (default: all)\n+    -Z                         location-detail=val -- what location details should be tracked when using caller_location, either `none`, or a comma separated list of location details, for which valid options are `file`, `line`, and `column` (default: `file,line,column`)\n     -Z                                      ls=val -- list the symbols defined by a library crate (default: no)\n     -Z                         macro-backtrace=val -- show macro backtraces (default: no)\n     -Z                         merge-functions=val -- control the operation of the MergeFunctions LLVM pass, taking the same values as the target option of the same name"}, {"sha": "7b609145bad7298ca95197ab553de4cb50c47d11", "filename": "src/test/ui/panics/location-detail-panic-no-location-info.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.rs?ref=9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "patch": "@@ -0,0 +1,8 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=none\n+// exec-env:RUST_BACKTRACE=0\n+\n+fn main() {\n+    panic!(\"no location info\");\n+}"}, {"sha": "d1c3108643c6c9ae4dc2a9fdc78dacf6560686f0", "filename": "src/test/ui/panics/location-detail-panic-no-location-info.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9cc06eb54d53e9b29d7ddcf3b26274cef335b75b/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-location-info.run.stderr?ref=9cc06eb54d53e9b29d7ddcf3b26274cef335b75b", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'no location info', <redacted>:0:0\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}]}