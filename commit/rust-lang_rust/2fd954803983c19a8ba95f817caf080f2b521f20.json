{"sha": "2fd954803983c19a8ba95f817caf080f2b521f20", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmZDk1NDgwMzk4M2MxOWE4YmE5NWY4MTdjYWYwODBmMmI1MjFmMjA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-08-03T11:12:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-08-03T11:12:02Z"}, "message": "Rollup merge of #63227 - jakubadamw:issue-63151, r=estebank\n\ndead_code: Properly inspect fields in struct patterns with type relative paths\n\nCloses #63151.", "tree": {"sha": "03a613e99ec93e4b5ca2ed667280166b0d4ebfc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/03a613e99ec93e4b5ca2ed667280166b0d4ebfc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2fd954803983c19a8ba95f817caf080f2b521f20", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdRWwCCRBK7hj4Ov3rIwAAdHIIACJXvIPHTikM+KKIN7VXuP+3\n+sQB/CqFgXM8nQdDmt7YlssmMUZ9iZghYg9RCyC2y56RkEBGPPVPXi1gzJBzoSCt\ntkUvrisSBF5Ek2uRrk+3mz7IgRyriZdb5x9872VGvnXbSg8bZfom/O8s+6/wYBiK\nuAfMzz9NrwT1orP86plagSR/k0wFSkz+fXYTUNtCV/QWwXiVuyDWJOmXjcfjzgpO\nvw6GGwSCjPlsntQgOP16FZlrJ/HIrCDFDzq4rk5aj6rFzWjjeA+K+6UXEqO260E+\nx/d7gLXJH9qGEhYni72wphcs937REZWTlefTF0hnNWb1ou3GR6y4B7Fio6uHvdo=\n=la+h\n-----END PGP SIGNATURE-----\n", "payload": "tree 03a613e99ec93e4b5ca2ed667280166b0d4ebfc5\nparent 6a38ef7abd75d28dd61bd939423468d64789b076\nparent 8235b6f8c37ca531279c5da5663120ea4ec8e0b3\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1564830722 +0200\ncommitter GitHub <noreply@github.com> 1564830722 +0200\n\nRollup merge of #63227 - jakubadamw:issue-63151, r=estebank\n\ndead_code: Properly inspect fields in struct patterns with type relative paths\n\nCloses #63151.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2fd954803983c19a8ba95f817caf080f2b521f20", "html_url": "https://github.com/rust-lang/rust/commit/2fd954803983c19a8ba95f817caf080f2b521f20", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2fd954803983c19a8ba95f817caf080f2b521f20/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a38ef7abd75d28dd61bd939423468d64789b076", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a38ef7abd75d28dd61bd939423468d64789b076", "html_url": "https://github.com/rust-lang/rust/commit/6a38ef7abd75d28dd61bd939423468d64789b076"}, {"sha": "8235b6f8c37ca531279c5da5663120ea4ec8e0b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/8235b6f8c37ca531279c5da5663120ea4ec8e0b3", "html_url": "https://github.com/rust-lang/rust/commit/8235b6f8c37ca531279c5da5663120ea4ec8e0b3"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "fefb3dc076d79f45abfe7a8f9a400b7a0c7c8f9a", "filename": "src/librustc/middle/dead.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2fd954803983c19a8ba95f817caf080f2b521f20/src%2Flibrustc%2Fmiddle%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd954803983c19a8ba95f817caf080f2b521f20/src%2Flibrustc%2Fmiddle%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fdead.rs?ref=2fd954803983c19a8ba95f817caf080f2b521f20", "patch": "@@ -269,8 +269,9 @@ impl<'a, 'tcx> Visitor<'tcx> for MarkSymbolVisitor<'a, 'tcx> {\n \n     fn visit_pat(&mut self, pat: &'tcx hir::Pat) {\n         match pat.node {\n-            PatKind::Struct(hir::QPath::Resolved(_, ref path), ref fields, _) => {\n-                self.handle_field_pattern_match(pat, path.res, fields);\n+            PatKind::Struct(ref path, ref fields, _) => {\n+                let res = self.tables.qpath_res(path, pat.hir_id);\n+                self.handle_field_pattern_match(pat, res, fields);\n             }\n             PatKind::Path(ref qpath @ hir::QPath::TypeRelative(..)) => {\n                 let res = self.tables.qpath_res(qpath, pat.hir_id);"}, {"sha": "66fb8dd0deaf425239ae33c23b00898586ac883e", "filename": "src/test/ui/type-alias-enum-variants/issue-63151-dead-code-lint-fields-in-patterns.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/2fd954803983c19a8ba95f817caf080f2b521f20/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fissue-63151-dead-code-lint-fields-in-patterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2fd954803983c19a8ba95f817caf080f2b521f20/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fissue-63151-dead-code-lint-fields-in-patterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fissue-63151-dead-code-lint-fields-in-patterns.rs?ref=2fd954803983c19a8ba95f817caf080f2b521f20", "patch": "@@ -0,0 +1,26 @@\n+// check-pass\n+\n+// Regression test for the issue #63151:\n+// Spurious unused field warning when matching variants under a `Self` scope\n+//\n+// This test checks that the `dead_code` lint properly inspects fields\n+// in struct patterns that use a type relative path.\n+\n+#![deny(dead_code)]\n+\n+enum Enum {\n+    Variant { field: usize }\n+}\n+\n+impl Enum {\n+    fn read_field(self) -> usize {\n+        match self {\n+            Self::Variant { field } => field\n+        }\n+    }\n+}\n+\n+fn main() {\n+    let e = Enum::Variant { field: 42 };\n+    println!(\"{}\", e.read_field());\n+}"}]}