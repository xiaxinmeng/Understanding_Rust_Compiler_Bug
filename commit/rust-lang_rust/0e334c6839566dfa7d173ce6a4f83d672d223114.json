{"sha": "0e334c6839566dfa7d173ce6a4f83d672d223114", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlMzM0YzY4Mzk1NjZkZmE3ZDE3M2NlNmE0ZjgzZDY3MmQyMjMxMTQ=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-01-10T23:59:22Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-01-10T23:59:57Z"}, "message": "Fold and re-evaluate expr in tag discriminant.", "tree": {"sha": "d8137d56f4c5450824866e5e1ca9e17e7ebd093c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8137d56f4c5450824866e5e1ca9e17e7ebd093c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e334c6839566dfa7d173ce6a4f83d672d223114", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e334c6839566dfa7d173ce6a4f83d672d223114", "html_url": "https://github.com/rust-lang/rust/commit/0e334c6839566dfa7d173ce6a4f83d672d223114", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e334c6839566dfa7d173ce6a4f83d672d223114/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1dc3debdafbf29c6ac4ff3cf336da62e13e1871e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1dc3debdafbf29c6ac4ff3cf336da62e13e1871e", "html_url": "https://github.com/rust-lang/rust/commit/1dc3debdafbf29c6ac4ff3cf336da62e13e1871e"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "f075979b7f676ffa20d143c21c09d1b7a49fd5f0", "filename": "src/comp/syntax/fold.rs", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0e334c6839566dfa7d173ce6a4f83d672d223114/src%2Fcomp%2Fsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e334c6839566dfa7d173ce6a4f83d672d223114/src%2Fcomp%2Fsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Ffold.rs?ref=0e334c6839566dfa7d173ce6a4f83d672d223114", "patch": "@@ -469,9 +469,22 @@ fn noop_fold_variant(v: variant_, fld: ast_fold) -> variant_ {\n         ret {ty: fld.fold_ty(va.ty), id: va.id};\n     }\n     let fold_variant_arg = bind fold_variant_arg_(_, fld);\n-    ret {name: v.name, args: vec::map(v.args, fold_variant_arg), id: v.id,\n-         disr_val: v.disr_val,  disr_expr: v.disr_expr\n-         /* FIXME: is this right (copying disr_val and disr_expr) */};\n+    let args = vec::map(v.args, fold_variant_arg);\n+    let (de, dv) = alt v.disr_expr {\n+      some(e) {\n+        let de = fld.fold_expr(e);\n+        let dv = alt syntax::ast_util::eval_const_expr(e) {\n+          ast_util::const_int(val) {\n+            // FIXME (#1417): check that value is in range\n+            val as int\n+          }\n+        };\n+        (some(de), dv)\n+      }\n+      none. { (none, v.disr_val) }\n+    };\n+    ret {name: v.name, args: args, id: v.id,\n+         disr_val: dv,  disr_expr: de};\n }\n \n fn noop_fold_ident(&&i: ident, _fld: ast_fold) -> ident { ret i; }"}, {"sha": "c3fb803e489151047bf80aeb7b5db09d74dcd161", "filename": "src/comp/syntax/parse/parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0e334c6839566dfa7d173ce6a4f83d672d223114/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e334c6839566dfa7d173ce6a4f83d672d223114/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs?ref=0e334c6839566dfa7d173ce6a4f83d672d223114", "patch": "@@ -2117,8 +2117,8 @@ fn parse_item_tag(p: parser, attrs: [ast::attribute]) -> @ast::item {\n                 // probably be doing.\"  (See issue #1417)\n                 alt syntax::ast_util::eval_const_expr(e) {\n                   syntax::ast_util::const_int(val) {\n+                    // FIXME (#1417): check that value is in range\n                     disr_val = val as int;\n-                    // FIXME: check that value is in range\n                   }\n                 }\n                 if option::is_some"}]}