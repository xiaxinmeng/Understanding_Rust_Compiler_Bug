{"sha": "3bc30bb012889eeeb08d5241dfe64fc47ed33537", "node_id": "C_kwDOAAsO6NoAKDNiYzMwYmIwMTI4ODllZWViMDhkNTI0MWRmZTY0ZmM0N2VkMzM1Mzc", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-08-12T15:09:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-12T15:09:18Z"}, "message": "Rollup merge of #100443 - est31:let_else_regression_tests, r=Mark-Simulacrum\n\nAdd two let else regression tests\n\nAdds a regression test for #94176, as it was fixed by #98574 but doesn't have a regression test. The PR also incorporates a commit from #94012 which added a test for an issue discovered in that PR.\n\nOriginally they have been part of #99291, but I've moved them out in the hopes of getting them merged more quickly, as that PR is already open since a month, and so that #99291 can focus on the drop order part of things.\n\nCloses #94176\nCloses #96961 -- dupe of #94176", "tree": {"sha": "66e6216f2716ddfc691ca2f3eb14fea6c9d31231", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/66e6216f2716ddfc691ca2f3eb14fea6c9d31231"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3bc30bb012889eeeb08d5241dfe64fc47ed33537", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi9m0eCRBK7hj4Ov3rIwAAefEIAI0E8oVn/NDhlrFyCmWkOxyQ\neQ1f7HLECP+xQbCoyyOcADMI6+HbZChxZk0py7hJ4vRHILIjgsw6wDT3mnsmCaDW\ng2Rqa8NeLbPas9DVIuxbaw3raQIK5cnyqNaOmayZRfeCP1WKn3MyraHYyHa4dTuO\n2RckTqvPAgUw35xMZBONQPFb95P1bOjJnZ+GKRWxzQqligQY758Vz7Qr6+1SAyLO\n82GIIICQyfnIgqUIELgQ6AmBDtrpI2DijbWTIHvyBh2Cz2Lm+sxhTB2tlE4WMLrs\nRY+S2k7hMMfXhV/Mj5suUFXmerHq+fdw/Zpky2An8IsSSh5LsyJBXlwVGbbDO70=\n=WMMV\n-----END PGP SIGNATURE-----\n", "payload": "tree 66e6216f2716ddfc691ca2f3eb14fea6c9d31231\nparent 03560346c4d8c71cf745f61d4f19ffce9fd12670\nparent 981852677c531d52f701b870bb27b45668a44d52\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1660316958 +0530\ncommitter GitHub <noreply@github.com> 1660316958 +0530\n\nRollup merge of #100443 - est31:let_else_regression_tests, r=Mark-Simulacrum\n\nAdd two let else regression tests\n\nAdds a regression test for #94176, as it was fixed by #98574 but doesn't have a regression test. The PR also incorporates a commit from #94012 which added a test for an issue discovered in that PR.\n\nOriginally they have been part of #99291, but I've moved them out in the hopes of getting them merged more quickly, as that PR is already open since a month, and so that #99291 can focus on the drop order part of things.\n\nCloses #94176\nCloses #96961 -- dupe of #94176\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3bc30bb012889eeeb08d5241dfe64fc47ed33537", "html_url": "https://github.com/rust-lang/rust/commit/3bc30bb012889eeeb08d5241dfe64fc47ed33537", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3bc30bb012889eeeb08d5241dfe64fc47ed33537/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03560346c4d8c71cf745f61d4f19ffce9fd12670", "url": "https://api.github.com/repos/rust-lang/rust/commits/03560346c4d8c71cf745f61d4f19ffce9fd12670", "html_url": "https://github.com/rust-lang/rust/commit/03560346c4d8c71cf745f61d4f19ffce9fd12670"}, {"sha": "981852677c531d52f701b870bb27b45668a44d52", "url": "https://api.github.com/repos/rust-lang/rust/commits/981852677c531d52f701b870bb27b45668a44d52", "html_url": "https://github.com/rust-lang/rust/commit/981852677c531d52f701b870bb27b45668a44d52"}], "stats": {"total": 62, "additions": 62, "deletions": 0}, "files": [{"sha": "e35bbd88830622fd0a24553a66e9ae78fcd6456d", "filename": "src/test/ui/let-else/issue-94176.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.rs?ref=3bc30bb012889eeeb08d5241dfe64fc47ed33537", "patch": "@@ -0,0 +1,10 @@\n+// Issue #94176: wrong span for the error message of a mismatched type error,\n+// if the function uses a `let else` construct.\n+#![feature(let_else)]\n+\n+pub fn test(a: Option<u32>) -> Option<u32> { //~ ERROR mismatched types\n+    let Some(_) = a else { return None; };\n+    println!(\"Foo\");\n+}\n+\n+fn main() {}"}, {"sha": "0cb97aceebfd5835311787240e3c1a3fa6a2b2ed", "filename": "src/test/ui/let-else/issue-94176.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Fissue-94176.stderr?ref=3bc30bb012889eeeb08d5241dfe64fc47ed33537", "patch": "@@ -0,0 +1,19 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-94176.rs:5:32\n+   |\n+LL | pub fn test(a: Option<u32>) -> Option<u32> {\n+   |        ----                    ^^^^^^^^^^^ expected enum `Option`, found `()`\n+   |        |\n+   |        implicitly returns `()` as its body has no tail or `return` expression\n+   |\n+   = note:   expected enum `Option<u32>`\n+           found unit type `()`\n+help: consider returning the local binding `a`\n+   |\n+LL ~     println!(\"Foo\");\n+LL +     a\n+   |\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "49633d943beea40db752c46684e55d765c1f4ed3", "filename": "src/test/ui/let-else/let-else-then-diverge.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.rs?ref=3bc30bb012889eeeb08d5241dfe64fc47ed33537", "patch": "@@ -0,0 +1,19 @@\n+//\n+// popped up in in #94012, where an alternative desugaring was\n+// causing unreachable code errors\n+\n+#![feature(let_else)]\n+#![deny(unused_variables)]\n+#![deny(unreachable_code)]\n+\n+fn let_else_diverge() -> bool {\n+    let Some(_) = Some(\"test\") else {\n+        let x = 5; //~ ERROR unused variable: `x`\n+        return false;\n+    };\n+    return true;\n+}\n+\n+fn main() {\n+    let_else_diverge();\n+}"}, {"sha": "ceb61029d38634f1c0feda6ef7f27d86640a6c2d", "filename": "src/test/ui/let-else/let-else-then-diverge.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3bc30bb012889eeeb08d5241dfe64fc47ed33537/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Flet-else-then-diverge.stderr?ref=3bc30bb012889eeeb08d5241dfe64fc47ed33537", "patch": "@@ -0,0 +1,14 @@\n+error: unused variable: `x`\n+  --> $DIR/let-else-then-diverge.rs:11:13\n+   |\n+LL |         let x = 5;\n+   |             ^ help: if this is intentional, prefix it with an underscore: `_x`\n+   |\n+note: the lint level is defined here\n+  --> $DIR/let-else-then-diverge.rs:6:9\n+   |\n+LL | #![deny(unused_variables)]\n+   |         ^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}