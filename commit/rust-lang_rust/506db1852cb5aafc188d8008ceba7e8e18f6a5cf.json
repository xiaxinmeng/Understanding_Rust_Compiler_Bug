{"sha": "506db1852cb5aafc188d8008ceba7e8e18f6a5cf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwNmRiMTg1MmNiNWFhZmMxODhkODAwOGNlYmE3ZThlMThmNmE1Y2Y=", "commit": {"author": {"name": "Alexander Gonzalez", "email": "alexfertel97@gmail.com", "date": "2021-07-26T20:19:12Z"}, "committer": {"name": "Alexander Gonzalez", "email": "alexfertel97@gmail.com", "date": "2021-07-27T22:29:22Z"}, "message": "test: Add tests for when hovering fails", "tree": {"sha": "26a07d75cad555c15bd9cdf2ed867413508ff4a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26a07d75cad555c15bd9cdf2ed867413508ff4a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/506db1852cb5aafc188d8008ceba7e8e18f6a5cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/506db1852cb5aafc188d8008ceba7e8e18f6a5cf", "html_url": "https://github.com/rust-lang/rust/commit/506db1852cb5aafc188d8008ceba7e8e18f6a5cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/506db1852cb5aafc188d8008ceba7e8e18f6a5cf/comments", "author": {"login": "alexfertel", "id": 22298999, "node_id": "MDQ6VXNlcjIyMjk4OTk5", "avatar_url": "https://avatars.githubusercontent.com/u/22298999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexfertel", "html_url": "https://github.com/alexfertel", "followers_url": "https://api.github.com/users/alexfertel/followers", "following_url": "https://api.github.com/users/alexfertel/following{/other_user}", "gists_url": "https://api.github.com/users/alexfertel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexfertel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexfertel/subscriptions", "organizations_url": "https://api.github.com/users/alexfertel/orgs", "repos_url": "https://api.github.com/users/alexfertel/repos", "events_url": "https://api.github.com/users/alexfertel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexfertel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexfertel", "id": 22298999, "node_id": "MDQ6VXNlcjIyMjk4OTk5", "avatar_url": "https://avatars.githubusercontent.com/u/22298999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexfertel", "html_url": "https://github.com/alexfertel", "followers_url": "https://api.github.com/users/alexfertel/followers", "following_url": "https://api.github.com/users/alexfertel/following{/other_user}", "gists_url": "https://api.github.com/users/alexfertel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexfertel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexfertel/subscriptions", "organizations_url": "https://api.github.com/users/alexfertel/orgs", "repos_url": "https://api.github.com/users/alexfertel/repos", "events_url": "https://api.github.com/users/alexfertel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexfertel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48f43df7d64378e0d58e74791fd1f9cbabcd0e18", "url": "https://api.github.com/repos/rust-lang/rust/commits/48f43df7d64378e0d58e74791fd1f9cbabcd0e18", "html_url": "https://github.com/rust-lang/rust/commit/48f43df7d64378e0d58e74791fd1f9cbabcd0e18"}], "stats": {"total": 74, "additions": 68, "deletions": 6}, "files": [{"sha": "292a1faacfe84b6d1808ad820cea3fb16deaccf3", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 68, "deletions": 6, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/506db1852cb5aafc188d8008ceba7e8e18f6a5cf/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/506db1852cb5aafc188d8008ceba7e8e18f6a5cf/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=506db1852cb5aafc188d8008ceba7e8e18f6a5cf", "patch": "@@ -673,6 +673,21 @@ mod tests {\n         expect.assert_eq(hover.info.markup.as_str())\n     }\n \n+    fn check_hover_range_no_results(ra_fixture: &str) {\n+        let (analysis, range) = fixture::range(ra_fixture);\n+        let hover = analysis\n+            .hover_range(\n+                &HoverConfig {\n+                    links_in_hover: false,\n+                    documentation: Some(HoverDocFormat::Markdown),\n+                },\n+                range,\n+            )\n+            .unwrap();\n+        println!(\"AAA {:#?}\", hover);\n+        assert!(hover.is_none());\n+    }\n+\n     #[test]\n     fn hover_shows_type_of_an_expression() {\n         check(\n@@ -3937,7 +3952,7 @@ struct Foo;\n     fn hover_range_math() {\n         check_hover_range(\n             r#\"\n-fn f() { let expr = $01 + 2 * 3$0 } \n+fn f() { let expr = $01 + 2 * 3$0 }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -3947,7 +3962,7 @@ fn f() { let expr = $01 + 2 * 3$0 }\n \n         check_hover_range(\n             r#\"\n-fn f() { let expr = 1 $0+ 2 * $03 } \n+fn f() { let expr = 1 $0+ 2 * $03 }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -3957,7 +3972,7 @@ fn f() { let expr = 1 $0+ 2 * $03 }\n \n         check_hover_range(\n             r#\"\n-fn f() { let expr = 1 + $02 * 3$0 } \n+fn f() { let expr = 1 + $02 * 3$0 }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -3970,7 +3985,7 @@ fn f() { let expr = 1 + $02 * 3$0 }\n     fn hover_range_arrays() {\n         check_hover_range(\n             r#\"\n-fn f() { let expr = $0[1, 2, 3, 4]$0 } \n+fn f() { let expr = $0[1, 2, 3, 4]$0 }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -3980,7 +3995,7 @@ fn f() { let expr = $0[1, 2, 3, 4]$0 }\n \n         check_hover_range(\n             r#\"\n-fn f() { let expr = [1, 2, $03, 4]$0 } \n+fn f() { let expr = [1, 2, $03, 4]$0 }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -3990,7 +4005,7 @@ fn f() { let expr = [1, 2, $03, 4]$0 }\n \n         check_hover_range(\n             r#\"\n-fn f() { let expr = [1, 2, $03$0, 4] } \n+fn f() { let expr = [1, 2, $03$0, 4] }\n             \"#,\n             expect![[r#\"\n             ```rust\n@@ -4023,4 +4038,51 @@ fn b() { f($0&[1, 2, 3, 4, 5]$0); }\n             ```\"#]],\n         );\n     }\n+\n+    #[test]\n+    fn hover_range_shows_nothing_when_invalid() {\n+        check_hover_range_no_results(\n+            r#\"\n+fn f<T>(a: &[T]) { }\n+fn b()$0 { f(&[1, 2, 3, 4, 5]); }$0\n+            \"#,\n+        );\n+\n+        check_hover_range_no_results(\n+            r#\"\n+fn f<T>$0(a: &[T]) { }\n+fn b() { f(&[1, 2, 3,$0 4, 5]); }\n+            \"#,\n+        );\n+\n+        check_hover_range_no_results(\n+            r#\"\n+fn $0f() { let expr = [1, 2, 3, 4]$0 }\n+            \"#,\n+        );\n+    }\n+\n+    #[test]\n+    fn hover_range_shows_unit_for_statements() {\n+        check_hover_range(\n+            r#\"\n+fn f<T>(a: &[T]) { }\n+fn b() { $0f(&[1, 2, 3, 4, 5]); }$0\n+            \"#,\n+            expect![[r#\"\n+            ```rust\n+            ()\n+            ```\"#]],\n+        );\n+\n+        check_hover_range(\n+            r#\"\n+fn f() { let expr$0 = $0[1, 2, 3, 4] }\n+            \"#,\n+            expect![[r#\"\n+            ```rust\n+            ()\n+            ```\"#]],\n+        );\n+    }\n }"}]}