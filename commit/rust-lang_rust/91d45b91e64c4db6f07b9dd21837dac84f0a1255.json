{"sha": "91d45b91e64c4db6f07b9dd21837dac84f0a1255", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxZDQ1YjkxZTY0YzRkYjZmMDdiOWRkMjE4MzdkYWM4NGYwYTEyNTU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-09T05:23:11Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-09T05:23:11Z"}, "message": "stdlib: Implement str::unsafe_from_bytes_ivec()", "tree": {"sha": "993e31b0f6894019017ed4c8a8d2f7c91b36c909", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/993e31b0f6894019017ed4c8a8d2f7c91b36c909"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91d45b91e64c4db6f07b9dd21837dac84f0a1255", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91d45b91e64c4db6f07b9dd21837dac84f0a1255", "html_url": "https://github.com/rust-lang/rust/commit/91d45b91e64c4db6f07b9dd21837dac84f0a1255", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91d45b91e64c4db6f07b9dd21837dac84f0a1255/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa0f6f49610962466972e659605e3c8e676ce7b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa0f6f49610962466972e659605e3c8e676ce7b5", "html_url": "https://github.com/rust-lang/rust/commit/aa0f6f49610962466972e659605e3c8e676ce7b5"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "51be2f6a0691e7156b9b4c6a6c6e7a3efa6015b7", "filename": "src/lib/str.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Flib%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Flib%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fstr.rs?ref=91d45b91e64c4db6f07b9dd21837dac84f0a1255", "patch": "@@ -55,6 +55,7 @@ native \"rust\" mod rustrt {\n     fn str_vec(str s) -> vec[u8];\n     fn str_byte_len(str s) -> uint;\n     fn str_alloc(uint n_bytes) -> str;\n+    fn str_from_ivec(&u8[mutable?] b) -> str;\n     fn str_from_vec(vec[mutable? u8] b) -> str;\n     fn str_from_cstr(sbuf cstr) -> str;\n     fn str_from_buf(sbuf buf, uint len) -> str;\n@@ -170,6 +171,10 @@ fn unsafe_from_bytes(vec[mutable? u8] v) -> str {\n     ret rustrt::str_from_vec(v);\n }\n \n+fn unsafe_from_bytes_ivec(&u8[mutable?] v) -> str {\n+    ret rustrt::str_from_ivec(v);\n+}\n+\n fn unsafe_from_byte(u8 u) -> str { ret rustrt::str_from_vec([u]); }\n \n fn str_from_cstr(sbuf cstr) -> str { ret rustrt::str_from_cstr(cstr); }"}, {"sha": "6057ee4cb6c9fd25995ea4aefe34e372f0d5bd6f", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=91d45b91e64c4db6f07b9dd21837dac84f0a1255", "patch": "@@ -313,6 +313,26 @@ str_byte_len(rust_task *task, rust_str *s)\n     return s->fill - 1;  // -1 for the '\\0' terminator.\n }\n \n+extern \"C\" CDECL rust_str *\n+str_from_ivec(rust_task *task, rust_ivec *v)\n+{\n+    uintptr_t fill = v->fill ? v->fill : v->payload.ptr->fill;\n+    void *data = v->fill ? v->payload.data : v->payload.ptr->data;\n+\n+    rust_str *st =\n+        vec_alloc_with_data(task,\n+                            fill + 1,   // +1 to fit at least '\\0'\n+                            fill,\n+                            1,\n+                            fill ? data : NULL);\n+    if (!st) {\n+        task->fail(2);\n+        return NULL;\n+    }\n+    st->data[st->fill++] = '\\0';\n+    return st;\n+}\n+\n extern \"C\" CDECL rust_str *\n str_from_vec(rust_task *task, rust_vec *v)\n {"}, {"sha": "6db3ac6fcf3fca5ad6ac457d5955333d525f1711", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/91d45b91e64c4db6f07b9dd21837dac84f0a1255/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=91d45b91e64c4db6f07b9dd21837dac84f0a1255", "patch": "@@ -41,6 +41,7 @@ str_buf\n str_byte_len\n str_from_buf\n str_from_cstr\n+str_from_ivec\n str_from_vec\n str_push_byte\n str_slice"}]}