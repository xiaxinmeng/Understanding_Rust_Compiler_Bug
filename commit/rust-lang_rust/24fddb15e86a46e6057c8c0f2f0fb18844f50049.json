{"sha": "24fddb15e86a46e6057c8c0f2f0fb18844f50049", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0ZmRkYjE1ZTg2YTQ2ZTYwNTdjOGMwZjJmMGZiMTg4NDRmNTAwNDk=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-05-01T21:57:24Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-05-01T21:57:24Z"}, "message": "Resolve match arm ty when arms diverge", "tree": {"sha": "c95129398ad1d64e71c765772925dfb01c6e90af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c95129398ad1d64e71c765772925dfb01c6e90af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24fddb15e86a46e6057c8c0f2f0fb18844f50049", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24fddb15e86a46e6057c8c0f2f0fb18844f50049", "html_url": "https://github.com/rust-lang/rust/commit/24fddb15e86a46e6057c8c0f2f0fb18844f50049", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24fddb15e86a46e6057c8c0f2f0fb18844f50049/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a55c2eb325029960991508e64650a139b040d24f", "url": "https://api.github.com/repos/rust-lang/rust/commits/a55c2eb325029960991508e64650a139b040d24f", "html_url": "https://github.com/rust-lang/rust/commit/a55c2eb325029960991508e64650a139b040d24f"}], "stats": {"total": 61, "additions": 43, "deletions": 18}, "files": [{"sha": "95b566d4a1b6933736e3c4fc12756e5f7bd7974f", "filename": "src/librustc/infer/error_reporting/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=24fddb15e86a46e6057c8c0f2f0fb18844f50049", "patch": "@@ -644,7 +644,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                         for sp in prior_arms {\n                             err.span_label(*sp, format!(\n                                 \"this is found to be of type `{}`\",\n-                                last_ty,\n+                                self.resolve_type_vars_if_possible(&last_ty),\n                             ));\n                         }\n                     } else if let Some(sp) = prior_arms.last() {"}, {"sha": "8dfbf1019e9a402245b73b6acd8abf86fd46cd2c", "filename": "src/test/ui/match/match-type-err-first-arm.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.rs?ref=24fddb15e86a46e6057c8c0f2f0fb18844f50049", "patch": "@@ -3,8 +3,7 @@ fn main() {\n     let _ = test_func2(1);\n }\n \n-fn test_func1(n: i32) -> i32 {\n-    //~^ NOTE expected `i32` because of return type\n+fn test_func1(n: i32) -> i32 { //~ NOTE expected `i32` because of return type\n     match n {\n         12 => 'b',\n         //~^ ERROR mismatched types\n@@ -14,10 +13,8 @@ fn test_func1(n: i32) -> i32 {\n }\n \n fn test_func2(n: i32) -> i32 {\n-    let x = match n {\n-    //~^ NOTE `match` arms have incompatible types\n-        12 => 'b',\n-        //~^ NOTE this is found to be of type `char`\n+    let x = match n { //~ NOTE `match` arms have incompatible types\n+        12 => 'b', //~ NOTE this is found to be of type `char`\n         _ => 42,\n         //~^ ERROR match arms have incompatible types\n         //~| NOTE expected char, found integer\n@@ -27,8 +24,7 @@ fn test_func2(n: i32) -> i32 {\n }\n \n fn test_func3(n: i32) -> i32 {\n-    let x = match n {\n-    //~^ NOTE `match` arms have incompatible types\n+    let x = match n { //~ NOTE `match` arms have incompatible types\n         1 => 'b',\n         2 => 'b',\n         3 => 'b',\n@@ -43,3 +39,15 @@ fn test_func3(n: i32) -> i32 {\n     };\n     x\n }\n+\n+fn test_func4() {\n+    match Some(0u32) { //~ NOTE `match` arms have incompatible types\n+        Some(x) => {\n+            x //~ NOTE this is found to be of type `u32`\n+        },\n+        None => {}\n+        //~^ ERROR match arms have incompatible types\n+        //~| NOTE expected u32, found ()\n+        //~| NOTE expected type `u32`\n+    };\n+}"}, {"sha": "e0553fca683a557aec0c25492fc2eda0b3bcf2d2", "filename": "src/test/ui/match/match-type-err-first-arm.stderr", "status": "modified", "additions": 26, "deletions": 9, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/24fddb15e86a46e6057c8c0f2f0fb18844f50049/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fmatch-type-err-first-arm.stderr?ref=24fddb15e86a46e6057c8c0f2f0fb18844f50049", "patch": "@@ -1,24 +1,23 @@\n error[E0308]: mismatched types\n-  --> $DIR/match-type-err-first-arm.rs:9:15\n+  --> $DIR/match-type-err-first-arm.rs:8:15\n    |\n LL | fn test_func1(n: i32) -> i32 {\n    |                          --- expected `i32` because of return type\n-...\n+LL |     match n {\n LL |         12 => 'b',\n    |               ^^^ expected i32, found char\n \n error[E0308]: match arms have incompatible types\n-  --> $DIR/match-type-err-first-arm.rs:21:14\n+  --> $DIR/match-type-err-first-arm.rs:18:14\n    |\n LL |       let x = match n {\n    |  _____________-\n-LL | |\n LL | |         12 => 'b',\n    | |               --- this is found to be of type `char`\n-LL | |\n LL | |         _ => 42,\n    | |              ^^ expected char, found integer\n-...  |\n+LL | |\n+LL | |\n LL | |\n LL | |     };\n    | |_____- `match` arms have incompatible types\n@@ -27,13 +26,13 @@ LL | |     };\n               found type `{integer}`\n \n error[E0308]: match arms have incompatible types\n-  --> $DIR/match-type-err-first-arm.rs:39:14\n+  --> $DIR/match-type-err-first-arm.rs:35:14\n    |\n LL |       let x = match n {\n    |  _____________-\n-LL | |\n LL | |         1 => 'b',\n LL | |         2 => 'b',\n+LL | |         3 => 'b',\n ...  |\n LL | |         6 => 'b',\n    | |              --- this and all prior arms are found to be of type `char`\n@@ -48,6 +47,24 @@ LL | |     };\n    = note: expected type `char`\n               found type `{integer}`\n \n-error: aborting due to 3 previous errors\n+error[E0308]: match arms have incompatible types\n+  --> $DIR/match-type-err-first-arm.rs:48:17\n+   |\n+LL | /     match Some(0u32) {\n+LL | |         Some(x) => {\n+LL | |             x\n+   | |             - this is found to be of type `u32`\n+LL | |         },\n+LL | |         None => {}\n+   | |                 ^^ expected u32, found ()\n+...  |\n+LL | |\n+LL | |     };\n+   | |_____- `match` arms have incompatible types\n+   |\n+   = note: expected type `u32`\n+              found type `()`\n+\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0308`."}]}