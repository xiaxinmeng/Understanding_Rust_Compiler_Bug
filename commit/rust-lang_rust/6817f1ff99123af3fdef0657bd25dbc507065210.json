{"sha": "6817f1ff99123af3fdef0657bd25dbc507065210", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MTdmMWZmOTkxMjNhZjNmZGVmMDY1N2JkMjVkYmM1MDcwNjUyMTA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-03T16:54:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-03T16:54:29Z"}, "message": "Merge #7544\n\n7544: Update `DefMap` and `block_def_map` docs r=jonas-schievink a=jonas-schievink\n\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>", "tree": {"sha": "6eb56b4241c51a2121640b4d27ad4aa75175dd86", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6eb56b4241c51a2121640b4d27ad4aa75175dd86"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6817f1ff99123af3fdef0657bd25dbc507065210", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgGtVFCRBK7hj4Ov3rIwAAdHIIAK+CvtD9QHAVlUOYDJ3e9SO3\nPx5v89wvQ4v/Q95V6ALxmk9879qy9ixv+a65kYHpzD6aCdXnmQwo2JM+uPCMvwgq\nlitesadlpAtTY8NUcTeAxLPkUT5v9sDNu7/QSDXxH+4jaXB0DC+kSHLV1yykNAxf\nHE0y00c7zRLSxl9nJieFUlIkkKhokz9DCTCn5aun2Vf7xOO4dRT/B9dEIqPwpNxX\nCTF/niFZOkf3N3JaiwoGy4gJe041UCPKoWGM+M1Mm/GuMkcwft/2tOm5E4NrRrgO\n41V4y1HaxwVkUxukDq1rIbD1xTHpaY/wcINJGjXLCymwHUwCWwRJ+lqs3OtCDoc=\n=D2OX\n-----END PGP SIGNATURE-----\n", "payload": "tree 6eb56b4241c51a2121640b4d27ad4aa75175dd86\nparent c92be90fd227c3cf96ab9b5f4a9cb6684b00c05e\nparent d4a22fc801f4768990c7e62241bea5fe4ff92ead\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1612371269 +0000\ncommitter GitHub <noreply@github.com> 1612371269 +0000\n\nMerge #7544\n\n7544: Update `DefMap` and `block_def_map` docs r=jonas-schievink a=jonas-schievink\n\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6817f1ff99123af3fdef0657bd25dbc507065210", "html_url": "https://github.com/rust-lang/rust/commit/6817f1ff99123af3fdef0657bd25dbc507065210", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6817f1ff99123af3fdef0657bd25dbc507065210/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c92be90fd227c3cf96ab9b5f4a9cb6684b00c05e", "url": "https://api.github.com/repos/rust-lang/rust/commits/c92be90fd227c3cf96ab9b5f4a9cb6684b00c05e", "html_url": "https://github.com/rust-lang/rust/commit/c92be90fd227c3cf96ab9b5f4a9cb6684b00c05e"}, {"sha": "d4a22fc801f4768990c7e62241bea5fe4ff92ead", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4a22fc801f4768990c7e62241bea5fe4ff92ead", "html_url": "https://github.com/rust-lang/rust/commit/d4a22fc801f4768990c7e62241bea5fe4ff92ead"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "6c01f1ed00f7b9f6fd37919f3d4a89f9e3a22659", "filename": "crates/hir_def/src/db.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6817f1ff99123af3fdef0657bd25dbc507065210/crates%2Fhir_def%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6817f1ff99123af3fdef0657bd25dbc507065210/crates%2Fhir_def%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fdb.rs?ref=6817f1ff99123af3fdef0657bd25dbc507065210", "patch": "@@ -58,6 +58,21 @@ pub trait DefDatabase: InternDatabase + AstDatabase + Upcast<dyn AstDatabase> {\n     #[salsa::invoke(DefMap::crate_def_map_query)]\n     fn crate_def_map_query(&self, krate: CrateId) -> Arc<DefMap>;\n \n+    /// Computes the block-level `DefMap`, returning `None` when `block` doesn't contain any inner\n+    /// items directly.\n+    ///\n+    /// For example:\n+    ///\n+    /// ```\n+    /// fn f() { // (0)\n+    ///     { // (1)\n+    ///         fn inner() {}\n+    ///     }\n+    /// }\n+    /// ```\n+    ///\n+    /// The `block_def_map` for block 0 would return `None`, while `block_def_map` of block 1 would\n+    /// return a `DefMap` containing `inner`.\n     #[salsa::invoke(DefMap::block_def_map_query)]\n     fn block_def_map(&self, block: BlockId) -> Option<Arc<DefMap>>;\n "}, {"sha": "ef54f7d089dc984ee81ed7c549d4abf41b2b9999", "filename": "crates/hir_def/src/nameres.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6817f1ff99123af3fdef0657bd25dbc507065210/crates%2Fhir_def%2Fsrc%2Fnameres.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6817f1ff99123af3fdef0657bd25dbc507065210/crates%2Fhir_def%2Fsrc%2Fnameres.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres.rs?ref=6817f1ff99123af3fdef0657bd25dbc507065210", "patch": "@@ -73,7 +73,15 @@ use crate::{\n     AstId, BlockId, BlockLoc, LocalModuleId, ModuleDefId, ModuleId,\n };\n \n-/// Contains all top-level defs from a macro-expanded crate\n+/// Contains the results of (early) name resolution.\n+///\n+/// A `DefMap` stores the module tree and the definitions that are in scope in every module after\n+/// item-level macros have been expanded.\n+///\n+/// Every crate has a primary `DefMap` whose root is the crate's main file (`main.rs`/`lib.rs`),\n+/// computed by the `crate_def_map` query. Additionally, every block expression introduces the\n+/// opportunity to write arbitrary item and module hierarchies, and thus gets its own `DefMap` that\n+/// is computed by the `block_def_map` query.\n #[derive(Debug, PartialEq, Eq)]\n pub struct DefMap {\n     _c: Count<Self>,\n@@ -91,6 +99,7 @@ pub struct DefMap {\n     diagnostics: Vec<DefDiagnostic>,\n }\n \n+/// For `DefMap`s computed for a block expression, this stores its location in the parent map.\n #[derive(Debug, PartialEq, Eq)]\n struct BlockInfo {\n     block: BlockId,"}]}