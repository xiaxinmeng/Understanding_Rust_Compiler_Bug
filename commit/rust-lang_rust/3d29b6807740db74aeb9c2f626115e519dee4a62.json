{"sha": "3d29b6807740db74aeb9c2f626115e519dee4a62", "node_id": "C_kwDOAAsO6NoAKDNkMjliNjgwNzc0MGRiNzRhZWI5YzJmNjI2MTE1ZTUxOWRlZTRhNjI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-11T15:15:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-11T15:15:15Z"}, "message": "Auto merge of #90648 - matthewjasper:assoc-item-cleanup, r=cjgillot\n\nAssoc item cleanup\n\nThis removes some fields from ObligationCauseCode\n\nSplit out of #90639", "tree": {"sha": "98e1c93a51c1eef64bd007ea994c3a04fc60d426", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98e1c93a51c1eef64bd007ea994c3a04fc60d426"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d29b6807740db74aeb9c2f626115e519dee4a62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d29b6807740db74aeb9c2f626115e519dee4a62", "html_url": "https://github.com/rust-lang/rust/commit/3d29b6807740db74aeb9c2f626115e519dee4a62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d29b6807740db74aeb9c2f626115e519dee4a62/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d71ba74f0d51459ef10f2b73400c013c7a12d828", "url": "https://api.github.com/repos/rust-lang/rust/commits/d71ba74f0d51459ef10f2b73400c013c7a12d828", "html_url": "https://github.com/rust-lang/rust/commit/d71ba74f0d51459ef10f2b73400c013c7a12d828"}, {"sha": "9734c035248319e2c4b871af94220ce881def29c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9734c035248319e2c4b871af94220ce881def29c", "html_url": "https://github.com/rust-lang/rust/commit/9734c035248319e2c4b871af94220ce881def29c"}], "stats": {"total": 91, "additions": 29, "deletions": 62}, "files": [{"sha": "298346c373e54cfd9d9a3fc0457556b8f745c99b", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -2190,14 +2190,12 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n \n         if let Some(SubregionOrigin::CompareImplMethodObligation {\n             span,\n-            item_name,\n             impl_item_def_id,\n             trait_item_def_id,\n         }) = origin\n         {\n             return self.report_extra_impl_obligation(\n                 span,\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n                 &format!(\"`{}: {}`\", bound_kind, sub),"}, {"sha": "cfa79213c805ce683e5f524bda74e7de27e14629", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/trait_impl_difference.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -54,12 +54,16 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n         {\n             if let SubregionOrigin::CompareImplTypeObligation {\n                 span,\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n             } = origin\n             {\n-                self.emit_associated_type_err(span, item_name, impl_item_def_id, trait_item_def_id);\n+                self.emit_associated_type_err(\n+                    span,\n+                    self.infcx.tcx.item_name(impl_item_def_id),\n+                    impl_item_def_id,\n+                    trait_item_def_id,\n+                );\n                 return Some(ErrorReported);\n             }\n         }"}, {"sha": "6600c18351fbe8bdf7628ce5e7938e000880b673", "filename": "compiler/rustc_infer/src/infer/error_reporting/note.rs", "status": "modified", "additions": 15, "deletions": 24, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -330,30 +330,21 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                 );\n                 err\n             }\n-            infer::CompareImplMethodObligation {\n-                span,\n-                item_name,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-            } => self.report_extra_impl_obligation(\n-                span,\n-                item_name,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-                &format!(\"`{}: {}`\", sup, sub),\n-            ),\n-            infer::CompareImplTypeObligation {\n-                span,\n-                item_name,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-            } => self.report_extra_impl_obligation(\n-                span,\n-                item_name,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-                &format!(\"`{}: {}`\", sup, sub),\n-            ),\n+            infer::CompareImplMethodObligation { span, impl_item_def_id, trait_item_def_id } => {\n+                self.report_extra_impl_obligation(\n+                    span,\n+                    impl_item_def_id,\n+                    trait_item_def_id,\n+                    &format!(\"`{}: {}`\", sup, sub),\n+                )\n+            }\n+            infer::CompareImplTypeObligation { span, impl_item_def_id, trait_item_def_id } => self\n+                .report_extra_impl_obligation(\n+                    span,\n+                    impl_item_def_id,\n+                    trait_item_def_id,\n+                    &format!(\"`{}: {}`\", sup, sub),\n+                ),\n         }\n     }\n "}, {"sha": "32d3db39d64405e6d826ded8999f6425796e1e82", "filename": "compiler/rustc_infer/src/infer/mod.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -419,21 +419,11 @@ pub enum SubregionOrigin<'tcx> {\n \n     /// Comparing the signature and requirements of an impl method against\n     /// the containing trait.\n-    CompareImplMethodObligation {\n-        span: Span,\n-        item_name: Symbol,\n-        impl_item_def_id: DefId,\n-        trait_item_def_id: DefId,\n-    },\n+    CompareImplMethodObligation { span: Span, impl_item_def_id: DefId, trait_item_def_id: DefId },\n \n     /// Comparing the signature and requirements of an impl associated type\n     /// against the containing trait\n-    CompareImplTypeObligation {\n-        span: Span,\n-        item_name: Symbol,\n-        impl_item_def_id: DefId,\n-        trait_item_def_id: DefId,\n-    },\n+    CompareImplTypeObligation { span: Span, impl_item_def_id: DefId, trait_item_def_id: DefId },\n }\n \n // `SubregionOrigin` is used a lot. Make sure it doesn't unintentionally get bigger.\n@@ -1830,23 +1820,19 @@ impl<'tcx> SubregionOrigin<'tcx> {\n             }\n \n             traits::ObligationCauseCode::CompareImplMethodObligation {\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n             } => SubregionOrigin::CompareImplMethodObligation {\n                 span: cause.span,\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n             },\n \n             traits::ObligationCauseCode::CompareImplTypeObligation {\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n             } => SubregionOrigin::CompareImplTypeObligation {\n                 span: cause.span,\n-                item_name,\n                 impl_item_def_id,\n                 trait_item_def_id,\n             },"}, {"sha": "c1f302e665d4b77cbfffae619a0f05afe49b7168", "filename": "compiler/rustc_infer/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -6,7 +6,6 @@ use rustc_errors::{struct_span_err, DiagnosticBuilder};\n use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n use rustc_middle::ty::TyCtxt;\n-use rustc_span::symbol::Symbol;\n use rustc_span::{MultiSpan, Span};\n use std::fmt;\n use std::iter;\n@@ -15,8 +14,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n     pub fn report_extra_impl_obligation(\n         &self,\n         error_span: Span,\n-        item_name: Symbol,\n-        _impl_item_def_id: DefId,\n+        impl_item_def_id: DefId,\n         trait_item_def_id: DefId,\n         requirement: &dyn fmt::Display,\n     ) -> DiagnosticBuilder<'tcx> {\n@@ -27,6 +25,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n \n         if let Some(trait_item_span) = self.tcx.hir().span_if_local(trait_item_def_id) {\n             let span = self.tcx.sess.source_map().guess_head_span(trait_item_span);\n+            let item_name = self.tcx.item_name(impl_item_def_id);\n             err.span_label(span, format!(\"definition of `{}` from trait\", item_name));\n         }\n "}, {"sha": "245df6361076f93a5c5eceeab0661828f39d129c", "filename": "compiler/rustc_middle/src/traits/mod.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -267,14 +267,12 @@ pub enum ObligationCauseCode<'tcx> {\n \n     /// Error derived when matching traits/impls; see ObligationCause for more details\n     CompareImplMethodObligation {\n-        item_name: Symbol,\n         impl_item_def_id: DefId,\n         trait_item_def_id: DefId,\n     },\n \n     /// Error derived when matching traits/impls; see ObligationCause for more details\n     CompareImplTypeObligation {\n-        item_name: Symbol,\n         impl_item_def_id: DefId,\n         trait_item_def_id: DefId,\n     },"}, {"sha": "79194718d1efd5da0289d6f6bd8ea7e72059fcb0", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -266,19 +266,16 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     }\n                 }\n                 if let ObligationCauseCode::CompareImplMethodObligation {\n-                    item_name,\n                     impl_item_def_id,\n                     trait_item_def_id,\n                 }\n                 | ObligationCauseCode::CompareImplTypeObligation {\n-                    item_name,\n                     impl_item_def_id,\n                     trait_item_def_id,\n                 } = obligation.cause.code\n                 {\n                     self.report_extra_impl_obligation(\n                         span,\n-                        item_name,\n                         impl_item_def_id,\n                         trait_item_def_id,\n                         &format!(\"`{}`\", obligation.predicate),"}, {"sha": "7d9568e0ca3526d21dc9053ac91ca3b92cee715d", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -2354,11 +2354,8 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     )\n                 });\n             }\n-            ObligationCauseCode::CompareImplMethodObligation {\n-                item_name,\n-                trait_item_def_id,\n-                ..\n-            } => {\n+            ObligationCauseCode::CompareImplMethodObligation { trait_item_def_id, .. } => {\n+                let item_name = self.tcx.item_name(trait_item_def_id);\n                 let msg = format!(\n                     \"the requirement `{}` appears on the impl method `{}` but not on the \\\n                      corresponding trait method\",\n@@ -2383,9 +2380,8 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                 }\n                 err.span_note(assoc_span, &msg);\n             }\n-            ObligationCauseCode::CompareImplTypeObligation {\n-                item_name, trait_item_def_id, ..\n-            } => {\n+            ObligationCauseCode::CompareImplTypeObligation { trait_item_def_id, .. } => {\n+                let item_name = self.tcx.item_name(trait_item_def_id);\n                 let msg = format!(\n                     \"the requirement `{}` appears on the associated impl type `{}` but not on the \\\n                      corresponding associated trait type\","}, {"sha": "cbfd8747ecf0091b16c6c711ee9e83c4771d5c3e", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d29b6807740db74aeb9c2f626115e519dee4a62/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=3d29b6807740db74aeb9c2f626115e519dee4a62", "patch": "@@ -92,7 +92,6 @@ fn compare_predicate_entailment<'tcx>(\n         impl_m_span,\n         impl_m_hir_id,\n         ObligationCauseCode::CompareImplMethodObligation {\n-            item_name: impl_m.ident.name,\n             impl_item_def_id: impl_m.def_id,\n             trait_item_def_id: trait_m.def_id,\n         },\n@@ -1167,7 +1166,6 @@ fn compare_type_predicate_entailment<'tcx>(\n         impl_ty_span,\n         impl_ty_hir_id,\n         ObligationCauseCode::CompareImplTypeObligation {\n-            item_name: impl_ty.ident.name,\n             impl_item_def_id: impl_ty.def_id,\n             trait_item_def_id: trait_ty.def_id,\n         },"}]}