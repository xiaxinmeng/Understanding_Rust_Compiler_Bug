{"sha": "2f3db49c3d99d0338b4a47b62079da71c26db458", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmM2RiNDljM2Q5OWQwMzM4YjRhNDdiNjIwNzlkYTcxYzI2ZGI0NTg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-12-12T22:43:44Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-12T13:18:20Z"}, "message": "resolve: Prohibit use of imported tool modules", "tree": {"sha": "5541c2fa88db3bbbdc5f07cdeeb8636a3b02e64f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5541c2fa88db3bbbdc5f07cdeeb8636a3b02e64f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f3db49c3d99d0338b4a47b62079da71c26db458", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f3db49c3d99d0338b4a47b62079da71c26db458", "html_url": "https://github.com/rust-lang/rust/commit/2f3db49c3d99d0338b4a47b62079da71c26db458", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f3db49c3d99d0338b4a47b62079da71c26db458/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf1e70cd1f39c0879b36bead3b07a0fdfcfc4c32", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf1e70cd1f39c0879b36bead3b07a0fdfcfc4c32", "html_url": "https://github.com/rust-lang/rust/commit/bf1e70cd1f39c0879b36bead3b07a0fdfcfc4c32"}], "stats": {"total": 57, "additions": 51, "deletions": 6}, "files": [{"sha": "e656e5329b5a54f0c7a7e8a0425bf2a56de68e3a", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=2f3db49c3d99d0338b4a47b62079da71c26db458", "patch": "@@ -3874,6 +3874,13 @@ impl<'a> Resolver<'a> {\n                         module = Some(ModuleOrUniformRoot::Module(next_module));\n                         record_segment_def(self, def);\n                     } else if def == Def::ToolMod && i + 1 != path.len() {\n+                        if binding.is_import() {\n+                            self.session.struct_span_err(\n+                                ident.span, \"cannot use a tool module through an import\"\n+                            ).span_note(\n+                                binding.span, \"the tool module imported here\"\n+                            ).emit();\n+                        }\n                         let def = Def::NonMacroAttr(NonMacroAttrKind::Tool);\n                         return PathResult::NonModule(PathResolution::new(def));\n                     } else if def == Def::Err {"}, {"sha": "e153e868b311375f6f46bbb1de148e1b0aec175d", "filename": "src/test/ui/rust-2018/uniform-paths/prelude-fail-2.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.rs?ref=2f3db49c3d99d0338b4a47b62079da71c26db458", "patch": "@@ -4,6 +4,18 @@\n \n // Built-in attribute\n use inline as imported_inline;\n+mod builtin {\n+    pub use inline as imported_inline;\n+}\n+\n+// Tool module\n+use rustfmt as imported_rustfmt;\n+mod tool_mod {\n+    pub use rustfmt as imported_rustfmt;\n+}\n \n #[imported_inline] //~ ERROR cannot use a built-in attribute through an import\n+#[builtin::imported_inline] //~ ERROR cannot use a built-in attribute through an import\n+#[imported_rustfmt::skip] //~ ERROR cannot use a tool module through an import\n+#[tool_mod::imported_rustfmt::skip] //~ ERROR cannot use a tool module through an import\n fn main() {}"}, {"sha": "4c49cd89bdcb9fd1e86be5103c193cf0ac852e17", "filename": "src/test/ui/rust-2018/uniform-paths/prelude-fail-2.stderr", "status": "modified", "additions": 32, "deletions": 2, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude-fail-2.stderr?ref=2f3db49c3d99d0338b4a47b62079da71c26db458", "patch": "@@ -1,5 +1,5 @@\n error: cannot use a built-in attribute through an import\n-  --> $DIR/prelude-fail-2.rs:8:3\n+  --> $DIR/prelude-fail-2.rs:17:3\n    |\n LL | #[imported_inline] //~ ERROR cannot use a built-in attribute through an import\n    |   ^^^^^^^^^^^^^^^\n@@ -10,5 +10,35 @@ note: the built-in attribute imported here\n LL | use inline as imported_inline;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to previous error\n+error: cannot use a built-in attribute through an import\n+  --> $DIR/prelude-fail-2.rs:18:3\n+   |\n+LL | #[builtin::imported_inline] //~ ERROR cannot use a built-in attribute through an import\n+   |   ^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cannot use a tool module through an import\n+  --> $DIR/prelude-fail-2.rs:19:3\n+   |\n+LL | #[imported_rustfmt::skip] //~ ERROR cannot use a tool module through an import\n+   |   ^^^^^^^^^^^^^^^^\n+   |\n+note: the tool module imported here\n+  --> $DIR/prelude-fail-2.rs:12:5\n+   |\n+LL | use rustfmt as imported_rustfmt;\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cannot use a tool module through an import\n+  --> $DIR/prelude-fail-2.rs:20:13\n+   |\n+LL | #[tool_mod::imported_rustfmt::skip] //~ ERROR cannot use a tool module through an import\n+   |             ^^^^^^^^^^^^^^^^\n+   |\n+note: the tool module imported here\n+  --> $DIR/prelude-fail-2.rs:14:13\n+   |\n+LL |     pub use rustfmt as imported_rustfmt;\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 4 previous errors\n "}, {"sha": "1a6027f30d786b01a7a3bf7b0ef6a5f095a51a0a", "filename": "src/test/ui/rust-2018/uniform-paths/prelude.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f3db49c3d99d0338b4a47b62079da71c26db458/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Funiform-paths%2Fprelude.rs?ref=2f3db49c3d99d0338b4a47b62079da71c26db458", "patch": "@@ -6,9 +6,6 @@\n // Macro imported with `#[macro_use] extern crate`\n use vec as imported_vec;\n \n-// Tool module\n-use rustfmt as imported_rustfmt;\n-\n // Standard library prelude\n use Vec as ImportedVec;\n \n@@ -17,7 +14,6 @@ use u8 as imported_u8;\n \n type A = imported_u8;\n \n-#[imported_rustfmt::skip]\n fn main() {\n     imported_vec![0];\n     ImportedVec::<u8>::new();"}]}