{"sha": "69244a6e18b3b53afaa0ee8073af52d93b983a86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5MjQ0YTZlMThiM2I1M2FmYWEwZWU4MDczYWY1MmQ5M2I5ODNhODY=", "commit": {"author": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T10:45:03Z"}, "committer": {"name": "Phil Ellison", "email": "phil.j.ellison@gmail.com", "date": "2019-07-28T10:45:03Z"}, "message": "Inline snapshots for all tests in complete_snippet, remove now-unused check_completion", "tree": {"sha": "fe52d2ecf2e771e1be2ed05bc9a45d48335e6bc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe52d2ecf2e771e1be2ed05bc9a45d48335e6bc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69244a6e18b3b53afaa0ee8073af52d93b983a86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69244a6e18b3b53afaa0ee8073af52d93b983a86", "html_url": "https://github.com/rust-lang/rust/commit/69244a6e18b3b53afaa0ee8073af52d93b983a86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69244a6e18b3b53afaa0ee8073af52d93b983a86/comments", "author": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "committer": {"login": "theotherphil", "id": 1974256, "node_id": "MDQ6VXNlcjE5NzQyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1974256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theotherphil", "html_url": "https://github.com/theotherphil", "followers_url": "https://api.github.com/users/theotherphil/followers", "following_url": "https://api.github.com/users/theotherphil/following{/other_user}", "gists_url": "https://api.github.com/users/theotherphil/gists{/gist_id}", "starred_url": "https://api.github.com/users/theotherphil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theotherphil/subscriptions", "organizations_url": "https://api.github.com/users/theotherphil/orgs", "repos_url": "https://api.github.com/users/theotherphil/repos", "events_url": "https://api.github.com/users/theotherphil/events{/privacy}", "received_events_url": "https://api.github.com/users/theotherphil/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "460423e66c7a8d48084813c0d592066b4bef3e85", "url": "https://api.github.com/repos/rust-lang/rust/commits/460423e66c7a8d48084813c0d592066b4bef3e85", "html_url": "https://github.com/rust-lang/rust/commit/460423e66c7a8d48084813c0d592066b4bef3e85"}], "stats": {"total": 139, "additions": 58, "deletions": 81}, "files": [{"sha": "a6b68be75ec83cf21f4db32c75c943f6ffecc2a8", "filename": "crates/ra_ide_api/src/completion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion.rs?ref=69244a6e18b3b53afaa0ee8073af52d93b983a86", "patch": "@@ -16,7 +16,7 @@ mod complete_postfix;\n use ra_db::SourceDatabase;\n \n #[cfg(test)]\n-use crate::completion::completion_item::{check_completion, do_completion};\n+use crate::completion::completion_item::do_completion;\n use crate::{\n     completion::{\n         completion_context::CompletionContext,"}, {"sha": "063b6931921f0aec52b5fd09f8e69768697cd822", "filename": "crates/ra_ide_api/src/completion/complete_snippet.rs", "status": "modified", "additions": 57, "deletions": 18, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs?ref=69244a6e18b3b53afaa0ee8073af52d93b983a86", "patch": "@@ -39,39 +39,78 @@ fn ${1:feature}() {\n \n #[cfg(test)]\n mod tests {\n-    use crate::completion::{check_completion, CompletionKind};\n+    use crate::completion::{do_completion, CompletionItem, CompletionKind};\n+\tuse insta::assert_debug_snapshot_matches;\n \n-    fn check_snippet_completion(name: &str, code: &str) {\n-        check_completion(name, code, CompletionKind::Snippet);\n+    fn do_snippet_completion(code: &str) -> Vec<CompletionItem> {\n+        do_completion(code, CompletionKind::Snippet)\n     }\n \n     #[test]\n     fn completes_snippets_in_expressions() {\n-        check_snippet_completion(\"snippets_in_expressions\", r\"fn foo(x: i32) { <|> }\");\n+        assert_debug_snapshot_matches!(\n+            do_snippet_completion(r\"fn foo(x: i32) { <|> }\"),\n+@r#\"[\n+    CompletionItem {\n+        label: \"pd\",\n+        source_range: [17; 17),\n+        delete: [17; 17),\n+        insert: \"eprintln!(\\\"$0 = {:?}\\\", $0);\",\n+        kind: Snippet,\n+    },\n+    CompletionItem {\n+        label: \"ppd\",\n+        source_range: [17; 17),\n+        delete: [17; 17),\n+        insert: \"eprintln!(\\\"$0 = {:#?}\\\", $0);\",\n+        kind: Snippet,\n+    },\n+]\"#\n+        );\n     }\n \n     #[test]\n     fn should_not_complete_snippets_in_path() {\n-        check_snippet_completion(\n-            \"should_not_complete_snippets_in_path\",\n-            r\"fn foo(x: i32) { ::foo<|> }\",\n+        assert_debug_snapshot_matches!(\n+            do_snippet_completion(r\"fn foo(x: i32) { ::foo<|> }\"),\n+@r#\"[]\"#\n         );\n-        check_snippet_completion(\n-            \"should_not_complete_snippets_in_path2\",\n-            r\"fn foo(x: i32) { ::<|> }\",\n+        assert_debug_snapshot_matches!(\n+            do_snippet_completion(r\"fn foo(x: i32) { ::<|> }\"),\n+@r#\"[]\"#\n         );\n     }\n \n     #[test]\n     fn completes_snippets_in_items() {\n-        check_snippet_completion(\n-            \"snippets_in_items\",\n-            r\"\n-            #[cfg(test)]\n-            mod tests {\n-                <|>\n-            }\n-            \",\n+        assert_debug_snapshot_matches!(\n+            do_snippet_completion(\n+                r\"\n+                #[cfg(test)]\n+                mod tests {\n+                    <|>\n+                }\n+                \"\n+            ),\n+@r###\"\n+       \u22ee[\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"Test function\",\n+       \u22ee        source_range: [78; 78),\n+       \u22ee        delete: [78; 78),\n+       \u22ee        insert: \"#[test]\\nfn ${1:feature}() {\\n    $0\\n}\",\n+       \u22ee        kind: Snippet,\n+       \u22ee        lookup: \"tfn\",\n+       \u22ee    },\n+       \u22ee    CompletionItem {\n+       \u22ee        label: \"pub(crate)\",\n+       \u22ee        source_range: [78; 78),\n+       \u22ee        delete: [78; 78),\n+       \u22ee        insert: \"pub(crate) $0\",\n+       \u22ee        kind: Snippet,\n+       \u22ee    },\n+       \u22ee]\n+        \"###\n         );\n     }\n }"}, {"sha": "d787bb69ed0125e9448bd22a84fc79bf22fb19af", "filename": "crates/ra_ide_api/src/completion/completion_item.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69244a6e18b3b53afaa0ee8073af52d93b983a86/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=69244a6e18b3b53afaa0ee8073af52d93b983a86", "patch": "@@ -299,10 +299,3 @@ pub(crate) fn do_completion(code: &str, kind: CompletionKind) -> Vec<CompletionI\n     kind_completions.sort_by_key(|c| c.label.clone());\n     kind_completions\n }\n-\n-#[cfg(test)]\n-pub(crate) fn check_completion(test_name: &str, code: &str, kind: CompletionKind) {\n-    use insta::assert_debug_snapshot_matches;\n-    let kind_completions = do_completion(code, kind);\n-    assert_debug_snapshot_matches!(test_name, kind_completions);\n-}"}, {"sha": "cb3278edf08664a39b37d1036665906ef6905cec", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__should_not_complete_snippets_in_path.snap", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path.snap", "raw_url": "https://github.com/rust-lang/rust/raw/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path.snap?ref=460423e66c7a8d48084813c0d592066b4bef3e85", "patch": "@@ -1,5 +0,0 @@\n-Created: 2019-01-23T05:19:36.475253+00:00\n-Creator: insta@0.1.4\n-Source: crates/ra_ide_api/src/completion/completion_item.rs\n-\n-[]"}, {"sha": "62c8e3de9313181f0585d44a8b2abdb3e3f0396e", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__should_not_complete_snippets_in_path2.snap", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__should_not_complete_snippets_in_path2.snap?ref=460423e66c7a8d48084813c0d592066b4bef3e85", "patch": "@@ -1,5 +0,0 @@\n-Created: 2019-01-23T05:19:36.476869+00:00\n-Creator: insta@0.1.4\n-Source: crates/ra_ide_api/src/completion/completion_item.rs\n-\n-[]"}, {"sha": "6f41bf76f9792d9bc0d396057f6c9d8edf37bf7e", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__snippets_in_expressions.snap", "status": "removed", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap", "raw_url": "https://github.com/rust-lang/rust/raw/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap?ref=460423e66c7a8d48084813c0d592066b4bef3e85", "patch": "@@ -1,22 +0,0 @@\n----\n-created: \"2019-05-23T22:23:35.141901047Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"pd\",\n-        source_range: [17; 17),\n-        delete: [17; 17),\n-        insert: \"eprintln!(\\\"$0 = {:?}\\\", $0);\",\n-        kind: Snippet,\n-    },\n-    CompletionItem {\n-        label: \"ppd\",\n-        source_range: [17; 17),\n-        delete: [17; 17),\n-        insert: \"eprintln!(\\\"$0 = {:#?}\\\", $0);\",\n-        kind: Snippet,\n-    },\n-]"}, {"sha": "1eb0adebeabde7d1a8aa401fd84ce7d6d86dcbaa", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__snippets_in_items.snap", "status": "removed", "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap", "raw_url": "https://github.com/rust-lang/rust/raw/460423e66c7a8d48084813c0d592066b4bef3e85/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap?ref=460423e66c7a8d48084813c0d592066b4bef3e85", "patch": "@@ -1,23 +0,0 @@\n----\n-created: \"2019-05-23T22:23:35.149234118Z\"\n-creator: insta@0.8.1\n-source: crates/ra_ide_api/src/completion/completion_item.rs\n-expression: kind_completions\n----\n-[\n-    CompletionItem {\n-        label: \"Test function\",\n-        source_range: [66; 66),\n-        delete: [66; 66),\n-        insert: \"#[test]\\nfn ${1:feature}() {\\n    $0\\n}\",\n-        kind: Snippet,\n-        lookup: \"tfn\",\n-    },\n-    CompletionItem {\n-        label: \"pub(crate)\",\n-        source_range: [66; 66),\n-        delete: [66; 66),\n-        insert: \"pub(crate) $0\",\n-        kind: Snippet,\n-    },\n-]"}]}