{"sha": "260cfaba1259e8551aec02ef4b846900517be8e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2MGNmYWJhMTI1OWU4NTUxYWVjMDJlZjRiODQ2OTAwNTE3YmU4ZTU=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-03-25T07:02:27Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-03-26T08:40:52Z"}, "message": "Don't allow access to the Session.", "tree": {"sha": "3c107ff5aa506ee3bdd14f374a1e803c5d423ffb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c107ff5aa506ee3bdd14f374a1e803c5d423ffb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/260cfaba1259e8551aec02ef4b846900517be8e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/260cfaba1259e8551aec02ef4b846900517be8e5", "html_url": "https://github.com/rust-lang/rust/commit/260cfaba1259e8551aec02ef4b846900517be8e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/260cfaba1259e8551aec02ef4b846900517be8e5/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d224e214e051a92c5313a2d4ec0c94d41c4ba01d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d224e214e051a92c5313a2d4ec0c94d41c4ba01d", "html_url": "https://github.com/rust-lang/rust/commit/d224e214e051a92c5313a2d4ec0c94d41c4ba01d"}], "stats": {"total": 19, "additions": 9, "deletions": 10}, "files": [{"sha": "f61f333b6c91ea43cc87beb5e197b5c998b883e3", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/260cfaba1259e8551aec02ef4b846900517be8e5/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/260cfaba1259e8551aec02ef4b846900517be8e5/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=260cfaba1259e8551aec02ef4b846900517be8e5", "patch": "@@ -4047,7 +4047,6 @@ dependencies = [\n  \"rustc_errors\",\n  \"rustc_index\",\n  \"rustc_macros\",\n- \"rustc_session\",\n  \"rustc_span\",\n  \"serialize\",\n  \"smallvec 1.0.0\","}, {"sha": "c60fdd2f4fcf6dc3359ee8b800c3db3acbbec8cc", "filename": "src/librustc/ty/query/plumbing.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fplumbing.rs?ref=260cfaba1259e8551aec02ef4b846900517be8e5", "patch": "@@ -13,15 +13,17 @@ use rustc_data_structures::fx::FxHashMap;\n use rustc_data_structures::sync::Lock;\n use rustc_data_structures::thin_vec::ThinVec;\n use rustc_errors::{struct_span_err, Diagnostic, DiagnosticBuilder, Handler, Level};\n-use rustc_session::Session;\n use rustc_span::def_id::DefId;\n use rustc_span::Span;\n \n impl QueryContext for TyCtxt<'tcx> {\n     type Query = Query<'tcx>;\n \n-    fn session(&self) -> &Session {\n-        &self.sess\n+    fn incremental_verify_ich(&self) -> bool {\n+        self.sess.opts.debugging_opts.incremental_verify_ich\n+    }\n+    fn verbose(&self) -> bool {\n+        self.sess.verbose()\n     }\n \n     fn def_path_str(&self, def_id: DefId) -> String {"}, {"sha": "e1657a8f3c607e68e7d9574dd8a3fa814c46973f", "filename": "src/librustc_query_system/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2FCargo.toml?ref=260cfaba1259e8551aec02ef4b846900517be8e5", "patch": "@@ -17,7 +17,6 @@ rustc_errors = { path = \"../librustc_errors\" }\n rustc_index = { path = \"../librustc_index\" }\n rustc_macros = { path = \"../librustc_macros\" }\n rustc_serialize = { path = \"../libserialize\", package = \"serialize\" }\n-rustc_session = { path = \"../librustc_session\" }\n rustc_span = { path = \"../librustc_span\" }\n parking_lot = \"0.9\"\n smallvec = { version = \"1.0\", features = [\"union\", \"may_dangle\"] }"}, {"sha": "46a48a31161c74cefc07bbfd3cfe98be13e9f9c7", "filename": "src/librustc_query_system/query/config.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2Fquery%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2Fquery%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fquery%2Fconfig.rs?ref=260cfaba1259e8551aec02ef4b846900517be8e5", "patch": "@@ -15,7 +15,6 @@ use rustc_data_structures::stable_hasher::HashStable;\n use rustc_data_structures::sync::Lock;\n use rustc_data_structures::thin_vec::ThinVec;\n use rustc_errors::Diagnostic;\n-use rustc_session::Session;\n use std::borrow::Cow;\n use std::fmt::Debug;\n use std::hash::Hash;\n@@ -33,8 +32,8 @@ pub trait QueryConfig<CTX> {\n pub trait QueryContext: DepContext {\n     type Query: Clone + HashStable<Self::StableHashingContext>;\n \n-    /// Access the session.\n-    fn session(&self) -> &Session;\n+    fn incremental_verify_ich(&self) -> bool;\n+    fn verbose(&self) -> bool;\n \n     /// Get string representation from DefPath.\n     fn def_path_str(&self, def_id: DefId) -> String;\n@@ -101,7 +100,7 @@ where\n     M: QueryAccessors<CTX, Key = DefId>,\n {\n     default fn describe(tcx: CTX, def_id: DefId) -> Cow<'static, str> {\n-        if !tcx.session().verbose() {\n+        if !tcx.verbose() {\n             format!(\"processing `{}`\", tcx.def_path_str(def_id)).into()\n         } else {\n             let name = ::std::any::type_name::<M>();"}, {"sha": "97b680420394ff5b3f54d69886e2d07baab44b22", "filename": "src/librustc_query_system/query/plumbing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/260cfaba1259e8551aec02ef4b846900517be8e5/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2Fquery%2Fplumbing.rs?ref=260cfaba1259e8551aec02ef4b846900517be8e5", "patch": "@@ -514,7 +514,7 @@ where\n \n     // If `-Zincremental-verify-ich` is specified, re-hash results from\n     // the cache and make sure that they have the expected fingerprint.\n-    if unlikely!(tcx.session().opts.debugging_opts.incremental_verify_ich) {\n+    if unlikely!(tcx.incremental_verify_ich()) {\n         incremental_verify_ich::<Q, _>(tcx, &result, dep_node, dep_node_index);\n     }\n "}]}