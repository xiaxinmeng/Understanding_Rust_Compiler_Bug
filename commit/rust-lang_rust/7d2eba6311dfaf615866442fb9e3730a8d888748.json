{"sha": "7d2eba6311dfaf615866442fb9e3730a8d888748", "node_id": "C_kwDOAAsO6NoAKDdkMmViYTYzMTFkZmFmNjE1ODY2NDQyZmI5ZTM3MzBhOGQ4ODg3NDg", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-27T10:38:45Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-30T07:58:41Z"}, "message": "middle: translation in `LintDiagnosticBuilder`\n\nAccept `DiagnosticMessage` in `LintDiagnosticBuilder::build` so that\nlints can be built with translatable diagnostic messages.\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "c26fa6464b46c74a06543b383e5ce2684f57baf9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c26fa6464b46c74a06543b383e5ce2684f57baf9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d2eba6311dfaf615866442fb9e3730a8d888748", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d2eba6311dfaf615866442fb9e3730a8d888748", "html_url": "https://github.com/rust-lang/rust/commit/7d2eba6311dfaf615866442fb9e3730a8d888748", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d2eba6311dfaf615866442fb9e3730a8d888748/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9eb9c52f3e8d8b6402e6acc69b9bcfc4f371d58", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9eb9c52f3e8d8b6402e6acc69b9bcfc4f371d58", "html_url": "https://github.com/rust-lang/rust/commit/a9eb9c52f3e8d8b6402e6acc69b9bcfc4f371d58"}], "stats": {"total": 15, "additions": 8, "deletions": 7}, "files": [{"sha": "1ad33ef25b763af5f27d12a62a25fc3cafd9c963", "filename": "compiler/rustc_errors/src/diagnostic_builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic_builder.rs?ref=7d2eba6311dfaf615866442fb9e3730a8d888748", "patch": "@@ -529,7 +529,7 @@ impl<'a, G: EmissionGuarantee> DiagnosticBuilder<'a, G> {\n         applicability: Applicability,\n     ) -> &mut Self);\n \n-    forward!(pub fn set_primary_message(&mut self, msg: impl Into<String>) -> &mut Self);\n+    forward!(pub fn set_primary_message(&mut self, msg: impl Into<DiagnosticMessage>) -> &mut Self);\n     forward!(pub fn set_span(&mut self, sp: impl Into<MultiSpan>) -> &mut Self);\n     forward!(pub fn code(&mut self, s: DiagnosticId) -> &mut Self);\n     forward!(pub fn set_arg("}, {"sha": "bf4a726b061881b86cc44147f6581241cf343734", "filename": "compiler/rustc_lint/src/levels.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flevels.rs?ref=7d2eba6311dfaf615866442fb9e3730a8d888748", "patch": "@@ -521,7 +521,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                             src,\n                             Some(sp.into()),\n                             |lint| {\n-                                let mut err = lint.build(&msg);\n+                                let mut err = lint.build(msg);\n                                 if let Some(new_name) = &renamed {\n                                     err.span_suggestion(\n                                         sp,\n@@ -548,7 +548,7 @@ impl<'s> LintLevelsBuilder<'s> {\n                             } else {\n                                 name.to_string()\n                             };\n-                            let mut db = lint.build(&format!(\"unknown lint: `{}`\", name));\n+                            let mut db = lint.build(format!(\"unknown lint: `{}`\", name));\n                             if let Some(suggestion) = suggestion {\n                                 db.span_suggestion(\n                                     sp,"}, {"sha": "32c0a7e260569986291f7b9878cf62b499d14a60", "filename": "compiler/rustc_middle/src/lint.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_middle%2Fsrc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flint.rs?ref=7d2eba6311dfaf615866442fb9e3730a8d888748", "patch": "@@ -3,7 +3,8 @@ use std::cmp;\n use rustc_data_structures::fx::FxHashMap;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_errors::{\n-    Diagnostic, DiagnosticBuilder, DiagnosticId, EmissionGuarantee, ErrorGuaranteed, MultiSpan,\n+    Diagnostic, DiagnosticBuilder, DiagnosticId, DiagnosticMessage, EmissionGuarantee,\n+    ErrorGuaranteed, MultiSpan,\n };\n use rustc_hir::HirId;\n use rustc_index::vec::IndexVec;\n@@ -231,7 +232,7 @@ pub struct LintDiagnosticBuilder<'a, G: EmissionGuarantee>(DiagnosticBuilder<'a,\n \n impl<'a, G: EmissionGuarantee> LintDiagnosticBuilder<'a, G> {\n     /// Return the inner `DiagnosticBuilder`, first setting the primary message to `msg`.\n-    pub fn build(mut self, msg: &str) -> DiagnosticBuilder<'a, G> {\n+    pub fn build(mut self, msg: impl Into<DiagnosticMessage>) -> DiagnosticBuilder<'a, G> {\n         self.0.set_primary_message(msg);\n         self.0.set_is_lint();\n         self.0"}, {"sha": "f22f3f61a01f2f18314fb13ee8cab7bef8ef4a4b", "filename": "compiler/rustc_mir_build/src/thir/pattern/const_to_pat.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fconst_to_pat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fconst_to_pat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fconst_to_pat.rs?ref=7d2eba6311dfaf615866442fb9e3730a8d888748", "patch": "@@ -550,7 +550,7 @@ impl<'a, 'tcx> ConstToPat<'a, 'tcx> {\n                         id,\n                         span,\n                         |lint| {\n-                            lint.build(&msg).emit();\n+                            lint.build(msg).emit();\n                         },\n                     );\n                 }"}, {"sha": "8c123c052e5ac4aa941a7d79adfc6ed87218d53a", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d2eba6311dfaf615866442fb9e3730a8d888748/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=7d2eba6311dfaf615866442fb9e3730a8d888748", "patch": "@@ -1163,7 +1163,7 @@ impl CheckAttrVisitor<'_> {\n                         hir_id,\n                         meta.span(),\n                         |lint| {\n-                            lint.build(&\"invalid `doc` attribute\").emit();\n+                            lint.build(\"invalid `doc` attribute\").emit();\n                         },\n                     );\n                     is_valid = false;"}]}