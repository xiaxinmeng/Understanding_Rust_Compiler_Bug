{"sha": "fe533e862cd2d2d65e14970d327365dfe593aa27", "node_id": "C_kwDOAAsO6NoAKGZlNTMzZTg2MmNkMmQyZDY1ZTE0OTcwZDMyNzM2NWRmZTU5M2FhMjc", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@fb.com", "date": "2022-06-07T20:38:35Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@fb.com", "date": "2022-06-07T20:38:35Z"}, "message": "Specify DWARF alignment in bits, not bytes.\n\nIn DWARF, alignment of types is specified in bits, as is made clear by the\nparameter name `AlignInBits`. However, `rustc` was incorrectly passing a byte\nalignment. This commit fixes that.\n\nThis was noticed in upstream LLVM when I tried to check in a test consisting of\nLLVM IR generated from `rustc` and it triggered assertions [1].\n\n[1]: https://reviews.llvm.org/D126835", "tree": {"sha": "40e05dce398f01f339ea8445ae94a53d52d24286", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/40e05dce398f01f339ea8445ae94a53d52d24286"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe533e862cd2d2d65e14970d327365dfe593aa27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe533e862cd2d2d65e14970d327365dfe593aa27", "html_url": "https://github.com/rust-lang/rust/commit/fe533e862cd2d2d65e14970d327365dfe593aa27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe533e862cd2d2d65e14970d327365dfe593aa27/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "357bc27904d4a99c83d4b01272c34e0e54934fa5", "url": "https://api.github.com/repos/rust-lang/rust/commits/357bc27904d4a99c83d4b01272c34e0e54934fa5", "html_url": "https://github.com/rust-lang/rust/commit/357bc27904d4a99c83d4b01272c34e0e54934fa5"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "f5cbbc7ca919872c8bf160df1c25592eda96d742", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fe533e862cd2d2d65e14970d327365dfe593aa27/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe533e862cd2d2d65e14970d327365dfe593aa27/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=fe533e862cd2d2d65e14970d327365dfe593aa27", "patch": "@@ -1365,7 +1365,7 @@ pub fn build_global_var_di_node<'ll>(cx: &CodegenCx<'ll, '_>, def_id: DefId, glo\n             is_local_to_unit,\n             global,\n             None,\n-            global_align.bytes() as u32,\n+            global_align.bits() as u32,\n         );\n     }\n }"}, {"sha": "f6c1062e0fc6cee420a54df67690129bf5efb884", "filename": "src/test/codegen/debug-alignment.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fe533e862cd2d2d65e14970d327365dfe593aa27/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe533e862cd2d2d65e14970d327365dfe593aa27/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs?ref=fe533e862cd2d2d65e14970d327365dfe593aa27", "patch": "@@ -0,0 +1,8 @@\n+// Verifies that DWARF alignment is specified properly.\n+//\n+// compile-flags: -C debuginfo=2\n+#![crate_type = \"lib\"]\n+\n+// CHECK: !DIGlobalVariable\n+// CHECK: align: 32\n+pub static A: u32 = 1;"}]}