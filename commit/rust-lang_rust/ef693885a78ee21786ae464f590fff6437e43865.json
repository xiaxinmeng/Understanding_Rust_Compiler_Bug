{"sha": "ef693885a78ee21786ae464f590fff6437e43865", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmNjkzODg1YTc4ZWUyMTc4NmFlNDY0ZjU5MGZmZjY0MzdlNDM4NjU=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2014-10-03T14:16:05Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2014-10-03T14:16:05Z"}, "message": "Fix a race condition between remove_from_env and other io::process tests.", "tree": {"sha": "bd32e8b1a5a3f20e518c35a1df626f566344a691", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd32e8b1a5a3f20e518c35a1df626f566344a691"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef693885a78ee21786ae464f590fff6437e43865", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef693885a78ee21786ae464f590fff6437e43865", "html_url": "https://github.com/rust-lang/rust/commit/ef693885a78ee21786ae464f590fff6437e43865", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef693885a78ee21786ae464f590fff6437e43865/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9a2286d3a13c4a97340c99c86c718654f6cb2ed6", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a2286d3a13c4a97340c99c86c718654f6cb2ed6", "html_url": "https://github.com/rust-lang/rust/commit/9a2286d3a13c4a97340c99c86c718654f6cb2ed6"}], "stats": {"total": 79, "additions": 53, "deletions": 26}, "files": [{"sha": "8b7d1cd0de580d94dd165f303c70ed734932c83e", "filename": "src/libstd/io/process.rs", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ef693885a78ee21786ae464f590fff6437e43865/src%2Flibstd%2Fio%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef693885a78ee21786ae464f590fff6437e43865/src%2Flibstd%2Fio%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fprocess.rs?ref=ef693885a78ee21786ae464f590fff6437e43865", "patch": "@@ -1024,32 +1024,6 @@ mod tests {\n                 \"didn't find RUN_TEST_NEW_ENV inside of:\\n\\n{}\", output);\n     }\n \n-    #[test]\n-    fn test_remove_from_env() {\n-        use os;\n-\n-        // save original environment\n-        let old_env = os::getenv(\"RUN_TEST_NEW_ENV\");\n-\n-        os::setenv(\"RUN_TEST_NEW_ENV\", \"123\");\n-        let prog = env_cmd().env_remove(\"RUN_TEST_NEW_ENV\").spawn().unwrap();\n-        let result = prog.wait_with_output().unwrap();\n-        let output = str::from_utf8_lossy(result.output.as_slice()).into_string();\n-\n-        // restore original environment\n-        match old_env {\n-            None => {\n-                os::unsetenv(\"RUN_TEST_NEW_ENV\");\n-            }\n-            Some(val) => {\n-                os::setenv(\"RUN_TEST_NEW_ENV\", val.as_slice());\n-            }\n-        }\n-\n-        assert!(!output.as_slice().contains(\"RUN_TEST_NEW_ENV\"),\n-                \"found RUN_TEST_NEW_ENV inside of:\\n\\n{}\", output);\n-    }\n-\n     #[cfg(unix)]\n     pub fn sleeper() -> Process {\n         Command::new(\"sleep\").arg(\"1000\").spawn().unwrap()"}, {"sha": "eab9c8a95da2c20c8e28a654890a8bf19e9f51c6", "filename": "src/test/run-pass/process-remove-from-env.rs", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/ef693885a78ee21786ae464f590fff6437e43865/src%2Ftest%2Frun-pass%2Fprocess-remove-from-env.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef693885a78ee21786ae464f590fff6437e43865/src%2Ftest%2Frun-pass%2Fprocess-remove-from-env.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fprocess-remove-from-env.rs?ref=ef693885a78ee21786ae464f590fff6437e43865", "patch": "@@ -0,0 +1,53 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::io::Command;\n+use std::os;\n+\n+#[cfg(all(unix, not(target_os=\"android\")))]\n+pub fn env_cmd() -> Command {\n+    Command::new(\"env\")\n+}\n+#[cfg(target_os=\"android\")]\n+pub fn env_cmd() -> Command {\n+    let mut cmd = Command::new(\"/system/bin/sh\");\n+    cmd.arg(\"-c\").arg(\"set\");\n+    cmd\n+}\n+\n+#[cfg(windows)]\n+pub fn env_cmd() -> Command {\n+    let mut cmd = Command::new(\"cmd\");\n+    cmd.arg(\"/c\").arg(\"set\");\n+    cmd\n+}\n+\n+fn main() {\n+    // save original environment\n+    let old_env = os::getenv(\"RUN_TEST_NEW_ENV\");\n+\n+    os::setenv(\"RUN_TEST_NEW_ENV\", \"123\");\n+\n+    let mut cmd = env_cmd();\n+    cmd.env_remove(\"RUN_TEST_NEW_ENV\");\n+\n+    // restore original environment\n+    match old_env {\n+        None => os::unsetenv(\"RUN_TEST_NEW_ENV\"),\n+        Some(val) => os::setenv(\"RUN_TEST_NEW_ENV\", val.as_slice())\n+    }\n+\n+    let prog = cmd.spawn().unwrap();\n+    let result = prog.wait_with_output().unwrap();\n+    let output = String::from_utf8_lossy(result.output.as_slice());\n+\n+    assert!(!output.as_slice().contains(\"RUN_TEST_NEW_ENV\"),\n+            \"found RUN_TEST_NEW_ENV inside of:\\n\\n{}\", output);\n+}"}]}