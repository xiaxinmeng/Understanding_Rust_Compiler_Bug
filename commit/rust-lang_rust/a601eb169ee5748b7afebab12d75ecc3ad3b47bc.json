{"sha": "a601eb169ee5748b7afebab12d75ecc3ad3b47bc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2MDFlYjE2OWVlNTc0OGI3YWZlYmFiMTJkNzVlY2MzYWQzYjQ3YmM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-01T02:12:33Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-02T17:39:13Z"}, "message": "Run pretty-printed sources through the compiler again for sanity\n\nJust go as far as typechecking for speed sake.\n\nIssue #789", "tree": {"sha": "d13ec4a2bf4bc9ec97511e0e3f1f4dc564f442bd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d13ec4a2bf4bc9ec97511e0e3f1f4dc564f442bd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a601eb169ee5748b7afebab12d75ecc3ad3b47bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a601eb169ee5748b7afebab12d75ecc3ad3b47bc", "html_url": "https://github.com/rust-lang/rust/commit/a601eb169ee5748b7afebab12d75ecc3ad3b47bc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a601eb169ee5748b7afebab12d75ecc3ad3b47bc/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59691b084fd64c6e98c36f8c738abe4a6fe6f89e", "url": "https://api.github.com/repos/rust-lang/rust/commits/59691b084fd64c6e98c36f8c738abe4a6fe6f89e", "html_url": "https://github.com/rust-lang/rust/commit/59691b084fd64c6e98c36f8c738abe4a6fe6f89e"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "50f61575a916981319681ed64ae482ce0538117f", "filename": "src/test/compiletest/runtest.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a601eb169ee5748b7afebab12d75ecc3ad3b47bc/src%2Ftest%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a601eb169ee5748b7afebab12d75ecc3ad3b47bc/src%2Ftest%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompiletest%2Fruntest.rs?ref=a601eb169ee5748b7afebab12d75ecc3ad3b47bc", "patch": "@@ -100,7 +100,7 @@ fn run_pretty_test(cx: &cx, props: &test_props, testfile: &str) {\n     compare_source(expected, actual);\n \n     // Finally, let's make sure it actually appears to remain valid code\n-    let procres = typecheck_source(cx, actual);\n+    let procres = typecheck_source(cx, testfile, actual);\n \n     if procres.status != 0 {\n         fatal_procres(\"pretty-printed source does not typecheck\",\n@@ -139,9 +139,15 @@ actual:\\n\\\n         }\n     }\n \n-    fn typecheck_source(cx: &cx, src: &str) -> procres {\n-        // FIXME\n-        ret {status: 0, stdout: src, stderr: \"\", cmdline: \"\"};\n+    fn typecheck_source(cx: &cx, testfile: &str, src: &str) -> procres {\n+        compose_and_run(cx, testfile, make_typecheck_args,\n+                        cx.config.compile_lib_path, option::some(src))\n+    }\n+\n+    fn make_typecheck_args(config: &config, testfile: &str) -> procargs {\n+        let prog = config.rustc_path;\n+        let args = [\"-\", \"--no-trans\"];\n+        ret {prog: prog, args: args};\n     }\n }\n "}]}