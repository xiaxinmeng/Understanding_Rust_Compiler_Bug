{"sha": "23f01eddacccf4c9b871b0fd84d4344fd67bf668", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzZjAxZWRkYWNjY2Y0YzliODcxYjBmZDg0ZDQzNDRmZDY3YmY2Njg=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2016-10-13T22:38:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-10-13T22:38:39Z"}, "message": "Merge pull request #1188 from Rantanen/master\n\nAdd support for spaces_within_angle_brackets", "tree": {"sha": "4ca75f5ee43eb087bf84a9ef0c27e02c9e0555b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ca75f5ee43eb087bf84a9ef0c27e02c9e0555b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23f01eddacccf4c9b871b0fd84d4344fd67bf668", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23f01eddacccf4c9b871b0fd84d4344fd67bf668", "html_url": "https://github.com/rust-lang/rust/commit/23f01eddacccf4c9b871b0fd84d4344fd67bf668", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23f01eddacccf4c9b871b0fd84d4344fd67bf668/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "171d9178884fb8415afef5fe522b024ce9a78b38", "url": "https://api.github.com/repos/rust-lang/rust/commits/171d9178884fb8415afef5fe522b024ce9a78b38", "html_url": "https://github.com/rust-lang/rust/commit/171d9178884fb8415afef5fe522b024ce9a78b38"}, {"sha": "d68d43c0a5f9824458640d868ac96e760adaf40c", "url": "https://api.github.com/repos/rust-lang/rust/commits/d68d43c0a5f9824458640d868ac96e760adaf40c", "html_url": "https://github.com/rust-lang/rust/commit/d68d43c0a5f9824458640d868ac96e760adaf40c"}], "stats": {"total": 157, "additions": 152, "deletions": 5}, "files": [{"sha": "1220d43356e8ca49919259d2660444722b4569f9", "filename": "src/chains.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -416,7 +416,13 @@ fn rewrite_method_call(method_name: ast::Ident,\n             .map(|ty| ty.rewrite(context, width, offset))\n             .collect());\n \n-        (types.last().unwrap().span.hi, format!(\"::<{}>\", type_list.join(\", \")))\n+        let type_str = if context.config.spaces_within_angle_brackets && type_list.len() > 0 {\n+            format!(\"::< {} >\", type_list.join(\", \"))\n+        } else {\n+            format!(\"::<{}>\", type_list.join(\", \"))\n+        };\n+\n+        (types.last().unwrap().span.hi, type_str)\n     };\n \n     let callee_str = format!(\".{}{}\", method_name, type_str);"}, {"sha": "b02af269f04516fd27d32fe206adb41fb82e8c6b", "filename": "src/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -416,6 +416,7 @@ create_config! {\n     space_after_bound_colon: bool, true,\n         \"Leave a space after the colon in a trait or lifetime bound\";\n     spaces_around_ranges: bool, false, \"Put spaces around the  .. and ... range operators\";\n+    spaces_within_angle_brackets: bool, false, \"Put spaces within non-empty generic arguments\";\n     spaces_within_parens: bool, false, \"Put spaces within non-empty parentheses\";\n     use_try_shorthand: bool, false, \"Replace uses of the try! macro by the ? shorthand\";\n     write_mode: WriteMode, WriteMode::Replace,"}, {"sha": "c24dde55189fce2f2f7356d227295a3529541ada", "filename": "src/items.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -1800,7 +1800,11 @@ fn rewrite_generics(context: &RewriteContext,\n                              span.hi);\n     let list_str = try_opt!(format_item_list(items, h_budget, offset, context.config));\n \n-    Some(format!(\"<{}>\", list_str))\n+    Some(if context.config.spaces_within_angle_brackets {\n+        format!(\"< {} >\", list_str)\n+    } else {\n+        format!(\"<{}>\", list_str)\n+    })\n }\n \n fn rewrite_trait_bounds(context: &RewriteContext,"}, {"sha": "75be97cce56867434b018e598cdd7a925d7552f8", "filename": "src/types.rs", "status": "modified", "additions": 23, "deletions": 3, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -45,6 +45,10 @@ pub fn rewrite_path(context: &RewriteContext,\n \n     if let Some(qself) = qself {\n         result.push('<');\n+        if context.config.spaces_within_angle_brackets {\n+            result.push_str(\" \")\n+        }\n+\n         let fmt_ty = try_opt!(qself.ty.rewrite(context, width, offset));\n         result.push_str(&fmt_ty);\n \n@@ -68,6 +72,10 @@ pub fn rewrite_path(context: &RewriteContext,\n                                                     offset + extra_offset));\n         }\n \n+        if context.config.spaces_within_angle_brackets {\n+            result.push_str(\" \")\n+        }\n+\n         result.push_str(\">::\");\n         span_lo = qself.ty.span.hi + BytePos(1);\n     }\n@@ -212,7 +220,11 @@ fn rewrite_segment(expr_context: bool,\n             // Update position of last bracket.\n             *span_lo = next_span_lo;\n \n-            format!(\"{}<{}>\", separator, list_str)\n+            if context.config.spaces_within_angle_brackets && list_str.len() > 0 {\n+                format!(\"{}< {} >\", separator, list_str)\n+            } else {\n+                format!(\"{}<{}>\", separator, list_str)\n+            }\n         }\n         ast::PathParameters::Parenthesized(ref data) => {\n             let output = match data.output {\n@@ -350,7 +362,11 @@ impl Rewrite for ast::WherePredicate {\n                                                     .intersperse(Some(\" + \".to_string()))\n                                                     .collect());\n \n-                    format!(\"for<{}> {}: {}\", lifetime_str, type_str, bounds_str)\n+                    if context.config.spaces_within_angle_brackets && lifetime_str.len() > 0 {\n+                        format!(\"for< {} > {}: {}\", lifetime_str, type_str, bounds_str)\n+                    } else {\n+                        format!(\"for<{}> {}: {}\", lifetime_str, type_str, bounds_str)\n+                    }\n                 } else {\n                     // 2 = \": \".len()\n                     let used_width = type_str.len() + 2;\n@@ -513,7 +529,11 @@ impl Rewrite for ast::PolyTraitRef {\n             let path_str = try_opt!(self.trait_ref\n                 .rewrite(context, max_path_width, offset + extra_offset));\n \n-            Some(format!(\"for<{}> {}\", lifetime_str, path_str))\n+            Some(if context.config.spaces_within_angle_brackets && lifetime_str.len() > 0 {\n+                format!(\"for< {} > {}\", lifetime_str, path_str)\n+            } else {\n+                format!(\"for<{}> {}\", lifetime_str, path_str)\n+            })\n         } else {\n             self.trait_ref.rewrite(context, width, offset)\n         }"}, {"sha": "fc8dcda42937b885004f0607b0cca352f580bd2c", "filename": "tests/source/spaces-within-angle-brackets.rs", "status": "added", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/tests%2Fsource%2Fspaces-within-angle-brackets.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/tests%2Fsource%2Fspaces-within-angle-brackets.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fspaces-within-angle-brackets.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -0,0 +1,58 @@\n+// rustfmt-spaces_within_angle_brackets: true\n+\n+struct Foo<T> {\n+    i: T,\n+}\n+\n+struct Bar<T, E> {\n+    i: T,\n+    e: E,\n+}\n+\n+struct Foo<'a> {\n+    i: &'a str,\n+}\n+\n+enum E<T> {\n+    T(T),\n+}\n+\n+enum E<T, S> {\n+    T(T),\n+    S(S),\n+}\n+\n+fn foo<T>(a: T) {\n+    foo::<u32>(10);\n+}\n+\n+fn foo<T, E>(a: T, b: E) {\n+    foo::<u32, str>(10, \"bar\");\n+}\n+\n+fn foo<T: Send, E: Send>(a: T, b: E) {\n+\n+    foo::<u32, str>(10, \"bar\");\n+\n+    let opt: Option<u32>;\n+    let res: Result<u32, String>;\n+}\n+\n+fn foo<'a>(a: &'a str) {\n+    foo(\"foo\");\n+}\n+\n+fn foo<'a, 'b>(a: &'a str, b: &'b str) {\n+    foo(\"foo\", \"bar\");\n+}\n+\n+impl Foo {\n+    fn bar() {\n+        <Foo as Foo>::bar();\n+    }\n+}\n+\n+trait MyTrait<A, D> {}\n+impl<A: Send, D: Send> MyTrait<A, D> for Foo {}\n+\n+fn foo() where for<'a> u32: 'a {}"}, {"sha": "bc662487369f0f46b6333c6fde903d9d32454673", "filename": "tests/target/spaces-within-angle-brackets.rs", "status": "added", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/23f01eddacccf4c9b871b0fd84d4344fd67bf668/tests%2Ftarget%2Fspaces-within-angle-brackets.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23f01eddacccf4c9b871b0fd84d4344fd67bf668/tests%2Ftarget%2Fspaces-within-angle-brackets.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fspaces-within-angle-brackets.rs?ref=23f01eddacccf4c9b871b0fd84d4344fd67bf668", "patch": "@@ -0,0 +1,58 @@\n+// rustfmt-spaces_within_angle_brackets: true\n+\n+struct Foo< T > {\n+    i: T,\n+}\n+\n+struct Bar< T, E > {\n+    i: T,\n+    e: E,\n+}\n+\n+struct Foo< 'a > {\n+    i: &'a str,\n+}\n+\n+enum E< T > {\n+    T(T),\n+}\n+\n+enum E< T, S > {\n+    T(T),\n+    S(S),\n+}\n+\n+fn foo< T >(a: T) {\n+    foo::< u32 >(10);\n+}\n+\n+fn foo< T, E >(a: T, b: E) {\n+    foo::< u32, str >(10, \"bar\");\n+}\n+\n+fn foo< T: Send, E: Send >(a: T, b: E) {\n+\n+    foo::< u32, str >(10, \"bar\");\n+\n+    let opt: Option< u32 >;\n+    let res: Result< u32, String >;\n+}\n+\n+fn foo< 'a >(a: &'a str) {\n+    foo(\"foo\");\n+}\n+\n+fn foo< 'a, 'b >(a: &'a str, b: &'b str) {\n+    foo(\"foo\", \"bar\");\n+}\n+\n+impl Foo {\n+    fn bar() {\n+        < Foo as Foo >::bar();\n+    }\n+}\n+\n+trait MyTrait< A, D > {}\n+impl< A: Send, D: Send > MyTrait< A, D > for Foo {}\n+\n+fn foo() where for< 'a > u32: 'a {}"}]}