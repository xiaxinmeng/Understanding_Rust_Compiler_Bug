{"sha": "bd6409ddef6ae0be42e91c8c36ddbce984311773", "node_id": "C_kwDOAAsO6NoAKGJkNjQwOWRkZWY2YWUwYmU0MmU5MWM4YzM2ZGRiY2U5ODQzMTE3NzM", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-05-27T23:05:32Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-06-07T14:24:14Z"}, "message": "Simplify handling of `initial_rustfmt`", "tree": {"sha": "045f2c840c023d95a2cb217e35950d602f385701", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/045f2c840c023d95a2cb217e35950d602f385701"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd6409ddef6ae0be42e91c8c36ddbce984311773", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd6409ddef6ae0be42e91c8c36ddbce984311773", "html_url": "https://github.com/rust-lang/rust/commit/bd6409ddef6ae0be42e91c8c36ddbce984311773", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd6409ddef6ae0be42e91c8c36ddbce984311773/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "27b95016d45cd1c0dcaef014373d4bb04d5d30ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/27b95016d45cd1c0dcaef014373d4bb04d5d30ef", "html_url": "https://github.com/rust-lang/rust/commit/27b95016d45cd1c0dcaef014373d4bb04d5d30ef"}], "stats": {"total": 18, "additions": 5, "deletions": 13}, "files": [{"sha": "2a6b54ce0557719eb119cfb114caf995e101f779", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/bd6409ddef6ae0be42e91c8c36ddbce984311773/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd6409ddef6ae0be42e91c8c36ddbce984311773/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=bd6409ddef6ae0be42e91c8c36ddbce984311773", "patch": "@@ -859,9 +859,6 @@ impl Config {\n         set(&mut config.full_bootstrap, build.full_bootstrap);\n         set(&mut config.extended, build.extended);\n         config.tools = build.tools;\n-        if build.rustfmt.is_some() {\n-            config.initial_rustfmt = build.rustfmt;\n-        }\n         set(&mut config.verbose, build.verbose);\n         set(&mut config.sanitizers, build.sanitizers);\n         set(&mut config.profiler, build.profiler);\n@@ -1154,17 +1151,12 @@ impl Config {\n             set(&mut config.missing_tools, t.missing_tools);\n         }\n \n-        config.initial_rustfmt = config.initial_rustfmt.or_else({\n-            let build = config.build;\n-            let initial_rustc = &config.initial_rustc;\n-\n-            move || {\n-                // Cargo does not provide a RUSTFMT environment variable, so we\n-                // synthesize it manually.\n-                let rustfmt = initial_rustc.with_file_name(exe(\"rustfmt\", build));\n+        config.initial_rustfmt = build.rustfmt.or_else(|| {\n+            // Cargo does not provide a RUSTFMT environment variable, so we\n+            // synthesize it manually.\n+            let rustfmt = config.initial_rustc.with_file_name(exe(\"rustfmt\", config.build));\n \n-                if rustfmt.exists() { Some(rustfmt) } else { None }\n-            }\n+            if rustfmt.exists() { Some(rustfmt) } else { None }\n         });\n \n         // Now that we've reached the end of our configuration, infer the"}]}