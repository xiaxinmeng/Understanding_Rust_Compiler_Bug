{"sha": "fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiOGExOTAzY2YwZWQ2YjQ5MjZmZjZmMDllMGNkYmE1ZDg1YTIwZDc=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2016-09-18T20:49:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-18T20:49:38Z"}, "message": "Merge pull request #1161 from sinkuu/fix550\n\nFix #550: `if` nested in tuple is indented oddly", "tree": {"sha": "02ffa2b85477c9da927d4275ede6d42212e51a0d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/02ffa2b85477c9da927d4275ede6d42212e51a0d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "html_url": "https://github.com/rust-lang/rust/commit/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d0e8322d7f9e53e4b4633166e83520ff2c121b35", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0e8322d7f9e53e4b4633166e83520ff2c121b35", "html_url": "https://github.com/rust-lang/rust/commit/d0e8322d7f9e53e4b4633166e83520ff2c121b35"}, {"sha": "079f39d07fd75e625a56c8a417bdc946cac389a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/079f39d07fd75e625a56c8a417bdc946cac389a6", "html_url": "https://github.com/rust-lang/rust/commit/079f39d07fd75e625a56c8a417bdc946cac389a6"}], "stats": {"total": 61, "additions": 55, "deletions": 6}, "files": [{"sha": "4ced667ef78a20409be0503412ceae7cbd63a622", "filename": "src/comment.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "patch": "@@ -435,10 +435,10 @@ impl<'a> Iterator for UngroupedCommentCodeSlices<'a> {\n             None => &self.slice[start_idx..],\n         };\n         Some((if kind.is_comment() {\n-            CodeCharKind::Comment\n-        } else {\n-            CodeCharKind::Normal\n-        },\n+                  CodeCharKind::Comment\n+              } else {\n+                  CodeCharKind::Normal\n+              },\n               start_idx,\n               slice))\n     }"}, {"sha": "58e2c732bc820e1e8d71d0e01caafb4ed7c58528", "filename": "src/expr.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "patch": "@@ -1732,11 +1732,16 @@ pub fn rewrite_tuple<'a, I>(context: &RewriteContext,\n           <I::Item as Deref>::Target: Rewrite + Spanned + 'a\n {\n     let indent = offset + 1;\n+    let aligned = RewriteContext { block_indent: indent, ..context.clone() };\n+\n     // In case of length 1, need a trailing comma\n     if items.len() == 1 {\n         // 3 = \"(\" + \",)\"\n         let budget = try_opt!(width.checked_sub(3));\n-        return items.next().unwrap().rewrite(context, budget, indent).map(|s| format!(\"({},)\", s));\n+        return items.next()\n+            .unwrap()\n+            .rewrite(&aligned, budget, indent)\n+            .map(|s| format!(\"({},)\", s));\n     }\n \n     let list_lo = context.codemap.span_after(span, \"(\");\n@@ -1749,7 +1754,7 @@ pub fn rewrite_tuple<'a, I>(context: &RewriteContext,\n                                  let inner_width = try_opt!(context.config\n                                      .max_width\n                                      .checked_sub(indent.width() + 1));\n-                                 item.rewrite(context, inner_width, indent)\n+                                 item.rewrite(&aligned, inner_width, indent)\n                              },\n                              list_lo,\n                              span.hi - BytePos(1));"}, {"sha": "b28e83d2f082a2e8b4f21d3350ba16a18b805460", "filename": "tests/source/tuple.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/tests%2Fsource%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/tests%2Fsource%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Ftuple.rs?ref=fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "patch": "@@ -0,0 +1,34 @@\n+// Test tuple litterals\n+\n+fn foo() {\n+    let a = (a, a, a, a, a);\n+    let aaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, aaaaaaaaaaaaaa, aaaaaaaaaaaaaa);\n+    let aaaaaaaaaaaaaaaaaaaaaa = (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaaaaaaaaaaaaaaaaaaaaaaa,\n+                                  aaaa);\n+    let a = (a,);\n+\n+    let b = (// This is a comment\n+             b, // Comment\n+             b /* Trailing comment */);\n+}\n+\n+fn a() {\n+    ((aaaaaaaa,\n+      aaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa),)\n+}\n+\n+fn b() {\n+    ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n+     bbbbbbbbbbbbbbbbbb)\n+}\n+\n+fn issue550() {\n+    self.visitor.visit_volume(self.level.sector_id(sector), (floor_y,\n+    if is_sky_flat(ceil_tex) {from_wad_height(self.height_range.1)} else {ceil_y}));\n+}"}, {"sha": "2d1d0b808d78f0f1bc14970b81d776007da939f9", "filename": "tests/target/tuple.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/tests%2Ftarget%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7/tests%2Ftarget%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftuple.rs?ref=fb8a1903cf0ed6b4926ff6f09e0cdba5d85a20d7", "patch": "@@ -27,3 +27,13 @@ fn b() {\n     ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n      bbbbbbbbbbbbbbbbbb)\n }\n+\n+fn issue550() {\n+    self.visitor.visit_volume(self.level.sector_id(sector),\n+                              (floor_y,\n+                               if is_sky_flat(ceil_tex) {\n+                                   from_wad_height(self.height_range.1)\n+                               } else {\n+                                   ceil_y\n+                               }));\n+}"}]}