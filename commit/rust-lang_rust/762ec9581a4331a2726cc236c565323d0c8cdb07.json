{"sha": "762ec9581a4331a2726cc236c565323d0c8cdb07", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2MmVjOTU4MWE0MzMxYTI3MjZjYzIzNmM1NjUzMjNkMGM4Y2RiMDc=", "commit": {"author": {"name": "Fedor Sakharov", "email": "fedor.sakharov@gmail.com", "date": "2020-05-11T09:25:18Z"}, "committer": {"name": "Fedor Sakharov", "email": "fedor.sakharov@gmail.com", "date": "2020-05-11T09:25:18Z"}, "message": "Find references to a function outside module", "tree": {"sha": "87dc0f219d4bf26ff5298247fc5f1247c6b89ac9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87dc0f219d4bf26ff5298247fc5f1247c6b89ac9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/762ec9581a4331a2726cc236c565323d0c8cdb07", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEOrvX5g4uaJk/ZAnkk9Q25ma/D+4FAl65Gf4ACgkQk9Q25ma/\nD+5LOwv/SCO58Ofn0ccqmNAEwoL+iBvOxkMjf3ZHHI5MZZgmjWmF6A+gGVgAB1id\nq2UOc4IiCwPJEx9JdOmVrfJ5aAkhjJhzyCT8y7FYiRUiZFw5Mz2gmaP2QFSz3MlU\ne9UrV1eBup6eQGYY+11bKQE1Y4pMsDd96NLCpX8Pj2csyAAKOic59RH5RHPFhxWw\nxH1l5VEl9tvrZ2SGhsdc8GcJSE5Am3LxWkmUM765Ya857ndIRKhG9hw5Jqnx9iDP\nvZo4SUa1kxgWs1wn4Xy4PfiHCjogPHlhGPkDqgCtkd/2MZtErIc0dH9uSVcxNKfb\nZJSfXm9FuME5LhjGW3mmnhhkkPEDA0NFDSV96ivyPrvy6dcWLMvyfeur1nvtSlmC\nDs8ejMdsO9q5yAIBlSHcE59+B8mJ/R4oRgNMwU7+yHTFwt33PqRavCAZksXdLQGA\n5vaG+OAO7M1wFregj4LoN6Db41N9GLavKYuzafUXV8ETQG5M9TB8B/UI04XRl4bL\nrZKNAKus\n=ef14\n-----END PGP SIGNATURE-----", "payload": "tree 87dc0f219d4bf26ff5298247fc5f1247c6b89ac9\nparent 4578154b608fa075595103d0c933da60d55b25c8\nauthor Fedor Sakharov <fedor.sakharov@gmail.com> 1589189118 +0300\ncommitter Fedor Sakharov <fedor.sakharov@gmail.com> 1589189118 +0300\n\nFind references to a function outside module\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/762ec9581a4331a2726cc236c565323d0c8cdb07", "html_url": "https://github.com/rust-lang/rust/commit/762ec9581a4331a2726cc236c565323d0c8cdb07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/762ec9581a4331a2726cc236c565323d0c8cdb07/comments", "author": {"login": "montekki", "id": 56672, "node_id": "MDQ6VXNlcjU2Njcy", "avatar_url": "https://avatars.githubusercontent.com/u/56672?v=4", "gravatar_id": "", "url": "https://api.github.com/users/montekki", "html_url": "https://github.com/montekki", "followers_url": "https://api.github.com/users/montekki/followers", "following_url": "https://api.github.com/users/montekki/following{/other_user}", "gists_url": "https://api.github.com/users/montekki/gists{/gist_id}", "starred_url": "https://api.github.com/users/montekki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/montekki/subscriptions", "organizations_url": "https://api.github.com/users/montekki/orgs", "repos_url": "https://api.github.com/users/montekki/repos", "events_url": "https://api.github.com/users/montekki/events{/privacy}", "received_events_url": "https://api.github.com/users/montekki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "montekki", "id": 56672, "node_id": "MDQ6VXNlcjU2Njcy", "avatar_url": "https://avatars.githubusercontent.com/u/56672?v=4", "gravatar_id": "", "url": "https://api.github.com/users/montekki", "html_url": "https://github.com/montekki", "followers_url": "https://api.github.com/users/montekki/followers", "following_url": "https://api.github.com/users/montekki/following{/other_user}", "gists_url": "https://api.github.com/users/montekki/gists{/gist_id}", "starred_url": "https://api.github.com/users/montekki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/montekki/subscriptions", "organizations_url": "https://api.github.com/users/montekki/orgs", "repos_url": "https://api.github.com/users/montekki/repos", "events_url": "https://api.github.com/users/montekki/events{/privacy}", "received_events_url": "https://api.github.com/users/montekki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4578154b608fa075595103d0c933da60d55b25c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/4578154b608fa075595103d0c933da60d55b25c8", "html_url": "https://github.com/rust-lang/rust/commit/4578154b608fa075595103d0c933da60d55b25c8"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "074284b42e28d5a422540944e83e9bc40c4e1b5f", "filename": "crates/ra_ide/src/references.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/762ec9581a4331a2726cc236c565323d0c8cdb07/crates%2Fra_ide%2Fsrc%2Freferences.rs", "raw_url": "https://github.com/rust-lang/rust/raw/762ec9581a4331a2726cc236c565323d0c8cdb07/crates%2Fra_ide%2Fsrc%2Freferences.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences.rs?ref=762ec9581a4331a2726cc236c565323d0c8cdb07", "patch": "@@ -593,6 +593,31 @@ mod tests {\n         check_result(refs, \"i BIND_PAT FileId(1) 36..37 Other\", &[\"FileId(1) 51..52 Other Write\"]);\n     }\n \n+    #[test]\n+    fn test_find_struct_function_refs_outside_module() {\n+        let code = r#\"\n+        mod foo {\n+            pub struct Foo;\n+\n+            impl Foo {\n+                pub fn new<|>() -> Foo {\n+                    Foo\n+                }\n+            }\n+        }\n+\n+        fn main() {\n+            let _f = foo::Foo::new();\n+        }\"#;\n+\n+        let refs = get_all_refs(code);\n+        check_result(\n+            refs,\n+            \"new FN_DEF FileId(1) 87..150 94..97 Other\",\n+            &[\"FileId(1) 227..230 StructLiteral\"],\n+        );\n+    }\n+\n     fn get_all_refs(text: &str) -> ReferenceSearchResult {\n         let (analysis, position) = single_file_with_position(text);\n         analysis.find_all_refs(position, None).unwrap().unwrap()"}, {"sha": "c74daff383f25ec35d39df283209c7625a5a5137", "filename": "crates/ra_ide_db/src/defs.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/762ec9581a4331a2726cc236c565323d0c8cdb07/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/762ec9581a4331a2726cc236c565323d0c8cdb07/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs?ref=762ec9581a4331a2726cc236c565323d0c8cdb07", "patch": "@@ -52,6 +52,7 @@ impl Definition {\n                     let parent = id.parent_enum(db);\n                     module?.visibility_of(db, &ModuleDef::Adt(Adt::Enum(parent)))\n                 }\n+                ModuleDef::Function(f) => Some(f.visibility(db)),\n                 _ => module?.visibility_of(db, def),\n             },\n             Definition::SelfType(_) => None,"}]}