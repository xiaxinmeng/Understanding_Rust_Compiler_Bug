{"sha": "3d65c7ff849bea9cd44fc652396d50486396f867", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkNjVjN2ZmODQ5YmVhOWNkNDRmYzY1MjM5NmQ1MDQ4NjM5NmY4Njc=", "commit": {"author": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2015-07-14T17:08:08Z"}, "committer": {"name": "Bj\u00f6rn Steinbrink", "email": "bsteinbr@gmail.com", "date": "2015-07-20T13:45:11Z"}, "message": "Create proper debuginfo for closure variables\n\nVariables for closures hold a tuple of captured variables, and not the\nfunction itself.\n\nFixes #26484", "tree": {"sha": "ec6ddd6ce23278c91a5b1f83ba3d1f5c49a818ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec6ddd6ce23278c91a5b1f83ba3d1f5c49a818ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d65c7ff849bea9cd44fc652396d50486396f867", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d65c7ff849bea9cd44fc652396d50486396f867", "html_url": "https://github.com/rust-lang/rust/commit/3d65c7ff849bea9cd44fc652396d50486396f867", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d65c7ff849bea9cd44fc652396d50486396f867/comments", "author": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9175a16bd8c5b37c485dfe36fea8f9df96e02bf0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9175a16bd8c5b37c485dfe36fea8f9df96e02bf0", "html_url": "https://github.com/rust-lang/rust/commit/9175a16bd8c5b37c485dfe36fea8f9df96e02bf0"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "5f17197a4b9a746fed0458a0ee19c180067966c3", "filename": "src/librustc_trans/trans/debuginfo/metadata.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo%2Fmetadata.rs?ref=3d65c7ff849bea9cd44fc652396d50486396f867", "patch": "@@ -813,8 +813,14 @@ pub fn type_metadata<'a, 'tcx>(cx: &CrateContext<'a, 'tcx>,\n         }\n         ty::TyClosure(def_id, substs) => {\n             let infcx = infer::normalizing_infer_ctxt(cx.tcx(), &cx.tcx().tables);\n-            let sig = infcx.closure_type(def_id, substs).sig;\n-            subroutine_type_metadata(cx, unique_type_id, &sig, usage_site_span)\n+            let upvars = infcx.closure_upvars(def_id, substs).unwrap();\n+            let upvar_types = upvars.iter().map(|u| u.ty).collect::<Vec<_>>();\n+\n+            prepare_tuple_metadata(cx,\n+                                   t,\n+                                   &upvar_types[..],\n+                                   unique_type_id,\n+                                   usage_site_span).finalize(cx)\n         }\n         ty::TyStruct(def_id, substs) => {\n             prepare_struct_metadata(cx,"}, {"sha": "2468150a6a5b16f599cca70e4f497df4efe63d69", "filename": "src/test/debuginfo/basic-types-metadata.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Ftest%2Fdebuginfo%2Fbasic-types-metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Ftest%2Fdebuginfo%2Fbasic-types-metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fbasic-types-metadata.rs?ref=3d65c7ff849bea9cd44fc652396d50486396f867", "patch": "@@ -43,7 +43,7 @@\n // gdb-command:whatis f64\n // gdb-check:type = f64\n // gdb-command:whatis fnptr\n-// gdb-check:type = void (*)(void)\n+// gdb-check:type = [...] (*)([...])\n // gdb-command:info functions _yyy\n // gdb-check:[...]![...]_yyy([...]);\n // gdb-command:continue"}, {"sha": "d3e6fc85f136fcd1f0c922a45f23f8781b40de0e", "filename": "src/test/run-pass/issue-26484.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Ftest%2Frun-pass%2Fissue-26484.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d65c7ff849bea9cd44fc652396d50486396f867/src%2Ftest%2Frun-pass%2Fissue-26484.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-26484.rs?ref=3d65c7ff849bea9cd44fc652396d50486396f867", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags:-g\n+\n+fn helper<F: FnOnce(usize) -> bool>(_f: F) {\n+    print!(\"\");\n+}\n+\n+fn main() {\n+    let cond = 0;\n+    helper(|v| v == cond)\n+}"}]}