{"sha": "d9d69212c3d1dca7e8975d5163f09289db4a7420", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5ZDY5MjEyYzNkMWRjYTdlODk3NWQ1MTYzZjA5Mjg5ZGI0YTc0MjA=", "commit": {"author": {"name": "Henry Boisdequin", "email": "65845077+henryboisdequin@users.noreply.github.com", "date": "2021-03-03T11:20:07Z"}, "committer": {"name": "Henry Boisdequin", "email": "65845077+henryboisdequin@users.noreply.github.com", "date": "2021-03-03T11:20:07Z"}, "message": "Fix diagnostic suggests adding type `[type error]`\n\nFixes #79040\n\nUnresolved questions:\n\nWhy does this change output the diagnostic twice?\n\nWhy does the CI fail when the errors are pointed out (UI tests)?", "tree": {"sha": "17ad4f3500a1f22343754bb744ce22b8a38bd911", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/17ad4f3500a1f22343754bb744ce22b8a38bd911"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d9d69212c3d1dca7e8975d5163f09289db4a7420", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d9d69212c3d1dca7e8975d5163f09289db4a7420", "html_url": "https://github.com/rust-lang/rust/commit/d9d69212c3d1dca7e8975d5163f09289db4a7420", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d9d69212c3d1dca7e8975d5163f09289db4a7420/comments", "author": {"login": "henryboisdequin", "id": 65845077, "node_id": "MDQ6VXNlcjY1ODQ1MDc3", "avatar_url": "https://avatars.githubusercontent.com/u/65845077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/henryboisdequin", "html_url": "https://github.com/henryboisdequin", "followers_url": "https://api.github.com/users/henryboisdequin/followers", "following_url": "https://api.github.com/users/henryboisdequin/following{/other_user}", "gists_url": "https://api.github.com/users/henryboisdequin/gists{/gist_id}", "starred_url": "https://api.github.com/users/henryboisdequin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/henryboisdequin/subscriptions", "organizations_url": "https://api.github.com/users/henryboisdequin/orgs", "repos_url": "https://api.github.com/users/henryboisdequin/repos", "events_url": "https://api.github.com/users/henryboisdequin/events{/privacy}", "received_events_url": "https://api.github.com/users/henryboisdequin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "henryboisdequin", "id": 65845077, "node_id": "MDQ6VXNlcjY1ODQ1MDc3", "avatar_url": "https://avatars.githubusercontent.com/u/65845077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/henryboisdequin", "html_url": "https://github.com/henryboisdequin", "followers_url": "https://api.github.com/users/henryboisdequin/followers", "following_url": "https://api.github.com/users/henryboisdequin/following{/other_user}", "gists_url": "https://api.github.com/users/henryboisdequin/gists{/gist_id}", "starred_url": "https://api.github.com/users/henryboisdequin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/henryboisdequin/subscriptions", "organizations_url": "https://api.github.com/users/henryboisdequin/orgs", "repos_url": "https://api.github.com/users/henryboisdequin/repos", "events_url": "https://api.github.com/users/henryboisdequin/events{/privacy}", "received_events_url": "https://api.github.com/users/henryboisdequin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1279b3b9232e4c44112d98f19cfa8846776d1fe8", "url": "https://api.github.com/repos/rust-lang/rust/commits/1279b3b9232e4c44112d98f19cfa8846776d1fe8", "html_url": "https://github.com/rust-lang/rust/commit/1279b3b9232e4c44112d98f19cfa8846776d1fe8"}], "stats": {"total": 48, "additions": 27, "deletions": 21}, "files": [{"sha": "92e2b5232027bcc2791793df21f50adf61a093e1", "filename": "compiler/rustc_typeck/src/collect/type_of.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d9d69212c3d1dca7e8975d5163f09289db4a7420/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9d69212c3d1dca7e8975d5163f09289db4a7420/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect%2Ftype_of.rs?ref=d9d69212c3d1dca7e8975d5163f09289db4a7420", "patch": "@@ -659,7 +659,7 @@ fn infer_placeholder_type(\n                 format!(\"{}: {}\", item_ident, ty),\n                 Applicability::MachineApplicable,\n             )\n-            .emit();\n+            .emit_unless(matches!(ty.kind(), ty::Error(_)));\n         }\n         None => {\n             let mut diag = bad_placeholder_type(tcx, vec![span]);"}, {"sha": "adc9dc8b42656363b52467c589445fa2f9286676", "filename": "src/test/ui/79040.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2F79040.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2F79040.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2F79040.rs?ref=d9d69212c3d1dca7e8975d5163f09289db4a7420", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    const FOO = \"hello\" + 1;\n+    //^~ ERROR cannot add `{integer}` to `&str`\n+    println!(\"{}\", FOO);\n+}\n\\ No newline at end of file"}, {"sha": "be7d2363c2d52be350af104ff94047cfbd9d8f67", "filename": "src/test/ui/79040.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2F79040.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2F79040.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2F79040.stderr?ref=d9d69212c3d1dca7e8975d5163f09289db4a7420", "patch": "@@ -0,0 +1,19 @@\n+error[E0369]: cannot add `{integer}` to `&str`\n+  --> $DIR/79040.rs:2:25\n+   |\n+LL |     const FOO = \"hello\" + 1;\n+   |                 ------- ^ - {integer}\n+   |                 |\n+   |                 &str\n+\n+error[E0369]: cannot add `{integer}` to `&str`\n+  --> $DIR/79040.rs:2:25\n+   |\n+LL |     const FOO = \"hello\" + 1;\n+   |                 ------- ^ - {integer}\n+   |                 |\n+   |                 &str\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0369`."}, {"sha": "aa75e5cee01d4985a3a0ae9ea5bad60cf114f5e8", "filename": "src/test/ui/parser/item-free-const-no-body-semantic-fail.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2Fparser%2Fitem-free-const-no-body-semantic-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2Fparser%2Fitem-free-const-no-body-semantic-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fitem-free-const-no-body-semantic-fail.stderr?ref=d9d69212c3d1dca7e8975d5163f09289db4a7420", "patch": "@@ -14,11 +14,5 @@ LL | const B;\n    |        |\n    |        help: provide a definition for the constant: `= <expr>;`\n \n-error: missing type for `const` item\n-  --> $DIR/item-free-const-no-body-semantic-fail.rs:6:7\n-   |\n-LL | const B;\n-   |       ^ help: provide a type for the item: `B: [type error]`\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n "}, {"sha": "2a270c8290fd4decd3e9770dfe40136e25c8684f", "filename": "src/test/ui/parser/item-free-static-no-body-semantic-fail.stderr", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2Fparser%2Fitem-free-static-no-body-semantic-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d9d69212c3d1dca7e8975d5163f09289db4a7420/src%2Ftest%2Fui%2Fparser%2Fitem-free-static-no-body-semantic-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fitem-free-static-no-body-semantic-fail.stderr?ref=d9d69212c3d1dca7e8975d5163f09289db4a7420", "patch": "@@ -30,17 +30,5 @@ LL | static mut D;\n    |             |\n    |             help: provide a definition for the static: `= <expr>;`\n \n-error: missing type for `static` item\n-  --> $DIR/item-free-static-no-body-semantic-fail.rs:6:8\n-   |\n-LL | static B;\n-   |        ^ help: provide a type for the item: `B: [type error]`\n-\n-error: missing type for `static mut` item\n-  --> $DIR/item-free-static-no-body-semantic-fail.rs:10:12\n-   |\n-LL | static mut D;\n-   |            ^ help: provide a type for the item: `D: [type error]`\n-\n-error: aborting due to 6 previous errors\n+error: aborting due to 4 previous errors\n "}]}