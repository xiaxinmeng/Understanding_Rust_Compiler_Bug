{"sha": "c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4YTczZmU2NTVmN2JmOTc3OGRlZWVjNGM4YjRiNTQxZTBhZjM5OGI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-12-21T16:57:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-21T16:57:49Z"}, "message": "Merge #6982\n\n6982: Remove parentheses when inverting `!(cond)` r=matklad a=Jesse-Bakker\n\nFollowup to #6894\r\n\r\nWhen inverting a composite condition twice, the parentheses were left. This also removes those unnecessary parentheses when applying the invert-if assist.\n\nCo-authored-by: Jesse Bakker <github@jessebakker.com>", "tree": {"sha": "f6f9a11b950e001505a3c711f59d34620a037684", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6f9a11b950e001505a3c711f59d34620a037684"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf4NQNCRBK7hj4Ov3rIwAAdHIIAGJigmcHxD0b8BQ2dv8Xyw2s\nuGrZ8W/8abB2nAnG6+WHhXtB3mwekm4/Ta+KTHZinsJ2orIj8SHv208k/w0XWfnc\nDaSj9Ranss+LQkea9V9fkaUEAKwXj1wmkpYh0MJZk0p3vqBNu1ztt4bNjJmHgMsM\nb6n2hn60kFChMqMgcOW82QD9XKDRqPpJyy0G0iX5w4gHlvSZs2RJn+ahog7p6anT\nPw272Ae3wIPIfEStyvinACdKx+dlS+NXdmZIoXWcBylFczOHcMgNYnujM7poHkz5\n75/5Jkvw1+G6Me9IyDUkvgRIpyAhqoYby3/FDryRR7w/OQ42yEQ72FqltXPZsWs=\n=HWBW\n-----END PGP SIGNATURE-----\n", "payload": "tree f6f9a11b950e001505a3c711f59d34620a037684\nparent 71c8073aa1e2cd3101a031a4f10e460013d4df74\nparent 2e7abf83844ef0c7d807262a682941f2aef9d3d9\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1608569869 +0000\ncommitter GitHub <noreply@github.com> 1608569869 +0000\n\nMerge #6982\n\n6982: Remove parentheses when inverting `!(cond)` r=matklad a=Jesse-Bakker\n\nFollowup to #6894\r\n\r\nWhen inverting a composite condition twice, the parentheses were left. This also removes those unnecessary parentheses when applying the invert-if assist.\n\nCo-authored-by: Jesse Bakker <github@jessebakker.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "html_url": "https://github.com/rust-lang/rust/commit/c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8a73fe655f7bf9778deeec4c8b4b541e0af398b/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71c8073aa1e2cd3101a031a4f10e460013d4df74", "url": "https://api.github.com/repos/rust-lang/rust/commits/71c8073aa1e2cd3101a031a4f10e460013d4df74", "html_url": "https://github.com/rust-lang/rust/commit/71c8073aa1e2cd3101a031a4f10e460013d4df74"}, {"sha": "2e7abf83844ef0c7d807262a682941f2aef9d3d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7abf83844ef0c7d807262a682941f2aef9d3d9", "html_url": "https://github.com/rust-lang/rust/commit/2e7abf83844ef0c7d807262a682941f2aef9d3d9"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "f9c33b3f7d1c23a8600a66ee95e71a82c8b9e37e", "filename": "crates/assists/src/handlers/invert_if.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c8a73fe655f7bf9778deeec4c8b4b541e0af398b/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8a73fe655f7bf9778deeec4c8b4b541e0af398b/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs?ref=c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "patch": "@@ -77,6 +77,15 @@ mod tests {\n         )\n     }\n \n+    #[test]\n+    fn invert_if_remove_not_parentheses() {\n+        check_assist(\n+            invert_if,\n+            \"fn f() { i<|>f !(x == 3 || x == 4 || x == 5) { 3 * 2 } else { 1 } }\",\n+            \"fn f() { if x == 3 || x == 4 || x == 5 { 1 } else { 3 * 2 } }\",\n+        )\n+    }\n+\n     #[test]\n     fn invert_if_remove_inequality() {\n         check_assist("}, {"sha": "d41084b59944daad1b91e6827bd2c3119b7ef730", "filename": "crates/assists/src/utils.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c8a73fe655f7bf9778deeec4c8b4b541e0af398b/crates%2Fassists%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8a73fe655f7bf9778deeec4c8b4b541e0af398b/crates%2Fassists%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Futils.rs?ref=c8a73fe655f7bf9778deeec4c8b4b541e0af398b", "patch": "@@ -232,7 +232,13 @@ fn invert_special_case(expr: &ast::Expr) -> Option<ast::Expr> {\n             };\n             Some(make::expr_method_call(receiver, method, arg_list))\n         }\n-        ast::Expr::PrefixExpr(pe) if pe.op_kind()? == ast::PrefixOp::Not => pe.expr(),\n+        ast::Expr::PrefixExpr(pe) if pe.op_kind()? == ast::PrefixOp::Not => {\n+            if let ast::Expr::ParenExpr(parexpr) = pe.expr()? {\n+                parexpr.expr()\n+            } else {\n+                pe.expr()\n+            }\n+        }\n         // FIXME:\n         // ast::Expr::Literal(true | false )\n         _ => None,"}]}