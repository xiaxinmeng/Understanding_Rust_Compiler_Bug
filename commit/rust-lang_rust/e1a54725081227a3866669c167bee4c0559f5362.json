{"sha": "e1a54725081227a3866669c167bee4c0559f5362", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxYTU0NzI1MDgxMjI3YTM4NjY2NjljMTY3YmVlNGMwNTU5ZjUzNjI=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-02-21T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-02-26T20:45:34Z"}, "message": "Emit 1-based column numbers in debuginfo\n\nThe debuginfo column numbers are 1-based. The value 0 indicates that no\ncolumn has been specified. Translate 0-based column numbers to 1-based\nwhen emitting debug information.", "tree": {"sha": "6a6bf48337b8468ba6346bc6ac23c68ea5df9dd1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a6bf48337b8468ba6346bc6ac23c68ea5df9dd1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e1a54725081227a3866669c167bee4c0559f5362", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e1a54725081227a3866669c167bee4c0559f5362", "html_url": "https://github.com/rust-lang/rust/commit/e1a54725081227a3866669c167bee4c0559f5362", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e1a54725081227a3866669c167bee4c0559f5362/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "abc3073c92df034636a823c5382ece2186d22b9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/abc3073c92df034636a823c5382ece2186d22b9e", "html_url": "https://github.com/rust-lang/rust/commit/abc3073c92df034636a823c5382ece2186d22b9e"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "de029ce51b321a4ce5d0c7a55fd9ea4a0b66f2c0", "filename": "src/librustc_codegen_llvm/debuginfo/create_scope_map.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e1a54725081227a3866669c167bee4c0559f5362/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fcreate_scope_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1a54725081227a3866669c167bee4c0559f5362/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fcreate_scope_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fcreate_scope_map.rs?ref=e1a54725081227a3866669c167bee4c0559f5362", "patch": "@@ -79,7 +79,8 @@ fn make_mir_scope(\n             parent_scope.scope_metadata.unwrap(),\n             file_metadata,\n             loc.line as c_uint,\n-            loc.col.to_usize() as c_uint,\n+            // Loc column is 0-based while debug one is 1-based.\n+            loc.col.to_usize() as c_uint + 1,\n         ))\n     };\n     debug_context.scopes[scope] = DebugScope {"}, {"sha": "ae5d9a7c8d89d99f6b28582333c5e27a4ab0ef74", "filename": "src/librustc_codegen_llvm/debuginfo/source_loc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e1a54725081227a3866669c167bee4c0559f5362/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fsource_loc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1a54725081227a3866669c167bee4c0559f5362/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fsource_loc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fsource_loc.rs?ref=e1a54725081227a3866669c167bee4c0559f5362", "patch": "@@ -19,7 +19,8 @@ impl CodegenCx<'ll, '_> {\n         let col_used = if self.sess().target.target.options.is_like_msvc {\n             UNKNOWN_COLUMN_NUMBER\n         } else {\n-            loc.col.to_usize() as c_uint\n+            // Loc column is 0-based while debug one is 1-based.\n+            loc.col.to_usize() as c_uint + 1\n         };\n \n         unsafe {"}, {"sha": "4a7b4176f2cee9eaf1d895b0b94218e81b385716", "filename": "src/test/codegen/debug-column.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e1a54725081227a3866669c167bee4c0559f5362/src%2Ftest%2Fcodegen%2Fdebug-column.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e1a54725081227a3866669c167bee4c0559f5362/src%2Ftest%2Fcodegen%2Fdebug-column.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fdebug-column.rs?ref=e1a54725081227a3866669c167bee4c0559f5362", "patch": "@@ -0,0 +1,16 @@\n+// Verify that emitted debuginfo column nubmers are 1-based. Regression test for issue #65437.\n+//\n+// ignore-windows\n+// compile-flags: -C debuginfo=2\n+\n+fn main() {\n+    unsafe {\n+        // CHECK: call void @giraffe(), !dbg [[DBG:!.*]]\n+        // CHECK: [[DBG]] = !DILocation(line: 10, column: 9\n+        giraffe();\n+    }\n+}\n+\n+extern {\n+    fn giraffe();\n+}"}]}