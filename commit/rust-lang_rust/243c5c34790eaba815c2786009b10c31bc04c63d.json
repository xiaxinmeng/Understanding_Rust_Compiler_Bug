{"sha": "243c5c34790eaba815c2786009b10c31bc04c63d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0M2M1YzM0NzkwZWFiYTgxNWMyNzg2MDA5YjEwYzMxYmMwNGM2M2Q=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-10-20T08:55:53Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-10-20T11:14:28Z"}, "message": "Use snap runtime, and the old main.o, for stage1\n\nThis is intended to be reverted again after I register the next\nsnapshot.", "tree": {"sha": "9576d51fc7d9994822e58245e7b1d91b496de760", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9576d51fc7d9994822e58245e7b1d91b496de760"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/243c5c34790eaba815c2786009b10c31bc04c63d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/243c5c34790eaba815c2786009b10c31bc04c63d", "html_url": "https://github.com/rust-lang/rust/commit/243c5c34790eaba815c2786009b10c31bc04c63d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/243c5c34790eaba815c2786009b10c31bc04c63d/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "880b1ec9f558281facc0757cbe8ab321564cb17b", "url": "https://api.github.com/repos/rust-lang/rust/commits/880b1ec9f558281facc0757cbe8ab321564cb17b", "html_url": "https://github.com/rust-lang/rust/commit/880b1ec9f558281facc0757cbe8ab321564cb17b"}], "stats": {"total": 67, "additions": 63, "deletions": 4}, "files": [{"sha": "3adb27d82e339c305bb56d2762868c066a4b4b9e", "filename": "mk/rt.mk", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/243c5c34790eaba815c2786009b10c31bc04c63d/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/243c5c34790eaba815c2786009b10c31bc04c63d/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=243c5c34790eaba815c2786009b10c31bc04c63d", "patch": "@@ -106,10 +106,16 @@ ifdef CFG_WINDOWSY\n rt/main.ll: rt/main.ll.in\n \t@$(call E, sed: $@)\n \t$(Q)sed 's/MAIN/WinMain@16/' < $^ > $@\n+rt/main0.ll: rt/main0.ll.in\n+\t@$(call E, sed: $@)\n+\t$(Q)sed 's/MAIN/WinMain@16/' < $^ > $@\n else\n rt/main.ll: rt/main.ll.in\n \t@$(call E, sed: $@)\n \t$(Q)sed 's/MAIN/main/' < $^ > $@\n+rt/main0.ll: rt/main0.ll.in\n+\t@$(call E, sed: $@)\n+\t$(Q)sed 's/MAIN/main/' < $^ > $@\n endif\n \n rt/%.o: rt/%.ll $(MKFILES)"}, {"sha": "f52d72f75e2aadb6967e87110fbbbc0622287504", "filename": "mk/target.mk", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/243c5c34790eaba815c2786009b10c31bc04c63d/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/243c5c34790eaba815c2786009b10c31bc04c63d/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=243c5c34790eaba815c2786009b10c31bc04c63d", "patch": "@@ -11,10 +11,6 @@ $$(TARGET_LIB$(1)$(2))/intrinsics.bc: $$(INTRINSICS_BC)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-$$(TARGET_LIB$(1)$(2))/main.o: rt/main.o\n-\t@$$(call E, cp: $$@)\n-\t$$(Q)cp $$< $$@\n-\n $$(TARGET_LIB$(1)$(2))/$$(CFG_STDLIB): \\\n \t$$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n         $$(TARGET_SREQ$(1)$(2))\n@@ -27,9 +23,23 @@ $$(TARGET_LIB$(1)$(2))/libstd.rlib: \\\n \t@$$(call E, compile_and_link: $$@)\n \t$$(STAGE$(1)) --lib --static -o $$@ $$<\n \n+ifeq ($(1), 0)\n+$$(TARGET_LIB$(1)$(2))/main.o: rt/main0.o\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+\n+$$(TARGET_LIB$(1)$(2))/$$(CFG_RUNTIME): stage0/lib/$$(CFG_RUNTIME)\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+else\n+$$(TARGET_LIB$(1)$(2))/main.o: rt/main.o\n+\t@$$(call E, cp: $$@)\n+\t$$(Q)cp $$< $$@\n+\n $$(TARGET_LIB$(1)$(2))/$$(CFG_RUNTIME): rt/$$(CFG_RUNTIME)\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n+endif\n \n $$(TARGET_LIB$(1)$(2))/$$(CFG_RUSTLLVM): rustllvm/$$(CFG_RUSTLLVM)\n \t@$$(call E, cp: $$@)"}, {"sha": "6b0454cc31fc42021bd6f25d7d76075e92539d6d", "filename": "src/rt/main0.ll.in", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/243c5c34790eaba815c2786009b10c31bc04c63d/src%2Frt%2Fmain0.ll.in", "raw_url": "https://github.com/rust-lang/rust/raw/243c5c34790eaba815c2786009b10c31bc04c63d/src%2Frt%2Fmain0.ll.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Fmain0.ll.in?ref=243c5c34790eaba815c2786009b10c31bc04c63d", "patch": "@@ -0,0 +1,43 @@\n+%0 = type { i32, [1 x i32] }\n+%1 = type { i32, i32 }\n+%2 = type { i32, %3 }\n+%3 = type { %tydesc*, %4, i1, {} }\n+%4 = type { i1*, i1* }\n+%5 = type { i32, i32, i32, i32, [0 x %6*] }\n+%6 = type { i32, i32, i32, i32, [0 x i8] }\n+\n+%tydesc = type { %tydesc**, i32, i32, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*)*, void (i1*, %task*, i1*, %tydesc**, i8*, i8*, i8)* }\n+\n+%task = type { i32, i32, i32, i32, i32, i32, i32, i32 }\n+\n+%vec = type { i32, i32, [0 x i8] }\n+\n+@_rust_crate_map_toplevel = external global %0\n+\n+declare i32 @rust_start(i32, i32, i32, i32)\n+\n+declare external fastcc void @_rust_main(i1* nocapture, %task*, %2* nocapture, %vec*)\n+\n+define void @_rust_main_wrap(i1* nocapture, %task *, %2* nocapture, %vec *)\n+{\n+  tail call fastcc void @_rust_main(i1* %0, %task *%1, %2* nocapture %2, %vec* %3)\n+  ret void\n+}\n+\n+%nullary_fn = type void (i1*, %task*, %2*)\n+\n+define void @_rust_spawn_wrap(\n+       i1* nocapture, %task*, %2* nocapture, %nullary_fn* %f)\n+{\n+  call void %f(i1* %0, %task *%1, %2* nocapture %2)\n+  ret void\n+}\n+\n+declare external void @set_spawn_wrapper(void (i1*, %task*, %2*, %nullary_fn*)*);\n+\n+define i32 @\"MAIN\"(i32, i32) {\n+  call void @set_spawn_wrapper(void (i1*, %task*, %2*, %nullary_fn*)* @_rust_spawn_wrap)\n+\n+  %result = tail call i32 @rust_start(i32 ptrtoint (void (i1*, %task*, %2*, %vec*)* @_rust_main_wrap to i32), i32 %0, i32 %1, i32 ptrtoint (%0* @_rust_crate_map_toplevel to i32))\n+  ret i32 %result\n+}"}]}