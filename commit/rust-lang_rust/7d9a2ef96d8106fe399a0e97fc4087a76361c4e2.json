{"sha": "7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkOWEyZWY5NmQ4MTA2ZmUzOTlhMGU5N2ZjNDA4N2E3NjM2MWM0ZTI=", "commit": {"author": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-02-08T12:39:11Z"}, "committer": {"name": "rchaser53", "email": "tayoshizawa29@gmail.com", "date": "2019-02-14T01:06:29Z"}, "message": "version/2: Align loop and while formatting\n\nThe loop and while formatting was diverting as  `loop`\nwas not being moved to a new, indented block, as `while`\nwas.\n\nThis commit fixes this inconsistency but pins it to version 2\nto avoid changing existing code.", "tree": {"sha": "128ccb245b06aa1ca3efe93929fdddf5156b6e4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/128ccb245b06aa1ca3efe93929fdddf5156b6e4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "html_url": "https://github.com/rust-lang/rust/commit/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/comments", "author": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rchaser53", "id": 9676954, "node_id": "MDQ6VXNlcjk2NzY5NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9676954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rchaser53", "html_url": "https://github.com/rchaser53", "followers_url": "https://api.github.com/users/rchaser53/followers", "following_url": "https://api.github.com/users/rchaser53/following{/other_user}", "gists_url": "https://api.github.com/users/rchaser53/gists{/gist_id}", "starred_url": "https://api.github.com/users/rchaser53/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rchaser53/subscriptions", "organizations_url": "https://api.github.com/users/rchaser53/orgs", "repos_url": "https://api.github.com/users/rchaser53/repos", "events_url": "https://api.github.com/users/rchaser53/events{/privacy}", "received_events_url": "https://api.github.com/users/rchaser53/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e28fae99747af538a30452413692a015da93b490", "url": "https://api.github.com/repos/rust-lang/rust/commits/e28fae99747af538a30452413692a015da93b490", "html_url": "https://github.com/rust-lang/rust/commit/e28fae99747af538a30452413692a015da93b490"}], "stats": {"total": 62, "additions": 59, "deletions": 3}, "files": [{"sha": "e74d0f7a44d65b04d237a15252c3ca5529ea6789", "filename": "src/closures.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/src%2Fclosures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/src%2Fclosures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fclosures.rs?ref=7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "patch": "@@ -13,6 +13,7 @@ use syntax::source_map::Span;\n use syntax::{ast, ptr};\n \n use crate::config::lists::*;\n+use crate::config::Version;\n use crate::expr::{block_contains_comment, is_simple_block, is_unsafe_block, rewrite_cond};\n use crate::items::{span_hi_for_arg, span_lo_for_arg};\n use crate::lists::{definitive_tactic, itemize_list, write_list, ListFormatting, Separator};\n@@ -376,22 +377,23 @@ fn is_block_closure_forced(context: &RewriteContext, expr: &ast::Expr) -> bool {\n     if context.inside_macro() {\n         false\n     } else {\n-        is_block_closure_forced_inner(expr)\n+        is_block_closure_forced_inner(expr, context.config.version())\n     }\n }\n \n-fn is_block_closure_forced_inner(expr: &ast::Expr) -> bool {\n+fn is_block_closure_forced_inner(expr: &ast::Expr, version: Version) -> bool {\n     match expr.node {\n         ast::ExprKind::If(..)\n         | ast::ExprKind::IfLet(..)\n         | ast::ExprKind::While(..)\n         | ast::ExprKind::WhileLet(..)\n         | ast::ExprKind::ForLoop(..) => true,\n+        ast::ExprKind::Loop(..) if version == Version::Two => true,\n         ast::ExprKind::AddrOf(_, ref expr)\n         | ast::ExprKind::Box(ref expr)\n         | ast::ExprKind::Try(ref expr)\n         | ast::ExprKind::Unary(_, ref expr)\n-        | ast::ExprKind::Cast(ref expr, _) => is_block_closure_forced_inner(expr),\n+        | ast::ExprKind::Cast(ref expr, _) => is_block_closure_forced_inner(expr, version),\n         _ => false,\n     }\n }"}, {"sha": "fcc8331000d33f90ed5f92e61824795cba0c3483", "filename": "tests/source/issue-3227/one.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Fsource%2Fissue-3227%2Fone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Fsource%2Fissue-3227%2Fone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3227%2Fone.rs?ref=7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "patch": "@@ -0,0 +1,13 @@\n+// rustfmt-version: One\n+\n+fn main() {\n+    thread::spawn(|| {\n+        while true {\n+            println!(\"iteration\");\n+        }\n+    });\n+\n+    thread::spawn(|| loop {\n+        println!(\"iteration\");\n+    });\n+}"}, {"sha": "c1572c00d57a479719c17bb509e246d8c14fcce8", "filename": "tests/source/issue-3227/two.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Fsource%2Fissue-3227%2Ftwo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Fsource%2Fissue-3227%2Ftwo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3227%2Ftwo.rs?ref=7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "patch": "@@ -0,0 +1,13 @@\n+// rustfmt-version: Two\n+\n+fn main() {\n+    thread::spawn(|| {\n+        while true {\n+            println!(\"iteration\");\n+        }\n+    });\n+\n+    thread::spawn(|| loop {\n+        println!(\"iteration\");\n+    });\n+}"}, {"sha": "fcc8331000d33f90ed5f92e61824795cba0c3483", "filename": "tests/target/issue-3227/one.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Ftarget%2Fissue-3227%2Fone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Ftarget%2Fissue-3227%2Fone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3227%2Fone.rs?ref=7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "patch": "@@ -0,0 +1,13 @@\n+// rustfmt-version: One\n+\n+fn main() {\n+    thread::spawn(|| {\n+        while true {\n+            println!(\"iteration\");\n+        }\n+    });\n+\n+    thread::spawn(|| loop {\n+        println!(\"iteration\");\n+    });\n+}"}, {"sha": "374ab54305d9953f18b31d97b33059ac82d7cbbc", "filename": "tests/target/issue-3227/two.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Ftarget%2Fissue-3227%2Ftwo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d9a2ef96d8106fe399a0e97fc4087a76361c4e2/tests%2Ftarget%2Fissue-3227%2Ftwo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3227%2Ftwo.rs?ref=7d9a2ef96d8106fe399a0e97fc4087a76361c4e2", "patch": "@@ -0,0 +1,15 @@\n+// rustfmt-version: Two\n+\n+fn main() {\n+    thread::spawn(|| {\n+        while true {\n+            println!(\"iteration\");\n+        }\n+    });\n+\n+    thread::spawn(|| {\n+        loop {\n+            println!(\"iteration\");\n+        }\n+    });\n+}"}]}