{"sha": "59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5ZjFhNTYzZDVhNWY2YWE5ZjM0ZGY1ZWQ0YjdhM2FkOWQxNTRhYzQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-22T13:58:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-22T13:58:11Z"}, "message": "Rollup merge of #58607 - gurgalex:fail_E0505_for_2018_edition, r=matthewjasper\n\nFixes #58586: Make E0505 erronous example fail for the 2018 edition\n\nThe original example worked for 2015, but not the 2018 edition of Rust.\n\nBorrowing the moved value after ownership is transferred seems required for 2018.\n\n[this](https://github.com/rust-lang/rust/compare/rust-lang:f66e469...gurgalex:b2a02c8#diff-4ca866aea4a6efecd732f1975faaad88R1564) line though is correct for 2018, but not for the 2015 edition.\n\nFix #58586", "tree": {"sha": "78a81b28058e86fb26d6eeb4f2f308ff442c2862", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/78a81b28058e86fb26d6eeb4f2f308ff442c2862"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcb//zCRBK7hj4Ov3rIwAAdHIIAA4/Xurxl5afDchCdRqEmFPX\n9eX3jUzj3f5JNiYxF3idcfSkf5mbN8zJVuXC40E5aA60W4GIowpoBINVWPzEdSzk\nTNZpBOgs3PRDcIkPYtoPoaiyblxCfYA20dI6i0rpLxlg78lEJWJ37TVF0fRk4WB8\n5OCojbhA1LxwSp2JzbaeLtymDK287IWhjLnvzwR/zYsP3DF/VlzU6AwZd7YnidVL\nmqpoLevDxoInXyoaOicU1l8RfRaTynWuwvPshC7qVHyCDsDB5GgW8KhPlduUdg94\nvl0utQHhAY2OwQFAt7sGX8Is9kbn58gfVf6LOKVGlEXdzzkPA+xkWZyiJNl+RPw=\n=bS1o\n-----END PGP SIGNATURE-----\n", "payload": "tree 78a81b28058e86fb26d6eeb4f2f308ff442c2862\nparent b28a32fba77f7c50497e15109773838fef07b0e7\nparent 6a5abea7092cf7ede5bb6b3489db94eb701cd04e\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550843891 +0100\ncommitter GitHub <noreply@github.com> 1550843891 +0100\n\nRollup merge of #58607 - gurgalex:fail_E0505_for_2018_edition, r=matthewjasper\n\nFixes #58586: Make E0505 erronous example fail for the 2018 edition\n\nThe original example worked for 2015, but not the 2018 edition of Rust.\n\nBorrowing the moved value after ownership is transferred seems required for 2018.\n\n[this](https://github.com/rust-lang/rust/compare/rust-lang:f66e469...gurgalex:b2a02c8#diff-4ca866aea4a6efecd732f1975faaad88R1564) line though is correct for 2018, but not for the 2015 edition.\n\nFix #58586\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4", "html_url": "https://github.com/rust-lang/rust/commit/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b28a32fba77f7c50497e15109773838fef07b0e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/b28a32fba77f7c50497e15109773838fef07b0e7", "html_url": "https://github.com/rust-lang/rust/commit/b28a32fba77f7c50497e15109773838fef07b0e7"}, {"sha": "6a5abea7092cf7ede5bb6b3489db94eb701cd04e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a5abea7092cf7ede5bb6b3489db94eb701cd04e", "html_url": "https://github.com/rust-lang/rust/commit/6a5abea7092cf7ede5bb6b3489db94eb701cd04e"}], "stats": {"total": 37, "additions": 22, "deletions": 15}, "files": [{"sha": "f369324157a9e358209f694a76c31ae813ce82b6", "filename": "src/librustc_mir/diagnostics.rs", "status": "modified", "additions": 22, "deletions": 15, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4/src%2Flibrustc_mir%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4/src%2Flibrustc_mir%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdiagnostics.rs?ref=59f1a563d5a5f6aa9f34df5ed4b7a3ad9d154ac4", "patch": "@@ -1545,20 +1545,22 @@ Erroneous code example:\n ```compile_fail,E0505\n struct Value {}\n \n+fn borrow(val: &Value) {}\n+\n fn eat(val: Value) {}\n \n fn main() {\n     let x = Value{};\n-    {\n-        let _ref_to_val: &Value = &x;\n-        eat(x);\n-    }\n+    let _ref_to_val: &Value = &x;\n+    eat(x);\n+    borrow(_ref_to_val);\n }\n ```\n \n-Here, the function `eat` takes the ownership of `x`. However,\n-`x` cannot be moved because it was borrowed to `_ref_to_val`.\n-To fix that you can do few different things:\n+Here, the function `eat` takes ownership of `x`. However,\n+`x` cannot be moved because the borrow to `_ref_to_val`\n+needs to last till the function `borrow`.\n+To fix that you can do a few different things:\n \n * Try to avoid moving the variable.\n * Release borrow before move.\n@@ -1569,14 +1571,15 @@ Examples:\n ```\n struct Value {}\n \n+fn borrow(val: &Value) {}\n+\n fn eat(val: &Value) {}\n \n fn main() {\n     let x = Value{};\n-    {\n-        let _ref_to_val: &Value = &x;\n-        eat(&x); // pass by reference, if it's possible\n-    }\n+    let _ref_to_val: &Value = &x;\n+    eat(&x); // pass by reference, if it's possible\n+    borrow(_ref_to_val);\n }\n ```\n \n@@ -1585,12 +1588,15 @@ Or:\n ```\n struct Value {}\n \n+fn borrow(val: &Value) {}\n+\n fn eat(val: Value) {}\n \n fn main() {\n     let x = Value{};\n     {\n         let _ref_to_val: &Value = &x;\n+        borrow(_ref_to_val);\n     }\n     eat(x); // release borrow and then move it.\n }\n@@ -1602,14 +1608,15 @@ Or:\n #[derive(Clone, Copy)] // implement Copy trait\n struct Value {}\n \n+fn borrow(val: &Value) {}\n+\n fn eat(val: Value) {}\n \n fn main() {\n     let x = Value{};\n-    {\n-        let _ref_to_val: &Value = &x;\n-        eat(x); // it will be copied here.\n-    }\n+    let _ref_to_val: &Value = &x;\n+    eat(x); // it will be copied here.\n+    borrow(_ref_to_val);\n }\n ```\n "}]}