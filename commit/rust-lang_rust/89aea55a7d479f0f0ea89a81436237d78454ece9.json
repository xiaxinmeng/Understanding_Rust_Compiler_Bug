{"sha": "89aea55a7d479f0f0ea89a81436237d78454ece9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5YWVhNTVhN2Q0NzlmMGYwZWE4OWE4MTQzNjIzN2Q3ODQ1NGVjZTk=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-10-31T08:49:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-31T08:49:34Z"}, "message": "Rollup merge of #78526 - Aaron1011:fix/assoc-tokens, r=estebank\n\nStrip tokens from trait and impl items before printing AST JSON\n\nFixes #78510", "tree": {"sha": "d141d49fda9b6b6365cd8cf432c0af995471aa33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d141d49fda9b6b6365cd8cf432c0af995471aa33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89aea55a7d479f0f0ea89a81436237d78454ece9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfnSUfCRBK7hj4Ov3rIwAAdHIIACQ4pXChHNjOaG3F5sCZByLT\nb9cwIpb+r6YS+Es0CB+tEgawiPMYRjLBiIqjCBPYr3D1qaTSIIVr9JWFIcV/w1r6\n3liDQ348+sQ2AyDJUo7AdfRKbKjLRAGgdvMXYUeK4yjgG6Av6ApkMfIsE1Uu1veY\njyvWGN20X2a9xCFevRNaNqkw6PGjBdoiIonlC7LgKS/jvGrDVtshlj/u25z8goiM\nP8Sgdb8SYlVD3eIS/NNAJZF9gh0EoBEV4Wef5Otz3/Naa/IfPQtSzF1HNv4HyHaA\nY+9NJjyNlbIdTj5NPXjcGS084bNPMmEbPaa1O4zhLwJkpGwSYwHWLG4v6ySbkM8=\n=fL0C\n-----END PGP SIGNATURE-----\n", "payload": "tree d141d49fda9b6b6365cd8cf432c0af995471aa33\nparent 4ebd5536b4db64fcf4ae4f54437162db4f37afe9\nparent 4ba57aa703397a34e92f055c9e07bc880b771226\nauthor Mara Bos <m-ou.se@m-ou.se> 1604134174 +0100\ncommitter GitHub <noreply@github.com> 1604134174 +0100\n\nRollup merge of #78526 - Aaron1011:fix/assoc-tokens, r=estebank\n\nStrip tokens from trait and impl items before printing AST JSON\n\nFixes #78510\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89aea55a7d479f0f0ea89a81436237d78454ece9", "html_url": "https://github.com/rust-lang/rust/commit/89aea55a7d479f0f0ea89a81436237d78454ece9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89aea55a7d479f0f0ea89a81436237d78454ece9/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4ebd5536b4db64fcf4ae4f54437162db4f37afe9", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ebd5536b4db64fcf4ae4f54437162db4f37afe9", "html_url": "https://github.com/rust-lang/rust/commit/4ebd5536b4db64fcf4ae4f54437162db4f37afe9"}, {"sha": "4ba57aa703397a34e92f055c9e07bc880b771226", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ba57aa703397a34e92f055c9e07bc880b771226", "html_url": "https://github.com/rust-lang/rust/commit/4ba57aa703397a34e92f055c9e07bc880b771226"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "a1487aa0060d5fe08000d8863f2874928dd842b1", "filename": "compiler/rustc_interface/src/passes.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/89aea55a7d479f0f0ea89a81436237d78454ece9/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89aea55a7d479f0f0ea89a81436237d78454ece9/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs?ref=89aea55a7d479f0f0ea89a81436237d78454ece9", "patch": "@@ -70,6 +70,17 @@ impl mut_visit::MutVisitor for TokenStripper {\n         i.tokens = None;\n         mut_visit::noop_flat_map_foreign_item(i, self)\n     }\n+    fn flat_map_trait_item(\n+        &mut self,\n+        mut i: P<ast::AssocItem>,\n+    ) -> SmallVec<[P<ast::AssocItem>; 1]> {\n+        i.tokens = None;\n+        mut_visit::noop_flat_map_assoc_item(i, self)\n+    }\n+    fn flat_map_impl_item(&mut self, mut i: P<ast::AssocItem>) -> SmallVec<[P<ast::AssocItem>; 1]> {\n+        i.tokens = None;\n+        mut_visit::noop_flat_map_assoc_item(i, self)\n+    }\n     fn visit_block(&mut self, b: &mut P<ast::Block>) {\n         b.tokens = None;\n         mut_visit::noop_visit_block(b, self);"}, {"sha": "ef3117c49cad3d2d62f7e2e91d0b4617daa5976b", "filename": "src/test/ui/ast-json/issue-78510-assoc-ice.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.rs?ref=89aea55a7d479f0f0ea89a81436237d78454ece9", "patch": "@@ -0,0 +1,18 @@\n+// compile-flags: -Zast-json\n+//\n+// Regression test for issue #78510\n+// Tests that we don't ICE when we have tokens for an associated item\n+\n+struct S;\n+\n+impl S {\n+    #[derive(Debug)] //~ ERROR `derive` may only be applied to structs, enums and unions\n+    fn f() {}\n+}\n+\n+trait Bar {\n+    #[derive(Debug)] //~ ERROR `derive` may only be applied to structs, enums and unions\n+    fn foo() {}\n+}\n+\n+fn main() {}"}, {"sha": "3573c203a789309f6e28a01dd0853c9d7249a55a", "filename": "src/test/ui/ast-json/issue-78510-assoc-ice.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stderr?ref=89aea55a7d479f0f0ea89a81436237d78454ece9", "patch": "@@ -0,0 +1,15 @@\n+error[E0774]: `derive` may only be applied to structs, enums and unions\n+  --> $DIR/issue-78510-assoc-ice.rs:9:5\n+   |\n+LL |     #[derive(Debug)]\n+   |     ^^^^^^^^^^^^^^^^\n+\n+error[E0774]: `derive` may only be applied to structs, enums and unions\n+  --> $DIR/issue-78510-assoc-ice.rs:14:5\n+   |\n+LL |     #[derive(Debug)]\n+   |     ^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0774`."}, {"sha": "fef9504285b530dec83f0ff48e6a91f4c6decd84", "filename": "src/test/ui/ast-json/issue-78510-assoc-ice.stdout", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/89aea55a7d479f0f0ea89a81436237d78454ece9/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fast-json%2Fissue-78510-assoc-ice.stdout?ref=89aea55a7d479f0f0ea89a81436237d78454ece9", "patch": "@@ -0,0 +1 @@\n+{\"module\":{\"inner\":{\"lo\":139,\"hi\":397},\"unsafety\":\"No\",\"items\":[{\"attrs\":[{\"kind\":{\"variant\":\"Normal\",\"fields\":[{\"path\":{\"span\":{\"lo\":0,\"hi\":0},\"segments\":[{\"ident\":{\"name\":\"prelude_import\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":3,\"args\":null}],\"tokens\":null},\"args\":\"Empty\",\"tokens\":null}]},\"id\":null,\"style\":\"Outer\",\"span\":{\"lo\":0,\"hi\":0},\"tokens\":null}],\"id\":4,\"span\":{\"lo\":0,\"hi\":0},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":0,\"hi\":0},\"tokens\":null},\"ident\":{\"name\":\"\",\"span\":{\"lo\":0,\"hi\":0}},\"kind\":{\"variant\":\"Use\",\"fields\":[{\"prefix\":{\"span\":{\"lo\":0,\"hi\":0},\"segments\":[{\"ident\":{\"name\":\"{{root}}\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":5,\"args\":null},{\"ident\":{\"name\":\"std\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":6,\"args\":null},{\"ident\":{\"name\":\"prelude\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":7,\"args\":null},{\"ident\":{\"name\":\"v1\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":8,\"args\":null}],\"tokens\":null},\"kind\":\"Glob\",\"span\":{\"lo\":0,\"hi\":0}}]},\"tokens\":null},{\"attrs\":[{\"kind\":{\"variant\":\"Normal\",\"fields\":[{\"path\":{\"span\":{\"lo\":0,\"hi\":0},\"segments\":[{\"ident\":{\"name\":\"macro_use\",\"span\":{\"lo\":0,\"hi\":0}},\"id\":9,\"args\":null}],\"tokens\":null},\"args\":\"Empty\",\"tokens\":null}]},\"id\":null,\"style\":\"Outer\",\"span\":{\"lo\":0,\"hi\":0},\"tokens\":null}],\"id\":10,\"span\":{\"lo\":0,\"hi\":0},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":0,\"hi\":0},\"tokens\":null},\"ident\":{\"name\":\"std\",\"span\":{\"lo\":0,\"hi\":0}},\"kind\":{\"variant\":\"ExternCrate\",\"fields\":[null]},\"tokens\":null},{\"attrs\":[],\"id\":11,\"span\":{\"lo\":139,\"hi\":148},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":139,\"hi\":139},\"tokens\":null},\"ident\":{\"name\":\"S\",\"span\":{\"lo\":146,\"hi\":147}},\"kind\":{\"variant\":\"Struct\",\"fields\":[{\"variant\":\"Unit\",\"fields\":[12]},{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":147,\"hi\":147}},\"span\":{\"lo\":147,\"hi\":147}}]},\"tokens\":null},{\"attrs\":[],\"id\":13,\"span\":{\"lo\":150,\"hi\":263},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":150,\"hi\":150},\"tokens\":null},\"ident\":{\"name\":\"\",\"span\":{\"lo\":0,\"hi\":0}},\"kind\":{\"variant\":\"Impl\",\"fields\":[\"No\",\"Positive\",\"Final\",\"No\",{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":156,\"hi\":156}},\"span\":{\"lo\":154,\"hi\":154}},null,{\"id\":14,\"kind\":{\"variant\":\"Path\",\"fields\":[null,{\"span\":{\"lo\":155,\"hi\":156},\"segments\":[{\"ident\":{\"name\":\"S\",\"span\":{\"lo\":155,\"hi\":156}},\"id\":15,\"args\":null}],\"tokens\":null}]},\"span\":{\"lo\":155,\"hi\":156},\"tokens\":null},[{\"attrs\":[],\"id\":19,\"span\":{\"lo\":252,\"hi\":261},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":252,\"hi\":252},\"tokens\":null},\"ident\":{\"name\":\"f\",\"span\":{\"lo\":255,\"hi\":256}},\"kind\":{\"variant\":\"Fn\",\"fields\":[\"Final\",{\"header\":{\"unsafety\":\"No\",\"asyncness\":\"No\",\"constness\":\"No\",\"ext\":\"None\"},\"decl\":{\"inputs\":[],\"output\":{\"variant\":\"Default\",\"fields\":[{\"lo\":259,\"hi\":259}]}},\"span\":{\"lo\":252,\"hi\":258}},{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":258,\"hi\":258}},\"span\":{\"lo\":256,\"hi\":256}},{\"stmts\":[],\"id\":20,\"rules\":\"Default\",\"span\":{\"lo\":259,\"hi\":261},\"tokens\":null}]},\"tokens\":null}]]},\"tokens\":null},{\"attrs\":[],\"id\":16,\"span\":{\"lo\":265,\"hi\":383},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":265,\"hi\":265},\"tokens\":null},\"ident\":{\"name\":\"Bar\",\"span\":{\"lo\":271,\"hi\":274}},\"kind\":{\"variant\":\"Trait\",\"fields\":[\"No\",\"No\",{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":274,\"hi\":274}},\"span\":{\"lo\":274,\"hi\":274}},[],[{\"attrs\":[],\"id\":21,\"span\":{\"lo\":370,\"hi\":381},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":370,\"hi\":370},\"tokens\":null},\"ident\":{\"name\":\"foo\",\"span\":{\"lo\":373,\"hi\":376}},\"kind\":{\"variant\":\"Fn\",\"fields\":[\"Final\",{\"header\":{\"unsafety\":\"No\",\"asyncness\":\"No\",\"constness\":\"No\",\"ext\":\"None\"},\"decl\":{\"inputs\":[],\"output\":{\"variant\":\"Default\",\"fields\":[{\"lo\":379,\"hi\":379}]}},\"span\":{\"lo\":370,\"hi\":378}},{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":378,\"hi\":378}},\"span\":{\"lo\":376,\"hi\":376}},{\"stmts\":[],\"id\":22,\"rules\":\"Default\",\"span\":{\"lo\":379,\"hi\":381},\"tokens\":null}]},\"tokens\":null}]]},\"tokens\":null},{\"attrs\":[],\"id\":17,\"span\":{\"lo\":385,\"hi\":397},\"vis\":{\"kind\":\"Inherited\",\"span\":{\"lo\":385,\"hi\":385},\"tokens\":null},\"ident\":{\"name\":\"main\",\"span\":{\"lo\":388,\"hi\":392}},\"kind\":{\"variant\":\"Fn\",\"fields\":[\"Final\",{\"header\":{\"unsafety\":\"No\",\"asyncness\":\"No\",\"constness\":\"No\",\"ext\":\"None\"},\"decl\":{\"inputs\":[],\"output\":{\"variant\":\"Default\",\"fields\":[{\"lo\":395,\"hi\":395}]}},\"span\":{\"lo\":385,\"hi\":394}},{\"params\":[],\"where_clause\":{\"has_where_token\":false,\"predicates\":[],\"span\":{\"lo\":394,\"hi\":394}},\"span\":{\"lo\":392,\"hi\":392}},{\"stmts\":[],\"id\":18,\"rules\":\"Default\",\"span\":{\"lo\":395,\"hi\":397},\"tokens\":null}]},\"tokens\":null}],\"inline\":true},\"attrs\":[],\"span\":{\"lo\":139,\"hi\":397},\"proc_macros\":[]}"}]}