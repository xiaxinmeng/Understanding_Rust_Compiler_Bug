{"sha": "a6b34861c44446cd7d78435c4127b19b0a7b9879", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2YjM0ODYxYzQ0NDQ2Y2Q3ZDc4NDM1YzQxMjdiMTliMGE3Yjk4Nzk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-25T23:01:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-25T23:01:06Z"}, "message": "Auto merge of #3698 - sorin-davidoi:fix-common-metadata-no-deps, r=oli-obk\n\nchore(cargo/dependencies/cargo-metadata): Upgrade to 0.7.1\n\nCloses https://github.com/rust-lang/rust-clippy/issues/3692.", "tree": {"sha": "f71771e2882669390a43037627c8257bd94e9139", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f71771e2882669390a43037627c8257bd94e9139"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6b34861c44446cd7d78435c4127b19b0a7b9879", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6b34861c44446cd7d78435c4127b19b0a7b9879", "html_url": "https://github.com/rust-lang/rust/commit/a6b34861c44446cd7d78435c4127b19b0a7b9879", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6b34861c44446cd7d78435c4127b19b0a7b9879/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a02512ab36741bcc5a83344d0519759491e6eae", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a02512ab36741bcc5a83344d0519759491e6eae", "html_url": "https://github.com/rust-lang/rust/commit/8a02512ab36741bcc5a83344d0519759491e6eae"}, {"sha": "dc3bee796219534de7b4719d76c73672041ed786", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc3bee796219534de7b4719d76c73672041ed786", "html_url": "https://github.com/rust-lang/rust/commit/dc3bee796219534de7b4719d76c73672041ed786"}], "stats": {"total": 27, "additions": 14, "deletions": 13}, "files": [{"sha": "868f21c1a49860a662929a839eaabf9f1f6308e8", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -47,7 +47,7 @@ rustc_tools_util = { version = \"0.1.1\", path = \"rustc_tools_util\"}\n \n [dev-dependencies]\n clippy_dev = { version = \"0.0.1\", path = \"clippy_dev\" }\n-cargo_metadata = \"0.6.2\"\n+cargo_metadata = \"0.7.1\"\n compiletest_rs = \"0.3.18\"\n lazy_static = \"1.0\"\n serde_derive = \"1.0\""}, {"sha": "592ad5cde1ce93a673ea19f5776b1d1669d7f774", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -17,7 +17,7 @@ keywords = [\"clippy\", \"lint\", \"plugin\"]\n edition = \"2018\"\n \n [dependencies]\n-cargo_metadata = \"0.6.2\"\n+cargo_metadata = \"0.7.1\"\n itertools = \"0.8\"\n lazy_static = \"1.0.2\"\n matches = \"0.1.7\""}, {"sha": "c60d10cd0092d61f689ce0dd5638620c63326aaf", "filename": "clippy_lints/src/cargo_common_metadata.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -66,7 +66,7 @@ impl LintPass for Pass {\n \n impl EarlyLintPass for Pass {\n     fn check_crate(&mut self, cx: &EarlyContext<'_>, _: &Crate) {\n-        let metadata = if let Ok(metadata) = cargo_metadata::metadata_deps(None, true) {\n+        let metadata = if let Ok(metadata) = cargo_metadata::MetadataCommand::new().no_deps().exec() {\n             metadata\n         } else {\n             warning(cx, \"could not read cargo metadata\");"}, {"sha": "6a042fa8c0a007f33bef910ed7a998fc6f70efbb", "filename": "clippy_lints/src/multiple_crate_versions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmultiple_crate_versions.rs?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -41,7 +41,7 @@ impl LintPass for Pass {\n \n impl EarlyLintPass for Pass {\n     fn check_crate(&mut self, cx: &EarlyContext<'_>, _: &Crate) {\n-        let metadata = if let Ok(metadata) = cargo_metadata::metadata_deps(None, true) {\n+        let metadata = if let Ok(metadata) = cargo_metadata::MetadataCommand::new().exec() {\n             metadata\n         } else {\n             span_lint(cx, MULTIPLE_CRATE_VERSIONS, DUMMY_SP, \"could not read cargo metadata\");"}, {"sha": "fb88b1371f7e26fd9d339200c9ca664d6cb51cf5", "filename": "clippy_lints/src/wildcard_dependencies.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fwildcard_dependencies.rs?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -37,7 +37,7 @@ impl LintPass for Pass {\n \n impl EarlyLintPass for Pass {\n     fn check_crate(&mut self, cx: &EarlyContext<'_>, _: &Crate) {\n-        let metadata = if let Ok(metadata) = cargo_metadata::metadata(None) {\n+        let metadata = if let Ok(metadata) = cargo_metadata::MetadataCommand::new().no_deps().exec() {\n             metadata\n         } else {\n             span_lint(cx, WILDCARD_DEPENDENCIES, DUMMY_SP, \"could not read cargo metadata\");"}, {"sha": "f5d03c645df0435b7876033306ef910f0237afcc", "filename": "tests/versioncheck.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a6b34861c44446cd7d78435c4127b19b0a7b9879/tests%2Fversioncheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6b34861c44446cd7d78435c4127b19b0a7b9879/tests%2Fversioncheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fversioncheck.rs?ref=a6b34861c44446cd7d78435c4127b19b0a7b9879", "patch": "@@ -1,17 +1,18 @@\n-use semver::VersionReq;\n-\n #[test]\n fn check_that_clippy_lints_has_the_same_version_as_clippy() {\n-    let clippy_meta = cargo_metadata::metadata(None).expect(\"could not obtain cargo metadata\");\n+    let clippy_meta = cargo_metadata::MetadataCommand::new()\n+        .no_deps()\n+        .exec()\n+        .expect(\"could not obtain cargo metadata\");\n     std::env::set_current_dir(std::env::current_dir().unwrap().join(\"clippy_lints\")).unwrap();\n-    let clippy_lints_meta = cargo_metadata::metadata(None).expect(\"could not obtain cargo metadata\");\n+    let clippy_lints_meta = cargo_metadata::MetadataCommand::new()\n+        .no_deps()\n+        .exec()\n+        .expect(\"could not obtain cargo metadata\");\n     assert_eq!(clippy_lints_meta.packages[0].version, clippy_meta.packages[0].version);\n     for package in &clippy_meta.packages[0].dependencies {\n         if package.name == \"clippy_lints\" {\n-            assert_eq!(\n-                VersionReq::parse(&clippy_lints_meta.packages[0].version).unwrap(),\n-                package.req\n-            );\n+            assert!(package.req.matches(&clippy_lints_meta.packages[0].version));\n             return;\n         }\n     }"}]}