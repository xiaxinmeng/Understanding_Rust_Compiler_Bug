{"sha": "43f2c37f9350b2bed0b81bf858e7478869d8c306", "node_id": "C_kwDOAAsO6NoAKDQzZjJjMzdmOTM1MGIyYmVkMGI4MWJmODU4ZTc0Nzg4NjlkOGMzMDY", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-19T19:05:15Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-10-20T03:44:12Z"}, "message": "Note discrepancies in constness calculation", "tree": {"sha": "e3d938486ac25dfb39646a9c102538d96e924b6a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e3d938486ac25dfb39646a9c102538d96e924b6a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/43f2c37f9350b2bed0b81bf858e7478869d8c306", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/43f2c37f9350b2bed0b81bf858e7478869d8c306", "html_url": "https://github.com/rust-lang/rust/commit/43f2c37f9350b2bed0b81bf858e7478869d8c306", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/43f2c37f9350b2bed0b81bf858e7478869d8c306/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab36a2fe16006a34c7d19baa6ef8e23f6ec079cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab36a2fe16006a34c7d19baa6ef8e23f6ec079cc", "html_url": "https://github.com/rust-lang/rust/commit/ab36a2fe16006a34c7d19baa6ef8e23f6ec079cc"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "3eebb4ace477fe867610edbc92070a628701fca4", "filename": "compiler/rustc_ty_utils/src/ty.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/43f2c37f9350b2bed0b81bf858e7478869d8c306/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/43f2c37f9350b2bed0b81bf858e7478869d8c306/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ty_utils%2Fsrc%2Fty.rs?ref=43f2c37f9350b2bed0b81bf858e7478869d8c306", "patch": "@@ -137,6 +137,7 @@ fn param_env(tcx: TyCtxt<'_>, def_id: DefId) -> ty::ParamEnv<'_> {\n     let local_did = def_id.as_local();\n     let hir_id = local_did.map(|def_id| tcx.hir().local_def_id_to_hir_id(def_id));\n \n+    // FIXME(consts): This is not exactly in line with the constness query.\n     let constness = match hir_id {\n         Some(hir_id) => match tcx.hir().get(hir_id) {\n             hir::Node::TraitItem(hir::TraitItem { kind: hir::TraitItemKind::Fn(..), .. })\n@@ -201,6 +202,10 @@ fn param_env(tcx: TyCtxt<'_>, def_id: DefId) -> ty::ParamEnv<'_> {\n \n             _ => hir::Constness::NotConst,\n         },\n+        // FIXME(consts): It's suspicious that a param-env for a foreign item\n+        // will always have NotConst param-env, though we don't typically use\n+        // that param-env for anything meaningful right now, so it's likely\n+        // not an issue.\n         None => hir::Constness::NotConst,\n     };\n "}]}