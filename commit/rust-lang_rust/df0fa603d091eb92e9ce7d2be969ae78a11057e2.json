{"sha": "df0fa603d091eb92e9ce7d2be969ae78a11057e2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmMGZhNjAzZDA5MWViOTJlOWNlN2QyYmU5NjlhZTc4YTExMDU3ZTI=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-03T07:27:33Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-03T07:27:33Z"}, "message": "Add version-stamp machinery (and put \"Draft + datestamp\" into doc footer).", "tree": {"sha": "6ce0b17ca8366bd1fca560b4ca33f7dffb0a16cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ce0b17ca8366bd1fca560b4ca33f7dffb0a16cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df0fa603d091eb92e9ce7d2be969ae78a11057e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df0fa603d091eb92e9ce7d2be969ae78a11057e2", "html_url": "https://github.com/rust-lang/rust/commit/df0fa603d091eb92e9ce7d2be969ae78a11057e2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df0fa603d091eb92e9ce7d2be969ae78a11057e2/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cf19c5132a074195b61c3a09b9b61f99840744df", "url": "https://api.github.com/repos/rust-lang/rust/commits/cf19c5132a074195b61c3a09b9b61f99840744df", "html_url": "https://github.com/rust-lang/rust/commit/cf19c5132a074195b61c3a09b9b61f99840744df"}], "stats": {"total": 54, "additions": 45, "deletions": 9}, "files": [{"sha": "8e07a9a19f03b79029cb44a4267e9b8390065f6a", "filename": "doc/Makefile", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/df0fa603d091eb92e9ce7d2be969ae78a11057e2/doc%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/df0fa603d091eb92e9ce7d2be969ae78a11057e2/doc%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2FMakefile?ref=df0fa603d091eb92e9ce7d2be969ae78a11057e2", "patch": "@@ -1,10 +1,14 @@\n \n all: rust.pdf rust.html\n \n-%.pdf: %.texi\n+version.texi: Makefile\n+\tgit log -1 \\\n+      --format='@macro gitversion%n%h %ci%n@end macro%n' >$@\n+\n+%.pdf: %.texi version.texi\n \ttexi2pdf $<\n \n-%.html: %.texi\n+%.html: %.texi version.texi\n \tmakeinfo --html --ifhtml --force --no-split --output=$@ $<\n \n clean:"}, {"sha": "0f0a0f446f85e816ae8dffe981a1e662617072f0", "filename": "doc/rust.texi", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/df0fa603d091eb92e9ce7d2be969ae78a11057e2/doc%2Frust.texi", "raw_url": "https://github.com/rust-lang/rust/raw/df0fa603d091eb92e9ce7d2be969ae78a11057e2/doc%2Frust.texi", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Frust.texi?ref=df0fa603d091eb92e9ce7d2be969ae78a11057e2", "patch": "@@ -6,15 +6,23 @@\n @c %**end of header\n \n @syncodeindex fn cp\n+@include version.texi\n \n @ifinfo\n This manual is for the ``Rust'' programming language.\n \n+\n+@uref{http://github.com/graydon/rust}\n+\n+Version: @gitversion\n+\n+\n Copyright 2006-2010 Graydon Hoare\n \n Copyright 2009-2010 Mozilla Foundation\n \n-All rights reserved (for the time being).\n+See accompanying LICENSE.txt for terms.\n+\n @end ifinfo\n \n @dircategory Programming\n@@ -30,13 +38,24 @@ All rights reserved (for the time being).\n \n @page\n @vskip 0pt plus 1filll\n+\n+\n+@uref{http://github.com/graydon/rust}\n+\n+Version: @gitversion\n+\n+@sp 2\n+\n Copyright @copyright{} 2006-2010 Graydon Hoare\n \n Copyright @copyright{} 2009-2010 Mozilla Foundation\n \n See accompanying LICENSE.txt for terms.\n+\n @end titlepage\n \n+@everyfooting @| @emph{-- Draft @today --} @|\n+\n @ifnottex\n @node Top\n @top Top"}, {"sha": "93cb0b11af5882add14701121d03a08acea776b8", "filename": "src/Makefile", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=df0fa603d091eb92e9ce7d2be969ae78a11057e2", "patch": "@@ -209,7 +209,7 @@ endif\n # List them in link order.\n # Nobody calculates the link-order DAG automatically, sadly.\n \n-UTIL_BOT_MLS := $(addprefix boot/util/, fmt.ml common.ml bits.ml)\n+UTIL_BOT_MLS := $(addprefix boot/util/, version.ml fmt.ml common.ml bits.ml)\n DRIVER_BOT_MLS := $(addprefix boot/driver/, session.ml)\n BE_MLS := $(addprefix boot/be/, x86.ml ra.ml pe.ml elf.ml \\\n           macho.ml)\n@@ -256,10 +256,16 @@ STDLIB_INPUTS := $(wildcard lib/*.rc lib/*.rs lib/*/*.rs)\n COMPILER_CRATE := comp/rustc.rc\n COMPILER_INPUTS := $(wildcard comp/*.rc comp/*.rs comp/*/*.rs)\n \n-all: $(CFG_COMPILER) $(MKFILES) boot/fe/lexer.ml\n+GENERATED := boot/fe/lexer.ml boot/util/version.ml\n+\n+all: $(CFG_COMPILER) $(MKFILES) $(GENERATED)\n+\n+boot/util/version.ml: Makefile\n+\t$(CFG_QUIET)git log -1 \\\n+      --format='let version = \"prerelease (%h %ci)\";;' >$@\n \n loc:\n-\twc -l $(BOOT_MLS) $(RUNTIME_CS) $(RUNTIME_HDR)\n+\t$(CFG_QUIET)wc -l $(BOOT_MLS) $(RUNTIME_CS) $(RUNTIME_HDR)\n \n $(CFG_RUNTIME): $(RUNTIME_OBJS) $(MKFILES) $(RUNTIME_HDR)\n \t@$(call CFG_ECHO, compile: $<)\n@@ -742,15 +748,15 @@ tidy:\n \t$(CFG_QUIET) python etc/tidy.py \\\n       $(wildcard ../*.txt) \\\n       ../README \\\n-      $(filter-out boot/fe/lexer.ml $(PKG_3RDPARTY), $(PKG_FILES))\n+      $(filter-out $(GENERATED) $(PKG_3RDPARTY), $(PKG_FILES))\n \n clean:\n \t@$(call CFG_ECHO, cleaning)\n \t$(CFG_QUIET)rm -f $(RUNTIME_OBJS)\n \t$(CFG_QUIET)rm -f $(BOOT_CMOS) $(BOOT_CMIS) $(BOOT_CMXS) $(BOOT_OBJS)\n \t$(CFG_QUIET)rm -f $(CFG_COMPILER)\n \t$(CFG_QUIET)rm -f $(ML_DEPFILES) $(C_DEPFILES) $(CRATE_DEPFILES)\n-\t$(CFG_QUIET)rm -f boot/fe/lexer.ml\n+\t$(CFG_QUIET)rm -f $(GENERATED)\n \t$(CFG_QUIET)rm -f $(CFG_BOOT) $(CFG_RUNTIME) $(CFG_STDLIB)\n \t$(CFG_QUIET)rm -f $(TEST_RPASS_EXES_X86) $(TEST_RPASS_OUTS_X86)\n \t$(CFG_QUIET)rm -f $(TEST_RPASS_EXES_LLVM) $(TEST_RPASS_OUTS_LLVM)"}, {"sha": "9cb068efe06d01ef0579fb6e3d4feb42b0a487ef", "filename": "src/boot/driver/main.ml", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2Fboot%2Fdriver%2Fmain.ml", "raw_url": "https://github.com/rust-lang/rust/raw/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2Fboot%2Fdriver%2Fmain.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fdriver%2Fmain.ml?ref=df0fa603d091eb92e9ce7d2be969ae78a11057e2", "patch": "@@ -118,6 +118,11 @@ let dump_meta (filename:filename) : unit =\n   exit 0\n ;;\n \n+let print_version _ =\n+  Printf.fprintf stdout \"rustboot %s\\n\" Version.version;\n+  exit 0;\n+;;\n+\n let flag f opt desc =\n   (opt, Arg.Unit f, desc)\n ;;\n@@ -206,6 +211,8 @@ let argspecs =\n      \"report metadata from DWARF info in compiled file, then exit\");\n     (\"-rdeps\", Arg.Unit (fun _ -> sess.Session.sess_report_deps <- true),\n      \"report dependencies of input, then exit\");\n+    (\"-version\", Arg.Unit (fun _ -> print_version()),\n+     \"print version information, then exit\");\n   ] @ (Glue.alt_argspecs sess)\n ;;\n "}, {"sha": "a568db417bdae12e3a7a10f107f66f1a311ce498", "filename": "src/boot/me/dwarf.ml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2Fboot%2Fme%2Fdwarf.ml", "raw_url": "https://github.com/rust-lang/rust/raw/df0fa603d091eb92e9ce7d2be969ae78a11057e2/src%2Fboot%2Fme%2Fdwarf.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fme%2Fdwarf.ml?ref=df0fa603d091eb92e9ce7d2be969ae78a11057e2", "patch": "@@ -2238,7 +2238,7 @@ let dwarf_visitor\n       (SEQ [|\n          uleb abbrev_code;\n          (* DW_AT_producer:  DW_FORM_string *)\n-         ZSTRING \"Rustboot pre-release\";\n+         ZSTRING (\"Rustboot \" ^ Version.version);\n          (* DW_AT_language:  DW_FORM_data4 *)\n          WORD (word_ty_mach, IMM 0x2L);     (* DW_LANG_C *)\n          (* DW_AT_name:  DW_FORM_string *)"}]}