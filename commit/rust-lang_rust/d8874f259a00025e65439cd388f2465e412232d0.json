{"sha": "d8874f259a00025e65439cd388f2465e412232d0", "node_id": "C_kwDOAAsO6NoAKGQ4ODc0ZjI1OWEwMDAyNWU2NTQzOWNkMzg4ZjI0NjVlNDEyMjMyZDA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-25T15:42:35Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-25T16:32:26Z"}, "message": "fix more clippy::style findings\n\nmatch_result_ok\nobfuscated_if_else\nsingle_char_add\nwriteln_empty_string\ncollapsible_match\niter_cloned_collect\nunnecessary_mut_passed", "tree": {"sha": "f957ca4a58b2ecd48befc7b3959e0daa75743923", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f957ca4a58b2ecd48befc7b3959e0daa75743923"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d8874f259a00025e65439cd388f2465e412232d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d8874f259a00025e65439cd388f2465e412232d0", "html_url": "https://github.com/rust-lang/rust/commit/d8874f259a00025e65439cd388f2465e412232d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d8874f259a00025e65439cd388f2465e412232d0/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9ee0f468f8d07e92da94fe991db91e95822d721", "url": "https://api.github.com/repos/rust-lang/rust/commits/d9ee0f468f8d07e92da94fe991db91e95822d721", "html_url": "https://github.com/rust-lang/rust/commit/d9ee0f468f8d07e92da94fe991db91e95822d721"}], "stats": {"total": 167, "additions": 74, "deletions": 93}, "files": [{"sha": "4abb1d90f4485e6a3998da2ef721c69d858eb1b4", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -259,8 +259,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                         body.as_deref(),\n                     );\n \n-                    let mut itctx = ImplTraitContext::Universal;\n-                    let (generics, decl) = this.lower_generics(generics, id, &mut itctx, |this| {\n+                    let itctx = ImplTraitContext::Universal;\n+                    let (generics, decl) = this.lower_generics(generics, id, &itctx, |this| {\n                         let ret_id = asyncness.opt_return_id();\n                         this.lower_fn_decl(&decl, id, *fn_sig_span, FnDeclKind::Fn, ret_id)\n                     });\n@@ -369,9 +369,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 // method, it will not be considered an in-band\n                 // lifetime to be added, but rather a reference to a\n                 // parent lifetime.\n-                let mut itctx = ImplTraitContext::Universal;\n+                let itctx = ImplTraitContext::Universal;\n                 let (generics, (trait_ref, lowered_ty)) =\n-                    self.lower_generics(ast_generics, id, &mut itctx, |this| {\n+                    self.lower_generics(ast_generics, id, &itctx, |this| {\n                         let trait_ref = trait_ref.as_ref().map(|trait_ref| {\n                             this.lower_trait_ref(\n                                 trait_ref,\n@@ -590,9 +590,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             kind: match &i.kind {\n                 ForeignItemKind::Fn(box Fn { sig, generics, .. }) => {\n                     let fdec = &sig.decl;\n-                    let mut itctx = ImplTraitContext::Universal;\n+                    let itctx = ImplTraitContext::Universal;\n                     let (generics, (fn_dec, fn_args)) =\n-                        self.lower_generics(generics, i.id, &mut itctx, |this| {\n+                        self.lower_generics(generics, i.id, &itctx, |this| {\n                             (\n                                 // Disallow `impl Trait` in foreign items.\n                                 this.lower_fn_decl(\n@@ -1184,8 +1184,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         is_async: Option<(NodeId, Span)>,\n     ) -> (&'hir hir::Generics<'hir>, hir::FnSig<'hir>) {\n         let header = self.lower_fn_header(sig.header);\n-        let mut itctx = ImplTraitContext::Universal;\n-        let (generics, decl) = self.lower_generics(generics, id, &mut itctx, |this| {\n+        let itctx = ImplTraitContext::Universal;\n+        let (generics, decl) = self.lower_generics(generics, id, &itctx, |this| {\n             this.lower_fn_decl(&sig.decl, id, sig.span, kind, is_async)\n         });\n         (generics, hir::FnSig { header, decl, span: self.lower_span(sig.span) })"}, {"sha": "27e91095b28d16710acb63737846a8d75feec4fe", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -2031,15 +2031,15 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         &mut self,\n         output: &FnRetTy,\n         span: Span,\n-        mut nested_impl_trait_context: ImplTraitContext,\n+        nested_impl_trait_context: ImplTraitContext,\n     ) -> hir::GenericBound<'hir> {\n         // Compute the `T` in `Future<Output = T>` from the return type.\n         let output_ty = match output {\n             FnRetTy::Ty(ty) => {\n                 // Not `OpaqueTyOrigin::AsyncFn`: that's only used for the\n                 // `impl Future` opaque type that `async fn` implicitly\n                 // generates.\n-                self.lower_ty(ty, &mut nested_impl_trait_context)\n+                self.lower_ty(ty, &nested_impl_trait_context)\n             }\n             FnRetTy::Default(ret_ty_span) => self.arena.alloc(self.ty_tup(*ret_ty_span, &[])),\n         };"}, {"sha": "06d885a45fb7d9c015620804e806972aa8480364", "filename": "compiler/rustc_ast_lowering/src/pat.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_ast_lowering%2Fsrc%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fpat.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -37,7 +37,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n                             qself,\n                             path,\n                             ParamMode::Optional,\n-                            &mut ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n+                            &ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n                         );\n                         let (pats, ddpos) = self.lower_pat_tuple(pats, \"tuple struct\");\n                         break hir::PatKind::TupleStruct(qpath, pats, ddpos);\n@@ -53,7 +53,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n                             qself,\n                             path,\n                             ParamMode::Optional,\n-                            &mut ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n+                            &ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n                         );\n                         break hir::PatKind::Path(qpath);\n                     }\n@@ -63,7 +63,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n                             qself,\n                             path,\n                             ParamMode::Optional,\n-                            &mut ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n+                            &ImplTraitContext::Disallowed(ImplTraitPosition::Path),\n                         );\n \n                         let fs = self.arena.alloc_from_iter(fields.iter().map(|f| {"}, {"sha": "8fa43f8528cca2a6b0f7b1b1e96c633ae7761adc", "filename": "compiler/rustc_borrowck/src/type_check/input_output.rs", "status": "modified", "additions": 22, "deletions": 23, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Finput_output.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Finput_output.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Ftype_check%2Finput_output.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -37,31 +37,30 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n         // those.\n         //\n         // e.g., `|x: FxHashMap<_, &'static u32>| ...`\n-        let user_provided_sig;\n-        if !self.tcx().is_closure(mir_def_id.to_def_id()) {\n-            user_provided_sig = None;\n+        let user_provided_sig = if !self.tcx().is_closure(mir_def_id.to_def_id()) {\n+            None\n         } else {\n             let typeck_results = self.tcx().typeck(mir_def_id);\n-            user_provided_sig =\n-                typeck_results.user_provided_sigs.get(&mir_def_id).map(|user_provided_poly_sig| {\n-                    // Instantiate the canonicalized variables from\n-                    // user-provided signature (e.g., the `_` in the code\n-                    // above) with fresh variables.\n-                    let poly_sig = self.instantiate_canonical_with_fresh_inference_vars(\n-                        body.span,\n-                        &user_provided_poly_sig,\n-                    );\n-\n-                    // Replace the bound items in the fn sig with fresh\n-                    // variables, so that they represent the view from\n-                    // \"inside\" the closure.\n-                    self.infcx.replace_bound_vars_with_fresh_vars(\n-                        body.span,\n-                        LateBoundRegionConversionTime::FnCall,\n-                        poly_sig,\n-                    )\n-                });\n-        }\n+\n+            typeck_results.user_provided_sigs.get(&mir_def_id).map(|user_provided_poly_sig| {\n+                // Instantiate the canonicalized variables from\n+                // user-provided signature (e.g., the `_` in the code\n+                // above) with fresh variables.\n+                let poly_sig = self.instantiate_canonical_with_fresh_inference_vars(\n+                    body.span,\n+                    &user_provided_poly_sig,\n+                );\n+\n+                // Replace the bound items in the fn sig with fresh\n+                // variables, so that they represent the view from\n+                // \"inside\" the closure.\n+                self.infcx.replace_bound_vars_with_fresh_vars(\n+                    body.span,\n+                    LateBoundRegionConversionTime::FnCall,\n+                    poly_sig,\n+                )\n+            })\n+        };\n \n         debug!(?normalized_input_tys, ?body.local_decls);\n "}, {"sha": "3ae6c531b4453bedb7b466291d3ef6bd6726ea07", "filename": "compiler/rustc_codegen_ssa/src/debuginfo/type_names.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fdebuginfo%2Ftype_names.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -509,7 +509,7 @@ pub fn compute_debuginfo_vtable_name<'tcx>(\n         visited.clear();\n         push_generic_params_internal(tcx, trait_ref.substs, &mut vtable_name, &mut visited);\n     } else {\n-        vtable_name.push_str(\"_\");\n+        vtable_name.push('_');\n     }\n \n     push_close_angle_bracket(cpp_like_debuginfo, &mut vtable_name);"}, {"sha": "31e08c44d29812a12d2a62fbc34d4cbd0fa435d8", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -653,7 +653,7 @@ fn print_crate_info(\n     for req in &sess.opts.prints {\n         match *req {\n             TargetList => {\n-                let mut targets = rustc_target::spec::TARGETS.iter().copied().collect::<Vec<_>>();\n+                let mut targets = rustc_target::spec::TARGETS.to_vec();\n                 targets.sort_unstable();\n                 println!(\"{}\", targets.join(\"\\n\"));\n             }"}, {"sha": "b03352d5fec6b9274f4944ab122743cb646e2215", "filename": "compiler/rustc_errors/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Flib.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -1212,8 +1212,8 @@ impl HandlerInner {\n         self.taught_diagnostics.insert(code.clone())\n     }\n \n-    fn force_print_diagnostic(&mut self, mut db: Diagnostic) {\n-        self.emitter.emit_diagnostic(&mut db);\n+    fn force_print_diagnostic(&mut self, db: Diagnostic) {\n+        self.emitter.emit_diagnostic(&db);\n     }\n \n     /// Emit all stashed diagnostics."}, {"sha": "3e6bc81f67232f74b5df6b0809a9bd17b46981ec", "filename": "compiler/rustc_expand/src/mbe/macro_rules.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -1166,11 +1166,7 @@ fn check_matcher_core<'tt>(\n                                     err.note(&format!(\n                                         \"{}{} or {}\",\n                                         msg,\n-                                        ts[..ts.len() - 1]\n-                                            .iter()\n-                                            .copied()\n-                                            .collect::<Vec<_>>()\n-                                            .join(\", \"),\n+                                        ts[..ts.len() - 1].to_vec().join(\", \"),\n                                         ts[ts.len() - 1],\n                                     ));\n                                 }"}, {"sha": "4f27068429c6d0777f96c8d3f479b408c3d95f03", "filename": "compiler/rustc_hir_analysis/src/check/wfcheck.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fwfcheck.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -410,10 +410,7 @@ fn check_gat_where_clauses(tcx: TyCtxt<'_>, associated_items: &[hir::TraitItemRe\n                             tcx,\n                             param_env,\n                             item_hir_id,\n-                            tcx.explicit_item_bounds(item_def_id)\n-                                .iter()\n-                                .copied()\n-                                .collect::<Vec<_>>(),\n+                            tcx.explicit_item_bounds(item_def_id).to_vec(),\n                             &FxIndexSet::default(),\n                             gat_def_id.def_id,\n                             gat_generics,"}, {"sha": "a16bb7f1a5f47aaaf3e1b5105c3e16c3090c1866", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -355,14 +355,12 @@ impl LintStore {\n                     sub: RequestedLevel { level, lint_name },\n                 });\n             }\n-            CheckLintNameResult::Tool(result) => {\n-                if let Err((Some(_), new_name)) = result {\n-                    sess.emit_warning(CheckNameDeprecated {\n-                        lint_name: lint_name.clone(),\n-                        new_name,\n-                        sub: RequestedLevel { level, lint_name },\n-                    });\n-                }\n+            CheckLintNameResult::Tool(Err((Some(_), new_name))) => {\n+                sess.emit_warning(CheckNameDeprecated {\n+                    lint_name: lint_name.clone(),\n+                    new_name,\n+                    sub: RequestedLevel { level, lint_name },\n+                });\n             }\n             CheckLintNameResult::NoTool => {\n                 sess.emit_err(CheckNameUnknownTool {"}, {"sha": "2d0b5560e4d7b9a87053de481ba7d6bbac0b89f2", "filename": "compiler/rustc_metadata/src/rmeta/encoder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -1564,7 +1564,7 @@ impl<'a, 'tcx> EncodeContext<'a, 'tcx> {\n                 let trait_ref = self.tcx.impl_trait_ref(def_id);\n                 if let Some(trait_ref) = trait_ref {\n                     let trait_def = self.tcx.trait_def(trait_ref.def_id);\n-                    if let Some(mut an) = trait_def.ancestors(self.tcx, def_id).ok() {\n+                    if let Ok(mut an) = trait_def.ancestors(self.tcx, def_id) {\n                         if let Some(specialization_graph::Node::Impl(parent)) = an.nth(1) {\n                             self.tables.impl_parent.set(def_id.index, parent.into());\n                         }"}, {"sha": "99e692ccb584a8ac30c9f60e0c6b224cfaa814c7", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -704,12 +704,10 @@ impl<'hir> Map<'hir> {\n     pub fn get_return_block(self, id: HirId) -> Option<HirId> {\n         let mut iter = self.parent_iter(id).peekable();\n         let mut ignore_tail = false;\n-        if let Some(node) = self.find(id) {\n-            if let Node::Expr(Expr { kind: ExprKind::Ret(_), .. }) = node {\n-                // When dealing with `return` statements, we don't care about climbing only tail\n-                // expressions.\n-                ignore_tail = true;\n-            }\n+        if let Some(Node::Expr(Expr { kind: ExprKind::Ret(_), .. })) = self.find(id) {\n+            // When dealing with `return` statements, we don't care about climbing only tail\n+            // expressions.\n+            ignore_tail = true;\n         }\n         while let Some((hir_id, node)) = iter.next() {\n             if let (Some((_, next_node)), false) = (iter.peek(), ignore_tail) {"}, {"sha": "a89e6566d56affcb6dfeddb285a18e373bf3c663", "filename": "compiler/rustc_middle/src/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -2894,7 +2894,7 @@ fn pretty_print_const_value<'tcx>(\n                 if let Some(contents) = tcx.try_destructure_mir_constant(\n                     ty::ParamEnv::reveal_all().and(ConstantKind::Val(ct, ty)),\n                 ) {\n-                    let fields = contents.fields.iter().copied().collect::<Vec<_>>();\n+                    let fields = contents.fields.to_vec();\n                     match *ty.kind() {\n                         ty::Array(..) => {\n                             fmt.write_str(\"[\")?;"}, {"sha": "4f25fc71314ea1ae738d29bc4ceff7bc61695c2a", "filename": "compiler/rustc_monomorphize/src/partitioning/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_monomorphize%2Fsrc%2Fpartitioning%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_monomorphize%2Fsrc%2Fpartitioning%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_monomorphize%2Fsrc%2Fpartitioning%2Fmod.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -305,7 +305,7 @@ where\n                 );\n             }\n \n-            let _ = writeln!(s, \"\");\n+            let _ = writeln!(s);\n         }\n \n         std::mem::take(s)"}, {"sha": "c59c06ac31ed7ca11f82b8d649fd8e14f997c40b", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -1090,9 +1090,7 @@ impl CheckAttrVisitor<'_> {\n                                     errors::DocTestUnknownInclude {\n                                         path,\n                                         value: value.to_string(),\n-                                        inner: (attr.style == AttrStyle::Inner)\n-                                            .then_some(\"!\")\n-                                            .unwrap_or(\"\"),\n+                                        inner: if attr.style == AttrStyle::Inner { \"!\" } else { \"\" },\n                                         sugg: (attr.meta().unwrap().span, applicability),\n                                     }\n                                 );"}, {"sha": "472086eca8feb698bafb629b699d9c9b803984db", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 19, "deletions": 24, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8874f259a00025e65439cd388f2465e412232d0/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=d8874f259a00025e65439cd388f2465e412232d0", "patch": "@@ -1291,29 +1291,25 @@ impl<'tcx> TypeErrCtxtExt<'tcx> for TypeErrCtxt<'_, 'tcx> {\n \n         if let ObligationCauseCode::AwaitableExpr(hir_id) = obligation.cause.code().peel_derives() {\n             let hir = self.tcx.hir();\n-            if let Some(node) = hir_id.and_then(|hir_id| hir.find(hir_id)) {\n-                if let hir::Node::Expr(expr) = node {\n-                    // FIXME: use `obligation.predicate.kind()...trait_ref.self_ty()` to see if we have `()`\n-                    // and if not maybe suggest doing something else? If we kept the expression around we\n-                    // could also check if it is an fn call (very likely) and suggest changing *that*, if\n-                    // it is from the local crate.\n-                    err.span_suggestion(\n-                        span,\n-                        \"remove the `.await`\",\n-                        \"\",\n-                        Applicability::MachineApplicable,\n-                    );\n-                    // FIXME: account for associated `async fn`s.\n-                    if let hir::Expr { span, kind: hir::ExprKind::Call(base, _), .. } = expr {\n-                        if let ty::PredicateKind::Clause(ty::Clause::Trait(pred)) =\n-                            obligation.predicate.kind().skip_binder()\n-                        {\n-                            err.span_label(\n-                                *span,\n-                                &format!(\"this call returns `{}`\", pred.self_ty()),\n-                            );\n-                        }\n-                        if let Some(typeck_results) = &self.typeck_results\n+            if let Some(hir::Node::Expr(expr)) = hir_id.and_then(|hir_id| hir.find(hir_id)) {\n+                // FIXME: use `obligation.predicate.kind()...trait_ref.self_ty()` to see if we have `()`\n+                // and if not maybe suggest doing something else? If we kept the expression around we\n+                // could also check if it is an fn call (very likely) and suggest changing *that*, if\n+                // it is from the local crate.\n+                err.span_suggestion(\n+                    span,\n+                    \"remove the `.await`\",\n+                    \"\",\n+                    Applicability::MachineApplicable,\n+                );\n+                // FIXME: account for associated `async fn`s.\n+                if let hir::Expr { span, kind: hir::ExprKind::Call(base, _), .. } = expr {\n+                    if let ty::PredicateKind::Clause(ty::Clause::Trait(pred)) =\n+                        obligation.predicate.kind().skip_binder()\n+                    {\n+                        err.span_label(*span, &format!(\"this call returns `{}`\", pred.self_ty()));\n+                    }\n+                    if let Some(typeck_results) = &self.typeck_results\n                             && let ty = typeck_results.expr_ty_adjusted(base)\n                             && let ty::FnDef(def_id, _substs) = ty.kind()\n                             && let Some(hir::Node::Item(hir::Item { ident, span, vis_span, .. })) =\n@@ -1339,7 +1335,6 @@ impl<'tcx> TypeErrCtxtExt<'tcx> for TypeErrCtxt<'_, 'tcx> {\n                                 );\n                             }\n                         }\n-                    }\n                 }\n             }\n         }"}]}