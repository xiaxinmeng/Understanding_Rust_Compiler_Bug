{"sha": "ea2c8bfb041bad805578d0ec50b46b0675ca0187", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhMmM4YmZiMDQxYmFkODA1NTc4ZDBlYzUwYjQ2YjA2NzVjYTAxODc=", "commit": {"author": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-05-30T15:43:27Z"}, "committer": {"name": "Oliver Schneider", "email": "github35764891676564198441@oli-obk.de", "date": "2018-05-30T15:43:27Z"}, "message": "`align_offset` intrinsic is now a lang item", "tree": {"sha": "26651098c0a3bed2366385010b088eb64dbe4049", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26651098c0a3bed2366385010b088eb64dbe4049"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea2c8bfb041bad805578d0ec50b46b0675ca0187", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea2c8bfb041bad805578d0ec50b46b0675ca0187", "html_url": "https://github.com/rust-lang/rust/commit/ea2c8bfb041bad805578d0ec50b46b0675ca0187", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea2c8bfb041bad805578d0ec50b46b0675ca0187/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e4f075459c5b9bb83ca695cf139581e07587bc15", "url": "https://api.github.com/repos/rust-lang/rust/commits/e4f075459c5b9bb83ca695cf139581e07587bc15", "html_url": "https://github.com/rust-lang/rust/commit/e4f075459c5b9bb83ca695cf139581e07587bc15"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "fdaa819c08f7ad456a4cc0ed51d1560524e79a94", "filename": "src/fn_call.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ea2c8bfb041bad805578d0ec50b46b0675ca0187/src%2Ffn_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea2c8bfb041bad805578d0ec50b46b0675ca0187/src%2Ffn_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ffn_call.rs?ref=ea2c8bfb041bad805578d0ec50b46b0675ca0187", "patch": "@@ -135,6 +135,18 @@ impl<'a, 'mir, 'tcx: 'mir + 'a> EvalContextExt<'tcx> for EvalContext<'a, 'mir, '\n             _ => {}\n         }\n \n+        if self.tcx.lang_items().align_offset_fn() == Some(instance.def.def_id()) {\n+            // FIXME: return a real value in case the target allocation has an\n+            // alignment bigger than the one requested\n+            let n = u128::max_value();\n+            let amt = 128 - self.memory.pointer_size().bytes() * 8;\n+            let (dest, return_to_block) = destination.unwrap();\n+            let ty = self.tcx.types.usize;\n+            self.write_scalar(dest, Scalar::from_u128((n << amt) >> amt), ty)?;\n+            self.goto_block(return_to_block);\n+            return Ok(true);\n+        }\n+\n         let mir = match self.load_mir(instance.def) {\n             Ok(mir) => mir,\n             Err(EvalError { kind: EvalErrorKind::NoMirFor(path), .. }) => {"}, {"sha": "cee2f1ab7682fb9e0cc7e71ffa76f7a51dce2966", "filename": "src/intrinsic.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ea2c8bfb041bad805578d0ec50b46b0675ca0187/src%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea2c8bfb041bad805578d0ec50b46b0675ca0187/src%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fintrinsic.rs?ref=ea2c8bfb041bad805578d0ec50b46b0675ca0187", "patch": "@@ -33,14 +33,6 @@ impl<'a, 'mir, 'tcx> EvalContextExt<'tcx> for EvalContext<'a, 'mir, 'tcx, super:\n \n         let intrinsic_name = &self.tcx.item_name(instance.def_id()).as_str()[..];\n         match intrinsic_name {\n-            \"align_offset\" => {\n-                // FIXME: return a real value in case the target allocation has an\n-                // alignment bigger than the one requested\n-                let n = u128::max_value();\n-                let amt = 128 - self.memory.pointer_size().bytes() * 8;\n-                self.write_scalar(dest, Scalar::from_u128((n << amt) >> amt), dest_layout.ty)?;\n-            },\n-\n             \"add_with_overflow\" => {\n                 self.intrinsic_with_overflow(\n                     mir::BinOp::Add,"}]}