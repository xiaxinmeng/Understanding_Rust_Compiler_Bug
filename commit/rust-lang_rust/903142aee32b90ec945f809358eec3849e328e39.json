{"sha": "903142aee32b90ec945f809358eec3849e328e39", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwMzE0MmFlZTMyYjkwZWM5NDVmODA5MzU4ZWVjMzg0OWUzMjhlMzk=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-08-01T23:56:19Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-08-02T09:31:25Z"}, "message": "dump statistics about re-use w/ -Z time-passes\n\nIt's nice to get a rough idea of how much work we're\nsaving.", "tree": {"sha": "0e6341a5c66d3cfb93c1180613fd13d02b83e92a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e6341a5c66d3cfb93c1180613fd13d02b83e92a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/903142aee32b90ec945f809358eec3849e328e39", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/903142aee32b90ec945f809358eec3849e328e39", "html_url": "https://github.com/rust-lang/rust/commit/903142aee32b90ec945f809358eec3849e328e39", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/903142aee32b90ec945f809358eec3849e328e39/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e7df800986cb7eee66cfbb4bd98104c45189d57", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7df800986cb7eee66cfbb4bd98104c45189d57", "html_url": "https://github.com/rust-lang/rust/commit/2e7df800986cb7eee66cfbb4bd98104c45189d57"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "4b8d6776f221e71765e7784cfe3a2e3049ec2d8b", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/903142aee32b90ec945f809358eec3849e328e39/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/903142aee32b90ec945f809358eec3849e328e39/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=903142aee32b90ec945f809358eec3849e328e39", "patch": "@@ -724,6 +724,10 @@ pub fn run_passes(sess: &Session,\n         work_items.push(work);\n     }\n \n+    if sess.time_passes() && sess.opts.incremental.is_some() {\n+        dump_incremental_data(&trans);\n+    }\n+\n     // Process the work items, optionally using worker threads.\n     // NOTE: This code is not really adapted to incremental compilation where\n     //       the compiler decides the number of codegen units (and will\n@@ -901,6 +905,17 @@ pub fn run_passes(sess: &Session,\n     }\n }\n \n+fn dump_incremental_data(trans: &CrateTranslation) {\n+    let mut reuse = 0;\n+    for mtrans in trans.modules.iter() {\n+        match mtrans.source {\n+            ModuleSource::Preexisting(..) => reuse += 1,\n+            ModuleSource::Translated(..) => (),\n+        }\n+    }\n+    println!(\"incremental: re-using {} out of {} modules\", reuse, trans.modules.len());\n+}\n+\n struct WorkItem {\n     mtrans: ModuleTranslation,\n     config: ModuleConfig,"}]}