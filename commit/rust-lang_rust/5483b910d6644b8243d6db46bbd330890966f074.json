{"sha": "5483b910d6644b8243d6db46bbd330890966f074", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0ODNiOTEwZDY2NDRiODI0M2Q2ZGI0NmJiZDMzMDg5MDk2NmYwNzQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-29T18:07:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-29T18:07:42Z"}, "message": "Convert a block to a fn in trans_ivec::trans_add\n\nThe block was not valgrind-clean", "tree": {"sha": "9c8d14222ca9a70e2c2a33f4046ab14a128a1450", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c8d14222ca9a70e2c2a33f4046ab14a128a1450"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5483b910d6644b8243d6db46bbd330890966f074", "comment_count": 4, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5483b910d6644b8243d6db46bbd330890966f074", "html_url": "https://github.com/rust-lang/rust/commit/5483b910d6644b8243d6db46bbd330890966f074", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5483b910d6644b8243d6db46bbd330890966f074/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f41bc854d896cede16f075e9b3090fc234f6996", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f41bc854d896cede16f075e9b3090fc234f6996", "html_url": "https://github.com/rust-lang/rust/commit/9f41bc854d896cede16f075e9b3090fc234f6996"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "2ec97916b05dde932e21010dafa5863c5c2bd9e6", "filename": "src/comp/middle/trans_ivec.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5483b910d6644b8243d6db46bbd330890966f074/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5483b910d6644b8243d6db46bbd330890966f074/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_ivec.rs?ref=5483b910d6644b8243d6db46bbd330890966f074", "patch": "@@ -202,7 +202,9 @@ fn trans_add(bcx: &@block_ctxt, vec_ty: ty::t, lhs: ValueRef,\n         alloc(bcx, vec_ty, new_fill, true);\n \n     let write_ptr_ptr = do_spill(bcx, get_dataptr(bcx, new_vec, llunitty));\n-    let copy_block = { | &bcx, addr, _ty |\n+    let copy_fn = bind fn(bcx: &@block_ctxt, addr: ValueRef, _ty: ty::t,\n+                          write_ptr_ptr: ValueRef, unit_ty: ty::t,\n+                          llunitsz: ValueRef) -> result {\n         let write_ptr = Load(bcx, write_ptr_ptr);\n         let bcx = copy_val(bcx, INIT, write_ptr,\n                            load_if_immediate(bcx, addr, unit_ty), unit_ty);\n@@ -213,10 +215,10 @@ fn trans_add(bcx: &@block_ctxt, vec_ty: ty::t, lhs: ValueRef,\n             incr_ptr(bcx, write_ptr, C_int(1), write_ptr_ptr);\n         }\n         ret rslt(bcx, C_nil());\n-    };\n+    } (_, _, _, write_ptr_ptr, unit_ty, llunitsz);\n \n-    let bcx = iter_ivec_raw(bcx, lhs, vec_ty, lhs_fill, copy_block).bcx;\n-    let bcx = iter_ivec_raw(bcx, rhs, vec_ty, rhs_fill, copy_block).bcx;\n+    let bcx = iter_ivec_raw(bcx, lhs, vec_ty, lhs_fill, copy_fn).bcx;\n+    let bcx = iter_ivec_raw(bcx, rhs, vec_ty, rhs_fill, copy_fn).bcx;\n     ret rslt(bcx, new_vec);\n }\n "}]}