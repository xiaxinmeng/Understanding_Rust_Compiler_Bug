{"sha": "461aada2fe0f1305b99b527b1b5ff8696a3e9ccc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2MWFhZGEyZmUwZjEzMDViOTliNTI3YjFiNWZmODY5NmEzZTljY2M=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-01-27T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2020-01-27T16:01:30Z"}, "message": "Add use after scope example to the unstable book", "tree": {"sha": "f36cd28786c76542020321f73c71662820366993", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f36cd28786c76542020321f73c71662820366993"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc", "html_url": "https://github.com/rust-lang/rust/commit/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08a1c566a792dcf9657d293155f7ada87746bb65", "url": "https://api.github.com/repos/rust-lang/rust/commits/08a1c566a792dcf9657d293155f7ada87746bb65", "html_url": "https://github.com/rust-lang/rust/commit/08a1c566a792dcf9657d293155f7ada87746bb65"}], "stats": {"total": 74, "additions": 74, "deletions": 0}, "files": [{"sha": "64bff2a6fe0b46bc169fac3ec0421b321a5e0316", "filename": "src/doc/unstable-book/src/compiler-flags/sanitizer.md", "status": "modified", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md", "raw_url": "https://github.com/rust-lang/rust/raw/461aada2fe0f1305b99b527b1b5ff8696a3e9ccc/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsanitizer.md?ref=461aada2fe0f1305b99b527b1b5ff8696a3e9ccc", "patch": "@@ -93,6 +93,80 @@ Shadow byte legend (one shadow byte represents 8 application bytes):\n ==10029==ABORTING\n ```\n \n+Use of a stack object after its scope has already ended:\n+\n+```shell\n+$ cat b.rs\n+static mut P: *mut usize = std::ptr::null_mut();\n+\n+fn main() {\n+    unsafe {\n+        {\n+            let mut x = 0;\n+            P = &mut x;\n+        }\n+        std::ptr::write_volatile(P, 123);\n+    }\n+}\n+$ rustc -Zsanitizer=address b.rs\n+$./b\n+=================================================================\n+==424427==ERROR: AddressSanitizer: stack-use-after-scope on address 0x7fff67be6be0 at pc 0x5647a3ea4658 bp 0x7fff67be6b90 sp 0x7fff67be6b88\n+WRITE of size 8 at 0x7fff67be6be0 thread T0\n+    #0 0x5647a3ea4657 in core::ptr::write_volatile::h4b04601757d0376d (/tmp/b+0xb8657)\n+    #1 0x5647a3ea4432 in b::main::h5574a756e615c9cf (/tmp/b+0xb8432)\n+    #2 0x5647a3ea480b in std::rt::lang_start::_$u7b$$u7b$closure$u7d$$u7d$::hd57e7ee01866077e (/tmp/b+0xb880b)\n+    #3 0x5647a3eab412 in std::panicking::try::do_call::he0421ca82dd11ba3 (.llvm.8083791802951296215) (/tmp/b+0xbf412)\n+    #4 0x5647a3eacb26 in __rust_maybe_catch_panic (/tmp/b+0xc0b26)\n+    #5 0x5647a3ea5b66 in std::rt::lang_start_internal::h19bc96b28f670a64 (/tmp/b+0xb9b66)\n+    #6 0x5647a3ea4788 in std::rt::lang_start::h642d10b4b6965fb8 (/tmp/b+0xb8788)\n+    #7 0x5647a3ea449a in main (/tmp/b+0xb849a)\n+    #8 0x7fd1d18b3bba in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x26bba)\n+    #9 0x5647a3df7299 in _start (/tmp/b+0xb299)\n+\n+Address 0x7fff67be6be0 is located in stack of thread T0 at offset 32 in frame\n+    #0 0x5647a3ea433f in b::main::h5574a756e615c9cf (/tmp/b+0xb833f)\n+\n+  This frame has 1 object(s):\n+    [32, 40) 'x' <== Memory access at offset 32 is inside this variable\n+HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork\n+      (longjmp and C++ exceptions *are* supported)\n+SUMMARY: AddressSanitizer: stack-use-after-scope (/tmp/b+0xb8657) in core::ptr::write_volatile::h4b04601757d0376d\n+Shadow bytes around the buggy address:\n+  0x10006cf74d20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74d30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74d40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74d50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74d60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+=>0x10006cf74d70: 00 00 00 00 00 00 00 00 f1 f1 f1 f1[f8]f3 f3 f3\n+  0x10006cf74d80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74d90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74da0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74db0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n+  0x10006cf74dc0: f1 f1 f1 f1 00 f3 f3 f3 00 00 00 00 00 00 00 00\n+Shadow byte legend (one shadow byte represents 8 application bytes):\n+  Addressable:           00\n+  Partially addressable: 01 02 03 04 05 06 07\n+  Heap left redzone:       fa\n+  Freed heap region:       fd\n+  Stack left redzone:      f1\n+  Stack mid redzone:       f2\n+  Stack right redzone:     f3\n+  Stack after return:      f5\n+  Stack use after scope:   f8\n+  Global redzone:          f9\n+  Global init order:       f6\n+  Poisoned by user:        f7\n+  Container overflow:      fc\n+  Array cookie:            ac\n+  Intra object redzone:    bb\n+  ASan internal:           fe\n+  Left alloca redzone:     ca\n+  Right alloca redzone:    cb\n+  Shadow gap:              cc\n+==424427==ABORTING\n+```\n+\n ## MemorySanitizer\n \n Use of uninitialized memory. Note that we are using `-Zbuild-std` to instrument"}]}