{"sha": "75614c06ee2212bf171a301e6d6e0a2f5429126f", "node_id": "C_kwDOAAsO6NoAKDc1NjE0YzA2ZWUyMjEyYmYxNzFhMzAxZTZkNmUwYTJmNTQyOTEyNmY", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2022-02-09T22:48:06Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2022-02-20T23:58:23Z"}, "message": "Delete Decoder::read_enum_variant", "tree": {"sha": "968ead33f9be7339398c6e69d5a5d1c95ce8f8b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/968ead33f9be7339398c6e69d5a5d1c95ce8f8b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75614c06ee2212bf171a301e6d6e0a2f5429126f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75614c06ee2212bf171a301e6d6e0a2f5429126f", "html_url": "https://github.com/rust-lang/rust/commit/75614c06ee2212bf171a301e6d6e0a2f5429126f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75614c06ee2212bf171a301e6d6e0a2f5429126f/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8def096c4de13ba04617040a7848c864b171fde4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8def096c4de13ba04617040a7848c864b171fde4", "html_url": "https://github.com/rust-lang/rust/commit/8def096c4de13ba04617040a7848c864b171fde4"}], "stats": {"total": 31, "additions": 9, "deletions": 22}, "files": [{"sha": "535158ffd8d844d4461109681c175ef8d0daf627", "filename": "compiler/rustc_macros/src/serialize.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/75614c06ee2212bf171a301e6d6e0a2f5429126f/compiler%2Frustc_macros%2Fsrc%2Fserialize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75614c06ee2212bf171a301e6d6e0a2f5429126f/compiler%2Frustc_macros%2Fsrc%2Fserialize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fserialize.rs?ref=75614c06ee2212bf171a301e6d6e0a2f5429126f", "patch": "@@ -58,14 +58,10 @@ fn decodable_body(\n                 variants.len()\n             );\n             quote! {\n-                ::rustc_serialize::Decoder::read_enum_variant(\n-                    __decoder,\n-                    |__decoder, __variant_idx| {\n-                        match __variant_idx {\n-                            #match_inner\n-                            _ => panic!(#message),\n-                        }\n-                    })\n+                match ::rustc_serialize::Decoder::read_usize(__decoder) {\n+                    #match_inner\n+                    _ => panic!(#message),\n+                }\n             }\n         }\n     };"}, {"sha": "10aec0294d094ccc37214068005e25e75fc66bd6", "filename": "compiler/rustc_serialize/src/serialize.rs", "status": "modified", "additions": 5, "deletions": 14, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/75614c06ee2212bf171a301e6d6e0a2f5429126f/compiler%2Frustc_serialize%2Fsrc%2Fserialize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75614c06ee2212bf171a301e6d6e0a2f5429126f/compiler%2Frustc_serialize%2Fsrc%2Fserialize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_serialize%2Fsrc%2Fserialize.rs?ref=75614c06ee2212bf171a301e6d6e0a2f5429126f", "patch": "@@ -201,15 +201,6 @@ pub trait Decoder {\n     fn read_str(&mut self) -> Cow<'_, str>;\n     fn read_raw_bytes_into(&mut self, s: &mut [u8]);\n \n-    #[inline]\n-    fn read_enum_variant<T, F>(&mut self, mut f: F) -> T\n-    where\n-        F: FnMut(&mut Self, usize) -> T,\n-    {\n-        let disr = self.read_usize();\n-        f(self, disr)\n-    }\n-\n     fn read_seq<T, F>(&mut self, f: F) -> T\n     where\n         F: FnOnce(&mut Self, usize) -> T,\n@@ -473,11 +464,11 @@ impl<S: Encoder, T: Encodable<S>> Encodable<S> for Option<T> {\n \n impl<D: Decoder, T: Decodable<D>> Decodable<D> for Option<T> {\n     fn decode(d: &mut D) -> Option<T> {\n-        d.read_enum_variant(move |this, idx| match idx {\n+        match d.read_usize() {\n             0 => None,\n-            1 => Some(Decodable::decode(this)),\n+            1 => Some(Decodable::decode(d)),\n             _ => panic!(\"Encountered invalid discriminant while decoding `Option`.\"),\n-        })\n+        }\n     }\n }\n \n@@ -496,11 +487,11 @@ impl<S: Encoder, T1: Encodable<S>, T2: Encodable<S>> Encodable<S> for Result<T1,\n \n impl<D: Decoder, T1: Decodable<D>, T2: Decodable<D>> Decodable<D> for Result<T1, T2> {\n     fn decode(d: &mut D) -> Result<T1, T2> {\n-        d.read_enum_variant(|d, disr| match disr {\n+        match d.read_usize() {\n             0 => Ok(T1::decode(d)),\n             1 => Err(T2::decode(d)),\n             _ => panic!(\"Encountered invalid discriminant while decoding `Result`.\"),\n-        })\n+        }\n     }\n }\n "}]}