{"sha": "aff7994740c7b2b2a7532f931ad2af65141037ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmZjc5OTQ3NDBjN2IyYjJhNzUzMmY5MzFhZDJhZjY1MTQxMDM3YmE=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-06-17T12:56:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-17T12:56:45Z"}, "message": "Rollup merge of #86355 - JohnTitor:issue-82158, r=estebank\n\nRemove invalid suggestions for assoc consts on placeholder type error\n\nFixes #82158\nThis also moves some tests to typeck.\nr? ``@estebank``", "tree": {"sha": "f1c0a5e0913d033446e4d4805c879127371ee5f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1c0a5e0913d033446e4d4805c879127371ee5f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aff7994740c7b2b2a7532f931ad2af65141037ba", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgy0aOCRBK7hj4Ov3rIwAAssMIABPF5PUax3G4VOnX4exoKaVV\n0d/7VRslG6YhXxPIvM0nY92YL2liIIPde0znkydtX5YC5PZGJGppWZNKyzyB4yf3\n4zuKw00LzVkMPx8ZJH7Q9CFZe87xSsPRA8331ODVKXyOyt1QTjyU3KCE9wPRLiKl\n2NUx4nbmef7QoT7uZ1/YHfQ77GCT+qwK7qFkpEKuK0P7zN0YhAAhlpUrqE0euwIG\n8+akN80YvnKapUdYTrS9KosPB5w8AyjedZcmPOsnZIuGSrpYfIQdtCvNxPr0iUoz\nmVSrxVyJVzXV4/TVBrTINCuq1P7WYTPoT9nCrN8Ugu1WBuoZJ+MGhIGd7w9pDAQ=\n=LIYS\n-----END PGP SIGNATURE-----\n", "payload": "tree f1c0a5e0913d033446e4d4805c879127371ee5f2\nparent afe70ee4408e750454ac65f8eab0cd4fa266e9c5\nparent fb06d9e0cdffd8b6bcb1eb7f41f0237038611a17\nauthor Yuki Okushi <jtitor@2k36.org> 1623934605 +0900\ncommitter GitHub <noreply@github.com> 1623934605 +0900\n\nRollup merge of #86355 - JohnTitor:issue-82158, r=estebank\n\nRemove invalid suggestions for assoc consts on placeholder type error\n\nFixes #82158\nThis also moves some tests to typeck.\nr? ``@estebank``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aff7994740c7b2b2a7532f931ad2af65141037ba", "html_url": "https://github.com/rust-lang/rust/commit/aff7994740c7b2b2a7532f931ad2af65141037ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aff7994740c7b2b2a7532f931ad2af65141037ba/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "afe70ee4408e750454ac65f8eab0cd4fa266e9c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/afe70ee4408e750454ac65f8eab0cd4fa266e9c5", "html_url": "https://github.com/rust-lang/rust/commit/afe70ee4408e750454ac65f8eab0cd4fa266e9c5"}, {"sha": "fb06d9e0cdffd8b6bcb1eb7f41f0237038611a17", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb06d9e0cdffd8b6bcb1eb7f41f0237038611a17", "html_url": "https://github.com/rust-lang/rust/commit/fb06d9e0cdffd8b6bcb1eb7f41f0237038611a17"}], "stats": {"total": 61, "additions": 51, "deletions": 10}, "files": [{"sha": "248669a2c0cb8cbc9502e2e6977bd87ee18a71d2", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "patch": "@@ -179,8 +179,7 @@ crate fn placeholder_type_error(\n     // Suggest, but only if it is not a function in const or static\n     if suggest {\n         let mut is_fn = false;\n-        let mut is_const = false;\n-        let mut is_static = false;\n+        let mut is_const_or_static = false;\n \n         if let Some(hir_ty) = hir_ty {\n             if let hir::TyKind::BareFn(_) = hir_ty.kind {\n@@ -190,19 +189,26 @@ crate fn placeholder_type_error(\n                 let parent_id = tcx.hir().get_parent_node(hir_ty.hir_id);\n                 let parent_node = tcx.hir().get(parent_id);\n \n-                if let hir::Node::Item(item) = parent_node {\n-                    if let hir::ItemKind::Const(_, _) = item.kind {\n-                        is_const = true;\n-                    } else if let hir::ItemKind::Static(_, _, _) = item.kind {\n-                        is_static = true;\n-                    }\n-                }\n+                is_const_or_static = match parent_node {\n+                    Node::Item(&hir::Item {\n+                        kind: hir::ItemKind::Const(..) | hir::ItemKind::Static(..),\n+                        ..\n+                    })\n+                    | Node::TraitItem(&hir::TraitItem {\n+                        kind: hir::TraitItemKind::Const(..),\n+                        ..\n+                    })\n+                    | Node::ImplItem(&hir::ImplItem {\n+                        kind: hir::ImplItemKind::Const(..), ..\n+                    }) => true,\n+                    _ => false,\n+                };\n             }\n         }\n \n         // if function is wrapped around a const or static,\n         // then don't show the suggestion\n-        if !(is_fn && (is_const || is_static)) {\n+        if !(is_fn && is_const_or_static) {\n             err.multipart_suggestion(\n                 \"use type parameters instead\",\n                 sugg,"}, {"sha": "f68a665b2f38d949507c63253ba0c3a0fca81268", "filename": "src/test/ui/typeck/issue-74086.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/issues/issue-74086.rs"}, {"sha": "e602425059e1b893cbd25d921e4e9b9d5f2c0e1d", "filename": "src/test/ui/typeck/issue-74086.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-74086.stderr?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/issues/issue-74086.stderr"}, {"sha": "86c39d4a48c05cc037a834432b6fb2cf04973098", "filename": "src/test/ui/typeck/issue-81885.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/issues/issue-81885.rs"}, {"sha": "955b4283874421015017af2163978d0d4a4f5718", "filename": "src/test/ui/typeck/issue-81885.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fissue-81885.stderr?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/issues/issue-81885.stderr"}, {"sha": "c27edc8485b9242b83621888261fb677c0afff45", "filename": "src/test/ui/typeck/type-placeholder-fn-in-const.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "patch": "@@ -0,0 +1,14 @@\n+struct MyStruct;\n+\n+trait Test {\n+    const TEST: fn() -> _;\n+    //~^ ERROR: the type placeholder `_` is not allowed within types on item signatures [E0121]\n+    //~| ERROR: the type placeholder `_` is not allowed within types on item signatures [E0121]\n+}\n+\n+impl Test for MyStruct {\n+    const TEST: fn() -> _ = 42;\n+    //~^ ERROR: the type placeholder `_` is not allowed within types on item signatures [E0121]\n+}\n+\n+fn main() {}"}, {"sha": "662871779a10ee4d6aed3e54fed6df110fd79f96", "filename": "src/test/ui/typeck/type-placeholder-fn-in-const.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftype-placeholder-fn-in-const.stderr?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "patch": "@@ -0,0 +1,21 @@\n+error[E0121]: the type placeholder `_` is not allowed within types on item signatures\n+  --> $DIR/type-placeholder-fn-in-const.rs:4:25\n+   |\n+LL |     const TEST: fn() -> _;\n+   |                         ^ not allowed in type signatures\n+\n+error[E0121]: the type placeholder `_` is not allowed within types on item signatures\n+  --> $DIR/type-placeholder-fn-in-const.rs:4:25\n+   |\n+LL |     const TEST: fn() -> _;\n+   |                         ^ not allowed in type signatures\n+\n+error[E0121]: the type placeholder `_` is not allowed within types on item signatures\n+  --> $DIR/type-placeholder-fn-in-const.rs:10:25\n+   |\n+LL |     const TEST: fn() -> _ = 42;\n+   |                         ^ not allowed in type signatures\n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0121`."}, {"sha": "2530a1e966d0a8a59e3b1d4ade2acea6fa9dea3a", "filename": "src/test/ui/typeck/typeck-closure-to-unsafe-fn-ptr.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-closure-to-unsafe-fn-ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-closure-to-unsafe-fn-ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-closure-to-unsafe-fn-ptr.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/typeck-closure-to-unsafe-fn-ptr.rs"}, {"sha": "1e954f5690956bffc54a033888027c13e16c2704", "filename": "src/test/ui/typeck/typeck-fn-to-unsafe-fn-ptr.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-fn-to-unsafe-fn-ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-fn-to-unsafe-fn-ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftypeck-fn-to-unsafe-fn-ptr.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/typeck-fn-to-unsafe-fn-ptr.rs"}, {"sha": "ea7aa5285b09d52acc520b9c6c90ad4e3cae6e41", "filename": "src/test/ui/typeck/typeck_type_placeholder_1.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck_type_placeholder_1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aff7994740c7b2b2a7532f931ad2af65141037ba/src%2Ftest%2Fui%2Ftypeck%2Ftypeck_type_placeholder_1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Ftypeck_type_placeholder_1.rs?ref=aff7994740c7b2b2a7532f931ad2af65141037ba", "previous_filename": "src/test/ui/typeck_type_placeholder_1.rs"}]}