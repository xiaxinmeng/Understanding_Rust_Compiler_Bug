{"sha": "e79ba76ec462031c9d5fa2130bc631600bc6d875", "node_id": "C_kwDOAAsO6NoAKGU3OWJhNzZlYzQ2MjAzMWM5ZDVmYTIxMzBiYzYzMTYwMGJjNmQ4NzU", "commit": {"author": {"name": "Peh", "email": "20146907+randomicon00@users.noreply.github.com", "date": "2022-03-30T00:29:29Z"}, "committer": {"name": "Peh", "email": "20146907+randomicon00@users.noreply.github.com", "date": "2022-05-05T23:56:40Z"}, "message": "Fixing #95444 by only displaying passes that take more than 5 milliseconds\n\n95444: Adding passes that include memory increase\n\nFix95444: Change the substraction with the abs_diff() method\n\nFix95444: Change the substraction with abs_diff() method", "tree": {"sha": "76ca42133ed474ecd2768fb965cb9552a9dbad80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76ca42133ed474ecd2768fb965cb9552a9dbad80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e79ba76ec462031c9d5fa2130bc631600bc6d875", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e79ba76ec462031c9d5fa2130bc631600bc6d875", "html_url": "https://github.com/rust-lang/rust/commit/e79ba76ec462031c9d5fa2130bc631600bc6d875", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e79ba76ec462031c9d5fa2130bc631600bc6d875/comments", "author": {"login": "randomicon00", "id": 20146907, "node_id": "MDQ6VXNlcjIwMTQ2OTA3", "avatar_url": "https://avatars.githubusercontent.com/u/20146907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/randomicon00", "html_url": "https://github.com/randomicon00", "followers_url": "https://api.github.com/users/randomicon00/followers", "following_url": "https://api.github.com/users/randomicon00/following{/other_user}", "gists_url": "https://api.github.com/users/randomicon00/gists{/gist_id}", "starred_url": "https://api.github.com/users/randomicon00/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/randomicon00/subscriptions", "organizations_url": "https://api.github.com/users/randomicon00/orgs", "repos_url": "https://api.github.com/users/randomicon00/repos", "events_url": "https://api.github.com/users/randomicon00/events{/privacy}", "received_events_url": "https://api.github.com/users/randomicon00/received_events", "type": "User", "site_admin": false}, "committer": {"login": "randomicon00", "id": 20146907, "node_id": "MDQ6VXNlcjIwMTQ2OTA3", "avatar_url": "https://avatars.githubusercontent.com/u/20146907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/randomicon00", "html_url": "https://github.com/randomicon00", "followers_url": "https://api.github.com/users/randomicon00/followers", "following_url": "https://api.github.com/users/randomicon00/following{/other_user}", "gists_url": "https://api.github.com/users/randomicon00/gists{/gist_id}", "starred_url": "https://api.github.com/users/randomicon00/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/randomicon00/subscriptions", "organizations_url": "https://api.github.com/users/randomicon00/orgs", "repos_url": "https://api.github.com/users/randomicon00/repos", "events_url": "https://api.github.com/users/randomicon00/events{/privacy}", "received_events_url": "https://api.github.com/users/randomicon00/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e1d19d30723c287f049662474021f2b9a9894ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e1d19d30723c287f049662474021f2b9a9894ce", "html_url": "https://github.com/rust-lang/rust/commit/5e1d19d30723c287f049662474021f2b9a9894ce"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "e122536f61ffa6d1f29a63392ae7d70483d89816", "filename": "compiler/rustc_data_structures/src/profiling.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e79ba76ec462031c9d5fa2130bc631600bc6d875/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e79ba76ec462031c9d5fa2130bc631600bc6d875/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fprofiling.rs?ref=e79ba76ec462031c9d5fa2130bc631600bc6d875", "patch": "@@ -649,11 +649,30 @@ impl Drop for VerboseTimingGuard<'_> {\n     fn drop(&mut self) {\n         if let Some((start_time, start_rss, ref message)) = self.start_and_message {\n             let end_rss = get_resident_set_size();\n-            print_time_passes_entry(&message, start_time.elapsed(), start_rss, end_rss);\n+            let dur = start_time.elapsed();\n+\n+            if should_print_passes(dur, start_rss, end_rss) {\n+                print_time_passes_entry(&message, dur, start_rss, end_rss);\n+            }\n         }\n     }\n }\n \n+fn should_print_passes(dur: Duration, start_rss: Option<usize>, end_rss: Option<usize>) -> bool {\n+    if dur.as_millis() > 5 {\n+        return true;\n+    }\n+\n+    if let (Some(start_rss), Some(end_rss)) = (start_rss, end_rss) {\n+        let change_rss = end_rss.abs_diff(start_rss);\n+        if change_rss > 0 {\n+            return true;\n+        }\n+    }\n+\n+    false\n+}\n+\n pub fn print_time_passes_entry(\n     what: &str,\n     dur: Duration,"}]}