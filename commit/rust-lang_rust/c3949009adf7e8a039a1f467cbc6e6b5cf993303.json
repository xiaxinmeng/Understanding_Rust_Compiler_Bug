{"sha": "c3949009adf7e8a039a1f467cbc6e6b5cf993303", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzOTQ5MDA5YWRmN2U4YTAzOWExZjQ2N2NiYzZlNmI1Y2Y5OTMzMDM=", "commit": {"author": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-07-04T12:25:33Z"}, "committer": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-07-04T12:28:44Z"}, "message": "Improving span of unknown lint tool error message", "tree": {"sha": "2fe55c9bfbfd0963dcaea3a0ad735cbbd1f4e294", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fe55c9bfbfd0963dcaea3a0ad735cbbd1f4e294"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3949009adf7e8a039a1f467cbc6e6b5cf993303", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE8rLaPclMjvVJWRZHnxhOEWSDEYEFAls8vXwACgkQnxhOEWSD\nEYEDPg/9E0HRJGpN8bLbrgKSKikA8t1fV78vM9PAraQYmbyVfiThlbLOcI0+5kq8\nyhodHwn+4eLnTK46NgNCEiXkumL/XBIJKcu7zcf0QgCmH30iO2weOzvde8IhTnIl\nwci6RpRtvAUY5UjL3HC1BBLHt8Ypn+7edoJGJoCA3rbgOcX2Ipggfbr5bzbKt71f\ngIeW+qRSVtOc/VThr+FCfXIGvjc/Cl9tT8FlyOUXvK0fisseQ0St8Kb9mHcgT88s\nAlE3bmcQHoCQIePrRMJUc5yQ634bpncnt0+GMTSnm7r6UMNqtbbMWCXmLAo40H6b\npvCbpHQ+t1BLSjRo5e2KavVrBpS6rFUxJRLbiqs39gaqCcDsTKtD18lsjfGh3GHy\nGKNAQzJ3Ah9DOUXmapUY08qJ+SBVdcFLMWbNG0U5o01PjPC7dm7SLpZPC3F2MYjw\nZf18dapMsNCKiYDet2Io1zQbKaoxypKdzI2sU382JoK88Ajgaglzt75ySov2IS9X\nTpsXW6a7BZWz6QWgitFJesPXmCFs7sJ7CDqvlGhpuiUuIFT2X2EkCn2KqenUY8fh\n7lTnGZI4sJ7CjVwva78xydUkCDkDjUdQ5HyoEAKQK/LS9AseXYLEc2os4RXRGtG3\nAa8g1EvbIs/NoH8mpgrS5Q+jFqbMaBaUKyGTmWhXsHan3bpZv7g=\n=oOk/\n-----END PGP SIGNATURE-----", "payload": "tree 2fe55c9bfbfd0963dcaea3a0ad735cbbd1f4e294\nparent a9634fcd013a31842e551ba30c25e389a5d67bbd\nauthor flip1995 <9744647+flip1995@users.noreply.github.com> 1530707133 +0200\ncommitter flip1995 <9744647+flip1995@users.noreply.github.com> 1530707324 +0200\n\nImproving span of unknown lint tool error message\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3949009adf7e8a039a1f467cbc6e6b5cf993303", "html_url": "https://github.com/rust-lang/rust/commit/c3949009adf7e8a039a1f467cbc6e6b5cf993303", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3949009adf7e8a039a1f467cbc6e6b5cf993303/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9634fcd013a31842e551ba30c25e389a5d67bbd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9634fcd013a31842e551ba30c25e389a5d67bbd", "html_url": "https://github.com/rust-lang/rust/commit/a9634fcd013a31842e551ba30c25e389a5d67bbd"}], "stats": {"total": 50, "additions": 38, "deletions": 12}, "files": [{"sha": "5bf15b10715c4a68ddeb7fc76b1b6410ee61b550", "filename": "src/librustc/lint/levels.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Flibrustc%2Flint%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Flibrustc%2Flint%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Flevels.rs?ref=c3949009adf7e8a039a1f467cbc6e6b5cf993303", "patch": "@@ -222,7 +222,7 @@ impl<'a> LintLevelsBuilder<'a> {\n                         continue\n                     }\n                 };\n-                if word.is_scoped() {\n+                if let Some(lint_tool) = word.is_scoped() {\n                     if !self.sess.features_untracked().tool_lints {\n                         feature_gate::emit_feature_err(&sess.parse_sess,\n                                                        \"tool_lints\",\n@@ -232,12 +232,12 @@ impl<'a> LintLevelsBuilder<'a> {\n                                                                 word.ident));\n                     }\n \n-                    if !attr::is_known_lint_tool(word) {\n+                    if !attr::is_known_lint_tool(lint_tool) {\n                         span_err!(\n                             sess,\n-                            word.span,\n+                            lint_tool.span,\n                             E0710,\n-                            \"an unknown tool name found in scoped lint: `{}`.\",\n+                            \"an unknown tool name found in scoped lint: `{}`\",\n                             word.ident\n                         );\n                     }"}, {"sha": "d746ac3c5771bb19f9c15526c1a4c37f3c504ae4", "filename": "src/libsyntax/attr/mod.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Flibsyntax%2Fattr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Flibsyntax%2Fattr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fattr%2Fmod.rs?ref=c3949009adf7e8a039a1f467cbc6e6b5cf993303", "patch": "@@ -98,10 +98,8 @@ pub fn is_known_tool(attr: &Attribute) -> bool {\n     RUST_KNOWN_TOOL.contains(&tool_name.as_str().as_ref())\n }\n \n-pub fn is_known_lint_tool(m_item: &MetaItem) -> bool {\n-    let tool_name =\n-        m_item.ident.segments.iter().next().expect(\"empty path in meta item\").ident.name;\n-    RUST_KNOWN_LINT_TOOL.contains(&tool_name.as_str().as_ref())\n+pub fn is_known_lint_tool(m_item: Ident) -> bool {\n+    RUST_KNOWN_LINT_TOOL.contains(&m_item.as_str().as_ref())\n }\n \n impl NestedMetaItem {\n@@ -298,8 +296,12 @@ impl MetaItem {\n         self.meta_item_list().is_some()\n     }\n \n-    pub fn is_scoped(&self) -> bool {\n-        self.ident.segments.len() > 1\n+    pub fn is_scoped(&self) -> Option<Ident> {\n+        if self.ident.segments.len() > 1 {\n+            Some(self.ident.segments[0].ident)\n+        } else {\n+            None\n+        }\n     }\n }\n "}, {"sha": "78b736edcebe6e0699beae6d7deb7c789518718a", "filename": "src/test/compile-fail/unknown-lint-tool-name.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fcompile-fail%2Funknown-lint-tool-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fcompile-fail%2Funknown-lint-tool-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funknown-lint-tool-name.rs?ref=c3949009adf7e8a039a1f467cbc6e6b5cf993303", "patch": "@@ -10,7 +10,7 @@\n \n #![feature(tool_lints)]\n \n-#![deny(foo::bar)] //~ ERROR an unknown tool name found in scoped lint: `foo::bar`.\n+#![deny(foo::bar)] //~ ERROR an unknown tool name found in scoped lint: `foo::bar`\n \n-#[allow(foo::bar)] //~ ERROR an unknown tool name found in scoped lint: `foo::bar`.\n+#[allow(foo::bar)] //~ ERROR an unknown tool name found in scoped lint: `foo::bar`\n fn main() {}"}, {"sha": "71f90b17c18fcefd792a8d6a36ccbab0779db93d", "filename": "src/test/ui/tool_lints.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fui%2Ftool_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fui%2Ftool_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftool_lints.rs?ref=c3949009adf7e8a039a1f467cbc6e6b5cf993303", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(tool_lints)]\n+\n+#[warn(foo::bar)]\n+//~^ ERROR an unknown tool name found in scoped lint: `foo::bar`\n+fn main() {}"}, {"sha": "16468df7370146065fec8dd329043e441b369109", "filename": "src/test/ui/tool_lints.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fui%2Ftool_lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c3949009adf7e8a039a1f467cbc6e6b5cf993303/src%2Ftest%2Fui%2Ftool_lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftool_lints.stderr?ref=c3949009adf7e8a039a1f467cbc6e6b5cf993303", "patch": "@@ -0,0 +1,9 @@\n+error[E0710]: an unknown tool name found in scoped lint: `foo::bar`\n+  --> $DIR/tool_lints.rs:13:8\n+   |\n+LL | #[warn(foo::bar)]\n+   |        ^^^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0710`."}]}