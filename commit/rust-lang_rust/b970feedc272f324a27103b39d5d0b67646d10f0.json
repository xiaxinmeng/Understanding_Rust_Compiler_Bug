{"sha": "b970feedc272f324a27103b39d5d0b67646d10f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5NzBmZWVkYzI3MmYzMjRhMjcxMDNiMzlkNWQwYjY3NjQ2ZDEwZjA=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-05-28T22:44:33Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-05-30T17:35:43Z"}, "message": "Add compare-mode to x.py", "tree": {"sha": "0734cef294638c3e1338ae135d921e8e33af9916", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0734cef294638c3e1338ae135d921e8e33af9916"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b970feedc272f324a27103b39d5d0b67646d10f0", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAlsO4PEACgkQiMlBzaHU\nZDJ+MQ//eiRkitrpE6JjNV5jm8Jk9T3486CbGDqUyp1C3AAdGeDFP9DDmtFRadIO\n7yuHkBWAjZ+B3geI7V60SFbuaqJbmEGZCUu+sdLnJGeRPSJ2i3P4j5T4Gd1FrAB8\nZUKuSKxGGSl6CaKGjfYut327Ulrir1ybZEFVhcFa+zv76dH6d4QPiHknwq8jeS/T\nOrdJRszt8QZQHdlxOkNQEfaHY8NEXhpAZKTKdByXmli/jzUto3hZ6nNvuf21YGV6\nBNe+RpI55obmLI1RFmHeToZFvRl7dYH7/WSopcIPF9MG0LWCOfRgbhgTKeitM5wp\n1ECscQ2qJ+oF3phSmSt2JGztOfE4nryrmoSB3Dz5e0qCkpKqPBkOs5cwDlGoG4AM\n9IEg384q/4YdvMrOuzCt/7yYeQ/g4T5yaouSNtv+Yv8E+zcJ9uLjxSAsjLZzZABa\nWDTpJaZxgP/HxRcLuih4r3AtWaZqcmlKf6jHeIxkaO5OqKiVrGwEetS6eCnNyMbj\nrD9nc5sNfi1yGtGgx2/u9G48et4Usd5iLJiEstPq9oe/x8NhI1jaJVm5fPajNhgz\nNcPBGeZ7CLVoycUpIu0+PXYUX0f1UZez+J6oyWtI1NjDMKJpfzme7Gctu6ZzaEaj\nKZAV9XhSP+8SbQuCEUc3Ds0GPLQgQ98CFMY/6jvWFp2EEyUYO9I=\n=tTdG\n-----END PGP SIGNATURE-----", "payload": "tree 0734cef294638c3e1338ae135d921e8e33af9916\nparent 9df0a41321b8dd3fc48da9b34b3f79b0c37051b7\nauthor Santiago Pastorino <spastorino@gmail.com> 1527547473 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1527701743 -0300\n\nAdd compare-mode to x.py\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b970feedc272f324a27103b39d5d0b67646d10f0", "html_url": "https://github.com/rust-lang/rust/commit/b970feedc272f324a27103b39d5d0b67646d10f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b970feedc272f324a27103b39d5d0b67646d10f0/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7", "html_url": "https://github.com/rust-lang/rust/commit/9df0a41321b8dd3fc48da9b34b3f79b0c37051b7"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "e987d3fa4fa6e9fc73f781342c95709094753420", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=b970feedc272f324a27103b39d5d0b67646d10f0", "patch": "@@ -1457,6 +1457,7 @@ mod __test {\n             fail_fast: true,\n             doc_tests: DocTests::No,\n             bless: false,\n+            compare_mode: None,\n         };\n \n         let build = Build::new(config);"}, {"sha": "f1473d19393aa0b4f9828c0a13ffa3390139cddd", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=b970feedc272f324a27103b39d5d0b67646d10f0", "patch": "@@ -61,6 +61,7 @@ pub enum Subcommand {\n         paths: Vec<PathBuf>,\n         /// Whether to automatically update stderr/stdout files\n         bless: bool,\n+        compare_mode: Option<String>,\n         test_args: Vec<String>,\n         rustc_args: Vec<String>,\n         fail_fast: bool,\n@@ -176,6 +177,7 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\");\n                 opts.optflag(\"\", \"no-doc\", \"do not run doc tests\");\n                 opts.optflag(\"\", \"doc\", \"only run doc tests\");\n                 opts.optflag(\"\", \"bless\", \"update all stderr/stdout files of failing ui tests\");\n+                opts.optopt(\"\", \"compare-mode\", \"mode describing what file the actual ui output will be compared to\", \"COMPARE MODE\");\n             },\n             \"bench\" => { opts.optmulti(\"\", \"test-args\", \"extra arguments\", \"ARGS\"); },\n             \"clean\" => { opts.optflag(\"\", \"all\", \"clean all build artifacts\"); },\n@@ -262,6 +264,7 @@ Arguments:\n         ./x.py test src/libstd --test-args hash_map\n         ./x.py test src/libstd --stage 0\n         ./x.py test src/test/ui --bless\n+        ./x.py test src/test/ui --compare-mode nll\n \n     If no arguments are passed then the complete artifacts for that stage are\n     compiled and tested.\n@@ -327,6 +330,7 @@ Arguments:\n                 Subcommand::Test {\n                     paths,\n                     bless: matches.opt_present(\"bless\"),\n+                    compare_mode: matches.opt_str(\"compare-mode\"),\n                     test_args: matches.opt_strs(\"test-args\"),\n                     rustc_args: matches.opt_strs(\"rustc-args\"),\n                     fail_fast: !matches.opt_present(\"no-fail-fast\"),\n@@ -436,6 +440,13 @@ impl Subcommand {\n             _ => false,\n         }\n     }\n+\n+    pub fn compare_mode(&self) -> Option<&str> {\n+        match *self {\n+            Subcommand::Test { ref compare_mode, .. } => compare_mode.as_ref().map(|s| &s[..]),\n+            _ => None,\n+        }\n+    }\n }\n \n fn split(s: Vec<String>) -> Vec<String> {"}, {"sha": "a0a51659ba3dccc4a1e41d7579c4e6ae27338365", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b970feedc272f324a27103b39d5d0b67646d10f0/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=b970feedc272f324a27103b39d5d0b67646d10f0", "patch": "@@ -887,7 +887,6 @@ impl Step for Compiletest {\n         let target = self.target;\n         let mode = self.mode;\n         let suite = self.suite;\n-        let compare_mode = self.compare_mode;\n \n         // Path for test suite\n         let suite_path = self.path.unwrap_or(\"\");\n@@ -965,6 +964,8 @@ impl Step for Compiletest {\n             cmd.arg(\"--bless\");\n         }\n \n+        let compare_mode = builder.config.cmd.compare_mode().or(self.compare_mode);\n+\n         if let Some(ref nodejs) = builder.config.nodejs {\n             cmd.arg(\"--nodejs\").arg(nodejs);\n         }"}]}