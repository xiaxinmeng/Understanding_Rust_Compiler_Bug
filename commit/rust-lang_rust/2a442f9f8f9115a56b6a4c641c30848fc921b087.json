{"sha": "2a442f9f8f9115a56b6a4c641c30848fc921b087", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhNDQyZjlmOGY5MTE1YTU2YjZhNGM2NDFjMzA4NDhmYzkyMWIwODc=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-20T02:09:19Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-20T02:14:17Z"}, "message": "rustdoc: Add function signatures to the doc tree", "tree": {"sha": "34c02a3c1154708d0fc31519a7d90575a30ca5b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/34c02a3c1154708d0fc31519a7d90575a30ca5b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a442f9f8f9115a56b6a4c641c30848fc921b087", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a442f9f8f9115a56b6a4c641c30848fc921b087", "html_url": "https://github.com/rust-lang/rust/commit/2a442f9f8f9115a56b6a4c641c30848fc921b087", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a442f9f8f9115a56b6a4c641c30848fc921b087/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "991db34b5bb9f2744109375c3d6345c8a21482d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/991db34b5bb9f2744109375c3d6345c8a21482d1", "html_url": "https://github.com/rust-lang/rust/commit/991db34b5bb9f2744109375c3d6345c8a21482d1"}], "stats": {"total": 36, "additions": 30, "deletions": 6}, "files": [{"sha": "3969bdd4032012995052cd1fae31960ca1fca305", "filename": "src/rustdoc/attr_pass.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fattr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fattr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_pass.rs?ref=2a442f9f8f9115a56b6a4c641c30848fc921b087", "patch": "@@ -135,7 +135,7 @@ fn fold_fn(\n             desc: attrs.desc,\n             args: merge_arg_attrs(doc.args, attrs.args),\n             return: merge_ret_attrs(doc.return, attrs.return),\n-            ty: none\n+            sig: none\n         };\n     }\n "}, {"sha": "4a3101bc71669d9ceda30212e1db458119a7e7d4", "filename": "src/rustdoc/doc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fdoc.rs?ref=2a442f9f8f9115a56b6a4c641c30848fc921b087", "patch": "@@ -23,7 +23,7 @@ type fndoc = ~{\n     desc: option<str>,\n     args: [argdoc],\n     return: option<retdoc>,\n-    ty: option<str>\n+    sig: option<str>\n };\n \n type argdoc = ~{"}, {"sha": "ce6d7bdcbb43bc00f3c79956d3204b11bad64a65", "filename": "src/rustdoc/extract.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fextract.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Fextract.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fextract.rs?ref=2a442f9f8f9115a56b6a4c641c30848fc921b087", "patch": "@@ -81,7 +81,7 @@ fn fndoc_from_fn(\n         desc: none,\n         args: argdocs_from_args(decl.inputs),\n         return: none,\n-        ty: none\n+        sig: none\n     }\n }\n "}, {"sha": "29b55602cb61d96a6d62f6716fc5be451417bf87", "filename": "src/rustdoc/tystr_pass.rs", "status": "modified", "additions": 27, "deletions": 3, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Ftystr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a442f9f8f9115a56b6a4c641c30848fc921b087/src%2Frustdoc%2Ftystr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Ftystr_pass.rs?ref=2a442f9f8f9115a56b6a4c641c30848fc921b087", "patch": "@@ -30,12 +30,36 @@ fn fold_fn(\n     let srv = fold.ctxt;\n \n     ~{\n+        args: merge_arg_tys(srv, doc.id, doc.args),\n         return: merge_ret_ty(srv, doc.id, doc.return),\n-        args: merge_arg_tys(srv, doc.id, doc.args)\n+        sig: get_fn_sig(srv, doc.id)\n         with *doc\n     }\n }\n \n+fn get_fn_sig(srv: astsrv::srv, fn_id: doc::ast_id) -> option<str> {\n+    astsrv::exec(srv) {|ctxt|\n+        alt ctxt.map.get(fn_id) {\n+          ast_map::node_item(@{\n+            ident: ident,\n+            node: ast::item_fn(decl, _, blk), _\n+          }) {\n+            some(pprust::fun_to_str(decl, ident, []))\n+          }\n+        }\n+    }\n+}\n+\n+#[test]\n+fn should_add_fn_sig() {\n+    let source = \"fn a() -> int { }\";\n+    let srv = astsrv::mk_srv_from_str(source);\n+    let doc = extract::from_srv(srv, \"\");\n+    let doc = run(srv, doc);\n+    log(error, doc.topmod.fns[0].sig);\n+    assert doc.topmod.fns[0].sig == some(\"fn a() -> int\");\n+}\n+\n fn merge_ret_ty(\n     srv: astsrv::srv,\n     fn_id: doc::ast_id,\n@@ -59,9 +83,9 @@ fn merge_ret_ty(\n     }\n }\n \n-fn get_ret_ty(srv: astsrv::srv, id: doc::ast_id) -> option<str> {\n+fn get_ret_ty(srv: astsrv::srv, fn_id: doc::ast_id) -> option<str> {\n     astsrv::exec(srv) {|ctxt|\n-        alt ctxt.map.get(id) {\n+        alt ctxt.map.get(fn_id) {\n           ast_map::node_item(@{\n             node: ast::item_fn(decl, _, _), _\n           }) {"}]}