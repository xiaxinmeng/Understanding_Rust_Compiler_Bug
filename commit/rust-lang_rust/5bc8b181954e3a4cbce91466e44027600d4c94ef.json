{"sha": "5bc8b181954e3a4cbce91466e44027600d4c94ef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViYzhiMTgxOTU0ZTNhNGNiY2U5MTQ2NmU0NDAyNzYwMGQ0Yzk0ZWY=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-09-06T23:38:26Z"}, "committer": {"name": "Joe Ellis", "email": "joe.ellis@arm.com", "date": "2020-09-14T09:30:53Z"}, "message": "Make bootstrap build on stable\n\nThis is generally a good idea, and will help with being able to build bootstrap\nwithout Python over time as it means we can \"just\" build with cargo +beta build\nrather than needing the user to set environment variables. This is a minor step,\nbut a necessary one on that road.", "tree": {"sha": "0d41a92fc8d41770988249d212c612ea0ca8e839", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d41a92fc8d41770988249d212c612ea0ca8e839"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5bc8b181954e3a4cbce91466e44027600d4c94ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5bc8b181954e3a4cbce91466e44027600d4c94ef", "html_url": "https://github.com/rust-lang/rust/commit/5bc8b181954e3a4cbce91466e44027600d4c94ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5bc8b181954e3a4cbce91466e44027600d4c94ef/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joechrisellis", "id": 6762885, "node_id": "MDQ6VXNlcjY3NjI4ODU=", "avatar_url": "https://avatars.githubusercontent.com/u/6762885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joechrisellis", "html_url": "https://github.com/joechrisellis", "followers_url": "https://api.github.com/users/joechrisellis/followers", "following_url": "https://api.github.com/users/joechrisellis/following{/other_user}", "gists_url": "https://api.github.com/users/joechrisellis/gists{/gist_id}", "starred_url": "https://api.github.com/users/joechrisellis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joechrisellis/subscriptions", "organizations_url": "https://api.github.com/users/joechrisellis/orgs", "repos_url": "https://api.github.com/users/joechrisellis/repos", "events_url": "https://api.github.com/users/joechrisellis/events{/privacy}", "received_events_url": "https://api.github.com/users/joechrisellis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e82584a77d019bd5ee4254b5870270b1493763a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e82584a77d019bd5ee4254b5870270b1493763a6", "html_url": "https://github.com/rust-lang/rust/commit/e82584a77d019bd5ee4254b5870270b1493763a6"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "4ab23b40ac34b8615bd28c160c4f2f3787bdabe1", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=5bc8b181954e3a4cbce91466e44027600d4c94ef", "patch": "@@ -714,7 +714,6 @@ def build_bootstrap(self):\n         # See also: <https://github.com/rust-lang/rust/issues/70208>.\n         if \"CARGO_BUILD_TARGET\" in env:\n             del env[\"CARGO_BUILD_TARGET\"]\n-        env[\"RUSTC_BOOTSTRAP\"] = '1'\n         env[\"CARGO_TARGET_DIR\"] = build_dir\n         env[\"RUSTC\"] = self.rustc()\n         env[\"LD_LIBRARY_PATH\"] = os.path.join(self.bin_root(), \"lib\") + \\"}, {"sha": "3b8c9c2d58e0d0f58f100e1bba5fcd8beecd2b07", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=5bc8b181954e3a4cbce91466e44027600d4c94ef", "patch": "@@ -103,8 +103,6 @@\n //! More documentation can be found in each respective module below, and you can\n //! also check out the `src/bootstrap/README.md` file for more information.\n \n-#![feature(drain_filter)]\n-\n use std::cell::{Cell, RefCell};\n use std::collections::{HashMap, HashSet};\n use std::env;"}, {"sha": "e8d7de7a5dcaa19e40e093e518591e16ec37d8f6", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bc8b181954e3a4cbce91466e44027600d4c94ef/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=5bc8b181954e3a4cbce91466e44027600d4c94ef", "patch": "@@ -162,13 +162,15 @@ impl Step for ToolBuild {\n                 \"the following dependencies are duplicated although they \\\n                       have the same features enabled:\"\n             );\n-            for (id, cur, prev) in duplicates.drain_filter(|(_, cur, prev)| cur.2 == prev.2) {\n+            let (same, different): (Vec<_>, Vec<_>) =\n+                duplicates.into_iter().partition(|(_, cur, prev)| cur.2 == prev.2);\n+            for (id, cur, prev) in same {\n                 println!(\"  {}\", id);\n                 // same features\n                 println!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n             }\n             println!(\"the following dependencies have different features:\");\n-            for (id, cur, prev) in duplicates {\n+            for (id, cur, prev) in different {\n                 println!(\"  {}\", id);\n                 let cur_features: HashSet<_> = cur.2.into_iter().collect();\n                 let prev_features: HashSet<_> = prev.2.into_iter().collect();"}]}