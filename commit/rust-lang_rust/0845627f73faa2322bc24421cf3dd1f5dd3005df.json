{"sha": "0845627f73faa2322bc24421cf3dd1f5dd3005df", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4NDU2MjdmNzNmYWEyMzIyYmMyNDQyMWNmM2RkMWY1ZGQzMDA1ZGY=", "commit": {"author": {"name": "Cassandra Fridkin", "email": "cass@swag.lgbt", "date": "2020-10-06T02:00:43Z"}, "committer": {"name": "Cassandra Fridkin", "email": "cass@swag.lgbt", "date": "2020-10-06T02:00:43Z"}, "message": "Make changes based on @jyn514's comments", "tree": {"sha": "c47798eb8a2d5d284e23ccbab56f4d552635ec6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c47798eb8a2d5d284e23ccbab56f4d552635ec6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0845627f73faa2322bc24421cf3dd1f5dd3005df", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdn8arGOPUN7UUjx9sGOAzKYTMzoFAl970AEACgkQsGOAzKYT\nMzpXVA/9E0UU2oElXDEbhUlQY71UC4z1GtUB81dVzeVKlbl0/7383m6l3QWAJ8kj\nwyNseTFN1+Z4ClXVkLkcdovjQJhmrVrXOIteXyfDhYleH00rhl0Z/wjzvaSL4qL+\nv68MPuhSN8pjSLLis51FMn5aHvrVidfrYs/S0aQ4jqMstsvYC/nIJQtK/smDL0kM\njkT5J8I0oeoXs4cGq7fyznPv+MygZL5vbYxlnBvEnBf0ljDrIGPyU6H01wOt/igw\n16EIagklbGqTDMcPDLdXjddUrsslURNLCo7PNrfAB/gJk5oiZbhy7PGj15p79Ux1\n+wvmCb8FziXDZEIf5VpQBu1Bvo76F26x8qvZjpsM31eEZl6mCZmjN344V2HuTROV\nIcHLzPLVuPBB4b0HxtISNmH4uBA7Ve43azb+nb65B1HQKa2D2rQVACcsQEyf3BBs\n8LIaE0W/bJ41eg12B4zL/BT/KHVbhHe/AQ8QuwnFEVz4eH6aJ0K6FlkCUsvDm8ny\nZjAPq96r2dkFGmGlDmvdOMRPBYFf8e8PDW10H0AXy/6ESxkL+9OsHKQi89vf3P11\nsHKZOmMzz6oP2cz45KJw34l/gngMoSh+dILAWK9PpdB2mCp/XlwMAiKeFuPvHipL\nGNVX2wvpUMN50WXJF2QrP8OA0FX0QbFy9LKPapEpcz8c3DnBHaw=\n=xhwe\n-----END PGP SIGNATURE-----", "payload": "tree c47798eb8a2d5d284e23ccbab56f4d552635ec6c\nparent d585c96eaf5ba0d719b7385f15f241a4be765b20\nauthor Cassandra Fridkin <cass@swag.lgbt> 1601949643 -0400\ncommitter Cassandra Fridkin <cass@swag.lgbt> 1601949643 -0400\n\nMake changes based on @jyn514's comments\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0845627f73faa2322bc24421cf3dd1f5dd3005df", "html_url": "https://github.com/rust-lang/rust/commit/0845627f73faa2322bc24421cf3dd1f5dd3005df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0845627f73faa2322bc24421cf3dd1f5dd3005df/comments", "author": {"login": "caass", "id": 25358963, "node_id": "MDQ6VXNlcjI1MzU4OTYz", "avatar_url": "https://avatars.githubusercontent.com/u/25358963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caass", "html_url": "https://github.com/caass", "followers_url": "https://api.github.com/users/caass/followers", "following_url": "https://api.github.com/users/caass/following{/other_user}", "gists_url": "https://api.github.com/users/caass/gists{/gist_id}", "starred_url": "https://api.github.com/users/caass/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caass/subscriptions", "organizations_url": "https://api.github.com/users/caass/orgs", "repos_url": "https://api.github.com/users/caass/repos", "events_url": "https://api.github.com/users/caass/events{/privacy}", "received_events_url": "https://api.github.com/users/caass/received_events", "type": "User", "site_admin": false}, "committer": {"login": "caass", "id": 25358963, "node_id": "MDQ6VXNlcjI1MzU4OTYz", "avatar_url": "https://avatars.githubusercontent.com/u/25358963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caass", "html_url": "https://github.com/caass", "followers_url": "https://api.github.com/users/caass/followers", "following_url": "https://api.github.com/users/caass/following{/other_user}", "gists_url": "https://api.github.com/users/caass/gists{/gist_id}", "starred_url": "https://api.github.com/users/caass/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caass/subscriptions", "organizations_url": "https://api.github.com/users/caass/orgs", "repos_url": "https://api.github.com/users/caass/repos", "events_url": "https://api.github.com/users/caass/events{/privacy}", "received_events_url": "https://api.github.com/users/caass/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d585c96eaf5ba0d719b7385f15f241a4be765b20", "url": "https://api.github.com/repos/rust-lang/rust/commits/d585c96eaf5ba0d719b7385f15f241a4be765b20", "html_url": "https://github.com/rust-lang/rust/commit/d585c96eaf5ba0d719b7385f15f241a4be765b20"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "cbf53dae8060860300345f267304fa0061fc0fcd", "filename": "src/bootstrap/setup.rs", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/0845627f73faa2322bc24421cf3dd1f5dd3005df/src%2Fbootstrap%2Fsetup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0845627f73faa2322bc24421cf3dd1f5dd3005df/src%2Fbootstrap%2Fsetup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsetup.rs?ref=0845627f73faa2322bc24421cf3dd1f5dd3005df", "patch": "@@ -46,8 +46,12 @@ pub fn setup(src_path: &Path, include_name: &str) {\n         _ => return,\n     };\n \n+    println!();\n+\n     t!(install_git_hook_maybe(src_path));\n \n+    println!();\n+\n     println!(\"To get started, try one of the following commands:\");\n     for cmd in suggestions {\n         println!(\"- `x.py {}`\", cmd);\n@@ -102,10 +106,10 @@ simply delete the `pre-commit` file from .git/hooks.\"\n     let should_install = loop {\n         print!(\"Would you like to install the git hook?: [y/N] \");\n         io::stdout().flush()?;\n+        input.clear();\n         io::stdin().read_line(&mut input)?;\n         break match input.trim().to_lowercase().as_str() {\n             \"y\" | \"yes\" => true,\n-            // is this the right way to check for \"entered nothing\"?\n             \"n\" | \"no\" | \"\" => false,\n             _ => {\n                 println!(\"error: unrecognized option '{}'\", input.trim());\n@@ -115,14 +119,17 @@ simply delete the `pre-commit` file from .git/hooks.\"\n         };\n     };\n \n-    if should_install {\n-        let src = src_path.join(\"/etc/pre-commit.rs\");\n-        let dst = src_path.join(\"/.git/hooks/pre-commit\");\n-        fs::hard_link(src, dst)?;\n-        println!(\"Linked `src/etc/pre-commit.sh` to `.git/hooks/pre-commit`\");\n+    Ok(if should_install {\n+        let src = src_path.join(\"src\").join(\"etc\").join(\"pre-commit.sh\");\n+        let dst = src_path.join(\".git\").join(\"hooks\").join(\"pre-commit\");\n+        match fs::hard_link(src, dst) {\n+            Err(e) => println!(\n+                \"x.py encountered an error -- do you already have the git hook installed?\\n{}\",\n+                e\n+            ),\n+            Ok(_) => println!(\"Linked `src/etc/pre-commit.sh` to `.git/hooks/pre-commit`\"),\n+        };\n     } else {\n         println!(\"Ok, skipping installation!\");\n-    };\n-\n-    Ok(())\n+    })\n }"}]}