{"sha": "7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "node_id": "C_kwDOAAsO6NoAKDdjOWE4NWJjNDM4MTBiZmQ4YjFiOTY1N2YyNGI1MjkyMDk4YTQ5ZmE", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-12-09T17:40:54Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-12-09T18:45:01Z"}, "message": "fix: Don't show duplicated adjustment hints for blocks, ifs and matches", "tree": {"sha": "1ac4ea15ab996f53f49256db2de6f4e3056de424", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ac4ea15ab996f53f49256db2de6f4e3056de424"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "html_url": "https://github.com/rust-lang/rust/commit/7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7c9a85bc43810bfd8b1b9657f24b5292098a49fa/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34e654cd7b9f347caf7d2a4726a3f632af533ea4", "url": "https://api.github.com/repos/rust-lang/rust/commits/34e654cd7b9f347caf7d2a4726a3f632af533ea4", "html_url": "https://github.com/rust-lang/rust/commit/34e654cd7b9f347caf7d2a4726a3f632af533ea4"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "08ce7be181110a9ee2c8227462dcbb17f58a738c", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 35, "deletions": 2, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/7c9a85bc43810bfd8b1b9657f24b5292098a49fa/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7c9a85bc43810bfd8b1b9657f24b5292098a49fa/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=7c9a85bc43810bfd8b1b9657f24b5292098a49fa", "patch": "@@ -638,8 +638,12 @@ fn adjustment_hints(\n         return None;\n     }\n \n-    if let ast::Expr::ParenExpr(_) = expr {\n-        // These inherit from the inner expression which would result in duplicate hints\n+    // These inherit from the inner expression which would result in duplicate hints\n+    if let ast::Expr::ParenExpr(_)\n+    | ast::Expr::IfExpr(_)\n+    | ast::Expr::BlockExpr(_)\n+    | ast::Expr::MatchExpr(_) = expr\n+    {\n         return None;\n     }\n \n@@ -3083,6 +3087,33 @@ fn main() {\n    //^^^^^^^^^^^&\n    //^^^^^^^^^^^*\n     (&mut Struct).by_ref_mut();\n+\n+    // Check that block-like expressions don't duplicate hints\n+    let _: &mut [u32] = (&mut []);\n+                       //^^^^^^^<unsize>\n+                       //^^^^^^^&mut $\n+                       //^^^^^^^*\n+    let _: &mut [u32] = { &mut [] };\n+                        //^^^^^^^<unsize>\n+                        //^^^^^^^&mut $\n+                        //^^^^^^^*\n+    let _: &mut [u32] = unsafe { &mut [] };\n+                               //^^^^^^^<unsize>\n+                               //^^^^^^^&mut $\n+                               //^^^^^^^*\n+    let _: &mut [u32] = if true {\n+        &mut []\n+      //^^^^^^^<unsize>\n+      //^^^^^^^&mut $\n+      //^^^^^^^*\n+    } else {\n+        loop {}\n+      //^^^^^^^<never-to-any>\n+    };\n+    let _: &mut [u32] = match () { () => &mut [] }\n+                                       //^^^^^^^<unsize>\n+                                       //^^^^^^^&mut $\n+                                       //^^^^^^^*\n }\n \n #[derive(Copy, Clone)]\n@@ -3092,6 +3123,8 @@ impl Struct {\n     fn by_ref(&self) {}\n     fn by_ref_mut(&mut self) {}\n }\n+trait Trait {}\n+impl Trait for Struct {}\n \"#,\n         )\n     }"}]}