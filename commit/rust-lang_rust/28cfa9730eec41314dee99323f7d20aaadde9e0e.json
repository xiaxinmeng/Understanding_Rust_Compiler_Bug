{"sha": "28cfa9730eec41314dee99323f7d20aaadde9e0e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4Y2ZhOTczMGVlYzQxMzE0ZGVlOTkzMjNmN2QyMGFhYWRkZTllMGU=", "commit": {"author": {"name": "Juan Aguilar Santillana", "email": "mhpoin@gmail.com", "date": "2020-09-18T05:57:01Z"}, "committer": {"name": "Juan Aguilar Santillana", "email": "mhpoin@gmail.com", "date": "2020-09-18T05:57:01Z"}, "message": "Simplify panic_if_treat_err_as_bug avoiding allocations", "tree": {"sha": "0940b7f7a87e7c3c0903cd32ae0b9ac33899b2f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0940b7f7a87e7c3c0903cd32ae0b9ac33899b2f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/28cfa9730eec41314dee99323f7d20aaadde9e0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/28cfa9730eec41314dee99323f7d20aaadde9e0e", "html_url": "https://github.com/rust-lang/rust/commit/28cfa9730eec41314dee99323f7d20aaadde9e0e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/28cfa9730eec41314dee99323f7d20aaadde9e0e/comments", "author": {"login": "botika", "id": 2625545, "node_id": "MDQ6VXNlcjI2MjU1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2625545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botika", "html_url": "https://github.com/botika", "followers_url": "https://api.github.com/users/botika/followers", "following_url": "https://api.github.com/users/botika/following{/other_user}", "gists_url": "https://api.github.com/users/botika/gists{/gist_id}", "starred_url": "https://api.github.com/users/botika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botika/subscriptions", "organizations_url": "https://api.github.com/users/botika/orgs", "repos_url": "https://api.github.com/users/botika/repos", "events_url": "https://api.github.com/users/botika/events{/privacy}", "received_events_url": "https://api.github.com/users/botika/received_events", "type": "User", "site_admin": false}, "committer": {"login": "botika", "id": 2625545, "node_id": "MDQ6VXNlcjI2MjU1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2625545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botika", "html_url": "https://github.com/botika", "followers_url": "https://api.github.com/users/botika/followers", "following_url": "https://api.github.com/users/botika/following{/other_user}", "gists_url": "https://api.github.com/users/botika/gists{/gist_id}", "starred_url": "https://api.github.com/users/botika/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botika/subscriptions", "organizations_url": "https://api.github.com/users/botika/orgs", "repos_url": "https://api.github.com/users/botika/repos", "events_url": "https://api.github.com/users/botika/events{/privacy}", "received_events_url": "https://api.github.com/users/botika/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b5d9836c47509e16900a274ed0b552a2e30a36a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b5d9836c47509e16900a274ed0b552a2e30a36a", "html_url": "https://github.com/rust-lang/rust/commit/7b5d9836c47509e16900a274ed0b552a2e30a36a"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "b16fe5603c1001f74868b926bf126f99f0d83075", "filename": "compiler/rustc_errors/src/lib.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/28cfa9730eec41314dee99323f7d20aaadde9e0e/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/28cfa9730eec41314dee99323f7d20aaadde9e0e/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Flib.rs?ref=28cfa9730eec41314dee99323f7d20aaadde9e0e", "patch": "@@ -973,16 +973,14 @@ impl HandlerInner {\n \n     fn panic_if_treat_err_as_bug(&self) {\n         if self.treat_err_as_bug() {\n-            let s = match (self.err_count(), self.flags.treat_err_as_bug.unwrap_or(0)) {\n-                (0, _) => return,\n-                (1, 1) => \"aborting due to `-Z treat-err-as-bug=1`\".to_string(),\n-                (1, _) => return,\n-                (count, as_bug) => format!(\n+            match (self.err_count(), self.flags.treat_err_as_bug.unwrap_or(0)) {\n+                (1, 1) => panic!(\"aborting due to `-Z treat-err-as-bug=1`\"),\n+                (0, _) | (1, _) => {}\n+                (count, as_bug) => panic!(\n                     \"aborting after {} errors due to `-Z treat-err-as-bug={}`\",\n                     count, as_bug,\n                 ),\n-            };\n-            panic!(s);\n+            }\n         }\n     }\n }"}]}