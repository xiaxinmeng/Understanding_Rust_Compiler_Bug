{"sha": "74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "node_id": "C_kwDOAAsO6NoAKDc0ZmVjOWI5NWFkMzA4YzNkYzA2NGJiMzg3NzhhZWE0ZWM1MWY1ZWU", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-02T02:13:27Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-02T16:52:07Z"}, "message": "Remove has_errors from FnCtxt", "tree": {"sha": "be297a197bf8810f8382a13ef7869c819cfaab75", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be297a197bf8810f8382a13ef7869c819cfaab75"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "html_url": "https://github.com/rust-lang/rust/commit/74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0a76127283bc963b085f54a1b275a8e281e81e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0a76127283bc963b085f54a1b275a8e281e81e6", "html_url": "https://github.com/rust-lang/rust/commit/c0a76127283bc963b085f54a1b275a8e281e81e6"}], "stats": {"total": 39, "additions": 20, "deletions": 19}, "files": [{"sha": "47b5673e8b3d044594fec5a29499e27806843a5f", "filename": "compiler/rustc_hir_typeck/src/expr.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -220,7 +220,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Hide the outer diverging and has_errors flags.\n         let old_diverges = self.diverges.replace(Diverges::Maybe);\n-        let old_has_errors = self.has_errors.replace(false);\n \n         let ty = ensure_sufficient_stack(|| match &expr.kind {\n             hir::ExprKind::Path(\n@@ -259,7 +258,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Combine the diverging and has_error flags.\n         self.diverges.set(self.diverges.get() | old_diverges);\n-        self.has_errors.set(self.has_errors.get() | old_has_errors);\n \n         debug!(\"type of {} is...\", self.tcx.hir().node_to_string(expr.hir_id));\n         debug!(\"... {:?}, expected is {:?}\", ty, expected);"}, {"sha": "38da0a47d7161343abb8d7ed49be2a23e1497680", "filename": "compiler/rustc_hir_typeck/src/fn_ctxt/_impl.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2F_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2F_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2F_impl.rs?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -143,7 +143,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         self.typeck_results.borrow_mut().node_types_mut().insert(id, ty);\n \n         if ty.references_error() {\n-            self.has_errors.set(true);\n             self.set_tainted_by_errors();\n         }\n     }"}, {"sha": "e1955d838f253ebb2c524d5bf9c9ab88761a2037", "filename": "compiler/rustc_hir_typeck/src/fn_ctxt/checks.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fchecks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fchecks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fchecks.rs?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -1334,7 +1334,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Hide the outer diverging and `has_errors` flags.\n         let old_diverges = self.diverges.replace(Diverges::Maybe);\n-        let old_has_errors = self.has_errors.replace(false);\n \n         match stmt.kind {\n             hir::StmtKind::Local(l) => {\n@@ -1364,7 +1363,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         // Combine the diverging and `has_error` flags.\n         self.diverges.set(self.diverges.get() | old_diverges);\n-        self.has_errors.set(self.has_errors.get() | old_has_errors);\n     }\n \n     pub fn check_block_no_value(&self, blk: &'tcx hir::Block<'tcx>) {\n@@ -1544,11 +1542,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             self.diverges.set(prev_diverges);\n         }\n \n-        let mut ty = ctxt.coerce.unwrap().complete(self);\n-\n-        if self.has_errors.get() || ty.references_error() {\n-            ty = self.tcx.ty_error()\n-        }\n+        let ty = ctxt.coerce.unwrap().complete(self);\n \n         self.write_ty(blk.hir_id, ty);\n "}, {"sha": "19839ad4d4c2799390b055a4dedf2cbd4ae7f483", "filename": "compiler/rustc_hir_typeck/src/fn_ctxt/mod.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Ffn_ctxt%2Fmod.rs?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -112,9 +112,6 @@ pub struct FnCtxt<'a, 'tcx> {\n     /// the diverges flag is set to something other than `Maybe`.\n     pub(super) diverges: Cell<Diverges>,\n \n-    /// Whether any child nodes have any type errors.\n-    pub(super) has_errors: Cell<bool>,\n-\n     pub(super) enclosing_breakables: RefCell<EnclosingBreakables<'tcx>>,\n \n     pub(super) inh: &'a Inherited<'tcx>,\n@@ -145,7 +142,6 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             resume_yield_tys: None,\n             ps: Cell::new(UnsafetyState::function(hir::Unsafety::Normal, hir::CRATE_HIR_ID)),\n             diverges: Cell::new(Diverges::Maybe),\n-            has_errors: Cell::new(false),\n             enclosing_breakables: RefCell::new(EnclosingBreakables {\n                 stack: Vec::new(),\n                 by_id: Default::default(),"}, {"sha": "14215d36a3833ce8f2874609c3cb5e7c3ed9dae9", "filename": "src/test/ui/error-codes/E0767.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/src%2Ftest%2Fui%2Ferror-codes%2FE0767.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/src%2Ftest%2Fui%2Ferror-codes%2FE0767.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0767.rs?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -1,6 +1,7 @@\n-fn main () {\n+fn main() {\n     'a: loop {\n         || {\n+            //~^ ERROR mismatched types\n             loop { break 'a; } //~ ERROR E0767\n         }\n     }"}, {"sha": "ee85247301c9ccba15d775daa7d9169d8e3de468", "filename": "src/test/ui/error-codes/E0767.stderr", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/src%2Ftest%2Fui%2Ferror-codes%2FE0767.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/74fec9b95ad308c3dc064bb38778aea4ec51f5ee/src%2Ftest%2Fui%2Ferror-codes%2FE0767.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0767.stderr?ref=74fec9b95ad308c3dc064bb38778aea4ec51f5ee", "patch": "@@ -1,14 +1,27 @@\n error[E0767]: use of unreachable label `'a`\n-  --> $DIR/E0767.rs:4:26\n+  --> $DIR/E0767.rs:5:26\n    |\n LL |     'a: loop {\n    |     -- unreachable label defined here\n-LL |         || {\n+...\n LL |             loop { break 'a; }\n    |                          ^^ unreachable label `'a`\n    |\n    = note: labels are unreachable through functions, closures, async blocks and modules\n \n-error: aborting due to previous error\n+error[E0308]: mismatched types\n+  --> $DIR/E0767.rs:3:9\n+   |\n+LL | /         || {\n+LL | |\n+LL | |             loop { break 'a; }\n+LL | |         }\n+   | |_________^ expected `()`, found closure\n+   |\n+   = note: expected unit type `()`\n+                found closure `[closure@$DIR/E0767.rs:3:9: 3:11]`\n+\n+error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0767`.\n+Some errors have detailed explanations: E0308, E0767.\n+For more information about an error, try `rustc --explain E0308`."}]}