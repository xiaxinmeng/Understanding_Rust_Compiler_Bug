{"sha": "c822546c9ebd79a245ca171a56f452b373ab623f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4MjI1NDZjOWViZDc5YTI0NWNhMTcxYTU2ZjQ1MmIzNzNhYjYyM2Y=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-04-04T18:24:44Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-04-04T18:24:44Z"}, "message": "mk: Hardcode the bootstrap key for each release\n\nStarting with the 1.10.0 release we would like to bootstrap all compilers from\nthe previous stable release. For example the 1.10.0 compiler should bootstrap\nfrom the literal 1.9.0 release artifacts. To do this, however, we need a way to\nenable unstable features temporarily in a stable compiler (as the released\ncompiler is stable), but it turns out we already have a way to do that!\n\nAt compile time the configure script selects a `CFG_BOOTSTRAP_KEY` variable\nvalue and then exports it into the makefiles. If the `RUSTC_BOOTSTRAP_KEY`\nenvironment variable is set to this value, then the compiler is allowed to\n\"cheat\" and use unstable features.\n\nThis method of choosing the bootstrap key, however, is problematic for the\nintention of bootstrapping from the previous release. Each time a 1.9.0 compiler\nis created, a new bootstrap key will be selected. That means that the 1.10.0\ncompiler will only compile from *our* literal release artifacts. Instead\ndistributions would like to bootstrap from their own compilers, so instead we\nsimply hardcode the bootstrap key for each release.\n\nThis patch uses the same `CFG_FILENAME_EXTRA` value (a hash of the release\nstring) as the bootstrap key. Consequently all 1.9.0 compilers, no matter where\nthey are compiled, will have the same bootstrap key. Additionally we won't need\nto keep updating this as it'll be based on the release number anyway.\n\nOnce the 1.9.0 beta has been created, we can update the 1.10.0 nightly sources\n(the `master` branch at that time) to bootstrap from that release using this\nhard-coded bootstrap key. We will likely just hardcode into the makefiles what\nthe previous bootstrap key was and we'll change that whenever the stage0\ncompiler is updated.", "tree": {"sha": "7b4f250c9b22ab33569e67cb366476754b4ebc3c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b4f250c9b22ab33569e67cb366476754b4ebc3c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c822546c9ebd79a245ca171a56f452b373ab623f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c822546c9ebd79a245ca171a56f452b373ab623f", "html_url": "https://github.com/rust-lang/rust/commit/c822546c9ebd79a245ca171a56f452b373ab623f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c822546c9ebd79a245ca171a56f452b373ab623f/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "080edd9957e3587e90314e02af7955fef14a6bd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/080edd9957e3587e90314e02af7955fef14a6bd7", "html_url": "https://github.com/rust-lang/rust/commit/080edd9957e3587e90314e02af7955fef14a6bd7"}], "stats": {"total": 23, "additions": 11, "deletions": 12}, "files": [{"sha": "84ed6fa895422bf541752e2b734f66cb2e6f1805", "filename": "configure", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c822546c9ebd79a245ca171a56f452b373ab623f/configure", "raw_url": "https://github.com/rust-lang/rust/raw/c822546c9ebd79a245ca171a56f452b373ab623f/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=c822546c9ebd79a245ca171a56f452b373ab623f", "patch": "@@ -716,18 +716,6 @@ if [ -n \"$CFG_ENABLE_DEBUG_JEMALLOC\" ]; then putvar CFG_ENABLE_DEBUG_JEMALLOC; f\n \n if [ -n \"$CFG_ENABLE_ORBIT\" ]; then putvar CFG_ENABLE_ORBIT; fi\n \n-# A magic value that allows the compiler to use unstable features\n-# during the bootstrap even when doing so would normally be an error\n-# because of feature staging or because the build turns on\n-# warnings-as-errors and unstable features default to warnings.  The\n-# build has to match this key in an env var. Meant to be a mild\n-# deterrent from users just turning on unstable features on the stable\n-# channel.\n-# Basing CFG_BOOTSTRAP_KEY on CFG_BOOTSTRAP_KEY lets it get picked up\n-# during a Makefile reconfig.\n-CFG_BOOTSTRAP_KEY=\"${CFG_BOOTSTRAP_KEY-`date +%H:%M:%S`}\"\n-putvar CFG_BOOTSTRAP_KEY\n-\n step_msg \"looking for build programs\"\n \n probe_need CFG_CURLORWGET  curl wget"}, {"sha": "9b8080f96610f3d763acab25fe67fdf8ea82dc9c", "filename": "mk/main.mk", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c822546c9ebd79a245ca171a56f452b373ab623f/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/c822546c9ebd79a245ca171a56f452b373ab623f/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=c822546c9ebd79a245ca171a56f452b373ab623f", "patch": "@@ -24,6 +24,17 @@ CFG_PRERELEASE_VERSION=.1\n # versions in the same place\n CFG_FILENAME_EXTRA=$(shell printf '%s' $(CFG_RELEASE)$(CFG_EXTRA_FILENAME) | $(CFG_HASH_COMMAND))\n \n+# A magic value that allows the compiler to use unstable features during the\n+# bootstrap even when doing so would normally be an error because of feature\n+# staging or because the build turns on warnings-as-errors and unstable features\n+# default to warnings. The build has to match this key in an env var.\n+#\n+# This value is keyed off the release to ensure that all compilers for one\n+# particular release have the same bootstrap key. Note that this is\n+# intentionally not \"secure\" by any definition, this is largely just a deterrent\n+# from users enabling unstable features on the stable compiler.\n+CFG_BOOTSTRAP_KEY=$(CFG_FILENAME_EXTRA)\n+\n ifeq ($(CFG_RELEASE_CHANNEL),stable)\n # This is the normal semver version string, e.g. \"0.12.0\", \"0.12.0-nightly\"\n CFG_RELEASE=$(CFG_RELEASE_NUM)"}]}