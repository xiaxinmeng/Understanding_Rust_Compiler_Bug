{"sha": "f8ca805422db8ff5c5112526db0794603b259577", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4Y2E4MDU0MjJkYjhmZjVjNTExMjUyNmRiMDc5NDYwM2IyNTk1Nzc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-12T19:27:39Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-03-11T16:41:36Z"}, "message": "configure: Remove --build detection\n\nThis commit removes detection of CFG_OSTYPE and CFG_CPUTYPE from the configure\nscript, which means that the default value of `--build` is no longer present in\nthe configure script. All this logic is now available in rustbuild itself, so\nthere's no need to duplicate it.", "tree": {"sha": "2ead485047591d74f7d5ace109a02cd99dd769dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2ead485047591d74f7d5ace109a02cd99dd769dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f8ca805422db8ff5c5112526db0794603b259577", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f8ca805422db8ff5c5112526db0794603b259577", "html_url": "https://github.com/rust-lang/rust/commit/f8ca805422db8ff5c5112526db0794603b259577", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f8ca805422db8ff5c5112526db0794603b259577/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51a4238dccf39b34ea56cb02a5e01ae6dc06356e", "url": "https://api.github.com/repos/rust-lang/rust/commits/51a4238dccf39b34ea56cb02a5e01ae6dc06356e", "html_url": "https://github.com/rust-lang/rust/commit/51a4238dccf39b34ea56cb02a5e01ae6dc06356e"}], "stats": {"total": 241, "additions": 27, "deletions": 214}, "files": [{"sha": "9b34e214214a5e173ec7bbc9957e47695be8a5b4", "filename": "configure", "status": "modified", "additions": 1, "deletions": 202, "changes": 203, "blob_url": "https://github.com/rust-lang/rust/blob/f8ca805422db8ff5c5112526db0794603b259577/configure", "raw_url": "https://github.com/rust-lang/rust/raw/f8ca805422db8ff5c5112526db0794603b259577/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=f8ca805422db8ff5c5112526db0794603b259577", "patch": "@@ -384,207 +384,6 @@ need_cmd sed\n need_cmd file\n need_cmd make\n \n-msg \"inspecting environment\"\n-\n-CFG_OSTYPE=$(uname -s)\n-CFG_CPUTYPE=$(uname -m)\n-\n-if [ $CFG_OSTYPE = Darwin -a $CFG_CPUTYPE = i386 ]\n-then\n-    # Darwin's `uname -s` lies and always returns i386. We have to use sysctl\n-    # instead.\n-    if sysctl hw.optional.x86_64 | grep -q ': 1'\n-    then\n-        CFG_CPUTYPE=x86_64\n-    fi\n-fi\n-\n-# The goal here is to come up with the same triple as LLVM would,\n-# at least for the subset of platforms we're willing to target.\n-\n-case $CFG_OSTYPE in\n-\n-    Linux)\n-        CFG_OSTYPE=unknown-linux-gnu\n-        ;;\n-\n-    FreeBSD)\n-        CFG_OSTYPE=unknown-freebsd\n-        ;;\n-\n-    DragonFly)\n-        CFG_OSTYPE=unknown-dragonfly\n-        ;;\n-\n-    Bitrig)\n-        CFG_OSTYPE=unknown-bitrig\n-        ;;\n-\n-    OpenBSD)\n-        CFG_OSTYPE=unknown-openbsd\n-       ;;\n-\n-    NetBSD)\n-\t    CFG_OSTYPE=unknown-netbsd\n-\t    ;;\n-\n-    Darwin)\n-        CFG_OSTYPE=apple-darwin\n-        ;;\n-\n-    SunOS)\n-        CFG_OSTYPE=sun-solaris\n-        CFG_CPUTYPE=$(isainfo -n)\n-        ;;\n-\n-    Haiku)\n-        CFG_OSTYPE=unknown-haiku\n-        ;;\n-\n-    MINGW*)\n-        # msys' `uname` does not print gcc configuration, but prints msys\n-        # configuration. so we cannot believe `uname -m`:\n-        # msys1 is always i686 and msys2 is always x86_64.\n-        # instead, msys defines $MSYSTEM which is MINGW32 on i686 and\n-        # MINGW64 on x86_64.\n-        CFG_CPUTYPE=i686\n-        CFG_OSTYPE=pc-windows-gnu\n-        if [ \"$MSYSTEM\" = MINGW64 ]\n-        then\n-            CFG_CPUTYPE=x86_64\n-        fi\n-        ;;\n-\n-    MSYS*)\n-        CFG_OSTYPE=pc-windows-gnu\n-        ;;\n-\n-# Thad's Cygwin identifiers below\n-\n-#   Vista 32 bit\n-    CYGWIN_NT-6.0)\n-        CFG_OSTYPE=pc-windows-gnu\n-        CFG_CPUTYPE=i686\n-        ;;\n-\n-#   Vista 64 bit\n-    CYGWIN_NT-6.0-WOW64)\n-        CFG_OSTYPE=pc-windows-gnu\n-        CFG_CPUTYPE=x86_64\n-        ;;\n-\n-#   Win 7 32 bit\n-    CYGWIN_NT-6.1)\n-        CFG_OSTYPE=pc-windows-gnu\n-        CFG_CPUTYPE=i686\n-        ;;\n-\n-#   Win 7 64 bit\n-    CYGWIN_NT-6.1-WOW64)\n-        CFG_OSTYPE=pc-windows-gnu\n-        CFG_CPUTYPE=x86_64\n-        ;;\n-\n-#   Win 8 # uname -s on 64-bit cygwin does not contain WOW64, so simply use uname -m to detect arch (works in my install)\n-    CYGWIN_NT-6.3)\n-    \tCFG_OSTYPE=pc-windows-gnu\n-    \t;;\n-# We do not detect other OS such as XP/2003 using 64 bit using uname.\n-# If we want to in the future, we will need to use Cygwin - Chuck's csih helper in /usr/lib/csih/winProductName.exe or alternative.\n-    *)\n-        err \"unknown OS type: $CFG_OSTYPE\"\n-        ;;\n-esac\n-\n-\n-case $CFG_CPUTYPE in\n-\n-    i386 | i486 | i686 | i786 | x86)\n-        CFG_CPUTYPE=i686\n-        ;;\n-\n-    xscale | arm)\n-        CFG_CPUTYPE=arm\n-        ;;\n-\n-    armv6l)\n-        CFG_CPUTYPE=arm\n-        CFG_OSTYPE=\"${CFG_OSTYPE}eabihf\"\n-        ;;\n-\n-    armv7l | armv8l)\n-        CFG_CPUTYPE=armv7\n-        CFG_OSTYPE=\"${CFG_OSTYPE}eabihf\"\n-        ;;\n-\n-    aarch64 | arm64)\n-        CFG_CPUTYPE=aarch64\n-        ;;\n-\n-    powerpc | ppc)\n-        CFG_CPUTYPE=powerpc\n-        ;;\n-\n-    powerpc64 | ppc64)\n-        CFG_CPUTYPE=powerpc64\n-        ;;\n-\n-    powerpc64le | ppc64le)\n-        CFG_CPUTYPE=powerpc64le\n-        ;;\n-\n-    s390x)\n-        CFG_CPUTYPE=s390x\n-        ;;\n-\n-    x86_64 | x86-64 | x64 | amd64)\n-        CFG_CPUTYPE=x86_64\n-        ;;\n-\n-    mips | mips64)\n-        if [ \"$CFG_CPUTYPE\" = \"mips64\" ]; then\n-            CFG_OSTYPE=\"${CFG_OSTYPE}abi64\"\n-        fi\n-        ENDIAN=$(printf '\\1' | od -dAn)\n-        if [ \"$ENDIAN\" -eq 1 ]; then\n-            CFG_CPUTYPE=\"${CFG_CPUTYPE}el\"\n-        elif [ \"$ENDIAN\" -ne 256 ]; then\n-            err \"unknown endianness: $ENDIAN (expecting 1 for little or 256 for big)\"\n-        fi\n-        ;;\n-\n-    BePC)\n-        CFG_CPUTYPE=i686\n-        ;;\n-\n-    *)\n-        err \"unknown CPU type: $CFG_CPUTYPE\"\n-esac\n-\n-# Detect 64 bit linux systems with 32 bit userland and force 32 bit compilation\n-if [ $CFG_OSTYPE = unknown-linux-gnu -a $CFG_CPUTYPE = x86_64 ]\n-then\n-    # $SHELL does not exist in standard 'sh', so probably only exists\n-    # if configure is running in an interactive bash shell. /usr/bin/env\n-    # exists *everywhere*.\n-    BIN_TO_PROBE=\"$SHELL\"\n-    if [ ! -r \"$BIN_TO_PROBE\" ]; then\n-        if [ -r \"/usr/bin/env\" ]; then\n-            BIN_TO_PROBE=\"/usr/bin/env\"\n-        else\n-            warn \"Cannot check if the userland is i686 or x86_64\"\n-        fi\n-    fi\n-    file -L \"$BIN_TO_PROBE\" | grep -q \"x86[_-]64\"\n-    if [ $? != 0 ]; then\n-        msg \"i686 userland on x86_64 Linux kernel\"\n-        CFG_CPUTYPE=i686\n-    fi\n-fi\n-\n-\n-DEFAULT_BUILD=\"${CFG_CPUTYPE}-${CFG_OSTYPE}\"\n-\n CFG_SRC_DIR=\"$(abs_path $(dirname $0))/\"\n CFG_SRC_DIR_RELATIVE=\"$(dirname $0)/\"\n CFG_BUILD_DIR=\"$(pwd)/\"\n@@ -673,7 +472,7 @@ valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt llvm-root \"\" \"set LLVM root\"\n valopt python \"\" \"set path to python\"\n valopt jemalloc-root \"\" \"set directory where libjemalloc_pic.a is located\"\n-valopt build \"${DEFAULT_BUILD}\" \"GNUs ./configure syntax LLVM build triple\"\n+valopt build \"\" \"GNUs ./configure syntax LLVM build triple\"\n valopt android-cross-path \"\" \"Android NDK standalone path (deprecated)\"\n valopt i686-linux-android-ndk \"\" \"i686-linux-android NDK standalone path\"\n valopt arm-linux-androideabi-ndk \"\" \"arm-linux-androideabi NDK standalone path\""}, {"sha": "b326f95e505fb8b8c2e314d5877e70a31d6f5333", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/f8ca805422db8ff5c5112526db0794603b259577/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/f8ca805422db8ff5c5112526db0794603b259577/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=f8ca805422db8ff5c5112526db0794603b259577", "patch": "@@ -296,8 +296,10 @@ def get_toml(self, key):\n \n     def get_mk(self, key):\n         for line in iter(self.config_mk.splitlines()):\n-            if line.startswith(key):\n-                return line[line.find(':=') + 2:].strip()\n+            if line.startswith(key + ' '):\n+                var = line[line.find(':=') + 2:].strip()\n+                if var != '':\n+                    return var\n         return None\n \n     def cargo(self):\n@@ -438,6 +440,8 @@ def build_triple(self):\n                 sys.exit(err)\n         elif ostype == 'Darwin':\n             ostype = 'apple-darwin'\n+        elif ostype == 'Haiku':\n+            ostype = 'unknown-haiku'\n         elif ostype.startswith('MINGW'):\n             # msys' `uname` does not print gcc configuration, but prints msys\n             # configuration. so we cannot believe `uname -m`:\n@@ -465,9 +469,12 @@ def build_triple(self):\n             cputype = 'i686'\n         elif cputype in {'xscale', 'arm'}:\n             cputype = 'arm'\n-        elif cputype in {'armv7l', 'armv8l'}:\n+        elif cputype in {'armv6l', 'armv7l', 'armv8l'}:\n             cputype = 'arm'\n             ostype += 'eabihf'\n+        elif cputype == 'armv7l':\n+            cputype = 'armv7'\n+            ostype += 'eabihf'\n         elif cputype == 'aarch64':\n             cputype = 'aarch64'\n         elif cputype == 'arm64':\n@@ -488,12 +495,20 @@ def build_triple(self):\n                 raise ValueError('unknown byteorder: ' + sys.byteorder)\n             # only the n64 ABI is supported, indicate it\n             ostype += 'abi64'\n-        elif cputype in {'powerpc', 'ppc', 'ppc64'}:\n+        elif cputype in {'powerpc', 'ppc'}:\n             cputype = 'powerpc'\n+        elif cputype in {'powerpc64', 'ppc64'}:\n+            cputype = 'powerpc64'\n+        elif cputype in {'powerpc64le', 'ppc64le'}:\n+            cputype = 'powerpc64le'\n         elif cputype == 'sparcv9':\n             pass\n         elif cputype in {'amd64', 'x86_64', 'x86-64', 'x64'}:\n             cputype = 'x86_64'\n+        elif cputype == 's390x':\n+            cputype = 's390x'\n+        elif cputype == 'BePC':\n+            cputype = 'i686'\n         else:\n             err = \"unknown cpu type: \" + cputype\n             if self.verbose:"}, {"sha": "431d4a333d3375f07ef942dc92017b672ff77801", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f8ca805422db8ff5c5112526db0794603b259577/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f8ca805422db8ff5c5112526db0794603b259577/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=f8ca805422db8ff5c5112526db0794603b259577", "patch": "@@ -463,14 +463,13 @@ impl Config {\n             }\n \n             match key {\n-                \"CFG_BUILD\" => self.build = value.to_string(),\n-                \"CFG_HOST\" => {\n-                    self.host = value.split(\" \").map(|s| s.to_string())\n-                                     .collect();\n-                }\n-                \"CFG_TARGET\" => {\n-                    self.target = value.split(\" \").map(|s| s.to_string())\n-                                       .collect();\n+                \"CFG_BUILD\" if value.len() > 0 => self.build = value.to_string(),\n+                \"CFG_HOST\" if value.len() > 0 => {\n+                    self.host.extend(value.split(\" \").map(|s| s.to_string()));\n+\n+                }\n+                \"CFG_TARGET\" if value.len() > 0 => {\n+                    self.target.extend(value.split(\" \").map(|s| s.to_string()));\n                 }\n                 \"CFG_MUSL_ROOT\" if value.len() > 0 => {\n                     self.musl_root = Some(parse_configure_path(value));"}]}