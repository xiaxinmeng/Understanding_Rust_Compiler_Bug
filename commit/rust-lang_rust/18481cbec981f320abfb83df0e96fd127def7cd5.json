{"sha": "18481cbec981f320abfb83df0e96fd127def7cd5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4NDgxY2JlYzk4MWYzMjBhYmZiODNkZjBlOTZmZDEyN2RlZjdjZDU=", "commit": {"author": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2020-07-30T18:39:53Z"}, "committer": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2020-08-08T04:40:07Z"}, "message": "Rm restriction on ord of default types w/ consts", "tree": {"sha": "1dbec3e83e917272f143fe729d6ee6befee44792", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1dbec3e83e917272f143fe729d6ee6befee44792"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/18481cbec981f320abfb83df0e96fd127def7cd5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/18481cbec981f320abfb83df0e96fd127def7cd5", "html_url": "https://github.com/rust-lang/rust/commit/18481cbec981f320abfb83df0e96fd127def7cd5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/18481cbec981f320abfb83df0e96fd127def7cd5/comments", "author": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "58b1a04b9edc19a2f44f780475ebace12a0ab435", "url": "https://api.github.com/repos/rust-lang/rust/commits/58b1a04b9edc19a2f44f780475ebace12a0ab435", "html_url": "https://github.com/rust-lang/rust/commit/58b1a04b9edc19a2f44f780475ebace12a0ab435"}], "stats": {"total": 58, "additions": 20, "deletions": 38}, "files": [{"sha": "893de1f60e87048b81c4e51b80e3888e43a0e0cb", "filename": "src/librustc_ast_passes/ast_validation.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Flibrustc_ast_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Flibrustc_ast_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_passes%2Fast_validation.rs?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -735,7 +735,8 @@ fn validate_generic_param_order<'a>(\n         }\n         let max_param = &mut max_param;\n         match max_param {\n-            Some(ParamKindOrd::Const) if ParamKindOrd::Type == kind => (),\n+            Some(ParamKindOrd::Const) if ParamKindOrd::Type == kind &&\n+                sess.features_untracked().const_generics => (),\n             Some(max_param) if *max_param > kind => {\n                 let entry = out_of_order.entry(kind).or_insert((*max_param, vec![]));\n                 entry.1.push(span);"}, {"sha": "9e071e674e709317cf547b7c2236d46915936585", "filename": "src/test/ui/const-generics/argument_order.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.rs?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -1,14 +1,13 @@\n #![feature(const_generics)]\n-//~^ WARN the feature `const_generics` is incomplete\n+#![allow(incomplete_features)]\n \n-struct Bad<const N: usize, T> { //~ ERROR type parameters must be declared prior\n+struct Bad<const N: usize, T> {\n     arr: [u8; { N }],\n     another: T,\n }\n \n struct AlsoBad<const N: usize, 'a, T, 'b, const M: usize, U> {\n-    //~^ ERROR type parameters must be declared prior\n-    //~| ERROR lifetime parameters must be declared prior\n+    //~^ ERROR lifetime parameters must be declared prior\n     a: &'a T,\n     b: &'b U,\n }"}, {"sha": "058cc346d1b744fcab3a9ab3258e37eabe3aa2f1", "filename": "src/test/ui/const-generics/argument_order.stderr", "status": "modified", "additions": 2, "deletions": 23, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fargument_order.stderr?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -1,39 +1,18 @@\n-error: type parameters must be declared prior to const parameters\n-  --> $DIR/argument_order.rs:4:28\n-   |\n-LL | struct Bad<const N: usize, T> {\n-   |           -----------------^- help: reorder the parameters: lifetimes, then types, then consts: `<T, const N: usize>`\n-\n error: lifetime parameters must be declared prior to const parameters\n   --> $DIR/argument_order.rs:9:32\n    |\n LL | struct AlsoBad<const N: usize, 'a, T, 'b, const M: usize, U> {\n    |               -----------------^^-----^^-------------------- help: reorder the parameters: lifetimes, then types, then consts: `<'a, 'b, T, U, const N: usize, const M: usize>`\n \n-error: type parameters must be declared prior to const parameters\n-  --> $DIR/argument_order.rs:9:36\n-   |\n-LL | struct AlsoBad<const N: usize, 'a, T, 'b, const M: usize, U> {\n-   |               ---------------------^----------------------^- help: reorder the parameters: lifetimes, then types, then consts: `<'a, 'b, T, U, const N: usize, const M: usize>`\n-\n-warning: the feature `const_generics` is incomplete and may not be safe to use and/or cause compiler crashes\n-  --> $DIR/argument_order.rs:1:12\n-   |\n-LL | #![feature(const_generics)]\n-   |            ^^^^^^^^^^^^^^\n-   |\n-   = note: `#[warn(incomplete_features)]` on by default\n-   = note: see issue #44580 <https://github.com/rust-lang/rust/issues/44580> for more information\n-\n error[E0747]: lifetime provided when a type was expected\n-  --> $DIR/argument_order.rs:17:23\n+  --> $DIR/argument_order.rs:16:23\n    |\n LL |     let _: AlsoBad<7, 'static, u32, 'static, 17, u16>;\n    |                       ^^^^^^^\n    |\n    = note: lifetime arguments must be provided before type arguments\n    = help: reorder the arguments: lifetimes, then types, then consts: `<'a, 'b, T, U, N, M>`\n \n-error: aborting due to 4 previous errors; 1 warning emitted\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0747`."}, {"sha": "0d787d9a67b590d5ccd052ca8bbe563d80f05ad9", "filename": "src/test/ui/const-generics/const-param-before-other-params.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.rs?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -5,8 +5,6 @@ fn bar<const X: (), 'a>(_: &'a ()) {\n     //~^ ERROR lifetime parameters must be declared prior to const parameters\n }\n \n-fn foo<const X: (), T>(_: &T) {\n-    //~^ ERROR type parameters must be declared prior to const parameters\n-}\n+fn foo<const X: (), T>(_: &T) {}\n \n fn main() {}"}, {"sha": "5c1171aae605152585f188e631f8239151328669", "filename": "src/test/ui/const-generics/const-param-before-other-params.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fconst-param-before-other-params.stderr?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -4,11 +4,5 @@ error: lifetime parameters must be declared prior to const parameters\n LL | fn bar<const X: (), 'a>(_: &'a ()) {\n    |       --------------^^- help: reorder the parameters: lifetimes, then types, then consts: `<'a, const X: ()>`\n \n-error: type parameters must be declared prior to const parameters\n-  --> $DIR/const-param-before-other-params.rs:8:21\n-   |\n-LL | fn foo<const X: (), T>(_: &T) {\n-   |       --------------^- help: reorder the parameters: lifetimes, then types, then consts: `<T, const X: ()>`\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n "}, {"sha": "f1b5c1f02c8628e93d048cdc90fd076d60cce206", "filename": "src/test/ui/const-generics/defaults/right-order.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fright-order.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18481cbec981f320abfb83df0e96fd127def7cd5/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fright-order.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fright-order.rs?ref=18481cbec981f320abfb83df0e96fd127def7cd5", "patch": "@@ -0,0 +1,11 @@\n+// run-pass\n+// Verifies that having generic parameters after constants is permitted\n+\n+#![feature(const_generics)]\n+#![allow(incomplete_features)]\n+\n+struct A<const N: usize, T=u32>(T);\n+\n+fn main() {\n+  let _: A<3> = A(0);\n+}"}]}