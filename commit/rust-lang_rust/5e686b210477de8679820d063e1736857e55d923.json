{"sha": "5e686b210477de8679820d063e1736857e55d923", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlNjg2YjIxMDQ3N2RlODY3OTgyMGQwNjNlMTczNjg1N2U1NWQ5MjM=", "commit": {"author": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2018-09-16T19:43:33Z"}, "committer": {"name": "Jorge Aparicio", "email": "jorge@japaric.io", "date": "2018-09-26T13:21:26Z"}, "message": "unstable-book: recommend an INFO section\n\nthat makes the output .stack_sizes section non-allocatable when linking with\neither GNU LD or LLD", "tree": {"sha": "021a9c1ba9ebc9225a9c5fa326ff2070acf11bf7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/021a9c1ba9ebc9225a9c5fa326ff2070acf11bf7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e686b210477de8679820d063e1736857e55d923", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e686b210477de8679820d063e1736857e55d923", "html_url": "https://github.com/rust-lang/rust/commit/5e686b210477de8679820d063e1736857e55d923", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e686b210477de8679820d063e1736857e55d923/comments", "author": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "committer": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d2bb283ce077059663a40588105cd0ce09182df", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d2bb283ce077059663a40588105cd0ce09182df", "html_url": "https://github.com/rust-lang/rust/commit/7d2bb283ce077059663a40588105cd0ce09182df"}], "stats": {"total": 26, "additions": 18, "deletions": 8}, "files": [{"sha": "b5456f9ba39aeab40a8b806ffa7fb934cea94d79", "filename": "src/doc/unstable-book/src/compiler-flags/emit-stack-sizes.md", "status": "modified", "additions": 18, "deletions": 8, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/5e686b210477de8679820d063e1736857e55d923/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Femit-stack-sizes.md", "raw_url": "https://github.com/rust-lang/rust/raw/5e686b210477de8679820d063e1736857e55d923/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Femit-stack-sizes.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Femit-stack-sizes.md?ref=5e686b210477de8679820d063e1736857e55d923", "patch": "@@ -99,7 +99,8 @@ To preserve the section you can use a linker script like the one shown below.\n /* file: keep-stack-sizes.x */\n SECTIONS\n {\n-  .stack_sizes :\n+  /* `INFO` makes the section not allocatable so it won't be loaded into memory */\n+  .stack_sizes (INFO) :\n   {\n     KEEP(*(.stack_sizes));\n   }\n@@ -133,19 +134,28 @@ $ RUSTFLAGS=\"-Z emit-stack-sizes\" cargo rustc --release -- \\\n     -C link-arg=-N\n \n $ size -A target/release/hello | grep stack_sizes\n-.stack_sizes                               90   205368\n+.stack_sizes                               90   176272\n+\n+$ # non-allocatable section (flags don't contain the \"A\" (alloc) flag)\n+$ readelf -S target/release/hello\n+Section Headers:\n+  [Nr]   Name              Type             Address           Offset\n+       Size              EntSize            Flags  Link  Info  Align\n+(..)\n+  [1031] .stack_sizes      PROGBITS         000000000002b090  0002b0f0\n+       000000000000005a  0000000000000000   L       5     0     1\n \n $ objdump -s -j .stack_sizes target/release/hello\n \n target/release/hello:     file format elf64-x86-64\n \n Contents of section .stack_sizes:\n- 32238 c0040000 00000000 08f00400 00000000  ................\n- 32248 00080005 00000000 00000810 05000000  ................\n- 32258 00000000 20050000 00000000 10400500  .... ........@..\n- 32268 00000000 00087005 00000000 00000080  ......p.........\n- 32278 05000000 00000000 90050000 00000000  ................\n- 32288 00a00500 00000000 0000               ..........\n+ 2b090 c0040000 00000000 08f00400 00000000  ................\n+ 2b0a0 00080005 00000000 00000810 05000000  ................\n+ 2b0b0 00000000 20050000 00000000 10400500  .... ........@..\n+ 2b0c0 00000000 00087005 00000000 00000080  ......p.........\n+ 2b0d0 05000000 00000000 90050000 00000000  ................\n+ 2b0e0 00a00500 00000000 0000               ..........\n ```\n \n > Author note: I'm not entirely sure why, in *this* case, `-N` is required in"}]}