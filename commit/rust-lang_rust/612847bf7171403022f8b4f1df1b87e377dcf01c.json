{"sha": "612847bf7171403022f8b4f1df1b87e377dcf01c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxMjg0N2JmNzE3MTQwMzAyMmY4YjRmMWRmMWI4N2UzNzdkY2YwMWM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-26T21:26:14Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-26T21:26:14Z"}, "message": "Auto merge of #41563 - aidanhs:aphs-fix-spurious-osx-openssl-failure, r=alexcrichton\n\nMake sure openssl compiles with only one core\n\nThis is (hopefully) a fix for the osx openssl spurious failure - #40417.\n\nThe intermittent failures and failing in different ways made me think of a race condition. But programs are parallel make safe right? [Not openssl](https://github.com/openssl/openssl/issues/298). But we don't do a parallel make on openssl [do we](https://github.com/rust-lang/rust/blob/8c4f2c64c6759a82f143e23964a46a65c67509c9/src/bootstrap/native.rs#L309)? This confused me, except \"Waiting for unfinished jobs\" is present in the logs...which is evidence of a parallel make!\n\nIt turns out that when we invoke to top level target [in run.sh](https://github.com/rust-lang/rust/blob/036983201d4e9aeb5c5e56e47c305971972b2569/src/ci/run.sh#L75-L77), make will [pass the flags downwards](https://www.gnu.org/software/make/manual/html_node/Options_002fRecursion.html) in order to take advantage of parallelism in sub-makes. Of course, we don't want this in openssl! Override this by explicitly disabling parallelism on the command line.\n\nI don't know why this hasn't happened on anything except OSX. Maybe Linux binutils check if the file is in use?\n\nr? @alexcrichton", "tree": {"sha": "57464197ca23e8d6842ca346b51c65633217fc4c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57464197ca23e8d6842ca346b51c65633217fc4c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/612847bf7171403022f8b4f1df1b87e377dcf01c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/612847bf7171403022f8b4f1df1b87e377dcf01c", "html_url": "https://github.com/rust-lang/rust/commit/612847bf7171403022f8b4f1df1b87e377dcf01c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/612847bf7171403022f8b4f1df1b87e377dcf01c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "036983201d4e9aeb5c5e56e47c305971972b2569", "url": "https://api.github.com/repos/rust-lang/rust/commits/036983201d4e9aeb5c5e56e47c305971972b2569", "html_url": "https://github.com/rust-lang/rust/commit/036983201d4e9aeb5c5e56e47c305971972b2569"}, {"sha": "367e90775beb90e3795209dab29b428b639521cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/367e90775beb90e3795209dab29b428b639521cf", "html_url": "https://github.com/rust-lang/rust/commit/367e90775beb90e3795209dab29b428b639521cf"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "3a95aec388d301105e0c43c7be6d8d7fb22310e1", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/612847bf7171403022f8b4f1df1b87e377dcf01c/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/612847bf7171403022f8b4f1df1b87e377dcf01c/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=612847bf7171403022f8b4f1df1b87e377dcf01c", "patch": "@@ -306,7 +306,7 @@ pub fn openssl(build: &Build, target: &str) {\n     println!(\"Configuring openssl for {}\", target);\n     build.run_quiet(&mut configure);\n     println!(\"Building openssl for {}\", target);\n-    build.run_quiet(Command::new(\"make\").current_dir(&obj));\n+    build.run_quiet(Command::new(\"make\").arg(\"-j1\").current_dir(&obj));\n     println!(\"Installing openssl for {}\", target);\n     build.run_quiet(Command::new(\"make\").arg(\"install\").current_dir(&obj));\n "}]}