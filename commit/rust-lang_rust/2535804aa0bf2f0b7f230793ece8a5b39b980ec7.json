{"sha": "2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MzU4MDRhYTBiZjJmMGI3ZjIzMDc5M2VjZThhNWIzOWI5ODBlYzc=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-21T11:22:18Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-21T11:22:18Z"}, "message": "Allow underscores in camel-case between non-alphabetic characters", "tree": {"sha": "3beebfdfcdb11abb25fdc82256d0c363e4307e1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3beebfdfcdb11abb25fdc82256d0c363e4307e1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "html_url": "https://github.com/rust-lang/rust/commit/2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b39c4bc12358078f77ddd01288b24252f757f37d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b39c4bc12358078f77ddd01288b24252f757f37d", "html_url": "https://github.com/rust-lang/rust/commit/b39c4bc12358078f77ddd01288b24252f757f37d"}], "stats": {"total": 47, "additions": 35, "deletions": 12}, "files": [{"sha": "26b70f63d6589c18dc4c1e5cdb3164ba458c0ea6", "filename": "src/Cargo.lock", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "patch": "@@ -967,6 +967,11 @@ name = \"lazy_static\"\n version = \"0.2.11\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"lazy_static\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"lazycell\"\n version = \"0.5.1\"\n@@ -1863,7 +1868,9 @@ dependencies = [\n name = \"rustc_lint\"\n version = \"0.0.0\"\n dependencies = [\n+ \"lazy_static 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"regex 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n  \"rustc_const_eval 0.0.0\",\n  \"syntax 0.0.0\",\n@@ -2813,6 +2820,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum kuchiki 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e03098e8e719c92b7794515dfd5c1724e2b12f5ce1788e61cfa4663f82eba8d8\"\n \"checksum languageserver-types 0.16.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"773e175c945800aeea4c21c04090bcb9db987b1a566ad9c6f569972299950e3e\"\n \"checksum lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"76f033c7ad61445c5b347c7382dd1237847eb1bce590fe50365dcb33d546be73\"\n+\"checksum lazy_static 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c8f31047daa365f19be14b47c29df4f7c3b581832407daabe6ae77397619237d\"\n \"checksum lazycell 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3b585b7a6811fb03aa10e74b278a0f00f8dd9b45dc681f148bb29fa5cb61859b\"\n \"checksum libc 0.2.34 (registry+https://github.com/rust-lang/crates.io-index)\" = \"36fbc8a8929c632868295d0178dd8f63fc423fd7537ad0738372bd010b3ac9b0\"\n \"checksum libgit2-sys 0.6.16 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6f74b4959cef96898f5123148724fc7dee043b9a6b99f219d948851bfbe53cb2\""}, {"sha": "2cc1827f518da06ed3d6fdb80b2f9fcbc23178f9", "filename": "src/librustc_lint/Cargo.toml", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2FCargo.toml?ref=2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "patch": "@@ -6,7 +6,7 @@ version = \"0.0.0\"\n [lib]\n name = \"rustc_lint\"\n path = \"lib.rs\"\n-crate-type = [\"dylib\"]\n+crate-types = [\"rlib\", \"dylib\"]\n test = false\n \n [dependencies]\n@@ -15,3 +15,5 @@ rustc = { path = \"../librustc\" }\n rustc_const_eval = { path = \"../librustc_const_eval\" }\n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }\n+lazy_static = \"1.0\"\n+regex = \"0.2.3\""}, {"sha": "09194d5c7c4aed3d6c820bacb36d17c8ac88ee40", "filename": "src/librustc_lint/bad_style.rs", "status": "modified", "additions": 21, "deletions": 11, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2Fbad_style.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2Fbad_style.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbad_style.rs?ref=2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "patch": "@@ -21,6 +21,12 @@ use syntax_pos::Span;\n use rustc::hir::{self, PatKind};\n use rustc::hir::intravisit::FnKind;\n \n+use regex::Regex;\n+\n+lazy_static! {\n+    static ref ALPHABETIC_UNDERSCORE: Regex = Regex::new(\"([[:alpha:]])_([[:alpha:]])\").unwrap();\n+}\n+\n #[derive(PartialEq)]\n pub enum MethodLateContext {\n     TraitAutoImpl,\n@@ -62,20 +68,24 @@ impl NonCamelCaseTypes {\n \n             // start with a non-lowercase letter rather than non-uppercase\n             // ones (some scripts don't have a concept of upper/lowercase)\n-            !name.is_empty() && !name.chars().next().unwrap().is_lowercase() && !name.contains('_')\n+            !name.is_empty() && !name.chars().next().unwrap().is_lowercase() &&\n+                !ALPHABETIC_UNDERSCORE.is_match(name)\n         }\n \n         fn to_camel_case(s: &str) -> String {\n-            s.split('_')\n-                .flat_map(|word| {\n-                    word.chars().enumerate().map(|(i, c)| if i == 0 {\n-                        c.to_uppercase().collect::<String>()\n-                    } else {\n-                        c.to_lowercase().collect()\n-                    })\n-                })\n-                .collect::<Vec<_>>()\n-                .concat()\n+            let s = s.split('_')\n+                        .map(|word| {\n+                            word.chars().enumerate().map(|(i, c)| if i == 0 {\n+                                c.to_uppercase().collect::<String>()\n+                            } else {\n+                                c.to_lowercase().collect()\n+                            })\n+                            .collect::<Vec<_>>()\n+                            .concat()\n+                        })\n+                        .collect::<Vec<_>>()\n+                        .join(\"_\");\n+            ALPHABETIC_UNDERSCORE.replace_all(s.as_str(), \"$1$2\").to_string()\n         }\n \n         if !is_camel_case(name) {"}, {"sha": "d285ac91e9fe55f9e09faf3a739556f3021c31f1", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2535804aa0bf2f0b7f230793ece8a5b39b980ec7/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=2535804aa0bf2f0b7f230793ece8a5b39b980ec7", "patch": "@@ -41,6 +41,9 @@ extern crate rustc;\n extern crate log;\n extern crate rustc_const_eval;\n extern crate syntax_pos;\n+#[macro_use]\n+extern crate lazy_static;\n+extern crate regex;\n \n use rustc::lint;\n use rustc::middle;"}]}