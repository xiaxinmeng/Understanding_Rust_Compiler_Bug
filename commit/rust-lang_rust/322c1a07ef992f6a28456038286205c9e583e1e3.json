{"sha": "322c1a07ef992f6a28456038286205c9e583e1e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyMmMxYTA3ZWY5OTJmNmEyODQ1NjAzODI4NjIwNWM5ZTU4M2UxZTM=", "commit": {"author": {"name": "llogiq", "email": "bogusandre@gmail.com", "date": "2016-09-02T20:04:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-02T20:04:28Z"}, "message": "Merge pull request #1210 from Manishearth/len_without_is_empty\n\nLen without is empty", "tree": {"sha": "981b6123cd37c833bb4ae37bfb9676159c00a2c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/981b6123cd37c833bb4ae37bfb9676159c00a2c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/322c1a07ef992f6a28456038286205c9e583e1e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/322c1a07ef992f6a28456038286205c9e583e1e3", "html_url": "https://github.com/rust-lang/rust/commit/322c1a07ef992f6a28456038286205c9e583e1e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/322c1a07ef992f6a28456038286205c9e583e1e3/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c736dc23f53f52a9c0e13e98f2f9341b80b4771", "url": "https://api.github.com/repos/rust-lang/rust/commits/9c736dc23f53f52a9c0e13e98f2f9341b80b4771", "html_url": "https://github.com/rust-lang/rust/commit/9c736dc23f53f52a9c0e13e98f2f9341b80b4771"}, {"sha": "b2de244cfddbad858fe71f9dd0c28dc6f2b85e5c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2de244cfddbad858fe71f9dd0c28dc6f2b85e5c", "html_url": "https://github.com/rust-lang/rust/commit/b2de244cfddbad858fe71f9dd0c28dc6f2b85e5c"}], "stats": {"total": 116, "additions": 80, "deletions": 36}, "files": [{"sha": "d46048b0e934c40807f24b7da889f957ed5c12f5", "filename": "CHANGELOG.md", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/322c1a07ef992f6a28456038286205c9e583e1e3/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/322c1a07ef992f6a28456038286205c9e583e1e3/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=322c1a07ef992f6a28456038286205c9e583e1e3", "patch": "@@ -2,7 +2,11 @@\n All notable changes to this project will be documented in this file.\n \n ## 0.0.88 \u2014 ??\n-* The following lints are not new but were missing from the [`clippy`] and [`clippy_pedantic`] groups: [`filter_next`], [`for_loop_over_option`], [`for_loop_over_result`], [`match_overlapping_arm`].\n+* The following lints are not new but were only usable through the `clippy`\n+  lint groups: [`filter_next`], [`for_loop_over_option`],\n+  [`for_loop_over_result`] and [`match_overlapping_arm`]. You should now be\n+  able to `#[allow/deny]` them individually and they are available directly\n+  through [`cargo clippy`].\n \n ## 0.0.87 \u2014 2016-08-31\n * Rustup to *rustc 1.13.0-nightly (eac41469d 2016-08-30)*"}, {"sha": "83b9788fba50dc00f6109b662647e52020086273", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/322c1a07ef992f6a28456038286205c9e583e1e3/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/322c1a07ef992f6a28456038286205c9e583e1e3/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=322c1a07ef992f6a28456038286205c9e583e1e3", "patch": "@@ -84,7 +84,7 @@ name\n [items_after_statements](https://github.com/Manishearth/rust-clippy/wiki#items_after_statements)                     | allow   | blocks where an item comes after a statement\n [iter_next_loop](https://github.com/Manishearth/rust-clippy/wiki#iter_next_loop)                                     | warn    | for-looping over `_.next()` which is probably not intended\n [iter_nth](https://github.com/Manishearth/rust-clippy/wiki#iter_nth)                                                 | warn    | using `.iter().nth()` on a standard library type with O(1) element access\n-[len_without_is_empty](https://github.com/Manishearth/rust-clippy/wiki#len_without_is_empty)                         | warn    | traits and impls that have `.len()` but not `.is_empty()`\n+[len_without_is_empty](https://github.com/Manishearth/rust-clippy/wiki#len_without_is_empty)                         | warn    | traits or impls with a public `len` method but no corresponding `is_empty` method\n [len_zero](https://github.com/Manishearth/rust-clippy/wiki#len_zero)                                                 | warn    | checking `.len() == 0` or `.len() > 0` (or similar) when `.is_empty()` could be used instead\n [let_and_return](https://github.com/Manishearth/rust-clippy/wiki#let_and_return)                                     | warn    | creating a let-binding and then immediately returning it like `let x = expr; x` at the end of a block\n [let_unit_value](https://github.com/Manishearth/rust-clippy/wiki#let_unit_value)                                     | warn    | creating a let binding to a value of unit type, which usually can't be used afterwards"}, {"sha": "fbcae08783682bbc2cab8b323c10ff1796e4ca35", "filename": "clippy_lints/src/len_zero.rs", "status": "modified", "additions": 25, "deletions": 19, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/322c1a07ef992f6a28456038286205c9e583e1e3/clippy_lints%2Fsrc%2Flen_zero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/322c1a07ef992f6a28456038286205c9e583e1e3/clippy_lints%2Fsrc%2Flen_zero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flen_zero.rs?ref=322c1a07ef992f6a28456038286205c9e583e1e3", "patch": "@@ -42,13 +42,13 @@ declare_lint! {\n /// **Example:**\n /// ```rust\n /// impl X {\n-///     fn len(&self) -> usize { .. }\n+///     pub fn len(&self) -> usize { .. }\n /// }\n /// ```\n declare_lint! {\n     pub LEN_WITHOUT_IS_EMPTY,\n     Warn,\n-    \"traits and impls that have `.len()` but not `.is_empty()`\"\n+    \"traits or impls with a public `len` method but no corresponding `is_empty` method\"\n }\n \n #[derive(Copy,Clone)]\n@@ -99,13 +99,12 @@ fn check_trait_items(cx: &LateContext, item: &Item, trait_items: &[TraitItem]) {\n     }\n \n     if !trait_items.iter().any(|i| is_named_self(i, \"is_empty\")) {\n-        for i in trait_items {\n-            if is_named_self(i, \"len\") {\n+        if let Some(i) = trait_items.iter().find(|i| is_named_self(i, \"len\")) {\n+            if cx.access_levels.is_exported(i.id) {\n                 span_lint(cx,\n                           LEN_WITHOUT_IS_EMPTY,\n                           i.span,\n-                          &format!(\"trait `{}` has a `.len(_: &Self)` method, but no `.is_empty(_: &Self)` method. \\\n-                                    Consider adding one\",\n+                          &format!(\"trait `{}` has a `len` method but no `is_empty` method\",\n                                    item.name));\n             }\n         }\n@@ -122,19 +121,26 @@ fn check_impl_items(cx: &LateContext, item: &Item, impl_items: &[ImplItem]) {\n         }\n     }\n \n-    if !impl_items.iter().any(|i| is_named_self(i, \"is_empty\")) {\n-        for i in impl_items {\n-            if is_named_self(i, \"len\") {\n-                let ty = cx.tcx.node_id_to_type(item.id);\n-\n-                span_lint(cx,\n-                          LEN_WITHOUT_IS_EMPTY,\n-                          i.span,\n-                          &format!(\"item `{}` has a `.len(_: &Self)` method, but no `.is_empty(_: &Self)` method. \\\n-                                    Consider adding one\",\n-                                   ty));\n-                return;\n-            }\n+    let is_empty = if let Some(is_empty) = impl_items.iter().find(|i| is_named_self(i, \"is_empty\")) {\n+        if cx.access_levels.is_exported(is_empty.id) {\n+            return;\n+        } else {\n+            \"a private\"\n+        }\n+    } else {\n+        \"no corresponding\"\n+    };\n+\n+    if let Some(i) = impl_items.iter().find(|i| is_named_self(i, \"len\")) {\n+        if cx.access_levels.is_exported(i.id) {\n+            let ty = cx.tcx.node_id_to_type(item.id);\n+\n+            span_lint(cx,\n+                      LEN_WITHOUT_IS_EMPTY,\n+                      i.span,\n+                      &format!(\"item `{}` has a public `len` method but {} `is_empty` method\",\n+                               ty,\n+                               is_empty));\n         }\n     }\n }"}, {"sha": "b640c6db3a3ceb4cdfece7f834d26308021b33fb", "filename": "tests/compile-fail/len_zero.rs", "status": "modified", "additions": 49, "deletions": 15, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/322c1a07ef992f6a28456038286205c9e583e1e3/tests%2Fcompile-fail%2Flen_zero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/322c1a07ef992f6a28456038286205c9e583e1e3/tests%2Fcompile-fail%2Flen_zero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Flen_zero.rs?ref=322c1a07ef992f6a28456038286205c9e583e1e3", "patch": "@@ -1,18 +1,45 @@\n #![feature(plugin)]\n #![plugin(clippy)]\n \n+#![deny(len_without_is_empty, len_zero)]\n+#![allow(dead_code, unused)]\n+\n+pub struct PubOne;\n+\n+impl PubOne {\n+    pub fn len(self: &Self) -> isize { //~ERROR item `PubOne` has a public `len` method but no corresponding `is_empty`\n+        1\n+    }\n+}\n+\n+struct NotPubOne;\n+\n+impl NotPubOne {\n+    pub fn len(self: &Self) -> isize { // no error, len is pub but `NotPubOne` is not exported anyway\n+        1\n+    }\n+}\n+\n struct One;\n \n-#[deny(len_without_is_empty)]\n impl One {\n-    fn len(self: &Self) -> isize { //~ERROR item `One` has a `.len(_: &Self)`\n+    fn len(self: &Self) -> isize { // no error, len is private, see #1085\n         1\n     }\n }\n \n-#[deny(len_without_is_empty)]\n+pub trait PubTraitsToo {\n+    fn len(self: &Self) -> isize; //~ERROR trait `PubTraitsToo` has a `len` method but no `is_empty`\n+}\n+\n+impl PubTraitsToo for One {\n+    fn len(self: &Self) -> isize {\n+        0\n+    }\n+}\n+\n trait TraitsToo {\n-    fn len(self: &Self) -> isize; //~ERROR trait `TraitsToo` has a `.len(_:\n+    fn len(self: &Self) -> isize; // no error, len is private, see #1085\n }\n \n impl TraitsToo for One {\n@@ -21,11 +48,22 @@ impl TraitsToo for One {\n     }\n }\n \n-struct HasIsEmpty;\n+struct HasPrivateIsEmpty;\n+\n+impl HasPrivateIsEmpty {\n+    pub fn len(self: &Self) -> isize {\n+        1\n+    }\n+\n+    fn is_empty(self: &Self) -> bool {\n+        false\n+    }\n+}\n+\n+pub struct HasIsEmpty;\n \n-#[deny(len_without_is_empty)]\n impl HasIsEmpty {\n-    fn len(self: &Self) -> isize {\n+    pub fn len(self: &Self) -> isize { //~ERROR item `HasIsEmpty` has a public `len` method but a private `is_empty`\n         1\n     }\n \n@@ -36,8 +74,7 @@ impl HasIsEmpty {\n \n struct Wither;\n \n-#[deny(len_without_is_empty)]\n-trait WithIsEmpty {\n+pub trait WithIsEmpty {\n     fn len(self: &Self) -> isize;\n     fn is_empty(self: &Self) -> bool;\n }\n@@ -52,21 +89,18 @@ impl WithIsEmpty for Wither {\n     }\n }\n \n-struct HasWrongIsEmpty;\n+pub struct HasWrongIsEmpty;\n \n-#[deny(len_without_is_empty)]\n impl HasWrongIsEmpty {\n-    fn len(self: &Self) -> isize { //~ERROR item `HasWrongIsEmpty` has a `.len(_: &Self)`\n+    pub fn len(self: &Self) -> isize { //~ERROR item `HasWrongIsEmpty` has a public `len` method but no corresponding `is_empty`\n         1\n     }\n \n-    #[allow(dead_code, unused)]\n-    fn is_empty(self: &Self, x : u32) -> bool {\n+    pub fn is_empty(self: &Self, x : u32) -> bool {\n         false\n     }\n }\n \n-#[deny(len_zero)]\n fn main() {\n     let x = [1, 2];\n     if x.len() == 0 {"}]}