{"sha": "564cb87e270f70310e25ae9f459c642e949e8213", "node_id": "C_kwDOAAsO6NoAKDU2NGNiODdlMjcwZjcwMzEwZTI1YWU5ZjQ1OWM2NDJlOTQ5ZTgyMTM", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-09-27T07:28:38Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2021-09-27T07:28:38Z"}, "message": "suggest path for tuple struct", "tree": {"sha": "2a6bc5fcbcd5b8294e07a2b3264d77bb8ff3f7f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2a6bc5fcbcd5b8294e07a2b3264d77bb8ff3f7f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/564cb87e270f70310e25ae9f459c642e949e8213", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/564cb87e270f70310e25ae9f459c642e949e8213", "html_url": "https://github.com/rust-lang/rust/commit/564cb87e270f70310e25ae9f459c642e949e8213", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/564cb87e270f70310e25ae9f459c642e949e8213/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2804655f553022f8b7f2e8fcf4c1343b6ecf255", "url": "https://api.github.com/repos/rust-lang/rust/commits/b2804655f553022f8b7f2e8fcf4c1343b6ecf255", "html_url": "https://github.com/rust-lang/rust/commit/b2804655f553022f8b7f2e8fcf4c1343b6ecf255"}], "stats": {"total": 53, "additions": 52, "deletions": 1}, "files": [{"sha": "84219873d55b4e9eb5b3f4139bb03aa17079e915", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/564cb87e270f70310e25ae9f459c642e949e8213/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/564cb87e270f70310e25ae9f459c642e949e8213/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=564cb87e270f70310e25ae9f459c642e949e8213", "patch": "@@ -1026,9 +1026,15 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n \n                 self.suggest_using_enum_variant(err, source, def_id, span);\n             }\n-            (Res::Def(DefKind::Struct, def_id), _) if ns == ValueNS => {\n+            (Res::Def(DefKind::Struct, def_id), source) if ns == ValueNS => {\n                 let (ctor_def, ctor_vis, fields) =\n                     if let Some(struct_ctor) = self.r.struct_constructors.get(&def_id).cloned() {\n+                        if let PathSource::Expr(Some(parent)) = source {\n+                            if let ExprKind::Field(..) | ExprKind::MethodCall(..) = parent.kind {\n+                                bad_struct_syntax_suggestion(def_id);\n+                                return true;\n+                            }\n+                        }\n                         struct_ctor\n                     } else {\n                         bad_struct_syntax_suggestion(def_id);"}, {"sha": "c8bc3e79fe2f0a69a199cc0417a227969ae9c8ba", "filename": "src/test/ui/resolve/suggest-path-for-tuple-struct.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/564cb87e270f70310e25ae9f459c642e949e8213/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/564cb87e270f70310e25ae9f459c642e949e8213/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.rs?ref=564cb87e270f70310e25ae9f459c642e949e8213", "patch": "@@ -0,0 +1,26 @@\n+mod module {\n+    pub struct SomeTupleStruct(u8);\n+    pub struct SomeRegularStruct {\n+        foo: u8\n+    }\n+\n+    impl SomeTupleStruct {\n+        pub fn new() -> Self {\n+            Self(0)\n+        }\n+    }\n+    impl SomeRegularStruct {\n+        pub fn new() -> Self {\n+            Self { foo: 0 }\n+        }\n+    }\n+}\n+\n+use module::{SomeTupleStruct, SomeRegularStruct};\n+\n+fn main() {\n+    let _ = SomeTupleStruct.new();\n+    //~^ ERROR expected value, found struct `SomeTupleStruct`\n+    let _ = SomeRegularStruct.new();\n+    //~^ ERROR expected value, found struct `SomeRegularStruct`\n+}"}, {"sha": "957045ca74bb21049501376fe784bcb04a2901ab", "filename": "src/test/ui/resolve/suggest-path-for-tuple-struct.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/564cb87e270f70310e25ae9f459c642e949e8213/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/564cb87e270f70310e25ae9f459c642e949e8213/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fsuggest-path-for-tuple-struct.stderr?ref=564cb87e270f70310e25ae9f459c642e949e8213", "patch": "@@ -0,0 +1,19 @@\n+error[E0423]: expected value, found struct `SomeTupleStruct`\n+  --> $DIR/suggest-path-for-tuple-struct.rs:22:13\n+   |\n+LL |     let _ = SomeTupleStruct.new();\n+   |             ^^^^^^^^^^^^^^^----\n+   |             |\n+   |             help: use the path separator to refer to an item: `SomeTupleStruct::new`\n+\n+error[E0423]: expected value, found struct `SomeRegularStruct`\n+  --> $DIR/suggest-path-for-tuple-struct.rs:24:13\n+   |\n+LL |     let _ = SomeRegularStruct.new();\n+   |             ^^^^^^^^^^^^^^^^^----\n+   |             |\n+   |             help: use the path separator to refer to an item: `SomeRegularStruct::new`\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0423`."}]}