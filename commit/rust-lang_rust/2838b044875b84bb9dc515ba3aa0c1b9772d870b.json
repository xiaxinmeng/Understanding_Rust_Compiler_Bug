{"sha": "2838b044875b84bb9dc515ba3aa0c1b9772d870b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4MzhiMDQ0ODc1Yjg0YmI5ZGM1MTViYTNhYTBjMWI5NzcyZDg3MGI=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-11-08T12:39:46Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-11-29T20:07:43Z"}, "message": "add internal-lints feature to enable clippys internal lints (off by default)", "tree": {"sha": "c7e5a7369e97b4231b738e2efb64832535cc107d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7e5a7369e97b4231b738e2efb64832535cc107d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2838b044875b84bb9dc515ba3aa0c1b9772d870b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2838b044875b84bb9dc515ba3aa0c1b9772d870b", "html_url": "https://github.com/rust-lang/rust/commit/2838b044875b84bb9dc515ba3aa0c1b9772d870b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2838b044875b84bb9dc515ba3aa0c1b9772d870b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68cf94f6a66e47234e3adefc6dfbe806cd6ad164", "url": "https://api.github.com/repos/rust-lang/rust/commits/68cf94f6a66e47234e3adefc6dfbe806cd6ad164", "html_url": "https://github.com/rust-lang/rust/commit/68cf94f6a66e47234e3adefc6dfbe806cd6ad164"}], "stats": {"total": 110, "additions": 84, "deletions": 26}, "files": [{"sha": "11c1eeac1cf99aaa19a6eb965e4973c56873f263", "filename": ".github/workflows/clippy_bors.yml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/.github%2Fworkflows%2Fclippy_bors.yml", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/.github%2Fworkflows%2Fclippy_bors.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fclippy_bors.yml?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -132,10 +132,10 @@ jobs:\n       run: cargo build --features deny-warnings\n \n     - name: Test\n-      run: cargo test --features deny-warnings\n+      run: cargo test --features deny-warnings  --features internal-lints\n \n     - name: Test clippy_lints\n-      run: cargo test --features deny-warnings\n+      run: cargo test --features deny-warnings --features internal-lints\n       working-directory: clippy_lints\n \n     - name: Test rustc_tools_util"}, {"sha": "a765390c6032d4c83694367683988b4b1c5e3bc0", "filename": "Cargo.toml", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -32,7 +32,7 @@ path = \"src/driver.rs\"\n clippy_lints = { version = \"0.0.212\", path = \"clippy_lints\" }\n # end automatic update\n semver = \"0.11\"\n-rustc_tools_util = { version = \"0.2.0\", path = \"rustc_tools_util\"}\n+rustc_tools_util = { version = \"0.2.0\", path = \"rustc_tools_util\" }\n tempfile = { version = \"3.1.0\", optional = true }\n \n [dev-dependencies]\n@@ -49,8 +49,9 @@ derive-new = \"0.5\"\n rustc-workspace-hack = \"1.0.0\"\n \n [build-dependencies]\n-rustc_tools_util = { version = \"0.2.0\", path = \"rustc_tools_util\"}\n+rustc_tools_util = { version = \"0.2.0\", path = \"rustc_tools_util\" }\n \n [features]\n deny-warnings = []\n integration = [\"tempfile\"]\n+internal-lints = [\"clippy_lints/internal-lints\"]"}, {"sha": "969249cc4467fd362f74b762c3545c291976fa89", "filename": "clippy_lints/Cargo.toml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2FCargo.toml?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -36,3 +36,5 @@ syn = { version = \"1\", features = [\"full\"] }\n \n [features]\n deny-warnings = []\n+# build clippy with internal lints enabled, off by default\n+internal-lints = []"}, {"sha": "a58f7eb3666a20a64d198b31e8a2e0631ed5359b", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 22, "deletions": 6, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -904,14 +904,23 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &unwrap_in_result::UNWRAP_IN_RESULT,\n         &use_self::USE_SELF,\n         &useless_conversion::USELESS_CONVERSION,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::CLIPPY_LINTS_INTERNAL,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::COLLAPSIBLE_SPAN_LINT_CALLS,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::COMPILER_LINT_FUNCTIONS,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::DEFAULT_LINT,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::INVALID_PATHS,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::LINT_WITHOUT_LINT_PASS,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::MATCH_TYPE_ON_DIAGNOSTIC_ITEM,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::OUTER_EXPN_EXPN_DATA,\n+        #[cfg(feature = \"internal-lints\")]\n         &utils::internal_lints::PRODUCE_ICE,\n         &vec::USELESS_VEC,\n         &vec_resize_to_zero::VEC_RESIZE_TO_ZERO,\n@@ -932,11 +941,14 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     // end register lints, do not remove this comment, it\u2019s used in `update_lints`\n     store.register_late_pass(|| box await_holding_invalid::AwaitHolding);\n     store.register_late_pass(|| box serde_api::SerdeAPI);\n-    store.register_late_pass(|| box utils::internal_lints::CompilerLintFunctions::new());\n-    store.register_late_pass(|| box utils::internal_lints::LintWithoutLintPass::default());\n-    store.register_late_pass(|| box utils::internal_lints::OuterExpnDataPass);\n-    store.register_late_pass(|| box utils::internal_lints::InvalidPaths);\n-    store.register_late_pass(|| box utils::inspector::DeepCodeInspector);\n+    #[cfg(feature = \"internal-lints\")]\n+    {\n+        store.register_late_pass(|| box utils::internal_lints::CompilerLintFunctions::new());\n+        store.register_late_pass(|| box utils::internal_lints::LintWithoutLintPass::default());\n+        store.register_late_pass(|| box utils::internal_lints::OuterExpnDataPass);\n+        store.register_late_pass(|| box utils::internal_lints::InvalidPaths);\n+        store.register_late_pass(|| box utils::inspector::DeepCodeInspector);\n+    }\n     store.register_late_pass(|| box utils::author::Author);\n     let vec_box_size_threshold = conf.vec_box_size_threshold;\n     store.register_late_pass(move || box types::Types::new(vec_box_size_threshold));\n@@ -1122,6 +1134,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_early_pass(|| box literal_representation::LiteralDigitGrouping);\n     let literal_representation_threshold = conf.literal_representation_threshold;\n     store.register_early_pass(move || box literal_representation::DecimalLiteralRepresentation::new(literal_representation_threshold));\n+    #[cfg(feature = \"internal-lints\")]\n     store.register_early_pass(|| box utils::internal_lints::ClippyLintsInternal);\n     let enum_variant_name_threshold = conf.enum_variant_name_threshold;\n     store.register_early_pass(move || box enum_variants::EnumVariantNames::new(enum_variant_name_threshold));\n@@ -1136,6 +1149,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(move || box large_const_arrays::LargeConstArrays::new(array_size_threshold));\n     store.register_late_pass(|| box floating_point_arithmetic::FloatingPointArithmetic);\n     store.register_early_pass(|| box as_conversions::AsConversions);\n+    #[cfg(feature = \"internal-lints\")]\n     store.register_early_pass(|| box utils::internal_lints::ProduceIce);\n     store.register_late_pass(|| box let_underscore::LetUnderscore);\n     store.register_late_pass(|| box atomic_ordering::AtomicOrdering);\n@@ -1152,6 +1166,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| box dereference::Dereferencing);\n     store.register_late_pass(|| box option_if_let_else::OptionIfLetElse);\n     store.register_late_pass(|| box future_not_send::FutureNotSend);\n+    #[cfg(feature = \"internal-lints\")]\n     store.register_late_pass(|| box utils::internal_lints::CollapsibleCalls);\n     store.register_late_pass(|| box if_let_mutex::IfLetMutex);\n     store.register_late_pass(|| box mut_mutex_lock::MutMutexLock);\n@@ -1177,6 +1192,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| box manual_ok_or::ManualOkOr);\n     store.register_late_pass(|| box float_equality_without_abs::FloatEqualityWithoutAbs);\n     store.register_late_pass(|| box async_yields_async::AsyncYieldsAsync);\n+    #[cfg(feature = \"internal-lints\")]\n     store.register_late_pass(|| box utils::internal_lints::MatchTypeOnDiagItem);\n     let disallowed_methods = conf.disallowed_methods.iter().cloned().collect::<FxHashSet<_>>();\n     store.register_late_pass(move || box disallowed_method::DisallowedMethod::new(&disallowed_methods));\n@@ -1317,7 +1333,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&wildcard_imports::ENUM_GLOB_USE),\n         LintId::of(&wildcard_imports::WILDCARD_IMPORTS),\n     ]);\n-\n+    #[cfg(feature = \"internal-lints\")]\n     store.register_group(true, \"clippy::internal\", Some(\"clippy_internal\"), vec![\n         LintId::of(&utils::internal_lints::CLIPPY_LINTS_INTERNAL),\n         LintId::of(&utils::internal_lints::COLLAPSIBLE_SPAN_LINT_CALLS),"}, {"sha": "a7a6b5855b754948957f7ce187261ac685303f37", "filename": "clippy_lints/src/utils/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fdiagnostics.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -186,7 +186,9 @@ pub fn span_lint_hir_and_then(\n ///     |\n ///     = note: `-D fold-any` implied by `-D warnings`\n /// ```\n-#[allow(clippy::collapsible_span_lint_calls)]\n+\n+#[allow(clippy::unknown_clippy_lints)]\n+#[cfg_attr(feature = \"internal-lints\", allow(clippy::collapsible_span_lint_calls))]\n pub fn span_lint_and_sugg<'a, T: LintContext>(\n     cx: &'a T,\n     lint: &'static Lint,"}, {"sha": "63f14c592bdc71ac2359f7ed4644b8c2af547067", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -14,6 +14,7 @@ pub mod eager_or_lazy;\n pub mod higher;\n mod hir_utils;\n pub mod inspector;\n+#[cfg(feature = \"internal-lints\")]\n pub mod internal_lints;\n pub mod numeric_literal;\n pub mod paths;"}, {"sha": "16e6a016c9ed80debd34e8bcc4de427899a79e45", "filename": "clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/clippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -31,6 +31,7 @@ pub const DISPLAY_TRAIT: [&str; 3] = [\"core\", \"fmt\", \"Display\"];\n pub const DOUBLE_ENDED_ITERATOR: [&str; 4] = [\"core\", \"iter\", \"traits\", \"DoubleEndedIterator\"];\n pub const DROP: [&str; 3] = [\"core\", \"mem\", \"drop\"];\n pub const DURATION: [&str; 3] = [\"core\", \"time\", \"Duration\"];\n+#[cfg(feature = \"internal-lints\")]\n pub const EARLY_CONTEXT: [&str; 2] = [\"rustc_lint\", \"EarlyContext\"];\n pub const EXIT: [&str; 3] = [\"std\", \"process\", \"exit\"];\n pub const F32_EPSILON: [&str; 4] = [\"core\", \"f32\", \"<impl f32>\", \"EPSILON\"];\n@@ -61,8 +62,10 @@ pub const IO_WRITE: [&str; 3] = [\"std\", \"io\", \"Write\"];\n pub const IPADDR_V4: [&str; 4] = [\"std\", \"net\", \"IpAddr\", \"V4\"];\n pub const IPADDR_V6: [&str; 4] = [\"std\", \"net\", \"IpAddr\", \"V6\"];\n pub const ITERATOR: [&str; 5] = [\"core\", \"iter\", \"traits\", \"iterator\", \"Iterator\"];\n+#[cfg(feature = \"internal-lints\")]\n pub const LATE_CONTEXT: [&str; 2] = [\"rustc_lint\", \"LateContext\"];\n pub const LINKED_LIST: [&str; 4] = [\"alloc\", \"collections\", \"linked_list\", \"LinkedList\"];\n+#[cfg(feature = \"internal-lints\")]\n pub const LINT: [&str; 2] = [\"rustc_lint_defs\", \"Lint\"];\n pub const MEM_DISCRIMINANT: [&str; 3] = [\"core\", \"mem\", \"discriminant\"];\n pub const MEM_FORGET: [&str; 3] = [\"core\", \"mem\", \"forget\"];\n@@ -133,6 +136,7 @@ pub const STR_ENDS_WITH: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"ends_with\"];\n pub const STR_FROM_UTF8: [&str; 4] = [\"core\", \"str\", \"converts\", \"from_utf8\"];\n pub const STR_LEN: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"len\"];\n pub const STR_STARTS_WITH: [&str; 4] = [\"core\", \"str\", \"<impl str>\", \"starts_with\"];\n+#[cfg(feature = \"internal-lints\")]\n pub const SYNTAX_CONTEXT: [&str; 3] = [\"rustc_span\", \"hygiene\", \"SyntaxContext\"];\n pub const TO_OWNED: [&str; 3] = [\"alloc\", \"borrow\", \"ToOwned\"];\n pub const TO_OWNED_METHOD: [&str; 4] = [\"alloc\", \"borrow\", \"ToOwned\", \"to_owned\"];"}, {"sha": "ec3af94b9ca910dd293b807638ddd015f49dd336", "filename": "tests/compile-test.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -12,6 +12,9 @@ use std::path::{Path, PathBuf};\n \n mod cargo;\n \n+// whether to run internal tests or not\n+const RUN_INTERNAL_TESTS: bool = cfg!(feature = \"internal-lints\");\n+\n fn host_lib() -> PathBuf {\n     option_env!(\"HOST_LIBS\").map_or(cargo::CARGO_TARGET_DIR.join(env!(\"PROFILE\")), PathBuf::from)\n }\n@@ -96,6 +99,16 @@ fn run_mode(cfg: &mut compiletest::Config) {\n     compiletest::run_tests(&cfg);\n }\n \n+fn run_internal_tests(cfg: &mut compiletest::Config) {\n+    // only run internal tests with the internal-tests feature\n+    if !RUN_INTERNAL_TESTS {\n+        return;\n+    }\n+    cfg.mode = TestMode::Ui;\n+    cfg.src_base = Path::new(\"tests\").join(\"ui-internal\");\n+    compiletest::run_tests(&cfg);\n+}\n+\n fn run_ui_toml(config: &mut compiletest::Config) {\n     fn run_tests(config: &compiletest::Config, mut tests: Vec<tester::TestDescAndFn>) -> Result<bool, io::Error> {\n         let mut result = true;\n@@ -199,7 +212,6 @@ fn run_ui_cargo(config: &mut compiletest::Config) {\n                         Some(\"main.rs\") => {},\n                         _ => continue,\n                     }\n-\n                     let paths = compiletest::common::TestPaths {\n                         file: file_path,\n                         base: config.src_base.clone(),\n@@ -253,4 +265,5 @@ fn compile_test() {\n     run_mode(&mut config);\n     run_ui_toml(&mut config);\n     run_ui_cargo(&mut config);\n+    run_internal_tests(&mut config);\n }"}, {"sha": "eae25adf839f59b434b847b059e498b83681f5db", "filename": "tests/dogfood.rs", "status": "modified", "additions": 33, "deletions": 14, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "patch": "@@ -18,20 +18,39 @@ fn dogfood_clippy() {\n     }\n     let root_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n \n-    let output = Command::new(&*CLIPPY_PATH)\n-        .current_dir(root_dir)\n-        .env(\"CLIPPY_DOGFOOD\", \"1\")\n-        .env(\"CARGO_INCREMENTAL\", \"0\")\n-        .arg(\"clippy-preview\")\n-        .arg(\"--all-targets\")\n-        .arg(\"--all-features\")\n-        .arg(\"--\")\n-        .args(&[\"-D\", \"clippy::all\"])\n-        .args(&[\"-D\", \"clippy::internal\"])\n-        .args(&[\"-D\", \"clippy::pedantic\"])\n-        .arg(\"-Cdebuginfo=0\") // disable debuginfo to generate less data in the target dir\n-        .output()\n-        .unwrap();\n+    let output = if cfg!(feature = \"internal-lints\") {\n+        // with internal lints and internal warnings\n+        Command::new(&*CLIPPY_PATH)\n+            .current_dir(root_dir)\n+            .env(\"CLIPPY_DOGFOOD\", \"1\")\n+            .env(\"CARGO_INCREMENTAL\", \"0\")\n+            .arg(\"clippy-preview\")\n+            .arg(\"--all-targets\")\n+            .arg(\"--all-features\")\n+            .args(&[\"--features\", \"internal-lints\"])\n+            .arg(\"--\")\n+            .args(&[\"-D\", \"clippy::all\"])\n+            .args(&[\"-D\", \"clippy::pedantic\"])\n+            .args(&[\"-D\", \"clippy::internal\"])\n+            .arg(\"-Cdebuginfo=0\") // disable debuginfo to generate less data in the target dir\n+            .output()\n+            .unwrap()\n+    } else {\n+        // without internal lints or warnings\n+        Command::new(&*CLIPPY_PATH)\n+            .current_dir(root_dir)\n+            .env(\"CLIPPY_DOGFOOD\", \"1\")\n+            .env(\"CARGO_INCREMENTAL\", \"0\")\n+            .arg(\"clippy-preview\")\n+            .arg(\"--all-targets\")\n+            .arg(\"--all-features\")\n+            .arg(\"--\")\n+            .args(&[\"-D\", \"clippy::all\"])\n+            .args(&[\"-D\", \"clippy::pedantic\"])\n+            .arg(\"-Cdebuginfo=0\") // disable debuginfo to generate less data in the target dir\n+            .output()\n+            .unwrap()\n+    };\n     println!(\"status: {}\", output.status);\n     println!(\"stdout: {}\", String::from_utf8_lossy(&output.stdout));\n     println!(\"stderr: {}\", String::from_utf8_lossy(&output.stderr));"}, {"sha": "e588c23345e2fdd8ad010e05a0db259589f7bade", "filename": "tests/ui-internal/collapsible_span_lint_calls.fixed", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcollapsible_span_lint_calls.fixed?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/collapsible_span_lint_calls.fixed"}, {"sha": "d5dd3bb562b429d9265f3ba1d5c80a4c977a4dc2", "filename": "tests/ui-internal/collapsible_span_lint_calls.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcollapsible_span_lint_calls.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/collapsible_span_lint_calls.rs"}, {"sha": "874d4a9f255c27dcaa542325be407d65d25cfabd", "filename": "tests/ui-internal/collapsible_span_lint_calls.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcollapsible_span_lint_calls.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcollapsible_span_lint_calls.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/collapsible_span_lint_calls.stderr"}, {"sha": "5b30c9d5721ca5a0dcf8c7fe0ef200c2339d50f2", "filename": "tests/ui-internal/custom_ice_message.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcustom_ice_message.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcustom_ice_message.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcustom_ice_message.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/custom_ice_message.rs"}, {"sha": "a1b8e2ee162cf67eb3722946e1884415b768149c", "filename": "tests/ui-internal/custom_ice_message.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcustom_ice_message.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fcustom_ice_message.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fcustom_ice_message.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/custom_ice_message.stderr"}, {"sha": "053faae02ce3e0d3aa457083224bb9d32b20ba30", "filename": "tests/ui-internal/default_lint.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fdefault_lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fdefault_lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fdefault_lint.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/default_lint.rs"}, {"sha": "5c5836a7d297e82a0ae0c18b819d73ef39b3caf9", "filename": "tests/ui-internal/default_lint.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fdefault_lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fdefault_lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fdefault_lint.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/default_lint.stderr"}, {"sha": "01e28ae5e9d3581c0995e1b88abb0fd738494052", "filename": "tests/ui-internal/invalid_paths.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Finvalid_paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Finvalid_paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Finvalid_paths.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/invalid_paths.rs"}, {"sha": "bd69d661b714fe8bd29e553588d2736e3eb22fc3", "filename": "tests/ui-internal/invalid_paths.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Finvalid_paths.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Finvalid_paths.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Finvalid_paths.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/invalid_paths.stderr"}, {"sha": "beaef79a340afad2c371352f2dda86f385c95d8c", "filename": "tests/ui-internal/lint_without_lint_pass.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Flint_without_lint_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Flint_without_lint_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Flint_without_lint_pass.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/lint_without_lint_pass.rs"}, {"sha": "1257dae96d71cc17c0261ff5f66efcea3575c165", "filename": "tests/ui-internal/lint_without_lint_pass.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Flint_without_lint_pass.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Flint_without_lint_pass.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Flint_without_lint_pass.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/lint_without_lint_pass.stderr"}, {"sha": "fe950b0aa7c7004c729c33cc7b6dab3392d1260a", "filename": "tests/ui-internal/match_type_on_diag_item.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fmatch_type_on_diag_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fmatch_type_on_diag_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fmatch_type_on_diag_item.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/match_type_on_diag_item.rs"}, {"sha": "82465dbaf6ecc9d9e61b5f99e25f62948da7ebc7", "filename": "tests/ui-internal/match_type_on_diag_item.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fmatch_type_on_diag_item.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fmatch_type_on_diag_item.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fmatch_type_on_diag_item.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/match_type_on_diag_item.stderr"}, {"sha": "b0b3498f057f7f7d05eb87124c4acb68a45aa7e6", "filename": "tests/ui-internal/outer_expn_data.fixed", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fouter_expn_data.fixed?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/outer_expn_data.fixed"}, {"sha": "55a3fed00d075dfa5a4d7360fa9b9f0a85ece34f", "filename": "tests/ui-internal/outer_expn_data.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fouter_expn_data.rs?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/outer_expn_data.rs"}, {"sha": "56b6ce1f78ea4de38c7f1b1d0ffb666565c1f05a", "filename": "tests/ui-internal/outer_expn_data.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2838b044875b84bb9dc515ba3aa0c1b9772d870b/tests%2Fui-internal%2Fouter_expn_data.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-internal%2Fouter_expn_data.stderr?ref=2838b044875b84bb9dc515ba3aa0c1b9772d870b", "previous_filename": "tests/ui/outer_expn_data.stderr"}]}