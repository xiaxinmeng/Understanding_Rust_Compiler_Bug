{"sha": "25096a212a9ccaa0d181630af5971532c3472182", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MDk2YTIxMmE5Y2NhYTBkMTgxNjMwYWY1OTcxNTMyYzM0NzIxODI=", "commit": {"author": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2012-10-10T20:40:17Z"}, "committer": {"name": "Philipp Br\u00fcschweiler", "email": "blei42@gmail.com", "date": "2012-10-10T20:40:58Z"}, "message": "rustc: fix size computation of structs for the FFI\n\nIt didn't take alignment into account.\n\nFixes #3656.", "tree": {"sha": "47caa13fbea6d044482194ebc05b7d0159f13ec2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47caa13fbea6d044482194ebc05b7d0159f13ec2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25096a212a9ccaa0d181630af5971532c3472182", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25096a212a9ccaa0d181630af5971532c3472182", "html_url": "https://github.com/rust-lang/rust/commit/25096a212a9ccaa0d181630af5971532c3472182", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25096a212a9ccaa0d181630af5971532c3472182/comments", "author": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Blei", "id": 52674, "node_id": "MDQ6VXNlcjUyNjc0", "avatar_url": "https://avatars.githubusercontent.com/u/52674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Blei", "html_url": "https://github.com/Blei", "followers_url": "https://api.github.com/users/Blei/followers", "following_url": "https://api.github.com/users/Blei/following{/other_user}", "gists_url": "https://api.github.com/users/Blei/gists{/gist_id}", "starred_url": "https://api.github.com/users/Blei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Blei/subscriptions", "organizations_url": "https://api.github.com/users/Blei/orgs", "repos_url": "https://api.github.com/users/Blei/repos", "events_url": "https://api.github.com/users/Blei/events{/privacy}", "received_events_url": "https://api.github.com/users/Blei/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d8f447d560d378adebfbad948427adfc2f5ae22", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d8f447d560d378adebfbad948427adfc2f5ae22", "html_url": "https://github.com/rust-lang/rust/commit/0d8f447d560d378adebfbad948427adfc2f5ae22"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "4a87eb57cbe24d6e46c22f799faa5f82e3a4ae75", "filename": "src/rustc/middle/trans/foreign.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/25096a212a9ccaa0d181630af5971532c3472182/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25096a212a9ccaa0d181630af5971532c3472182/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=25096a212a9ccaa0d181630af5971532c3472182", "patch": "@@ -112,9 +112,10 @@ fn classify_ty(ty: TypeRef) -> ~[x86_64_reg_class] {\n             Float => 4,\n             Double => 8,\n             Struct => {\n-              do vec::foldl(0, struct_tys(ty)) |s, t| {\n-                    s + ty_size(*t)\n-                }\n+              let size = do vec::foldl(0, struct_tys(ty)) |s, t| {\n+                  align(s, *t) + ty_size(*t)\n+              };\n+              align(size, ty)\n             }\n             Array => {\n               let len = llvm::LLVMGetArrayLength(ty) as uint;"}, {"sha": "feb7ad1db7a8ee324d711f3d4393b8d278856723", "filename": "src/test/run-pass/issue-3656.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/25096a212a9ccaa0d181630af5971532c3472182/src%2Ftest%2Frun-pass%2Fissue-3656.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25096a212a9ccaa0d181630af5971532c3472182/src%2Ftest%2Frun-pass%2Fissue-3656.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-3656.rs?ref=25096a212a9ccaa0d181630af5971532c3472182", "patch": "@@ -0,0 +1,20 @@\n+// Issue #3656\n+// Incorrect struct size computation in the FFI, because of not taking\n+// the alignment of elements into account.\n+\n+use libc::*;\n+\n+struct KEYGEN {\n+    hash_algorithm: [c_uint]/2,\n+    count: uint32_t,\n+    salt: *c_void,\n+    salt_size: uint32_t,\n+}\n+\n+extern {\n+    // Bogus signature, just need to test if it compiles.\n+    pub fn malloc(++data: KEYGEN);\n+}\n+\n+fn main() {\n+}"}]}