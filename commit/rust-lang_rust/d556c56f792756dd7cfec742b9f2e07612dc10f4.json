{"sha": "d556c56f792756dd7cfec742b9f2e07612dc10f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ1NTZjNTZmNzkyNzU2ZGQ3Y2ZlYzc0MmI5ZjJlMDc2MTJkYzEwZjQ=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-31T17:31:33Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-01-31T17:31:33Z"}, "message": "Add option to build using the sysroot of rustc", "tree": {"sha": "cad2e5a8fe6635c92a496921493d5bdc3e28c19f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cad2e5a8fe6635c92a496921493d5bdc3e28c19f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d556c56f792756dd7cfec742b9f2e07612dc10f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d556c56f792756dd7cfec742b9f2e07612dc10f4", "html_url": "https://github.com/rust-lang/rust/commit/d556c56f792756dd7cfec742b9f2e07612dc10f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d556c56f792756dd7cfec742b9f2e07612dc10f4/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17cffc1757dc6d8a89e2537e90c6cc5b336a66bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/17cffc1757dc6d8a89e2537e90c6cc5b336a66bf", "html_url": "https://github.com/rust-lang/rust/commit/17cffc1757dc6d8a89e2537e90c6cc5b336a66bf"}], "stats": {"total": 39, "additions": 27, "deletions": 12}, "files": [{"sha": "598ce35eceaac6dbe21bba8c9a87b9a1bce913f5", "filename": "build.sh", "status": "modified", "additions": 26, "deletions": 11, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/d556c56f792756dd7cfec742b9f2e07612dc10f4/build.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d556c56f792756dd7cfec742b9f2e07612dc10f4/build.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.sh?ref=d556c56f792756dd7cfec742b9f2e07612dc10f4", "patch": "@@ -3,16 +3,17 @@ set -e\n \n # Settings\n export CHANNEL=\"release\"\n-build_sysroot=1\n+build_sysroot=\"clif\"\n target_dir='build'\n oldbe=''\n while [[ $# != 0 ]]; do\n     case $1 in\n         \"--debug\")\n             export CHANNEL=\"debug\"\n             ;;\n-        \"--without-sysroot\")\n-            build_sysroot=0\n+        \"--sysroot\")\n+            build_sysroot=$2\n+            shift\n             ;;\n         \"--target-dir\")\n             target_dir=$2\n@@ -23,7 +24,7 @@ while [[ $# != 0 ]]; do\n             ;;\n         *)\n             echo \"Unknown flag '$1'\"\n-            echo \"Usage: ./build.sh [--debug] [--without-sysroot] [--target-dir DIR] [--oldbe]\"\n+            echo \"Usage: ./build.sh [--debug] [--sysroot none|clif|llvm] [--target-dir DIR] [--oldbe]\"\n             exit 1\n             ;;\n     esac\n@@ -62,10 +63,24 @@ if [[ \"$TARGET_TRIPLE\" == \"x86_64-pc-windows-gnu\" ]]; then\n     cp $(rustc --print sysroot)/lib/rustlib/$TARGET_TRIPLE/lib/*.o \"$target_dir/lib/rustlib/$TARGET_TRIPLE/lib/\"\n fi\n \n-if [[ \"$build_sysroot\" == \"1\" ]]; then\n-    echo \"[BUILD] sysroot\"\n-    dir=$(pwd)\n-    cd \"$target_dir\"\n-    time \"$dir/build_sysroot/build_sysroot.sh\"\n-    cp lib/rustlib/*/lib/libstd-* lib/\n-fi\n+case \"$build_sysroot\" in\n+    \"none\")\n+        ;;\n+    \"llvm\")\n+        cp -r $(rustc --print sysroot)/lib/rustlib/$TARGET_TRIPLE/lib \"$target_dir/lib/rustlib/$TARGET_TRIPLE/\"\n+        ;;\n+    \"clif\")\n+        echo \"[BUILD] sysroot\"\n+        dir=$(pwd)\n+        cd \"$target_dir\"\n+        time \"$dir/build_sysroot/build_sysroot.sh\"\n+        cp lib/rustlib/*/lib/libstd-* lib/\n+        ;;\n+    *)\n+        echo \"Unknown sysroot kind \\`$build_sysroot\\`.\"\n+        echo \"The allowed values are:\"\n+        echo \"    none A sysroot that doesn't contain the standard library\"\n+        echo \"    llvm Copy the sysroot from rustc compiled by cg_llvm\"\n+        echo \"    clif Build a new sysroot using cg_clif\"\n+        exit 1\n+esac"}, {"sha": "5ab10e0e905c7b9ce3fb60fbe37bd7f443642706", "filename": "test.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d556c56f792756dd7cfec742b9f2e07612dc10f4/test.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d556c56f792756dd7cfec742b9f2e07612dc10f4/test.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test.sh?ref=d556c56f792756dd7cfec742b9f2e07612dc10f4", "patch": "@@ -1,7 +1,7 @@\n #!/bin/bash\n set -e\n \n-./build.sh --without-sysroot \"$@\"\n+./build.sh --sysroot none \"$@\"\n \n rm -r target/out || true\n "}]}