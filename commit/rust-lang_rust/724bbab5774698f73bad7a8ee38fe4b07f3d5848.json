{"sha": "724bbab5774698f73bad7a8ee38fe4b07f3d5848", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyNGJiYWI1Nzc0Njk4ZjczYmFkN2E4ZWUzOGZlNGIwN2YzZDU4NDg=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-10-13T22:10:25Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-10-13T22:10:25Z"}, "message": "rollup merge of #18012 : pnkfelix/gate-bors-on-building-compiletest", "tree": {"sha": "a5ba10dc90808a78eb095888c1467bc6e6a7c4ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a5ba10dc90808a78eb095888c1467bc6e6a7c4ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/724bbab5774698f73bad7a8ee38fe4b07f3d5848", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/724bbab5774698f73bad7a8ee38fe4b07f3d5848", "html_url": "https://github.com/rust-lang/rust/commit/724bbab5774698f73bad7a8ee38fe4b07f3d5848", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/724bbab5774698f73bad7a8ee38fe4b07f3d5848/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b1929656791389dcd0fabd7226ca8b2b2a5e8f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b1929656791389dcd0fabd7226ca8b2b2a5e8f2", "html_url": "https://github.com/rust-lang/rust/commit/1b1929656791389dcd0fabd7226ca8b2b2a5e8f2"}, {"sha": "b26972e28bfc1b797e2dfa14435b551685cb180b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b26972e28bfc1b797e2dfa14435b551685cb180b", "html_url": "https://github.com/rust-lang/rust/commit/b26972e28bfc1b797e2dfa14435b551685cb180b"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "6c586957862b48bce0bda73fe34d46f844d3ad39", "filename": "mk/tests.mk", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/724bbab5774698f73bad7a8ee38fe4b07f3d5848/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/724bbab5774698f73bad7a8ee38fe4b07f3d5848/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=724bbab5774698f73bad7a8ee38fe4b07f3d5848", "patch": "@@ -199,14 +199,29 @@ check-docs: cleantestlibs cleantmptestlogs check-stage2-docs\n \n # Some less critical tests that are not prone to breakage.\n # Not run as part of the normal test suite, but tested by bors on checkin.\n-check-secondary: check-lexer check-pretty\n+check-secondary: check-build-compiletest check-lexer check-pretty\n \n # check + check-secondary.\n-check-all: check check-secondary\n+#\n+# Issue #17883: build check-secondary first so hidden dependencies in\n+# e.g. building compiletest are exercised (resolve those by adding\n+# deps to rules that need them; not by putting `check` first here).\n+check-all: check-secondary check\n \n # Pretty-printing tests.\n check-pretty: check-stage2-T-$(CFG_BUILD)-H-$(CFG_BUILD)-pretty-exec\n \n+define DEF_CHECK_BUILD_COMPILETEST_FOR_STAGE\n+check-stage$(1)-build-compiletest: \t$$(HBIN$(1)_H_$(CFG_BUILD))/compiletest$$(X_$(CFG_BUILD))\n+endef\n+\n+$(foreach stage,$(STAGES), \\\n+ $(eval $(call DEF_CHECK_BUILD_COMPILETEST_FOR_STAGE,$(stage))))\n+\n+check-build-compiletest: \\\n+\tcheck-stage1-build-compiletest \\\n+\tcheck-stage2-build-compiletest\n+\n .PHONY: cleantmptestlogs cleantestlibs\n \n cleantmptestlogs:\n@@ -720,6 +735,13 @@ PRETTY_DEPS_pretty-rpass-full = $(RPASS_FULL_TESTS)\n PRETTY_DEPS_pretty-rfail = $(RFAIL_TESTS)\n PRETTY_DEPS_pretty-bench = $(BENCH_TESTS)\n PRETTY_DEPS_pretty-pretty = $(PRETTY_TESTS)\n+# The stage- and host-specific dependencies are for e.g. macro_crate_test which pulls in\n+# external crates.\n+PRETTY_DEPS$(1)_H_$(3)_pretty-rpass =\n+PRETTY_DEPS$(1)_H_$(3)_pretty-rpass-full = $$(HLIB$(1)_H_$(3))/stamp.syntax $$(HLIB$(1)_H_$(3))/stamp.rustc\n+PRETTY_DEPS$(1)_H_$(3)_pretty-rfail =\n+PRETTY_DEPS$(1)_H_$(3)_pretty-bench =\n+PRETTY_DEPS$(1)_H_$(3)_pretty-pretty =\n PRETTY_DIRNAME_pretty-rpass = run-pass\n PRETTY_DIRNAME_pretty-rpass-full = run-pass-fulldeps\n PRETTY_DIRNAME_pretty-rfail = run-fail\n@@ -738,7 +760,8 @@ check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4\n \n $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t        $$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n-\t        $$(PRETTY_DEPS_$(4))\n+\t        $$(PRETTY_DEPS_$(4)) \\\n+\t        $$(PRETTY_DEPS$(1)_H_$(3)_$(4))\n \t@$$(call E, run pretty-rpass [$(2)]: $$<)\n \t$$(Q)$$(call CFG_RUN_CTEST_$(2),$(1),$$<,$(3)) \\\n \t\t$$(PRETTY_ARGS$(1)-T-$(2)-H-$(3)-$(4)) \\"}]}