{"sha": "d9bf9f01fe796698d412b69a279c104fbc8852d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5YmY5ZjAxZmU3OTY2OThkNDEyYjY5YTI3OWMxMDRmYmM4ODUyZDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-16T19:13:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-16T19:13:17Z"}, "message": "Auto merge of #5806 - flip1995:deploy_beta_fix, r=phansch\n\nFix deploy script for beta deployment\n\nSince the `beta/` directory already exists, we can't copy the complete `master` dir\n\nchangelog: none", "tree": {"sha": "151486df63db9b2768a5dee768f0ba6b261f3698", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/151486df63db9b2768a5dee768f0ba6b261f3698"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d9bf9f01fe796698d412b69a279c104fbc8852d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d9bf9f01fe796698d412b69a279c104fbc8852d7", "html_url": "https://github.com/rust-lang/rust/commit/d9bf9f01fe796698d412b69a279c104fbc8852d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d9bf9f01fe796698d412b69a279c104fbc8852d7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb67423577de689256483881ee9a8a0df34f7cd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb67423577de689256483881ee9a8a0df34f7cd7", "html_url": "https://github.com/rust-lang/rust/commit/bb67423577de689256483881ee9a8a0df34f7cd7"}, {"sha": "c65eb4d66314d22d85cf2e58ff20ec1ca7404751", "url": "https://api.github.com/repos/rust-lang/rust/commits/c65eb4d66314d22d85cf2e58ff20ec1ca7404751", "html_url": "https://github.com/rust-lang/rust/commit/c65eb4d66314d22d85cf2e58ff20ec1ca7404751"}], "stats": {"total": 21, "additions": 15, "deletions": 6}, "files": [{"sha": "e85e8874ba60039e3ba12819d198603bb95211b4", "filename": ".github/deploy.sh", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d9bf9f01fe796698d412b69a279c104fbc8852d7/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d9bf9f01fe796698d412b69a279c104fbc8852d7/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=d9bf9f01fe796698d412b69a279c104fbc8852d7", "patch": "@@ -19,7 +19,7 @@ fi\n \n if [[ $BETA = \"true\" ]]; then\n   echo \"Update documentation for the beta release\"\n-  cp -r out/master out/beta\n+  cp -r out/master/* out/beta\n fi\n \n # Generate version index that is shown as root index page\n@@ -33,12 +33,13 @@ cd out\n git config user.name \"GHA CI\"\n git config user.email \"gha@ci.invalid\"\n \n-if git diff --exit-code --quiet; then\n-  echo \"No changes to the output on this push; exiting.\"\n-  exit 0\n-fi\n-\n if [[ -n $TAG_NAME ]]; then\n+  # track files, so that the following check works\n+  git add --intent-to-add \"$TAG_NAME\"\n+  if git diff --exit-code --quiet -- $TAG_NAME/; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   # Add the new dir\n   git add \"$TAG_NAME\"\n   # Update the symlink\n@@ -47,9 +48,17 @@ if [[ -n $TAG_NAME ]]; then\n   git add versions.json\n   git commit -m \"Add documentation for ${TAG_NAME} release: ${SHA}\"\n elif [[ $BETA = \"true\" ]]; then\n+  if git diff --exit-code --quiet -- beta/; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   git add beta\n   git commit -m \"Automatic deploy to GitHub Pages (beta): ${SHA}\"\n else\n+  if git diff --exit-code --quiet; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+  fi\n   git add .\n   git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n fi"}]}