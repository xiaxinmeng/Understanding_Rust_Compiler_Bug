{"sha": "471795b019d800dca65e2a400fbdb166e6f821cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3MTc5NWIwMTlkODAwZGNhNjVlMmE0MDBmYmRiMTY2ZTZmODIxY2Q=", "commit": {"author": {"name": "Yaroslav Bolyukin", "email": "iam@lach.pw", "date": "2021-02-13T20:11:00Z"}, "committer": {"name": "Yaroslav Bolyukin", "email": "iam@lach.pw", "date": "2021-02-13T20:11:00Z"}, "message": "fix: tolerate spaces in nix binary patching\n\nIf path to original file contains space (I.e on code insiders, where\ndefault data directory is ~/Code - Insiders/), then there is syntax\nerror evaluating src arg.\n\nInstead pass path as str, and coerce to path back in nix expression\n\nSigned-off-by: Yaroslav Bolyukin <iam@lach.pw>", "tree": {"sha": "00f69ad87dfeb290613f138c954fbcae018b121b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00f69ad87dfeb290613f138c954fbcae018b121b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/471795b019d800dca65e2a400fbdb166e6f821cd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEMjyVtdv3LXSFcMC3QLXWlIFDF18FAmAoMlQACgkQQLXWlIFD\nF1+vTQv+Os2p0T6WxxT5kNTOEa4vKVcXw1/uXbqL8Ecc1oNIVMBW1LFY5KyHbtqz\njSDmqFBzNrz8LKmtOzjnQXXOLKUNTxqiXhq4BVHFDED8aNc8FgMJigzj1/F/oCrC\n28pX0WH+EehQ0uUgYik3PtyZYB+UlRhGaYd59y7NP/y+1cLAcsAYm3xQQvZF7p5+\nX4N5hMAYyWOiAcUREHW4i4Xucpnji1MWnl46vAmzoH1l/D9YlY3NZ3IwXUHrZMp4\nMSpqSEUVm6pdXgWcWaB/VrJXGyGU5CsQm1GKVbXxwyoKGDEQuitwopYMEf92yQkf\nD48J6w3wCUJwgR+XdsJWjOew8ZSHdof5WGpcDwhmP47SaIPk85Fz8jxcOMAIS4EE\nMvjaJC1Hpj2E+Ohgkde5QGF1uidg7GeORLWgUCNgCm51HNYCsdsH3lpJoSvk3UPO\nw1cvhGLvtSVGH8P0K4Y0ieGh+qaTsenFGUmuNoEjST3P0rDVm9rs+2E0guFvgRkv\nQhjwptNB\n=cbps\n-----END PGP SIGNATURE-----", "payload": "tree 00f69ad87dfeb290613f138c954fbcae018b121b\nparent 3fdc556632e39145678219ace8476e12d7d70d41\nauthor Yaroslav Bolyukin <iam@lach.pw> 1613247060 +0300\ncommitter Yaroslav Bolyukin <iam@lach.pw> 1613247060 +0300\n\nfix: tolerate spaces in nix binary patching\n\nIf path to original file contains space (I.e on code insiders, where\ndefault data directory is ~/Code - Insiders/), then there is syntax\nerror evaluating src arg.\n\nInstead pass path as str, and coerce to path back in nix expression\n\nSigned-off-by: Yaroslav Bolyukin <iam@lach.pw>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/471795b019d800dca65e2a400fbdb166e6f821cd", "html_url": "https://github.com/rust-lang/rust/commit/471795b019d800dca65e2a400fbdb166e6f821cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/471795b019d800dca65e2a400fbdb166e6f821cd/comments", "author": {"login": "CertainLach", "id": 6235312, "node_id": "MDQ6VXNlcjYyMzUzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/6235312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CertainLach", "html_url": "https://github.com/CertainLach", "followers_url": "https://api.github.com/users/CertainLach/followers", "following_url": "https://api.github.com/users/CertainLach/following{/other_user}", "gists_url": "https://api.github.com/users/CertainLach/gists{/gist_id}", "starred_url": "https://api.github.com/users/CertainLach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CertainLach/subscriptions", "organizations_url": "https://api.github.com/users/CertainLach/orgs", "repos_url": "https://api.github.com/users/CertainLach/repos", "events_url": "https://api.github.com/users/CertainLach/events{/privacy}", "received_events_url": "https://api.github.com/users/CertainLach/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CertainLach", "id": 6235312, "node_id": "MDQ6VXNlcjYyMzUzMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/6235312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CertainLach", "html_url": "https://github.com/CertainLach", "followers_url": "https://api.github.com/users/CertainLach/followers", "following_url": "https://api.github.com/users/CertainLach/following{/other_user}", "gists_url": "https://api.github.com/users/CertainLach/gists{/gist_id}", "starred_url": "https://api.github.com/users/CertainLach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CertainLach/subscriptions", "organizations_url": "https://api.github.com/users/CertainLach/orgs", "repos_url": "https://api.github.com/users/CertainLach/repos", "events_url": "https://api.github.com/users/CertainLach/events{/privacy}", "received_events_url": "https://api.github.com/users/CertainLach/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3fdc556632e39145678219ace8476e12d7d70d41", "url": "https://api.github.com/repos/rust-lang/rust/commits/3fdc556632e39145678219ace8476e12d7d70d41", "html_url": "https://github.com/rust-lang/rust/commit/3fdc556632e39145678219ace8476e12d7d70d41"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "620810d72294af59ad520cc17c8b83ee1de943e5", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/471795b019d800dca65e2a400fbdb166e6f821cd/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/471795b019d800dca65e2a400fbdb166e6f821cd/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=471795b019d800dca65e2a400fbdb166e6f821cd", "patch": "@@ -246,10 +246,10 @@ async function patchelf(dest: PathLike): Promise<void> {\n         },\n         async (progress, _) => {\n             const expression = `\n-            {src, pkgs ? import <nixpkgs> {}}:\n+            {srcStr, pkgs ? import <nixpkgs> {}}:\n                 pkgs.stdenv.mkDerivation {\n                     name = \"rust-analyzer\";\n-                    inherit src;\n+                    src = /. + srcStr;\n                     phases = [ \"installPhase\" \"fixupPhase\" ];\n                     installPhase = \"cp $src $out\";\n                     fixupPhase = ''\n@@ -262,7 +262,7 @@ async function patchelf(dest: PathLike): Promise<void> {\n             await fs.rename(dest, origFile);\n             progress.report({ message: \"Patching executable\", increment: 20 });\n             await new Promise((resolve, reject) => {\n-                const handle = exec(`nix-build -E - --arg src '${origFile}' -o ${dest}`,\n+                const handle = exec(`nix-build -E - --argstr srcStr '${origFile}' -o '${dest}'`,\n                     (err, stdout, stderr) => {\n                         if (err != null) {\n                             reject(Error(stderr));"}]}