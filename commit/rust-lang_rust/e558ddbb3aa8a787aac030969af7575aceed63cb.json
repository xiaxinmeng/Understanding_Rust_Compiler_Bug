{"sha": "e558ddbb3aa8a787aac030969af7575aceed63cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1NThkZGJiM2FhOGE3ODdhYWMwMzA5NjlhZjc1NzVhY2VlZDYzY2I=", "commit": {"author": {"name": "Hameer Abbasi", "email": "einstein.edison@gmail.com", "date": "2021-04-24T14:25:36Z"}, "committer": {"name": "Hameer Abbasi", "email": "einstein.edison@gmail.com", "date": "2021-04-25T06:56:50Z"}, "message": "Improve diagnostics for function passed when a type was expected.", "tree": {"sha": "debc8bf0d7c889d0f4a735b6f89fd6e84d602496", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/debc8bf0d7c889d0f4a735b6f89fd6e84d602496"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e558ddbb3aa8a787aac030969af7575aceed63cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e558ddbb3aa8a787aac030969af7575aceed63cb", "html_url": "https://github.com/rust-lang/rust/commit/e558ddbb3aa8a787aac030969af7575aceed63cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e558ddbb3aa8a787aac030969af7575aceed63cb/comments", "author": {"login": "hameerabbasi", "id": 2190658, "node_id": "MDQ6VXNlcjIxOTA2NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2190658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hameerabbasi", "html_url": "https://github.com/hameerabbasi", "followers_url": "https://api.github.com/users/hameerabbasi/followers", "following_url": "https://api.github.com/users/hameerabbasi/following{/other_user}", "gists_url": "https://api.github.com/users/hameerabbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/hameerabbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hameerabbasi/subscriptions", "organizations_url": "https://api.github.com/users/hameerabbasi/orgs", "repos_url": "https://api.github.com/users/hameerabbasi/repos", "events_url": "https://api.github.com/users/hameerabbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/hameerabbasi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hameerabbasi", "id": 2190658, "node_id": "MDQ6VXNlcjIxOTA2NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2190658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hameerabbasi", "html_url": "https://github.com/hameerabbasi", "followers_url": "https://api.github.com/users/hameerabbasi/followers", "following_url": "https://api.github.com/users/hameerabbasi/following{/other_user}", "gists_url": "https://api.github.com/users/hameerabbasi/gists{/gist_id}", "starred_url": "https://api.github.com/users/hameerabbasi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hameerabbasi/subscriptions", "organizations_url": "https://api.github.com/users/hameerabbasi/orgs", "repos_url": "https://api.github.com/users/hameerabbasi/repos", "events_url": "https://api.github.com/users/hameerabbasi/events{/privacy}", "received_events_url": "https://api.github.com/users/hameerabbasi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4", "html_url": "https://github.com/rust-lang/rust/commit/e11a9fa52a3f372dadd6db3d3f2ed7dc2621dcc4"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "748704988627ff7b510394af7e6dab0f8d53055d", "filename": "compiler/rustc_typeck/src/astconv/generics.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e558ddbb3aa8a787aac030969af7575aceed63cb/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e558ddbb3aa8a787aac030969af7575aceed63cb/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fgenerics.rs?ref=e558ddbb3aa8a787aac030969af7575aceed63cb", "patch": "@@ -109,6 +109,20 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                     );\n                 }\n             }\n+            (GenericArg::Const(cnst), GenericParamDefKind::Type { .. }) => {\n+                let body = tcx.hir().body(cnst.value.body);\n+                if let rustc_hir::ExprKind::Path(rustc_hir::QPath::Resolved(_, path)) =\n+                    body.value.kind\n+                {\n+                    if let Res::Def(DefKind::Fn { .. }, id) = path.res {\n+                        err.help(&format!(\n+                            \"`{}` is a function item, not a type\",\n+                            tcx.item_name(id)\n+                        ));\n+                        err.help(\"function item types cannot be named directly\");\n+                    }\n+                }\n+            }\n             _ => {}\n         }\n "}, {"sha": "e1b0578cadbe96d32ea3e2c03c6ee774c24405cb", "filename": "src/test/ui/generics/generic-function-item-where-type.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.rs?ref=e558ddbb3aa8a787aac030969af7575aceed63cb", "patch": "@@ -0,0 +1,6 @@\n+fn foo<U>() {}\n+\n+fn main() {\n+    foo::<main>()\n+    //~^ ERROR constant provided when a type was expected\n+}"}, {"sha": "88594129caabac4ca6591b2301dfa3751f48dc2b", "filename": "src/test/ui/generics/generic-function-item-where-type.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerics%2Fgeneric-function-item-where-type.stderr?ref=e558ddbb3aa8a787aac030969af7575aceed63cb", "patch": "@@ -0,0 +1,12 @@\n+error[E0747]: constant provided when a type was expected\n+  --> $DIR/generic-function-item-where-type.rs:4:11\n+   |\n+LL |     foo::<main>()\n+   |           ^^^^\n+   |\n+   = help: `main` is a function item, not a type\n+   = help: function item types cannot be named directly\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0747`."}, {"sha": "d09a8aae7480108eee0c477cc6e7493bdbd71d3c", "filename": "src/test/ui/privacy/privacy-ns1.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns1.stderr?ref=e558ddbb3aa8a787aac030969af7575aceed63cb", "patch": "@@ -57,6 +57,9 @@ error[E0747]: constant provided when a type was expected\n    |\n LL |     let _x: Box<Bar>;\n    |                 ^^^\n+   |\n+   = help: `Bar` is a function item, not a type\n+   = help: function item types cannot be named directly\n \n error: aborting due to 4 previous errors\n "}, {"sha": "fdf0549cf50bc5fd5dcf4318b9a1f7a28d581fb1", "filename": "src/test/ui/privacy/privacy-ns2.stderr", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e558ddbb3aa8a787aac030969af7575aceed63cb/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fprivacy-ns2.stderr?ref=e558ddbb3aa8a787aac030969af7575aceed63cb", "patch": "@@ -83,12 +83,18 @@ error[E0747]: constant provided when a type was expected\n    |\n LL |     let _x : Box<Bar>;\n    |                  ^^^\n+   |\n+   = help: `Bar` is a function item, not a type\n+   = help: function item types cannot be named directly\n \n error[E0747]: constant provided when a type was expected\n   --> $DIR/privacy-ns2.rs:48:17\n    |\n LL |     let _x: Box<Bar>;\n    |                 ^^^\n+   |\n+   = help: `Bar` is a function item, not a type\n+   = help: function item types cannot be named directly\n \n error: aborting due to 8 previous errors\n "}]}