{"sha": "d2c405eeff3930bf0c0777f06108a2eedcd456f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyYzQwNWVlZmYzOTMwYmYwYzA3NzdmMDYxMDhhMmVlZGNkNDU2ZjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-27T23:32:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-27T23:32:18Z"}, "message": "auto merge of #10642 : cmr/rust/strict_doccomment, r=alexcrichton\n\nPreviously, `//// foo` and `/*** foo ***/` were accepted as doc comments. This\nchanges that, so that only `/// foo` and `/** foo ***/` are accepted. This\nconfuses many newcomers and it seems weird.\n\nAlso update the manual for these changes, and modernify the EBNF for comments.\n\nCloses #10638", "tree": {"sha": "0672956c3f38a15d76316f27171bd663520a8659", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0672956c3f38a15d76316f27171bd663520a8659"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2c405eeff3930bf0c0777f06108a2eedcd456f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2c405eeff3930bf0c0777f06108a2eedcd456f6", "html_url": "https://github.com/rust-lang/rust/commit/d2c405eeff3930bf0c0777f06108a2eedcd456f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2c405eeff3930bf0c0777f06108a2eedcd456f6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d662820b297f0ecda17126577571fcf886bdac81", "url": "https://api.github.com/repos/rust-lang/rust/commits/d662820b297f0ecda17126577571fcf886bdac81", "html_url": "https://github.com/rust-lang/rust/commit/d662820b297f0ecda17126577571fcf886bdac81"}, {"sha": "b50b1628840daf849e548c83372f85bc13092314", "url": "https://api.github.com/repos/rust-lang/rust/commits/b50b1628840daf849e548c83372f85bc13092314", "html_url": "https://github.com/rust-lang/rust/commit/b50b1628840daf849e548c83372f85bc13092314"}], "stats": {"total": 40, "additions": 29, "deletions": 11}, "files": [{"sha": "2a4a066c020836ca17383722a8521c4ea66d9905", "filename": "doc/rust.md", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d2c405eeff3930bf0c0777f06108a2eedcd456f6/doc%2Frust.md", "raw_url": "https://github.com/rust-lang/rust/raw/d2c405eeff3930bf0c0777f06108a2eedcd456f6/doc%2Frust.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Frust.md?ref=d2c405eeff3930bf0c0777f06108a2eedcd456f6", "patch": "@@ -153,17 +153,19 @@ Some productions are defined by exclusion of particular Unicode characters:\n ~~~~ {.ebnf .gram}\n comment : block_comment | line_comment ;\n block_comment : \"/*\" block_comment_body * '*' + '/' ;\n-block_comment_body : non_star * | '*' + non_slash_or_star ;\n+block_comment_body : (block_comment | character) * ;\n line_comment : \"//\" non_eol * ;\n ~~~~\n \n Comments in Rust code follow the general C++ style of line and block-comment forms,\n with no nesting of block-comment delimiters.\n \n-Line comments beginning with _three_ slashes (`///`),\n-and block comments beginning with a repeated asterisk in the block-open sequence (`/**`),\n-are interpreted as a special syntax for `doc` [attributes](#attributes).\n-That is, they are equivalent to writing `#[doc \"...\"]` around the comment's text.\n+Line comments beginning with exactly _three_ slashes (`///`), and block\n+comments beginning with a exactly one repeated asterisk in the block-open\n+sequence (`/**`), are interpreted as a special syntax for `doc`\n+[attributes](#attributes).  That is, they are equivalent to writing\n+`#[doc=\"...\"]` around the body of the comment (this includes the comment\n+characters themselves, ie `/// Foo` turns into `#[doc=\"/// Foo\"]`).\n \n Non-doc comments are interpreted as a form of whitespace.\n "}, {"sha": "dc1e58c1ae37549ac49165c8cc1426dfd667bde8", "filename": "src/etc/vim/syntax/rust.vim", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "raw_url": "https://github.com/rust-lang/rust/raw/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fvim%2Fsyntax%2Frust.vim?ref=d2c405eeff3930bf0c0777f06108a2eedcd456f6", "patch": "@@ -187,8 +187,8 @@ syn match   rustCharacter   /'\\([^'\\\\]\\|\\\\\\([nrt0\\\\'\"]\\|x\\x\\{2}\\|u\\x\\{4}\\|U\\x\\{8\n \n syn region    rustCommentML   start=\"/\\*\" end=\"\\*/\" contains=rustTodo\n syn region    rustComment     start=\"//\" end=\"$\" contains=rustTodo keepend\n-syn region    rustCommentMLDoc start=\"/\\*\\%(!\\|\\*/\\@!\\)\" end=\"\\*/\" contains=rustTodo\n-syn region    rustCommentDoc  start=\"//[/!]\" end=\"$\" contains=rustTodo keepend\n+syn region    rustCommentMLDoc start=\"/\\*\\%(!\\|\\*[*/]\\@!\\)\" end=\"\\*/\" contains=rustTodo\n+syn region    rustCommentDoc  start=\"//\\%(//\\@!\\|!\\)\" end=\"$\" contains=rustTodo keepend\n \n syn keyword rustTodo contained TODO FIXME XXX NB NOTE\n "}, {"sha": "fa93c5f897711a5d6c3d8deca8ce84045b0a149b", "filename": "src/libsyntax/parse/lexer.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Flibsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Flibsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer.rs?ref=d2c405eeff3930bf0c0777f06108a2eedcd456f6", "patch": "@@ -317,8 +317,7 @@ fn consume_whitespace_and_comments(rdr: @mut StringReader)\n }\n \n pub fn is_line_non_doc_comment(s: &str) -> bool {\n-    let s = s.trim_right();\n-    s.len() > 3 && s.chars().all(|ch| ch == '/')\n+    s.starts_with(\"////\")\n }\n \n // PRECONDITION: rdr.curr is not whitespace\n@@ -378,8 +377,7 @@ fn consume_any_line_comment(rdr: @mut StringReader)\n }\n \n pub fn is_block_non_doc_comment(s: &str) -> bool {\n-    assert!(s.len() >= 1u);\n-    s.slice(1u, s.len() - 1u).chars().all(|ch| ch == '*')\n+    s.starts_with(\"/***\")\n }\n \n // might return a sugared-doc-attr"}, {"sha": "bc77b4c534311f0115a3fe3966238d206d4882d5", "filename": "src/test/run-pass/issue-10638.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Ftest%2Frun-pass%2Fissue-10638.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2c405eeff3930bf0c0777f06108a2eedcd456f6/src%2Ftest%2Frun-pass%2Fissue-10638.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-10638.rs?ref=d2c405eeff3930bf0c0777f06108a2eedcd456f6", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+pub fn main() {\n+    //// I am not a doc comment!\n+    ////////////////// still not a doc comment\n+    /////**** nope, me neither */\n+    /*** And neither am I! */\n+    5;\n+    /*****! certainly not I */\n+}"}]}