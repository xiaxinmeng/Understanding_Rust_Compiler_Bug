{"sha": "d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ0ZWYwN2IyMzU1ZGY4OTFkNGY5Yjc2NDFmMDI0NmViZTViZDZhNmI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-21T12:50:07Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-21T12:50:07Z"}, "message": "use completions in API", "tree": {"sha": "30d9d415773d4a68d93d8a2c194ade23a80a1aa9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/30d9d415773d4a68d93d8a2c194ade23a80a1aa9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "html_url": "https://github.com/rust-lang/rust/commit/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba0072401c3b8b6c9391428672bd91055150c8ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba0072401c3b8b6c9391428672bd91055150c8ee", "html_url": "https://github.com/rust-lang/rust/commit/ba0072401c3b8b6c9391428672bd91055150c8ee"}], "stats": {"total": 15, "additions": 7, "deletions": 8}, "files": [{"sha": "09894d9553ca520b7227a12644a94e1fc00eb7aa", "filename": "crates/ra_analysis/src/completion.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b/crates%2Fra_analysis%2Fsrc%2Fcompletion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b/crates%2Fra_analysis%2Fsrc%2Fcompletion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion.rs?ref=d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "patch": "@@ -24,7 +24,7 @@ pub use crate::completion::completion_item::{CompletionItem, InsertText};\n pub(crate) fn completions(\n     db: &db::RootDatabase,\n     position: FilePosition,\n-) -> Cancelable<Option<Vec<CompletionItem>>> {\n+) -> Cancelable<Option<Completions>> {\n     let original_file = db.source_file(position.file_id);\n     // Insert a fake ident to get a valid parse tree\n     let file = {\n@@ -53,12 +53,10 @@ pub(crate) fn completions(\n             param_completions(&mut acc, name.syntax());\n         }\n     }\n-    let res = if has_completions {\n-        Some(acc.into())\n-    } else {\n-        None\n-    };\n-    Ok(res)\n+    if !has_completions {\n+        return Ok(None);\n+    }\n+    Ok(Some(acc))\n }\n \n /// Complete repeated parametes, both name and type. For example, if all"}, {"sha": "340f7c78c9c3f07313ae9bdf8dcc1c94449438d5", "filename": "crates/ra_analysis/src/imp.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b/crates%2Fra_analysis%2Fsrc%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fimp.rs?ref=d4ef07b2355df891d4f9b7641f0246ebe5bd6a6b", "patch": "@@ -219,7 +219,8 @@ impl AnalysisImpl {\n         self.db.crate_graph().crate_root(crate_id)\n     }\n     pub fn completions(&self, position: FilePosition) -> Cancelable<Option<Vec<CompletionItem>>> {\n-        completions(&self.db, position)\n+        let completions = completions(&self.db, position)?;\n+        Ok(completions.map(|it| it.into()))\n     }\n     pub fn approximately_resolve_symbol(\n         &self,"}]}