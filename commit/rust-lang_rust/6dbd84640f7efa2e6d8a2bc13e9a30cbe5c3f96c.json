{"sha": "6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkYmQ4NDY0MGY3ZWZhMmU2ZDhhMmJjMTNlOWEzMGNiZTVjM2Y5NmM=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2017-08-08T16:11:39Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2017-08-09T12:09:48Z"}, "message": "Erase/anonymize regions while computing TypeId hash.", "tree": {"sha": "c4d510a098f5f6d2b1dde0d3ffaf5d0448c726bd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4d510a098f5f6d2b1dde0d3ffaf5d0448c726bd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "html_url": "https://github.com/rust-lang/rust/commit/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d07dd4ab444bb14746c3cc80186c979e5c51c3a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/d07dd4ab444bb14746c3cc80186c979e5c51c3a1", "html_url": "https://github.com/rust-lang/rust/commit/d07dd4ab444bb14746c3cc80186c979e5c51c3a1"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "ca95ff5722a12d03e448b223953987e8745a708a", "filename": "src/librustc/ty/util.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c/src%2Flibrustc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c/src%2Flibrustc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Futil.rs?ref=6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "patch": "@@ -214,6 +214,11 @@ impl<'a, 'tcx> TyCtxt<'a, 'tcx, 'tcx> {\n         let mut hasher = StableHasher::new();\n         let mut hcx = StableHashingContext::new(self);\n \n+        // We want the type_id be independent of the types free regions, so we\n+        // erase them. The erase_regions() call will also anonymize bound\n+        // regions, which is desirable too.\n+        let ty = self.erase_regions(&ty);\n+\n         hcx.while_hashing_spans(false, |hcx| {\n             hcx.with_node_id_hashing_mode(NodeIdHashingMode::HashDefPath, |hcx| {\n                 ty.hash_stable(hcx, &mut hasher);"}, {"sha": "2865b5d04e5be61d4bdaf6ca522d5dac1c7be7ea", "filename": "src/test/run-pass/type-id-higher-rank.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c/src%2Ftest%2Frun-pass%2Ftype-id-higher-rank.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c/src%2Ftest%2Frun-pass%2Ftype-id-higher-rank.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftype-id-higher-rank.rs?ref=6dbd84640f7efa2e6d8a2bc13e9a30cbe5c3f96c", "patch": "@@ -45,6 +45,11 @@ fn main() {\n         assert!(g != h);\n         assert!(g != i);\n         assert!(h != i);\n+\n+        // Make sure lifetime anonymization handles nesting correctly\n+        let j = TypeId::of::<fn(for<'a> fn(&'a isize) -> &'a usize)>();\n+        let k = TypeId::of::<fn(for<'b> fn(&'b isize) -> &'b usize)>();\n+        assert_eq!(j, k);\n     }\n     // Boxed unboxed closures\n     {"}]}