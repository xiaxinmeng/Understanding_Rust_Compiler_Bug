{"sha": "4788aaa5f07da85707b7bf409b5d25df1682a760", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3ODhhYWE1ZjA3ZGE4NTcwN2I3YmY0MDliNWQyNWRmMTY4MmE3NjA=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2020-12-13T13:52:45Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2020-12-13T13:53:04Z"}, "message": "Add test for #6852", "tree": {"sha": "dbe9c8211ce85e866b0d0658cfb74921f59a70a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbe9c8211ce85e866b0d0658cfb74921f59a70a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4788aaa5f07da85707b7bf409b5d25df1682a760", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4788aaa5f07da85707b7bf409b5d25df1682a760", "html_url": "https://github.com/rust-lang/rust/commit/4788aaa5f07da85707b7bf409b5d25df1682a760", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4788aaa5f07da85707b7bf409b5d25df1682a760/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48802e54d1669c68fd27b007533dd6aa5221d089", "url": "https://api.github.com/repos/rust-lang/rust/commits/48802e54d1669c68fd27b007533dd6aa5221d089", "html_url": "https://github.com/rust-lang/rust/commit/48802e54d1669c68fd27b007533dd6aa5221d089"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "da817041704a32ca364c1067c9b34d41914df8eb", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/4788aaa5f07da85707b7bf409b5d25df1682a760/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4788aaa5f07da85707b7bf409b5d25df1682a760/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=4788aaa5f07da85707b7bf409b5d25df1682a760", "patch": "@@ -883,3 +883,40 @@ fn issue_6628() {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn issue_6852() {\n+    check_infer(\n+        r#\"\n+        #[lang = \"deref\"]\n+        pub trait Deref {\n+            type Target;\n+        }\n+\n+        struct BufWriter {}\n+\n+        struct Mutex<T> {}\n+        struct MutexGuard<'a, T> {}\n+        impl<T> Mutex<T> {\n+            fn lock(&self) -> MutexGuard<'_, T> {}\n+        }\n+        impl<'a, T: 'a> Deref for MutexGuard<'a, T> {\n+            type Target = T;\n+        }\n+        fn flush(&self) {\n+            let w: &Mutex<BufWriter>;\n+            *(w.lock());\n+        }\n+        \"#,\n+        expect![[r#\"\n+            156..160 'self': &Mutex<T>\n+            183..185 '{}': ()\n+            267..271 'self': &{unknown}\n+            273..323 '{     ...()); }': ()\n+            283..284 'w': &Mutex<BufWriter>\n+            309..320 '*(w.lock())': BufWriter\n+            311..312 'w': &Mutex<BufWriter>\n+            311..319 'w.lock()': MutexGuard<BufWriter>\n+        \"#]],\n+    );\n+}"}]}