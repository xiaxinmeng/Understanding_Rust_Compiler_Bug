{"sha": "d749b5e2237abdb79494afc9c8d7c8280db9088c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3NDliNWUyMjM3YWJkYjc5NDk0YWZjOWM4ZDdjODI4MGRiOTA4OGM=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-07-24T15:00:09Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-07-24T15:00:09Z"}, "message": "Gate binary dependency information behind -Zbinary-dep-depinfo", "tree": {"sha": "ec914bd100359037adfbd390947fcbf3add766b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec914bd100359037adfbd390947fcbf3add766b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d749b5e2237abdb79494afc9c8d7c8280db9088c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d749b5e2237abdb79494afc9c8d7c8280db9088c", "html_url": "https://github.com/rust-lang/rust/commit/d749b5e2237abdb79494afc9c8d7c8280db9088c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d749b5e2237abdb79494afc9c8d7c8280db9088c/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eafb42dc94b191fdd9f38b548f624184101182a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/eafb42dc94b191fdd9f38b548f624184101182a2", "html_url": "https://github.com/rust-lang/rust/commit/eafb42dc94b191fdd9f38b548f624184101182a2"}], "stats": {"total": 29, "additions": 18, "deletions": 11}, "files": [{"sha": "9a8429733d1034b374a67d98d9ec461ae47a6cfe", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=d749b5e2237abdb79494afc9c8d7c8280db9088c", "patch": "@@ -1468,6 +1468,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n     symbol_mangling_version: SymbolManglingVersion = (SymbolManglingVersion::Legacy,\n         parse_symbol_mangling_version, [TRACKED],\n         \"which mangling version to use for symbol names\"),\n+    binary_dep_depinfo: bool = (false, parse_bool, [TRACKED],\n+        \"include artifacts (sysroot, crate dependencies) used during compilation in dep-info\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "c88ca132184b267095676b3afc21fa0665fea1f6", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=d749b5e2237abdb79494afc9c8d7c8280db9088c", "patch": "@@ -545,6 +545,9 @@ impl Session {\n     pub fn print_llvm_passes(&self) -> bool {\n         self.opts.debugging_opts.print_llvm_passes\n     }\n+    pub fn binary_dep_depinfo(&self) -> bool {\n+        self.opts.debugging_opts.binary_dep_depinfo\n+    }\n \n     /// Gets the features enabled for the current compilation session.\n     /// DO NOT USE THIS METHOD if there is a TyCtxt available, as it circumvents"}, {"sha": "772395bca2b3740aba2c334c3ba64cb73d755742", "filename": "src/librustc_interface/passes.rs", "status": "modified", "additions": 13, "deletions": 11, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc_interface%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d749b5e2237abdb79494afc9c8d7c8280db9088c/src%2Flibrustc_interface%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fpasses.rs?ref=d749b5e2237abdb79494afc9c8d7c8280db9088c", "patch": "@@ -677,17 +677,19 @@ fn write_out_deps(compiler: &Compiler, outputs: &OutputFilenames, out_filenames:\n             .map(|fmap| escape_dep_filename(&fmap.name))\n             .collect();\n \n-        for cnum in compiler.cstore.crates_untracked() {\n-            let metadata = compiler.cstore.crate_data_as_rc_any(cnum);\n-            let metadata = metadata.downcast_ref::<cstore::CrateMetadata>().unwrap();\n-            if let Some((path, _)) = &metadata.source.dylib {\n-                files.push(escape_dep_filename(&FileName::Real(path.clone())));\n-            }\n-            if let Some((path, _)) = &metadata.source.rlib {\n-                files.push(escape_dep_filename(&FileName::Real(path.clone())));\n-            }\n-            if let Some((path, _)) = &metadata.source.rmeta {\n-                files.push(escape_dep_filename(&FileName::Real(path.clone())));\n+        if sess.binary_dep_depinfo() {\n+            for cnum in compiler.cstore.crates_untracked() {\n+                let metadata = compiler.cstore.crate_data_as_rc_any(cnum);\n+                let metadata = metadata.downcast_ref::<cstore::CrateMetadata>().unwrap();\n+                if let Some((path, _)) = &metadata.source.dylib {\n+                    files.push(escape_dep_filename(&FileName::Real(path.clone())));\n+                }\n+                if let Some((path, _)) = &metadata.source.rlib {\n+                    files.push(escape_dep_filename(&FileName::Real(path.clone())));\n+                }\n+                if let Some((path, _)) = &metadata.source.rmeta {\n+                    files.push(escape_dep_filename(&FileName::Real(path.clone())));\n+                }\n             }\n         }\n "}]}