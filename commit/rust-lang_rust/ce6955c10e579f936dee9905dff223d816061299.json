{"sha": "ce6955c10e579f936dee9905dff223d816061299", "node_id": "C_kwDOAAsO6NoAKGNlNjk1NWMxMGU1NzlmOTM2ZGVlOTkwNWRmZjIyM2Q4MTYwNjEyOTk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-14T12:22:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-14T12:22:43Z"}, "message": "Auto merge of #13946 - Veykril:inlay-hints, r=Veykril\n\nRemove hover inlay tooltips, replace them with location links\n\nTurns out we re-implemented what clients can already figure out through the use of location-links. We might want lazy resolves tooltips later on still, but for now this simplifies things again.", "tree": {"sha": "bec3fb96451139ddb7b047c85af0fe81c3001ccd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bec3fb96451139ddb7b047c85af0fe81c3001ccd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce6955c10e579f936dee9905dff223d816061299", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce6955c10e579f936dee9905dff223d816061299", "html_url": "https://github.com/rust-lang/rust/commit/ce6955c10e579f936dee9905dff223d816061299", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce6955c10e579f936dee9905dff223d816061299/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32be158630e0b011a24545b07282753e6de37dd3", "url": "https://api.github.com/repos/rust-lang/rust/commits/32be158630e0b011a24545b07282753e6de37dd3", "html_url": "https://github.com/rust-lang/rust/commit/32be158630e0b011a24545b07282753e6de37dd3"}, {"sha": "f2444b2a402f8d551152cb482686c7839574ac1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2444b2a402f8d551152cb482686c7839574ac1d", "html_url": "https://github.com/rust-lang/rust/commit/f2444b2a402f8d551152cb482686c7839574ac1d"}], "stats": {"total": 753, "additions": 282, "deletions": 471}, "files": [{"sha": "13d8d40ddd37509d8223b92a993e3d445b2122ba", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -645,6 +645,7 @@ dependencies = [\n  \"profile\",\n  \"pulldown-cmark\",\n  \"pulldown-cmark-to-cmark\",\n+ \"smallvec\",\n  \"stdx\",\n  \"syntax\",\n  \"test-utils\","}, {"sha": "397383bc3a0b2f7fd9b3dbf364140cd9791629f0", "filename": "crates/ide/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2FCargo.toml?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -20,6 +20,7 @@ pulldown-cmark-to-cmark = \"10.0.4\"\n pulldown-cmark = { version = \"0.9.1\", default-features = false }\n url = \"2.3.1\"\n dot = \"0.1.4\"\n+smallvec = \"1.10.0\"\n \n stdx = { path = \"../stdx\", version = \"0.0.0\" }\n syntax = { path = \"../syntax\", version = \"0.0.0\" }"}, {"sha": "861bf1c66cbe946d245b31b421501962c9063029", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 76, "deletions": 41, "changes": 117, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -7,10 +7,11 @@ use either::Either;\n use hir::{known, HasVisibility, HirDisplay, HirWrite, ModuleDef, ModuleDefId, Semantics};\n use ide_db::{base_db::FileRange, famous_defs::FamousDefs, RootDatabase};\n use itertools::Itertools;\n+use smallvec::{smallvec, SmallVec};\n use stdx::never;\n use syntax::{\n     ast::{self, AstNode},\n-    match_ast, NodeOrToken, SyntaxNode, TextRange, TextSize,\n+    match_ast, NodeOrToken, SyntaxNode, TextRange,\n };\n \n use crate::{navigation_target::TryToNav, FileId};\n@@ -83,75 +84,108 @@ pub enum AdjustmentHintsMode {\n     PreferPostfix,\n }\n \n-#[derive(Clone, Debug, PartialEq, Eq)]\n+#[derive(Copy, Clone, Debug, PartialEq, Eq)]\n pub enum InlayKind {\n-    BindingModeHint,\n-    ChainingHint,\n-    ClosingBraceHint,\n-    ClosureReturnTypeHint,\n-    GenericParamListHint,\n-    AdjustmentHint,\n-    AdjustmentHintPostfix,\n-    LifetimeHint,\n-    ParameterHint,\n-    TypeHint,\n-    DiscriminantHint,\n+    BindingMode,\n+    Chaining,\n+    ClosingBrace,\n+    ClosureReturnType,\n+    GenericParamList,\n+    Adjustment,\n+    AdjustmentPostfix,\n+    Lifetime,\n+    Parameter,\n+    Type,\n+    Discriminant,\n     OpeningParenthesis,\n     ClosingParenthesis,\n }\n \n #[derive(Debug)]\n pub struct InlayHint {\n+    /// The text range this inlay hint applies to.\n     pub range: TextRange,\n+    /// The kind of this inlay hint. This is used to determine side and padding of the hint for\n+    /// rendering purposes.\n     pub kind: InlayKind,\n+    /// The actual label to show in the inlay hint.\n     pub label: InlayHintLabel,\n-    pub tooltip: Option<InlayTooltip>,\n+}\n+\n+impl InlayHint {\n+    fn closing_paren(range: TextRange) -> InlayHint {\n+        InlayHint { range, kind: InlayKind::ClosingParenthesis, label: InlayHintLabel::from(\")\") }\n+    }\n+    fn opening_paren(range: TextRange) -> InlayHint {\n+        InlayHint { range, kind: InlayKind::OpeningParenthesis, label: InlayHintLabel::from(\"(\") }\n+    }\n }\n \n #[derive(Debug)]\n pub enum InlayTooltip {\n     String(String),\n-    HoverRanged(FileId, TextRange),\n-    HoverOffset(FileId, TextSize),\n+    Markdown(String),\n }\n \n #[derive(Default)]\n pub struct InlayHintLabel {\n-    pub parts: Vec<InlayHintLabelPart>,\n+    pub parts: SmallVec<[InlayHintLabelPart; 1]>,\n }\n \n impl InlayHintLabel {\n-    pub fn as_simple_str(&self) -> Option<&str> {\n-        match &*self.parts {\n-            [part] => part.as_simple_str(),\n-            _ => None,\n+    pub fn simple(\n+        s: impl Into<String>,\n+        tooltip: Option<InlayTooltip>,\n+        linked_location: Option<FileRange>,\n+    ) -> InlayHintLabel {\n+        InlayHintLabel {\n+            parts: smallvec![InlayHintLabelPart { text: s.into(), linked_location, tooltip }],\n         }\n     }\n \n     pub fn prepend_str(&mut self, s: &str) {\n         match &mut *self.parts {\n-            [part, ..] if part.as_simple_str().is_some() => part.text = format!(\"{s}{}\", part.text),\n-            _ => self.parts.insert(0, InlayHintLabelPart { text: s.into(), linked_location: None }),\n+            [InlayHintLabelPart { text, linked_location: None, tooltip: None }, ..] => {\n+                text.insert_str(0, s)\n+            }\n+            _ => self.parts.insert(\n+                0,\n+                InlayHintLabelPart { text: s.into(), linked_location: None, tooltip: None },\n+            ),\n         }\n     }\n \n     pub fn append_str(&mut self, s: &str) {\n         match &mut *self.parts {\n-            [.., part] if part.as_simple_str().is_some() => part.text.push_str(s),\n-            _ => self.parts.push(InlayHintLabelPart { text: s.into(), linked_location: None }),\n+            [.., InlayHintLabelPart { text, linked_location: None, tooltip: None }] => {\n+                text.push_str(s)\n+            }\n+            _ => self.parts.push(InlayHintLabelPart {\n+                text: s.into(),\n+                linked_location: None,\n+                tooltip: None,\n+            }),\n         }\n     }\n }\n \n impl From<String> for InlayHintLabel {\n     fn from(s: String) -> Self {\n-        Self { parts: vec![InlayHintLabelPart { text: s, linked_location: None }] }\n+        Self {\n+            parts: smallvec![InlayHintLabelPart { text: s, linked_location: None, tooltip: None }],\n+        }\n     }\n }\n \n impl From<&str> for InlayHintLabel {\n     fn from(s: &str) -> Self {\n-        Self { parts: vec![InlayHintLabelPart { text: s.into(), linked_location: None }] }\n+        Self {\n+            parts: smallvec![InlayHintLabelPart {\n+                text: s.into(),\n+                linked_location: None,\n+                tooltip: None\n+            }],\n+        }\n     }\n }\n \n@@ -175,25 +209,25 @@ pub struct InlayHintLabelPart {\n     /// When setting this, no tooltip must be set on the containing hint, or VS Code will display\n     /// them both.\n     pub linked_location: Option<FileRange>,\n-}\n-\n-impl InlayHintLabelPart {\n-    pub fn as_simple_str(&self) -> Option<&str> {\n-        match self {\n-            Self { text, linked_location: None } => Some(text),\n-            _ => None,\n-        }\n-    }\n+    /// The tooltip to show when hovering over the inlay hint, this may invoke other actions like\n+    /// hover requests to show.\n+    pub tooltip: Option<InlayTooltip>,\n }\n \n impl fmt::Debug for InlayHintLabelPart {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        match self.as_simple_str() {\n-            Some(string) => string.fmt(f),\n-            None => f\n+        match self {\n+            Self { text, linked_location: None, tooltip: None } => text.fmt(f),\n+            Self { text, linked_location, tooltip } => f\n                 .debug_struct(\"InlayHintLabelPart\")\n-                .field(\"text\", &self.text)\n-                .field(\"linked_location\", &self.linked_location)\n+                .field(\"text\", text)\n+                .field(\"linked_location\", linked_location)\n+                .field(\n+                    \"tooltip\",\n+                    &tooltip.as_ref().map_or(\"\", |it| match it {\n+                        InlayTooltip::String(it) | InlayTooltip::Markdown(it) => it,\n+                    }),\n+                )\n                 .finish(),\n         }\n     }\n@@ -242,6 +276,7 @@ impl InlayHintLabelBuilder<'_> {\n         self.result.parts.push(InlayHintLabelPart {\n             text: take(&mut self.last_part),\n             linked_location: self.location.take(),\n+            tooltip: None,\n         });\n     }\n "}, {"sha": "581813f3b7700a6655a83035ba8e1b90e556dfb5", "filename": "crates/ide/src/inlay_hints/adjustment.rs", "status": "modified", "additions": 7, "deletions": 42, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fadjustment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fadjustment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fadjustment.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -44,27 +44,12 @@ pub(super) fn hints(\n         mode_and_needs_parens_for_adjustment_hints(expr, config.adjustment_hints_mode);\n \n     if needs_outer_parens {\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::OpeningParenthesis,\n-            label: \"(\".into(),\n-            tooltip: None,\n-        });\n+        acc.push(InlayHint::opening_paren(expr.syntax().text_range()));\n     }\n \n     if postfix && needs_inner_parens {\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::OpeningParenthesis,\n-            label: \"(\".into(),\n-            tooltip: None,\n-        });\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::ClosingParenthesis,\n-            label: \")\".into(),\n-            tooltip: None,\n-        });\n+        acc.push(InlayHint::opening_paren(expr.syntax().text_range()));\n+        acc.push(InlayHint::closing_paren(expr.syntax().text_range()));\n     }\n \n     let (mut tmp0, mut tmp1);\n@@ -112,36 +97,16 @@ pub(super) fn hints(\n         };\n         acc.push(InlayHint {\n             range: expr.syntax().text_range(),\n-            kind: if postfix {\n-                InlayKind::AdjustmentHintPostfix\n-            } else {\n-                InlayKind::AdjustmentHint\n-            },\n+            kind: if postfix { InlayKind::AdjustmentPostfix } else { InlayKind::Adjustment },\n             label: if postfix { format!(\".{}\", text.trim_end()).into() } else { text.into() },\n-            tooltip: None,\n         });\n     }\n     if !postfix && needs_inner_parens {\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::OpeningParenthesis,\n-            label: \"(\".into(),\n-            tooltip: None,\n-        });\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::ClosingParenthesis,\n-            label: \")\".into(),\n-            tooltip: None,\n-        });\n+        acc.push(InlayHint::opening_paren(expr.syntax().text_range()));\n+        acc.push(InlayHint::closing_paren(expr.syntax().text_range()));\n     }\n     if needs_outer_parens {\n-        acc.push(InlayHint {\n-            range: expr.syntax().text_range(),\n-            kind: InlayKind::ClosingParenthesis,\n-            label: \")\".into(),\n-            tooltip: None,\n-        });\n+        acc.push(InlayHint::closing_paren(expr.syntax().text_range()));\n     }\n     Some(())\n }"}, {"sha": "5227c651ff454a244a3d3b872b654382cb6f5e9e", "filename": "crates/ide/src/inlay_hints/bind_pat.rs", "status": "modified", "additions": 7, "deletions": 27, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fbind_pat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fbind_pat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fbind_pat.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -12,17 +12,15 @@ use syntax::{\n     match_ast,\n };\n \n-use crate::{\n-    inlay_hints::closure_has_block_body, InlayHint, InlayHintsConfig, InlayKind, InlayTooltip,\n-};\n+use crate::{inlay_hints::closure_has_block_body, InlayHint, InlayHintsConfig, InlayKind};\n \n use super::label_of_ty;\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n     famous_defs @ FamousDefs(sema, _): &FamousDefs<'_, '_>,\n     config: &InlayHintsConfig,\n-    file_id: FileId,\n+    _file_id: FileId,\n     pat: &ast::IdentPat,\n ) -> Option<()> {\n     if !config.type_hints {\n@@ -50,12 +48,8 @@ pub(super) fn hints(\n             Some(name) => name.syntax().text_range(),\n             None => pat.syntax().text_range(),\n         },\n-        kind: InlayKind::TypeHint,\n+        kind: InlayKind::Type,\n         label,\n-        tooltip: pat\n-            .name()\n-            .map(|it| it.syntax().text_range())\n-            .map(|it| InlayTooltip::HoverRanged(file_id, it)),\n     });\n \n     Some(())\n@@ -322,22 +316,14 @@ fn main(a: SliceIter<'_, Container>) {\n                 [\n                     InlayHint {\n                         range: 484..554,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"impl Iterator<Item = impl Iterator<Item = &&str>>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                484..554,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 484..485,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -350,6 +336,7 @@ fn main(a: SliceIter<'_, Container>) {\n                                         range: 289..298,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"<\",\n                             InlayHintLabelPart {\n@@ -362,17 +349,10 @@ fn main(a: SliceIter<'_, Container>) {\n                                         range: 238..247,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \">\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                484..485,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],"}, {"sha": "11b9cd269bfa8c77b2005f28842a99a743a3c586", "filename": "crates/ide/src/inlay_hints/binding_mode.rs", "status": "modified", "additions": 5, "deletions": 21, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fbinding_mode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fbinding_mode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fbinding_mode.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -7,7 +7,7 @@ use ide_db::RootDatabase;\n \n use syntax::ast::{self, AstNode};\n \n-use crate::{InlayHint, InlayHintsConfig, InlayKind, InlayTooltip};\n+use crate::{InlayHint, InlayHintsConfig, InlayKind};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -40,12 +40,7 @@ pub(super) fn hints(\n             (true, false) => \"&\",\n             _ => return,\n         };\n-        acc.push(InlayHint {\n-            range,\n-            kind: InlayKind::BindingModeHint,\n-            label: r.to_string().into(),\n-            tooltip: Some(InlayTooltip::String(\"Inferred binding mode\".into())),\n-        });\n+        acc.push(InlayHint { range, kind: InlayKind::BindingMode, label: r.to_string().into() });\n     });\n     match pat {\n         ast::Pat::IdentPat(pat) if pat.ref_token().is_none() && pat.mut_token().is_none() => {\n@@ -57,24 +52,13 @@ pub(super) fn hints(\n             };\n             acc.push(InlayHint {\n                 range: pat.syntax().text_range(),\n-                kind: InlayKind::BindingModeHint,\n+                kind: InlayKind::BindingMode,\n                 label: bm.to_string().into(),\n-                tooltip: Some(InlayTooltip::String(\"Inferred binding mode\".into())),\n             });\n         }\n         ast::Pat::OrPat(pat) if !pattern_adjustments.is_empty() && outer_paren_pat.is_none() => {\n-            acc.push(InlayHint {\n-                range: pat.syntax().text_range(),\n-                kind: InlayKind::OpeningParenthesis,\n-                label: \"(\".into(),\n-                tooltip: None,\n-            });\n-            acc.push(InlayHint {\n-                range: pat.syntax().text_range(),\n-                kind: InlayKind::ClosingParenthesis,\n-                label: \")\".into(),\n-                tooltip: None,\n-            });\n+            acc.push(InlayHint::opening_paren(pat.syntax().text_range()));\n+            acc.push(InlayHint::closing_paren(pat.syntax().text_range()));\n         }\n         _ => (),\n     }"}, {"sha": "e0045a53d7469367a3974029b437ed6d0d5552c0", "filename": "crates/ide/src/inlay_hints/chaining.rs", "status": "modified", "additions": 43, "deletions": 149, "changes": 192, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fchaining.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fchaining.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fchaining.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -5,15 +5,15 @@ use syntax::{\n     Direction, NodeOrToken, SyntaxKind, T,\n };\n \n-use crate::{FileId, InlayHint, InlayHintsConfig, InlayKind, InlayTooltip};\n+use crate::{FileId, InlayHint, InlayHintsConfig, InlayKind};\n \n use super::label_of_ty;\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n     famous_defs @ FamousDefs(sema, _): &FamousDefs<'_, '_>,\n     config: &InlayHintsConfig,\n-    file_id: FileId,\n+    _file_id: FileId,\n     expr: &ast::Expr,\n ) -> Option<()> {\n     if !config.chaining_hints {\n@@ -59,9 +59,8 @@ pub(super) fn hints(\n             }\n             acc.push(InlayHint {\n                 range: expr.syntax().text_range(),\n-                kind: InlayKind::ChainingHint,\n+                kind: InlayKind::Chaining,\n                 label: label_of_ty(famous_defs, config, ty)?,\n-                tooltip: Some(InlayTooltip::HoverRanged(file_id, expr.syntax().text_range())),\n             });\n         }\n     }\n@@ -111,7 +110,7 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 147..172,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -124,21 +123,14 @@ fn main() {\n                                         range: 63..64,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                147..172,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 147..154,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -151,17 +143,10 @@ fn main() {\n                                         range: 7..8,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                147..154,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],\n@@ -210,33 +195,17 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 143..190,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"C\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                143..190,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 143..179,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"B\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                143..179,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],\n@@ -269,7 +238,7 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 143..190,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -282,21 +251,14 @@ fn main() {\n                                         range: 51..52,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                143..190,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 143..179,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -309,17 +271,10 @@ fn main() {\n                                         range: 29..30,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                143..179,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],\n@@ -353,7 +308,7 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 246..283,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -366,6 +321,7 @@ fn main() {\n                                         range: 23..24,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"<\",\n                             InlayHintLabelPart {\n@@ -378,21 +334,14 @@ fn main() {\n                                         range: 55..56,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"<i32, bool>>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                246..283,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 246..265,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -405,6 +354,7 @@ fn main() {\n                                         range: 7..8,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"<\",\n                             InlayHintLabelPart {\n@@ -417,17 +367,10 @@ fn main() {\n                                         range: 55..56,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"<i32, bool>>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                246..265,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],\n@@ -463,52 +406,28 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 174..241,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"impl Iterator<Item = ()>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                174..241,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 174..224,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"impl Iterator<Item = ()>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                174..224,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 174..206,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"impl Iterator<Item = ()>\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                174..206,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 174..189,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"&mut \",\n                             InlayHintLabelPart {\n@@ -521,17 +440,10 @@ fn main() {\n                                         range: 24..30,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                174..189,\n-                            ),\n-                        ),\n                     },\n                 ]\n             \"#]],\n@@ -564,7 +476,7 @@ fn main() {\n                 [\n                     InlayHint {\n                         range: 124..130,\n-                        kind: TypeHint,\n+                        kind: Type,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -577,21 +489,14 @@ fn main() {\n                                         range: 7..13,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                124..130,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 145..185,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -604,21 +509,14 @@ fn main() {\n                                         range: 7..13,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                145..185,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 145..168,\n-                        kind: ChainingHint,\n+                        kind: Chaining,\n                         label: [\n                             \"\",\n                             InlayHintLabelPart {\n@@ -631,32 +529,28 @@ fn main() {\n                                         range: 7..13,\n                                     },\n                                 ),\n+                                tooltip: \"\",\n                             },\n                             \"\",\n                         ],\n-                        tooltip: Some(\n-                            HoverRanged(\n-                                FileId(\n-                                    0,\n-                                ),\n-                                145..168,\n-                            ),\n-                        ),\n                     },\n                     InlayHint {\n                         range: 222..228,\n-                        kind: ParameterHint,\n+                        kind: Parameter,\n                         label: [\n-                            \"self\",\n-                        ],\n-                        tooltip: Some(\n-                            HoverOffset(\n-                                FileId(\n-                                    0,\n+                            InlayHintLabelPart {\n+                                text: \"self\",\n+                                linked_location: Some(\n+                                    FileRange {\n+                                        file_id: FileId(\n+                                            0,\n+                                        ),\n+                                        range: 42..46,\n+                                    },\n                                 ),\n-                                42,\n-                            ),\n-                        ),\n+                                tooltip: \"\",\n+                            },\n+                        ],\n                     },\n                 ]\n             \"#]],"}, {"sha": "aae805f78d6900d6691bba2d8d9b689b9c6971e9", "filename": "crates/ide/src/inlay_hints/closing_brace.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosing_brace.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -10,9 +10,7 @@ use syntax::{\n     match_ast, SyntaxKind, SyntaxNode, T,\n };\n \n-use crate::{\n-    inlay_hints::InlayHintLabelPart, FileId, InlayHint, InlayHintLabel, InlayHintsConfig, InlayKind,\n-};\n+use crate::{FileId, InlayHint, InlayHintLabel, InlayHintsConfig, InlayKind};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -115,9 +113,8 @@ pub(super) fn hints(\n         .flatten();\n     acc.push(InlayHint {\n         range: closing_token.text_range(),\n-        kind: InlayKind::ClosingBraceHint,\n-        label: InlayHintLabel { parts: vec![InlayHintLabelPart { text: label, linked_location }] },\n-        tooltip: None, // provided by label part location\n+        kind: InlayKind::ClosingBrace,\n+        label: InlayHintLabel::simple(label, None, linked_location),\n     });\n \n     None"}, {"sha": "f03a18b8e960faf176c805064bb04ecdffc00a5e", "filename": "crates/ide/src/inlay_hints/closure_ret.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosure_ret.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosure_ret.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fclosure_ret.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -4,7 +4,7 @@ use syntax::ast::{self, AstNode};\n \n use crate::{\n     inlay_hints::closure_has_block_body, ClosureReturnTypeHints, InlayHint, InlayHintsConfig,\n-    InlayKind, InlayTooltip,\n+    InlayKind,\n };\n \n use super::label_of_ty;\n@@ -13,7 +13,7 @@ pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n     famous_defs @ FamousDefs(sema, _): &FamousDefs<'_, '_>,\n     config: &InlayHintsConfig,\n-    file_id: FileId,\n+    _file_id: FileId,\n     closure: ast::ClosureExpr,\n ) -> Option<()> {\n     if config.closure_return_type_hints == ClosureReturnTypeHints::Never {\n@@ -41,9 +41,8 @@ pub(super) fn hints(\n     }\n     acc.push(InlayHint {\n         range: param_list.syntax().text_range(),\n-        kind: InlayKind::ClosureReturnTypeHint,\n+        kind: InlayKind::ClosureReturnType,\n         label: label_of_ty(famous_defs, config, ty)?,\n-        tooltip: Some(InlayTooltip::HoverRanged(file_id, param_list.syntax().text_range())),\n     });\n     Some(())\n }"}, {"sha": "310295cc379353652583db6ecfbea171527b3d6b", "filename": "crates/ide/src/inlay_hints/discriminant.rs", "status": "modified", "additions": 15, "deletions": 10, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fdiscriminant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fdiscriminant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fdiscriminant.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -7,7 +7,9 @@\n use ide_db::{base_db::FileId, famous_defs::FamousDefs};\n use syntax::ast::{self, AstNode, HasName};\n \n-use crate::{DiscriminantHints, InlayHint, InlayHintsConfig, InlayKind, InlayTooltip};\n+use crate::{\n+    DiscriminantHints, InlayHint, InlayHintLabel, InlayHintsConfig, InlayKind, InlayTooltip,\n+};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -41,15 +43,18 @@ pub(super) fn hints(\n             Some(field_list) => name.syntax().text_range().cover(field_list.syntax().text_range()),\n             None => name.syntax().text_range(),\n         },\n-        kind: InlayKind::DiscriminantHint,\n-        label: match &d {\n-            Ok(v) => format!(\"{}\", v).into(),\n-            Err(_) => \"?\".into(),\n-        },\n-        tooltip: Some(InlayTooltip::String(match &d {\n-            Ok(_) => \"enum variant discriminant\".into(),\n-            Err(e) => format!(\"{e:?}\").into(),\n-        })),\n+        kind: InlayKind::Discriminant,\n+        label: InlayHintLabel::simple(\n+            match &d {\n+                Ok(v) => format!(\"{}\", v),\n+                Err(_) => \"?\".into(),\n+            },\n+            Some(InlayTooltip::String(match &d {\n+                Ok(_) => \"enum variant discriminant\".into(),\n+                Err(e) => format!(\"{e:?}\").into(),\n+            })),\n+            None,\n+        ),\n     });\n \n     Some(())"}, {"sha": "b7182085b312ee2a964f2524f93999c57bcb4f4e", "filename": "crates/ide/src/inlay_hints/fn_lifetime_fn.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Ffn_lifetime_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Ffn_lifetime_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Ffn_lifetime_fn.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -10,7 +10,7 @@ use syntax::{\n     SyntaxToken,\n };\n \n-use crate::{InlayHint, InlayHintsConfig, InlayKind, InlayTooltip, LifetimeElisionHints};\n+use crate::{InlayHint, InlayHintsConfig, InlayKind, LifetimeElisionHints};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -23,9 +23,8 @@ pub(super) fn hints(\n \n     let mk_lt_hint = |t: SyntaxToken, label: String| InlayHint {\n         range: t.text_range(),\n-        kind: InlayKind::LifetimeHint,\n+        kind: InlayKind::Lifetime,\n         label: label.into(),\n-        tooltip: Some(InlayTooltip::String(\"Elided lifetime\".into())),\n     };\n \n     let param_list = func.param_list()?;\n@@ -183,21 +182,19 @@ pub(super) fn hints(\n             let is_empty = gpl.generic_params().next().is_none();\n             acc.push(InlayHint {\n                 range: angle_tok.text_range(),\n-                kind: InlayKind::LifetimeHint,\n+                kind: InlayKind::Lifetime,\n                 label: format!(\n                     \"{}{}\",\n                     allocated_lifetimes.iter().format(\", \"),\n                     if is_empty { \"\" } else { \", \" }\n                 )\n                 .into(),\n-                tooltip: Some(InlayTooltip::String(\"Elided lifetimes\".into())),\n             });\n         }\n         (None, allocated_lifetimes) => acc.push(InlayHint {\n             range: func.name()?.syntax().text_range(),\n-            kind: InlayKind::GenericParamListHint,\n+            kind: InlayKind::GenericParamList,\n             label: format!(\"<{}>\", allocated_lifetimes.iter().format(\", \"),).into(),\n-            tooltip: Some(InlayTooltip::String(\"Elided lifetimes\".into())),\n         }),\n     }\n     Some(())"}, {"sha": "1122ee2e3925dfde7e827c66548c8265a7cc4f62", "filename": "crates/ide/src/inlay_hints/implicit_static.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fimplicit_static.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fimplicit_static.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fimplicit_static.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -8,7 +8,7 @@ use syntax::{\n     SyntaxKind,\n };\n \n-use crate::{InlayHint, InlayHintsConfig, InlayKind, InlayTooltip, LifetimeElisionHints};\n+use crate::{InlayHint, InlayHintsConfig, InlayKind, LifetimeElisionHints};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -32,9 +32,8 @@ pub(super) fn hints(\n             let t = ty.amp_token()?;\n             acc.push(InlayHint {\n                 range: t.text_range(),\n-                kind: InlayKind::LifetimeHint,\n+                kind: InlayKind::Lifetime,\n                 label: \"'static\".to_owned().into(),\n-                tooltip: Some(InlayTooltip::String(\"Elided static lifetime\".into())),\n             });\n         }\n     }"}, {"sha": "9cdae6324104480a0280435b63685629d323cfeb", "filename": "crates/ide/src/inlay_hints/param_name.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fparam_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Finlay_hints%2Fparam_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints%2Fparam_name.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -10,7 +10,7 @@ use ide_db::{base_db::FileRange, RootDatabase};\n use stdx::to_lower_snake_case;\n use syntax::ast::{self, AstNode, HasArgList, HasName, UnaryOp};\n \n-use crate::{InlayHint, InlayHintsConfig, InlayKind, InlayTooltip};\n+use crate::{InlayHint, InlayHintLabel, InlayHintsConfig, InlayKind};\n \n pub(super) fn hints(\n     acc: &mut Vec<InlayHint>,\n@@ -43,21 +43,20 @@ pub(super) fn hints(\n             !should_hide_param_name_hint(sema, &callable, param_name, arg)\n         })\n         .map(|(param, param_name, _, FileRange { range, .. })| {\n-            let mut tooltip = None;\n+            let mut linked_location = None;\n             if let Some(name) = param {\n                 if let hir::CallableKind::Function(f) = callable.kind() {\n                     // assert the file is cached so we can map out of macros\n                     if let Some(_) = sema.source(f) {\n-                        tooltip = sema.original_range_opt(name.syntax());\n+                        linked_location = sema.original_range_opt(name.syntax());\n                     }\n                 }\n             }\n \n             InlayHint {\n                 range,\n-                kind: InlayKind::ParameterHint,\n-                label: param_name.into(),\n-                tooltip: tooltip.map(|it| InlayTooltip::HoverOffset(it.file_id, it.range.start())),\n+                kind: InlayKind::Parameter,\n+                label: InlayHintLabel::simple(param_name, None, linked_location),\n             }\n         });\n "}, {"sha": "8424d82aa18300dfe3fb83e937a1f45c108703d3", "filename": "crates/ide/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Fide%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Flib.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -82,7 +82,8 @@ pub use crate::{\n     hover::{HoverAction, HoverConfig, HoverDocFormat, HoverGotoTypeData, HoverResult},\n     inlay_hints::{\n         AdjustmentHints, AdjustmentHintsMode, ClosureReturnTypeHints, DiscriminantHints, InlayHint,\n-        InlayHintLabel, InlayHintsConfig, InlayKind, InlayTooltip, LifetimeElisionHints,\n+        InlayHintLabel, InlayHintLabelPart, InlayHintsConfig, InlayKind, InlayTooltip,\n+        LifetimeElisionHints,\n     },\n     join_lines::JoinLinesConfig,\n     markup::Markup,"}, {"sha": "033ef75cca0de1a3eb4d054cfb9d6c3a5af2d303", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 2, "deletions": 48, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -29,7 +29,6 @@ use project_model::{ManifestPath, ProjectWorkspace, TargetKind};\n use serde_json::json;\n use stdx::{format_to, never};\n use syntax::{algo, ast, AstNode, TextRange, TextSize};\n-use tracing::error;\n use vfs::AbsPathBuf;\n \n use crate::{\n@@ -1360,55 +1359,10 @@ pub(crate) fn handle_inlay_hints(\n }\n \n pub(crate) fn handle_inlay_hints_resolve(\n-    snap: GlobalStateSnapshot,\n-    mut hint: InlayHint,\n+    _snap: GlobalStateSnapshot,\n+    hint: InlayHint,\n ) -> Result<InlayHint> {\n     let _p = profile::span(\"handle_inlay_hints_resolve\");\n-    let data = match hint.data.take() {\n-        Some(it) => it,\n-        None => return Ok(hint),\n-    };\n-\n-    let resolve_data: lsp_ext::InlayHintResolveData = serde_json::from_value(data)?;\n-\n-    match snap.url_file_version(&resolve_data.text_document.uri) {\n-        Some(version) if version == resolve_data.text_document.version => {}\n-        Some(version) => {\n-            error!(\n-                \"attempted inlayHints/resolve of '{}' at version {} while server version is {}\",\n-                resolve_data.text_document.uri, resolve_data.text_document.version, version,\n-            );\n-            return Ok(hint);\n-        }\n-        None => {\n-            error!(\n-                \"attempted inlayHints/resolve of unknown file '{}' at version {}\",\n-                resolve_data.text_document.uri, resolve_data.text_document.version,\n-            );\n-            return Ok(hint);\n-        }\n-    }\n-    let file_range = from_proto::file_range_uri(\n-        &snap,\n-        &resolve_data.text_document.uri,\n-        match resolve_data.position {\n-            PositionOrRange::Position(pos) => Range::new(pos, pos),\n-            PositionOrRange::Range(range) => range,\n-        },\n-    )?;\n-    let info = match snap.analysis.hover(&snap.config.hover(), file_range)? {\n-        None => return Ok(hint),\n-        Some(info) => info,\n-    };\n-\n-    let markup_kind =\n-        snap.config.hover().documentation.map_or(ide::HoverDocFormat::Markdown, |kind| kind);\n-\n-    // FIXME: hover actions?\n-    hint.tooltip = Some(lsp_types::InlayHintTooltip::MarkupContent(to_proto::markup_content(\n-        info.info.markup,\n-        markup_kind,\n-    )));\n     Ok(hint)\n }\n "}, {"sha": "b117acd1b0f7cb97064de044a0034130d50943ac", "filename": "crates/rust-analyzer/src/lsp_ext.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Flsp_ext.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -3,11 +3,11 @@\n use std::{collections::HashMap, path::PathBuf};\n \n use lsp_types::request::Request;\n+use lsp_types::PositionEncodingKind;\n use lsp_types::{\n     notification::Notification, CodeActionKind, DocumentOnTypeFormattingParams,\n     PartialResultParams, Position, Range, TextDocumentIdentifier, WorkDoneProgressParams,\n };\n-use lsp_types::{PositionEncodingKind, VersionedTextDocumentIdentifier};\n use serde::{Deserialize, Serialize};\n \n pub enum AnalyzerStatus {}\n@@ -568,10 +568,7 @@ pub struct CompletionResolveData {\n }\n \n #[derive(Debug, Serialize, Deserialize)]\n-pub struct InlayHintResolveData {\n-    pub text_document: VersionedTextDocumentIdentifier,\n-    pub position: PositionOrRange,\n-}\n+pub struct InlayHintResolveData {}\n \n #[derive(Debug, Serialize, Deserialize)]\n pub struct CompletionImport {"}, {"sha": "0f0642bb4b5686816f872cf3f5cbcb64b6313c3f", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 103, "deletions": 100, "changes": 203, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -9,9 +9,9 @@ use ide::{\n     Annotation, AnnotationKind, Assist, AssistKind, Cancellable, CompletionItem,\n     CompletionItemKind, CompletionRelevance, Documentation, FileId, FileRange, FileSystemEdit,\n     Fold, FoldKind, Highlight, HlMod, HlOperator, HlPunct, HlRange, HlTag, Indel, InlayHint,\n-    InlayHintLabel, InlayKind, Markup, NavigationTarget, ReferenceCategory, RenameError, Runnable,\n-    Severity, SignatureHelp, SourceChange, StructureNodeKind, SymbolKind, TextEdit, TextRange,\n-    TextSize,\n+    InlayHintLabel, InlayHintLabelPart, InlayKind, Markup, NavigationTarget, ReferenceCategory,\n+    RenameError, Runnable, Severity, SignatureHelp, SourceChange, StructureNodeKind, SymbolKind,\n+    TextEdit, TextRange, TextSize,\n };\n use itertools::Itertools;\n use serde_json::to_value;\n@@ -431,137 +431,140 @@ pub(crate) fn inlay_hint(\n     mut inlay_hint: InlayHint,\n ) -> Cancellable<lsp_types::InlayHint> {\n     match inlay_hint.kind {\n-        InlayKind::ParameterHint if render_colons => inlay_hint.label.append_str(\":\"),\n-        InlayKind::TypeHint if render_colons => inlay_hint.label.prepend_str(\": \"),\n-        InlayKind::ClosureReturnTypeHint => inlay_hint.label.prepend_str(\" -> \"),\n-        InlayKind::DiscriminantHint => inlay_hint.label.prepend_str(\" = \"),\n+        InlayKind::Parameter if render_colons => inlay_hint.label.append_str(\":\"),\n+        InlayKind::Type if render_colons => inlay_hint.label.prepend_str(\": \"),\n+        InlayKind::ClosureReturnType => inlay_hint.label.prepend_str(\" -> \"),\n+        InlayKind::Discriminant => inlay_hint.label.prepend_str(\" = \"),\n         _ => {}\n     }\n \n+    let (label, tooltip) = inlay_hint_label(snap, inlay_hint.label)?;\n+\n     Ok(lsp_types::InlayHint {\n         position: match inlay_hint.kind {\n             // before annotated thing\n             InlayKind::OpeningParenthesis\n-            | InlayKind::ParameterHint\n-            | InlayKind::AdjustmentHint\n-            | InlayKind::BindingModeHint => position(line_index, inlay_hint.range.start()),\n+            | InlayKind::Parameter\n+            | InlayKind::Adjustment\n+            | InlayKind::BindingMode => position(line_index, inlay_hint.range.start()),\n             // after annotated thing\n-            InlayKind::ClosureReturnTypeHint\n-            | InlayKind::TypeHint\n-            | InlayKind::DiscriminantHint\n-            | InlayKind::ChainingHint\n-            | InlayKind::GenericParamListHint\n+            InlayKind::ClosureReturnType\n+            | InlayKind::Type\n+            | InlayKind::Discriminant\n+            | InlayKind::Chaining\n+            | InlayKind::GenericParamList\n             | InlayKind::ClosingParenthesis\n-            | InlayKind::AdjustmentHintPostfix\n-            | InlayKind::LifetimeHint\n-            | InlayKind::ClosingBraceHint => position(line_index, inlay_hint.range.end()),\n+            | InlayKind::AdjustmentPostfix\n+            | InlayKind::Lifetime\n+            | InlayKind::ClosingBrace => position(line_index, inlay_hint.range.end()),\n         },\n         padding_left: Some(match inlay_hint.kind {\n-            InlayKind::TypeHint => !render_colons,\n-            InlayKind::ChainingHint | InlayKind::ClosingBraceHint => true,\n+            InlayKind::Type => !render_colons,\n+            InlayKind::Chaining | InlayKind::ClosingBrace => true,\n             InlayKind::ClosingParenthesis\n-            | InlayKind::DiscriminantHint\n+            | InlayKind::Discriminant\n             | InlayKind::OpeningParenthesis\n-            | InlayKind::BindingModeHint\n-            | InlayKind::ClosureReturnTypeHint\n-            | InlayKind::GenericParamListHint\n-            | InlayKind::AdjustmentHint\n-            | InlayKind::AdjustmentHintPostfix\n-            | InlayKind::LifetimeHint\n-            | InlayKind::ParameterHint => false,\n+            | InlayKind::BindingMode\n+            | InlayKind::ClosureReturnType\n+            | InlayKind::GenericParamList\n+            | InlayKind::Adjustment\n+            | InlayKind::AdjustmentPostfix\n+            | InlayKind::Lifetime\n+            | InlayKind::Parameter => false,\n         }),\n         padding_right: Some(match inlay_hint.kind {\n             InlayKind::ClosingParenthesis\n             | InlayKind::OpeningParenthesis\n-            | InlayKind::ChainingHint\n-            | InlayKind::ClosureReturnTypeHint\n-            | InlayKind::GenericParamListHint\n-            | InlayKind::AdjustmentHint\n-            | InlayKind::AdjustmentHintPostfix\n-            | InlayKind::TypeHint\n-            | InlayKind::DiscriminantHint\n-            | InlayKind::ClosingBraceHint => false,\n-            InlayKind::BindingModeHint => inlay_hint.label.as_simple_str() != Some(\"&\"),\n-            InlayKind::ParameterHint | InlayKind::LifetimeHint => true,\n+            | InlayKind::Chaining\n+            | InlayKind::ClosureReturnType\n+            | InlayKind::GenericParamList\n+            | InlayKind::Adjustment\n+            | InlayKind::AdjustmentPostfix\n+            | InlayKind::Type\n+            | InlayKind::Discriminant\n+            | InlayKind::ClosingBrace => false,\n+            InlayKind::BindingMode => {\n+                matches!(&label, lsp_types::InlayHintLabel::String(s) if s != \"&\")\n+            }\n+            InlayKind::Parameter | InlayKind::Lifetime => true,\n         }),\n         kind: match inlay_hint.kind {\n-            InlayKind::ParameterHint => Some(lsp_types::InlayHintKind::PARAMETER),\n-            InlayKind::ClosureReturnTypeHint | InlayKind::TypeHint | InlayKind::ChainingHint => {\n+            InlayKind::Parameter => Some(lsp_types::InlayHintKind::PARAMETER),\n+            InlayKind::ClosureReturnType | InlayKind::Type | InlayKind::Chaining => {\n                 Some(lsp_types::InlayHintKind::TYPE)\n             }\n             InlayKind::ClosingParenthesis\n-            | InlayKind::DiscriminantHint\n+            | InlayKind::Discriminant\n             | InlayKind::OpeningParenthesis\n-            | InlayKind::BindingModeHint\n-            | InlayKind::GenericParamListHint\n-            | InlayKind::LifetimeHint\n-            | InlayKind::AdjustmentHint\n-            | InlayKind::AdjustmentHintPostfix\n-            | InlayKind::ClosingBraceHint => None,\n+            | InlayKind::BindingMode\n+            | InlayKind::GenericParamList\n+            | InlayKind::Lifetime\n+            | InlayKind::Adjustment\n+            | InlayKind::AdjustmentPostfix\n+            | InlayKind::ClosingBrace => None,\n         },\n         text_edits: None,\n-        data: (|| match inlay_hint.tooltip {\n-            Some(ide::InlayTooltip::HoverOffset(file_id, offset)) => {\n-                let uri = url(snap, file_id);\n-                let line_index = snap.file_line_index(file_id).ok()?;\n-\n-                let text_document = lsp_types::VersionedTextDocumentIdentifier {\n-                    version: snap.url_file_version(&uri)?,\n-                    uri,\n-                };\n-                to_value(lsp_ext::InlayHintResolveData {\n-                    text_document,\n-                    position: lsp_ext::PositionOrRange::Position(position(&line_index, offset)),\n-                })\n-                .ok()\n-            }\n-            Some(ide::InlayTooltip::HoverRanged(file_id, text_range)) => {\n-                let uri = url(snap, file_id);\n-                let text_document = lsp_types::VersionedTextDocumentIdentifier {\n-                    version: snap.url_file_version(&uri)?,\n-                    uri,\n-                };\n-                let line_index = snap.file_line_index(file_id).ok()?;\n-                to_value(lsp_ext::InlayHintResolveData {\n-                    text_document,\n-                    position: lsp_ext::PositionOrRange::Range(range(&line_index, text_range)),\n-                })\n-                .ok()\n-            }\n-            _ => None,\n-        })(),\n-        tooltip: Some(match inlay_hint.tooltip {\n-            Some(ide::InlayTooltip::String(s)) => lsp_types::InlayHintTooltip::String(s),\n-            _ => lsp_types::InlayHintTooltip::String(inlay_hint.label.to_string()),\n-        }),\n-        label: inlay_hint_label(snap, inlay_hint.label)?,\n+        data: None,\n+        tooltip,\n+        label,\n     })\n }\n \n fn inlay_hint_label(\n     snap: &GlobalStateSnapshot,\n-    label: InlayHintLabel,\n-) -> Cancellable<lsp_types::InlayHintLabel> {\n-    Ok(match label.as_simple_str() {\n-        Some(s) => lsp_types::InlayHintLabel::String(s.into()),\n-        None => lsp_types::InlayHintLabel::LabelParts(\n-            label\n+    mut label: InlayHintLabel,\n+) -> Cancellable<(lsp_types::InlayHintLabel, Option<lsp_types::InlayHintTooltip>)> {\n+    let res = match &*label.parts {\n+        [InlayHintLabelPart { linked_location: None, .. }] => {\n+            let InlayHintLabelPart { text, tooltip, .. } = label.parts.pop().unwrap();\n+            (\n+                lsp_types::InlayHintLabel::String(text),\n+                match tooltip {\n+                    Some(ide::InlayTooltip::String(s)) => {\n+                        Some(lsp_types::InlayHintTooltip::String(s))\n+                    }\n+                    Some(ide::InlayTooltip::Markdown(s)) => {\n+                        Some(lsp_types::InlayHintTooltip::MarkupContent(lsp_types::MarkupContent {\n+                            kind: lsp_types::MarkupKind::Markdown,\n+                            value: s,\n+                        }))\n+                    }\n+                    None => None,\n+                },\n+            )\n+        }\n+        _ => {\n+            let parts = label\n                 .parts\n                 .into_iter()\n                 .map(|part| {\n-                    Ok(lsp_types::InlayHintLabelPart {\n-                        value: part.text,\n-                        tooltip: None,\n-                        location: part\n-                            .linked_location\n-                            .map(|range| location(snap, range))\n-                            .transpose()?,\n-                        command: None,\n-                    })\n+                    part.linked_location.map(|range| location(snap, range)).transpose().map(\n+                        |location| lsp_types::InlayHintLabelPart {\n+                            value: part.text,\n+                            tooltip: match part.tooltip {\n+                                Some(ide::InlayTooltip::String(s)) => {\n+                                    Some(lsp_types::InlayHintLabelPartTooltip::String(s))\n+                                }\n+                                Some(ide::InlayTooltip::Markdown(s)) => {\n+                                    Some(lsp_types::InlayHintLabelPartTooltip::MarkupContent(\n+                                        lsp_types::MarkupContent {\n+                                            kind: lsp_types::MarkupKind::Markdown,\n+                                            value: s,\n+                                        },\n+                                    ))\n+                                }\n+                                None => None,\n+                            },\n+                            location,\n+                            command: None,\n+                        },\n+                    )\n                 })\n-                .collect::<Cancellable<Vec<_>>>()?,\n-        ),\n-    })\n+                .collect::<Cancellable<_>>()?;\n+            (lsp_types::InlayHintLabel::LabelParts(parts), None)\n+        }\n+    };\n+    Ok(res)\n }\n \n static TOKEN_RESULT_COUNTER: AtomicU32 = AtomicU32::new(1);"}, {"sha": "0f24ddbbc00e2377306cfa9a890ade13d6eed9be", "filename": "docs/dev/lsp-extensions.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce6955c10e579f936dee9905dff223d816061299/docs%2Fdev%2Flsp-extensions.md", "raw_url": "https://github.com/rust-lang/rust/raw/ce6955c10e579f936dee9905dff223d816061299/docs%2Fdev%2Flsp-extensions.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Flsp-extensions.md?ref=ce6955c10e579f936dee9905dff223d816061299", "patch": "@@ -1,5 +1,5 @@\n <!---\n-lsp_ext.rs hash: 45bd7985265725c5\n+lsp_ext.rs hash: d296ce1226e3568d\n \n If you need to change the above hash to make the test pass, please check if you\n need to adjust this doc as well and ping this issue:"}]}