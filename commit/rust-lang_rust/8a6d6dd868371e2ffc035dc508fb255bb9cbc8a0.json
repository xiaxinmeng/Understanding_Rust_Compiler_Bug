{"sha": "8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhNmQ2ZGQ4NjgzNzFlMmZmYzAzNWRjNTA4ZmIyNTViYjljYmM4YTA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-18T21:10:13Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-18T21:14:17Z"}, "message": "rustc: Fix struct returns on x86 mac for 8-byte structs\n\nMac appears to follow the same ABI as MSVC. This fixes one case\nbut leaves others broken, like windows.", "tree": {"sha": "ee4eea7f7415001a271afc2cb67b87d9d793006c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee4eea7f7415001a271afc2cb67b87d9d793006c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "html_url": "https://github.com/rust-lang/rust/commit/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b329f2fa82185c9e7c6bbbdf26270dd839618e9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b329f2fa82185c9e7c6bbbdf26270dd839618e9c", "html_url": "https://github.com/rust-lang/rust/commit/b329f2fa82185c9e7c6bbbdf26270dd839618e9c"}], "stats": {"total": 14, "additions": 5, "deletions": 9}, "files": [{"sha": "08b8c3db3cabfc312e1f0961910f9f25b18793fc", "filename": "src/librustc/middle/trans/cabi_x86.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcabi_x86.rs?ref=8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use driver::session::os_win32;\n+use driver::session::{os_win32, os_macos};\n use core::option::*;\n use lib::llvm::*;\n use lib::llvm::llvm::*;\n@@ -38,12 +38,12 @@ impl ABIInfo for X86_ABIInfo {\n \n         // Rules for returning structs taken from\n         // http://www.angelcode.com/dev/callconv/callconv.html\n+        // Clang's ABI handling is in lib/CodeGen/TargetInfo.cpp\n         let sret = {\n             let returning_a_struct = unsafe { LLVMGetTypeKind(rty) == Struct && ret_def };\n-            let big_struct = if self.ccx.sess.targ_cfg.os != os_win32 {\n-                true\n-            } else {\n-                llsize_of_alloc(self.ccx, rty) > 8\n+            let big_struct = match self.ccx.sess.targ_cfg.os {\n+                os_win32 | os_macos => llsize_of_alloc(self.ccx, rty) > 8,\n+                _ => true\n             };\n             returning_a_struct && big_struct\n         };"}, {"sha": "16d14a96cfe4f64cd2089b83f549ead34c7a1d63", "filename": "src/test/run-pass/extern-pass-TwoU32s.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-pass-TwoU32s.rs?ref=8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "patch": "@@ -11,8 +11,6 @@\n // Test a foreign function that accepts and returns a struct\n // by value.\n \n-// xfail-macos Broken on mac i686\n-\n #[deriving(Eq)]\n struct TwoU32s {\n     one: u32, two: u32"}, {"sha": "9e374687855b0aea2c6fbad15b4ab94df15ec07e", "filename": "src/test/run-pass/extern-return-TwoU32s.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-return-TwoU32s.rs?ref=8a6d6dd868371e2ffc035dc508fb255bb9cbc8a0", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// xfail-macos Broken on mac i686\n-\n struct TwoU32s {\n     one: u32, two: u32\n }"}]}