{"sha": "ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "node_id": "C_kwDOAAsO6NoAKGFjM2Q4Y2UxYzZjNWE0MGRmZTEyMDNlOTg3M2FjZTIxOWE2ZTIwY2Y", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-03-29T02:27:59Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-03-29T23:42:47Z"}, "message": "Clarify comments about doc comments in macros.", "tree": {"sha": "013bc8c4ffef0303208f5197d3926b05c9924d2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/013bc8c4ffef0303208f5197d3926b05c9924d2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "html_url": "https://github.com/rust-lang/rust/commit/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b60cc081b31c48a5d9037ba559b6be32974a14f", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b60cc081b31c48a5d9037ba559b6be32974a14f", "html_url": "https://github.com/rust-lang/rust/commit/2b60cc081b31c48a5d9037ba559b6be32974a14f"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "c65b96d436511fe266a537a67a8f84af22c6b066", "filename": "compiler/rustc_expand/src/mbe/macro_parser.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs?ref=ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "patch": "@@ -517,7 +517,12 @@ impl<'tt> TtParser<'tt> {\n \n                     TokenTree::Token(t) => {\n                         // If it's a doc comment, we just ignore it and move on to the next tt in\n-                        // the matcher. If the token matches, we can just advance the parser.\n+                        // the matcher. This is a bug, but #95267 showed that existing programs\n+                        // rely on this behaviour, and changing it would require some care and a\n+                        // transition period.\n+                        //\n+                        // If the token matches, we can just advance the parser.\n+                        //\n                         // Otherwise, this match has failed, there is nothing to do, and hopefully\n                         // another item in `cur_items` will match.\n                         if matches!(t, Token { kind: DocComment(..), .. }) {"}, {"sha": "a2fe402bccf8ff325b6dd0907652bb044321b618", "filename": "src/test/ui/macros/issue-95267.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf/src%2Ftest%2Fui%2Fmacros%2Fissue-95267.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf/src%2Ftest%2Fui%2Fmacros%2Fissue-95267.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fissue-95267.rs?ref=ac3d8ce1c6c5a40dfe1203e9873ace219a6e20cf", "patch": "@@ -1,7 +1,8 @@\n // check-pass\n \n-// This is a valid macro. Commit 4 in #95159 broke things such that it failed\n-// with a \"missing tokens in macro arguments\" error, as reported in #95267.\n+// The doc comment here is ignored. This is a bug, but #95267 showed that\n+// existing programs rely on this behaviour, and changing it would require some\n+// care and a transition period.\n macro_rules! f {\n     (\n         /// ab"}]}