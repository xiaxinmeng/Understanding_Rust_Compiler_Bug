{"sha": "fde8d11ca12e83fe2b07a536956f4a2725b24485", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkZThkMTFjYTEyZTgzZmUyYjA3YTUzNjk1NmY0YTI3MjViMjQ0ODU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2020-06-17T22:08:37Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2020-06-26T16:23:00Z"}, "message": "Don't pollute docs/suggestions with libstd deps\n\nCurrently dependency crates of the standard library can sometimes leak\ninto error messages such as when traits to import are suggested.\nAdditionally they can leak into documentation such as in the list of\n\"all traits implemented by `u32`\". The dependencies of the standard\nlibrary, however, are intended to be private.\n\nThe dependencies of the standard library can't actually be stabl-y\nimported nor is the documentation that relevant since you can't import\nthem on stable either. This commit updates both the compiler and rustdoc\nto ignore unstable traits in these two scenarios.\n\nSpecifically the suggestion for traits to import ignore unstable traits,\nand similarly the list of traits implemented by a type excludes unstable\ntraits.\n\nThis commit is extracted from #73441 where the addition of some new\ndependencies to the standard library was showed to leak into various\nerror messages and documentation. The intention here is to go ahead and\nland these changes ahead of that since it will likely take some time to\nland.", "tree": {"sha": "5c0ec4f365edcf77dbfbd1e1105a16f400aa851f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c0ec4f365edcf77dbfbd1e1105a16f400aa851f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fde8d11ca12e83fe2b07a536956f4a2725b24485", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fde8d11ca12e83fe2b07a536956f4a2725b24485", "html_url": "https://github.com/rust-lang/rust/commit/fde8d11ca12e83fe2b07a536956f4a2725b24485", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fde8d11ca12e83fe2b07a536956f4a2725b24485/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9672b5e95c520774cc17bffc7031c80a1bcf4b4c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9672b5e95c520774cc17bffc7031c80a1bcf4b4c", "html_url": "https://github.com/rust-lang/rust/commit/9672b5e95c520774cc17bffc7031c80a1bcf4b4c"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "9c4873bccb299397c0f400b4a33ebb3543d0b1fd", "filename": "src/librustc_typeck/check/method/suggest.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fde8d11ca12e83fe2b07a536956f4a2725b24485/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fde8d11ca12e83fe2b07a536956f4a2725b24485/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs?ref=fde8d11ca12e83fe2b07a536956f4a2725b24485", "patch": "@@ -937,6 +937,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         // legal to implement.\n         let mut candidates = all_traits(self.tcx)\n             .into_iter()\n+            // Don't issue suggestions for unstable traits since they're\n+            // unlikely to be implementable anyway\n+            .filter(|info| match self.tcx.lookup_stability(info.def_id) {\n+                Some(attr) => attr.level.is_stable(),\n+                None => true,\n+            })\n             .filter(|info| {\n                 // We approximate the coherence rules to only suggest\n                 // traits that are legal to implement by requiring that"}, {"sha": "ee1c17bad9f938862eaf0ca5faa33fb4712d4eb7", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fde8d11ca12e83fe2b07a536956f4a2725b24485/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fde8d11ca12e83fe2b07a536956f4a2725b24485/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=fde8d11ca12e83fe2b07a536956f4a2725b24485", "patch": "@@ -339,6 +339,16 @@ pub fn build_impl(\n                 return;\n             }\n         }\n+\n+        // Skip foreign unstable traits from lists of trait implementations and\n+        // such. This helps prevent dependencies of the standard library, for\n+        // example, from getting documented as \"traits `u32` implements\" which\n+        // isn't really too helpful.\n+        if let Some(stab) = cx.tcx.lookup_stability(did) {\n+            if stab.level.is_unstable() {\n+                return;\n+            }\n+        }\n     }\n \n     let for_ = if let Some(did) = did.as_local() {"}]}