{"sha": "d76afa705b808824400e79649414a35a3d79dfb4", "node_id": "C_kwDOAAsO6NoAKGQ3NmFmYTcwNWI4MDg4MjQ0MDBlNzk2NDk0MTRhMzVhM2Q3OWRmYjQ", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-10-02T12:42:18Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-10-02T12:42:18Z"}, "message": "Sync from rust a8387aef8c378a771686878062e544af4d5e2245", "tree": {"sha": "34c43e61fa17f4964078c4f35691764fdad14dd9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/34c43e61fa17f4964078c4f35691764fdad14dd9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d76afa705b808824400e79649414a35a3d79dfb4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d76afa705b808824400e79649414a35a3d79dfb4", "html_url": "https://github.com/rust-lang/rust/commit/d76afa705b808824400e79649414a35a3d79dfb4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d76afa705b808824400e79649414a35a3d79dfb4/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eded3690869bad32185607000a0d3996e81d2073", "url": "https://api.github.com/repos/rust-lang/rust/commits/eded3690869bad32185607000a0d3996e81d2073", "html_url": "https://github.com/rust-lang/rust/commit/eded3690869bad32185607000a0d3996e81d2073"}, {"sha": "881208f2681dde99e17d6d2facd53d033f36b2fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/881208f2681dde99e17d6d2facd53d033f36b2fd", "html_url": "https://github.com/rust-lang/rust/commit/881208f2681dde99e17d6d2facd53d033f36b2fd"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "a0e99267c2b705771b9c9cfee2e11a41c12a5cf1", "filename": "scripts/filter_profile.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d76afa705b808824400e79649414a35a3d79dfb4/scripts%2Ffilter_profile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76afa705b808824400e79649414a35a3d79dfb4/scripts%2Ffilter_profile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Ffilter_profile.rs?ref=d76afa705b808824400e79649414a35a3d79dfb4", "patch": "@@ -96,7 +96,7 @@ fn main() -> Result<(), Box<dyn std::error::Error>> {\n             stack = &stack[..index + REPORT_SYMBOL_NAMES.len()];\n         }\n \n-        const ENCODE_METADATA: &str = \"rustc_middle::ty::context::TyCtxt::encode_metadata\";\n+        const ENCODE_METADATA: &str = \"rustc_metadata::rmeta::encoder::encode_metadata\";\n         if let Some(index) = stack.find(ENCODE_METADATA) {\n             stack = &stack[..index + ENCODE_METADATA.len()];\n         }"}, {"sha": "32cc50eebe4364ad8c6707757c63e87501304196", "filename": "src/driver/aot.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d76afa705b808824400e79649414a35a3d79dfb4/src%2Fdriver%2Faot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76afa705b808824400e79649414a35a3d79dfb4/src%2Fdriver%2Faot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Faot.rs?ref=d76afa705b808824400e79649414a35a3d79dfb4", "patch": "@@ -6,8 +6,8 @@ use std::path::PathBuf;\n use rustc_ast::{InlineAsmOptions, InlineAsmTemplatePiece};\n use rustc_codegen_ssa::{CodegenResults, CompiledModule, CrateInfo, ModuleKind};\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n+use rustc_metadata::EncodedMetadata;\n use rustc_middle::dep_graph::{WorkProduct, WorkProductId};\n-use rustc_middle::middle::cstore::EncodedMetadata;\n use rustc_middle::mir::mono::{CodegenUnit, MonoItem};\n use rustc_session::cgu_reuse_tracker::CguReuse;\n use rustc_session::config::{DebugInfo, OutputType};"}, {"sha": "64328a44950b5a6789222f4959f02574abd84038", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d76afa705b808824400e79649414a35a3d79dfb4/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76afa705b808824400e79649414a35a3d79dfb4/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=d76afa705b808824400e79649414a35a3d79dfb4", "patch": "@@ -30,8 +30,8 @@ use std::any::Any;\n use rustc_codegen_ssa::traits::CodegenBackend;\n use rustc_codegen_ssa::CodegenResults;\n use rustc_errors::ErrorReported;\n+use rustc_metadata::EncodedMetadata;\n use rustc_middle::dep_graph::{WorkProduct, WorkProductId};\n-use rustc_middle::middle::cstore::EncodedMetadata;\n use rustc_session::config::OutputFilenames;\n use rustc_session::Session;\n "}, {"sha": "1c8fd0b01d9d94ed346e67bf5ae734bb9d12b50b", "filename": "src/metadata.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d76afa705b808824400e79649414a35a3d79dfb4/src%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d76afa705b808824400e79649414a35a3d79dfb4/src%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmetadata.rs?ref=d76afa705b808824400e79649414a35a3d79dfb4", "patch": "@@ -3,16 +3,20 @@\n use object::write::{Object, StandardSegment, Symbol, SymbolSection};\n use object::{SectionKind, SymbolFlags, SymbolKind, SymbolScope};\n \n-use rustc_middle::middle::cstore::EncodedMetadata;\n+use rustc_metadata::EncodedMetadata;\n use rustc_middle::ty::TyCtxt;\n \n // Adapted from https://github.com/rust-lang/rust/blob/da573206f87b5510de4b0ee1a9c044127e409bd3/src/librustc_codegen_llvm/base.rs#L47-L112\n-pub(crate) fn new_metadata_object(tcx: TyCtxt<'_>, cgu_name: &str, metadata: &EncodedMetadata) -> Vec<u8> {\n+pub(crate) fn new_metadata_object(\n+    tcx: TyCtxt<'_>,\n+    cgu_name: &str,\n+    metadata: &EncodedMetadata,\n+) -> Vec<u8> {\n     use snap::write::FrameEncoder;\n     use std::io::Write;\n \n     let mut compressed = rustc_metadata::METADATA_HEADER.to_vec();\n-    FrameEncoder::new(&mut compressed).write_all(&metadata.raw_data).unwrap();\n+    FrameEncoder::new(&mut compressed).write_all(metadata.raw_data()).unwrap();\n \n     let triple = crate::target_triple(tcx.sess);\n "}]}