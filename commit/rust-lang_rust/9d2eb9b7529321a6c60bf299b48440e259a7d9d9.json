{"sha": "9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkMmViOWI3NTI5MzIxYTZjNjBiZjI5OWI0ODQ0MGUyNTlhN2Q5ZDk=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-19T03:03:33Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-19T08:47:48Z"}, "message": "Rollup merge of #55166 - varkor:ret-parens, r=davidtwco\n\nDon't warn about parentheses on `match (return)`\n\nFixes #55164.", "tree": {"sha": "b45bc3374cee027ec3462119366a1b4df8821295", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b45bc3374cee027ec3462119366a1b4df8821295"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlvJmjQACgkQ/vbIBR0O\nATx2kQ//cBzjWtvH54LSRM+2NzymrtJKYsipxiM9FQJGfCpGnpFvbH3YiWcSkgHh\npV58CGlmfERyzarBr9YAzFFVFJNCuuWgWPQ03GnPAeicI9OtIlGaJ7B3yTzXIOw+\nAO9EIf56kktpQViCGPV6O/rSnADVTtrr69dCL6d304X1jw30TVvyNCy6PqIwXZcF\nZdKevSJpyMfk6If2p0HuCMVjyK4BYpbfPB1OF5PNI4mzwr7tgbegvreHWJNeIkn8\nL2rWhY94/zEumPzOPY9DHnsUnYU5udU2BT6BECC0cNLWqwUfYDBELsc1Ws75hg96\nonhiHTkoDKJuPz9nPdIgA1UPDBEVl7M9LM2kh+yEaaIFmGfeJpVBB5MAOBU29bs/\nAzeibO3fYVSK1XoAlRAfqrWjbmq++4C19fmc6KRTgAQdit4Arq3nY2uM+v5OciOb\nmUD+tM/Aed670My2Rp0QZ3vrC+1PwHplMzuGs39nDYY99vY198khw1W5I29vvAJZ\nzBXS5u4brBYJ9X92Joc4x8PQGTXoOPj+O3n/CcMz9pUod15RLXaMAPS50nXmUyH7\n2AQj8wwl4p25wOCj+gsHKqH7bIE0QoVZx3W83hcoBiTLxfTUGUxv6KLcYfAe0yZA\ntZZgtytVEeiL4Vpw6AEaJak9TXW77Rq5GcaiEwmqjN+Ut5h8MiU=\n=/QnT\n-----END PGP SIGNATURE-----", "payload": "tree b45bc3374cee027ec3462119366a1b4df8821295\nparent 8d712aa1d82c44f02a8e7cc86835e2bfc95900f8\nparent 40bba70823466eb1458a4fd99a4f644411b4eae4\nauthor kennytm <kennytm@gmail.com> 1539918213 +0800\ncommitter kennytm <kennytm@gmail.com> 1539938868 +0800\n\nRollup merge of #55166 - varkor:ret-parens, r=davidtwco\n\nDon't warn about parentheses on `match (return)`\n\nFixes #55164.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "html_url": "https://github.com/rust-lang/rust/commit/9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d2eb9b7529321a6c60bf299b48440e259a7d9d9/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d712aa1d82c44f02a8e7cc86835e2bfc95900f8", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d712aa1d82c44f02a8e7cc86835e2bfc95900f8", "html_url": "https://github.com/rust-lang/rust/commit/8d712aa1d82c44f02a8e7cc86835e2bfc95900f8"}, {"sha": "40bba70823466eb1458a4fd99a4f644411b4eae4", "url": "https://api.github.com/repos/rust-lang/rust/commits/40bba70823466eb1458a4fd99a4f644411b4eae4", "html_url": "https://github.com/rust-lang/rust/commit/40bba70823466eb1458a4fd99a4f644411b4eae4"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "4cf2072e792ca3ee6a50420f4df9c27177f71f67", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9d2eb9b7529321a6c60bf299b48440e259a7d9d9/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d2eb9b7529321a6c60bf299b48440e259a7d9d9/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "patch": "@@ -276,10 +276,13 @@ impl UnusedParens {\n                                 cx: &EarlyContext,\n                                 value: &ast::Expr,\n                                 msg: &str,\n-                                struct_lit_needs_parens: bool) {\n+                                followed_by_block: bool) {\n         if let ast::ExprKind::Paren(ref inner) = value.node {\n-            let necessary = struct_lit_needs_parens &&\n-                            parser::contains_exterior_struct_lit(&inner);\n+            let necessary = followed_by_block && if let ast::ExprKind::Ret(_) = inner.node {\n+                true\n+            } else {\n+                parser::contains_exterior_struct_lit(&inner)\n+            };\n             if !necessary {\n                 let pattern = pprust::expr_to_string(value);\n                 Self::remove_outer_parens(cx, value.span, &pattern, msg);\n@@ -343,7 +346,7 @@ impl LintPass for UnusedParens {\n impl EarlyLintPass for UnusedParens {\n     fn check_expr(&mut self, cx: &EarlyContext, e: &ast::Expr) {\n         use syntax::ast::ExprKind::*;\n-        let (value, msg, struct_lit_needs_parens) = match e.node {\n+        let (value, msg, followed_by_block) = match e.node {\n             If(ref cond, ..) => (cond, \"`if` condition\", true),\n             While(ref cond, ..) => (cond, \"`while` condition\", true),\n             IfLet(_, ref cond, ..) => (cond, \"`if let` head expression\", true),\n@@ -380,7 +383,7 @@ impl EarlyLintPass for UnusedParens {\n                 return;\n             }\n         };\n-        self.check_unused_parens_expr(cx, &value, msg, struct_lit_needs_parens);\n+        self.check_unused_parens_expr(cx, &value, msg, followed_by_block);\n     }\n \n     fn check_pat(&mut self, cx: &EarlyContext, p: &ast::Pat) {"}, {"sha": "37dc519a20401bb7a900f461cbc8a722ae3ba3d8", "filename": "src/test/ui/lint/no-unused-parens-return-block.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9d2eb9b7529321a6c60bf299b48440e259a7d9d9/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d2eb9b7529321a6c60bf299b48440e259a7d9d9/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fno-unused-parens-return-block.rs?ref=9d2eb9b7529321a6c60bf299b48440e259a7d9d9", "patch": "@@ -0,0 +1,9 @@\n+// run-pass\n+\n+#![deny(unused_parens)]\n+#![allow(unreachable_code)]\n+\n+fn main() {\n+    match (return) {} // ok\n+    if (return) {} // ok\n+}"}]}