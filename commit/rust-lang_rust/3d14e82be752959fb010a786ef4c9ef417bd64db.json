{"sha": "3d14e82be752959fb010a786ef4c9ef417bd64db", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkMTRlODJiZTc1Mjk1OWZiMDEwYTc4NmVmNGM5ZWY0MTdiZDY0ZGI=", "commit": {"author": {"name": "Jakub", "email": "jakub@jakub.cc", "date": "2013-09-08T22:59:51Z"}, "committer": {"name": "Jakub", "email": "jakub@jakub.cc", "date": "2013-09-12T23:31:45Z"}, "message": "Fix rustpkg install for git repositories", "tree": {"sha": "a95635d2f523df5316e14a99c12a80a84efe95ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a95635d2f523df5316e14a99c12a80a84efe95ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d14e82be752959fb010a786ef4c9ef417bd64db", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d14e82be752959fb010a786ef4c9ef417bd64db", "html_url": "https://github.com/rust-lang/rust/commit/3d14e82be752959fb010a786ef4c9ef417bd64db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d14e82be752959fb010a786ef4c9ef417bd64db/comments", "author": null, "committer": null, "parents": [{"sha": "248765a746237e7292d30dce072799e076e4f9cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/248765a746237e7292d30dce072799e076e4f9cf", "html_url": "https://github.com/rust-lang/rust/commit/248765a746237e7292d30dce072799e076e4f9cf"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "bba9d073b7d80e344d62b90a7785b3c20fde93cd", "filename": "src/librustpkg/package_source.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3d14e82be752959fb010a786ef4c9ef417bd64db/src%2Flibrustpkg%2Fpackage_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d14e82be752959fb010a786ef4c9ef417bd64db/src%2Flibrustpkg%2Fpackage_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpackage_source.rs?ref=3d14e82be752959fb010a786ef4c9ef417bd64db", "patch": "@@ -18,7 +18,7 @@ use context::*;\n use crate::Crate;\n use messages::*;\n use source_control::{git_clone, git_clone_general};\n-use path_util::{find_dir_using_rust_path_hack, default_workspace};\n+use path_util::{find_dir_using_rust_path_hack, default_workspace, make_dir_rwx_recursive};\n use util::compile_crate;\n use workspace::is_workspace;\n use workcache_support;\n@@ -166,12 +166,14 @@ impl PkgSrc {\n                   url, clone_target.to_str(), pkgid.version.to_str());\n \n         if git_clone_general(url, &clone_target, &pkgid.version) {\n-            // since the operation succeeded, move clone_target to local\n-            if !os::rename_file(&clone_target, local) {\n-                 None\n+            // Since the operation succeeded, move clone_target to local.\n+            // First, create all ancestor directories.\n+            if make_dir_rwx_recursive(&local.pop())\n+                && os::rename_file(&clone_target, local) {\n+                 Some(local.clone())\n             }\n             else {\n-                 Some(local.clone())\n+                 None\n             }\n         }\n         else {"}, {"sha": "3cfa793e898be6e805502eee18c5c916fc098a24", "filename": "src/librustpkg/path_util.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d14e82be752959fb010a786ef4c9ef417bd64db/src%2Flibrustpkg%2Fpath_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d14e82be752959fb010a786ef4c9ef417bd64db/src%2Flibrustpkg%2Fpath_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fpath_util.rs?ref=3d14e82be752959fb010a786ef4c9ef417bd64db", "patch": "@@ -43,6 +43,8 @@ pub static U_RWX: i32 = (S_IRUSR | S_IWUSR | S_IXUSR) as i32;\n /// succeeded.\n pub fn make_dir_rwx(p: &Path) -> bool { os::make_dir(p, U_RWX) }\n \n+pub fn make_dir_rwx_recursive(p: &Path) -> bool { os::mkdir_recursive(p, U_RWX) }\n+\n // n.b. The next three functions ignore the package version right\n // now. Should fix that.\n "}]}