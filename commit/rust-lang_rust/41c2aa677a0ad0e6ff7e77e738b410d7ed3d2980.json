{"sha": "41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxYzJhYTY3N2EwYWQwZTZmZjdlNzdlNzM4YjQxMGQ3ZWQzZDI5ODA=", "commit": {"author": {"name": "David Renshaw", "email": "david@sandstorm.io", "date": "2017-03-14T00:47:08Z"}, "committer": {"name": "David Renshaw", "email": "david@sandstorm.io", "date": "2017-03-14T00:47:08Z"}, "message": "simplify write_bytes() by using memory.write_repeat()", "tree": {"sha": "fd643cf496dfcb4373650f85c1c704c180ee0154", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd643cf496dfcb4373650f85c1c704c180ee0154"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980", "html_url": "https://github.com/rust-lang/rust/commit/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980/comments", "author": null, "committer": null, "parents": [{"sha": "4cae50cccbd5b9cf349baaa93178edb8b2ff3b1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4cae50cccbd5b9cf349baaa93178edb8b2ff3b1d", "html_url": "https://github.com/rust-lang/rust/commit/4cae50cccbd5b9cf349baaa93178edb8b2ff3b1d"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "51404e7d13198780dee2eeef996b99891d5d72f8", "filename": "src/terminator/intrinsic.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980/src%2Fterminator%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980/src%2Fterminator%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fterminator%2Fintrinsic.rs?ref=41c2aa677a0ad0e6ff7e77e738b410d7ed3d2980", "patch": "@@ -405,13 +405,13 @@ impl<'a, 'tcx> EvalContext<'a, 'tcx> {\n             \"write_bytes\" => {\n                 let u8 = self.tcx.types.u8;\n                 let ty = substs.type_at(0);\n+                let ty_align = self.type_align(ty)?;\n+                let val_byte = self.value_to_primval(arg_vals[1], u8)?.to_u128()? as u8;\n                 let size = self.type_size(ty)?.expect(\"write_bytes() type must be sized\");\n-                let mut ptr = arg_vals[0].read_ptr(&self.memory)?;\n+                let ptr = arg_vals[0].read_ptr(&self.memory)?;\n                 let count = self.value_to_primval(arg_vals[2], usize)?.to_u64()?;\n-                for _ in 0..(count * size) {\n-                    self.write_value_to_ptr(arg_vals[1], ptr, u8)?;\n-                    ptr = ptr.offset(1);\n-                }\n+                self.memory.check_align(ptr, size * count, ty_align)?;\n+                self.memory.write_repeat(ptr, val_byte, size * count)?;\n             }\n \n             name => return Err(EvalError::Unimplemented(format!(\"unimplemented intrinsic: {}\", name))),"}]}