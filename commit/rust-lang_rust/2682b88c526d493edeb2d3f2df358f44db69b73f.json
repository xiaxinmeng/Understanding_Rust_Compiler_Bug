{"sha": "2682b88c526d493edeb2d3f2df358f44db69b73f", "node_id": "C_kwDOAAsO6NoAKDI2ODJiODhjNTI2ZDQ5M2VkZWIyZDNmMmRmMzU4ZjQ0ZGI2OWI3M2Y", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-11T06:37:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-11T06:37:20Z"}, "message": "Auto merge of #98369 - jyn514:configure.py, r=Mark-Simulacrum\n\nRemove unsupported options in configure.py\n\nI've seen people using `optimize = false` and `full-bootstrap = true` in the past, without knowing\nthat they're not recommended. Remove `optimize` and a few other options that are always a bad idea,\nand document that full-bootstrap is only for testing reproducible builds.", "tree": {"sha": "108cf828c24392caa09bdaa00ecb3c7a91204014", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/108cf828c24392caa09bdaa00ecb3c7a91204014"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2682b88c526d493edeb2d3f2df358f44db69b73f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2682b88c526d493edeb2d3f2df358f44db69b73f", "html_url": "https://github.com/rust-lang/rust/commit/2682b88c526d493edeb2d3f2df358f44db69b73f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2682b88c526d493edeb2d3f2df358f44db69b73f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a51fb2ba827f24ec4d676a9575a0a5e46afd302a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a51fb2ba827f24ec4d676a9575a0a5e46afd302a", "html_url": "https://github.com/rust-lang/rust/commit/a51fb2ba827f24ec4d676a9575a0a5e46afd302a"}, {"sha": "4151a5b96cb4707bb0b09037bacc58ade1940fa2", "url": "https://api.github.com/repos/rust-lang/rust/commits/4151a5b96cb4707bb0b09037bacc58ade1940fa2", "html_url": "https://github.com/rust-lang/rust/commit/4151a5b96cb4707bb0b09037bacc58ade1940fa2"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "85afc1f5f6c68e7fa400509be39edfddf7ad7bab", "filename": "src/bootstrap/CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fbootstrap%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fbootstrap%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCHANGELOG.md?ref=2682b88c526d493edeb2d3f2df358f44db69b73f", "patch": "@@ -12,6 +12,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - The options `infodir`, `localstatedir`, and `gpg-password-file` are no longer allowed in config.toml. Previously, they were ignored without warning. Note that `infodir` and `localstatedir` are still accepted by `./configure`, with a warning. [#82451](https://github.com/rust-lang/rust/pull/82451)\n - Change the names for `dist` commands to match the component they generate. [#90684](https://github.com/rust-lang/rust/pull/90684)\n - The `build.fast-submodules` option has been removed. Fast submodule checkouts are enabled unconditionally. Automatic submodule handling can still be disabled with `build.submodules = false`.\n+- Several unsupported `./configure` options have been removed: `optimize`, `parallel-compiler`. These can still be enabled with `--set`, although it isn't recommended.\n \n ### Non-breaking changes\n "}, {"sha": "6b139decb555193f3990962a6812a217867c281c", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=2682b88c526d493edeb2d3f2df358f44db69b73f", "patch": "@@ -31,11 +31,10 @@ def v(*args):\n     options.append(Option(*args, value=True))\n \n \n-o(\"debug\", \"rust.debug\", \"enables debugging environment; does not affect optimization of bootstrapped code (use `--disable-optimize` for that)\")\n+o(\"debug\", \"rust.debug\", \"enables debugging environment; does not affect optimization of bootstrapped code\")\n o(\"docs\", \"build.docs\", \"build standard library documentation\")\n o(\"compiler-docs\", \"build.compiler-docs\", \"build compiler documentation\")\n o(\"optimize-tests\", \"rust.optimize-tests\", \"build tests with optimizations\")\n-o(\"parallel-compiler\", \"rust.parallel-compiler\", \"build a multi-threaded rustc\")\n o(\"verbose-tests\", \"rust.verbose-tests\", \"enable verbose output when running tests\")\n o(\"ccache\", \"llvm.ccache\", \"invoke gcc/clang via ccache to reuse object files between builds\")\n o(\"sccache\", None, \"invoke gcc/clang via sccache to reuse object files between builds\")\n@@ -70,7 +69,6 @@ def v(*args):\n \n # Optimization and debugging options. These may be overridden by the release\n # channel, etc.\n-o(\"optimize\", \"rust.optimize\", \"build optimized rust code\")\n o(\"optimize-llvm\", \"llvm.optimize\", \"build optimized LLVM\")\n o(\"llvm-assertions\", \"llvm.assertions\", \"build LLVM with assertions\")\n o(\"llvm-plugins\", \"llvm.plugins\", \"build LLVM with plugin interface\")\n@@ -161,7 +159,7 @@ def v(*args):\n # Many of these are saved below during the \"writing configuration\" step\n # (others are conditionally saved).\n o(\"manage-submodules\", \"build.submodules\", \"let the build manage the git submodules\")\n-o(\"full-bootstrap\", \"build.full-bootstrap\", \"build three compilers instead of two\")\n+o(\"full-bootstrap\", \"build.full-bootstrap\", \"build three compilers instead of two (not recommended except for testing reproducible builds)\")\n o(\"extended\", \"build.extended\", \"build an extended rust tool set\")\n \n v(\"tools\", None, \"List of extended tools will be installed\")\n@@ -493,4 +491,3 @@ def configure_section(lines, config):\n \n p(\"\")\n p(\"run `python {}/x.py --help`\".format(rust_dir))\n-p(\"\")"}, {"sha": "13d440423b20b4ba244b2b7cffe321707f28ccf6", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-debug/Dockerfile", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-debug%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-debug%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-debug%2FDockerfile?ref=2682b88c526d493edeb2d3f2df358f44db69b73f", "patch": "@@ -35,7 +35,6 @@ ENV RUST_CONFIGURE_ARGS \\\n       --build=x86_64-unknown-linux-gnu \\\n       --enable-debug \\\n       --enable-lld \\\n-      --enable-optimize \\\n       --set llvm.use-linker=lld \\\n       --set target.x86_64-unknown-linux-gnu.linker=clang \\\n       --set target.x86_64-unknown-linux-gnu.cc=clang \\"}, {"sha": "3e5dc4af04a351ff4609f072c3050605d57f5e97", "filename": "src/ci/docker/scripts/musl.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh?ref=2682b88c526d493edeb2d3f2df358f44db69b73f", "patch": "@@ -33,7 +33,7 @@ if [ ! -d $MUSL ]; then\n fi\n \n cd $MUSL\n-./configure --enable-optimize --enable-debug --disable-shared --prefix=/musl-$TAG \"$@\"\n+./configure --enable-debug --disable-shared --prefix=/musl-$TAG \"$@\"\n if [ \"$TAG\" = \"i586\" -o \"$TAG\" = \"i686\" ]; then\n   hide_output make -j$(nproc) AR=ar RANLIB=ranlib\n else"}, {"sha": "16d8bdb81536775b08784a8aa7608b723c5cdcba", "filename": "src/ci/run.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2682b88c526d493edeb2d3f2df358f44db69b73f/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=2682b88c526d493edeb2d3f2df358f44db69b73f", "patch": "@@ -132,7 +132,7 @@ trap datecheck EXIT\n SCCACHE_IDLE_TIMEOUT=10800 sccache --start-server || true\n \n if [ \"$RUN_CHECK_WITH_PARALLEL_QUERIES\" != \"\" ]; then\n-  $SRC/configure --enable-parallel-compiler\n+  $SRC/configure --set rust.parallel-compiler\n   CARGO_INCREMENTAL=0 $PYTHON ../x.py check\n   rm -f config.toml\n   rm -rf build"}]}