{"sha": "869ddd8d0019683c007956bae17fc07cd30f39f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2OWRkZDhkMDAxOTY4M2MwMDc5NTZiYWUxN2ZjMDdjZDMwZjM5Zjc=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-05-10T08:17:52Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-05-13T08:07:50Z"}, "message": "ci: still use aws for caches", "tree": {"sha": "c72cfd7375a5131040f0f5d3bc657909efb8a25c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c72cfd7375a5131040f0f5d3bc657909efb8a25c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/869ddd8d0019683c007956bae17fc07cd30f39f7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAlzZJdkACgkQPgar6Auq\n8Zw3xg//WvusIjs9LetKlAcdZYx2IIY6b8BDciG+2v3209A8QpauEmg+qOp5up4D\nu7Grxvqwwufzv8O+YvuJCmxO3voMedfVzbGbVSegTdoelJ86pcy6rUMAPrGojzAi\n71FuHT2sJschba6z8UdrMEc7dCKtauLlehhWKIBvFHQVfm2b5bHTO5vJybO1Vxf9\nvyDh0gENrJ0HWGyQhoMq3XXhYD9WUEylQRA9nB/n3vLz0aVR8amc3JWSnJ+458Gf\nLsufrXXsh64R6HXM2j1Dh/iEpnBIOk7hg+9O3BBTdxeHrH8dfNvtQHwRPVaxfLUd\nAYnlQ3sli+5lPb2M6qFXMz07M7qnQZXUBnpGDg1hpiF1ruPc9pbcP9OZN0+hDcRC\nP3ieurDV4Aod3FwvTyOb3URgNsGFCL+oOn5dszEXAOA/dllPA81IPUsDCC2+SkmG\nh2tcHcZtpc6g9zRF9tJRYqcErylBSFoygXq+JLcv1nnBcTUwad4Y7mv6SUZB4AVM\nD1pIx9ubHo4iLfZrNPHkY4E2MjgvgXbCPAdKfV/GHvA6ax8ZLrfS19heCfKyHfm9\nXULxMSk3M6UOCSFQU440JsoY2LsLBWlDkx8Fg0CMfoXTvshsv6+M8s0O2bFCF2bS\n+ZZOlbGefSikZGvx63ifKM3h/JFQHXIT5gAcKCcSKmcnp2w+sJw=\n=sFBQ\n-----END PGP SIGNATURE-----", "payload": "tree c72cfd7375a5131040f0f5d3bc657909efb8a25c\nparent abd4b3a83cdc6b2a8e36a238d096afa9c83d3eb5\nauthor Pietro Albini <pietro@pietroalbini.org> 1557476272 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1557734870 +0200\n\nci: still use aws for caches\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/869ddd8d0019683c007956bae17fc07cd30f39f7", "html_url": "https://github.com/rust-lang/rust/commit/869ddd8d0019683c007956bae17fc07cd30f39f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/869ddd8d0019683c007956bae17fc07cd30f39f7/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "abd4b3a83cdc6b2a8e36a238d096afa9c83d3eb5", "url": "https://api.github.com/repos/rust-lang/rust/commits/abd4b3a83cdc6b2a8e36a238d096afa9c83d3eb5", "html_url": "https://github.com/rust-lang/rust/commit/abd4b3a83cdc6b2a8e36a238d096afa9c83d3eb5"}], "stats": {"total": 57, "additions": 17, "deletions": 40}, "files": [{"sha": "def19a87076d8c79c3817a4c4736c0060bab603d", "filename": ".azure-pipelines/auto.fanout.yml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fauto.fanout.yml", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fauto.fanout.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fauto.fanout.yml?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -160,7 +160,7 @@ jobs:\n \n   - script: |\n       REM md sccache\n-      REM powershell -Command \"iwr -outf sccache\\sccache.exe https://rustlangtools.blob.core.windows.net/public/stable-x86_64-pc-windows-msvc.sccache.exe\"\n+      REM powershell -Command \"iwr -outf sccache\\sccache.exe https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-26-sccache-x86_64-pc-windows-msvc\"\n       echo ##vso[task.prependpath]%CD%\\sccache\n     displayName: Download and install sccache\n \n@@ -392,7 +392,7 @@ jobs:\n       mkdir -p $HOME/rustsrc    \n       echo \"##vso[task.setvariable variable=PATH;]$PATH\"\n \n-      curl -fo /usr/local/bin/sccache https://rustlangtools.blob.core.windows.net/public/stable-x86_64-apple-darwin.sccache\n+      curl -fo /usr/local/bin/sccache https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-apple-darwin\n       chmod +x /usr/local/bin/sccache\n \n       curl -fo /usr/local/bin/stamp https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-03-17-stamp-x86_64-apple-darwin"}, {"sha": "189536cff5f4ac20a09a504e2cd228213766351f", "filename": ".azure-pipelines/auto.yml", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fauto.yml?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -1,11 +1,6 @@\n #\n # Azure Pipelines \"auto\" branch build for Rust on Linux, macOS, and Windows.\n # \n-# Notes:\n-# To get sccache working, I (John Erickson) had to build it with the Azure feature enabled\n-# and with openssl statically-linked for Linux.\n-# Here's the build (with a backpointer to source) of where the bits came from:\n-# https://dev.azure.com/johnterickson/rust-lang/_build/results?buildId=275\n \n pr: none\n # trigger:"}, {"sha": "e88b5613e46d497ab64177c6b68280a83cfa7b29", "filename": ".azure-pipelines/steps/macos.yml", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Fmacos.yml", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Fmacos.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fsteps%2Fmacos.yml?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -3,21 +3,21 @@ steps:\n \n - bash: |\n     export PATH=$PATH:$HOME/.local/bin:$HOME/Library/Python/2.7/bin/\n-    mkdir -p $HOME/rustsrc    \n+    mkdir -p $HOME/rustsrc\n     echo \"##vso[task.setvariable variable=PATH;]$PATH\"\n \n-    curl -fo /usr/local/bin/sccache https://rustlangtools.blob.core.windows.net/public/stable-x86_64-apple-darwin.sccache\n+    curl -fo /usr/local/bin/sccache https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-apple-darwin\n     chmod +x /usr/local/bin/sccache\n \n     curl -fo /usr/local/bin/stamp https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2017-03-17-stamp-x86_64-apple-darwin\n     chmod +x /usr/local/bin/stamp\n-    \n+\n     export CC=`pwd`/clang+llvm-7.0.0-x86_64-apple-darwin/bin/clang\n     echo \"##vso[task.setvariable variable=CC]$CC\"\n-    \n+\n     export CXX=`pwd`/clang+llvm-7.0.0-x86_64-apple-darwin/bin/clang++\n     echo \"##vso[task.setvariable variable=CXX]$CXX\"\n-    \n+\n     echo \"##vso[task.setvariable variable=AR]ar\"\n   displayName: Prep\n "}, {"sha": "cb8e8a629a7e6e5992db43698159cceac6465a6e", "filename": ".azure-pipelines/steps/run-script.yml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Frun-script.yml", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Frun-script.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fsteps%2Frun-script.yml?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -5,7 +5,7 @@ steps:\n     date && (curl -fs --head https://google.com | grep ^Date: | sed 's/Date: //g' || true)\n   displayName: Log time information (before)\n \n-- bash: |    \n+- bash: |\n     which sccache\n     stamp sh -x -c \"$RUN_SCRIPT\"\n   env:\n@@ -15,8 +15,8 @@ steps:\n \n     # Explicitly decrypt secret variables\n     # See https://docs.microsoft.com/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#secret-variables\n-    SCCACHE_AZURE_CONNECTION_STRING: $(SCCACHE_AZURE_CONNECTION_STRING_SECRET)\n-    DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT_KEY: $(DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT_KEY_SECRET)\n+    AWS_ACCESS_KEY_ID: $(SCCACHE_AWS_ACCESS_KEY_ID)\n+    AWS_SECRET_ACCESS_KEY: $(SCCACHE_AWS_SECRET_ACCESS_KEY)\n   displayName: Run script\n \n - bash: |"}, {"sha": "e3c06d543a972e8b51cdd2f59f8d7e2662d1c7ff", "filename": ".azure-pipelines/steps/windows.yml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Fwindows.yml", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/.azure-pipelines%2Fsteps%2Fwindows.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.azure-pipelines%2Fsteps%2Fwindows.yml?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -106,7 +106,7 @@ steps:\n \n - script: |\n     md sccache\n-    powershell -Command \"iwr -outf sccache\\sccache.exe https://rustlangtools.blob.core.windows.net/public/stable-x86_64-pc-windows-msvc.sccache.exe\"\n+    powershell -Command \"iwr -outf sccache\\sccache.exe https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-26-sccache-x86_64-pc-windows-msvc\"\n     echo ##vso[task.prependpath]%CD%\\sccache\n   displayName: Download and install sccache\n \n@@ -155,6 +155,6 @@ steps:\n \n     # explicitly decrypt secret variables\n     # see https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch\n-    SCCACHE_AZURE_CONNECTION_STRING: $(SCCACHE_AZURE_CONNECTION_STRING_SECRET)\n-    DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT_KEY: $(DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT_KEY_SECRET)\n+    AWS_ACCESS_KEY_ID: $(SCCACHE_AWS_ACCESS_KEY_ID)\n+    AWS_SECRET_ACCESS_KEY: $(SCCACHE_AWS_SECRET_ACCESS_KEY)\n   displayName: Run script"}, {"sha": "0e1485601e96ee8815cbf96c28043879876692ea", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 3, "deletions": 20, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -1,7 +1,5 @@\n #!/usr/bin/env bash\n \n-# ignore-tidy-linelength\n-\n set -e\n \n export MSYS_NO_PATHCONV=1\n@@ -43,21 +41,9 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       cksum=$(sha512sum $hash_key | \\\n         awk '{print $1}')\n \n-      if [ \"$DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT\" != \"\" ]; then\n-        # install azcopy\n-        echo \"deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-xenial-prod/ xenial main\" > azure.list\n-        sudo cp ./azure.list /etc/apt/sources.list.d/\n-        sudo apt-key adv --keyserver packages.microsoft.com --recv-keys EB3E94ADBE1229CF\n-        sudo apt-get update\n-        sudo apt-get install azcopy\n-\n-        url=\"https://$DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT.blob.core.windows.net/$DOCKER_LAYER_CACHE_AZURE_STORAGE_CONTAINER/$cksum\"\n-        upload=\"azcopy --quiet --destination $url --dest-key $DOCKER_LAYER_CACHE_AZURE_STORAGE_ACCOUNT_KEY\"\n-      else\n-        s3url=\"s3://$SCCACHE_BUCKET/docker/$cksum\"\n-        url=\"https://s3-us-west-1.amazonaws.com/$SCCACHE_BUCKET/docker/$cksum\"\n-        upload=\"aws s3 cp - $s3url\"\n-      fi\n+      s3url=\"s3://$SCCACHE_BUCKET/docker/$cksum\"\n+      url=\"https://s3-us-west-1.amazonaws.com/$SCCACHE_BUCKET/docker/$cksum\"\n+      upload=\"aws s3 cp - $s3url\"\n \n       echo \"Attempting to download $url\"\n       rm -f /tmp/rustci_docker_cache\n@@ -134,9 +120,6 @@ if [ \"$SCCACHE_BUCKET\" != \"\" ]; then\n     args=\"$args --env SCCACHE_REGION\"\n     args=\"$args --env AWS_ACCESS_KEY_ID\"\n     args=\"$args --env AWS_SECRET_ACCESS_KEY\"\n-elif [ \"$SCCACHE_AZURE_CONNECTION_STRING\" != \"\" ]; then\n-    args=\"$args --env SCCACHE_AZURE_CONNECTION_STRING\"\n-    args=\"$args --env SCCACHE_AZURE_BLOB_CONTAINER\"\n else\n     mkdir -p $HOME/.cache/sccache\n     args=\"$args --env SCCACHE_DIR=/sccache --volume $HOME/.cache/sccache:/sccache\""}, {"sha": "4c03419894e7cac95a9af3796e6132fa0420b509", "filename": "src/ci/docker/scripts/sccache.sh", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/869ddd8d0019683c007956bae17fc07cd30f39f7/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh", "raw_url": "https://github.com/rust-lang/rust/raw/869ddd8d0019683c007956bae17fc07cd30f39f7/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fsccache.sh?ref=869ddd8d0019683c007956bae17fc07cd30f39f7", "patch": "@@ -1,7 +1,6 @@\n set -ex\n \n-echo Use sccache built with Azure Storage support\n curl -fo /usr/local/bin/sccache \\\n-  https://rustlangtools.blob.core.windows.net/public/stable-x86_64-unknown-linux-musl.sccache\n+  https://s3-us-west-1.amazonaws.com/rust-lang-ci2/rust-ci-mirror/2018-04-02-sccache-x86_64-unknown-linux-musl\n \n chmod +x /usr/local/bin/sccache"}]}