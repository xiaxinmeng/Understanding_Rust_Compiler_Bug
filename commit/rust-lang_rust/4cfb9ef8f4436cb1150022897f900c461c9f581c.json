{"sha": "4cfb9ef8f4436cb1150022897f900c461c9f581c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjZmI5ZWY4ZjQ0MzZjYjExNTAwMjI4OTdmOTAwYzQ2MWM5ZjU4MWM=", "commit": {"author": {"name": "Caleb Cartwright", "email": "caleb.cartwright@outlook.com", "date": "2020-12-11T18:19:30Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2020-12-20T18:05:05Z"}, "message": "fix: don't strip nonexistent comma in derive", "tree": {"sha": "ab29c996f3e471481ddf229c82ada1aefc499b53", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab29c996f3e471481ddf229c82ada1aefc499b53"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cfb9ef8f4436cb1150022897f900c461c9f581c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cfb9ef8f4436cb1150022897f900c461c9f581c", "html_url": "https://github.com/rust-lang/rust/commit/4cfb9ef8f4436cb1150022897f900c461c9f581c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cfb9ef8f4436cb1150022897f900c461c9f581c/comments", "author": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70ce18255f429caf0d75ecfed8c1464535ee779b", "url": "https://api.github.com/repos/rust-lang/rust/commits/70ce18255f429caf0d75ecfed8c1464535ee779b", "html_url": "https://github.com/rust-lang/rust/commit/70ce18255f429caf0d75ecfed8c1464535ee779b"}], "stats": {"total": 55, "additions": 54, "deletions": 1}, "files": [{"sha": "2d25c263277500da15e992410af578e78f4db4c0", "filename": "src/attr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4cfb9ef8f4436cb1150022897f900c461c9f581c/src%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cfb9ef8f4436cb1150022897f900c461c9f581c/src%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fattr.rs?ref=4cfb9ef8f4436cb1150022897f900c461c9f581c", "patch": "@@ -183,9 +183,11 @@ fn format_derive(\n     } else if let SeparatorTactic::Always = context.config.trailing_comma() {\n         // Retain the trailing comma.\n         result.push_str(&item_str);\n-    } else {\n+    } else if item_str.ends_with(\",\") {\n         // Remove the trailing comma.\n         result.push_str(&item_str[..item_str.len() - 1]);\n+    } else {\n+        result.push_str(&item_str);\n     }\n     result.push_str(\")]\");\n "}, {"sha": "695c5590559d0dc4c7404320a652129619ec7b15", "filename": "tests/source/issue_4584.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/4cfb9ef8f4436cb1150022897f900c461c9f581c/tests%2Fsource%2Fissue_4584.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cfb9ef8f4436cb1150022897f900c461c9f581c/tests%2Fsource%2Fissue_4584.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue_4584.rs?ref=4cfb9ef8f4436cb1150022897f900c461c9f581c", "patch": "@@ -0,0 +1,19 @@\n+// rustfmt-indent_style: Visual\n+\n+#[derive(Debug,)]\n+pub enum Case {\n+    Upper,\n+    Lower\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq,)]\n+pub enum Case {\n+    Upper,\n+    Lower\n+}\n+\n+// NB - This formatting looks potentially off the desired state, but is\n+// consistent with current behavior. Included here to provide a line wrapped\n+// derive case with the changes applied to resolve issue #4584\n+#[derive(Add, Sub, Mul, Div, Clone, Copy, Eq, PartialEq, Ord, PartialOrd, Debug, Hash, Serialize, Mul,)]\n+struct Foo {}\n\\ No newline at end of file"}, {"sha": "20255beadb2c39624f8b2faa85063be848ab6f33", "filename": "tests/target/issue_4584.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/4cfb9ef8f4436cb1150022897f900c461c9f581c/tests%2Ftarget%2Fissue_4584.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cfb9ef8f4436cb1150022897f900c461c9f581c/tests%2Ftarget%2Fissue_4584.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue_4584.rs?ref=4cfb9ef8f4436cb1150022897f900c461c9f581c", "patch": "@@ -0,0 +1,32 @@\n+// rustfmt-indent_style: Visual\n+\n+#[derive(Debug)]\n+pub enum Case {\n+    Upper,\n+    Lower,\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub enum Case {\n+    Upper,\n+    Lower,\n+}\n+\n+// NB - This formatting looks potentially off the desired state, but is\n+// consistent with current behavior. Included here to provide a line wrapped\n+// derive case with the changes applied to resolve issue #4584\n+#[derive(Add,\n+           Sub,\n+           Mul,\n+           Div,\n+           Clone,\n+           Copy,\n+           Eq,\n+           PartialEq,\n+           Ord,\n+           PartialOrd,\n+           Debug,\n+           Hash,\n+           Serialize,\n+           Mul)]\n+struct Foo {}"}]}