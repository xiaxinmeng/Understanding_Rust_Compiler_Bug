{"sha": "6239fe47306b6fa5a33e92e82d1e4dba76e4503f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyMzlmZTQ3MzA2YjZmYTVhMzNlOTJlODJkMWU0ZGJhNzZlNDUwM2Y=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-02-05T14:14:33Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-02-05T14:14:33Z"}, "message": "Fix merging of `segment_index` in path resolution", "tree": {"sha": "836731a12104b925f4b801c7a8afa7fc7ca54280", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/836731a12104b925f4b801c7a8afa7fc7ca54280"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6239fe47306b6fa5a33e92e82d1e4dba76e4503f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6239fe47306b6fa5a33e92e82d1e4dba76e4503f", "html_url": "https://github.com/rust-lang/rust/commit/6239fe47306b6fa5a33e92e82d1e4dba76e4503f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6239fe47306b6fa5a33e92e82d1e4dba76e4503f/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac5958485e5e77b020b3ebe0c100df5a5fe6ca08", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac5958485e5e77b020b3ebe0c100df5a5fe6ca08", "html_url": "https://github.com/rust-lang/rust/commit/ac5958485e5e77b020b3ebe0c100df5a5fe6ca08"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "036e389b01d4d16b67f13b3ec83303aea002c347", "filename": "crates/hir_def/src/nameres/path_resolution.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6239fe47306b6fa5a33e92e82d1e4dba76e4503f/crates%2Fhir_def%2Fsrc%2Fnameres%2Fpath_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6239fe47306b6fa5a33e92e82d1e4dba76e4503f/crates%2Fhir_def%2Fsrc%2Fnameres%2Fpath_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Fpath_resolution.rs?ref=6239fe47306b6fa5a33e92e82d1e4dba76e4503f", "patch": "@@ -108,7 +108,6 @@ impl DefMap {\n         shadow: BuiltinShadowMode,\n     ) -> ResolvePathResult {\n         let mut result = ResolvePathResult::empty(ReachedFixedPoint::No);\n-        result.segment_index = Some(usize::max_value());\n \n         let mut arc;\n         let mut current_map = self;\n@@ -128,7 +127,11 @@ impl DefMap {\n             }\n             // FIXME: this doesn't seem right; what if the different namespace resolutions come from different crates?\n             result.krate = result.krate.or(new.krate);\n-            result.segment_index = result.segment_index.min(new.segment_index);\n+            result.segment_index = match (result.segment_index, new.segment_index) {\n+                (Some(idx), None) => Some(idx),\n+                (Some(old), Some(new)) => Some(old.max(new)),\n+                (None, new) => new,\n+            };\n \n             match &current_map.block {\n                 Some(block) => {"}]}