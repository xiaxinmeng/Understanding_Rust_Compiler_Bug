{"sha": "f3f68987197c384f44ea6bb96dc88caa4ade193a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzZjY4OTg3MTk3YzM4NGY0NGVhNmJiOTZkYzg4Y2FhNGFkZTE5M2E=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-04-05T22:14:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-04-05T22:14:44Z"}, "message": "Rollup merge of #59696 - michaelwoerister:fix-issue-59137, r=alexcrichton\n\nRemove invalid assertion back::link::from add_upstream_rust_crates().\n\nThis removes a misplaced assertion. The function containing the assertion is actually only ever called for upstream crates that are not considered for LTO, so we don't care whether upstream code has been merged in by LTO or not.\n\nFixes #59137\n\nr? @alexcrichton", "tree": {"sha": "9e0044a40883b21a9f39fc6e3700982ee6aa7836", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e0044a40883b21a9f39fc6e3700982ee6aa7836"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3f68987197c384f44ea6bb96dc88caa4ade193a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcp9NUCRBK7hj4Ov3rIwAAdHIIABqsZtWf9l6RKf6fOMFOL4uR\nMHGfycjwlxjhmgfXb7xnQDdstTfoARowS5qJb7ECO0KnQtxCxFSO8GfsfujSNxBN\nyYdLFa9uXTwFUWyHvZvgYiP0F7EW8BtfwJOpDp9QVuwGJ7UAEfbT5uADr1XMahn7\nIlFHcW4e/2YK+c4cLlZU/nqMUCAFl+CnMiFBFw1dRc1c1FUxIs/W1KWxWmzfnEMc\nOgqOsQ0zkPjgQUt8u6VHJYjkRi1UraL9ruOAHiWyoyGWzbudAyoRVMIOqYVsusqK\no9yjGSLVHE16LcBS6RZpUcxFqghc8qx2HizQ99QGqgilQFoynR1pNd3McHZYTzE=\n=BZKc\n-----END PGP SIGNATURE-----\n", "payload": "tree 9e0044a40883b21a9f39fc6e3700982ee6aa7836\nparent 6c7ec18e3357e71c7c26f43b28b52e78634a917c\nparent a6e802ab4c84fb50b484fb12bbf397b889c70f77\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1554502484 +0200\ncommitter GitHub <noreply@github.com> 1554502484 +0200\n\nRollup merge of #59696 - michaelwoerister:fix-issue-59137, r=alexcrichton\n\nRemove invalid assertion back::link::from add_upstream_rust_crates().\n\nThis removes a misplaced assertion. The function containing the assertion is actually only ever called for upstream crates that are not considered for LTO, so we don't care whether upstream code has been merged in by LTO or not.\n\nFixes #59137\n\nr? @alexcrichton\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3f68987197c384f44ea6bb96dc88caa4ade193a", "html_url": "https://github.com/rust-lang/rust/commit/f3f68987197c384f44ea6bb96dc88caa4ade193a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3f68987197c384f44ea6bb96dc88caa4ade193a/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c7ec18e3357e71c7c26f43b28b52e78634a917c", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c7ec18e3357e71c7c26f43b28b52e78634a917c", "html_url": "https://github.com/rust-lang/rust/commit/6c7ec18e3357e71c7c26f43b28b52e78634a917c"}, {"sha": "a6e802ab4c84fb50b484fb12bbf397b889c70f77", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6e802ab4c84fb50b484fb12bbf397b889c70f77", "html_url": "https://github.com/rust-lang/rust/commit/a6e802ab4c84fb50b484fb12bbf397b889c70f77"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "19419a72b94dd57476590f4e6b7e069a953c1904", "filename": "src/librustc_codegen_llvm/back/link.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs?ref=f3f68987197c384f44ea6bb96dc88caa4ade193a", "patch": "@@ -1396,10 +1396,6 @@ fn add_upstream_rust_crates(cmd: &mut dyn Linker,\n \n     // Same thing as above, but for dynamic crates instead of static crates.\n     fn add_dynamic_crate(cmd: &mut dyn Linker, sess: &Session, cratepath: &Path) {\n-        // If we're performing LTO, then it should have been previously required\n-        // that all upstream rust dependencies were available in an rlib format.\n-        assert!(!are_upstream_rust_objects_already_included(sess));\n-\n         // Just need to tell the linker about where the library lives and\n         // what its name is\n         let parent = cratepath.parent();"}, {"sha": "ab8ee6c2ef7e11aa80d0824c9c072ea467c7b378", "filename": "src/test/run-make-fulldeps/lto-dylib-dep/Makefile", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2FMakefile?ref=f3f68987197c384f44ea6bb96dc88caa4ade193a", "patch": "@@ -0,0 +1,10 @@\n+-include ../tools.mk\n+\n+# Test that we don't run into an assertion when using a Rust dylib dependency\n+# while compiling with full LTO.\n+# See https://github.com/rust-lang/rust/issues/59137\n+\n+all:\n+\t$(RUSTC) a_dylib.rs --crate-type=dylib -C prefer-dynamic\n+\t$(RUSTC) main.rs -C lto\n+\t$(call RUN,main)"}, {"sha": "c5a35296f89ed8342304b4a975eba225f4c6068d", "filename": "src/test/run-make-fulldeps/lto-dylib-dep/a_dylib.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fa_dylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fa_dylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fa_dylib.rs?ref=f3f68987197c384f44ea6bb96dc88caa4ade193a", "patch": "@@ -0,0 +1,4 @@\n+\n+pub fn foo() {\n+    println!(\"bar\");\n+}"}, {"sha": "af0955e7f3520fa7c36483156c465092e9a4de82", "filename": "src/test/run-make-fulldeps/lto-dylib-dep/main.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3f68987197c384f44ea6bb96dc88caa4ade193a/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Flto-dylib-dep%2Fmain.rs?ref=f3f68987197c384f44ea6bb96dc88caa4ade193a", "patch": "@@ -0,0 +1,6 @@\n+\n+extern crate a_dylib;\n+\n+fn main() {\n+    a_dylib::foo();\n+}"}]}