{"sha": "037caec62c881e11325f93627d9bfd44fb374d51", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzN2NhZWM2MmM4ODFlMTEzMjVmOTM2MjdkOWJmZDQ0ZmIzNzRkNTE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-01-07T11:37:38Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-01-07T12:07:19Z"}, "message": "Use american spelling for config\n\nAs per\n\nhttps://github.com/rust-analyzer/rust-analyzer/blob/171c3c08fe245938fb25321394233de5fe2abc7c/docs/dev/style.md#variable-naming\n\nAlso implement config aliasing, for pain-free settings migrations in the future", "tree": {"sha": "d81cef123586950822b88581454f3bf1a86f8349", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d81cef123586950822b88581454f3bf1a86f8349"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/037caec62c881e11325f93627d9bfd44fb374d51", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/037caec62c881e11325f93627d9bfd44fb374d51", "html_url": "https://github.com/rust-lang/rust/commit/037caec62c881e11325f93627d9bfd44fb374d51", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/037caec62c881e11325f93627d9bfd44fb374d51/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8ace3a295aa63ff7f210f11840e7fc9de65264c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8ace3a295aa63ff7f210f11840e7fc9de65264c", "html_url": "https://github.com/rust-lang/rust/commit/c8ace3a295aa63ff7f210f11840e7fc9de65264c"}], "stats": {"total": 35, "additions": 24, "deletions": 11}, "files": [{"sha": "2d3e25cbf2a1f19411384fc41f5308cdf76e3ac8", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 22, "deletions": 9, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/037caec62c881e11325f93627d9bfd44fb374d51/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/037caec62c881e11325f93627d9bfd44fb374d51/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=037caec62c881e11325f93627d9bfd44fb374d51", "patch": "@@ -7,7 +7,7 @@\n //! configure the server itself, feature flags are passed into analysis, and\n //! tweak things like automatic insertion of `()` in completions.\n \n-use std::{convert::TryFrom, ffi::OsString, path::PathBuf};\n+use std::{convert::TryFrom, ffi::OsString, iter, path::PathBuf};\n \n use flycheck::FlycheckConfig;\n use hir::PrefixKind;\n@@ -28,7 +28,8 @@ use crate::{caps::completion_item_edit_resolve, diagnostics::DiagnosticsMapConfi\n config_data! {\n     struct ConfigData {\n         /// The strategy to use when inserting new imports or merging imports.\n-        assist_importMergeBehaviour: MergeBehaviorDef = \"\\\"full\\\"\",\n+        assist_importMergeBehavior |\n+        assist_importMergeBehaviour: MergeBehaviorDef  = \"\\\"full\\\"\",\n         /// The path structure for newly inserted paths to use.\n         assist_importPrefix: ImportPrefixDef           = \"\\\"plain\\\"\",\n \n@@ -530,7 +531,7 @@ impl Config {\n         }\n     }\n     fn merge_behavior(&self) -> Option<MergeBehavior> {\n-        match self.data.assist_importMergeBehaviour {\n+        match self.data.assist_importMergeBehavior {\n             MergeBehaviorDef::None => None,\n             MergeBehaviorDef::Full => Some(MergeBehavior::Full),\n             MergeBehaviorDef::Last => Some(MergeBehavior::Last),\n@@ -639,7 +640,7 @@ macro_rules! _config_data {\n     (struct $name:ident {\n         $(\n             $(#[doc=$doc:literal])*\n-            $field:ident: $ty:ty = $default:expr,\n+            $field:ident $(| $alias:ident)?: $ty:ty = $default:expr,\n         )*\n     }) => {\n         #[allow(non_snake_case)]\n@@ -648,7 +649,12 @@ macro_rules! _config_data {\n         impl $name {\n             fn from_json(mut json: serde_json::Value) -> $name {\n                 $name {$(\n-                    $field: get_field(&mut json, stringify!($field), $default),\n+                    $field: get_field(\n+                        &mut json,\n+                        stringify!($field),\n+                        None$(.or(Some(stringify!($alias))))?,\n+                        $default,\n+                    ),\n                 )*}\n             }\n \n@@ -680,14 +686,21 @@ use _config_data as config_data;\n fn get_field<T: DeserializeOwned>(\n     json: &mut serde_json::Value,\n     field: &'static str,\n+    alias: Option<&'static str>,\n     default: &str,\n ) -> T {\n     let default = serde_json::from_str(default).unwrap();\n \n-    let mut pointer = field.replace('_', \"/\");\n-    pointer.insert(0, '/');\n-    json.pointer_mut(&pointer)\n-        .and_then(|it| serde_json::from_value(it.take()).ok())\n+    // XXX: check alias first, to work-around the VS Code where it pre-fills the\n+    // defaults instead of sending an empty object.\n+    alias\n+        .into_iter()\n+        .chain(iter::once(field))\n+        .find_map(move |field| {\n+            let mut pointer = field.replace('_', \"/\");\n+            pointer.insert(0, '/');\n+            json.pointer_mut(&pointer).and_then(|it| serde_json::from_value(it.take()).ok())\n+        })\n         .unwrap_or(default)\n }\n "}, {"sha": "a76c99d1e4b1a3efaa4046febcab7f8d0101eb4a", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/037caec62c881e11325f93627d9bfd44fb374d51/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/037caec62c881e11325f93627d9bfd44fb374d51/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=037caec62c881e11325f93627d9bfd44fb374d51", "patch": "@@ -1,4 +1,4 @@\n-[[rust-analyzer.assist.importMergeBehaviour]]rust-analyzer.assist.importMergeBehaviour (default: `\"full\"`)::\n+[[rust-analyzer.assist.importMergeBehavior]]rust-analyzer.assist.importMergeBehavior (default: `\"full\"`)::\n  The strategy to use when inserting new imports or merging imports.\n [[rust-analyzer.assist.importPrefix]]rust-analyzer.assist.importPrefix (default: `\"plain\"`)::\n  The path structure for newly inserted paths to use."}, {"sha": "3e6ebd7ed64cfb1fc01b0a319e35b914b4a6e656", "filename": "editors/code/package.json", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/037caec62c881e11325f93627d9bfd44fb374d51/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/037caec62c881e11325f93627d9bfd44fb374d51/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=037caec62c881e11325f93627d9bfd44fb374d51", "patch": "@@ -349,7 +349,7 @@\n                     \"default\": {},\n                     \"markdownDescription\": \"Optional settings passed to the debug engine. Example: `{ \\\"lldb\\\": { \\\"terminal\\\":\\\"external\\\"} }`\"\n                 },\n-                \"rust-analyzer.assist.importMergeBehaviour\": {\n+                \"rust-analyzer.assist.importMergeBehavior\": {\n                     \"markdownDescription\": \"The strategy to use when inserting new imports or merging imports.\",\n                     \"default\": \"full\",\n                     \"type\": \"string\","}]}