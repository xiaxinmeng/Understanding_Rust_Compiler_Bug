{"sha": "722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "node_id": "C_kwDOAAsO6NoAKDcyMmY3ZDI4YzNkYWYyZDU2OGEzYWY3N2E2MmM0ODlmYjZhMWFlYTI", "commit": {"author": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2022-05-29T18:28:34Z"}, "committer": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2022-05-29T18:39:27Z"}, "message": "needless_late_init: fix ICE when all branches return the never type", "tree": {"sha": "c35d0aa7719841db7cc4e9fb0453263aa660ed12", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c35d0aa7719841db7cc4e9fb0453263aa660ed12"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "html_url": "https://github.com/rust-lang/rust/commit/722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/comments", "author": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39231b4b503955626c1ccf965b8328ac67c523bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/39231b4b503955626c1ccf965b8328ac67c523bb", "html_url": "https://github.com/rust-lang/rust/commit/39231b4b503955626c1ccf965b8328ac67c523bb"}], "stats": {"total": 265, "additions": 148, "deletions": 117}, "files": [{"sha": "26c694a71feddf4130a78ec63b7a83a3034d0002", "filename": "clippy_lints/src/needless_late_init.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/clippy_lints%2Fsrc%2Fneedless_late_init.rs", "raw_url": "https://github.com/rust-lang/rust/raw/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/clippy_lints%2Fsrc%2Fneedless_late_init.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_late_init.rs?ref=722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "patch": "@@ -194,14 +194,15 @@ fn assignment_suggestions<'tcx>(\n         }))\n         .collect::<Option<Vec<(Span, String)>>>()?;\n \n-    let applicability = if suggestions.len() > 1 {\n+    match suggestions.len() {\n+        // All of `exprs` are never types\n+        // https://github.com/rust-lang/rust-clippy/issues/8911\n+        0 => None,\n+        1 => Some((Applicability::MachineApplicable, suggestions)),\n         // multiple suggestions don't work with rustfix in multipart_suggest\n         // https://github.com/rust-lang/rustfix/issues/141\n-        Applicability::Unspecified\n-    } else {\n-        Applicability::MachineApplicable\n-    };\n-    Some((applicability, suggestions))\n+        _ => Some((Applicability::Unspecified, suggestions)),\n+    }\n }\n \n struct Usage<'tcx> {"}, {"sha": "fee8e3030b8087cb16a52a6ffa55f67967c9158f", "filename": "tests/ui/needless_late_init.fixed", "status": "modified", "additions": 31, "deletions": 16, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init.fixed?ref=722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "patch": "@@ -3,6 +3,7 @@\n #![allow(\n     unused,\n     clippy::assign_op_pattern,\n+    clippy::blocks_in_if_conditions,\n     clippy::let_and_return,\n     clippy::let_unit_value,\n     clippy::nonminimal_bool\n@@ -18,6 +19,22 @@ impl std::ops::Drop for SignificantDrop {\n     }\n }\n \n+fn simple() {\n+    \n+    let a = \"zero\";\n+\n+    \n+    \n+    let b = 1;\n+    let c = 2;\n+\n+    \n+    let d: usize = 1;\n+\n+    \n+    let e = format!(\"{}\", d);\n+}\n+\n fn main() {\n     \n     let n = 1;\n@@ -237,22 +254,20 @@ fn does_not_lint() {\n     x = SignificantDrop;\n }\n \n-mod fixable {\n-    #![allow(dead_code)]\n-\n-    fn main() {\n-        \n-        let a = \"zero\";\n-\n-        \n-        \n-        let b = 1;\n-        let c = 2;\n-\n-        \n-        let d: usize = 1;\n+#[rustfmt::skip]\n+fn issue8911() -> u32 {\n+    let x;\n+    match 1 {\n+        _ if { x = 1; false } => return 1,\n+        _ => return 2,\n+    }\n \n-        \n-        let e = format!(\"{}\", d);\n+    let x;\n+    if { x = 1; true } {\n+        return 1;\n+    } else {\n+        return 2;\n     }\n+\n+    3\n }"}, {"sha": "402d9f9ef7f81945f4dd9087c314ca0dfe0f8b32", "filename": "tests/ui/needless_late_init.rs", "status": "modified", "additions": 31, "deletions": 16, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.rs", "raw_url": "https://github.com/rust-lang/rust/raw/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init.rs?ref=722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "patch": "@@ -3,6 +3,7 @@\n #![allow(\n     unused,\n     clippy::assign_op_pattern,\n+    clippy::blocks_in_if_conditions,\n     clippy::let_and_return,\n     clippy::let_unit_value,\n     clippy::nonminimal_bool\n@@ -18,6 +19,22 @@ impl std::ops::Drop for SignificantDrop {\n     }\n }\n \n+fn simple() {\n+    let a;\n+    a = \"zero\";\n+\n+    let b;\n+    let c;\n+    b = 1;\n+    c = 2;\n+\n+    let d: usize;\n+    d = 1;\n+\n+    let e;\n+    e = format!(\"{}\", d);\n+}\n+\n fn main() {\n     let a;\n     let n = 1;\n@@ -237,22 +254,20 @@ fn does_not_lint() {\n     x = SignificantDrop;\n }\n \n-mod fixable {\n-    #![allow(dead_code)]\n-\n-    fn main() {\n-        let a;\n-        a = \"zero\";\n-\n-        let b;\n-        let c;\n-        b = 1;\n-        c = 2;\n-\n-        let d: usize;\n-        d = 1;\n+#[rustfmt::skip]\n+fn issue8911() -> u32 {\n+    let x;\n+    match 1 {\n+        _ if { x = 1; false } => return 1,\n+        _ => return 2,\n+    }\n \n-        let e;\n-        e = format!(\"{}\", d);\n+    let x;\n+    if { x = 1; true } {\n+        return 1;\n+    } else {\n+        return 2;\n     }\n+\n+    3\n }"}, {"sha": "f320b5b9cbb378c2b14212b751c7f811fb640909", "filename": "tests/ui/needless_late_init.stderr", "status": "modified", "additions": 79, "deletions": 79, "changes": 158, "blob_url": "https://github.com/rust-lang/rust/blob/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/722f7d28c3daf2d568a3af77a62c489fb6a1aea2/tests%2Fui%2Fneedless_late_init.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init.stderr?ref=722f7d28c3daf2d568a3af77a62c489fb6a1aea2", "patch": "@@ -1,12 +1,79 @@\n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:22:5\n+  --> $DIR/needless_late_init.rs:23:5\n    |\n LL |     let a;\n-   |     ^^^^^^\n+   |     ^^^^^^ created here\n+LL |     a = \"zero\";\n+   |     ^^^^^^^^^^ initialised here\n    |\n    = note: `-D clippy::needless-late-init` implied by `-D warnings`\n help: declare `a` here\n    |\n+LL |     let a = \"zero\";\n+   |     ~~~~~\n+\n+error: unneeded late initialization\n+  --> $DIR/needless_late_init.rs:26:5\n+   |\n+LL |     let b;\n+   |     ^^^^^^ created here\n+LL |     let c;\n+LL |     b = 1;\n+   |     ^^^^^ initialised here\n+   |\n+help: declare `b` here\n+   |\n+LL |     let b = 1;\n+   |     ~~~~~\n+\n+error: unneeded late initialization\n+  --> $DIR/needless_late_init.rs:27:5\n+   |\n+LL |     let c;\n+   |     ^^^^^^ created here\n+LL |     b = 1;\n+LL |     c = 2;\n+   |     ^^^^^ initialised here\n+   |\n+help: declare `c` here\n+   |\n+LL |     let c = 2;\n+   |     ~~~~~\n+\n+error: unneeded late initialization\n+  --> $DIR/needless_late_init.rs:31:5\n+   |\n+LL |     let d: usize;\n+   |     ^^^^^^^^^^^^^ created here\n+LL |     d = 1;\n+   |     ^^^^^ initialised here\n+   |\n+help: declare `d` here\n+   |\n+LL |     let d: usize = 1;\n+   |     ~~~~~~~~~~~~\n+\n+error: unneeded late initialization\n+  --> $DIR/needless_late_init.rs:34:5\n+   |\n+LL |     let e;\n+   |     ^^^^^^ created here\n+LL |     e = format!(\"{}\", d);\n+   |     ^^^^^^^^^^^^^^^^^^^^ initialised here\n+   |\n+help: declare `e` here\n+   |\n+LL |     let e = format!(\"{}\", d);\n+   |     ~~~~~\n+\n+error: unneeded late initialization\n+  --> $DIR/needless_late_init.rs:39:5\n+   |\n+LL |     let a;\n+   |     ^^^^^^\n+   |\n+help: declare `a` here\n+   |\n LL |     let a = match n {\n    |     +++++++\n help: remove the assignments from the `match` arms\n@@ -21,7 +88,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:31:5\n+  --> $DIR/needless_late_init.rs:48:5\n    |\n LL |     let b;\n    |     ^^^^^^\n@@ -42,7 +109,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:38:5\n+  --> $DIR/needless_late_init.rs:55:5\n    |\n LL |     let d;\n    |     ^^^^^^\n@@ -63,7 +130,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:46:5\n+  --> $DIR/needless_late_init.rs:63:5\n    |\n LL |     let e;\n    |     ^^^^^^\n@@ -84,7 +151,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:53:5\n+  --> $DIR/needless_late_init.rs:70:5\n    |\n LL |     let f;\n    |     ^^^^^^\n@@ -100,7 +167,7 @@ LL +         1 => \"three\",\n    | \n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:59:5\n+  --> $DIR/needless_late_init.rs:76:5\n    |\n LL |     let g: usize;\n    |     ^^^^^^^^^^^^^\n@@ -120,7 +187,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:67:5\n+  --> $DIR/needless_late_init.rs:84:5\n    |\n LL |     let x;\n    |     ^^^^^^ created here\n@@ -134,7 +201,7 @@ LL |     let x = 1;\n    |     ~~~~~\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:71:5\n+  --> $DIR/needless_late_init.rs:88:5\n    |\n LL |     let x;\n    |     ^^^^^^ created here\n@@ -148,7 +215,7 @@ LL |     let x = SignificantDrop;\n    |     ~~~~~\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:75:5\n+  --> $DIR/needless_late_init.rs:92:5\n    |\n LL |     let x;\n    |     ^^^^^^ created here\n@@ -162,7 +229,7 @@ LL |     let x = SignificantDrop;\n    |     ~~~~~\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:94:5\n+  --> $DIR/needless_late_init.rs:111:5\n    |\n LL |     let a;\n    |     ^^^^^^\n@@ -183,7 +250,7 @@ LL |     };\n    |      +\n \n error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:111:5\n+  --> $DIR/needless_late_init.rs:128:5\n    |\n LL |     let a;\n    |     ^^^^^^\n@@ -203,72 +270,5 @@ help: add a semicolon after the `match` expression\n LL |     };\n    |      +\n \n-error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:244:9\n-   |\n-LL |         let a;\n-   |         ^^^^^^ created here\n-LL |         a = \"zero\";\n-   |         ^^^^^^^^^^ initialised here\n-   |\n-help: declare `a` here\n-   |\n-LL |         let a = \"zero\";\n-   |         ~~~~~\n-\n-error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:247:9\n-   |\n-LL |         let b;\n-   |         ^^^^^^ created here\n-LL |         let c;\n-LL |         b = 1;\n-   |         ^^^^^ initialised here\n-   |\n-help: declare `b` here\n-   |\n-LL |         let b = 1;\n-   |         ~~~~~\n-\n-error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:248:9\n-   |\n-LL |         let c;\n-   |         ^^^^^^ created here\n-LL |         b = 1;\n-LL |         c = 2;\n-   |         ^^^^^ initialised here\n-   |\n-help: declare `c` here\n-   |\n-LL |         let c = 2;\n-   |         ~~~~~\n-\n-error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:252:9\n-   |\n-LL |         let d: usize;\n-   |         ^^^^^^^^^^^^^ created here\n-LL |         d = 1;\n-   |         ^^^^^ initialised here\n-   |\n-help: declare `d` here\n-   |\n-LL |         let d: usize = 1;\n-   |         ~~~~~~~~~~~~\n-\n-error: unneeded late initialization\n-  --> $DIR/needless_late_init.rs:255:9\n-   |\n-LL |         let e;\n-   |         ^^^^^^ created here\n-LL |         e = format!(\"{}\", d);\n-   |         ^^^^^^^^^^^^^^^^^^^^ initialised here\n-   |\n-help: declare `e` here\n-   |\n-LL |         let e = format!(\"{}\", d);\n-   |         ~~~~~\n-\n error: aborting due to 16 previous errors\n "}]}