{"sha": "a22eb31668e949fb392c417547d2f5da5fbbcc19", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyMmViMzE2NjhlOTQ5ZmIzOTJjNDE3NTQ3ZDJmNWRhNWZiYmNjMTk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-09-23T12:54:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-09-23T12:54:00Z"}, "message": "Rollup merge of #76898 - Aaron1011:fix/item-def-span, r=oli-obk\n\nRecord `tcx.def_span` instead of `item.span` in crate metadata\n\nThis was missed in PR #75465. As a result, a few places have been using\nthe full body span of functions, instead of just the header span.", "tree": {"sha": "23cc239d94688b08ea92fd3d91aac41446978724", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23cc239d94688b08ea92fd3d91aac41446978724"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a22eb31668e949fb392c417547d2f5da5fbbcc19", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfa0VoCRBK7hj4Ov3rIwAAdHIIAJONC26VpoW13HVFFMKwjjI3\nMSZ2v44339T1eJCSrXWIJSVzdI792jM1eA+Qgq0/acBOeAtHvrhU/VWkQyd76Zun\n1m5ffxoZEfDNjGGG5DOZ5Dt2wt7KRUGiaPbcDPuO/cn5ZWX5/GKd4fkDhn+lW4Ux\nO88WCRbd32gqS6mJq5JRm/NRJtxSuMQRwohfa3H3Fs3EwIXxSbyZPJgD7BaOWwlq\nKoeX+w0mR0rFRYthjGtVpMZuIYyTND4U5VtI24NrWYQlmsKp/fWMrxTCNOyFx3r/\n0p0AGw/FXzMYTedDnT/RnFP0bOL+dn28+PQ59m7IY4Wm3ruUqipWAGWWYlKer3U=\n=PDGV\n-----END PGP SIGNATURE-----\n", "payload": "tree 23cc239d94688b08ea92fd3d91aac41446978724\nparent feca2c229e209ceda1eda7306e6ea9ee0aaa9305\nparent e734733a9e931cbbe26cfccbdf9849faef8e5125\nauthor Dylan DPC <dylan.dpc@gmail.com> 1600865640 +0200\ncommitter GitHub <noreply@github.com> 1600865640 +0200\n\nRollup merge of #76898 - Aaron1011:fix/item-def-span, r=oli-obk\n\nRecord `tcx.def_span` instead of `item.span` in crate metadata\n\nThis was missed in PR #75465. As a result, a few places have been using\nthe full body span of functions, instead of just the header span.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a22eb31668e949fb392c417547d2f5da5fbbcc19", "html_url": "https://github.com/rust-lang/rust/commit/a22eb31668e949fb392c417547d2f5da5fbbcc19", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a22eb31668e949fb392c417547d2f5da5fbbcc19/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "feca2c229e209ceda1eda7306e6ea9ee0aaa9305", "url": "https://api.github.com/repos/rust-lang/rust/commits/feca2c229e209ceda1eda7306e6ea9ee0aaa9305", "html_url": "https://github.com/rust-lang/rust/commit/feca2c229e209ceda1eda7306e6ea9ee0aaa9305"}, {"sha": "e734733a9e931cbbe26cfccbdf9849faef8e5125", "url": "https://api.github.com/repos/rust-lang/rust/commits/e734733a9e931cbbe26cfccbdf9849faef8e5125", "html_url": "https://github.com/rust-lang/rust/commit/e734733a9e931cbbe26cfccbdf9849faef8e5125"}], "stats": {"total": 62, "additions": 20, "deletions": 42}, "files": [{"sha": "d5b0a868a364e4cdc6cf040ed0555b2c8c886533", "filename": "compiler/rustc_metadata/src/rmeta/encoder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fencoder.rs?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -1300,7 +1300,7 @@ impl EncodeContext<'a, 'tcx> {\n         });\n         record!(self.tables.visibility[def_id] <-\n             ty::Visibility::from_hir(&item.vis, item.hir_id, tcx));\n-        record!(self.tables.span[def_id] <- item.span);\n+        record!(self.tables.span[def_id] <- self.tcx.def_span(def_id));\n         record!(self.tables.attributes[def_id] <- item.attrs);\n         // FIXME(eddyb) there should be a nicer way to do this.\n         match item.kind {"}, {"sha": "eb1b42c57bc51f905566b45ec2e76c69e082e6c2", "filename": "src/test/ui/consts/miri_unleashed/drop.stderr", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fdrop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fdrop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fdrop.stderr?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -1,22 +1,16 @@\n error[E0080]: could not evaluate static initializer\n   --> $SRC_DIR/core/src/ptr/mod.rs:LL:COL\n    |\n-LL | / pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n-LL | |     // Code here does not matter - this is replaced by the\n-LL | |     // real drop glue by the compiler.\n-LL | |\n-LL | |     // SAFETY: see comment above\n-LL | |     unsafe { drop_in_place(to_drop) }\n-LL | | }\n-   | | ^\n-   | | |\n-   | |_calling non-const function `<Vec<i32> as Drop>::drop`\n-   |   inside `drop_in_place::<Vec<i32>> - shim(Some(Vec<i32>))` at $SRC_DIR/core/src/ptr/mod.rs:LL:COL\n+LL | pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | |\n+   | calling non-const function `<Vec<i32> as Drop>::drop`\n+   | inside `drop_in_place::<Vec<i32>> - shim(Some(Vec<i32>))` at $SRC_DIR/core/src/ptr/mod.rs:LL:COL\n    | \n   ::: $DIR/drop.rs:18:1\n    |\n-LL |   };\n-   |   - inside `TEST_BAD` at $DIR/drop.rs:18:1\n+LL | };\n+   | - inside `TEST_BAD` at $DIR/drop.rs:18:1\n \n warning: skipping const checks\n    |"}, {"sha": "63b8b29d6ce2861db2a879c6d2d2bca76fa67d3c", "filename": "src/test/ui/macros/same-sequence-span.stderr", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fmacros%2Fsame-sequence-span.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fmacros%2Fsame-sequence-span.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fsame-sequence-span.stderr?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -17,15 +17,11 @@ LL |                $(= $z:tt)*\n error: `$x:expr` may be followed by `$y:tt`, which is not allowed for `expr` fragments\n   --> $DIR/same-sequence-span.rs:19:1\n    |\n-LL |   proc_macro_sequence::make_foo!();\n-   |   ^--------------------------------\n-   |   |\n-   |  _in this macro invocation\n+LL | proc_macro_sequence::make_foo!();\n+   | ---------------------------------^^^^^^^^^^^^^\n    | |\n-LL | |\n-LL | |\n-LL | | fn main() {}\n-...  |\n+   | not allowed after `expr` fragments\n+   | in this macro invocation\n    |\n    = note: allowed there are: `=>`, `,` or `;`\n    = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)"}, {"sha": "81cebae17aeba4d1690326f5831650a86638be59", "filename": "src/test/ui/proc-macro/meta-macro-hygiene.stdout", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro-hygiene.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro-hygiene.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro-hygiene.stdout?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -1,6 +1,6 @@\n-Def site: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5)\n+Def site: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5)\n Input: TokenStream [Ident { ident: \"$crate\", span: $DIR/meta-macro-hygiene.rs:24:37: 24:43 (#4) }, Punct { ch: ':', spacing: Joint, span: $DIR/meta-macro-hygiene.rs:24:43: 24:45 (#4) }, Punct { ch: ':', spacing: Alone, span: $DIR/meta-macro-hygiene.rs:24:43: 24:45 (#4) }, Ident { ident: \"dummy\", span: $DIR/meta-macro-hygiene.rs:24:45: 24:50 (#4) }, Punct { ch: '!', spacing: Alone, span: $DIR/meta-macro-hygiene.rs:24:50: 24:51 (#4) }, Group { delimiter: Parenthesis, stream: TokenStream [], span: $DIR/meta-macro-hygiene.rs:24:51: 24:53 (#4) }]\n-Respanned: TokenStream [Ident { ident: \"$crate\", span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }, Punct { ch: ':', spacing: Joint, span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }, Punct { ch: ':', spacing: Alone, span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }, Ident { ident: \"dummy\", span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }, Punct { ch: '!', spacing: Alone, span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }, Group { delimiter: Parenthesis, stream: TokenStream [], span: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#5) }]\n+Respanned: TokenStream [Ident { ident: \"$crate\", span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }, Punct { ch: ':', spacing: Joint, span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }, Punct { ch: ':', spacing: Alone, span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }, Ident { ident: \"dummy\", span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }, Punct { ch: '!', spacing: Alone, span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }, Group { delimiter: Parenthesis, stream: TokenStream [], span: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#5) }]\n #![feature /* 0#0 */(prelude_import)]\n // ignore-tidy-linelength\n // aux-build:make-macro.rs"}, {"sha": "662682d40b2c68640e5c057d43f531802f1e90c7", "filename": "src/test/ui/proc-macro/meta-macro.stdout", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fmeta-macro.stdout?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -1,3 +1,3 @@\n-Def site: $DIR/auxiliary/make-macro.rs:7:9: 16:10 (#4)\n+Def site: $DIR/auxiliary/make-macro.rs:7:9: 7:56 (#4)\n Input: TokenStream []\n Respanned: TokenStream []"}, {"sha": "5bf381607c5ed6eb78b7886bc211e17270f6d38f", "filename": "src/test/ui/recursion/issue-38591-non-regular-dropck-recursion.stderr", "status": "modified", "additions": 4, "deletions": 16, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Frecursion%2Fissue-38591-non-regular-dropck-recursion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Frecursion%2Fissue-38591-non-regular-dropck-recursion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frecursion%2Fissue-38591-non-regular-dropck-recursion.stderr?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -1,26 +1,14 @@\n error: reached the recursion limit while instantiating `drop_in_place::<S<fn(fn(fn(fn(fn...)))))))))))))))))))))))))))))>))`\n   --> $SRC_DIR/core/src/ptr/mod.rs:LL:COL\n    |\n-LL | / pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n-LL | |     // Code here does not matter - this is replaced by the\n-LL | |     // real drop glue by the compiler.\n-LL | |\n-LL | |     // SAFETY: see comment above\n-LL | |     unsafe { drop_in_place(to_drop) }\n-LL | | }\n-   | |_^\n+LL | pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n note: `drop_in_place` defined here\n   --> $SRC_DIR/core/src/ptr/mod.rs:LL:COL\n    |\n-LL | / pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n-LL | |     // Code here does not matter - this is replaced by the\n-LL | |     // real drop glue by the compiler.\n-LL | |\n-LL | |     // SAFETY: see comment above\n-LL | |     unsafe { drop_in_place(to_drop) }\n-LL | | }\n-   | |_^\n+LL | pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: the full type name has been written to '$TEST_BUILD_DIR/recursion/issue-38591-non-regular-dropck-recursion/issue-38591-non-regular-dropck-recursion.long-type.txt'\n \n error: aborting due to previous error"}, {"sha": "a2ddffff997d882af39f5f3ac15b1c9c34b8566f", "filename": "src/test/ui/type_length_limit.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Ftype_length_limit.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a22eb31668e949fb392c417547d2f5da5fbbcc19/src%2Ftest%2Fui%2Ftype_length_limit.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype_length_limit.stderr?ref=a22eb31668e949fb392c417547d2f5da5fbbcc19", "patch": "@@ -2,7 +2,7 @@ error: reached the type-length limit while instantiating `std::mem::drop::<Optio\n   --> $SRC_DIR/core/src/mem/mod.rs:LL:COL\n    |\n LL | pub fn drop<T>(_x: T) {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: the full type name has been written to '$TEST_BUILD_DIR/type_length_limit/type_length_limit.long-type.txt'\n    = help: consider adding a `#![type_length_limit=\"8\"]` attribute to your crate"}]}