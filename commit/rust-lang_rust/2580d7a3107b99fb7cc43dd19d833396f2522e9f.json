{"sha": "2580d7a3107b99fb7cc43dd19d833396f2522e9f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1ODBkN2EzMTA3Yjk5ZmI3Y2M0M2RkMTlkODMzMzk2ZjI1MjJlOWY=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-05-25T07:07:56Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-05-25T07:07:56Z"}, "message": "Add chain_split_single_child option", "tree": {"sha": "e1653395f3162efe124aa7fcc098f95656f7e953", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1653395f3162efe124aa7fcc098f95656f7e953"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2580d7a3107b99fb7cc43dd19d833396f2522e9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2580d7a3107b99fb7cc43dd19d833396f2522e9f", "html_url": "https://github.com/rust-lang/rust/commit/2580d7a3107b99fb7cc43dd19d833396f2522e9f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2580d7a3107b99fb7cc43dd19d833396f2522e9f/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c69608a7e05eef2da99081118bf20da87733b746", "url": "https://api.github.com/repos/rust-lang/rust/commits/c69608a7e05eef2da99081118bf20da87733b746", "html_url": "https://github.com/rust-lang/rust/commit/c69608a7e05eef2da99081118bf20da87733b746"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "a0c6ba407d955e4f4ca1ef59e8b9ebfdec031b3c", "filename": "Configurations.md", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/2580d7a3107b99fb7cc43dd19d833396f2522e9f/Configurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/2580d7a3107b99fb7cc43dd19d833396f2522e9f/Configurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Configurations.md?ref=2580d7a3107b99fb7cc43dd19d833396f2522e9f", "patch": "@@ -112,6 +112,28 @@ let lorem = ipsum.dolor().sit().amet().consectetur().adipiscing().elit();\n #### Lines longer than `chain_one_line_max`:\n See [`chain_indent`](#chain_indent).\n \n+## `chain_split_single_child`\n+\n+Split a chain with a single child if its length exceeds [`chain_one_line_max`](#chain_one_line_max).\n+\n+- **Default value**: `false`\n+- **Possible values**: `false`, `true`\n+\n+#### `false`\n+\n+```rust\n+let files = fs::read_dir(\"tests/coverage/source\").expect(\"Couldn't read source dir\");\n+```\n+\n+#### `true`\n+\n+```rust\n+let files = fs::read_dir(\"tests/coverage/source\")\n+    .expect(\"Couldn't read source dir\");\n+```\n+\n+See also [`chain_one_line_max`](#chain_one_line_max).\n+\n ## `closure_block_indent_threshold`\n \n How many lines a closure must have before it is block indented. -1 means never use block indent."}, {"sha": "9a8a69144403039f37e6131a54366d8ea52e3568", "filename": "src/chains.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2580d7a3107b99fb7cc43dd19d833396f2522e9f/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2580d7a3107b99fb7cc43dd19d833396f2522e9f/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=2580d7a3107b99fb7cc43dd19d833396f2522e9f", "patch": "@@ -163,10 +163,10 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n            first_child_shape,\n            other_child_shape);\n \n-    let child_shape_iter = Some(first_child_shape)\n-        .into_iter()\n-        .chain(::std::iter::repeat(other_child_shape)\n-                   .take(subexpr_list.len() - 1));\n+    let child_shape_iter =\n+        Some(first_child_shape)\n+            .into_iter()\n+            .chain(::std::iter::repeat(other_child_shape).take(subexpr_list.len() - 1));\n     let iter = subexpr_list.iter().rev().zip(child_shape_iter);\n     let mut rewrites = try_opt!(iter.map(|(e, shape)| {\n                                              rewrite_chain_subexpr(e, total_span, context, shape)\n@@ -186,7 +186,7 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n         if rewrites.len() > 1 {\n             true\n         } else if rewrites.len() == 1 {\n-            parent_rewrite.len() > context.config.chain_one_line_max() / 2\n+            context.config.chain_split_single_child() || one_line_len > shape.width\n         } else {\n             false\n         }"}, {"sha": "1863c6ac33f5f44dbe95871e85ca01ace740c831", "filename": "tests/target/configs-chain_split_single_child-false.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2580d7a3107b99fb7cc43dd19d833396f2522e9f/tests%2Ftarget%2Fconfigs-chain_split_single_child-false.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2580d7a3107b99fb7cc43dd19d833396f2522e9f/tests%2Ftarget%2Fconfigs-chain_split_single_child-false.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-chain_split_single_child-false.rs?ref=2580d7a3107b99fb7cc43dd19d833396f2522e9f", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-chain_split_single_child: false\n+\n+fn main() {\n+    let files = fs::read_dir(\"tests/source\").expect(\"Couldn't read source dir\");\n+}"}, {"sha": "154fa0bfa2e6131b9842cf90476fe50510bc0038", "filename": "tests/target/configs-chain_split_single_child-true.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2580d7a3107b99fb7cc43dd19d833396f2522e9f/tests%2Ftarget%2Fconfigs-chain_split_single_child-true.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2580d7a3107b99fb7cc43dd19d833396f2522e9f/tests%2Ftarget%2Fconfigs-chain_split_single_child-true.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-chain_split_single_child-true.rs?ref=2580d7a3107b99fb7cc43dd19d833396f2522e9f", "patch": "@@ -0,0 +1,6 @@\n+// rustfmt-chain_split_single_child: true\n+\n+fn main() {\n+    let files = fs::read_dir(\"tests/source\")\n+        .expect(\"Couldn't read source dir\");\n+}"}]}