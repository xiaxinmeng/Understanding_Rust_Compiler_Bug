{"sha": "231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzMWJkNDgyYzZkMmYyYWFlNDYzZjJkNWI1N2VkM2M4ZjVhMDgwM2U=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-04-03T23:49:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-04-03T23:49:13Z"}, "message": "Rollup merge of #59677 - phansch:rustfix_coverage_handle_other_error_formats, r=oli-obk\n\nrustfix coverage: Skip UI tests with non-json error-format\n\nWhen using the `rustfix-coverage` flag, some tests currently fail\nbecause they define a different error-format than `json`.\n\nThe current implementation crashes when encountering those tests. Since\nwe don't care about non-json test output when collecting the coverage\ndata, we handle those tests by returning an empty `Vec` instead.\n\nr? @oli-obk", "tree": {"sha": "d8484f16a7f4568dc6086d133859d1070f3a0b43", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8484f16a7f4568dc6086d133859d1070f3a0b43"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcpUZ5CRBK7hj4Ov3rIwAAdHIIAErdXx76vBieXbGmI8+sPKaP\nQSmE6d1YX78/UKXxbWKtFRfsKZ9VfNZLFb5ZQhlekXwTD1QHm3bLOKyif6NsrS6Q\nCkhHuFKPI5J6Qe3goVeG+RsUAz3bIyo9x0Z/Ug0G1V7DIUXz/3fYo1gyxYg8yFdm\nfNK0Cmi7XZl42U7hJ4RqrPIoEDpHCVrjXLnHU/nA7+pPnIw2aLRHkX5FOHbWuOIJ\nbn9Xek39MGcJ5vT0leAoBJjZbyY29I8SHpt9ukaxlSLGEEo6/9gMB3jMuQ+NT3tc\nKWK9uQRT9aQiyCCNgCGgXy5vjsUW5PJPWQQhbzuHu6O958qDKCNsDr0vnPoTsic=\n=lWfQ\n-----END PGP SIGNATURE-----\n", "payload": "tree d8484f16a7f4568dc6086d133859d1070f3a0b43\nparent eb3215e523d41420b4b73add98541f9f26f26eb1\nparent da99f4671150ba90a5441e012d3f1f5b87536f3b\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1554335353 +0200\ncommitter GitHub <noreply@github.com> 1554335353 +0200\n\nRollup merge of #59677 - phansch:rustfix_coverage_handle_other_error_formats, r=oli-obk\n\nrustfix coverage: Skip UI tests with non-json error-format\n\nWhen using the `rustfix-coverage` flag, some tests currently fail\nbecause they define a different error-format than `json`.\n\nThe current implementation crashes when encountering those tests. Since\nwe don't care about non-json test output when collecting the coverage\ndata, we handle those tests by returning an empty `Vec` instead.\n\nr? @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e", "html_url": "https://github.com/rust-lang/rust/commit/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb3215e523d41420b4b73add98541f9f26f26eb1", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb3215e523d41420b4b73add98541f9f26f26eb1", "html_url": "https://github.com/rust-lang/rust/commit/eb3215e523d41420b4b73add98541f9f26f26eb1"}, {"sha": "da99f4671150ba90a5441e012d3f1f5b87536f3b", "url": "https://api.github.com/repos/rust-lang/rust/commits/da99f4671150ba90a5441e012d3f1f5b87536f3b", "html_url": "https://github.com/rust-lang/rust/commit/da99f4671150ba90a5441e012d3f1f5b87536f3b"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "2021dd513aa6209c3207715f24c19c11c2899397", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=231bd482c6d2f2aae463f2d5b57ed3c8f5a0803e", "patch": "@@ -2820,12 +2820,15 @@ impl<'test> TestCx<'test> {\n             // don't test rustfix with nll right now\n         } else if self.config.rustfix_coverage {\n             // Find out which tests have `MachineApplicable` suggestions but are missing\n-            // `run-rustfix` or `run-rustfix-only-machine-applicable` headers\n+            // `run-rustfix` or `run-rustfix-only-machine-applicable` headers.\n+            //\n+            // This will return an empty `Vec` in case the executed test file has a\n+            // `compile-flags: --error-format=xxxx` header with a value other than `json`.\n             let suggestions = get_suggestions_from_json(\n                 &proc_res.stderr,\n                 &HashSet::new(),\n                 Filter::MachineApplicableOnly\n-            ).unwrap();\n+            ).unwrap_or_default();\n             if suggestions.len() > 0\n                 && !self.props.run_rustfix\n                 && !self.props.rustfix_only_machine_applicable {"}]}