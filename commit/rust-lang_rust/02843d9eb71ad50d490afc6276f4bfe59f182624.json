{"sha": "02843d9eb71ad50d490afc6276f4bfe59f182624", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAyODQzZDllYjcxYWQ1MGQ0OTBhZmM2Mjc2ZjRiZmU1OWYxODI2MjQ=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-01-17T15:18:56Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-01-17T15:18:56Z"}, "message": "properly deprecate suggestion methods", "tree": {"sha": "6e05d1bd196d1e108931bd604e24ca676ca0e040", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e05d1bd196d1e108931bd604e24ca676ca0e040"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/02843d9eb71ad50d490afc6276f4bfe59f182624", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAlxAnP4WHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdCW6B/9yg96ThRS7xx4T1W7Hq5FStd0g\nYLvHteozv0OB1J4gPsma9yJspO4n5rqwgU7XSNPg94Gc21jJWx6gowS/E+e8FuHW\nVfEVoUt5YmgnAaG1RLZs4XUimbIUgmmn3k7TD29WRUdH+1dhR0loWpBqkkvAzTxL\n8X1TIQyL+qC70kIbnZaLTqWf1wBtA7swRe8GH21UgUPPTy/xHt1iFlptngWDzAmQ\nJlEtKivX+STK8ITwPe/pX4lY9k+1wUfy7YGxGg4zIwaj3unVhyUpl9zubGhOXWth\nukbN9NnYCU525aEusF5VsQRT53YAI1xJIgzjwW7HIyARlbZCU/D/z2VpzxKT\n=O7Ei\n-----END PGP SIGNATURE-----", "payload": "tree 6e05d1bd196d1e108931bd604e24ca676ca0e040\nparent 920192490f3eea0cf3b2e58e28912eb68423fdde\nauthor Andy Russell <arussell123@gmail.com> 1547738336 -0500\ncommitter Andy Russell <arussell123@gmail.com> 1547738336 -0500\n\nproperly deprecate suggestion methods\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/02843d9eb71ad50d490afc6276f4bfe59f182624", "html_url": "https://github.com/rust-lang/rust/commit/02843d9eb71ad50d490afc6276f4bfe59f182624", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/02843d9eb71ad50d490afc6276f4bfe59f182624/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "920192490f3eea0cf3b2e58e28912eb68423fdde", "url": "https://api.github.com/repos/rust-lang/rust/commits/920192490f3eea0cf3b2e58e28912eb68423fdde", "html_url": "https://github.com/rust-lang/rust/commit/920192490f3eea0cf3b2e58e28912eb68423fdde"}], "stats": {"total": 126, "additions": 86, "deletions": 40}, "files": [{"sha": "736cca6bd64af3b6399623e4b054e4b333bff7aa", "filename": "src/librustc_errors/diagnostic_builder.rs", "status": "modified", "additions": 56, "deletions": 34, "changes": 90, "blob_url": "https://github.com/rust-lang/rust/blob/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_errors%2Fdiagnostic_builder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_errors%2Fdiagnostic_builder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Fdiagnostic_builder.rs?ref=02843d9eb71ad50d490afc6276f4bfe59f182624", "patch": "@@ -33,7 +33,11 @@ pub struct DiagnosticBuilder<'a> {\n /// it easy to declare such methods on the builder.\n macro_rules! forward {\n     // Forward pattern for &self -> &Self\n-    (pub fn $n:ident(&self, $($name:ident: $ty:ty),* $(,)*) -> &Self) => {\n+    (\n+        $(#[$attrs:meta])*\n+        pub fn $n:ident(&self, $($name:ident: $ty:ty),* $(,)*) -> &Self\n+    ) => {\n+        $(#[$attrs])*\n         pub fn $n(&self, $($name: $ty),*) -> &Self {\n             #[allow(deprecated)]\n             self.diagnostic.$n($($name),*);\n@@ -42,7 +46,11 @@ macro_rules! forward {\n     };\n \n     // Forward pattern for &mut self -> &mut Self\n-    (pub fn $n:ident(&mut self, $($name:ident: $ty:ty),* $(,)*) -> &mut Self) => {\n+    (\n+        $(#[$attrs:meta])*\n+        pub fn $n:ident(&mut self, $($name:ident: $ty:ty),* $(,)*) -> &mut Self\n+    ) => {\n+        $(#[$attrs])*\n         pub fn $n(&mut self, $($name: $ty),*) -> &mut Self {\n             #[allow(deprecated)]\n             self.diagnostic.$n($($name),*);\n@@ -52,10 +60,15 @@ macro_rules! forward {\n \n     // Forward pattern for &mut self -> &mut Self, with S: Into<MultiSpan>\n     // type parameter. No obvious way to make this more generic.\n-    (pub fn $n:ident<S: Into<MultiSpan>>(\n-                    &mut self,\n-                    $($name:ident: $ty:ty),*\n-                    $(,)*) -> &mut Self) => {\n+    (\n+        $(#[$attrs:meta])*\n+        pub fn $n:ident<S: Into<MultiSpan>>(\n+            &mut self,\n+            $($name:ident: $ty:ty),*\n+            $(,)*\n+        ) -> &mut Self\n+    ) => {\n+        $(#[$attrs])*\n         pub fn $n<S: Into<MultiSpan>>(&mut self, $($name: $ty),*) -> &mut Self {\n             #[allow(deprecated)]\n             self.diagnostic.$n($($name),*);\n@@ -177,34 +190,43 @@ impl<'a> DiagnosticBuilder<'a> {\n                                                   msg: &str,\n                                                   ) -> &mut Self);\n \n-    #[deprecated(note = \"Use `span_suggestion_short_with_applicability`\")]\n-    forward!(pub fn span_suggestion_short(\n-                                      &mut self,\n-                                      sp: Span,\n-                                      msg: &str,\n-                                      suggestion: String,\n-                                      ) -> &mut Self);\n-\n-    #[deprecated(note = \"Use `multipart_suggestion_with_applicability`\")]\n-    forward!(pub fn multipart_suggestion(\n-        &mut self,\n-        msg: &str,\n-        suggestion: Vec<(Span, String)>,\n-    ) -> &mut Self);\n-\n-    #[deprecated(note = \"Use `span_suggestion_with_applicability`\")]\n-    forward!(pub fn span_suggestion(&mut self,\n-                                    sp: Span,\n-                                    msg: &str,\n-                                    suggestion: String,\n-                                    ) -> &mut Self);\n-\n-    #[deprecated(note = \"Use `span_suggestions_with_applicability`\")]\n-    forward!(pub fn span_suggestions(&mut self,\n-                                     sp: Span,\n-                                     msg: &str,\n-                                     suggestions: Vec<String>,\n-                                     ) -> &mut Self);\n+    forward!(\n+        #[deprecated(note = \"Use `span_suggestion_short_with_applicability`\")]\n+        pub fn span_suggestion_short(\n+            &mut self,\n+            sp: Span,\n+            msg: &str,\n+            suggestion: String,\n+        ) -> &mut Self\n+    );\n+\n+    forward!(\n+        #[deprecated(note = \"Use `multipart_suggestion_with_applicability`\")]\n+        pub fn multipart_suggestion(\n+            &mut self,\n+            msg: &str,\n+            suggestion: Vec<(Span, String)>,\n+        ) -> &mut Self\n+    );\n+\n+    forward!(\n+        #[deprecated(note = \"Use `span_suggestion_with_applicability`\")]\n+        pub fn span_suggestion(\n+            &mut self,\n+            sp: Span,\n+            msg: &str,\n+            suggestion: String,\n+        ) -> &mut Self\n+    );\n+\n+    forward!(\n+        #[deprecated(note = \"Use `span_suggestions_with_applicability`\")]\n+        pub fn span_suggestions(&mut self,\n+            sp: Span,\n+            msg: &str,\n+            suggestions: Vec<String>,\n+        ) -> &mut Self\n+    );\n \n     pub fn multipart_suggestion_with_applicability(&mut self,\n                                               msg: &str,"}, {"sha": "fea013826e949aeaca30bbf206dcbd58c2739a04", "filename": "src/librustc_resolve/build_reduced_graph.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs?ref=02843d9eb71ad50d490afc6276f4bfe59f182624", "patch": "@@ -21,6 +21,8 @@ use std::cell::Cell;\n use std::ptr;\n use rustc_data_structures::sync::Lrc;\n \n+use errors::Applicability;\n+\n use syntax::ast::{Name, Ident};\n use syntax::attr;\n \n@@ -345,7 +347,12 @@ impl<'a> Resolver<'a> {\n                 let module = if orig_name.is_none() && ident.name == keywords::SelfLower.name() {\n                     self.session\n                         .struct_span_err(item.span, \"`extern crate self;` requires renaming\")\n-                        .span_suggestion(item.span, \"try\", \"extern crate self as name;\".into())\n+                        .span_suggestion_with_applicability(\n+                            item.span,\n+                            \"try\",\n+                            \"extern crate self as name;\".into(),\n+                            Applicability::HasPlaceholders,\n+                        )\n                         .emit();\n                     return;\n                 } else if orig_name == Some(keywords::SelfLower.name()) {"}, {"sha": "896cb3d5a0c69e5e707d904c8c0ae261a431ff95", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=02843d9eb71ad50d490afc6276f4bfe59f182624", "patch": "@@ -4823,8 +4823,13 @@ impl<'a> Resolver<'a> {\n                 } else if ident.span.rust_2018() {\n                     let msg = \"relative paths are not supported in visibilities on 2018 edition\";\n                     self.session.struct_span_err(ident.span, msg)\n-                                .span_suggestion(path.span, \"try\", format!(\"crate::{}\", path))\n-                                .emit();\n+                        .span_suggestion_with_applicability(\n+                            path.span,\n+                            \"try\",\n+                            format!(\"crate::{}\", path),\n+                            Applicability::MaybeIncorrect,\n+                        )\n+                        .emit();\n                     return ty::Visibility::Public;\n                 } else {\n                     let ctxt = ident.span.ctxt();"}, {"sha": "47f258e1aea7478d77cb28b8004bfbbf34225ced", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=02843d9eb71ad50d490afc6276f4bfe59f182624", "patch": "@@ -1,5 +1,6 @@\n use check::{FnCtxt, Expectation, Diverges, Needs};\n use check::coercion::CoerceMany;\n+use errors::Applicability;\n use rustc::hir::{self, PatKind};\n use rustc::hir::def::{Def, CtorKind};\n use rustc::hir::pat_util::EnumerateAndAdjustIterator;\n@@ -989,7 +990,13 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n                     let suggested_name =\n                         find_best_match_for_name(input, &ident.as_str(), None);\n                     if let Some(suggested_name) = suggested_name {\n-                        err.span_suggestion(*span, \"did you mean\", suggested_name.to_string());\n+                        err.span_suggestion_with_applicability(\n+                            *span,\n+                            \"did you mean\",\n+                            suggested_name.to_string(),\n+                            Applicability::MaybeIncorrect,\n+                        );\n+\n                         // we don't want to throw `E0027` in case we have thrown `E0026` for them\n                         unmentioned_fields.retain(|&x| x.as_str() != suggested_name.as_str());\n                     }"}, {"sha": "4f1bc2fc2412c7029f374aafff69c96632320053", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02843d9eb71ad50d490afc6276f4bfe59f182624/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=02843d9eb71ad50d490afc6276f4bfe59f182624", "patch": "@@ -4063,12 +4063,13 @@ impl<'a> Parser<'a> {\n \n         if let Some(mut err) = delayed_err {\n             if let Some(etc_span) = etc_span {\n-                err.multipart_suggestion(\n+                err.multipart_suggestion_with_applicability(\n                     \"move the `..` to the end of the field list\",\n                     vec![\n                         (etc_span, String::new()),\n                         (self.span, format!(\"{}.. }}\", if ate_comma { \"\" } else { \", \" })),\n                     ],\n+                    Applicability::MachineApplicable,\n                 );\n             }\n             err.emit();\n@@ -6913,7 +6914,11 @@ impl<'a> Parser<'a> {\n \n             let mut err = self.struct_span_err(fixed_name_sp, error_msg);\n             err.span_label(fixed_name_sp, \"dash-separated idents are not valid\");\n-            err.multipart_suggestion(suggestion_msg, replacement);\n+            err.multipart_suggestion_with_applicability(\n+                suggestion_msg,\n+                replacement,\n+                Applicability::MachineApplicable,\n+            );\n             err.emit();\n         }\n         Ok(ident)"}]}