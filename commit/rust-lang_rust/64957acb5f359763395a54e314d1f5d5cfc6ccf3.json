{"sha": "64957acb5f359763395a54e314d1f5d5cfc6ccf3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0OTU3YWNiNWYzNTk3NjMzOTVhNTRlMzE0ZDFmNWQ1Y2ZjNmNjZjM=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-03-21T00:10:59Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-03-21T00:28:42Z"}, "message": "Fix incorrect scoping in while expressions", "tree": {"sha": "00cec518c2cfd88dac252a4aad824372c7afc898", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00cec518c2cfd88dac252a4aad824372c7afc898"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64957acb5f359763395a54e314d1f5d5cfc6ccf3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64957acb5f359763395a54e314d1f5d5cfc6ccf3", "html_url": "https://github.com/rust-lang/rust/commit/64957acb5f359763395a54e314d1f5d5cfc6ccf3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64957acb5f359763395a54e314d1f5d5cfc6ccf3/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62a4677dbc6cf1c90e4558c3c73fef201a0d1080", "url": "https://api.github.com/repos/rust-lang/rust/commits/62a4677dbc6cf1c90e4558c3c73fef201a0d1080", "html_url": "https://github.com/rust-lang/rust/commit/62a4677dbc6cf1c90e4558c3c73fef201a0d1080"}], "stats": {"total": 55, "additions": 41, "deletions": 14}, "files": [{"sha": "bd7005ca6966dcb39be7bb2ac64ed8d9aef0b96e", "filename": "crates/hir_def/src/body/scope.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fhir_def%2Fsrc%2Fbody%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fhir_def%2Fsrc%2Fbody%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fbody%2Fscope.rs?ref=64957acb5f359763395a54e314d1f5d5cfc6ccf3", "patch": "@@ -188,8 +188,8 @@ fn compute_expr_scopes(expr: ExprId, body: &Body, scopes: &mut ExprScopes, scope\n             compute_expr_scopes(*body_expr, body, scopes, scope);\n         }\n         Expr::While { condition, body: body_expr, label } => {\n-            compute_expr_scopes(*condition, body, scopes, scope);\n             let scope = scopes.new_labeled_scope(scope, make_label(label));\n+            compute_expr_scopes(*condition, body, scopes, scope);\n             compute_expr_scopes(*body_expr, body, scopes, scope);\n         }\n         Expr::Loop { body: body_expr, label } => {"}, {"sha": "628c1fb9b6cb97dabd9dd8926fe43a591cc191cc", "filename": "crates/ide_completion/src/completions/lifetime.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fide_completion%2Fsrc%2Fcompletions%2Flifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fide_completion%2Fsrc%2Fcompletions%2Flifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcompletions%2Flifetime.rs?ref=64957acb5f359763395a54e314d1f5d5cfc6ccf3", "patch": "@@ -253,4 +253,33 @@ fn foo() {\n             \"#]],\n         );\n     }\n+\n+    #[test]\n+    fn complete_label_in_while_cond() {\n+        check(\n+            r#\"\n+fn foo() {\n+    'outer: while { 'inner: loop { break '$0 } } {}\n+}\n+\"#,\n+            expect![[r#\"\n+                lb 'inner\n+                lb 'outer\n+            \"#]],\n+        );\n+    }\n+\n+    #[test]\n+    fn complete_label_in_for_iterable() {\n+        check(\n+            r#\"\n+fn foo() {\n+    'outer: for _ in [{ 'inner: loop { break '$0 } }] {}\n+}\n+\"#,\n+            expect![[r#\"\n+                lb 'inner\n+            \"#]],\n+        );\n+    }\n }"}, {"sha": "67e2d6f6c2944765c9e13afba5db23eed30fc005", "filename": "crates/ide_completion/src/context.rs", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64957acb5f359763395a54e314d1f5d5cfc6ccf3/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcontext.rs?ref=64957acb5f359763395a54e314d1f5d5cfc6ccf3", "patch": "@@ -475,19 +475,17 @@ impl<'a> CompletionContext<'a> {\n                 return;\n             }\n \n-            if parent.kind() != syntax::SyntaxKind::LABEL {\n-                match_ast! {\n-                    match parent {\n-                        ast::LifetimeParam(_it) => {\n-                            self.lifetime_allowed = true;\n-                            self.lifetime_param_syntax =\n-                                self.sema.find_node_at_offset_with_macros(original_file, offset);\n-                        },\n-                        ast::BreakExpr(_it) => self.is_label_ref = true,\n-                        ast::ContinueExpr(_it) => self.is_label_ref = true,\n-                        ast::Label(_it) => (),\n-                        _ => self.lifetime_allowed = true,\n-                    }\n+            match_ast! {\n+                match parent {\n+                    ast::LifetimeParam(_it) => {\n+                        self.lifetime_allowed = true;\n+                        self.lifetime_param_syntax =\n+                            self.sema.find_node_at_offset_with_macros(original_file, offset);\n+                    },\n+                    ast::BreakExpr(_it) => self.is_label_ref = true,\n+                    ast::ContinueExpr(_it) => self.is_label_ref = true,\n+                    ast::Label(_it) => (),\n+                    _ => self.lifetime_allowed = true,\n                 }\n             }\n         }"}]}