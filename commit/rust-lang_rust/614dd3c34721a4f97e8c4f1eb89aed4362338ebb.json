{"sha": "614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxNGRkM2MzNDcyMWE0Zjk3ZThjNGYxZWI4OWFlZDQzNjIzMzhlYmI=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-03-06T23:39:50Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-03-07T00:05:07Z"}, "message": "Rename and change `add_roots` to return a `Vec`.", "tree": {"sha": "f8d353555372c6dc36c1321e3771a7fb71eaea44", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8d353555372c6dc36c1321e3771a7fb71eaea44"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlyAYDMACgkQAXYLT59T\n8VT6UA/+JzI9DsLseapVilyLzWhmWYSUP3MS2A18yC+UnV3szYin1d4ztbG+M0E/\nKKqMJPvpA5+0Fid0MhbNUAj/nYnbiZqVGq9bLNMZQHXTMhgxvFjLMg9PE4vi/F1x\nS/3lwh6nud77IvRWh4hUUJSvjcqpP3LyghD6toYPSsbydrizMoxqovCmRxrrP8QG\nAw4aqPXZ0tzAaRQxZE8T7mIAbJBqGMy3vNURTsQBU9Z41G34JbvuWM7BsEt+Ji++\nRUct3ncokl6TcvhdLYD4w1wuzGYcYk4Oh3+Q3BsUjpKenYnBmqkUkteMru6IUxC1\n8FSyI2ccv6BqejSchRsXhU1PWm63L+1JUaqhKLbLxB5wxKA8VLMTn7KP2mjA3TwW\n7s36ku6/JBMvDtjcAyBcNI/OpiyNMFiWMRuw/x4RDZmCzMyvt3ZTMd+KliWVDrWy\nKetaSSnDhbteaYBohEu4uCO1YtIaiN5DHx+fz26tNrjaT9hrup+vOuFZfrLlV5XR\n2TAFuKsV6N13j1kjmt8xxMAHc0hPdFC0z36JOOZM3LEvruOHWVWmpsMKErB+aFS6\nKIw8tOqoyxfAKYBJa5I/Gj/ieRdNWmEuit6htbj42Ip9aohNiwDdJXOVk0/yLbyx\nGPAGPRiiJEV0U5oL15mayLRjHCs/JgHS36OyxvMR9OHJXIEmQME=\n=I73r\n-----END PGP SIGNATURE-----", "payload": "tree f8d353555372c6dc36c1321e3771a7fb71eaea44\nparent 00d927a1885ec2938d3365a8e136993445b437f5\nauthor David Wood <david@davidtw.co> 1551915590 +0100\ncommitter David Wood <david@davidtw.co> 1551917107 +0100\n\nRename and change `add_roots` to return a `Vec`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "html_url": "https://github.com/rust-lang/rust/commit/614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00d927a1885ec2938d3365a8e136993445b437f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/00d927a1885ec2938d3365a8e136993445b437f5", "html_url": "https://github.com/rust-lang/rust/commit/00d927a1885ec2938d3365a8e136993445b437f5"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "c6d10107d1880261994edcf42bb0aa7207b655bb", "filename": "crates/ra_batch/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_batch%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_batch%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_batch%2Fsrc%2Flib.rs?ref=614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "patch": "@@ -99,7 +99,7 @@ impl BatchDatabase {\n         let ws = ProjectWorkspace::discover(root.as_ref())?;\n         let mut roots = Vec::new();\n         roots.push(root.clone());\n-        ws.add_roots(&mut roots);\n+        roots.extend(ws.to_roots());\n         let (mut vfs, roots) = Vfs::new(roots);\n         let mut load = |path: &Path| {\n             let vfs_file = vfs.load(path);"}, {"sha": "7163568b9cd71ced544925d092a0c4f0200729d1", "filename": "crates/ra_lsp_server/src/server_world.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs", "raw_url": "https://github.com/rust-lang/rust/raw/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fserver_world.rs?ref=614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "patch": "@@ -40,7 +40,7 @@ impl ServerWorldState {\n         let mut roots = Vec::new();\n         roots.push(root.clone());\n         for ws in workspaces.iter() {\n-            ws.add_roots(&mut roots);\n+            roots.extend(ws.to_roots());\n         }\n         let (mut vfs, roots) = Vfs::new(roots);\n         let roots_to_scan = roots.len();"}, {"sha": "c566ec0fb5fef33f2cc9f8c6d8a10e4a9428aa97", "filename": "crates/ra_project_model/src/lib.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_project_model%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/614dd3c34721a4f97e8c4f1eb89aed4362338ebb/crates%2Fra_project_model%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Flib.rs?ref=614dd3c34721a4f97e8c4f1eb89aed4362338ebb", "patch": "@@ -50,20 +50,25 @@ impl ProjectWorkspace {\n         }\n     }\n \n-    pub fn add_roots(&self, roots: &mut Vec<PathBuf>) {\n+    pub fn to_roots(&self) -> Vec<PathBuf> {\n         match self {\n             ProjectWorkspace::Json { project } => {\n+                let mut roots = Vec::with_capacity(project.roots.len());\n                 for root in &project.roots {\n                     roots.push(root.path.clone());\n                 }\n+                roots\n             }\n             ProjectWorkspace::Cargo { cargo, sysroot } => {\n+                let mut roots =\n+                    Vec::with_capacity(cargo.packages().count() + sysroot.crates().count());\n                 for pkg in cargo.packages() {\n                     roots.push(pkg.root(&cargo).to_path_buf());\n                 }\n                 for krate in sysroot.crates() {\n                     roots.push(krate.root_dir(&sysroot).to_path_buf())\n                 }\n+                roots\n             }\n         }\n     }"}]}