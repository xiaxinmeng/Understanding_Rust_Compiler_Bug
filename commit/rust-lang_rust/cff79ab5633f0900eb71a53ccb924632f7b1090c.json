{"sha": "cff79ab5633f0900eb71a53ccb924632f7b1090c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmZjc5YWI1NjMzZjA5MDBlYjcxYTUzY2NiOTI0NjMyZjdiMTA5MGM=", "commit": {"author": {"name": "Paolo Falabella", "email": "paolo.falabella@gmail.com", "date": "2014-07-02T15:39:43Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-07-03T19:54:51Z"}, "message": "Rationals that have a 1 denom should print like ints", "tree": {"sha": "d789e88278907856f69e252651c927de9d520b0a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d789e88278907856f69e252651c927de9d520b0a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cff79ab5633f0900eb71a53ccb924632f7b1090c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cff79ab5633f0900eb71a53ccb924632f7b1090c", "html_url": "https://github.com/rust-lang/rust/commit/cff79ab5633f0900eb71a53ccb924632f7b1090c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cff79ab5633f0900eb71a53ccb924632f7b1090c/comments", "author": {"login": "pfalabella", "id": 1331706, "node_id": "MDQ6VXNlcjEzMzE3MDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1331706?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pfalabella", "html_url": "https://github.com/pfalabella", "followers_url": "https://api.github.com/users/pfalabella/followers", "following_url": "https://api.github.com/users/pfalabella/following{/other_user}", "gists_url": "https://api.github.com/users/pfalabella/gists{/gist_id}", "starred_url": "https://api.github.com/users/pfalabella/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pfalabella/subscriptions", "organizations_url": "https://api.github.com/users/pfalabella/orgs", "repos_url": "https://api.github.com/users/pfalabella/repos", "events_url": "https://api.github.com/users/pfalabella/events{/privacy}", "received_events_url": "https://api.github.com/users/pfalabella/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "faf5d926ec21efb04d308fc71214e0afa55649d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/faf5d926ec21efb04d308fc71214e0afa55649d9", "html_url": "https://github.com/rust-lang/rust/commit/faf5d926ec21efb04d308fc71214e0afa55649d9"}], "stats": {"total": 45, "additions": 28, "deletions": 17}, "files": [{"sha": "c35b2976b407f19aef7f9614c48d2f3fc19e4bd7", "filename": "src/libnum/rational.rs", "status": "modified", "additions": 28, "deletions": 17, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/cff79ab5633f0900eb71a53ccb924632f7b1090c/src%2Flibnum%2Frational.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cff79ab5633f0900eb71a53ccb924632f7b1090c/src%2Flibnum%2Frational.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibnum%2Frational.rs?ref=cff79ab5633f0900eb71a53ccb924632f7b1090c", "patch": "@@ -274,12 +274,17 @@ impl<T: Clone + Integer + PartialOrd>\n     Num for Ratio<T> {}\n \n /* String conversions */\n-impl<T: fmt::Show> fmt::Show for Ratio<T> {\n-    /// Renders as `numer/denom`.\n+impl<T: fmt::Show + Eq + One> fmt::Show for Ratio<T> {\n+    /// Renders as `numer/denom`. If denom=1, renders as numer.\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n-        write!(f, \"{}/{}\", self.numer, self.denom)\n+        if self.denom == One::one() {\n+            write!(f, \"{}\", self.numer)\n+        } else {\n+            write!(f, \"{}/{}\", self.numer, self.denom)\n+        }\n     }\n }\n+\n impl<T: ToStrRadix> ToStrRadix for Ratio<T> {\n     /// Renders as `numer/denom` where the numbers are in base `radix`.\n     fn to_str_radix(&self, radix: uint) -> String {\n@@ -291,21 +296,20 @@ impl<T: ToStrRadix> ToStrRadix for Ratio<T> {\n \n impl<T: FromStr + Clone + Integer + PartialOrd>\n     FromStr for Ratio<T> {\n-    /// Parses `numer/denom`.\n+    /// Parses `numer/denom` or just `numer`\n     fn from_str(s: &str) -> Option<Ratio<T>> {\n-        let split: Vec<&str> = s.splitn('/', 1).collect();\n-        if split.len() < 2 {\n-            return None\n+        let mut split = s.splitn('/', 1);\n+\n+        let num = split.next().and_then(|n| FromStr::from_str(n));\n+        let den = split.next().or(Some(\"1\")).and_then(|d| FromStr::from_str(d));\n+\n+        match (num, den) {\n+            (Some(n), Some(d)) => Some(Ratio::new(n, d)),\n+            _ => None\n         }\n-        let a_option: Option<T> = FromStr::from_str(*split.get(0));\n-        a_option.and_then(|a| {\n-            let b_option: Option<T> = FromStr::from_str(*split.get(1));\n-            b_option.and_then(|b| {\n-                Some(Ratio::new(a.clone(), b.clone()))\n-            })\n-        })\n     }\n }\n+\n impl<T: FromStrRadix + Clone + Integer + PartialOrd>\n     FromStrRadix for Ratio<T> {\n     /// Parses `numer/denom` where the numbers are in base `radix`.\n@@ -429,6 +433,13 @@ mod test {\n         assert!(!_neg1_2.is_integer());\n     }\n \n+    #[test]\n+    fn test_show() {\n+        assert_eq!(format!(\"{}\", _2), \"2\".to_string());\n+        assert_eq!(format!(\"{}\", _1_2), \"1/2\".to_string());\n+        assert_eq!(format!(\"{}\", _0), \"0\".to_string());\n+        assert_eq!(format!(\"{}\", Ratio::from_integer(-2i)), \"-2\".to_string());\n+    }\n \n     mod arith {\n         use super::{_0, _1, _2, _1_2, _3_2, _neg1_2, to_big};\n@@ -562,11 +573,11 @@ mod test {\n             assert_eq!(FromStr::from_str(s.as_slice()), Some(r));\n             assert_eq!(r.to_str(), s);\n         }\n-        test(_1, \"1/1\".to_string());\n-        test(_0, \"0/1\".to_string());\n+        test(_1, \"1\".to_string());\n+        test(_0, \"0\".to_string());\n         test(_1_2, \"1/2\".to_string());\n         test(_3_2, \"3/2\".to_string());\n-        test(_2, \"2/1\".to_string());\n+        test(_2, \"2\".to_string());\n         test(_neg1_2, \"-1/2\".to_string());\n     }\n     #[test]"}]}