{"sha": "e7b8db2e633f71da868fac22da5c050dcb922788", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3YjhkYjJlNjMzZjcxZGE4NjhmYWMyMmRhNWMwNTBkY2I5MjI3ODg=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-04-13T17:53:19Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-04-13T17:54:08Z"}, "message": "Enable alias analysis and the function attributes pass.\n\nThe C API extension is already upstream, we can drop the local copy once\nthe bots are updated.", "tree": {"sha": "2dec6ad5d4352a8ba4905dc5b66706b7aa7fc544", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2dec6ad5d4352a8ba4905dc5b66706b7aa7fc544"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7b8db2e633f71da868fac22da5c050dcb922788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7b8db2e633f71da868fac22da5c050dcb922788", "html_url": "https://github.com/rust-lang/rust/commit/e7b8db2e633f71da868fac22da5c050dcb922788", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7b8db2e633f71da868fac22da5c050dcb922788/comments", "author": null, "committer": null, "parents": [{"sha": "6909e7ca7872ef8672e3f044b6648f5b78af64d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/6909e7ca7872ef8672e3f044b6648f5b78af64d8", "html_url": "https://github.com/rust-lang/rust/commit/6909e7ca7872ef8672e3f044b6648f5b78af64d8"}], "stats": {"total": 32, "additions": 28, "deletions": 4}, "files": [{"sha": "6770320598a97f5c82db98860616838e1169cf2c", "filename": "src/comp/lib/llvm.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Fcomp%2Flib%2Fllvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Fcomp%2Flib%2Fllvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Flib%2Fllvm.rs?ref=e7b8db2e633f71da868fac22da5c050dcb922788", "patch": "@@ -775,6 +775,8 @@ native mod llvm = llvm_lib {\n     fn LLVMAddSimplifyLibCallsPass(PassManagerRef PM);\n     fn LLVMAddLoopIdiomPass(PassManagerRef PM);\n     fn LLVMAddEarlyCSEPass(PassManagerRef PM);\n+    fn LLVMAddTypeBasedAliasAnalysisPass(PassManagerRef PM);\n+    fn LLVMAddBasicAliasAnalysisPass(PassManagerRef PM);\n \n     /** Destroys a memory buffer. */\n     fn LLVMDisposeMemoryBuffer(MemoryBufferRef MemBuf);"}, {"sha": "99ac225f8eeeed03149f4a9a1a7e95797b772d92", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=e7b8db2e633f71da868fac22da5c050dcb922788", "patch": "@@ -6647,24 +6647,25 @@ fn run_passes(ModuleRef llmod, bool opt) {\n         auto fpm = mk_pass_manager();\n \n         // createStandardFunctionPasses\n+        llvm.LLVMAddTypeBasedAliasAnalysisPass(fpm.llpm);\n+        llvm.LLVMAddBasicAliasAnalysisPass(fpm.llpm);\n         llvm.LLVMAddCFGSimplificationPass(fpm.llpm);\n         llvm.LLVMAddScalarReplAggregatesPass(fpm.llpm);\n         llvm.LLVMAddEarlyCSEPass(fpm.llpm);\n \n         llvm.LLVMRunPassManager(fpm.llpm, llmod);\n \n         // createStandardModulePasses\n+        llvm.LLVMAddTypeBasedAliasAnalysisPass(pm.llpm);\n+        llvm.LLVMAddBasicAliasAnalysisPass(pm.llpm);\n         llvm.LLVMAddGlobalOptimizerPass(pm.llpm);\n         llvm.LLVMAddIPSCCPPass(pm.llpm);\n         llvm.LLVMAddDeadArgEliminationPass(pm.llpm);\n         llvm.LLVMAddInstructionCombiningPass(pm.llpm);\n         llvm.LLVMAddCFGSimplificationPass(pm.llpm);\n         llvm.LLVMAddPruneEHPass(pm.llpm);\n         llvm.LLVMAddFunctionInliningPass(pm.llpm);\n-\n-        // FIXME: crashes!\n-        // llvm.LLVMAddFunctionAttrsPass(pm.llpm);\n-\n+        llvm.LLVMAddFunctionAttrsPass(pm.llpm);\n         llvm.LLVMAddScalarReplAggregatesPassSSA(pm.llpm);\n         llvm.LLVMAddEarlyCSEPass(pm.llpm);\n         llvm.LLVMAddSimplifyLibCallsPass(pm.llpm);"}, {"sha": "cde4f9d34c1d9b2b5297b9809484cc955ddbfe46", "filename": "src/rustllvm/Passes.cpp", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2FPasses.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2FPasses.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FPasses.cpp?ref=e7b8db2e633f71da868fac22da5c050dcb922788", "patch": "@@ -0,0 +1,14 @@\n+#include \"llvm/Analysis/Passes.h\"\n+#include \"llvm/PassManager.h\"\n+#include \"llvm-c/Core.h\"\n+\n+using namespace llvm;\n+extern \"C\" {\n+  void LLVMAddTypeBasedAliasAnalysisPass(LLVMPassManagerRef PM) {\n+    unwrap(PM)->add(createTypeBasedAliasAnalysisPass());\n+  }\n+\n+  void LLVMAddBasicAliasAnalysisPass(LLVMPassManagerRef PM) {\n+    unwrap(PM)->add(createBasicAliasAnalysisPass());\n+  }\n+}"}, {"sha": "aa17184ceb927400644c0b23597d893d94b5a076", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=e7b8db2e633f71da868fac22da5c050dcb922788", "patch": "@@ -31,3 +31,8 @@ extern \"C\" const char *LLVMRustGetLastError(void) {\n \n LLVMOpaqueObjectFile* (*RustHackToFetchObjectO)(LLVMOpaqueMemoryBuffer*)\n   = LLVMCreateObjectFile;\n+\n+extern \"C\" void LLVMAddBasicAliasAnalysisPass(LLVMPassManagerRef PM);\n+\n+void (*RustHackToFetchPassesO)(LLVMPassManagerRef PM) =\n+  LLVMAddBasicAliasAnalysisPass;"}, {"sha": "6067c3838fb08ed6d29ce999cbb2d7ada5a4720a", "filename": "src/rustllvm/rustllvm.def.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2Frustllvm.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/e7b8db2e633f71da868fac22da5c050dcb922788/src%2Frustllvm%2Frustllvm.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2Frustllvm.def.in?ref=e7b8db2e633f71da868fac22da5c050dcb922788", "patch": "@@ -15,6 +15,7 @@ LLVMAddAggressiveDCEPass\n LLVMAddAlias\n LLVMAddArgumentPromotionPass\n LLVMAddAttribute\n+LLVMaddBasicAliasAnalysisPass\n LLVMAddCFGSimplificationPass\n LLVMAddCase\n LLVMAddConstantMergePass\n@@ -67,6 +68,7 @@ LLVMAddStripDeadPrototypesPass\n LLVMAddStripSymbolsPass\n LLVMAddTailCallEliminationPass\n LLVMAddTargetData\n+LLVMAddTypeBasedAliasAnalysisPass\n LLVMAddTypeName\n LLVMAddVerifierPass\n LLVMAlignOf"}]}