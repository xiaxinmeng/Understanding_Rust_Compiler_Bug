{"sha": "1171a214a633128bbbd067bd0e582f8b40172e01", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNzFhMjE0YTYzMzEyOGJiYmQwNjdiZDBlNTgyZjhiNDAxNzJlMDE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-02-18T21:50:36Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-02-18T21:50:36Z"}, "message": "auto merge of #4979 : z0w0/rust/issue-1301, r=catamorphism", "tree": {"sha": "3605cc2aef179eac233dd82eb94d39e6b7fe0d14", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3605cc2aef179eac233dd82eb94d39e6b7fe0d14"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1171a214a633128bbbd067bd0e582f8b40172e01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1171a214a633128bbbd067bd0e582f8b40172e01", "html_url": "https://github.com/rust-lang/rust/commit/1171a214a633128bbbd067bd0e582f8b40172e01", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1171a214a633128bbbd067bd0e582f8b40172e01/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a2068f1b219d79aec867834e7790fbba399abc57", "url": "https://api.github.com/repos/rust-lang/rust/commits/a2068f1b219d79aec867834e7790fbba399abc57", "html_url": "https://github.com/rust-lang/rust/commit/a2068f1b219d79aec867834e7790fbba399abc57"}, {"sha": "0991437c3b8e801080119b754ce4ebf8d4ef9b01", "url": "https://api.github.com/repos/rust-lang/rust/commits/0991437c3b8e801080119b754ce4ebf8d4ef9b01", "html_url": "https://github.com/rust-lang/rust/commit/0991437c3b8e801080119b754ce4ebf8d4ef9b01"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "d069c95c5ec9d2f6bcd7acda79a2577fddc5e770", "filename": "src/librustc/metadata/creader.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1171a214a633128bbbd067bd0e582f8b40172e01/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1171a214a633128bbbd067bd0e582f8b40172e01/src%2Flibrustc%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fcreader.rs?ref=1171a214a633128bbbd067bd0e582f8b40172e01", "patch": "@@ -55,6 +55,7 @@ pub fn read_crates(diag: span_handler,\n             visit_view_item: |a| visit_view_item(e, a),\n             visit_item: |a| visit_item(e, a),\n             .. *visit::default_simple_visitor()});\n+    visit_crate(e, crate);\n     visit::visit_crate(crate, (), v);\n     dump_crates(e.crate_cache);\n     warn_if_multiple_versions(e, diag, e.crate_cache);\n@@ -125,6 +126,20 @@ struct Env {\n     intr: @ident_interner\n }\n \n+fn visit_crate(e: @mut Env, c: ast::crate) {\n+    let cstore = e.cstore;\n+    let link_args = attr::find_attrs_by_name(c.node.attrs, \"link_args\");\n+\n+    for link_args.each |a| {\n+        match attr::get_meta_item_value_str(attr::attr_meta(*a)) {\n+          Some(ref linkarg) => {\n+            cstore::add_used_link_args(cstore, (/*bad*/copy *linkarg));\n+          }\n+          None => {/* fallthrough */ }\n+        }\n+    }\n+}\n+\n fn visit_view_item(e: @mut Env, i: @ast::view_item) {\n     match /*bad*/copy i.node {\n       ast::view_item_use(ident, meta_items, id) => {\n@@ -181,7 +196,7 @@ fn visit_item(e: @mut Env, i: @ast::item) {\n         for link_args.each |a| {\n             match attr::get_meta_item_value_str(attr::attr_meta(*a)) {\n               Some(ref linkarg) => {\n-                cstore::add_used_link_args(cstore, (/*bad*/copy *linkarg));\n+                cstore::add_used_link_args(cstore, *linkarg);\n               }\n               None => {/* fallthrough */ }\n             }"}, {"sha": "84a588e48860cfa596631b03b02c376d2eb898fa", "filename": "src/librustc/metadata/cstore.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1171a214a633128bbbd067bd0e582f8b40172e01/src%2Flibrustc%2Fmetadata%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1171a214a633128bbbd067bd0e582f8b40172e01/src%2Flibrustc%2Fmetadata%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fcstore.rs?ref=1171a214a633128bbbd067bd0e582f8b40172e01", "patch": "@@ -119,7 +119,7 @@ pub fn get_used_libraries(cstore: @mut CStore) -> ~[~str] {\n     return /*bad*/copy cstore.used_libraries;\n }\n \n-pub fn add_used_link_args(cstore: @mut CStore, args: ~str) {\n+pub fn add_used_link_args(cstore: @mut CStore, args: &str) {\n     cstore.used_link_args.push_all(str::split_char(args, ' '));\n }\n "}]}