{"sha": "e3b498971dfb5009f15700d103c88a6c427edd30", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzYjQ5ODk3MWRmYjUwMDlmMTU3MDBkMTAzYzg4YTZjNDI3ZWRkMzA=", "commit": {"author": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2017-09-30T06:52:51Z"}, "committer": {"name": "Zack M. Davis", "email": "code@zackmdavis.net", "date": "2017-09-30T18:31:12Z"}, "message": "code suggestions for unused-mut, while-true lints; UI test", "tree": {"sha": "7d591f8ba63fc30d458eccda7629ebf82751e36a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d591f8ba63fc30d458eccda7629ebf82751e36a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3b498971dfb5009f15700d103c88a6c427edd30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3b498971dfb5009f15700d103c88a6c427edd30", "html_url": "https://github.com/rust-lang/rust/commit/e3b498971dfb5009f15700d103c88a6c427edd30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3b498971dfb5009f15700d103c88a6c427edd30/comments", "author": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "zackmdavis", "id": 1076988, "node_id": "MDQ6VXNlcjEwNzY5ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/1076988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackmdavis", "html_url": "https://github.com/zackmdavis", "followers_url": "https://api.github.com/users/zackmdavis/followers", "following_url": "https://api.github.com/users/zackmdavis/following{/other_user}", "gists_url": "https://api.github.com/users/zackmdavis/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackmdavis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackmdavis/subscriptions", "organizations_url": "https://api.github.com/users/zackmdavis/orgs", "repos_url": "https://api.github.com/users/zackmdavis/repos", "events_url": "https://api.github.com/users/zackmdavis/events{/privacy}", "received_events_url": "https://api.github.com/users/zackmdavis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c9f806d7860a281346743b31529230d5480deef", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c9f806d7860a281346743b31529230d5480deef", "html_url": "https://github.com/rust-lang/rust/commit/5c9f806d7860a281346743b31529230d5480deef"}], "stats": {"total": 89, "additions": 81, "deletions": 8}, "files": [{"sha": "7f331418d4242193bf597e6063fe5ef2551df518", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -76,9 +76,13 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for WhileTrue {\n             if let hir::ExprLit(ref lit) = cond.node {\n                 if let ast::LitKind::Bool(true) = lit.node {\n                     if lit.span.ctxt() == SyntaxContext::empty() {\n-                        cx.span_lint(WHILE_TRUE,\n-                                    e.span,\n-                                    \"denote infinite loops with loop { ... }\");\n+                        let msg = \"denote infinite loops with `loop { ... }`\";\n+                        let mut err = cx.struct_span_lint(WHILE_TRUE, e.span, msg);\n+                        let condition_span = cx.tcx.sess.codemap().def_span(e.span);\n+                        err.span_suggestion_short(condition_span,\n+                                                  \"use `loop`\",\n+                                                  \"loop\".to_owned());\n+                        err.emit();\n                     }\n                 }\n             }"}, {"sha": "887245b15d35762d1e0634b86df9a52da269bfb0", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -71,9 +71,13 @@ impl UnusedMut {\n         let used_mutables = cx.tcx.used_mut_nodes.borrow();\n         for (_, v) in &mutables {\n             if !v.iter().any(|e| used_mutables.contains(e)) {\n-                cx.span_lint(UNUSED_MUT,\n-                             cx.tcx.hir.span(v[0]),\n-                             \"variable does not need to be mutable\");\n+                let binding_span = cx.tcx.hir.span(v[0]);\n+                let mut_span = cx.tcx.sess.codemap().span_until_char(binding_span, ' ');\n+                let mut err = cx.struct_span_lint(UNUSED_MUT,\n+                                                  binding_span,\n+                                                  \"variable does not need to be mutable\");\n+                err.span_suggestion_short(mut_span, \"remove this `mut`\", \"\".to_owned());\n+                err.emit();\n             }\n         }\n     }"}, {"sha": "9de3040bb616c0c4707312271581b123da881ac7", "filename": "src/test/compile-fail/issue-1962.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fcompile-fail%2Fissue-1962.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fcompile-fail%2Fissue-1962.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-1962.rs?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -11,7 +11,7 @@\n // compile-flags: -D while-true\n fn main() {\n   let mut i = 0;\n-  while true  { //~ ERROR denote infinite loops with loop\n+  while true  { //~ ERROR denote infinite loops with `loop\n     i += 1;\n     if i == 5 { break; }\n   }"}, {"sha": "874124a7d36583227207344ac93128198b1e15c0", "filename": "src/test/ui/lint/suggestions.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fsuggestions.rs?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![warn(unused_mut)] // UI tests pass `-A unused`\u2014see Issue #43896\n+#![feature(no_debug)]\n+\n+#[no_debug] // should suggest removal of deprecated attribute\n+fn main() {\n+    while true { // should suggest `loop`\n+        let mut a = (1); // should suggest no `mut`, no parens\n+        println!(\"{}\", a);\n+    }\n+}"}, {"sha": "5b2a4f589f7381c0b15cff47ca8c785ec3aed91e", "filename": "src/test/ui/lint/suggestions.stderr", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fsuggestions.stderr?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -0,0 +1,45 @@\n+warning: unnecessary parentheses around assigned value\n+  --> $DIR/suggestions.rs:17:21\n+   |\n+17 |         let mut a = (1); // should suggest no `mut`, no parens\n+   |                     ^^^ help: remove these parentheses\n+   |\n+   = note: #[warn(unused_parens)] on by default\n+\n+warning: use of deprecated attribute `no_debug`: the `#[no_debug]` attribute was an experimental feature that has been deprecated due to lack of demand. See https://github.com/rust-lang/rust/issues/29721\n+  --> $DIR/suggestions.rs:14:1\n+   |\n+14 | #[no_debug] // should suggest removal of deprecated attribute\n+   | ^^^^^^^^^^^ help: remove this attribute\n+   |\n+   = note: #[warn(deprecated)] on by default\n+\n+warning: denote infinite loops with `loop { ... }`\n+  --> $DIR/suggestions.rs:16:5\n+   |\n+16 |       while true { // should suggest `loop`\n+   |       ^---------\n+   |       |\n+   |  _____help: use `loop`\n+   | |\n+17 | |         let mut a = (1); // should suggest no `mut`, no parens\n+18 | |         println!(\"{}\", a);\n+19 | |     }\n+   | |_____^\n+   |\n+   = note: #[warn(while_true)] on by default\n+\n+warning: variable does not need to be mutable\n+  --> $DIR/suggestions.rs:17:13\n+   |\n+17 |         let mut a = (1); // should suggest no `mut`, no parens\n+   |             ---^^\n+   |             |\n+   |             help: remove this `mut`\n+   |\n+note: lint level defined here\n+  --> $DIR/suggestions.rs:11:9\n+   |\n+11 | #![warn(unused_mut)] // UI tests pass `-A unused`\u2014see Issue #43896\n+   |         ^^^^^^^^^^\n+"}, {"sha": "19e22b3f6f94fc8c10aa82f013f0b1ced61ca61e", "filename": "src/test/ui/path-lookahead.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Fpath-lookahead.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e3b498971dfb5009f15700d103c88a6c427edd30/src%2Ftest%2Fui%2Fpath-lookahead.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpath-lookahead.stderr?ref=e3b498971dfb5009f15700d103c88a6c427edd30", "patch": "@@ -2,7 +2,7 @@ warning: unnecessary parentheses around `return` value\n   --> $DIR/path-lookahead.rs:18:10\n    |\n 18 |   return (<T as ToString>::to_string(&arg)); //~WARN unnecessary parentheses around `return` value\n-   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: remove these parentheses\n    |\n    = note: #[warn(unused_parens)] on by default\n "}]}