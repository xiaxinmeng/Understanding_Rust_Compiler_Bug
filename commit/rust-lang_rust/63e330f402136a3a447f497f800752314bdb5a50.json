{"sha": "63e330f402136a3a447f497f800752314bdb5a50", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzZTMzMGY0MDIxMzZhM2E0NDdmNDk3ZjgwMDc1MjMxNGJkYjVhNTA=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-01-02T14:06:59Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2021-01-02T14:06:59Z"}, "message": "Fix infer error of macro invocation in array expr", "tree": {"sha": "1c91f2d7ce2d2d3251e4fe25a7223451e75ea1d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c91f2d7ce2d2d3251e4fe25a7223451e75ea1d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/63e330f402136a3a447f497f800752314bdb5a50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/63e330f402136a3a447f497f800752314bdb5a50", "html_url": "https://github.com/rust-lang/rust/commit/63e330f402136a3a447f497f800752314bdb5a50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/63e330f402136a3a447f497f800752314bdb5a50/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51d29fe55456e6e7af69d23982aa57c7fcf91e81", "url": "https://api.github.com/repos/rust-lang/rust/commits/51d29fe55456e6e7af69d23982aa57c7fcf91e81", "html_url": "https://github.com/rust-lang/rust/commit/51d29fe55456e6e7af69d23982aa57c7fcf91e81"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "0a0d021e055381e871162f938dc8739e16242ac7", "filename": "crates/hir_expand/src/db.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/63e330f402136a3a447f497f800752314bdb5a50/crates%2Fhir_expand%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63e330f402136a3a447f497f800752314bdb5a50/crates%2Fhir_expand%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fdb.rs?ref=63e330f402136a3a447f497f800752314bdb5a50", "patch": "@@ -404,7 +404,7 @@ fn to_fragment_kind(db: &dyn AstDatabase, id: MacroCallId) -> FragmentKind {\n         TRY_EXPR => FragmentKind::Expr,\n         TUPLE_EXPR => FragmentKind::Expr,\n         PAREN_EXPR => FragmentKind::Expr,\n-\n+        ARRAY_EXPR => FragmentKind::Expr,\n         FOR_EXPR => FragmentKind::Expr,\n         PATH_EXPR => FragmentKind::Expr,\n         CLOSURE_EXPR => FragmentKind::Expr,"}, {"sha": "cffe8630b47350215e2c43930953c4ffac523636", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/63e330f402136a3a447f497f800752314bdb5a50/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/63e330f402136a3a447f497f800752314bdb5a50/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=63e330f402136a3a447f497f800752314bdb5a50", "patch": "@@ -325,6 +325,24 @@ fn infer_paren_macro_call() {\n     );\n }\n \n+#[test]\n+fn infer_array_macro_call() {\n+    check_infer(\n+        r#\"\n+        macro_rules! bar { () => {0u32} }\n+        fn test() {\n+            let a = [bar!()];\n+        }\n+        \"#,\n+        expect![[r#\"\n+            !0..4 '0u32': u32\n+            44..69 '{     ...()]; }': ()\n+            54..55 'a': [u32; _]\n+            58..66 '[bar!()]': [u32; _]\n+        \"#]],\n+    );\n+}\n+\n #[test]\n fn bug_1030() {\n     check_infer("}]}