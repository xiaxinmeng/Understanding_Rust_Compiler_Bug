{"sha": "ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVjNThkMGM5OTc2YzE4YzQwNWE1OWQyNjI1MmExZmE3YTNlMmE3NDI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-07-05T15:25:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-07-05T15:25:37Z"}, "message": "Auto merge of #34412 - gnzlbg:document_platform_intrinsics_generate, r=alexcrichton\n\nAdd x86 intrinsics for bit manipulation (BMI 1.0, BMI 2.0, and TBM).\n\nThis PR adds the LLVM x86 intrinsics for the bit manipulation instruction sets (BMI 1.0, BMI 2.0, and TBM).\n\nThe objective of this pull-request is to allow building a library that implements all the algorithms offered by those instruction sets, using compiler intrinsics for the targets that support them (by means of `target_feature`).\n\nThe target features added are:\n\n- `bmi`: Bit Manipulation Instruction Set 1.0, available in Intel >= Haswell and AMD's >= Jaguar/Piledriver,\n- `bmi2`: Bit Manipulation Instruction Set 2.0, available in Intel >= Haswell and AMD's >= Excavator,\n- `tbm`: Trailing Bit Manipulation, available only in AMD's Piledriver (won't be available in newer CPUs).\n\nThe intrinsics added are:\n\n- BMI 1.0:\n  - `bextr`: Bit field extract (with register).\n- BMI 2.0:\n  - `bzhi`: Zero high bits starting with specified bit position.\n  - `pdep`: Parallel bits deposit.\n  - `pext`: Parallel bits extract.\n- TBM:\n - `bextri`: Bit field extract (with immediate).", "tree": {"sha": "0906524fcaa564987dd163b474faf3a73ffb8c5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0906524fcaa564987dd163b474faf3a73ffb8c5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "html_url": "https://github.com/rust-lang/rust/commit/ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd0ea6050204c6f297fca8cf4fdc859b7d76f4be", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd0ea6050204c6f297fca8cf4fdc859b7d76f4be", "html_url": "https://github.com/rust-lang/rust/commit/cd0ea6050204c6f297fca8cf4fdc859b7d76f4be"}, {"sha": "483bec790b28d03f318b8cfbe053e284677b6be2", "url": "https://api.github.com/repos/rust-lang/rust/commits/483bec790b28d03f318b8cfbe053e284677b6be2", "html_url": "https://github.com/rust-lang/rust/commit/483bec790b28d03f318b8cfbe053e284677b6be2"}], "stats": {"total": 1874, "additions": 1012, "deletions": 862}, "files": [{"sha": "c8cda4077b79075b4d32a3db7bddcab04b5d4dfd", "filename": "src/etc/platform-intrinsics/aarch64.json", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,6 +1,6 @@\n {\n-    \"platform\": \"aarch64\",\n-    \"intrinsic_prefix\": \"aarch64_v\",\n+    \"platform\": \"aarch64_v\",\n+    \"intrinsic_prefix\": \"\",\n     \"llvm_prefix\": \"llvm.aarch64.neon.\",\n     \"number_info\": {\n         \"signed\": {"}, {"sha": "39e49e239f34dfcc64e67a71933a0f89ec4037ed", "filename": "src/etc/platform-intrinsics/arm.json", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Farm.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Farm.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Farm.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,6 +1,6 @@\n {\n-    \"platform\": \"arm\",\n-    \"intrinsic_prefix\": \"arm_v\",\n+    \"platform\": \"arm_v\",\n+    \"intrinsic_prefix\": \"\",\n     \"llvm_prefix\": \"llvm.neon.v\",\n     \"number_info\": {\n         \"signed\": {"}, {"sha": "a4a91170efb3b5334e9f874a48240059a7f7d903", "filename": "src/etc/platform-intrinsics/generator.py", "status": "modified", "additions": 39, "deletions": 8, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -26,10 +26,9 @@\n class PlatformInfo(object):\n     def __init__(self, json):\n         self._platform = json['platform']\n-        self._intrinsic_prefix = json['intrinsic_prefix']\n \n-    def intrinsic_prefix(self):\n-        return self._intrinsic_prefix\n+    def platform_prefix(self):\n+        return self._platform\n \n class IntrinsicSet(object):\n     def __init__(self, platform, json):\n@@ -38,6 +37,7 @@ def __init__(self, platform, json):\n         self._intrinsics = json['intrinsics']\n         self._widths = json['width_info']\n         self._platform = platform\n+        self._intrinsic_prefix = json['intrinsic_prefix']\n \n     def intrinsics(self):\n         for raw in self._intrinsics:\n@@ -48,6 +48,9 @@ def intrinsics(self):\n     def platform(self):\n         return self._platform\n \n+    def intrinsic_prefix(self):\n+        return self._intrinsic_prefix\n+\n     def llvm_prefix(self):\n         return self._llvm_prefix\n \n@@ -538,8 +541,14 @@ def intrinsic_suffix(self):\n                                       *self._args,\n                                       width = self._width)\n \n+    def platform_prefix(self):\n+        return self._platform.platform().platform_prefix()\n+\n+    def intrinsic_set_name(self):\n+        return self._platform.intrinsic_prefix()\n+\n     def intrinsic_name(self):\n-        return self._platform.platform().intrinsic_prefix() + self.intrinsic_suffix()\n+        return self._platform.intrinsic_prefix() + self.intrinsic_suffix()\n \n     def compiler_args(self):\n         return ', '.join(arg.compiler_ctor_ref() for arg in self._args_raw)\n@@ -561,6 +570,27 @@ def parse_args():\n         formatter_class = argparse.RawDescriptionHelpFormatter,\n         description = 'Render an intrinsic definition JSON to various formats.',\n         epilog = textwrap.dedent('''\\\n+        Quick How-To:\n+\n+        There are two operating modes: single file and multiple files.\n+\n+        For example, ARM is specified as a single file. To generate the\n+        compiler-definitions for ARM just pass the script the \"arm.json\" file:\n+\n+        python generator.py --format compiler-defs arm.json\n+\n+        The X86 architecture is specified as multiple files (for the different\n+        instruction sets that x86 supports). To generate the compiler\n+        definitions one needs to pass the script a \"platform information file\"\n+        (with the -i flag) next to the files of the different intruction sets.\n+        For example, to generate the X86 compiler-definitions for SSE4.2, just:\n+\n+        python generator.py --format compiler-defs -i x86/info.json sse42.json\n+\n+        And to generate the compiler-definitions for SSE4.1 and SSE4.2, just:\n+\n+        python generator.py --format compiler-defs -i x86/info.json sse41.json sse42.json\n+\n         An intrinsic definition consists of a map with fields:\n         - intrinsic: pattern for the name(s) of the vendor's C intrinsic(s)\n         - llvm: pattern for the name(s) of the internal llvm intrinsic(s)\n@@ -730,8 +760,9 @@ def open(self, platform):\n         return 'extern \"platform-intrinsic\" {'\n \n     def render(self, mono):\n-        return '    fn {}{};'.format(mono.intrinsic_name(),\n-                                     mono.intrinsic_signature())\n+        return '    fn {}{}{};'.format(mono.platform_prefix(),\n+                                       mono.intrinsic_name(),\n+                                       mono.intrinsic_signature())\n \n     def close(self):\n         return '}'\n@@ -765,15 +796,15 @@ def open(self, platform):\n #[inline(never)]\n pub fn find(name: &str) -> Option<Intrinsic> {{\n     if !name.starts_with(\"{0}\") {{ return None }}\n-    Some(match &name[\"{0}\".len()..] {{'''.format(platform.intrinsic_prefix())\n+    Some(match &name[\"{0}\".len()..] {{'''.format(platform.platform_prefix())\n \n     def render(self, mono):\n         return '''\\\n         \"{}\" => Intrinsic {{\n             inputs: {{ static INPUTS: [&'static Type; {}] = [{}]; &INPUTS }},\n             output: {},\n             definition: Named(\"{}\")\n-        }},'''.format(mono.intrinsic_suffix(),\n+        }},'''.format(mono.intrinsic_set_name() + mono.intrinsic_suffix(),\n                       len(mono._args_raw),\n                       mono.compiler_args(),\n                       mono.compiler_ret(),"}, {"sha": "1f41e2ecf3e6d29ba0eb6d4d7d52c981faf40d94", "filename": "src/etc/platform-intrinsics/x86/avx.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.avx.\",\n     \"intrinsics\": [\n         {"}, {"sha": "4e006c1c4cf417c512e32a5c8582d5f86600f142", "filename": "src/etc/platform-intrinsics/x86/avx2.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.avx2.\",\n     \"intrinsics\": [\n         {"}, {"sha": "24e2cbcf8aad10702b1a42651bdb2bb2513c6834", "filename": "src/etc/platform-intrinsics/x86/bmi.json", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -0,0 +1,13 @@\n+{\n+    \"intrinsic_prefix\": \"_bmi\",\n+    \"llvm_prefix\": \"llvm.x86.bmi.\",\n+    \"intrinsics\": [\n+        {\n+            \"intrinsic\": \"_bextr_{0.bitwidth}\",\n+            \"width\": [\"0\"],\n+            \"llvm\": \"bextr.{0.bitwidth}\",\n+            \"ret\": \"S(32-64)u\",\n+            \"args\": [\"0\", \"0\"]\n+        }\n+    ]\n+}"}, {"sha": "f5a0db5ef51da359b14ef74211602639722f17a7", "filename": "src/etc/platform-intrinsics/x86/bmi2.json", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi2.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi2.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fbmi2.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -0,0 +1,27 @@\n+{\n+    \"intrinsic_prefix\": \"_bmi2\",\n+    \"llvm_prefix\": \"llvm.x86.bmi.\",\n+    \"intrinsics\": [\n+        {\n+            \"intrinsic\": \"_bzhi_{0.bitwidth}\",\n+            \"width\": [\"0\"],\n+            \"llvm\": \"bzhi.{0.bitwidth}\",\n+            \"ret\": \"S(32-64)u\",\n+            \"args\": [\"0\", \"0\"]\n+        },\n+        {\n+            \"intrinsic\": \"_pdep_{0.bitwidth}\",\n+            \"width\": [\"0\"],\n+            \"llvm\": \"pdep.{0.bitwidth}\",\n+            \"ret\": \"S(32-64)u\",\n+            \"args\": [\"0\", \"0\"]\n+        },\n+        {\n+            \"intrinsic\": \"_pext_{0.bitwidth}\",\n+            \"width\": [\"0\"],\n+            \"llvm\": \"pext.{0.bitwidth}\",\n+            \"ret\": \"S(32-64)u\",\n+            \"args\": [\"0\", \"0\"]\n+        }\n+    ]\n+}"}, {"sha": "dcc26cd501c9bdbfaab71869e60baceba59f7663", "filename": "src/etc/platform-intrinsics/x86/fma.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.fma.\",\n     \"intrinsics\": [\n         {"}, {"sha": "8e90b8579c49ef996a33307d4903f6e95a4862f5", "filename": "src/etc/platform-intrinsics/x86/info.json", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,26 +1,30 @@\n {\n     \"platform\": \"x86\",\n-    \"intrinsic_prefix\": \"x86_mm\",\n     \"number_info\": {\n         \"signed\": {\n             \"kind\": \"s\",\n             \"kind_short\": \"\",\n             \"data_type\": { \"pattern\": \"epi{bitwidth}\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"8\": \"b\", \"16\": \"w\", \"32\": \"d\", \"64\": \"q\" }\n         },\n         \"unsigned\": {\n             \"kind\": \"u\",\n             \"kind_short\": \"u\",\n             \"data_type\": { \"pattern\": \"epu{bitwidth}\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"8\": \"b\", \"16\": \"w\", \"32\": \"d\", \"64\": \"q\" }\n         },\n         \"float\": {\n             \"kind\": \"f\",\n             \"data_type\": { \"32\": \"ps\", \"64\": \"pd\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"32\": \"ps\", \"64\": \"pd\" }\n         }\n     },\n     \"width_info\": {\n+        \"32\":  { \"width_mm\": \"32\", \"width_suffix\": \"\" },\n+        \"64\":  { \"width_mm\": \"64\", \"width_suffix\": \"\" },\n         \"128\": { \"width_mm\": \"\", \"width_suffix\": \"\" },\n         \"256\": { \"width_mm\": \"256\", \"width_suffix\": \".256\" },\n         \"512\": { \"width_mm\": \"512\", \"width_suffix\": \".512\" }"}, {"sha": "d8eef8a3514aec7267107d6526dcdc214d596ad2", "filename": "src/etc/platform-intrinsics/x86/sse.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse.\",\n     \"intrinsics\": [\n         {"}, {"sha": "4d6317d80a57e306ce117902e31570b33c21bb83", "filename": "src/etc/platform-intrinsics/x86/sse2.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse2.\",\n     \"intrinsics\": [\n         {"}, {"sha": "119bf208f7e3437d48e8e143f982891da8c176e7", "filename": "src/etc/platform-intrinsics/x86/sse3.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse3.\",\n     \"intrinsics\": [\n         {"}, {"sha": "b499637e0d3c6f5046a5a3107c5da7cfaf2afacf", "filename": "src/etc/platform-intrinsics/x86/sse41.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse41.\",\n     \"intrinsics\": [\n         {"}, {"sha": "fdee9c8a6671b9e2d914185b6629da4da20be93c", "filename": "src/etc/platform-intrinsics/x86/sse42.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse42.\",\n     \"intrinsics\": [\n         {"}, {"sha": "5a5617957b3e5b78597a0b4a86cadd3e4838d646", "filename": "src/etc/platform-intrinsics/x86/ssse3.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.ssse3.\",\n     \"intrinsics\": [\n         {"}, {"sha": "d1322cd60c4cfe2d8601c3f0fab316576afef135", "filename": "src/etc/platform-intrinsics/x86/tbm.json", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ftbm.json", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ftbm.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ftbm.json?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -0,0 +1,13 @@\n+{\n+    \"intrinsic_prefix\": \"_tbm\",\n+    \"llvm_prefix\": \"llvm.x86.tbm.\",\n+    \"intrinsics\": [\n+        {\n+            \"intrinsic\": \"_bextri_u{0.bitwidth}\",\n+            \"width\": [\"0\"],\n+            \"llvm\": \"bextri.u{0.bitwidth}\",\n+            \"ret\": \"S(32-64)u\",\n+            \"args\": [\"0\", \"0\"]\n+        }\n+    ]\n+}"}, {"sha": "f2020303089d2e3d52fef55df7ca4d3986b4e98a", "filename": "src/librustc_driver/target_features.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Flibrustc_driver%2Ftarget_features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Flibrustc_driver%2Ftarget_features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Ftarget_features.rs?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742", "patch": "@@ -30,12 +30,15 @@ const ARM_WHITELIST: &'static [&'static str] = &[\n const X86_WHITELIST: &'static [&'static str] = &[\n     \"avx\\0\",\n     \"avx2\\0\",\n+    \"bmi\\0\",\n+    \"bmi2\\0\",\n     \"sse\\0\",\n     \"sse2\\0\",\n     \"sse3\\0\",\n     \"sse4.1\\0\",\n     \"sse4.2\\0\",\n     \"ssse3\\0\",\n+    \"tbm\\0\",\n ];\n \n /// Add `target_feature = \"...\"` cfgs for a variety of platform"}, {"sha": "91ecad8402fd40b2df5e50b97da5d7910d8c7614", "filename": "src/librustc_platform_intrinsics/x86.rs", "status": "modified", "additions": 899, "deletions": 849, "changes": 1748, "blob_url": "https://github.com/rust-lang/rust/blob/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Flibrustc_platform_intrinsics%2Fx86.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec58d0c9976c18c405a59d26252a1fa7a3e2a742/src%2Flibrustc_platform_intrinsics%2Fx86.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_platform_intrinsics%2Fx86.rs?ref=ec58d0c9976c18c405a59d26252a1fa7a3e2a742"}]}