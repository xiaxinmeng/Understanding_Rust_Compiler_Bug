{"sha": "21f754de2ac507c8ebc50d857264c224c1c76120", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxZjc1NGRlMmFjNTA3YzhlYmM1MGQ4NTcyNjRjMjI0YzFjNzYxMjA=", "commit": {"author": {"name": "Bastian Kauschke", "email": "bastian_kauschke@hotmail.de", "date": "2020-11-12T14:39:21Z"}, "committer": {"name": "Bastian Kauschke", "email": "bastian_kauschke@hotmail.de", "date": "2020-11-12T14:39:21Z"}, "message": "check `Drop` specialization of const params", "tree": {"sha": "253be036ce6b8bd7c0eb0e884f134de18376c445", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/253be036ce6b8bd7c0eb0e884f134de18376c445"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21f754de2ac507c8ebc50d857264c224c1c76120", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21f754de2ac507c8ebc50d857264c224c1c76120", "html_url": "https://github.com/rust-lang/rust/commit/21f754de2ac507c8ebc50d857264c224c1c76120", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21f754de2ac507c8ebc50d857264c224c1c76120/comments", "author": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3539259795a6f1f5fa6c2ccb8fe1fb5b12af6e59", "url": "https://api.github.com/repos/rust-lang/rust/commits/3539259795a6f1f5fa6c2ccb8fe1fb5b12af6e59", "html_url": "https://github.com/rust-lang/rust/commit/3539259795a6f1f5fa6c2ccb8fe1fb5b12af6e59"}], "stats": {"total": 89, "additions": 61, "deletions": 28}, "files": [{"sha": "02e8665cd2e3be1a67aa06a3b880cc4a87a6be42", "filename": "src/test/ui/dropck/reject-specialized-drops-8142.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/21f754de2ac507c8ebc50d857264c224c1c76120/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21f754de2ac507c8ebc50d857264c224c1c76120/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.rs?ref=21f754de2ac507c8ebc50d857264c224c1c76120", "patch": "@@ -1,5 +1,6 @@\n // Issue 8142: Test that Drop impls cannot be specialized beyond the\n // predicates attached to the type definition itself.\n+#![feature(min_const_generics)]\n \n trait Bound { fn foo(&self) { } }\n struct K<'l1,'l2> { x: &'l1 i8, y: &'l2 u8 }\n@@ -15,6 +16,8 @@ struct T<'t,Ts:'t> { x: &'t Ts }\n struct U;\n struct V<Tva, Tvb> { x: *const Tva, y: *const Tvb }\n struct W<'l1, 'l2> { x: &'l1 i8, y: &'l2 u8 }\n+struct X<const Ca: usize>;\n+struct Y<const Ca: usize, const Cb: usize>;\n \n enum Enum<T> { Variant(T) }\n struct TupleStruct<T>(T);\n@@ -58,6 +61,12 @@ impl<One>         Drop for V<One,One>     { fn drop(&mut self) { } } // REJECT\n impl<'lw>         Drop for W<'lw,'lw>     { fn drop(&mut self) { } } // REJECT\n //~^ ERROR cannot infer an appropriate lifetime for lifetime parameter `'lw`\n \n+impl              Drop for X<3>           { fn drop(&mut self) { } } // REJECT\n+//~^ ERROR `Drop` impls cannot be specialized\n+\n+impl<const Ca: usize> Drop for Y<Ca, Ca>     { fn drop(&mut self) { } } // REJECT\n+//~^ ERROR `Drop` impls cannot be specialized\n+\n impl<AddsBnd:Bound> Drop for Enum<AddsBnd> { fn drop(&mut self) { } } // REJECT\n //~^ ERROR `Drop` impl requires `AddsBnd: Bound`\n "}, {"sha": "284cf59c822bd2b34a88eb25542ee899c98f9f63", "filename": "src/test/ui/dropck/reject-specialized-drops-8142.stderr", "status": "modified", "additions": 52, "deletions": 28, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/21f754de2ac507c8ebc50d857264c224c1c76120/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/21f754de2ac507c8ebc50d857264c224c1c76120/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdropck%2Freject-specialized-drops-8142.stderr?ref=21f754de2ac507c8ebc50d857264c224c1c76120", "patch": "@@ -1,151 +1,175 @@\n error[E0367]: `Drop` impl requires `'adds_bnd: 'al` but the struct it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:23:20\n+  --> $DIR/reject-specialized-drops-8142.rs:26:20\n    |\n LL | impl<'al,'adds_bnd:'al> Drop for K<'al,'adds_bnd> {                        // REJECT\n    |                    ^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:5:1\n+  --> $DIR/reject-specialized-drops-8142.rs:6:1\n    |\n LL | struct K<'l1,'l2> { x: &'l1 i8, y: &'l2 u8 }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0367]: `Drop` impl requires `'adds_bnd: 'al` but the struct it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:27:67\n+  --> $DIR/reject-specialized-drops-8142.rs:30:67\n    |\n LL | impl<'al,'adds_bnd>     Drop for L<'al,'adds_bnd> where 'adds_bnd:'al {    // REJECT\n    |                                                                   ^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:6:1\n+  --> $DIR/reject-specialized-drops-8142.rs:7:1\n    |\n LL | struct L<'l1,'l2> { x: &'l1 i8, y: &'l2 u8 }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0308]: mismatched types\n-  --> $DIR/reject-specialized-drops-8142.rs:33:1\n+  --> $DIR/reject-specialized-drops-8142.rs:36:1\n    |\n LL | impl                    Drop for N<'static>     { fn drop(&mut self) { } } // REJECT\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ lifetime mismatch\n    |\n    = note: expected struct `N<'n>`\n               found struct `N<'static>`\n-note: the lifetime `'n` as defined on the struct at 8:10...\n-  --> $DIR/reject-specialized-drops-8142.rs:8:10\n+note: the lifetime `'n` as defined on the struct at 9:10...\n+  --> $DIR/reject-specialized-drops-8142.rs:9:10\n    |\n LL | struct N<'n> { x: &'n i8 }\n    |          ^^\n    = note: ...does not necessarily outlive the static lifetime\n \n error[E0366]: `Drop` impls cannot be specialized\n-  --> $DIR/reject-specialized-drops-8142.rs:40:1\n+  --> $DIR/reject-specialized-drops-8142.rs:43:1\n    |\n LL | impl              Drop for P<i8>          { fn drop(&mut self) { } } // REJECT\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n note: use the same sequence of generic type, lifetime and const parameters as the struct definition\n-  --> $DIR/reject-specialized-drops-8142.rs:10:1\n+  --> $DIR/reject-specialized-drops-8142.rs:11:1\n    |\n LL | struct P<Tp> { x: *const Tp }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0367]: `Drop` impl requires `AddsBnd: Bound` but the struct it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:43:14\n+  --> $DIR/reject-specialized-drops-8142.rs:46:14\n    |\n LL | impl<AddsBnd:Bound> Drop for Q<AddsBnd> { fn drop(&mut self) { } } // REJECT\n    |              ^^^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:11:1\n+  --> $DIR/reject-specialized-drops-8142.rs:12:1\n    |\n LL | struct Q<Tq> { x: *const Tq }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0367]: `Drop` impl requires `AddsRBnd: 'rbnd` but the struct it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:46:21\n+  --> $DIR/reject-specialized-drops-8142.rs:49:21\n    |\n LL | impl<'rbnd,AddsRBnd:'rbnd> Drop for R<AddsRBnd> { fn drop(&mut self) { } } // REJECT\n    |                     ^^^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:12:1\n+  --> $DIR/reject-specialized-drops-8142.rs:13:1\n    |\n LL | struct R<Tr> { x: *const Tr }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0366]: `Drop` impls cannot be specialized\n-  --> $DIR/reject-specialized-drops-8142.rs:55:1\n+  --> $DIR/reject-specialized-drops-8142.rs:58:1\n    |\n LL | impl<One>         Drop for V<One,One>     { fn drop(&mut self) { } } // REJECT\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n note: use the same sequence of generic type, lifetime and const parameters as the struct definition\n-  --> $DIR/reject-specialized-drops-8142.rs:16:1\n+  --> $DIR/reject-specialized-drops-8142.rs:17:1\n    |\n LL | struct V<Tva, Tvb> { x: *const Tva, y: *const Tvb }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0495]: cannot infer an appropriate lifetime for lifetime parameter `'lw` due to conflicting requirements\n-  --> $DIR/reject-specialized-drops-8142.rs:58:1\n+  --> $DIR/reject-specialized-drops-8142.rs:61:1\n    |\n LL | impl<'lw>         Drop for W<'lw,'lw>     { fn drop(&mut self) { } } // REJECT\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n-note: first, the lifetime cannot outlive the lifetime `'l1` as defined on the struct at 17:10...\n-  --> $DIR/reject-specialized-drops-8142.rs:17:10\n+note: first, the lifetime cannot outlive the lifetime `'l1` as defined on the struct at 18:10...\n+  --> $DIR/reject-specialized-drops-8142.rs:18:10\n    |\n LL | struct W<'l1, 'l2> { x: &'l1 i8, y: &'l2 u8 }\n    |          ^^^\n-note: ...but the lifetime must also be valid for the lifetime `'l2` as defined on the struct at 17:15...\n-  --> $DIR/reject-specialized-drops-8142.rs:17:15\n+note: ...but the lifetime must also be valid for the lifetime `'l2` as defined on the struct at 18:15...\n+  --> $DIR/reject-specialized-drops-8142.rs:18:15\n    |\n LL | struct W<'l1, 'l2> { x: &'l1 i8, y: &'l2 u8 }\n    |               ^^^\n note: ...so that the types are compatible\n-  --> $DIR/reject-specialized-drops-8142.rs:58:1\n+  --> $DIR/reject-specialized-drops-8142.rs:61:1\n    |\n LL | impl<'lw>         Drop for W<'lw,'lw>     { fn drop(&mut self) { } } // REJECT\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: expected `W<'l1, 'l2>`\n               found `W<'_, '_>`\n \n+error[E0366]: `Drop` impls cannot be specialized\n+  --> $DIR/reject-specialized-drops-8142.rs:64:1\n+   |\n+LL | impl              Drop for X<3>           { fn drop(&mut self) { } } // REJECT\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: use the same sequence of generic type, lifetime and const parameters as the struct definition\n+  --> $DIR/reject-specialized-drops-8142.rs:19:1\n+   |\n+LL | struct X<const Ca: usize>;\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0366]: `Drop` impls cannot be specialized\n+  --> $DIR/reject-specialized-drops-8142.rs:67:1\n+   |\n+LL | impl<const Ca: usize> Drop for Y<Ca, Ca>     { fn drop(&mut self) { } } // REJECT\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: use the same sequence of generic type, lifetime and const parameters as the struct definition\n+  --> $DIR/reject-specialized-drops-8142.rs:20:1\n+   |\n+LL | struct Y<const Ca: usize, const Cb: usize>;\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error[E0367]: `Drop` impl requires `AddsBnd: Bound` but the enum it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:61:14\n+  --> $DIR/reject-specialized-drops-8142.rs:70:14\n    |\n LL | impl<AddsBnd:Bound> Drop for Enum<AddsBnd> { fn drop(&mut self) { } } // REJECT\n    |              ^^^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:19:1\n+  --> $DIR/reject-specialized-drops-8142.rs:22:1\n    |\n LL | enum Enum<T> { Variant(T) }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0367]: `Drop` impl requires `AddsBnd: Bound` but the struct it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:64:14\n+  --> $DIR/reject-specialized-drops-8142.rs:73:14\n    |\n LL | impl<AddsBnd:Bound> Drop for TupleStruct<AddsBnd> { fn drop(&mut self) { } } // REJECT\n    |              ^^^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:20:1\n+  --> $DIR/reject-specialized-drops-8142.rs:23:1\n    |\n LL | struct TupleStruct<T>(T);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0367]: `Drop` impl requires `AddsBnd: Bound` but the union it is implemented for does not\n-  --> $DIR/reject-specialized-drops-8142.rs:67:21\n+  --> $DIR/reject-specialized-drops-8142.rs:76:21\n    |\n LL | impl<AddsBnd:Copy + Bound> Drop for Union<AddsBnd> { fn drop(&mut self) { } } // REJECT\n    |                     ^^^^^\n    |\n note: the implementor must specify the same requirement\n-  --> $DIR/reject-specialized-drops-8142.rs:21:1\n+  --> $DIR/reject-specialized-drops-8142.rs:24:1\n    |\n LL | union Union<T: Copy> { f: T }\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 11 previous errors\n+error: aborting due to 13 previous errors\n \n Some errors have detailed explanations: E0308, E0366, E0367, E0495.\n For more information about an error, try `rustc --explain E0308`."}]}