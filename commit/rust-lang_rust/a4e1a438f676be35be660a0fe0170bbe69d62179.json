{"sha": "a4e1a438f676be35be660a0fe0170bbe69d62179", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0ZTFhNDM4ZjY3NmJlMzViZTY2MGEwZmUwMTcwYmJlNjlkNjIxNzk=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-02T22:10:19Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-05T20:23:11Z"}, "message": "Cleanup LLVM build rules after rebase onto x64 changes", "tree": {"sha": "2616f0982d4b091d98658cde657e17058bec068e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2616f0982d4b091d98658cde657e17058bec068e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4e1a438f676be35be660a0fe0170bbe69d62179", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4e1a438f676be35be660a0fe0170bbe69d62179", "html_url": "https://github.com/rust-lang/rust/commit/a4e1a438f676be35be660a0fe0170bbe69d62179", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4e1a438f676be35be660a0fe0170bbe69d62179/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "225f50ea9626b9a2813820cf1e03bb82f337f959", "url": "https://api.github.com/repos/rust-lang/rust/commits/225f50ea9626b9a2813820cf1e03bb82f337f959", "html_url": "https://github.com/rust-lang/rust/commit/225f50ea9626b9a2813820cf1e03bb82f337f959"}], "stats": {"total": 26, "additions": 14, "deletions": 12}, "files": [{"sha": "564fd5ab0baa024949c732ae6768028bb7e79f45", "filename": "Makefile.in", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a4e1a438f676be35be660a0fe0170bbe69d62179/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/a4e1a438f676be35be660a0fe0170bbe69d62179/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=a4e1a438f676be35be660a0fe0170bbe69d62179", "patch": "@@ -196,6 +196,7 @@ COMPILER_INPUTS := $(wildcard $(addprefix $(S)src/comp/, \\\n # LLVM macros\n ######################################################################\n \n+# Any rules that depend on LLVM should depend on LLVM_CONFIG\n LLVM_CONFIG:=$(CFG_LLVM_INST_DIR)/bin/llvm-config\n LLVM_VERSION=$(shell \"$(LLVM_CONFIG)\" --version)\n LLVM_BINDIR=$(shell \"$(LLVM_CONFIG)\" --bindir)\n@@ -206,8 +207,8 @@ LLVM_LDFLAGS=$(shell \"$(LLVM_CONFIG)\" --ldflags)\n LLVM_CXXFLAGS=$(shell \"$(LLVM_CONFIG)\" --cxxflags)\n LLVM_HOST_TRIPLE=$(shell \"$(LLVM_CONFIG)\" --host-target)\n \n-LLVM_AS=$(CFG_LLVM_BINDIR)/llvm-as$(X)\n-LLC=$(CFG_LLVM_BINDIR)/llc$(X)\n+LLVM_AS=$(LLVM_BINDIR)/llvm-as$(X)\n+LLC=$(LLVM_BINDIR)/llc$(X)\n \n ######################################################################\n # Exports for sub-utilities"}, {"sha": "c0625cf86013bc4e3791bed52bd1ee2f29c1f332", "filename": "configure", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a4e1a438f676be35be660a0fe0170bbe69d62179/configure", "raw_url": "https://github.com/rust-lang/rust/raw/a4e1a438f676be35be660a0fe0170bbe69d62179/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=a4e1a438f676be35be660a0fe0170bbe69d62179", "patch": "@@ -204,15 +204,16 @@ esac\n case $CFG_CPUTYPE in\n \n     i386 | i486 | i686 | i786 | x86)\n-        CFG_CPUTYPE=i686\n+        CFG_CPUTYPE=i386\n         ;;\n \n     xscale | arm)\n         CFG_CPUTYPE=arm\n         ;;\n \n     x86_64 | x86-64 | x64)\n-        CFG_CPUTYPE=x86_64\n+\t# FIME: Once we do a 64-bit build this should be x86_64\n+        CFG_CPUTYPE=i386\n         ;;\n \n     *)\n@@ -306,17 +307,17 @@ fi\n \n if [ ! -z \"$CFG_LLVM_ROOT\" -a -e \"$CFG_LLVM_ROOT/bin/llvm-config\" ]\n then\n-    step_msg \"using custom LLVM\"\n+    step_msg \"using custom LLVM at $CFG_LLVM_ROOT\"\n \n     LLVM_CONFIG=\"$CFG_LLVM_ROOT/bin/llvm-config\"\n-    LLVM_VERSION=$($CFG_LLVM_CONFIG --version)\n+    LLVM_VERSION=$($LLVM_CONFIG --version)\n \n     case $LLVM_VERSION in\n \t(3.0svn | 3.0 | 3.1svn)\n-\t    step_msg \"found ok version of LLVM: $CFG_LLVM_VERSION\"\n+\t    step_msg \"found ok version of LLVM: $LLVM_VERSION\"\n \t    ;;\n \t(*)\n-\t    err \"bad LLVM version: $CFG_LLVM_VERSION, need >=3.0svn\"\n+\t    err \"bad LLVM version: $LLVM_VERSION, need >=3.0svn\"\n \t    ;;\n     esac\n fi"}, {"sha": "f1dfd824e1e08316e20d1272c4a0759ee0011afe", "filename": "mk/platform.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=a4e1a438f676be35be660a0fe0170bbe69d62179", "patch": "@@ -39,7 +39,7 @@ endif\n \n ifneq ($(findstring linux,$(CFG_OSTYPE)),)\n   CFG_LIB_NAME=lib$(1).so\n-  CFG_GCCISH_CFLAGS += -fPIC -march=i686\n+  CFG_GCCISH_CFLAGS += -fPIC\n   CFG_GCCISH_LINK_FLAGS += -shared -fPIC -ldl -lpthread -lrt\n   CFG_GCCISH_DEF_FLAG := -Wl,--export-dynamic,--dynamic-list=\n   CFG_GCCISH_PRE_LIB_FLAGS := -Wl,-whole-archive"}, {"sha": "0ed9c55e694163708a6f867ed5f408d9bdc9a366", "filename": "mk/rustllvm.mk", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Frustllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Frustllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frustllvm.mk?ref=a4e1a438f676be35be660a0fe0170bbe69d62179", "patch": "@@ -26,8 +26,7 @@ rustllvm/$(1)/$(CFG_RUSTLLVM): $$(RUSTLLVM_OBJS_OBJS_$(1)) \\\n           $$(CFG_GCCISH_POST_LIB_FLAGS) \\\n           $$(LLVM_LDFLAGS),$$(RUSTLLVM_DEF_$(1)),$$(CFG_RUSTLLVM))\n \n-rustllvm/$(1)/%.o: rustllvm/%.cpp $$(MKFILES) \\\n-\t\t$$(CFG_LLVM_INST_DIR)/bin/llvm-config\n+rustllvm/$(1)/%.o: rustllvm/%.cpp $$(MKFILES) $$(LLVM_CONFIG)\n \t@$$(call E, compile: $$@)\n \t$$(Q)$$(call CFG_COMPILE_C_$(1), $$@, $$(LLVM_CXXFLAGS) $$(RUSTLLVM_INCS_$(1))) $$<\n endef"}, {"sha": "ad6b8cc31dbc54212f300d6fec79bfce2f7cae3c", "filename": "mk/target.mk", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/a4e1a438f676be35be660a0fe0170bbe69d62179/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=a4e1a438f676be35be660a0fe0170bbe69d62179", "patch": "@@ -12,7 +12,8 @@ $$(TARGET_LIB$(1)$(2))/intrinsics.ll: \\\n \t@$$(call E, sed: $$@)\n \t$$(Q)sed s/@CFG_TARGET_TRIPLE@/$(2)/ $$< > $$@\n \n-$$(TARGET_LIB$(1)$(2))/intrinsics.bc: $$(TARGET_LIB$(1)$(2))/intrinsics.ll\n+$$(TARGET_LIB$(1)$(2))/intrinsics.bc: $$(TARGET_LIB$(1)$(2))/intrinsics.ll \\\n+\t\t$$(LLVM_CONFIG)\n \t@$$(call E, llvms-as: $$@)\n \t$$(Q)$$(LLVM_AS) -o $$@ $$<\n "}]}