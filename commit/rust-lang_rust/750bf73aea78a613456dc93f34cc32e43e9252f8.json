{"sha": "750bf73aea78a613456dc93f34cc32e43e9252f8", "node_id": "C_kwDOAAsO6NoAKDc1MGJmNzNhZWE3OGE2MTM0NTZkYzkzZjM0Y2MzMmU0M2U5MjUyZjg", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-24T07:53:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-24T07:53:48Z"}, "message": "Rollup merge of #106109 - notriddle:notriddle/source-lines, r=GuillaumeGomez\n\nrustdoc: make line number CSS for doc comment and scraped the same\n\n![image](https://user-images.githubusercontent.com/1593513/209423540-2657bb43-e6d7-4af3-9cb3-c790a8dd8cd9.png)\n\nDiscussed in\nhttps://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/Line.20number.20styling\n\nPreview: http://notriddle.com/notriddle-rustdoc-demos/source-lines/test_dingus/fn.test.html", "tree": {"sha": "123817ac9b8c3655985ca2d334c66078c5555143", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/123817ac9b8c3655985ca2d334c66078c5555143"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/750bf73aea78a613456dc93f34cc32e43e9252f8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjprAMCRBK7hj4Ov3rIwAAj6gIACdIa5inkoXjmOpqOv7eA/dW\nj8IgafLuw2XJv9NFIyxEHpNfYOhqjUYGCMae/WGiwSdo9817mM2LcCQ5tPh9YuIO\nVX/d97IM1eIbOMHWpXSNspoa7sI09+PaCSiKEyDieCNtyrs8h2w1uRVJ5P5CO3ta\nf5AkwB4txCl5TOfW5WMA65mekxtHzxp/XMJk9QOzJCLFcH4+/dI6YDGoKHFBaXBl\n8D8mR4zfokgz52ocI9Ik8tR8U+l9DNxpIrD00rTmEmzTxW24XDhiLxABNAA92hjB\nY24FSYOXsyPNMyXsiUl77xM47d7FDF/0cHp+TEEw4PVaCKIl2+1FHa6KQGkVclk=\n=R2YU\n-----END PGP SIGNATURE-----\n", "payload": "tree 123817ac9b8c3655985ca2d334c66078c5555143\nparent 09ee7048fdae23fde07fd813e4310fdb640d0f20\nparent f4517171572fdc2d6d2880fc20bb2b689faae3c3\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1671868428 +0100\ncommitter GitHub <noreply@github.com> 1671868428 +0100\n\nRollup merge of #106109 - notriddle:notriddle/source-lines, r=GuillaumeGomez\n\nrustdoc: make line number CSS for doc comment and scraped the same\n\n![image](https://user-images.githubusercontent.com/1593513/209423540-2657bb43-e6d7-4af3-9cb3-c790a8dd8cd9.png)\n\nDiscussed in\nhttps://rust-lang.zulipchat.com/#narrow/stream/266220-rustdoc/topic/Line.20number.20styling\n\nPreview: http://notriddle.com/notriddle-rustdoc-demos/source-lines/test_dingus/fn.test.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/750bf73aea78a613456dc93f34cc32e43e9252f8", "html_url": "https://github.com/rust-lang/rust/commit/750bf73aea78a613456dc93f34cc32e43e9252f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/750bf73aea78a613456dc93f34cc32e43e9252f8/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09ee7048fdae23fde07fd813e4310fdb640d0f20", "url": "https://api.github.com/repos/rust-lang/rust/commits/09ee7048fdae23fde07fd813e4310fdb640d0f20", "html_url": "https://github.com/rust-lang/rust/commit/09ee7048fdae23fde07fd813e4310fdb640d0f20"}, {"sha": "f4517171572fdc2d6d2880fc20bb2b689faae3c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4517171572fdc2d6d2880fc20bb2b689faae3c3", "html_url": "https://github.com/rust-lang/rust/commit/f4517171572fdc2d6d2880fc20bb2b689faae3c3"}], "stats": {"total": 93, "additions": 54, "deletions": 39}, "files": [{"sha": "53c8a1add780b9d6005b062385f972ee9d95e8d9", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 9, "deletions": 21, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -347,6 +347,9 @@ pre {\n .source .content pre {\n \tpadding: 20px;\n }\n+.rustdoc.source .example-wrap > pre.src-line-numbers  {\n+\tpadding: 20px 0 20px 4px;\n+}\n \n img {\n \tmax-width: 100%;\n@@ -519,10 +522,6 @@ ul.block, .block li {\n \tdisplay: none;\n }\n \n-.source .content pre.rust {\n-\tpadding-left: 0;\n-}\n-\n .rustdoc .example-wrap {\n \tdisplay: flex;\n \tposition: relative;\n@@ -550,23 +549,21 @@ ul.block, .block li {\n \t-moz-user-select: none;\n \t-ms-user-select: none;\n \tuser-select: none;\n+\tpadding: 14px 8px;\n+\tcolor: var(--src-line-numbers-span-color);\n }\n \n-.example-line-numbers {\n-\tborder: 1px solid;\n-\tpadding: 13px 8px;\n-\tborder-top-left-radius: 5px;\n-\tborder-bottom-left-radius: 5px;\n-\tborder-color: var(--example-line-numbers-border-color);\n+.rustdoc .example-wrap > pre.src-line-numbers {\n+\tpadding: 14px 0;\n }\n-\n .src-line-numbers a, .src-line-numbers span {\n \tcolor: var(--src-line-numbers-span-color);\n+\tpadding: 0 8px;\n }\n .src-line-numbers :target {\n \tbackground-color: transparent;\n \tborder-right: none;\n-\tpadding-right: 0;\n+\tpadding: 0 8px;\n }\n .src-line-numbers .line-highlighted {\n \tbackground-color: var(--src-line-number-highlighted-background-color);\n@@ -1958,15 +1955,6 @@ in storage.js\n \tbottom: 0;\n }\n \n-.scraped-example .code-wrapper .src-line-numbers {\n-\tpadding: 14px 0;\n-}\n-\n-.scraped-example .code-wrapper .src-line-numbers a,\n-.scraped-example .code-wrapper .src-line-numbers span {\n-\tpadding: 0 14px;\n-}\n-\n .scraped-example .code-wrapper .example-wrap {\n \twidth: 100%;\n \toverflow-y: hidden;"}, {"sha": "7377e2a17914ec9bc46704dac7550b44a7357c82", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -62,7 +62,6 @@ Original by Dempfi (https://github.com/dempfi/ayu)\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #788797;\n \t--code-highlight-doc-comment-color: #a1ac88;\n-\t--example-line-numbers-border-color: none;\n \t--src-line-numbers-span-color: #5c6773;\n \t--src-line-number-highlighted-background-color: rgba(255, 236, 164, 0.06);\n \t--test-arrow-color: #788797;\n@@ -132,7 +131,7 @@ pre, .rustdoc.source .example-wrap {\n \n .src-line-numbers .line-highlighted {\n \tcolor: #708090;\n-\tpadding-right: 4px;\n+\tpadding-right: 7px;\n \tborder-right: 1px solid #ffb44c;\n }\n "}, {"sha": "2091f8dcca9f0c182056473277d2538e6869cc0a", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -57,7 +57,6 @@\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #8d8d8b;\n \t--code-highlight-doc-comment-color: #8ca375;\n-\t--example-line-numbers-border-color: #4a4949;\n \t--src-line-numbers-span-color: #3b91e2;\n \t--src-line-number-highlighted-background-color: #0a042f;\n \t--test-arrow-color: #dedede;"}, {"sha": "f582796d5ddbc4bf8908949eb2fef5ba34cd71e0", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -57,7 +57,6 @@\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #8e908c;\n \t--code-highlight-doc-comment-color: #4d4d4c;\n-\t--example-line-numbers-border-color: #c7c7c7;\n \t--src-line-numbers-span-color: #c67e2d;\n \t--src-line-number-highlighted-background-color: #fdffd3;\n \t--test-arrow-color: #f5f5f5;"}, {"sha": "a3ed008719c00237a1cd50d51a74d8ed9ac8da6e", "filename": "src/test/rustdoc-gui/docblock-code-block-line-number.goml", "status": "modified", "additions": 42, "deletions": 12, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Ftest%2Frustdoc-gui%2Fdocblock-code-block-line-number.goml", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Ftest%2Frustdoc-gui%2Fdocblock-code-block-line-number.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fdocblock-code-block-line-number.goml?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -1,23 +1,53 @@\n // Checks that the setting \"line numbers\" is working as expected.\n goto: \"file://\" + |DOC_PATH| + \"/test_docs/fn.foo.html\"\n \n+// Otherwise, we can't check text color\n+show-text: true\n+\n // We check that without this setting, there is no line number displayed.\n assert-false: \"pre.example-line-numbers\"\n \n-// We now set the setting to show the line numbers on code examples.\n-local-storage: {\"rustdoc-line-numbers\": \"true\" }\n-// We reload to make the line numbers appear.\n-reload:\n-\n-// We wait for them to be added into the DOM by the JS...\n-wait-for: \"pre.example-line-numbers\"\n-// If the test didn't fail, it means that it was found!\n // Let's now check some CSS properties...\n-assert-css: (\"pre.example-line-numbers\", {\n-    \"margin\": \"0px\",\n-    \"padding\": \"13px 8px\",\n-    \"text-align\": \"right\",\n+define-function: (\n+    \"check-colors\",\n+    (theme, color),\n+    [\n+        // We now set the setting to show the line numbers on code examples.\n+        (\"local-storage\", {\n+            \"rustdoc-theme\": |theme|,\n+            \"rustdoc-use-system-theme\": \"false\",\n+            \"rustdoc-line-numbers\": \"true\"\n+        }),\n+        // We reload to make the line numbers appear and change theme.\n+        (\"reload\"),\n+        // We wait for them to be added into the DOM by the JS...\n+        (\"wait-for\", \"pre.example-line-numbers\"),\n+        // If the test didn't fail, it means that it was found!\n+        (\"assert-css\", (\n+            \"pre.example-line-numbers\",\n+            {\n+                \"color\": |color|,\n+                \"margin\": \"0px\",\n+                \"padding\": \"14px 8px\",\n+                \"text-align\": \"right\",\n+            },\n+            ALL,\n+        )),\n+    ],\n+)\n+call-function: (\"check-colors\", {\n+    \"theme\": \"ayu\",\n+    \"color\": \"rgb(92, 103, 115)\",\n })\n+call-function: (\"check-colors\", {\n+    \"theme\": \"dark\",\n+    \"color\": \"rgb(59, 145, 226)\",\n+})\n+call-function: (\"check-colors\", {\n+    \"theme\": \"light\",\n+    \"color\": \"rgb(198, 126, 45)\",\n+})\n+\n // The first code block has two lines so let's check its `<pre>` elements lists both of them.\n assert-text: (\"pre.example-line-numbers\", \"1\\n2\")\n "}, {"sha": "8a33e713191292cebd0082c94858ddf0b12fe3cf", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/750bf73aea78a613456dc93f34cc32e43e9252f8/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=750bf73aea78a613456dc93f34cc32e43e9252f8", "patch": "@@ -89,9 +89,9 @@ assert-css: (\".src-line-numbers\", {\"text-align\": \"right\"})\n // do anything (and certainly not add a `#NaN` to the URL!).\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n // We use this assert-position to know where we will click.\n-assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 112})\n+assert-position: (\"//*[@id='1']\", {\"x\": 88, \"y\": 112})\n // We click on the left of the \"1\" anchor but still in the \"src-line-number\" `<pre>`.\n-click: (103, 103)\n+click: (87, 103)\n assert-document-property: ({\"URL\": \"/lib.rs.html\"}, ENDS_WITH)\n \n // Checking the source code sidebar."}]}