{"sha": "d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwZGRjNWE3YzFlM2YzZGYwOWY0ZTM2MzdjYzgwNDU5ZDgyNzMzMTA=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-25T20:36:56Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-25T20:36:56Z"}, "message": "Merge #655\n\n655: Fix type inference of binops on int/float variables r=matklad a=flodiebold\n\nFixes #651.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "551a026f63068eb9290f8e7c8f8d1a8b4322dd5d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/551a026f63068eb9290f8e7c8f8d1a8b4322dd5d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "html_url": "https://github.com/rust-lang/rust/commit/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "d3b5ff8fe679b4e66e8af71db063b01d34fec3fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3b5ff8fe679b4e66e8af71db063b01d34fec3fc", "html_url": "https://github.com/rust-lang/rust/commit/d3b5ff8fe679b4e66e8af71db063b01d34fec3fc"}, {"sha": "5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a1385007cb7509d50a77afa5a47ed0685f7f2f9", "html_url": "https://github.com/rust-lang/rust/commit/5a1385007cb7509d50a77afa5a47ed0685f7f2f9"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "179ebddeec9ab9f4c8915860f1fe2eceae816994", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "patch": "@@ -790,7 +790,10 @@ fn binary_op_return_ty(op: BinaryOp, rhs_ty: Ty) -> Ty {\n         | BinaryOp::BitwiseAnd\n         | BinaryOp::BitwiseOr\n         | BinaryOp::BitwiseXor => match rhs_ty {\n-            Ty::Int(..) | Ty::Float(..) => rhs_ty,\n+            Ty::Int(..)\n+            | Ty::Float(..)\n+            | Ty::Infer(InferTy::IntVar(..))\n+            | Ty::Infer(InferTy::FloatVar(..)) => rhs_ty,\n             _ => Ty::Unknown,\n         },\n         BinaryOp::RangeRightOpen | BinaryOp::RangeRightClosed => Ty::Unknown,"}, {"sha": "d23d3f139261586a4556e2ff0b1363e47bf0bbcc", "filename": "crates/ra_hir/src/ty/snapshots/tests__bug_651.snap", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__bug_651.snap?ref=d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "patch": "@@ -0,0 +1,13 @@\n+---\n+created: \"2019-01-25T20:31:47.275112244+00:00\"\n+creator: insta@0.5.2\n+expression: \"&result\"\n+source: crates/ra_hir/src/ty/tests.rs\n+---\n+[11; 41) '{     ...+ y; }': ()\n+[21; 22) 'y': i32\n+[25; 27) '92': i32\n+[33; 34) '1': i32\n+[33; 38) '1 + y': i32\n+[37; 38) 'y': i32\n+"}, {"sha": "389bdaf23725cd3fe4a6ab7f2ed9fc0da1bc3779", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddc5a7c1e3f3df09f4e3637cc80459d8273310/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=d0ddc5a7c1e3f3df09f4e3637cc80459d8273310", "patch": "@@ -532,6 +532,19 @@ fn test() {\n     );\n }\n \n+#[test]\n+fn bug_651() {\n+    check_inference(\n+        \"bug_651\",\n+        r#\"\n+fn quux() {\n+    let y = 92;\n+    1 + y;\n+}\n+\"#,\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.source_file(file_id);"}]}