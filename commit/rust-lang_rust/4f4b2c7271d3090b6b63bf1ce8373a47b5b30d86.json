{"sha": "4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "node_id": "C_kwDOAAsO6NoAKDRmNGIyYzcyNzFkMzA5MGI2YjYzYmYxY2U4MzczYTQ3YjViMzBkODY", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-12-14T16:11:23Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-12-14T16:11:23Z"}, "message": "Constify `bool::then{,_some}`", "tree": {"sha": "aa17648acb72ed51b76a638ad0b9d9d86872c204", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa17648acb72ed51b76a638ad0b9d9d86872c204"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE3RQPHNISvvEnSKtjbQF6ltjmwvkFAmG4wisACgkQbQF6ltjm\nwvl9KxAAvHAt6uq7+KV3tqgyRQEuZeXMGa2vA4sBfN3zCqIk0DRm/7Bxp2AfnoCv\n45Re4pQtSAQAmvvAt/kZnrWYyMZx9crAkchx6mc8iKw7F2ijIKzC6udYddsDrYKL\nSdF51TCiRFhg0mihpeCDVlm8KS9p9Zx92nID30DIScf8kQHCK9aZFWFcqB7d8Imw\nOIscQ26U1DnsZwQoAts3+tZJWXCBOyMMHPv5ZupZLvH/e+75quTFKrs/BsruC15p\n9xs+TQ/SE/azgrVYP7y9NOIbc+229JezHllCcy9II+Bylt7tQ7+ZlWV7PP5R8dBv\nNzMRhwjCKKSFLQDfAGfNaJtBSVTcIZm5E2z9FYg+HYtjkdHFYko5K3NibwHKTgEr\nmC2bYAATnpVyBvyJX0BhCxOcgr9joTT04VuR6JU80FR9BuG/29soc2SC5fqosXi8\n/piwzc4Vb+8tdZbPxlpGPk0lts0sqZxrsVqayiYqWrSLLIl2RLWHxMQm9PC+Pioo\nvdSn2V3jwZVOAgu9+IussIZ9SMx90XPppArhlA7mbkAtNv7d47wPLEvAgl9paO7c\nFz/d4p43AOcXAAS+MT92a2IWKfFRmqmA962/9WikVRqxQJMGOtSzchJXaZMWlMNw\nzpfnOUlX4f2AR8Bo/7dsaGhfg5eq2pA77dVXjfWdAQS3fF665RA=\n=dhJZ\n-----END PGP SIGNATURE-----", "payload": "tree aa17648acb72ed51b76a638ad0b9d9d86872c204\nparent 404c8471aba60c2d837fa728e7c729a0f52d5830\nauthor Deadbeef <ent3rm4n@gmail.com> 1639498283 +0800\ncommitter Deadbeef <ent3rm4n@gmail.com> 1639498283 +0800\n\nConstify `bool::then{,_some}`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "html_url": "https://github.com/rust-lang/rust/commit/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "404c8471aba60c2d837fa728e7c729a0f52d5830", "url": "https://api.github.com/repos/rust-lang/rust/commits/404c8471aba60c2d837fa728e7c729a0f52d5830", "html_url": "https://github.com/rust-lang/rust/commit/404c8471aba60c2d837fa728e7c729a0f52d5830"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "d5119d0b7c3286f70153d9c28a6393fec1f061db", "filename": "library/core/src/bool.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Fsrc%2Fbool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Fsrc%2Fbool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fbool.rs?ref=4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "patch": "@@ -14,8 +14,12 @@ impl bool {\n     /// assert_eq!(true.then_some(0), Some(0));\n     /// ```\n     #[unstable(feature = \"bool_to_option\", issue = \"80967\")]\n+    #[rustc_const_unstable(feature = \"const_bool_to_option\", issue = \"91917\")]\n     #[inline]\n-    pub fn then_some<T>(self, t: T) -> Option<T> {\n+    pub const fn then_some<T>(self, t: T) -> Option<T>\n+    where\n+        T: ~const Drop,\n+    {\n         if self { Some(t) } else { None }\n     }\n \n@@ -29,8 +33,13 @@ impl bool {\n     /// assert_eq!(true.then(|| 0), Some(0));\n     /// ```\n     #[stable(feature = \"lazy_bool_to_option\", since = \"1.50.0\")]\n+    #[rustc_const_unstable(feature = \"const_bool_to_option\", issue = \"91917\")]\n     #[inline]\n-    pub fn then<T, F: FnOnce() -> T>(self, f: F) -> Option<T> {\n+    pub const fn then<T, F>(self, f: F) -> Option<T>\n+    where\n+        F: ~const FnOnce() -> T,\n+        F: ~const Drop,\n+    {\n         if self { Some(f()) } else { None }\n     }\n }"}, {"sha": "4819ce911d6186a54a45e42c49aefd68c4ab284d", "filename": "library/core/tests/bool.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Ftests%2Fbool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Ftests%2Fbool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fbool.rs?ref=4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "patch": "@@ -88,4 +88,18 @@ fn test_bool_to_option() {\n     assert_eq!(true.then_some(0), Some(0));\n     assert_eq!(false.then(|| 0), None);\n     assert_eq!(true.then(|| 0), Some(0));\n+\n+    const fn zero() -> i32 {\n+        0\n+    }\n+\n+    const A: Option<i32> = false.then_some(0);\n+    const B: Option<i32> = true.then_some(0);\n+    const C: Option<i32> = false.then(zero);\n+    const D: Option<i32> = true.then(zero);\n+\n+    assert_eq!(A, None);\n+    assert_eq!(B, Some(0));\n+    assert_eq!(C, None);\n+    assert_eq!(D, Some(0));\n }"}, {"sha": "dacb33619f8c3d0bd88ac62299df1467ce623abd", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=4f4b2c7271d3090b6b63bf1ce8373a47b5b30d86", "patch": "@@ -8,6 +8,7 @@\n #![feature(cfg_panic)]\n #![feature(cfg_target_has_atomic)]\n #![feature(const_assume)]\n+#![feature(const_bool_to_option)]\n #![feature(const_cell_into_inner)]\n #![feature(const_convert)]\n #![feature(const_maybe_uninit_as_mut_ptr)]"}]}