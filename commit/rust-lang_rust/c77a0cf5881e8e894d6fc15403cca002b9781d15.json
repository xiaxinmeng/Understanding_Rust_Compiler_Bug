{"sha": "c77a0cf5881e8e894d6fc15403cca002b9781d15", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3N2EwY2Y1ODgxZThlODk0ZDZmYzE1NDAzY2NhMDAyYjk3ODFkMTU=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-10-10T23:54:17Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-10-10T23:54:17Z"}, "message": "Accept `Option<Box<$t:ty>>` in macro argument\n\nGiven the following code, compile successfuly:\n\n```\nmacro_rules! test {\n    (\n        fn fun() -> Option<Box<$t:ty>>;\n    ) => {\n        fn fun(x: $t) -> Option<Box<$t>>\n        { Some(Box::new(x)) }\n    }\n}\n\ntest! {\n    fn fun() -> Option<Box<i32>>;\n}\n```", "tree": {"sha": "41d96ec097480772c8c802da3dee05bdf4fa5906", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41d96ec097480772c8c802da3dee05bdf4fa5906"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c77a0cf5881e8e894d6fc15403cca002b9781d15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c77a0cf5881e8e894d6fc15403cca002b9781d15", "html_url": "https://github.com/rust-lang/rust/commit/c77a0cf5881e8e894d6fc15403cca002b9781d15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c77a0cf5881e8e894d6fc15403cca002b9781d15/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1041c6cd1a027ab3ada3e8538620d2e1d7067fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1041c6cd1a027ab3ada3e8538620d2e1d7067fe", "html_url": "https://github.com/rust-lang/rust/commit/e1041c6cd1a027ab3ada3e8538620d2e1d7067fe"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "07d9bdb03adc7cc9670612c696759f562c50299c", "filename": "src/libsyntax/ext/tt/macro_rules.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c77a0cf5881e8e894d6fc15403cca002b9781d15/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77a0cf5881e8e894d6fc15403cca002b9781d15/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs?ref=c77a0cf5881e8e894d6fc15403cca002b9781d15", "patch": "@@ -902,7 +902,8 @@ fn is_in_follow(tok: &quoted::TokenTree, frag: &str) -> Result<bool, (String, &'\n             \"path\" | \"ty\" => match *tok {\n                 TokenTree::Token(_, ref tok) => match *tok {\n                     OpenDelim(token::DelimToken::Brace) | OpenDelim(token::DelimToken::Bracket) |\n-                    Comma | FatArrow | Colon | Eq | Gt | Semi | BinOp(token::Or) => Ok(true),\n+                    Comma | FatArrow | Colon | Eq | Gt | BinOp(token::Shr) | Semi |\n+                    BinOp(token::Or) => Ok(true),\n                     Ident(i, false) if i.name == \"as\" || i.name == \"where\" => Ok(true),\n                     _ => Ok(false)\n                 },"}, {"sha": "e81b2c7a7233b197eb8112d698dfca596bae84d1", "filename": "src/test/run-pass/macros/issue-25274.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c77a0cf5881e8e894d6fc15403cca002b9781d15/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77a0cf5881e8e894d6fc15403cca002b9781d15/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs?ref=c77a0cf5881e8e894d6fc15403cca002b9781d15", "patch": "@@ -0,0 +1,16 @@\n+macro_rules! test {\n+    (\n+        fn fun() -> Option<Box<$t:ty>>;\n+    ) => {\n+        fn fun(x: $t) -> Option<Box<$t>>\n+        { Some(Box::new(x)) }\n+    }\n+}\n+\n+test! {\n+    fn fun() -> Option<Box<i32>>;\n+}\n+\n+fn main() {\n+    println!(\"{}\", fun(0).unwrap());\n+}"}]}