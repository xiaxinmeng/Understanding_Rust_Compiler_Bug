{"sha": "a4c30d750411f09a999b201631000a08e88907fd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0YzMwZDc1MDQxMWYwOWE5OTliMjAxNjMxMDAwYTA4ZTg4OTA3ZmQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-02T21:47:44Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-02T21:47:44Z"}, "message": "Merge #408\n\n408: vscode problem matcher improvements r=matklad a=vemoo\n\nThe problem matcher wasn't working properly and looking at the rustc errors i realized it could be simplified.\r\n\r\nI also added a new problem matcher that can be used with https://github.com/passcod/cargo-watch to get the errors in the editor on save. To use it one can create a tasks.json file with:\r\n```json\r\n{\r\n    \"version\": \"2.0.0\",\r\n    \"tasks\": [\r\n        {\r\n            \"type\": \"shell\",\r\n            \"label\": \"cargo watch\",\r\n            \"command\": \"cargo\",\r\n            \"isBackground\": true,\r\n            \"args\": [\r\n                \"watch\",\r\n                \"-c\"\r\n            ],\r\n            \"problemMatcher\": [\r\n                \"$rustc-watch\"\r\n            ]\r\n        }\r\n    ]\r\n}\r\n```\r\nI initially implemented it like this: https://github.com/rust-analyzer/rust-analyzer/commit/cff9f62d321a90c45e622f5304e60a248cbcf4f2 but i think there's a bug in vscode so i worked around it by copying the pattern for both problem matchers. The first commit can be used if https://github.com/Microsoft/vscode/pull/65840 is merged.\r\n\n\nCo-authored-by: Bernardo <berublan@gmail.com>", "tree": {"sha": "1034c83bd53ab42e916f58c73249678a04a0085f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1034c83bd53ab42e916f58c73249678a04a0085f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4c30d750411f09a999b201631000a08e88907fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4c30d750411f09a999b201631000a08e88907fd", "html_url": "https://github.com/rust-lang/rust/commit/a4c30d750411f09a999b201631000a08e88907fd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4c30d750411f09a999b201631000a08e88907fd/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "54efd8204ec05313007d42351fe4701061b06a67", "url": "https://api.github.com/repos/rust-lang/rust/commits/54efd8204ec05313007d42351fe4701061b06a67", "html_url": "https://github.com/rust-lang/rust/commit/54efd8204ec05313007d42351fe4701061b06a67"}, {"sha": "96f0683974406055e98ff88af3b01327aae8ba61", "url": "https://api.github.com/repos/rust-lang/rust/commits/96f0683974406055e98ff88af3b01327aae8ba61", "html_url": "https://github.com/rust-lang/rust/commit/96f0683974406055e98ff88af3b01327aae8ba61"}], "stats": {"total": 64, "additions": 50, "deletions": 14}, "files": [{"sha": "e0db3c337d0bf46e92794960750d9e37dfafa38a", "filename": "editors/code/package.json", "status": "modified", "additions": 50, "deletions": 14, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/a4c30d750411f09a999b201631000a08e88907fd/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/a4c30d750411f09a999b201631000a08e88907fd/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=a4c30d750411f09a999b201631000a08e88907fd", "patch": "@@ -145,6 +145,26 @@\n                 }\n             }\n         },\n+        \"problemPatterns\": [\n+            {\n+                \"//comment\": \"named multiline problem patterns are not parsed properly in vscode at the moment, when fixed in vscode replace both \\\"pattern\\\": [...] below with \\\"pattern\\\": \\\"$rustc\\\"\",\n+                \"name\": \"rustc\",\n+                \"patterns\": [\n+                    {\n+                        \"regexp\": \"^(warning|warn|error)(?:\\\\[(.*?)\\\\])?: (.*)$\",\n+                        \"severity\": 1,\n+                        \"code\": 2,\n+                        \"message\": 3\n+                    },\n+                    {\n+                        \"regexp\": \"^[\\\\s->=]*(.*?):(\\\\d*):(\\\\d*)\\\\s*$\",\n+                        \"file\": 1,\n+                        \"line\": 2,\n+                        \"column\": 3\n+                    }\n+                ]\n+            }\n+        ],\n         \"problemMatchers\": [\n             {\n                 \"name\": \"rustc\",\n@@ -154,28 +174,44 @@\n                 ],\n                 \"pattern\": [\n                     {\n-                        \"regexp\": \"^(warning|warn|error)(\\\\[(.*)\\\\])?: (.*)$\",\n+                        \"regexp\": \"^(warning|warn|error)(?:\\\\[(.*?)\\\\])?: (.*)$\",\n                         \"severity\": 1,\n-                        \"message\": 4,\n-                        \"code\": 3\n+                        \"code\": 2,\n+                        \"message\": 3\n                     },\n                     {\n-                        \"regexp\": \"^([\\\\s->=]*(.*):(\\\\d*):(\\\\d*)|.*)$\",\n-                        \"file\": 2,\n-                        \"line\": 3,\n-                        \"column\": 4\n-                    },\n+                        \"regexp\": \"^[\\\\s->=]*(.*?):(\\\\d*):(\\\\d*)\\\\s*$\",\n+                        \"file\": 1,\n+                        \"line\": 2,\n+                        \"column\": 3\n+                    }\n+                ]\n+            },\n+            {\n+                \"name\": \"rustc-watch\",\n+                \"fileLocation\": [\n+                    \"relative\",\n+                    \"${workspaceRoot}\"\n+                ],\n+                \"background\": {\n+                    \"beginsPattern\": \"^\\\\[Running \",\n+                    \"endsPattern\": \"^(\\\\[Finished running\\\\]|To learn more, run the command again with --verbose\\\\.)$\"\n+                },\n+                \"pattern\": [\n                     {\n-                        \"regexp\": \"^.*$\"\n+                        \"regexp\": \"^(warning|warn|error)(?:\\\\[(.*?)\\\\])?: (.*)$\",\n+                        \"severity\": 1,\n+                        \"code\": 2,\n+                        \"message\": 3\n                     },\n                     {\n-                        \"regexp\": \"^([\\\\s->=]*(.*):(\\\\d*):(\\\\d*)|.*)$\",\n-                        \"file\": 2,\n-                        \"line\": 3,\n-                        \"column\": 4\n+                        \"regexp\": \"^[\\\\s->=]*(.*?):(\\\\d*):(\\\\d*)\\\\s*$\",\n+                        \"file\": 1,\n+                        \"line\": 2,\n+                        \"column\": 3\n                     }\n                 ]\n             }\n         ]\n     }\n-}\n+}\n\\ No newline at end of file"}]}