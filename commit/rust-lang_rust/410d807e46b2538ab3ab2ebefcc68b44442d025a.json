{"sha": "410d807e46b2538ab3ab2ebefcc68b44442d025a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxMGQ4MDdlNDZiMjUzOGFiM2FiMmViZWZjYzY4YjQ0NDQyZDAyNWE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-12T03:34:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-02-12T03:34:57Z"}, "message": "Auto merge of #39554 - zackmdavis:assert_eq_has_a_terrible_error_message_when_given_a_trailing_comma, r=BurntSushi\n\nimprove error message when two-arg assert_eq! receives a trailing comma\n\nPreviously, `assert_eq!(left, right,)` (respectively, `assert_ne!(left,\nright,)`; note the trailing comma) would result in a confusing \"requires\nat least a format string argument\" error. In reality, a format string is\noptional, but the trailing comma puts us into the \"match a token tree of\nzero or more tokens\" branch of the macro (in order to support the\noptional format string), and passing the empty token tree into\n`format_args!` results in the confusing error. If instead we match a\ntoken tree of one or more tokens, we get a much more sensible\n\"unexpected end of macro invocation\" error.\n\nWhile we're here, fix up a stray space before a comma in the match\nguards.\n\nResolves #39369.\n\n-----\n\n**Before:**\n```\n$ rustc scratch.rs\nerror: requires at least a format string argument\n --> scratch.rs:2:5\n  |\n2 |     assert_eq!(1, 2,);\n  |     ^^^^^^^^^^^^^^^^^^\n  |\n  = note: this error originates in a macro outside of the current crate\n\nerror: aborting due to previous error\n```\n\n**After:**\n```\n$ ./build/x86_64-unknown-linux-gnu/stage1/bin/rustc scratch.rs\nerror: unexpected end of macro invocation\n --> scratch.rs:2:20\n  |\n2 |     assert_eq!(1, 2,);\n  |                    ^\n```", "tree": {"sha": "77a3a832110895cb4abf81a2f8ebcb4241a21003", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77a3a832110895cb4abf81a2f8ebcb4241a21003"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/410d807e46b2538ab3ab2ebefcc68b44442d025a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/410d807e46b2538ab3ab2ebefcc68b44442d025a", "html_url": "https://github.com/rust-lang/rust/commit/410d807e46b2538ab3ab2ebefcc68b44442d025a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/410d807e46b2538ab3ab2ebefcc68b44442d025a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "912bc14a6b25bac66822766b09dcfb3c6263757d", "url": "https://api.github.com/repos/rust-lang/rust/commits/912bc14a6b25bac66822766b09dcfb3c6263757d", "html_url": "https://github.com/rust-lang/rust/commit/912bc14a6b25bac66822766b09dcfb3c6263757d"}, {"sha": "65435e14febd9d8aa1d40a19cd1adb427263c48e", "url": "https://api.github.com/repos/rust-lang/rust/commits/65435e14febd9d8aa1d40a19cd1adb427263c48e", "html_url": "https://github.com/rust-lang/rust/commit/65435e14febd9d8aa1d40a19cd1adb427263c48e"}], "stats": {"total": 50, "additions": 44, "deletions": 6}, "files": [{"sha": "66a923f8e588ae33fe11784d12096ab9c0d45010", "filename": "src/libcore/macros.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Flibcore%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Flibcore%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmacros.rs?ref=410d807e46b2538ab3ab2ebefcc68b44442d025a", "patch": "@@ -103,7 +103,7 @@ macro_rules! assert {\n #[macro_export]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n macro_rules! assert_eq {\n-    ($left:expr , $right:expr) => ({\n+    ($left:expr, $right:expr) => ({\n         match (&$left, &$right) {\n             (left_val, right_val) => {\n                 if !(*left_val == *right_val) {\n@@ -113,13 +113,13 @@ macro_rules! assert_eq {\n             }\n         }\n     });\n-    ($left:expr , $right:expr, $($arg:tt)*) => ({\n+    ($left:expr, $right:expr, $($arg:tt)+) => ({\n         match (&($left), &($right)) {\n             (left_val, right_val) => {\n                 if !(*left_val == *right_val) {\n                     panic!(\"assertion failed: `(left == right)` \\\n                            (left: `{:?}`, right: `{:?}`): {}\", left_val, right_val,\n-                           format_args!($($arg)*))\n+                           format_args!($($arg)+))\n                 }\n             }\n         }\n@@ -146,7 +146,7 @@ macro_rules! assert_eq {\n #[macro_export]\n #[stable(feature = \"assert_ne\", since = \"1.12.0\")]\n macro_rules! assert_ne {\n-    ($left:expr , $right:expr) => ({\n+    ($left:expr, $right:expr) => ({\n         match (&$left, &$right) {\n             (left_val, right_val) => {\n                 if *left_val == *right_val {\n@@ -156,13 +156,13 @@ macro_rules! assert_ne {\n             }\n         }\n     });\n-    ($left:expr , $right:expr, $($arg:tt)*) => ({\n+    ($left:expr, $right:expr, $($arg:tt)+) => ({\n         match (&($left), &($right)) {\n             (left_val, right_val) => {\n                 if *left_val == *right_val {\n                     panic!(\"assertion failed: `(left != right)` \\\n                            (left: `{:?}`, right: `{:?}`): {}\", left_val, right_val,\n-                           format_args!($($arg)*))\n+                           format_args!($($arg)+))\n                 }\n             }\n         }"}, {"sha": "d98baf640a8c95ca71dfc3df4d2ad7041a64f374", "filename": "src/test/ui/macros/assert_eq_trailing_comma.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.rs?ref=410d807e46b2538ab3ab2ebefcc68b44442d025a", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    assert_eq!(1, 1,);\n+}"}, {"sha": "ca590db90e43f4a2dacb43b1b492ec2f508b1619", "filename": "src/test/ui/macros/assert_eq_trailing_comma.stderr", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert_eq_trailing_comma.stderr?ref=410d807e46b2538ab3ab2ebefcc68b44442d025a", "patch": "@@ -0,0 +1,6 @@\n+error: unexpected end of macro invocation\n+  --> $DIR/assert_eq_trailing_comma.rs:12:20\n+   |\n+12 |     assert_eq!(1, 1,);\n+   |                    ^\n+"}, {"sha": "4d3c29da8b22b8efae94293c574b5ee0368cbfc8", "filename": "src/test/ui/macros/assert_ne_trailing_comma.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.rs?ref=410d807e46b2538ab3ab2ebefcc68b44442d025a", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    assert_ne!(1, 2,);\n+}"}, {"sha": "ffabcaeb0493c4e16a2c69d388c8888257110a95", "filename": "src/test/ui/macros/assert_ne_trailing_comma.stderr", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/410d807e46b2538ab3ab2ebefcc68b44442d025a/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert_ne_trailing_comma.stderr?ref=410d807e46b2538ab3ab2ebefcc68b44442d025a", "patch": "@@ -0,0 +1,6 @@\n+error: unexpected end of macro invocation\n+  --> $DIR/assert_ne_trailing_comma.rs:12:20\n+   |\n+12 |     assert_ne!(1, 2,);\n+   |                    ^\n+"}]}