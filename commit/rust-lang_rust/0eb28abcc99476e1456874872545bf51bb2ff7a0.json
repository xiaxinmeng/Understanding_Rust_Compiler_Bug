{"sha": "0eb28abcc99476e1456874872545bf51bb2ff7a0", "node_id": "C_kwDOAAsO6NoAKDBlYjI4YWJjYzk5NDc2ZTE0NTY4NzQ4NzI1NDViZjUxYmIyZmY3YTA", "commit": {"author": {"name": "bstrie", "email": "865233+bstrie@users.noreply.github.com", "date": "2022-07-27T14:20:21Z"}, "committer": {"name": "bstrie", "email": "865233+bstrie@users.noreply.github.com", "date": "2022-07-27T14:25:13Z"}, "message": "Allow using stable os::fd::raw items through unstable os::wasi module\n\nThis fixes a regression from stable to nightly.\n\nCloses #99502.", "tree": {"sha": "904da849ed8b42dd09fe32f0d573745ae415e7b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/904da849ed8b42dd09fe32f0d573745ae415e7b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0eb28abcc99476e1456874872545bf51bb2ff7a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0eb28abcc99476e1456874872545bf51bb2ff7a0", "html_url": "https://github.com/rust-lang/rust/commit/0eb28abcc99476e1456874872545bf51bb2ff7a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0eb28abcc99476e1456874872545bf51bb2ff7a0/comments", "author": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50166d5e5e82ca795306824decbe4ffabcc23d3d", "url": "https://api.github.com/repos/rust-lang/rust/commits/50166d5e5e82ca795306824decbe4ffabcc23d3d", "html_url": "https://github.com/rust-lang/rust/commit/50166d5e5e82ca795306824decbe4ffabcc23d3d"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "081915ed148b36be114ec2154b30022dab8c658c", "filename": "library/std/src/os/fd/raw.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0eb28abcc99476e1456874872545bf51bb2ff7a0/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eb28abcc99476e1456874872545bf51bb2ff7a0/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fraw.rs?ref=0eb28abcc99476e1456874872545bf51bb2ff7a0", "patch": "@@ -14,6 +14,7 @@ use crate::os::wasi::io::OwnedFd;\n use crate::sys_common::{AsInner, IntoInner};\n \n /// Raw file descriptors.\n+#[cfg_attr(not(bootstrap), rustc_allowed_through_unstable_modules)]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub type RawFd = raw::c_int;\n \n@@ -22,6 +23,7 @@ pub type RawFd = raw::c_int;\n /// This is only available on unix and WASI platforms and must be imported in\n /// order to call the method. Windows platforms have a corresponding\n /// `AsRawHandle` and `AsRawSocket` set of traits.\n+#[cfg_attr(not(bootstrap), rustc_allowed_through_unstable_modules)]\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub trait AsRawFd {\n     /// Extracts the raw file descriptor.\n@@ -57,6 +59,7 @@ pub trait AsRawFd {\n \n /// A trait to express the ability to construct an object from a raw file\n /// descriptor.\n+#[cfg_attr(not(bootstrap), rustc_allowed_through_unstable_modules)]\n #[stable(feature = \"from_raw_os\", since = \"1.1.0\")]\n pub trait FromRawFd {\n     /// Constructs a new instance of `Self` from the given raw file\n@@ -100,6 +103,7 @@ pub trait FromRawFd {\n \n /// A trait to express the ability to consume an object and acquire ownership of\n /// its raw file descriptor.\n+#[cfg_attr(not(bootstrap), rustc_allowed_through_unstable_modules)]\n #[stable(feature = \"into_raw_os\", since = \"1.4.0\")]\n pub trait IntoRawFd {\n     /// Consumes this object, returning the raw underlying file descriptor."}, {"sha": "da3b36adad409e037a89a505463c2cb7548afaee", "filename": "library/std/src/os/wasi/io/raw.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/0eb28abcc99476e1456874872545bf51bb2ff7a0/library%2Fstd%2Fsrc%2Fos%2Fwasi%2Fio%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eb28abcc99476e1456874872545bf51bb2ff7a0/library%2Fstd%2Fsrc%2Fos%2Fwasi%2Fio%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Fwasi%2Fio%2Fraw.rs?ref=0eb28abcc99476e1456874872545bf51bb2ff7a0", "patch": "@@ -2,4 +2,19 @@\n \n #![unstable(feature = \"wasi_ext\", issue = \"71213\")]\n \n+// NOTE: despite the fact that this module is unstable,\n+// stable Rust had the capability to access the stable\n+// re-exported items from os::fd::raw through this\n+// unstable module.\n+// In PR #95956 the stability checker was changed to check\n+// all path segments of an item rather than just the last,\n+// which caused the aforementioned stable usage to regress\n+// (see issue #99502).\n+// As a result, the items in os::fd::raw were given the\n+// rustc_allowed_through_unstable_modules attribute.\n+// No regression tests were added to ensure this property,\n+// as CI is not configured to test wasm32-wasi.\n+// If this module is stabilized,\n+// you may want to remove those attributes\n+// (assuming no other unstable modules need them).\n pub use crate::os::fd::raw::*;"}]}