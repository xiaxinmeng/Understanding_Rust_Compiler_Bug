{"sha": "ca65a5e485761ed06e88756d9066156109b0755f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhNjVhNWU0ODU3NjFlZDA2ZTg4NzU2ZDkwNjYxNTYxMDliMDc1NWY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-06-10T20:38:04Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-06-13T10:00:18Z"}, "message": "Don't auto-hide inherent impls even if `rustdoc-collapse == true`.", "tree": {"sha": "07088a06b0145fe96d3f1f1a0ff808031a53b070", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/07088a06b0145fe96d3f1f1a0ff808031a53b070"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca65a5e485761ed06e88756d9066156109b0755f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlsg6zIACgkQ/vbIBR0O\nATyNKg/+I3JqxQtz+PhOqkl07Es6XAyn3xQrhl6NiYCCT29QaK0ogvps4VUlyf7Z\nwhv64IMjqDh/sWbHsl6fzDgpVy70kwrPDdcKrMWm+zMFPaDcH+A9yEziwiVuOHD/\nqhkOGE1YA3o4pnDqJzPU+3y7IRtTJ7l8sO5S3u2UkUzOjEgnr/oWuK8kM046HTco\nMVSKnTmBPZ0c4OrhQh/NnqLDePct2eqSBHk7VXwZsGKMNozOwHxL2HsO0u8w14Z3\nrPnos2SkPTUS7g01UO8XTfrNW1xVK1rYcfiBuSl8m1NTAhzt4INPtAVRWGizMZvq\niN/ZEtjxZy2mZ/BNFm3LlrIdeygkNuyCtD3l5hCaOnBkcHNyzpSnZcIEwHozz/m/\nqGPIrhs6NNpUmASVCt3DJKqioAHNysSydEe/pHRLgs9D86zah7707Maw/rAtYg8U\nSDnjP1yqEELTUXiOUmfn5fJwfxhlGUPugt6qXEN4hjJaKa15BZpBjcnlgJajcGMR\nwQh7yAMNkWclIlNE/7MquQFxATdUbvVXZ4CDu2OQ6KwU1X9ebhrDny9OlE9tfB7M\nS7d7WI0EiBLgIwA0EauVsUHkdB/2umggVvH2Nh7QBRR0+RPK2QuHX7E2PITqlWj+\nLF7wNBqR3N/yThydz7HTG2wIQcvhlrYHWK4nUkhE8oShxVjT5xQ=\n=Ptte\n-----END PGP SIGNATURE-----", "payload": "tree 07088a06b0145fe96d3f1f1a0ff808031a53b070\nparent 8398ab82e5d6623f49f054af848f1553f429d307\nauthor kennytm <kennytm@gmail.com> 1528663084 +0800\ncommitter kennytm <kennytm@gmail.com> 1528884018 +0800\n\nDon't auto-hide inherent impls even if `rustdoc-collapse == true`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca65a5e485761ed06e88756d9066156109b0755f", "html_url": "https://github.com/rust-lang/rust/commit/ca65a5e485761ed06e88756d9066156109b0755f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca65a5e485761ed06e88756d9066156109b0755f/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8398ab82e5d6623f49f054af848f1553f429d307", "url": "https://api.github.com/repos/rust-lang/rust/commits/8398ab82e5d6623f49f054af848f1553f429d307", "html_url": "https://github.com/rust-lang/rust/commit/8398ab82e5d6623f49f054af848f1553f429d307"}], "stats": {"total": 49, "additions": 25, "deletions": 24}, "files": [{"sha": "ed6745cd7f52529ee086e983af85a91b520bab46", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 25, "deletions": 24, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/ca65a5e485761ed06e88756d9066156109b0755f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/ca65a5e485761ed06e88756d9066156109b0755f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=ca65a5e485761ed06e88756d9066156109b0755f", "patch": "@@ -1775,7 +1775,7 @@\n         }\n     }\n \n-    function toggleAllDocs(pageId) {\n+    function toggleAllDocs(pageId, fromAutoCollapse) {\n         var toggle = document.getElementById(\"toggle-all-docs\");\n         if (!toggle) {\n             return;\n@@ -1787,20 +1787,23 @@\n                 e.innerHTML = labelForToggleButton(false);\n             });\n             toggle.title = \"collapse all docs\";\n-            onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                collapseDocs(e, \"show\");\n-            });\n+            if (fromAutoCollapse !== true) {\n+                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                    collapseDocs(e, \"show\");\n+                });\n+            }\n         } else {\n             updateLocalStorage(\"rustdoc-collapse\", \"true\");\n             addClass(toggle, \"will-expand\");\n             onEveryMatchingChild(toggle, \"inner\", function(e) {\n                 e.innerHTML = labelForToggleButton(true);\n             });\n             toggle.title = \"expand all docs\";\n-\n-            onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                collapseDocs(e, \"hide\", pageId);\n-            });\n+            if (fromAutoCollapse !== true) {\n+                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                    collapseDocs(e, \"hide\", pageId);\n+                });\n+            }\n         }\n     }\n \n@@ -1921,17 +1924,19 @@\n         }\n     }\n \n-    function autoCollapseAllImpls(pageId) {\n-        // Automatically minimize all non-inherent impls\n-        onEach(document.getElementsByClassName('impl'), function(n) {\n-            // inherent impl ids are like 'impl' or impl-<number>'\n-            var inherent = (n.id.match(/^impl(?:-\\d+)?$/) !== null);\n-            if (!inherent) {\n-                onEach(n.childNodes, function(m) {\n-                    if (hasClass(m, \"collapse-toggle\")) {\n-                        collapseDocs(m, \"hide\", pageId);\n-                    }\n-                });\n+    function autoCollapse(pageId, collapse) {\n+        if (collapse) {\n+            toggleAllDocs(pageId, true);\n+        }\n+        onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+            // inherent impl ids are like 'impl' or impl-<number>'.\n+            // they will never be hidden by default.\n+            var n = e.parentNode;\n+            if (n.id.match(/^impl(?:-\\d+)?$/) === null) {\n+                // Automatically minimize all non-inherent impls\n+                if (collapse || hasClass(n, 'impl')) {\n+                    collapseDocs(e, \"hide\", pageId);\n+                }\n             }\n         });\n     }\n@@ -2044,8 +2049,6 @@\n         }\n     });\n \n-    autoCollapseAllImpls(getPageId());\n-\n     function createToggleWrapper(tog) {\n         var span = document.createElement('span');\n         span.className = 'toggle-label';\n@@ -2175,9 +2178,7 @@\n         hideSidebar();\n     };\n \n-    if (getCurrentValue(\"rustdoc-collapse\") === \"true\") {\n-        toggleAllDocs(getPageId());\n-    }\n+    autoCollapse(getPageId(), getCurrentValue(\"rustdoc-collapse\") === \"true\");\n }());\n \n // Sets the focus on the search bar at the top of the page"}]}