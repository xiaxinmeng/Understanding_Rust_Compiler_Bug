{"sha": "d19b51e441833630a53a8966e3bc0ed1c94420f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxOWI1MWU0NDE4MzM2MzBhNTNhODk2NmUzYmMwZWQxYzk0NDIwZjc=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-05-29T06:07:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-29T06:07:04Z"}, "message": "Rollup merge of #72534 - chrissimpkins:fix-72373, r=estebank\n\nImprove missing `@` in slice binding pattern diagnostics\n\nCloses https://github.com/rust-lang/rust/issues/72373\n\nIncludes a new suggestion with `Applicability::MaybeIncorrect` confidence level.\n\nBefore:\n\n```\n --> src/main.rs:5:19\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                   -^\n  |                   |\n  |                   expected one of `,`, `@`, `]`, or `|`\n  |                   help: missing `,`\n\nerror[E0308]: mismatched types\n --> src/main.rs:5:46\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                                              ^^ expected slice `[u32]`, found `u32`\n  |\n  = note: expected reference `&[u32]`\n             found reference `&u32`\n\nerror: aborting due to 2 previous errors\n```\n\nAfter:\n\n```\nerror: expected one of `,`, `@`, `]`, or `|`, found `..`\n --> src/main.rs:5:20\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                    ^^ expected one of `,`, `@`, `]`, or `|`\n  |\nhelp: if you meant to bind the contents of the rest of the array pattern into `ts`, use `@`\n  |\n5 |         [h, ref ts @ ..] => foo(c, n - h) + foo(ts, n),\n  |                    ^\n\nerror: aborting due to previous error\n```\n\nr? @estebank", "tree": {"sha": "9e240486f738382b1e1c4492c8e3c2a963b58473", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9e240486f738382b1e1c4492c8e3c2a963b58473"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d19b51e441833630a53a8966e3bc0ed1c94420f7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe0KaICRBK7hj4Ov3rIwAAdHIIAJGbqFp8/jLHtJ67HlClicu+\nOCrIsFPju5ijil1pTJfWP+evSrcNW/ccjBz/BJqyc/cff1DjCHvOxn1T6ZtmI/rq\nmxhxKFBJK60KwcxN64Kke/j8Jy/yrGZzHeKIGLmB3Tc0KURXHm6RoGkMPHpsmvgt\nU1sHQZX6zSQo91RKeC2g933JtPP4dpk9QiRYl1hS5nVB4QMznEG/AEs/+yB2gFZb\nxblCBXG7UERhDRJvkYeA00MCZvU83bNJJw2r3f8P6c+erUB8XocjqIDdy5pIchXT\n9M04on3hqsF5fQaSMNOqT0KFVuiqLNd0+9QpPjqAMpm73VHAZK8cQ+Zx3EoRRy8=\n=vpnh\n-----END PGP SIGNATURE-----\n", "payload": "tree 9e240486f738382b1e1c4492c8e3c2a963b58473\nparent 6786c7d190a0792cd392fc2d8dde7c7de1e9f9b3\nparent 593d1eed8216c4ab33500b323fbd1b3de4ecb34d\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1590732424 +0900\ncommitter GitHub <noreply@github.com> 1590732424 +0900\n\nRollup merge of #72534 - chrissimpkins:fix-72373, r=estebank\n\nImprove missing `@` in slice binding pattern diagnostics\n\nCloses https://github.com/rust-lang/rust/issues/72373\n\nIncludes a new suggestion with `Applicability::MaybeIncorrect` confidence level.\n\nBefore:\n\n```\n --> src/main.rs:5:19\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                   -^\n  |                   |\n  |                   expected one of `,`, `@`, `]`, or `|`\n  |                   help: missing `,`\n\nerror[E0308]: mismatched types\n --> src/main.rs:5:46\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                                              ^^ expected slice `[u32]`, found `u32`\n  |\n  = note: expected reference `&[u32]`\n             found reference `&u32`\n\nerror: aborting due to 2 previous errors\n```\n\nAfter:\n\n```\nerror: expected one of `,`, `@`, `]`, or `|`, found `..`\n --> src/main.rs:5:20\n  |\n5 |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n  |                    ^^ expected one of `,`, `@`, `]`, or `|`\n  |\nhelp: if you meant to bind the contents of the rest of the array pattern into `ts`, use `@`\n  |\n5 |         [h, ref ts @ ..] => foo(c, n - h) + foo(ts, n),\n  |                    ^\n\nerror: aborting due to previous error\n```\n\nr? @estebank\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d19b51e441833630a53a8966e3bc0ed1c94420f7", "html_url": "https://github.com/rust-lang/rust/commit/d19b51e441833630a53a8966e3bc0ed1c94420f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d19b51e441833630a53a8966e3bc0ed1c94420f7/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6786c7d190a0792cd392fc2d8dde7c7de1e9f9b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/6786c7d190a0792cd392fc2d8dde7c7de1e9f9b3", "html_url": "https://github.com/rust-lang/rust/commit/6786c7d190a0792cd392fc2d8dde7c7de1e9f9b3"}, {"sha": "593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "url": "https://api.github.com/repos/rust-lang/rust/commits/593d1eed8216c4ab33500b323fbd1b3de4ecb34d", "html_url": "https://github.com/rust-lang/rust/commit/593d1eed8216c4ab33500b323fbd1b3de4ecb34d"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "c00b60848293346a3cd31cc48b09eb10c3385da7", "filename": "src/librustc_parse/parser/mod.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Flibrustc_parse%2Fparser%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Flibrustc_parse%2Fparser%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fparser%2Fmod.rs?ref=d19b51e441833630a53a8966e3bc0ed1c94420f7", "patch": "@@ -672,6 +672,26 @@ impl<'a> Parser<'a> {\n                                 }\n                             }\n \n+                            // If this was a missing `@` in a binding pattern\n+                            // bail with a suggestion\n+                            // https://github.com/rust-lang/rust/issues/72373\n+                            if self.prev_token.is_ident() && &self.token.kind == &token::DotDot {\n+                                let msg = format!(\n+                                    \"if you meant to bind the contents of \\\n+                                    the rest of the array pattern into `{}`, use `@`\",\n+                                    pprust::token_to_string(&self.prev_token)\n+                                );\n+                                expect_err\n+                                    .span_suggestion_verbose(\n+                                        self.prev_token.span.shrink_to_hi().until(self.token.span),\n+                                        &msg,\n+                                        \" @ \".to_string(),\n+                                        Applicability::MaybeIncorrect,\n+                                    )\n+                                    .emit();\n+                                break;\n+                            }\n+\n                             // Attempt to keep parsing if it was an omitted separator.\n                             match f(self) {\n                                 Ok(t) => {"}, {"sha": "4da6061c27fe840a82da12e0cb340dece6a4745e", "filename": "src/test/ui/issues/issue-72373.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72373.rs?ref=d19b51e441833630a53a8966e3bc0ed1c94420f7", "patch": "@@ -0,0 +1,9 @@\n+fn foo(c: &[u32], n: u32) -> u32 {\n+    match *c {\n+        [h, ..] if h > n => 0,\n+        [h, ..] if h == n => 1,\n+        [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n+        //~^ ERROR expected one of `,`, `@`, `]`, or `|`, found `..`\n+        [] => 0,\n+    }\n+}"}, {"sha": "dfde8624814f8e154303dbefedf3ce963d031e21", "filename": "src/test/ui/issues/issue-72373.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d19b51e441833630a53a8966e3bc0ed1c94420f7/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-72373.stderr?ref=d19b51e441833630a53a8966e3bc0ed1c94420f7", "patch": "@@ -0,0 +1,13 @@\n+error: expected one of `,`, `@`, `]`, or `|`, found `..`\n+  --> $DIR/issue-72373.rs:5:19\n+   |\n+LL |         [h, ref ts..] => foo(c, n - h) + foo(ts, n),\n+   |                   ^^ expected one of `,`, `@`, `]`, or `|`\n+   |\n+help: if you meant to bind the contents of the rest of the array pattern into `ts`, use `@`\n+   |\n+LL |         [h, ref ts @ ..] => foo(c, n - h) + foo(ts, n),\n+   |                    ^\n+\n+error: aborting due to previous error\n+"}]}