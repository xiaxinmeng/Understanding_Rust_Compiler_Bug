{"sha": "a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyMDBjMDFlNGZiMzIxNzlhZjFjYmJjNDdhMWU1ZWE3YTYzOTRlOWE=", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-06-17T06:15:33Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-06-17T06:15:33Z"}, "message": "Document how Windows compares environment variables", "tree": {"sha": "29b4376c05e310a4ff4f5f3a07488799b6d58805", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29b4376c05e310a4ff4f5f3a07488799b6d58805"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmDK6IYACgkQcTRy8vRW\nJ95xkg//V8byUqWAlIHZom1V/Vu0O1+gKvxOoqPA5i+vHAiLnyWa4+60ZyXxGgti\nE5FRhzlfAC1kUa+OKlQuG9vVv7kde2FWK1GEAKgcnh2eFALhMJtepUunQA/dTMNn\nAxPwVaLA2864cQWEFHERAR/L3l8SarG2AW+C9q4bCMcT0OcYygvsyOcGabTT48Lq\nI5KQS87ck38q32ESsrok/owIii7OP5nQfPD9MjTDVEaXJZH1idwalR+VegfIrQES\nGaYrAOja4ja1beqospVx36enm//KsTn4a46urL+uzFeAkiBmkZHfnbJ+jjkRz6JS\nf+VvX3kx1iJvL1d7mODWZslz7CPim8MUu7EKYhTsATLnyCd42q8aJVgw6E0VmkFz\njQMtZNh3KYveswOR29dlQoEV5p6BBZkC7VGMF95dLpWPck5/IxK4wGBOvFkDE33k\nD+/Lvfy5PnMVsd0FmT+DyGtC8D+IetE0/s72z4aEn7itCjwx/ndlx09SbKTAwF2D\nMWP0XIeKnhWAS9bWQdEjsPBxQFEBc+EmIvK9El3dq4EcDDJ5c9xTxazIf2Hei9GD\nfVXbm9KsrEL4TUCR4lk/uN3vTS+QSJBmPmaGrSO5ZpK7UkJJK8t4YIn/8ZHy5wNl\nhXfKA5S5A0cHucnJXzTNzeHzydNKKiv3iU6Q2JvSXLlkxigDGh8=\n=9lGl\n-----END PGP SIGNATURE-----", "payload": "tree 29b4376c05e310a4ff4f5f3a07488799b6d58805\nparent 8345538fec7aa45fabeb7283707386ac7ed51f5b\nauthor Chris Denton <christophersdenton@gmail.com> 1623910533 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1623910533 +0100\n\nDocument how Windows compares environment variables\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a", "html_url": "https://github.com/rust-lang/rust/commit/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8345538fec7aa45fabeb7283707386ac7ed51f5b", "url": "https://api.github.com/repos/rust-lang/rust/commits/8345538fec7aa45fabeb7283707386ac7ed51f5b", "html_url": "https://github.com/rust-lang/rust/commit/8345538fec7aa45fabeb7283707386ac7ed51f5b"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "988801a78f0f265c13cd9ff31a3cc5f8d5fa44cd", "filename": "library/std/src/sys/windows/process.rs", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs?ref=a200c01e4fb32179af1cbbc47a1e5ea7a6394e9a", "patch": "@@ -46,9 +46,26 @@ pub struct EnvKey {\n     utf16: Vec<u16>,\n }\n \n-// Windows environment variables preserve their case but comparisons use\n-// simplified case folding. So we call `CompareStringOrdinal` to get the OS to\n-// perform the comparison.\n+// Comparing Windows environment variable keys[1] are behaviourally the\n+// composition of two operations[2]:\n+//\n+// 1. Case-fold both strings. This is done using a language-independent\n+// uppercase mapping that's unique to Windows (albeit based on data from an\n+// older Unicode spec). It only operates on individual UTF-16 code units so\n+// surrogates are left unchanged. This uppercase mapping can potentially change\n+// between Windows versions.\n+//\n+// 2. Perform an ordinal comparison of the strings. A comparison using ordinal\n+// is just a comparison based on the numerical value of each UTF-16 code unit[3].\n+//\n+// Because the case-folding mapping is unique to Windows and not guaranteed to\n+// be stable, we ask the OS to compare the strings for us. This is done by\n+// calling `CompareStringOrdinal`[4] with `bIgnoreCase` set to `TRUE`.\n+//\n+// [1] https://docs.microsoft.com/en-us/dotnet/standard/base-types/best-practices-strings#choosing-a-stringcomparison-member-for-your-method-call\n+// [2] https://docs.microsoft.com/en-us/dotnet/standard/base-types/best-practices-strings#stringtoupper-and-stringtolower\n+// [3] https://docs.microsoft.com/en-us/dotnet/api/system.stringcomparison?view=net-5.0#System_StringComparison_Ordinal\n+// [4] https://docs.microsoft.com/en-us/windows/win32/api/stringapiset/nf-stringapiset-comparestringordinal\n impl Ord for EnvKey {\n     fn cmp(&self, other: &Self) -> cmp::Ordering {\n         unsafe {\n@@ -84,6 +101,8 @@ impl PartialEq for EnvKey {\n     }\n }\n \n+// Environment variable keys should preserve their original case even though\n+// they are compared using a caseless string mapping.\n impl From<OsString> for EnvKey {\n     fn from(k: OsString) -> Self {\n         EnvKey { utf16: k.encode_wide().collect(), os_string: k }"}]}