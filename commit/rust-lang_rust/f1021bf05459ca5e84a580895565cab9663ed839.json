{"sha": "f1021bf05459ca5e84a580895565cab9663ed839", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxMDIxYmYwNTQ1OWNhNWU4NGE1ODA4OTU1NjVjYWI5NjYzZWQ4Mzk=", "commit": {"author": {"name": "Gus Wynn", "email": "guswynn@gmail.com", "date": "2021-09-18T19:23:16Z"}, "committer": {"name": "Gus Wynn", "email": "guswynn@gmail.com", "date": "2021-09-18T19:23:16Z"}, "message": "generic test", "tree": {"sha": "1d182a12ea117a1bbecc6c8dd667f0d3c59f906a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d182a12ea117a1bbecc6c8dd667f0d3c59f906a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1021bf05459ca5e84a580895565cab9663ed839", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1021bf05459ca5e84a580895565cab9663ed839", "html_url": "https://github.com/rust-lang/rust/commit/f1021bf05459ca5e84a580895565cab9663ed839", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1021bf05459ca5e84a580895565cab9663ed839/comments", "author": {"login": "guswynn", "id": 5404303, "node_id": "MDQ6VXNlcjU0MDQzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5404303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guswynn", "html_url": "https://github.com/guswynn", "followers_url": "https://api.github.com/users/guswynn/followers", "following_url": "https://api.github.com/users/guswynn/following{/other_user}", "gists_url": "https://api.github.com/users/guswynn/gists{/gist_id}", "starred_url": "https://api.github.com/users/guswynn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guswynn/subscriptions", "organizations_url": "https://api.github.com/users/guswynn/orgs", "repos_url": "https://api.github.com/users/guswynn/repos", "events_url": "https://api.github.com/users/guswynn/events{/privacy}", "received_events_url": "https://api.github.com/users/guswynn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "guswynn", "id": 5404303, "node_id": "MDQ6VXNlcjU0MDQzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5404303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guswynn", "html_url": "https://github.com/guswynn", "followers_url": "https://api.github.com/users/guswynn/followers", "following_url": "https://api.github.com/users/guswynn/following{/other_user}", "gists_url": "https://api.github.com/users/guswynn/gists{/gist_id}", "starred_url": "https://api.github.com/users/guswynn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guswynn/subscriptions", "organizations_url": "https://api.github.com/users/guswynn/orgs", "repos_url": "https://api.github.com/users/guswynn/repos", "events_url": "https://api.github.com/users/guswynn/events{/privacy}", "received_events_url": "https://api.github.com/users/guswynn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "110aecd23eefa603ffd1b5d8f64832230d42b435", "url": "https://api.github.com/repos/rust-lang/rust/commits/110aecd23eefa603ffd1b5d8f64832230d42b435", "html_url": "https://github.com/rust-lang/rust/commit/110aecd23eefa603ffd1b5d8f64832230d42b435"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "ac67d2b93c57bc36a41a1cfd223ef51cf91f5a45", "filename": "compiler/rustc_typeck/src/check/generator_interior.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f1021bf05459ca5e84a580895565cab9663ed839/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fgenerator_interior.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1021bf05459ca5e84a580895565cab9663ed839/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fgenerator_interior.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fgenerator_interior.rs?ref=f1021bf05459ca5e84a580895565cab9663ed839", "patch": "@@ -462,6 +462,9 @@ pub struct SuspendCheckData<'a, 'tcx> {\n // Returns whether it emitted a diagnostic or not\n // Note that this fn and the proceding one are based on the code\n // for creating must_use diagnostics\n+//\n+// Note that this technique was chosen over things like a `Suspend` marker trait\n+// as it is simpler and has precendent in the compiler\n pub fn check_must_not_suspend_ty<'tcx>(\n     fcx: &FnCtxt<'_, 'tcx>,\n     ty: Ty<'tcx>,"}, {"sha": "94457e375400e69572c041dfca450be13f8d17af", "filename": "src/test/ui/lint/must_not_suspend/generic.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f1021bf05459ca5e84a580895565cab9663ed839/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1021bf05459ca5e84a580895565cab9663ed839/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.rs?ref=f1021bf05459ca5e84a580895565cab9663ed839", "patch": "@@ -0,0 +1,21 @@\n+// edition:2018\n+#![feature(must_not_suspend)]\n+#![deny(must_not_suspend)]\n+\n+#[must_not_suspend]\n+struct No {}\n+\n+async fn shushspend() {}\n+\n+async fn wheeee<T>(t: T) {\n+    shushspend().await;\n+    drop(t);\n+}\n+\n+async fn yes() {\n+    wheeee(No {}).await; //~ ERROR `No` held across\n+    //~^ ERROR `No` held across\n+}\n+\n+fn main() {\n+}"}, {"sha": "d853ba720a3ad909213b79fc9539a54dffba548f", "filename": "src/test/ui/lint/must_not_suspend/generic.stderr", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/f1021bf05459ca5e84a580895565cab9663ed839/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f1021bf05459ca5e84a580895565cab9663ed839/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fmust_not_suspend%2Fgeneric.stderr?ref=f1021bf05459ca5e84a580895565cab9663ed839", "patch": "@@ -0,0 +1,31 @@\n+error: `No` held across a suspend point, but should not be\n+  --> $DIR/generic.rs:16:12\n+   |\n+LL |     wheeee(No {}).await;\n+   |     -------^^^^^------- the value is held across this suspend point\n+   |\n+note: the lint level is defined here\n+  --> $DIR/generic.rs:3:9\n+   |\n+LL | #![deny(must_not_suspend)]\n+   |         ^^^^^^^^^^^^^^^^\n+help: consider using a block (`{ ... }`) to shrink the value's scope, ending before the suspend point\n+  --> $DIR/generic.rs:16:12\n+   |\n+LL |     wheeee(No {}).await;\n+   |            ^^^^^\n+\n+error: `No` held across a suspend point, but should not be\n+  --> $DIR/generic.rs:16:12\n+   |\n+LL |     wheeee(No {}).await;\n+   |     -------^^^^^------- the value is held across this suspend point\n+   |\n+help: consider using a block (`{ ... }`) to shrink the value's scope, ending before the suspend point\n+  --> $DIR/generic.rs:16:12\n+   |\n+LL |     wheeee(No {}).await;\n+   |            ^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}