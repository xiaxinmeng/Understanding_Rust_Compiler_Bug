{"sha": "1b2e72726f2e395578d4713f75743761677b6a4e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiMmU3MjcyNmYyZTM5NTU3OGQ0NzEzZjc1NzQzNzYxNjc3YjZhNGU=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-10-08T01:38:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-08T01:38:49Z"}, "message": "Merge pull request #3078 from YaLTeR/fix-closure-indentation\n\nFix inconsistent overflow behavior in Visual style", "tree": {"sha": "39163f787a405b8860b27a56e920ab899d2265cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/39163f787a405b8860b27a56e920ab899d2265cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b2e72726f2e395578d4713f75743761677b6a4e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJburUpCRBK7hj4Ov3rIwAAdHIIAKuonYOdp2RmXf4jhuWm1Cv0\npmBv9dskDDYwz4LQyUTS+CBO68QgQpfnIYqmSHveQNJ7n9iWdevrR8/IdQT4Rueg\nSGxG5eyO7p/JcoQyvTLPvCgPeuebIKd8FBdZF7ol8/7QUpfclTGRxqJU4zuMslag\nSxhbgqTkGeOEaHE1R30G4nJ1cKxbSgbN6snZHG6xuzAtSfCQbamQJMVatd1DqohJ\nj3K+7cqN7xychhcnDVQI4+7qGHccRn5jAD1UDaSEp4Rn8MEZGVFmeyLvvAZ/9vT1\n+1lgLYsv45iSsRPULHchmqDeMqHttSGtNkuelHnfw8jdMEsMp5B1yffps3WFlG8=\n=E01M\n-----END PGP SIGNATURE-----\n", "payload": "tree 39163f787a405b8860b27a56e920ab899d2265cb\nparent 832a912f79cf5eda76d60c5b83238bdade21cde0\nparent dee68434e6046094bd3740618388d18077bf2a43\nauthor Nick Cameron <nrc@ncameron.org> 1538962729 +1300\ncommitter GitHub <noreply@github.com> 1538962729 +1300\n\nMerge pull request #3078 from YaLTeR/fix-closure-indentation\n\nFix inconsistent overflow behavior in Visual style"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b2e72726f2e395578d4713f75743761677b6a4e", "html_url": "https://github.com/rust-lang/rust/commit/1b2e72726f2e395578d4713f75743761677b6a4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b2e72726f2e395578d4713f75743761677b6a4e/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "832a912f79cf5eda76d60c5b83238bdade21cde0", "url": "https://api.github.com/repos/rust-lang/rust/commits/832a912f79cf5eda76d60c5b83238bdade21cde0", "html_url": "https://github.com/rust-lang/rust/commit/832a912f79cf5eda76d60c5b83238bdade21cde0"}, {"sha": "dee68434e6046094bd3740618388d18077bf2a43", "url": "https://api.github.com/repos/rust-lang/rust/commits/dee68434e6046094bd3740618388d18077bf2a43", "html_url": "https://github.com/rust-lang/rust/commit/dee68434e6046094bd3740618388d18077bf2a43"}], "stats": {"total": 183, "additions": 140, "deletions": 43}, "files": [{"sha": "b7619c0a18af49a65bee7bc253211cad1d9817fe", "filename": "src/chains.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -576,7 +576,15 @@ impl<'a> ChainFormatterShared<'a> {\n         if all_in_one_line || extendable {\n             // First we try to 'overflow' the last child and see if it looks better than using\n             // vertical layout.\n-            if let Some(one_line_shape) = last_shape.offset_left(almost_total) {\n+            let one_line_shape = if context.use_block_indent() {\n+                last_shape.offset_left(almost_total)\n+            } else {\n+                last_shape\n+                    .visual_indent(almost_total)\n+                    .sub_width(almost_total)\n+            };\n+\n+            if let Some(one_line_shape) = one_line_shape {\n                 if let Some(rw) = last.rewrite(context, one_line_shape) {\n                     // We allow overflowing here only if both of the following conditions match:\n                     // 1. The entire chain fits in a single line except the last child."}, {"sha": "d3f51fc5f3c7090a855cb399949cf36587bd1484", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -1326,8 +1326,7 @@ pub fn can_be_overflowed_expr(context: &RewriteContext, expr: &ast::Expr, args_l\n             context.config.combine_control_expr() && context.use_block_indent() && args_len == 1\n         }\n         ast::ExprKind::Block(..) | ast::ExprKind::Closure(..) => {\n-            context.use_block_indent()\n-                || context.config.indent_style() == IndentStyle::Visual && args_len > 1\n+            context.use_block_indent() || context.config.indent_style() == IndentStyle::Visual\n         }\n         ast::ExprKind::Array(..)\n         | ast::ExprKind::Call(..)"}, {"sha": "43742683e4cd35365653468027fe78fd9eeaea74", "filename": "tests/source/issue-3049.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Fsource%2Fissue-3049.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Fsource%2Fissue-3049.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3049.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -0,0 +1,45 @@\n+// rustfmt-indent_style: Visual\n+fn main() {\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(|| {\n+                                 let x = hello();\n+                             });\n+\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(arg, || {\n+                 let x = hello();\n+             });\n+\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(arg,\n+                             || {\n+                                 let x = hello();\n+                             },\n+                             arg);\n+\n+    AAAAAAAAAAA.function(|| {\n+                   let _ = ();\n+               });\n+\n+    AAAAAAAAAAA.chain().function(|| {\n+        let _ = ();\n+    })\n+}"}, {"sha": "76ef99a4b59f15d62b0ffa26b987c8fbcb1e2731", "filename": "tests/target/chains-visual.rs", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fchains-visual.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fchains-visual.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains-visual.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -37,8 +37,8 @@ fn main() {\n \n     fffffffffffffffffffffffffffffffffff(a, {\n         SCRIPT_TASK_ROOT.with(|root| {\n-                                  *root.borrow_mut() = Some(&script_task);\n-                              });\n+                            *root.borrow_mut() = Some(&script_task);\n+                        });\n     });\n \n     let suuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuum =\n@@ -47,9 +47,9 @@ fn main() {\n                .fold(0, |acc, x| acc + x);\n \n     aaaaaaaaaaaaaaaa.map(|x| {\n-                             x += 1;\n-                             x\n-                         })\n+                        x += 1;\n+                        x\n+                    })\n                     .filter(some_mod::some_filter)\n }\n \n@@ -83,16 +83,16 @@ fn floaters() {\n      .baz();\n \n     Foo { x: val }.baz(|| {\n-                           force();\n-                           multiline();\n-                       })\n+                      force();\n+                      multiline();\n+                  })\n                   .quux();\n \n     Foo { y: i_am_multi_line,\n           z: ok }.baz(|| {\n-                          force();\n-                          multiline();\n-                      })\n+                     force();\n+                     multiline();\n+                 })\n                  .quux();\n \n     a + match x {\n@@ -137,22 +137,22 @@ fn issue1434() {\n     for _ in 0..100 {\n         let prototype_id =\n             PrototypeIdData::from_reader::<_, B>(&mut self.file_cursor).chain_err(|| {\n-                           format!(\"could not read prototype ID at offset {:#010x}\",\n-                                   current_offset)\n-                       })?;\n+                format!(\"could not read prototype ID at offset {:#010x}\",\n+                        current_offset)\n+            })?;\n     }\n }\n \n fn issue2264() {\n     {\n         something.function()\n                  .map(|| {\n-                          if let a_very_very_very_very_very_very_very_very_long_variable =\n-                              compute_this_variable()\n-                          {\n-                              println!(\"Hello\");\n-                          }\n-                      })\n+                     if let a_very_very_very_very_very_very_very_very_long_variable =\n+                         compute_this_variable()\n+                     {\n+                         println!(\"Hello\");\n+                     }\n+                 })\n                  .collect();\n     }\n }"}, {"sha": "37b216ea9b137258d1021ca7a5bef60262b73a44", "filename": "tests/target/issue-2985.rs", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fissue-2985.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fissue-2985.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2985.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -4,30 +4,30 @@ fn foo() {\n         {\n             let extra_encoder_settings = extra_encoder_settings.iter()\n                                                                .filter_map(|&(name, value)| {\n-                                                                               value.split()\n-                                                                                    .next()\n-                                                                                    .something()\n-                                                                                    .something2()\n-                                                                                    .something3()\n-                                                                                    .something4()\n-                                                                           });\n+                                                                   value.split()\n+                                                                        .next()\n+                                                                        .something()\n+                                                                        .something2()\n+                                                                        .something3()\n+                                                                        .something4()\n+                                                               });\n             let extra_encoder_settings = extra_encoder_settings.iter()\n                                                                .filter_map(|&(name, value)| {\n-                                                                               value.split()\n-                                                                                    .next()\n-                                                                                    .something()\n-                                                                                    .something2()\n-                                                                                    .something3()\n-                                                                                    .something4()\n-                                                                           })\n+                                                                   value.split()\n+                                                                        .next()\n+                                                                        .something()\n+                                                                        .something2()\n+                                                                        .something3()\n+                                                                        .something4()\n+                                                               })\n                                                                .something();\n             if let Some(subpod) = pod.subpods.iter().find(|s| {\n-                                                              !s.plaintext\n-                                                                .as_ref()\n-                                                                .map(String::as_ref)\n-                                                                .unwrap_or(\"\")\n-                                                                .is_empty()\n-                                                          }) {\n+                                                        !s.plaintext\n+                                                          .as_ref()\n+                                                          .map(String::as_ref)\n+                                                          .unwrap_or(\"\")\n+                                                          .is_empty()\n+                                                    }) {\n                 do_something();\n             }\n         }"}, {"sha": "fad15435433d10bb71e3ff2e50fae399973b1b42", "filename": "tests/target/issue-3049.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fissue-3049.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b2e72726f2e395578d4713f75743761677b6a4e/tests%2Ftarget%2Fissue-3049.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3049.rs?ref=1b2e72726f2e395578d4713f75743761677b6a4e", "patch": "@@ -0,0 +1,45 @@\n+// rustfmt-indent_style: Visual\n+fn main() {\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(|| {\n+                 let x = hello();\n+             });\n+\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(arg, || {\n+                 let x = hello();\n+             });\n+\n+    something.aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .aaaaaaaaaaaa()\n+             .bench_function(arg,\n+                             || {\n+                                 let x = hello();\n+                             },\n+                             arg);\n+\n+    AAAAAAAAAAA.function(|| {\n+                   let _ = ();\n+               });\n+\n+    AAAAAAAAAAA.chain().function(|| {\n+                           let _ = ();\n+                       })\n+}"}]}