{"sha": "3fac6f8b54b3d48aad63941a76010314fdf532e0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmYWM2ZjhiNTRiM2Q0OGFhZDYzOTQxYTc2MDEwMzE0ZmRmNTMyZTA=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-01-22T03:39:45Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2013-01-22T03:39:45Z"}, "message": "Revert \"doc: Fix tutorial-ffi xfail-tests and update SHA1() to use size_t\"\n\nThis reverts commit 50c8cbb25aeb9d8132ac06914e9978d3cddb7f42.", "tree": {"sha": "16644ad5450eaec5dac2cfdaed319fc864305b73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/16644ad5450eaec5dac2cfdaed319fc864305b73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3fac6f8b54b3d48aad63941a76010314fdf532e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3fac6f8b54b3d48aad63941a76010314fdf532e0", "html_url": "https://github.com/rust-lang/rust/commit/3fac6f8b54b3d48aad63941a76010314fdf532e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3fac6f8b54b3d48aad63941a76010314fdf532e0/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9c8d6fdd145db125decffed44de396119a01ca9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9c8d6fdd145db125decffed44de396119a01ca9", "html_url": "https://github.com/rust-lang/rust/commit/c9c8d6fdd145db125decffed44de396119a01ca9"}], "stats": {"total": 40, "additions": 16, "deletions": 24}, "files": [{"sha": "8324f752c1d3e697253587774779597f8b905435", "filename": "doc/tutorial-ffi.md", "status": "modified", "additions": 16, "deletions": 24, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/3fac6f8b54b3d48aad63941a76010314fdf532e0/doc%2Ftutorial-ffi.md", "raw_url": "https://github.com/rust-lang/rust/raw/3fac6f8b54b3d48aad63941a76010314fdf532e0/doc%2Ftutorial-ffi.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Ftutorial-ffi.md?ref=3fac6f8b54b3d48aad63941a76010314fdf532e0", "patch": "@@ -12,12 +12,12 @@ argument, which it then converts to a hexadecimal string and prints to\n standard output. If you have the OpenSSL libraries installed, it\n should compile and run without any extra effort.\n \n-~~~~\n+~~~~ {.xfail-test}\n extern mod std;\n-use libc::size_t;\n+use libc::c_uint;\n \n extern mod crypto {\n-    fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8;\n+    fn SHA1(src: *u8, sz: c_uint, out: *u8) -> *u8;\n }\n \n fn as_hex(data: ~[u8]) -> ~str {\n@@ -29,7 +29,7 @@ fn as_hex(data: ~[u8]) -> ~str {\n fn sha1(data: ~str) -> ~str unsafe {\n     let bytes = str::to_bytes(data);\n     let hash = crypto::SHA1(vec::raw::to_ptr(bytes),\n-                            vec::len(bytes) as size_t, ptr::null());\n+                            vec::len(bytes) as c_uint, ptr::null());\n     return as_hex(vec::from_buf(hash, 20));\n }\n \n@@ -43,11 +43,9 @@ fn main() {\n Before we can call the `SHA1` function defined in the OpenSSL library, we have\n to declare it. That is what this part of the program does:\n \n-~~~~\n-# use libc::size_t;\n+~~~~ {.xfail-test}\n extern mod crypto {\n-    fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8;\n-}\n+    fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8; }\n ~~~~\n \n An `extern` module declaration containing function signatures introduces the\n@@ -64,11 +62,10 @@ searches for the shared library with that name, and links the library into the\n program. If you want the module to have a different name from the actual\n library, you can use the `\"link_name\"` attribute, like:\n \n-~~~~\n-# use libc::size_t;\n+~~~~ {.xfail-test}\n #[link_name = \"crypto\"]\n extern mod something {\n-    fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8;\n+    fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8;\n }\n ~~~~\n \n@@ -97,10 +94,9 @@ calling conventions.\n \n The foreign `SHA1` function takes three arguments, and returns a pointer.\n \n-~~~~\n-# use libc::size_t;\n+~~~~ {.xfail-test}\n # extern mod crypto {\n-fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8;\n+fn SHA1(src: *u8, sz: libc::c_uint, out: *u8) -> *u8;\n # }\n ~~~~\n \n@@ -112,8 +108,8 @@ probably even worse, your code will work on one platform, but break on\n another.\n \n In this case, we declare that `SHA1` takes two `unsigned char*`\n-arguments and one `size_t`. The Rust equivalents are `*u8`\n-unsafe pointers and an `libc::size_t` (which, like `unsigned long`, is a\n+arguments and one `unsigned long`. The Rust equivalents are `*u8`\n+unsafe pointers and an `uint` (which, like `unsigned long`, is a\n machine-word-sized type).\n \n The standard library provides various functions to create unsafe pointers,\n@@ -128,16 +124,14 @@ The `sha1` function is the most obscure part of the program.\n \n ~~~~\n # pub mod crypto {\n-#   use libc::size_t;\n-#   pub fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8 { out }\n+#   pub fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8 { out }\n # }\n-# use libc::size_t;\n # fn as_hex(data: ~[u8]) -> ~str { ~\"hi\" }\n fn sha1(data: ~str) -> ~str {\n     unsafe {\n         let bytes = str::to_bytes(data);\n         let hash = crypto::SHA1(vec::raw::to_ptr(bytes),\n-                                vec::len(bytes) as size_t, ptr::null());\n+                                vec::len(bytes), ptr::null());\n         return as_hex(vec::from_buf(hash, 20));\n     }\n }\n@@ -175,16 +169,14 @@ Let's look at our `sha1` function again.\n \n ~~~~\n # pub mod crypto {\n-#     use libc::size_t;\n-#     pub fn SHA1(src: *u8, sz: size_t, out: *u8) -> *u8 { out }\n+#     pub fn SHA1(src: *u8, sz: uint, out: *u8) -> *u8 { out }\n # }\n-# use libc::size_t;\n # fn as_hex(data: ~[u8]) -> ~str { ~\"hi\" }\n # fn x(data: ~str) -> ~str {\n # unsafe {\n let bytes = str::to_bytes(data);\n let hash = crypto::SHA1(vec::raw::to_ptr(bytes),\n-                        vec::len(bytes) as size_t, ptr::null());\n+                        vec::len(bytes), ptr::null());\n return as_hex(vec::from_buf(hash, 20));\n # }\n # }"}]}