{"sha": "f5c069c9d909dc13ca84415e228288a08b95df7d", "node_id": "C_kwDOAAsO6NoAKGY1YzA2OWM5ZDkwOWRjMTNjYTg0NDE1ZTIyODI4OGEwOGI5NWRmN2Q", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-04-04T13:06:51Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-04T13:06:51Z"}, "message": "Merge #11894\n\n11894: complete pattern args based on type name r=Veykril a=cameron1024\n\nAddresses #11892 \r\n\r\nChanges function argument completion to cover a case like this:\r\n```rust\r\nstruct Foo { bar: i32 }\r\n\r\nfn qux(Foo { bar }: Foo) {\r\n  println!(\"{bar}\");\r\n}\r\n```\r\nWhen completing the function call for `qux`, instead of expanding to `qux(_)`, it will now expand to `qux(foo)` (based on the snake-cased version of the name of the ADT)\r\n\r\nNon ADTs are unaffected\r\n\n\nCo-authored-by: cameron <cameron.studdstreet@gmail.com>\nCo-authored-by: cameron1024 <cameron.studdstreet@gmail.com>", "tree": {"sha": "d654732da06e81ec7b450ef59ccb8428f6a54428", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d654732da06e81ec7b450ef59ccb8428f6a54428"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5c069c9d909dc13ca84415e228288a08b95df7d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiSu1rCRBK7hj4Ov3rIwAAZM8IABMPheT5cpNCy0mIsGzOoiuj\n6WOmCaxq8uiSbWsCCU66b3wxVNn9gr17/Att8vVAwFn08Y3fymwdvpsliUo4sDtV\nBlZPRnls/tcgxLxFV1o7BwxRb08d8CmOMLd5WsFSYMoICYLLqlDpIz+YXe+8i9+4\n9AWejmjxwwo38+K8n4NsdMaMK0V2KuAoVR3xZJ289lPoRcFgKsZLyxJvh3LpbyXC\ntLp7/tgMmZiVaorXh7X8T5Wvml7APPt2w0Mg5G106E/Fw70KwGkcUo6w09CNVa9P\n+788u2D2Z1Oj0AMiAHYhaqpk6DOJZXKB562s5A/2C6AvjlvOoyqurR6pgZmp0kc=\n=H+/d\n-----END PGP SIGNATURE-----\n", "payload": "tree d654732da06e81ec7b450ef59ccb8428f6a54428\nparent 46d7ee68f26285db26b2640f2c07d6332380c756\nparent 37d2a8243fc23d84490090803a428cf130894b6d\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1649077611 +0000\ncommitter GitHub <noreply@github.com> 1649077611 +0000\n\nMerge #11894\n\n11894: complete pattern args based on type name r=Veykril a=cameron1024\n\nAddresses #11892 \r\n\r\nChanges function argument completion to cover a case like this:\r\n```rust\r\nstruct Foo { bar: i32 }\r\n\r\nfn qux(Foo { bar }: Foo) {\r\n  println!(\"{bar}\");\r\n}\r\n```\r\nWhen completing the function call for `qux`, instead of expanding to `qux(_)`, it will now expand to `qux(foo)` (based on the snake-cased version of the name of the ADT)\r\n\r\nNon ADTs are unaffected\r\n\n\nCo-authored-by: cameron <cameron.studdstreet@gmail.com>\nCo-authored-by: cameron1024 <cameron.studdstreet@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5c069c9d909dc13ca84415e228288a08b95df7d", "html_url": "https://github.com/rust-lang/rust/commit/f5c069c9d909dc13ca84415e228288a08b95df7d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5c069c9d909dc13ca84415e228288a08b95df7d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46d7ee68f26285db26b2640f2c07d6332380c756", "url": "https://api.github.com/repos/rust-lang/rust/commits/46d7ee68f26285db26b2640f2c07d6332380c756", "html_url": "https://github.com/rust-lang/rust/commit/46d7ee68f26285db26b2640f2c07d6332380c756"}, {"sha": "37d2a8243fc23d84490090803a428cf130894b6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/37d2a8243fc23d84490090803a428cf130894b6d", "html_url": "https://github.com/rust-lang/rust/commit/37d2a8243fc23d84490090803a428cf130894b6d"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "2031eef049a7e16db598029685d122ff6b34b4e6", "filename": "crates/ide_completion/src/render/function.rs", "status": "modified", "additions": 45, "deletions": 2, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/f5c069c9d909dc13ca84415e228288a08b95df7d/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5c069c9d909dc13ca84415e228288a08b95df7d/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs?ref=f5c069c9d909dc13ca84415e228288a08b95df7d", "patch": "@@ -3,7 +3,7 @@\n use hir::{db::HirDatabase, AsAssocItem, HirDisplay};\n use ide_db::{SnippetCap, SymbolKind};\n use itertools::Itertools;\n-use stdx::format_to;\n+use stdx::{format_to, to_lower_snake_case};\n use syntax::SmolStr;\n \n use crate::{\n@@ -135,7 +135,17 @@ pub(super) fn add_call_parens<'b>(\n                             let ref_ = ref_of_param(ctx, text, param.ty());\n                             f(&format_args!(\"${{{}:{}{}}}\", index + offset, ref_, text))\n                         }\n-                        None => f(&format_args!(\"${{{}:_}}\", index + offset,)),\n+                        None => {\n+                            let name = match param.ty().as_adt() {\n+                                None => \"_\".to_string(),\n+                                Some(adt) => adt\n+                                    .name(ctx.db)\n+                                    .as_text()\n+                                    .map(|s| to_lower_snake_case(s.as_str()))\n+                                    .unwrap_or_else(|| \"_\".to_string()),\n+                            };\n+                            f(&format_args!(\"${{{}:{}}}\", index + offset, name))\n+                        }\n                     }\n                 });\n             match self_param {\n@@ -516,6 +526,39 @@ fn take_mutably(mut x: &i32) {}\n fn main() {\n     take_mutably(${1:x})$0\n }\n+\"#,\n+        );\n+    }\n+\n+    #[test]\n+    fn complete_pattern_args_with_type_name_if_adt() {\n+        check_edit(\n+            \"qux\",\n+            r#\"\n+struct Foo {\n+    bar: i32\n+}\n+\n+fn qux(Foo { bar }: Foo) {\n+    println!(\"{}\", bar);\n+}\n+\n+fn main() {\n+  qu$0\n+}\n+\"#,\n+            r#\"\n+struct Foo {\n+    bar: i32\n+}\n+\n+fn qux(Foo { bar }: Foo) {\n+    println!(\"{}\", bar);\n+}\n+\n+fn main() {\n+  qux(${1:foo})$0\n+}\n \"#,\n         );\n     }"}]}