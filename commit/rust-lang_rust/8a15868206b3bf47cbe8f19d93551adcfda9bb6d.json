{"sha": "8a15868206b3bf47cbe8f19d93551adcfda9bb6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhMTU4NjgyMDZiM2JmNDdjYmU4ZjE5ZDkzNTUxYWRjZmRhOWJiNmQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-03-23T22:11:12Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-03-23T22:11:12Z"}, "message": "rollup merge of #23640: nagisa/thread-less-weak\n\nThis is more portable as far as linux is concerned.", "tree": {"sha": "8e9c588de8167db52ff7eb436710f85e4b1b2261", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e9c588de8167db52ff7eb436710f85e4b1b2261"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a15868206b3bf47cbe8f19d93551adcfda9bb6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a15868206b3bf47cbe8f19d93551adcfda9bb6d", "html_url": "https://github.com/rust-lang/rust/commit/8a15868206b3bf47cbe8f19d93551adcfda9bb6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a15868206b3bf47cbe8f19d93551adcfda9bb6d/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e06ebbfc0d7c3655656dba1f3255e34fa711b68", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e06ebbfc0d7c3655656dba1f3255e34fa711b68", "html_url": "https://github.com/rust-lang/rust/commit/5e06ebbfc0d7c3655656dba1f3255e34fa711b68"}, {"sha": "d29d5545b6a5485bb1a51e035889e20330b2e4f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/d29d5545b6a5485bb1a51e035889e20330b2e4f7", "html_url": "https://github.com/rust-lang/rust/commit/d29d5545b6a5485bb1a51e035889e20330b2e4f7"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "eb2a6dc08bf4fa768b7715679eba4244df81b179", "filename": "src/libstd/sys/unix/thread.rs", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/8a15868206b3bf47cbe8f19d93551adcfda9bb6d/src%2Flibstd%2Fsys%2Funix%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a15868206b3bf47cbe8f19d93551adcfda9bb6d/src%2Flibstd%2Fsys%2Funix%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fthread.rs?ref=8a15868206b3bf47cbe8f19d93551adcfda9bb6d", "patch": "@@ -229,19 +229,16 @@ pub unsafe fn create(stack: usize, p: Thunk) -> io::Result<rust_thread> {\n \n #[cfg(any(target_os = \"linux\", target_os = \"android\"))]\n pub unsafe fn set_name(name: &str) {\n-    // pthread_setname_np() since glibc 2.12\n-    // availability autodetected via weak linkage\n-    type F = unsafe extern fn(libc::pthread_t, *const libc::c_char)\n-                              -> libc::c_int;\n+    // pthread wrapper only appeared in glibc 2.12, so we use syscall directly.\n     extern {\n-        #[linkage = \"extern_weak\"]\n-        static pthread_setname_np: *const ();\n-    }\n-    if !pthread_setname_np.is_null() {\n-        let cname = CString::new(name).unwrap();\n-        mem::transmute::<*const (), F>(pthread_setname_np)(pthread_self(),\n-                                                           cname.as_ptr());\n+        fn prctl(option: libc::c_int, arg2: libc::c_ulong, arg3: libc::c_ulong,\n+                 arg4: libc::c_ulong, arg5: libc::c_ulong) -> libc::c_int;\n     }\n+    const PR_SET_NAME: libc::c_int = 15;\n+    let cname = CString::new(name).unwrap_or_else(|_| {\n+        panic!(\"thread name may not contain interior null bytes\")\n+    });\n+    prctl(PR_SET_NAME, cname.as_ptr() as libc::c_ulong, 0, 0, 0);\n }\n \n #[cfg(any(target_os = \"freebsd\","}]}