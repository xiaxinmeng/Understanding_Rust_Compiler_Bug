{"sha": "9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkZGJiOTEzM2M4NmRmOWFhYjdiOThhMGU2YjY0MWI4NDdjODAwZWM=", "commit": {"author": {"name": "Havvy", "email": "ryan.havvy@gmail.com", "date": "2016-11-02T09:38:36Z"}, "committer": {"name": "Havvy", "email": "ryan.havvy@gmail.com", "date": "2016-11-03T04:57:36Z"}, "message": "Added Graph::is_cyclicic_node algorithm", "tree": {"sha": "ba2aa4bc49234a20f34b7f130024ead54d2690e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba2aa4bc49234a20f34b7f130024ead54d2690e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "html_url": "https://github.com/rust-lang/rust/commit/9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ddbb9133c86df9aab7b98a0e6b641b847c800ec/comments", "author": {"login": "Havvy", "id": 731722, "node_id": "MDQ6VXNlcjczMTcyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/731722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Havvy", "html_url": "https://github.com/Havvy", "followers_url": "https://api.github.com/users/Havvy/followers", "following_url": "https://api.github.com/users/Havvy/following{/other_user}", "gists_url": "https://api.github.com/users/Havvy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Havvy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Havvy/subscriptions", "organizations_url": "https://api.github.com/users/Havvy/orgs", "repos_url": "https://api.github.com/users/Havvy/repos", "events_url": "https://api.github.com/users/Havvy/events{/privacy}", "received_events_url": "https://api.github.com/users/Havvy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Havvy", "id": 731722, "node_id": "MDQ6VXNlcjczMTcyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/731722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Havvy", "html_url": "https://github.com/Havvy", "followers_url": "https://api.github.com/users/Havvy/followers", "following_url": "https://api.github.com/users/Havvy/following{/other_user}", "gists_url": "https://api.github.com/users/Havvy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Havvy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Havvy/subscriptions", "organizations_url": "https://api.github.com/users/Havvy/orgs", "repos_url": "https://api.github.com/users/Havvy/repos", "events_url": "https://api.github.com/users/Havvy/events{/privacy}", "received_events_url": "https://api.github.com/users/Havvy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d91581cca025fbf308ed3402d04a55ea0bb0267", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d91581cca025fbf308ed3402d04a55ea0bb0267", "html_url": "https://github.com/rust-lang/rust/commit/7d91581cca025fbf308ed3402d04a55ea0bb0267"}], "stats": {"total": 97, "additions": 82, "deletions": 15}, "files": [{"sha": "f94ed6b7209462dd0d7343492d2de705a9fc358a", "filename": "src/librustc_data_structures/graph/mod.rs", "status": "modified", "additions": 40, "deletions": 11, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/9ddbb9133c86df9aab7b98a0e6b641b847c800ec/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ddbb9133c86df9aab7b98a0e6b641b847c800ec/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fgraph%2Fmod.rs?ref=9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "patch": "@@ -231,14 +231,14 @@ impl<N: Debug, E: Debug> Graph<N, E> {\n \n     // # Iterating over nodes, edges\n \n-    pub fn all_nodes_enumerated(&self) -> Nodes<N> {\n-        Nodes {\n+    pub fn enumerated_nodes(&self) -> EnumeratedNodes<N> {\n+        EnumeratedNodes {\n             iter: self.nodes.iter().enumerate()\n         }\n     }\n \n-    pub fn all_edges_enumerated(&self) -> Edges<E> {\n-        Edges {\n+    pub fn enumerated_edges(&self) -> EnumeratedEdges<E> {\n+        EnumeratedEdges {\n             iter: self.edges.iter().enumerate()\n         }\n     }\n@@ -247,14 +247,14 @@ impl<N: Debug, E: Debug> Graph<N, E> {\n         where F: FnMut(NodeIndex, &'a Node<N>) -> bool\n     {\n         //! Iterates over all edges defined in the graph.\n-        self.all_nodes_enumerated().all(|(node_idx, node)| f(node_idx, node))\n+        self.enumerated_nodes().all(|(node_idx, node)| f(node_idx, node))\n     }\n \n     pub fn each_edge<'a, F>(&'a self, mut f: F) -> bool\n         where F: FnMut(EdgeIndex, &'a Edge<E>) -> bool\n     {\n         //! Iterates over all edges defined in the graph\n-        self.all_edges_enumerated().all(|(edge_idx, edge)| f(edge_idx, edge))\n+        self.enumerated_edges().all(|(edge_idx, edge)| f(edge_idx, edge))\n     }\n \n     pub fn outgoing_edges(&self, source: NodeIndex) -> AdjacentEdges<N, E> {\n@@ -295,7 +295,7 @@ impl<N: Debug, E: Debug> Graph<N, E> {\n         while changed {\n             changed = false;\n             iteration += 1;\n-            for (edge_index, edge) in self.all_edges_enumerated() {\n+            for (edge_index, edge) in self.enumerated_edges() {\n                 changed |= op(iteration, edge_index, edge);\n             }\n         }\n@@ -307,31 +307,60 @@ impl<N: Debug, E: Debug> Graph<N, E> {\n                               -> DepthFirstTraversal<'a, N, E> {\n         DepthFirstTraversal::with_start_node(self, start, direction)\n     }\n+\n+    /// Whether or not a node can be reached from itself.\n+    pub fn is_node_cyclic(&self, starting_node_index: NodeIndex) -> bool {\n+        // This is similar to depth traversal below, but we\n+        // can't use that, because depth traversal doesn't show\n+        // the starting node a second time.\n+        let mut visited = BitVector::new(self.len_nodes());\n+        let mut stack = vec![starting_node_index];\n+\n+        while let Some(current_node_index) = stack.pop() {\n+            visited.insert(current_node_index.0);\n+\n+            // Directionality doesn't change the answer,\n+            // so just use outgoing edges.\n+            for (_, edge) in self.outgoing_edges(current_node_index) {\n+                let target_node_index = edge.target();\n+\n+                if target_node_index == starting_node_index {\n+                    return true;\n+                }\n+\n+                if !visited.contains(target_node_index.0) {\n+                    stack.push(target_node_index);\n+                }\n+            }\n+        }\n+\n+        false\n+    }\n }\n \n // # Iterators\n \n-pub struct Nodes<'g, N>\n+pub struct EnumeratedNodes<'g, N>\n     where N: 'g,\n {\n     iter: ::std::iter::Enumerate<::std::slice::Iter<'g, Node<N>>>\n }\n \n-impl<'g, N: Debug> Iterator for Nodes<'g, N> {\n+impl<'g, N: Debug> Iterator for EnumeratedNodes<'g, N> {\n     type Item = (NodeIndex, &'g Node<N>);\n \n     fn next(&mut self) -> Option<(NodeIndex, &'g Node<N>)> {\n         self.iter.next().map(|(idx, n)| (NodeIndex(idx), n))\n     }\n }\n \n-pub struct Edges<'g, E>\n+pub struct EnumeratedEdges<'g, E>\n     where E: 'g,\n {\n     iter: ::std::iter::Enumerate<::std::slice::Iter<'g, Edge<E>>>\n }\n \n-impl<'g, E: Debug> Iterator for Edges<'g, E> {\n+impl<'g, E: Debug> Iterator for EnumeratedEdges<'g, E> {\n     type Item = (EdgeIndex, &'g Edge<E>);\n \n     fn next(&mut self) -> Option<(EdgeIndex, &'g Edge<E>)> {"}, {"sha": "a87410e6e1c8ce398d1f56c6ea61d4f81ba9d22f", "filename": "src/librustc_data_structures/graph/tests.rs", "status": "modified", "additions": 42, "deletions": 4, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/9ddbb9133c86df9aab7b98a0e6b641b847c800ec/src%2Flibrustc_data_structures%2Fgraph%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ddbb9133c86df9aab7b98a0e6b641b847c800ec/src%2Flibrustc_data_structures%2Fgraph%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fgraph%2Ftests.rs?ref=9ddbb9133c86df9aab7b98a0e6b641b847c800ec", "patch": "@@ -20,10 +20,13 @@ fn create_graph() -> TestGraph {\n \n     // Create a simple graph\n     //\n-    //    A -+> B --> C\n-    //       |  |     ^\n-    //       |  v     |\n-    //       F  D --> E\n+    //          F\n+    //          |\n+    //          V\n+    //    A --> B --> C\n+    //          |     ^\n+    //          v     |\n+    //          D --> E\n \n     let a = graph.add_node(\"A\");\n     let b = graph.add_node(\"B\");\n@@ -42,6 +45,29 @@ fn create_graph() -> TestGraph {\n     return graph;\n }\n \n+fn create_graph_with_cycle() -> TestGraph {\n+    let mut graph = Graph::new();\n+\n+    // Create a graph with a cycle.\n+    //\n+    //    A --> B <-- +\n+    //          |     |\n+    //          v     |\n+    //          C --> D\n+\n+    let a = graph.add_node(\"A\");\n+    let b = graph.add_node(\"B\");\n+    let c = graph.add_node(\"C\");\n+    let d = graph.add_node(\"D\");\n+\n+    graph.add_edge(a, b, \"AB\");\n+    graph.add_edge(b, c, \"BC\");\n+    graph.add_edge(c, d, \"CD\");\n+    graph.add_edge(d, b, \"DB\");\n+\n+    return graph;\n+}\n+\n #[test]\n fn each_node() {\n     let graph = create_graph();\n@@ -139,3 +165,15 @@ fn each_adjacent_from_d() {\n     let graph = create_graph();\n     test_adjacent_edges(&graph, NodeIndex(3), \"D\", &[(\"BD\", \"B\")], &[(\"DE\", \"E\")]);\n }\n+\n+#[test]\n+fn is_node_cyclic_a() {\n+    let graph = create_graph_with_cycle();\n+    assert!(!graph.is_node_cyclic(NodeIndex(0)));\n+}\n+\n+#[test]\n+fn is_node_cyclic_b() {\n+    let graph = create_graph_with_cycle();\n+    assert!(graph.is_node_cyclic(NodeIndex(1)));\n+}"}]}