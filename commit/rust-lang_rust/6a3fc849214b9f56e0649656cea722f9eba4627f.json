{"sha": "6a3fc849214b9f56e0649656cea722f9eba4627f", "node_id": "C_kwDOAAsO6NoAKDZhM2ZjODQ5MjE0YjlmNTZlMDY0OTY1NmNlYTcyMmY5ZWJhNDYyN2Y", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T12:17:53Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T12:17:53Z"}, "message": "internal: move builtin macro tests to macro expansion suite", "tree": {"sha": "d674e955ec8ecb49a5806c7199eed9227a326b28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d674e955ec8ecb49a5806c7199eed9227a326b28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a3fc849214b9f56e0649656cea722f9eba4627f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a3fc849214b9f56e0649656cea722f9eba4627f", "html_url": "https://github.com/rust-lang/rust/commit/6a3fc849214b9f56e0649656cea722f9eba4627f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a3fc849214b9f56e0649656cea722f9eba4627f/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfc5d8529a678ffb0207246a4bc9cf72814f6213", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfc5d8529a678ffb0207246a4bc9cf72814f6213", "html_url": "https://github.com/rust-lang/rust/commit/bfc5d8529a678ffb0207246a4bc9cf72814f6213"}], "stats": {"total": 198, "additions": 122, "deletions": 76}, "files": [{"sha": "9c91ea8a7abd9b2c039b6d8959d1d663ca66130c", "filename": "crates/hir_def/src/macro_expansion_tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs?ref=6a3fc849214b9f56e0649656cea722f9eba4627f", "patch": "@@ -10,6 +10,7 @@\n //! and harder to understand.\n \n mod mbe;\n+mod builtin;\n \n use std::{iter, ops::Range};\n "}, {"sha": "c2b900b9df396d464174ace297e13a70f28b2a89", "filename": "crates/hir_def/src/macro_expansion_tests/builtin.rs", "status": "added", "additions": 121, "deletions": 0, "changes": 121, "blob_url": "https://github.com/rust-lang/rust/blob/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fbuiltin.rs?ref=6a3fc849214b9f56e0649656cea722f9eba4627f", "patch": "@@ -0,0 +1,121 @@\n+//! Tests for builtin macros (see `builtin_macro.rs` in `hir_expand`).\n+\n+use expect_test::expect;\n+\n+use crate::macro_expansion_tests::check;\n+\n+#[test]\n+fn test_column_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! column {() => {}}\n+\n+fn main() { column!(); }\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! column {() => {}}\n+\n+fn main() { 0; }\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_line_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! line {() => {}}\n+\n+fn main() { line!() }\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! line {() => {}}\n+\n+fn main() { 0 }\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_stringify_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! stringify {() => {}}\n+\n+fn main() {\n+    stringify!(\n+        a\n+        b\n+        c\n+    );\n+}\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! stringify {() => {}}\n+\n+fn main() {\n+    \"a b c\";\n+}\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_env_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! env {() => {}}\n+\n+fn main() { env!(\"TEST_ENV_VAR\"); }\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! env {() => {}}\n+\n+fn main() { \"__RA_UNIMPLEMENTED__\"; }\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_option_env_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! option_env {() => {}}\n+\n+fn main() { option_env!(\"TEST_ENV_VAR\"); }\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! option_env {() => {}}\n+\n+fn main() { std::option::Option::None:: < &str>; }\n+\"##]],\n+    );\n+}\n+\n+#[test]\n+fn test_file_expand() {\n+    check(\n+        r#\"\n+#[rustc_builtin_macro]\n+macro_rules! file {() => {}}\n+\n+fn main() { file!(); }\n+\"#,\n+        expect![[r##\"\n+#[rustc_builtin_macro]\n+macro_rules! file {() => {}}\n+\n+fn main() { \"\"; }\n+\"##]],\n+    );\n+}"}, {"sha": "55dc665c5d78fef4dc79b6854172e7bdcd0dd031", "filename": "crates/hir_expand/src/builtin_macro.rs", "status": "modified", "additions": 0, "deletions": 76, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a3fc849214b9f56e0649656cea722f9eba4627f/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs?ref=6a3fc849214b9f56e0649656cea722f9eba4627f", "patch": "@@ -669,82 +669,6 @@ mod tests {\n         expect.assert_eq(&expansion);\n     }\n \n-    #[test]\n-    fn test_column_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! column {() => {}}\n-            column!()\n-            \"#,\n-            expect![[\"0\"]],\n-        );\n-    }\n-\n-    #[test]\n-    fn test_line_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! line {() => {}}\n-            line!()\n-            \"#,\n-            expect![[\"0\"]],\n-        );\n-    }\n-\n-    #[test]\n-    fn test_stringify_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! stringify {() => {}}\n-            stringify!(\n-                a\n-                b\n-                c\n-            )\n-            \"#,\n-            expect![[\"\\\"a b c\\\"\"]],\n-        );\n-    }\n-\n-    #[test]\n-    fn test_env_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! env {() => {}}\n-            env!(\"TEST_ENV_VAR\")\n-            \"#,\n-            expect![[\"\\\"__RA_UNIMPLEMENTED__\\\"\"]],\n-        );\n-    }\n-\n-    #[test]\n-    fn test_option_env_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! option_env {() => {}}\n-            option_env!(\"TEST_ENV_VAR\")\n-            \"#,\n-            expect![[\"std::option::Option::None:: < &str>\"]],\n-        );\n-    }\n-\n-    #[test]\n-    fn test_file_expand() {\n-        check_expansion(\n-            r#\"\n-            #[rustc_builtin_macro]\n-            macro_rules! file {() => {}}\n-            file!()\n-            \"#,\n-            expect![[r#\"\"\"\"#]],\n-        );\n-    }\n-\n     #[test]\n     fn test_assert_expand() {\n         check_expansion("}]}