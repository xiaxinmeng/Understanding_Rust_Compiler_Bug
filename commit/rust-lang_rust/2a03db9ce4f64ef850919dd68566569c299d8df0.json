{"sha": "2a03db9ce4f64ef850919dd68566569c299d8df0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhMDNkYjljZTRmNjRlZjg1MDkxOWRkNjg1NjY1NjljMjk5ZDhkZjA=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-04-04T20:34:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-04-04T20:34:46Z"}, "message": "Merge pull request #673 from RalfJung/travis\n\nuse rustup-toolchain-install-master for CI", "tree": {"sha": "41dcc5035a8875023772dbf7dfa9ceb36fef14b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/41dcc5035a8875023772dbf7dfa9ceb36fef14b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a03db9ce4f64ef850919dd68566569c299d8df0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcpmpmCRBK7hj4Ov3rIwAAdHIIAFKSQFk5BNOC5hiNoC+HSyLE\ny6rqPMX3z+ktahnY3WaBNJJOJ1MFjz2VNVNMq8ShTB5ikmPtaGOY9oXOq6XliSi+\nAKJnhwGgGf+jQIDoek5Z17I7k+xP1WjkdVvxwVWHXCnxpE5weRI1nVTtigB1eJOb\n5N4Tw6iQIqTwavRnDRLIX1rhUEeKWoLQsawplDH90Jk0KZcKboIKkH8ACqVqogLz\nLYs3l8y4Yik41Uxx1bu9TQ996/mE+I4uT/ca/RU/lfPEenAvkptWWvTiNdqLMtj6\nMxxBQyIpFrBQ1kjB9woyb2W1SpuZGnEWONBoj5uiBuS8RTe0chR0HMoO4E3ky9s=\n=vfY1\n-----END PGP SIGNATURE-----\n", "payload": "tree 41dcc5035a8875023772dbf7dfa9ceb36fef14b5\nparent 82f9a0173011b96411d315b332754ee6b35cf00f\nparent 159cce1da25944785c95f46a83ae304c0426fe23\nauthor Ralf Jung <post@ralfj.de> 1554410086 +0100\ncommitter GitHub <noreply@github.com> 1554410086 +0100\n\nMerge pull request #673 from RalfJung/travis\n\nuse rustup-toolchain-install-master for CI"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a03db9ce4f64ef850919dd68566569c299d8df0", "html_url": "https://github.com/rust-lang/rust/commit/2a03db9ce4f64ef850919dd68566569c299d8df0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a03db9ce4f64ef850919dd68566569c299d8df0/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "82f9a0173011b96411d315b332754ee6b35cf00f", "url": "https://api.github.com/repos/rust-lang/rust/commits/82f9a0173011b96411d315b332754ee6b35cf00f", "html_url": "https://github.com/rust-lang/rust/commit/82f9a0173011b96411d315b332754ee6b35cf00f"}, {"sha": "159cce1da25944785c95f46a83ae304c0426fe23", "url": "https://api.github.com/repos/rust-lang/rust/commits/159cce1da25944785c95f46a83ae304c0426fe23", "html_url": "https://github.com/rust-lang/rust/commit/159cce1da25944785c95f46a83ae304c0426fe23"}], "stats": {"total": 59, "additions": 42, "deletions": 17}, "files": [{"sha": "e97380cb932fe8ad6b035e6ef0f86e812363be34", "filename": ".appveyor.yml", "status": "modified", "additions": 20, "deletions": 10, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/2a03db9ce4f64ef850919dd68566569c299d8df0/.appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/2a03db9ce4f64ef850919dd68566569c299d8df0/.appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.appveyor.yml?ref=2a03db9ce4f64ef850919dd68566569c299d8df0", "patch": "@@ -3,28 +3,31 @@ environment:\n         PROJECT_NAME: miri\n     matrix:\n         - TARGET: x86_64-pc-windows-msvc\n-          MSYS2_BITS: 64\n         - TARGET: i686-pc-windows-msvc\n-          MSYS2_BITS: 32\n \n # branches to build\n branches:\n   # whitelist\n   only:\n     - master\n \n+cache:\n+    - '%USERPROFILE%\\.cargo'\n+    - '%USERPROFILE%\\.rustup'\n+\n install:\n-    # Install Rust.\n-    - set PATH=C:\\Program Files\\Git\\mingw64\\bin;C:\\msys64\\mingw%MSYS2_BITS%\\bin;%PATH%\n-    - set /p RUST_TOOLCHAIN=<rust-version\n+    # Install Rust\n     - curl -sSf -o rustup-init.exe https://win.rustup.rs/\n-    - rustup-init.exe -y --default-host %TARGET% --default-toolchain %RUST_TOOLCHAIN%\n+    - rustup-init.exe -y --default-host %TARGET% --default-toolchain stable\n     - set PATH=%USERPROFILE%\\.cargo\\bin;%PATH%\n+    # Install \"master\" toolchain\n+    - cargo install rustup-toolchain-install-master\n+    - set /p RUSTC_HASH=<rust-version\n+    - rustup-toolchain-install-master -f -n master %RUSTC_HASH% -c cargo -c rust-src\n+    - rustup default master\n     - rustc --version\n \n-build: false\n-\n-test_script:\n+build_script:\n     - set RUST_TEST_NOCAPTURE=1\n     - set RUST_BACKTRACE=1\n     # Build and install miri\n@@ -33,11 +36,18 @@ test_script:\n     # Get ourselves a MIR-full libstd, and use it henceforth\n     - cargo miri setup\n     - set MIRI_SYSROOT=%USERPROFILE%\\AppData\\Local\\miri\\miri\\cache\\HOST\n+\n+test_script:\n     # Test miri\n     - cargo test --release --all-features\n     # Test cargo integration\n     - cd test-cargo-miri\n-    - python3 run-test.py\n+    - '\"C:\\msys64\\mingw64\\bin\\python3.exe\" run-test.py'\n+\n+after_test:\n+    # Don't cache \"master\" toolchain, it's a waste\n+    - rustup default stable\n+    - rustup toolchain uninstall master\n \n notifications:\n     - provider: Email"}, {"sha": "883404fb4a0876f556ef78db96eeccfedbd07dc0", "filename": ".travis.yml", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2a03db9ce4f64ef850919dd68566569c299d8df0/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/2a03db9ce4f64ef850919dd68566569c299d8df0/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=2a03db9ce4f64ef850919dd68566569c299d8df0", "patch": "@@ -4,7 +4,8 @@ cache:\n   # we cannot reuse anyway when the nightly changes (and it grows quite large\n   # over time).\n   directories:\n-    - /home/travis/.cargo\n+    - $HOME/.cargo\n+    - $HOME/.rustup\n \n os:\n - linux\n@@ -17,18 +18,27 @@ before_script:\n # Compute the rust version we use. We do not use \"language: rust\" to have more control here.\n - |\n   if [[ \"$TRAVIS_EVENT_TYPE\" == cron ]]; then\n-    RUST_TOOLCHAIN=nightly\n+    RUSTC_HASH=$(git ls-remote https://github.com/rust-lang/rust.git master | awk '{print $1}')\n   else\n-    RUST_TOOLCHAIN=$(cat rust-version)\n+    RUSTC_HASH=$(cat rust-version)\n   fi\n-# install Rust\n-- curl https://build.travis-ci.org/files/rustup-init.sh -sSf | sh -s -- -y --default-toolchain \"$RUST_TOOLCHAIN\"\n+# Install Rust (\"stable\" toolchain for better caching, it is just used to build rustup-toolchain-install-master)\n+- curl https://build.travis-ci.org/files/rustup-init.sh -sSf | sh -s -- -y --default-toolchain stable\n - export PATH=$HOME/.cargo/bin:$PATH\n+# Install \"master\" toolchain\n+- cargo install rustup-toolchain-install-master || echo \"rustup-toolchain-install-master already installed\"\n+- travis_retry rustup-toolchain-install-master -f -n master $RUSTC_HASH -c cargo -c rust-src\n+- rustup default master\n - rustc --version\n \n script:\n - ./travis.sh\n \n+before_cache:\n+# Don't cache \"master\" toolchain, it's a waste\n+- rustup default stable\n+- rustup toolchain uninstall master\n+\n notifications:\n   email:\n     on_success: never"}, {"sha": "54d8411b2fe74b7129f247fe63d1690e3d0d0555", "filename": "README.md", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2a03db9ce4f64ef850919dd68566569c299d8df0/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/2a03db9ce4f64ef850919dd68566569c299d8df0/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=2a03db9ce4f64ef850919dd68566569c299d8df0", "patch": "@@ -120,13 +120,18 @@ other projects:\n \n ```sh\n rustup component remove miri # avoid having Miri installed twice\n-cargo +nightly install --path \"$DIR\" --force # or the nightly in `rust-version`\n+cargo +nightly install --path \"$DIR\" --force\n cargo +nightly miri setup\n ```\n \n (We are giving `+nightly` explicitly here all the time because it is important\n that all of these commands get executed with the same toolchain.)\n \n+In case this fails, your nightly might be incompatible with Miri master.  The\n+`rust-version` file contains the commit hash of rustc that Miri is currently\n+tested against; you can use that to find a nightly that works or you might have\n+to wait for the next nightly to get released.\n+\n If you want to use a different libstd (not the one that comes with the\n nightly), you can do that by running\n "}, {"sha": "a2b3daad97ec895840a9d9508b2786ea59489f3a", "filename": "rust-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a03db9ce4f64ef850919dd68566569c299d8df0/rust-version", "raw_url": "https://github.com/rust-lang/rust/raw/2a03db9ce4f64ef850919dd68566569c299d8df0/rust-version", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-version?ref=2a03db9ce4f64ef850919dd68566569c299d8df0", "patch": "@@ -1 +1 @@\n-nightly-2019-04-03\n+f717b58dd70829f105960a071c7992b440720482"}]}