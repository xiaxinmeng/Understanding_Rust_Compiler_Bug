{"sha": "44c8ddf885daaecfa4785e100ac1b065126c05b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0YzhkZGY4ODVkYWFlY2ZhNDc4NWUxMDBhYzFiMDY1MTI2YzA1Yjc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-10-24T13:13:17Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-10-24T13:13:17Z"}, "message": "make indexing parallel again", "tree": {"sha": "1852cf05df754530636d58797e24f583e32617d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1852cf05df754530636d58797e24f583e32617d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44c8ddf885daaecfa4785e100ac1b065126c05b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44c8ddf885daaecfa4785e100ac1b065126c05b7", "html_url": "https://github.com/rust-lang/rust/commit/44c8ddf885daaecfa4785e100ac1b065126c05b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44c8ddf885daaecfa4785e100ac1b065126c05b7/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b636d23bec0dcc6f85595787b8295c24df2bacfe", "url": "https://api.github.com/repos/rust-lang/rust/commits/b636d23bec0dcc6f85595787b8295c24df2bacfe", "html_url": "https://github.com/rust-lang/rust/commit/b636d23bec0dcc6f85595787b8295c24df2bacfe"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "15081f55559acd1bf3a63db05e8d43177dddb071", "filename": "crates/ra_analysis/src/roots.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/44c8ddf885daaecfa4785e100ac1b065126c05b7/crates%2Fra_analysis%2Fsrc%2Froots.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44c8ddf885daaecfa4785e100ac1b065126c05b7/crates%2Fra_analysis%2Fsrc%2Froots.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Froots.rs?ref=44c8ddf885daaecfa4785e100ac1b065126c05b7", "patch": "@@ -3,6 +3,7 @@ use std::{sync::Arc};\n use ra_editor::LineIndex;\n use ra_syntax::File;\n use rustc_hash::FxHashSet;\n+use rayon::prelude::*;\n use salsa::Database;\n \n use crate::{\n@@ -105,8 +106,8 @@ impl ReadonlySourceRoot {\n             .set((), Arc::new(db::FileSet { files: file_ids, resolver }));\n         let file_set = db.file_set();\n         let symbol_index =\n-            SymbolIndex::for_files(file_set.files.iter() // TODO: par iter\n-                .map(|&file_id| (file_id, db.file_syntax(file_id))));\n+            SymbolIndex::for_files(file_set.files.par_iter()\n+                .map_with(db.clone(), |db, &file_id| (file_id, db.file_syntax(file_id))));\n \n         ReadonlySourceRoot { db, symbol_index: Arc::new(symbol_index) }\n     }"}, {"sha": "e5c8d8870c360603fa7ef8894f3e4beb54485ae4", "filename": "crates/ra_analysis/src/symbol_index.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/44c8ddf885daaecfa4785e100ac1b065126c05b7/crates%2Fra_analysis%2Fsrc%2Fsymbol_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44c8ddf885daaecfa4785e100ac1b065126c05b7/crates%2Fra_analysis%2Fsrc%2Fsymbol_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fsymbol_index.rs?ref=44c8ddf885daaecfa4785e100ac1b065126c05b7", "patch": "@@ -34,7 +34,7 @@ impl Hash for SymbolIndex {\n }\n \n impl SymbolIndex {\n-    pub(crate) fn for_files(files: impl Iterator<Item = (FileId, File)>) -> SymbolIndex {\n+    pub(crate) fn for_files(files: impl ParallelIterator<Item = (FileId, File)>) -> SymbolIndex {\n         let mut symbols = files\n             .flat_map(|(file_id, file)| {\n                 file_symbols(&file)\n@@ -52,7 +52,7 @@ impl SymbolIndex {\n     }\n \n     pub(crate) fn for_file(file_id: FileId, file: File) -> SymbolIndex {\n-        SymbolIndex::for_files(::std::iter::once((file_id, file)))\n+        SymbolIndex::for_files(rayon::iter::once((file_id, file)))\n     }\n }\n "}]}