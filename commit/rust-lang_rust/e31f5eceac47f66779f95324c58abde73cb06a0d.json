{"sha": "e31f5eceac47f66779f95324c58abde73cb06a0d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMWY1ZWNlYWM0N2Y2Njc3OWY5NTMyNGM1OGFiZGU3M2NiMDZhMGQ=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-16T21:25:58Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-17T06:35:29Z"}, "message": "Use correct span for Infer type inside closure header", "tree": {"sha": "98d409a29b7294a3309cde90ed1181b96c16b1f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98d409a29b7294a3309cde90ed1181b96c16b1f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e31f5eceac47f66779f95324c58abde73cb06a0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e31f5eceac47f66779f95324c58abde73cb06a0d", "html_url": "https://github.com/rust-lang/rust/commit/e31f5eceac47f66779f95324c58abde73cb06a0d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e31f5eceac47f66779f95324c58abde73cb06a0d/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "897d7bdcb9bbce7d92e42c41899b570fec1325c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/897d7bdcb9bbce7d92e42c41899b570fec1325c3", "html_url": "https://github.com/rust-lang/rust/commit/897d7bdcb9bbce7d92e42c41899b570fec1325c3"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "8e2fe782ce987fc5102c07708c6f4038c44fe2bb", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=e31f5eceac47f66779f95324c58abde73cb06a0d", "patch": "@@ -561,7 +561,7 @@ fn rewrite_closure_fn_decl(\n         fn_decl.inputs.iter(),\n         \"|\",\n         |arg| span_lo_for_arg(arg),\n-        |arg| span_hi_for_arg(arg),\n+        |arg| span_hi_for_arg(context, arg),\n         |arg| arg.rewrite(context, arg_shape),\n         context.codemap.span_after(span, \"|\"),\n         body.span.lo,"}, {"sha": "9a6bb08d3b6d1cad4d0999c7099c0da7225cb7f1", "filename": "src/items.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=e31f5eceac47f66779f95324c58abde73cb06a0d", "patch": "@@ -1657,6 +1657,16 @@ impl Rewrite for ast::FunctionRetTy {\n     }\n }\n \n+fn is_empty_infer(context: &RewriteContext, ty: &ast::Ty) -> bool {\n+    match ty.node {\n+        ast::TyKind::Infer => {\n+            let original = context.snippet(ty.span);\n+            original != \"_\"\n+        }\n+        _ => false,\n+    }\n+}\n+\n impl Rewrite for ast::Arg {\n     fn rewrite(&self, context: &RewriteContext, shape: Shape) -> Option<String> {\n         if is_named_arg(self) {\n@@ -1665,7 +1675,7 @@ impl Rewrite for ast::Arg {\n                 Shape::legacy(shape.width, shape.indent),\n             ));\n \n-            if self.ty.node != ast::TyKind::Infer {\n+            if !is_empty_infer(context, &*self.ty) {\n                 if context.config.space_before_type_annotation() {\n                     result.push_str(\" \");\n                 }\n@@ -1750,8 +1760,9 @@ pub fn span_lo_for_arg(arg: &ast::Arg) -> BytePos {\n     }\n }\n \n-pub fn span_hi_for_arg(arg: &ast::Arg) -> BytePos {\n+pub fn span_hi_for_arg(context: &RewriteContext, arg: &ast::Arg) -> BytePos {\n     match arg.ty.node {\n+        ast::TyKind::Infer if context.snippet(arg.ty.span) == \"_\" => arg.ty.span.hi,\n         ast::TyKind::Infer if is_named_arg(arg) => arg.pat.span.hi,\n         _ => arg.ty.span.hi,\n     }"}, {"sha": "b8225aaed1c12407474c34f6de6dece4fe13e9e8", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e31f5eceac47f66779f95324c58abde73cb06a0d/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=e31f5eceac47f66779f95324c58abde73cb06a0d", "patch": "@@ -792,7 +792,7 @@ impl Rewrite for ast::Attribute {\n                 } else {\n                     format!(\"#[{}]\", rw)\n                 }\n-            }\n+            },\n         )\n     }\n }"}, {"sha": "b52643f2fb8c6a0a3dbd561799405044d8f5ac72", "filename": "tests/source/closure.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e31f5eceac47f66779f95324c58abde73cb06a0d/tests%2Fsource%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e31f5eceac47f66779f95324c58abde73cb06a0d/tests%2Fsource%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fclosure.rs?ref=e31f5eceac47f66779f95324c58abde73cb06a0d", "patch": "@@ -147,3 +147,7 @@ fn issue325() {\n fn issue1697() {\n     Test.func_a(A_VERY_LONG_CONST_VARIABLE_NAME, move |arg1, arg2, arg3, arg4| arg1 + arg2 + arg3 + arg4)\n }\n+\n+fn issue1694() {\n+    foooooo(|_referencefffffffff: _, _target_reference: _, _oid: _, _target_oid: _| format!(\"refs/pull/{}/merge\", pr_id))\n+}"}, {"sha": "3d6d322a1039b24667fad3e3ae011bb2dd644b84", "filename": "tests/target/closure.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e31f5eceac47f66779f95324c58abde73cb06a0d/tests%2Ftarget%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e31f5eceac47f66779f95324c58abde73cb06a0d/tests%2Ftarget%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fclosure.rs?ref=e31f5eceac47f66779f95324c58abde73cb06a0d", "patch": "@@ -174,3 +174,11 @@ fn issue1697() {\n         move |arg1, arg2, arg3, arg4| arg1 + arg2 + arg3 + arg4,\n     )\n }\n+\n+fn issue1694() {\n+    foooooo(\n+        |_referencefffffffff: _, _target_reference: _, _oid: _, _target_oid: _| {\n+            format!(\"refs/pull/{}/merge\", pr_id)\n+        },\n+    )\n+}"}]}