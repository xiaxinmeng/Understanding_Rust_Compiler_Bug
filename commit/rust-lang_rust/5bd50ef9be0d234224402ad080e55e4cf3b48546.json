{"sha": "5bd50ef9be0d234224402ad080e55e4cf3b48546", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViZDUwZWY5YmUwZDIzNDIyNDQwMmFkMDgwZTU1ZTRjZjNiNDg1NDY=", "commit": {"author": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2021-03-16T16:14:23Z"}, "committer": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2021-03-16T17:17:25Z"}, "message": "Simplify C compilation for Fortanix-SGX target", "tree": {"sha": "5b4258722cacacef980f9edfedf6a74198cadef1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b4258722cacacef980f9edfedf6a74198cadef1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5bd50ef9be0d234224402ad080e55e4cf3b48546", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5bd50ef9be0d234224402ad080e55e4cf3b48546", "html_url": "https://github.com/rust-lang/rust/commit/5bd50ef9be0d234224402ad080e55e4cf3b48546", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5bd50ef9be0d234224402ad080e55e4cf3b48546/comments", "author": null, "committer": null, "parents": [{"sha": "f24ce9b0140d9be5a336954e878d0c1522966bb8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f24ce9b0140d9be5a336954e878d0c1522966bb8", "html_url": "https://github.com/rust-lang/rust/commit/f24ce9b0140d9be5a336954e878d0c1522966bb8"}], "stats": {"total": 24, "additions": 4, "deletions": 20}, "files": [{"sha": "de3a99f34fcfaf0a47f6d5f8ca6c8656a9e831c5", "filename": "src/ci/docker/host-x86_64/dist-various-2/Dockerfile", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5bd50ef9be0d234224402ad080e55e4cf3b48546/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/5bd50ef9be0d234224402ad080e55e4cf3b48546/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile?ref=5bd50ef9be0d234224402ad080e55e4cf3b48546", "patch": "@@ -45,10 +45,10 @@ ENV \\\n     CC_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-gcc-8 \\\n     CXX_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-g++-8 \\\n     AR_x86_64_fortanix_unknown_sgx=ar \\\n-    CC_x86_64_fortanix_unknown_sgx=x86_64-fortanix-unknown-sgx-clang-11 \\\n-    CFLAGS_x86_64_fortanix_unknown_sgx=\"-mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n-    CXX_x86_64_fortanix_unknown_sgx=x86_64-fortanix-unknown-sgx-clang++-11 \\\n-    CXXFLAGS_x86_64_fortanix_unknown_sgx=\"-mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n+    CC_x86_64_fortanix_unknown_sgx=clang-11 \\\n+    CFLAGS_x86_64_fortanix_unknown_sgx=\"-D__ELF__ -isystem/usr/include/x86_64-linux-gnu -mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n+    CXX_x86_64_fortanix_unknown_sgx=clang++-11 \\\n+    CXXFLAGS_x86_64_fortanix_unknown_sgx=\"-D__ELF__ -isystem/usr/include/x86_64-linux-gnu -mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n     AR_i686_unknown_freebsd=i686-unknown-freebsd11-ar \\\n     CC_i686_unknown_freebsd=i686-unknown-freebsd11-clang \\\n     CXX_i686_unknown_freebsd=i686-unknown-freebsd11-clang++ \\\n@@ -71,8 +71,6 @@ COPY host-x86_64/dist-various-2/build-solaris-toolchain.sh /tmp/\n RUN /tmp/build-solaris-toolchain.sh x86_64  amd64   solaris-i386\n RUN /tmp/build-solaris-toolchain.sh sparcv9 sparcv9 solaris-sparc\n COPY host-x86_64/dist-various-2/build-x86_64-fortanix-unknown-sgx-toolchain.sh /tmp/\n-COPY host-x86_64/dist-various-2/x86_64-fortanix-unknown-sgx-clang-wrap.sh /usr/bin/x86_64-fortanix-unknown-sgx-clang-11\n-RUN ln -s /usr/bin/x86_64-fortanix-unknown-sgx-clang-11 /usr/bin/x86_64-fortanix-unknown-sgx-clang++-11\n RUN /tmp/build-x86_64-fortanix-unknown-sgx-toolchain.sh\n \n COPY host-x86_64/dist-various-2/build-wasi-toolchain.sh /tmp/"}, {"sha": "c4ff44c37b1e35aa6e1a2d441d8fcfbaaaa305eb", "filename": "src/ci/docker/host-x86_64/dist-various-2/x86_64-fortanix-unknown-sgx-clang-wrap.sh", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f24ce9b0140d9be5a336954e878d0c1522966bb8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f24ce9b0140d9be5a336954e878d0c1522966bb8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh?ref=f24ce9b0140d9be5a336954e878d0c1522966bb8", "patch": "@@ -1,14 +0,0 @@\n-#!/bin/bash\n-\n-args=(\"$@\")\n-\n-for i in \"${!args[@]}\"; do\n-    # x86_64-fortanix-unknown-sgx doesn't have a C sysroot for things like\n-    # stdint.h and the C++ STL. Unlike GCC, clang will not use the host's\n-    # sysroot instead. Force it.\n-    if [ \"${args[$i]}\" = \"--target=x86_64-fortanix-unknown-sgx\" ]; then\n-        args[$i]=\"--target=x86_64-unknown-linux-gnu\"\n-    fi\n-done\n-\n-exec \"${0/x86_64-fortanix-unknown-sgx-clang/clang}\" \"${args[@]}\""}]}