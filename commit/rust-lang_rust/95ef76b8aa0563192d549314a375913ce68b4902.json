{"sha": "95ef76b8aa0563192d549314a375913ce68b4902", "node_id": "C_kwDOAAsO6NoAKDk1ZWY3NmI4YWEwNTYzMTkyZDU0OTMxNGEzNzU5MTNjZTY4YjQ5MDI", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2023-01-13T02:28:20Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2023-01-13T02:28:20Z"}, "message": "Normalize test output more thoroughly\n\nThis prevents differences in local environments, which may (for example)\nend up with a longer backtrace with more digits in the backtrace prefix,\nas happened to me. While we're at it, clean more of the output up,\nincluding the exact location of the error in the compiler.", "tree": {"sha": "4cadcc7c3c61ef74603b1923457b536f36a126c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4cadcc7c3c61ef74603b1923457b536f36a126c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95ef76b8aa0563192d549314a375913ce68b4902", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95ef76b8aa0563192d549314a375913ce68b4902", "html_url": "https://github.com/rust-lang/rust/commit/95ef76b8aa0563192d549314a375913ce68b4902", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95ef76b8aa0563192d549314a375913ce68b4902/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61a415be590113b4935464ef0aaf3b4e7713a077", "url": "https://api.github.com/repos/rust-lang/rust/commits/61a415be590113b4935464ef0aaf3b4e7713a077", "html_url": "https://github.com/rust-lang/rust/commit/61a415be590113b4935464ef0aaf3b4e7713a077"}], "stats": {"total": 83, "additions": 55, "deletions": 28}, "files": [{"sha": "1c69b07e3d4af0859656946d6094f3c2bb07e173", "filename": "tests/ui/chalkify/bugs/async.rs", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/95ef76b8aa0563192d549314a375913ce68b4902/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95ef76b8aa0563192d549314a375913ce68b4902/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.rs?ref=95ef76b8aa0563192d549314a375913ce68b4902", "patch": "@@ -2,12 +2,21 @@\n // known-bug\n // unset-rustc-env:RUST_BACKTRACE\n // compile-flags:-Z trait-solver=chalk --edition=2021\n-// error-pattern:stack backtrace:\n+// error-pattern:internal compiler error\n // failure-status:101\n-// normalize-stderr-test \"note: .*\" -> \"\"\n-// normalize-stderr-test \"thread 'rustc' .*\" -> \"\"\n-// normalize-stderr-test \"  .*\\n\" -> \"\"\n // normalize-stderr-test \"DefId([^)]*)\" -> \"...\"\n+// normalize-stderr-test \"\\nerror: internal compiler error.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note:.*unexpectedly panicked.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: we would appreciate a bug report.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: compiler flags.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"note: rustc.*running on.*\\n\\n\" -> \"\"\n+// normalize-stderr-test \"thread.*panicked.*\\n\" -> \"\"\n+// normalize-stderr-test \"stack backtrace:\\n\" -> \"\"\n+// normalize-stderr-test \"\\s\\d{1,}: .*\\n\" -> \"\"\n+// normalize-stderr-test \"\\s at .*\\n\" -> \"\"\n+// normalize-stderr-test \".*note: Some details.*\\n\" -> \"\"\n+// normalize-stderr-test \"\\n\\n[ ]*\\n\" -> \"\"\n+// normalize-stderr-test \"compiler/.*: projection\" -> \"projection\"\n \n fn main() -> () {}\n "}, {"sha": "d1508cb17001b4cf807bc3dcb3a0449f2854dd98", "filename": "tests/ui/chalkify/bugs/async.stderr", "status": "modified", "additions": 42, "deletions": 24, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/95ef76b8aa0563192d549314a375913ce68b4902/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/95ef76b8aa0563192d549314a375913ce68b4902/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fchalkify%2Fbugs%2Fasync.stderr?ref=95ef76b8aa0563192d549314a375913ce68b4902", "patch": "@@ -1,29 +1,47 @@\n-error[E0277]: `[async fn body@$DIR/async.rs:14:29: 16:2]` is not a future\n-LL |LL | |LL | | }\n-\n-\n-error[E0277]: the size for values of type `<[async fn body@$DIR/async.rs:14:29: 16:2] as Future>::Output` cannot be known at compilation time\n-LL |LL | |LL | | }\n-\n-\n-error[E0277]: `[async fn body@$DIR/async.rs:14:29: 16:2]` is not a future\n+error[E0277]: `[async fn body@$DIR/async.rs:23:29: 25:2]` is not a future\n+  --> $DIR/async.rs:23:29\n+   |\n+LL |   async fn foo(x: u32) -> u32 {\n+   |  _____________________________-\n+LL | |     x\n+LL | | }\n+   | | ^\n+   | | |\n+   | |_`[async fn body@$DIR/async.rs:23:29: 25:2]` is not a future\n+   |   required by a bound introduced by this call\n+   |\n+   = help: the trait `Future` is not implemented for `[async fn body@$DIR/async.rs:23:29: 25:2]`\n+   = note: [async fn body@$DIR/async.rs:23:29: 25:2] must be a future or must implement `IntoFuture` to be awaited\n+note: required by a bound in `identity_future`\n+  --> $SRC_DIR/core/src/future/mod.rs:LL:COL\n+\n+error[E0277]: the size for values of type `<[async fn body@$DIR/async.rs:23:29: 25:2] as Future>::Output` cannot be known at compilation time\n+  --> $DIR/async.rs:23:29\n+   |\n+LL |   async fn foo(x: u32) -> u32 {\n+   |  _____________________________^\n+LL | |     x\n+LL | | }\n+   | |_^ doesn't have a size known at compile-time\n+   |\n+   = help: the trait `Sized` is not implemented for `<[async fn body@$DIR/async.rs:23:29: 25:2] as Future>::Output`\n+note: required by a bound in `identity_future`\n+  --> $SRC_DIR/core/src/future/mod.rs:LL:COL\n+\n+error[E0277]: `[async fn body@$DIR/async.rs:23:29: 25:2]` is not a future\n+  --> $DIR/async.rs:23:25\n+   |\n LL | async fn foo(x: u32) -> u32 {\n-\n-error: internal compiler error: compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs:1114:25: projection clauses should be implied from elsewhere. obligation: `Obligation(predicate=Binder(ProjectionPredicate(AliasTy { substs: [[async fn body@$DIR/async.rs:14:29: 16:2]], def_id: ...), _use_mk_alias_ty_instead: () }, Term::Ty(u32)), []), depth=0)`\n+   |                         ^^^ `[async fn body@$DIR/async.rs:23:29: 25:2]` is not a future\n+   |\n+   = help: the trait `Future` is not implemented for `[async fn body@$DIR/async.rs:23:29: 25:2]`\n+   = note: [async fn body@$DIR/async.rs:23:29: 25:2] must be a future or must implement `IntoFuture` to be awaited\n+\n+error: internal compiler error: projection clauses should be implied from elsewhere. obligation: `Obligation(predicate=Binder(ProjectionPredicate(AliasTy { substs: [[async fn body@$DIR/async.rs:23:29: 25:2]], def_id: ...), _use_mk_alias_ty_instead: () }, Term::Ty(u32)), []), depth=0)`\n+  --> $DIR/async.rs:23:25\n+   |\n LL | async fn foo(x: u32) -> u32 {\n-\n-\n-stack backtrace:\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-query stack during panic:\n+   |                         ^^^query stack during panic:\n #0 [typeck] type-checking `foo`\n #1 [thir_body] building THIR for `foo`\n #2 [mir_built] building MIR for `foo`"}]}