{"sha": "7b3650da7aac05266fe51184d5e4bdf11137b256", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiMzY1MGRhN2FhYzA1MjY2ZmU1MTE4NGQ1ZTRiZGYxMTEzN2IyNTY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-04-29T15:55:40Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-04-29T15:55:40Z"}, "message": "mk: Depend on regex_macros for tests appropriately\n\nThere is currently not much precedent for target crates requiring syntax\nextensions to compile their test versions. This dependency is possible, but\ncan't be encoded through the normal means of DEPS_regex because it is a\ntest-only dependency and it must be a *host* dependency (it's a syntax\nextension).\n\nCloses #13844", "tree": {"sha": "598f424dff35597645e0947e17153043fdfa16eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/598f424dff35597645e0947e17153043fdfa16eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b3650da7aac05266fe51184d5e4bdf11137b256", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b3650da7aac05266fe51184d5e4bdf11137b256", "html_url": "https://github.com/rust-lang/rust/commit/7b3650da7aac05266fe51184d5e4bdf11137b256", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b3650da7aac05266fe51184d5e4bdf11137b256/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "30e373390f1a2f74e78bf9ca9c8ca68451f3511a", "url": "https://api.github.com/repos/rust-lang/rust/commits/30e373390f1a2f74e78bf9ca9c8ca68451f3511a", "html_url": "https://github.com/rust-lang/rust/commit/30e373390f1a2f74e78bf9ca9c8ca68451f3511a"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "d97a3799bd060f10b78a5dbc1a25c86363f4f346", "filename": "mk/tests.mk", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7b3650da7aac05266fe51184d5e4bdf11137b256/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7b3650da7aac05266fe51184d5e4bdf11137b256/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=7b3650da7aac05266fe51184d5e4bdf11137b256", "patch": "@@ -349,6 +349,16 @@ TESTDEP_$(1)_$(2)_$(3)_$(4) = $$(SREQ$(1)_T_$(2)_H_$(3)) \\\n \t\t\t    $$(foreach crate,$$(TARGET_CRATES),\\\n \t\t\t\t$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\\n \t\t\t\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4))\n+\n+# The regex crate depends on the regex_macros crate during testing, but it\n+# notably depend on the *host* regex_macros crate, not the target version.\n+# Additionally, this is not a dependency in stage1, only in stage2.\n+ifeq ($(4),regex)\n+ifneq ($(1),1)\n+TESTDEP_$(1)_$(2)_$(3)_$(4) += $$(TLIB$(1)_T_$(3)_H_$(3))/stamp.regex_macros\n+endif\n+endif\n+\n else\n TESTDEP_$(1)_$(2)_$(3)_$(4) = $$(RSINPUTS_$(4))\n endif"}]}