{"sha": "a94e39e7f440deb408637150b226f39e0d62ee11", "node_id": "C_kwDOAAsO6NoAKGE5NGUzOWU3ZjQ0MGRlYjQwODYzNzE1MGIyMjZmMzllMGQ2MmVlMTE", "commit": {"author": {"name": "sireliah", "email": "sajuukk@gmail.com", "date": "2021-10-09T19:27:06Z"}, "committer": {"name": "sireliah", "email": "sajuukk@gmail.com", "date": "2021-10-09T19:49:09Z"}, "message": "Add long explanation for error E0482", "tree": {"sha": "f99c585ed2381d2cb4aedbcf477e700822faf90c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f99c585ed2381d2cb4aedbcf477e700822faf90c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a94e39e7f440deb408637150b226f39e0d62ee11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a94e39e7f440deb408637150b226f39e0d62ee11", "html_url": "https://github.com/rust-lang/rust/commit/a94e39e7f440deb408637150b226f39e0d62ee11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a94e39e7f440deb408637150b226f39e0d62ee11/comments", "author": {"login": "sireliah", "id": 17201781, "node_id": "MDQ6VXNlcjE3MjAxNzgx", "avatar_url": "https://avatars.githubusercontent.com/u/17201781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sireliah", "html_url": "https://github.com/sireliah", "followers_url": "https://api.github.com/users/sireliah/followers", "following_url": "https://api.github.com/users/sireliah/following{/other_user}", "gists_url": "https://api.github.com/users/sireliah/gists{/gist_id}", "starred_url": "https://api.github.com/users/sireliah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sireliah/subscriptions", "organizations_url": "https://api.github.com/users/sireliah/orgs", "repos_url": "https://api.github.com/users/sireliah/repos", "events_url": "https://api.github.com/users/sireliah/events{/privacy}", "received_events_url": "https://api.github.com/users/sireliah/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sireliah", "id": 17201781, "node_id": "MDQ6VXNlcjE3MjAxNzgx", "avatar_url": "https://avatars.githubusercontent.com/u/17201781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sireliah", "html_url": "https://github.com/sireliah", "followers_url": "https://api.github.com/users/sireliah/followers", "following_url": "https://api.github.com/users/sireliah/following{/other_user}", "gists_url": "https://api.github.com/users/sireliah/gists{/gist_id}", "starred_url": "https://api.github.com/users/sireliah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sireliah/subscriptions", "organizations_url": "https://api.github.com/users/sireliah/orgs", "repos_url": "https://api.github.com/users/sireliah/repos", "events_url": "https://api.github.com/users/sireliah/events{/privacy}", "received_events_url": "https://api.github.com/users/sireliah/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69eb996b2617621c7088e567089a86a6657f2a0f", "url": "https://api.github.com/repos/rust-lang/rust/commits/69eb996b2617621c7088e567089a86a6657f2a0f", "html_url": "https://github.com/rust-lang/rust/commit/69eb996b2617621c7088e567089a86a6657f2a0f"}], "stats": {"total": 70, "additions": 69, "deletions": 1}, "files": [{"sha": "1b4b58314b3561806eca5011676a423fda50637b", "filename": "compiler/rustc_error_codes/src/error_codes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a94e39e7f440deb408637150b226f39e0d62ee11/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a94e39e7f440deb408637150b226f39e0d62ee11/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs?ref=a94e39e7f440deb408637150b226f39e0d62ee11", "patch": "@@ -242,6 +242,7 @@ E0468: include_str!(\"./error_codes/E0468.md\"),\n E0469: include_str!(\"./error_codes/E0469.md\"),\n E0477: include_str!(\"./error_codes/E0477.md\"),\n E0478: include_str!(\"./error_codes/E0478.md\"),\n+E0482: include_str!(\"./error_codes/E0482.md\"),\n E0491: include_str!(\"./error_codes/E0491.md\"),\n E0492: include_str!(\"./error_codes/E0492.md\"),\n E0493: include_str!(\"./error_codes/E0493.md\"),\n@@ -599,7 +600,6 @@ E0785: include_str!(\"./error_codes/E0785.md\"),\n //  E0479, // the type `..` (provided as the value of a type parameter) is...\n //  E0480, // lifetime of method receiver does not outlive the method call\n //  E0481, // lifetime of function argument does not outlive the function call\n-    E0482, // lifetime of return value does not outlive the function call\n //  E0483, // lifetime of operand does not outlive the operation\n //  E0484, // reference is not valid at the time of borrow\n //  E0485, // automatically reference is not valid at the time of borrow"}, {"sha": "5ae754b8252b8f0a3105ffe46ff6278e880e1618", "filename": "compiler/rustc_error_codes/src/error_codes/E0482.md", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/a94e39e7f440deb408637150b226f39e0d62ee11/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0482.md", "raw_url": "https://github.com/rust-lang/rust/raw/a94e39e7f440deb408637150b226f39e0d62ee11/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0482.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0482.md?ref=a94e39e7f440deb408637150b226f39e0d62ee11", "patch": "@@ -0,0 +1,68 @@\n+A lifetime of return value does not outlive the function call.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0482\n+fn prefix<'a>(\n+    words: impl Iterator<Item = &'a str>\n+) -> impl Iterator<Item = String> {\n+    words.map(|v| format!(\"foo-{}\", v))\n+}\n+```\n+\n+To fix this error, make the lifetime of the returned value explicit.\n+\n+```\n+fn prefix<'a>(\n+    words: impl Iterator<Item = &'a str> + 'a\n+) -> impl Iterator<Item = String> + 'a {\n+    words.map(|v| format!(\"foo-{}\", v))\n+}\n+```\n+\n+[`impl Trait`] feature in return type have implicit `'static` lifetime\n+restriction and the type implementing the `Iterator` passed to the function\n+lives just `'a`, so shorter time.\n+\n+The solution involves adding lifetime bound to both function argument and\n+the return value to make sure that the values inside the iterator\n+are not dropped when the function goes out of the scope.\n+\n+Alternative solution would be to guarantee that the `Item` references\n+in the iterator are alive for the whole lifetime of the program.\n+\n+```\n+fn prefix(\n+    words: impl Iterator<Item = &'static str>\n+) -> impl Iterator<Item = String> {\n+    words.map(|v| format!(\"foo-{}\", v))\n+}\n+```\n+\n+Similar lifetime problem might arise when returning closures.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0482\n+fn foo(x: &mut Vec<i32>) -> impl FnMut(&mut Vec<i32>) -> &[i32] {\n+    |y| {\n+        y.append(x);\n+        y\n+    }\n+}\n+```\n+\n+Analogically, solution here is to use explicit return lifetime\n+and move the ownership of the variable to the closure.\n+\n+```\n+fn foo<'a>(x: &'a mut Vec<i32>) -> impl FnMut(&mut Vec<i32>) -> &[i32] + 'a {\n+    move |y| {\n+        y.append(x);\n+        y\n+    }\n+}\n+```\n+\n+- [`impl Trait`]: https://doc.rust-lang.org/reference/types/impl-trait.html\n+- [RFC 1951]: https://rust-lang.github.io/rfcs/1951-expand-impl-trait.html"}]}