{"sha": "b97ccebc7c3189f3cd0f725a14b163836b0a7b22", "node_id": "C_kwDOAAsO6NoAKGI5N2NjZWJjN2MzMTg5ZjNjZDBmNzI1YTE0YjE2MzgzNmIwYTdiMjI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-11T06:48:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-11T06:48:05Z"}, "message": "Rollup merge of #93852 - GuillaumeGomez:remove-multi-query, r=jsha\n\nrustdoc: remove support for multi-query search\n\nThis is needed by https://github.com/rust-lang/rust/pull/90630 to make feature changes non-existent.\n\ncc `@camelid`\nr? `@jsha`", "tree": {"sha": "927feb78bc3e0c7d6b960508e0f56c3545d39114", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/927feb78bc3e0c7d6b960508e0f56c3545d39114"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b97ccebc7c3189f3cd0f725a14b163836b0a7b22", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiBgalCRBK7hj4Ov3rIwAA4mcIAIQqS6V1MKgnButbnwqlFGjX\nuw8+ITHRpI30h1X3Hvzi1WXUUUV1m4klaW4PDLEF0p+l49lXl1r1jHAi3kDFhmnu\nF8Jxz7tjs35l9wR8mU1laeodHLO+MoJY7uOD6tMfHfSc77u9Pg1psyItvP8YDo4Q\ncpBHCkZeIifVRoGUufgNJHJEfOFdvfguCTyefDNbrmQOl5aGzciuzK3wVTW68rr2\nUrgv2TWTXjm+Pi3rQNhZPiimOnFMM0KV2h5ItjMpqIIhTvM9YO+v86qOj4e7QZFq\norNt9bPtTLnoEclGdvDobWKxm/GkgCGHNw2mOlTLsOJmH3ly5JtnC1ekQk5qfqw=\n=odux\n-----END PGP SIGNATURE-----\n", "payload": "tree 927feb78bc3e0c7d6b960508e0f56c3545d39114\nparent b8da6f4ce4cfdc60885e80edd7a73c5605f560e1\nparent 8e12b4e94fdffe61bd866958ee7c8c297d6de355\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1644562085 +0100\ncommitter GitHub <noreply@github.com> 1644562085 +0100\n\nRollup merge of #93852 - GuillaumeGomez:remove-multi-query, r=jsha\n\nrustdoc: remove support for multi-query search\n\nThis is needed by https://github.com/rust-lang/rust/pull/90630 to make feature changes non-existent.\n\ncc `@camelid`\nr? `@jsha`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b97ccebc7c3189f3cd0f725a14b163836b0a7b22", "html_url": "https://github.com/rust-lang/rust/commit/b97ccebc7c3189f3cd0f725a14b163836b0a7b22", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b97ccebc7c3189f3cd0f725a14b163836b0a7b22/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8da6f4ce4cfdc60885e80edd7a73c5605f560e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8da6f4ce4cfdc60885e80edd7a73c5605f560e1", "html_url": "https://github.com/rust-lang/rust/commit/b8da6f4ce4cfdc60885e80edd7a73c5605f560e1"}, {"sha": "8e12b4e94fdffe61bd866958ee7c8c297d6de355", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e12b4e94fdffe61bd866958ee7c8c297d6de355", "html_url": "https://github.com/rust-lang/rust/commit/8e12b4e94fdffe61bd866958ee7c8c297d6de355"}], "stats": {"total": 113, "additions": 6, "deletions": 107}, "files": [{"sha": "b0ce63a4ec1d5d7177feacb2d84198642d807ce5", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 6, "deletions": 97, "changes": 103, "blob_url": "https://github.com/rust-lang/rust/blob/b97ccebc7c3189f3cd0f725a14b163836b0a7b22/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/b97ccebc7c3189f3cd0f725a14b163836b0a7b22/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=b97ccebc7c3189f3cd0f725a14b163836b0a7b22", "patch": "@@ -1197,110 +1197,19 @@ window.initSearch = function(rawSearchIndex) {\n     }\n \n     function execSearch(query, searchWords, filterCrates) {\n-        function getSmallest(arrays, positions, notDuplicates) {\n-            var start = null;\n-\n-            for (var it = 0, len = positions.length; it < len; ++it) {\n-                if (arrays[it].length > positions[it] &&\n-                    (start === null || start > arrays[it][positions[it]].lev) &&\n-                    !notDuplicates[arrays[it][positions[it]].fullPath]) {\n-                    start = arrays[it][positions[it]].lev;\n-                }\n-            }\n-            return start;\n-        }\n-\n-        function mergeArrays(arrays) {\n-            var ret = [];\n-            var positions = [];\n-            var notDuplicates = {};\n-\n-            for (var x = 0, arrays_len = arrays.length; x < arrays_len; ++x) {\n-                positions.push(0);\n-            }\n-            while (ret.length < MAX_RESULTS) {\n-                var smallest = getSmallest(arrays, positions, notDuplicates);\n-\n-                if (smallest === null) {\n-                    break;\n-                }\n-                for (x = 0; x < arrays_len && ret.length < MAX_RESULTS; ++x) {\n-                    if (arrays[x].length > positions[x] &&\n-                            arrays[x][positions[x]].lev === smallest &&\n-                            !notDuplicates[arrays[x][positions[x]].fullPath]) {\n-                        ret.push(arrays[x][positions[x]]);\n-                        notDuplicates[arrays[x][positions[x]].fullPath] = true;\n-                        positions[x] += 1;\n-                    }\n-                }\n-            }\n-            return ret;\n-        }\n-\n-        // Split search query by \",\", while respecting angle bracket nesting.\n-        // Since \"<\" is an alias for the Ord family of traits, it also uses\n-        // lookahead to distinguish \"<\"-as-less-than from \"<\"-as-angle-bracket.\n-        //\n-        // tokenizeQuery(\"A<B, C>, D\") == [\"A<B, C>\", \"D\"]\n-        // tokenizeQuery(\"A<B, C, D\") == [\"A<B\", \"C\", \"D\"]\n-        function tokenizeQuery(raw) {\n-            var i, matched;\n-            var l = raw.length;\n-            var depth = 0;\n-            var nextAngle = /(<|>)/g;\n-            var ret = [];\n-            var start = 0;\n-            for (i = 0; i < l; ++i) {\n-                switch (raw[i]) {\n-                    case \"<\":\n-                        nextAngle.lastIndex = i + 1;\n-                        matched = nextAngle.exec(raw);\n-                        if (matched && matched[1] === '>') {\n-                            depth += 1;\n-                        }\n-                        break;\n-                    case \">\":\n-                        if (depth > 0) {\n-                            depth -= 1;\n-                        }\n-                        break;\n-                    case \",\":\n-                        if (depth === 0) {\n-                            ret.push(raw.substring(start, i));\n-                            start = i + 1;\n-                        }\n-                        break;\n-                }\n-            }\n-            if (start !== i) {\n-                ret.push(raw.substring(start, i));\n-            }\n-            return ret;\n-        }\n-\n-        var queries = tokenizeQuery(query.raw);\n+        query = query.raw.trim();\n         var results = {\n             \"in_args\": [],\n             \"returned\": [],\n             \"others\": [],\n         };\n \n-        for (var i = 0, len = queries.length; i < len; ++i) {\n-            query = queries[i].trim();\n-            if (query.length !== 0) {\n-                var tmp = execQuery(getQuery(query), searchWords, filterCrates);\n+        if (query.length !== 0) {\n+            var tmp = execQuery(getQuery(query), searchWords, filterCrates);\n \n-                results.in_args.push(tmp.in_args);\n-                results.returned.push(tmp.returned);\n-                results.others.push(tmp.others);\n-            }\n-        }\n-        if (queries.length > 1) {\n-            return {\n-                \"in_args\": mergeArrays(results.in_args),\n-                \"returned\": mergeArrays(results.returned),\n-                \"others\": mergeArrays(results.others),\n-            };\n+            results.in_args.push(tmp.in_args);\n+            results.returned.push(tmp.returned);\n+            results.others.push(tmp.others);\n         }\n         return {\n             \"in_args\": results.in_args[0],"}, {"sha": "1c92d019606b673f056ecd613478c877eb6d8afc", "filename": "src/test/rustdoc-js-std/multi-query.js", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b8da6f4ce4cfdc60885e80edd7a73c5605f560e1/src%2Ftest%2Frustdoc-js-std%2Fmulti-query.js", "raw_url": "https://github.com/rust-lang/rust/raw/b8da6f4ce4cfdc60885e80edd7a73c5605f560e1/src%2Ftest%2Frustdoc-js-std%2Fmulti-query.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-js-std%2Fmulti-query.js?ref=b8da6f4ce4cfdc60885e80edd7a73c5605f560e1", "patch": "@@ -1,10 +0,0 @@\n-const QUERY = 'str,u8';\n-\n-const EXPECTED = {\n-    'others': [\n-        { 'path': 'std', 'name': 'str', 'href': '../std/primitive.str.html' },\n-        { 'path': 'std', 'name': 'u8', 'href': '../std/primitive.u8.html'  },\n-        { 'path': 'std', 'name': 'str', 'href': '../std/str/index.html' },\n-        { 'path': 'std', 'name': 'u8', 'href': '../std/u8/index.html' },\n-    ],\n-};"}]}