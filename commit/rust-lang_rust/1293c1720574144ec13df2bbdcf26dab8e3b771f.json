{"sha": "1293c1720574144ec13df2bbdcf26dab8e3b771f", "node_id": "C_kwDOAAsO6NoAKDEyOTNjMTcyMDU3NDE0NGVjMTNkZjJiYmRjZjI2ZGFiOGUzYjc3MWY", "commit": {"author": {"name": "Shane Murphy", "email": "shaneeverittmurphy@gmail.com", "date": "2023-06-01T00:22:44Z"}, "committer": {"name": "Shane Murphy", "email": "shaneeverittmurphy@gmail.com", "date": "2023-06-01T00:25:53Z"}, "message": "Fix bug in utf16_to_utf8 for zero length strings\n\nThis fixes the behavior of sending EOF by pressing Ctrl+Z => Enter in a\nwindows console.\n\nPreviously, that would trip the unpaired surrogate error, whereas now we\ncorrectly detect EOF.", "tree": {"sha": "0a76177c0ace8686894ee09cea401e8ad3ac70d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0a76177c0ace8686894ee09cea401e8ad3ac70d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1293c1720574144ec13df2bbdcf26dab8e3b771f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1293c1720574144ec13df2bbdcf26dab8e3b771f", "html_url": "https://github.com/rust-lang/rust/commit/1293c1720574144ec13df2bbdcf26dab8e3b771f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1293c1720574144ec13df2bbdcf26dab8e3b771f/comments", "author": {"login": "ShaneEverittM", "id": 47866566, "node_id": "MDQ6VXNlcjQ3ODY2NTY2", "avatar_url": "https://avatars.githubusercontent.com/u/47866566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShaneEverittM", "html_url": "https://github.com/ShaneEverittM", "followers_url": "https://api.github.com/users/ShaneEverittM/followers", "following_url": "https://api.github.com/users/ShaneEverittM/following{/other_user}", "gists_url": "https://api.github.com/users/ShaneEverittM/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShaneEverittM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShaneEverittM/subscriptions", "organizations_url": "https://api.github.com/users/ShaneEverittM/orgs", "repos_url": "https://api.github.com/users/ShaneEverittM/repos", "events_url": "https://api.github.com/users/ShaneEverittM/events{/privacy}", "received_events_url": "https://api.github.com/users/ShaneEverittM/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ShaneEverittM", "id": 47866566, "node_id": "MDQ6VXNlcjQ3ODY2NTY2", "avatar_url": "https://avatars.githubusercontent.com/u/47866566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShaneEverittM", "html_url": "https://github.com/ShaneEverittM", "followers_url": "https://api.github.com/users/ShaneEverittM/followers", "following_url": "https://api.github.com/users/ShaneEverittM/following{/other_user}", "gists_url": "https://api.github.com/users/ShaneEverittM/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShaneEverittM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShaneEverittM/subscriptions", "organizations_url": "https://api.github.com/users/ShaneEverittM/orgs", "repos_url": "https://api.github.com/users/ShaneEverittM/repos", "events_url": "https://api.github.com/users/ShaneEverittM/events{/privacy}", "received_events_url": "https://api.github.com/users/ShaneEverittM/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "871b5952023139738f72eba235063575062bc2e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/871b5952023139738f72eba235063575062bc2e9", "html_url": "https://github.com/rust-lang/rust/commit/871b5952023139738f72eba235063575062bc2e9"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "3fcaaa508e3c89f6bf6039029c798b7ad5b0573d", "filename": "library/std/src/sys/windows/stdio.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1293c1720574144ec13df2bbdcf26dab8e3b771f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1293c1720574144ec13df2bbdcf26dab8e3b771f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio.rs?ref=1293c1720574144ec13df2bbdcf26dab8e3b771f", "patch": "@@ -11,6 +11,9 @@ use crate::sys::cvt;\n use crate::sys::handle::Handle;\n use core::str::utf8_char_width;\n \n+#[cfg(test)]\n+mod tests;\n+\n // Don't cache handles but get them fresh for every read/write. This allows us to track changes to\n // the value over time (such as if a process calls `SetStdHandle` while it's running). See #40490.\n pub struct Stdin {\n@@ -383,6 +386,10 @@ fn utf16_to_utf8(utf16: &[u16], utf8: &mut [u8]) -> io::Result<usize> {\n     debug_assert!(utf16.len() <= c::c_int::MAX as usize);\n     debug_assert!(utf8.len() <= c::c_int::MAX as usize);\n \n+    if utf16.is_empty() {\n+        return Ok(0);\n+    }\n+\n     let result = unsafe {\n         c::WideCharToMultiByte(\n             c::CP_UTF8,              // CodePage"}, {"sha": "1e53e0bee636978f55f2f27ae9fbe78ea0e26c06", "filename": "library/std/src/sys/windows/stdio/tests.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1293c1720574144ec13df2bbdcf26dab8e3b771f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1293c1720574144ec13df2bbdcf26dab8e3b771f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstdio%2Ftests.rs?ref=1293c1720574144ec13df2bbdcf26dab8e3b771f", "patch": "@@ -0,0 +1,6 @@\n+use super::utf16_to_utf8;\n+\n+#[test]\n+fn zero_size_read() {\n+    assert_eq!(utf16_to_utf8(&[], &mut []).unwrap(), 0);\n+}"}]}