{"sha": "042facb9357f9b6248b0b2b6c5624742c3948e47", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0MmZhY2I5MzU3ZjliNjI0OGIwYjJiNmM1NjI0NzQyYzM5NDhlNDc=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-23T13:55:24Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-01-25T09:32:58Z"}, "message": "Fix some bugs reported by eslint", "tree": {"sha": "f730330726b8920c12d410a8372e839f197ba107", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f730330726b8920c12d410a8372e839f197ba107"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/042facb9357f9b6248b0b2b6c5624742c3948e47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/042facb9357f9b6248b0b2b6c5624742c3948e47", "html_url": "https://github.com/rust-lang/rust/commit/042facb9357f9b6248b0b2b6c5624742c3948e47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/042facb9357f9b6248b0b2b6c5624742c3948e47/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b814b639836aa76b5c6deaa585367150bb2debf4", "url": "https://api.github.com/repos/rust-lang/rust/commits/b814b639836aa76b5c6deaa585367150bb2debf4", "html_url": "https://github.com/rust-lang/rust/commit/b814b639836aa76b5c6deaa585367150bb2debf4"}], "stats": {"total": 64, "additions": 33, "deletions": 31}, "files": [{"sha": "53f0831852456bfc753056ec27c14598c6812974", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 22, "deletions": 28, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=042facb9357f9b6248b0b2b6c5624742c3948e47", "patch": "@@ -1,9 +1,6 @@\n-// From rust:\n-/* global ALIASES */\n-\n // Local js definitions:\n-/* global addClass, getCurrentValue, hasClass */\n-/* global onEachLazy, hasOwnProperty, removeClass, updateLocalStorage */\n+/* global addClass, getSettingValue, hasClass */\n+/* global onEach, onEachLazy, hasOwnProperty, removeClass, updateLocalStorage */\n /* global hideThemeButtonState, showThemeButtonState */\n \n if (!String.prototype.startsWith) {\n@@ -2214,7 +2211,7 @@ function defocusSearchBar() {\n         }\n     }\n \n-    function toggleAllDocs(pageId, fromAutoCollapse) {\n+    function toggleAllDocs(fromAutoCollapse) {\n         var innerToggle = document.getElementById(toggleAllDocsId);\n         if (!innerToggle) {\n             return;\n@@ -2257,14 +2254,14 @@ function defocusSearchBar() {\n                     }\n                     if (!parent || !superParent || superParent.id !== \"main\" ||\n                         hasClass(parent, \"impl\") === false) {\n-                        collapseDocs(e, \"hide\", pageId);\n+                        collapseDocs(e, \"hide\");\n                     }\n                 });\n             }\n         }\n     }\n \n-    function collapseDocs(toggle, mode, pageId) {\n+    function collapseDocs(toggle, mode) {\n         if (!toggle || !toggle.parentNode) {\n             return;\n         }\n@@ -2384,35 +2381,35 @@ function defocusSearchBar() {\n         }\n     }\n \n-    function collapser(pageId, e, collapse) {\n+    function collapser(e, collapse) {\n         // inherent impl ids are like \"impl\" or impl-<number>'.\n         // they will never be hidden by default.\n         var n = e.parentElement;\n         if (n.id.match(/^impl(?:-\\d+)?$/) === null) {\n             // Automatically minimize all non-inherent impls\n             if (collapse || hasClass(n, \"impl\")) {\n-                collapseDocs(e, \"hide\", pageId);\n+                collapseDocs(e, \"hide\");\n             }\n         }\n     }\n \n-    function autoCollapse(pageId, collapse) {\n+    function autoCollapse(collapse) {\n         if (collapse) {\n-            toggleAllDocs(pageId, true);\n+            toggleAllDocs(true);\n         } else if (getSettingValue(\"auto-hide-trait-implementations\") !== \"false\") {\n             var impl_list = document.getElementById(\"trait-implementations-list\");\n \n             if (impl_list !== null) {\n                 onEachLazy(impl_list.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                    collapser(pageId, e, collapse);\n+                    collapser(e, collapse);\n                 });\n             }\n \n             var blanket_list = document.getElementById(\"blanket-implementations-list\");\n \n             if (blanket_list !== null) {\n                 onEachLazy(blanket_list.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                    collapser(pageId, e, collapse);\n+                    collapser(e, collapse);\n                 });\n             }\n         }\n@@ -2475,7 +2472,6 @@ function defocusSearchBar() {\n         var toggle = createSimpleToggle(false);\n         var hideMethodDocs = getSettingValue(\"auto-hide-method-docs\") === \"true\";\n         var hideImplementors = getSettingValue(\"auto-collapse-implementors\") !== \"false\";\n-        var pageId = getPageId();\n \n         var func = function(e) {\n             var next = e.nextElementSibling;\n@@ -2489,7 +2485,7 @@ function defocusSearchBar() {\n                 var newToggle = toggle.cloneNode(true);\n                 insertAfter(newToggle, e.childNodes[e.childNodes.length - 1]);\n                 if (hideMethodDocs === true && hasClass(e, \"method\") === true) {\n-                    collapseDocs(newToggle, \"hide\", pageId);\n+                    collapseDocs(newToggle, \"hide\");\n                 }\n             }\n         };\n@@ -2513,7 +2509,7 @@ function defocusSearchBar() {\n                 // In case the option \"auto-collapse implementors\" is not set to false, we collapse\n                 // all implementors.\n                 if (hideImplementors === true && e.parentNode.id === \"implementors-list\") {\n-                    collapseDocs(newToggle, \"hide\", pageId);\n+                    collapseDocs(newToggle, \"hide\");\n                 }\n             }\n         };\n@@ -2527,7 +2523,7 @@ function defocusSearchBar() {\n                 if (e.id.match(/^impl(?:-\\d+)?$/) === null) {\n                     // Automatically minimize all non-inherent impls\n                     if (hasClass(e, \"impl\") === true) {\n-                        collapseDocs(newToggle, \"hide\", pageId);\n+                        collapseDocs(newToggle, \"hide\");\n                     }\n                 }\n             };\n@@ -2562,14 +2558,12 @@ function defocusSearchBar() {\n         }\n         onEachLazy(document.getElementsByClassName(\"impl-items\"), function(e) {\n             onEachLazy(e.getElementsByClassName(\"associatedconstant\"), func);\n-            var hiddenElems = e.getElementsByClassName(\"hidden\");\n-            var needToggle = false;\n-\n-            var needToggle = onEachLazy(e.getElementsByClassName(\"hidden\"), function(hiddenElem) {\n-                if (hasClass(hiddenElem, \"content\") === false &&\n-                    hasClass(hiddenElem, \"docblock\") === false) {\n-                    return true;\n-                }\n+            // We transform the DOM iterator into a vec of DOM elements to prevent performance\n+            // issues on webkit browsers.\n+            var hiddenElems = Array.prototype.slice.call(e.getElementsByClassName(\"hidden\"));\n+            var needToggle = hiddenElems.some(function(hiddenElem) {\n+                return hasClass(hiddenElem, \"content\") === false &&\n+                    hasClass(hiddenElem, \"docblock\") === false;\n             });\n             if (needToggle === true) {\n                 var inner_toggle = newToggle.cloneNode(true);\n@@ -2672,10 +2666,10 @@ function defocusSearchBar() {\n \n         onEachLazy(document.getElementsByClassName(\"docblock\"), buildToggleWrapper);\n         onEachLazy(document.getElementsByClassName(\"sub-variant\"), buildToggleWrapper);\n-        var pageId = getPageId();\n \n-        autoCollapse(pageId, getSettingValue(\"collapse\") === \"true\");\n+        autoCollapse(getSettingValue(\"collapse\") === \"true\");\n \n+        var pageId = getPageId();\n         if (pageId !== null) {\n             expandSection(pageId);\n         }"}, {"sha": "4f10e14e8558c71cde4c5ef964d91ae90e03a796", "filename": "src/librustdoc/html/static/settings.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsettings.js", "raw_url": "https://github.com/rust-lang/rust/raw/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsettings.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsettings.js?ref=042facb9357f9b6248b0b2b6c5624742c3948e47", "patch": "@@ -1,5 +1,5 @@\n // Local js definitions:\n-/* global getCurrentValue, getVirtualKey, updateLocalStorage, updateSystemTheme */\n+/* global getSettingValue, getVirtualKey, onEachLazy, updateLocalStorage, updateSystemTheme */\n \n (function () {\n     function changeSetting(settingName, value) {"}, {"sha": "42b54e4cc1e46a639b31fc1fffcc0638b0bdb9ea", "filename": "src/librustdoc/html/static/source-script.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js?ref=042facb9357f9b6248b0b2b6c5624742c3948e47", "patch": "@@ -113,6 +113,8 @@ function createSidebarToggle() {\n     return sidebarToggle;\n }\n \n+// This function is called from \"source-files.js\", generated in `html/render/mod.rs`.\n+// eslint-disable-next-line no-unused-vars\n function createSourceSidebar() {\n     if (window.rootPath.endsWith(\"/\") === false) {\n         window.rootPath += \"/\";"}, {"sha": "9c5ac1625afeae0c6714ce7a84a920b4b858091d", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/042facb9357f9b6248b0b2b6c5624742c3948e47/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=042facb9357f9b6248b0b2b6c5624742c3948e47", "patch": "@@ -1,5 +1,5 @@\n // From rust:\n-/* global resourcesSuffix, getSettingValue */\n+/* global resourcesSuffix */\n \n var darkThemes = [\"dark\", \"ayu\"];\n var currentTheme = document.getElementById(\"themeStyle\");\n@@ -35,17 +35,20 @@ var localStoredTheme = getSettingValue(\"theme\");\n \n var savedHref = [];\n \n+// eslint-disable-next-line no-unused-vars\n function hasClass(elem, className) {\n     return elem && elem.classList && elem.classList.contains(className);\n }\n \n+// eslint-disable-next-line no-unused-vars\n function addClass(elem, className) {\n     if (!elem || !elem.classList) {\n         return;\n     }\n     elem.classList.add(className);\n }\n \n+// eslint-disable-next-line no-unused-vars\n function removeClass(elem, className) {\n     if (!elem || !elem.classList) {\n         return;\n@@ -81,6 +84,7 @@ function onEachLazy(lazyArray, func, reversed) {\n         reversed);\n }\n \n+// eslint-disable-next-line no-unused-vars\n function hasOwnProperty(obj, property) {\n     return Object.prototype.hasOwnProperty.call(obj, property);\n }\n@@ -148,6 +152,8 @@ function switchTheme(styleElem, mainStyleElem, newTheme, saveTheme) {\n     }\n }\n \n+// This function is called from \"theme.js\", generated in `html/render/mod.rs`.\n+// eslint-disable-next-line no-unused-vars\n function useSystemTheme(value) {\n     if (value === undefined) {\n         value = true;\n@@ -172,7 +178,7 @@ var updateSystemTheme = (function() {\n             switchTheme(\n                 currentTheme,\n                 mainTheme,\n-                JSON.parse(cssTheme) || light,\n+                JSON.parse(cssTheme) || \"light\",\n                 true\n             );\n         };"}]}