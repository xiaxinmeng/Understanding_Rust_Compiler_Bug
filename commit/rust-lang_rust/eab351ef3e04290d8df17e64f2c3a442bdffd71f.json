{"sha": "eab351ef3e04290d8df17e64f2c3a442bdffd71f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhYjM1MWVmM2UwNDI5MGQ4ZGYxN2U2NGYyYzNhNDQyYmRmZmQ3MWY=", "commit": {"author": {"name": "Andrea Canciani", "email": "ranma42@gmail.com", "date": "2016-01-04T16:13:19Z"}, "committer": {"name": "Andrea Canciani", "email": "ranma42@gmail.com", "date": "2016-01-04T16:31:41Z"}, "message": "Cleanup unicode.py\n\nThe methods related to char width are dead code since\n464cdff102993ff1900eebbf65209e0a3c0be0d5; remove them.", "tree": {"sha": "a1ba9209ea2f51e691641ef4a569a7cad551f589", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a1ba9209ea2f51e691641ef4a569a7cad551f589"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eab351ef3e04290d8df17e64f2c3a442bdffd71f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eab351ef3e04290d8df17e64f2c3a442bdffd71f", "html_url": "https://github.com/rust-lang/rust/commit/eab351ef3e04290d8df17e64f2c3a442bdffd71f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eab351ef3e04290d8df17e64f2c3a442bdffd71f/comments", "author": {"login": "ranma42", "id": 1506030, "node_id": "MDQ6VXNlcjE1MDYwMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1506030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ranma42", "html_url": "https://github.com/ranma42", "followers_url": "https://api.github.com/users/ranma42/followers", "following_url": "https://api.github.com/users/ranma42/following{/other_user}", "gists_url": "https://api.github.com/users/ranma42/gists{/gist_id}", "starred_url": "https://api.github.com/users/ranma42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ranma42/subscriptions", "organizations_url": "https://api.github.com/users/ranma42/orgs", "repos_url": "https://api.github.com/users/ranma42/repos", "events_url": "https://api.github.com/users/ranma42/events{/privacy}", "received_events_url": "https://api.github.com/users/ranma42/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ranma42", "id": 1506030, "node_id": "MDQ6VXNlcjE1MDYwMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1506030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ranma42", "html_url": "https://github.com/ranma42", "followers_url": "https://api.github.com/users/ranma42/followers", "following_url": "https://api.github.com/users/ranma42/following{/other_user}", "gists_url": "https://api.github.com/users/ranma42/gists{/gist_id}", "starred_url": "https://api.github.com/users/ranma42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ranma42/subscriptions", "organizations_url": "https://api.github.com/users/ranma42/orgs", "repos_url": "https://api.github.com/users/ranma42/repos", "events_url": "https://api.github.com/users/ranma42/events{/privacy}", "received_events_url": "https://api.github.com/users/ranma42/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "191ff2d8fd57a8238d85302a8f06e2bd11b2f6d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/191ff2d8fd57a8238d85302a8f06e2bd11b2f6d2", "html_url": "https://github.com/rust-lang/rust/commit/191ff2d8fd57a8238d85302a8f06e2bd11b2f6d2"}], "stats": {"total": 115, "additions": 0, "deletions": 115}, "files": [{"sha": "4452be10bc274a7bcda2d1d25bd495ba19c035ab", "filename": "src/etc/unicode.py", "status": "modified", "additions": 0, "deletions": 115, "changes": 115, "blob_url": "https://github.com/rust-lang/rust/blob/eab351ef3e04290d8df17e64f2c3a442bdffd71f/src%2Fetc%2Funicode.py", "raw_url": "https://github.com/rust-lang/rust/raw/eab351ef3e04290d8df17e64f2c3a442bdffd71f/src%2Fetc%2Funicode.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Funicode.py?ref=eab351ef3e04290d8df17e64f2c3a442bdffd71f", "patch": "@@ -271,43 +271,6 @@ def load_properties(f, interestingprops):\n \n     return props\n \n-# load all widths of want_widths, except those in except_cats\n-def load_east_asian_width(want_widths, except_cats):\n-    f = \"EastAsianWidth.txt\"\n-    fetch(f)\n-    widths = {}\n-    re1 = re.compile(\"^([0-9A-F]+);(\\w+) +# (\\w+)\")\n-    re2 = re.compile(\"^([0-9A-F]+)\\.\\.([0-9A-F]+);(\\w+) +# (\\w+)\")\n-\n-    for line in fileinput.input(f):\n-        width = None\n-        d_lo = 0\n-        d_hi = 0\n-        cat = None\n-        m = re1.match(line)\n-        if m:\n-            d_lo = m.group(1)\n-            d_hi = m.group(1)\n-            width = m.group(2)\n-            cat = m.group(3)\n-        else:\n-            m = re2.match(line)\n-            if m:\n-                d_lo = m.group(1)\n-                d_hi = m.group(2)\n-                width = m.group(3)\n-                cat = m.group(4)\n-            else:\n-                continue\n-        if cat in except_cats or width not in want_widths:\n-            continue\n-        d_lo = int(d_lo, 16)\n-        d_hi = int(d_hi, 16)\n-        if width not in widths:\n-            widths[width] = []\n-        widths[width].append((d_lo, d_hi))\n-    return widths\n-\n def escape_char(c):\n     return \"'\\\\u{%x}'\" % c if c != 0 else \"'\\\\0'\"\n \n@@ -398,47 +361,6 @@ def emit_conversions_module(f, to_upper, to_lower, to_title):\n         is_pub=False, t_type = t_type, pfun=pfun)\n     f.write(\"}\\n\\n\")\n \n-def emit_charwidth_module(f, width_table):\n-    f.write(\"pub mod charwidth {\\n\")\n-    f.write(\"    use core::option::Option;\\n\")\n-    f.write(\"    use core::option::Option::{Some, None};\\n\")\n-    f.write(\"    use core::result::Result::{Ok, Err};\\n\")\n-    f.write(\"\"\"\n-    fn bsearch_range_value_table(c: char, is_cjk: bool, r: &'static [(char, char, u8, u8)]) -> u8 {\n-        use core::cmp::Ordering::{Equal, Less, Greater};\n-        match r.binary_search_by(|&(lo, hi, _, _)| {\n-            if lo <= c && c <= hi { Equal }\n-            else if hi < c { Less }\n-            else { Greater }\n-        }) {\n-            Ok(idx) => {\n-                let (_, _, r_ncjk, r_cjk) = r[idx];\n-                if is_cjk { r_cjk } else { r_ncjk }\n-            }\n-            Err(_) => 1\n-        }\n-    }\n-\"\"\")\n-\n-    f.write(\"\"\"\n-    pub fn width(c: char, is_cjk: bool) -> Option<usize> {\n-        match c as usize {\n-            _c @ 0 => Some(0),          // null is zero width\n-            cu if cu < 0x20 => None,    // control sequences have no width\n-            cu if cu < 0x7F => Some(1), // ASCII\n-            cu if cu < 0xA0 => None,    // more control sequences\n-            _ => Some(bsearch_range_value_table(c, is_cjk, charwidth_table) as usize)\n-        }\n-    }\n-\n-\"\"\")\n-\n-    f.write(\"    // character width table. Based on Markus Kuhn's free wcwidth() implementation,\\n\")\n-    f.write(\"    //     http://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c\\n\")\n-    emit_table(f, \"charwidth_table\", width_table, \"&'static [(char, char, u8, u8)]\", is_pub=False,\n-            pfun=lambda x: \"(%s,%s,%s,%s)\" % (escape_char(x[0]), escape_char(x[1]), x[2], x[3]))\n-    f.write(\"}\\n\\n\")\n-\n def emit_norm_module(f, canon, compat, combine, norm_props):\n     canon_keys = canon.keys()\n     canon_keys.sort()\n@@ -459,43 +381,6 @@ def emit_norm_module(f, canon, compat, combine, norm_props):\n     canon_comp_keys = canon_comp.keys()\n     canon_comp_keys.sort()\n \n-def remove_from_wtable(wtable, val):\n-    wtable_out = []\n-    while wtable:\n-        if wtable[0][1] < val:\n-            wtable_out.append(wtable.pop(0))\n-        elif wtable[0][0] > val:\n-            break\n-        else:\n-            (wt_lo, wt_hi, width, width_cjk) = wtable.pop(0)\n-            if wt_lo == wt_hi == val:\n-                continue\n-            elif wt_lo == val:\n-                wtable_out.append((wt_lo+1, wt_hi, width, width_cjk))\n-            elif wt_hi == val:\n-                wtable_out.append((wt_lo, wt_hi-1, width, width_cjk))\n-            else:\n-                wtable_out.append((wt_lo, val-1, width, width_cjk))\n-                wtable_out.append((val+1, wt_hi, width, width_cjk))\n-    if wtable:\n-        wtable_out.extend(wtable)\n-    return wtable_out\n-\n-\n-\n-def optimize_width_table(wtable):\n-    wtable_out = []\n-    w_this = wtable.pop(0)\n-    while wtable:\n-        if w_this[1] == wtable[0][0] - 1 and w_this[2:3] == wtable[0][2:3]:\n-            w_tmp = wtable.pop(0)\n-            w_this = (w_this[0], w_tmp[1], w_tmp[2], w_tmp[3])\n-        else:\n-            wtable_out.append(w_this)\n-            w_this = wtable.pop(0)\n-    wtable_out.append(w_this)\n-    return wtable_out\n-\n if __name__ == \"__main__\":\n     r = \"tables.rs\"\n     if os.path.exists(r):"}]}