{"sha": "2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhZDY2M2MxY2Q3YWM4ZGY5ZWVhMDEwY2IwZjNmNDBlZDZkODcwN2E=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-09T08:58:16Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-14T09:12:10Z"}, "message": "Normalize test build directory and root build directory.", "tree": {"sha": "f2495a2b3ce94d7e7bbe1026ff33620beaa36abe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f2495a2b3ce94d7e7bbe1026ff33620beaa36abe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAltynOoACgkQAXYLT59T\n8VSgpA/9EGyzbnGi/kpmjpcaYpMLBlmAb/diA307CcVhzmB7/77qPJxpytJjzZcA\nAPABRe+Fx2gAhsT7iHpvCh5C0lBQTbO5/GXl4YjIe7lejmkP5RP6ltVmSluGlxBp\nC6MIE/sqyK5//eRgqTBLmynlJPH72ZY0XbroXf1XHNYDF/lXUIjbi77QfQp2ZeNZ\npGMXGBO9MZXloxrL9+Kw27iEbUhReUS6E9qAQSerC32lwrxwfXUVxdL1j1Pa3KkL\npElzv/tQDouNm+JcsNcTTuC7V4MrbJYc8E+8uRhihA7gK20vMh/p+KJgc8rxS9ao\n9grgQ6sBOO8nG3WH91tg0oTj+LfVx7UTDfBTBkSo0EeqOYrgK3s4QiO2P79PNxGF\n0rNlnGu/L2hRhsN9Q2PFdMigBRJmVrDHyjYc1XpaXaPfryNzrO5qzbQhsQpASbFd\nJW7fE24BjkKffEp0h+cm2DjrFRKmd66kD/qtqF7mZLSM49TIimkdGyetRFN9VNer\nP3dt2jAiWkMu270aFkWIUElvVltahoSxPrII3PUxeGRrhJFhX8igi3xklF8xxJrq\n8b2NOOjIJ9nd2jhWohkmYWccl26NT0tBmZGP8zjtNDRInTPAEt3z4OvOgZavvSqA\n2WWib/5ZWX5y+A0GgAjCsSPyWRftE96D0EArEUGab7hIw3pxhS4=\n=Rlo6\n-----END PGP SIGNATURE-----", "payload": "tree f2495a2b3ce94d7e7bbe1026ff33620beaa36abe\nparent ed79c31f0929059cb1933a52b0d6a154497fd206\nauthor David Wood <david@davidtw.co> 1533805096 +0200\ncommitter David Wood <david@davidtw.co> 1534237930 +0200\n\nNormalize test build directory and root build directory.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "html_url": "https://github.com/rust-lang/rust/commit/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed79c31f0929059cb1933a52b0d6a154497fd206", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed79c31f0929059cb1933a52b0d6a154497fd206", "html_url": "https://github.com/rust-lang/rust/commit/ed79c31f0929059cb1933a52b0d6a154497fd206"}], "stats": {"total": 25, "additions": 17, "deletions": 8}, "files": [{"sha": "fb5321eebf8bb8275ca8bdeb682d63d6ff96ca57", "filename": "src/test/ui/crateresolve1.nll.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fcrateresolve1.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fcrateresolve1.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcrateresolve1.nll.stderr?ref=2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "patch": "@@ -5,9 +5,9 @@ LL | extern crate crateresolve1;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: candidates:\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1.nll/auxiliary/libcrateresolve1-3.so\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1.nll/auxiliary/libcrateresolve1-1.so\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1.nll/auxiliary/libcrateresolve1-2.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1.nll/auxiliary/libcrateresolve1-1.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1.nll/auxiliary/libcrateresolve1-2.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1.nll/auxiliary/libcrateresolve1-3.so\n \n error[E0463]: can't find crate for `crateresolve1`\n   --> $DIR/crateresolve1.rs:16:1"}, {"sha": "a1105475d097da598e62186e6505f3ce3e294fc1", "filename": "src/test/ui/crateresolve1.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fcrateresolve1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fcrateresolve1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcrateresolve1.stderr?ref=2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "patch": "@@ -5,9 +5,9 @@ LL | extern crate crateresolve1;\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: candidates:\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1/auxiliary/libcrateresolve1-3.so\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1/auxiliary/libcrateresolve1-1.so\n-           crate `crateresolve1`: /home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/crateresolve1/auxiliary/libcrateresolve1-2.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1/auxiliary/libcrateresolve1-1.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1/auxiliary/libcrateresolve1-2.so\n+           crate `crateresolve1`: $TEST_BUILD_DIR/crateresolve1/auxiliary/libcrateresolve1-3.so\n \n error[E0463]: can't find crate for `crateresolve1`\n   --> $DIR/crateresolve1.rs:16:1"}, {"sha": "c82dbf99f93868a2780f217547452ac3abfe431f", "filename": "src/test/ui/nolink-with-link-args.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnolink-with-link-args.nll.stderr?ref=2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "patch": "@@ -1,6 +1,6 @@\n error: linking with `ld` failed: exit code: 1\n    |\n-   = note: \"ld\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args.nll/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args.nll/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args.nll/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args.nll/auxiliary\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n+   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args.nll/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n    = note: ld: unrecognized option '-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n            ld: use the --help option for usage information\n            "}, {"sha": "cdc1d24c527fed8c9ec03da9dca8fd29235c6392", "filename": "src/test/ui/nolink-with-link-args.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnolink-with-link-args.stderr?ref=2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "patch": "@@ -1,6 +1,6 @@\n error: linking with `ld` failed: exit code: 1\n    |\n-   = note: \"ld\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/test/ui/nolink-with-link-args/auxiliary\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"/home/david/projects/rust/workdirs/rust1/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n+   = note: \"ld\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args0-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a.nolink_with_link_args1-317d481089b8c8fe83113de504472633.rs.rcgu.o\" \"-o\" \"$TEST_BUILD_DIR/nolink-with-link-args/a\" \"--gc-sections\" \"-pie\" \"-zrelro\" \"-znow\" \"-O1\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"$TEST_BUILD_DIR/nolink-with-link-args/auxiliary\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--start-group\" \"-L\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-41f43a30bc296e4f\" \"--end-group\" \"-Bstatic\" \"$BUILD_DIR/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-ce73107aecc35a63.rlib\" \"-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-rpath,/home/david/projects/rust/workdirs/rust1/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\" \"aFdEfSeVEEE\"\n    = note: ld: unrecognized option '-Wl,-rpath,$ORIGIN/../../../stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n            ld: use the --help option for usage information\n            "}, {"sha": "af2108d7b88e132942ca8fab9999de5505c955f3", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=2ad663c1cd7ac8df9eea010cb0f3f40ed6d8707a", "patch": "@@ -2918,6 +2918,15 @@ impl<'test> TestCx<'test> {\n         };\n         normalized = normalized.replace(&src_dir_str, \"$SRC_DIR\");\n \n+        // Paths into the build directory\n+        let test_build_dir = &self.config.build_base;\n+        let parent_build_dir = test_build_dir.parent().unwrap().parent().unwrap().parent().unwrap();\n+\n+        // eg. /home/user/rust/build/x86_64-unknown-linux-gnu/test/ui\n+        normalized = normalized.replace(test_build_dir.to_str().unwrap(), \"$TEST_BUILD_DIR\");\n+        // eg. /home/user/rust/build\n+        normalized = normalized.replace(&parent_build_dir.to_str().unwrap(), \"$BUILD_DIR\");\n+\n         if json {\n             // escaped newlines in json strings should be readable\n             // in the stderr files. There's no point int being correct,"}]}