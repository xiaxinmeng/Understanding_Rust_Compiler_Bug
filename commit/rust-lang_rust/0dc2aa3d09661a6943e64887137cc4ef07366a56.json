{"sha": "0dc2aa3d09661a6943e64887137cc4ef07366a56", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYzJhYTNkMDk2NjFhNjk0M2U2NDg4NzEzN2NjNGVmMDczNjZhNTY=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-28T18:18:25Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-28T18:18:34Z"}, "message": "Bit more work on mingw cross. Pending on other changes now (test combination, build artifact locations)", "tree": {"sha": "c6993b7bb791a4a61b32a68eec884f8dfe82f19d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6993b7bb791a4a61b32a68eec884f8dfe82f19d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0dc2aa3d09661a6943e64887137cc4ef07366a56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0dc2aa3d09661a6943e64887137cc4ef07366a56", "html_url": "https://github.com/rust-lang/rust/commit/0dc2aa3d09661a6943e64887137cc4ef07366a56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0dc2aa3d09661a6943e64887137cc4ef07366a56/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ebcab711d76bf903f5c3d61e3419e064496bac0", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ebcab711d76bf903f5c3d61e3419e064496bac0", "html_url": "https://github.com/rust-lang/rust/commit/8ebcab711d76bf903f5c3d61e3419e064496bac0"}], "stats": {"total": 53, "additions": 26, "deletions": 27}, "files": [{"sha": "a6dcd003d366cc1d27919143a8cd974379571653", "filename": "Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0dc2aa3d09661a6943e64887137cc4ef07366a56/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/0dc2aa3d09661a6943e64887137cc4ef07366a56/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=0dc2aa3d09661a6943e64887137cc4ef07366a56", "patch": "@@ -166,6 +166,7 @@ SREQ2 := stage2/rustc$(X) $(LREQ) rt/main.o stage2/glue.o \\\n export CFG_SRC_DIR\n export CFG_VERSION\n export CFG_LLVM_ROOT\n+export CFG_ENABLE_MINGW_CROSS\n \n ######################################################################\n # Subprograms"}, {"sha": "84fcf0705c334518bb8b8b77213d067e1814f4cd", "filename": "mk/platform.mk", "status": "modified", "additions": 24, "deletions": 26, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/0dc2aa3d09661a6943e64887137cc4ef07366a56/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0dc2aa3d09661a6943e64887137cc4ef07366a56/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=0dc2aa3d09661a6943e64887137cc4ef07366a56", "patch": "@@ -74,24 +74,6 @@ CFG_TESTLIB=$(CFG_BUILD_DIR)/$(strip     \\\n                stage2/lib,                   \\\n                ))))\n \n-ifdef CFG_WINDOWSY\n-  CFG_INFO := $(info cfg: windows-y environment)\n-\n-  CFG_EXE_SUFFIX := .exe\n-  CFG_LIB_NAME=$(1).dll\n-  CFG_LDPATH :=$(CFG_LDPATH):$(CFG_LLVM_BINDIR)\n-  CFG_LDPATH :=$(CFG_LDPATH):$$PATH\n-  CFG_RUN_TEST=PATH=\"$(CFG_LDPATH):$(call CFG_TESTLIB,$(1))\" $(1)\n-  CFG_RUN_TARG=PATH=\"$(CFG_BUILD_DIR)/$(1)/lib:$(CFG_LDPATH)\" $(2)\n-\n-  CFG_PATH_MUNGE := $(strip perl -i.bak -p             \\\n-                           -e 's@\\\\(\\S)@/\\1@go;'       \\\n-                           -e 's@^/([a-zA-Z])/@\\1:/@o;')\n-  CFG_GCCISH_CFLAGS += -march=i686 -O2\n-  CFG_GCCISH_LINK_FLAGS += -shared -fPIC\n-  CFG_DEF_SUFFIX := .def\n-endif\n-\n ifdef CFG_UNIXY\n   CFG_INFO := $(info cfg: unix-y environment)\n \n@@ -104,21 +86,14 @@ ifdef CFG_UNIXY\n       $(CFG_VALGRIND) $(1)\n \n   ifdef CFG_ENABLE_MINGW_CROSS\n-    CFG_EXE_SUFFIX := .exe\n-    CFG_LIB_NAME=$(1).dll\n-    CFG_DEF_SUFFIX := .def\n-    CFG_LDPATH :=$(CFG_LDPATH):$(CFG_LLVM_BINDIR)\n-    CFG_LDPATH :=$(CFG_LDPATH):$$PATH\n-    CFG_RUN_TARG=PATH=$(CFG_BUILD_DIR)/$(1)/lib:$(CFG_LDPATH) $(2)\n-    CFG_RUN_TEST=PATH=$(CFG_LDPATH):$(call CFG_TESTLIB,$(1)) $(1)\n     CFG_WINDOWSY := 1\n     CFG_INFO := $(info cfg: mingw-cross)\n     CFG_GCCISH_CROSS := i586-mingw32msvc-\n     ifdef CFG_VALGRIND\n       CFG_VALGRIND += wine\n     endif\n \n-    CFG_GCCISH_CFLAGS := -fno-strict-aliasing -march=i686 -O2\n+    CFG_GCCISH_CFLAGS := -fno-strict-aliasing -march=i586 -O2\n     CFG_GCCISH_PRE_LIB_FLAGS :=\n     CFG_GCCISH_POST_LIB_FLAGS :=\n     CFG_GCCISH_DEF_FLAG :=\n@@ -136,6 +111,29 @@ ifdef CFG_UNIXY\n   endif\n endif\n \n+\n+ifdef CFG_WINDOWSY\n+  CFG_INFO := $(info cfg: windows-y environment)\n+\n+  CFG_EXE_SUFFIX := .exe\n+  CFG_LIB_NAME=$(1).dll\n+  CFG_DEF_SUFFIX := .def\n+  CFG_LDPATH :=$(CFG_LDPATH):$(CFG_LLVM_BINDIR)\n+  CFG_LDPATH :=$(CFG_LDPATH):$$PATH\n+  CFG_RUN_TEST=PATH=\"$(CFG_LDPATH):$(call CFG_TESTLIB,$(1))\" $(1)\n+  CFG_RUN_TARG=PATH=\"$(CFG_BUILD_DIR)/$(1)/lib:$(CFG_LDPATH)\" $(2)\n+\n+  ifndef CFG_ENABLE_MINGW_CROSS\n+    CFG_PATH_MUNGE := $(strip perl -i.bak -p             \\\n+                             -e 's@\\\\(\\S)@/\\1@go;'       \\\n+                             -e 's@^/([a-zA-Z])/@\\1:/@o;')\n+    CFG_GCCISH_CFLAGS += -march=i686 -O2\n+    CFG_GCCISH_LINK_FLAGS += -shared -fPIC\n+  endif\n+\n+endif\n+\n+\n ifdef CFG_CLANG\n   CFG_INFO := $(info cfg: using clang)\n   CFG_GCCISH_CFLAGS += -Wall -Werror -fno-rtti -fno-exceptions -g"}, {"sha": "3922d7314f7b2c00b91fc15657dd6fdacaba044b", "filename": "src/etc/snapshot.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0dc2aa3d09661a6943e64887137cc4ef07366a56/src%2Fetc%2Fsnapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/0dc2aa3d09661a6943e64887137cc4ef07366a56/src%2Fetc%2Fsnapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fsnapshot.py?ref=0dc2aa3d09661a6943e64887137cc4ef07366a56", "patch": "@@ -52,7 +52,7 @@ def full_snapshot_name(date, rev, platform, hsh):\n \n \n def get_kernel():\n-    if os.name == \"nt\":\n+    if os.name == \"nt\" or scrub(os.getenv(\"CFG_ENABLE_MINGW_CROSS\")):\n         return \"winnt\"\n     kernel = os.uname()[0].lower()\n     if kernel == \"darwin\":"}]}