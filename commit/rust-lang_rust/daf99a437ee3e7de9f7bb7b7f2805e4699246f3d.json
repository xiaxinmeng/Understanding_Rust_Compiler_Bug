{"sha": "daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "node_id": "C_kwDOAAsO6NoAKGRhZjk5YTQzN2VlM2U3ZGU5ZjdiYjdiN2YyODA1ZTQ2OTkyNDZmM2Q", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn.nelson@redjack.com", "date": "2023-03-01T16:47:33Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn.nelson@redjack.com", "date": "2023-03-01T16:49:28Z"}, "message": "Remove `llvm.skip-rebuild` option\n\nThis was added to in 2019 to speed up rebuild times when LLVM was\nmodified. Now that download-ci-llvm exists, I don't think it makes sense\nto support an unsound option like this that can lead to miscompiles; and\nthe code cleanup is nice too.", "tree": {"sha": "d9fd4ed8c3422009a3fff0fd5c970b998cad5bac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9fd4ed8c3422009a3fff0fd5c970b998cad5bac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "html_url": "https://github.com/rust-lang/rust/commit/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6209e6c5983f93526da54db1b66beb3f1d658437", "url": "https://api.github.com/repos/rust-lang/rust/commits/6209e6c5983f93526da54db1b66beb3f1d658437", "html_url": "https://github.com/rust-lang/rust/commit/6209e6c5983f93526da54db1b66beb3f1d658437"}], "stats": {"total": 38, "additions": 0, "deletions": 38}, "files": [{"sha": "c19a1da1b8331c021c90431bb6632a271c53ab4b", "filename": "config.toml.example", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "patch": "@@ -46,12 +46,6 @@ changelog-seen = 2\n # Defaults to \"if-available\" when `channel = \"dev\"` and \"false\" otherwise.\n #download-ci-llvm = \"if-available\"\n \n-# Indicates whether LLVM rebuild should be skipped when running bootstrap. If\n-# this is `false` then the compiler's LLVM will be rebuilt whenever the built\n-# version doesn't have the correct hash. If it is `true` then LLVM will never\n-# be rebuilt. The default value is `false`.\n-#skip-rebuild = false\n-\n # Indicates whether the LLVM build is a Release or Debug build\n #optimize = true\n "}, {"sha": "e544039c14fdd1adbb7d239f1d930f8e94ee4868", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "patch": "@@ -111,7 +111,6 @@ pub struct Config {\n     pub backtrace_on_ice: bool,\n \n     // llvm codegen options\n-    pub llvm_skip_rebuild: bool,\n     pub llvm_assertions: bool,\n     pub llvm_tests: bool,\n     pub llvm_plugins: bool,\n@@ -664,7 +663,6 @@ define_config! {\n define_config! {\n     /// TOML representation of how the LLVM build is configured.\n     struct Llvm {\n-        skip_rebuild: Option<bool> = \"skip-rebuild\",\n         optimize: Option<bool> = \"optimize\",\n         thin_lto: Option<bool> = \"thin-lto\",\n         release_debuginfo: Option<bool> = \"release-debuginfo\",\n@@ -1057,11 +1055,6 @@ impl Config {\n             config.mandir = install.mandir.map(PathBuf::from);\n         }\n \n-        // We want the llvm-skip-rebuild flag to take precedence over the\n-        // skip-rebuild config.toml option so we store it separately\n-        // so that we can infer the right value\n-        let mut llvm_skip_rebuild = flags.llvm_skip_rebuild;\n-\n         // Store off these values as options because if they're not provided\n         // we'll infer default values for them later\n         let mut llvm_assertions = None;\n@@ -1166,7 +1159,6 @@ impl Config {\n             llvm_assertions = llvm.assertions;\n             llvm_tests = llvm.tests;\n             llvm_plugins = llvm.plugins;\n-            llvm_skip_rebuild = llvm_skip_rebuild.or(llvm.skip_rebuild);\n             set(&mut config.llvm_optimize, llvm.optimize);\n             set(&mut config.llvm_thin_lto, llvm.thin_lto);\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);\n@@ -1329,7 +1321,6 @@ impl Config {\n         // Now that we've reached the end of our configuration, infer the\n         // default values for all options that we haven't otherwise stored yet.\n \n-        config.llvm_skip_rebuild = llvm_skip_rebuild.unwrap_or(false);\n         config.llvm_assertions = llvm_assertions.unwrap_or(false);\n         config.llvm_tests = llvm_tests.unwrap_or(false);\n         config.llvm_plugins = llvm_plugins.unwrap_or(false);"}, {"sha": "448f4f000b52d683267b314b666a20e5f7ec83bd", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "patch": "@@ -67,8 +67,6 @@ pub struct Flags {\n     // true => deny, false => warn\n     pub deny_warnings: Option<bool>,\n \n-    pub llvm_skip_rebuild: Option<bool>,\n-\n     pub rust_profile_use: Option<String>,\n     pub rust_profile_generate: Option<String>,\n \n@@ -249,14 +247,6 @@ To learn more about a subcommand, run `./x.py <subcommand> -h`\",\n         opts.optopt(\"\", \"error-format\", \"rustc error format\", \"FORMAT\");\n         opts.optflag(\"\", \"json-output\", \"use message-format=json\");\n         opts.optopt(\"\", \"color\", \"whether to use color in cargo and rustc output\", \"STYLE\");\n-        opts.optopt(\n-            \"\",\n-            \"llvm-skip-rebuild\",\n-            \"whether rebuilding llvm should be skipped \\\n-             a VALUE of TRUE indicates that llvm will not be rebuilt \\\n-             VALUE overrides the skip-rebuild option in config.toml.\",\n-            \"VALUE\",\n-        );\n         opts.optopt(\n             \"\",\n             \"rust-profile-generate\",\n@@ -707,9 +697,6 @@ Arguments:\n                 .collect::<Vec<_>>(),\n             include_default_paths: matches.opt_present(\"include-default-paths\"),\n             deny_warnings: parse_deny_warnings(&matches),\n-            llvm_skip_rebuild: matches.opt_str(\"llvm-skip-rebuild\").map(|s| s.to_lowercase()).map(\n-                |s| s.parse::<bool>().expect(\"`llvm-skip-rebuild` should be either true or false\"),\n-            ),\n             color: matches\n                 .opt_get_default(\"color\", Color::Auto)\n                 .expect(\"`color` should be `always`, `never`, or `auto`\"),"}, {"sha": "fb1ed40bc53f1f70cbb1731f24b5728fcb28daea", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "patch": "@@ -109,15 +109,6 @@ pub fn prebuilt_llvm_config(\n     let stamp = out_dir.join(\"llvm-finished-building\");\n     let stamp = HashStamp::new(stamp, builder.in_tree_llvm_info.sha());\n \n-    if builder.config.llvm_skip_rebuild && stamp.path.exists() {\n-        builder.info(\n-            \"Warning: \\\n-                Using a potentially stale build of LLVM; \\\n-                This may not behave well.\",\n-        );\n-        return Ok(res);\n-    }\n-\n     if stamp.is_done() {\n         if stamp.hash.is_none() {\n             builder.info("}, {"sha": "32d3440f1dc989f8bde6ad5a895a2c38f26c91da", "filename": "src/doc/rustc/src/platform-support/armeb-unknown-linux-gnueabi.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmeb-unknown-linux-gnueabi.md", "raw_url": "https://github.com/rust-lang/rust/raw/daf99a437ee3e7de9f7bb7b7f2805e4699246f3d/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmeb-unknown-linux-gnueabi.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Farmeb-unknown-linux-gnueabi.md?ref=daf99a437ee3e7de9f7bb7b7f2805e4699246f3d", "patch": "@@ -26,7 +26,6 @@ Therefore, you can build Rust with support for the target by adding it to the ta\n ```toml\n [llvm]\n download-ci-llvm = false\n-skip-rebuild = true\n optimize = true\n ninja = true\n targets = \"ARM;X86\""}]}