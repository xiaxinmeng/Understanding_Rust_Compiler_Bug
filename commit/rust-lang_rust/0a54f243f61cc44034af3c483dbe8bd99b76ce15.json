{"sha": "0a54f243f61cc44034af3c483dbe8bd99b76ce15", "node_id": "C_kwDOAAsO6NoAKDBhNTRmMjQzZjYxY2M0NDAzNGFmM2M0ODNkYmU4YmQ5OWI3NmNlMTU", "commit": {"author": {"name": "antoyo", "email": "antoyo@users.noreply.github.com", "date": "2022-11-25T20:12:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-25T20:12:29Z"}, "message": "Merge pull request #225 from rust-lang/feature/stdarch-tests\n\nRun stdarch tests in the CI", "tree": {"sha": "eb1285e178c219347828331080691018eb648d13", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb1285e178c219347828331080691018eb648d13"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a54f243f61cc44034af3c483dbe8bd99b76ce15", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjgSGtCRBK7hj4Ov3rIwAAzb0IACbo060HIN3RHFGapOLUmR+L\nOJ+fYxQWlK8nYPrIi/h8j1V710Ae8MUdlcKpnmIBmR6Bwz65i5g86IytCcU6PtDh\neF9Vy8cGntBGzYzaPtAHGs7FD3Z7PGE0iya7heNJpp3DLc2bz7ReNDADixsF1PQC\nByOoqy4t3M/T3QrIk9GCIpnbn+oQR6/YcbE8RLtqAzNztNq+6q612CMacZbHJqcC\nCxFb936xBy4noPnuGiAPzc5Z1EO3SVxr1d8IL6ucss/L3Rsuxvw56L/znVRl8kIv\nYi8MJcI4J0aurVGfBoclk5LEcQPPi3UCpV22bYaEOd5KBQfws6BtxNowmMqm4aE=\n=JfCc\n-----END PGP SIGNATURE-----\n", "payload": "tree eb1285e178c219347828331080691018eb648d13\nparent 8520bc7f9f1d9bf5f5418e35fa8e4b3c9626e9c2\nparent 054696e4a3c8e91ed5e880f41a0c42632d8b19b7\nauthor antoyo <antoyo@users.noreply.github.com> 1669407149 -0500\ncommitter GitHub <noreply@github.com> 1669407149 -0500\n\nMerge pull request #225 from rust-lang/feature/stdarch-tests\n\nRun stdarch tests in the CI"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a54f243f61cc44034af3c483dbe8bd99b76ce15", "html_url": "https://github.com/rust-lang/rust/commit/0a54f243f61cc44034af3c483dbe8bd99b76ce15", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a54f243f61cc44034af3c483dbe8bd99b76ce15/comments", "author": {"login": "antoyo", "id": 584972, "node_id": "MDQ6VXNlcjU4NDk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/584972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoyo", "html_url": "https://github.com/antoyo", "followers_url": "https://api.github.com/users/antoyo/followers", "following_url": "https://api.github.com/users/antoyo/following{/other_user}", "gists_url": "https://api.github.com/users/antoyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoyo/subscriptions", "organizations_url": "https://api.github.com/users/antoyo/orgs", "repos_url": "https://api.github.com/users/antoyo/repos", "events_url": "https://api.github.com/users/antoyo/events{/privacy}", "received_events_url": "https://api.github.com/users/antoyo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8520bc7f9f1d9bf5f5418e35fa8e4b3c9626e9c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/8520bc7f9f1d9bf5f5418e35fa8e4b3c9626e9c2", "html_url": "https://github.com/rust-lang/rust/commit/8520bc7f9f1d9bf5f5418e35fa8e4b3c9626e9c2"}, {"sha": "054696e4a3c8e91ed5e880f41a0c42632d8b19b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/054696e4a3c8e91ed5e880f41a0c42632d8b19b7", "html_url": "https://github.com/rust-lang/rust/commit/054696e4a3c8e91ed5e880f41a0c42632d8b19b7"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "2e81442298c60f8c71cfd04a6564cf4bdc40ce11", "filename": ".github/workflows/release.yml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0a54f243f61cc44034af3c483dbe8bd99b76ce15/.github%2Fworkflows%2Frelease.yml", "raw_url": "https://github.com/rust-lang/rust/raw/0a54f243f61cc44034af3c483dbe8bd99b76ce15/.github%2Fworkflows%2Frelease.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Frelease.yml?ref=0a54f243f61cc44034af3c483dbe8bd99b76ce15", "patch": "@@ -105,3 +105,8 @@ jobs:\n     - name: Run tests\n       run: |\n         ./test.sh --release --clean --release-sysroot --build-sysroot --mini-tests --std-tests # --test-libcore # FIXME(antoyo): libcore tests fail.\n+\n+    - name: Run stdarch tests\n+      run: |\n+        cd build_sysroot/sysroot_src/library/stdarch/\n+        CHANNEL=release TARGET=x86_64-unknown-linux-gnu ../../../../cargo.sh test"}, {"sha": "1b71df1ca8df2c4ef5eb86cf408c1574f7277d54", "filename": "patches/0001-Disable-examples.patch", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/0a54f243f61cc44034af3c483dbe8bd99b76ce15/patches%2F0001-Disable-examples.patch", "raw_url": "https://github.com/rust-lang/rust/raw/0a54f243f61cc44034af3c483dbe8bd99b76ce15/patches%2F0001-Disable-examples.patch", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/patches%2F0001-Disable-examples.patch?ref=0a54f243f61cc44034af3c483dbe8bd99b76ce15", "patch": "@@ -0,0 +1,25 @@\n+From a2d53a324a02c04b76c0e9d39dc15cd443a3b8b2 Mon Sep 17 00:00:00 2001\n+From: Antoni Boucher <bouanto@zoho.com>\n+Date: Fri, 25 Nov 2022 11:18:11 -0500\n+Subject: [PATCH] Disable examples\n+\n+---\n+ library/stdarch/Cargo.toml | 2 +-\n+ 1 file changed, 1 insertion(+), 1 deletion(-)\n+\n+diff --git a/library/stdarch/Cargo.toml b/library/stdarch/Cargo.toml\n+index fbe0a95..748d72d 100644\n+--- a/library/stdarch/Cargo.toml\n++++ b/library/stdarch/Cargo.toml\n+@@ -3,7 +3,7 @@ members = [\n+   \"crates/core_arch\",\n+   \"crates/std_detect\",\n+   \"crates/stdarch-gen\",\n+-  \"examples/\"\n++  #\"examples/\"\n+ ]\n+ exclude = [\n+   \"crates/wasm-assert-instr-tests\"\n+-- \n+2.26.2.7.g19db9cfb68.dirty\n+"}, {"sha": "ed3daddf43e9ebfb58146adbbfe2a1ac1499e0c3", "filename": "src/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0a54f243f61cc44034af3c483dbe8bd99b76ce15/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a54f243f61cc44034af3c483dbe8bd99b76ce15/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=0a54f243f61cc44034af3c483dbe8bd99b76ce15", "patch": "@@ -101,7 +101,7 @@ pub fn compile_codegen_unit<'tcx>(tcx: TyCtxt<'tcx>, cgu_name: Symbol, supports_\n         context.add_command_line_option(\"-m64\");\n         context.add_command_line_option(\"-mbmi\");\n         context.add_command_line_option(\"-mgfni\");\n-        context.add_command_line_option(\"-mavxvnni\");\n+        //context.add_command_line_option(\"-mavxvnni\"); // The CI doesn't support this option.\n         context.add_command_line_option(\"-mf16c\");\n         context.add_command_line_option(\"-maes\");\n         context.add_command_line_option(\"-mxsavec\");"}, {"sha": "e52ee4818f3e3fc590bb957624b6b69aac44339b", "filename": "src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0a54f243f61cc44034af3c483dbe8bd99b76ce15/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a54f243f61cc44034af3c483dbe8bd99b76ce15/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=0a54f243f61cc44034af3c483dbe8bd99b76ce15", "patch": "@@ -316,7 +316,8 @@ pub fn target_features(sess: &Session, allow_unstable: bool) -> Vec<Symbol> {\n             // gcc -march=native -Q --help=target\n             #[cfg(feature=\"master\")]\n             {\n-                (_feature.contains(\"sse\") || _feature.contains(\"avx\")) && !_feature.contains(\"avx512\")\n+                // NOTE: the CPU in the CI doesn't support sse4a, so disable it to make the stdarch tests pass in the CI.\n+                (_feature.contains(\"sse\") || _feature.contains(\"avx\")) && !_feature.contains(\"avx512\") && !_feature.contains(\"sse4a\")\n             }\n             #[cfg(not(feature=\"master\"))]\n             {"}]}