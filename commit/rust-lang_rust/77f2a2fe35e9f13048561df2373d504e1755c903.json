{"sha": "77f2a2fe35e9f13048561df2373d504e1755c903", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3ZjJhMmZlMzVlOWYxMzA0ODU2MWRmMjM3M2Q1MDRlMTc1NWM5MDM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-08-23T23:51:41Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-08-23T23:51:41Z"}, "message": "Turn the error for module-relative access to macro-expanded `macro_export` macros into a deprecation lint", "tree": {"sha": "43de32476ecc82568602fbdfd2eb7dfd6b0d9d0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43de32476ecc82568602fbdfd2eb7dfd6b0d9d0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77f2a2fe35e9f13048561df2373d504e1755c903", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77f2a2fe35e9f13048561df2373d504e1755c903", "html_url": "https://github.com/rust-lang/rust/commit/77f2a2fe35e9f13048561df2373d504e1755c903", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77f2a2fe35e9f13048561df2373d504e1755c903/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a8b7268112e262bc1f3f08a0f489199fc9a9eb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a8b7268112e262bc1f3f08a0f489199fc9a9eb6", "html_url": "https://github.com/rust-lang/rust/commit/7a8b7268112e262bc1f3f08a0f489199fc9a9eb6"}], "stats": {"total": 37, "additions": 32, "deletions": 5}, "files": [{"sha": "6783415619f983c1bdd3b0808d913b69c2cb1a72", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=77f2a2fe35e9f13048561df2373d504e1755c903", "patch": "@@ -331,6 +331,13 @@ declare_lint! {\n      via the module system\"\n }\n \n+declare_lint! {\n+    pub MACRO_EXPANDED_MACRO_EXPORTS_ACCESSED_BY_ABSOLUTE_PATHS,\n+    Deny,\n+    \"macro-expanded `macro_export` macros from the current crate \\\n+     cannot be referred to by absolute paths\"\n+}\n+\n /// Some lints that are buffered from `libsyntax`. See `syntax::early_buffered_lints`.\n pub mod parser {\n     declare_lint! {\n@@ -398,6 +405,7 @@ impl LintPass for HardwiredLints {\n             WHERE_CLAUSES_OBJECT_SAFETY,\n             PROC_MACRO_DERIVE_RESOLUTION_FALLBACK,\n             MACRO_USE_EXTERN_CRATE,\n+            MACRO_EXPANDED_MACRO_EXPORTS_ACCESSED_BY_ABSOLUTE_PATHS,\n             parser::QUESTION_MARK_MACRO_SEP,\n         )\n     }\n@@ -412,6 +420,7 @@ pub enum BuiltinLintDiagnostics {\n     AbsPathWithModule(Span),\n     DuplicatedMacroExports(ast::Ident, Span, Span),\n     ProcMacroDeriveResolutionFallback(Span),\n+    MacroExpandedMacroExportsAccessedByAbsolutePaths(Span),\n     ElidedLifetimesInPaths(usize, Span, bool, Span, String),\n }\n \n@@ -453,6 +462,9 @@ impl BuiltinLintDiagnostics {\n                 db.span_label(span, \"names from parent modules are not \\\n                                      accessible without an explicit import\");\n             }\n+            BuiltinLintDiagnostics::MacroExpandedMacroExportsAccessedByAbsolutePaths(span_def) => {\n+                db.span_note(span_def, \"the macro is defined here\");\n+            }\n             BuiltinLintDiagnostics::ElidedLifetimesInPaths(\n                 n, path_span, incl_angl_brckt, insertion_span, anon_lts\n             ) => {"}, {"sha": "7d802787105d19fd6a71fd39a3e4d557d0643835", "filename": "src/librustc_lint/lib.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc_lint%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc_lint%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Flib.rs?ref=77f2a2fe35e9f13048561df2373d504e1755c903", "patch": "@@ -334,7 +334,12 @@ pub fn register_builtins(store: &mut lint::LintStore, sess: Option<&Session>) {\n             id: LintId::of(QUESTION_MARK_MACRO_SEP),\n             reference: \"issue #48075 <https://github.com/rust-lang/rust/issues/48075>\",\n             edition: Some(Edition::Edition2018),\n-        }\n+        },\n+        FutureIncompatibleInfo {\n+            id: LintId::of(MACRO_EXPANDED_MACRO_EXPORTS_ACCESSED_BY_ABSOLUTE_PATHS),\n+            reference: \"issue #52234 <https://github.com/rust-lang/rust/issues/52234>\",\n+            edition: None,\n+        },\n         ]);\n \n     // Register renamed and removed lints"}, {"sha": "264f5c01135815a8cd0a08d3885c83cafe95181f", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=77f2a2fe35e9f13048561df2373d504e1755c903", "patch": "@@ -4477,9 +4477,12 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n         for &(span_use, span_def) in &self.macro_expanded_macro_export_errors {\n             let msg = \"macro-expanded `macro_export` macros from the current crate \\\n                        cannot be referred to by absolute paths\";\n-            self.session.struct_span_err(span_use, msg)\n-                        .span_note(span_def, \"the macro is defined here\")\n-                        .emit();\n+            self.session.buffer_lint_with_diagnostic(\n+                lint::builtin::MACRO_EXPANDED_MACRO_EXPORTS_ACCESSED_BY_ABSOLUTE_PATHS,\n+                CRATE_NODE_ID, span_use, msg,\n+                lint::builtin::BuiltinLintDiagnostics::\n+                    MacroExpandedMacroExportsAccessedByAbsolutePaths(span_def),\n+            );\n         }\n \n         for &AmbiguityError { span, name, b1, b2, lexical } in &self.ambiguity_errors {"}, {"sha": "1cd7cc56a400d062b8c4340c04fad22ae4e4ae34", "filename": "src/test/ui/imports/local-modularized-tricky-fail-3.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.rs?ref=77f2a2fe35e9f13048561df2373d504e1755c903", "patch": "@@ -22,9 +22,11 @@ define_exported!();\n mod m {\n     use exported;\n     //~^ ERROR macro-expanded `macro_export` macros from the current crate cannot\n+    //~| WARN this was previously accepted\n }\n \n fn main() {\n     ::exported!();\n     //~^ ERROR macro-expanded `macro_export` macros from the current crate cannot\n+    //~| WARN this was previously accepted\n }"}, {"sha": "6c5c789e5ee8008ef37aa5c4671f13832027af75", "filename": "src/test/ui/imports/local-modularized-tricky-fail-3.stderr", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/77f2a2fe35e9f13048561df2373d504e1755c903/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Flocal-modularized-tricky-fail-3.stderr?ref=77f2a2fe35e9f13048561df2373d504e1755c903", "patch": "@@ -4,6 +4,9 @@ error: macro-expanded `macro_export` macros from the current crate cannot be ref\n LL |     use exported;\n    |         ^^^^^^^^\n    |\n+   = note: #[deny(macro_expanded_macro_exports_accessed_by_absolute_paths)] on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #52234 <https://github.com/rust-lang/rust/issues/52234>\n note: the macro is defined here\n   --> $DIR/local-modularized-tricky-fail-3.rs:15:5\n    |\n@@ -16,11 +19,13 @@ LL |   define_exported!();\n    |   ------------------- in this macro invocation\n \n error: macro-expanded `macro_export` macros from the current crate cannot be referred to by absolute paths\n-  --> $DIR/local-modularized-tricky-fail-3.rs:28:5\n+  --> $DIR/local-modularized-tricky-fail-3.rs:29:5\n    |\n LL |     ::exported!();\n    |     ^^^^^^^^^^\n    |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #52234 <https://github.com/rust-lang/rust/issues/52234>\n note: the macro is defined here\n   --> $DIR/local-modularized-tricky-fail-3.rs:15:5\n    |"}]}