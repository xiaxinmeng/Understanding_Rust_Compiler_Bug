{"sha": "90230ce3723f6e88f2f39e852a54837b80e59736", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwMjMwY2UzNzIzZjZlODhmMmYzOWU4NTJhNTQ4MzdiODBlNTk3MzY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-03-15T21:36:46Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-03-15T21:36:46Z"}, "message": "Rollup merge of #49050 - snf:fix_oom_asmjs, r=alexcrichton\n\nsetting ABORTING_MALLOC=0 for asmjs backend\n\nThis changes the behaviour of the allocator for asmjs backend.\nIt will return NULL on OOM instead of aborting and let Rust choose the behaviour.\nFixes #48968 and enables try_reserve (fallible allocation) in asmjs.", "tree": {"sha": "f1ce610a776eb3daf941c67e38d4c5f2c4cc49aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1ce610a776eb3daf941c67e38d4c5f2c4cc49aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90230ce3723f6e88f2f39e852a54837b80e59736", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlqq524ACgkQ/vbIBR0O\nATypXw/8C93giD8jJUCbUGMY+eYkqf6/r6Oyj6f2ja94YmIjDVLnlSxVDtXfd3ke\nvgidhwDbnZZDAF3xnIeqHcSPQeTpFDqkWsJVERCcPpg+5iPU6jpuOTd+3y+3WEW2\noQw89OAfgxPP8jZL3tRfYudtMjQcyAgYAj05YpHs6ZZVZ6+UdtsPKNrMLp/mcOJ4\navm+rDWKDRN/nMmGIxGR/Ccu5YThPFTLl1qWaP2xeDNxUi8qkd2m+FGBg9+V6BFI\n7xkXawL7IsOvwziMnzA/lNFjzSwHvoEKF6+u6B0vxgwQRWS7Z+rMPgdq+OCXNr/M\nowWVGyW1EmInkZEro3ltObElCTt3Nz0S4/DJLJhuLGITbAXABQi5s/aTFeY0haU3\nXmx9sCcsIKUxg+ZBTFtWBu8nn6QmcG7jqCNKzVCLXaoE91BGeAK24QP7zKmuitqc\n2P10vVeElLe1UhOchR7+1xv/mw+gwoNKiDBn1PwcIRi+rnyQ9fUcawhRlHn4mIWu\nQL3LnnydSPNrKemlZ5RKRKpXplnLfidb6zFH0kWYR5/ujfOMQuPBuWq6jRA9djDM\nx1KHQ+N8aQV+4F7vNTu1gR2JdQFrhDquJsa9NVboiQkYnQ584eNgk3J+8AWUshtJ\n3crr9WAeo0JDFWuxFsueNMceIgP/4ns/8PIXuvP4RI5M1b3Va7A=\n=J4IA\n-----END PGP SIGNATURE-----", "payload": "tree f1ce610a776eb3daf941c67e38d4c5f2c4cc49aa\nparent 55a0075a20ec064e7ec793656d564e13e9206836\nparent 9e64946bded0698c8c45d74526e6a8b5a514c4a1\nauthor kennytm <kennytm@gmail.com> 1521149806 +0800\ncommitter kennytm <kennytm@gmail.com> 1521149806 +0800\n\nRollup merge of #49050 - snf:fix_oom_asmjs, r=alexcrichton\n\nsetting ABORTING_MALLOC=0 for asmjs backend\n\nThis changes the behaviour of the allocator for asmjs backend.\nIt will return NULL on OOM instead of aborting and let Rust choose the behaviour.\nFixes #48968 and enables try_reserve (fallible allocation) in asmjs.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90230ce3723f6e88f2f39e852a54837b80e59736", "html_url": "https://github.com/rust-lang/rust/commit/90230ce3723f6e88f2f39e852a54837b80e59736", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90230ce3723f6e88f2f39e852a54837b80e59736/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "55a0075a20ec064e7ec793656d564e13e9206836", "url": "https://api.github.com/repos/rust-lang/rust/commits/55a0075a20ec064e7ec793656d564e13e9206836", "html_url": "https://github.com/rust-lang/rust/commit/55a0075a20ec064e7ec793656d564e13e9206836"}, {"sha": "9e64946bded0698c8c45d74526e6a8b5a514c4a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e64946bded0698c8c45d74526e6a8b5a514c4a1", "html_url": "https://github.com/rust-lang/rust/commit/9e64946bded0698c8c45d74526e6a8b5a514c4a1"}], "stats": {"total": 28, "additions": 5, "deletions": 23}, "files": [{"sha": "d1e746ea43b45516875e87f7d30f94f0e194556d", "filename": "src/liballoc/tests/string.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Fstring.rs?ref=90230ce3723f6e88f2f39e852a54837b80e59736", "patch": "@@ -9,11 +9,8 @@\n // except according to those terms.\n \n use std::borrow::Cow;\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::collections::CollectionAllocErr::*;\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::mem::size_of;\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::{usize, isize};\n \n pub trait IntoCow<'a, B: ?Sized> where B: ToOwned {\n@@ -535,7 +532,6 @@ fn test_reserve_exact() {\n     assert!(s.capacity() >= 33)\n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve() {\n \n@@ -613,7 +609,6 @@ fn test_try_reserve() {\n \n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve_exact() {\n "}, {"sha": "3c17a401bbaf5793b4d63486d8ad3121b879c0a5", "filename": "src/liballoc/tests/vec.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Fvec.rs?ref=90230ce3723f6e88f2f39e852a54837b80e59736", "patch": "@@ -10,11 +10,8 @@\n \n use std::borrow::Cow;\n use std::mem::size_of;\n-use std::{usize, panic};\n-#[cfg(not(target_arch = \"asmjs\"))]\n-use std::isize;\n+use std::{usize, isize, panic};\n use std::vec::{Drain, IntoIter};\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::collections::CollectionAllocErr::*;\n \n struct DropCounter<'a> {\n@@ -994,7 +991,6 @@ fn test_reserve_exact() {\n     assert!(v.capacity() >= 33)\n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve() {\n \n@@ -1097,7 +1093,6 @@ fn test_try_reserve() {\n \n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve_exact() {\n "}, {"sha": "fc1a0b624a555eebde59edf875a7f459074800bc", "filename": "src/liballoc/tests/vec_deque.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Fliballoc%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Fvec_deque.rs?ref=90230ce3723f6e88f2f39e852a54837b80e59736", "patch": "@@ -11,13 +11,9 @@\n use std::collections::VecDeque;\n use std::fmt::Debug;\n use std::collections::vec_deque::{Drain};\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::collections::CollectionAllocErr::*;\n-#[cfg(not(target_arch = \"asmjs\"))]\n use std::mem::size_of;\n-use std::isize;\n-#[cfg(not(target_arch = \"asmjs\"))]\n-use std::usize;\n+use std::{usize, isize};\n \n use self::Taggy::*;\n use self::Taggypar::*;\n@@ -1053,7 +1049,6 @@ fn test_reserve_exact_2() {\n     assert!(v.capacity() >= 48)\n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve() {\n \n@@ -1155,7 +1150,6 @@ fn test_try_reserve() {\n \n }\n \n-#[cfg(not(target_arch = \"asmjs\"))]\n #[test]\n fn test_try_reserve_exact() {\n "}, {"sha": "ab7df4ba1c543395b28c6b857c4a657997375685", "filename": "src/librustc_back/target/asmjs_unknown_emscripten.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Flibrustc_back%2Ftarget%2Fasmjs_unknown_emscripten.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Flibrustc_back%2Ftarget%2Fasmjs_unknown_emscripten.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fasmjs_unknown_emscripten.rs?ref=90230ce3723f6e88f2f39e852a54837b80e59736", "patch": "@@ -15,7 +15,9 @@ pub fn target() -> Result<Target, String> {\n     let mut args = LinkArgs::new();\n     args.insert(LinkerFlavor::Em,\n                 vec![\"-s\".to_string(),\n-                     \"ERROR_ON_UNDEFINED_SYMBOLS=1\".to_string()]);\n+                     \"ERROR_ON_UNDEFINED_SYMBOLS=1\".to_string(),\n+                     \"-s\".to_string(),\n+                     \"ABORTING_MALLOC=0\".to_string()]);\n \n     let opts = TargetOptions {\n         dynamic_linking: false,"}, {"sha": "b18b38ec302460e4eb1f0fd9c84739dfac9252a3", "filename": "src/libstd/collections/hash/map.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Flibstd%2Fcollections%2Fhash%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90230ce3723f6e88f2f39e852a54837b80e59736/src%2Flibstd%2Fcollections%2Fhash%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fcollections%2Fhash%2Fmap.rs?ref=90230ce3723f6e88f2f39e852a54837b80e59736", "patch": "@@ -2755,11 +2755,8 @@ mod test_map {\n     use cell::RefCell;\n     use rand::{thread_rng, Rng};\n     use panic;\n-    #[cfg(not(target_arch = \"asmjs\"))]\n     use realstd::collections::CollectionAllocErr::*;\n-    #[cfg(not(target_arch = \"asmjs\"))]\n     use realstd::mem::size_of;\n-    #[cfg(not(target_arch = \"asmjs\"))]\n     use realstd::usize;\n \n     #[test]\n@@ -3696,7 +3693,6 @@ mod test_map {\n         assert_eq!(hm.len(), 0);\n     }\n \n-    #[cfg(not(target_arch = \"asmjs\"))]\n     #[test]\n     fn test_try_reserve() {\n "}]}