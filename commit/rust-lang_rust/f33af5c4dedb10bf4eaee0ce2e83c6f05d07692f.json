{"sha": "f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzM2FmNWM0ZGVkYjEwYmY0ZWFlZTBjZTJlODNjNmYwNWQwNzY5MmY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-04-20T14:42:44Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-04-23T21:55:36Z"}, "message": "fix search bar bug", "tree": {"sha": "105905cb4686d7f1b6046778be1bb4543d25ecb9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/105905cb4686d7f1b6046778be1bb4543d25ecb9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "html_url": "https://github.com/rust-lang/rust/commit/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4640615ce740766cf57b014722603b0bd0fffec2", "url": "https://api.github.com/repos/rust-lang/rust/commits/4640615ce740766cf57b014722603b0bd0fffec2", "html_url": "https://github.com/rust-lang/rust/commit/4640615ce740766cf57b014722603b0bd0fffec2"}], "stats": {"total": 28, "additions": 18, "deletions": 10}, "files": [{"sha": "ef8bf2244d97763186352b7593fb50a3da93dd4a", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "patch": "@@ -1375,13 +1375,17 @@\n \n         function search(e) {\n             var params = getQueryStringParams();\n-            var query = getQuery(document.getElementsByClassName('search-input')[0].value.trim());\n+            var search_input = document.getElementsByClassName('search-input')[0];\n+            var query = getQuery(search_input.value.trim());\n \n             if (e) {\n                 e.preventDefault();\n             }\n \n             if (!query.query || query.id === currentResults) {\n+                if (query.query.length > 0) {\n+                    putBackSearch(search_input);\n+                }\n                 return;\n             }\n \n@@ -2072,19 +2076,23 @@\n         };\n     });\n \n+    function putBackSearch(search_input) {\n+        if (search_input.value !== \"\") {\n+            addClass(document.getElementById(\"main\"), \"hidden\");\n+            removeClass(document.getElementById(\"search\"), \"hidden\");\n+            if (browserSupportsHistoryApi()) {\n+                history.replaceState(search_input.value,\n+                                     \"\",\n+                                     \"?search=\" + encodeURIComponent(search_input.value));\n+            }\n+        }\n+    }\n+\n     var search_input = document.getElementsByClassName(\"search-input\")[0];\n \n     if (search_input) {\n         search_input.onfocus = function() {\n-            if (search_input.value !== \"\") {\n-                addClass(document.getElementById(\"main\"), \"hidden\");\n-                removeClass(document.getElementById(\"search\"), \"hidden\");\n-                if (browserSupportsHistoryApi()) {\n-                    history.replaceState(search_input.value,\n-                                         \"\",\n-                                         \"?search=\" + encodeURIComponent(search_input.value));\n-                }\n-            }\n+            putBackSearch(this);\n         };\n     }\n "}]}