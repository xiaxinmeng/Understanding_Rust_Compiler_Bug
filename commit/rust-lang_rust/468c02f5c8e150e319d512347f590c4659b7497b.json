{"sha": "468c02f5c8e150e319d512347f590c4659b7497b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ2OGMwMmY1YzhlMTUwZTMxOWQ1MTIzNDdmNTkwYzQ2NTliNzQ5N2I=", "commit": {"author": {"name": "Josh Stone", "email": "cuviper@gmail.com", "date": "2019-03-28T01:15:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-03-28T01:15:33Z"}, "message": "Rollup merge of #59420 - cuviper:ci-image-info, r=alexcrichton\n\n[CI] record docker image info for reuse\n\nThis writes an extra `dist/image-$image.txt` which contains the S3 URL\nof the cached image and the `sha256` digest of the docker entry point.\nThis will be uploaded with the rest of the deployed artifacts in the\nTravis `after_success` script.\n\ncc rust-lang/rustup.rs#1724\nr? @alexcrichton", "tree": {"sha": "14f2bbab185366bf93ec2b9ec6a211160f47f2eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14f2bbab185366bf93ec2b9ec6a211160f47f2eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/468c02f5c8e150e319d512347f590c4659b7497b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcnCA1CRBK7hj4Ov3rIwAAdHIIAK6e6ioStOhZdEC5pKVyV+H6\nWlSauadVy5H4vQj4k34IVYXVtEIRlegbiXEsmWMZyR3+7HHT4TInOY20IqK3Diht\nayf3LYymV+faDfwz5XAD3M0LmsGylkvUdSNfCnB4uSAtJpIPwNQ2Gy5aLBZk3pvg\n4btpLJ9h4UI9zd+3hWz2TCaI6nBXwIu6IB5kcL4MA88puBREmY+/rGW8M1naCIi4\n5ZwbKhiPT+YFF+FFyQof3fms8lofm2PFDqBfiF0eCrVQoimddvDkJheaFx4Mgy//\nKyGPfTQ4PdTyiBjNkmCNAhix8un/vPkrQ4Tk9mwKkOcXdEqP6q8PLQr+N2BXbGc=\n=cLmV\n-----END PGP SIGNATURE-----\n", "payload": "tree 14f2bbab185366bf93ec2b9ec6a211160f47f2eb\nparent 413aaf3227be873d11aa47243489ea84b09c1500\nparent 9e663032a1d8697ddde7e0e51e632e8565772265\nauthor Josh Stone <cuviper@gmail.com> 1553735733 -0700\ncommitter GitHub <noreply@github.com> 1553735733 -0700\n\nRollup merge of #59420 - cuviper:ci-image-info, r=alexcrichton\n\n[CI] record docker image info for reuse\n\nThis writes an extra `dist/image-$image.txt` which contains the S3 URL\nof the cached image and the `sha256` digest of the docker entry point.\nThis will be uploaded with the rest of the deployed artifacts in the\nTravis `after_success` script.\n\ncc rust-lang/rustup.rs#1724\nr? @alexcrichton\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/468c02f5c8e150e319d512347f590c4659b7497b", "html_url": "https://github.com/rust-lang/rust/commit/468c02f5c8e150e319d512347f590c4659b7497b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/468c02f5c8e150e319d512347f590c4659b7497b/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "413aaf3227be873d11aa47243489ea84b09c1500", "url": "https://api.github.com/repos/rust-lang/rust/commits/413aaf3227be873d11aa47243489ea84b09c1500", "html_url": "https://github.com/rust-lang/rust/commit/413aaf3227be873d11aa47243489ea84b09c1500"}, {"sha": "9e663032a1d8697ddde7e0e51e632e8565772265", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e663032a1d8697ddde7e0e51e632e8565772265", "html_url": "https://github.com/rust-lang/rust/commit/9e663032a1d8697ddde7e0e51e632e8565772265"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "98a765e1cec9557c815dca50507ebeb5fe2def60", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/468c02f5c8e150e319d512347f590c4659b7497b/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/468c02f5c8e150e319d512347f590c4659b7497b/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=468c02f5c8e150e319d512347f590c4659b7497b", "patch": "@@ -12,6 +12,9 @@ ci_dir=\"`dirname $docker_dir`\"\n src_dir=\"`dirname $ci_dir`\"\n root_dir=\"`dirname $src_dir`\"\n \n+objdir=$root_dir/obj\n+dist=$objdir/build/dist\n+\n source \"$ci_dir/shared.sh\"\n \n travis_fold start build_docker\n@@ -77,6 +80,11 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       else\n         echo \"Looks like docker image is the same as before, not uploading\"\n       fi\n+      # Record the container image for reuse, e.g. by rustup.rs builds\n+      info=\"$dist/image-$image.txt\"\n+      mkdir -p \"$dist\"\n+      echo \"$url\" >\"$info\"\n+      echo \"$digest\" >>\"$info\"\n     fi\n elif [ -f \"$docker_dir/disabled/$image/Dockerfile\" ]; then\n     if [ -n \"$TRAVIS_OS_NAME\" ]; then\n@@ -99,8 +107,6 @@ fi\n travis_fold end build_docker\n travis_time_finish\n \n-objdir=$root_dir/obj\n-\n mkdir -p $HOME/.cargo\n mkdir -p $objdir/tmp\n mkdir -p $objdir/cores"}]}