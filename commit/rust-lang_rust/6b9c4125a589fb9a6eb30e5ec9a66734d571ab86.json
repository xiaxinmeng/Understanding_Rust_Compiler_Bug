{"sha": "6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "node_id": "C_kwDOAAsO6NoAKDZiOWM0MTI1YTU4OWZiOWE2ZWIzMGU1ZWM5YTY2NzM0ZDU3MWFiODY", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2023-03-03T04:53:47Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2023-03-03T05:15:23Z"}, "message": "Don't call `temporary_scope` twice.\n\n`mirror_expr_inner` calls `temporary_scope`. It then calls\n`make_mirror_unadjusted` which makes an identical call to\n`temporary_scope`.\n\nThis commit changes the `mirror_expr_inner` to get the `temp_lifetime`\nout of the expression produced by `make_mirror_unadjusted`, similar to\nhow it currently gets the type.", "tree": {"sha": "2059c7bb9b270c39a59262eda9f61ee48dc8b5ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2059c7bb9b270c39a59262eda9f61ee48dc8b5ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "html_url": "https://github.com/rust-lang/rust/commit/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca1bc7f1f6487991dd6b504d1fddbc982e6b779c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca1bc7f1f6487991dd6b504d1fddbc982e6b779c", "html_url": "https://github.com/rust-lang/rust/commit/ca1bc7f1f6487991dd6b504d1fddbc982e6b779c"}], "stats": {"total": 6, "additions": 2, "deletions": 4}, "files": [{"sha": "1b790e16b485b3950e5eac53ee16fce3bbcb4f34", "filename": "compiler/rustc_mir_build/src/thir/cx/expr.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b9c4125a589fb9a6eb30e5ec9a66734d571ab86/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fexpr.rs?ref=6b9c4125a589fb9a6eb30e5ec9a66734d571ab86", "patch": "@@ -33,8 +33,6 @@ impl<'tcx> Cx<'tcx> {\n \n     #[instrument(level = \"trace\", skip(self, hir_expr))]\n     pub(super) fn mirror_expr_inner(&mut self, hir_expr: &'tcx hir::Expr<'tcx>) -> ExprId {\n-        let temp_lifetime =\n-            self.rvalue_scopes.temporary_scope(self.region_scope_tree, hir_expr.hir_id.local_id);\n         let expr_scope =\n             region::Scope { id: hir_expr.hir_id.local_id, data: region::ScopeData::Node };\n \n@@ -67,7 +65,7 @@ impl<'tcx> Cx<'tcx> {\n \n         // Next, wrap this up in the expr's scope.\n         expr = Expr {\n-            temp_lifetime,\n+            temp_lifetime: expr.temp_lifetime,\n             ty: expr.ty,\n             span: hir_expr.span,\n             kind: ExprKind::Scope {\n@@ -82,7 +80,7 @@ impl<'tcx> Cx<'tcx> {\n             self.region_scope_tree.opt_destruction_scope(hir_expr.hir_id.local_id)\n         {\n             expr = Expr {\n-                temp_lifetime,\n+                temp_lifetime: expr.temp_lifetime,\n                 ty: expr.ty,\n                 span: hir_expr.span,\n                 kind: ExprKind::Scope {"}]}