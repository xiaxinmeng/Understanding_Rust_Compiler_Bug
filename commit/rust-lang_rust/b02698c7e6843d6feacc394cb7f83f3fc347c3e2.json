{"sha": "b02698c7e6843d6feacc394cb7f83f3fc347c3e2", "node_id": "C_kwDOAAsO6NoAKGIwMjY5OGM3ZTY4NDNkNmZlYWNjMzk0Y2I3ZjgzZjNmYzM0N2MzZTI", "commit": {"author": {"name": "Chris Copeland", "email": "chris@chrisnc.net", "date": "2022-02-17T06:02:58Z"}, "committer": {"name": "Chris Copeland", "email": "chris@chrisnc.net", "date": "2022-02-21T05:27:36Z"}, "message": "use `BOOL` for `TCP_NODELAY` `setsockopt` value on Windows\n\nThis issue was found by the Wine project and mitigated there [1].\n\nWindows' documented interface for `setsockopt` expects a `BOOL` (a\n`typedef` for `int`) for `TCP_NODELAY` [2]. Windows is forgiving and\nwill accept any positive length and interpret the first byte of\n`*option_value` as the value, so this bug does not affect Windows\nitself, but does affect systems implementing Windows' interface more\nstrictly, such as Wine. Wine was previously passing this through to the\nhost's `setsockopt`, where, e.g., Linux requires that `option_len` be\ncorrect for the chosen option, and `TCP_NODELAY` expects an `int`.\n\n[1]: https://source.winehq.org/git/wine.git/commit/d6ea38f32dfd3edbe107a255c37e9f7f3da06ae7\n[2]: https://docs.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-setsockopt", "tree": {"sha": "421215188003253132cd99c83644672fd17bd20a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/421215188003253132cd99c83644672fd17bd20a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b02698c7e6843d6feacc394cb7f83f3fc347c3e2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIgEABYKADAWIQRUFr6XZXwtz1k0J+QUVQ2nJIXfMAUCYhMiyBIcY2hyaXNAY2hy\naXNuYy5uZXQACgkQFFUNpySF3zBxJgEAgqMMRsOiP5tz5J1j2KFrLSvwSXkZWgj8\nuHW1PMnMuKYBAMlUpvgx99+coBSbICbGhmYYIY4m+VC0P0dUpn6zhywJ\n=9szy\n-----END PGP SIGNATURE-----", "payload": "tree 421215188003253132cd99c83644672fd17bd20a\nparent f2ebd0a11fd7ed131d669fcac20fa3b8df642f39\nauthor Chris Copeland <chris@chrisnc.net> 1645077778 -0800\ncommitter Chris Copeland <chris@chrisnc.net> 1645421256 -0800\n\nuse `BOOL` for `TCP_NODELAY` `setsockopt` value on Windows\n\nThis issue was found by the Wine project and mitigated there [1].\n\nWindows' documented interface for `setsockopt` expects a `BOOL` (a\n`typedef` for `int`) for `TCP_NODELAY` [2]. Windows is forgiving and\nwill accept any positive length and interpret the first byte of\n`*option_value` as the value, so this bug does not affect Windows\nitself, but does affect systems implementing Windows' interface more\nstrictly, such as Wine. Wine was previously passing this through to the\nhost's `setsockopt`, where, e.g., Linux requires that `option_len` be\ncorrect for the chosen option, and `TCP_NODELAY` expects an `int`.\n\n[1]: https://source.winehq.org/git/wine.git/commit/d6ea38f32dfd3edbe107a255c37e9f7f3da06ae7\n[2]: https://docs.microsoft.com/en-us/windows/win32/api/winsock/nf-winsock-setsockopt\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b02698c7e6843d6feacc394cb7f83f3fc347c3e2", "html_url": "https://github.com/rust-lang/rust/commit/b02698c7e6843d6feacc394cb7f83f3fc347c3e2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b02698c7e6843d6feacc394cb7f83f3fc347c3e2/comments", "author": {"login": "chrisnc", "id": 2592855, "node_id": "MDQ6VXNlcjI1OTI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2592855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisnc", "html_url": "https://github.com/chrisnc", "followers_url": "https://api.github.com/users/chrisnc/followers", "following_url": "https://api.github.com/users/chrisnc/following{/other_user}", "gists_url": "https://api.github.com/users/chrisnc/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisnc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisnc/subscriptions", "organizations_url": "https://api.github.com/users/chrisnc/orgs", "repos_url": "https://api.github.com/users/chrisnc/repos", "events_url": "https://api.github.com/users/chrisnc/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisnc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chrisnc", "id": 2592855, "node_id": "MDQ6VXNlcjI1OTI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2592855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisnc", "html_url": "https://github.com/chrisnc", "followers_url": "https://api.github.com/users/chrisnc/followers", "following_url": "https://api.github.com/users/chrisnc/following{/other_user}", "gists_url": "https://api.github.com/users/chrisnc/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisnc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisnc/subscriptions", "organizations_url": "https://api.github.com/users/chrisnc/orgs", "repos_url": "https://api.github.com/users/chrisnc/repos", "events_url": "https://api.github.com/users/chrisnc/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisnc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2ebd0a11fd7ed131d669fcac20fa3b8df642f39", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2ebd0a11fd7ed131d669fcac20fa3b8df642f39", "html_url": "https://github.com/rust-lang/rust/commit/f2ebd0a11fd7ed131d669fcac20fa3b8df642f39"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "5de12313784883f774036c52a7011bf64edf3e31", "filename": "library/std/src/sys/windows/net.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b02698c7e6843d6feacc394cb7f83f3fc347c3e2/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b02698c7e6843d6feacc394cb7f83f3fc347c3e2/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs?ref=b02698c7e6843d6feacc394cb7f83f3fc347c3e2", "patch": "@@ -407,11 +407,11 @@ impl Socket {\n     }\n \n     pub fn set_nodelay(&self, nodelay: bool) -> io::Result<()> {\n-        net::setsockopt(self, c::IPPROTO_TCP, c::TCP_NODELAY, nodelay as c::BYTE)\n+        net::setsockopt(self, c::IPPROTO_TCP, c::TCP_NODELAY, nodelay as c::BOOL)\n     }\n \n     pub fn nodelay(&self) -> io::Result<bool> {\n-        let raw: c::BYTE = net::getsockopt(self, c::IPPROTO_TCP, c::TCP_NODELAY)?;\n+        let raw: c::BOOL = net::getsockopt(self, c::IPPROTO_TCP, c::TCP_NODELAY)?;\n         Ok(raw != 0)\n     }\n "}]}