{"sha": "c0695bbf6083fae739c259c8d88ef24502e5c089", "node_id": "C_kwDOAAsO6NoAKGMwNjk1YmJmNjA4M2ZhZTczOWMyNTljOGQ4OGVmMjQ1MDJlNWMwODk", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-20T00:09:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-20T00:09:38Z"}, "message": "Rollup merge of #90089 - jsha:enum-fields-headings, r=camelid,GuillaumeGomez\n\nImprove display of enum variants\n\nUse h3 and h4 for the variant name and the \"Fields\" subheading.\nRemove the \"of T\" part of the \"Fields\" subheading.\nRemove border-bottom from \"Fields\" subheading.\nMove docblock below \"Fields\" listing.\n\nFixes #90061\n\nDemo:\n\nhttps://jacob.hoffman-andrews.com/rust/xmlparser-updated/xmlparser/enum.Token.html#variants\nhttps://jacob.hoffman-andrews.com/rust/fix-enum-variants/std/io/enum.ErrorKind.html#variants\nhttps://jacob.hoffman-andrews.com/rust/fix-enum-variants/std/result/enum.Result.html#variants\n\nr? ``@camelid``", "tree": {"sha": "ea551cea48448daa6f5361a11a6d0547c4126fe1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea551cea48448daa6f5361a11a6d0547c4126fe1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0695bbf6083fae739c259c8d88ef24502e5c089", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhmDzDCRBK7hj4Ov3rIwAAyjYIAJAStsLE0kh/TBmv7cHIQC83\nn/bIUwJkuSXmoEe5UwDI/sc0rgilwMZV2tpHz3aUytBHWaMD4nCEPJ9EANs6OaSt\nyh0c5TIRqhX28kFn0YGR+11YIM0jcBF844ezNuLYYc7FQPqtezktbFvXL4IevyEv\neUMG63sYJI762wrDNAsKWIWyVL/4WxazJ4aUxTCHYooguYrUypJIMdlfjwfClzCH\nh1Gk/kP5lxJVD+BTyuByW/HKwgUx+boTm08zKqG7MrOAAVXgi9hIx7fAFdzBliXz\nhjLhXLWP3Qf+vt91nrUuQfHs7kF8OmR++dKDAiqKSaE7gLWVBWGZBf7qghtltTo=\n=B7ix\n-----END PGP SIGNATURE-----\n", "payload": "tree ea551cea48448daa6f5361a11a6d0547c4126fe1\nparent 97bd45b3730c8f09327b6f8ca5133de38269101c\nparent 69df43b041f76251391f11264c1ff763ca2a64a0\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1637366978 +0100\ncommitter GitHub <noreply@github.com> 1637366978 +0100\n\nRollup merge of #90089 - jsha:enum-fields-headings, r=camelid,GuillaumeGomez\n\nImprove display of enum variants\n\nUse h3 and h4 for the variant name and the \"Fields\" subheading.\nRemove the \"of T\" part of the \"Fields\" subheading.\nRemove border-bottom from \"Fields\" subheading.\nMove docblock below \"Fields\" listing.\n\nFixes #90061\n\nDemo:\n\nhttps://jacob.hoffman-andrews.com/rust/xmlparser-updated/xmlparser/enum.Token.html#variants\nhttps://jacob.hoffman-andrews.com/rust/fix-enum-variants/std/io/enum.ErrorKind.html#variants\nhttps://jacob.hoffman-andrews.com/rust/fix-enum-variants/std/result/enum.Result.html#variants\n\nr? ``@camelid``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0695bbf6083fae739c259c8d88ef24502e5c089", "html_url": "https://github.com/rust-lang/rust/commit/c0695bbf6083fae739c259c8d88ef24502e5c089", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0695bbf6083fae739c259c8d88ef24502e5c089/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97bd45b3730c8f09327b6f8ca5133de38269101c", "url": "https://api.github.com/repos/rust-lang/rust/commits/97bd45b3730c8f09327b6f8ca5133de38269101c", "html_url": "https://github.com/rust-lang/rust/commit/97bd45b3730c8f09327b6f8ca5133de38269101c"}, {"sha": "69df43b041f76251391f11264c1ff763ca2a64a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/69df43b041f76251391f11264c1ff763ca2a64a0", "html_url": "https://github.com/rust-lang/rust/commit/69df43b041f76251391f11264c1ff763ca2a64a0"}], "stats": {"total": 137, "additions": 89, "deletions": 48}, "files": [{"sha": "049d17a4b477af36e53639465ab24202beebbd9e", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=c0695bbf6083fae739c259c8d88ef24502e5c089", "patch": "@@ -1080,7 +1080,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n                 cx.derive_id(format!(\"{}.{}\", ItemType::Variant, variant.name.as_ref().unwrap()));\n             write!(\n                 w,\n-                \"<div id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n+                \"<h3 id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n                     <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\\\n                     <code>{name}\",\n                 id = id,\n@@ -1093,9 +1093,7 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n             }\n             w.write_str(\"</code>\");\n             render_stability_since(w, variant, it, cx.tcx());\n-            w.write_str(\"</div>\");\n-            document(w, cx, variant, Some(it), HeadingOffset::H3);\n-            document_non_exhaustive(w, variant);\n+            w.write_str(\"</h3>\");\n \n             use crate::clean::Variant;\n             if let Some((extra, fields)) = match *variant.kind {\n@@ -1109,12 +1107,8 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n                     variant.name.as_ref().unwrap()\n                 ));\n                 write!(w, \"<div class=\\\"sub-variant\\\" id=\\\"{id}\\\">\", id = variant_id);\n-                write!(\n-                    w,\n-                    \"<h3>{extra}Fields of <b>{name}</b></h3><div>\",\n-                    extra = extra,\n-                    name = variant.name.as_ref().unwrap(),\n-                );\n+                write!(w, \"<h4>{extra}Fields</h4>\", extra = extra,);\n+                document_non_exhaustive(w, variant);\n                 for field in fields {\n                     match *field.kind {\n                         clean::StrippedItem(box clean::StructFieldItem(_)) => {}\n@@ -1126,21 +1120,25 @@ fn item_enum(w: &mut Buffer, cx: &Context<'_>, it: &clean::Item, e: &clean::Enum\n                             ));\n                             write!(\n                                 w,\n-                                \"<span id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n+                                \"<div class=\\\"sub-variant-field\\\">\\\n+                                 <span id=\\\"{id}\\\" class=\\\"variant small-section-header\\\">\\\n                                     <a href=\\\"#{id}\\\" class=\\\"anchor field\\\"></a>\\\n                                     <code>{f}:&nbsp;{t}</code>\\\n                                 </span>\",\n                                 id = id,\n                                 f = field.name.as_ref().unwrap(),\n                                 t = ty.print(cx)\n                             );\n-                            document(w, cx, field, Some(variant), HeadingOffset::H4);\n+                            document(w, cx, field, Some(variant), HeadingOffset::H5);\n+                            write!(w, \"</div>\");\n                         }\n                         _ => unreachable!(),\n                     }\n                 }\n-                w.write_str(\"</div></div>\");\n+                w.write_str(\"</div>\");\n             }\n+\n+            document(w, cx, variant, Some(it), HeadingOffset::H4);\n         }\n     }\n     let def_id = it.def_id.expect_def_id();"}, {"sha": "cb1df15bbb152237f003cf33fd93433280c90d8a", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=c0695bbf6083fae739c259c8d88ef24502e5c089", "patch": "@@ -1102,25 +1102,28 @@ a.test-arrow:hover{\n \tmargin-right: 5px;\n }\n \n-.sub-variant, .sub-variant > h3 {\n-\tmargin-top: 0px !important;\n-\tpadding-top: 1px;\n+h3.variant {\n+\tfont-weight: 600;\n+\tfont-size: 1.1em;\n+\tmargin-bottom: 10px;\n+\tborder-bottom: none;\n }\n \n-#main .sub-variant > h3 {\n-\tfont-size: 15px;\n-\tmargin-left: 25px;\n-\tmargin-bottom: 5px;\n+.sub-variant h4 {\n+\tfont-size: 1em;\n+\tfont-weight: 400;\n+\tborder-bottom: none;\n+\tmargin-top: 0;\n+\tmargin-bottom: 0;\n }\n \n-.sub-variant > div {\n-\tmargin-left: 20px;\n-\tmargin-bottom: 10px;\n+.sub-variant {\n+\tmargin-left: 24px;\n+\tmargin-bottom: 40px;\n }\n \n-.sub-variant > div > span {\n-\tdisplay: block;\n-\tposition: relative;\n+.sub-variant > .sub-variant-field {\n+\tmargin-left: 24px;\n }\n \n .toggle-label {"}, {"sha": "87c512468e05fd9a1dcfd0fdc5a91028c8933c2a", "filename": "src/test/rustdoc-gui/headings.goml", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc-gui%2Fheadings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fheadings.goml?ref=c0695bbf6083fae739c259c8d88ef24502e5c089", "patch": "@@ -1,4 +1,4 @@\n-// This test check that headers (a) have the correct heading level, (b) are the right size,\n+// This test checks that headers (a) have the correct heading level, (b) are the right size,\n // and (c) have the correct underlining (or absence of underlining).\n // The sizes may change as design changes, but try to make sure a lower header is never bigger than\n // its parent headers. Also make sure lower headers don't have underlines when their parents lack\n@@ -67,25 +67,25 @@ assert-css: (\"h4#top-doc-prose-sub-sub-heading\", {\"border-bottom-width\": \"1px\"})\n assert-css: (\"h2#variants\", {\"font-size\": \"22.4px\"})\n assert-css: (\"h2#variants\", {\"border-bottom-width\": \"1px\"})\n \n-assert-css: (\"h3#none-prose-title\", {\"font-size\": \"20.8px\"})\n-assert-css: (\"h3#none-prose-title\", {\"border-bottom-width\": \"0px\"})\n-assert-css: (\"h4#none-prose-sub-heading\", {\"font-size\": \"16px\"})\n-assert-css: (\"h4#none-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n-\n-assert-css: (\"h3#wrapped-prose-title\", {\"font-size\": \"20.8px\"})\n-assert-css: (\"h3#wrapped-prose-title\", {\"border-bottom-width\": \"0px\"})\n-assert-css: (\"h4#wrapped-prose-sub-heading\", {\"font-size\": \"16px\"})\n-assert-css: (\"h4#wrapped-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n-\n-assert-css: (\"h4#wrapped0-prose-title\", {\"font-size\": \"16px\"})\n-assert-css: (\"h4#wrapped0-prose-title\", {\"border-bottom-width\": \"0px\"})\n-assert-css: (\"h5#wrapped0-prose-sub-heading\", {\"font-size\": \"16px\"})\n-assert-css: (\"h5#wrapped0-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n-\n-assert-css: (\"h4#structy-prose-title\", {\"font-size\": \"16px\"})\n-assert-css: (\"h4#structy-prose-title\", {\"border-bottom-width\": \"0px\"})\n-assert-css: (\"h5#structy-prose-sub-heading\", {\"font-size\": \"16px\"})\n-assert-css: (\"h5#structy-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"h4#none-prose-title\", {\"font-size\": \"16px\"})\n+assert-css: (\"h4#none-prose-title\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"h5#none-prose-sub-heading\", {\"font-size\": \"16px\"})\n+assert-css: (\"h5#none-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n+\n+assert-css: (\"h4#wrapped-prose-title\", {\"font-size\": \"16px\"})\n+assert-css: (\"h4#wrapped-prose-title\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"h5#wrapped-prose-sub-heading\", {\"font-size\": \"16px\"})\n+assert-css: (\"h5#wrapped-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n+\n+assert-css: (\"h5#wrapped0-prose-title\", {\"font-size\": \"16px\"})\n+assert-css: (\"h5#wrapped0-prose-title\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"h6#wrapped0-prose-sub-heading\", {\"font-size\": \"15.2px\"})\n+assert-css: (\"h6#wrapped0-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n+\n+assert-css: (\"h5#structy-prose-title\", {\"font-size\": \"16px\"})\n+assert-css: (\"h5#structy-prose-title\", {\"border-bottom-width\": \"0px\"})\n+assert-css: (\"h6#structy-prose-sub-heading\", {\"font-size\": \"15.2px\"})\n+assert-css: (\"h6#structy-prose-sub-heading\", {\"border-bottom-width\": \"0px\"})\n \n assert-css: (\"h2#implementations\", {\"font-size\": \"22.4px\"})\n assert-css: (\"h2#implementations\", {\"border-bottom-width\": \"1px\"})"}, {"sha": "2e5c34391c4af5a0e99b760ce7c4adb420e14839", "filename": "src/test/rustdoc/enum-headings.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc%2Fenum-headings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc%2Fenum-headings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fenum-headings.rs?ref=c0695bbf6083fae739c259c8d88ef24502e5c089", "patch": "@@ -0,0 +1,40 @@\n+#![crate_name = \"foo\"]\n+// @has foo/enum.Token.html\n+/// A token!\n+/// # First\n+/// Some following text...\n+// @has - '//h2[@id=\"first\"]' \"First\"\n+pub enum Token {\n+    /// A declaration!\n+    /// # Variant-First\n+    /// Some following text...\n+    // @has - '//h4[@id=\"variant-first\"]' \"Variant-First\"\n+    Declaration {\n+        /// A version!\n+        /// # Variant-Field-First\n+        /// Some following text...\n+        // @has - '//h5[@id=\"variant-field-first\"]' \"Variant-Field-First\"\n+        version: String,\n+    },\n+    /// A Zoople!\n+    /// # Variant-First\n+    Zoople(\n+        // @has - '//h5[@id=\"variant-tuple-field-first\"]' \"Variant-Tuple-Field-First\"\n+        /// Zoople's first variant!\n+        /// # Variant-Tuple-Field-First\n+        /// Some following text...\n+        usize,\n+    ),\n+    /// Unfinished business!\n+    /// # Non-Exhaustive-First\n+    /// Some following text...\n+    // @has - '//h4[@id=\"non-exhaustive-first\"]' \"Non-Exhaustive-First\"\n+    #[non_exhaustive]\n+    Unfinished {\n+        /// This is x.\n+        /// # X-First\n+        /// Some following text...\n+        // @has - '//h5[@id=\"x-first\"]' \"X-First\"\n+        x: usize,\n+    },\n+}"}, {"sha": "139c5b4391ab7261860d3eb2f6f84ef99fd187af", "filename": "src/test/rustdoc/tuple-struct-fields-doc.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc%2Ftuple-struct-fields-doc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0695bbf6083fae739c259c8d88ef24502e5c089/src%2Ftest%2Frustdoc%2Ftuple-struct-fields-doc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftuple-struct-fields-doc.rs?ref=c0695bbf6083fae739c259c8d88ef24502e5c089", "patch": "@@ -20,10 +20,10 @@ pub struct Foo(\n \n // @has foo/enum.Bar.html\n // @has - '//pre[@class=\"rust enum\"]' 'BarVariant(String),'\n-// @matches - '//*[@id=\"variant.BarVariant.fields\"]/h3' '^Tuple Fields of BarVariant$'\n+// @matches - '//*[@id=\"variant.BarVariant.fields\"]/h4' '^Tuple Fields$'\n // @has - '//*[@id=\"variant.BarVariant.field.0\"]' '0: String'\n // @has - '//*[@id=\"variant.BarVariant.fields\"]//*[@class=\"docblock\"]' 'Hello docs'\n-// @matches - '//*[@id=\"variant.FooVariant.fields\"]/h3' '^Fields of FooVariant$'\n+// @matches - '//*[@id=\"variant.FooVariant.fields\"]/h4' '^Fields$'\n pub enum Bar {\n     BarVariant(\n         /// Hello docs"}]}