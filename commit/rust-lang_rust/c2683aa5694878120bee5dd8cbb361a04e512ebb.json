{"sha": "c2683aa5694878120bee5dd8cbb361a04e512ebb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyNjgzYWE1Njk0ODc4MTIwYmVlNWRkOGNiYjM2MWEwNGU1MTJlYmI=", "commit": {"author": {"name": "Oli Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2021-03-15T11:02:35Z"}, "committer": {"name": "Oli Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2021-03-15T17:39:18Z"}, "message": "Explain each variant of TAIT usage with examples", "tree": {"sha": "bfc12e8261f4ca7d63ea496c20124896f3e16439", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bfc12e8261f4ca7d63ea496c20124896f3e16439"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2683aa5694878120bee5dd8cbb361a04e512ebb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2683aa5694878120bee5dd8cbb361a04e512ebb", "html_url": "https://github.com/rust-lang/rust/commit/c2683aa5694878120bee5dd8cbb361a04e512ebb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2683aa5694878120bee5dd8cbb361a04e512ebb/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6109d731120b1d326be863434c9de5b6dd674aa4", "url": "https://api.github.com/repos/rust-lang/rust/commits/6109d731120b1d326be863434c9de5b6dd674aa4", "html_url": "https://github.com/rust-lang/rust/commit/6109d731120b1d326be863434c9de5b6dd674aa4"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "e2fc1da5c786c8778e3bccb62c0747467e54354f", "filename": "compiler/rustc_typeck/src/check/check.rs", "status": "modified", "additions": 44, "deletions": 1, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/c2683aa5694878120bee5dd8cbb361a04e512ebb/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2683aa5694878120bee5dd8cbb361a04e512ebb/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs?ref=c2683aa5694878120bee5dd8cbb361a04e512ebb", "patch": "@@ -88,16 +88,59 @@ pub(super) fn check_fn<'a, 'tcx>(\n     let declared_ret_ty = fn_sig.output();\n \n     let feature = match tcx.hir().get(fn_id) {\n+        // TAIT usage in function return position.\n+        // Example:\n+        //\n+        // ```rust\n+        // type Foo = impl Debug;\n+        // fn bar() -> Foo { 42 }\n+        // ```\n         Node::Item(hir::Item { kind: ItemKind::Fn(..), .. }) |\n+        // TAIT usage in associated function return position.\n+        //\n+        // Example with a free type alias:\n+        //\n+        // ```rust\n+        // type Foo = impl Debug;\n+        // impl SomeTrait for SomeType {\n+        //     fn bar() -> Foo { 42 }\n+        // }\n+        // ```\n+        //\n+        // Example with an associated TAIT:\n+        //\n+        // ```rust\n+        // impl SomeTrait for SomeType {\n+        //     type Foo = impl Debug;\n+        //     fn bar() -> Self::Foo { 42 }\n+        // }\n+        // ```\n         Node::ImplItem(hir::ImplItem {\n             kind: hir::ImplItemKind::Fn(..), ..\n         }) => None,\n-        // I don't know if TAIT uses in trait declarations make sense at all\n+        // Forbid TAIT in trait declarations for now.\n+        // Examples:\n+        //\n+        // ```rust\n+        // type Foo = impl Debug;\n+        // trait Bar {\n+        //     fn bar() -> Foo;\n+        // }\n+        // trait Bop {\n+        //     type Bop: PartialEq<Foo>;\n+        // }\n+        // ```\n         Node::TraitItem(hir::TraitItem {\n             kind: hir::TraitItemKind::Fn(..),\n             ..\n         }) |\n         // Forbid TAIT in closure return position for now.\n+        // Example:\n+        //\n+        // ```rust\n+        // type Foo = impl Debug;\n+        // let x = |y| -> Foo { 42 + y };\n+        // ```\n         Node::Expr(hir::Expr { kind: hir::ExprKind::Closure(..), .. }) => Some(sym::type_alias_impl_trait),\n         node => bug!(\"Item being checked wasn't a function/closure: {:?}\", node),\n     };"}]}