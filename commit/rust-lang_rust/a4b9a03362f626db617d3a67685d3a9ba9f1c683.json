{"sha": "a4b9a03362f626db617d3a67685d3a9ba9f1c683", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0YjlhMDMzNjJmNjI2ZGI2MTdkM2E2NzY4NWQzYTliYTlmMWM2ODM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-22T03:52:47Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-09T02:16:34Z"}, "message": "Fix inaccurate comments in '?' Kleene operator tests.", "tree": {"sha": "913889ad8bada258ab03a4c623e4479a6d471ecd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/913889ad8bada258ab03a4c623e4479a6d471ecd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4b9a03362f626db617d3a67685d3a9ba9f1c683", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4b9a03362f626db617d3a67685d3a9ba9f1c683", "html_url": "https://github.com/rust-lang/rust/commit/a4b9a03362f626db617d3a67685d3a9ba9f1c683", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4b9a03362f626db617d3a67685d3a9ba9f1c683/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f86719a111ab4dff770914097af1d6ba76d2f97d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f86719a111ab4dff770914097af1d6ba76d2f97d", "html_url": "https://github.com/rust-lang/rust/commit/f86719a111ab4dff770914097af1d6ba76d2f97d"}], "stats": {"total": 138, "additions": 87, "deletions": 51}, "files": [{"sha": "66597c0acf6288c59f537cbb491f6627d6755cd0", "filename": "src/test/run-pass/macros/macro-at-most-once-rep-2015.rs", "status": "modified", "additions": 30, "deletions": 13, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2015.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2015.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2015.rs?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -1,33 +1,50 @@\n // run-pass\n+\n #![allow(unused_mut)]\n-// The logic for parsing Kleene operators in macros has a special case to disambiguate `?`.\n-// Specifically, `$(pat)?` is the ZeroOrOne operator whereas `$(pat)?+` or `$(pat)?*` are the\n-// ZeroOrMore and OneOrMore operators using `?` as a separator. These tests are intended to\n-// exercise that logic in the macro parser.\n-//\n-// Moreover, we also throw in some tests for using a separator with `?`, which is meaningless but\n-// included for consistency with `+` and `*`.\n-//\n-// This test focuses on non-error cases and making sure the correct number of repetitions happen.\n+\n+// Check that when `?` is followed by what looks like a Kleene operator (?, +, and *)\n+// then that `?` is not interpreted as a separator. In other words, `$(pat)?+` matches `pat +`\n+// or `+` but does not match `pat` or `pat ? pat`.\n \n // edition:2015\n \n macro_rules! foo {\n-    ($($a:ident)? ; $num:expr) => { {\n+    // Check for `?`.\n+    ($($a:ident)? ? $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `+`.\n+    ($($a:ident)? + $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `*`.\n+    ($($a:ident)? * $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `;`, not a kleene operator.\n+    ($($a:ident)? ; $num:expr) => {\n         let mut x = 0;\n \n         $(\n             x += $a;\n-         )?\n+        )?\n \n         assert_eq!(x, $num);\n-    } }\n+    };\n }\n \n pub fn main() {\n     let a = 1;\n \n-    // accept 0 or 1 repetitions\n+    // Accept 0 repetitions.\n     foo!( ; 0);\n+    foo!( + 0);\n+    foo!( * 0);\n+    foo!( ? 0);\n+\n+    // Accept 1 repetition.\n     foo!(a ; 1);\n+    foo!(a + 1);\n+    foo!(a * 1);\n+    foo!(a ? 1);\n }"}, {"sha": "b37f3853016a6054c9ec943544133d0041d72580", "filename": "src/test/run-pass/macros/macro-at-most-once-rep-2018.rs", "status": "modified", "additions": 30, "deletions": 13, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2018.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2018.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacros%2Fmacro-at-most-once-rep-2018.rs?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -1,33 +1,50 @@\n // run-pass\n+\n #![allow(unused_mut)]\n-// The logic for parsing Kleene operators in macros has a special case to disambiguate `?`.\n-// Specifically, `$(pat)?` is the ZeroOrOne operator whereas `$(pat)?+` or `$(pat)?*` are the\n-// ZeroOrMore and OneOrMore operators using `?` as a separator. These tests are intended to\n-// exercise that logic in the macro parser.\n-//\n-// Moreover, we also throw in some tests for using a separator with `?`, which is meaningless but\n-// included for consistency with `+` and `*`.\n-//\n-// This test focuses on non-error cases and making sure the correct number of repetitions happen.\n+\n+// Check that when `?` is followed by what looks like a Kleene operator (?, +, and *)\n+// then that `?` is not interpreted as a separator. In other words, `$(pat)?+` matches `pat +`\n+// or `+` but does not match `pat` or `pat ? pat`.\n \n // edition:2018\n \n macro_rules! foo {\n-    ($($a:ident)? ; $num:expr) => { {\n+    // Check for `?`.\n+    ($($a:ident)? ? $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `+`.\n+    ($($a:ident)? + $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `*`.\n+    ($($a:ident)? * $num:expr) => {\n+        foo!($($a)? ; $num);\n+    };\n+    // Check for `;`, not a kleene operator.\n+    ($($a:ident)? ; $num:expr) => {\n         let mut x = 0;\n \n         $(\n             x += $a;\n-         )?\n+        )?\n \n         assert_eq!(x, $num);\n-    } }\n+    };\n }\n \n pub fn main() {\n     let a = 1;\n \n-    // accept 0 or 1 repetitions\n+    // Accept 0 repetitions.\n     foo!( ; 0);\n+    foo!( + 0);\n+    foo!( * 0);\n+    foo!( ? 0);\n+\n+    // Accept 1 repetition.\n     foo!(a ; 1);\n+    foo!(a + 1);\n+    foo!(a * 1);\n+    foo!(a ? 1);\n }"}, {"sha": "f68100d4557d6044dab0ff1bb2871d63d60fda5d", "filename": "src/test/ui/macros/macro-at-most-once-rep-2015.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.rs?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -6,6 +6,7 @@ macro_rules! foo {\n     ($(a)?) => {};\n }\n \n+// The Kleene op `?` does not admit a separator before it.\n macro_rules! baz {\n     ($(a),?) => {}; //~ERROR the `?` macro repetition operator\n }"}, {"sha": "f9871ab8ffe0c49c40cdbc3bc72a1ff66dc2e8fa", "filename": "src/test/ui/macros/macro-at-most-once-rep-2015.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2015.stderr?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -1,11 +1,11 @@\n error: the `?` macro repetition operator does not take a separator\n-  --> $DIR/macro-at-most-once-rep-2015.rs:10:10\n+  --> $DIR/macro-at-most-once-rep-2015.rs:11:10\n    |\n LL |     ($(a),?) => {};\n    |          ^\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:24:11\n+  --> $DIR/macro-at-most-once-rep-2015.rs:25:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -14,7 +14,7 @@ LL |     foo!(a?);\n    |           ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:25:11\n+  --> $DIR/macro-at-most-once-rep-2015.rs:26:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -23,7 +23,7 @@ LL |     foo!(a?a);\n    |           ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:26:11\n+  --> $DIR/macro-at-most-once-rep-2015.rs:27:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -32,7 +32,7 @@ LL |     foo!(a?a?a);\n    |           ^ no rules expected this token in macro call\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2015.rs:28:5\n+  --> $DIR/macro-at-most-once-rep-2015.rs:29:5\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -41,7 +41,7 @@ LL |     barplus!();\n    |     ^^^^^^^^^^^ missing tokens in macro arguments\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2015.rs:29:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:30:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -50,7 +50,7 @@ LL |     barplus!(a);\n    |               ^ missing tokens in macro arguments\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:30:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:31:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -59,7 +59,7 @@ LL |     barplus!(a?);\n    |               ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:31:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:32:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -68,7 +68,7 @@ LL |     barplus!(a?a);\n    |               ^ no rules expected this token in macro call\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2015.rs:35:5\n+  --> $DIR/macro-at-most-once-rep-2015.rs:36:5\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -77,7 +77,7 @@ LL |     barstar!();\n    |     ^^^^^^^^^^^ missing tokens in macro arguments\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2015.rs:36:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:37:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -86,7 +86,7 @@ LL |     barstar!(a);\n    |               ^ missing tokens in macro arguments\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:37:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:38:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -95,7 +95,7 @@ LL |     barstar!(a?);\n    |               ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2015.rs:38:15\n+  --> $DIR/macro-at-most-once-rep-2015.rs:39:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro"}, {"sha": "e4ae406f5123198ff82752db5f9dd6c4eb788af2", "filename": "src/test/ui/macros/macro-at-most-once-rep-2018.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.rs?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -1,11 +1,12 @@\n-// Tests that `?` is a Kleene op and not a macro separator in the 2018 edition.\n+// Tests that `?` is a Kleene op and not a macro separator in the 2015 edition.\n \n // edition:2018\n \n macro_rules! foo {\n     ($(a)?) => {};\n }\n \n+// The Kleene op `?` does not admit a separator before it.\n macro_rules! baz {\n     ($(a),?) => {}; //~ERROR the `?` macro repetition operator\n }"}, {"sha": "bfe5883b03fa04e56c0f211b924c3a6fcd3d1531", "filename": "src/test/ui/macros/macro-at-most-once-rep-2018.stderr", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a4b9a03362f626db617d3a67685d3a9ba9f1c683/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-at-most-once-rep-2018.stderr?ref=a4b9a03362f626db617d3a67685d3a9ba9f1c683", "patch": "@@ -1,11 +1,11 @@\n error: the `?` macro repetition operator does not take a separator\n-  --> $DIR/macro-at-most-once-rep-2018.rs:10:10\n+  --> $DIR/macro-at-most-once-rep-2018.rs:11:10\n    |\n LL |     ($(a),?) => {};\n    |          ^\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:24:11\n+  --> $DIR/macro-at-most-once-rep-2018.rs:25:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -14,7 +14,7 @@ LL |     foo!(a?);\n    |           ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:25:11\n+  --> $DIR/macro-at-most-once-rep-2018.rs:26:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -23,7 +23,7 @@ LL |     foo!(a?a);\n    |           ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:26:11\n+  --> $DIR/macro-at-most-once-rep-2018.rs:27:11\n    |\n LL | macro_rules! foo {\n    | ---------------- when calling this macro\n@@ -32,7 +32,7 @@ LL |     foo!(a?a?a);\n    |           ^ no rules expected this token in macro call\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2018.rs:28:5\n+  --> $DIR/macro-at-most-once-rep-2018.rs:29:5\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -41,7 +41,7 @@ LL |     barplus!();\n    |     ^^^^^^^^^^^ missing tokens in macro arguments\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2018.rs:29:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:30:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -50,7 +50,7 @@ LL |     barplus!(a);\n    |               ^ missing tokens in macro arguments\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:30:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:31:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -59,7 +59,7 @@ LL |     barplus!(a?);\n    |               ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:31:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:32:15\n    |\n LL | macro_rules! barplus {\n    | -------------------- when calling this macro\n@@ -68,7 +68,7 @@ LL |     barplus!(a?a);\n    |               ^ no rules expected this token in macro call\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2018.rs:35:5\n+  --> $DIR/macro-at-most-once-rep-2018.rs:36:5\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -77,7 +77,7 @@ LL |     barstar!();\n    |     ^^^^^^^^^^^ missing tokens in macro arguments\n \n error: unexpected end of macro invocation\n-  --> $DIR/macro-at-most-once-rep-2018.rs:36:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:37:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -86,7 +86,7 @@ LL |     barstar!(a);\n    |               ^ missing tokens in macro arguments\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:37:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:38:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro\n@@ -95,7 +95,7 @@ LL |     barstar!(a?);\n    |               ^ no rules expected this token in macro call\n \n error: no rules expected the token `?`\n-  --> $DIR/macro-at-most-once-rep-2018.rs:38:15\n+  --> $DIR/macro-at-most-once-rep-2018.rs:39:15\n    |\n LL | macro_rules! barstar {\n    | -------------------- when calling this macro"}]}