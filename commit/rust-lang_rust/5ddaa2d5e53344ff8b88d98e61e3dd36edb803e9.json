{"sha": "5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "node_id": "C_kwDOAAsO6NoAKDVkZGFhMmQ1ZTUzMzQ0ZmY4Yjg4ZDk4ZTYxZTNkZDM2ZWRiODAzZTk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-07T01:21:39Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-07T01:21:39Z"}, "message": "Erase regions when checking for missing Copy predicates", "tree": {"sha": "34314a21df5a01d6941cf82a9184708fac2a1433", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/34314a21df5a01d6941cf82a9184708fac2a1433"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "html_url": "https://github.com/rust-lang/rust/commit/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "38a0b81b1c32764d6a583a5efb6f306b8c44c503", "url": "https://api.github.com/repos/rust-lang/rust/commits/38a0b81b1c32764d6a583a5efb6f306b8c44c503", "html_url": "https://github.com/rust-lang/rust/commit/38a0b81b1c32764d6a583a5efb6f306b8c44c503"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "2a74e1ce8b1b16ef5f1c3154da41ce475048362d", "filename": "compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs?ref=5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "patch": "@@ -448,8 +448,16 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                                 self.mir_hir_id(),\n                                 rustc_infer::traits::ObligationCauseCode::MiscObligation,\n                             );\n-                            fulfill_cx.register_bound(&infcx, self.param_env, ty, copy_did, cause);\n-                            let errors = fulfill_cx.select_where_possible(&infcx);\n+                            fulfill_cx.register_bound(\n+                                &infcx,\n+                                self.param_env,\n+                                // Erase any region vids from the type, which may not be resolved\n+                                infcx.tcx.erase_regions(ty),\n+                                copy_did,\n+                                cause,\n+                            );\n+                            // Select all, including ambiguous predicates\n+                            let errors = fulfill_cx.select_all_or_error(&infcx);\n \n                             // Only emit suggestion if all required predicates are on generic\n                             errors"}, {"sha": "dff95283459b604afc09677cba04a6d157c2563a", "filename": "src/test/ui/borrowck/copy-suggestion-region-vid.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.rs?ref=5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "patch": "@@ -0,0 +1,17 @@\n+pub struct DataStruct();\n+\n+pub struct HelperStruct<'n> {\n+    pub helpers: [Vec<&'n i64>; 2],\n+    pub is_empty: bool,\n+}\n+\n+impl DataStruct {\n+    pub fn f(&self) -> HelperStruct {\n+        let helpers = [vec![], vec![]];\n+\n+        HelperStruct { helpers, is_empty: helpers[0].is_empty() }\n+        //~^ ERROR borrow of moved value\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "f03cdd84d75f898f7ac3d541451a2963e8adff65", "filename": "src/test/ui/borrowck/copy-suggestion-region-vid.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fcopy-suggestion-region-vid.stderr?ref=5ddaa2d5e53344ff8b88d98e61e3dd36edb803e9", "patch": "@@ -0,0 +1,14 @@\n+error[E0382]: borrow of moved value: `helpers`\n+  --> $DIR/copy-suggestion-region-vid.rs:12:43\n+   |\n+LL |         let helpers = [vec![], vec![]];\n+   |             ------- move occurs because `helpers` has type `[Vec<&i64>; 2]`, which does not implement the `Copy` trait\n+LL | \n+LL |         HelperStruct { helpers, is_empty: helpers[0].is_empty() }\n+   |                        -------            ^^^^^^^^^^^^^^^^^^^^^ value borrowed here after move\n+   |                        |\n+   |                        value moved here\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0382`."}]}