{"sha": "098e4f119595cc199bf09ccf150aeefa6b2c49ac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA5OGU0ZjExOTU5NWNjMTk5YmYwOWNjZjE1MGFlZWZhNmIyYzQ5YWM=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-10-12T16:29:29Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-10-12T16:29:29Z"}, "message": "driver.rs: Replace lazy_static with once_cell", "tree": {"sha": "286520a867ab11773f94dc3e4e9da2a74bfa0a42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/286520a867ab11773f94dc3e4e9da2a74bfa0a42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/098e4f119595cc199bf09ccf150aeefa6b2c49ac", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEb0jkZw3AJLMiOp9wGI/nM3KGUrEFAl+EhH8ACgkQGI/nM3KG\nUrEIGg/+PRQyH3BNMYwFV9sQxBJSV/f/vK2pUSGa9KHpVOuUBIm2FzW2tPVhVvwD\nhMsmHFvTji0rTIls9NkjlVDMoi5lF0UEQAJPAXzbn/UucRafzW+AQtHEA1s+xaqz\ns3cFoxTHnXnSughp57shtxbwtSp83CnXRlvSuqEtqCnPi4YFe1+T26AfqdbrAhiz\nlZqfRuLb2Oxrwo50lH0vJPtMByhOQfVO/IXTMGQtQ5H6QLejhM29YcIrloKL6e2c\nyCNZLCduf5JZe48VhM8/8zqRI1QWbAB2Ybe6gh2dzy6nEe0sPHnIHNmaN8qK9ftK\nfciTIbUUWPO/85/u05wfourRl9o2p3aUIvL6Yzmz+sdURvyNb3f97ZXt7HAvj0jc\n9cRHHeehwN4fAAKGCKMDWc7mUmhQiXgPca9x6+pn8iQyV0ZveAZ333orL7Fk5fLe\nTKI73a8jw6lxqzSJYUEFVw2V/E12Ge1cng+rkTYtKYAejdWret+VDlqNA3gVvAI0\noxaVgfKOPGGcc60adHvM1gt8DF4NRLUkgu/k3A3osklFxx+neh/tko1z2wP3s8K6\nNzdk/fW9gxG6MBUbSLMabSFtS+JpkaPeZUbM+/d4vB2PC20bHUCZnSUL0V+shEvy\n/6j1YoR8Znwk9HD1AocO3vfvenGC4UcFT2WlMFYD3SQoYi4qezc=\n=pDAL\n-----END PGP SIGNATURE-----", "payload": "tree 286520a867ab11773f94dc3e4e9da2a74bfa0a42\nparent c5774f94efd60b60fc7120ba3d6de7f79b05681b\nauthor Philipp Hansch <dev@phansch.net> 1602520169 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1602520169 +0200\n\ndriver.rs: Replace lazy_static with once_cell\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/098e4f119595cc199bf09ccf150aeefa6b2c49ac", "html_url": "https://github.com/rust-lang/rust/commit/098e4f119595cc199bf09ccf150aeefa6b2c49ac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/098e4f119595cc199bf09ccf150aeefa6b2c49ac/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5774f94efd60b60fc7120ba3d6de7f79b05681b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5774f94efd60b60fc7120ba3d6de7f79b05681b", "html_url": "https://github.com/rust-lang/rust/commit/c5774f94efd60b60fc7120ba3d6de7f79b05681b"}], "stats": {"total": 18, "additions": 7, "deletions": 11}, "files": [{"sha": "13db35f4b0ef0282658db2d542d31d42ce04866f", "filename": "Cargo.toml", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/098e4f119595cc199bf09ccf150aeefa6b2c49ac/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/098e4f119595cc199bf09ccf150aeefa6b2c49ac/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=098e4f119595cc199bf09ccf150aeefa6b2c49ac", "patch": "@@ -34,13 +34,11 @@ clippy_lints = { version = \"0.0.212\", path = \"clippy_lints\" }\n semver = \"0.10\"\n rustc_tools_util = { version = \"0.2.0\", path = \"rustc_tools_util\"}\n tempfile = { version = \"3.1.0\", optional = true }\n-lazy_static = \"1.0\"\n \n [dev-dependencies]\n cargo_metadata = \"0.11.1\"\n compiletest_rs = { version = \"0.5.0\", features = [\"tmp\"] }\n tester = \"0.7\"\n-lazy_static = \"1.0\"\n clippy-mini-macro-test = { version = \"0.2\", path = \"mini-macro\" }\n serde = { version = \"1.0\", features = [\"derive\"] }\n derive-new = \"0.5\""}, {"sha": "e32ba116939b2351f931e0da327fe1a832e2c4d1", "filename": "src/driver.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/098e4f119595cc199bf09ccf150aeefa6b2c49ac/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/098e4f119595cc199bf09ccf150aeefa6b2c49ac/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=098e4f119595cc199bf09ccf150aeefa6b2c49ac", "patch": "@@ -18,13 +18,13 @@ use rustc_interface::interface;\n use rustc_middle::ty::TyCtxt;\n use rustc_tools_util::VersionInfo;\n \n-use lazy_static::lazy_static;\n use std::borrow::Cow;\n use std::env;\n use std::ops::Deref;\n use std::panic;\n use std::path::{Path, PathBuf};\n use std::process::{exit, Command};\n+use std::lazy::SyncLazy;\n \n mod lintlist;\n \n@@ -231,13 +231,11 @@ You can use tool lints to allow or deny lints from your code, eg.:\n \n const BUG_REPORT_URL: &str = \"https://github.com/rust-lang/rust-clippy/issues/new\";\n \n-lazy_static! {\n-    static ref ICE_HOOK: Box<dyn Fn(&panic::PanicInfo<'_>) + Sync + Send + 'static> = {\n-        let hook = panic::take_hook();\n-        panic::set_hook(Box::new(|info| report_clippy_ice(info, BUG_REPORT_URL)));\n-        hook\n-    };\n-}\n+static ICE_HOOK: SyncLazy<Box<dyn Fn(&panic::PanicInfo<'_>) + Sync + Send + 'static>> = SyncLazy::new(|| {\n+    let hook = panic::take_hook();\n+    panic::set_hook(Box::new(|info| report_clippy_ice(info, BUG_REPORT_URL)));\n+    hook\n+});\n \n fn report_clippy_ice(info: &panic::PanicInfo<'_>, bug_report_url: &str) {\n     // Invoke our ICE handler, which prints the actual panic message and optionally a backtrace\n@@ -296,7 +294,7 @@ fn toolchain_path(home: Option<String>, toolchain: Option<String>) -> Option<Pat\n \n pub fn main() {\n     rustc_driver::init_rustc_env_logger();\n-    lazy_static::initialize(&ICE_HOOK);\n+    SyncLazy::force(&ICE_HOOK);\n     exit(rustc_driver::catch_with_exit_code(move || {\n         let mut orig_args: Vec<String> = env::args().collect();\n "}]}