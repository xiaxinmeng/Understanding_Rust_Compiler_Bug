{"sha": "2f555dec4a5e3eeaea31d991c0220c4260b794e5", "node_id": "C_kwDOAAsO6NoAKDJmNTU1ZGVjNGE1ZTNlZWFlYTMxZDk5MWMwMjIwYzQyNjBiNzk0ZTU", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-12-17T06:16:12Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-12-17T12:46:48Z"}, "message": "Add a temporary hack before env fix lands in bootstrap", "tree": {"sha": "2e653ae2f024f8b217c9efce34f69fade7185e35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e653ae2f024f8b217c9efce34f69fade7185e35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f555dec4a5e3eeaea31d991c0220c4260b794e5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE3RQPHNISvvEnSKtjbQF6ltjmwvkFAmG8hrgACgkQbQF6ltjm\nwvkjPhAAk8NPP0ch1evTa+hxtU9Oly8ysM0GOsdJFPX/8lvWCN9xMve/0ICiIkBk\nSGmoQWTuGg8oZgWzInrZDTQol/YNCkwYfoep6IxOWHiwCOl5VKuWJ7mKoiocaq0p\nuQnEbg8e0jQ3Xs6snHSK2/mTA8bDk5VhjZpFrNVQjQoFtkI0a/XcJi3LDyO1Cf5F\nTusOvP3klJVZobcW3na2tAQcI5VWbBQdTNvJV0MFD80Hp5coLRVrT2y/7XSQTjYp\nQ/OYQd6SSrT6W20zkoZ3yjzsX0fJseyOIfscIuovKXgmyXeM8luoaEwiCPwUEDwP\njTji9U2DC3QcWJn6Sb7pwWfPLNQ7OSei11NdYaikLuQosfQISkFTp6+SXssVN2z3\nAzbtFRARIMF42ZH9sM0CEYRVGaYmLF5s5OchjwdyyGgFGOryRC406P8wJg86pbE7\nCg3lJHtAbEjN2PJmqeJpJRA/EqiSLPQigfrRzwCT+LZo9CLxeRCPdcXPW3Ztnc4/\nGd9WHL5zKSotN8GqN3WAdVxiJGZ6GoTKYAVQoxk8447rvfrqcg2ikb80UfFJm32y\nb5VWhmO6cCGdRRVNDeNoWq3/AgRiGMUNZv5fdKBoF5dyzpv+o9Ek0YJdGk0OGT5X\nkoC0UGkfMokB508UIuIKItuLxDz8C58/NYR61EPAUdW2YLAK52E=\n=IjXC\n-----END PGP SIGNATURE-----", "payload": "tree 2e653ae2f024f8b217c9efce34f69fade7185e35\nparent 6b5f63c3fc4cc5bcaaf5cad60e2cc7e56df3487f\nauthor Deadbeef <ent3rm4n@gmail.com> 1639721772 +0800\ncommitter Deadbeef <ent3rm4n@gmail.com> 1639745208 +0800\n\nAdd a temporary hack before env fix lands in bootstrap\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f555dec4a5e3eeaea31d991c0220c4260b794e5", "html_url": "https://github.com/rust-lang/rust/commit/2f555dec4a5e3eeaea31d991c0220c4260b794e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f555dec4a5e3eeaea31d991c0220c4260b794e5/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b5f63c3fc4cc5bcaaf5cad60e2cc7e56df3487f", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b5f63c3fc4cc5bcaaf5cad60e2cc7e56df3487f", "html_url": "https://github.com/rust-lang/rust/commit/6b5f63c3fc4cc5bcaaf5cad60e2cc7e56df3487f"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "e2de9f12aaa71527080243cb1d994f79e1d07274", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/2f555dec4a5e3eeaea31d991c0220c4260b794e5/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f555dec4a5e3eeaea31d991c0220c4260b794e5/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=2f555dec4a5e3eeaea31d991c0220c4260b794e5", "patch": "@@ -771,11 +771,24 @@ rustc_queries! {\n         desc { |tcx| \"type-checking `{}`\", tcx.def_path_str(key.to_def_id()) }\n         cache_on_disk_if { true }\n         load_cached(tcx, id) {\n-            let typeck_results: Option<ty::TypeckResults<'tcx>> = tcx\n-                .on_disk_cache().as_ref()\n-                .and_then(|c| c.try_load_query_result(*tcx, id));\n+            #[cfg(bootstrap)]\n+            {\n+                match match tcx.on_disk_cache().as_ref() {\n+                    Some(c) => c.try_load_query_result(*tcx, id),\n+                    None => None,\n+                } {\n+                    Some(x) => Some(&*tcx.arena.alloc(x)),\n+                    None => None,\n+                }\n+            }\n+            #[cfg(not(bootstrap))]\n+            {\n+                let typeck_results: Option<ty::TypeckResults<'tcx>> = tcx\n+                    .on_disk_cache().as_ref()\n+                    .and_then(|c| c.try_load_query_result(*tcx, id));\n \n-            typeck_results.map(|x| &*tcx.arena.alloc(x))\n+                typeck_results.map(|x| &*tcx.arena.alloc(x))\n+            }\n         }\n     }\n "}]}