{"sha": "32894d503e720130cc6fd0fa193afa2d9f7d4431", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyODk0ZDUwM2U3MjAxMzBjYzZmZDBmYTE5M2FmYTJkOWY3ZDQ0MzE=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-08T13:32:30Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-16T10:17:15Z"}, "message": "lint enum variants names that start or end with their enum's name", "tree": {"sha": "49a13a5df8d380a52183b7ceee3e3273f231d1e3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49a13a5df8d380a52183b7ceee3e3273f231d1e3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/32894d503e720130cc6fd0fa193afa2d9f7d4431", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXYnysAAoJEFbW7qD8Z6xGZP8P/i4Xbz7B7lCo7nseIKbuy3PC\nGsSmWVT1rVJbP5lSSvZ3etjgr/nXQR/pXWGvH4U7U2dEiFEFwqeWSwPwCE7eAk8w\ncuP6ZqxpI5/gaRmrRHfQqxyr7jgWQWkLOcr8X+9tEqWWRb7wnJZWs1W/IK0Yga2f\nzSiRGD1t6TN4cNOuZ3MEYGqem2bgdX+IVxNoklEHBMDWJE5J/d8mOIbih2cIUjVj\nt1jWdpMnpuj6QZevmFJjtmzD+yM0yg9R7xythhnoGhUZ/LMV6Z15JkiQZnbnYJ/O\ny8kcakFI7Icq3L1pi+TANvTX96icL1wSqiHykybRNoHLxFiVSYl7M6spLofdov1p\n+3aFyZzOpKFI4jH+Ita+vCGgHbcW/4Mwce5uWTTWe84Ltgz0jU0YrW20RBIQ1xBl\n84awCpjDEhF67eWmAShpYKM44DCSJ0dg8GDZ6Hf9yVtvY03ghM8Emsw9UKHxMBFX\nmN02+QvzYSoyVZYEWneNZwhsuRdxI8G8UW7qnyYIkqqYMD4eXvPrmzmJXX3Fw0q3\nqRNylHdgQ8WSnxP1QOS+k7vFJB2rRG+VWjvm1N1xBS6b8FwX4r9B32NHqf2AE92Z\nd7FYEf7pBGNeuVPrvu1aeBCsHj7OzQY1ItTlX2DTEcUUr3f1qINa2O4TTY2wXcl3\nMwJ9dYC1QWc593+p7JgJ\n=HoC8\n-----END PGP SIGNATURE-----", "payload": "tree 49a13a5df8d380a52183b7ceee3e3273f231d1e3\nparent 5726216c9b0756c8a94b6d8af9418b5544afa8bc\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1465392750 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1466072235 +0200\n\nlint enum variants names that start or end with their enum's name"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/32894d503e720130cc6fd0fa193afa2d9f7d4431", "html_url": "https://github.com/rust-lang/rust/commit/32894d503e720130cc6fd0fa193afa2d9f7d4431", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/32894d503e720130cc6fd0fa193afa2d9f7d4431/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5726216c9b0756c8a94b6d8af9418b5544afa8bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/5726216c9b0756c8a94b6d8af9418b5544afa8bc", "html_url": "https://github.com/rust-lang/rust/commit/5726216c9b0756c8a94b6d8af9418b5544afa8bc"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "ec318a3795292ba5aa592050181ed21001611485", "filename": "clippy_lints/src/enum_variants.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/32894d503e720130cc6fd0fa193afa2d9f7d4431/clippy_lints%2Fsrc%2Fenum_variants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32894d503e720130cc6fd0fa193afa2d9f7d4431/clippy_lints%2Fsrc%2Fenum_variants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fenum_variants.rs?ref=32894d503e720130cc6fd0fa193afa2d9f7d4431", "patch": "@@ -3,7 +3,7 @@\n use rustc::lint::*;\n use syntax::ast::*;\n use syntax::parse::token::InternedString;\n-use utils::span_help_and_lint;\n+use utils::{span_help_and_lint, span_lint};\n use utils::{camel_case_from, camel_case_until};\n \n /// **What it does:** Warns on enum variants that are prefixed or suffixed by the same characters\n@@ -30,12 +30,14 @@ fn var2str(var: &Variant) -> InternedString {\n     var.node.name.name.as_str()\n }\n \n+/// Returns the number of chars that match from the start\n fn partial_match(pre: &str, name: &str) -> usize {\n     let mut name_iter = name.chars();\n     let _ = name_iter.next_back(); // make sure the name is never fully matched\n     pre.chars().zip(name_iter).take_while(|&(l, r)| l == r).count()\n }\n \n+/// Returns the number of chars that match from the end\n fn partial_rmatch(post: &str, name: &str) -> usize {\n     let mut name_iter = name.chars();\n     let _ = name_iter.next(); // make sure the name is never fully matched\n@@ -46,7 +48,20 @@ impl EarlyLintPass for EnumVariantNames {\n     // FIXME: #600\n     #[allow(while_let_on_iterator)]\n     fn check_item(&mut self, cx: &EarlyContext, item: &Item) {\n+        let item_name = item.ident.name.as_str();\n+        let item_name_chars = item_name.chars().count();\n         if let ItemKind::Enum(ref def, _) = item.node {\n+            for var in &def.variants {\n+                let name = var2str(var);\n+                let matching = partial_match(&item_name, &name);\n+                let rmatching = partial_rmatch(&item_name, &name);\n+                if matching == item_name_chars {\n+                    span_lint(cx, ENUM_VARIANT_NAMES, var.span, \"Variant name starts with the enum's name\");\n+                }\n+                if rmatching == item_name_chars {\n+                    span_lint(cx, ENUM_VARIANT_NAMES, var.span, \"Variant name ends with the enum's name\");\n+                }\n+            }\n             if def.variants.len() < 2 {\n                 return;\n             }"}, {"sha": "ed7f7823f8fa24a2b3d7468b25e2bd97f56a0695", "filename": "tests/compile-fail/enum_variants.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/32894d503e720130cc6fd0fa193afa2d9f7d4431/tests%2Fcompile-fail%2Fenum_variants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/32894d503e720130cc6fd0fa193afa2d9f7d4431/tests%2Fcompile-fail%2Fenum_variants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fenum_variants.rs?ref=32894d503e720130cc6fd0fa193afa2d9f7d4431", "patch": "@@ -11,7 +11,8 @@ enum FakeCallType2 {\n }\n \n enum Foo {\n-    cFoo, cBar,\n+    cFoo, //~ ERROR: Variant name ends with the enum's name\n+    cBar,\n }\n \n enum BadCallType { //~ ERROR: All variants have the same prefix: `CallType`\n@@ -68,4 +69,12 @@ enum NonCaps { //~ ERROR: All variants have the same prefix: `Prefix`\n     PrefixCake,\n }\n \n+enum Stuff {\n+    BadStuff, //~ ERROR: Variant name ends with the enum's name\n+}\n+\n+enum Food {\n+    FoodGood, //~ ERROR: Variant name starts with the enum's name\n+}\n+\n fn main() {}"}]}