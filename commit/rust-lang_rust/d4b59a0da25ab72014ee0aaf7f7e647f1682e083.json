{"sha": "d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "node_id": "C_kwDOAAsO6NoAKGQ0YjU5YTBkYTI1YWI3MjAxNGVlMGFhZjdmN2U2NDdmMTY4MmUwODM", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-09T17:11:30Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-03-09T17:24:07Z"}, "message": "Propagate expected return type instead of real return type in check_binop", "tree": {"sha": "364e950c028223ebd69406c08d86e200d888e5cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/364e950c028223ebd69406c08d86e200d888e5cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "html_url": "https://github.com/rust-lang/rust/commit/d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb", "html_url": "https://github.com/rust-lang/rust/commit/1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb"}], "stats": {"total": 55, "additions": 37, "deletions": 18}, "files": [{"sha": "37783bc91bb8c821420e7a73909b2141bb7c858f", "filename": "compiler/rustc_hir_typeck/src/op.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/compiler%2Frustc_hir_typeck%2Fsrc%2Fop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/compiler%2Frustc_hir_typeck%2Fsrc%2Fop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fop.rs?ref=d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "patch": "@@ -148,10 +148,11 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         rhs_ty,\n                         op,\n                     );\n-                    self.demand_suptype(expr.span, builtin_return_ty, return_ty);\n+                    self.demand_eqtype(expr.span, builtin_return_ty, return_ty);\n+                    builtin_return_ty\n+                } else {\n+                    return_ty\n                 }\n-\n-                return_ty\n             }\n         }\n     }"}, {"sha": "b4f09fbbb04d03806cbc890c692cdb00d1690f3c", "filename": "tests/ui/issues/issue-66667-function-cmp-cycle.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.rs?ref=d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "patch": "@@ -1,16 +1,19 @@\n fn first() {\n     second == 1 //~ ERROR binary operation\n     //~^ ERROR mismatched types\n+    //~| ERROR mismatched types\n }\n \n fn second() {\n     first == 1 //~ ERROR binary operation\n     //~^ ERROR mismatched types\n+    //~| ERROR mismatched types\n }\n \n fn bar() {\n     bar == 1 //~ ERROR binary operation\n     //~^ ERROR mismatched types\n+    //~| ERROR mismatched types\n }\n \n fn main() {}"}, {"sha": "d9a960ce197305ff313fa7b4dc309b1a7675bbc0", "filename": "tests/ui/issues/issue-66667-function-cmp-cycle.stderr", "status": "modified", "additions": 29, "deletions": 5, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fissues%2Fissue-66667-function-cmp-cycle.stderr?ref=d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "patch": "@@ -15,41 +15,65 @@ LL |     second == 1\n    = note: expected fn item `fn() {second}`\n                  found type `{integer}`\n \n+error[E0308]: mismatched types\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:2:5\n+   |\n+LL | fn first() {\n+   |            - help: try adding a return type: `-> bool`\n+LL |     second == 1\n+   |     ^^^^^^^^^^^ expected `()`, found `bool`\n+\n error[E0369]: binary operation `==` cannot be applied to type `fn() {first}`\n-  --> $DIR/issue-66667-function-cmp-cycle.rs:7:11\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:8:11\n    |\n LL |     first == 1\n    |     ----- ^^ - {integer}\n    |     |\n    |     fn() {first}\n \n error[E0308]: mismatched types\n-  --> $DIR/issue-66667-function-cmp-cycle.rs:7:14\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:8:14\n    |\n LL |     first == 1\n    |              ^ expected fn item, found integer\n    |\n    = note: expected fn item `fn() {first}`\n                  found type `{integer}`\n \n+error[E0308]: mismatched types\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:8:5\n+   |\n+LL | fn second() {\n+   |             - help: try adding a return type: `-> bool`\n+LL |     first == 1\n+   |     ^^^^^^^^^^ expected `()`, found `bool`\n+\n error[E0369]: binary operation `==` cannot be applied to type `fn() {bar}`\n-  --> $DIR/issue-66667-function-cmp-cycle.rs:12:9\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:14:9\n    |\n LL |     bar == 1\n    |     --- ^^ - {integer}\n    |     |\n    |     fn() {bar}\n \n error[E0308]: mismatched types\n-  --> $DIR/issue-66667-function-cmp-cycle.rs:12:12\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:14:12\n    |\n LL |     bar == 1\n    |            ^ expected fn item, found integer\n    |\n    = note: expected fn item `fn() {bar}`\n                  found type `{integer}`\n \n-error: aborting due to 6 previous errors\n+error[E0308]: mismatched types\n+  --> $DIR/issue-66667-function-cmp-cycle.rs:14:5\n+   |\n+LL | fn bar() {\n+   |          - help: try adding a return type: `-> bool`\n+LL |     bar == 1\n+   |     ^^^^^^^^ expected `()`, found `bool`\n+\n+error: aborting due to 9 previous errors\n \n Some errors have detailed explanations: E0308, E0369.\n For more information about an error, try `rustc --explain E0308`."}, {"sha": "3b261062f782e6c1d227379a4fbb14d6a566d0b4", "filename": "tests/ui/typeck/lazy-norm/cast-checks-handling-projections.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4b59a0da25ab72014ee0aaf7f7e647f1682e083/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.rs?ref=d4b59a0da25ab72014ee0aaf7f7e647f1682e083", "patch": "@@ -1,5 +1,5 @@\n // compile-flags: -Ztrait-solver=next\n-// known-bug: unknown\n+// check-pass\n \n fn main() {\n     (0u8 + 0u8) as char;"}, {"sha": "6b09ccd52140def0329639a2f6ad5889d8193cbf", "filename": "tests/ui/typeck/lazy-norm/cast-checks-handling-projections.stderr", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftypeck%2Flazy-norm%2Fcast-checks-handling-projections.stderr?ref=1b6d6f92d1980d7f987fa0fe53cea8d8fb3209eb", "patch": "@@ -1,9 +0,0 @@\n-error[E0271]: type mismatch resolving `char == <u8 as Add>::Output`\n-  --> $DIR/cast-checks-handling-projections.rs:5:5\n-   |\n-LL |     (0u8 + 0u8) as char;\n-   |     ^^^^^^^^^^^ types differ\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0271`."}]}