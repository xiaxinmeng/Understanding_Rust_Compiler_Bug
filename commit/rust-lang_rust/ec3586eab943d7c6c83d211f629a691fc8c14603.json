{"sha": "ec3586eab943d7c6c83d211f629a691fc8c14603", "node_id": "C_kwDOAAsO6NoAKGVjMzU4NmVhYjk0M2Q3YzZjODNkMjExZjYyOWE2OTFmYzhjMTQ2MDM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-28T18:52:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-28T18:52:00Z"}, "message": "Auto merge of #12904 - lnicola:completion-builtin-filter, r=lnicola\n\ninternal: Be more explicit when filtering built-in completions\n\nWe return every built-in type here, but only have `u32` in the tests, so let's look for that one to make tests more reliable across platforms.", "tree": {"sha": "6d69b74a9ee25ca567bcb0aa1f94555bdb47a6f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d69b74a9ee25ca567bcb0aa1f94555bdb47a6f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec3586eab943d7c6c83d211f629a691fc8c14603", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec3586eab943d7c6c83d211f629a691fc8c14603", "html_url": "https://github.com/rust-lang/rust/commit/ec3586eab943d7c6c83d211f629a691fc8c14603", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec3586eab943d7c6c83d211f629a691fc8c14603/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cab105543051761394f4573c091a33f97db83d0b", "url": "https://api.github.com/repos/rust-lang/rust/commits/cab105543051761394f4573c091a33f97db83d0b", "html_url": "https://github.com/rust-lang/rust/commit/cab105543051761394f4573c091a33f97db83d0b"}, {"sha": "11ef494b3764811b8ea5178d6c9bd67b287f104a", "url": "https://api.github.com/repos/rust-lang/rust/commits/11ef494b3764811b8ea5178d6c9bd67b287f104a", "html_url": "https://github.com/rust-lang/rust/commit/11ef494b3764811b8ea5178d6c9bd67b287f104a"}], "stats": {"total": 7, "additions": 1, "deletions": 6}, "files": [{"sha": "cf826648dcf7b92426d162055248a2f7248a91c3", "filename": "crates/ide-completion/src/tests.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ec3586eab943d7c6c83d211f629a691fc8c14603/crates%2Fide-completion%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec3586eab943d7c6c83d211f629a691fc8c14603/crates%2Fide-completion%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests.rs?ref=ec3586eab943d7c6c83d211f629a691fc8c14603", "patch": "@@ -23,8 +23,6 @@ mod type_pos;\n mod use_tree;\n mod visibility;\n \n-use std::mem;\n-\n use hir::{db::DefDatabase, PrefixKind, Semantics};\n use ide_db::{\n     base_db::{fixture::ChangeFixture, FileLoader, FilePosition},\n@@ -107,12 +105,9 @@ fn completion_list_with_config(\n ) -> String {\n     // filter out all but one builtintype completion for smaller test outputs\n     let items = get_all_items(config, ra_fixture, trigger_character);\n-    let mut bt_seen = false;\n     let items = items\n         .into_iter()\n-        .filter(|it| {\n-            it.kind() != CompletionItemKind::BuiltinType || !mem::replace(&mut bt_seen, true)\n-        })\n+        .filter(|it| it.kind() != CompletionItemKind::BuiltinType || it.label() == \"u32\")\n         .filter(|it| include_keywords || it.kind() != CompletionItemKind::Keyword)\n         .filter(|it| include_keywords || it.kind() != CompletionItemKind::Snippet)\n         .sorted_by_key(|it| (it.kind(), it.label().to_owned(), it.detail().map(ToOwned::to_owned)))"}]}