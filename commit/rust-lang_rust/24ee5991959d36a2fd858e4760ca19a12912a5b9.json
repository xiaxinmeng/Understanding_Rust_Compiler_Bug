{"sha": "24ee5991959d36a2fd858e4760ca19a12912a5b9", "node_id": "C_kwDOAAsO6NoAKDI0ZWU1OTkxOTU5ZDM2YTJmZDg1OGU0NzYwY2ExOWExMjkxMmE1Yjk", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2022-11-18T22:48:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-18T22:48:18Z"}, "message": "Rollup merge of #104338 - compiler-errors:pointer-sized, r=eholk\n\nEnforce that `dyn*` coercions are actually pointer-sized\n\nImplement a perma-unstable, rudimentary `PointerSized` trait to enforce `dyn*` casts are `usize`-sized for now, at least to prevent ICEs and weird codegen issues from cropping up after monomorphization since currently we enforce *nothing*.\n\nThis probably can/should be removed in favor of a more sophisticated trait for handling `dyn*` conversions when we decide on one, but I just want to get something up for discussion and experimentation for now.\n\nr? ```@eholk``` cc ```@tmandry``` (though feel free to claim/reassign)\n\nFixes #102141\nFixes #102173", "tree": {"sha": "3aaac9c0346e05ff22b1bdf95c2de14f9d600290", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3aaac9c0346e05ff22b1bdf95c2de14f9d600290"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24ee5991959d36a2fd858e4760ca19a12912a5b9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjeAuyCRBK7hj4Ov3rIwAAS+4IAEI//4e7mIqH3ytrRDNerTw2\nGwmv7A+jwO5YbBx3YNdTkpSHJEdxurStUgAUmKQazcmiLKVFVtFu18+7ex46sMeI\np3MniVqxzDlavtcSY1XmkxkGHSKqmGgfy9gDNyvK3WqlCNwjUxu4gmLCXCQ2WXHy\ndrsIyprZhysx8Antd9wE/vwmpVREwSyPQL1uOOvg0iL6eKeVQrLra1r4qcsPzDWr\nHw2AEDD49jdfb2xqR5OEHClqLCp7tLKPeowP/Ep7WVv2W38BMswOLxhCeXg1AAzp\nRDC6+2QH9ncHqglzSZYm9mXfKiZtQD5M2ODX3JiMtOI9gQxuHfzyzQBqg1TI+P4=\n=Fer+\n-----END PGP SIGNATURE-----\n", "payload": "tree 3aaac9c0346e05ff22b1bdf95c2de14f9d600290\nparent 3181006d83ae9a7c64e8d83693b87259974f0bfd\nparent 39e076a2e7df1407a58efa74bd46de60c7883941\nauthor Manish Goregaokar <manishsmail@gmail.com> 1668811698 -0500\ncommitter GitHub <noreply@github.com> 1668811698 -0500\n\nRollup merge of #104338 - compiler-errors:pointer-sized, r=eholk\n\nEnforce that `dyn*` coercions are actually pointer-sized\n\nImplement a perma-unstable, rudimentary `PointerSized` trait to enforce `dyn*` casts are `usize`-sized for now, at least to prevent ICEs and weird codegen issues from cropping up after monomorphization since currently we enforce *nothing*.\n\nThis probably can/should be removed in favor of a more sophisticated trait for handling `dyn*` conversions when we decide on one, but I just want to get something up for discussion and experimentation for now.\n\nr? ```@eholk``` cc ```@tmandry``` (though feel free to claim/reassign)\n\nFixes #102141\nFixes #102173\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24ee5991959d36a2fd858e4760ca19a12912a5b9", "html_url": "https://github.com/rust-lang/rust/commit/24ee5991959d36a2fd858e4760ca19a12912a5b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24ee5991959d36a2fd858e4760ca19a12912a5b9/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3181006d83ae9a7c64e8d83693b87259974f0bfd", "url": "https://api.github.com/repos/rust-lang/rust/commits/3181006d83ae9a7c64e8d83693b87259974f0bfd", "html_url": "https://github.com/rust-lang/rust/commit/3181006d83ae9a7c64e8d83693b87259974f0bfd"}, {"sha": "39e076a2e7df1407a58efa74bd46de60c7883941", "url": "https://api.github.com/repos/rust-lang/rust/commits/39e076a2e7df1407a58efa74bd46de60c7883941", "html_url": "https://github.com/rust-lang/rust/commit/39e076a2e7df1407a58efa74bd46de60c7883941"}], "stats": {"total": 188, "additions": 180, "deletions": 8}, "files": [{"sha": "a748af65774485d7824e9935429ca0f8f938e61a", "filename": "compiler/rustc_hir/src/lang_items.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Flang_items.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -270,6 +270,8 @@ language_item_table! {\n     TryTraitBranch,          sym::branch,              branch_fn,                  Target::Method(MethodKind::Trait { body: false }), GenericRequirement::None;\n     TryTraitFromYeet,        sym::from_yeet,           from_yeet_fn,               Target::Fn,             GenericRequirement::None;\n \n+    PointerSized,            sym::pointer_sized,       pointer_sized,              Target::Trait,          GenericRequirement::Exact(0);\n+\n     PollReady,               sym::Ready,               poll_ready_variant,         Target::Variant,        GenericRequirement::None;\n     PollPending,             sym::Pending,             poll_pending_variant,       Target::Variant,        GenericRequirement::None;\n "}, {"sha": "c1e4ab600f34f204242165cba1ed560b1fd580cb", "filename": "compiler/rustc_hir_typeck/src/coercion.rs", "status": "modified", "additions": 25, "deletions": 8, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_hir_typeck%2Fsrc%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_hir_typeck%2Fsrc%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fcoercion.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -775,7 +775,7 @@ impl<'f, 'tcx> Coerce<'f, 'tcx> {\n \n         // Check the obligations of the cast -- for example, when casting\n         // `usize` to `dyn* Clone + 'static`:\n-        let obligations = predicates\n+        let mut obligations: Vec<_> = predicates\n             .iter()\n             .map(|predicate| {\n                 // For each existential predicate (e.g., `?Self: Clone`) substitute\n@@ -785,16 +785,33 @@ impl<'f, 'tcx> Coerce<'f, 'tcx> {\n                 let predicate = predicate.with_self_ty(self.tcx, a);\n                 Obligation::new(self.tcx, self.cause.clone(), self.param_env, predicate)\n             })\n-            // Enforce the region bound (e.g., `usize: 'static`, in our example).\n-            .chain([Obligation::new(\n+            .chain([\n+                // Enforce the region bound (e.g., `usize: 'static`, in our example).\n+                Obligation::new(\n+                    self.tcx,\n+                    self.cause.clone(),\n+                    self.param_env,\n+                    ty::Binder::dummy(ty::PredicateKind::TypeOutlives(ty::OutlivesPredicate(\n+                        a, b_region,\n+                    ))),\n+                ),\n+            ])\n+            .collect();\n+\n+        // Enforce that the type is `usize`/pointer-sized. For now, only those\n+        // can be coerced to `dyn*`, except for `dyn* -> dyn*` upcasts.\n+        if !a.is_dyn_star() {\n+            obligations.push(Obligation::new(\n                 self.tcx,\n                 self.cause.clone(),\n                 self.param_env,\n-                self.tcx.mk_predicate(ty::Binder::dummy(ty::PredicateKind::TypeOutlives(\n-                    ty::OutlivesPredicate(a, b_region),\n-                ))),\n-            )])\n-            .collect();\n+                ty::Binder::dummy(ty::TraitRef::new(\n+                    self.tcx.require_lang_item(hir::LangItem::PointerSized, Some(self.cause.span)),\n+                    self.tcx.mk_substs_trait(a, &[]),\n+                ))\n+                .to_poly_trait_predicate(),\n+            ));\n+        }\n \n         Ok(InferOk {\n             value: (vec![Adjustment { kind: Adjust::DynStar, target: b }], b),"}, {"sha": "199b2d32b9d4c1e6b01492321a982f7052713f93", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -1067,6 +1067,7 @@ symbols! {\n         plugins,\n         pointee_trait,\n         pointer,\n+        pointer_sized,\n         poll,\n         position,\n         post_dash_lto: \"post-lto\","}, {"sha": "e5b9ca67b1be67b12128041f2ef82e79aa0d2d3c", "filename": "compiler/rustc_trait_selection/src/traits/select/candidate_assembly.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -304,6 +304,8 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 self.assemble_candidates_for_transmutability(obligation, &mut candidates);\n             } else if lang_items.tuple_trait() == Some(def_id) {\n                 self.assemble_candidate_for_tuple(obligation, &mut candidates);\n+            } else if lang_items.pointer_sized() == Some(def_id) {\n+                self.assemble_candidate_for_ptr_sized(obligation, &mut candidates);\n             } else {\n                 if lang_items.clone_trait() == Some(def_id) {\n                     // Same builtin conditions as `Copy`, i.e., every type which has builtin support\n@@ -1047,4 +1049,30 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n             | ty::Placeholder(_) => {}\n         }\n     }\n+\n+    fn assemble_candidate_for_ptr_sized(\n+        &mut self,\n+        obligation: &TraitObligation<'tcx>,\n+        candidates: &mut SelectionCandidateSet<'tcx>,\n+    ) {\n+        // The regions of a type don't affect the size of the type\n+        let self_ty = self\n+            .tcx()\n+            .erase_regions(self.tcx().erase_late_bound_regions(obligation.predicate.self_ty()));\n+\n+        // But if there are inference variables, we have to wait until it's resolved.\n+        if self_ty.has_non_region_infer() {\n+            candidates.ambiguous = true;\n+            return;\n+        }\n+\n+        let usize_layout =\n+            self.tcx().layout_of(ty::ParamEnv::empty().and(self.tcx().types.usize)).unwrap().layout;\n+        if let Ok(layout) = self.tcx().layout_of(obligation.param_env.and(self_ty))\n+            && layout.layout.size() == usize_layout.size()\n+            && layout.layout.align().abi == usize_layout.align().abi\n+        {\n+            candidates.vec.push(BuiltinCandidate { has_nested: false });\n+        }\n+    }\n }"}, {"sha": "42c342801976957a9696b25b92511653d313b918", "filename": "library/core/src/marker.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/library%2Fcore%2Fsrc%2Fmarker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/library%2Fcore%2Fsrc%2Fmarker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmarker.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -809,6 +809,15 @@ pub trait Destruct {}\n #[cfg_attr(not(bootstrap), rustc_deny_explicit_impl)]\n pub trait Tuple {}\n \n+/// A marker for things\n+#[unstable(feature = \"pointer_sized_trait\", issue = \"none\")]\n+#[cfg_attr(not(bootstrap), lang = \"pointer_sized\")]\n+#[rustc_on_unimplemented(\n+    message = \"`{Self}` needs to be a pointer-sized type\",\n+    label = \"`{Self}` needs to be a pointer-sized type\"\n+)]\n+pub trait PointerSized {}\n+\n /// Implementations of `Copy` for primitive types.\n ///\n /// Implementations that cannot be described in Rust"}, {"sha": "983d7bf6e7e9cdc7e3d7053534651ca41b95180b", "filename": "src/test/ui/dyn-star/align.normal.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.normal.stderr?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,11 @@\n+warning: the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/align.rs:4:12\n+   |\n+LL | #![feature(dyn_star)]\n+   |            ^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+warning: 1 warning emitted\n+"}, {"sha": "6b6fc55d8053eb71861505f62c24082816a29b02", "filename": "src/test/ui/dyn-star/align.over_aligned.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.over_aligned.stderr?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,20 @@\n+warning: the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/align.rs:4:12\n+   |\n+LL | #![feature(dyn_star)]\n+   |            ^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error[E0277]: `AlignedUsize` needs to be a pointer-sized type\n+  --> $DIR/align.rs:15:13\n+   |\n+LL |     let x = AlignedUsize(12) as dyn* Debug;\n+   |             ^^^^^^^^^^^^^^^^ `AlignedUsize` needs to be a pointer-sized type\n+   |\n+   = help: the trait `PointerSized` is not implemented for `AlignedUsize`\n+\n+error: aborting due to previous error; 1 warning emitted\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "fb41a05a0660ba19e45dc5f652b43fdf0f856111", "filename": "src/test/ui/dyn-star/align.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Falign.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,17 @@\n+// revisions: normal over_aligned\n+//[normal] check-pass\n+\n+#![feature(dyn_star)]\n+//~^ WARN the feature `dyn_star` is incomplete and may not be safe to use and/or cause compiler crashes\n+\n+use std::fmt::Debug;\n+\n+#[cfg_attr(over_aligned,      repr(C, align(1024)))]\n+#[cfg_attr(not(over_aligned), repr(C))]\n+#[derive(Debug)]\n+struct AlignedUsize(usize);\n+\n+fn main() {\n+    let x = AlignedUsize(12) as dyn* Debug;\n+    //[over_aligned]~^ ERROR `AlignedUsize` needs to be a pointer-sized type\n+}"}, {"sha": "e19e36cc7d7b5a7ed70400259361b3d009e3f5a8", "filename": "src/test/ui/dyn-star/check-size-at-cast-polymorphic-bad.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,15 @@\n+#![feature(dyn_star)]\n+#![allow(incomplete_features)]\n+\n+use std::fmt::Debug;\n+\n+fn dyn_debug(_: (dyn* Debug + '_)) {\n+\n+}\n+\n+fn polymorphic<T: Debug + ?Sized>(t: &T) {\n+    dyn_debug(t);\n+    //~^ ERROR `&T` needs to be a pointer-sized type\n+}\n+\n+fn main() {}"}, {"sha": "53ccbe43dcc9eea389cb3712f2e88028d378a8b6", "filename": "src/test/ui/dyn-star/check-size-at-cast-polymorphic-bad.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic-bad.stderr?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,15 @@\n+error[E0277]: `&T` needs to be a pointer-sized type\n+  --> $DIR/check-size-at-cast-polymorphic-bad.rs:11:15\n+   |\n+LL |     dyn_debug(t);\n+   |               ^ `&T` needs to be a pointer-sized type\n+   |\n+   = help: the trait `PointerSized` is not implemented for `&T`\n+help: consider introducing a `where` clause, but there might be an alternative better way to express this requirement\n+   |\n+LL | fn polymorphic<T: Debug + ?Sized>(t: &T) where &T: PointerSized {\n+   |                                          ++++++++++++++++++++++\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "5c0a3d256f60742da6c3a2d0b19a428c5f3251b6", "filename": "src/test/ui/dyn-star/check-size-at-cast-polymorphic.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast-polymorphic.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,16 @@\n+// check-pass\n+\n+#![feature(dyn_star)]\n+#![allow(incomplete_features)]\n+\n+use std::fmt::Debug;\n+\n+fn dyn_debug(_: (dyn* Debug + '_)) {\n+\n+}\n+\n+fn polymorphic<T: Debug>(t: &T) {\n+    dyn_debug(t);\n+}\n+\n+fn main() {}"}, {"sha": "1f22f798361541600bc877d8ee90fe2fe0565d2c", "filename": "src/test/ui/dyn-star/check-size-at-cast.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.rs?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,10 @@\n+#![feature(dyn_star)]\n+#![allow(incomplete_features)]\n+\n+use std::fmt::Debug;\n+\n+fn main() {\n+    let i = [1, 2, 3, 4] as dyn* Debug;\n+    //~^ ERROR `[i32; 4]` needs to be a pointer-sized type\n+    dbg!(i);\n+}"}, {"sha": "af2a1ccf71c6d6e7851c389a030aa4a0d43e2c0f", "filename": "src/test/ui/dyn-star/check-size-at-cast.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/24ee5991959d36a2fd858e4760ca19a12912a5b9/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdyn-star%2Fcheck-size-at-cast.stderr?ref=24ee5991959d36a2fd858e4760ca19a12912a5b9", "patch": "@@ -0,0 +1,11 @@\n+error[E0277]: `[i32; 4]` needs to be a pointer-sized type\n+  --> $DIR/check-size-at-cast.rs:7:13\n+   |\n+LL |     let i = [1, 2, 3, 4] as dyn* Debug;\n+   |             ^^^^^^^^^^^^ `[i32; 4]` needs to be a pointer-sized type\n+   |\n+   = help: the trait `PointerSized` is not implemented for `[i32; 4]`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}]}