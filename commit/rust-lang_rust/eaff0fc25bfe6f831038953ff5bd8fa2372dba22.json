{"sha": "eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhZmYwZmMyNWJmZTZmODMxMDM4OTUzZmY1YmQ4ZmEyMzcyZGJhMjI=", "commit": {"author": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-07-29T20:35:03Z"}, "committer": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-07-30T21:12:42Z"}, "message": "Add a hint that the expressions produce a value", "tree": {"sha": "4bb5b69920b362a1476cb59000607c123113c816", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bb5b69920b362a1476cb59000607c123113c816"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEx6scKn6IIf/+FpBu2rpbBylhwYoFAmEEa0oACgkQ2rpbBylh\nwYpjVRAAkPRtAg8xHF/yQJdJjeYvHOS/VMvSEe2xjRVFFtzSbsgieNzwpoS40mYY\nU7FgRf8LQHNOq+FFusvgoJO4vGqr3fjMpxNN8tYVOFPz5wlJOz0zx/oo+ZjBxShx\nTJQfV3Waz/7ayt8GULjBrKDVvMGzGrbh0MJPf38RXbz900uWs82WFAfEwPv7oHM2\n1PrSW3YtgtKGNp7et88otsy7g2ukSqtvS2oUDrMMH/Ipzh79ZFrmxzH+T7I/fNGg\nUtDQJ+lG+rsOx8bEUAl1FPWpZijTOTC02VloZRI1pYnZr/rVagRhT9qsv7UtxOi4\n5B3/L1lFC/0ARZ4QhWaL4ZK6s83ulK/aZGbnTOpA9jV88bKn+r5kX8YyM2z14ZMi\nthfKESP+waPOaCL9pxbuaSPWT6aq3DEfkxgK/8qIQiW8KfZEwQjP58MG1pEkhVux\nC7+ZKAUmO7ShwZvGVscsWt1PXciPm/VOB0yREDNM1M+OYlprdTwE8grVbSdw5mBR\nqxIfpRV9m3iRAfHSgeTFm1cqbC4vvgqjPJlu/akj7soaEp1xCHw3cVbjTVsWm+zs\nMMzvDDO0TkgMphE6AnKgUn8fmOPxwol7I91pvLfyKoo6neI/Huh6zq+lhH6hDt6s\n+IWsrMLMK2MjYW21AQO7Rs7WGfu4C+fXlNM5E5zilMpGkdvQoBQ=\n=bTnV\n-----END PGP SIGNATURE-----", "payload": "tree 4bb5b69920b362a1476cb59000607c123113c816\nparent f3f8e758f2b2abd84b76bcb4ec0b6ae263e1e7b9\nauthor Yuki Okushi <yuki.okushi@huawei.com> 1627590903 +0900\ncommitter Yuki Okushi <yuki.okushi@huawei.com> 1627679562 +0900\n\nAdd a hint that the expressions produce a value\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "html_url": "https://github.com/rust-lang/rust/commit/eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3f8e758f2b2abd84b76bcb4ec0b6ae263e1e7b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3f8e758f2b2abd84b76bcb4ec0b6ae263e1e7b9", "html_url": "https://github.com/rust-lang/rust/commit/f3f8e758f2b2abd84b76bcb4ec0b6ae263e1e7b9"}], "stats": {"total": 155, "additions": 125, "deletions": 30}, "files": [{"sha": "5437174a683cf8abb18f9191c5fa754389209c61", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -161,7 +161,18 @@ impl<'tcx> LateLintPass<'tcx> for UnusedResults {\n \n         if let Some(must_use_op) = must_use_op {\n             cx.struct_span_lint(UNUSED_MUST_USE, expr.span, |lint| {\n-                lint.build(&format!(\"unused {} that must be used\", must_use_op)).emit()\n+                let mut lint = lint.build(&format!(\"unused {} that must be used\", must_use_op));\n+                lint.note(&format!(\"the {} produces a value\", must_use_op));\n+                if let Ok(snippet) = cx.sess().source_map().span_to_snippet(expr.span) {\n+                    lint.span_suggestion(\n+                        expr.span,\n+                        \"use `let _ = ...` to ignore it\",\n+                        format!(\"let _ = {}\", snippet),\n+                        Applicability::MachineApplicable,\n+                    )\n+                    .emit()\n+                }\n+                lint.emit();\n             });\n             op_warned = true;\n         }"}, {"sha": "75a22823329a7beebb66aeff93f6764ce4a8781a", "filename": "src/test/ui/lint/fn_must_use.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Ffn_must_use.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Ffn_must_use.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Ffn_must_use.stderr?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -47,13 +47,17 @@ warning: unused comparison that must be used\n   --> $DIR/fn_must_use.rs:74:5\n    |\n LL |     2 == 3;\n-   |     ^^^^^^\n+   |     ^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 2 == 3`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/fn_must_use.rs:75:5\n    |\n LL |     m == n;\n-   |     ^^^^^^\n+   |     ^^^^^^ help: use `let _ = ...` to ignore it: `let _ = m == n`\n+   |\n+   = note: the comparison produces a value\n \n warning: 8 warnings emitted\n "}, {"sha": "73405d02a2eb5f09b392284c4d74a6e44e99c830", "filename": "src/test/ui/lint/must-use-ops.stderr", "status": "modified", "additions": 62, "deletions": 21, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fmust-use-ops.stderr?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -2,133 +2,174 @@ warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:12:5\n    |\n LL |     val == 1;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val == 1`\n    |\n note: the lint level is defined here\n   --> $DIR/must-use-ops.rs:5:9\n    |\n LL | #![warn(unused_must_use)]\n    |         ^^^^^^^^^^^^^^^\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:13:5\n    |\n LL |     val < 1;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val < 1`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:14:5\n    |\n LL |     val <= 1;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val <= 1`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:15:5\n    |\n LL |     val != 1;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val != 1`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:16:5\n    |\n LL |     val >= 1;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val >= 1`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused comparison that must be used\n   --> $DIR/must-use-ops.rs:17:5\n    |\n LL |     val > 1;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val > 1`\n+   |\n+   = note: the comparison produces a value\n \n warning: unused arithmetic operation that must be used\n   --> $DIR/must-use-ops.rs:20:5\n    |\n LL |     val + 2;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val + 2`\n+   |\n+   = note: the arithmetic operation produces a value\n \n warning: unused arithmetic operation that must be used\n   --> $DIR/must-use-ops.rs:21:5\n    |\n LL |     val - 2;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val - 2`\n+   |\n+   = note: the arithmetic operation produces a value\n \n warning: unused arithmetic operation that must be used\n   --> $DIR/must-use-ops.rs:22:5\n    |\n LL |     val / 2;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val / 2`\n+   |\n+   = note: the arithmetic operation produces a value\n \n warning: unused arithmetic operation that must be used\n   --> $DIR/must-use-ops.rs:23:5\n    |\n LL |     val * 2;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val * 2`\n+   |\n+   = note: the arithmetic operation produces a value\n \n warning: unused arithmetic operation that must be used\n   --> $DIR/must-use-ops.rs:24:5\n    |\n LL |     val % 2;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = val % 2`\n+   |\n+   = note: the arithmetic operation produces a value\n \n warning: unused logical operation that must be used\n   --> $DIR/must-use-ops.rs:27:5\n    |\n LL |     true && true;\n-   |     ^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = true && true`\n+   |\n+   = note: the logical operation produces a value\n \n warning: unused logical operation that must be used\n   --> $DIR/must-use-ops.rs:28:5\n    |\n LL |     false || true;\n-   |     ^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = false || true`\n+   |\n+   = note: the logical operation produces a value\n \n warning: unused bitwise operation that must be used\n   --> $DIR/must-use-ops.rs:31:5\n    |\n LL |     5 ^ val;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 5 ^ val`\n+   |\n+   = note: the bitwise operation produces a value\n \n warning: unused bitwise operation that must be used\n   --> $DIR/must-use-ops.rs:32:5\n    |\n LL |     5 & val;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 5 & val`\n+   |\n+   = note: the bitwise operation produces a value\n \n warning: unused bitwise operation that must be used\n   --> $DIR/must-use-ops.rs:33:5\n    |\n LL |     5 | val;\n-   |     ^^^^^^^\n+   |     ^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 5 | val`\n+   |\n+   = note: the bitwise operation produces a value\n \n warning: unused bitwise operation that must be used\n   --> $DIR/must-use-ops.rs:34:5\n    |\n LL |     5 << val;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 5 << val`\n+   |\n+   = note: the bitwise operation produces a value\n \n warning: unused bitwise operation that must be used\n   --> $DIR/must-use-ops.rs:35:5\n    |\n LL |     5 >> val;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = 5 >> val`\n+   |\n+   = note: the bitwise operation produces a value\n \n warning: unused unary operation that must be used\n   --> $DIR/must-use-ops.rs:38:5\n    |\n LL |     !val;\n-   |     ^^^^\n+   |     ^^^^ help: use `let _ = ...` to ignore it: `let _ = !val`\n+   |\n+   = note: the unary operation produces a value\n \n warning: unused unary operation that must be used\n   --> $DIR/must-use-ops.rs:39:5\n    |\n LL |     -val;\n-   |     ^^^^\n+   |     ^^^^ help: use `let _ = ...` to ignore it: `let _ = -val`\n+   |\n+   = note: the unary operation produces a value\n \n warning: unused unary operation that must be used\n   --> $DIR/must-use-ops.rs:40:5\n    |\n LL |     *val_pointer;\n-   |     ^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = *val_pointer`\n+   |\n+   = note: the unary operation produces a value\n \n warning: 21 warnings emitted\n "}, {"sha": "459381b642ce6815436319d0f185ff18c1c48e13", "filename": "src/test/ui/lint/unused-borrows.stderr", "status": "modified", "additions": 17, "deletions": 6, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Funused-borrows.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Flint%2Funused-borrows.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused-borrows.stderr?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -2,43 +2,54 @@ error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:6:5\n    |\n LL |     &42;\n-   |     ^^^\n+   |     ^^^ help: use `let _ = ...` to ignore it: `let _ = &42`\n    |\n note: the lint level is defined here\n   --> $DIR/unused-borrows.rs:1:9\n    |\n LL | #![deny(unused_must_use)]\n    |         ^^^^^^^^^^^^^^^\n+   = note: the borrow produces a value\n \n error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:9:5\n    |\n LL |     &mut foo(42);\n-   |     ^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = &mut foo(42)`\n+   |\n+   = note: the borrow produces a value\n \n error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:12:5\n    |\n LL |     &&42;\n-   |     ^^^^\n+   |     ^^^^ help: use `let _ = ...` to ignore it: `let _ = &&42`\n+   |\n+   = note: the borrow produces a value\n \n error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:15:5\n    |\n LL |     &&mut 42;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = &&mut 42`\n+   |\n+   = note: the borrow produces a value\n \n error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:18:5\n    |\n LL |     &mut &42;\n-   |     ^^^^^^^^\n+   |     ^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = &mut &42`\n+   |\n+   = note: the borrow produces a value\n \n error: unused borrow that must be used\n   --> $DIR/unused-borrows.rs:23:5\n    |\n LL |     && foo(42);\n-   |     ^^^^^^^^^^\n+   |     ^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = && foo(42)`\n+   |\n+   = note: the borrow produces a value\n \n error: aborting due to 6 previous errors\n "}, {"sha": "7f3817b6ef1cc0633aef58b15c6c47b6a67ccf39", "filename": "src/test/ui/unused/issue-85913.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Funused%2Fissue-85913.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Funused%2Fissue-85913.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused%2Fissue-85913.rs?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -0,0 +1,13 @@\n+#![deny(unused_must_use)]\n+\n+pub fn fun() -> i32 {\n+    function() && return 1;\n+    //~^ ERROR: unused logical operation that must be used\n+    return 0;\n+}\n+\n+fn function() -> bool {\n+    true\n+}\n+\n+fn main() {}"}, {"sha": "d5d99f0f7d33d73df40054762e291711327dcb6a", "filename": "src/test/ui/unused/issue-85913.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Funused%2Fissue-85913.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eaff0fc25bfe6f831038953ff5bd8fa2372dba22/src%2Ftest%2Fui%2Funused%2Fissue-85913.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused%2Fissue-85913.stderr?ref=eaff0fc25bfe6f831038953ff5bd8fa2372dba22", "patch": "@@ -0,0 +1,15 @@\n+error: unused logical operation that must be used\n+  --> $DIR/issue-85913.rs:4:5\n+   |\n+LL |     function() && return 1;\n+   |     ^^^^^^^^^^^^^^^^^^^^^^ help: use `let _ = ...` to ignore it: `let _ = function() && return 1`\n+   |\n+note: the lint level is defined here\n+  --> $DIR/issue-85913.rs:1:9\n+   |\n+LL | #![deny(unused_must_use)]\n+   |         ^^^^^^^^^^^^^^^\n+   = note: the logical operation produces a value\n+\n+error: aborting due to previous error\n+"}]}