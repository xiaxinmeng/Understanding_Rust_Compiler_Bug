{"sha": "a5e5c6775629b912fd058e2a595f70e5457b3d46", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1ZTVjNjc3NTYyOWI5MTJmZDA1OGUyYTU5NWY3MGU1NDU3YjNkNDY=", "commit": {"author": {"name": "Florian Hartwig", "email": "florian.j.hartwig@gmail.com", "date": "2015-11-25T23:21:38Z"}, "committer": {"name": "Florian Hartwig", "email": "florian.j.hartwig@gmail.com", "date": "2015-11-25T23:21:38Z"}, "message": "Add suggestion of similar macro names to `macro undefined` error message", "tree": {"sha": "d9736c9ff57063de8afb11591a5cb12905c38b81", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d9736c9ff57063de8afb11591a5cb12905c38b81"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5e5c6775629b912fd058e2a595f70e5457b3d46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5e5c6775629b912fd058e2a595f70e5457b3d46", "html_url": "https://github.com/rust-lang/rust/commit/a5e5c6775629b912fd058e2a595f70e5457b3d46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5e5c6775629b912fd058e2a595f70e5457b3d46/comments", "author": {"login": "fhartwig", "id": 83271, "node_id": "MDQ6VXNlcjgzMjcx", "avatar_url": "https://avatars.githubusercontent.com/u/83271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fhartwig", "html_url": "https://github.com/fhartwig", "followers_url": "https://api.github.com/users/fhartwig/followers", "following_url": "https://api.github.com/users/fhartwig/following{/other_user}", "gists_url": "https://api.github.com/users/fhartwig/gists{/gist_id}", "starred_url": "https://api.github.com/users/fhartwig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fhartwig/subscriptions", "organizations_url": "https://api.github.com/users/fhartwig/orgs", "repos_url": "https://api.github.com/users/fhartwig/repos", "events_url": "https://api.github.com/users/fhartwig/events{/privacy}", "received_events_url": "https://api.github.com/users/fhartwig/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fhartwig", "id": 83271, "node_id": "MDQ6VXNlcjgzMjcx", "avatar_url": "https://avatars.githubusercontent.com/u/83271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fhartwig", "html_url": "https://github.com/fhartwig", "followers_url": "https://api.github.com/users/fhartwig/followers", "following_url": "https://api.github.com/users/fhartwig/following{/other_user}", "gists_url": "https://api.github.com/users/fhartwig/gists{/gist_id}", "starred_url": "https://api.github.com/users/fhartwig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fhartwig/subscriptions", "organizations_url": "https://api.github.com/users/fhartwig/orgs", "repos_url": "https://api.github.com/users/fhartwig/repos", "events_url": "https://api.github.com/users/fhartwig/events{/privacy}", "received_events_url": "https://api.github.com/users/fhartwig/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edf2198f5fdc4488b354824f6d6947353ae80bcc", "url": "https://api.github.com/repos/rust-lang/rust/commits/edf2198f5fdc4488b354824f6d6947353ae80bcc", "html_url": "https://github.com/rust-lang/rust/commit/edf2198f5fdc4488b354824f6d6947353ae80bcc"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "454b70da8f20976516b4b9ecd0536974b69209a0", "filename": "src/librustc/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -152,7 +152,6 @@ pub mod util {\n     pub mod common;\n     pub mod ppaux;\n     pub mod nodemap;\n-    pub mod lev_distance;\n     pub mod num;\n     pub mod fs;\n }"}, {"sha": "5cdce22d82644cffa614a5375c2776a672a97d5b", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -63,7 +63,6 @@ use rustc::middle::privacy::*;\n use rustc::middle::subst::{ParamSpace, FnSpace, TypeSpace};\n use rustc::middle::ty::{Freevar, FreevarMap, TraitMap, GlobMap};\n use rustc::util::nodemap::{NodeMap, DefIdSet, FnvHashMap};\n-use rustc::util::lev_distance::lev_distance;\n \n use syntax::ast;\n use syntax::ast::{CRATE_NODE_ID, Ident, Name, NodeId, CrateNum, TyIs, TyI8, TyI16, TyI32, TyI64};\n@@ -73,6 +72,7 @@ use syntax::ext::mtwt;\n use syntax::parse::token::{self, special_names, special_idents};\n use syntax::ptr::P;\n use syntax::codemap::{self, Span, Pos};\n+use syntax::util::lev_distance::lev_distance;\n \n use rustc_front::intravisit::{self, FnKind, Visitor};\n use rustc_front::hir;"}, {"sha": "df91db3608932c579e4ba962699ce1fe225633b6", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -110,7 +110,6 @@ use TypeAndSubsts;\n use lint;\n use util::common::{block_query, ErrorReported, indenter, loop_query};\n use util::nodemap::{DefIdMap, FnvHashMap, NodeMap};\n-use util::lev_distance::lev_distance;\n \n use std::cell::{Cell, Ref, RefCell};\n use std::collections::{HashSet};\n@@ -123,6 +122,7 @@ use syntax::codemap::{self, Span, Spanned};\n use syntax::owned_slice::OwnedSlice;\n use syntax::parse::token::{self, InternedString};\n use syntax::ptr::P;\n+use syntax::util::lev_distance::lev_distance;\n \n use rustc_front::intravisit::{self, Visitor};\n use rustc_front::hir;"}, {"sha": "7db9dd9fbeedb8ef48a2a57c593c944e080ea9c7", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -24,6 +24,7 @@ use parse::token;\n use parse::token::{InternedString, intern, str_to_ident};\n use ptr::P;\n use util::small_vector::SmallVector;\n+use util::lev_distance::lev_distance;\n use ext::mtwt;\n use fold::Folder;\n \n@@ -776,6 +777,22 @@ impl<'a> ExtCtxt<'a> {\n     pub fn name_of(&self, st: &str) -> ast::Name {\n         token::intern(st)\n     }\n+\n+    pub fn suggest_macro_name(&mut self, name: &str, span: Span) {\n+        use std::cmp::max;\n+\n+        let mut min: Option<(Name, usize)> = None;\n+        let max_dist = max(name.len() / 3, 1);\n+        for macro_name in self.syntax_env.names.iter() {\n+            let dist = lev_distance(name, &macro_name.as_str());\n+            if dist <= max_dist && (min.is_none() || min.unwrap().1 > dist) {\n+                min = Some((*macro_name, dist));\n+            }\n+        }\n+        if let Some((suggestion, _)) = min {\n+            self.span_help(span, &format!(\"did you mean `{}`?\", suggestion));\n+        }\n+    }\n }\n \n /// Extract a string literal from the macro expanded version of `expr`,"}, {"sha": "01e72cf2a8d849f7352235ca14f8ad4c153abe9e", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -191,6 +191,7 @@ fn expand_mac_invoc<T, F, G>(mac: ast::Mac,\n                 pth.span,\n                 &format!(\"macro undefined: '{}!'\",\n                         &extname));\n+            fld.cx.suggest_macro_name(&extname.as_str(), pth.span);\n \n             // let compilation continue\n             None"}, {"sha": "d245599592108eef5a5fda30bfdd24de9fdc7bb8", "filename": "src/libsyntax/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Flib.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "patch": "@@ -65,6 +65,7 @@ macro_rules! panictry {\n \n pub mod util {\n     pub mod interner;\n+    pub mod lev_distance;\n     pub mod node_count;\n     pub mod parser;\n     #[cfg(test)]"}, {"sha": "28f8510ce3fee150100523f49c455f82e2c6e7c3", "filename": "src/libsyntax/util/lev_distance.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Futil%2Flev_distance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5e5c6775629b912fd058e2a595f70e5457b3d46/src%2Flibsyntax%2Futil%2Flev_distance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Futil%2Flev_distance.rs?ref=a5e5c6775629b912fd058e2a595f70e5457b3d46", "previous_filename": "src/librustc/util/lev_distance.rs"}]}