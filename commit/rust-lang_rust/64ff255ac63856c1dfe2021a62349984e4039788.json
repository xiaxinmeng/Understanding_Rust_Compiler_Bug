{"sha": "64ff255ac63856c1dfe2021a62349984e4039788", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0ZmYyNTVhYzYzODU2YzFkZmUyMDIxYTYyMzQ5OTg0ZTQwMzk3ODg=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-11-19T21:07:49Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-11-19T21:07:49Z"}, "message": "Merge #3432\n\n3432: match_ref_pats: don't emit suggestions inside of a macro r=Manishearth a=flip1995\n\nFixes #2636 \n\nCo-authored-by: flip1995 <hello@philkrones.com>", "tree": {"sha": "deb25e839c9e6856d70339d6d6d65f312b4ecda2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/deb25e839c9e6856d70339d6d6d65f312b4ecda2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64ff255ac63856c1dfe2021a62349984e4039788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64ff255ac63856c1dfe2021a62349984e4039788", "html_url": "https://github.com/rust-lang/rust/commit/64ff255ac63856c1dfe2021a62349984e4039788", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64ff255ac63856c1dfe2021a62349984e4039788/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "0abbc38730d9573f028d183ff545ba91f4f54fb1", "url": "https://api.github.com/repos/rust-lang/rust/commits/0abbc38730d9573f028d183ff545ba91f4f54fb1", "html_url": "https://github.com/rust-lang/rust/commit/0abbc38730d9573f028d183ff545ba91f4f54fb1"}, {"sha": "655a2b4709136546e28961e1f6cccb45155983ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/655a2b4709136546e28961e1f6cccb45155983ff", "html_url": "https://github.com/rust-lang/rust/commit/655a2b4709136546e28961e1f6cccb45155983ff"}], "stats": {"total": 58, "additions": 54, "deletions": 4}, "files": [{"sha": "9e2dac8fef113ffa5e36fd103b83657b7bafd928", "filename": "clippy_lints/src/matches.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/64ff255ac63856c1dfe2021a62349984e4039788/clippy_lints%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ff255ac63856c1dfe2021a62349984e4039788/clippy_lints%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches.rs?ref=64ff255ac63856c1dfe2021a62349984e4039788", "patch": "@@ -18,9 +18,9 @@ use std::collections::Bound;\n use crate::syntax::ast::LitKind;\n use crate::syntax::source_map::Span;\n use crate::utils::paths;\n-use crate::utils::{expr_block, is_allowed, is_expn_of, match_qpath, match_type, multispan_sugg,\n-            remove_blocks, snippet, span_lint_and_sugg, span_lint_and_then,\n-            span_note_and_lint, walk_ptrs_ty};\n+use crate::utils::{expr_block, in_macro, is_allowed, is_expn_of, match_qpath, match_type,\n+    multispan_sugg, remove_blocks, snippet, span_lint_and_sugg, span_lint_and_then,\n+    span_note_and_lint, walk_ptrs_ty};\n use crate::utils::sugg::Sugg;\n use crate::consts::{constant, Constant};\n use crate::rustc_errors::Applicability;\n@@ -457,7 +457,9 @@ fn check_match_ref_pats(cx: &LateContext<'_, '_>, ex: &Expr, arms: &[Arm], expr:\n         }));\n \n         span_lint_and_then(cx, MATCH_REF_PATS, expr.span, title, |db| {\n-            multispan_sugg(db, msg.to_owned(), suggs);\n+            if !in_macro(expr.span) {\n+                multispan_sugg(db, msg.to_owned(), suggs);\n+            }\n         });\n     }\n }"}, {"sha": "3ef9ea8f69fb44baf1dfd5b3ccf846bb2eae95a9", "filename": "tests/ui/ice-2636.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/64ff255ac63856c1dfe2021a62349984e4039788/tests%2Fui%2Fice-2636.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64ff255ac63856c1dfe2021a62349984e4039788/tests%2Fui%2Fice-2636.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fice-2636.rs?ref=64ff255ac63856c1dfe2021a62349984e4039788", "patch": "@@ -0,0 +1,32 @@\n+// Copyright 2014-2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![allow(dead_code)]\n+\n+enum Foo {\n+    A,\n+    B,\n+    C,\n+}\n+\n+macro_rules! test_hash {\n+    ($foo:expr, $($t:ident => $ord:expr),+ ) => {\n+        use self::Foo::*;\n+        match $foo {\n+            $ ( & $t => $ord,\n+            )*\n+        };\n+    };\n+}\n+\n+fn main() {\n+    let a = Foo::A;\n+    test_hash!(&a, A => 0, B => 1, C => 2);\n+}\n+"}, {"sha": "a0806af5da9e807cc4f32b0c8b95d1f279ec7466", "filename": "tests/ui/ice-2636.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/64ff255ac63856c1dfe2021a62349984e4039788/tests%2Fui%2Fice-2636.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/64ff255ac63856c1dfe2021a62349984e4039788/tests%2Fui%2Fice-2636.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fice-2636.stderr?ref=64ff255ac63856c1dfe2021a62349984e4039788", "patch": "@@ -0,0 +1,16 @@\n+error: you don't need to add `&` to both the expression and the patterns\n+  --> $DIR/ice-2636.rs:21:9\n+   |\n+21 | /         match $foo {\n+22 | |             $ ( & $t => $ord,\n+23 | |             )*\n+24 | |         };\n+   | |_________^\n+...\n+30 |       test_hash!(&a, A => 0, B => 1, C => 2);\n+   |       --------------------------------------- in this macro invocation\n+   |\n+   = note: `-D clippy::match-ref-pats` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}]}