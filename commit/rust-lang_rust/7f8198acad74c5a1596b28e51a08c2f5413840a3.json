{"sha": "7f8198acad74c5a1596b28e51a08c2f5413840a3", "node_id": "C_kwDOAAsO6NoAKDdmODE5OGFjYWQ3NGM1YTE1OTZiMjhlNTFhMDhjMmY1NDEzODQwYTM", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2021-11-02T13:44:21Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2021-11-02T16:57:50Z"}, "message": "Advise to put a :: prefix inside the ticks", "tree": {"sha": "c47c79624bd097c6a0c46a8e790a2f39dce320dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c47c79624bd097c6a0c46a8e790a2f39dce320dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f8198acad74c5a1596b28e51a08c2f5413840a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f8198acad74c5a1596b28e51a08c2f5413840a3", "html_url": "https://github.com/rust-lang/rust/commit/7f8198acad74c5a1596b28e51a08c2f5413840a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f8198acad74c5a1596b28e51a08c2f5413840a3/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107", "url": "https://api.github.com/repos/rust-lang/rust/commits/18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107", "html_url": "https://github.com/rust-lang/rust/commit/18cc4e74f89ddcfc9dd873fb8a5e5dfafd850107"}], "stats": {"total": 100, "additions": 64, "deletions": 36}, "files": [{"sha": "44f7ee3b89a4aef3aa58ee83aeecc485a2117ef0", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7f8198acad74c5a1596b28e51a08c2f5413840a3/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f8198acad74c5a1596b28e51a08c2f5413840a3/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=7f8198acad74c5a1596b28e51a08c2f5413840a3", "patch": "@@ -689,10 +689,18 @@ fn check_text(cx: &LateContext<'_>, valid_idents: &FxHashSet<String>, text: &str\n     for word in text.split(|c: char| c.is_whitespace() || c == '\\'') {\n         // Trim punctuation as in `some comment (see foo::bar).`\n         //                                                   ^^\n-        // Or even as in `_foo bar_` which is emphasized.\n-        let word = word.trim_matches(|c: char| !c.is_alphanumeric());\n+        // Or even as in `_foo bar_` which is emphasized. Also preserve `::` as a prefix/suffix.\n+        let mut word = word.trim_matches(|c: char| !c.is_alphanumeric() && c != ':');\n \n-        if valid_idents.contains(word) {\n+        // Remove leading or trailing single `:` which may be part of a sentence.\n+        if word.starts_with(':') && !word.starts_with(\"::\") {\n+            word = word.trim_start_matches(':');\n+        }\n+        if word.ends_with(':') && !word.ends_with(\"::\") {\n+            word = word.trim_end_matches(':');\n+        }\n+\n+        if valid_idents.contains(word) || word.chars().all(|c| c == ':') {\n             continue;\n         }\n "}, {"sha": "e40bb42bee284ff812e3440691b97f5349401b11", "filename": "tests/ui/doc/doc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7f8198acad74c5a1596b28e51a08c2f5413840a3/tests%2Fui%2Fdoc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f8198acad74c5a1596b28e51a08c2f5413840a3/tests%2Fui%2Fdoc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc%2Fdoc.rs?ref=7f8198acad74c5a1596b28e51a08c2f5413840a3", "patch": "@@ -8,7 +8,9 @@\n /// The foo_bar function does _nothing_. See also foo::bar. (note the dot there)\n /// Markdown is _weird_. I mean _really weird_. This \\_ is ok. So is `_`. But not Foo::some_fun\n /// which should be reported only once despite being __doubly bad__.\n-/// Here be ::a::global:path.\n+/// Here be ::a::global:path, and _::another::global::path_.  :: is not a path though.\n+/// Import an item from ::awesome::global::blob:: (Intended postfix)\n+/// These are the options for ::Cat: (Intended trailing single colon, shouldn't be linted)\n /// That's not code ~NotInCodeBlock~.\n /// be_sure_we_got_to_the_end_of_it\n fn foo_bar() {"}, {"sha": "3022e0bfc75aaafea870cf2dd16c3034cbc0deb8", "filename": "tests/ui/doc/doc.stderr", "status": "modified", "additions": 50, "deletions": 32, "changes": 82, "blob_url": "https://github.com/rust-lang/rust/blob/7f8198acad74c5a1596b28e51a08c2f5413840a3/tests%2Fui%2Fdoc%2Fdoc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7f8198acad74c5a1596b28e51a08c2f5413840a3/tests%2Fui%2Fdoc%2Fdoc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc%2Fdoc.stderr?ref=7f8198acad74c5a1596b28e51a08c2f5413840a3", "patch": "@@ -18,173 +18,191 @@ error: you should put `Foo::some_fun` between ticks in the documentation\n LL | /// Markdown is _weird_. I mean _really weird_. This /_ is ok. So is `_`. But not Foo::some_fun\n    |                                                                                   ^^^^^^^^^^^^^\n \n-error: you should put `a::global:path` between ticks in the documentation\n-  --> $DIR/doc.rs:11:15\n+error: you should put `::a::global:path` between ticks in the documentation\n+  --> $DIR/doc.rs:11:13\n    |\n-LL | /// Here be ::a::global:path.\n-   |               ^^^^^^^^^^^^^^\n+LL | /// Here be ::a::global:path, and _::another::global::path_.  :: is not a path though.\n+   |             ^^^^^^^^^^^^^^^^\n+\n+error: you should put `::another::global::path` between ticks in the documentation\n+  --> $DIR/doc.rs:11:36\n+   |\n+LL | /// Here be ::a::global:path, and _::another::global::path_.  :: is not a path though.\n+   |                                    ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: you should put `::awesome::global::blob::` between ticks in the documentation\n+  --> $DIR/doc.rs:12:25\n+   |\n+LL | /// Import an item from ::awesome::global::blob:: (Intended postfix)\n+   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: you should put `::Cat` between ticks in the documentation\n+  --> $DIR/doc.rs:13:31\n+   |\n+LL | /// These are the options for ::Cat: (Intended trailing single colon, shouldn't be linted)\n+   |                               ^^^^^\n \n error: you should put `NotInCodeBlock` between ticks in the documentation\n-  --> $DIR/doc.rs:12:22\n+  --> $DIR/doc.rs:14:22\n    |\n LL | /// That's not code ~NotInCodeBlock~.\n    |                      ^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:13:5\n+  --> $DIR/doc.rs:15:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:27:5\n+  --> $DIR/doc.rs:29:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:34:5\n+  --> $DIR/doc.rs:36:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:48:5\n+  --> $DIR/doc.rs:50:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:71:5\n+  --> $DIR/doc.rs:73:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `link_with_underscores` between ticks in the documentation\n-  --> $DIR/doc.rs:75:22\n+  --> $DIR/doc.rs:77:22\n    |\n LL | /// This test has [a link_with_underscores][chunked-example] inside it. See #823.\n    |                      ^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `inline_link2` between ticks in the documentation\n-  --> $DIR/doc.rs:78:21\n+  --> $DIR/doc.rs:80:21\n    |\n LL | /// It can also be [inline_link2].\n    |                     ^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:88:5\n+  --> $DIR/doc.rs:90:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `CamelCaseThing` between ticks in the documentation\n-  --> $DIR/doc.rs:96:8\n+  --> $DIR/doc.rs:98:8\n    |\n LL | /// ## CamelCaseThing\n    |        ^^^^^^^^^^^^^^\n \n error: you should put `CamelCaseThing` between ticks in the documentation\n-  --> $DIR/doc.rs:99:7\n+  --> $DIR/doc.rs:101:7\n    |\n LL | /// # CamelCaseThing\n    |       ^^^^^^^^^^^^^^\n \n error: you should put `CamelCaseThing` between ticks in the documentation\n-  --> $DIR/doc.rs:101:22\n+  --> $DIR/doc.rs:103:22\n    |\n LL | /// Not a title #897 CamelCaseThing\n    |                      ^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:102:5\n+  --> $DIR/doc.rs:104:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:109:5\n+  --> $DIR/doc.rs:111:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:122:5\n+  --> $DIR/doc.rs:124:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `FooBar` between ticks in the documentation\n-  --> $DIR/doc.rs:133:43\n+  --> $DIR/doc.rs:135:43\n    |\n LL | /** E.g., serialization of an empty list: FooBar\n    |                                           ^^^^^^\n \n error: you should put `BarQuz` between ticks in the documentation\n-  --> $DIR/doc.rs:138:5\n+  --> $DIR/doc.rs:140:5\n    |\n LL | And BarQuz too.\n    |     ^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:139:1\n+  --> $DIR/doc.rs:141:1\n    |\n LL | be_sure_we_got_to_the_end_of_it\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `FooBar` between ticks in the documentation\n-  --> $DIR/doc.rs:144:43\n+  --> $DIR/doc.rs:146:43\n    |\n LL | /** E.g., serialization of an empty list: FooBar\n    |                                           ^^^^^^\n \n error: you should put `BarQuz` between ticks in the documentation\n-  --> $DIR/doc.rs:149:5\n+  --> $DIR/doc.rs:151:5\n    |\n LL | And BarQuz too.\n    |     ^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:150:1\n+  --> $DIR/doc.rs:152:1\n    |\n LL | be_sure_we_got_to_the_end_of_it\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `be_sure_we_got_to_the_end_of_it` between ticks in the documentation\n-  --> $DIR/doc.rs:161:5\n+  --> $DIR/doc.rs:163:5\n    |\n LL | /// be_sure_we_got_to_the_end_of_it\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n-  --> $DIR/doc.rs:188:13\n+  --> $DIR/doc.rs:190:13\n    |\n LL | /// Not ok: http://www.unicode.org\n    |             ^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n-  --> $DIR/doc.rs:189:13\n+  --> $DIR/doc.rs:191:13\n    |\n LL | /// Not ok: https://www.unicode.org\n    |             ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n-  --> $DIR/doc.rs:190:13\n+  --> $DIR/doc.rs:192:13\n    |\n LL | /// Not ok: http://www.unicode.org/\n    |             ^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put bare URLs between `<`/`>` or make a proper Markdown link\n-  --> $DIR/doc.rs:191:13\n+  --> $DIR/doc.rs:193:13\n    |\n LL | /// Not ok: http://www.unicode.org/reports/tr9/#Reordering_Resolved_Levels\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: you should put `mycrate::Collection` between ticks in the documentation\n-  --> $DIR/doc.rs:194:22\n+  --> $DIR/doc.rs:196:22\n    |\n LL | /// An iterator over mycrate::Collection's values.\n    |                      ^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 31 previous errors\n+error: aborting due to 34 previous errors\n "}]}