{"sha": "47a443c50dbeee88cadc78e5c938f3e6d04d6f6b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3YTQ0M2M1MGRiZWVlODhjYWRjNzhlNWM5MzhmM2U2ZDA0ZDZmNmI=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-24T00:13:02Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-10-17T23:16:40Z"}, "message": "Duplicate lint specifications are always bug!\n\nReplace early_error and sess.err with bug!, in all cases. If the\ncompiler we're running with, including plugins, is registering something\ntwice, that's a (compiler/plugin) programmer error -- we should not try\nto be nice at the cost of developer ergononomics (hiding the stacktrace\nof the second registration is bad).\n\nThis also is basically a static bug in ~all cases so it should not be a\ndetriment to users, including with plugins.", "tree": {"sha": "aa9f513c185bfe4f777e94bcdd2befbeb3ebbe33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa9f513c185bfe4f777e94bcdd2befbeb3ebbe33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b", "html_url": "https://github.com/rust-lang/rust/commit/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fa0f7d0080d8e7e9eb20aa9cbf8013f96c81287f", "url": "https://api.github.com/repos/rust-lang/rust/commits/fa0f7d0080d8e7e9eb20aa9cbf8013f96c81287f", "html_url": "https://github.com/rust-lang/rust/commit/fa0f7d0080d8e7e9eb20aa9cbf8013f96c81287f"}], "stats": {"total": 22, "additions": 2, "deletions": 20}, "files": [{"sha": "002c3f662351450d9e797dfc1093f03a8a05d5e2", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 2, "deletions": 20, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47a443c50dbeee88cadc78e5c938f3e6d04d6f6b/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=47a443c50dbeee88cadc78e5c938f3e6d04d6f6b", "patch": "@@ -218,16 +218,7 @@ impl LintStore {\n \n             let id = LintId::of(lint);\n             if self.by_name.insert(lint.name_lower(), Id(id)).is_some() {\n-                let msg = format!(\"duplicate specification of lint {}\", lint.name_lower());\n-                match (sess, from_plugin) {\n-                    // We load builtin lints first, so a duplicate is a compiler bug.\n-                    // Use early_error when handling -W help with no crate.\n-                    (None, _) => early_error(config::ErrorOutputType::default(), &msg[..]),\n-                    (Some(_), false) => bug!(\"{}\", msg),\n-\n-                    // A duplicate name from a plugin is a user error.\n-                    (Some(sess), true)  => sess.err(&msg[..]),\n-                }\n+                bug!(\"duplicate specification of lint {}\", lint.name_lower())\n             }\n         }\n     }\n@@ -300,16 +291,7 @@ impl LintStore {\n         }\n \n         if !new {\n-            let msg = format!(\"duplicate specification of lint group {}\", name);\n-            match (sess, from_plugin) {\n-                // We load builtin lints first, so a duplicate is a compiler bug.\n-                // Use early_error when handling -W help with no crate.\n-                (None, _) => early_error(config::ErrorOutputType::default(), &msg[..]),\n-                (Some(_), false) => bug!(\"{}\", msg),\n-\n-                // A duplicate name from a plugin is a user error.\n-                (Some(sess), true)  => sess.err(&msg[..]),\n-            }\n+            bug!(\"duplicate specification of lint group {}\", name);\n         }\n     }\n "}]}