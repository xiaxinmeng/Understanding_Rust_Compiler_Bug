{"sha": "b950ae44e08c549029368f95d0af833ca1e92016", "node_id": "C_kwDOAAsO6NoAKGI5NTBhZTQ0ZTA4YzU0OTAyOTM2OGY5NWQwYWY4MzNjYTFlOTIwMTY", "commit": {"author": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-09-13T21:39:36Z"}, "committer": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-09-13T22:16:19Z"}, "message": "Update issue-65436-raw-ptr-not-send.rs", "tree": {"sha": "634f5edf8e3e0400654d5d3fc2c8dae502527340", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/634f5edf8e3e0400654d5d3fc2c8dae502527340"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b950ae44e08c549029368f95d0af833ca1e92016", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b950ae44e08c549029368f95d0af833ca1e92016", "html_url": "https://github.com/rust-lang/rust/commit/b950ae44e08c549029368f95d0af833ca1e92016", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b950ae44e08c549029368f95d0af833ca1e92016/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "911c178f038f53b9ac6d63b6ee8fa473a898161d", "url": "https://api.github.com/repos/rust-lang/rust/commits/911c178f038f53b9ac6d63b6ee8fa473a898161d", "html_url": "https://github.com/rust-lang/rust/commit/911c178f038f53b9ac6d63b6ee8fa473a898161d"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "a723503776b9dba540788737919ff36e740ba197", "filename": "src/test/ui/async-await/issues/issue-65436-raw-ptr-not-send.no_drop_tracking.stderr", "status": "renamed", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b950ae44e08c549029368f95d0af833ca1e92016/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.no_drop_tracking.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b950ae44e08c549029368f95d0af833ca1e92016/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.no_drop_tracking.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.no_drop_tracking.stderr?ref=b950ae44e08c549029368f95d0af833ca1e92016", "patch": "@@ -1,5 +1,5 @@\n error: future cannot be sent between threads safely\n-  --> $DIR/issue-65436-raw-ptr-not-send.rs:12:17\n+  --> $DIR/issue-65436-raw-ptr-not-send.rs:16:17\n    |\n LL |       assert_send(async {\n    |  _________________^\n@@ -10,24 +10,24 @@ LL | |     })\n    |\n    = help: within `impl Future<Output = ()>`, the trait `Send` is not implemented for `*const u8`\n note: future is not `Send` as this value is used across an await\n-  --> $DIR/issue-65436-raw-ptr-not-send.rs:14:35\n+  --> $DIR/issue-65436-raw-ptr-not-send.rs:18:35\n    |\n LL |         bar(Foo(std::ptr::null())).await;\n    |                 ----------------  ^^^^^^ await occurs here, with `std::ptr::null()` maybe used later\n    |                 |\n    |                 has type `*const u8` which is not `Send`\n note: `std::ptr::null()` is later dropped here\n-  --> $DIR/issue-65436-raw-ptr-not-send.rs:14:41\n+  --> $DIR/issue-65436-raw-ptr-not-send.rs:18:41\n    |\n LL |         bar(Foo(std::ptr::null())).await;\n    |                                         ^\n help: consider moving this into a `let` binding to create a shorter lived borrow\n-  --> $DIR/issue-65436-raw-ptr-not-send.rs:14:13\n+  --> $DIR/issue-65436-raw-ptr-not-send.rs:18:13\n    |\n LL |         bar(Foo(std::ptr::null())).await;\n    |             ^^^^^^^^^^^^^^^^^^^^^\n note: required by a bound in `assert_send`\n-  --> $DIR/issue-65436-raw-ptr-not-send.rs:9:19\n+  --> $DIR/issue-65436-raw-ptr-not-send.rs:13:19\n    |\n LL | fn assert_send<T: Send>(_: T) {}\n    |                   ^^^^ required by this bound in `assert_send`", "previous_filename": "src/test/ui/async-await/issues/issue-65436-raw-ptr-not-send.stderr"}, {"sha": "91edbc10dc0d770adbf874b234f86a8d30f6e2c0", "filename": "src/test/ui/async-await/issues/issue-65436-raw-ptr-not-send.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b950ae44e08c549029368f95d0af833ca1e92016/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b950ae44e08c549029368f95d0af833ca1e92016/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-65436-raw-ptr-not-send.rs?ref=b950ae44e08c549029368f95d0af833ca1e92016", "patch": "@@ -1,4 +1,8 @@\n // edition:2018\n+// revisions: no_drop_tracking drop_tracking\n+// [drop_tracking] check-pass\n+// [drop_tracking] compile-flags: -Zdrop-tracking=yes\n+// [no_drop_tracking] compile-flags: -Zdrop-tracking=no\n \n struct Foo(*const u8);\n \n@@ -10,7 +14,7 @@ fn assert_send<T: Send>(_: T) {}\n \n fn main() {\n     assert_send(async {\n-    //~^ ERROR future cannot be sent between threads safely\n+        //[no_drop_tracking]~^ ERROR future cannot be sent between threads safely\n         bar(Foo(std::ptr::null())).await;\n     })\n }"}]}