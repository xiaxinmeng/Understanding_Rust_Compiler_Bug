{"sha": "b61071d953019ccfcc8b5c53f737256a1c64230d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2MTA3MWQ5NTMwMTljY2ZjYzhiNWM1M2Y3MzcyNTZhMWM2NDIzMGQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-06-03T03:50:21Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-06-07T01:36:34Z"}, "message": "make lookup fn pure in codemap", "tree": {"sha": "6507577863928b4864c5ac92bfac476410d0fbe6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6507577863928b4864c5ac92bfac476410d0fbe6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b61071d953019ccfcc8b5c53f737256a1c64230d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b61071d953019ccfcc8b5c53f737256a1c64230d", "html_url": "https://github.com/rust-lang/rust/commit/b61071d953019ccfcc8b5c53f737256a1c64230d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b61071d953019ccfcc8b5c53f737256a1c64230d/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83d290f461c8cf3fe65e682162f3acd4a6369478", "url": "https://api.github.com/repos/rust-lang/rust/commits/83d290f461c8cf3fe65e682162f3acd4a6369478", "html_url": "https://github.com/rust-lang/rust/commit/83d290f461c8cf3fe65e682162f3acd4a6369478"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "0fa419cd4a96a6db60adac99ee9825b9141d604b", "filename": "src/libsyntax/codemap.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b61071d953019ccfcc8b5c53f737256a1c64230d/src%2Flibsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b61071d953019ccfcc8b5c53f737256a1c64230d/src%2Flibsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fcodemap.rs?ref=b61071d953019ccfcc8b5c53f737256a1c64230d", "patch": "@@ -77,7 +77,7 @@ fn next_line(file: filemap, chpos: uint, byte_pos: uint) {\n     file.lines += [{ch: chpos, byte: byte_pos + file.start_pos.byte}];\n }\n \n-type lookup_fn = fn@(file_pos) -> uint;\n+type lookup_fn = pure fn(file_pos) -> uint;\n \n fn lookup_line(map: codemap, pos: uint, lookup: lookup_fn)\n     -> {fm: filemap, line: uint}\n@@ -108,12 +108,12 @@ fn lookup_pos(map: codemap, pos: uint, lookup: lookup_fn) -> loc {\n }\n \n fn lookup_char_pos(map: codemap, pos: uint) -> loc {\n-    fn lookup(pos: file_pos) -> uint { ret pos.ch; }\n+    pure fn lookup(pos: file_pos) -> uint { ret pos.ch; }\n     ret lookup_pos(map, pos, lookup);\n }\n \n fn lookup_byte_pos(map: codemap, pos: uint) -> loc {\n-    fn lookup(pos: file_pos) -> uint { ret pos.byte; }\n+    pure fn lookup(pos: file_pos) -> uint { ret pos.byte; }\n     ret lookup_pos(map, pos, lookup);\n }\n \n@@ -139,7 +139,7 @@ fn lookup_char_pos_adj(map: codemap, pos: uint)\n }\n \n fn adjust_span(map: codemap, sp: span) -> span {\n-    fn lookup(pos: file_pos) -> uint { ret pos.ch; }\n+    pure fn lookup(pos: file_pos) -> uint { ret pos.ch; }\n     let line = lookup_line(map, sp.lo, lookup);\n     alt (line.fm.substr) {\n       fss_none {sp}\n@@ -198,7 +198,8 @@ fn get_line(fm: filemap, line: int) -> str unsafe {\n \n fn lookup_byte_offset(cm: codemap::codemap, chpos: uint)\n     -> {fm: filemap, pos: uint} {\n-    let {fm, line} = lookup_line(cm, chpos, {|pos| pos.ch});\n+    pure fn lookup(pos: file_pos) -> uint { ret pos.ch; }\n+    let {fm, line} = lookup_line(cm, chpos, lookup);\n     let line_offset = fm.lines[line].byte - fm.start_pos.byte;\n     let col = chpos - fm.lines[line].ch;\n     let col_offset = str::count_bytes(*fm.src, line_offset, col);"}]}