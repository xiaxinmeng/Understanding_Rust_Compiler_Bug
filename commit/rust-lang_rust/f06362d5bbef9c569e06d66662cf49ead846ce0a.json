{"sha": "f06362d5bbef9c569e06d66662cf49ead846ce0a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwNjM2MmQ1YmJlZjljNTY5ZTA2ZDY2NjYyY2Y0OWVhZDg0NmNlMGE=", "commit": {"author": {"name": "Jeff Olson", "email": "olson.jeffery@gmail.com", "date": "2012-04-12T05:14:45Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-20T22:23:21Z"}, "message": "exporting priv::weaken_task and adding some debug logging", "tree": {"sha": "b8515927dc6ad7b4eac6e5aaacb11dae299a1acc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b8515927dc6ad7b4eac6e5aaacb11dae299a1acc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f06362d5bbef9c569e06d66662cf49ead846ce0a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f06362d5bbef9c569e06d66662cf49ead846ce0a", "html_url": "https://github.com/rust-lang/rust/commit/f06362d5bbef9c569e06d66662cf49ead846ce0a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f06362d5bbef9c569e06d66662cf49ead846ce0a/comments", "author": {"login": "olsonjeffery", "id": 10408, "node_id": "MDQ6VXNlcjEwNDA4", "avatar_url": "https://avatars.githubusercontent.com/u/10408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olsonjeffery", "html_url": "https://github.com/olsonjeffery", "followers_url": "https://api.github.com/users/olsonjeffery/followers", "following_url": "https://api.github.com/users/olsonjeffery/following{/other_user}", "gists_url": "https://api.github.com/users/olsonjeffery/gists{/gist_id}", "starred_url": "https://api.github.com/users/olsonjeffery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olsonjeffery/subscriptions", "organizations_url": "https://api.github.com/users/olsonjeffery/orgs", "repos_url": "https://api.github.com/users/olsonjeffery/repos", "events_url": "https://api.github.com/users/olsonjeffery/events{/privacy}", "received_events_url": "https://api.github.com/users/olsonjeffery/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6667c06c34a25a8a21a1805b4f454f2d05d337c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6667c06c34a25a8a21a1805b4f454f2d05d337c", "html_url": "https://github.com/rust-lang/rust/commit/c6667c06c34a25a8a21a1805b4f454f2d05d337c"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "90fc9239e14db67722ce76241c0b8e4b54637018", "filename": "src/libcore/priv.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f06362d5bbef9c569e06d66662cf49ead846ce0a/src%2Flibcore%2Fpriv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f06362d5bbef9c569e06d66662cf49ead846ce0a/src%2Flibcore%2Fpriv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fpriv.rs?ref=f06362d5bbef9c569e06d66662cf49ead846ce0a", "patch": "@@ -1,6 +1,6 @@\n #[doc(hidden)];\n \n-export chan_from_global_ptr;\n+export chan_from_global_ptr, weaken_task;\n \n import compare_and_swap = rustrt::rust_compare_and_swap_ptr;\n \n@@ -32,8 +32,11 @@ unsafe fn chan_from_global_ptr<T: send>(\n         abort\n     }\n \n+    log(debug,\"ENTERING chan_from_global_ptr, before is_prob_zero check\");\n     let is_probably_zero = *global == 0u;\n+    log(debug,\"after is_prob_zero check\");\n     if is_probably_zero {\n+        log(debug,\"is probably zero...\");\n         // There's no global channel. We must make it\n \n         let setup_po = comm::port();\n@@ -51,14 +54,17 @@ unsafe fn chan_from_global_ptr<T: send>(\n             }\n         };\n \n+        log(debug,\"before setup recv..\");\n         // This is the proposed global channel\n         let ch = comm::recv(setup_po);\n         // 0 is our sentinal value. It is not a valid channel\n         assert unsafe::reinterpret_cast(ch) != 0u;\n \n         // Install the channel\n+        log(debug,\"BEFORE COMPARE AND SWAP\");\n         let swapped = compare_and_swap(\n             global, 0u, unsafe::reinterpret_cast(ch));\n+        log(debug,#fmt(\"AFTER .. swapped? %?\", swapped));\n \n         if swapped {\n             // Success!\n@@ -70,6 +76,7 @@ unsafe fn chan_from_global_ptr<T: send>(\n             unsafe::reinterpret_cast(*global)\n         }\n     } else {\n+        log(debug, \"global != 0\");\n         unsafe::reinterpret_cast(*global)\n     }\n }"}]}