{"sha": "7e824343d32b985b7159cd1872a291cfc33265ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlODI0MzQzZDMyYjk4NWI3MTU5Y2QxODcyYTI5MWNmYzMzMjY1Y2U=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-01-27T11:50:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-27T11:50:49Z"}, "message": "Rollup merge of #68370 - Aaron1011:const-extern-test, r=RalfJung\n\nEnsure that we error when calling \"const extern fn\" with wrong convention\n\nSee #64926", "tree": {"sha": "b7f702a6990ba3d2c0631a85b554551928e136a7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7f702a6990ba3d2c0631a85b554551928e136a7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e824343d32b985b7159cd1872a291cfc33265ce", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeLs6ZCRBK7hj4Ov3rIwAAdHIIACYFxPLzfN4qN7ndNiNjaBg9\nrlq9KnwXLTPbG2A9O37y+4eKOgHj+CcVzeuIFj6nWIdIJfP491RjS0d4bMDcRQvA\n3X1Vp0j4iG4CAMQnoXUAyQ5Zw7ca1z6LCH866LYZoEETM49QSZU3V/FGgyRFhbUv\niwt9oz+q11tiWPeV9rx+nZA5Z5du0DV/Ife5R7Da6LGpDvYF58tbNl/F+nd4Ju2+\n9uaLHWrlO9NmufyL7mQj3TeBC7VWUn0ml9nhazOwobzomew6/iWAhFZsJf20F1u0\nQSytpECZMdT29gCkYFJqHKr7LP0LtSzrAmFY7dIIA2CvB0DB9NxhwPjqEx1A+3w=\n=hGDx\n-----END PGP SIGNATURE-----\n", "payload": "tree b7f702a6990ba3d2c0631a85b554551928e136a7\nparent c8d5f4dcd120c16099ea85eb32588538d4faa14b\nparent 4a650324f83d3a903f740197af972bfa9f95d41a\nauthor Pietro Albini <pietro@pietroalbini.org> 1580125849 +0100\ncommitter GitHub <noreply@github.com> 1580125849 +0100\n\nRollup merge of #68370 - Aaron1011:const-extern-test, r=RalfJung\n\nEnsure that we error when calling \"const extern fn\" with wrong convention\n\nSee #64926\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e824343d32b985b7159cd1872a291cfc33265ce", "html_url": "https://github.com/rust-lang/rust/commit/7e824343d32b985b7159cd1872a291cfc33265ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e824343d32b985b7159cd1872a291cfc33265ce/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8d5f4dcd120c16099ea85eb32588538d4faa14b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8d5f4dcd120c16099ea85eb32588538d4faa14b", "html_url": "https://github.com/rust-lang/rust/commit/c8d5f4dcd120c16099ea85eb32588538d4faa14b"}, {"sha": "4a650324f83d3a903f740197af972bfa9f95d41a", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a650324f83d3a903f740197af972bfa9f95d41a", "html_url": "https://github.com/rust-lang/rust/commit/4a650324f83d3a903f740197af972bfa9f95d41a"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "d8e63b0bfb24ecff8db55724dbc8e285777d202c", "filename": "src/test/ui/consts/miri_unleashed/abi-mismatch.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/7e824343d32b985b7159cd1872a291cfc33265ce/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e824343d32b985b7159cd1872a291cfc33265ce/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.rs?ref=7e824343d32b985b7159cd1872a291cfc33265ce", "patch": "@@ -0,0 +1,16 @@\n+// Checks that we report ABI mismatches for \"const extern fn\"\n+// compile-flags: -Z unleash-the-miri-inside-of-you\n+\n+#![feature(const_extern_fn)]\n+\n+const extern \"C\" fn c_fn() {}\n+\n+const fn call_rust_fn(my_fn: extern \"Rust\" fn()) {\n+    my_fn(); //~ ERROR any use of this value will cause an error\n+    //~^ WARN skipping const checks\n+}\n+\n+const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+//~^ WARN skipping const checks\n+\n+fn main() {}"}, {"sha": "da00c49963eec2778231a36c93a9491e2f403df4", "filename": "src/test/ui/consts/miri_unleashed/abi-mismatch.stderr", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7e824343d32b985b7159cd1872a291cfc33265ce/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7e824343d32b985b7159cd1872a291cfc33265ce/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fabi-mismatch.stderr?ref=7e824343d32b985b7159cd1872a291cfc33265ce", "patch": "@@ -0,0 +1,28 @@\n+warning: skipping const checks\n+  --> $DIR/abi-mismatch.rs:9:5\n+   |\n+LL |     my_fn();\n+   |     ^^^^^^^\n+\n+warning: skipping const checks\n+  --> $DIR/abi-mismatch.rs:13:39\n+   |\n+LL | const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: any use of this value will cause an error\n+  --> $DIR/abi-mismatch.rs:9:5\n+   |\n+LL |     my_fn();\n+   |     ^^^^^^^\n+   |     |\n+   |     tried to call a function with ABI C using caller ABI Rust\n+   |     inside call to `call_rust_fn` at $DIR/abi-mismatch.rs:13:17\n+...\n+LL | const VAL: () = call_rust_fn(unsafe { std::mem::transmute(c_fn as extern \"C\" fn()) });\n+   | --------------------------------------------------------------------------------------\n+   |\n+   = note: `#[deny(const_err)]` on by default\n+\n+error: aborting due to previous error\n+"}]}