{"sha": "bdef57ea45594752f904983effc81fe938fbdfe9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkZWY1N2VhNDU1OTQ3NTJmOTA0OTgzZWZmYzgxZmU5MzhmYmRmZTk=", "commit": {"author": {"name": "Samrat Man Singh", "email": "samratmansingh@gmail.com", "date": "2020-08-04T15:10:48Z"}, "committer": {"name": "Samrat Man Singh", "email": "samratmansingh@gmail.com", "date": "2020-08-04T15:10:48Z"}, "message": "Flush to stdout from FileDescriptor::write for `Stdout`\n\nAlso, remove unnecessary `-Zmiri-disable-isolation` in test", "tree": {"sha": "477928c84ff5ef86efe7f341e02083a50310faf0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/477928c84ff5ef86efe7f341e02083a50310faf0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdef57ea45594752f904983effc81fe938fbdfe9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdef57ea45594752f904983effc81fe938fbdfe9", "html_url": "https://github.com/rust-lang/rust/commit/bdef57ea45594752f904983effc81fe938fbdfe9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdef57ea45594752f904983effc81fe938fbdfe9/comments", "author": {"login": "samrat", "id": 480806, "node_id": "MDQ6VXNlcjQ4MDgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/480806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samrat", "html_url": "https://github.com/samrat", "followers_url": "https://api.github.com/users/samrat/followers", "following_url": "https://api.github.com/users/samrat/following{/other_user}", "gists_url": "https://api.github.com/users/samrat/gists{/gist_id}", "starred_url": "https://api.github.com/users/samrat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samrat/subscriptions", "organizations_url": "https://api.github.com/users/samrat/orgs", "repos_url": "https://api.github.com/users/samrat/repos", "events_url": "https://api.github.com/users/samrat/events{/privacy}", "received_events_url": "https://api.github.com/users/samrat/received_events", "type": "User", "site_admin": false}, "committer": {"login": "samrat", "id": 480806, "node_id": "MDQ6VXNlcjQ4MDgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/480806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samrat", "html_url": "https://github.com/samrat", "followers_url": "https://api.github.com/users/samrat/followers", "following_url": "https://api.github.com/users/samrat/following{/other_user}", "gists_url": "https://api.github.com/users/samrat/gists{/gist_id}", "starred_url": "https://api.github.com/users/samrat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samrat/subscriptions", "organizations_url": "https://api.github.com/users/samrat/orgs", "repos_url": "https://api.github.com/users/samrat/repos", "events_url": "https://api.github.com/users/samrat/events{/privacy}", "received_events_url": "https://api.github.com/users/samrat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bea7113eb8b3ce63b95a9c6a4f8d39c7f912d9e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/bea7113eb8b3ce63b95a9c6a4f8d39c7f912d9e1", "html_url": "https://github.com/rust-lang/rust/commit/bea7113eb8b3ce63b95a9c6a4f8d39c7f912d9e1"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "151ab95f1e3c4d278d89a0972ce9ec0b2cda9350", "filename": "src/shims/posix/foreign_items.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bdef57ea45594752f904983effc81fe938fbdfe9/src%2Fshims%2Fposix%2Fforeign_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdef57ea45594752f904983effc81fe938fbdfe9/src%2Fshims%2Fposix%2Fforeign_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fposix%2Fforeign_items.rs?ref=bdef57ea45594752f904983effc81fe938fbdfe9", "patch": "@@ -1,5 +1,3 @@\n-use std::io::{self, Write};\n-\n use log::trace;\n \n use rustc_middle::mir;\n@@ -76,9 +74,6 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                 let count = this.read_scalar(n)?.to_machine_usize(this)?;\n                 trace!(\"Called write({:?}, {:?}, {:?})\", fd, buf, count);\n                 let result = this.write(fd, buf, count)?;\n-                if fd == 1 {\n-                    io::stdout().flush().unwrap();\n-                }\n                 // Now, `result` is the value we return back to the program.\n                 this.write_scalar(Scalar::from_machine_isize(result, this), dest)?;\n             }"}, {"sha": "3e1ba3976f776a783fce15a674c6f8facbf03b69", "filename": "src/shims/posix/fs.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bdef57ea45594752f904983effc81fe938fbdfe9/src%2Fshims%2Fposix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdef57ea45594752f904983effc81fe938fbdfe9/src%2Fshims%2Fposix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fposix%2Ffs.rs?ref=bdef57ea45594752f904983effc81fe938fbdfe9", "patch": "@@ -76,7 +76,15 @@ impl<'tcx> FileDescriptor<'tcx> for io::Stdout {\n     }\n \n     fn write(&mut self, bytes: &[u8]) -> InterpResult<'tcx, io::Result<usize>> {\n-        Ok(Write::write(self, bytes))\n+        let result = Write::write(self, bytes);\n+        // Stdout is buffered, flush to make sure it appears on the\n+        // screen.  This is the write() syscall of the interpreted\n+        // program, we want it to correspond to a write() syscall on\n+        // the host -- there is no good in adding extra buffering\n+        // here.\n+        io::stdout().flush().unwrap();\n+\n+        Ok(result)\n     }\n \n     fn seek(&mut self, _offset: SeekFrom) -> InterpResult<'tcx, io::Result<u64>> {"}, {"sha": "c2754636c860c9d74bf0c7e7c7f8f198bf2715cb", "filename": "tests/compile-fail/fs/write_to_stdin.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bdef57ea45594752f904983effc81fe938fbdfe9/tests%2Fcompile-fail%2Ffs%2Fwrite_to_stdin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdef57ea45594752f904983effc81fe938fbdfe9/tests%2Fcompile-fail%2Ffs%2Fwrite_to_stdin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Ffs%2Fwrite_to_stdin.rs?ref=bdef57ea45594752f904983effc81fe938fbdfe9", "patch": "@@ -1,4 +1,3 @@\n-// compile-flags: -Zmiri-disable-isolation\n // ignore-windows: No libc on Windows\n \n #![feature(rustc_private)]"}]}