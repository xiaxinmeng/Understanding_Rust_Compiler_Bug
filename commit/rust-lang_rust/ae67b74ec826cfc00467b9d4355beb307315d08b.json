{"sha": "ae67b74ec826cfc00467b9d4355beb307315d08b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlNjdiNzRlYzgyNmNmYzAwNDY3YjlkNDM1NWJlYjMwNzMxNWQwOGI=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2014-04-28T16:57:26Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2014-05-20T19:37:08Z"}, "message": "Make configure respect (and save) values for `CC`, `CXX`, `CFLAGS`, etc.\n\nI mostly tried to remain backwards compatible with old invocations of\nthe `configure` script; if you do not want to use `CC` et al., you\nshould not have to; you can keep using `--enable-clang` and/or\n`--enable-ccache`.\n\nThe overall intention is to capture the following precedences for\nguessing the C compiler:\n\n 1. Value of `CC` at make invocation time.\n 2. Value of `CC` at configure invocation time.\n 3. Compiler inferred at configure invocation time (`gcc` or `clang`).\n\nThe strategy is to check (at `configure` time) if each of the\nenvironment variables is set, and if so, save its value in a\ncorresponding `CFG_` variable (e.g. `CFG_CC`).\n\nThen, in the makefiles, if `CC` is not set but `CFG_CC` is, then we\nuse the `CFG_CC` setting as `CC`.\n\nAlso, I fold the potential user-provided `CFLAGS` and `CXXFLAGS`\nvalues into all of the per-platform `CFLAGS` and `CXXFLAGS` settings.\n(This was opposed to adding `$(CFLAGS)` in an ad-hoc manner to various\nparts of the mk files.)\n\nFix #13805.\n\n----\n\nNote that if you try to set the compiler to clang via the `CC` and\n`CXX` environment variables, you will probably need to also set\n`CXXFLAGS` to `--enable-libcpp` so that LLVM will be configured\nproperly.\n\n----\n\nIntroduce CFG_USING_CLANG, which is distinguished from\nCFG_ENABLE_CLANG because the former represents \"we think we're using\nclang, choose appropriate warning-control options\" while the latter\nrepresents \"we asked configure (or the host required) that we attempt\nto use clang, so check that we have an appropriate version of clang.\"\n\nThe main reason I added this is that I wanted to allow the user to\nchoose clang via setting the `CC` environment variable, but I did not\nwant that method of selection to get confused with the user passing\nthe `--enable-clang` option.\n\n----\n\nA digression: The `configure` script does not infer the compiler\nsetting if `CC` is set; but if `--enable-clang` was passed, then it\n*does* still attempt to validate that the clang version is compatible.\n\nSupporting this required revising `CLANG_VERSION` check to be robust\nin face of user-provided `CC` value.\n\nIn particular, on Travis, the `CC` is set to `gcc` and so the natural\nthing to do is to attempt to use `gcc` as the compiler, but Travis is\nalso passing `--enable-clang` to configure.  So, what is the right\nanswer in the face of these contradictory requests?\n\nOne approach would be to have `--enable-clang` supersede the setting\nfor `CC` (and instead just call whatever we inferred for `CFG_CLANG`).\nThat sounds maximally inflexible to me (pnkfelix): a developer\nrequesting a `CC` value probably wants it respected, and should be\nable to set it to something else; it is harder for that developer to\nhack our configure script to change its inferred path to clang.\n\nA second approach would be to blindly use the `CC` value but keep\ngoing through the clang version check when `--enable-clang` is turned\non.  But on Travis (a Linux host), the `gcc` invocation won't print a\nclang version, so we would not get past the CLANG_VERSION check in\nthat context.\n\nA third approach would be to never run the CLANG_VERSION check if `CC`\nis explicitly set.  That is not a terrible idea; but if the user uses\n`CC` to pass in a path to some other version of clang that they want\nto test, probably should still send that through the `CLANG_VERSION`\ncheck.\n\nSo in the end I (pnkfelix) took a fourth approach: do the\nCLANG_VERSION check if `CC` is unset *or* if `CC` is set to a string\nending with `clang`.  This way setting `CC` to things like\n`path/to/clang` or `ccache clang` will still go through the\nCLANG_VERSION check, while setting `CC` to `gcc` or some unknown\ncompiler will skip the CLANG_VERSION check (regardless of whether the\nuser passed --enable-clang to `configure`).\n\n----\n\nDrive-by fixes:\n\n* The call that sets `CFG_CLANG_VERSION` was quoting `\"$CFG_CC\"` in\n  its invocation, but that does not play nicely with someone who sets\n  `$CFG_CC` to e.g. `ccache clang`, since you do not want to intepret\n  that whole string as a command.\n\n  (On the other hand, a path with spaces might need the quoted\n  invocation.  Not sure which one of these corner use-cases is more\n  important to support.)\n\n* Fix chk_cc error message to point user at `gcc` not `cc`.", "tree": {"sha": "97212c16cb3750ce57ecc172403e4be5bc0abaaa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97212c16cb3750ce57ecc172403e4be5bc0abaaa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae67b74ec826cfc00467b9d4355beb307315d08b", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae67b74ec826cfc00467b9d4355beb307315d08b", "html_url": "https://github.com/rust-lang/rust/commit/ae67b74ec826cfc00467b9d4355beb307315d08b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae67b74ec826cfc00467b9d4355beb307315d08b/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84320a4f4bd31206f4a93b82190a867340035135", "url": "https://api.github.com/repos/rust-lang/rust/commits/84320a4f4bd31206f4a93b82190a867340035135", "html_url": "https://github.com/rust-lang/rust/commit/84320a4f4bd31206f4a93b82190a867340035135"}], "stats": {"total": 294, "additions": 176, "deletions": 118}, "files": [{"sha": "f4cac4cbe85ae261c13326cd90e7aeef28016d25", "filename": "configure", "status": "modified", "additions": 119, "deletions": 31, "changes": 150, "blob_url": "https://github.com/rust-lang/rust/blob/ae67b74ec826cfc00467b9d4355beb307315d08b/configure", "raw_url": "https://github.com/rust-lang/rust/raw/ae67b74ec826cfc00467b9d4355beb307315d08b/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=ae67b74ec826cfc00467b9d4355beb307315d08b", "patch": "@@ -223,6 +223,30 @@ opt() {\n      fi\n }\n \n+envopt() {\n+    local NAME=$1\n+    local V=\"CFG_${NAME}\"\n+    eval VV=\\$$V\n+\n+    # If configure didn't set a value already, then check environment.\n+    #\n+    # (It is recommended that the configure script always check the\n+    # environment before setting any values to envopt variables; see\n+    # e.g.  how CFG_CC is handled, where it first checks `-z \"$CC\"`,\n+    # and issues msg if it ends up employing that provided value.)\n+    if [ -z \"$VV\" ]\n+    then\n+        eval $V=\\$$NAME\n+        eval VV=\\$$V\n+    fi\n+\n+    # If script or environment provided a value, save it.\n+    if [ ! -z \"$VV\" ]\n+    then\n+        putvar $V\n+    fi\n+}\n+\n msg \"looking for configure programs\"\n need_cmd cmp\n need_cmd mkdir\n@@ -621,7 +645,7 @@ then\n             if !((chk_cc gcc clang  && chk_cc g++ clang) ||\n                 (chk_cc gcc gcc  &&( chk_cc g++ g++ || chk g++ gcc))) then\n                 err \"the gcc and g++ in your path point to different compilers.\n-    Check which versions are in your path with  cc --version and g++ --version.\n+    Check which versions are in your path with gcc --version and g++ --version.\n     To resolve this problem, either fix your PATH  or run configure with --enable-clang\"\n             fi\n \n@@ -646,41 +670,101 @@ then\n     esac\n fi\n \n-if [ ! -z \"$CFG_ENABLE_CLANG\" ]\n+# Even when the user overrides the choice of CC, still try to detect\n+# clang to disable some clang-specific warnings.  We here draw a\n+# distinction between:\n+#\n+#  CFG_ENABLE_CLANG : passed --enable-clang, or host \"requires\" clang,\n+#  CFG_USING_CLANG : compiler (clang / gcc / $CC) looks like clang.\n+#\n+# This distinction is important because there are some safeguards we\n+# would prefer to skip when merely CFG_USING_CLANG is set; but when\n+# CFG_ENABLE_CLANG is set, that indicates that we are opting into\n+# running such safeguards.\n+\n+if [ ! -z \"$CC\" ]\n then\n-    if [ -z \"$CFG_CLANG\" ]\n+    msg \"skipping compiler inference steps; using provided CC=$CC\"\n+    CFG_CC=\"$CC\"\n+\n+    CFG_OSX_CC_VERSION=$(\"$CFG_CC\" --version 2>&1 | grep \"clang\")\n+    if [ $? -eq 0 ]\n     then\n-        err \"clang requested but not found\"\n+        step_msg \"note, user-provided CC looks like clang; CC=$CC.\"\n+        CFG_USING_CLANG=1\n+        putvar CFG_USING_CLANG\n     fi\n-    CFG_CLANG_VERSION=$(\"$CFG_CLANG\" \\\n-                      --version \\\n-                      | grep version \\\n-                      | sed 's/.*\\(version .*\\)/\\1/; s/.*based on \\(LLVM .*\\))/\\1/' \\\n-                      | cut -d ' ' -f 2)\n-\n-    case $CFG_CLANG_VERSION in\n-        (3.0svn | 3.0 | 3.1* | 3.2* | 3.3* | 3.4* | 3.5* )\n-        step_msg \"found ok version of CLANG: $CFG_CLANG_VERSION\"\n-        CFG_C_COMPILER=\"clang\"\n-        ;;\n-        (*)\n-        err \"bad CLANG version: $CFG_CLANG_VERSION, need >=3.0svn\"\n-        ;;\n-    esac\n else\n-    CFG_C_COMPILER=\"gcc\"\n+    if [ ! -z \"$CFG_ENABLE_CLANG\" ]\n+    then\n+        if [ -z \"$CFG_CLANG\" ]\n+        then\n+            err \"clang requested but not found\"\n+        fi\n+        CFG_CC=\"$CFG_CLANG\"\n+        CFG_USING_CLANG=1\n+        putvar CFG_USING_CLANG\n+    else\n+        CFG_CC=\"gcc\"\n+    fi\n+fi\n+\n+if [ ! -z \"$CFG_ENABLE_CLANG\" ]\n+then\n+    if [ -z \"$CC\" ] || [[ $CC == *clang ]]\n+    then\n+        CFG_CLANG_VERSION=$($CFG_CC \\\n+            --version \\\n+            | grep version \\\n+            | sed 's/.*\\(version .*\\)/\\1/; s/.*based on \\(LLVM .*\\))/\\1/' \\\n+            | cut -d ' ' -f 2)\n+\n+        case $CFG_CLANG_VERSION in\n+            (3.0svn | 3.0 | 3.1* | 3.2* | 3.3* | 3.4* | 3.5* )\n+            step_msg \"found ok version of CLANG: $CFG_CLANG_VERSION\"\n+            if [ -z \"$CC\" ]\n+            then\n+                CFG_CC=\"clang\"\n+            fi\n+            ;;\n+            (*)\n+            err \"bad CLANG version: $CFG_CLANG_VERSION, need >=3.0svn\"\n+            ;;\n+        esac\n+    else\n+        msg \"skipping CFG_ENABLE_CLANG version check; provided CC=$CC\"\n+    fi\n fi\n \n if [ ! -z \"$CFG_ENABLE_CCACHE\" ]\n then\n-    if [ -z \"$CFG_CCACHE\" ]\n+    if [ -z \"$CC\" ]\n     then\n-        err \"ccache requested but not found\"\n+        if [ -z \"$CFG_CCACHE\" ]\n+        then\n+            err \"ccache requested but not found\"\n+        fi\n+\n+        CFG_CC=\"ccache $CFG_CC\"\n     fi\n+fi\n \n-    CFG_C_COMPILER=\"ccache $CFG_C_COMPILER\"\n+if [ -z \"$CC\" -a -z \"$CFG_ENABLE_CLANG\" -a -z \"$CFG_GCC\" ]\n+then\n+    err \"either clang or gcc is required\"\n fi\n \n+# All safeguards based on $CFG_ENABLE_CLANG should occur before this\n+# point in the script; after this point, script logic should inspect\n+# $CFG_USING_CLANG rather than $CFG_ENABLE_CLANG.\n+\n+# Set CFG_{CC,CXX,CPP,CFLAGS,CXXFLAGS}\n+envopt CC\n+envopt CXX\n+envopt CPP\n+envopt CFLAGS\n+envopt CXXFLAGS\n+\n # a little post-processing of various config values\n CFG_PREFIX=${CFG_PREFIX%/}\n CFG_MANDIR=${CFG_MANDIR%/}\n@@ -742,11 +826,6 @@ do\n     esac\n done\n \n-if [ -z \"$CFG_ENABLE_CLANG\" -a -z \"$CFG_GCC\" ]\n-then\n-    err \"either clang or gcc is required\"\n-fi\n-\n if [ ! -z \"$CFG_PERF\" ]\n then\n     HAVE_PERF_LOGFD=`$CFG_PERF stat --log-fd 2>&1 | grep 'unknown option'`\n@@ -961,7 +1040,7 @@ do\n             ;;\n         esac\n \n-        case \"$CFG_C_COMPILER\" in\n+        case \"$CFG_CC\" in\n             (\"ccache clang\")\n             LLVM_CXX_32=\"ccache clang++ -m32 -Qunused-arguments\"\n             LLVM_CC_32=\"ccache clang -m32 -Qunused-arguments\"\n@@ -991,6 +1070,16 @@ do\n \n             LLVM_CXX_64=\"g++\"\n             LLVM_CC_64=\"gcc\"\n+            ;;\n+\n+            (*)\n+            msg \"inferring LLVM_CXX/CC from CXX/CC = $CXX/$CC\"\n+            LLVM_CXX_32=\"$CXX -m32\"\n+            LLVM_CC_32=\"$CC -m32\"\n+\n+            LLVM_CXX_64=\"$CXX\"\n+            LLVM_CC_64=\"$CC\"\n+            ;;\n         esac\n \n         LLVM_CFLAGS_32=\"-m32\"\n@@ -1073,7 +1162,6 @@ putvar CFG_PREFIX\n putvar CFG_BUILD\n putvar CFG_HOST\n putvar CFG_TARGET\n-putvar CFG_C_COMPILER\n putvar CFG_LIBDIR\n putvar CFG_LIBDIR_RELATIVE\n putvar CFG_DISABLE_MANAGE_SUBMODULES\n@@ -1084,7 +1172,7 @@ putvar CFG_DISABLE_INJECT_STD_VERSION\n \n # Avoid spurious warnings from clang by feeding it original source on\n # ccache-miss rather than preprocessed input.\n-if [ ! -z \"$CFG_ENABLE_CCACHE\" ] && [ ! -z \"$CFG_ENABLE_CLANG\" ]\n+if [ ! -z \"$CFG_ENABLE_CCACHE\" ] && [ ! -z \"$CFG_USING_CLANG\" ]\n then\n     CFG_CCACHE_CPP2=1\n     putvar CFG_CCACHE_CPP2"}, {"sha": "ecc4c33d154841e80fceb022a67fafa549d3710e", "filename": "mk/platform.mk", "status": "modified", "additions": 57, "deletions": 87, "changes": 144, "blob_url": "https://github.com/rust-lang/rust/blob/ae67b74ec826cfc00467b9d4355beb307315d08b/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/ae67b74ec826cfc00467b9d4355beb307315d08b/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=ae67b74ec826cfc00467b9d4355beb307315d08b", "patch": "@@ -81,57 +81,27 @@ CFG_DEPEND_FLAGS = -MMD -MP -MT $(1) -MF $(1:%.o=%.d)\n \n AR := ar\n \n-CFG_INFO := $(info cfg: using $(CFG_C_COMPILER))\n-ifeq ($(CFG_C_COMPILER),clang)\n-  # The -Qunused-arguments sidesteps spurious warnings from clang\n-  ifeq ($(origin CC),default)\n-    CC=clang -Qunused-arguments\n-  endif\n-  ifeq ($(origin CXX),default)\n-    CXX=clang++ -Qunused-arguments\n-  endif\n-  ifeq ($(origin CPP),default)\n-    CPP=clang -Qunused-arguments\n-  endif\n-else\n-ifeq ($(CFG_C_COMPILER),gcc)\n-  ifeq ($(origin CC),default)\n-    CC=gcc\n-  endif\n-  ifeq ($(origin CXX),default)\n-    CXX=g++\n-  endif\n-  ifeq ($(origin CPP),default)\n-    CPP=gcc\n+define SET_FROM_CFG\n+  ifdef CFG_$(1)\n+    ifeq ($(origin $(1)),undefined)\n+      $$(info cfg: using $(1)=$(CFG_$(1)) (CFG_$(1)))\n+      $(1)=$(CFG_$(1))\n+    endif\n+    ifeq ($(origin $(1)),default)\n+      $$(info cfg: using $(1)=$(CFG_$(1)) (CFG_$(1)))\n+      $(1)=$(CFG_$(1))\n+    endif\n   endif\n-else\n-ifeq ($(CFG_C_COMPILER),ccache clang)\n+endef\n+\n+$(foreach cvar,CC CXX CPP CFLAGS CXXFLAGS CPPFLAGS,\\\n+  $(eval $(call SET_FROM_CFG,$(cvar))))\n+\n+ifeq ($(CFG_USING_CLANG),1)\n   # The -Qunused-arguments sidesteps spurious warnings from clang\n-  ifeq ($(origin CC),default)\n-    CC=ccache clang -Qunused-arguments\n-  endif\n-  ifeq ($(origin CXX),default)\n-    CXX=ccache clang++ -Qunused-arguments\n-  endif\n-  ifeq ($(origin CPP),default)\n-    CPP=ccache clang -Qunused-arguments\n-  endif\n-else\n-ifeq ($(CFG_C_COMPILER),ccache gcc)\n-  ifeq ($(origin CC),default)\n-    CC=ccache gcc\n-  endif\n-  ifeq ($(origin CXX),default)\n-    CXX=ccache g++\n-  endif\n-  ifeq ($(origin CPP),default)\n-    CPP=ccache gcc\n-  endif\n-else\n-  CFG_ERR := $(error please try on a system with gcc or clang)\n-endif\n-endif\n-endif\n+  CFLAGS += -Qunused-arguments\n+  CXXFLAGS += -Qunused-arguments\n+  CPPFLAGS += -Qunused-arguments\n endif\n \n CFG_RLIB_GLOB=lib$(1)-*.rlib\n@@ -173,9 +143,9 @@ CFG_LIB_NAME_i686-unknown-linux-gnu=lib$(1).so\n CFG_STATIC_LIB_NAME_i686-unknown-linux-gnu=lib$(1).a\n CFG_LIB_GLOB_i686-unknown-linux-gnu=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_i686-unknown-linux-gnu=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_i686-unknown-linux-gnu := -m32\n-CFG_GCCISH_CFLAGS_i686-unknown-linux-gnu := -Wall -Werror -g -fPIC -m32\n-CFG_GCCISH_CXXFLAGS_i686-unknown-linux-gnu := -fno-rtti\n+CFG_CFLAGS_i686-unknown-linux-gnu := -m32 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_i686-unknown-linux-gnu := -Wall -Werror -g -fPIC -m32 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_i686-unknown-linux-gnu := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_i686-unknown-linux-gnu := -shared -fPIC -ldl -pthread  -lrt -g -m32\n CFG_GCCISH_DEF_FLAG_i686-unknown-linux-gnu := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_i686-unknown-linux-gnu := -Wl,-whole-archive\n@@ -203,9 +173,9 @@ AR_arm-apple-darwin = $(shell xcrun -find -sdk iphoneos ar)\n CFG_LIB_NAME_arm-apple-darwin = lib$(1).dylib\n CFG_LIB_GLOB_arm-apple-darwin = lib$(1)-*.dylib\n CFG_LIB_DSYM_GLOB_arm-apple-darwin = lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_arm-apple-darwin := $(CFG_IOS_FLAGS)\n-CFG_GCCISH_CFLAGS_arm-apple-darwin := -Wall -Werror -g -fPIC $(CFG_IOS_FLAGS)\n-CFG_GCCISH_CXXFLAGS_arm-apple-darwin := -fno-rtti $(CFG_IOS_FLAGS)\n+CFG_CFLAGS_arm-apple-darwin := $(CFG_IOS_FLAGS) $(CFLAGS)\n+CFG_GCCISH_CFLAGS_arm-apple-darwin := -Wall -Werror -g -fPIC $(CFG_IOS_FLAGS) $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_arm-apple-darwin := -fno-rtti $(CFG_IOS_FLAGS) $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_arm-apple-darwin := -dynamiclib -lpthread -framework CoreServices -Wl,-no_compact_unwind\n CFG_GCCISH_DEF_FLAG_arm-apple-darwin := -Wl,-exported_symbols_list,\n CFG_GCCISH_PRE_LIB_FLAGS_arm-apple-darwin :=\n@@ -232,9 +202,9 @@ CFG_LIB_NAME_x86_64-apple-darwin=lib$(1).dylib\n CFG_STATIC_LIB_NAME_x86_64-apple-darwin=lib$(1).a\n CFG_LIB_GLOB_x86_64-apple-darwin=lib$(1)-*.dylib\n CFG_LIB_DSYM_GLOB_x86_64-apple-darwin=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_x86_64-apple-darwin := -m64 -arch x86_64\n-CFG_GCCISH_CFLAGS_x86_64-apple-darwin := -Wall -Werror -g -fPIC -m64 -arch x86_64\n-CFG_GCCISH_CXXFLAGS_x86_64-apple-darwin := -fno-rtti\n+CFG_CFLAGS_x86_64-apple-darwin := -m64 -arch x86_64 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_x86_64-apple-darwin := -Wall -Werror -g -fPIC -m64 -arch x86_64 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_x86_64-apple-darwin := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_x86_64-apple-darwin := -dynamiclib -pthread  -framework CoreServices -m64\n CFG_GCCISH_DEF_FLAG_x86_64-apple-darwin := -Wl,-exported_symbols_list,\n CFG_GCCISH_PRE_LIB_FLAGS_x86_64-apple-darwin :=\n@@ -260,9 +230,9 @@ CFG_LIB_NAME_i686-apple-darwin=lib$(1).dylib\n CFG_STATIC_LIB_NAME_i686-apple-darwin=lib$(1).a\n CFG_LIB_GLOB_i686-apple-darwin=lib$(1)-*.dylib\n CFG_LIB_DSYM_GLOB_i686-apple-darwin=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_i686-apple-darwin := -m32 -arch i386\n-CFG_GCCISH_CFLAGS_i686-apple-darwin := -Wall -Werror -g -fPIC -m32 -arch i386\n-CFG_GCCISH_CXXFLAGS_i686-apple-darwin := -fno-rtti\n+CFG_CFLAGS_i686-apple-darwin := -m32 -arch i386 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_i686-apple-darwin := -Wall -Werror -g -fPIC -m32 -arch i386 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_i686-apple-darwin := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_i686-apple-darwin := -dynamiclib -pthread  -framework CoreServices -m32\n CFG_GCCISH_DEF_FLAG_i686-apple-darwin := -Wl,-exported_symbols_list,\n CFG_GCCISH_PRE_LIB_FLAGS_i686-apple-darwin :=\n@@ -288,9 +258,9 @@ CFG_LIB_NAME_arm-linux-androideabi=lib$(1).so\n CFG_STATIC_LIB_NAME_arm-linux-androideabi=lib$(1).a\n CFG_LIB_GLOB_arm-linux-androideabi=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_arm-linux-androideabi=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_arm-linux-androideabi := -D__arm__ -DANDROID -D__ANDROID__\n-CFG_GCCISH_CFLAGS_arm-linux-androideabi := -Wall -g -fPIC -D__arm__ -DANDROID -D__ANDROID__\n-CFG_GCCISH_CXXFLAGS_arm-linux-androideabi := -fno-rtti\n+CFG_CFLAGS_arm-linux-androideabi := -D__arm__ -DANDROID -D__ANDROID__ $(CFLAGS)\n+CFG_GCCISH_CFLAGS_arm-linux-androideabi := -Wall -g -fPIC -D__arm__ -DANDROID -D__ANDROID__ $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_arm-linux-androideabi := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_arm-linux-androideabi := -shared -fPIC -ldl -g -lm -lsupc++\n CFG_GCCISH_DEF_FLAG_arm-linux-androideabi := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_arm-linux-androideabi := -Wl,-whole-archive\n@@ -319,9 +289,9 @@ CFG_LIB_NAME_arm-unknown-linux-gnueabihf=lib$(1).so\n CFG_STATIC_LIB_NAME_arm-unknown-linux-gnueabihf=lib$(1).a\n CFG_LIB_GLOB_arm-unknown-linux-gnueabihf=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_arm-unknown-linux-gnueabihf=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_arm-unknown-linux-gnueabihf := -D__arm__\n-CFG_GCCISH_CFLAGS_arm-unknown-linux-gnueabihf := -Wall -g -fPIC -D__arm__\n-CFG_GCCISH_CXXFLAGS_arm-unknown-linux-gnueabihf := -fno-rtti\n+CFG_CFLAGS_arm-unknown-linux-gnueabihf := -D__arm__ $(CFLAGS)\n+CFG_GCCISH_CFLAGS_arm-unknown-linux-gnueabihf := -Wall -g -fPIC -D__arm__ $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_arm-unknown-linux-gnueabihf := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_arm-unknown-linux-gnueabihf := -shared -fPIC -g\n CFG_GCCISH_DEF_FLAG_arm-unknown-linux-gnueabihf := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_arm-unknown-linux-gnueabihf := -Wl,-whole-archive\n@@ -350,9 +320,9 @@ CFG_LIB_NAME_arm-unknown-linux-gnueabi=lib$(1).so\n CFG_STATIC_LIB_NAME_arm-unknown-linux-gnueabi=lib$(1).a\n CFG_LIB_GLOB_arm-unknown-linux-gnueabi=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_arm-unknown-linux-gnueabi=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_arm-unknown-linux-gnueabi := -D__arm__ -mfpu=vfp\n-CFG_GCCISH_CFLAGS_arm-unknown-linux-gnueabi := -Wall -g -fPIC -D__arm__ -mfpu=vfp\n-CFG_GCCISH_CXXFLAGS_arm-unknown-linux-gnueabi := -fno-rtti\n+CFG_CFLAGS_arm-unknown-linux-gnueabi := -D__arm__ -mfpu=vfp $(CFLAGS)\n+CFG_GCCISH_CFLAGS_arm-unknown-linux-gnueabi := -Wall -g -fPIC -D__arm__ -mfpu=vfp $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_arm-unknown-linux-gnueabi := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_arm-unknown-linux-gnueabi := -shared -fPIC -g\n CFG_GCCISH_DEF_FLAG_arm-unknown-linux-gnueabi := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_arm-unknown-linux-gnueabi := -Wl,-whole-archive\n@@ -380,9 +350,9 @@ CFG_LIB_NAME_mips-unknown-linux-gnu=lib$(1).so\n CFG_STATIC_LIB_NAME_mips-unknown-linux-gnu=lib$(1).a\n CFG_LIB_GLOB_mips-unknown-linux-gnu=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_mips-unknown-linux-gnu=lib$(1)-*.dylib.dSYM\n-CFG_CFLAGS_mips-unknown-linux-gnu := -mips32r2 -msoft-float -mabi=32 -mno-compact-eh\n-CFG_GCCISH_CFLAGS_mips-unknown-linux-gnu := -Wall -g -fPIC -mips32r2 -msoft-float -mabi=32 -mno-compact-eh\n-CFG_GCCISH_CXXFLAGS_mips-unknown-linux-gnu := -fno-rtti\n+CFG_CFLAGS_mips-unknown-linux-gnu := -mips32r2 -msoft-float -mabi=32 -mno-compact-eh $(CFLAGS)\n+CFG_GCCISH_CFLAGS_mips-unknown-linux-gnu := -Wall -g -fPIC -mips32r2 -msoft-float -mabi=32 -mno-compact-eh $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_mips-unknown-linux-gnu := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_mips-unknown-linux-gnu := -shared -fPIC -g -mips32r2 -msoft-float -mabi=32\n CFG_GCCISH_DEF_FLAG_mips-unknown-linux-gnu := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_mips-unknown-linux-gnu := -Wl,-whole-archive\n@@ -409,9 +379,9 @@ CFG_LIB_NAME_i686-pc-mingw32=$(1).dll\n CFG_STATIC_LIB_NAME_i686-pc-mingw32=$(1).lib\n CFG_LIB_GLOB_i686-pc-mingw32=$(1)-*.dll\n CFG_LIB_DSYM_GLOB_i686-pc-mingw32=$(1)-*.dylib.dSYM\n-CFG_CFLAGS_mips-i686-pc-mingw32 := -m32 -march=i686 -D_WIN32_WINNT=0x0600\n-CFG_GCCISH_CFLAGS_i686-pc-mingw32 := -Wall -Werror -g -m32 -march=i686 -D_WIN32_WINNT=0x0600 -I$(CFG_SRC_DIR)src/etc/mingw-fix-include\n-CFG_GCCISH_CXXFLAGS_i686-pc-mingw32 := -fno-rtti\n+CFG_CFLAGS_mips-i686-pc-mingw32 := -m32 -march=i686 -D_WIN32_WINNT=0x0600 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_i686-pc-mingw32 := -Wall -Werror -g -m32 -march=i686 -D_WIN32_WINNT=0x0600 -I$(CFG_SRC_DIR)src/etc/mingw-fix-include $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_i686-pc-mingw32 := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_i686-pc-mingw32 := -shared -fPIC -g -m32\n CFG_GCCISH_DEF_FLAG_i686-pc-mingw32 :=\n CFG_GCCISH_PRE_LIB_FLAGS_i686-pc-mingw32 :=\n@@ -438,9 +408,9 @@ CFG_LIB_NAME_i586-mingw32msvc=$(1).dll\n CFG_STATIC_LIB_NAME_i586-mingw32msvc=$(1).lib\n CFG_LIB_GLOB_i586-mingw32msvc=$(1)-*.dll\n CFG_LIB_DSYM_GLOB_i586-mingw32msvc=$(1)-*.dylib.dSYM\n-CFG_CFLAGS_i586-mingw32msvc := -march=i586 -m32\n-CFG_GCCISH_CFLAGS_i586-mingw32msvc := -Wall -Werror -g -march=i586 -m32\n-CFG_GCCISH_CXXFLAGS_i586-mingw32msvc := -fno-rtti\n+CFG_CFLAGS_i586-mingw32msvc := -march=i586 -m32 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_i586-mingw32msvc := -Wall -Werror -g -march=i586 -m32 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_i586-mingw32msvc := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_i586-mingw32msvc := -shared -g -m32\n CFG_GCCISH_DEF_FLAG_i586-mingw32msvc :=\n CFG_GCCISH_PRE_LIB_FLAGS_i586-mingw32msvc :=\n@@ -469,9 +439,9 @@ CFG_LIB_NAME_i686-w64-mingw32=$(1).dll\n CFG_STATIC_LIB_NAME_i686-w64-mingw32=$(1).lib\n CFG_LIB_GLOB_i686-w64-mingw32=$(1)-*.dll\n CFG_LIB_DSYM_GLOB_i686-w64-mingw32=$(1)-*.dylib.dSYM\n-CFG_CFLAGS_i586-w64-mingw32 := -march=i586 -m32 -D_WIN32_WINNT=0x0600\n-CFG_GCCISH_CFLAGS_i686-w64-mingw32 := -Wall -Werror -g -m32 -D_WIN32_WINNT=0x0600\n-CFG_GCCISH_CXXFLAGS_i686-w64-mingw32 := -fno-rtti\n+CFG_CFLAGS_i586-w64-mingw32 := -march=i586 -m32 -D_WIN32_WINNT=0x0600 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_i686-w64-mingw32 := -Wall -Werror -g -m32 -D_WIN32_WINNT=0x0600 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_i686-w64-mingw32 := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_i686-w64-mingw32 := -shared -g -m32\n CFG_GCCISH_DEF_FLAG_i686-w64-mingw32 :=\n CFG_GCCISH_PRE_LIB_FLAGS_i686-w64-mingw32 :=\n@@ -499,9 +469,9 @@ CFG_LIB_NAME_x86_64-w64-mingw32=$(1).dll\n CFG_STATIC_LIB_NAME_x86_64-w64-mingw32=$(1).lib\n CFG_LIB_GLOB_x86_64-w64-mingw32=$(1)-*.dll\n CFG_LIB_DSYM_GLOB_x86_64-w64-mingw32=$(1)-*.dylib.dSYM\n-CFG_CFLAGS_x86_64-w64-mingw32 := -m64 -D_WIN32_WINNT=0x0600\n-CFG_GCCISH_CFLAGS_x86_64-w64-mingw32 := -Wall -Werror -g -m64 -D_WIN32_WINNT=0x0600\n-CFG_GCCISH_CXXFLAGS_x86_64-w64-mingw32 := -fno-rtti\n+CFG_CFLAGS_x86_64-w64-mingw32 := -m64 -D_WIN32_WINNT=0x0600 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_x86_64-w64-mingw32 := -Wall -Werror -g -m64 -D_WIN32_WINNT=0x0600 $(CFLAGS)\n+CFG_GCCISH_CXXFLAGS_x86_64-w64-mingw32 := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_x86_64-w64-mingw32 := -shared -g -m64\n CFG_GCCISH_DEF_FLAG_x86_64-w64-mingw32 :=\n CFG_GCCISH_PRE_LIB_FLAGS_x86_64-w64-mingw32 :=\n@@ -528,8 +498,8 @@ CFG_LIB_NAME_x86_64-unknown-freebsd=lib$(1).so\n CFG_STATIC_LIB_NAME_x86_64-unknown-freebsd=lib$(1).a\n CFG_LIB_GLOB_x86_64-unknown-freebsd=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_x86_64-unknown-freebsd=$(1)-*.dylib.dSYM\n-CFG_CFLAGS_x86_64-unknown-freebsd := -I/usr/local/include\n-CFG_GCCISH_CFLAGS_x86_64-unknown-freebsd := -Wall -Werror -g -fPIC -I/usr/local/include\n+CFG_CFLAGS_x86_64-unknown-freebsd := -I/usr/local/include $(CFLAGS)\n+CFG_GCCISH_CFLAGS_x86_64-unknown-freebsd := -Wall -Werror -g -fPIC -I/usr/local/include $(CFLAGS)\n CFG_GCCISH_LINK_FLAGS_x86_64-unknown-freebsd := -shared -fPIC -g -pthread  -lrt\n CFG_GCCISH_DEF_FLAG_x86_64-unknown-freebsd := -Wl,--export-dynamic,--dynamic-list=\n CFG_GCCISH_PRE_LIB_FLAGS_x86_64-unknown-freebsd := -Wl,-whole-archive"}]}