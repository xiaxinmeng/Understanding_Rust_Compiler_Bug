{"sha": "ade57d9f5827f0753cd0acee025f830a5256a78a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkZTU3ZDlmNTgyN2YwNzUzY2QwYWNlZTAyNWY4MzBhNTI1NmE3OGE=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-10-04T21:45:08Z"}, "committer": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-10-04T22:37:19Z"}, "message": "rt::io::net::tcp: Fix eof_twice tests on Win32\n\ncc #8811", "tree": {"sha": "f5b839d87105193d8f8f2eb010f66b0f5d8ecec2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5b839d87105193d8f8f2eb010f66b0f5d8ecec2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ade57d9f5827f0753cd0acee025f830a5256a78a", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ade57d9f5827f0753cd0acee025f830a5256a78a", "html_url": "https://github.com/rust-lang/rust/commit/ade57d9f5827f0753cd0acee025f830a5256a78a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ade57d9f5827f0753cd0acee025f830a5256a78a/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8aadcd4851d90adfb32da6ba8da3e7e29d97c28e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8aadcd4851d90adfb32da6ba8da3e7e29d97c28e", "html_url": "https://github.com/rust-lang/rust/commit/8aadcd4851d90adfb32da6ba8da3e7e29d97c28e"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "3b894b9d3319338d242c8abe358cfb9cd764f10e", "filename": "src/libstd/rt/io/net/tcp.rs", "status": "modified", "additions": 20, "deletions": 6, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ade57d9f5827f0753cd0acee025f830a5256a78a/src%2Flibstd%2Frt%2Fio%2Fnet%2Ftcp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ade57d9f5827f0753cd0acee025f830a5256a78a/src%2Flibstd%2Frt%2Fio%2Fnet%2Ftcp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Fio%2Fnet%2Ftcp.rs?ref=ade57d9f5827f0753cd0acee025f830a5256a78a", "patch": "@@ -306,7 +306,6 @@ mod test {\n     }\n \n     #[test]\n-    #[ignore(cfg(windows))] // FIXME #8811\n     fn read_eof_twice_ip4() {\n         do run_in_mt_newsched_task {\n             let addr = next_test_ip4();\n@@ -321,8 +320,16 @@ mod test {\n                 let mut buf = [0];\n                 let nread = stream.read(buf);\n                 assert!(nread.is_none());\n-                let nread = stream.read(buf);\n-                assert!(nread.is_none());\n+                do read_error::cond.trap(|e| {\n+                    if cfg!(windows) {\n+                        assert_eq!(e.kind, NotConnected);\n+                    } else {\n+                        fail2!();\n+                    }\n+                }).inside {\n+                    let nread = stream.read(buf);\n+                    assert!(nread.is_none());\n+                }\n             }\n \n             do spawntask {\n@@ -334,7 +341,6 @@ mod test {\n     }\n \n     #[test]\n-    #[ignore(cfg(windows))] // FIXME #8811\n     fn read_eof_twice_ip6() {\n         do run_in_mt_newsched_task {\n             let addr = next_test_ip6();\n@@ -349,8 +355,16 @@ mod test {\n                 let mut buf = [0];\n                 let nread = stream.read(buf);\n                 assert!(nread.is_none());\n-                let nread = stream.read(buf);\n-                assert!(nread.is_none());\n+                do read_error::cond.trap(|e| {\n+                    if cfg!(windows) {\n+                        assert_eq!(e.kind, NotConnected);\n+                    } else {\n+                        fail2!();\n+                    }\n+                }).inside {\n+                    let nread = stream.read(buf);\n+                    assert!(nread.is_none());\n+                }\n             }\n \n             do spawntask {"}]}