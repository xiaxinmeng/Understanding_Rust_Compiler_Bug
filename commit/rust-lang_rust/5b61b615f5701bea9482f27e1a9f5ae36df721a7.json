{"sha": "5b61b615f5701bea9482f27e1a9f5ae36df721a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViNjFiNjE1ZjU3MDFiZWE5NDgyZjI3ZTFhOWY1YWUzNmRmNzIxYTc=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-02-20T19:11:58Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-02-20T19:11:58Z"}, "message": "Allow to not switch to a theme if it doesn't exist", "tree": {"sha": "f7dfcb624b7f31162f130b7ed0b554ab070fbc0a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f7dfcb624b7f31162f130b7ed0b554ab070fbc0a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b61b615f5701bea9482f27e1a9f5ae36df721a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b61b615f5701bea9482f27e1a9f5ae36df721a7", "html_url": "https://github.com/rust-lang/rust/commit/5b61b615f5701bea9482f27e1a9f5ae36df721a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b61b615f5701bea9482f27e1a9f5ae36df721a7/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d3f31df8bdcefdd17b5b6a77eac4c94c08aa38d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d3f31df8bdcefdd17b5b6a77eac4c94c08aa38d", "html_url": "https://github.com/rust-lang/rust/commit/2d3f31df8bdcefdd17b5b6a77eac4c94c08aa38d"}], "stats": {"total": 42, "additions": 31, "deletions": 11}, "files": [{"sha": "ba2e58eb475761fffdafaf36f45d80926be17af3", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5b61b615f5701bea9482f27e1a9f5ae36df721a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/5b61b615f5701bea9482f27e1a9f5ae36df721a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=5b61b615f5701bea9482f27e1a9f5ae36df721a7", "patch": "@@ -96,14 +96,6 @@\n         }\n     }\n \n-    function onEach(arr, func) {\n-        if (arr && arr.length > 0 && func) {\n-            for (var i = 0; i < arr.length; i++) {\n-                func(arr[i]);\n-            }\n-        }\n-    }\n-\n     function isHidden(elem) {\n         return (elem.offsetParent === null)\n     }"}, {"sha": "f21dfc8af92984410aec95bb76f2120b3808bd96", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 31, "deletions": 3, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/5b61b615f5701bea9482f27e1a9f5ae36df721a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/5b61b615f5701bea9482f27e1a9f5ae36df721a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=5b61b615f5701bea9482f27e1a9f5ae36df721a7", "patch": "@@ -13,6 +13,18 @@\n var currentTheme = document.getElementById(\"themeStyle\");\n var mainTheme = document.getElementById(\"mainThemeStyle\");\n \n+var savedHref = [];\n+\n+function onEach(arr, func) {\n+    if (arr && arr.length > 0 && func) {\n+        for (var i = 0; i < arr.length; i++) {\n+            if (func(arr[i]) === true) {\n+                break;\n+            }\n+        }\n+    }\n+}\n+\n function updateLocalStorage(name, value) {\n     if (typeof(Storage) !== \"undefined\") {\n         localStorage[name] = value;\n@@ -29,8 +41,24 @@ function getCurrentValue(name) {\n }\n \n function switchTheme(styleElem, mainStyleElem, newTheme) {\n-    styleElem.href = mainStyleElem.href.replace(\"rustdoc.css\", newTheme + \".css\");\n-    updateLocalStorage('rustdoc-theme', newTheme);\n+    var newHref = mainStyleElem.href.replace(\"rustdoc.css\", newTheme + \".css\");\n+    var found = false;\n+\n+    if (savedHref.length === 0) {\n+        onEach(document.getElementsByTagName(\"link\"), function(el) {\n+            savedHref.push(el.href);\n+        });\n+    }\n+    onEach(savedHref, function(el) {\n+        if (el === newHref) {\n+            found = true;\n+            return true;\n+        }\n+    });\n+    if (found === true) {\n+        styleElem.href = newHref;\n+        updateLocalStorage('rustdoc-theme', newTheme);\n+    }\n }\n \n-switchTheme(currentTheme, mainTheme, getCurrentValue('theme') || 'main');\n+switchTheme(currentTheme, mainTheme, getCurrentValue('rustdoc-theme') || 'main');"}]}