{"sha": "ddc2076902c7286c3766c406e17d63a1eac90098", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkYzIwNzY5MDJjNzI4NmMzNzY2YzQwNmUxN2Q2M2ExZWFjOTAwOTg=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-08-18T23:24:36Z"}, "committer": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-08-18T23:24:36Z"}, "message": "Make windows respect RUST_SEED. Closes #627.", "tree": {"sha": "ffe6a43737a1dcc892877c864ebf64e78ce0f54f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ffe6a43737a1dcc892877c864ebf64e78ce0f54f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ddc2076902c7286c3766c406e17d63a1eac90098", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ddc2076902c7286c3766c406e17d63a1eac90098", "html_url": "https://github.com/rust-lang/rust/commit/ddc2076902c7286c3766c406e17d63a1eac90098", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ddc2076902c7286c3766c406e17d63a1eac90098/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a00fab2492245bd637269a1a65ab6975ee17da2", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a00fab2492245bd637269a1a65ab6975ee17da2", "html_url": "https://github.com/rust-lang/rust/commit/0a00fab2492245bd637269a1a65ab6975ee17da2"}], "stats": {"total": 21, "additions": 10, "deletions": 11}, "files": [{"sha": "6ab7d305a82d6cb3cb959dc1f16dc38e9cd83ed6", "filename": "src/rt/rust_util.h", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ddc2076902c7286c3766c406e17d63a1eac90098/src%2Frt%2Frust_util.h", "raw_url": "https://github.com/rust-lang/rust/raw/ddc2076902c7286c3766c406e17d63a1eac90098/src%2Frt%2Frust_util.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_util.h?ref=ddc2076902c7286c3766c406e17d63a1eac90098", "patch": "@@ -130,8 +130,15 @@ isaac_init(sched_or_kernel *sched, randctx *rctx)\n {\n         memset(rctx, 0, sizeof(randctx));\n \n+        char *rust_seed = sched->env->rust_seed;\n+        if (rust_seed != NULL) {\n+            ub4 seed = (ub4) atoi(rust_seed);\n+            for (size_t i = 0; i < RANDSIZ; i ++) {\n+                memcpy(&rctx->randrsl[i], &seed, sizeof(ub4));\n+                seed = (seed + 0x7ed55d16) + (seed << 12);\n+            }\n+        } else {\n #ifdef __WIN32__\n-        {\n             HCRYPTPROV hProv;\n             sched->win32_require\n                 (_T(\"CryptAcquireContext\"),\n@@ -144,24 +151,16 @@ isaac_init(sched_or_kernel *sched, randctx *rctx)\n             sched->win32_require\n                 (_T(\"CryptReleaseContext\"),\n                  CryptReleaseContext(hProv, 0));\n-        }\n #else\n-        char *rust_seed = sched->env->rust_seed;\n-        if (rust_seed != NULL) {\n-            ub4 seed = (ub4) atoi(rust_seed);\n-            for (size_t i = 0; i < RANDSIZ; i ++) {\n-                memcpy(&rctx->randrsl[i], &seed, sizeof(ub4));\n-                seed = (seed + 0x7ed55d16) + (seed << 12);\n-            }\n-        } else {\n             int fd = open(\"/dev/urandom\", O_RDONLY);\n             I(sched, fd > 0);\n             I(sched,\n               read(fd, (void*) &rctx->randrsl, sizeof(rctx->randrsl))\n               == sizeof(rctx->randrsl));\n             I(sched, close(fd) == 0);\n-        }\n #endif\n+        }\n+\n         randinit(rctx, 1);\n }\n "}]}