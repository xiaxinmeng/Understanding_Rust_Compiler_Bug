{"sha": "7979da0783a0052cbcdbebd0594c5518eae7fb9c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5NzlkYTA3ODNhMDA1MmNiY2RiZWJkMDU5NGM1NTE4ZWFlN2ZiOWM=", "commit": {"author": {"name": "Jonathan Turner", "email": "jonathandturner@users.noreply.github.com", "date": "2016-08-08T20:25:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-08T20:25:56Z"}, "message": "Rollup merge of #35446 - pcn:update-E0023-to-new-format, r=jonathandturner\n\nUpdate E0023 to the new format\n\nAdded some extra code to check for the appropriate ending for numbers ==\n1 vs. not 1 in error messages.\n\nAdded an extra test so that the plural suffix is seen and exercised.", "tree": {"sha": "c7ba7ab6bca25d13340bd9a7af2f61b8bd7795ed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7ba7ab6bca25d13340bd9a7af2f61b8bd7795ed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7979da0783a0052cbcdbebd0594c5518eae7fb9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7979da0783a0052cbcdbebd0594c5518eae7fb9c", "html_url": "https://github.com/rust-lang/rust/commit/7979da0783a0052cbcdbebd0594c5518eae7fb9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7979da0783a0052cbcdbebd0594c5518eae7fb9c/comments", "author": {"login": "jonathandturner", "id": 111457284, "node_id": "O_kgDOBqS0BA", "avatar_url": "https://avatars.githubusercontent.com/u/111457284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathandturner", "html_url": "https://github.com/jonathandturner", "followers_url": "https://api.github.com/users/jonathandturner/followers", "following_url": "https://api.github.com/users/jonathandturner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathandturner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathandturner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathandturner/subscriptions", "organizations_url": "https://api.github.com/users/jonathandturner/orgs", "repos_url": "https://api.github.com/users/jonathandturner/repos", "events_url": "https://api.github.com/users/jonathandturner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathandturner/received_events", "type": "Organization", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd3817290376e3b31cd703a431deb4f6871728da", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd3817290376e3b31cd703a431deb4f6871728da", "html_url": "https://github.com/rust-lang/rust/commit/dd3817290376e3b31cd703a431deb4f6871728da"}, {"sha": "2c563c69f40a140e82e2d653bafd9e4f88621f30", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c563c69f40a140e82e2d653bafd9e4f88621f30", "html_url": "https://github.com/rust-lang/rust/commit/2c563c69f40a140e82e2d653bafd9e4f88621f30"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "2e8fd3dc27623802c1cd20fe2c91f07c7c05ef4a", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/7979da0783a0052cbcdbebd0594c5518eae7fb9c/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7979da0783a0052cbcdbebd0594c5518eae7fb9c/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=7979da0783a0052cbcdbebd0594c5518eae7fb9c", "patch": "@@ -633,10 +633,23 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                 self.check_pat(&subpat, field_ty);\n             }\n         } else {\n-            span_err!(tcx.sess, pat.span, E0023,\n-                      \"this pattern has {} field{s}, but the corresponding {} has {} field{s}\",\n-                      subpats.len(), def.kind_name(), variant.fields.len(),\n-                      s = if variant.fields.len() == 1 {\"\"} else {\"s\"});\n+            let subpats_ending = if subpats.len() == 1 {\n+                \"\"\n+            } else {\n+                \"s\"\n+            };\n+            let fields_ending = if variant.fields.len() == 1 {\n+                \"\"\n+            } else {\n+                \"s\"\n+            };\n+            struct_span_err!(tcx.sess, pat.span, E0023,\n+                             \"this pattern has {} field{}, but the corresponding {} has {} field{}\",\n+                             subpats.len(), subpats_ending, def.kind_name(),\n+                             variant.fields.len(),  fields_ending)\n+                .span_label(pat.span, &format!(\"expected {} field{}, found {}\",\n+                                               variant.fields.len(), fields_ending, subpats.len()))\n+                .emit();\n             on_error();\n         }\n     }"}, {"sha": "c3623e3177b56207606de2bf18b45f8e38d45aa3", "filename": "src/test/compile-fail/E0023.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7979da0783a0052cbcdbebd0594c5518eae7fb9c/src%2Ftest%2Fcompile-fail%2FE0023.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7979da0783a0052cbcdbebd0594c5518eae7fb9c/src%2Ftest%2Fcompile-fail%2FE0023.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0023.rs?ref=7979da0783a0052cbcdbebd0594c5518eae7fb9c", "patch": "@@ -13,10 +13,15 @@ enum Fruit {\n     Pear(u32),\n }\n \n+\n fn main() {\n     let x = Fruit::Apple(String::new(), String::new());\n     match x {\n         Fruit::Apple(a) => {}, //~ ERROR E0023\n+                               //~| NOTE expected 2 fields, found 1\n         Fruit::Apple(a, b, c) => {}, //~ ERROR E0023\n+                                     //~| NOTE expected 2 fields, found 3\n+        Fruit::Pear(1, 2) => {}, //~ ERROR E0023\n+                                 //~| NOTE expected 1 field, found 2\n     }\n }"}]}