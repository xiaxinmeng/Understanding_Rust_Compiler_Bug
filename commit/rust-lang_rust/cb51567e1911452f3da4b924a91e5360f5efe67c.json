{"sha": "cb51567e1911452f3da4b924a91e5360f5efe67c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiNTE1NjdlMTkxMTQ1MmYzZGE0YjkyNGE5MWU1MzYwZjVlZmU2N2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-11-16T04:37:36Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-11-16T04:37:36Z"}, "message": "auto merge of #18788 : ricky26/rust/master, r=aturon\n\nThis moves chars() and lines() out of Buffer and into separate traits (CharsBuffer and LinesBuffer respectively) - this matches the pattern used for bytes() on Reader (with BytesReader).\r\n\r\n(I came across this when I wanted a trait object of a Buffer, so that I could use read_line(); rustc errors about std::io::Buffer not being object-safe.)\r\n\r\n[breaking-change]\r\nAny uses of Buffer::lines() will need to use the new trait std::io::LinesBuffer.\r\nThe same is true for Buffer::chars() with std::io::CharsBuffer.", "tree": {"sha": "6491b2030f478bcc9a7da9db59da40c9dae4b651", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6491b2030f478bcc9a7da9db59da40c9dae4b651"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb51567e1911452f3da4b924a91e5360f5efe67c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb51567e1911452f3da4b924a91e5360f5efe67c", "html_url": "https://github.com/rust-lang/rust/commit/cb51567e1911452f3da4b924a91e5360f5efe67c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb51567e1911452f3da4b924a91e5360f5efe67c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e43f419cb98c9035d30e5cf0e0be7944dbc0371", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e43f419cb98c9035d30e5cf0e0be7944dbc0371", "html_url": "https://github.com/rust-lang/rust/commit/7e43f419cb98c9035d30e5cf0e0be7944dbc0371"}, {"sha": "43fd6446add0bcf237f3fe15b7d715eceee2a08c", "url": "https://api.github.com/repos/rust-lang/rust/commits/43fd6446add0bcf237f3fe15b7d715eceee2a08c", "html_url": "https://github.com/rust-lang/rust/commit/43fd6446add0bcf237f3fe15b7d715eceee2a08c"}], "stats": {"total": 37, "additions": 25, "deletions": 12}, "files": [{"sha": "90345cb0535eb93ca5866c9d83abcb17d427eda9", "filename": "src/libstd/io/mod.rs", "status": "modified", "additions": 24, "deletions": 11, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/cb51567e1911452f3da4b924a91e5360f5efe67c/src%2Flibstd%2Fio%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb51567e1911452f3da4b924a91e5360f5efe67c/src%2Flibstd%2Fio%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fmod.rs?ref=cb51567e1911452f3da4b924a91e5360f5efe67c", "patch": "@@ -1437,16 +1437,6 @@ pub trait Buffer: Reader {\n         )\n     }\n \n-    /// Create an iterator that reads a line on each iteration until EOF.\n-    ///\n-    /// # Error\n-    ///\n-    /// Any error other than `EndOfFile` that is produced by the underlying Reader\n-    /// is returned by the iterator and should be handled by the caller.\n-    fn lines<'r>(&'r mut self) -> Lines<'r, Self> {\n-        Lines { buffer: self }\n-    }\n-\n     /// Reads a sequence of bytes leading up to a specified delimiter. Once the\n     /// specified byte is encountered, reading ceases and the bytes up to and\n     /// including the delimiter are returned.\n@@ -1522,17 +1512,36 @@ pub trait Buffer: Reader {\n             None => Err(standard_error(InvalidInput))\n         }\n     }\n+}\n \n+/// Extension methods for the Buffer trait which are included in the prelude.\n+pub trait BufferPrelude {\n     /// Create an iterator that reads a utf8-encoded character on each iteration\n     /// until EOF.\n     ///\n     /// # Error\n     ///\n     /// Any error other than `EndOfFile` that is produced by the underlying Reader\n     /// is returned by the iterator and should be handled by the caller.\n-    fn chars<'r>(&'r mut self) -> Chars<'r, Self> {\n+    fn chars<'r>(&'r mut self) -> Chars<'r, Self>;\n+\n+    /// Create an iterator that reads a line on each iteration until EOF.\n+    ///\n+    /// # Error\n+    ///\n+    /// Any error other than `EndOfFile` that is produced by the underlying Reader\n+    /// is returned by the iterator and should be handled by the caller.\n+    fn lines<'r>(&'r mut self) -> Lines<'r, Self>;\n+}\n+\n+impl<T: Buffer> BufferPrelude for T {\n+    fn chars<'r>(&'r mut self) -> Chars<'r, T> {\n         Chars { buffer: self }\n     }\n+\n+    fn lines<'r>(&'r mut self) -> Lines<'r, T> {\n+        Lines { buffer: self }\n+    }\n }\n \n /// When seeking, the resulting cursor is offset from a base by the offset given\n@@ -2003,4 +2012,8 @@ mod tests {\n         assert_eq!(format!(\"{}\", ALL_PERMISSIONS), \"0777\".to_string());\n         assert_eq!(format!(\"{}\", USER_READ | USER_WRITE | OTHER_WRITE), \"0602\".to_string());\n     }\n+\n+    fn _ensure_buffer_is_object_safe<T: Buffer>(x: &T) -> &Buffer {\n+        x as &Buffer\n+    }\n }"}, {"sha": "e9793ea65ad9079499f17854401ad8313cfe0a8b", "filename": "src/libstd/prelude.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cb51567e1911452f3da4b924a91e5360f5efe67c/src%2Flibstd%2Fprelude.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb51567e1911452f3da4b924a91e5360f5efe67c/src%2Flibstd%2Fprelude.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprelude.rs?ref=cb51567e1911452f3da4b924a91e5360f5efe67c", "patch": "@@ -73,7 +73,7 @@\n #[doc(no_inline)] pub use path::{GenericPath, Path, PosixPath, WindowsPath};\n #[doc(no_inline)] pub use ptr::{RawPtr, RawMutPtr};\n #[doc(no_inline)] pub use result::{Result, Ok, Err};\n-#[doc(no_inline)] pub use io::{Buffer, Writer, Reader, Seek};\n+#[doc(no_inline)] pub use io::{Buffer, Writer, Reader, Seek, BufferPrelude};\n #[doc(no_inline)] pub use str::{Str, StrVector, StrPrelude};\n #[doc(no_inline)] pub use str::{IntoMaybeOwned, StrAllocating, UnicodeStrPrelude};\n #[doc(no_inline)] pub use to_string::{ToString, IntoStr};"}]}