{"sha": "24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0YjNhOTc5ODYwZWZhZDdhNjlhNDMyYzBmMWJjYmYzNWI4YmJhYjc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-07T07:36:57Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-07T07:36:57Z"}, "message": "Rollup merge of #49503 - oli-obk:extern_crate_compiler_builtins, r=alexcrichton\n\nInject the `compiler_builtins` crate whenever the `core` crate is injected", "tree": {"sha": "a92bd703cc755e11c1046b772d015c65ecef4893", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a92bd703cc755e11c1046b772d015c65ecef4893"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlrIdRkACgkQ/vbIBR0O\nATxwSA/+OQ3h2oGPP1kFHZMDv+k9+UhtZEpJLhbJXYWv0tMpSNvFxgkeVtZF+wtp\nuOUAhkfZLLGgrLAtd2pXoYa1mGRcHPcQZLUVfn8poUcO190E+zfVRNsKxbezqsMi\n7f1J04aBnetnhAP+PhUlDF8ZOcjcdAsMREbwrCBMYH3S0tHeu9nSPj/iHQG9z4/a\n9LWWsDHN4lalhDeSLMjT5LasjUWMsh4fIH+GHgXFXhMDwgPGlemUOl8/rL3hrpT/\nqnXWjhSzOILvfHSurRrUVJ+SkGcF+KGtV3bEokPhBe4uJxSeYp0TxLxFEcga/oRC\nGeLHKGbZO7ky6i4SeM4t0NX/f9kEmRrrVzRXlsKEgrjunS1t/McGTGyEbO43LJBS\n1muAbViavvBEkV3lk6+OvNCN9InHJm8iUmVZpDDLBptJL8Z/N0CfOS5RTmzwyRbc\njtAi2qCpmvhC8+X12LOS630luCGt/0f83DA13IERN46pRDGkfe0d7wLwGE32ehcE\nrSKhpzsjbOIe+2VeFxEwqyHNgu3klD1Os0/N+uzR1zNkm1q0+DiXIAT7AZBtZ7cl\ntQnO0YjBsM+c5mPSLoCK6d4WFgJ7MCD5urkrs09zBfpJy8wt2kpWt60hPs3OP/Mz\nuSQPhtUF8V79JTCdUWUHqhzPJNLcYqoBf8+Jh8E6Wwd9hjpJzKM=\n=vCZV\n-----END PGP SIGNATURE-----", "payload": "tree a92bd703cc755e11c1046b772d015c65ecef4893\nparent 3e0b15f8243be22019e93755bf94f46c8a25f4de\nparent 679657b863c2a53a3052d8af9defbce48e12db10\nauthor kennytm <kennytm@gmail.com> 1523086617 +0800\ncommitter kennytm <kennytm@gmail.com> 1523086617 +0800\n\nRollup merge of #49503 - oli-obk:extern_crate_compiler_builtins, r=alexcrichton\n\nInject the `compiler_builtins` crate whenever the `core` crate is injected\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "html_url": "https://github.com/rust-lang/rust/commit/24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e0b15f8243be22019e93755bf94f46c8a25f4de", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e0b15f8243be22019e93755bf94f46c8a25f4de", "html_url": "https://github.com/rust-lang/rust/commit/3e0b15f8243be22019e93755bf94f46c8a25f4de"}, {"sha": "679657b863c2a53a3052d8af9defbce48e12db10", "url": "https://api.github.com/repos/rust-lang/rust/commits/679657b863c2a53a3052d8af9defbce48e12db10", "html_url": "https://github.com/rust-lang/rust/commit/679657b863c2a53a3052d8af9defbce48e12db10"}], "stats": {"total": 73, "additions": 57, "deletions": 16}, "files": [{"sha": "004d1c0ffc933aa56b69d79a12958630ef09784e", "filename": "src/Cargo.lock", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -10,6 +10,7 @@ dependencies = [\n name = \"alloc\"\n version = \"0.0.0\"\n dependencies = [\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"rand 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"std_unicode 0.0.0\",\n@@ -23,6 +24,7 @@ dependencies = [\n  \"alloc_system 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cc 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"libc 0.0.0\",\n ]\n@@ -32,6 +34,7 @@ name = \"alloc_system\"\n version = \"0.0.0\"\n dependencies = [\n  \"alloc 0.0.0\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"dlmalloc 0.0.0\",\n  \"libc 0.0.0\",\n@@ -541,6 +544,7 @@ name = \"dlmalloc\"\n version = \"0.0.0\"\n dependencies = [\n  \"alloc 0.0.0\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -976,6 +980,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n name = \"libc\"\n version = \"0.0.0\"\n dependencies = [\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -1254,6 +1259,7 @@ dependencies = [\n name = \"panic_abort\"\n version = \"0.0.0\"\n dependencies = [\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"libc 0.0.0\",\n ]\n@@ -1263,6 +1269,7 @@ name = \"panic_unwind\"\n version = \"0.0.0\"\n dependencies = [\n  \"alloc 0.0.0\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"libc 0.0.0\",\n  \"unwind 0.0.0\",\n@@ -1401,6 +1408,7 @@ name = \"profiler_builtins\"\n version = \"0.0.0\"\n dependencies = [\n  \"cc 1.0.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -1797,6 +1805,7 @@ dependencies = [\n  \"alloc_system 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.29 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -1942,6 +1951,7 @@ dependencies = [\n  \"alloc_system 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.29 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -1991,6 +2001,7 @@ dependencies = [\n  \"alloc_system 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.29 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -2130,6 +2141,7 @@ dependencies = [\n  \"alloc_system 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.29 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -2343,6 +2355,7 @@ dependencies = [\n name = \"std_unicode\"\n version = \"0.0.0\"\n dependencies = [\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n ]\n \n@@ -2725,6 +2738,7 @@ dependencies = [\n name = \"unwind\"\n version = \"0.0.0\"\n dependencies = [\n+ \"compiler_builtins 0.0.0\",\n  \"core 0.0.0\",\n  \"libc 0.0.0\",\n ]"}, {"sha": "2eb8ea1260446a44cfd8fad1f09c91fdfe5ffcec", "filename": "src/liballoc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -10,6 +10,7 @@ path = \"lib.rs\"\n [dependencies]\n core = { path = \"../libcore\" }\n std_unicode = { path = \"../libstd_unicode\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }\n \n [dev-dependencies]\n rand = \"0.4\""}, {"sha": "fd4a45530463df9854455a883061962ba470e8b8", "filename": "src/liballoc_jemalloc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc_jemalloc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc_jemalloc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -16,6 +16,7 @@ alloc = { path = \"../liballoc\" }\n alloc_system = { path = \"../liballoc_system\" }\n core = { path = \"../libcore\" }\n libc = { path = \"../rustc/libc_shim\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }\n \n [build-dependencies]\n build_helper = { path = \"../build_helper\" }"}, {"sha": "936e20a32e10e9d064f55f22094052eaafc41455", "filename": "src/liballoc_system/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc_system%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Fliballoc_system%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_system%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -13,6 +13,7 @@ doc = false\n alloc = { path = \"../liballoc\" }\n core = { path = \"../libcore\" }\n libc = { path = \"../rustc/libc_shim\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }\n \n # See comments in the source for what this dependency is\n [target.'cfg(all(target_arch = \"wasm32\", not(target_os = \"emscripten\")))'.dependencies]"}, {"sha": "633d273b3b93cd49834bd972a5dce5ab106a7ae1", "filename": "src/libpanic_abort/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibpanic_abort%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibpanic_abort%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_abort%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -12,3 +12,4 @@ doc = false\n [dependencies]\n core = { path = \"../libcore\" }\n libc = { path = \"../rustc/libc_shim\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "74aaa4d5ae3db6bf606fbcad57a1866324826fba", "filename": "src/libpanic_unwind/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibpanic_unwind%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibpanic_unwind%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibpanic_unwind%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -14,3 +14,4 @@ alloc = { path = \"../liballoc\" }\n core = { path = \"../libcore\" }\n libc = { path = \"../rustc/libc_shim\" }\n unwind = { path = \"../libunwind\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "79192fbb6819c4ba09f6822c6bf3515261e31fc3", "filename": "src/libprofiler_builtins/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibprofiler_builtins%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibprofiler_builtins%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibprofiler_builtins%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -13,6 +13,7 @@ doc = false\n \n [dependencies]\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }\n \n [build-dependencies]\n cc = \"1.0.1\""}, {"sha": "34d8b75a5bfb3476a1f587d33ad663f2d8498f37", "filename": "src/librustc_asan/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_asan%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_asan%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_asan%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -17,3 +17,4 @@ cmake = \"0.1.18\"\n alloc = { path = \"../liballoc\" }\n alloc_system = { path = \"../liballoc_system\" }\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "9c19b53742654e4c760056a09d1233d25fad7851", "filename": "src/librustc_lsan/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_lsan%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_lsan%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lsan%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -17,3 +17,4 @@ cmake = \"0.1.18\"\n alloc = { path = \"../liballoc\" }\n alloc_system = { path = \"../liballoc_system\" }\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "17ec2b96438ad02b97746e66de4a6d5a9c7021ad", "filename": "src/librustc_msan/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_msan%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_msan%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_msan%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -17,3 +17,4 @@ cmake = \"0.1.18\"\n alloc = { path = \"../liballoc\" }\n alloc_system = { path = \"../liballoc_system\" }\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "8bb67c0bbac5f4e601154bf939c328550d71cba0", "filename": "src/librustc_tsan/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_tsan%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibrustc_tsan%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_tsan%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -17,3 +17,4 @@ cmake = \"0.1.18\"\n alloc = { path = \"../liballoc\" }\n alloc_system = { path = \"../liballoc_system\" }\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "f9041ac8546b9db6820d19c5aee5a385e0e03a35", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -373,6 +373,7 @@ extern crate unwind;\n \n // compiler-rt intrinsics\n #[doc(masked)]\n+#[cfg(stage0)]\n extern crate compiler_builtins;\n \n // During testing, this crate is not actually the \"real\" std library, but rather"}, {"sha": "283070a0e2cf7f42d9a54bd2a8a6a16a46cab8e2", "filename": "src/libstd_unicode/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibstd_unicode%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibstd_unicode%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd_unicode%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -15,3 +15,4 @@ path = \"tests/lib.rs\"\n \n [dependencies]\n core = { path = \"../libcore\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "8168db19058764f0585f148769062c1ffd917510", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -94,7 +94,7 @@ pub fn print_crate<'a>(cm: &'a CodeMap,\n                        is_expanded: bool) -> io::Result<()> {\n     let mut s = State::new_from_input(cm, sess, filename, input, out, ann, is_expanded);\n \n-    if is_expanded && !std_inject::injected_crate_name().is_none() {\n+    if is_expanded && std_inject::injected_crate_name().is_some() {\n         // We need to print `#![no_std]` (and its feature gate) so that\n         // compiling pretty-printed source won't inject libstd again.\n         // However we don't want these attributes in the AST because"}, {"sha": "bba7a2d73773646d5db9df809836d6645e811177", "filename": "src/libsyntax/std_inject.rs", "status": "modified", "additions": 26, "deletions": 15, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibsyntax%2Fstd_inject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibsyntax%2Fstd_inject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fstd_inject.rs?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -44,27 +44,38 @@ thread_local! {\n }\n \n pub fn maybe_inject_crates_ref(mut krate: ast::Crate, alt_std_name: Option<&str>) -> ast::Crate {\n-    let name = if attr::contains_name(&krate.attrs, \"no_core\") {\n+    // the first name in this list is the crate name of the crate with the prelude\n+    let names: &[&str] = if attr::contains_name(&krate.attrs, \"no_core\") {\n         return krate;\n     } else if attr::contains_name(&krate.attrs, \"no_std\") {\n-        \"core\"\n+        if attr::contains_name(&krate.attrs, \"compiler_builtins\") {\n+            &[\"core\"]\n+        } else {\n+            &[\"core\", \"compiler_builtins\"]\n+        }\n     } else {\n-        \"std\"\n+        &[\"std\"]\n     };\n \n-    INJECTED_CRATE_NAME.with(|opt_name| opt_name.set(Some(name)));\n+    for name in names {\n+        krate.module.items.insert(0, P(ast::Item {\n+            attrs: vec![attr::mk_attr_outer(DUMMY_SP,\n+                                            attr::mk_attr_id(),\n+                                            attr::mk_word_item(ast::Ident::from_str(\"macro_use\")))],\n+            vis: dummy_spanned(ast::VisibilityKind::Inherited),\n+            node: ast::ItemKind::ExternCrate(alt_std_name.map(Symbol::intern)),\n+            ident: ast::Ident::from_str(name),\n+            id: ast::DUMMY_NODE_ID,\n+            span: DUMMY_SP,\n+            tokens: None,\n+        }));\n+    }\n \n-    krate.module.items.insert(0, P(ast::Item {\n-        attrs: vec![attr::mk_attr_outer(DUMMY_SP,\n-                                        attr::mk_attr_id(),\n-                                        attr::mk_word_item(ast::Ident::from_str(\"macro_use\")))],\n-        vis: dummy_spanned(ast::VisibilityKind::Inherited),\n-        node: ast::ItemKind::ExternCrate(alt_std_name.map(Symbol::intern)),\n-        ident: ast::Ident::from_str(name),\n-        id: ast::DUMMY_NODE_ID,\n-        span: DUMMY_SP,\n-        tokens: None,\n-    }));\n+    // the crates have been injected, the assumption is that the first one is the one with\n+    // the prelude.\n+    let name = names[0];\n+\n+    INJECTED_CRATE_NAME.with(|opt_name| opt_name.set(Some(name)));\n \n     let span = ignored_span(DUMMY_SP);\n     krate.module.items.insert(0, P(ast::Item {"}, {"sha": "4760461df64e3895e73561fccd66785dedc6ff92", "filename": "src/libunwind/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibunwind%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Flibunwind%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -14,3 +14,4 @@ doc = false\n [dependencies]\n core = { path = \"../libcore\" }\n libc = { path = \"../rustc/libc_shim\" }\n+compiler_builtins = { path = \"../rustc/compiler_builtins_shim\" }"}, {"sha": "d2fe159d80673d54dbdb48a6fd0affacfc3665d4", "filename": "src/rustc/dlmalloc_shim/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Frustc%2Fdlmalloc_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Frustc%2Fdlmalloc_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fdlmalloc_shim%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -11,4 +11,5 @@ doc = false\n \n [dependencies]\n core = { path = \"../../libcore\" }\n+compiler_builtins = { path = \"../../rustc/compiler_builtins_shim\" }\n alloc = { path = \"../../liballoc\" }"}, {"sha": "e77897d6433136603451492472ebd6834a1fd561", "filename": "src/rustc/libc_shim/Cargo.toml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Frustc%2Flibc_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/24b3a979860efad7a69a432c0f1bcbf35b8bbab7/src%2Frustc%2Flibc_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Flibc_shim%2FCargo.toml?ref=24b3a979860efad7a69a432c0f1bcbf35b8bbab7", "patch": "@@ -29,6 +29,8 @@ doc = false\n #\n # See https://github.com/rust-lang/rfcs/pull/1133.\n core = { path = \"../../libcore\" }\n+compiler_builtins = { path = \"../compiler_builtins_shim\" }\n+\n \n [features]\n # Certain parts of libc are conditionally compiled differently than when used"}]}