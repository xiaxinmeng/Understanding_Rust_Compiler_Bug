{"sha": "e027f5a99e16d2509478c71856e0246e11148322", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwMjdmNWE5OWUxNmQyNTA5NDc4YzcxODU2ZTAyNDZlMTExNDgzMjI=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-03T21:55:40Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-03T21:55:40Z"}, "message": "Add mir test, review comments", "tree": {"sha": "11722ec9c0d1a0e0874bf893c66fae6fb42d7ac0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11722ec9c0d1a0e0874bf893c66fae6fb42d7ac0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e027f5a99e16d2509478c71856e0246e11148322", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e027f5a99e16d2509478c71856e0246e11148322", "html_url": "https://github.com/rust-lang/rust/commit/e027f5a99e16d2509478c71856e0246e11148322", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e027f5a99e16d2509478c71856e0246e11148322/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48b684a40a503a85f5e62f03ea7217d40fee6e1a", "url": "https://api.github.com/repos/rust-lang/rust/commits/48b684a40a503a85f5e62f03ea7217d40fee6e1a", "html_url": "https://github.com/rust-lang/rust/commit/48b684a40a503a85f5e62f03ea7217d40fee6e1a"}], "stats": {"total": 52, "additions": 39, "deletions": 13}, "files": [{"sha": "ef5edf9c6b586ba992b87193197c3f87ed1f5e8d", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e027f5a99e16d2509478c71856e0246e11148322/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e027f5a99e16d2509478c71856e0246e11148322/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=e027f5a99e16d2509478c71856e0246e11148322", "patch": "@@ -347,11 +347,11 @@ impl<'tcx> LoanPath<'tcx> {\n \n     fn to_type(&self) -> Ty<'tcx> { self.ty }\n \n-    fn is_downcast(&self) -> bool {\n+    fn has_downcast(&self) -> bool {\n         match self.kind {\n             LpDowncast(_, _) => true,\n             LpExtend(ref lp, _, LpInterior(_, _)) => {\n-                lp.is_downcast()\n+                lp.has_downcast()\n             }\n             _ => false,\n         }\n@@ -733,7 +733,7 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n         if need_note {\n             err.note(&format!(\n                 \"move occurs because {} has type `{}`, which does not implement the `Copy` trait\",\n-                if moved_lp.is_downcast() {\n+                if moved_lp.has_downcast() {\n                     \"the value\".to_string()\n                 } else {\n                     format!(\"`{}`\", self.loan_path_to_string(moved_lp))"}, {"sha": "d592be11335e0254148657a343d5cdf19c10c733", "filename": "src/test/ui/borrowck/issue-41962.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e027f5a99e16d2509478c71856e0246e11148322/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e027f5a99e16d2509478c71856e0246e11148322/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.rs?ref=e027f5a99e16d2509478c71856e0246e11148322", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -8,13 +8,17 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// compile-flags: -Z borrowck=compare\n+\n pub fn main(){\n     let maybe = Some(vec![true, true]);\n \n     loop {\n         if let Some(thing) = maybe {\n-        //~^ ERROR use of partially moved value\n-        //~| ERROR use of moved value\n+        //~^ ERROR use of partially moved value: `maybe` (Ast) [E0382]\n+        //~| ERROR use of moved value: `(maybe as std::prelude::v1::Some).0` (Ast) [E0382]\n+        //~| ERROR use of moved value: `maybe` (Mir) [E0382]\n+        //~| ERROR use of moved value: `maybe.0` (Mir) [E0382]\n         }\n     }\n }"}, {"sha": "4522029593fa1f33ef379fe327734c6b5cca3d64", "filename": "src/test/ui/borrowck/issue-41962.stderr", "status": "modified", "additions": 29, "deletions": 7, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/e027f5a99e16d2509478c71856e0246e11148322/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e027f5a99e16d2509478c71856e0246e11148322/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr?ref=e027f5a99e16d2509478c71856e0246e11148322", "patch": "@@ -1,20 +1,42 @@\n-error[E0382]: use of partially moved value: `maybe`\n-  --> $DIR/issue-41962.rs:15:30\n+error[E0382]: use of partially moved value: `maybe` (Ast)\n+  --> $DIR/issue-41962.rs:17:30\n    |\n-15 |         if let Some(thing) = maybe {\n+17 |         if let Some(thing) = maybe {\n    |                     -----    ^^^^^ value used here after move\n    |                     |\n    |                     value moved here\n    |\n    = note: move occurs because the value has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n \n-error[E0382]: use of moved value: `(maybe as std::prelude::v1::Some).0`\n-  --> $DIR/issue-41962.rs:15:21\n+error[E0382]: use of moved value: `(maybe as std::prelude::v1::Some).0` (Ast)\n+  --> $DIR/issue-41962.rs:17:21\n    |\n-15 |         if let Some(thing) = maybe {\n+17 |         if let Some(thing) = maybe {\n    |                     ^^^^^ value moved here in previous iteration of loop\n    |\n    = note: move occurs because the value has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n \n-error: aborting due to 2 previous errors\n+error[E0382]: use of moved value: `maybe` (Mir)\n+  --> $DIR/issue-41962.rs:17:16\n+   |\n+17 |         if let Some(thing) = maybe {\n+   |                ^^^^^-----^\n+   |                |    |\n+   |                |    value moved here\n+   |                value used here after move\n+   |\n+   = note: move occurs because `maybe` has type `std::option::Option<std::vec::Vec<bool>>`, which does not implement the `Copy` trait\n+\n+error[E0382]: use of moved value: `maybe.0` (Mir)\n+  --> $DIR/issue-41962.rs:17:21\n+   |\n+17 |         if let Some(thing) = maybe {\n+   |                     ^^^^^\n+   |                     |\n+   |                     value used here after move\n+   |                     value moved here in previous iteration of loop\n+   |\n+   = note: move occurs because `maybe.0` has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n+\n+error: aborting due to 4 previous errors\n "}]}