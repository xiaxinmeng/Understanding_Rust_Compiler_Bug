{"sha": "fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjNDZjMTJlMzY0MWM1ZGNkMThmNGIzMmY4NWIyZDhmMzMwMDBjZjY=", "commit": {"author": {"name": "David Lattimore", "email": "dml@google.com", "date": "2020-06-27T01:31:15Z"}, "committer": {"name": "David Lattimore", "email": "dml@google.com", "date": "2020-06-27T01:33:00Z"}, "message": "Fix test following change to fixture parsing (d016cb486738c1ab2574a322924183fa8a870b06)", "tree": {"sha": "29a0c7c6bf92215b840048717b91c4f19f7dc77e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29a0c7c6bf92215b840048717b91c4f19f7dc77e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6", "html_url": "https://github.com/rust-lang/rust/commit/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6/comments", "author": {"login": "davidlattimore", "id": 8983542, "node_id": "MDQ6VXNlcjg5ODM1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8983542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidlattimore", "html_url": "https://github.com/davidlattimore", "followers_url": "https://api.github.com/users/davidlattimore/followers", "following_url": "https://api.github.com/users/davidlattimore/following{/other_user}", "gists_url": "https://api.github.com/users/davidlattimore/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidlattimore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidlattimore/subscriptions", "organizations_url": "https://api.github.com/users/davidlattimore/orgs", "repos_url": "https://api.github.com/users/davidlattimore/repos", "events_url": "https://api.github.com/users/davidlattimore/events{/privacy}", "received_events_url": "https://api.github.com/users/davidlattimore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidlattimore", "id": 8983542, "node_id": "MDQ6VXNlcjg5ODM1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8983542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidlattimore", "html_url": "https://github.com/davidlattimore", "followers_url": "https://api.github.com/users/davidlattimore/followers", "following_url": "https://api.github.com/users/davidlattimore/following{/other_user}", "gists_url": "https://api.github.com/users/davidlattimore/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidlattimore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidlattimore/subscriptions", "organizations_url": "https://api.github.com/users/davidlattimore/orgs", "repos_url": "https://api.github.com/users/davidlattimore/repos", "events_url": "https://api.github.com/users/davidlattimore/events{/privacy}", "received_events_url": "https://api.github.com/users/davidlattimore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f4dc54958257ad33fe182d600c418591341c86dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4dc54958257ad33fe182d600c418591341c86dd", "html_url": "https://github.com/rust-lang/rust/commit/f4dc54958257ad33fe182d600c418591341c86dd"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "7a3141be8b901085401c684ddf8b9f92d6027d03", "filename": "crates/ra_ssr/src/tests.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6/crates%2Fra_ssr%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6/crates%2Fra_ssr%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ssr%2Fsrc%2Ftests.rs?ref=fc46c12e3641c5dcd18f4b32f85b2d8f33000cf6", "patch": "@@ -209,6 +209,11 @@ fn assert_ssr_transform(rule: &str, input: &str, result: &str) {\n     assert_ssr_transforms(&[rule], input, result);\n }\n \n+fn normalize_code(code: &str) -> String {\n+    let (db, file_id) = single_file(code);\n+    db.file_text(file_id).to_string()\n+}\n+\n fn assert_ssr_transforms(rules: &[&str], input: &str, result: &str) {\n     let (db, file_id) = single_file(input);\n     let mut match_finder = MatchFinder::new(&db);\n@@ -217,8 +222,13 @@ fn assert_ssr_transforms(rules: &[&str], input: &str, result: &str) {\n         match_finder.add_rule(rule);\n     }\n     if let Some(edits) = match_finder.edits_for_file(file_id) {\n-        let mut after = input.to_string();\n+        // Note, db.file_text is not necessarily the same as `input`, since fixture parsing alters\n+        // stuff.\n+        let mut after = db.file_text(file_id).to_string();\n         edits.apply(&mut after);\n+        // Likewise, we need to make sure that whatever transformations fixture parsing applies,\n+        // also get appplied to our expected result.\n+        let result = normalize_code(result);\n         assert_eq!(after, result);\n     } else {\n         panic!(\"No edits were made\");"}]}