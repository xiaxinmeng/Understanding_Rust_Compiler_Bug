{"sha": "5c9b9305b754065f6573d01fc27d1631b01a7abd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjOWI5MzA1Yjc1NDA2NWY2NTczZDAxZmMyN2QxNjMxYjAxYTdhYmQ=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-03-24T12:17:03Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-03-24T12:17:03Z"}, "message": "Update Cranelift and object", "tree": {"sha": "7ed0a195093b2f065286cfee9b2bbf4be492daca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ed0a195093b2f065286cfee9b2bbf4be492daca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c9b9305b754065f6573d01fc27d1631b01a7abd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c9b9305b754065f6573d01fc27d1631b01a7abd", "html_url": "https://github.com/rust-lang/rust/commit/5c9b9305b754065f6573d01fc27d1631b01a7abd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c9b9305b754065f6573d01fc27d1631b01a7abd/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c9ebdb19401965913b2b1dd81de1381058c87ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c9ebdb19401965913b2b1dd81de1381058c87ad", "html_url": "https://github.com/rust-lang/rust/commit/3c9ebdb19401965913b2b1dd81de1381058c87ad"}], "stats": {"total": 82, "additions": 22, "deletions": 60}, "files": [{"sha": "041b76ff5f301e19e605a3ba3ada912d37b3efb0", "filename": "Cargo.lock", "status": "modified", "additions": 16, "deletions": 56, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/5c9b9305b754065f6573d01fc27d1631b01a7abd/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/5c9b9305b754065f6573d01fc27d1631b01a7abd/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=5c9b9305b754065f6573d01fc27d1631b01a7abd", "patch": "@@ -45,15 +45,15 @@ checksum = \"4785bdd1c96b2a846b2bd7cc02e86b6b3dbf14e7e53446c4f54c92a361040822\"\n [[package]]\n name = \"cranelift-bforest\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-entity\",\n ]\n \n [[package]]\n name = \"cranelift-codegen\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"byteorder\",\n  \"cranelift-bforest\",\n@@ -70,7 +70,7 @@ dependencies = [\n [[package]]\n name = \"cranelift-codegen-meta\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-codegen-shared\",\n  \"cranelift-entity\",\n@@ -79,17 +79,17 @@ dependencies = [\n [[package]]\n name = \"cranelift-codegen-shared\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n \n [[package]]\n name = \"cranelift-entity\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n \n [[package]]\n name = \"cranelift-frontend\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"log\",\n@@ -100,7 +100,7 @@ dependencies = [\n [[package]]\n name = \"cranelift-module\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n@@ -112,7 +112,7 @@ dependencies = [\n [[package]]\n name = \"cranelift-native\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"raw-cpuid\",\n@@ -122,19 +122,18 @@ dependencies = [\n [[package]]\n name = \"cranelift-object\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"cranelift-module\",\n- \"goblin\",\n  \"object\",\n  \"target-lexicon\",\n ]\n \n [[package]]\n name = \"cranelift-simplejit\"\n version = \"0.60.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/#c202a8eeaf8f72a5e87d50ac2f0d58c9170b3488\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/#0d4bde4ab30f202c888888db7a8eb2d905c0119f\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"cranelift-module\",\n@@ -192,17 +191,6 @@ dependencies = [\n  \"indexmap\",\n ]\n \n-[[package]]\n-name = \"goblin\"\n-version = \"0.1.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"3081214398d39e4bd7f2c1975f0488ed04614ffdd976c6fc7a0708278552c0da\"\n-dependencies = [\n- \"log\",\n- \"plain\",\n- \"scroll\",\n-]\n-\n [[package]]\n name = \"indexmap\"\n version = \"1.3.2\"\n@@ -248,24 +236,16 @@ dependencies = [\n \n [[package]]\n name = \"object\"\n-version = \"0.17.0\"\n+version = \"0.18.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ea44a4fd660ab0f38434934ca0212e90fbeaaee54126ef20a3451c30c95bafae\"\n+checksum = \"e5666bbb90bc4d1e5bdcb26c0afda1822d25928341e9384ab187a9b37ab69e36\"\n dependencies = [\n  \"crc32fast\",\n- \"goblin\",\n  \"indexmap\",\n- \"scroll\",\n  \"target-lexicon\",\n- \"uuid\",\n+ \"wasmparser\",\n ]\n \n-[[package]]\n-name = \"plain\"\n-version = \"0.2.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b4596b6d070b27117e987119b4dac604f3c58cfb0b191112e24771b2faeac1a6\"\n-\n [[package]]\n name = \"proc-macro2\"\n version = \"1.0.9\"\n@@ -334,26 +314,6 @@ dependencies = [\n  \"semver\",\n ]\n \n-[[package]]\n-name = \"scroll\"\n-version = \"0.10.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"abb2332cb595d33f7edd5700f4cbf94892e680c7f0ae56adab58a35190b66cb1\"\n-dependencies = [\n- \"scroll_derive\",\n-]\n-\n-[[package]]\n-name = \"scroll_derive\"\n-version = \"0.10.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f8584eea9b9ff42825b46faf46a8c24d2cff13ec152fa2a50df788b87c07ee28\"\n-dependencies = [\n- \"proc-macro2\",\n- \"quote\",\n- \"syn\",\n-]\n-\n [[package]]\n name = \"semver\"\n version = \"0.9.0\"\n@@ -419,10 +379,10 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"826e7639553986605ec5979c7dd957c7895e93eabed50ab2ffa7f6128a75097c\"\n \n [[package]]\n-name = \"uuid\"\n-version = \"0.8.1\"\n+name = \"wasmparser\"\n+version = \"0.51.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9fde2f6a4bea1d6e007c4ad38c6839fa71cbb63b6dbf5b595aa38dc9b1093c11\"\n+checksum = \"aeb1956b19469d1c5e63e459d29e7b5aa0f558d9f16fcef09736f8a265e6c10a\"\n \n [[package]]\n name = \"winapi\""}, {"sha": "ab8410c49fd08a9c13019423109cf2847a4e58a8", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5c9b9305b754065f6573d01fc27d1631b01a7abd/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5c9b9305b754065f6573d01fc27d1631b01a7abd/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=5c9b9305b754065f6573d01fc27d1631b01a7abd", "patch": "@@ -20,7 +20,7 @@ byteorder = \"1.2.7\"\n indexmap = \"1.0.2\"\n \n [dependencies.object]\n-version = \"0.17.0\"\n+version = \"0.18.0\"\n default-features = false\n features = [\"read\", \"std\", \"write\"] # We don't need WASM support\n "}, {"sha": "3c3a7c5014910527dc6c48efca990c0c415b594e", "filename": "src/metadata.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5c9b9305b754065f6573d01fc27d1631b01a7abd/src%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c9b9305b754065f6573d01fc27d1631b01a7abd/src%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmetadata.rs?ref=5c9b9305b754065f6573d01fc27d1631b01a7abd", "patch": "@@ -44,13 +44,15 @@ impl MetadataLoader for CraneliftMetadataLoader {\n         _target: &Target,\n         path: &Path,\n     ) -> Result<owning_ref::ErasedBoxRef<[u8]>, String> {\n-        use object::Object;\n+        use object::{Object, ObjectSection};\n         let file = std::fs::read(path).map_err(|e| format!(\"read:{:?}\", e))?;\n         let file = object::File::parse(&file).map_err(|e| format!(\"parse: {:?}\", e))?;\n         let buf = file\n-            .section_data_by_name(\".rustc\")\n+            .section_by_name(\".rustc\")\n             .ok_or(\"no .rustc section\")?\n-            .into_owned();\n+            .data()\n+            .map_err(|e| format!(\"failed to read .rustc section: {:?}\", e))?\n+            .to_owned();\n         let buf: OwningRef<Vec<u8>, [u8]> = OwningRef::new(buf).into();\n         Ok(rustc_erase_owner!(buf.map_owner_box()))\n     }"}]}