{"sha": "6cb671628393e292d5e68e6367f80488ace46532", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjYjY3MTYyODM5M2UyOTJkNWU2OGU2MzY3ZjgwNDg4YWNlNDY1MzI=", "commit": {"author": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2020-08-16T03:01:38Z"}, "committer": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2020-09-04T20:04:13Z"}, "message": "Add test for checking if-let or-patterns", "tree": {"sha": "f254b77170cb0f356af32d5be334d5a23dd2ba9d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f254b77170cb0f356af32d5be334d5a23dd2ba9d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6cb671628393e292d5e68e6367f80488ace46532", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6cb671628393e292d5e68e6367f80488ace46532", "html_url": "https://github.com/rust-lang/rust/commit/6cb671628393e292d5e68e6367f80488ace46532", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6cb671628393e292d5e68e6367f80488ace46532/comments", "author": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2454643e137bde519786ee9e650c455d7ad6f34", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2454643e137bde519786ee9e650c455d7ad6f34", "html_url": "https://github.com/rust-lang/rust/commit/d2454643e137bde519786ee9e650c455d7ad6f34"}], "stats": {"total": 108, "additions": 108, "deletions": 0}, "files": [{"sha": "44d6bc619d3bbfa09b207b3d1be395418d054ef5", "filename": "src/test/mir-opt/issues/issue-75439.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/6cb671628393e292d5e68e6367f80488ace46532/src%2Ftest%2Fmir-opt%2Fissues%2Fissue-75439.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6cb671628393e292d5e68e6367f80488ace46532/src%2Ftest%2Fmir-opt%2Fissues%2Fissue-75439.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissues%2Fissue-75439.rs?ref=6cb671628393e292d5e68e6367f80488ace46532", "patch": "@@ -0,0 +1,21 @@\n+// EMIT_MIR issue_75439.foo.MatchBranchSimplification.diff\n+\n+#![feature(const_fn_transmute)]\n+#![feature(or_patterns)]\n+\n+use std::mem::transmute;\n+\n+pub fn foo(bytes: [u8; 16]) -> Option<[u8; 4]> {\n+    // big endian `u32`s\n+    let dwords: [u32; 4] = unsafe { transmute(bytes) };\n+    const FF: u32 = 0x0000_ffff_u32.to_be();\n+    if let [0, 0, 0 | FF, ip] = dwords {\n+        Some(unsafe { transmute(ip) })\n+    } else {\n+        None\n+    }\n+}\n+\n+fn main() {\n+  let _ = foo([0; 16]);\n+}"}, {"sha": "43422b36e1e5283894f3f923a390167d31158560", "filename": "src/test/mir-opt/issues/issue_75439.foo.MatchBranchSimplification.diff", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/6cb671628393e292d5e68e6367f80488ace46532/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_75439.foo.MatchBranchSimplification.diff", "raw_url": "https://github.com/rust-lang/rust/raw/6cb671628393e292d5e68e6367f80488ace46532/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_75439.foo.MatchBranchSimplification.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissues%2Fissue_75439.foo.MatchBranchSimplification.diff?ref=6cb671628393e292d5e68e6367f80488ace46532", "patch": "@@ -0,0 +1,87 @@\n+- // MIR for `foo` before MatchBranchSimplification\n++ // MIR for `foo` after MatchBranchSimplification\n+  \n+  fn foo(_1: [u8; 16]) -> Option<[u8; 4]> {\n+      debug bytes => _1;                   // in scope 0 at $DIR/issue-75439.rs:8:12: 8:17\n+      let mut _0: std::option::Option<[u8; 4]>; // return place in scope 0 at $DIR/issue-75439.rs:8:32: 8:47\n+      let _2: [u32; 4];                    // in scope 0 at $DIR/issue-75439.rs:10:9: 10:15\n+      let mut _3: [u8; 16];                // in scope 0 at $DIR/issue-75439.rs:10:47: 10:52\n+      let mut _5: [u8; 4];                 // in scope 0 at $DIR/issue-75439.rs:13:14: 13:38\n+      let mut _6: u32;                     // in scope 0 at $DIR/issue-75439.rs:13:33: 13:35\n+      scope 1 {\n+          debug dwords => _2;              // in scope 1 at $DIR/issue-75439.rs:10:9: 10:15\n+          let _4: u32;                     // in scope 1 at $DIR/issue-75439.rs:12:27: 12:29\n+          scope 3 {\n+              debug ip => _4;              // in scope 3 at $DIR/issue-75439.rs:12:27: 12:29\n+              scope 4 {\n+              }\n+          }\n+      }\n+      scope 2 {\n+      }\n+  \n+      bb0: {\n+          StorageLive(_2);                 // scope 0 at $DIR/issue-75439.rs:10:9: 10:15\n+          StorageLive(_3);                 // scope 2 at $DIR/issue-75439.rs:10:47: 10:52\n+          _3 = _1;                         // scope 2 at $DIR/issue-75439.rs:10:47: 10:52\n+          _2 = transmute::<[u8; 16], [u32; 4]>(move _3) -> bb1; // scope 2 at $DIR/issue-75439.rs:10:37: 10:53\n+                                           // mir::Constant\n+                                           // + span: $DIR/issue-75439.rs:10:37: 10:46\n+                                           // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn([u8; 16]) -> [u32; 4] {std::intrinsics::transmute::<[u8; 16], [u32; 4]>}, val: Value(Scalar(<ZST>)) }\n+      }\n+  \n+      bb1: {\n+          StorageDead(_3);                 // scope 2 at $DIR/issue-75439.rs:10:52: 10:53\n+          switchInt(_2[0 of 4]) -> [0_u32: bb2, otherwise: bb4]; // scope 1 at $DIR/issue-75439.rs:12:13: 12:14\n+      }\n+  \n+      bb2: {\n+          switchInt(_2[1 of 4]) -> [0_u32: bb3, otherwise: bb4]; // scope 1 at $DIR/issue-75439.rs:12:16: 12:17\n+      }\n+  \n+      bb3: {\n+          switchInt(_2[2 of 4]) -> [0_u32: bb6, 4294901760_u32: bb7, otherwise: bb4]; // scope 1 at $DIR/issue-75439.rs:12:19: 12:20\n+      }\n+  \n+      bb4: {\n+          discriminant(_0) = 0;            // scope 1 at $DIR/issue-75439.rs:15:9: 15:13\n+          goto -> bb9;                     // scope 1 at $DIR/issue-75439.rs:12:5: 16:6\n+      }\n+  \n+      bb5: {\n+          StorageLive(_5);                 // scope 3 at $DIR/issue-75439.rs:13:14: 13:38\n+          StorageLive(_6);                 // scope 4 at $DIR/issue-75439.rs:13:33: 13:35\n+          _6 = _4;                         // scope 4 at $DIR/issue-75439.rs:13:33: 13:35\n+          _5 = transmute::<u32, [u8; 4]>(move _6) -> bb8; // scope 4 at $DIR/issue-75439.rs:13:23: 13:36\n+                                           // mir::Constant\n+                                           // + span: $DIR/issue-75439.rs:13:23: 13:32\n+                                           // + literal: Const { ty: unsafe extern \"rust-intrinsic\" fn(u32) -> [u8; 4] {std::intrinsics::transmute::<u32, [u8; 4]>}, val: Value(Scalar(<ZST>)) }\n+      }\n+  \n+      bb6: {\n+          StorageLive(_4);                 // scope 1 at $DIR/issue-75439.rs:12:27: 12:29\n+          _4 = _2[3 of 4];                 // scope 1 at $DIR/issue-75439.rs:12:27: 12:29\n+          goto -> bb5;                     // scope 1 at $DIR/issue-75439.rs:12:5: 16:6\n+      }\n+  \n+      bb7: {\n+          StorageLive(_4);                 // scope 1 at $DIR/issue-75439.rs:12:27: 12:29\n+          _4 = _2[3 of 4];                 // scope 1 at $DIR/issue-75439.rs:12:27: 12:29\n+          goto -> bb5;                     // scope 1 at $DIR/issue-75439.rs:12:5: 16:6\n+      }\n+  \n+      bb8: {\n+          StorageDead(_6);                 // scope 4 at $DIR/issue-75439.rs:13:35: 13:36\n+          ((_0 as Some).0: [u8; 4]) = move _5; // scope 3 at $DIR/issue-75439.rs:13:9: 13:39\n+          discriminant(_0) = 1;            // scope 3 at $DIR/issue-75439.rs:13:9: 13:39\n+          StorageDead(_5);                 // scope 3 at $DIR/issue-75439.rs:13:38: 13:39\n+          StorageDead(_4);                 // scope 1 at $DIR/issue-75439.rs:14:5: 14:6\n+          goto -> bb9;                     // scope 1 at $DIR/issue-75439.rs:12:5: 16:6\n+      }\n+  \n+      bb9: {\n+          StorageDead(_2);                 // scope 0 at $DIR/issue-75439.rs:17:1: 17:2\n+          return;                          // scope 0 at $DIR/issue-75439.rs:17:2: 17:2\n+      }\n+  }\n+  "}]}