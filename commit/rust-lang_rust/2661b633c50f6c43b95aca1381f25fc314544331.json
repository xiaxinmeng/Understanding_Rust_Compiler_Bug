{"sha": "2661b633c50f6c43b95aca1381f25fc314544331", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2NjFiNjMzYzUwZjZjNDNiOTVhY2ExMzgxZjI1ZmMzMTQ1NDQzMzE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-19T18:55:03Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-25T00:56:42Z"}, "message": "Disallow char literals which should be escaped\n\nAs documented in issue #7945, these literal identifiers are all accepted by rust\ntoday, but they should probably be disallowed (especially `'''`). This changes\nall escapable sequences to being *required* to be escaped.\n\nCloses #7945", "tree": {"sha": "4360c45a5a8f507764ad95b91b7da12f68d27bd5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4360c45a5a8f507764ad95b91b7da12f68d27bd5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2661b633c50f6c43b95aca1381f25fc314544331", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2661b633c50f6c43b95aca1381f25fc314544331", "html_url": "https://github.com/rust-lang/rust/commit/2661b633c50f6c43b95aca1381f25fc314544331", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2661b633c50f6c43b95aca1381f25fc314544331/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89cc8529cc18802e4d7feb370e56809a1150b750", "url": "https://api.github.com/repos/rust-lang/rust/commits/89cc8529cc18802e4d7feb370e56809a1150b750", "html_url": "https://github.com/rust-lang/rust/commit/89cc8529cc18802e4d7feb370e56809a1150b750"}], "stats": {"total": 110, "additions": 89, "deletions": 21}, "files": [{"sha": "c848f52b3eacac52a8bf756ee1c787110fb6946d", "filename": "src/libsyntax/parse/lexer.rs", "status": "modified", "additions": 28, "deletions": 21, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/2661b633c50f6c43b95aca1381f25fc314544331/src%2Flibsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2661b633c50f6c43b95aca1381f25fc314544331/src%2Flibsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer.rs?ref=2661b633c50f6c43b95aca1381f25fc314544331", "patch": "@@ -747,27 +747,34 @@ fn next_token_inner(rdr: @mut StringReader) -> token::Token {\n         }\n \n         // Otherwise it is a character constant:\n-        if c2 == '\\\\' {\n-            // '\\X' for some X must be a character constant:\n-            let escaped = rdr.curr;\n-            let escaped_pos = rdr.last_pos;\n-            bump(rdr);\n-            match escaped {\n-              'n' => { c2 = '\\n'; }\n-              'r' => { c2 = '\\r'; }\n-              't' => { c2 = '\\t'; }\n-              '\\\\' => { c2 = '\\\\'; }\n-              '\\'' => { c2 = '\\''; }\n-              '\"' => { c2 = '\"'; }\n-              '0' => { c2 = '\\x00'; }\n-              'x' => { c2 = scan_numeric_escape(rdr, 2u); }\n-              'u' => { c2 = scan_numeric_escape(rdr, 4u); }\n-              'U' => { c2 = scan_numeric_escape(rdr, 8u); }\n-              c2 => {\n-                fatal_span_char(rdr, escaped_pos, rdr.last_pos,\n-                                ~\"unknown character escape\", c2);\n-              }\n+        match c2 {\n+            '\\\\' => {\n+                // '\\X' for some X must be a character constant:\n+                let escaped = rdr.curr;\n+                let escaped_pos = rdr.last_pos;\n+                bump(rdr);\n+                match escaped {\n+                    'n' => { c2 = '\\n'; }\n+                    'r' => { c2 = '\\r'; }\n+                    't' => { c2 = '\\t'; }\n+                    '\\\\' => { c2 = '\\\\'; }\n+                    '\\'' => { c2 = '\\''; }\n+                    '\"' => { c2 = '\"'; }\n+                    '0' => { c2 = '\\x00'; }\n+                    'x' => { c2 = scan_numeric_escape(rdr, 2u); }\n+                    'u' => { c2 = scan_numeric_escape(rdr, 4u); }\n+                    'U' => { c2 = scan_numeric_escape(rdr, 8u); }\n+                    c2 => {\n+                        fatal_span_char(rdr, escaped_pos, rdr.last_pos,\n+                                        ~\"unknown character escape\", c2);\n+                    }\n+                }\n+            }\n+            '\\t' | '\\n' | '\\r' | '\\'' => {\n+                fatal_span_char(rdr, start, rdr.last_pos,\n+                                ~\"character constant must be escaped\", c2);\n             }\n+            _ => {}\n         }\n         if rdr.curr != '\\'' {\n             fatal_span_verbose(rdr,\n@@ -973,7 +980,7 @@ mod test {\n     }\n \n     #[test] fn character_escaped() {\n-        let env = setup(@\"'\\n'\");\n+        let env = setup(@\"'\\\\n'\");\n         let TokenAndSpan {tok, sp: _} =\n             env.string_reader.next_token();\n         assert_eq!(tok, token::LIT_CHAR('\\n' as u32));"}, {"sha": "53723c87a521b5fa0a9f8a35f9cb13477c871205", "filename": "src/test/compile-fail/bad-char-literals.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-char-literals.rs?ref=2661b633c50f6c43b95aca1381f25fc314544331", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    // these literals are just silly.\n+    ''';\n+    //~^ ERROR: character constant must be escaped\n+}"}, {"sha": "c5226cfec457bcb461d97e4ef599e8e9a6f758e1", "filename": "src/test/compile-fail/bad-char-literals2.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-char-literals2.rs?ref=2661b633c50f6c43b95aca1381f25fc314544331", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    // note that this is a literal \"\\n\" byte\n+    '\n+';\n+    //~^^ ERROR: character constant must be escaped\n+}"}, {"sha": "9bbe5c75b17234bcb5f1b08e475ff411c3960d41", "filename": "src/test/compile-fail/bad-char-literals3.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-char-literals3.rs?ref=2661b633c50f6c43b95aca1381f25fc314544331", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    // note that this is a literal \"\\r\" byte\n+    '\r';\n+    //~^ ERROR: character constant must be escaped\n+}"}, {"sha": "675ff742d5cca321f97d0889dae92e95f81f376b", "filename": "src/test/compile-fail/bad-char-literals4.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2661b633c50f6c43b95aca1381f25fc314544331/src%2Ftest%2Fcompile-fail%2Fbad-char-literals4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-char-literals4.rs?ref=2661b633c50f6c43b95aca1381f25fc314544331", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    // note that this is a literal tab character here\n+    '\t';\n+    //~^ ERROR: character constant must be escaped\n+}"}]}