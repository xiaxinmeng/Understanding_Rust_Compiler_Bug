{"sha": "1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEyNjRiYjZiN2Q3NDA5NWY3ZmI5MjIxOTA0YmJjMjg4ZmYyMWEzYzM=", "commit": {"author": {"name": "Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-18T07:44:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-18T07:44:24Z"}, "message": "Merge pull request #3323 from pengowen123/fix_manual_memcpy\n\nSimplify manual_memcpy suggestion in some cases", "tree": {"sha": "a7aaafcb40c14362dc48b05313f881eecc81e37a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7aaafcb40c14362dc48b05313f881eecc81e37a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbyDnYCRBK7hj4Ov3rIwAAdHIIAI+gjlSAKD3CmF61cv0Zy9OT\n2moiic7wlqxcDkPnnmiQiX+ASiZ3W1uQuCe212t20UIQlPfz5xCxkqpjNuBbKIzA\np8BXeXzMgzO5ZCFjEhHf63wqOSNuSNK6rQ7vzkk9YYhhJmQIVe4koBNq/OW5LOav\nMRKaJlKYzU9tk8/pvgHEX6iZtxXIs5X1qatQeEVan7EacMaOBJM+hY+FQPYfW0YI\nqioYyhV67MSTgH9brjQfwx41MuCJrNN4niXAhhakGUtNLVX/OkJEOaBknqxyyDpR\nP1B9VYdms4ioo3K3jv477fh+53TcjMyxG6bom+KYtDOfnlaktVgTennWuYzY8JI=\n=9QRZ\n-----END PGP SIGNATURE-----\n", "payload": "tree a7aaafcb40c14362dc48b05313f881eecc81e37a\nparent adbaa85ee90b120ab22082811373750a95aeda39\nparent 8c902d1cf263c38416ccf4bf48d143d40c75f8db\nauthor Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer <github35764891676564198441@oli-obk.de> 1539848664 +0200\ncommitter GitHub <noreply@github.com> 1539848664 +0200\n\nMerge pull request #3323 from pengowen123/fix_manual_memcpy\n\nSimplify manual_memcpy suggestion in some cases"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "html_url": "https://github.com/rust-lang/rust/commit/1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "adbaa85ee90b120ab22082811373750a95aeda39", "url": "https://api.github.com/repos/rust-lang/rust/commits/adbaa85ee90b120ab22082811373750a95aeda39", "html_url": "https://github.com/rust-lang/rust/commit/adbaa85ee90b120ab22082811373750a95aeda39"}, {"sha": "8c902d1cf263c38416ccf4bf48d143d40c75f8db", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c902d1cf263c38416ccf4bf48d143d40c75f8db", "html_url": "https://github.com/rust-lang/rust/commit/8c902d1cf263c38416ccf4bf48d143d40c75f8db"}], "stats": {"total": 55, "additions": 46, "deletions": 9}, "files": [{"sha": "9e45757f3f0f5531c9bf932b908f799ea21b8b5c", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "patch": "@@ -950,8 +950,20 @@ fn detect_manual_memcpy<'a, 'tcx>(\n                     (\"0\", _, x, false) | (x, false, \"0\", false) => x.into(),\n                     (\"0\", _, x, true) | (x, false, \"0\", true) => format!(\"-{}\", x),\n                     (x, false, y, false) => format!(\"({} + {})\", x, y),\n-                    (x, false, y, true) => format!(\"({} - {})\", x, y),\n-                    (x, true, y, false) => format!(\"({} - {})\", y, x),\n+                    (x, false, y, true) => {\n+                        if x == y {\n+                            \"0\".into()\n+                        } else {\n+                            format!(\"({} - {})\", x, y)\n+                        }\n+                    },\n+                    (x, true, y, false) => {\n+                        if x == y {\n+                            \"0\".into()\n+                        } else {\n+                            format!(\"({} - {})\", y, x)\n+                        }\n+                    },\n                     (x, true, y, true) => format!(\"-({} + {})\", x, y),\n                 }\n             };"}, {"sha": "f80270d9fe8f71514a37fa4afe7cd91505460932", "filename": "tests/ui/for_loop.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.rs?ref=1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "patch": "@@ -550,6 +550,19 @@ pub fn manual_copy(src: &[i32], dst: &mut [i32], dst2: &mut [i32]) {\n     for i in 0..10 {\n         dst_vec[i] = src[i];\n     }\n+\n+    // Simplify suggestion (issue #3004)\n+    let src = [0, 1, 2, 3, 4];\n+    let mut dst = [0, 0, 0, 0, 0, 0];\n+    let from = 1;\n+\n+    for i in from..from + src.len() {\n+        dst[i] = src[i - from];\n+    }\n+\n+    for i in from..from + 3 {\n+        dst[i] = src[i - from];\n+    }\n }\n \n #[warn(clippy::needless_range_loop)]"}, {"sha": "331763357832610dad9e6ba4706c4aa4560de589", "filename": "tests/ui/for_loop.stderr", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stderr?ref=1264bb6b7d74095f7fb9221904bbc288ff21a3c3", "patch": "@@ -482,22 +482,34 @@ error: it looks like you're manually copying between slices\n     |              ^^^^^^^^^^^^^^^^ help: try replacing the loop by: `dst_vec[..src_vec.len()].clone_from_slice(&src_vec[..])`\n \n error: it looks like you're manually copying between slices\n-   --> $DIR/for_loop.rs:557:14\n+   --> $DIR/for_loop.rs:559:14\n     |\n-557 |     for i in 0..src.len() {\n+559 |     for i in from..from + src.len() {\n+    |              ^^^^^^^^^^^^^^^^^^^^^^ help: try replacing the loop by: `dst[from..from + src.len()].clone_from_slice(&src[0..(from + src.len() - from)])`\n+\n+error: it looks like you're manually copying between slices\n+   --> $DIR/for_loop.rs:563:14\n+    |\n+563 |     for i in from..from + 3 {\n+    |              ^^^^^^^^^^^^^^ help: try replacing the loop by: `dst[from..from + 3].clone_from_slice(&src[0..(from + 3 - from)])`\n+\n+error: it looks like you're manually copying between slices\n+   --> $DIR/for_loop.rs:570:14\n+    |\n+570 |     for i in 0..src.len() {\n     |              ^^^^^^^^^^^^ help: try replacing the loop by: `dst[..src.len()].clone_from_slice(&src[..])`\n \n error: the variable `count` is used as a loop counter. Consider using `for (count, item) in text.chars().enumerate()` or similar iterators\n-   --> $DIR/for_loop.rs:618:19\n+   --> $DIR/for_loop.rs:631:19\n     |\n-618 |         for ch in text.chars() {\n+631 |         for ch in text.chars() {\n     |                   ^^^^^^^^^^^^\n \n error: the variable `count` is used as a loop counter. Consider using `for (count, item) in text.chars().enumerate()` or similar iterators\n-   --> $DIR/for_loop.rs:629:19\n+   --> $DIR/for_loop.rs:642:19\n     |\n-629 |         for ch in text.chars() {\n+642 |         for ch in text.chars() {\n     |                   ^^^^^^^^^^^^\n \n-error: aborting due to 61 previous errors\n+error: aborting due to 63 previous errors\n "}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "tests/ui/for_loop.stdout", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/1264bb6b7d74095f7fb9221904bbc288ff21a3c3/tests%2Fui%2Ffor_loop.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stdout?ref=1264bb6b7d74095f7fb9221904bbc288ff21a3c3"}]}