{"sha": "d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4MGJlM2I0ZmY0OTU4M2Q5NGRlYTg5YjFiOWJkMDZhMDEzZjQzZDY=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-09-22T13:35:28Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-10-15T07:03:51Z"}, "message": "Test basic hygiene for `macro_rules` produced by transparent macros", "tree": {"sha": "e65d9a76d520b1db1387c21d6d7a0096165712e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e65d9a76d520b1db1387c21d6d7a0096165712e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "html_url": "https://github.com/rust-lang/rust/commit/d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b39e188dda7a690f560c8beb0ae0b34982b993d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/b39e188dda7a690f560c8beb0ae0b34982b993d8", "html_url": "https://github.com/rust-lang/rust/commit/b39e188dda7a690f560c8beb0ae0b34982b993d8"}], "stats": {"total": 74, "additions": 74, "deletions": 0}, "files": [{"sha": "548fefe76f57111a25c50726aa6c6e0500b0d3c9", "filename": "src/test/ui/proc-macro/auxiliary/gen-macro-rules-hygiene.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fgen-macro-rules-hygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fgen-macro-rules-hygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fgen-macro-rules-hygiene.rs?ref=d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "patch": "@@ -0,0 +1,23 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+use proc_macro::*;\n+\n+#[proc_macro]\n+pub fn gen_macro_rules(_: TokenStream) -> TokenStream {\n+    \"\n+    macro_rules! generated {() => {\n+        struct ItemDef;\n+        let local_def = 0;\n+\n+        ItemUse; // OK\n+        local_use; // ERROR\n+        break 'label_use; // ERROR\n+\n+        type DollarCrate = $crate::ItemUse; // OK\n+    }}\n+    \".parse().unwrap()\n+}"}, {"sha": "195bda82e9ce1f3cee048362d59f5650d3549592", "filename": "src/test/ui/proc-macro/gen-macro-rules-hygiene.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.rs?ref=d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "patch": "@@ -0,0 +1,23 @@\n+// `macro_rules` items produced by transparent macros have correct hygiene in basic cases.\n+// Local variables and labels are hygienic, items are not hygienic.\n+// `$crate` refers to the crate that defines `macro_rules` and not the outer transparent macro.\n+\n+// aux-build:gen-macro-rules-hygiene.rs\n+\n+#[macro_use]\n+extern crate gen_macro_rules_hygiene;\n+\n+struct ItemUse;\n+\n+gen_macro_rules!();\n+//~^ ERROR use of undeclared label `'label_use`\n+//~| ERROR cannot find value `local_use` in this scope\n+\n+fn main() {\n+    'label_use: loop {\n+        let local_use = 1;\n+        generated!();\n+        ItemDef; // OK\n+        local_def; //~ ERROR cannot find value `local_def` in this scope\n+    }\n+}"}, {"sha": "ecebdfa965666ec7fc2771a6f41fdc88a1c71516", "filename": "src/test/ui/proc-macro/gen-macro-rules-hygiene.stderr", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d80be3b4ff49583d94dea89b1b9bd06a013f43d6/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fgen-macro-rules-hygiene.stderr?ref=d80be3b4ff49583d94dea89b1b9bd06a013f43d6", "patch": "@@ -0,0 +1,28 @@\n+error[E0426]: use of undeclared label `'label_use`\n+  --> $DIR/gen-macro-rules-hygiene.rs:12:1\n+   |\n+LL | gen_macro_rules!();\n+   | ^^^^^^^^^^^^^^^^^^^ undeclared label `'label_use`\n+...\n+LL |         generated!();\n+   |         ------------- in this macro invocation\n+\n+error[E0425]: cannot find value `local_use` in this scope\n+  --> $DIR/gen-macro-rules-hygiene.rs:12:1\n+   |\n+LL | gen_macro_rules!();\n+   | ^^^^^^^^^^^^^^^^^^^ not found in this scope\n+...\n+LL |         generated!();\n+   |         ------------- in this macro invocation\n+\n+error[E0425]: cannot find value `local_def` in this scope\n+  --> $DIR/gen-macro-rules-hygiene.rs:21:9\n+   |\n+LL |         local_def;\n+   |         ^^^^^^^^^ not found in this scope\n+\n+error: aborting due to 3 previous errors\n+\n+Some errors have detailed explanations: E0425, E0426.\n+For more information about an error, try `rustc --explain E0425`."}]}