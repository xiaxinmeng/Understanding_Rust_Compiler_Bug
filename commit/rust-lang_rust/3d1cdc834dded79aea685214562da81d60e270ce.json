{"sha": "3d1cdc834dded79aea685214562da81d60e270ce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkMWNkYzgzNGRkZWQ3OWFlYTY4NTIxNDU2MmRhODFkNjBlMjcwY2U=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-21T20:17:49Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-21T21:04:37Z"}, "message": "Fix offset bug in SourceWalker", "tree": {"sha": "91cca49d99ba49bacb81b855547d3a609f4103d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/91cca49d99ba49bacb81b855547d3a609f4103d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d1cdc834dded79aea685214562da81d60e270ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d1cdc834dded79aea685214562da81d60e270ce", "html_url": "https://github.com/rust-lang/rust/commit/3d1cdc834dded79aea685214562da81d60e270ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d1cdc834dded79aea685214562da81d60e270ce/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49c9686c3cb02d64c077d3002f3c68e6fa2cf407", "url": "https://api.github.com/repos/rust-lang/rust/commits/49c9686c3cb02d64c077d3002f3c68e6fa2cf407", "html_url": "https://github.com/rust-lang/rust/commit/49c9686c3cb02d64c077d3002f3c68e6fa2cf407"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "20da1e9f7e54239865651fba6d7e137faf908229", "filename": "crates/ra_mbe/src/subtree_source.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3d1cdc834dded79aea685214562da81d60e270ce/crates%2Fra_mbe%2Fsrc%2Fsubtree_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d1cdc834dded79aea685214562da81d60e270ce/crates%2Fra_mbe%2Fsrc%2Fsubtree_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fsubtree_source.rs?ref=3d1cdc834dded79aea685214562da81d60e270ce", "patch": "@@ -21,6 +21,7 @@ impl<'a> From<&'a [tt::TokenTree]> for TokenSeq<'a> {\n     }\n }\n \n+#[derive(Debug)]\n enum DelimToken<'a> {\n     Delim(&'a tt::Delimiter, bool),\n     Token(&'a tt::TokenTree),\n@@ -52,10 +53,10 @@ impl<'a> TokenSeq<'a> {\n         }\n     }\n \n-    fn child_slice(&self) -> &[tt::TokenTree] {\n+    fn child_slice(&self, pos: usize) -> &[tt::TokenTree] {\n         match self {\n-            TokenSeq::Subtree(subtree) => &subtree.token_trees,\n-            TokenSeq::Seq(tokens) => &tokens,\n+            TokenSeq::Subtree(subtree) => &subtree.token_trees[pos - 1..],\n+            TokenSeq::Seq(tokens) => &tokens[pos..],\n         }\n     }\n }\n@@ -114,7 +115,7 @@ impl<'a> SubTreeWalker<'a> {\n                     WalkCursor::Token(0, convert_delim(subtree.delimiter, false))\n                 }\n                 tt::TokenTree::Leaf(leaf) => {\n-                    let next_tokens = self.ts.child_slice();\n+                    let next_tokens = self.ts.child_slice(0);\n                     WalkCursor::Token(0, convert_leaf(&next_tokens, leaf))\n                 }\n             },\n@@ -190,8 +191,8 @@ impl<'a> SubTreeWalker<'a> {\n                     WalkCursor::Token(new_idx, convert_delim(subtree.delimiter, backward))\n                 }\n                 tt::TokenTree::Leaf(leaf) => {\n-                    let next_tokens = top.child_slice();\n-                    WalkCursor::Token(pos, convert_leaf(&next_tokens[pos..], leaf))\n+                    let next_tokens = top.child_slice(pos);\n+                    WalkCursor::Token(pos, convert_leaf(&next_tokens, leaf))\n                 }\n             },\n             DelimToken::Delim(delim, is_end) => {"}]}