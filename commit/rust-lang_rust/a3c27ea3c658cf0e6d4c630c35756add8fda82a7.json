{"sha": "a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzYzI3ZWEzYzY1OGNmMGU2ZDRjNjMwYzM1NzU2YWRkOGZkYTgyYTc=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-15T20:40:30Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2014-09-15T23:25:20Z"}, "message": "mk: Update how the build deals with version labels. #16677\n\nAdds a new configure flag, --release-channel, which determines how the version\nnumber should be augmented with a release label, as well as how the distribution\nartifacts will be named. This is entirely for use by the build automation.\n\n--release-channel can be either 'source', 'nightly', 'beta', or 'stable'.\n\nHere's a summary of the affect of these values on version number and\nartifact naming, respectively:\n\n* source - '0.12.0-pre', 'rust-0.12.0-pre-...'\n* nightly - '0.12.0-nightly', 'rust-nightly-...'\n* beta - '0.12.0-beta', 'rust-beta-...'\n* stable - '0.12.0', 'rust-0.12.0-...'\n\nPer http://discuss.rust-lang.org/t/rfc-impending-changes-to-the-release-process/508/1", "tree": {"sha": "eab839bf821c5bf8510699a68e6f28e73a416306", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eab839bf821c5bf8510699a68e6f28e73a416306"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "html_url": "https://github.com/rust-lang/rust/commit/a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8d478db512803d25785a11c5b21634f8703b17f", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8d478db512803d25785a11c5b21634f8703b17f", "html_url": "https://github.com/rust-lang/rust/commit/a8d478db512803d25785a11c5b21634f8703b17f"}], "stats": {"total": 57, "additions": 43, "deletions": 14}, "files": [{"sha": "23ba3e5b6fad8d54c8984b8ccb166bcf85a666f0", "filename": "configure", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/configure", "raw_url": "https://github.com/rust-lang/rust/raw/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "patch": "@@ -453,6 +453,8 @@ valopt datadir \"${CFG_PREFIX}/share\" \"install data\"\n valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt mandir \"${CFG_PREFIX}/share/man\" \"install man pages in PATH\"\n \n+valopt release-channel \"source\" \"the name of the release channel to build\"\n+\n # On windows we just store the libraries in the bin directory because\n # there's no rpath. This is where the build system itself puts libraries;\n # --libdir is used to configure the installation directory.\n@@ -481,6 +483,23 @@ CFG_BUILD=`echo \"${CFG_BUILD}\" | sed 's/-pc-mingw32/-w64-mingw32/g'`\n CFG_HOST=`echo \"${CFG_HOST}\" | sed 's/-pc-mingw32/-w64-mingw32/g'`\n CFG_TARGET=`echo \"${CFG_TARGET}\" | sed 's/-pc-mingw32/-w64-mingw32/g'`\n \n+# Validate the release channel\n+case \"$CFG_RELEASE_CHANNEL\" in\n+    (source | nightly | beta | stable)\n+\t;;\n+    (*)\n+        err \"release channel must be 'source', 'nightly', 'beta' or 'stable'\"\n+        ;;\n+esac\n+\n+# Continue supporting the old --enable-nightly flag to transition the bots\n+# XXX Remove me\n+if [ $CFG_ENABLE_NIGHTLY -eq 1 ]\n+then\n+    CFG_RELEASE_CHANNEL=nightly\n+    putvar CFG_RELEASE_CHANNEL\n+fi\n+\n step_msg \"looking for build programs\"\n \n probe_need CFG_PERL        perl"}, {"sha": "6b7243541c41afb0f10f129b2367ba6dbf84ae35", "filename": "man/rustc.1", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/man%2Frustc.1", "raw_url": "https://github.com/rust-lang/rust/raw/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/man%2Frustc.1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/man%2Frustc.1?ref=a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "patch": "@@ -1,4 +1,4 @@\n-.TH RUSTC \"1\" \"March 2014\" \"rustc 0.12.0-pre\" \"User Commands\"\n+.TH RUSTC \"1\" \"March 2014\" \"rustc 0.12.0\" \"User Commands\"\n .SH NAME\n rustc \\- The Rust compiler\n .SH SYNOPSIS"}, {"sha": "e675aca38aa9882993aeae8431fa85861f41882c", "filename": "man/rustdoc.1", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/man%2Frustdoc.1", "raw_url": "https://github.com/rust-lang/rust/raw/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/man%2Frustdoc.1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/man%2Frustdoc.1?ref=a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "patch": "@@ -1,4 +1,4 @@\n-.TH RUSTDOC \"1\" \"March 2014\" \"rustdoc 0.12.0-pre\" \"User Commands\"\n+.TH RUSTDOC \"1\" \"March 2014\" \"rustdoc 0.12.0\" \"User Commands\"\n .SH NAME\n rustdoc \\- generate documentation from Rust source code\n .SH SYNOPSIS"}, {"sha": "6667a29d4f956fd661da5e2b4a284b54fed83e33", "filename": "mk/main.mk", "status": "modified", "additions": 21, "deletions": 11, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "patch": "@@ -14,22 +14,32 @@\n \n # The version number\n CFG_RELEASE_NUM=0.12.0\n-CFG_RELEASE_LABEL=-pre\n \n CFG_FILENAME_EXTRA=4e7c5e5c\n \n-ifndef CFG_ENABLE_NIGHTLY\n-# This is the normal version string\n-CFG_RELEASE=$(CFG_RELEASE_NUM)$(CFG_RELEASE_LABEL)\n-CFG_PACKAGE_VERS=$(CFG_RELEASE)\n-else\n-# Modify the version label for nightly builds\n-CFG_RELEASE=$(CFG_RELEASE_NUM)$(CFG_RELEASE_LABEL)-nightly\n-# When building nightly distributables just reuse the same \"rust-nightly\" name\n-# so when we upload we'll always override the previous nighly. This doesn't actually\n-# impact the version reported by rustc - it's just for file naming.\n+ifeq ($(CFG_RELEASE_CHANNEL),stable)\n+# This is the normal semver version string, e.g. \"0.12.0\", \"0.12.0-nightly\"\n+CFG_RELEASE=$(CFG_RELEASE_NUM)\n+# This is the string used in dist artifact file names, e.g. \"0.12.0\", \"nightly\"\n+CFG_PACKAGE_VERS=$(CFG_RELEASE_NUM)\n+endif\n+ifeq ($(CFG_RELEASE_CHANNEL),beta)\n+CFG_RELEASE=$(CFG_RELEASE_NUM)-beta\n+# When building beta/nightly distributables just reuse the same \"beta\"\n+# name so when we upload we'll always override the previous\n+# nighly. This doesn't actually impact the version reported by rustc -\n+# it's just for file naming.\n+CFG_PACKAGE_VERS=beta\n+endif\n+ifeq ($(CFG_RELEASE_CHANNEL),nightly)\n+CFG_RELEASE=$(CFG_RELEASE_NUM)-nightly\n CFG_PACKAGE_VERS=nightly\n endif\n+ifeq ($(CFG_RELEASE_CHANNEL),source)\n+CFG_RELEASE=$(CFG_RELEASE_NUM)-pre\n+CFG_PACKAGE_VERS=$(CFG_RELEASE_NUM)-pre\n+endif\n+\n # The name of the package to use for creating tarballs, installers etc.\n CFG_PACKAGE_NAME=rust-$(CFG_PACKAGE_VERS)\n "}, {"sha": "2b80c0ff39f5a43b6c24415689f436b56c5964cb", "filename": "src/etc/kate/rust.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/src%2Fetc%2Fkate%2Frust.xml", "raw_url": "https://github.com/rust-lang/rust/raw/a3c27ea3c658cf0e6d4c630c35756add8fda82a7/src%2Fetc%2Fkate%2Frust.xml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fkate%2Frust.xml?ref=a3c27ea3c658cf0e6d4c630c35756add8fda82a7", "patch": "@@ -7,7 +7,7 @@\n \t<!ENTITY rustIdent \"[a-zA-Z_][a-zA-Z_0-9]*\">\n \t<!ENTITY rustIntSuf \"([iu](8|16|32|64)?)?\">\n ]>\n-<language name=\"Rust\" version=\"0.12.0-pre\" kateversion=\"2.4\" section=\"Sources\" extensions=\"*.rs\" mimetype=\"text/x-rust\" priority=\"15\">\n+<language name=\"Rust\" version=\"0.12.0\" kateversion=\"2.4\" section=\"Sources\" extensions=\"*.rs\" mimetype=\"text/x-rust\" priority=\"15\">\n <highlighting>\n \t<list name=\"fn\">\n \t\t<item> fn </item>"}]}