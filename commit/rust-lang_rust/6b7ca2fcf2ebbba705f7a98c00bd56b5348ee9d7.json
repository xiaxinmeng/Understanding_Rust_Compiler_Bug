{"sha": "6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "node_id": "C_kwDOAAsO6NoAKDZiN2NhMmZjZjJlYmJiYTcwNWY3YTk4YzAwYmQ1NmI1MzQ4ZWU5ZDc", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-09-08T00:52:51Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-11-17T02:45:59Z"}, "message": "Box `ExprKind::{Closure,MethodCall}`, and `QSelf` in expressions, types, and patterns.", "tree": {"sha": "36212a72da44e033e4bae2d42d087abcf488748f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36212a72da44e033e4bae2d42d087abcf488748f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "html_url": "https://github.com/rust-lang/rust/commit/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bebd57a9602e48431c90274fbf7d96683b0708b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/bebd57a9602e48431c90274fbf7d96683b0708b6", "html_url": "https://github.com/rust-lang/rust/commit/bebd57a9602e48431c90274fbf7d96683b0708b6"}], "stats": {"total": 727, "additions": 409, "deletions": 318}, "files": [{"sha": "a9b3aa1d56022ae044106cc9a19e9b4e9e8d3907", "filename": "compiler/rustc_ast/src/ast.rs", "status": "modified", "additions": 42, "deletions": 27, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fast.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -718,10 +718,10 @@ pub enum PatKind {\n \n     /// A struct or struct variant pattern (e.g., `Variant {x, y, ..}`).\n     /// The `bool` is `true` in the presence of a `..`.\n-    Struct(Option<QSelf>, Path, Vec<PatField>, /* recovered */ bool),\n+    Struct(Option<P<QSelf>>, Path, Vec<PatField>, /* recovered */ bool),\n \n     /// A tuple struct/variant pattern (`Variant(x, y, .., z)`).\n-    TupleStruct(Option<QSelf>, Path, Vec<P<Pat>>),\n+    TupleStruct(Option<P<QSelf>>, Path, Vec<P<Pat>>),\n \n     /// An or-pattern `A | B | C`.\n     /// Invariant: `pats.len() >= 2`.\n@@ -731,7 +731,7 @@ pub enum PatKind {\n     /// Unqualified path patterns `A::B::C` can legally refer to variants, structs, constants\n     /// or associated constants. Qualified path patterns `<A>::B::C`/`<A as Trait>::B::C` can\n     /// only legally refer to associated constants.\n-    Path(Option<QSelf>, Path),\n+    Path(Option<P<QSelf>>, Path),\n \n     /// A tuple pattern (`(a, b)`).\n     Tuple(Vec<P<Pat>>),\n@@ -1272,6 +1272,18 @@ impl Expr {\n     }\n }\n \n+#[derive(Clone, Encodable, Decodable, Debug)]\n+pub struct Closure {\n+    pub binder: ClosureBinder,\n+    pub capture_clause: CaptureBy,\n+    pub asyncness: Async,\n+    pub movability: Movability,\n+    pub fn_decl: P<FnDecl>,\n+    pub body: P<Expr>,\n+    /// The span of the argument block `|...|`.\n+    pub fn_decl_span: Span,\n+}\n+\n /// Limit types of a range (inclusive or exclusive)\n #[derive(Copy, Clone, PartialEq, Encodable, Decodable, Debug)]\n pub enum RangeLimits {\n@@ -1281,6 +1293,20 @@ pub enum RangeLimits {\n     Closed,\n }\n \n+/// A method call (e.g. `x.foo::<Bar, Baz>(a, b, c)`).\n+#[derive(Clone, Encodable, Decodable, Debug)]\n+pub struct MethodCall {\n+    /// The method name and its generic arguments, e.g. `foo::<Bar, Baz>`.\n+    pub seg: PathSegment,\n+    /// The receiver, e.g. `x`.\n+    pub receiver: P<Expr>,\n+    /// The arguments, e.g. `a, b, c`.\n+    pub args: Vec<P<Expr>>,\n+    /// The span of the function, without the dot and receiver e.g. `foo::<Bar,\n+    /// Baz>(a, b, c)`.\n+    pub span: Span,\n+}\n+\n #[derive(Clone, Encodable, Decodable, Debug)]\n pub enum StructRest {\n     /// `..x`.\n@@ -1293,7 +1319,7 @@ pub enum StructRest {\n \n #[derive(Clone, Encodable, Decodable, Debug)]\n pub struct StructExpr {\n-    pub qself: Option<QSelf>,\n+    pub qself: Option<P<QSelf>>,\n     pub path: Path,\n     pub fields: Vec<ExprField>,\n     pub rest: StructRest,\n@@ -1314,17 +1340,8 @@ pub enum ExprKind {\n     /// This also represents calling the constructor of\n     /// tuple-like ADTs such as tuple structs and enum variants.\n     Call(P<Expr>, Vec<P<Expr>>),\n-    /// A method call (`x.foo::<'static, Bar, Baz>(a, b, c, d)`)\n-    ///\n-    /// The `PathSegment` represents the method name and its generic arguments\n-    /// (within the angle brackets).\n-    /// The standalone `Expr` is the receiver expression.\n-    /// The vector of `Expr` is the arguments.\n-    /// `x.foo::<Bar, Baz>(a, b, c, d)` is represented as\n-    /// `ExprKind::MethodCall(PathSegment { foo, [Bar, Baz] }, x, [a, b, c, d])`.\n-    /// This `Span` is the span of the function, without the dot and receiver\n-    /// (e.g. `foo(a, b)` in `x.foo(a, b)`\n-    MethodCall(PathSegment, P<Expr>, Vec<P<Expr>>, Span),\n+    /// A method call (e.g. `x.foo::<Bar, Baz>(a, b, c)`).\n+    MethodCall(Box<MethodCall>),\n     /// A tuple (e.g., `(a, b, c, d)`).\n     Tup(Vec<P<Expr>>),\n     /// A binary operation (e.g., `a + b`, `a * b`).\n@@ -1363,9 +1380,7 @@ pub enum ExprKind {\n     /// A `match` block.\n     Match(P<Expr>, Vec<Arm>),\n     /// A closure (e.g., `move |a, b, c| a + b + c`).\n-    ///\n-    /// The final span is the span of the argument block `|...|`.\n-    Closure(ClosureBinder, CaptureBy, Async, Movability, P<FnDecl>, P<Expr>, Span),\n+    Closure(Box<Closure>),\n     /// A block (`'label: { ... }`).\n     Block(P<Block>, Option<Label>),\n     /// An async block (`async move { ... }`).\n@@ -1403,7 +1418,7 @@ pub enum ExprKind {\n     /// parameters (e.g., `foo::bar::<baz>`).\n     ///\n     /// Optionally \"qualified\" (e.g., `<Vec<T> as SomeTrait>::SomeType`).\n-    Path(Option<QSelf>, Path),\n+    Path(Option<P<QSelf>>, Path),\n \n     /// A referencing operation (`&a`, `&mut a`, `&raw const a` or `&raw mut a`).\n     AddrOf(BorrowKind, Mutability, P<Expr>),\n@@ -2006,7 +2021,7 @@ pub enum TyKind {\n     /// \"qualified\", e.g., `<Vec<T> as SomeTrait>::SomeType`.\n     ///\n     /// Type parameters are stored in the `Path` itself.\n-    Path(Option<QSelf>, Path),\n+    Path(Option<P<QSelf>>, Path),\n     /// A trait object type `Bound1 + Bound2 + Bound3`\n     /// where `Bound` is a trait or a lifetime.\n     TraitObject(GenericBounds, TraitObjectSyntax),\n@@ -2138,7 +2153,7 @@ impl InlineAsmTemplatePiece {\n #[derive(Clone, Encodable, Decodable, Debug)]\n pub struct InlineAsmSym {\n     pub id: NodeId,\n-    pub qself: Option<QSelf>,\n+    pub qself: Option<P<QSelf>>,\n     pub path: Path,\n }\n \n@@ -3031,8 +3046,8 @@ mod size_asserts {\n     static_assert_size!(AssocItemKind, 32);\n     static_assert_size!(Attribute, 32);\n     static_assert_size!(Block, 48);\n-    static_assert_size!(Expr, 104);\n-    static_assert_size!(ExprKind, 72);\n+    static_assert_size!(Expr, 88);\n+    static_assert_size!(ExprKind, 56);\n     static_assert_size!(Fn, 184);\n     static_assert_size!(ForeignItem, 96);\n     static_assert_size!(ForeignItemKind, 24);\n@@ -3046,13 +3061,13 @@ mod size_asserts {\n     static_assert_size!(LitKind, 24);\n     static_assert_size!(Local, 72);\n     static_assert_size!(Param, 40);\n-    static_assert_size!(Pat, 120);\n+    static_assert_size!(Pat, 104);\n     static_assert_size!(Path, 40);\n     static_assert_size!(PathSegment, 24);\n-    static_assert_size!(PatKind, 96);\n+    static_assert_size!(PatKind, 80);\n     static_assert_size!(Stmt, 32);\n     static_assert_size!(StmtKind, 16);\n-    static_assert_size!(Ty, 96);\n-    static_assert_size!(TyKind, 72);\n+    static_assert_size!(Ty, 80);\n+    static_assert_size!(TyKind, 56);\n     // tidy-alphabetical-end\n }"}, {"sha": "ece4cb5556b47c78c8b86c28fa7eebf7dbb8722e", "filename": "compiler/rustc_ast/src/mut_visit.rs", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -194,7 +194,7 @@ pub trait MutVisitor: Sized {\n         noop_visit_path(p, self);\n     }\n \n-    fn visit_qself(&mut self, qs: &mut Option<QSelf>) {\n+    fn visit_qself(&mut self, qs: &mut Option<P<QSelf>>) {\n         noop_visit_qself(qs, self);\n     }\n \n@@ -529,8 +529,9 @@ pub fn noop_visit_path<T: MutVisitor>(Path { segments, span, tokens }: &mut Path\n     visit_lazy_tts(tokens, vis);\n }\n \n-pub fn noop_visit_qself<T: MutVisitor>(qself: &mut Option<QSelf>, vis: &mut T) {\n-    visit_opt(qself, |QSelf { ty, path_span, position: _ }| {\n+pub fn noop_visit_qself<T: MutVisitor>(qself: &mut Option<P<QSelf>>, vis: &mut T) {\n+    visit_opt(qself, |qself| {\n+        let QSelf { ty, path_span, position: _ } = &mut **qself;\n         vis.visit_ty(ty);\n         vis.visit_span(path_span);\n     })\n@@ -1303,12 +1304,17 @@ pub fn noop_visit_expr<T: MutVisitor>(\n             vis.visit_expr(f);\n             visit_exprs(args, vis);\n         }\n-        ExprKind::MethodCall(PathSegment { ident, id, args }, receiver, exprs, span) => {\n+        ExprKind::MethodCall(box MethodCall {\n+            seg: PathSegment { ident, id, args: seg_args },\n+            receiver,\n+            args: call_args,\n+            span,\n+        }) => {\n             vis.visit_ident(ident);\n             vis.visit_id(id);\n-            visit_opt(args, |args| vis.visit_generic_args(args));\n+            visit_opt(seg_args, |args| vis.visit_generic_args(args));\n             vis.visit_method_receiver_expr(receiver);\n-            visit_exprs(exprs, vis);\n+            visit_exprs(call_args, vis);\n             vis.visit_span(span);\n         }\n         ExprKind::Binary(_binop, lhs, rhs) => {\n@@ -1353,12 +1359,20 @@ pub fn noop_visit_expr<T: MutVisitor>(\n             vis.visit_expr(expr);\n             arms.flat_map_in_place(|arm| vis.flat_map_arm(arm));\n         }\n-        ExprKind::Closure(binder, _capture_by, asyncness, _movability, decl, body, span) => {\n+        ExprKind::Closure(box Closure {\n+            binder,\n+            capture_clause: _,\n+            asyncness,\n+            movability: _,\n+            fn_decl,\n+            body,\n+            fn_decl_span,\n+        }) => {\n             vis.visit_closure_binder(binder);\n             vis.visit_asyncness(asyncness);\n-            vis.visit_fn_decl(decl);\n+            vis.visit_fn_decl(fn_decl);\n             vis.visit_expr(body);\n-            vis.visit_span(span);\n+            vis.visit_span(fn_decl_span);\n         }\n         ExprKind::Block(blk, label) => {\n             vis.visit_block(blk);"}, {"sha": "fbb4cf43a954ccc08814d63fe49b2ec8d2063a10", "filename": "compiler/rustc_ast/src/util/classify.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Futil%2Fclassify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Futil%2Fclassify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Futil%2Fclassify.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -36,14 +36,16 @@ pub fn expr_trailing_brace(mut expr: &ast::Expr) -> Option<&ast::Expr> {\n             | Binary(_, _, e)\n             | Box(e)\n             | Break(_, Some(e))\n-            | Closure(.., e, _)\n             | Let(_, e, _)\n             | Range(_, Some(e), _)\n             | Ret(Some(e))\n             | Unary(_, e)\n             | Yield(Some(e)) => {\n                 expr = e;\n             }\n+            Closure(closure) => {\n+                expr = &closure.body;\n+            }\n             Async(..) | Block(..) | ForLoop(..) | If(..) | Loop(..) | Match(..) | Struct(..)\n             | TryBlock(..) | While(..) => break Some(expr),\n             _ => break None,"}, {"sha": "30c55dffb180382b476378d48b4d07c80312bec6", "filename": "compiler/rustc_ast/src/util/parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Futil%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Futil%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Futil%2Fparser.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -396,7 +396,7 @@ pub fn contains_exterior_struct_lit(value: &ast::Expr) -> bool {\n             contains_exterior_struct_lit(&x)\n         }\n \n-        ast::ExprKind::MethodCall(_, ref receiver, _, _) => {\n+        ast::ExprKind::MethodCall(box ast::MethodCall { ref receiver, .. }) => {\n             // X { y: 1 }.bar(...)\n             contains_exterior_struct_lit(&receiver)\n         }"}, {"sha": "ad5a2116c424a485da6b3deeed939f6631bdbe6f", "filename": "compiler/rustc_ast/src/visit.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -798,10 +798,10 @@ pub fn walk_expr<'a, V: Visitor<'a>>(visitor: &mut V, expression: &'a Expr) {\n             visitor.visit_expr(callee_expression);\n             walk_list!(visitor, visit_expr, arguments);\n         }\n-        ExprKind::MethodCall(ref segment, ref receiver, ref arguments, _span) => {\n-            visitor.visit_path_segment(segment);\n+        ExprKind::MethodCall(box MethodCall { ref seg, ref receiver, ref args, span: _ }) => {\n+            visitor.visit_path_segment(seg);\n             visitor.visit_expr(receiver);\n-            walk_list!(visitor, visit_expr, arguments);\n+            walk_list!(visitor, visit_expr, args);\n         }\n         ExprKind::Binary(_, ref left_expression, ref right_expression) => {\n             visitor.visit_expr(left_expression);\n@@ -842,8 +842,16 @@ pub fn walk_expr<'a, V: Visitor<'a>>(visitor: &mut V, expression: &'a Expr) {\n             visitor.visit_expr(subexpression);\n             walk_list!(visitor, visit_arm, arms);\n         }\n-        ExprKind::Closure(ref binder, _, _, _, ref decl, ref body, _decl_span) => {\n-            visitor.visit_fn(FnKind::Closure(binder, decl, body), expression.span, expression.id)\n+        ExprKind::Closure(box Closure {\n+            ref binder,\n+            capture_clause: _,\n+            asyncness: _,\n+            movability: _,\n+            ref fn_decl,\n+            ref body,\n+            fn_decl_span: _,\n+        }) => {\n+            visitor.visit_fn(FnKind::Closure(binder, fn_decl, body), expression.span, expression.id)\n         }\n         ExprKind::Block(ref block, ref opt_label) => {\n             walk_list!(visitor, visit_label, opt_label);"}, {"sha": "e4a59ba5381bd032e5a434e72b183cea1a13bd7a", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -61,7 +61,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                         hir::ExprKind::Call(f, self.lower_exprs(args))\n                     }\n                 }\n-                ExprKind::MethodCall(ref seg, ref receiver, ref args, span) => {\n+                ExprKind::MethodCall(box MethodCall { ref seg, ref receiver, ref args, span }) => {\n                     let hir_seg = self.arena.alloc(self.lower_path_segment(\n                         e.span,\n                         seg,\n@@ -172,22 +172,22 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                     };\n                     self.lower_expr_await(dot_await_span, expr)\n                 }\n-                ExprKind::Closure(\n+                ExprKind::Closure(box Closure {\n                     ref binder,\n                     capture_clause,\n                     asyncness,\n                     movability,\n-                    ref decl,\n+                    ref fn_decl,\n                     ref body,\n                     fn_decl_span,\n-                ) => {\n+                }) => {\n                     if let Async::Yes { closure_id, .. } = asyncness {\n                         self.lower_expr_async_closure(\n                             binder,\n                             capture_clause,\n                             e.id,\n                             closure_id,\n-                            decl,\n+                            fn_decl,\n                             body,\n                             fn_decl_span,\n                         )\n@@ -197,7 +197,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                             capture_clause,\n                             e.id,\n                             movability,\n-                            decl,\n+                            fn_decl,\n                             body,\n                             fn_decl_span,\n                         )\n@@ -1077,7 +1077,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     fn extract_tuple_struct_path<'a>(\n         &mut self,\n         expr: &'a Expr,\n-    ) -> Option<(&'a Option<QSelf>, &'a Path)> {\n+    ) -> Option<(&'a Option<AstP<QSelf>>, &'a Path)> {\n         if let ExprKind::Path(qself, path) = &expr.kind {\n             // Does the path resolve to something disallowed in a tuple struct/variant pattern?\n             if let Some(partial_res) = self.resolver.get_partial_res(expr.id) {\n@@ -1097,7 +1097,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n     fn extract_unit_struct_path<'a>(\n         &mut self,\n         expr: &'a Expr,\n-    ) -> Option<(&'a Option<QSelf>, &'a Path)> {\n+    ) -> Option<(&'a Option<AstP<QSelf>>, &'a Path)> {\n         if let ExprKind::Path(qself, path) = &expr.kind {\n             // Does the path resolve to something disallowed in a unit struct/variant pattern?\n             if let Some(partial_res) = self.resolver.get_partial_res(expr.id) {"}, {"sha": "2ce95d0c185a9202ddf30a73d865e7e9ae8c1c8a", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -1207,7 +1207,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     fn lower_path_ty(\n         &mut self,\n         t: &Ty,\n-        qself: &Option<QSelf>,\n+        qself: &Option<ptr::P<QSelf>>,\n         path: &Path,\n         param_mode: ParamMode,\n         itctx: &ImplTraitContext,"}, {"sha": "83d459d899b5cff3e938b14296ce51263e3e18c0", "filename": "compiler/rustc_ast_lowering/src/path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fpath.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -19,7 +19,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     pub(crate) fn lower_qpath(\n         &mut self,\n         id: NodeId,\n-        qself: &Option<QSelf>,\n+        qself: &Option<ptr::P<QSelf>>,\n         p: &Path,\n         param_mode: ParamMode,\n         itctx: &ImplTraitContext,"}, {"sha": "1da40d2302e125b5dcfc0baa1979370f7dad4f52", "filename": "compiler/rustc_ast_pretty/src/pprust/state/expr.rs", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate%2Fexpr.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -121,7 +121,7 @@ impl<'a> State<'a> {\n \n     fn print_expr_struct(\n         &mut self,\n-        qself: &Option<ast::QSelf>,\n+        qself: &Option<P<ast::QSelf>>,\n         path: &ast::Path,\n         fields: &[ast::ExprField],\n         rest: &ast::StructRest,\n@@ -307,8 +307,13 @@ impl<'a> State<'a> {\n             ast::ExprKind::Call(ref func, ref args) => {\n                 self.print_expr_call(func, &args);\n             }\n-            ast::ExprKind::MethodCall(ref segment, ref receiver, ref args, _) => {\n-                self.print_expr_method_call(segment, &receiver, &args);\n+            ast::ExprKind::MethodCall(box ast::MethodCall {\n+                ref seg,\n+                ref receiver,\n+                ref args,\n+                ..\n+            }) => {\n+                self.print_expr_method_call(seg, &receiver, &args);\n             }\n             ast::ExprKind::Binary(op, ref lhs, ref rhs) => {\n                 self.print_expr_binary(op, lhs, rhs);\n@@ -396,21 +401,21 @@ impl<'a> State<'a> {\n                 let empty = attrs.is_empty() && arms.is_empty();\n                 self.bclose(expr.span, empty);\n             }\n-            ast::ExprKind::Closure(\n+            ast::ExprKind::Closure(box ast::Closure {\n                 ref binder,\n                 capture_clause,\n                 asyncness,\n                 movability,\n-                ref decl,\n+                ref fn_decl,\n                 ref body,\n-                _,\n-            ) => {\n+                fn_decl_span: _,\n+            }) => {\n                 self.print_closure_binder(binder);\n                 self.print_movability(movability);\n                 self.print_asyncness(asyncness);\n                 self.print_capture_clause(capture_clause);\n \n-                self.print_fn_params_and_ret(decl, true);\n+                self.print_fn_params_and_ret(fn_decl, true);\n                 self.space();\n                 self.print_expr(body);\n                 self.end(); // need to close a box"}, {"sha": "4b57bdfbc8fb1a689cab2d099d56813027ffaa08", "filename": "compiler/rustc_builtin_macros/src/assert/context.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fassert%2Fcontext.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -3,8 +3,8 @@ use rustc_ast::{\n     ptr::P,\n     token,\n     tokenstream::{DelimSpan, TokenStream, TokenTree},\n-    BinOpKind, BorrowKind, Expr, ExprKind, ItemKind, MacArgs, MacCall, MacDelimiter, Mutability,\n-    Path, PathSegment, Stmt, StructRest, UnOp, UseTree, UseTreeKind, DUMMY_NODE_ID,\n+    BinOpKind, BorrowKind, Expr, ExprKind, ItemKind, MacArgs, MacCall, MacDelimiter, MethodCall,\n+    Mutability, Path, PathSegment, Stmt, StructRest, UnOp, UseTree, UseTreeKind, DUMMY_NODE_ID,\n };\n use rustc_ast_pretty::pprust;\n use rustc_data_structures::fx::FxHashSet;\n@@ -242,9 +242,9 @@ impl<'cx, 'a> Context<'cx, 'a> {\n                 self.manage_cond_expr(prefix);\n                 self.manage_cond_expr(suffix);\n             }\n-            ExprKind::MethodCall(_, _,ref mut local_exprs, _) => {\n-                for local_expr in local_exprs.iter_mut() {\n-                    self.manage_cond_expr(local_expr);\n+            ExprKind::MethodCall(ref mut call) => {\n+                for arg in call.args.iter_mut() {\n+                    self.manage_cond_expr(arg);\n                 }\n             }\n             ExprKind::Path(_, Path { ref segments, .. }) if let &[ref path_segment] = &segments[..] => {\n@@ -296,7 +296,7 @@ impl<'cx, 'a> Context<'cx, 'a> {\n             | ExprKind::Block(_, _)\n             | ExprKind::Box(_)\n             | ExprKind::Break(_, _)\n-            | ExprKind::Closure(_, _, _, _, _, _, _)\n+            | ExprKind::Closure(_)\n             | ExprKind::ConstBlock(_)\n             | ExprKind::Continue(_)\n             | ExprKind::Err\n@@ -442,12 +442,12 @@ fn expr_addr_of_mut(cx: &ExtCtxt<'_>, sp: Span, e: P<Expr>) -> P<Expr> {\n \n fn expr_method_call(\n     cx: &ExtCtxt<'_>,\n-    path: PathSegment,\n+    seg: PathSegment,\n     receiver: P<Expr>,\n     args: Vec<P<Expr>>,\n     span: Span,\n ) -> P<Expr> {\n-    cx.expr(span, ExprKind::MethodCall(path, receiver, args, span))\n+    cx.expr(span, ExprKind::MethodCall(Box::new(MethodCall { seg, receiver, args, span })))\n }\n \n fn expr_paren(cx: &ExtCtxt<'_>, sp: Span, e: P<Expr>) -> P<Expr> {"}, {"sha": "03dbc07e5dc3e0c3968b3623fb53e8b7e80aa7ae", "filename": "compiler/rustc_expand/src/build.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_expand%2Fsrc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_expand%2Fsrc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fbuild.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -532,15 +532,15 @@ impl<'a> ExtCtxt<'a> {\n         // here, but that's not entirely clear.\n         self.expr(\n             span,\n-            ast::ExprKind::Closure(\n-                ast::ClosureBinder::NotPresent,\n-                ast::CaptureBy::Ref,\n-                ast::Async::No,\n-                ast::Movability::Movable,\n+            ast::ExprKind::Closure(Box::new(ast::Closure {\n+                binder: ast::ClosureBinder::NotPresent,\n+                capture_clause: ast::CaptureBy::Ref,\n+                asyncness: ast::Async::No,\n+                movability: ast::Movability::Movable,\n                 fn_decl,\n                 body,\n-                span,\n-            ),\n+                fn_decl_span: span,\n+            })),\n         )\n     }\n "}, {"sha": "fc760ee3b8fa03281a3fd88bf768f894ca81e208", "filename": "compiler/rustc_lint/src/early.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_lint%2Fsrc%2Fearly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_lint%2Fsrc%2Fearly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fearly.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -212,7 +212,10 @@ impl<'a, T: EarlyLintPass> ast_visit::Visitor<'a> for EarlyContextAndPass<'a, T>\n         // Explicitly check for lints associated with 'closure_id', since\n         // it does not have a corresponding AST node\n         match e.kind {\n-            ast::ExprKind::Closure(_, _, ast::Async::Yes { closure_id, .. }, ..)\n+            ast::ExprKind::Closure(box ast::Closure {\n+                asyncness: ast::Async::Yes { closure_id, .. },\n+                ..\n+            })\n             | ast::ExprKind::Async(_, closure_id, ..) => self.check_id(closure_id),\n             _ => {}\n         }"}, {"sha": "34b41f55aec34caab6698f559fe16d3e7629f079", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -653,7 +653,7 @@ trait UnusedDelimLint {\n             ref call_or_other => {\n                 let (args_to_check, ctx) = match *call_or_other {\n                     Call(_, ref args) => (&args[..], UnusedDelimsCtx::FunctionArg),\n-                    MethodCall(_, _, ref args, _) => (&args[..], UnusedDelimsCtx::MethodArg),\n+                    MethodCall(ref call) => (&call.args[..], UnusedDelimsCtx::MethodArg),\n                     // actual catch-all arm\n                     _ => {\n                         return;"}, {"sha": "3352e0a6c69d63e1bc0d4ea13e44295e718d3688", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -65,15 +65,15 @@ pub(super) fn dummy_arg(ident: Ident) -> Param {\n pub(super) trait RecoverQPath: Sized + 'static {\n     const PATH_STYLE: PathStyle = PathStyle::Expr;\n     fn to_ty(&self) -> Option<P<Ty>>;\n-    fn recovered(qself: Option<QSelf>, path: ast::Path) -> Self;\n+    fn recovered(qself: Option<P<QSelf>>, path: ast::Path) -> Self;\n }\n \n impl RecoverQPath for Ty {\n     const PATH_STYLE: PathStyle = PathStyle::Type;\n     fn to_ty(&self) -> Option<P<Ty>> {\n         Some(P(self.clone()))\n     }\n-    fn recovered(qself: Option<QSelf>, path: ast::Path) -> Self {\n+    fn recovered(qself: Option<P<QSelf>>, path: ast::Path) -> Self {\n         Self {\n             span: path.span,\n             kind: TyKind::Path(qself, path),\n@@ -87,7 +87,7 @@ impl RecoverQPath for Pat {\n     fn to_ty(&self) -> Option<P<Ty>> {\n         self.to_ty()\n     }\n-    fn recovered(qself: Option<QSelf>, path: ast::Path) -> Self {\n+    fn recovered(qself: Option<P<QSelf>>, path: ast::Path) -> Self {\n         Self {\n             span: path.span,\n             kind: PatKind::Path(qself, path),\n@@ -101,7 +101,7 @@ impl RecoverQPath for Expr {\n     fn to_ty(&self) -> Option<P<Ty>> {\n         self.to_ty()\n     }\n-    fn recovered(qself: Option<QSelf>, path: ast::Path) -> Self {\n+    fn recovered(qself: Option<P<QSelf>>, path: ast::Path) -> Self {\n         Self {\n             span: path.span,\n             kind: ExprKind::Path(qself, path),\n@@ -1437,7 +1437,7 @@ impl<'a> Parser<'a> {\n         });\n \n         let path_span = ty_span.shrink_to_hi(); // Use an empty path since `position == 0`.\n-        Ok(P(T::recovered(Some(QSelf { ty, path_span, position: 0 }), path)))\n+        Ok(P(T::recovered(Some(P(QSelf { ty, path_span, position: 0 })), path)))\n     }\n \n     pub fn maybe_consume_incorrect_semicolon(&mut self, items: &[P<Item>]) -> bool {"}, {"sha": "413c58f1bffd5a5bf0f1c951e2f6dcc215c489d2", "filename": "compiler/rustc_parse/src/parser/expr.rs", "status": "modified", "additions": 25, "deletions": 17, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fexpr.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -840,7 +840,7 @@ impl<'a> Parser<'a> {\n                     ExprKind::Index(_, _) => \"indexing\",\n                     ExprKind::Try(_) => \"`?`\",\n                     ExprKind::Field(_, _) => \"a field access\",\n-                    ExprKind::MethodCall(_, _, _, _) => \"a method call\",\n+                    ExprKind::MethodCall(_) => \"a method call\",\n                     ExprKind::Call(_, _) => \"a function call\",\n                     ExprKind::Await(_) => \"`.await`\",\n                     ExprKind::Err => return Ok(with_postfix),\n@@ -1262,24 +1262,32 @@ impl<'a> Parser<'a> {\n         }\n \n         let fn_span_lo = self.token.span;\n-        let mut segment = self.parse_path_segment(PathStyle::Expr, None)?;\n-        self.check_trailing_angle_brackets(&segment, &[&token::OpenDelim(Delimiter::Parenthesis)]);\n-        self.check_turbofish_missing_angle_brackets(&mut segment);\n+        let mut seg = self.parse_path_segment(PathStyle::Expr, None)?;\n+        self.check_trailing_angle_brackets(&seg, &[&token::OpenDelim(Delimiter::Parenthesis)]);\n+        self.check_turbofish_missing_angle_brackets(&mut seg);\n \n         if self.check(&token::OpenDelim(Delimiter::Parenthesis)) {\n             // Method call `expr.f()`\n             let args = self.parse_paren_expr_seq()?;\n             let fn_span = fn_span_lo.to(self.prev_token.span);\n             let span = lo.to(self.prev_token.span);\n-            Ok(self.mk_expr(span, ExprKind::MethodCall(segment, self_arg, args, fn_span)))\n+            Ok(self.mk_expr(\n+                span,\n+                ExprKind::MethodCall(Box::new(ast::MethodCall {\n+                    seg,\n+                    receiver: self_arg,\n+                    args,\n+                    span: fn_span,\n+                })),\n+            ))\n         } else {\n             // Field access `expr.f`\n-            if let Some(args) = segment.args {\n+            if let Some(args) = seg.args {\n                 self.sess.emit_err(FieldExpressionWithGeneric(args.span()));\n             }\n \n             let span = lo.to(self.prev_token.span);\n-            Ok(self.mk_expr(span, ExprKind::Field(self_arg, segment.ident)))\n+            Ok(self.mk_expr(span, ExprKind::Field(self_arg, seg.ident)))\n         }\n     }\n \n@@ -1498,7 +1506,7 @@ impl<'a> Parser<'a> {\n             });\n             (lo.to(self.prev_token.span), ExprKind::MacCall(mac))\n         } else if self.check(&token::OpenDelim(Delimiter::Brace)) &&\n-            let Some(expr) = self.maybe_parse_struct_expr(qself.as_ref(), &path) {\n+            let Some(expr) = self.maybe_parse_struct_expr(&qself, &path) {\n                 if qself.is_some() {\n                     self.sess.gated_spans.gate(sym::more_qualified_paths, path.span);\n                 }\n@@ -2049,9 +2057,9 @@ impl<'a> Parser<'a> {\n         };\n \n         let capture_clause = self.parse_capture_clause()?;\n-        let decl = self.parse_fn_block_decl()?;\n+        let fn_decl = self.parse_fn_block_decl()?;\n         let decl_hi = self.prev_token.span;\n-        let mut body = match decl.output {\n+        let mut body = match fn_decl.output {\n             FnRetTy::Default(_) => {\n                 let restrictions = self.restrictions - Restrictions::STMT_EXPR;\n                 self.parse_expr_res(restrictions, None)?\n@@ -2087,15 +2095,15 @@ impl<'a> Parser<'a> {\n \n         let closure = self.mk_expr(\n             lo.to(body.span),\n-            ExprKind::Closure(\n+            ExprKind::Closure(Box::new(ast::Closure {\n                 binder,\n                 capture_clause,\n                 asyncness,\n                 movability,\n-                decl,\n+                fn_decl,\n                 body,\n-                lo.to(decl_hi),\n-            ),\n+                fn_decl_span: lo.to(decl_hi),\n+            })),\n         );\n \n         // Disable recovery for closure body\n@@ -2800,15 +2808,15 @@ impl<'a> Parser<'a> {\n \n     fn maybe_parse_struct_expr(\n         &mut self,\n-        qself: Option<&ast::QSelf>,\n+        qself: &Option<P<ast::QSelf>>,\n         path: &ast::Path,\n     ) -> Option<PResult<'a, P<Expr>>> {\n         let struct_allowed = !self.restrictions.contains(Restrictions::NO_STRUCT_LITERAL);\n         if struct_allowed || self.is_certainly_not_a_block() {\n             if let Err(err) = self.expect(&token::OpenDelim(Delimiter::Brace)) {\n                 return Some(Err(err));\n             }\n-            let expr = self.parse_struct_expr(qself.cloned(), path.clone(), true);\n+            let expr = self.parse_struct_expr(qself.clone(), path.clone(), true);\n             if let (Ok(expr), false) = (&expr, struct_allowed) {\n                 // This is a struct literal, but we don't can't accept them here.\n                 self.sess.emit_err(StructLiteralNotAllowedHere {\n@@ -2939,7 +2947,7 @@ impl<'a> Parser<'a> {\n     /// Precondition: already parsed the '{'.\n     pub(super) fn parse_struct_expr(\n         &mut self,\n-        qself: Option<ast::QSelf>,\n+        qself: Option<P<ast::QSelf>>,\n         pth: ast::Path,\n         recover: bool,\n     ) -> PResult<'a, P<Expr>> {"}, {"sha": "0e202645a39b85a5e82a296345e7a23ea785d0fb", "filename": "compiler/rustc_parse/src/parser/pat.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -889,7 +889,7 @@ impl<'a> Parser<'a> {\n     }\n \n     /// Parse a struct (\"record\") pattern (e.g. `Foo { ... }` or `Foo::Bar { ... }`).\n-    fn parse_pat_struct(&mut self, qself: Option<QSelf>, path: Path) -> PResult<'a, PatKind> {\n+    fn parse_pat_struct(&mut self, qself: Option<P<QSelf>>, path: Path) -> PResult<'a, PatKind> {\n         if qself.is_some() {\n             // Feature gate the use of qualified paths in patterns\n             self.sess.gated_spans.gate(sym::more_qualified_paths, path.span);\n@@ -906,7 +906,11 @@ impl<'a> Parser<'a> {\n     }\n \n     /// Parse tuple struct or tuple variant pattern (e.g. `Foo(...)` or `Foo::Bar(...)`).\n-    fn parse_pat_tuple_struct(&mut self, qself: Option<QSelf>, path: Path) -> PResult<'a, PatKind> {\n+    fn parse_pat_tuple_struct(\n+        &mut self,\n+        qself: Option<P<QSelf>>,\n+        path: Path,\n+    ) -> PResult<'a, PatKind> {\n         let (fields, _) = self.parse_paren_comma_seq(|p| {\n             p.parse_pat_allow_top_alt(\n                 None,"}, {"sha": "c2d4d218a5b79db97fa308f56c5af8983ee9381e", "filename": "compiler/rustc_parse/src/parser/path.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpath.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -48,7 +48,7 @@ impl<'a> Parser<'a> {\n     /// `<T as U>::a`\n     /// `<T as U>::F::a<S>` (without disambiguator)\n     /// `<T as U>::F::a::<S>` (with disambiguator)\n-    pub(super) fn parse_qpath(&mut self, style: PathStyle) -> PResult<'a, (QSelf, Path)> {\n+    pub(super) fn parse_qpath(&mut self, style: PathStyle) -> PResult<'a, (P<QSelf>, Path)> {\n         let lo = self.prev_token.span;\n         let ty = self.parse_ty()?;\n \n@@ -77,7 +77,7 @@ impl<'a> Parser<'a> {\n             self.expect(&token::ModSep)?;\n         }\n \n-        let qself = QSelf { ty, path_span, position: path.segments.len() };\n+        let qself = P(QSelf { ty, path_span, position: path.segments.len() });\n         self.parse_path_segments(&mut path.segments, style, None)?;\n \n         Ok(("}, {"sha": "b1cee06849dd98f753c1904498bf73bd9190f64a", "filename": "compiler/rustc_resolve/src/def_collector.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdef_collector.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -262,11 +262,11 @@ impl<'a, 'b> visit::Visitor<'a> for DefCollector<'a, 'b> {\n     fn visit_expr(&mut self, expr: &'a Expr) {\n         let parent_def = match expr.kind {\n             ExprKind::MacCall(..) => return self.visit_macro_invoc(expr.id),\n-            ExprKind::Closure(_, _, asyncness, ..) => {\n+            ExprKind::Closure(ref closure) => {\n                 // Async closures desugar to closures inside of closures, so\n                 // we must create two defs.\n                 let closure_def = self.create_def(expr.id, DefPathData::ClosureExpr, expr.span);\n-                match asyncness {\n+                match closure.asyncness {\n                     Async::Yes { closure_id, .. } => {\n                         self.create_def(closure_id, DefPathData::ClosureExpr, expr.span)\n                     }"}, {"sha": "1b0879cf79ef7c376e8873bd1e001aa164ef28b8", "filename": "compiler/rustc_resolve/src/late.rs", "status": "modified", "additions": 31, "deletions": 28, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -648,7 +648,7 @@ impl<'a: 'ast, 'ast> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast> {\n             }\n             TyKind::Path(ref qself, ref path) => {\n                 self.diagnostic_metadata.current_type_path = Some(ty);\n-                self.smart_resolve_path(ty.id, qself.as_ref(), path, PathSource::Type);\n+                self.smart_resolve_path(ty.id, &qself, path, PathSource::Type);\n \n                 // Check whether we should interpret this as a bare trait object.\n                 if qself.is_none()\n@@ -749,7 +749,7 @@ impl<'a: 'ast, 'ast> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast> {\n                 this.visit_generic_params(&tref.bound_generic_params, false);\n                 this.smart_resolve_path(\n                     tref.trait_ref.ref_id,\n-                    None,\n+                    &None,\n                     &tref.trait_ref.path,\n                     PathSource::Trait(AliasPossibility::Maybe),\n                 );\n@@ -978,7 +978,7 @@ impl<'a: 'ast, 'ast> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast> {\n                                 |this| {\n                                     this.smart_resolve_path(\n                                         ty.id,\n-                                        qself.as_ref(),\n+                                        qself,\n                                         path,\n                                         PathSource::Expr(None),\n                                     );\n@@ -1138,12 +1138,7 @@ impl<'a: 'ast, 'ast> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast> {\n         self.with_rib(ValueNS, InlineAsmSymRibKind, |this| {\n             this.with_rib(TypeNS, InlineAsmSymRibKind, |this| {\n                 this.with_label_rib(InlineAsmSymRibKind, |this| {\n-                    this.smart_resolve_path(\n-                        sym.id,\n-                        sym.qself.as_ref(),\n-                        &sym.path,\n-                        PathSource::Expr(None),\n-                    );\n+                    this.smart_resolve_path(sym.id, &sym.qself, &sym.path, PathSource::Expr(None));\n                     visit::walk_inline_asm_sym(this, sym);\n                 });\n             })\n@@ -2571,7 +2566,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n             self.diagnostic_metadata.currently_processing_impl_trait =\n                 Some((trait_ref.clone(), self_type.clone()));\n             let res = self.smart_resolve_path_fragment(\n-                None,\n+                &None,\n                 &path,\n                 PathSource::Trait(AliasPossibility::No),\n                 Finalize::new(trait_ref.ref_id, trait_ref.path.span),\n@@ -3094,7 +3089,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                 PatKind::TupleStruct(ref qself, ref path, ref sub_patterns) => {\n                     self.smart_resolve_path(\n                         pat.id,\n-                        qself.as_ref(),\n+                        qself,\n                         path,\n                         PathSource::TupleStruct(\n                             pat.span,\n@@ -3103,10 +3098,10 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                     );\n                 }\n                 PatKind::Path(ref qself, ref path) => {\n-                    self.smart_resolve_path(pat.id, qself.as_ref(), path, PathSource::Pat);\n+                    self.smart_resolve_path(pat.id, qself, path, PathSource::Pat);\n                 }\n                 PatKind::Struct(ref qself, ref path, ..) => {\n-                    self.smart_resolve_path(pat.id, qself.as_ref(), path, PathSource::Struct);\n+                    self.smart_resolve_path(pat.id, qself, path, PathSource::Struct);\n                 }\n                 PatKind::Or(ref ps) => {\n                     // Add a new set of bindings to the stack. `Or` here records that when a\n@@ -3299,7 +3294,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n     fn smart_resolve_path(\n         &mut self,\n         id: NodeId,\n-        qself: Option<&QSelf>,\n+        qself: &Option<P<QSelf>>,\n         path: &Path,\n         source: PathSource<'ast>,\n     ) {\n@@ -3313,7 +3308,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n \n     fn smart_resolve_path_fragment(\n         &mut self,\n-        qself: Option<&QSelf>,\n+        qself: &Option<P<QSelf>>,\n         path: &[Segment],\n         source: PathSource<'ast>,\n         finalize: Finalize,\n@@ -3534,7 +3529,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n     // Resolve in alternative namespaces if resolution in the primary namespace fails.\n     fn resolve_qpath_anywhere(\n         &mut self,\n-        qself: Option<&QSelf>,\n+        qself: &Option<P<QSelf>>,\n         path: &[Segment],\n         primary_ns: Namespace,\n         span: Span,\n@@ -3578,7 +3573,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n     /// Handles paths that may refer to associated items.\n     fn resolve_qpath(\n         &mut self,\n-        qself: Option<&QSelf>,\n+        qself: &Option<P<QSelf>>,\n         path: &[Segment],\n         ns: Namespace,\n         finalize: Finalize,\n@@ -3608,7 +3603,7 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n             // but with `qself` set to `None`.\n             let ns = if qself.position + 1 == path.len() { ns } else { TypeNS };\n             let partial_res = self.smart_resolve_path_fragment(\n-                None,\n+                &None,\n                 &path[..=qself.position],\n                 PathSource::TraitItem(ns),\n                 Finalize::with_root_span(finalize.node_id, finalize.path_span, qself.path_span),\n@@ -3791,12 +3786,12 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n         // Next, resolve the node.\n         match expr.kind {\n             ExprKind::Path(ref qself, ref path) => {\n-                self.smart_resolve_path(expr.id, qself.as_ref(), path, PathSource::Expr(parent));\n+                self.smart_resolve_path(expr.id, qself, path, PathSource::Expr(parent));\n                 visit::walk_expr(self, expr);\n             }\n \n             ExprKind::Struct(ref se) => {\n-                self.smart_resolve_path(expr.id, se.qself.as_ref(), &se.path, PathSource::Struct);\n+                self.smart_resolve_path(expr.id, &se.qself, &se.path, PathSource::Struct);\n                 visit::walk_expr(self, expr);\n             }\n \n@@ -3866,12 +3861,12 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n             ExprKind::Field(ref subexpression, _) => {\n                 self.resolve_expr(subexpression, Some(expr));\n             }\n-            ExprKind::MethodCall(ref segment, ref receiver, ref arguments, _) => {\n+            ExprKind::MethodCall(box MethodCall { ref seg, ref receiver, ref args, .. }) => {\n                 self.resolve_expr(receiver, Some(expr));\n-                for argument in arguments {\n-                    self.resolve_expr(argument, None);\n+                for arg in args {\n+                    self.resolve_expr(arg, None);\n                 }\n-                self.visit_path_segment(segment);\n+                self.visit_path_segment(seg);\n             }\n \n             ExprKind::Call(ref callee, ref arguments) => {\n@@ -3913,7 +3908,12 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n             // `async |x| ...` gets desugared to `|x| future_from_generator(|| ...)`, so we need to\n             // resolve the arguments within the proper scopes so that usages of them inside the\n             // closure are detected as upvars rather than normal closure arg usages.\n-            ExprKind::Closure(_, _, Async::Yes { .. }, _, ref fn_decl, ref body, _span) => {\n+            ExprKind::Closure(box ast::Closure {\n+                asyncness: Async::Yes { .. },\n+                ref fn_decl,\n+                ref body,\n+                ..\n+            }) => {\n                 self.with_rib(ValueNS, NormalRibKind, |this| {\n                     this.with_label_rib(ClosureOrAsyncRibKind, |this| {\n                         // Resolve arguments:\n@@ -3933,7 +3933,10 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                 });\n             }\n             // For closures, ClosureOrAsyncRibKind is added in visit_fn\n-            ExprKind::Closure(ClosureBinder::For { ref generic_params, span }, ..) => {\n+            ExprKind::Closure(box ast::Closure {\n+                binder: ClosureBinder::For { ref generic_params, span },\n+                ..\n+            }) => {\n                 self.with_generic_param_rib(\n                     &generic_params,\n                     NormalRibKind,\n@@ -3990,9 +3993,9 @@ impl<'a: 'ast, 'b, 'ast> LateResolutionVisitor<'a, 'b, 'ast> {\n                 let traits = self.traits_in_scope(ident, ValueNS);\n                 self.r.trait_map.insert(expr.id, traits);\n             }\n-            ExprKind::MethodCall(ref segment, ..) => {\n+            ExprKind::MethodCall(ref call) => {\n                 debug!(\"(recording candidate traits for expr) recording traits for {}\", expr.id);\n-                let traits = self.traits_in_scope(segment.ident, ValueNS);\n+                let traits = self.traits_in_scope(call.seg.ident, ValueNS);\n                 self.r.trait_map.insert(expr.id, traits);\n             }\n             _ => {"}, {"sha": "06b60fc8602ccc49232c29fba231e00214ad7fe9", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -8,7 +8,7 @@ use crate::{PathResult, PathSource, Segment};\n use rustc_ast::visit::{FnCtxt, FnKind, LifetimeCtxt};\n use rustc_ast::{\n     self as ast, AssocItemKind, Expr, ExprKind, GenericParam, GenericParamKind, Item, ItemKind,\n-    NodeId, Path, Ty, TyKind, DUMMY_NODE_ID,\n+    MethodCall, NodeId, Path, Ty, TyKind, DUMMY_NODE_ID,\n };\n use rustc_ast_pretty::pprust::path_segment_to_string;\n use rustc_data_structures::fx::FxHashSet;\n@@ -1022,11 +1022,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             };\n \n         // Confirm that the target is an associated type.\n-        let (ty, position, path) = if let ast::TyKind::Path(\n-            Some(ast::QSelf { ty, position, .. }),\n-            path,\n-        ) = &bounded_ty.kind\n-        {\n+        let (ty, position, path) = if let ast::TyKind::Path(Some(qself), path) = &bounded_ty.kind {\n             // use this to verify that ident is a type param.\n             let Some(partial_res) = self.r.partial_res_map.get(&bounded_ty.id) else {\n                 return false;\n@@ -1037,7 +1033,7 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             ) {\n                 return false;\n             }\n-            (ty, position, path)\n+            (&qself.ty, qself.position, path)\n         } else {\n             return false;\n         };\n@@ -1073,12 +1069,12 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n                                     .source_map()\n                                     .span_to_snippet(ty.span) // Account for `<&'a T as Foo>::Bar`.\n                                     .unwrap_or_else(|_| constrain_ident.to_string()),\n-                                path.segments[..*position]\n+                                path.segments[..position]\n                                     .iter()\n                                     .map(|segment| path_segment_to_string(segment))\n                                     .collect::<Vec<_>>()\n                                     .join(\"::\"),\n-                                path.segments[*position..]\n+                                path.segments[position..]\n                                     .iter()\n                                     .map(|segment| path_segment_to_string(segment))\n                                     .collect::<Vec<_>>()\n@@ -1170,7 +1166,9 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n \n             let (lhs_span, rhs_span) = match &expr.kind {\n                 ExprKind::Field(base, ident) => (base.span, ident.span),\n-                ExprKind::MethodCall(_, receiver, _, span) => (receiver.span, *span),\n+                ExprKind::MethodCall(box MethodCall { receiver, span, .. }) => {\n+                    (receiver.span, *span)\n+                }\n                 _ => return false,\n             };\n "}, {"sha": "c68ae63ddb316057c0bf885b42b938eab24e47ca", "filename": "src/test/ui-fulldeps/pprust-expr-roundtrip.rs", "status": "modified", "additions": 17, "deletions": 13, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftest%2Fui-fulldeps%2Fpprust-expr-roundtrip.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftest%2Fui-fulldeps%2Fpprust-expr-roundtrip.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Fpprust-expr-roundtrip.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -73,11 +73,15 @@ fn iter_exprs(depth: usize, f: &mut dyn FnMut(P<Expr>)) {\n             2 => {\n                 let seg = PathSegment::from_ident(Ident::from_str(\"x\"));\n                 iter_exprs(depth - 1, &mut |e| {\n-                    g(ExprKind::MethodCall(seg.clone(), e, vec![make_x()], DUMMY_SP))\n-                });\n+                    g(ExprKind::MethodCall(Box::new(MethodCall {\n+                        seg: seg.clone(), receiver: e, args: vec![make_x()], span: DUMMY_SP\n+                    }))\n+                )});\n                 iter_exprs(depth - 1, &mut |e| {\n-                    g(ExprKind::MethodCall(seg.clone(), make_x(), vec![e], DUMMY_SP))\n-                });\n+                    g(ExprKind::MethodCall(Box::new(MethodCall {\n+                        seg: seg.clone(), receiver: make_x(), args: vec![e], span: DUMMY_SP\n+                    }))\n+                )});\n             }\n             3..=8 => {\n                 let op = Spanned {\n@@ -112,15 +116,15 @@ fn iter_exprs(depth: usize, f: &mut dyn FnMut(P<Expr>)) {\n             11 => {\n                 let decl = P(FnDecl { inputs: vec![], output: FnRetTy::Default(DUMMY_SP) });\n                 iter_exprs(depth - 1, &mut |e| {\n-                    g(ExprKind::Closure(\n-                        ClosureBinder::NotPresent,\n-                        CaptureBy::Value,\n-                        Async::No,\n-                        Movability::Movable,\n-                        decl.clone(),\n-                        e,\n-                        DUMMY_SP,\n-                    ))\n+                    g(ExprKind::Closure(Box::new(Closure {\n+                        binder: ClosureBinder::NotPresent,\n+                        capture_clause: CaptureBy::Value,\n+                        asyncness: Async::No,\n+                        movability: Movability::Movable,\n+                        fn_decl: decl.clone(),\n+                        body: e,\n+                        fn_decl_span: DUMMY_SP,\n+                    })))\n                 });\n             }\n             12 => {"}, {"sha": "c61e8254385a04eb84d8fd64cd5e2b883e4adb3c", "filename": "src/test/ui/stats/hir-stats.stderr", "status": "modified", "additions": 89, "deletions": 89, "changes": 178, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -11,109 +11,109 @@ ast-stats-1 - AngleBracketed            64 ( 0.8%)             1\n ast-stats-1 Local                     72 ( 0.9%)             1            72\n ast-stats-1 WherePredicate            72 ( 0.9%)             1            72\n ast-stats-1 - BoundPredicate            72 ( 0.9%)             1\n-ast-stats-1 Arm                       96 ( 1.1%)             2            48\n-ast-stats-1 ForeignItem               96 ( 1.1%)             1            96\n-ast-stats-1 - Fn                        96 ( 1.1%)             1\n-ast-stats-1 FieldDef                 160 ( 1.9%)             2            80\n-ast-stats-1 Stmt                     160 ( 1.9%)             5            32\n+ast-stats-1 Arm                       96 ( 1.2%)             2            48\n+ast-stats-1 ForeignItem               96 ( 1.2%)             1            96\n+ast-stats-1 - Fn                        96 ( 1.2%)             1\n+ast-stats-1 FieldDef                 160 ( 2.0%)             2            80\n+ast-stats-1 Stmt                     160 ( 2.0%)             5            32\n ast-stats-1 - Local                     32 ( 0.4%)             1\n ast-stats-1 - MacCall                   32 ( 0.4%)             1\n-ast-stats-1 - Expr                      96 ( 1.1%)             3\n-ast-stats-1 Param                    160 ( 1.9%)             4            40\n-ast-stats-1 FnDecl                   200 ( 2.4%)             5            40\n-ast-stats-1 Variant                  240 ( 2.9%)             2           120\n-ast-stats-1 Block                    288 ( 3.4%)             6            48\n-ast-stats-1 GenericBound             352 ( 4.2%)             4            88\n-ast-stats-1 - Trait                    352 ( 4.2%)             4\n-ast-stats-1 AssocItem                416 ( 4.9%)             4           104\n-ast-stats-1 - Type                     208 ( 2.5%)             2\n-ast-stats-1 - Fn                       208 ( 2.5%)             2\n-ast-stats-1 GenericParam             480 ( 5.7%)             5            96\n-ast-stats-1 PathSegment              720 ( 8.6%)            30            24\n-ast-stats-1 Expr                     832 ( 9.9%)             8           104\n-ast-stats-1 - Path                     104 ( 1.2%)             1\n-ast-stats-1 - Match                    104 ( 1.2%)             1\n-ast-stats-1 - Struct                   104 ( 1.2%)             1\n-ast-stats-1 - Lit                      208 ( 2.5%)             2\n-ast-stats-1 - Block                    312 ( 3.7%)             3\n-ast-stats-1 Pat                      840 (10.0%)             7           120\n-ast-stats-1 - Struct                   120 ( 1.4%)             1\n-ast-stats-1 - Wild                     120 ( 1.4%)             1\n-ast-stats-1 - Ident                    600 ( 7.1%)             5\n-ast-stats-1 Ty                     1_344 (16.0%)            14            96\n-ast-stats-1 - Rptr                      96 ( 1.1%)             1\n-ast-stats-1 - Ptr                       96 ( 1.1%)             1\n-ast-stats-1 - ImplicitSelf             192 ( 2.3%)             2\n-ast-stats-1 - Path                     960 (11.4%)            10\n-ast-stats-1 Item                   1_656 (19.7%)             9           184\n-ast-stats-1 - Trait                    184 ( 2.2%)             1\n-ast-stats-1 - Enum                     184 ( 2.2%)             1\n-ast-stats-1 - ForeignMod               184 ( 2.2%)             1\n-ast-stats-1 - Impl                     184 ( 2.2%)             1\n-ast-stats-1 - Fn                       368 ( 4.4%)             2\n-ast-stats-1 - Use                      552 ( 6.6%)             3\n+ast-stats-1 - Expr                      96 ( 1.2%)             3\n+ast-stats-1 Param                    160 ( 2.0%)             4            40\n+ast-stats-1 FnDecl                   200 ( 2.5%)             5            40\n+ast-stats-1 Variant                  240 ( 3.0%)             2           120\n+ast-stats-1 Block                    288 ( 3.6%)             6            48\n+ast-stats-1 GenericBound             352 ( 4.4%)             4            88\n+ast-stats-1 - Trait                    352 ( 4.4%)             4\n+ast-stats-1 AssocItem                416 ( 5.2%)             4           104\n+ast-stats-1 - Type                     208 ( 2.6%)             2\n+ast-stats-1 - Fn                       208 ( 2.6%)             2\n+ast-stats-1 GenericParam             480 ( 6.0%)             5            96\n+ast-stats-1 Expr                     704 ( 8.9%)             8            88\n+ast-stats-1 - Path                      88 ( 1.1%)             1\n+ast-stats-1 - Match                     88 ( 1.1%)             1\n+ast-stats-1 - Struct                    88 ( 1.1%)             1\n+ast-stats-1 - Lit                      176 ( 2.2%)             2\n+ast-stats-1 - Block                    264 ( 3.3%)             3\n+ast-stats-1 PathSegment              720 ( 9.1%)            30            24\n+ast-stats-1 Pat                      728 ( 9.2%)             7           104\n+ast-stats-1 - Struct                   104 ( 1.3%)             1\n+ast-stats-1 - Wild                     104 ( 1.3%)             1\n+ast-stats-1 - Ident                    520 ( 6.5%)             5\n+ast-stats-1 Ty                     1_120 (14.1%)            14            80\n+ast-stats-1 - Rptr                      80 ( 1.0%)             1\n+ast-stats-1 - Ptr                       80 ( 1.0%)             1\n+ast-stats-1 - ImplicitSelf             160 ( 2.0%)             2\n+ast-stats-1 - Path                     800 (10.1%)            10\n+ast-stats-1 Item                   1_656 (20.8%)             9           184\n+ast-stats-1 - Trait                    184 ( 2.3%)             1\n+ast-stats-1 - Enum                     184 ( 2.3%)             1\n+ast-stats-1 - ForeignMod               184 ( 2.3%)             1\n+ast-stats-1 - Impl                     184 ( 2.3%)             1\n+ast-stats-1 - Fn                       368 ( 4.6%)             2\n+ast-stats-1 - Use                      552 ( 6.9%)             3\n ast-stats-1 ----------------------------------------------------------------\n-ast-stats-1 Total                  8_416\n+ast-stats-1 Total                  7_952\n ast-stats-1\n ast-stats-2 POST EXPANSION AST STATS\n ast-stats-2 Name                Accumulated Size         Count     Item Size\n ast-stats-2 ----------------------------------------------------------------\n-ast-stats-2 ExprField                 48 ( 0.5%)             1            48\n+ast-stats-2 ExprField                 48 ( 0.6%)             1            48\n ast-stats-2 Crate                     56 ( 0.6%)             1            56\n ast-stats-2 GenericArgs               64 ( 0.7%)             1            64\n ast-stats-2 - AngleBracketed            64 ( 0.7%)             1\n ast-stats-2 Local                     72 ( 0.8%)             1            72\n ast-stats-2 WherePredicate            72 ( 0.8%)             1            72\n ast-stats-2 - BoundPredicate            72 ( 0.8%)             1\n-ast-stats-2 Arm                       96 ( 1.0%)             2            48\n-ast-stats-2 ForeignItem               96 ( 1.0%)             1            96\n-ast-stats-2 - Fn                        96 ( 1.0%)             1\n-ast-stats-2 InlineAsm                120 ( 1.3%)             1           120\n-ast-stats-2 Attribute                128 ( 1.4%)             4            32\n-ast-stats-2 - DocComment                32 ( 0.3%)             1\n-ast-stats-2 - Normal                    96 ( 1.0%)             3\n-ast-stats-2 FieldDef                 160 ( 1.7%)             2            80\n-ast-stats-2 Stmt                     160 ( 1.7%)             5            32\n-ast-stats-2 - Local                     32 ( 0.3%)             1\n-ast-stats-2 - Semi                      32 ( 0.3%)             1\n-ast-stats-2 - Expr                      96 ( 1.0%)             3\n-ast-stats-2 Param                    160 ( 1.7%)             4            40\n-ast-stats-2 FnDecl                   200 ( 2.2%)             5            40\n-ast-stats-2 Variant                  240 ( 2.6%)             2           120\n-ast-stats-2 Block                    288 ( 3.1%)             6            48\n-ast-stats-2 GenericBound             352 ( 3.8%)             4            88\n-ast-stats-2 - Trait                    352 ( 3.8%)             4\n-ast-stats-2 AssocItem                416 ( 4.5%)             4           104\n-ast-stats-2 - Type                     208 ( 2.3%)             2\n-ast-stats-2 - Fn                       208 ( 2.3%)             2\n-ast-stats-2 GenericParam             480 ( 5.2%)             5            96\n-ast-stats-2 PathSegment              792 ( 8.7%)            33            24\n-ast-stats-2 Pat                      840 ( 9.2%)             7           120\n-ast-stats-2 - Struct                   120 ( 1.3%)             1\n-ast-stats-2 - Wild                     120 ( 1.3%)             1\n-ast-stats-2 - Ident                    600 ( 6.6%)             5\n-ast-stats-2 Expr                     936 (10.2%)             9           104\n-ast-stats-2 - Path                     104 ( 1.1%)             1\n-ast-stats-2 - Match                    104 ( 1.1%)             1\n-ast-stats-2 - Struct                   104 ( 1.1%)             1\n-ast-stats-2 - InlineAsm                104 ( 1.1%)             1\n-ast-stats-2 - Lit                      208 ( 2.3%)             2\n-ast-stats-2 - Block                    312 ( 3.4%)             3\n-ast-stats-2 Ty                     1_344 (14.7%)            14            96\n-ast-stats-2 - Rptr                      96 ( 1.0%)             1\n-ast-stats-2 - Ptr                       96 ( 1.0%)             1\n-ast-stats-2 - ImplicitSelf             192 ( 2.1%)             2\n-ast-stats-2 - Path                     960 (10.5%)            10\n-ast-stats-2 Item                   2_024 (22.1%)            11           184\n-ast-stats-2 - Trait                    184 ( 2.0%)             1\n-ast-stats-2 - Enum                     184 ( 2.0%)             1\n-ast-stats-2 - ExternCrate              184 ( 2.0%)             1\n-ast-stats-2 - ForeignMod               184 ( 2.0%)             1\n-ast-stats-2 - Impl                     184 ( 2.0%)             1\n-ast-stats-2 - Fn                       368 ( 4.0%)             2\n-ast-stats-2 - Use                      736 ( 8.0%)             4\n+ast-stats-2 Arm                       96 ( 1.1%)             2            48\n+ast-stats-2 ForeignItem               96 ( 1.1%)             1            96\n+ast-stats-2 - Fn                        96 ( 1.1%)             1\n+ast-stats-2 InlineAsm                120 ( 1.4%)             1           120\n+ast-stats-2 Attribute                128 ( 1.5%)             4            32\n+ast-stats-2 - DocComment                32 ( 0.4%)             1\n+ast-stats-2 - Normal                    96 ( 1.1%)             3\n+ast-stats-2 FieldDef                 160 ( 1.8%)             2            80\n+ast-stats-2 Stmt                     160 ( 1.8%)             5            32\n+ast-stats-2 - Local                     32 ( 0.4%)             1\n+ast-stats-2 - Semi                      32 ( 0.4%)             1\n+ast-stats-2 - Expr                      96 ( 1.1%)             3\n+ast-stats-2 Param                    160 ( 1.8%)             4            40\n+ast-stats-2 FnDecl                   200 ( 2.3%)             5            40\n+ast-stats-2 Variant                  240 ( 2.8%)             2           120\n+ast-stats-2 Block                    288 ( 3.3%)             6            48\n+ast-stats-2 GenericBound             352 ( 4.1%)             4            88\n+ast-stats-2 - Trait                    352 ( 4.1%)             4\n+ast-stats-2 AssocItem                416 ( 4.8%)             4           104\n+ast-stats-2 - Type                     208 ( 2.4%)             2\n+ast-stats-2 - Fn                       208 ( 2.4%)             2\n+ast-stats-2 GenericParam             480 ( 5.5%)             5            96\n+ast-stats-2 Pat                      728 ( 8.4%)             7           104\n+ast-stats-2 - Struct                   104 ( 1.2%)             1\n+ast-stats-2 - Wild                     104 ( 1.2%)             1\n+ast-stats-2 - Ident                    520 ( 6.0%)             5\n+ast-stats-2 PathSegment              792 ( 9.1%)            33            24\n+ast-stats-2 Expr                     792 ( 9.1%)             9            88\n+ast-stats-2 - Path                      88 ( 1.0%)             1\n+ast-stats-2 - Match                     88 ( 1.0%)             1\n+ast-stats-2 - Struct                    88 ( 1.0%)             1\n+ast-stats-2 - InlineAsm                 88 ( 1.0%)             1\n+ast-stats-2 - Lit                      176 ( 2.0%)             2\n+ast-stats-2 - Block                    264 ( 3.0%)             3\n+ast-stats-2 Ty                     1_120 (12.9%)            14            80\n+ast-stats-2 - Rptr                      80 ( 0.9%)             1\n+ast-stats-2 - Ptr                       80 ( 0.9%)             1\n+ast-stats-2 - ImplicitSelf             160 ( 1.8%)             2\n+ast-stats-2 - Path                     800 ( 9.2%)            10\n+ast-stats-2 Item                   2_024 (23.4%)            11           184\n+ast-stats-2 - Trait                    184 ( 2.1%)             1\n+ast-stats-2 - Enum                     184 ( 2.1%)             1\n+ast-stats-2 - ExternCrate              184 ( 2.1%)             1\n+ast-stats-2 - ForeignMod               184 ( 2.1%)             1\n+ast-stats-2 - Impl                     184 ( 2.1%)             1\n+ast-stats-2 - Fn                       368 ( 4.2%)             2\n+ast-stats-2 - Use                      736 ( 8.5%)             4\n ast-stats-2 ----------------------------------------------------------------\n-ast-stats-2 Total                  9_144\n+ast-stats-2 Total                  8_664\n ast-stats-2\n hir-stats HIR STATS\n hir-stats Name                Accumulated Size         Count     Item Size"}, {"sha": "29425b2e5541791db6c485d904a38981abda173b", "filename": "src/tools/clippy/clippy_lints/src/double_parens.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdouble_parens.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdouble_parens.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdouble_parens.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -61,10 +61,10 @@ impl EarlyLintPass for DoubleParens {\n                     }\n                 }\n             },\n-            ExprKind::MethodCall(_, _, ref params, _) => {\n-                if let [ref param] = params[..] {\n-                    if let ExprKind::Paren(_) = param.kind {\n-                        span_lint(cx, DOUBLE_PARENS, param.span, msg);\n+            ExprKind::MethodCall(ref call) => {\n+                if let [ref arg] = call.args[..] {\n+                    if let ExprKind::Paren(_) = arg.kind {\n+                        span_lint(cx, DOUBLE_PARENS, arg.span, msg);\n                     }\n                 }\n             },"}, {"sha": "377bddeaa5feabccaa30f4a6e759baf33b152741", "filename": "src/tools/clippy/clippy_lints/src/option_env_unwrap.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_env_unwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_env_unwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Foption_env_unwrap.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -1,7 +1,7 @@\n use clippy_utils::diagnostics::span_lint_and_help;\n use clippy_utils::is_direct_expn_of;\n use if_chain::if_chain;\n-use rustc_ast::ast::{Expr, ExprKind};\n+use rustc_ast::ast::{Expr, ExprKind, MethodCall};\n use rustc_lint::{EarlyContext, EarlyLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::sym;\n@@ -37,8 +37,8 @@ declare_lint_pass!(OptionEnvUnwrap => [OPTION_ENV_UNWRAP]);\n impl EarlyLintPass for OptionEnvUnwrap {\n     fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n         if_chain! {\n-            if let ExprKind::MethodCall(path_segment, receiver, _, _) = &expr.kind;\n-            if matches!(path_segment.ident.name, sym::expect | sym::unwrap);\n+            if let ExprKind::MethodCall(box MethodCall { seg, receiver, .. }) = &expr.kind;\n+            if matches!(seg.ident.name, sym::expect | sym::unwrap);\n             if let ExprKind::Call(caller, _) = &receiver.kind;\n             if is_direct_expn_of(caller.span, \"option_env\").is_some();\n             then {"}, {"sha": "057b7e30642ec5bc0edd134d913bef1ec8c537e4", "filename": "src/tools/clippy/clippy_lints/src/precedence.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fprecedence.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fprecedence.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fprecedence.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -1,7 +1,7 @@\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_applicability;\n use if_chain::if_chain;\n-use rustc_ast::ast::{BinOpKind, Expr, ExprKind, UnOp};\n+use rustc_ast::ast::{BinOpKind, Expr, ExprKind, MethodCall, UnOp};\n use rustc_ast::token;\n use rustc_errors::Applicability;\n use rustc_lint::{EarlyContext, EarlyLintPass};\n@@ -110,11 +110,11 @@ impl EarlyLintPass for Precedence {\n             let mut arg = operand;\n \n             let mut all_odd = true;\n-            while let ExprKind::MethodCall(path_segment, receiver, _, _) = &arg.kind {\n-                let path_segment_str = path_segment.ident.name.as_str();\n+            while let ExprKind::MethodCall(box MethodCall { seg, receiver, .. }) = &arg.kind {\n+                let seg_str = seg.ident.name.as_str();\n                 all_odd &= ALLOWED_ODD_FUNCTIONS\n                     .iter()\n-                    .any(|odd_function| **odd_function == *path_segment_str);\n+                    .any(|odd_function| **odd_function == *seg_str);\n                 arg = receiver;\n             }\n "}, {"sha": "4cbe9597c5393eee7221480dbb487aa6d863ce76", "filename": "src/tools/clippy/clippy_lints/src/redundant_closure_call.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_closure_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_closure_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fredundant_closure_call.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -69,24 +69,24 @@ impl EarlyLintPass for RedundantClosureCall {\n         if_chain! {\n             if let ast::ExprKind::Call(ref paren, _) = expr.kind;\n             if let ast::ExprKind::Paren(ref closure) = paren.kind;\n-            if let ast::ExprKind::Closure(_, _, ref r#async, _, ref decl, ref block, _) = closure.kind;\n+            if let ast::ExprKind::Closure(box ast::Closure { ref asyncness, ref fn_decl, ref body, .. }) = closure.kind;\n             then {\n                 let mut visitor = ReturnVisitor::new();\n-                visitor.visit_expr(block);\n+                visitor.visit_expr(body);\n                 if !visitor.found_return {\n                     span_lint_and_then(\n                         cx,\n                         REDUNDANT_CLOSURE_CALL,\n                         expr.span,\n                         \"try not to call a closure in the expression where it is declared\",\n                         |diag| {\n-                            if decl.inputs.is_empty() {\n+                            if fn_decl.inputs.is_empty() {\n                                 let app = Applicability::MachineApplicable;\n-                                let mut hint = Sugg::ast(cx, block, \"..\");\n+                                let mut hint = Sugg::ast(cx, body, \"..\");\n \n-                                if r#async.is_async() {\n+                                if asyncness.is_async() {\n                                     // `async x` is a syntax error, so it becomes `async { x }`\n-                                    if !matches!(block.kind, ast::ExprKind::Block(_, _)) {\n+                                    if !matches!(body.kind, ast::ExprKind::Block(_, _)) {\n                                         hint = hint.blockify();\n                                     }\n "}, {"sha": "78e83880e1a6121020f0d6e0d724fee457fe46e0", "filename": "src/tools/clippy/clippy_lints/src/suspicious_operation_groupings.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsuspicious_operation_groupings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsuspicious_operation_groupings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fsuspicious_operation_groupings.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -580,7 +580,7 @@ fn ident_difference_expr_with_base_location(\n         | (Await(_), Await(_))\n         | (Async(_, _, _), Async(_, _, _))\n         | (Block(_, _), Block(_, _))\n-        | (Closure(_, _, _, _, _, _, _), Closure(_, _, _, _, _, _, _))\n+        | (Closure(_), Closure(_))\n         | (Match(_, _), Match(_, _))\n         | (Loop(_, _), Loop(_, _))\n         | (ForLoop(_, _, _, _), ForLoop(_, _, _, _))\n@@ -593,7 +593,7 @@ fn ident_difference_expr_with_base_location(\n         | (Unary(_, _), Unary(_, _))\n         | (Binary(_, _, _), Binary(_, _, _))\n         | (Tup(_), Tup(_))\n-        | (MethodCall(_, _, _, _), MethodCall(_, _, _, _))\n+        | (MethodCall(_), MethodCall(_))\n         | (Call(_, _), Call(_, _))\n         | (ConstBlock(_), ConstBlock(_))\n         | (Array(_), Array(_))"}, {"sha": "bb6fb38e9690e32a3e472c49f1462bc38fa28d1b", "filename": "src/tools/clippy/clippy_lints/src/unnested_or_patterns.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnested_or_patterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnested_or_patterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnested_or_patterns.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -292,7 +292,7 @@ fn transform_with_focus_on_idx(alternatives: &mut Vec<P<Pat>>, focus_idx: usize)\n /// So when we fixate on some `ident_k: pat_k`, we try to find `ident_k` in the other pattern\n /// and check that all `fp_i` where `i \u2208 ((0...n) \\ k)` between two patterns are equal.\n fn extend_with_struct_pat(\n-    qself1: &Option<ast::QSelf>,\n+    qself1: &Option<P<ast::QSelf>>,\n     path1: &ast::Path,\n     fps1: &mut [ast::PatField],\n     rest1: bool,"}, {"sha": "5ab351bc29ca0b8b1ba653287f1933cc70d99217", "filename": "src/tools/clippy/clippy_lints/src/unused_rounding.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funused_rounding.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funused_rounding.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funused_rounding.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -1,5 +1,5 @@\n use clippy_utils::diagnostics::span_lint_and_sugg;\n-use rustc_ast::ast::{Expr, ExprKind};\n+use rustc_ast::ast::{Expr, ExprKind, MethodCall};\n use rustc_errors::Applicability;\n use rustc_lint::{EarlyContext, EarlyLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n@@ -30,8 +30,8 @@ declare_clippy_lint! {\n declare_lint_pass!(UnusedRounding => [UNUSED_ROUNDING]);\n \n fn is_useless_rounding(expr: &Expr) -> Option<(&str, String)> {\n-    if let ExprKind::MethodCall(name_ident, receiver, _, _) = &expr.kind\n-        && let method_name = name_ident.ident.name.as_str()\n+    if let ExprKind::MethodCall(box MethodCall { seg, receiver, .. }) = &expr.kind\n+        && let method_name = seg.ident.name.as_str()\n         && (method_name == \"ceil\" || method_name == \"round\" || method_name == \"floor\")\n         && let ExprKind::Lit(token_lit) = &receiver.kind\n         && token_lit.is_semantic_float() {"}, {"sha": "23aed4b5ba2f40f2c675009c338736431a5fdd1e", "filename": "src/tools/clippy/clippy_utils/src/ast_utils.rs", "status": "modified", "additions": 27, "deletions": 5, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fast_utils.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -75,11 +75,11 @@ pub fn eq_field_pat(l: &PatField, r: &PatField) -> bool {\n         && over(&l.attrs, &r.attrs, eq_attr)\n }\n \n-pub fn eq_qself(l: &QSelf, r: &QSelf) -> bool {\n+pub fn eq_qself(l: &P<QSelf>, r: &P<QSelf>) -> bool {\n     l.position == r.position && eq_ty(&l.ty, &r.ty)\n }\n \n-pub fn eq_maybe_qself(l: &Option<QSelf>, r: &Option<QSelf>) -> bool {\n+pub fn eq_maybe_qself(l: &Option<P<QSelf>>, r: &Option<P<QSelf>>) -> bool {\n     match (l, r) {\n         (Some(l), Some(r)) => eq_qself(l, r),\n         (None, None) => true,\n@@ -147,8 +147,11 @@ pub fn eq_expr(l: &Expr, r: &Expr) -> bool {\n         (Array(l), Array(r)) | (Tup(l), Tup(r)) => over(l, r, |l, r| eq_expr(l, r)),\n         (Repeat(le, ls), Repeat(re, rs)) => eq_expr(le, re) && eq_expr(&ls.value, &rs.value),\n         (Call(lc, la), Call(rc, ra)) => eq_expr(lc, rc) && over(la, ra, |l, r| eq_expr(l, r)),\n-        (MethodCall(lc, ls, la, _), MethodCall(rc, rs, ra, _)) => {\n-            eq_path_seg(lc, rc) && eq_expr(ls, rs) && over(la, ra, |l, r| eq_expr(l, r))\n+        (\n+            MethodCall(box ast::MethodCall { seg: ls, receiver: lr, args: la, .. }),\n+            MethodCall(box ast::MethodCall { seg: rs, receiver: rr, args: ra, .. })\n+        ) => {\n+            eq_path_seg(ls, rs) && eq_expr(lr, rr) && over(la, ra, |l, r| eq_expr(l, r))\n         },\n         (Binary(lo, ll, lr), Binary(ro, rl, rr)) => lo.node == ro.node && eq_expr(ll, rl) && eq_expr(lr, rr),\n         (Unary(lo, l), Unary(ro, r)) => mem::discriminant(lo) == mem::discriminant(ro) && eq_expr(l, r),\n@@ -170,7 +173,26 @@ pub fn eq_expr(l: &Expr, r: &Expr) -> bool {\n         (AssignOp(lo, lp, lv), AssignOp(ro, rp, rv)) => lo.node == ro.node && eq_expr(lp, rp) && eq_expr(lv, rv),\n         (Field(lp, lf), Field(rp, rf)) => eq_id(*lf, *rf) && eq_expr(lp, rp),\n         (Match(ls, la), Match(rs, ra)) => eq_expr(ls, rs) && over(la, ra, eq_arm),\n-        (Closure(lb, lc, la, lm, lf, le, _), Closure(rb, rc, ra, rm, rf, re, _)) => {\n+        (\n+            Closure(box ast::Closure {\n+                binder: lb,\n+                capture_clause: lc,\n+                asyncness: la,\n+                movability: lm,\n+                fn_decl: lf,\n+                body: le,\n+                ..\n+            }),\n+            Closure(box ast::Closure {\n+                binder: rb,\n+                capture_clause: rc,\n+                asyncness: ra,\n+                movability: rm,\n+                fn_decl: rf,\n+                body: re,\n+                ..\n+            })\n+        ) => {\n             eq_closure_binder(lb, rb)\n                 && lc == rc\n                 && la.is_async() == ra.is_async()"}, {"sha": "23f55db773e6c01e52ab624b95a681b019f7ddbb", "filename": "src/tools/rustfmt/src/attr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -290,10 +290,10 @@ impl Rewrite for ast::MetaItem {\n     fn rewrite(&self, context: &RewriteContext<'_>, shape: Shape) -> Option<String> {\n         Some(match self.kind {\n             ast::MetaItemKind::Word => {\n-                rewrite_path(context, PathContext::Type, None, &self.path, shape)?\n+                rewrite_path(context, PathContext::Type, &None, &self.path, shape)?\n             }\n             ast::MetaItemKind::List(ref list) => {\n-                let path = rewrite_path(context, PathContext::Type, None, &self.path, shape)?;\n+                let path = rewrite_path(context, PathContext::Type, &None, &self.path, shape)?;\n                 let has_trailing_comma = crate::expr::span_ends_with_comma(context, self.span);\n                 overflow::rewrite_with_parens(\n                     context,\n@@ -311,7 +311,7 @@ impl Rewrite for ast::MetaItem {\n                 )?\n             }\n             ast::MetaItemKind::NameValue(ref literal) => {\n-                let path = rewrite_path(context, PathContext::Type, None, &self.path, shape)?;\n+                let path = rewrite_path(context, PathContext::Type, &None, &self.path, shape)?;\n                 // 3 = ` = `\n                 let lit_shape = shape.shrink_left(path.len() + 3)?;\n                 // `rewrite_literal` returns `None` when `literal` exceeds max"}, {"sha": "a1a73cf4bd570f2ee495766e207e2e7935487773", "filename": "src/tools/rustfmt/src/chains.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fchains.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -145,8 +145,8 @@ impl ChainItemKind {\n \n     fn from_ast(context: &RewriteContext<'_>, expr: &ast::Expr) -> (ChainItemKind, Span) {\n         let (kind, span) = match expr.kind {\n-            ast::ExprKind::MethodCall(ref segment, ref receiver, ref expressions, _) => {\n-                let types = if let Some(ref generic_args) = segment.args {\n+            ast::ExprKind::MethodCall(ref call) => {\n+                let types = if let Some(ref generic_args) = call.seg.args {\n                     if let ast::GenericArgs::AngleBracketed(ref data) = **generic_args {\n                         data.args\n                             .iter()\n@@ -163,8 +163,8 @@ impl ChainItemKind {\n                 } else {\n                     vec![]\n                 };\n-                let span = mk_sp(receiver.span.hi(), expr.span.hi());\n-                let kind = ChainItemKind::MethodCall(segment.clone(), types, expressions.clone());\n+                let span = mk_sp(call.receiver.span.hi(), expr.span.hi());\n+                let kind = ChainItemKind::MethodCall(call.seg.clone(), types, call.args.clone());\n                 (kind, span)\n             }\n             ast::ExprKind::Field(ref nested, field) => {\n@@ -400,9 +400,7 @@ impl Chain {\n     // is a try! macro, we'll convert it to shorthand when the option is set.\n     fn pop_expr_chain(expr: &ast::Expr, context: &RewriteContext<'_>) -> Option<ast::Expr> {\n         match expr.kind {\n-            ast::ExprKind::MethodCall(_, ref receiver, _, _) => {\n-                Some(Self::convert_try(&receiver, context))\n-            }\n+            ast::ExprKind::MethodCall(ref call) => Some(Self::convert_try(&call.receiver, context)),\n             ast::ExprKind::Field(ref subexpr, _)\n             | ast::ExprKind::Try(ref subexpr)\n             | ast::ExprKind::Await(ref subexpr) => Some(Self::convert_try(subexpr, context)),"}, {"sha": "423c3a997f53da7e8879bbb797b92a2774026569", "filename": "src/tools/rustfmt/src/closures.rs", "status": "modified", "additions": 19, "deletions": 11, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fclosures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fclosures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fclosures.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -326,16 +326,16 @@ pub(crate) fn rewrite_last_closure(\n     expr: &ast::Expr,\n     shape: Shape,\n ) -> Option<String> {\n-    if let ast::ExprKind::Closure(\n-        ref binder,\n-        capture,\n-        ref is_async,\n-        movability,\n-        ref fn_decl,\n-        ref body,\n-        _,\n-    ) = expr.kind\n-    {\n+    if let ast::ExprKind::Closure(ref closure) = expr.kind {\n+        let ast::Closure {\n+            ref binder,\n+            capture_clause,\n+            ref asyncness,\n+            movability,\n+            ref fn_decl,\n+            ref body,\n+            fn_decl_span: _,\n+        } = **closure;\n         let body = match body.kind {\n             ast::ExprKind::Block(ref block, _)\n                 if !is_unsafe_block(block)\n@@ -347,7 +347,15 @@ pub(crate) fn rewrite_last_closure(\n             _ => body,\n         };\n         let (prefix, extra_offset) = rewrite_closure_fn_decl(\n-            binder, capture, is_async, movability, fn_decl, body, expr.span, context, shape,\n+            binder,\n+            capture_clause,\n+            asyncness,\n+            movability,\n+            fn_decl,\n+            body,\n+            expr.span,\n+            context,\n+            shape,\n         )?;\n         // If the closure goes multi line before its body, do not overflow the closure.\n         if prefix.contains('\\n') {"}, {"sha": "aba1c484bf1ddc028e8507fd59517c9a9691e6a1", "filename": "src/tools/rustfmt/src/expr.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -116,7 +116,7 @@ pub(crate) fn format_expr(\n             rewrite_struct_lit(\n                 context,\n                 path,\n-                qself.as_ref(),\n+                qself,\n                 fields,\n                 rest,\n                 &expr.attrs,\n@@ -169,7 +169,7 @@ pub(crate) fn format_expr(\n             rewrite_match(context, cond, arms, shape, expr.span, &expr.attrs)\n         }\n         ast::ExprKind::Path(ref qself, ref path) => {\n-            rewrite_path(context, PathContext::Expr, qself.as_ref(), path, shape)\n+            rewrite_path(context, PathContext::Expr, qself, path, shape)\n         }\n         ast::ExprKind::Assign(ref lhs, ref rhs, _) => {\n             rewrite_assignment(context, lhs, rhs, None, shape)\n@@ -203,16 +203,16 @@ pub(crate) fn format_expr(\n                 Some(\"yield\".to_string())\n             }\n         }\n-        ast::ExprKind::Closure(\n-            ref binder,\n-            capture,\n-            ref is_async,\n-            movability,\n-            ref fn_decl,\n-            ref body,\n-            _,\n-        ) => closures::rewrite_closure(\n-            binder, capture, is_async, movability, fn_decl, body, expr.span, context, shape,\n+        ast::ExprKind::Closure(ref cl) => closures::rewrite_closure(\n+            &cl.binder,\n+            cl.capture_clause,\n+            &cl.asyncness,\n+            cl.movability,\n+            &cl.fn_decl,\n+            &cl.body,\n+            expr.span,\n+            context,\n+            shape,\n         ),\n         ast::ExprKind::Try(..)\n         | ast::ExprKind::Field(..)\n@@ -1537,7 +1537,7 @@ fn struct_lit_can_be_aligned(fields: &[ast::ExprField], has_base: bool) -> bool\n fn rewrite_struct_lit<'a>(\n     context: &RewriteContext<'_>,\n     path: &ast::Path,\n-    qself: Option<&ast::QSelf>,\n+    qself: &Option<ptr::P<ast::QSelf>>,\n     fields: &'a [ast::ExprField],\n     struct_rest: &ast::StructRest,\n     attrs: &[ast::Attribute],"}, {"sha": "3f335172590ec808e44a3a667905e1764cd01aba", "filename": "src/tools/rustfmt/src/patterns.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -227,11 +227,10 @@ impl Rewrite for Pat {\n             }\n             PatKind::Tuple(ref items) => rewrite_tuple_pat(items, None, self.span, context, shape),\n             PatKind::Path(ref q_self, ref path) => {\n-                rewrite_path(context, PathContext::Expr, q_self.as_ref(), path, shape)\n+                rewrite_path(context, PathContext::Expr, q_self, path, shape)\n             }\n             PatKind::TupleStruct(ref q_self, ref path, ref pat_vec) => {\n-                let path_str =\n-                    rewrite_path(context, PathContext::Expr, q_self.as_ref(), path, shape)?;\n+                let path_str = rewrite_path(context, PathContext::Expr, q_self, path, shape)?;\n                 rewrite_tuple_pat(pat_vec, Some(path_str), self.span, context, shape)\n             }\n             PatKind::Lit(ref expr) => expr.rewrite(context, shape),\n@@ -271,7 +270,7 @@ impl Rewrite for Pat {\n }\n \n fn rewrite_struct_pat(\n-    qself: &Option<ast::QSelf>,\n+    qself: &Option<ptr::P<ast::QSelf>>,\n     path: &ast::Path,\n     fields: &[ast::PatField],\n     ellipsis: bool,\n@@ -281,7 +280,7 @@ fn rewrite_struct_pat(\n ) -> Option<String> {\n     // 2 =  ` {`\n     let path_shape = shape.sub_width(2)?;\n-    let path_str = rewrite_path(context, PathContext::Expr, qself.as_ref(), path, path_shape)?;\n+    let path_str = rewrite_path(context, PathContext::Expr, qself, path, path_shape)?;\n \n     if fields.is_empty() && !ellipsis {\n         return Some(format!(\"{} {{}}\", path_str));"}, {"sha": "d5177a2057b8ab05fb3daebe466de1d87dc32710", "filename": "src/tools/rustfmt/src/types.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -38,11 +38,11 @@ pub(crate) enum PathContext {\n pub(crate) fn rewrite_path(\n     context: &RewriteContext<'_>,\n     path_context: PathContext,\n-    qself: Option<&ast::QSelf>,\n+    qself: &Option<ptr::P<ast::QSelf>>,\n     path: &ast::Path,\n     shape: Shape,\n ) -> Option<String> {\n-    let skip_count = qself.map_or(0, |x| x.position);\n+    let skip_count = qself.as_ref().map_or(0, |x| x.position);\n \n     let mut result = if path.is_global() && qself.is_none() && path_context != PathContext::Import {\n         \"::\".to_owned()\n@@ -655,7 +655,7 @@ impl Rewrite for ast::PolyTraitRef {\n \n impl Rewrite for ast::TraitRef {\n     fn rewrite(&self, context: &RewriteContext<'_>, shape: Shape) -> Option<String> {\n-        rewrite_path(context, PathContext::Type, None, &self.path, shape)\n+        rewrite_path(context, PathContext::Type, &None, &self.path, shape)\n     }\n }\n \n@@ -800,7 +800,7 @@ impl Rewrite for ast::Ty {\n                 rewrite_tuple(context, items.iter(), self.span, shape, items.len() == 1)\n             }\n             ast::TyKind::Path(ref q_self, ref path) => {\n-                rewrite_path(context, PathContext::Type, q_self.as_ref(), path, shape)\n+                rewrite_path(context, PathContext::Type, q_self, path, shape)\n             }\n             ast::TyKind::Array(ref ty, ref repeats) => rewrite_pair(\n                 &**ty,"}, {"sha": "136a2c7fce24a802aac4c6e252e818b12db00ea1", "filename": "src/tools/rustfmt/src/utils.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Futils.rs?ref=6b7ca2fcf2ebbba705f7a98c00bd56b5348ee9d7", "patch": "@@ -479,9 +479,9 @@ pub(crate) fn is_block_expr(context: &RewriteContext<'_>, expr: &ast::Expr, repr\n         | ast::ExprKind::Binary(_, _, ref expr)\n         | ast::ExprKind::Index(_, ref expr)\n         | ast::ExprKind::Unary(_, ref expr)\n-        | ast::ExprKind::Closure(_, _, _, _, _, ref expr, _)\n         | ast::ExprKind::Try(ref expr)\n         | ast::ExprKind::Yield(Some(ref expr)) => is_block_expr(context, expr, repr),\n+        ast::ExprKind::Closure(ref closure) => is_block_expr(context, &closure.body, repr),\n         // This can only be a string lit\n         ast::ExprKind::Lit(_) => {\n             repr.contains('\\n') && trimmed_last_line_width(repr) <= context.config.tab_spaces()"}]}