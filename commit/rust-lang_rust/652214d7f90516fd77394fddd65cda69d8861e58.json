{"sha": "652214d7f90516fd77394fddd65cda69d8861e58", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1MjIxNGQ3ZjkwNTE2ZmQ3NzM5NGZkZGQ2NWNkYTY5ZDg4NjFlNTg=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-19T23:55:09Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-19T23:55:45Z"}, "message": "Fix calculation of sizeof boxed ivec of str in rt. Closes #712", "tree": {"sha": "d85ff2477e092812b07238c33ff70deaedc8b5da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d85ff2477e092812b07238c33ff70deaedc8b5da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/652214d7f90516fd77394fddd65cda69d8861e58", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/652214d7f90516fd77394fddd65cda69d8861e58", "html_url": "https://github.com/rust-lang/rust/commit/652214d7f90516fd77394fddd65cda69d8861e58", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/652214d7f90516fd77394fddd65cda69d8861e58/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19a17b3d1d0d25155c8bd11c73bf88238f9bd180", "url": "https://api.github.com/repos/rust-lang/rust/commits/19a17b3d1d0d25155c8bd11c73bf88238f9bd180", "html_url": "https://github.com/rust-lang/rust/commit/19a17b3d1d0d25155c8bd11c73bf88238f9bd180"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "e434138f102cadcd5e894810ddfeeddc948537fe", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/652214d7f90516fd77394fddd65cda69d8861e58/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/652214d7f90516fd77394fddd65cda69d8861e58/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=652214d7f90516fd77394fddd65cda69d8861e58", "patch": "@@ -608,8 +608,12 @@ rust_list_files_ivec(rust_task *task, rust_str *path) {\n       closedir(dirp);\n   }\n #endif\n+  size_t str_ivec_sz =\n+      sizeof(size_t)            // fill\n+      + sizeof(size_t)          // alloc\n+      + sizeof(rust_str *) * 4; // payload\n   rust_box *box = (rust_box *)task->malloc(sizeof(rust_box) +\n-                                           sizeof(rust_ivec));\n+                                           str_ivec_sz);\n   box->ref_count = 1;\n   rust_ivec *iv = (rust_ivec *)&box->data;\n   iv->fill = 0;"}, {"sha": "99db357658e50af4c96d358db084fe5352cbe0ee", "filename": "src/rt/rust_util.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/652214d7f90516fd77394fddd65cda69d8861e58/src%2Frt%2Frust_util.h", "raw_url": "https://github.com/rust-lang/rust/raw/652214d7f90516fd77394fddd65cda69d8861e58/src%2Frt%2Frust_util.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_util.h?ref=652214d7f90516fd77394fddd65cda69d8861e58", "patch": "@@ -202,6 +202,7 @@ rust_ivec_heap\n     uint8_t data[];\n };\n \n+// Note that the payload is actually size 4*sizeof(elem), even when heapified\n union\n rust_ivec_payload\n {"}, {"sha": "8bc8989e5638d7045518d29801f7012787c136f9", "filename": "src/test/run-pass/lib-fs.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/652214d7f90516fd77394fddd65cda69d8861e58/src%2Ftest%2Frun-pass%2Flib-fs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/652214d7f90516fd77394fddd65cda69d8861e58/src%2Ftest%2Frun-pass%2Flib-fs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-fs.rs?ref=652214d7f90516fd77394fddd65cda69d8861e58", "patch": "@@ -9,4 +9,12 @@ fn test_connect() {\n     assert (fs::connect(\"a\" + slash, \"b\") == \"a\" + slash + \"b\");\n }\n \n-fn main() { test_connect(); }\n\\ No newline at end of file\n+// Issue #712\n+fn test_list_dir_no_invalid_memory_access() {\n+  fs::list_dir(\".\");\n+}\n+\n+fn main() {\n+  test_connect();\n+  test_list_dir_no_invalid_memory_access();\n+}\n\\ No newline at end of file"}]}