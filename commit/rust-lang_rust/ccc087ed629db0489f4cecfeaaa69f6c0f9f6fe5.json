{"sha": "ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjYzA4N2VkNjI5ZGIwNDg5ZjRjZWNmZWFhYTY5ZjZjMGY5ZjZmZTU=", "commit": {"author": {"name": "Samuel E. Moelius III", "email": "sam@moeli.us", "date": "2021-09-01T22:31:42Z"}, "committer": {"name": "Samuel E. Moelius III", "email": "sam@moeli.us", "date": "2021-09-09T08:59:06Z"}, "message": "Prep for upgrade to cargo_metadata 0.14.0", "tree": {"sha": "d67df76de8dbde71c3b208a6d534f09aa147c9e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d67df76de8dbde71c3b208a6d534f09aa147c9e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5", "html_url": "https://github.com/rust-lang/rust/commit/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5/comments", "author": {"login": "smoelius", "id": 35515885, "node_id": "MDQ6VXNlcjM1NTE1ODg1", "avatar_url": "https://avatars.githubusercontent.com/u/35515885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smoelius", "html_url": "https://github.com/smoelius", "followers_url": "https://api.github.com/users/smoelius/followers", "following_url": "https://api.github.com/users/smoelius/following{/other_user}", "gists_url": "https://api.github.com/users/smoelius/gists{/gist_id}", "starred_url": "https://api.github.com/users/smoelius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smoelius/subscriptions", "organizations_url": "https://api.github.com/users/smoelius/orgs", "repos_url": "https://api.github.com/users/smoelius/repos", "events_url": "https://api.github.com/users/smoelius/events{/privacy}", "received_events_url": "https://api.github.com/users/smoelius/received_events", "type": "User", "site_admin": false}, "committer": {"login": "smoelius", "id": 35515885, "node_id": "MDQ6VXNlcjM1NTE1ODg1", "avatar_url": "https://avatars.githubusercontent.com/u/35515885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smoelius", "html_url": "https://github.com/smoelius", "followers_url": "https://api.github.com/users/smoelius/followers", "following_url": "https://api.github.com/users/smoelius/following{/other_user}", "gists_url": "https://api.github.com/users/smoelius/gists{/gist_id}", "starred_url": "https://api.github.com/users/smoelius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smoelius/subscriptions", "organizations_url": "https://api.github.com/users/smoelius/orgs", "repos_url": "https://api.github.com/users/smoelius/repos", "events_url": "https://api.github.com/users/smoelius/events{/privacy}", "received_events_url": "https://api.github.com/users/smoelius/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "261e34d5348218cbea3cd9a589c49aba92c322d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/261e34d5348218cbea3cd9a589c49aba92c322d4", "html_url": "https://github.com/rust-lang/rust/commit/261e34d5348218cbea3cd9a589c49aba92c322d4"}], "stats": {"total": 14, "additions": 4, "deletions": 10}, "files": [{"sha": "162911b77d6153b6f02fc7b8d6e5ada56fcfe2a1", "filename": "clippy_lints/src/cargo_common_metadata.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs?ref=ccc087ed629db0489f4cecfeaaa69f6c0f9f6fe5", "patch": "@@ -1,7 +1,5 @@\n //! lint on missing cargo common metadata\n \n-use std::path::PathBuf;\n-\n use clippy_utils::{diagnostics::span_lint, is_lint_allowed};\n use rustc_hir::{hir_id::CRATE_HIR_ID, Crate};\n use rustc_lint::{LateContext, LateLintPass};\n@@ -69,12 +67,8 @@ fn missing_warning(cx: &LateContext<'_>, package: &cargo_metadata::Package, fiel\n     span_lint(cx, CARGO_COMMON_METADATA, DUMMY_SP, &message);\n }\n \n-fn is_empty_str(value: &Option<String>) -> bool {\n-    value.as_ref().map_or(true, String::is_empty)\n-}\n-\n-fn is_empty_path(value: &Option<PathBuf>) -> bool {\n-    value.as_ref().and_then(|x| x.to_str()).map_or(true, str::is_empty)\n+fn is_empty_str<T: AsRef<std::ffi::OsStr>>(value: &Option<T>) -> bool {\n+    value.as_ref().map_or(true, |s| s.as_ref().is_empty())\n }\n \n fn is_empty_vec(value: &[String]) -> bool {\n@@ -98,15 +92,15 @@ impl LateLintPass<'_> for CargoCommonMetadata {\n                     missing_warning(cx, &package, \"package.description\");\n                 }\n \n-                if is_empty_str(&package.license) && is_empty_path(&package.license_file) {\n+                if is_empty_str(&package.license) && is_empty_str(&package.license_file) {\n                     missing_warning(cx, &package, \"either package.license or package.license_file\");\n                 }\n \n                 if is_empty_str(&package.repository) {\n                     missing_warning(cx, &package, \"package.repository\");\n                 }\n \n-                if is_empty_path(&package.readme) {\n+                if is_empty_str(&package.readme) {\n                     missing_warning(cx, &package, \"package.readme\");\n                 }\n "}]}