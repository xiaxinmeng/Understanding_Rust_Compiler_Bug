{"sha": "9f406ce2c799cd39173f43cff8288674710f91d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmNDA2Y2UyYzc5OWNkMzkxNzNmNDNjZmY4Mjg4Njc0NzEwZjkxZDc=", "commit": {"author": {"name": "Manuel Drehwald", "email": "git@manuel.drehwald.info", "date": "2021-06-20T23:38:25Z"}, "committer": {"name": "Manuel Drehwald", "email": "git@manuel.drehwald.info", "date": "2021-06-20T23:38:25Z"}, "message": "addressing feedback", "tree": {"sha": "ca7747ca4885aa6d54bc4af3ace3b26fd393d93d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ca7747ca4885aa6d54bc4af3ace3b26fd393d93d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f406ce2c799cd39173f43cff8288674710f91d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f406ce2c799cd39173f43cff8288674710f91d7", "html_url": "https://github.com/rust-lang/rust/commit/9f406ce2c799cd39173f43cff8288674710f91d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f406ce2c799cd39173f43cff8288674710f91d7/comments", "author": {"login": "ZuseZ4", "id": 25483084, "node_id": "MDQ6VXNlcjI1NDgzMDg0", "avatar_url": "https://avatars.githubusercontent.com/u/25483084?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZuseZ4", "html_url": "https://github.com/ZuseZ4", "followers_url": "https://api.github.com/users/ZuseZ4/followers", "following_url": "https://api.github.com/users/ZuseZ4/following{/other_user}", "gists_url": "https://api.github.com/users/ZuseZ4/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZuseZ4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZuseZ4/subscriptions", "organizations_url": "https://api.github.com/users/ZuseZ4/orgs", "repos_url": "https://api.github.com/users/ZuseZ4/repos", "events_url": "https://api.github.com/users/ZuseZ4/events{/privacy}", "received_events_url": "https://api.github.com/users/ZuseZ4/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ZuseZ4", "id": 25483084, "node_id": "MDQ6VXNlcjI1NDgzMDg0", "avatar_url": "https://avatars.githubusercontent.com/u/25483084?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZuseZ4", "html_url": "https://github.com/ZuseZ4", "followers_url": "https://api.github.com/users/ZuseZ4/followers", "following_url": "https://api.github.com/users/ZuseZ4/following{/other_user}", "gists_url": "https://api.github.com/users/ZuseZ4/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZuseZ4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZuseZ4/subscriptions", "organizations_url": "https://api.github.com/users/ZuseZ4/orgs", "repos_url": "https://api.github.com/users/ZuseZ4/repos", "events_url": "https://api.github.com/users/ZuseZ4/events{/privacy}", "received_events_url": "https://api.github.com/users/ZuseZ4/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4dbdcd1c5cc5f2e61495af95d81b1fc588506aa4", "url": "https://api.github.com/repos/rust-lang/rust/commits/4dbdcd1c5cc5f2e61495af95d81b1fc588506aa4", "html_url": "https://github.com/rust-lang/rust/commit/4dbdcd1c5cc5f2e61495af95d81b1fc588506aa4"}], "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "1972e96d10eb96ce8031d49b0bb38733b6237c35", "filename": "compiler/rustc_codegen_llvm/src/llvm_util.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9f406ce2c799cd39173f43cff8288674710f91d7/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f406ce2c799cd39173f43cff8288674710f91d7/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs?ref=9f406ce2c799cd39173f43cff8288674710f91d7", "patch": "@@ -130,13 +130,12 @@ unsafe fn configure_llvm(sess: &Session) {\n     llvm::LLVMInitializePasses();\n \n     for plugin in &sess.opts.debugging_opts.llvm_plugins {\n-        let path = CString::new(plugin.as_bytes()).unwrap();\n-        let res = libc::dlopen(path.as_ptr(), libc::RTLD_LAZY | libc::RTLD_GLOBAL);\n-        if res.is_null() {\n-            println!(\"{}\", CStr::from_ptr(libc::dlerror()).to_string_lossy().into_owned());\n+        let path = path::Path::new(plugin);\n+        let res = DynamicLibrary::open(path);\n+        match res {\n+            Ok(_) => debug!(\"configure_llvm: {}\", plugin),\n+            Err(e) => bug!(\"couldn't load plugin: {}\", e),\n         }\n-        println!(\"{:p}\", res);\n-        println!(\"{}\", plugin);\n     }\n \n     rustc_llvm::initialize_available_targets();"}]}