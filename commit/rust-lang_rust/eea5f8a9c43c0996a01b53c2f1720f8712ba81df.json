{"sha": "eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "node_id": "C_kwDOAAsO6NoAKGVlYTVmOGE5YzQzYzA5OTZhMDFiNTNjMmYxNzIwZjg3MTJiYTgxZGY", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-04-28T01:51:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-28T01:51:59Z"}, "message": "Rollup merge of #110721 - lukas-code:panic-fmt, r=Amanieu\n\nformat panic message only once\n\nFormatting the panic message multiple times can cause problems for some real-world crates, so here's a test to ensure that we don't do that.\n\nThis was regressed in https://github.com/rust-lang/rust/pull/109507 and reverted in https://github.com/rust-lang/rust/pull/110782.\n\nfixes https://github.com/rust-lang/rust/issues/110717\nfixes https://github.com/rust-itertools/itertools/issues/694", "tree": {"sha": "d894f86e1bbb822336419f6395104b96f9085715", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d894f86e1bbb822336419f6395104b96f9085715"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkSya/CRBK7hj4Ov3rIwAAti8IAB4GwC3TudG6ROnI2ilaoUep\nr7LKQZ5wMCZsIbuyLNWd2jsNNXj/aCQMEwyfgF2Hpf63bfPxWSSpUBTkR01PBSCB\nNqJ6DzbIJaIK+noqxfMkEwOiamcQqHNkqI7HvCUY4BRiIQaz6qPNwVZcNNoJsvFR\nwRfdYO/Q5lm3O6+PxugGe48L1m9kml5RDWw+OoSW5QT0XEI6yXGnxeQgCS05//Pq\nU9ur7koqEyLkZ+hyzpI3MRcK+hBr73rw19DCDUmVaDsStntjRj8/v2aUhnoKDshe\nHq2RtnTxFEZwvWv6GADHSpXHiSBPqXaPeth8vG7z5UY/6lTgo8Qr7OjsxLq+5Hw=\n=SWBE\n-----END PGP SIGNATURE-----\n", "payload": "tree d894f86e1bbb822336419f6395104b96f9085715\nparent 085fbe90984bce639afdd1c2153a092a1adcadd4\nparent cd398a6de9a177137b493f2355a3b4db4ab8d02a\nauthor Yuki Okushi <jtitor@2k36.org> 1682646719 +0900\ncommitter GitHub <noreply@github.com> 1682646719 +0900\n\nRollup merge of #110721 - lukas-code:panic-fmt, r=Amanieu\n\nformat panic message only once\n\nFormatting the panic message multiple times can cause problems for some real-world crates, so here's a test to ensure that we don't do that.\n\nThis was regressed in https://github.com/rust-lang/rust/pull/109507 and reverted in https://github.com/rust-lang/rust/pull/110782.\n\nfixes https://github.com/rust-lang/rust/issues/110717\nfixes https://github.com/rust-itertools/itertools/issues/694\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "html_url": "https://github.com/rust-lang/rust/commit/eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eea5f8a9c43c0996a01b53c2f1720f8712ba81df/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "085fbe90984bce639afdd1c2153a092a1adcadd4", "url": "https://api.github.com/repos/rust-lang/rust/commits/085fbe90984bce639afdd1c2153a092a1adcadd4", "html_url": "https://github.com/rust-lang/rust/commit/085fbe90984bce639afdd1c2153a092a1adcadd4"}, {"sha": "cd398a6de9a177137b493f2355a3b4db4ab8d02a", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd398a6de9a177137b493f2355a3b4db4ab8d02a", "html_url": "https://github.com/rust-lang/rust/commit/cd398a6de9a177137b493f2355a3b4db4ab8d02a"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "6211bf961b3bcff4d4a5a4a0133269ba3e08e57c", "filename": "tests/ui/panics/fmt-only-once.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/eea5f8a9c43c0996a01b53c2f1720f8712ba81df/tests%2Fui%2Fpanics%2Ffmt-only-once.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eea5f8a9c43c0996a01b53c2f1720f8712ba81df/tests%2Fui%2Fpanics%2Ffmt-only-once.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpanics%2Ffmt-only-once.rs?ref=eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "patch": "@@ -0,0 +1,21 @@\n+// run-fail\n+// check-run-results\n+// exec-env:RUST_BACKTRACE=0\n+\n+// Test that we format the panic message only once.\n+// Regression test for https://github.com/rust-lang/rust/issues/110717\n+\n+use std::fmt;\n+\n+struct PrintOnFmt;\n+\n+impl fmt::Display for PrintOnFmt {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        eprintln!(\"fmt\");\n+        f.write_str(\"PrintOnFmt\")\n+    }\n+}\n+\n+fn main() {\n+    panic!(\"{}\", PrintOnFmt)\n+}"}, {"sha": "39bd06881ad051252c4041ca9f1009febe1c447f", "filename": "tests/ui/panics/fmt-only-once.run.stderr", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/eea5f8a9c43c0996a01b53c2f1720f8712ba81df/tests%2Fui%2Fpanics%2Ffmt-only-once.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eea5f8a9c43c0996a01b53c2f1720f8712ba81df/tests%2Fui%2Fpanics%2Ffmt-only-once.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpanics%2Ffmt-only-once.run.stderr?ref=eea5f8a9c43c0996a01b53c2f1720f8712ba81df", "patch": "@@ -0,0 +1,3 @@\n+fmt\n+thread 'main' panicked at 'PrintOnFmt', $DIR/fmt-only-once.rs:20:5\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}]}