{"sha": "c74ff8b563358435fa0da50e949159d043efc1a5", "node_id": "C_kwDOAAsO6NoAKGM3NGZmOGI1NjMzNTg0MzVmYTBkYTUwZTk0OTE1OWQwNDNlZmMxYTU", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-11-19T04:06:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-19T04:06:37Z"}, "message": "Rollup merge of #90961 - estebank:suggest-removal-of-call, r=nagisa\n\nSuggest removal of arguments for unit variant, not replacement", "tree": {"sha": "9f94b803a75b523c4ff6d6aa254f732c12b88746", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f94b803a75b523c4ff6d6aa254f732c12b88746"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c74ff8b563358435fa0da50e949159d043efc1a5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhlyLOCRBK7hj4Ov3rIwAAAB4IAG2uqZU3PUeRGcFi6QQfWaLG\nT3j8GglJNng1wpKVUOJTSWS8+/dT14PLo86Jd7Kpjow25GnaNMzsvPDrugp1qFna\nS6ZaCovmYuhw0cQqSO6GJ6uBIGSOiC6AM5Us/b7Wuyct0fyXrkJmtRmVPs20V+L4\nPJ0D0r9RqtHMum/+jTjPkNU4OnrL8DXcsxUCWJ5e4TK2YmE67A6qOBetKXBbYmX0\nDUfJZHE/cYBQfD21dgHGa6Nr5cf9II2ijHNPCw9N+Z3zejOxDgP1plGh8WHRydGU\nJDqwYvC22cXEhHqvhOMJ7S/fDIuBdZyXJYLfz9nlxQgpHkHXOp9XrCDoqcMtJME=\n=P6aZ\n-----END PGP SIGNATURE-----\n", "payload": "tree 9f94b803a75b523c4ff6d6aa254f732c12b88746\nparent 022709f4790294bed83b71886dbb52b0c48480b2\nparent 4ca4e094abf6ef2c4871aa6b395e85e8843eb4a8\nauthor Yuki Okushi <jtitor@2k36.org> 1637294797 +0900\ncommitter GitHub <noreply@github.com> 1637294797 +0900\n\nRollup merge of #90961 - estebank:suggest-removal-of-call, r=nagisa\n\nSuggest removal of arguments for unit variant, not replacement\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c74ff8b563358435fa0da50e949159d043efc1a5", "html_url": "https://github.com/rust-lang/rust/commit/c74ff8b563358435fa0da50e949159d043efc1a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c74ff8b563358435fa0da50e949159d043efc1a5/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "022709f4790294bed83b71886dbb52b0c48480b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/022709f4790294bed83b71886dbb52b0c48480b2", "html_url": "https://github.com/rust-lang/rust/commit/022709f4790294bed83b71886dbb52b0c48480b2"}, {"sha": "4ca4e094abf6ef2c4871aa6b395e85e8843eb4a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ca4e094abf6ef2c4871aa6b395e85e8843eb4a8", "html_url": "https://github.com/rust-lang/rust/commit/4ca4e094abf6ef2c4871aa6b395e85e8843eb4a8"}], "stats": {"total": 47, "additions": 28, "deletions": 19}, "files": [{"sha": "635ed93819319e536cfea9c1572d528c9e269c99", "filename": "compiler/rustc_typeck/src/check/callee.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c74ff8b563358435fa0da50e949159d043efc1a5/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c74ff8b563358435fa0da50e949159d043efc1a5/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcallee.rs?ref=c74ff8b563358435fa0da50e949159d043efc1a5", "patch": "@@ -349,9 +349,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             ty::FnPtr(sig) => (sig, None),\n             ref t => {\n                 let mut unit_variant = None;\n+                let mut removal_span = call_expr.span;\n                 if let ty::Adt(adt_def, ..) = t {\n                     if adt_def.is_enum() {\n                         if let hir::ExprKind::Call(expr, _) = call_expr.kind {\n+                            removal_span =\n+                                expr.span.shrink_to_hi().to(call_expr.span.shrink_to_hi());\n                             unit_variant =\n                                 self.tcx.sess.source_map().span_to_snippet(expr.span).ok();\n                         }\n@@ -379,14 +382,13 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 );\n \n                 if let Some(ref path) = unit_variant {\n-                    err.span_suggestion(\n-                        call_expr.span,\n+                    err.span_suggestion_verbose(\n+                        removal_span,\n                         &format!(\n-                            \"`{}` is a unit variant, you need to write it \\\n-                                 without the parentheses\",\n+                            \"`{}` is a unit variant, you need to write it without the parentheses\",\n                             path\n                         ),\n-                        path.to_string(),\n+                        String::new(),\n                         Applicability::MachineApplicable,\n                     );\n                 }"}, {"sha": "81651c5bf6f40c4842a0d8108dcf5c2f5f453205", "filename": "src/test/ui/empty/empty-struct-unit-expr.stderr", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-expr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-expr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fempty%2Fempty-struct-unit-expr.stderr?ref=c74ff8b563358435fa0da50e949159d043efc1a5", "patch": "@@ -22,8 +22,9 @@ LL |     let e4 = E::Empty4();\n    |\n help: `E::Empty4` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     let e4 = E::Empty4;\n-   |              ~~~~~~~~~\n+LL -     let e4 = E::Empty4();\n+LL +     let e4 = E::Empty4;\n+   | \n \n error[E0618]: expected function, found `empty_struct::XEmpty2`\n   --> $DIR/empty-struct-unit-expr.rs:18:15\n@@ -43,8 +44,9 @@ LL |     let xe4 = XE::XEmpty4();\n    |\n help: `XE::XEmpty4` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     let xe4 = XE::XEmpty4;\n-   |               ~~~~~~~~~~~\n+LL -     let xe4 = XE::XEmpty4();\n+LL +     let xe4 = XE::XEmpty4;\n+   | \n \n error: aborting due to 4 previous errors\n "}, {"sha": "a3a90968df704c38e5ccf3e15636de2d09f3e98a", "filename": "src/test/ui/error-codes/E0618.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0618.stderr?ref=c74ff8b563358435fa0da50e949159d043efc1a5", "patch": "@@ -11,8 +11,9 @@ LL |     X::Entry();\n    |\n help: `X::Entry` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     X::Entry;\n-   |     ~~~~~~~~\n+LL -     X::Entry();\n+LL +     X::Entry;\n+   | \n \n error[E0618]: expected function, found `i32`\n   --> $DIR/E0618.rs:9:5"}, {"sha": "c93ba915efb2f36fd919fff93466f6fdd41ba55c", "filename": "src/test/ui/resolve/privacy-enum-ctor.stderr", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr?ref=c74ff8b563358435fa0da50e949159d043efc1a5", "patch": "@@ -340,8 +340,9 @@ LL |         let _ = Z::Unit();\n    |\n help: `Z::Unit` is a unit variant, you need to write it without the parentheses\n    |\n-LL |         let _ = Z::Unit;\n-   |                 ~~~~~~~\n+LL -         let _ = Z::Unit();\n+LL +         let _ = Z::Unit;\n+   | \n \n error[E0308]: mismatched types\n   --> $DIR/privacy-enum-ctor.rs:43:16\n@@ -374,8 +375,9 @@ LL |     let _: E = m::E::Unit();\n    |\n help: `m::E::Unit` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     let _: E = m::E::Unit;\n-   |                ~~~~~~~~~~\n+LL -     let _: E = m::E::Unit();\n+LL +     let _: E = m::E::Unit;\n+   | \n \n error[E0308]: mismatched types\n   --> $DIR/privacy-enum-ctor.rs:51:16\n@@ -408,8 +410,9 @@ LL |     let _: E = E::Unit();\n    |\n help: `E::Unit` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     let _: E = E::Unit;\n-   |                ~~~~~~~\n+LL -     let _: E = E::Unit();\n+LL +     let _: E = E::Unit;\n+   | \n \n error: aborting due to 23 previous errors\n "}, {"sha": "0cf020861c749558d86e0512d73762943a949d73", "filename": "src/test/ui/type-alias-enum-variants/incorrect-variant-form-through-alias-caught.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fincorrect-variant-form-through-alias-caught.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c74ff8b563358435fa0da50e949159d043efc1a5/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fincorrect-variant-form-through-alias-caught.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-enum-variants%2Fincorrect-variant-form-through-alias-caught.stderr?ref=c74ff8b563358435fa0da50e949159d043efc1a5", "patch": "@@ -29,8 +29,9 @@ LL |     Alias::Unit();\n    |\n help: `Alias::Unit` is a unit variant, you need to write it without the parentheses\n    |\n-LL |     Alias::Unit;\n-   |     ~~~~~~~~~~~\n+LL -     Alias::Unit();\n+LL +     Alias::Unit;\n+   | \n \n error[E0164]: expected tuple struct or tuple variant, found unit variant `Alias::Unit`\n   --> $DIR/incorrect-variant-form-through-alias-caught.rs:17:9"}]}