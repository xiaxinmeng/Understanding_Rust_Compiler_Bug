{"sha": "6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjOWYyMThmM2UxZjJiYjlhNmJjMGNkZjVhMGFhMTZjMjIwZjFlZTg=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2019-10-04T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2019-10-04T14:13:29Z"}, "message": "Disable stack probe when thread sanitizer is enabled\n\nWhen thread sanitizer instrumentation is enabled during compilation of\nstack probe function, the function will be miscompiled and trigger\nsegmentation fault at runtime. Disable stack probes when tsan is\nenabled.", "tree": {"sha": "6caa6735761a034c5ed758f865d48c7af7ec090f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6caa6735761a034c5ed758f865d48c7af7ec090f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8", "html_url": "https://github.com/rust-lang/rust/commit/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e35a2811d8c65e9473176b8656a3201b7e152c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e35a2811d8c65e9473176b8656a3201b7e152c7", "html_url": "https://github.com/rust-lang/rust/commit/9e35a2811d8c65e9473176b8656a3201b7e152c7"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "a0bef5b78156586ee195df67e5d807d698bd5002", "filename": "src/librustc_codegen_llvm/attributes.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8/src%2Flibrustc_codegen_llvm%2Fattributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8/src%2Flibrustc_codegen_llvm%2Fattributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fattributes.rs?ref=6c9f218f3e1f2bb9a6bc0cdf5a0aa16c220f1ee8", "patch": "@@ -96,10 +96,12 @@ pub fn set_probestack(cx: &CodegenCx<'ll, '_>, llfn: &'ll Value) {\n     }\n \n     // Currently stack probes seem somewhat incompatible with the address\n-    // sanitizer. With asan we're already protected from stack overflow anyway\n-    // so we don't really need stack probes regardless.\n-    if let Some(Sanitizer::Address) = cx.sess().opts.debugging_opts.sanitizer {\n-        return\n+    // sanitizer and thread sanitizer. With asan we're already protected from\n+    // stack overflow anyway so we don't really need stack probes regardless.\n+    match cx.sess().opts.debugging_opts.sanitizer {\n+        Some(Sanitizer::Address) |\n+        Some(Sanitizer::Thread) => return,\n+        _ => {},\n     }\n \n     // probestack doesn't play nice either with `-C profile-generate`."}]}