{"sha": "c1fa1102d484b74cb7bc425994fa4246dd690ad3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMxZmExMTAyZDQ4NGI3NGNiN2JjNDI1OTk0ZmE0MjQ2ZGQ2OTBhZDM=", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-03-12T20:52:01Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-05-05T16:38:26Z"}, "message": "ENABLE_METADATA_COLLECTION env-value to disable default metadata collection", "tree": {"sha": "419f1ea2e9e10de3c5b57f558ed4f8bb39ad2d8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/419f1ea2e9e10de3c5b57f558ed4f8bb39ad2d8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c1fa1102d484b74cb7bc425994fa4246dd690ad3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c1fa1102d484b74cb7bc425994fa4246dd690ad3", "html_url": "https://github.com/rust-lang/rust/commit/c1fa1102d484b74cb7bc425994fa4246dd690ad3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c1fa1102d484b74cb7bc425994fa4246dd690ad3/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fc960301bcd4370bfc2238415c7ba3d2d8f9312", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fc960301bcd4370bfc2238415c7ba3d2d8f9312", "html_url": "https://github.com/rust-lang/rust/commit/4fc960301bcd4370bfc2238415c7ba3d2d8f9312"}], "stats": {"total": 26, "additions": 7, "deletions": 19}, "files": [{"sha": "1a74f641554db9143d9e0469a870479c3d860f4a", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c1fa1102d484b74cb7bc425994fa4246dd690ad3/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c1fa1102d484b74cb7bc425994fa4246dd690ad3/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=c1fa1102d484b74cb7bc425994fa4246dd690ad3", "patch": "@@ -1005,7 +1005,11 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         store.register_late_pass(|| box utils::internal_lints::OuterExpnDataPass);\n     }\n     #[cfg(feature = \"metadata-collector-lint\")]\n-    store.register_late_pass(|| box utils::internal_lints::metadata_collector::MetadataCollector::default());\n+    {\n+        if std::env::var(\"ENABLE_METADATA_COLLECTION\").eq(&Ok(\"1\".to_string())) {\n+            store.register_late_pass(|| box utils::internal_lints::metadata_collector::MetadataCollector::default());\n+        }\n+    }\n \n     store.register_late_pass(|| box utils::author::Author);\n     store.register_late_pass(|| box await_holding_invalid::AwaitHolding);"}, {"sha": "07abae31386b2d2ec2656c34a7df1f2c30a5308b", "filename": "clippy_lints/src/utils/internal_lints/metadata_collector.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c1fa1102d484b74cb7bc425994fa4246dd690ad3/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c1fa1102d484b74cb7bc425994fa4246dd690ad3/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs?ref=c1fa1102d484b74cb7bc425994fa4246dd690ad3", "patch": "@@ -148,24 +148,6 @@ struct LintMetadata {\n     applicability: Option<ApplicabilityInfo>,\n }\n \n-// impl Ord for LintMetadata {\n-//     fn cmp(&self, other: &Self) -> Ordering {\n-//         self.id.cmp(&other.id)\n-//     }\n-// }\n-//\n-// impl PartialOrd for LintMetadata {\n-//     fn partial_cmp(&self, other: &Self) -> Option<Ordering> {\n-//         Some(self.cmp(other))\n-//     }\n-// }\n-//\n-// impl PartialEq for LintMetadata {\n-//     fn eq(&self, other: &Self) -> bool {\n-//         self.id == other.id\n-//     }\n-// }\n-\n impl LintMetadata {\n     fn new(id: String, id_span: SerializableSpan, group: String, docs: String) -> Self {\n         Self {"}, {"sha": "6524fd4706ce13f37694cff7407c8515cfeec45c", "filename": "tests/dogfood.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c1fa1102d484b74cb7bc425994fa4246dd690ad3/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c1fa1102d484b74cb7bc425994fa4246dd690ad3/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=c1fa1102d484b74cb7bc425994fa4246dd690ad3", "patch": "@@ -22,12 +22,14 @@ fn dogfood_clippy() {\n         return;\n     }\n     let root_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n+    let enable_metadata_collection = std::env::var(\"ENABLE_METADATA_COLLECTION\").unwrap_or_else(|_| \"0\".to_string());\n \n     let mut command = Command::new(&*CLIPPY_PATH);\n     command\n         .current_dir(root_dir)\n         .env(\"CLIPPY_DOGFOOD\", \"1\")\n         .env(\"CARGO_INCREMENTAL\", \"0\")\n+        .env(\"ENABLE_METADATA_COLLECTION\", &enable_metadata_collection)\n         .arg(\"clippy\")\n         .arg(\"--all-targets\")\n         .arg(\"--all-features\")"}]}