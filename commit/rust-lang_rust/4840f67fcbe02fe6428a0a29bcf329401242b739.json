{"sha": "4840f67fcbe02fe6428a0a29bcf329401242b739", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4NDBmNjdmY2JlMDJmZTY0MjhhMGEyOWJjZjMyOTQwMTI0MmI3Mzk=", "commit": {"author": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2021-09-15T01:29:38Z"}, "committer": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2021-09-15T02:10:05Z"}, "message": "Add chown functions to std::os::unix::fs to change the owner and group of files\n\nThis is a straightforward wrapper that uses the existing helpers for C\nstring handling and errno handling.\n\nHaving this available is convenient for UNIX utility programs written in\nRust, and avoids having to call unsafe functions like `libc::chown`\ndirectly and handle errors manually, in a program that may otherwise be\nentirely safe code.\n\nIn addition, these functions provide a more Rustic interface by\naccepting appropriate traits and using `None` rather than `-1`.", "tree": {"sha": "f088da8a322d63cb07d60032f92387a122f5d6e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f088da8a322d63cb07d60032f92387a122f5d6e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4840f67fcbe02fe6428a0a29bcf329401242b739", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4840f67fcbe02fe6428a0a29bcf329401242b739", "html_url": "https://github.com/rust-lang/rust/commit/4840f67fcbe02fe6428a0a29bcf329401242b739", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4840f67fcbe02fe6428a0a29bcf329401242b739/comments", "author": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3c0f80d6081092faff801542dd82f0e2420152b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3c0f80d6081092faff801542dd82f0e2420152b", "html_url": "https://github.com/rust-lang/rust/commit/c3c0f80d6081092faff801542dd82f0e2420152b"}], "stats": {"total": 87, "additions": 87, "deletions": 0}, "files": [{"sha": "c26f6a182b74f87affb7a3467e8c6576aa2234bb", "filename": "library/std/src/os/unix/fs.rs", "status": "modified", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/4840f67fcbe02fe6428a0a29bcf329401242b739/library%2Fstd%2Fsrc%2Fos%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4840f67fcbe02fe6428a0a29bcf329401242b739/library%2Fstd%2Fsrc%2Fos%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Funix%2Ffs.rs?ref=4840f67fcbe02fe6428a0a29bcf329401242b739", "patch": "@@ -5,6 +5,7 @@\n use super::platform::fs::MetadataExt as _;\n use crate::fs::{self, OpenOptions, Permissions};\n use crate::io;\n+use crate::os::unix::io::{AsFd, AsRawFd};\n use crate::path::Path;\n use crate::sys;\n use crate::sys_common::{AsInner, AsInnerMut, FromInner};\n@@ -924,6 +925,75 @@ impl DirBuilderExt for fs::DirBuilder {\n     }\n }\n \n+/// Change the owner and group of the specified path.\n+///\n+/// Specifying either the uid or gid as `None` will leave it unchanged.\n+///\n+/// Changing the owner typically requires privileges, such as root or a specific capability.\n+/// Changing the group typically requires either being the owner and a member of the group, or\n+/// having privileges.\n+///\n+/// If called on a symbolic link, this will change the owner and group of the link target. To\n+/// change the owner and group of the link itself, see [`lchown`].\n+///\n+/// # Examples\n+///\n+/// ```no_run\n+/// #![feature(unix_chown)]\n+/// use std::os::unix::fs;\n+///\n+/// fn main() -> std::io::Result<()> {\n+///     fs::chown(\"/sandbox\", Some(0), Some(0))?;\n+///     Ok(())\n+/// }\n+/// ```\n+#[unstable(feature = \"unix_chown\", issue = \"none\")]\n+pub fn chown<P: AsRef<Path>>(dir: P, uid: Option<u32>, gid: Option<u32>) -> io::Result<()> {\n+    sys::fs::chown(dir.as_ref(), uid.unwrap_or(u32::MAX), gid.unwrap_or(u32::MAX))\n+}\n+\n+/// Change the owner and group of the file referenced by the specified open file descriptor.\n+///\n+/// For semantics and required privileges, see [`chown`].\n+///\n+/// # Examples\n+///\n+/// ```no_run\n+/// #![feature(unix_chown)]\n+/// use std::os::unix::fs;\n+///\n+/// fn main() -> std::io::Result<()> {\n+///     let f = std::fs::File::open(\"/file\")?;\n+///     fs::fchown(f, Some(0), Some(0))?;\n+///     Ok(())\n+/// }\n+/// ```\n+#[unstable(feature = \"unix_chown\", issue = \"none\")]\n+pub fn fchown<F: AsFd>(fd: F, uid: Option<u32>, gid: Option<u32>) -> io::Result<()> {\n+    sys::fs::fchown(fd.as_fd().as_raw_fd(), uid.unwrap_or(u32::MAX), gid.unwrap_or(u32::MAX))\n+}\n+\n+/// Change the owner and group of the specified path, without dereferencing symbolic links.\n+///\n+/// Identical to [`chown`], except that if called on a symbolic link, this will change the owner\n+/// and group of the link itself rather than the owner and group of the link target.\n+///\n+/// # Examples\n+///\n+/// ```no_run\n+/// #![feature(unix_chown)]\n+/// use std::os::unix::fs;\n+///\n+/// fn main() -> std::io::Result<()> {\n+///     fs::lchown(\"/symlink\", Some(0), Some(0))?;\n+///     Ok(())\n+/// }\n+/// ```\n+#[unstable(feature = \"unix_chown\", issue = \"none\")]\n+pub fn lchown<P: AsRef<Path>>(dir: P, uid: Option<u32>, gid: Option<u32>) -> io::Result<()> {\n+    sys::fs::lchown(dir.as_ref(), uid.unwrap_or(u32::MAX), gid.unwrap_or(u32::MAX))\n+}\n+\n /// Change the root directory of the current process to the specified path.\n ///\n /// This typically requires privileges, such as root or a specific capability."}, {"sha": "a4fff9b2e64731c7f775fcff82075bbf3b2c3784", "filename": "library/std/src/sys/unix/fs.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4840f67fcbe02fe6428a0a29bcf329401242b739/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4840f67fcbe02fe6428a0a29bcf329401242b739/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Ffs.rs?ref=4840f67fcbe02fe6428a0a29bcf329401242b739", "patch": "@@ -1416,6 +1416,23 @@ pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n     Ok(bytes_copied as u64)\n }\n \n+pub fn chown(path: &Path, uid: u32, gid: u32) -> io::Result<()> {\n+    let path = cstr(path)?;\n+    cvt(unsafe { libc::chown(path.as_ptr(), uid as libc::uid_t, gid as libc::gid_t) })?;\n+    Ok(())\n+}\n+\n+pub fn fchown(fd: c_int, uid: u32, gid: u32) -> io::Result<()> {\n+    cvt(unsafe { libc::fchown(fd, uid as libc::uid_t, gid as libc::gid_t) })?;\n+    Ok(())\n+}\n+\n+pub fn lchown(path: &Path, uid: u32, gid: u32) -> io::Result<()> {\n+    let path = cstr(path)?;\n+    cvt(unsafe { libc::lchown(path.as_ptr(), uid as libc::uid_t, gid as libc::gid_t) })?;\n+    Ok(())\n+}\n+\n #[cfg(not(any(target_os = \"fuchsia\", target_os = \"vxworks\")))]\n pub fn chroot(dir: &Path) -> io::Result<()> {\n     let dir = cstr(dir)?;"}]}