{"sha": "5cc51add43bffa21bab4708a53a1920c9671ea8a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjYzUxYWRkNDNiZmZhMjFiYWI0NzA4YTUzYTE5MjBjOTY3MWVhOGE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-09-08T08:07:40Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-09-08T10:26:37Z"}, "message": "Rollup merge of #53973 - tromey:prefer-rust-enabled-lldb, r=alexcrichton\n\nHave rust-lldb look for the rust-enabled lldb\n\nWe're shipping a rust-enabled lldb, but the \"lldb\" executable is not\ninstalled into the \"bin\" directory by rustup.  See the discussion in\nhttps://github.com/rust-lang-nursery/rustup.rs/pull/1492 for\nbackground on this decision.  There, we agreed to have rust-lldb\nprefer the rust-enabled lldb if it is installed.  This patch changes\nrust-lldb to look in the sysroot and use the lldb found there, if any.\n\nSee issue #48168", "tree": {"sha": "70c145d295d375a64305ce0fc555f0dd9be46421", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70c145d295d375a64305ce0fc555f0dd9be46421"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5cc51add43bffa21bab4708a53a1920c9671ea8a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAluTo90ACgkQ/vbIBR0O\nATxnDw/+O7Vko+B6ezNQoz4rSEDkaTrgUjabuxjU1AArH57cjsZuEfyDwKlR7Qnz\n2nQoJ0JCv96Kzr7s23H83SWEsre5gx6hRyUgIMfGCscyzcPFRMqnDjzNr98qHgnj\nF9/W6eX5+gTykK83W1w4MmAuCBubdjsE07mS9WF+y/9bvYx45zNswkyPkiWFHlAB\n3R7lke0lRT/t3VqV+i+ZayZ63VuHaciSVWKm0xML7Ts92JiGVRq5MiELFniYwNjw\n8ZqXZk2PHh+U8QBnDndzVWVlxT/o9aahzk+5tiZebVyjLO42taVdbPF5VSqg9Bxz\ngLpXIxSCQhvJU0Qps9lrMLKcoPZIIT1b4015FMVJD3Z/H9RAyHiP4oy1wmeE+HX5\nQDYOuiFzebHHWEAn5uWM53UeAoqYue0jaSobpr1tPzu0UMmYMHppSJBsAF2Gk8VO\noHF2mgdTMe5anwn6XZkjw4/WWTiHigOmk8BpLNdutd4VrdJz0E8kJG25c4RQMtW9\n2wadAF2Xg5N0x498Wbc8EXQhwAruByDl3vUPwBaVaW/uNfEsYEMIuZu9uvK03RLC\nJ6s2hiHfcz+4at3kJ9FE2tpzMq3c3GojAADmbagtHlwEew39Exk/QJwT5elGeCxZ\nN8L3RAf45KoZsCxbkZB0a/Um9s5CY8FtUA/s+H/ipVffxStm4RM=\n=O958\n-----END PGP SIGNATURE-----", "payload": "tree 70c145d295d375a64305ce0fc555f0dd9be46421\nparent dbc9ec9da8da4deae0d3520c3b7befd124b9cb18\nparent 8aae6ca44a1bea64e2be3f2ce5a4581bb65d43ef\nauthor kennytm <kennytm@gmail.com> 1536394060 +0800\ncommitter kennytm <kennytm@gmail.com> 1536402397 +0800\n\nRollup merge of #53973 - tromey:prefer-rust-enabled-lldb, r=alexcrichton\n\nHave rust-lldb look for the rust-enabled lldb\n\nWe're shipping a rust-enabled lldb, but the \"lldb\" executable is not\ninstalled into the \"bin\" directory by rustup.  See the discussion in\nhttps://github.com/rust-lang-nursery/rustup.rs/pull/1492 for\nbackground on this decision.  There, we agreed to have rust-lldb\nprefer the rust-enabled lldb if it is installed.  This patch changes\nrust-lldb to look in the sysroot and use the lldb found there, if any.\n\nSee issue #48168\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5cc51add43bffa21bab4708a53a1920c9671ea8a", "html_url": "https://github.com/rust-lang/rust/commit/5cc51add43bffa21bab4708a53a1920c9671ea8a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5cc51add43bffa21bab4708a53a1920c9671ea8a/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbc9ec9da8da4deae0d3520c3b7befd124b9cb18", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbc9ec9da8da4deae0d3520c3b7befd124b9cb18", "html_url": "https://github.com/rust-lang/rust/commit/dbc9ec9da8da4deae0d3520c3b7befd124b9cb18"}, {"sha": "8aae6ca44a1bea64e2be3f2ce5a4581bb65d43ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/8aae6ca44a1bea64e2be3f2ce5a4581bb65d43ef", "html_url": "https://github.com/rust-lang/rust/commit/8aae6ca44a1bea64e2be3f2ce5a4581bb65d43ef"}], "stats": {"total": 33, "additions": 21, "deletions": 12}, "files": [{"sha": "2d94704fda7d600f847f918b6bdc871b0f2d996d", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5cc51add43bffa21bab4708a53a1920c9671ea8a/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5cc51add43bffa21bab4708a53a1920c9671ea8a/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=5cc51add43bffa21bab4708a53a1920c9671ea8a", "patch": "@@ -2056,7 +2056,8 @@ impl Step for Lldb {\n         drop(fs::remove_dir_all(&image));\n \n         // Prepare the image directory\n-        let dst = image.join(\"bin\");\n+        let root = image.join(\"lib/rustlib\").join(&*target);\n+        let dst = root.join(\"bin\");\n         t!(fs::create_dir_all(&dst));\n         for program in &[\"lldb\", \"lldb-argdumper\", \"lldb-mi\", \"lldb-server\"] {\n             let exe = bindir.join(exe(program, &target));\n@@ -2065,7 +2066,7 @@ impl Step for Lldb {\n \n         // The libraries.\n         let libdir = builder.llvm_out(target).join(\"lib\");\n-        let dst = image.join(\"lib\");\n+        let dst = root.join(\"lib\");\n         t!(fs::create_dir_all(&dst));\n         for entry in t!(fs::read_dir(&libdir)) {\n             let entry = entry.unwrap();\n@@ -2093,7 +2094,7 @@ impl Step for Lldb {\n             let entry = t!(entry);\n             if let Ok(name) = entry.file_name().into_string() {\n                 if name.starts_with(\"python\") {\n-                    let dst = image.join(libdir_name)\n+                    let dst = root.join(libdir_name)\n                         .join(entry.file_name());\n                     t!(fs::create_dir_all(&dst));\n                     builder.cp_r(&entry.path(), &dst);"}, {"sha": "6ed8210349e1727210e95b6f066ef48ae08778b6", "filename": "src/etc/rust-lldb", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/5cc51add43bffa21bab4708a53a1920c9671ea8a/src%2Fetc%2Frust-lldb", "raw_url": "https://github.com/rust-lang/rust/raw/5cc51add43bffa21bab4708a53a1920c9671ea8a/src%2Fetc%2Frust-lldb", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Frust-lldb?ref=5cc51add43bffa21bab4708a53a1920c9671ea8a", "patch": "@@ -12,27 +12,35 @@\n # Exit if anything fails\n set -e\n \n-LLDB_VERSION=`lldb --version 2>/dev/null | head -1 | cut -d. -f1`\n+# Find out where to look for the pretty printer Python module\n+RUSTC_SYSROOT=`rustc --print sysroot`\n+\n+# Find the host triple so we can find lldb in rustlib.\n+host=`rustc -vV | sed -n -e 's/^host: //p'`\n+\n+lldb=lldb\n+if [ -f \"$RUSTC_SYSROOT/lib/rustlib/$host/bin/lldb\" ]; then\n+    lldb=\"$RUSTC_SYSROOT/lib/rustlib/$host/bin/lldb\"\n+else\n+    LLDB_VERSION=`\"$lldb\" --version 2>/dev/null | head -1 | cut -d. -f1`\n \n-if [ \"$LLDB_VERSION\" = \"lldb-350\" ]\n-then\n-    echo \"***\"\n+    if [ \"$LLDB_VERSION\" = \"lldb-350\" ]\n+    then\n+        echo \"***\"\n \techo \\\n \"WARNING: This version of LLDB has known issues with Rust and cannot \\\n display the contents of local variables!\"\n-    echo \"***\"\n+        echo \"***\"\n+    fi\n fi\n \n-# Find out where to look for the pretty printer Python module\n-RUSTC_SYSROOT=`rustc --print sysroot`\n-\n # Prepare commands that will be loaded before any file on the command line has been loaded\n script_import=\"command script import \\\"$RUSTC_SYSROOT/lib/rustlib/etc/lldb_rust_formatters.py\\\"\"\n category_definition=\"type summary add --no-value --python-function lldb_rust_formatters.print_val -x \\\".*\\\" --category Rust\"\n category_enable=\"type category enable Rust\"\n \n # Call LLDB with the commands added to the argument list\n-exec lldb --one-line-before-file=\"$script_import\" \\\n+exec \"$lldb\" --one-line-before-file=\"$script_import\" \\\n     --one-line-before-file=\"$category_definition\" \\\n     --one-line-before-file=\"$category_enable\" \\\n     \"$@\""}]}