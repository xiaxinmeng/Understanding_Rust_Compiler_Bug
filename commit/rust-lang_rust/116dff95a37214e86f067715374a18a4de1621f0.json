{"sha": "116dff95a37214e86f067715374a18a4de1621f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExNmRmZjk1YTM3MjE0ZTg2ZjA2NzcxNTM3NGExOGE0ZGUxNjIxZjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-16T12:16:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-02-16T12:16:49Z"}, "message": "Auto merge of #68997 - Zoxc:pure-node-id, r=petrochenkov\n\nPanic if NodeIds are used for incremental compilation\n\nr? @michaelwoerister", "tree": {"sha": "37f4efd3582e1a975a23c01fbfdd9f33f6b1705a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/37f4efd3582e1a975a23c01fbfdd9f33f6b1705a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/116dff95a37214e86f067715374a18a4de1621f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/116dff95a37214e86f067715374a18a4de1621f0", "html_url": "https://github.com/rust-lang/rust/commit/116dff95a37214e86f067715374a18a4de1621f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/116dff95a37214e86f067715374a18a4de1621f0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8040bc983669fcc3fe358dfc9772ea2ecde0ae1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/8040bc983669fcc3fe358dfc9772ea2ecde0ae1b", "html_url": "https://github.com/rust-lang/rust/commit/8040bc983669fcc3fe358dfc9772ea2ecde0ae1b"}, {"sha": "8a37811e2c3b89beb135cf96dcb5d887a6262751", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a37811e2c3b89beb135cf96dcb5d887a6262751", "html_url": "https://github.com/rust-lang/rust/commit/8a37811e2c3b89beb135cf96dcb5d887a6262751"}], "stats": {"total": 48, "additions": 3, "deletions": 45}, "files": [{"sha": "9e2db35dc6db8f5395b2e610759a3779a3cee118", "filename": "src/librustc/ich/hcx.rs", "status": "modified", "additions": 2, "deletions": 21, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/116dff95a37214e86f067715374a18a4de1621f0/src%2Flibrustc%2Fich%2Fhcx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116dff95a37214e86f067715374a18a4de1621f0/src%2Flibrustc%2Fich%2Fhcx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fich%2Fhcx.rs?ref=116dff95a37214e86f067715374a18a4de1621f0", "patch": "@@ -220,27 +220,8 @@ impl<'a> ToStableHashKey<StableHashingContext<'a>> for hir::HirId {\n }\n \n impl<'a> HashStable<StableHashingContext<'a>> for ast::NodeId {\n-    fn hash_stable(&self, hcx: &mut StableHashingContext<'a>, hasher: &mut StableHasher) {\n-        match hcx.node_id_hashing_mode {\n-            NodeIdHashingMode::Ignore => {\n-                // Don't do anything.\n-            }\n-            NodeIdHashingMode::HashDefPath => {\n-                hcx.definitions.node_to_hir_id(*self).hash_stable(hcx, hasher);\n-            }\n-        }\n-    }\n-}\n-\n-impl<'a> ToStableHashKey<StableHashingContext<'a>> for ast::NodeId {\n-    type KeyType = (DefPathHash, hir::ItemLocalId);\n-\n-    #[inline]\n-    fn to_stable_hash_key(\n-        &self,\n-        hcx: &StableHashingContext<'a>,\n-    ) -> (DefPathHash, hir::ItemLocalId) {\n-        hcx.definitions.node_to_hir_id(*self).to_stable_hash_key(hcx)\n+    fn hash_stable(&self, _: &mut StableHashingContext<'a>, _: &mut StableHasher) {\n+        panic!(\"Node IDs should not appear in incremental state\");\n     }\n }\n "}, {"sha": "45d95e97a9cf06480eae036686e205f6e871a5c2", "filename": "src/librustc/ty/query/on_disk_cache.rs", "status": "modified", "additions": 1, "deletions": 24, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/116dff95a37214e86f067715374a18a4de1621f0/src%2Flibrustc%2Fty%2Fquery%2Fon_disk_cache.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116dff95a37214e86f067715374a18a4de1621f0/src%2Flibrustc%2Fty%2Fquery%2Fon_disk_cache.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fquery%2Fon_disk_cache.rs?ref=116dff95a37214e86f067715374a18a4de1621f0", "patch": "@@ -22,7 +22,7 @@ use rustc_span::hygiene::{ExpnId, SyntaxContext};\n use rustc_span::source_map::{SourceMap, StableSourceFileId};\n use rustc_span::{BytePos, SourceFile, Span, DUMMY_SP};\n use std::mem;\n-use syntax::ast::{Ident, NodeId};\n+use syntax::ast::Ident;\n \n const TAG_FILE_FOOTER: u128 = 0xC0FFEE_C0FFEE_C0FFEE_C0FFEE_C0FFEE;\n \n@@ -680,16 +680,6 @@ impl<'a, 'tcx> SpecializedDecoder<hir::HirId> for CacheDecoder<'a, 'tcx> {\n     }\n }\n \n-// `NodeId`s are not stable across compilation sessions, so we store them in their\n-// `HirId` representation. This allows use to map them to the current `NodeId`.\n-impl<'a, 'tcx> SpecializedDecoder<NodeId> for CacheDecoder<'a, 'tcx> {\n-    #[inline]\n-    fn specialized_decode(&mut self) -> Result<NodeId, Self::Error> {\n-        let hir_id = hir::HirId::decode(self)?;\n-        Ok(self.tcx().hir().hir_to_node_id(hir_id))\n-    }\n-}\n-\n impl<'a, 'tcx> SpecializedDecoder<Fingerprint> for CacheDecoder<'a, 'tcx> {\n     fn specialized_decode(&mut self) -> Result<Fingerprint, Self::Error> {\n         Fingerprint::decode_opaque(&mut self.opaque)\n@@ -928,19 +918,6 @@ where\n     }\n }\n \n-// `NodeId`s are not stable across compilation sessions, so we store them in their\n-// `HirId` representation. This allows use to map them to the current `NodeId`.\n-impl<'a, 'tcx, E> SpecializedEncoder<NodeId> for CacheEncoder<'a, 'tcx, E>\n-where\n-    E: 'a + TyEncoder,\n-{\n-    #[inline]\n-    fn specialized_encode(&mut self, node_id: &NodeId) -> Result<(), Self::Error> {\n-        let hir_id = self.tcx.hir().node_to_hir_id(*node_id);\n-        hir_id.encode(self)\n-    }\n-}\n-\n impl<'a, 'tcx> SpecializedEncoder<Fingerprint> for CacheEncoder<'a, 'tcx, opaque::Encoder> {\n     fn specialized_encode(&mut self, f: &Fingerprint) -> Result<(), Self::Error> {\n         f.encode_opaque(&mut self.encoder)"}]}