{"sha": "51cc594e106ab5c0452784e543b56d5a0b42cfe7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxY2M1OTRlMTA2YWI1YzA0NTI3ODRlNTQzYjU2ZDVhMGI0MmNmZTc=", "commit": {"author": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-06-06T03:05:30Z"}, "committer": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-08-02T22:57:24Z"}, "message": "First pass at json output", "tree": {"sha": "ff4c26f4f480f5af9f08811c21ab47eee4265adf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff4c26f4f480f5af9f08811c21ab47eee4265adf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51cc594e106ab5c0452784e543b56d5a0b42cfe7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51cc594e106ab5c0452784e543b56d5a0b42cfe7", "html_url": "https://github.com/rust-lang/rust/commit/51cc594e106ab5c0452784e543b56d5a0b42cfe7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51cc594e106ab5c0452784e543b56d5a0b42cfe7/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e50dfe66f3c42bd67c0589b7bbd3307d5e9a1cf7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e50dfe66f3c42bd67c0589b7bbd3307d5e9a1cf7", "html_url": "https://github.com/rust-lang/rust/commit/e50dfe66f3c42bd67c0589b7bbd3307d5e9a1cf7"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "dda4a2d2418d7bc09784b39907b747c08b11f091", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=51cc594e106ab5c0452784e543b56d5a0b42cfe7", "patch": "@@ -1369,6 +1369,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"inject the given attribute in the crate\"),\n     self_profile: bool = (false, parse_bool, [UNTRACKED],\n           \"run the self profiler\"),\n+    profile_json: bool = (false, parse_bool, [UNTRACKED],\n+          \"output a json file with profiler results\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "8bb9f0b92679cb28776d2e2257b633c43f17d7df", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=51cc594e106ab5c0452784e543b56d5a0b42cfe7", "patch": "@@ -839,6 +839,11 @@ impl Session {\n         profiler.print_results(&self.opts);\n     }\n \n+    pub fn save_json_results(&self) {\n+        let profiler = self.self_profiling.borrow();\n+        profiler.save_results();\n+    }\n+\n     pub fn print_perf_stats(&self) {\n         println!(\n             \"Total time spent computing symbol hashes:      {}\","}, {"sha": "73604d2a4371a89617b7c03247f022f1a842bb47", "filename": "src/librustc/util/profiling.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Futil%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc%2Futil%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fprofiling.rs?ref=51cc594e106ab5c0452784e543b56d5a0b42cfe7", "patch": "@@ -10,6 +10,7 @@\n \n use session::config::Options;\n \n+use std::fs;\n use std::io::{self, StdoutLock, Write};\n use std::time::Instant;\n \n@@ -119,6 +120,46 @@ impl CategoryData {\n         p!(\"Linking\", linking);\n         p!(\"Other\", other);\n     }\n+\n+    fn json(&self) -> String {\n+        format!(\"[\n+            {{\n+                \\\"category\\\": \\\"Parsing\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"Expansion\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"TypeChecking\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"BorrowChecking\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"Codegen\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"Linking\\\",\n+                \\\"time_ms\\\": {}\n+            }},\n+            {{\n+                \\\"category\\\": \\\"Other\\\",\n+                \\\"time_ms\\\": {}\n+            }}\n+        ]\",\n+        self.times.parsing / 1_000_000,\n+        self.times.expansion / 1_000_000,\n+        self.times.type_checking / 1_000_000,\n+        self.times.borrow_checking / 1_000_000,\n+        self.times.codegen / 1_000_000,\n+        self.times.linking / 1_000_000,\n+        self.times.other / 1_000_000)\n+    }\n }\n \n pub struct SelfProfiler {\n@@ -235,6 +276,10 @@ impl SelfProfiler {\n         writeln!(lock, \"Incremental: {}\", incremental).unwrap();\n     }\n \n+    pub fn save_results(&self) {\n+        fs::write(\"self_profiler_results.json\", self.data.json()).unwrap();\n+    }\n+\n     pub fn record_activity<'a>(&'a mut self, category: ProfileCategory) -> ProfilerActivity<'a> {\n         self.start_activity(category);\n "}, {"sha": "f178f847aa51e21858f17929d60107f4b756405f", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cc594e106ab5c0452784e543b56d5a0b42cfe7/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=51cc594e106ab5c0452784e543b56d5a0b42cfe7", "patch": "@@ -355,6 +355,10 @@ pub fn compile_input(\n \n     if sess.opts.debugging_opts.self_profile {\n         sess.print_profiler_results();\n+\n+        if sess.opts.debugging_opts.profile_json {\n+            sess.save_json_results();\n+        }\n     }\n \n     controller_entry_point!("}]}