{"sha": "c7dc868ed7b2899f585fa64ede938e665f965067", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZGM4NjhlZDdiMjg5OWY1ODVmYTY0ZWRlOTM4ZTY2NWY5NjUwNjc=", "commit": {"author": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-11-20T04:26:00Z"}, "committer": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-11-20T04:26:00Z"}, "message": "Fix json output in the self-profiler\n\nFix missing ',' array element separators and convert NaN's to 0.", "tree": {"sha": "7fcc0b9abae534c0e4998188b529608e78475787", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fcc0b9abae534c0e4998188b529608e78475787"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7dc868ed7b2899f585fa64ede938e665f965067", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7dc868ed7b2899f585fa64ede938e665f965067", "html_url": "https://github.com/rust-lang/rust/commit/c7dc868ed7b2899f585fa64ede938e665f965067", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7dc868ed7b2899f585fa64ede938e665f965067/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31fa30145e15d57a17de8029e8950c60d28d6c8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/31fa30145e15d57a17de8029e8950c60d28d6c8f", "html_url": "https://github.com/rust-lang/rust/commit/31fa30145e15d57a17de8029e8950c60d28d6c8f"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "dfd3f2ee184cebd87cb0490e06783bed66178cec", "filename": "src/librustc/util/profiling.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c7dc868ed7b2899f585fa64ede938e665f965067/src%2Flibrustc%2Futil%2Fprofiling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7dc868ed7b2899f585fa64ede938e665f965067/src%2Flibrustc%2Futil%2Fprofiling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Futil%2Fprofiling.rs?ref=c7dc868ed7b2899f585fa64ede938e665f965067", "patch": "@@ -93,16 +93,27 @@ macro_rules! define_categories {\n                 $(\n                     let (hits, total) = self.query_counts.$name;\n \n+                    //normalize hits to 0%\n+                    let hit_percent =\n+                        if total > 0 {\n+                            ((hits as f32) / (total as f32)) * 100.0\n+                        } else {\n+                            0.0\n+                        };\n+\n                     json.push_str(&format!(\n                         \"{{ \\\"category\\\": {}, \\\"time_ms\\\": {},\n-                            \\\"query_count\\\": {}, \\\"query_hits\\\": {} }}\",\n+                            \\\"query_count\\\": {}, \\\"query_hits\\\": {} }},\",\n                         stringify!($name),\n                         self.times.$name / 1_000_000,\n                         total,\n-                        format!(\"{:.2}\", (((hits as f32) / (total as f32)) * 100.0))\n+                        format!(\"{:.2}\", hit_percent)\n                     ));\n                 )*\n \n+                //remove the trailing ',' character\n+                json.pop();\n+\n                 json.push(']');\n \n                 json"}]}