{"sha": "ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiOWNhZTFiYTE5MmFmY2MzNWU4YmQ2YTVmZGRjZDE0NDVkMDVkYTc=", "commit": {"author": {"name": "Jimmy Brush", "email": "code@jimmah.com", "date": "2018-02-14T03:09:02Z"}, "committer": {"name": "Jimmy Brush", "email": "code@jimmah.com", "date": "2018-02-14T03:10:27Z"}, "message": "only pass -no-pie if linker_is_gnu", "tree": {"sha": "d96eb368884a57944ffa3dd319e312785473c6f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d96eb368884a57944ffa3dd319e312785473c6f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA1EtiBaDzGKsVzCxjAopB5kfVmQFAlqDqKMACgkQjAopB5kf\nVmTFUxAAnPscR2BbxiLo5WHj6ojVUZQRdt5MXhT9sRxEkV5Rnz0jFHrU1gil5jOq\nJZ5emZCQl2Dhf0ISyCHAT26C7I9ztoGukFqMB1TIyRSa0iAM+iAw2s2AkGz0JUau\n7MMU6BgoYw+wqskLGFqqA2OBeYyaaNZSJoj5ok0okWuhgaQwWSwSL6evLtgQCvax\nm4vG3ycnVJbiZ5OvBAxUHj9s3Gc+edGNhzooKkpl8QFBbhRiAfuU/UnznN/rA0H3\nW1MyaXyAasykx3zCedLJn8nwk3SdN+5gsWUSxsL2VWJ3IR3x++G1Y2L32IfM5DZi\n2s2wEg4TIAjgk8uwQqz9H00hfiVilzAAt0Keze+45JteKBHN6qgDeix+VxYTHupj\nTO1U+h6RkSd6mLS5zTEEFWn2UNOcLQq+UswVpmN49PG/nEyNhUlG2PbMoWXGZcr0\nrtl18iczzXwHiEFz+7wIinIWmFiiIopcvNbxcNfJzAxrObkPbktlvEx5kouwiG+V\nGMacMTe3Bvtk7tiIhzfUZmWx517CXW95Qo9C7OV7VLK7VaxnYlC5eMgJS2a/Gzv7\n2BXbwQ2sSkcFcEvZe9dhtjYF+wd7VABBXsTx4ePrMQZlrmXCGlQaG46OWoTEcb8/\nsNvkzidV9YypHH/QpkqcSq9IRo9ZVZWsqLM/Be2xqWO7ctx//LQ=\n=wMLn\n-----END PGP SIGNATURE-----", "payload": "tree d96eb368884a57944ffa3dd319e312785473c6f1\nparent c8def9222be5079585e15b2902039d371b7527ce\nauthor Jimmy Brush <code@jimmah.com> 1518577742 -0500\ncommitter Jimmy Brush <code@jimmah.com> 1518577827 -0500\n\nonly pass -no-pie if linker_is_gnu\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7", "html_url": "https://github.com/rust-lang/rust/commit/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7/comments", "author": {"login": "canarysnort01", "id": 24806352, "node_id": "MDQ6VXNlcjI0ODA2MzUy", "avatar_url": "https://avatars.githubusercontent.com/u/24806352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/canarysnort01", "html_url": "https://github.com/canarysnort01", "followers_url": "https://api.github.com/users/canarysnort01/followers", "following_url": "https://api.github.com/users/canarysnort01/following{/other_user}", "gists_url": "https://api.github.com/users/canarysnort01/gists{/gist_id}", "starred_url": "https://api.github.com/users/canarysnort01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/canarysnort01/subscriptions", "organizations_url": "https://api.github.com/users/canarysnort01/orgs", "repos_url": "https://api.github.com/users/canarysnort01/repos", "events_url": "https://api.github.com/users/canarysnort01/events{/privacy}", "received_events_url": "https://api.github.com/users/canarysnort01/received_events", "type": "User", "site_admin": false}, "committer": {"login": "canarysnort01", "id": 24806352, "node_id": "MDQ6VXNlcjI0ODA2MzUy", "avatar_url": "https://avatars.githubusercontent.com/u/24806352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/canarysnort01", "html_url": "https://github.com/canarysnort01", "followers_url": "https://api.github.com/users/canarysnort01/followers", "following_url": "https://api.github.com/users/canarysnort01/following{/other_user}", "gists_url": "https://api.github.com/users/canarysnort01/gists{/gist_id}", "starred_url": "https://api.github.com/users/canarysnort01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/canarysnort01/subscriptions", "organizations_url": "https://api.github.com/users/canarysnort01/orgs", "repos_url": "https://api.github.com/users/canarysnort01/repos", "events_url": "https://api.github.com/users/canarysnort01/events{/privacy}", "received_events_url": "https://api.github.com/users/canarysnort01/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8def9222be5079585e15b2902039d371b7527ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8def9222be5079585e15b2902039d371b7527ce", "html_url": "https://github.com/rust-lang/rust/commit/c8def9222be5079585e15b2902039d371b7527ce"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "8be4dc48d51222bfe023a9b79d1639a57ca9f97e", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=ab9cae1ba192afcc35e8bd6a5fddcd1445d05da7", "patch": "@@ -669,7 +669,8 @@ fn link_natively(sess: &Session,\n         // if the linker doesn't support -no-pie then it should not default to\n         // linking executables as pie. Different versions of gcc seem to use\n         // different quotes in the error message so don't check for them.\n-        if (out.contains(\"unrecognized command line option\") ||\n+        if sess.target.target.options.linker_is_gnu &&\n+           (out.contains(\"unrecognized command line option\") ||\n             out.contains(\"unknown argument\")) &&\n            out.contains(\"-no-pie\") &&\n            cmd.get_args().iter().any(|e| e.to_string_lossy() == \"-no-pie\") {\n@@ -936,7 +937,12 @@ fn link_args(cmd: &mut Linker,\n         if position_independent_executable {\n             cmd.position_independent_executable();\n         } else {\n-            cmd.no_position_independent_executable();\n+            // recent versions of gcc can be configured to generate position\n+            // independent executables by default. We have to pass -no-pie to\n+            // explicitly turn that off.\n+            if sess.target.target.options.linker_is_gnu {\n+                cmd.no_position_independent_executable();\n+            }\n         }\n     }\n "}]}