{"sha": "a11c032f36658667bb08382cc409455b0a1d0a61", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExMWMwMzJmMzY2NTg2NjdiYjA4MzgyY2M0MDk0NTViMGExZDBhNjE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-20T09:16:21Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-04-20T09:16:21Z"}, "message": "core::rt: Fix a broken uvio test", "tree": {"sha": "7d0fdcc1e1e69231a0db3c08425f64a97e8e2183", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d0fdcc1e1e69231a0db3c08425f64a97e8e2183"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a11c032f36658667bb08382cc409455b0a1d0a61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a11c032f36658667bb08382cc409455b0a1d0a61", "html_url": "https://github.com/rust-lang/rust/commit/a11c032f36658667bb08382cc409455b0a1d0a61", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a11c032f36658667bb08382cc409455b0a1d0a61/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e564fc7f6b02e917407b3aa6235fc0727afdaf2c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e564fc7f6b02e917407b3aa6235fc0727afdaf2c", "html_url": "https://github.com/rust-lang/rust/commit/e564fc7f6b02e917407b3aa6235fc0727afdaf2c"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "2582ddf310510a5e64b9ef4c346dca1bfbe94fd4", "filename": "src/libcore/rt/uvio.rs", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/a11c032f36658667bb08382cc409455b0a1d0a61/src%2Flibcore%2Frt%2Fuvio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a11c032f36658667bb08382cc409455b0a1d0a61/src%2Flibcore%2Frt%2Fuvio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Frt%2Fuvio.rs?ref=a11c032f36658667bb08382cc409455b0a1d0a61", "patch": "@@ -434,22 +434,39 @@ fn test_read_and_block() {\n     }\n }\n \n-#[test] #[ignore(reason = \"needs server\")]\n+#[test]\n fn test_read_read_read() {\n     do run_in_newsched_task {\n         let addr = Ipv4(127, 0, 0, 1, next_test_port());\n+        static MAX: uint = 5000000;\n+        \n+        do spawn_immediately {\n+            unsafe {\n+                let io = local_sched::unsafe_borrow_io();\n+                let mut listener = io.bind(addr).unwrap();\n+                let mut stream = listener.listen().unwrap();\n+                let mut buf = [0, .. 2048];\n+                let mut total_bytes_written = 0;\n+                while total_bytes_written < MAX {\n+                    stream.write(buf);\n+                    total_bytes_written += buf.len();\n+                }\n+                stream.close();\n+                listener.close();\n+            }\n+        }\n \n         do spawn_immediately {\n             let io = unsafe { local_sched::unsafe_borrow_io() };\n             let mut stream = io.connect(addr).unwrap();\n             let mut buf = [0, .. 2048];\n             let mut total_bytes_read = 0;\n-            while total_bytes_read < 500000000 {\n+            while total_bytes_read < MAX {\n                 let nread = stream.read(buf).unwrap();\n                 rtdebug!(\"read %u bytes\", nread as uint);\n                 total_bytes_read += nread;\n             }\n-            rtdebug_!(\"read %u bytes total\", total_bytes_read as uint);\n+            rtdebug!(\"read %u bytes total\", total_bytes_read as uint);\n             stream.close();\n         }\n     }"}]}