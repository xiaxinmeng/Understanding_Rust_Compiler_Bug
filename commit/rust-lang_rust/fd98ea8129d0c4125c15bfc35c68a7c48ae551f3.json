{"sha": "fd98ea8129d0c4125c15bfc35c68a7c48ae551f3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkOThlYTgxMjlkMGM0MTI1YzE1YmZjMzVjNjhhN2M0OGFlNTUxZjM=", "commit": {"author": {"name": "Matthijs Hofstra", "email": "thiezz@gmail.com", "date": "2013-02-08T23:45:00Z"}, "committer": {"name": "Matthijs 'Thiez' Hofstra", "email": "thiezz@gmail.com", "date": "2013-02-08T23:57:39Z"}, "message": "Fix for issue 2174\n\nThe function that formats and prints the squigly line that hilights\nerrors counted tabs as spaces, which resulted in incorrect error\nmessages when tabs were used for indentation. This change compares\nthe highlight line with the previous line and inserts a tab instead\nof a space whenever such a tab exists on the previous line. Note\nthat error messages will still highlight incorrectly when the\nprevious line include characters that require more than one utf8\ncode point, as mentioned in issue 3260.", "tree": {"sha": "3c0923246a95731242b7c3352278c221190df743", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c0923246a95731242b7c3352278c221190df743"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3", "html_url": "https://github.com/rust-lang/rust/commit/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3/comments", "author": {"login": "Thiez", "id": 204550, "node_id": "MDQ6VXNlcjIwNDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thiez", "html_url": "https://github.com/Thiez", "followers_url": "https://api.github.com/users/Thiez/followers", "following_url": "https://api.github.com/users/Thiez/following{/other_user}", "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions", "organizations_url": "https://api.github.com/users/Thiez/orgs", "repos_url": "https://api.github.com/users/Thiez/repos", "events_url": "https://api.github.com/users/Thiez/events{/privacy}", "received_events_url": "https://api.github.com/users/Thiez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Thiez", "id": 204550, "node_id": "MDQ6VXNlcjIwNDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/204550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thiez", "html_url": "https://github.com/Thiez", "followers_url": "https://api.github.com/users/Thiez/followers", "following_url": "https://api.github.com/users/Thiez/following{/other_user}", "gists_url": "https://api.github.com/users/Thiez/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thiez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thiez/subscriptions", "organizations_url": "https://api.github.com/users/Thiez/orgs", "repos_url": "https://api.github.com/users/Thiez/repos", "events_url": "https://api.github.com/users/Thiez/events{/privacy}", "received_events_url": "https://api.github.com/users/Thiez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c2b4edff5009ff4d2330723d9acbc85af4b12ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c2b4edff5009ff4d2330723d9acbc85af4b12ab", "html_url": "https://github.com/rust-lang/rust/commit/0c2b4edff5009ff4d2330723d9acbc85af4b12ab"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "1276d5e0ca2d05fa70d3e1771e8712192ee453c3", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd98ea8129d0c4125c15bfc35c68a7c48ae551f3/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=fd98ea8129d0c4125c15bfc35c68a7c48ae551f3", "patch": "@@ -263,14 +263,26 @@ fn highlight_lines(cm: @codemap::CodeMap,\n         // indent past |name:## | and the 0-offset column location\n         let mut left = str::len(fm.name) + digits + lo.col.to_uint() + 3u;\n         let mut s = ~\"\";\n-        while left > 0u { str::push_char(&mut s, ' '); left -= 1u; }\n-\n+        // Skip is the number of characters we need to skip because they are\n+        // part of the 'filename:line ' part of the previous line.\n+        let skip = str::len(fm.name) + digits + 3u;\n+        for skip.times() {\n+            s += ~\" \";\n+        }\n+        let orig = fm.get_line(lines.lines[0] as int);\n+        for uint::range(0u,left-skip) |pos| {\n+            let curChar = (orig[pos] as char);\n+            s += match curChar { // Whenever a tab occurs on the previous\n+                '\\t' => \"\\t\",    // line, we insert one on the error-point-\n+                _ => \" \"         // -squigly-line as well (instead of a\n+            };                   // space). This way the squigly-line will\n+        }                        // usually appear in the correct position.\n         s += ~\"^\";\n         let hi = cm.lookup_char_pos(sp.hi);\n         if hi.col != lo.col {\n             // the ^ already takes up one space\n-            let mut width = hi.col.to_uint() - lo.col.to_uint() - 1u;\n-            while width > 0u { str::push_char(&mut s, '~'); width -= 1u; }\n+            let num_squiglies = hi.col.to_uint()-lo.col.to_uint()-1u;\n+            for num_squiglies.times() { s += ~\"~\"; }\n         }\n         io::stderr().write_str(s + ~\"\\n\");\n     }"}]}