{"sha": "9546517a842f31be2258a70ae940dd9071e2913a", "node_id": "C_kwDOAAsO6NoAKDk1NDY1MTdhODQyZjMxYmUyMjU4YTcwYWU5NDBkZDkwNzFlMjkxM2E", "commit": {"author": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-03-16T18:48:23Z"}, "committer": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-03-16T19:22:39Z"}, "message": "Add external macro test + Now it works", "tree": {"sha": "62be7856baf4264621c443111dfb0d31f2a89c16", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/62be7856baf4264621c443111dfb0d31f2a89c16"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9546517a842f31be2258a70ae940dd9071e2913a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEM3aofraJSaf7CtgpTTgXC1ovwzQFAmQTbJ0ACgkQTTgXC1ov\nwzTisw//az6JVi/6X+sriRqQ8CxYg9lK/EmhPcAKOS2oiUZlqVHoL4YNNZPMOTn9\n2pzC5en5K1SQWTcgxPbOeobjs5iWj+TzjfSkIWspu+4AXtMqUIT12TyzLCG9ec1q\nvgG0WHhAJtW2wWp2X3C7h8kW/dNhGRl3+r966krQhCg0lSsGLp31njnsctQeXxaF\nws59dWJyxCR0OAiFgDgH/7kbkH5wKwUQbeybJiYrEE3dAByCApuk33kQ/sW3qnrx\n+LMerqGW0pw/g8ez+dZ21Drci7phSQr+eucp304iaHMTUsPiEfeLUYO17gJ07axD\nge1PVCamG3WAIjBXOEKDbFEdssZCXyl7nrlVl+UHT0x0l2tz/3pfR+3GKjbXjjZW\n0WnmMDfMJo0hL5ZRweTdhp3rCMhwiwlrLqj3ZKqAMcRNZ6eunjc7g5t5LTHz/r0S\ng8LylHQIAHoUI2AyQuO8h9t26KvgGjXS3sjuq7hz4h2M0tHFmzMS7mMhMTSXj+LK\nGWFVIE9OgCek8n8hI3whXW9C/LOMznlGBSbrODrif3PixqFSdKQV1G5lzGXn0PGG\ntX0OTpitKAqSEtCkCpmoV2M/5FxX4gfRB6d62LjQvnf2l186YKcrDE0tVr9LWXW4\nszGtMJ8my+mf8k610o54k4vd2jUCyvFOa8TX3PPt615Fc7xOXJc=\n=IHDP\n-----END PGP SIGNATURE-----", "payload": "tree 62be7856baf4264621c443111dfb0d31f2a89c16\nparent e2ba75d69da533775f8db90a3348521458cf4fed\nauthor blyxyas <blyxyas@gmail.com> 1678992503 +0100\ncommitter blyxyas <blyxyas@gmail.com> 1678994559 +0100\n\nAdd external macro test + Now it works\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9546517a842f31be2258a70ae940dd9071e2913a", "html_url": "https://github.com/rust-lang/rust/commit/9546517a842f31be2258a70ae940dd9071e2913a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9546517a842f31be2258a70ae940dd9071e2913a/comments", "author": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2ba75d69da533775f8db90a3348521458cf4fed", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2ba75d69da533775f8db90a3348521458cf4fed", "html_url": "https://github.com/rust-lang/rust/commit/e2ba75d69da533775f8db90a3348521458cf4fed"}], "stats": {"total": 69, "additions": 35, "deletions": 34}, "files": [{"sha": "50298898d034612cdbec1b87af55fb579a249c31", "filename": "clippy_lints/src/swap.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9546517a842f31be2258a70ae940dd9071e2913a/clippy_lints%2Fsrc%2Fswap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9546517a842f31be2258a70ae940dd9071e2913a/clippy_lints%2Fsrc%2Fswap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fswap.rs?ref=9546517a842f31be2258a70ae940dd9071e2913a", "patch": "@@ -76,9 +76,7 @@ declare_lint_pass!(Swap => [MANUAL_SWAP, ALMOST_SWAPPED]);\n impl<'tcx> LateLintPass<'tcx> for Swap {\n     fn check_block(&mut self, cx: &LateContext<'tcx>, block: &'tcx Block<'_>) {\n         check_manual_swap(cx, block);\n-        if !in_external_macro(cx.sess(), block.span) {\n-            check_suspicious_swap(cx, block);\n-        }\n+        check_suspicious_swap(cx, block);\n         check_xor_swap(cx, block);\n     }\n }\n@@ -191,6 +189,7 @@ fn check_suspicious_swap(cx: &LateContext<'_>, block: &Block<'_>) {\n         if let Some((lhs0, rhs0)) = parse(first)\n             && let Some((lhs1, rhs1)) = parse(second)\n             && first.span.eq_ctxt(second.span)\n+\t\t\t&& !in_external_macro(&cx.sess(), first.span)\n             && is_same(cx, lhs0, rhs1)\n             && is_same(cx, lhs1, rhs0)\n \t\t\t&& !is_same(cx, lhs1, rhs1) // Ignore a = b; a = a (#10421)"}, {"sha": "a9bb61451dca68d086e839197b360174da39c4b8", "filename": "tests/ui/auxiliary/macro_rules.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauxiliary%2Fmacro_rules.rs?ref=9546517a842f31be2258a70ae940dd9071e2913a", "patch": "@@ -27,3 +27,13 @@ macro_rules! mut_mut {\n         let mut_mut_ty: &mut &mut u32 = &mut &mut 1u32;\n     };\n }\n+\n+#[macro_export]\n+macro_rules! issue_10421 {\n+    () => {\n+        let mut a = 1;\n+        let mut b = 2;\n+        a = b;\n+        b = a;\n+    };\n+}"}, {"sha": "9703674d1a4ed35ff2a28b356ac1a517b8182e4a", "filename": "tests/ui/swap.fixed", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fswap.fixed?ref=9546517a842f31be2258a70ae940dd9071e2913a", "patch": "@@ -1,4 +1,5 @@\n // run-rustfix\n+// aux-build: macro_rules.rs\n \n #![warn(clippy::all)]\n #![allow(\n@@ -188,13 +189,8 @@ const fn issue_9864(mut u: u32) -> u32 {\n     u + v\n }\n \n-macro_rules! issue_10421 {\n-    () => {\n-        let a = 1;\n-        let b = a;\n-        let b = b;\n-    };\n-}\n+#[macro_use]\n+extern crate macro_rules;\n \n const fn issue_10421(x: u32) -> u32 {\n     issue_10421!();"}, {"sha": "a0228065e46b5984bae752a93fe07b35a420b7bc", "filename": "tests/ui/swap.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fswap.rs?ref=9546517a842f31be2258a70ae940dd9071e2913a", "patch": "@@ -1,4 +1,5 @@\n // run-rustfix\n+// aux-build: macro_rules.rs\n \n #![warn(clippy::all)]\n #![allow(\n@@ -217,13 +218,8 @@ const fn issue_9864(mut u: u32) -> u32 {\n     u + v\n }\n \n-macro_rules! issue_10421 {\n-    () => {\n-        let a = 1;\n-        let b = a;\n-        let b = b;\n-    };\n-}\n+#[macro_use]\n+extern crate macro_rules;\n \n const fn issue_10421(x: u32) -> u32 {\n     issue_10421!();"}, {"sha": "0c246268499d9cb6f5f4a0321cffbab1a4e7a1d1", "filename": "tests/ui/swap.stderr", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9546517a842f31be2258a70ae940dd9071e2913a/tests%2Fui%2Fswap.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fswap.stderr?ref=9546517a842f31be2258a70ae940dd9071e2913a", "patch": "@@ -1,5 +1,5 @@\n error: this looks like you are swapping `bar.a` and `bar.b` manually\n-  --> $DIR/swap.rs:26:5\n+  --> $DIR/swap.rs:27:5\n    |\n LL | /     let temp = bar.a;\n LL | |     bar.a = bar.b;\n@@ -10,55 +10,55 @@ LL | |     bar.b = temp;\n    = note: `-D clippy::manual-swap` implied by `-D warnings`\n \n error: this looks like you are swapping elements of `foo` manually\n-  --> $DIR/swap.rs:38:5\n+  --> $DIR/swap.rs:39:5\n    |\n LL | /     let temp = foo[0];\n LL | |     foo[0] = foo[1];\n LL | |     foo[1] = temp;\n    | |__________________^ help: try: `foo.swap(0, 1);`\n \n error: this looks like you are swapping elements of `foo` manually\n-  --> $DIR/swap.rs:47:5\n+  --> $DIR/swap.rs:48:5\n    |\n LL | /     let temp = foo[0];\n LL | |     foo[0] = foo[1];\n LL | |     foo[1] = temp;\n    | |__________________^ help: try: `foo.swap(0, 1);`\n \n error: this looks like you are swapping elements of `foo` manually\n-  --> $DIR/swap.rs:66:5\n+  --> $DIR/swap.rs:67:5\n    |\n LL | /     let temp = foo[0];\n LL | |     foo[0] = foo[1];\n LL | |     foo[1] = temp;\n    | |__________________^ help: try: `foo.swap(0, 1);`\n \n error: this looks like you are swapping `a` and `b` manually\n-  --> $DIR/swap.rs:77:5\n+  --> $DIR/swap.rs:78:5\n    |\n LL | /     a ^= b;\n LL | |     b ^= a;\n LL | |     a ^= b;\n    | |___________^ help: try: `std::mem::swap(&mut a, &mut b);`\n \n error: this looks like you are swapping `bar.a` and `bar.b` manually\n-  --> $DIR/swap.rs:85:5\n+  --> $DIR/swap.rs:86:5\n    |\n LL | /     bar.a ^= bar.b;\n LL | |     bar.b ^= bar.a;\n LL | |     bar.a ^= bar.b;\n    | |___________________^ help: try: `std::mem::swap(&mut bar.a, &mut bar.b);`\n \n error: this looks like you are swapping elements of `foo` manually\n-  --> $DIR/swap.rs:93:5\n+  --> $DIR/swap.rs:94:5\n    |\n LL | /     foo[0] ^= foo[1];\n LL | |     foo[1] ^= foo[0];\n LL | |     foo[0] ^= foo[1];\n    | |_____________________^ help: try: `foo.swap(0, 1);`\n \n error: this looks like you are swapping `foo[0][1]` and `bar[1][0]` manually\n-  --> $DIR/swap.rs:122:5\n+  --> $DIR/swap.rs:123:5\n    |\n LL | /     let temp = foo[0][1];\n LL | |     foo[0][1] = bar[1][0];\n@@ -68,7 +68,7 @@ LL | |     bar[1][0] = temp;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are swapping `a` and `b` manually\n-  --> $DIR/swap.rs:136:7\n+  --> $DIR/swap.rs:137:7\n    |\n LL |       ; let t = a;\n    |  _______^\n@@ -79,7 +79,7 @@ LL | |     b = t;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are swapping `c.0` and `a` manually\n-  --> $DIR/swap.rs:145:7\n+  --> $DIR/swap.rs:146:7\n    |\n LL |       ; let t = c.0;\n    |  _______^\n@@ -90,7 +90,7 @@ LL | |     a = t;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are swapping `b` and `a` manually\n-  --> $DIR/swap.rs:171:5\n+  --> $DIR/swap.rs:172:5\n    |\n LL | /     let t = b;\n LL | |     b = a;\n@@ -100,7 +100,7 @@ LL | |     a = t;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are trying to swap `a` and `b`\n-  --> $DIR/swap.rs:133:5\n+  --> $DIR/swap.rs:134:5\n    |\n LL | /     a = b;\n LL | |     b = a;\n@@ -110,7 +110,7 @@ LL | |     b = a;\n    = note: `-D clippy::almost-swapped` implied by `-D warnings`\n \n error: this looks like you are trying to swap `c.0` and `a`\n-  --> $DIR/swap.rs:142:5\n+  --> $DIR/swap.rs:143:5\n    |\n LL | /     c.0 = a;\n LL | |     a = c.0;\n@@ -119,7 +119,7 @@ LL | |     a = c.0;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are trying to swap `a` and `b`\n-  --> $DIR/swap.rs:149:5\n+  --> $DIR/swap.rs:150:5\n    |\n LL | /     let a = b;\n LL | |     let b = a;\n@@ -128,7 +128,7 @@ LL | |     let b = a;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are trying to swap `d` and `c`\n-  --> $DIR/swap.rs:154:5\n+  --> $DIR/swap.rs:155:5\n    |\n LL | /     d = c;\n LL | |     c = d;\n@@ -137,7 +137,7 @@ LL | |     c = d;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are trying to swap `a` and `b`\n-  --> $DIR/swap.rs:158:5\n+  --> $DIR/swap.rs:159:5\n    |\n LL | /     let a = b;\n LL | |     b = a;\n@@ -146,7 +146,7 @@ LL | |     b = a;\n    = note: or maybe you should use `std::mem::replace`?\n \n error: this looks like you are swapping `s.0.x` and `s.0.y` manually\n-  --> $DIR/swap.rs:206:5\n+  --> $DIR/swap.rs:207:5\n    |\n LL | /     let t = s.0.x;\n LL | |     s.0.x = s.0.y;"}]}