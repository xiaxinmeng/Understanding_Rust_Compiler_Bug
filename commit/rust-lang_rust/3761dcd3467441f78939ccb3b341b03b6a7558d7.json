{"sha": "3761dcd3467441f78939ccb3b341b03b6a7558d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3NjFkY2QzNDY3NDQxZjc4OTM5Y2NiM2IzNDFiMDNiNmE3NTU4ZDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-28T20:26:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-01-28T20:26:24Z"}, "message": "Auto merge of #68606 - jonas-schievink:normalize-fastpath, r=Zoxc\n\nAdd an early-exit to `QueryNormalizer::fold_ty`\n\nPulled out from https://github.com/rust-lang/rust/pull/68524, this results in a ~60-70% reduction in compile time for the await-call-tree benchmarks. This should unblock https://github.com/rust-lang/rust/issues/67982 as well.\n\nr? @Zoxc", "tree": {"sha": "9db360c58dde696d24eeb1f733cd1ec458743850", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9db360c58dde696d24eeb1f733cd1ec458743850"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3761dcd3467441f78939ccb3b341b03b6a7558d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3761dcd3467441f78939ccb3b341b03b6a7558d7", "html_url": "https://github.com/rust-lang/rust/commit/3761dcd3467441f78939ccb3b341b03b6a7558d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3761dcd3467441f78939ccb3b341b03b6a7558d7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac2f3fa41ac5ae8425b959f955bb7433b7c57aea", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac2f3fa41ac5ae8425b959f955bb7433b7c57aea", "html_url": "https://github.com/rust-lang/rust/commit/ac2f3fa41ac5ae8425b959f955bb7433b7c57aea"}, {"sha": "474d0e33717062696be4c9799ce9822bf7b56fc2", "url": "https://api.github.com/repos/rust-lang/rust/commits/474d0e33717062696be4c9799ce9822bf7b56fc2", "html_url": "https://github.com/rust-lang/rust/commit/474d0e33717062696be4c9799ce9822bf7b56fc2"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "20d7b5563774ef77baed2c3b9ba39a09244b6827", "filename": "src/librustc/traits/query/normalize.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3761dcd3467441f78939ccb3b341b03b6a7558d7/src%2Flibrustc%2Ftraits%2Fquery%2Fnormalize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3761dcd3467441f78939ccb3b341b03b6a7558d7/src%2Flibrustc%2Ftraits%2Fquery%2Fnormalize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fquery%2Fnormalize.rs?ref=3761dcd3467441f78939ccb3b341b03b6a7558d7", "patch": "@@ -81,6 +81,10 @@ impl<'cx, 'tcx> TypeFolder<'tcx> for QueryNormalizer<'cx, 'tcx> {\n     }\n \n     fn fold_ty(&mut self, ty: Ty<'tcx>) -> Ty<'tcx> {\n+        if !ty.has_projections() {\n+            return ty;\n+        }\n+\n         let ty = ty.super_fold_with(self);\n         match ty.kind {\n             ty::Opaque(def_id, substs) if !substs.has_escaping_bound_vars() => {"}]}