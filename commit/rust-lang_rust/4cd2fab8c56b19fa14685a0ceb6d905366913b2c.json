{"sha": "4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjZDJmYWI4YzU2YjE5ZmExNDY4NWEwY2ViNmQ5MDUzNjY5MTNiMmM=", "commit": {"author": {"name": "Smitty", "email": "me@smitop.com", "date": "2021-06-20T17:48:37Z"}, "committer": {"name": "Smitty", "email": "me@smitop.com", "date": "2021-06-20T17:48:37Z"}, "message": "Specify if struct/enum in arg mismatch error", "tree": {"sha": "317fdd6728bd396fda1f8e96c375c8abd64c72d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/317fdd6728bd396fda1f8e96c375c8abd64c72d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "html_url": "https://github.com/rust-lang/rust/commit/4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/comments", "author": {"login": "syvb", "id": 10530973, "node_id": "MDQ6VXNlcjEwNTMwOTcz", "avatar_url": "https://avatars.githubusercontent.com/u/10530973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syvb", "html_url": "https://github.com/syvb", "followers_url": "https://api.github.com/users/syvb/followers", "following_url": "https://api.github.com/users/syvb/following{/other_user}", "gists_url": "https://api.github.com/users/syvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/syvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syvb/subscriptions", "organizations_url": "https://api.github.com/users/syvb/orgs", "repos_url": "https://api.github.com/users/syvb/repos", "events_url": "https://api.github.com/users/syvb/events{/privacy}", "received_events_url": "https://api.github.com/users/syvb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "syvb", "id": 10530973, "node_id": "MDQ6VXNlcjEwNTMwOTcz", "avatar_url": "https://avatars.githubusercontent.com/u/10530973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syvb", "html_url": "https://github.com/syvb", "followers_url": "https://api.github.com/users/syvb/followers", "following_url": "https://api.github.com/users/syvb/following{/other_user}", "gists_url": "https://api.github.com/users/syvb/gists{/gist_id}", "starred_url": "https://api.github.com/users/syvb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syvb/subscriptions", "organizations_url": "https://api.github.com/users/syvb/orgs", "repos_url": "https://api.github.com/users/syvb/repos", "events_url": "https://api.github.com/users/syvb/events{/privacy}", "received_events_url": "https://api.github.com/users/syvb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39260f6d4994db191f2fca9f12b4930eb3a3c122", "url": "https://api.github.com/repos/rust-lang/rust/commits/39260f6d4994db191f2fca9f12b4930eb3a3c122", "html_url": "https://github.com/rust-lang/rust/commit/39260f6d4994db191f2fca9f12b4930eb3a3c122"}], "stats": {"total": 112, "additions": 106, "deletions": 6}, "files": [{"sha": "f65cc429fbd48241fdb5423ee8fa47fde73a1d38", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/checks.rs", "status": "modified", "additions": 24, "deletions": 4, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fchecks.rs?ref=4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "patch": "@@ -11,7 +11,7 @@ use crate::check::{\n use rustc_ast as ast;\n use rustc_errors::{Applicability, DiagnosticBuilder, DiagnosticId};\n use rustc_hir as hir;\n-use rustc_hir::def::{DefKind, Res};\n+use rustc_hir::def::{CtorOf, DefKind, Res};\n use rustc_hir::def_id::DefId;\n use rustc_hir::{ExprKind, Node, QPath};\n use rustc_middle::ty::adjustment::AllowTwoPhase;\n@@ -120,8 +120,22 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                  error_code: &str,\n                                  c_variadic: bool,\n                                  sugg_unit: bool| {\n-            let (span, start_span, args) = match &expr.kind {\n-                hir::ExprKind::Call(hir::Expr { span, .. }, args) => (*span, *span, &args[..]),\n+            let (span, start_span, args, ctor_of) = match &expr.kind {\n+                hir::ExprKind::Call(\n+                    hir::Expr {\n+                        span,\n+                        kind:\n+                            hir::ExprKind::Path(hir::QPath::Resolved(\n+                                _,\n+                                hir::Path { res: Res::Def(DefKind::Ctor(of, _), _), .. },\n+                            )),\n+                        ..\n+                    },\n+                    args,\n+                ) => (*span, *span, &args[..], Some(of)),\n+                hir::ExprKind::Call(hir::Expr { span, .. }, args) => {\n+                    (*span, *span, &args[..], None)\n+                }\n                 hir::ExprKind::MethodCall(path_segment, span, args, _) => (\n                     *span,\n                     // `sp` doesn't point at the whole `foo.bar()`, only at `bar`.\n@@ -137,6 +151,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                         })\n                         .unwrap_or(*span),\n                     &args[1..], // Skip the receiver.\n+                    None,       // methods are never ctors\n                 ),\n                 k => span_bug!(sp, \"checking argument types on a non-call: `{:?}`\", k),\n             };\n@@ -157,7 +172,12 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             let mut err = tcx.sess.struct_span_err_with_code(\n                 span,\n                 &format!(\n-                    \"this function takes {}{} but {} {} supplied\",\n+                    \"this {} takes {}{} but {} {} supplied\",\n+                    match ctor_of {\n+                        Some(CtorOf::Struct) => \"struct\",\n+                        Some(CtorOf::Variant) => \"enum variant\",\n+                        None => \"function\",\n+                    },\n                     if c_variadic { \"at least \" } else { \"\" },\n                     potentially_plural_count(expected_count, \"argument\"),\n                     potentially_plural_count(arg_count, \"argument\"),"}, {"sha": "5b9861da6e8544079bcb506ddc7e683f4d76788e", "filename": "src/test/ui/span/missing-unit-argument.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.rs?ref=4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "patch": "@@ -8,7 +8,7 @@ impl S {\n }\n \n fn main() {\n-    let _: Result<(), String> = Ok(); //~ ERROR this function takes\n+    let _: Result<(), String> = Ok(); //~ ERROR this enum variant takes\n     foo(); //~ ERROR this function takes\n     foo(()); //~ ERROR this function takes\n     bar(); //~ ERROR this function takes"}, {"sha": "7a24ffbd81c88d2e6edbd271dcf3e32eafa3b4a8", "filename": "src/test/ui/span/missing-unit-argument.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fmissing-unit-argument.stderr?ref=4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "patch": "@@ -1,4 +1,4 @@\n-error[E0061]: this function takes 1 argument but 0 arguments were supplied\n+error[E0061]: this enum variant takes 1 argument but 0 arguments were supplied\n   --> $DIR/missing-unit-argument.rs:11:33\n    |\n LL |     let _: Result<(), String> = Ok();"}, {"sha": "7204caa09d4d21bca0cce13bbdb8f45166dcd865", "filename": "src/test/ui/typeck/struct-enum-wrong-args.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.rs?ref=4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "patch": "@@ -0,0 +1,13 @@\n+struct Wrapper(i32);\n+struct DoubleWrapper(i32, i32);\n+\n+fn main() {\n+    let _ = Some(3, 2); //~ ERROR this enum variant takes\n+    let _ = Ok(3, 6, 2); //~ ERROR this enum variant takes\n+    let _ = Ok(); //~ ERROR this enum variant takes\n+    let _ = Wrapper(); //~ ERROR this struct takes\n+    let _ = Wrapper(5, 2); //~ ERROR this struct takes\n+    let _ = DoubleWrapper(); //~ ERROR this struct takes\n+    let _ = DoubleWrapper(5); //~ ERROR this struct takes\n+    let _ = DoubleWrapper(5, 2, 7); //~ ERROR this struct takes\n+}"}, {"sha": "b9c5756d1f903610a3a9362bc8e3eba775376e73", "filename": "src/test/ui/typeck/struct-enum-wrong-args.stderr", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4cd2fab8c56b19fa14685a0ceb6d905366913b2c/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fstruct-enum-wrong-args.stderr?ref=4cd2fab8c56b19fa14685a0ceb6d905366913b2c", "patch": "@@ -0,0 +1,67 @@\n+error[E0061]: this enum variant takes 1 argument but 2 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:5:13\n+   |\n+LL |     let _ = Some(3, 2);\n+   |             ^^^^ -  - supplied 2 arguments\n+   |             |\n+   |             expected 1 argument\n+\n+error[E0061]: this enum variant takes 1 argument but 3 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:6:13\n+   |\n+LL |     let _ = Ok(3, 6, 2);\n+   |             ^^ -  -  - supplied 3 arguments\n+   |             |\n+   |             expected 1 argument\n+\n+error[E0061]: this enum variant takes 1 argument but 0 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:7:13\n+   |\n+LL |     let _ = Ok();\n+   |             ^^-- supplied 0 arguments\n+   |             |\n+   |             expected 1 argument\n+\n+error[E0061]: this struct takes 1 argument but 0 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:8:13\n+   |\n+LL |     let _ = Wrapper();\n+   |             ^^^^^^^-- supplied 0 arguments\n+   |             |\n+   |             expected 1 argument\n+\n+error[E0061]: this struct takes 1 argument but 2 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:9:13\n+   |\n+LL |     let _ = Wrapper(5, 2);\n+   |             ^^^^^^^ -  - supplied 2 arguments\n+   |             |\n+   |             expected 1 argument\n+\n+error[E0061]: this struct takes 2 arguments but 0 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:10:13\n+   |\n+LL |     let _ = DoubleWrapper();\n+   |             ^^^^^^^^^^^^^-- supplied 0 arguments\n+   |             |\n+   |             expected 2 arguments\n+\n+error[E0061]: this struct takes 2 arguments but 1 argument was supplied\n+  --> $DIR/struct-enum-wrong-args.rs:11:13\n+   |\n+LL |     let _ = DoubleWrapper(5);\n+   |             ^^^^^^^^^^^^^ - supplied 1 argument\n+   |             |\n+   |             expected 2 arguments\n+\n+error[E0061]: this struct takes 2 arguments but 3 arguments were supplied\n+  --> $DIR/struct-enum-wrong-args.rs:12:13\n+   |\n+LL |     let _ = DoubleWrapper(5, 2, 7);\n+   |             ^^^^^^^^^^^^^ -  -  - supplied 3 arguments\n+   |             |\n+   |             expected 2 arguments\n+\n+error: aborting due to 8 previous errors\n+\n+For more information about this error, try `rustc --explain E0061`."}]}