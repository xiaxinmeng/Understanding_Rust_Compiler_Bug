{"sha": "6a168e4538a3fa76101904c3f1942804556c4c67", "node_id": "C_kwDOAAsO6NoAKDZhMTY4ZTQ1MzhhM2ZhNzYxMDE5MDRjM2YxOTQyODA0NTU2YzRjNjc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-10-19T05:15:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-19T05:15:31Z"}, "message": "Rollup merge of #103178 - ferrocene:pa-coverage-reports-tests, r=Mark-Simulacrum\n\nPartially fix `src/test/run-make/coverage-reports` when cross-compiling\n\nThe test does not work on cross-compiled targets because the --target flag was not passed to rustc inside the test. This commit fixes that by adding the flag to the invocations.\n\nNote that the test still fails on cross-compiled targets using remote-test, as remote-test is not capable (yet) of sending back to the host system the `*.profraw` file generated by the instrumentation.\n\nBecause of that, this is only a partial fix, and the test has been ignored on cross-compilation.", "tree": {"sha": "fb34e59dbb9d5f19a98090f4311e7af4961a542d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb34e59dbb9d5f19a98090f4311e7af4961a542d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a168e4538a3fa76101904c3f1942804556c4c67", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjT4fzCRBK7hj4Ov3rIwAA4LYIAIHT2YVZJ0jkeEHkE0guSll4\nFxdWnoG60HTHpBVg4gOVz2OMW0/S7dCkoA2QHHoy7v0YhHtQXpqjcaHZEBsDJ+VC\n7OGHUhGz0s6K8+cVR1Iu0adGTXZYy/1LYp9uVv9CIFuc6l437Ud/yudlRoRydLgG\nfcNL+EwYhE7r26wRxBl27K9udQyDzK0ULndWggoRzV6G6ANLxm7uPqSo/3H8f45Z\nrwcvmhCvUVyZ8WbSQsPZP3ZDNn1lyRqlnRXDLGKTNovEa5fu6OjtKwafggcA30zH\nhKb+qHGcRf1fbBQ+SFaFWpKbQAKWUXObj3zJzHopATiq+xxyTASwauy0SRKh0u0=\n=qmJX\n-----END PGP SIGNATURE-----\n", "payload": "tree fb34e59dbb9d5f19a98090f4311e7af4961a542d\nparent e86bc898311ee19c9725393283b7d88b7d7d4ea8\nparent 399e5cc8db64f06c2d2d57894fc066d289e3eeae\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1666156531 +0200\ncommitter GitHub <noreply@github.com> 1666156531 +0200\n\nRollup merge of #103178 - ferrocene:pa-coverage-reports-tests, r=Mark-Simulacrum\n\nPartially fix `src/test/run-make/coverage-reports` when cross-compiling\n\nThe test does not work on cross-compiled targets because the --target flag was not passed to rustc inside the test. This commit fixes that by adding the flag to the invocations.\n\nNote that the test still fails on cross-compiled targets using remote-test, as remote-test is not capable (yet) of sending back to the host system the `*.profraw` file generated by the instrumentation.\n\nBecause of that, this is only a partial fix, and the test has been ignored on cross-compilation.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a168e4538a3fa76101904c3f1942804556c4c67", "html_url": "https://github.com/rust-lang/rust/commit/6a168e4538a3fa76101904c3f1942804556c4c67", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a168e4538a3fa76101904c3f1942804556c4c67/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e86bc898311ee19c9725393283b7d88b7d7d4ea8", "url": "https://api.github.com/repos/rust-lang/rust/commits/e86bc898311ee19c9725393283b7d88b7d7d4ea8", "html_url": "https://github.com/rust-lang/rust/commit/e86bc898311ee19c9725393283b7d88b7d7d4ea8"}, {"sha": "399e5cc8db64f06c2d2d57894fc066d289e3eeae", "url": "https://api.github.com/repos/rust-lang/rust/commits/399e5cc8db64f06c2d2d57894fc066d289e3eeae", "html_url": "https://github.com/rust-lang/rust/commit/399e5cc8db64f06c2d2d57894fc066d289e3eeae"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "407992c9f43d89eef7941cdf14436f7632a24f8a", "filename": "src/test/run-make/coverage-reports/Makefile", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6a168e4538a3fa76101904c3f1942804556c4c67/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/6a168e4538a3fa76101904c3f1942804556c4c67/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fcoverage-reports%2FMakefile?ref=6a168e4538a3fa76101904c3f1942804556c4c67", "patch": "@@ -1,6 +1,11 @@\n # needs-profiler-support\n # ignore-windows-gnu\n \n+# FIXME(pietroalbini): this test currently does not work on cross-compiled\n+# targets because remote-test is not capable of sending back the *.profraw\n+# files generated by the LLVM instrumentation.\n+# ignore-cross-compile\n+\n # Rust coverage maps support LLVM Coverage Mapping Format versions 5 and 6,\n # corresponding with LLVM versions 12 and 13, respectively.\n # When upgrading LLVM versions, consider whether to enforce a minimum LLVM\n@@ -81,13 +86,13 @@ include clear_expected_if_blessed\n \t# Compile the test library with coverage instrumentation\n \t$(RUSTC) $(SOURCEDIR)/lib/$@.rs \\\n \t\t\t$$( sed -n 's/^\\/\\/ compile-flags: \\([^#]*\\).*/\\1/p' $(SOURCEDIR)/lib/$@.rs ) \\\n-\t\t\t--crate-type rlib -Cinstrument-coverage\n+\t\t\t--crate-type rlib -Cinstrument-coverage --target $(TARGET)\n \n %: $(SOURCEDIR)/%.rs\n \t# Compile the test program with coverage instrumentation\n \t$(RUSTC) $(SOURCEDIR)/$@.rs \\\n \t\t\t$$( sed -n 's/^\\/\\/ compile-flags: \\([^#]*\\).*/\\1/p' $(SOURCEDIR)/$@.rs ) \\\n-\t\t\t-L \"$(TMPDIR)\" -Cinstrument-coverage\n+\t\t\t-L \"$(TMPDIR)\" -Cinstrument-coverage --target $(TARGET)\n \n \t# Run it in order to generate some profiling data,\n \t# with `LLVM_PROFILE_FILE=<profdata_file>` environment variable set to"}]}