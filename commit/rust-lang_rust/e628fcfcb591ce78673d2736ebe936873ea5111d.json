{"sha": "e628fcfcb591ce78673d2736ebe936873ea5111d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2MjhmY2ZjYjU5MWNlNzg2NzNkMjczNmViZTkzNjg3M2VhNTExMWQ=", "commit": {"author": {"name": "J. Ryan Stinnett", "email": "jryans@gmail.com", "date": "2020-12-20T02:49:18Z"}, "committer": {"name": "J. Ryan Stinnett", "email": "jryans@gmail.com", "date": "2020-12-20T02:55:35Z"}, "message": "Skip `dsymutil` by default for compiler bootstrap\n\n`dsymutil` adds time to builds on Apple platforms for no clear benefit, and also\nmakes it more difficult for debuggers to find debug info. The compiler currently\ndefaults to running `dsymutil` to preserve its historical default, but when\ncompiling the compiler itself, we skip it by default since we know it's safe to\ndo so in that case.", "tree": {"sha": "64cd42056420a14a70947d5fe6e4ef58ed73d504", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64cd42056420a14a70947d5fe6e4ef58ed73d504"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e628fcfcb591ce78673d2736ebe936873ea5111d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e628fcfcb591ce78673d2736ebe936873ea5111d", "html_url": "https://github.com/rust-lang/rust/commit/e628fcfcb591ce78673d2736ebe936873ea5111d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e628fcfcb591ce78673d2736ebe936873ea5111d/comments", "author": {"login": "jryans", "id": 279572, "node_id": "MDQ6VXNlcjI3OTU3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/279572?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jryans", "html_url": "https://github.com/jryans", "followers_url": "https://api.github.com/users/jryans/followers", "following_url": "https://api.github.com/users/jryans/following{/other_user}", "gists_url": "https://api.github.com/users/jryans/gists{/gist_id}", "starred_url": "https://api.github.com/users/jryans/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jryans/subscriptions", "organizations_url": "https://api.github.com/users/jryans/orgs", "repos_url": "https://api.github.com/users/jryans/repos", "events_url": "https://api.github.com/users/jryans/events{/privacy}", "received_events_url": "https://api.github.com/users/jryans/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jryans", "id": 279572, "node_id": "MDQ6VXNlcjI3OTU3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/279572?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jryans", "html_url": "https://github.com/jryans", "followers_url": "https://api.github.com/users/jryans/followers", "following_url": "https://api.github.com/users/jryans/following{/other_user}", "gists_url": "https://api.github.com/users/jryans/gists{/gist_id}", "starred_url": "https://api.github.com/users/jryans/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jryans/subscriptions", "organizations_url": "https://api.github.com/users/jryans/orgs", "repos_url": "https://api.github.com/users/jryans/repos", "events_url": "https://api.github.com/users/jryans/events{/privacy}", "received_events_url": "https://api.github.com/users/jryans/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f5bc176b0e54a8e464704adcd7e571700207fe9", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f5bc176b0e54a8e464704adcd7e571700207fe9", "html_url": "https://github.com/rust-lang/rust/commit/1f5bc176b0e54a8e464704adcd7e571700207fe9"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "b1fb8904ca9889779d0b94d637dd6b9707e42168", "filename": "config.toml.example", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e628fcfcb591ce78673d2736ebe936873ea5111d/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/e628fcfcb591ce78673d2736ebe936873ea5111d/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=e628fcfcb591ce78673d2736ebe936873ea5111d", "patch": "@@ -426,6 +426,14 @@ changelog-seen = 2\n # FIXME(#61117): Some tests fail when this option is enabled.\n #debuginfo-level-tests = 0\n \n+# Whether to run `dsymutil` on Apple platforms to gather debug info into .dSYM\n+# bundles. `dsymutil` adds time to builds for no clear benefit, and also makes\n+# it more difficult for debuggers to find debug info. The compiler currently\n+# defaults to running `dsymutil` to preserve its historical default, but when\n+# compiling the compiler itself, we skip it by default since we know it's safe\n+# to do so in that case.\n+#run-dsymutil = false\n+\n # Whether or not `panic!`s generate backtraces (RUST_BACKTRACE)\n #backtrace = true\n "}, {"sha": "ab0c4a5c31b05ce84d9525d71180ebacb691ceb0", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/e628fcfcb591ce78673d2736ebe936873ea5111d/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e628fcfcb591ce78673d2736ebe936873ea5111d/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=e628fcfcb591ce78673d2736ebe936873ea5111d", "patch": "@@ -1126,6 +1126,19 @@ impl<'a> Builder<'a> {\n             },\n         );\n \n+        // `dsymutil` adds time to builds on Apple platforms for no clear benefit, and also makes\n+        // it more difficult for debuggers to find debug info. The compiler currently defaults to\n+        // running `dsymutil` to preserve its historical default, but when compiling the compiler\n+        // itself, we skip it by default since we know it's safe to do so in that case.\n+        // See https://github.com/rust-lang/rust/issues/79361 for more info on this flag.\n+        if target.contains(\"apple\") {\n+            if self.config.rust_run_dsymutil {\n+                rustflags.arg(\"-Zrun-dsymutil=yes\");\n+            } else {\n+                rustflags.arg(\"-Zrun-dsymutil=no\");\n+            }\n+        }\n+\n         if self.config.cmd.bless() {\n             // Bless `expect!` tests.\n             cargo.env(\"UPDATE_EXPECT\", \"1\");"}, {"sha": "ece8a7494b50a094ae0292622e8dd164e40e442f", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e628fcfcb591ce78673d2736ebe936873ea5111d/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e628fcfcb591ce78673d2736ebe936873ea5111d/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=e628fcfcb591ce78673d2736ebe936873ea5111d", "patch": "@@ -123,6 +123,7 @@ pub struct Config {\n     pub rust_debuginfo_level_std: u32,\n     pub rust_debuginfo_level_tools: u32,\n     pub rust_debuginfo_level_tests: u32,\n+    pub rust_run_dsymutil: bool,\n     pub rust_rpath: bool,\n     pub rustc_parallel: bool,\n     pub rustc_default_linker: Option<String>,\n@@ -466,6 +467,7 @@ struct Rust {\n     debuginfo_level_std: Option<u32>,\n     debuginfo_level_tools: Option<u32>,\n     debuginfo_level_tests: Option<u32>,\n+    run_dsymutil: Option<bool>,\n     backtrace: Option<bool>,\n     incremental: Option<bool>,\n     parallel_compiler: Option<bool>,\n@@ -830,6 +832,7 @@ impl Config {\n             debuginfo_level_std = rust.debuginfo_level_std;\n             debuginfo_level_tools = rust.debuginfo_level_tools;\n             debuginfo_level_tests = rust.debuginfo_level_tests;\n+            config.rust_run_dsymutil = rust.run_dsymutil.unwrap_or(false);\n             optimize = rust.optimize;\n             ignore_git = rust.ignore_git;\n             set(&mut config.rust_new_symbol_mangling, rust.new_symbol_mangling);"}]}