{"sha": "e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "node_id": "C_kwDOAAsO6NoAKGU0ZDI1N2UxZDM1OWNiMGVjMjVmN2EzODk2NGVlZjhhMTlkN2FlNzE", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2021-10-04T06:13:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-04T06:13:18Z"}, "message": "Rollup merge of #88305 - ijackson:exitstatus-debug, r=dtolnay\n\nManual Debug for Unix ExitCode ExitStatus ExitStatusError\n\nThese structs have misleading names.  An ExitStatus[Error] is actually a Unix wait status; an ExitCode is actually an exit status.  These misleading names appear in the `Debug` output.\n\nThe `Display` impls on Unix have been improved, but the `Debug` impls are still misleading, as reported in #74832.\n\nFix this by pretending that these internal structs are called `unix_exit_status` and `unix_wait_status` as applicable.  (We can't actually rename the structs because of the way that the cross-platform machinery works: the names are cross-platform.)\n\nAfter this change, this program\n```\n#![feature(exit_status_error)]\nfn main(){\n    let x = std::process::Command::new(\"false\").status().unwrap();\n    dbg!(x.exit_ok());\n    eprintln!(\"x={:?}\",x);\n}\n```\nproduces this output\n```\n[src/main.rs:4] x.exit_ok() = Err(\n    ExitStatusError(\n        unix_wait_status(\n            256,\n        ),\n    ),\n)\nx=ExitStatus(unix_wait_status(256))\n```\n\nCloses #74832", "tree": {"sha": "8f64ccb1f17884c6cc3ecde80afa01b286f45ae8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f64ccb1f17884c6cc3ecde80afa01b286f45ae8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhWpt/CRBK7hj4Ov3rIwAA7SoIACWakexwaVwpZt8vDENj3bWc\nzIH8nyiJ5FEvLxXnXpcP5GleRhRLTmcyZkmjI5J/+zbV+k20eOd+bev8iI23Ku8/\nESUeJPqeJgW0NZJf4sfTqaGl+0VO58aueGJ5/V66hbJ7QKjhWG5IJt3KNjRP3Wp8\nIINmnDE2iVhbHoy62SWcRshoEzL3ah+wpu/RaQVipMWL2D1OOlZb/sczA1gcYOE/\nDwJ1/HLQkHtLNcnQoqeFcKP4SBkPdwVgv/jPSRI6YYz9qZEGKkx+S+HTczTIzip6\n3etXkfEQsna6Gu/a+iPg+iB2OYI20rVVOCZndTJ0fWlJ7q69MH6oaskMCvtYhn0=\n=D6sF\n-----END PGP SIGNATURE-----\n", "payload": "tree 8f64ccb1f17884c6cc3ecde80afa01b286f45ae8\nparent f2ec71fe74ca9db59dbcc43983d689ca31139779\nparent 848a38ac9d9bc956cded893bdd55e1171a2706dd\nauthor Manish Goregaokar <manishsmail@gmail.com> 1633327998 -0700\ncommitter GitHub <noreply@github.com> 1633327998 -0700\n\nRollup merge of #88305 - ijackson:exitstatus-debug, r=dtolnay\n\nManual Debug for Unix ExitCode ExitStatus ExitStatusError\n\nThese structs have misleading names.  An ExitStatus[Error] is actually a Unix wait status; an ExitCode is actually an exit status.  These misleading names appear in the `Debug` output.\n\nThe `Display` impls on Unix have been improved, but the `Debug` impls are still misleading, as reported in #74832.\n\nFix this by pretending that these internal structs are called `unix_exit_status` and `unix_wait_status` as applicable.  (We can't actually rename the structs because of the way that the cross-platform machinery works: the names are cross-platform.)\n\nAfter this change, this program\n```\n#![feature(exit_status_error)]\nfn main(){\n    let x = std::process::Command::new(\"false\").status().unwrap();\n    dbg!(x.exit_ok());\n    eprintln!(\"x={:?}\",x);\n}\n```\nproduces this output\n```\n[src/main.rs:4] x.exit_ok() = Err(\n    ExitStatusError(\n        unix_wait_status(\n            256,\n        ),\n    ),\n)\nx=ExitStatus(unix_wait_status(256))\n```\n\nCloses #74832\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "html_url": "https://github.com/rust-lang/rust/commit/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2ec71fe74ca9db59dbcc43983d689ca31139779", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2ec71fe74ca9db59dbcc43983d689ca31139779", "html_url": "https://github.com/rust-lang/rust/commit/f2ec71fe74ca9db59dbcc43983d689ca31139779"}, {"sha": "848a38ac9d9bc956cded893bdd55e1171a2706dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/848a38ac9d9bc956cded893bdd55e1171a2706dd", "html_url": "https://github.com/rust-lang/rust/commit/848a38ac9d9bc956cded893bdd55e1171a2706dd"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "7ac2f9d8af75a139609b84d5cb47bd349f83c1a8", "filename": "library/std/src/sys/unix/process/process_common.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs?ref=e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "patch": "@@ -457,9 +457,15 @@ impl fmt::Debug for Command {\n     }\n }\n \n-#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+#[derive(PartialEq, Eq, Clone, Copy)]\n pub struct ExitCode(u8);\n \n+impl fmt::Debug for ExitCode {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        f.debug_tuple(\"unix_exit_status\").field(&self.0).finish()\n+    }\n+}\n+\n impl ExitCode {\n     pub const SUCCESS: ExitCode = ExitCode(EXIT_SUCCESS as _);\n     pub const FAILURE: ExitCode = ExitCode(EXIT_FAILURE as _);"}, {"sha": "8c33051cfa436f21ca4790c68172f8aff1c5ed46", "filename": "library/std/src/sys/unix/process/process_unix.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4d257e1d359cb0ec25f7a38964eef8a19d7ae71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs?ref=e4d257e1d359cb0ec25f7a38964eef8a19d7ae71", "patch": "@@ -606,9 +606,15 @@ impl Process {\n }\n \n /// Unix exit statuses\n-#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+#[derive(PartialEq, Eq, Clone, Copy)]\n pub struct ExitStatus(c_int);\n \n+impl fmt::Debug for ExitStatus {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        f.debug_tuple(\"unix_wait_status\").field(&self.0).finish()\n+    }\n+}\n+\n impl ExitStatus {\n     pub fn new(status: c_int) -> ExitStatus {\n         ExitStatus(status)\n@@ -682,7 +688,7 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n-#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+#[derive(PartialEq, Eq, Clone, Copy)]\n pub struct ExitStatusError(NonZero_c_int);\n \n impl Into<ExitStatus> for ExitStatusError {\n@@ -691,6 +697,12 @@ impl Into<ExitStatus> for ExitStatusError {\n     }\n }\n \n+impl fmt::Debug for ExitStatusError {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        f.debug_tuple(\"unix_wait_status\").field(&self.0).finish()\n+    }\n+}\n+\n impl ExitStatusError {\n     pub fn code(self) -> Option<NonZeroI32> {\n         ExitStatus(self.0.into()).code().map(|st| st.try_into().unwrap())"}]}