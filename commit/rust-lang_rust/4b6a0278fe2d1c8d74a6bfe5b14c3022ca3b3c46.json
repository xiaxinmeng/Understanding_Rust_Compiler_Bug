{"sha": "4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiNmEwMjc4ZmUyZDFjOGQ3NGE2YmZlNWIxNGMzMDIyY2EzYjNjNDY=", "commit": {"author": {"name": "Federico Ponzi", "email": "isaacisback92@gmail.com", "date": "2020-07-17T22:01:27Z"}, "committer": {"name": "Federico Ponzi", "email": "isaacisback92@gmail.com", "date": "2020-07-17T22:01:27Z"}, "message": "fixes #67108 by using the external crate", "tree": {"sha": "4f8beb727fc0bea33c7ead7f353eadde41d948a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f8beb727fc0bea33c7ead7f353eadde41d948a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJfEh+3AAoJEM+pzP5TY9DGEAYP+gPlAKAocqsaw05k2/wCaAPN\nJd+iM7X7KC7fm9/3QHlhwqiNsXlB40C8NeILwUYcUet8JhJF8ek/b+hLx8gwCQLa\nHeE+eyTCnE30tbj4V2Kyv57VagcakZO4kF5DSN24xkfO5BEldJ8Zr327MOaN0ZBt\nieliig3m26YnJ0zu7fChd7jmqWREeg7fgdEI46ZdOyGRBHfhXBInPnPzdduiRC+s\nRyV1KV67I6Hu2N9zIY843wQ7lUWMS39stvdM7ju8cSQHoB7AAgXEgGEiROT8gAlR\nj1k9WjbEKsYfSdB/jweDgiwuGDs2o4K98hmeRCX+iDL/EpJwpK36h46fMLmuf1ar\njz9CYvTdGAD6EDBLrTspqfMYMj7MLRx+YEwdQ0h9f0zGYsh3ziBkr36SjaBl+oYv\n5IcXV1Q1AllvgTTK7/wWQ25aWitcGryi15Tk5zS6UKXSAfOCB3znZqfxwFVa9/04\nnWTAsOAwtTTaVSb4VDa6pp8dm+nVu3R3jCePnPobPw8dVs1WMWGTSP7qqavgatOg\n/Z01ykqMGvUyZW4Tb3j8V1rWFP04t6PGWwEA29T0z4jcUhNmkupKK+7vGG5nNzjL\n58Skt2gNoqcofuRSUo2YCwrWfbQC34Qpdl1DPxKK6mCrp6i1riqdY/BFmXsgttYh\nTMRcV67XCx4FVv/N0nCf\n=aNWa\n-----END PGP SIGNATURE-----", "payload": "tree 4f8beb727fc0bea33c7ead7f353eadde41d948a1\nparent 3014f23ddd437d2ba9947383c4565d09c1eb39f2\nauthor Federico Ponzi <isaacisback92@gmail.com> 1595023287 +0200\ncommitter Federico Ponzi <isaacisback92@gmail.com> 1595023287 +0200\n\nfixes #67108 by using the external crate\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "html_url": "https://github.com/rust-lang/rust/commit/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/comments", "author": {"login": "FedericoPonzi", "id": 2124904, "node_id": "MDQ6VXNlcjIxMjQ5MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2124904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FedericoPonzi", "html_url": "https://github.com/FedericoPonzi", "followers_url": "https://api.github.com/users/FedericoPonzi/followers", "following_url": "https://api.github.com/users/FedericoPonzi/following{/other_user}", "gists_url": "https://api.github.com/users/FedericoPonzi/gists{/gist_id}", "starred_url": "https://api.github.com/users/FedericoPonzi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FedericoPonzi/subscriptions", "organizations_url": "https://api.github.com/users/FedericoPonzi/orgs", "repos_url": "https://api.github.com/users/FedericoPonzi/repos", "events_url": "https://api.github.com/users/FedericoPonzi/events{/privacy}", "received_events_url": "https://api.github.com/users/FedericoPonzi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "FedericoPonzi", "id": 2124904, "node_id": "MDQ6VXNlcjIxMjQ5MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2124904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FedericoPonzi", "html_url": "https://github.com/FedericoPonzi", "followers_url": "https://api.github.com/users/FedericoPonzi/followers", "following_url": "https://api.github.com/users/FedericoPonzi/following{/other_user}", "gists_url": "https://api.github.com/users/FedericoPonzi/gists{/gist_id}", "starred_url": "https://api.github.com/users/FedericoPonzi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FedericoPonzi/subscriptions", "organizations_url": "https://api.github.com/users/FedericoPonzi/orgs", "repos_url": "https://api.github.com/users/FedericoPonzi/repos", "events_url": "https://api.github.com/users/FedericoPonzi/events{/privacy}", "received_events_url": "https://api.github.com/users/FedericoPonzi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3014f23ddd437d2ba9947383c4565d09c1eb39f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/3014f23ddd437d2ba9947383c4565d09c1eb39f2", "html_url": "https://github.com/rust-lang/rust/commit/3014f23ddd437d2ba9947383c4565d09c1eb39f2"}], "stats": {"total": 41, "additions": 10, "deletions": 31}, "files": [{"sha": "3ee7d07900700cdc1797ecbcbc1fcb8efd98c8df", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "patch": "@@ -2142,6 +2142,12 @@ dependencies = [\n  \"winapi 0.3.8\",\n ]\n \n+[[package]]\n+name = \"pathdiff\"\n+version = \"0.2.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"877630b3de15c0b64cc52f659345724fbf6bdad9bd9566699fc53688f3c34a34\"\n+\n [[package]]\n name = \"percent-encoding\"\n version = \"1.0.1\"\n@@ -3318,6 +3324,7 @@ dependencies = [\n  \"log\",\n  \"memmap\",\n  \"num_cpus\",\n+ \"pathdiff\",\n  \"rustc_apfloat\",\n  \"rustc_ast\",\n  \"rustc_attr\","}, {"sha": "e100e0095c92a4bfd37142ee7c9310b8ad8f2f86", "filename": "src/librustc_codegen_ssa/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/src%2Flibrustc_codegen_ssa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/src%2Flibrustc_codegen_ssa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2FCargo.toml?ref=4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "patch": "@@ -18,6 +18,7 @@ log = \"0.4.5\"\n libc = \"0.2.50\"\n jobserver = \"0.1.11\"\n tempfile = \"3.1\"\n+pathdiff = \"0.2.0\"\n \n rustc_serialize = { path = \"../librustc_serialize\" }\n rustc_ast = { path = \"../librustc_ast\" }"}, {"sha": "e1d649c6ed3ded6538f4205f3109366841e825b2", "filename": "src/librustc_codegen_ssa/back/rpath.rs", "status": "modified", "additions": 2, "deletions": 31, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs?ref=4b6a0278fe2d1c8d74a6bfe5b14c3022ca3b3c46", "patch": "@@ -2,6 +2,7 @@ use rustc_data_structures::fx::FxHashSet;\n use std::env;\n use std::fs;\n use std::path::{Path, PathBuf};\n+use pathdiff::diff_paths;\n \n use rustc_hir::def_id::CrateNum;\n use rustc_middle::middle::cstore::LibSource;\n@@ -109,37 +110,7 @@ fn get_rpath_relative_to_output(config: &mut RPathConfig<'_>, lib: &Path) -> Str\n // In particular, this handles the case on unix where both paths are\n // absolute but with only the root as the common directory.\n fn path_relative_from(path: &Path, base: &Path) -> Option<PathBuf> {\n-    use std::path::Component;\n-\n-    if path.is_absolute() != base.is_absolute() {\n-        path.is_absolute().then(|| PathBuf::from(path))\n-    } else {\n-        let mut ita = path.components();\n-        let mut itb = base.components();\n-        let mut comps: Vec<Component<'_>> = vec![];\n-        loop {\n-            match (ita.next(), itb.next()) {\n-                (None, None) => break,\n-                (Some(a), None) => {\n-                    comps.push(a);\n-                    comps.extend(ita.by_ref());\n-                    break;\n-                }\n-                (None, _) => comps.push(Component::ParentDir),\n-                (Some(a), Some(b)) if comps.is_empty() && a == b => (),\n-                (Some(a), Some(b)) if b == Component::CurDir => comps.push(a),\n-                (Some(_), Some(b)) if b == Component::ParentDir => return None,\n-                (Some(a), Some(_)) => {\n-                    comps.push(Component::ParentDir);\n-                    comps.extend(itb.map(|_| Component::ParentDir));\n-                    comps.push(a);\n-                    comps.extend(ita.by_ref());\n-                    break;\n-                }\n-            }\n-        }\n-        Some(comps.iter().map(|c| c.as_os_str()).collect())\n-    }\n+    diff_paths(path, base)\n }\n \n fn get_install_prefix_rpath(config: &mut RPathConfig<'_>) -> String {"}]}