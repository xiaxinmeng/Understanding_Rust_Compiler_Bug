{"sha": "c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1ZTM0NGY3NzQ3ZGJkN2U3ZDRiMjA5ZTNjNDgwZGViNTk3OWE1NmY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-07T03:31:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-07T03:31:23Z"}, "message": "Auto merge of #86920 - JohnTitor:rollup-buvzpkr, r=JohnTitor\n\nRollup of 8 pull requests\n\nSuccessful merges:\n\n - #80918 (Add Integer::log variants)\n - #86717 (Rename some Rust 2021 lints to better names )\n - #86819 (Clean up rustdoc IDs)\n - #86880 (Test ManuallyDrop::clone_from.)\n - #86906 (Replace deprecated compare_and_swap and fix typo in core::sync::atomic::{fence, compiler_fence} docs)\n - #86907 (Migrate `cpu-usage-over-time.py` to Python 3)\n - #86916 (rewrote documentation for thread::yield_now())\n - #86919 (Update books)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "0390ebc50ec6f445460fefd566a67be3be79a088", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0390ebc50ec6f445460fefd566a67be3be79a088"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "html_url": "https://github.com/rust-lang/rust/commit/c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0bd5a584da4f26a1391163a0bdc21b34cf1ba54", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0bd5a584da4f26a1391163a0bdc21b34cf1ba54", "html_url": "https://github.com/rust-lang/rust/commit/c0bd5a584da4f26a1391163a0bdc21b34cf1ba54"}, {"sha": "51968854f4c3bd9cc54cf35c3e84047adfc6cf21", "url": "https://api.github.com/repos/rust-lang/rust/commits/51968854f4c3bd9cc54cf35c3e84047adfc6cf21", "html_url": "https://github.com/rust-lang/rust/commit/51968854f4c3bd9cc54cf35c3e84047adfc6cf21"}], "stats": {"total": 1141, "additions": 842, "deletions": 299}, "files": [{"sha": "8b68c94e61a384c19603352176b09e396236e31e", "filename": "compiler/rustc_expand/src/mbe/macro_rules.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_rules.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -18,7 +18,9 @@ use rustc_data_structures::fx::FxHashMap;\n use rustc_data_structures::sync::Lrc;\n use rustc_errors::{Applicability, DiagnosticBuilder};\n use rustc_feature::Features;\n-use rustc_lint_defs::builtin::{OR_PATTERNS_BACK_COMPAT, SEMICOLON_IN_EXPRESSIONS_FROM_MACROS};\n+use rustc_lint_defs::builtin::{\n+    RUST_2021_INCOMPATIBLE_OR_PATTERNS, SEMICOLON_IN_EXPRESSIONS_FROM_MACROS,\n+};\n use rustc_lint_defs::BuiltinLintDiagnostics;\n use rustc_parse::parser::Parser;\n use rustc_session::parse::ParseSess;\n@@ -975,7 +977,7 @@ fn check_matcher_core(\n                             Some(NonterminalKind::PatParam { inferred: false }),\n                         ));\n                         sess.buffer_lint_with_diagnostic(\n-                            &OR_PATTERNS_BACK_COMPAT,\n+                            &RUST_2021_INCOMPATIBLE_OR_PATTERNS,\n                             span,\n                             ast::CRATE_NODE_ID,\n                             \"the meaning of the `pat` fragment specifier is changing in Rust 2021, which may affect this macro\","}, {"sha": "6225b71692139da12f2c36352a01fed2b139eaf0", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -325,6 +325,9 @@ fn register_builtins(store: &mut LintStore, no_interleave_lints: bool) {\n     store.register_renamed(\"redundant_semicolon\", \"redundant_semicolons\");\n     store.register_renamed(\"overlapping_patterns\", \"overlapping_range_endpoints\");\n     store.register_renamed(\"safe_packed_borrows\", \"unaligned_references\");\n+    store.register_renamed(\"disjoint_capture_migration\", \"rust_2021_incompatible_closure_captures\");\n+    store.register_renamed(\"or_patterns_back_compat\", \"rust_2021_incompatible_or_patterns\");\n+    store.register_renamed(\"non_fmt_panic\", \"non_fmt_panics\");\n \n     // These were moved to tool lints, but rustc still sees them when compiling normally, before\n     // tool lints are registered, so `check_tool_name_for_backwards_compat` doesn't work. Use"}, {"sha": "99a88f6bf610d494d1bfb7a0e80ee3230a0a4007", "filename": "compiler/rustc_lint/src/non_fmt_panic.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint%2Fsrc%2Fnon_fmt_panic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint%2Fsrc%2Fnon_fmt_panic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fnon_fmt_panic.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -9,7 +9,7 @@ use rustc_span::edition::Edition;\n use rustc_span::{hygiene, sym, symbol::kw, symbol::SymbolStr, InnerSpan, Span, Symbol};\n \n declare_lint! {\n-    /// The `non_fmt_panic` lint detects `panic!(..)` invocations where the first\n+    /// The `non_fmt_panics` lint detects `panic!(..)` invocations where the first\n     /// argument is not a formatting string.\n     ///\n     /// ### Example\n@@ -29,7 +29,7 @@ declare_lint! {\n     /// an `i32` as message.\n     ///\n     /// Rust 2021 always interprets the first argument as format string.\n-    NON_FMT_PANIC,\n+    NON_FMT_PANICS,\n     Warn,\n     \"detect single-argument panic!() invocations in which the argument is not a format string\",\n     @future_incompatible = FutureIncompatibleInfo {\n@@ -39,7 +39,7 @@ declare_lint! {\n     report_in_external_macro\n }\n \n-declare_lint_pass!(NonPanicFmt => [NON_FMT_PANIC]);\n+declare_lint_pass!(NonPanicFmt => [NON_FMT_PANICS]);\n \n impl<'tcx> LateLintPass<'tcx> for NonPanicFmt {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx hir::Expr<'tcx>) {\n@@ -91,7 +91,7 @@ fn check_panic<'tcx>(cx: &LateContext<'tcx>, f: &'tcx hir::Expr<'tcx>, arg: &'tc\n         arg_span = expn.call_site;\n     }\n \n-    cx.struct_span_lint(NON_FMT_PANIC, arg_span, |lint| {\n+    cx.struct_span_lint(NON_FMT_PANICS, arg_span, |lint| {\n         let mut l = lint.build(\"panic message is not a string literal\");\n         l.note(\"this usage of panic!() is deprecated; it will be a hard error in Rust 2021\");\n         l.note(\"for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/panic-macro-consistency.html>\");\n@@ -174,7 +174,7 @@ fn check_panic_str<'tcx>(\n             [] => vec![fmt_span],\n             v => v.iter().map(|span| fmt_span.from_inner(*span)).collect(),\n         };\n-        cx.struct_span_lint(NON_FMT_PANIC, arg_spans, |lint| {\n+        cx.struct_span_lint(NON_FMT_PANICS, arg_spans, |lint| {\n             let mut l = lint.build(match n_arguments {\n                 1 => \"panic message contains an unused formatting placeholder\",\n                 _ => \"panic message contains unused formatting placeholders\",\n@@ -208,7 +208,7 @@ fn check_panic_str<'tcx>(\n             Some(v) if v.len() == 1 => \"panic message contains a brace\",\n             _ => \"panic message contains braces\",\n         };\n-        cx.struct_span_lint(NON_FMT_PANIC, brace_spans.unwrap_or_else(|| vec![span]), |lint| {\n+        cx.struct_span_lint(NON_FMT_PANICS, brace_spans.unwrap_or_else(|| vec![span]), |lint| {\n             let mut l = lint.build(msg);\n             l.note(\"this message is not used as a format string, but will be in Rust 2021\");\n             if span.contains(arg.span) {"}, {"sha": "01291de51bdab4024b71099f448b094ccbf0c80e", "filename": "compiler/rustc_lint_defs/src/builtin.rs", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2967,13 +2967,13 @@ declare_lint_pass! {\n         MISSING_ABI,\n         INVALID_DOC_ATTRIBUTES,\n         SEMICOLON_IN_EXPRESSIONS_FROM_MACROS,\n-        DISJOINT_CAPTURE_MIGRATION,\n+        RUST_2021_INCOMPATIBLE_CLOSURE_CAPTURES,\n         LEGACY_DERIVE_HELPERS,\n         PROC_MACRO_BACK_COMPAT,\n-        OR_PATTERNS_BACK_COMPAT,\n+        RUST_2021_INCOMPATIBLE_OR_PATTERNS,\n         LARGE_ASSIGNMENTS,\n-        FUTURE_PRELUDE_COLLISION,\n-        RESERVED_PREFIX,\n+        RUST_2021_PRELUDE_COLLISIONS,\n+        RUST_2021_PREFIXES_INCOMPATIBLE_SYNTAX,\n         UNSUPPORTED_CALLING_CONVENTIONS,\n     ]\n }\n@@ -3002,7 +3002,7 @@ declare_lint! {\n }\n \n declare_lint! {\n-    /// The `disjoint_capture_migration` lint detects variables that aren't completely\n+    /// The `rust_2021_incompatible_closure_captures` lint detects variables that aren't completely\n     /// captured in Rust 2021 and affect the Drop order of at least one path starting at this variable.\n     /// It can also detect when a variable implements a trait, but one of its field does not and\n     /// the field is captured by a closure and used with the assumption that said field implements\n@@ -3011,7 +3011,7 @@ declare_lint! {\n     /// ### Example of drop reorder\n     ///\n     /// ```rust,compile_fail\n-    /// # #![deny(disjoint_capture_migration)]\n+    /// # #![deny(rust_2021_incompatible_closure_captures)]\n     /// # #![allow(unused)]\n     /// struct FancyInteger(i32);\n     ///\n@@ -3046,7 +3046,7 @@ declare_lint! {\n     /// ### Example of auto-trait\n     ///\n     /// ```rust,compile_fail\n-    /// #![deny(disjoint_capture_migration)]\n+    /// #![deny(rust_2021_incompatible_closure_captures)]\n     /// use std::thread;\n     ///\n     /// struct Pointer(*mut i32);\n@@ -3068,7 +3068,7 @@ declare_lint! {\n     /// In the above example, only `fptr.0` is captured in Rust 2021.\n     /// The field is of type *mut i32 which doesn't implement Send, making the code invalid as the\n     /// field cannot be sent between thread safely.\n-    pub DISJOINT_CAPTURE_MIGRATION,\n+    pub RUST_2021_INCOMPATIBLE_CLOSURE_CAPTURES,\n     Allow,\n     \"detects closures affected by Rust 2021 changes\",\n     @future_incompatible = FutureIncompatibleInfo {\n@@ -3183,12 +3183,12 @@ declare_lint! {\n }\n \n declare_lint! {\n-    /// The `or_patterns_back_compat` lint detects usage of old versions of or-patterns.\n+    /// The `rust_2021_incompatible_or_patterns` lint detects usage of old versions of or-patterns.\n     ///\n     /// ### Example\n     ///\n     /// ```rust,compile_fail\n-    /// #![deny(or_patterns_back_compat)]\n+    /// #![deny(rust_2021_incompatible_or_patterns)]\n     /// macro_rules! match_any {\n     ///     ( $expr:expr , $( $( $pat:pat )|+ => $expr_arm:expr ),+ ) => {\n     ///         match $expr {\n@@ -3211,7 +3211,7 @@ declare_lint! {\n     /// ### Explanation\n     ///\n     /// In Rust 2021, the pat matcher will match new patterns, which include the | character.\n-    pub OR_PATTERNS_BACK_COMPAT,\n+    pub RUST_2021_INCOMPATIBLE_OR_PATTERNS,\n     Allow,\n     \"detects usage of old versions of or-patterns\",\n     @future_incompatible = FutureIncompatibleInfo {\n@@ -3221,13 +3221,13 @@ declare_lint! {\n }\n \n declare_lint! {\n-    /// The `future_prelude_collision` lint detects the usage of trait methods which are ambiguous\n+    /// The `rust_2021_prelude_collisions` lint detects the usage of trait methods which are ambiguous\n     /// with traits added to the prelude in future editions.\n     ///\n     /// ### Example\n     ///\n     /// ```rust,compile_fail\n-    /// #![deny(future_prelude_collision)]\n+    /// #![deny(rust_2021_prelude_collisions)]\n     ///\n     /// trait Foo {\n     ///     fn try_into(self) -> Result<String, !>;\n@@ -3259,7 +3259,7 @@ declare_lint! {\n     ///  is called directly on a type.\n     ///\n     /// [prelude changes]: https://blog.rust-lang.org/inside-rust/2021/03/04/planning-rust-2021.html#prelude-changes\n-    pub FUTURE_PRELUDE_COLLISION,\n+    pub RUST_2021_PRELUDE_COLLISIONS,\n     Allow,\n     \"detects the usage of trait methods which are ambiguous with traits added to the \\\n         prelude in future editions\",\n@@ -3270,13 +3270,13 @@ declare_lint! {\n }\n \n declare_lint! {\n-    /// The `reserved_prefix` lint detects identifiers that will be parsed as a\n+    /// The `rust_2021_prefixes_incompatible_syntax` lint detects identifiers that will be parsed as a\n     /// prefix instead in Rust 2021.\n     ///\n     /// ### Example\n     ///\n     /// ```rust,compile_fail\n-    /// #![deny(reserved_prefix)]\n+    /// #![deny(rust_2021_prefixes_incompatible_syntax)]\n     ///\n     /// macro_rules! m {\n     ///     (z $x:expr) => ();\n@@ -3295,7 +3295,7 @@ declare_lint! {\n     ///\n     /// This lint suggests to add whitespace between the `z` and `\"hey\"` tokens\n     /// to keep them separated in Rust 2021.\n-    pub RESERVED_PREFIX,\n+    pub RUST_2021_PREFIXES_INCOMPATIBLE_SYNTAX,\n     Allow,\n     \"identifiers that will be parsed as a prefix in Rust 2021\",\n     @future_incompatible = FutureIncompatibleInfo {"}, {"sha": "98befe4066bc57a334d124bf13845855e222517a", "filename": "compiler/rustc_parse/src/lexer/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_parse%2Fsrc%2Flexer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_parse%2Fsrc%2Flexer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flexer%2Fmod.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -4,7 +4,7 @@ use rustc_ast::tokenstream::{Spacing, TokenStream};\n use rustc_errors::{error_code, Applicability, DiagnosticBuilder, FatalError, PResult};\n use rustc_lexer::unescape::{self, Mode};\n use rustc_lexer::{Base, DocStyle, RawStrError};\n-use rustc_session::lint::builtin::RESERVED_PREFIX;\n+use rustc_session::lint::builtin::RUST_2021_PREFIXES_INCOMPATIBLE_SYNTAX;\n use rustc_session::lint::BuiltinLintDiagnostics;\n use rustc_session::parse::ParseSess;\n use rustc_span::symbol::{sym, Symbol};\n@@ -526,7 +526,7 @@ impl<'a> StringReader<'a> {\n         } else {\n             // Before Rust 2021, only emit a lint for migration.\n             self.sess.buffer_lint_with_diagnostic(\n-                &RESERVED_PREFIX,\n+                &RUST_2021_PREFIXES_INCOMPATIBLE_SYNTAX,\n                 prefix_span,\n                 ast::CRATE_NODE_ID,\n                 &msg,"}, {"sha": "6ca0b3ed66b3933e25198d878e998bb16033c8d7", "filename": "compiler/rustc_typeck/src/check/method/prelude2021.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprelude2021.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprelude2021.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fprelude2021.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -5,7 +5,7 @@ use rustc_ast::Mutability;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n use rustc_middle::ty::{Ref, Ty};\n-use rustc_session::lint::builtin::FUTURE_PRELUDE_COLLISION;\n+use rustc_session::lint::builtin::RUST_2021_PRELUDE_COLLISIONS;\n use rustc_span::symbol::kw::Underscore;\n use rustc_span::symbol::{sym, Ident};\n use rustc_span::Span;\n@@ -67,7 +67,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             // Inherent impls only require not relying on autoref and autoderef in order to\n             // ensure that the trait implementation won't be used\n             self.tcx.struct_span_lint_hir(\n-                FUTURE_PRELUDE_COLLISION,\n+                RUST_2021_PRELUDE_COLLISIONS,\n                 self_expr.hir_id,\n                 self_expr.span,\n                 |lint| {\n@@ -128,7 +128,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             // trait implementations require full disambiguation to not clash with the new prelude\n             // additions (i.e. convert from dot-call to fully-qualified call)\n             self.tcx.struct_span_lint_hir(\n-                FUTURE_PRELUDE_COLLISION,\n+                RUST_2021_PRELUDE_COLLISIONS,\n                 call_expr.hir_id,\n                 call_expr.span,\n                 |lint| {\n@@ -212,7 +212,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             return;\n         }\n \n-        self.tcx.struct_span_lint_hir(FUTURE_PRELUDE_COLLISION, expr_id, span, |lint| {\n+        self.tcx.struct_span_lint_hir(RUST_2021_PRELUDE_COLLISIONS, expr_id, span, |lint| {\n             // \"type\" refers to either a type or, more likely, a trait from which\n             // the associated function or method is from.\n             let trait_path = self.trait_path_or_bare_name(span, expr_id, pick.item.container.id());"}, {"sha": "6e6d4778b269ca0d672e0800bb3406963abeab68", "filename": "compiler/rustc_typeck/src/check/upvar.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -171,7 +171,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n \n         let closure_hir_id = self.tcx.hir().local_def_id_to_hir_id(local_def_id);\n \n-        if should_do_disjoint_capture_migration_analysis(self.tcx, closure_hir_id) {\n+        if should_do_rust_2021_incompatible_closure_captures_analysis(self.tcx, closure_hir_id) {\n             self.perform_2229_migration_anaysis(closure_def_id, body_id, capture_clause, span);\n         }\n \n@@ -503,7 +503,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             let local_def_id = closure_def_id.expect_local();\n             let closure_hir_id = self.tcx.hir().local_def_id_to_hir_id(local_def_id);\n             self.tcx.struct_span_lint_hir(\n-                lint::builtin::DISJOINT_CAPTURE_MIGRATION,\n+                lint::builtin::RUST_2021_INCOMPATIBLE_CLOSURE_CAPTURES,\n                 closure_hir_id,\n                 span,\n                 |lint| {\n@@ -1820,8 +1820,12 @@ fn var_name(tcx: TyCtxt<'_>, var_hir_id: hir::HirId) -> Symbol {\n     tcx.hir().name(var_hir_id)\n }\n \n-fn should_do_disjoint_capture_migration_analysis(tcx: TyCtxt<'_>, closure_id: hir::HirId) -> bool {\n-    let (level, _) = tcx.lint_level_at_node(lint::builtin::DISJOINT_CAPTURE_MIGRATION, closure_id);\n+fn should_do_rust_2021_incompatible_closure_captures_analysis(\n+    tcx: TyCtxt<'_>,\n+    closure_id: hir::HirId,\n+) -> bool {\n+    let (level, _) =\n+        tcx.lint_level_at_node(lint::builtin::RUST_2021_INCOMPATIBLE_CLOSURE_CAPTURES, closure_id);\n \n     !matches!(level, lint::Level::Allow)\n }"}, {"sha": "3557dbad90cc215f01af0e199f63879b0c2a3183", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -164,7 +164,8 @@\n #![feature(no_niche)] // rust-lang/rust#68303\n #![feature(no_coverage)] // rust-lang/rust#84605\n #![deny(unsafe_op_in_unsafe_fn)]\n-#![deny(or_patterns_back_compat)]\n+#![cfg_attr(bootstrap, deny(or_patterns_back_compat))]\n+#![cfg_attr(not(bootstrap), deny(rust_2021_incompatible_or_patterns))]\n \n // allow using `core::` in intra-doc links\n #[allow(unused_extern_crates)]"}, {"sha": "a9461649d4aa17cf37c3f5182884081968703cd7", "filename": "library/core/src/num/int_macros.rs", "status": "modified", "additions": 188, "deletions": 0, "changes": 188, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1744,6 +1744,194 @@ macro_rules! int_impl {\n             }\n         }\n \n+        /// Returns the logarithm of the number with respect to an arbitrary base.\n+        ///\n+        /// This method may not be optimized owing to implementation details;\n+        /// `log2` can produce results more efficiently for base 2, and `log10`\n+        /// can produce results more efficiently for base 10.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is zero, or if the base is not at least 2; it\n+        /// panics in debug mode and the return value is wrapped to 0 in release\n+        /// mode (the only situation in which the method can return 0).\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(5\", stringify!($SelfT), \".log(5), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log(self, base: Self) -> Self {\n+            match self.checked_log(base) {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the base 2 logarithm of the number.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is zero it panics in debug mode and the return value\n+        /// is wrapped to 0 in release mode (the only situation in which the\n+        /// method can return 0).\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(2\", stringify!($SelfT), \".log2(), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log2(self) -> Self {\n+            match self.checked_log2() {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the base 10 logarithm of the number.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is zero it panics in debug mode and the return value\n+        /// is wrapped to 0 in release mode (the only situation in which the\n+        /// method can return 0).\n+        ///\n+        /// # Example\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(10\", stringify!($SelfT), \".log10(), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log10(self) -> Self {\n+            match self.checked_log10() {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the logarithm of the number with respect to an arbitrary base.\n+        ///\n+        /// Returns `None` if the number is negative or zero, or if the base is not at least 2.\n+        ///\n+        /// This method may not be optimized owing to implementation details;\n+        /// `checked_log2` can produce results more efficiently for base 2, and\n+        /// `checked_log10` can produce results more efficiently for base 10.\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(5\", stringify!($SelfT), \".checked_log(5), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log(self, base: Self) -> Option<Self> {\n+            if self <= 0 || base <= 1 {\n+                None\n+            } else {\n+                let mut n = 0;\n+                let mut r = self;\n+\n+                // Optimization for 128 bit wide integers.\n+                if Self::BITS == 128 {\n+                    let b = Self::log2(self) / (Self::log2(base) + 1);\n+                    n += b;\n+                    r /= base.pow(b as u32);\n+                }\n+\n+                while r >= base {\n+                    r /= base;\n+                    n += 1;\n+                }\n+                Some(n)\n+            }\n+        }\n+\n+        /// Returns the base 2 logarithm of the number.\n+        ///\n+        /// Returns `None` if the number is negative or zero.\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(2\", stringify!($SelfT), \".checked_log2(), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log2(self) -> Option<Self> {\n+            if self <= 0 {\n+                None\n+            } else {\n+                // SAFETY: We just checked that this number is positive\n+                let log = (Self::BITS - 1) as Self - unsafe { intrinsics::ctlz_nonzero(self) };\n+                Some(log)\n+            }\n+        }\n+\n+        /// Returns the base 10 logarithm of the number.\n+        ///\n+        /// Returns `None` if the number is negative or zero.\n+        ///\n+        /// # Example\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(10\", stringify!($SelfT), \".checked_log10(), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log10(self) -> Option<Self> {\n+            self.checked_log(10)\n+        }\n+\n         /// Computes the absolute value of `self`.\n         ///\n         /// # Overflow behavior"}, {"sha": "bf4d2e7433e2f9a924b8a2c814b27adf126a8ab4", "filename": "library/core/src/num/uint_macros.rs", "status": "modified", "additions": 188, "deletions": 0, "changes": 188, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -634,6 +634,194 @@ macro_rules! uint_impl {\n             }\n         }\n \n+        /// Returns the logarithm of the number with respect to an arbitrary base.\n+        ///\n+        /// This method may not be optimized owing to implementation details;\n+        /// `log2` can produce results more efficiently for base 2, and `log10`\n+        /// can produce results more efficiently for base 10.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is negative, zero, or if the base is not at least 2;\n+        /// it panics in debug mode and the return value is wrapped to 0 in\n+        /// release mode (the only situation in which the method can return 0).\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(5\", stringify!($SelfT), \".log(5), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log(self, base: Self) -> Self {\n+            match self.checked_log(base) {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the base 2 logarithm of the number.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is negative or zero it panics in debug mode and\n+        /// the return value is wrapped to 0 in release mode (the only situation in\n+        /// which the method can return 0).\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(2\", stringify!($SelfT), \".log2(), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log2(self) -> Self {\n+            match self.checked_log2() {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the base 10 logarithm of the number.\n+        ///\n+        /// # Panics\n+        ///\n+        /// When the number is negative or zero it panics in debug mode and the\n+        /// return value is wrapped to 0 in release mode (the only situation in\n+        /// which the method can return 0).\n+        ///\n+        /// # Example\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(10\", stringify!($SelfT), \".log10(), 1);\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        #[track_caller]\n+        #[rustc_inherit_overflow_checks]\n+        #[allow(arithmetic_overflow)]\n+        pub const fn log10(self) -> Self {\n+            match self.checked_log10() {\n+                Some(n) => n,\n+                None => {\n+                    // In debug builds, trigger a panic on None.\n+                    // This should optimize completely out in release builds.\n+                    let _ = Self::MAX + 1;\n+\n+                    0\n+                },\n+            }\n+        }\n+\n+        /// Returns the logarithm of the number with respect to an arbitrary base.\n+        ///\n+        /// Returns `None` if the number is zero, or if the base is not at least 2.\n+        ///\n+        /// This method may not be optimized owing to implementation details;\n+        /// `checked_log2` can produce results more efficiently for base 2, and\n+        /// `checked_log10` can produce results more efficiently for base 10.\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(5\", stringify!($SelfT), \".checked_log(5), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log(self, base: Self) -> Option<Self> {\n+            if self <= 0 || base <= 1 {\n+                None\n+            } else {\n+                let mut n = 0;\n+                let mut r = self;\n+\n+                // Optimization for 128 bit wide integers.\n+                if Self::BITS == 128 {\n+                    let b = Self::log2(self) / (Self::log2(base) + 1);\n+                    n += b;\n+                    r /= base.pow(b as u32);\n+                }\n+\n+                while r >= base {\n+                    r /= base;\n+                    n += 1;\n+                }\n+                Some(n)\n+            }\n+        }\n+\n+        /// Returns the base 2 logarithm of the number.\n+        ///\n+        /// Returns `None` if the number is zero.\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(2\", stringify!($SelfT), \".checked_log2(), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log2(self) -> Option<Self> {\n+            if self <= 0 {\n+                None\n+            } else {\n+                // SAFETY: We just checked that this number is positive\n+                let log = (Self::BITS - 1) as Self - unsafe { intrinsics::ctlz_nonzero(self) };\n+                Some(log)\n+            }\n+        }\n+\n+        /// Returns the base 10 logarithm of the number.\n+        ///\n+        /// Returns `None` if the number is zero.\n+        ///\n+        /// # Examples\n+        ///\n+        /// ```\n+        /// #![feature(int_log)]\n+        #[doc = concat!(\"assert_eq!(10\", stringify!($SelfT), \".checked_log10(), Some(1));\")]\n+        /// ```\n+        #[unstable(feature = \"int_log\", issue = \"70887\")]\n+        #[must_use = \"this returns the result of the operation, \\\n+                        without modifying the original\"]\n+        #[inline]\n+        pub const fn checked_log10(self) -> Option<Self> {\n+            self.checked_log(10)\n+        }\n+\n         /// Checked negation. Computes `-self`, returning `None` unless `self ==\n         /// 0`.\n         ///"}, {"sha": "b673b36c10211a3c13f8d2168b64caea740d8288", "filename": "library/core/src/sync/atomic.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fsync%2Fatomic.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2648,7 +2648,11 @@ unsafe fn atomic_umin<T: Copy>(dst: *mut T, val: T, order: Ordering) -> T {\n ///\n ///     pub fn lock(&self) {\n ///         // Wait until the old value is `false`.\n-///         while self.flag.compare_and_swap(false, true, Ordering::Relaxed) != false {}\n+///         while self\n+///             .flag\n+///             .compare_exchange_weak(false, true, Ordering::Relaxed, Ordering::Relaxed)\n+///             .is_err()\n+///         {}\n ///         // This fence synchronizes-with store in `unlock`.\n ///         fence(Ordering::Acquire);\n ///     }\n@@ -2710,7 +2714,7 @@ pub fn fence(order: Ordering) {\n /// Without `compiler_fence`, the `assert_eq!` in following code\n /// is *not* guaranteed to succeed, despite everything happening in a single thread.\n /// To see why, remember that the compiler is free to swap the stores to\n-/// `IMPORTANT_VARIABLE` and `IS_READ` since they are both\n+/// `IMPORTANT_VARIABLE` and `IS_READY` since they are both\n /// `Ordering::Relaxed`. If it does, and the signal handler is invoked right\n /// after `IS_READY` is updated, then the signal handler will see\n /// `IS_READY=1`, but `IMPORTANT_VARIABLE=0`."}, {"sha": "cc4ff1be563140d2b6d038ead4e0ecd07f2b499b", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -44,6 +44,7 @@\n #![feature(try_trait_v2)]\n #![feature(slice_internals)]\n #![feature(slice_partition_dedup)]\n+#![feature(int_log)]\n #![feature(iter_advance_by)]\n #![feature(iter_partition_in_place)]\n #![feature(iter_intersperse)]"}, {"sha": "9eac279733af902a334f42184e7bb22d520675fa", "filename": "library/core/tests/manually_drop.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fmanually_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fmanually_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fmanually_drop.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,6 +2,7 @@ use core::mem::ManuallyDrop;\n \n #[test]\n fn smoke() {\n+    #[derive(Clone)]\n     struct TypeWithDrop;\n     impl Drop for TypeWithDrop {\n         fn drop(&mut self) {\n@@ -16,4 +17,11 @@ fn smoke() {\n     let x: Box<ManuallyDrop<[TypeWithDrop]>> =\n         Box::new(ManuallyDrop::new([TypeWithDrop, TypeWithDrop]));\n     drop(x);\n+\n+    // test clone and clone_from implementations\n+    let mut x = ManuallyDrop::new(TypeWithDrop);\n+    let y = x.clone();\n+    x.clone_from(&y);\n+    drop(x);\n+    drop(y);\n }"}, {"sha": "99a9b17ab118369e7dcf64c495a9c0110ec784a8", "filename": "library/core/tests/num/int_log.rs", "status": "added", "additions": 99, "deletions": 0, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fnum%2Fint_log.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fnum%2Fint_log.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fnum%2Fint_log.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -0,0 +1,99 @@\n+//! This tests the `Integer::{log,log2,log10}` methods. These tests are in a\n+//! separate file because there's both a large number of them, and not all tests\n+//! can be run on Android. This is because in Android `log2` uses an imprecise\n+//! approximation:https://github.com/rust-lang/rust/blob/4825e12fc9c79954aa0fe18f5521efa6c19c7539/src/libstd/sys/unix/android.rs#L27-L53\n+\n+#[test]\n+fn checked_log() {\n+    assert_eq!(999u32.checked_log(10), Some(2));\n+    assert_eq!(1000u32.checked_log(10), Some(3));\n+    assert_eq!(555u32.checked_log(13), Some(2));\n+    assert_eq!(63u32.checked_log(4), Some(2));\n+    assert_eq!(64u32.checked_log(4), Some(3));\n+    assert_eq!(10460353203u64.checked_log(3), Some(21));\n+    assert_eq!(10460353202u64.checked_log(3), Some(20));\n+    assert_eq!(147808829414345923316083210206383297601u128.checked_log(3), Some(80));\n+    assert_eq!(147808829414345923316083210206383297600u128.checked_log(3), Some(79));\n+    assert_eq!(22528399544939174411840147874772641u128.checked_log(19683), Some(8));\n+    assert_eq!(22528399544939174411840147874772631i128.checked_log(19683), Some(7));\n+\n+    assert_eq!(0u8.checked_log(4), None);\n+    assert_eq!(0u16.checked_log(4), None);\n+    assert_eq!(0i8.checked_log(4), None);\n+    assert_eq!(0i16.checked_log(4), None);\n+\n+    for i in i16::MIN..=0 {\n+        assert_eq!(i.checked_log(4), None);\n+    }\n+    for i in 1..=i16::MAX {\n+        assert_eq!(i.checked_log(13), Some((i as f32).log(13.0) as i16));\n+    }\n+    for i in 1..=u16::MAX {\n+        assert_eq!(i.checked_log(13), Some((i as f32).log(13.0) as u16));\n+    }\n+}\n+\n+#[test]\n+fn checked_log2() {\n+    assert_eq!(5u32.checked_log2(), Some(2));\n+    assert_eq!(0u64.checked_log2(), None);\n+    assert_eq!(128i32.checked_log2(), Some(7));\n+    assert_eq!((-55i16).checked_log2(), None);\n+\n+    assert_eq!(0u8.checked_log2(), None);\n+    assert_eq!(0u16.checked_log2(), None);\n+    assert_eq!(0i8.checked_log2(), None);\n+    assert_eq!(0i16.checked_log2(), None);\n+\n+    for i in 1..=u8::MAX {\n+        assert_eq!(i.checked_log2(), Some((i as f32).log2() as u8));\n+    }\n+    for i in 1..=u16::MAX {\n+        // Guard against Android's imprecise f32::log2 implementation.\n+        if i != 8192 && i != 32768 {\n+            assert_eq!(i.checked_log2(), Some((i as f32).log2() as u16));\n+        }\n+    }\n+    for i in i8::MIN..=0 {\n+        assert_eq!(i.checked_log2(), None);\n+    }\n+    for i in 1..=i8::MAX {\n+        assert_eq!(i.checked_log2(), Some((i as f32).log2() as i8));\n+    }\n+    for i in i16::MIN..=0 {\n+        assert_eq!(i.checked_log2(), None);\n+    }\n+    for i in 1..=i16::MAX {\n+        // Guard against Android's imprecise f32::log2 implementation.\n+        if i != 8192 {\n+            assert_eq!(i.checked_log2(), Some((i as f32).log2() as i16));\n+        }\n+    }\n+}\n+\n+// Validate cases that fail on Android's imprecise float log2 implementation.\n+#[test]\n+#[cfg(not(target_os = \"android\"))]\n+fn checked_log2_not_android() {\n+    assert_eq!(8192u16.checked_log2(), Some((8192f32).log2() as u16));\n+    assert_eq!(32768u16.checked_log2(), Some((32768f32).log2() as u16));\n+    assert_eq!(8192i16.checked_log2(), Some((8192f32).log2() as i16));\n+}\n+\n+#[test]\n+fn checked_log10() {\n+    assert_eq!(0u8.checked_log10(), None);\n+    assert_eq!(0u16.checked_log10(), None);\n+    assert_eq!(0i8.checked_log10(), None);\n+    assert_eq!(0i16.checked_log10(), None);\n+\n+    for i in i16::MIN..=0 {\n+        assert_eq!(i.checked_log10(), None);\n+    }\n+    for i in 1..=i16::MAX {\n+        assert_eq!(i.checked_log10(), Some((i as f32).log10() as i16));\n+    }\n+    for i in 1..=u16::MAX {\n+        assert_eq!(i.checked_log10(), Some((i as f32).log10() as u16));\n+    }\n+}"}, {"sha": "76e838cf6bfbd2b75983a0257a82759db353cd99", "filename": "library/core/tests/num/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fnum%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fcore%2Ftests%2Fnum%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fnum%2Fmod.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -29,6 +29,7 @@ mod u8;\n mod bignum;\n mod dec2flt;\n mod flt2dec;\n+mod int_log;\n mod ops;\n mod wrapping;\n "}, {"sha": "8c120f4af288d0d0fb542515d210ffc0673964df", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -278,6 +278,7 @@\n #![feature(hashmap_internals)]\n #![feature(int_error_internals)]\n #![feature(integer_atomics)]\n+#![feature(int_log)]\n #![feature(into_future)]\n #![feature(intra_doc_pointers)]\n #![feature(iter_zip)]"}, {"sha": "da2d11604934fa118b0dfd38a158972098f51c5f", "filename": "library/std/src/thread/mod.rs", "status": "modified", "additions": 17, "deletions": 16, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Fmod.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -651,22 +651,23 @@ pub fn current() -> Thread {\n \n /// Cooperatively gives up a timeslice to the OS scheduler.\n ///\n-/// This is used when the programmer knows that the thread will have nothing\n-/// to do for some time, and thus avoid wasting computing time.\n-///\n-/// For example when polling on a resource, it is common to check that it is\n-/// available, and if not to yield in order to avoid busy waiting.\n-///\n-/// Thus the pattern of `yield`ing after a failed poll is rather common when\n-/// implementing low-level shared resources or synchronization primitives.\n-///\n-/// However programmers will usually prefer to use [`channel`]s, [`Condvar`]s,\n-/// [`Mutex`]es or [`join`] for their synchronization routines, as they avoid\n-/// thinking about thread scheduling.\n-///\n-/// Note that [`channel`]s for example are implemented using this primitive.\n-/// Indeed when you call `send` or `recv`, which are blocking, they will yield\n-/// if the channel is not available.\n+/// This calls the underlying OS scheduler's yield primitive, signaling\n+/// that the calling thread is willing to give up its remaining timeslice\n+/// so that the OS may schedule other threads on the CPU.\n+///\n+/// A drawback of yielding in a loop is that if the OS does not have any\n+/// other ready threads to run on the current CPU, the thread will effectively\n+/// busy-wait, which wastes CPU time and energy.\n+///\n+/// Therefore, when waiting for events of interest, a programmer's first\n+/// choice should be to use synchronization devices such as [`channel`]s,\n+/// [`Condvar`]s, [`Mutex`]es or [`join`] since these primitives are\n+/// implemented in a blocking manner, giving up the CPU until the event\n+/// of interest has occurred which avoids repeated yielding.\n+///\n+/// `yield_now` should thus be used only rarely, mostly in situations where\n+/// repeated polling is required because there is no other suitable way to\n+/// learn when an event of interest has occurred.\n ///\n /// # Examples\n ///"}, {"sha": "267c3964d0d692d2e8e975fa5868943a547c00fc", "filename": "src/ci/cpu-usage-over-time.py", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Fci%2Fcpu-usage-over-time.py", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Fci%2Fcpu-usage-over-time.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fcpu-usage-over-time.py?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,4 +1,4 @@\n-#!/usr/bin/env python\n+#!/usr/bin/env python3\n # ignore-tidy-linelength\n \n # This is a small script that we use on CI to collect CPU usage statistics of\n@@ -37,7 +37,10 @@\n import sys\n import time\n \n-if sys.platform == 'linux2':\n+# Python 3.3 changed the value of `sys.platform` on Linux from \"linux2\" to just\n+# \"linux\". We check here with `.startswith` to keep compatibility with older\n+# Python versions (especially Python 2.7).\n+if sys.platform.startswith('linux'):\n     class State:\n         def __init__(self):\n             with open('/proc/stat', 'r') as file:"}, {"sha": "853b4628fab2f3d1c487afcc46db4018ec9ae988", "filename": "src/ci/scripts/collect-cpu-stats.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -6,4 +6,4 @@\n set -euo pipefail\n IFS=$'\\n\\t'\n \n-python src/ci/cpu-usage-over-time.py &> cpu-usage.csv &\n+python3 src/ci/cpu-usage-over-time.py &> cpu-usage.csv &"}, {"sha": "a90f07f1e9a7fc75dc9105a6c6f16d5c13edceb0", "filename": "src/doc/book", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fbook?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit 55a26488ddefc8433e73a2e8352d70f7a5c7fc2b\n+Subproject commit a90f07f1e9a7fc75dc9105a6c6f16d5c13edceb0"}, {"sha": "5d57b3832f8d308a9f478ce0a69799548f27ad4d", "filename": "src/doc/edition-guide", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fedition-guide?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit c74b2a0d6bf55774cf15d69f05dfe05408b8f81a\n+Subproject commit 5d57b3832f8d308a9f478ce0a69799548f27ad4d"}, {"sha": "506840eb73b0749336e1d5274e16d6393892ee82", "filename": "src/doc/embedded-book", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fembedded-book?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit cbec77fbd8eea0c13e390dd9eded1ae200e811d1\n+Subproject commit 506840eb73b0749336e1d5274e16d6393892ee82"}, {"sha": "7a13537f96af4b9b8e3ea296d6e5c3c7ab72ce9f", "filename": "src/doc/nomicon", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fnomicon?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit b9ca313e687c991223e23e5520529815dc281205\n+Subproject commit 7a13537f96af4b9b8e3ea296d6e5c3c7ab72ce9f"}, {"sha": "ab60513a3a5a0591e237fddff5d027a982648392", "filename": "src/doc/reference", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Freference?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit d9699fa8f3186440fdaadd703d63d8d42322c176\n+Subproject commit ab60513a3a5a0591e237fddff5d027a982648392"}, {"sha": "028f93a61500fe8f746ee7cc6b204ea6c9f42935", "filename": "src/doc/rust-by-example", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frust-by-example?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit 805e016c5792ad2adabb66e348233067d5ea9f10\n+Subproject commit 028f93a61500fe8f746ee7cc6b204ea6c9f42935"}, {"sha": "60e282559104035985331645907c3d9f842312c5", "filename": "src/doc/rustc-dev-guide", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc-dev-guide?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1 +1 @@\n-Subproject commit fe34beddb41dea5cb891032512a8d5b842b99696\n+Subproject commit 60e282559104035985331645907c3d9f842312c5"}, {"sha": "9fff508165a1010f9fbb5afda2ef55c68f9189cd", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1358,7 +1358,10 @@ pub struct IdMap {\n \n fn init_id_map() -> FxHashMap<String, usize> {\n     let mut map = FxHashMap::default();\n-    // This is the list of IDs used by rustdoc templates.\n+    // This is the list of IDs used in Javascript.\n+    map.insert(\"help\".to_owned(), 1);\n+    // This is the list of IDs used in HTML generated in Rust (including the ones\n+    // used in tera template files).\n     map.insert(\"mainThemeStyle\".to_owned(), 1);\n     map.insert(\"themeStyle\".to_owned(), 1);\n     map.insert(\"theme-picker\".to_owned(), 1);\n@@ -1375,14 +1378,14 @@ fn init_id_map() -> FxHashMap<String, usize> {\n     map.insert(\"rustdoc-vars\".to_owned(), 1);\n     map.insert(\"sidebar-vars\".to_owned(), 1);\n     map.insert(\"copy-path\".to_owned(), 1);\n-    map.insert(\"help\".to_owned(), 1);\n     map.insert(\"TOC\".to_owned(), 1);\n-    map.insert(\"render-detail\".to_owned(), 1);\n-    // This is the list of IDs used by rustdoc sections.\n+    // This is the list of IDs used by rustdoc sections (but still generated by\n+    // rustdoc).\n     map.insert(\"fields\".to_owned(), 1);\n     map.insert(\"variants\".to_owned(), 1);\n     map.insert(\"implementors-list\".to_owned(), 1);\n     map.insert(\"synthetic-implementors-list\".to_owned(), 1);\n+    map.insert(\"foreign-impls\".to_owned(), 1);\n     map.insert(\"implementations\".to_owned(), 1);\n     map.insert(\"trait-implementations\".to_owned(), 1);\n     map.insert(\"synthetic-implementations\".to_owned(), 1);\n@@ -1393,6 +1396,10 @@ fn init_id_map() -> FxHashMap<String, usize> {\n     map.insert(\"provided-methods\".to_owned(), 1);\n     map.insert(\"implementors\".to_owned(), 1);\n     map.insert(\"synthetic-implementors\".to_owned(), 1);\n+    map.insert(\"trait-implementations-list\".to_owned(), 1);\n+    map.insert(\"synthetic-implementations-list\".to_owned(), 1);\n+    map.insert(\"blanket-implementations-list\".to_owned(), 1);\n+    map.insert(\"deref-methods\".to_owned(), 1);\n     map\n }\n "}, {"sha": "134d07c400b3abf8554504ed7f3d4f36334521d7", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.fixed", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,10 +1,10 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n use std::thread;\n \n /* Test Send Trait Migration */\n-struct SendPointer (*mut i32);\n+struct SendPointer(*mut i32);\n unsafe impl Send for SendPointer {}\n \n fn test_send_trait() {\n@@ -18,8 +18,8 @@ fn test_send_trait() {\n }\n \n /* Test Sync Trait Migration */\n-struct CustomInt (*mut i32);\n-struct SyncPointer (CustomInt);\n+struct CustomInt(*mut i32);\n+struct SyncPointer(CustomInt);\n unsafe impl Sync for SyncPointer {}\n unsafe impl Send for CustomInt {}\n \n@@ -38,7 +38,7 @@ fn test_sync_trait() {\n struct S(String);\n struct T(i32);\n \n-struct U(S,T);\n+struct U(S, T);\n \n impl Clone for U {\n     fn clone(&self) -> Self {"}, {"sha": "b48a724f052f0afb46461c91cfafa4c5b7e7d364", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,10 +1,10 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n use std::thread;\n \n /* Test Send Trait Migration */\n-struct SendPointer (*mut i32);\n+struct SendPointer(*mut i32);\n unsafe impl Send for SendPointer {}\n \n fn test_send_trait() {\n@@ -18,8 +18,8 @@ fn test_send_trait() {\n }\n \n /* Test Sync Trait Migration */\n-struct CustomInt (*mut i32);\n-struct SyncPointer (CustomInt);\n+struct CustomInt(*mut i32);\n+struct SyncPointer(CustomInt);\n unsafe impl Sync for SyncPointer {}\n unsafe impl Send for CustomInt {}\n \n@@ -38,7 +38,7 @@ fn test_sync_trait() {\n struct S(String);\n struct T(i32);\n \n-struct U(S,T);\n+struct U(S, T);\n \n impl Clone for U {\n     fn clone(&self) -> Self {"}, {"sha": "3d3dde15412bf30d2dac82f08b7c5468608f4511", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/auto_traits.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fauto_traits.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -12,8 +12,8 @@ LL | |     });\n note: the lint level is defined here\n   --> $DIR/auto_traits.rs:2:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `fptr` to be fully captured\n    |"}, {"sha": "51d9c4881af3fdec51e10e3f6aae778c01adc32a", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop.fixed", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test cases for types that implement a insignificant drop (stlib defined)\n@@ -13,9 +13,9 @@ fn test1_all_need_migration() {\n     let t2 = (String::new(), String::new());\n \n     let c = || { let _ = (&t, &t1, &t2); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n \n         let _t = t.0;\n         let _t1 = t1.0;\n@@ -33,9 +33,9 @@ fn test2_only_precise_paths_need_migration() {\n     let t2 = (String::new(), String::new());\n \n     let c = || { let _ = (&t, &t1); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -50,9 +50,9 @@ fn test3_only_by_value_need_migration() {\n     let t = (String::new(), String::new());\n     let t1 = (String::new(), String::new());\n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         println!(\"{}\", t1.1);\n     };\n@@ -69,9 +69,9 @@ fn test4_only_non_copy_types_need_migration() {\n     let t1 = (0i32, 0i32);\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n     };\n@@ -88,9 +88,9 @@ fn test5_only_drop_types_need_migration() {\n     let s = S(0i32, 0i32);\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _s = s.0;\n     };\n@@ -104,9 +104,9 @@ fn test6_move_closures_non_copy_types_might_need_migration() {\n     let t = (String::new(), String::new());\n     let t1 = (String::new(), String::new());\n     let c = move || { let _ = (&t1, &t); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n         println!(\"{} {}\", t1.1, t.1);\n     };\n \n@@ -120,9 +120,9 @@ fn test7_drop_non_drop_aggregate_need_migration() {\n     let t = (String::new(), String::new(), 0i32);\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n "}, {"sha": "c732cbb4fa51e0057cb18529f94a084ea1ce6a0e", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop.rs", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test cases for types that implement a insignificant drop (stlib defined)\n@@ -13,9 +13,9 @@ fn test1_all_need_migration() {\n     let t2 = (String::new(), String::new());\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n \n         let _t = t.0;\n         let _t1 = t1.0;\n@@ -33,9 +33,9 @@ fn test2_only_precise_paths_need_migration() {\n     let t2 = (String::new(), String::new());\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -50,9 +50,9 @@ fn test3_only_by_value_need_migration() {\n     let t = (String::new(), String::new());\n     let t1 = (String::new(), String::new());\n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         println!(\"{}\", t1.1);\n     };\n@@ -69,9 +69,9 @@ fn test4_only_non_copy_types_need_migration() {\n     let t1 = (0i32, 0i32);\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n     };\n@@ -88,9 +88,9 @@ fn test5_only_drop_types_need_migration() {\n     let s = S(0i32, 0i32);\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _s = s.0;\n     };\n@@ -104,9 +104,9 @@ fn test6_move_closures_non_copy_types_might_need_migration() {\n     let t = (String::new(), String::new());\n     let t1 = (String::new(), String::new());\n     let c = move || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n         println!(\"{} {}\", t1.1, t.1);\n     };\n \n@@ -120,9 +120,9 @@ fn test7_drop_non_drop_aggregate_need_migration() {\n     let t = (String::new(), String::new(), 0i32);\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n "}, {"sha": "89a2b0eb95366b5bd3a342433f8d3cdf668bf2f6", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -14,8 +14,8 @@ LL | |     };\n note: the lint level is defined here\n   --> $DIR/insignificant_drop.rs:3:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n    |"}, {"sha": "8c85cd990d308d865795828ab2e2703a6535442e", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop_attr_migrations.fixed", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,8 +1,7 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n-\n #![feature(rustc_attrs)]\n #![allow(unused)]\n \n@@ -36,9 +35,9 @@ fn significant_drop_needs_migration() {\n     let t = (SigDrop {}, SigDrop {});\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -54,9 +53,9 @@ fn generic_struct_with_significant_drop_needs_migration() {\n \n     // move is used to force i32 to be copied instead of being a ref\n     let c = move || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.1;\n     };\n "}, {"sha": "17cee28e3111738a78e9e85b3eb6ca3d16150974", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop_attr_migrations.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,8 +1,7 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n-\n #![feature(rustc_attrs)]\n #![allow(unused)]\n \n@@ -36,9 +35,9 @@ fn significant_drop_needs_migration() {\n     let t = (SigDrop {}, SigDrop {});\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -54,9 +53,9 @@ fn generic_struct_with_significant_drop_needs_migration() {\n \n     // move is used to force i32 to be copied instead of being a ref\n     let c = move || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.1;\n     };\n "}, {"sha": "1d3bda03d0e164923a9a869c9ef116003ad7abf3", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop_attr_migrations.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_migrations.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n error: drop order will change in Rust 2021\n-  --> $DIR/insignificant_drop_attr_migrations.rs:38:13\n+  --> $DIR/insignificant_drop_attr_migrations.rs:37:13\n    |\n LL |       let c = || {\n    |  _____________^\n@@ -13,8 +13,8 @@ LL | |     };\n note: the lint level is defined here\n   --> $DIR/insignificant_drop_attr_migrations.rs:3:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `t` to be fully captured\n    |\n@@ -27,7 +27,7 @@ LL |     };\n    |\n \n error: drop order will change in Rust 2021\n-  --> $DIR/insignificant_drop_attr_migrations.rs:56:13\n+  --> $DIR/insignificant_drop_attr_migrations.rs:55:13\n    |\n LL |       let c = move || {\n    |  _____________^"}, {"sha": "a527bf42e574a7b8ce1ccf6140980854ba9e8210", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop_attr_no_migrations.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_no_migrations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_no_migrations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop_attr_no_migrations.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-pass\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n #![feature(rustc_attrs)]\n #![allow(unused)]\n "}, {"sha": "ff5d284614bf1390d207e690b0c5bb0614ebb213", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/issue-78720.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-78720.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-78720.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-78720.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,10 +1,10 @@\n // run-pass\n \n-#![warn(disjoint_capture_migration)]\n+#![warn(rust_2021_incompatible_closure_captures)]\n \n fn main() {\n     if let a = \"\" {\n-    //~^ WARNING: irrefutable `if let` pattern\n+        //~^ WARNING: irrefutable `if let` pattern\n         drop(|_: ()| drop(a));\n     }\n }"}, {"sha": "c974299c1536bd85c516c7afbdcb42c3894cc495", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/migrations_rustfix.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test the two possible cases for automated migartion using rustfix"}, {"sha": "dd9556aa56784c1b6d7d731b9e1f5fced7218ca5", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/migrations_rustfix.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test the two possible cases for automated migartion using rustfix"}, {"sha": "2d5e5e5e55c1413cca14c6fd9fa36169ec1ac4e4", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/migrations_rustfix.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmigrations_rustfix.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -13,8 +13,8 @@ LL | |     };\n note: the lint level is defined here\n   --> $DIR/migrations_rustfix.rs:2:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `t` to be fully captured\n    |"}, {"sha": "7f49b460ef63a1f8b1d6bb5a589c1c97661cef25", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/mir_calls_to_shims.fixed", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,16 +1,20 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n // ignore-wasm32-bare compiled with panic=abort by default\n-\n #![feature(fn_traits)]\n #![feature(never_type)]\n \n use std::panic;\n \n-fn foo_diverges() -> ! { panic!() }\n+fn foo_diverges() -> ! {\n+    panic!()\n+}\n \n-fn assert_panics<F>(f: F) where F: FnOnce() {\n+fn assert_panics<F>(f: F)\n+where\n+    F: FnOnce(),\n+{\n     let f = panic::AssertUnwindSafe(f);\n     let result = panic::catch_unwind(move || { let _ = &f; \n         //~^ ERROR: `UnwindSafe`, `RefUnwindSafe` trait implementation\n@@ -23,7 +27,8 @@ fn assert_panics<F>(f: F) where F: FnOnce() {\n }\n \n fn test_fn_ptr_panic<T>(mut t: T)\n-    where T: Fn() -> !\n+where\n+    T: Fn() -> !,\n {\n     let as_fn = <T as Fn<()>>::call;\n     assert_panics(|| as_fn(&t, ()));"}, {"sha": "3c654bec52605c8f051bee736c27e84522e32fd8", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/mir_calls_to_shims.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,16 +1,20 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n // ignore-wasm32-bare compiled with panic=abort by default\n-\n #![feature(fn_traits)]\n #![feature(never_type)]\n \n use std::panic;\n \n-fn foo_diverges() -> ! { panic!() }\n+fn foo_diverges() -> ! {\n+    panic!()\n+}\n \n-fn assert_panics<F>(f: F) where F: FnOnce() {\n+fn assert_panics<F>(f: F)\n+where\n+    F: FnOnce(),\n+{\n     let f = panic::AssertUnwindSafe(f);\n     let result = panic::catch_unwind(move || {\n         //~^ ERROR: `UnwindSafe`, `RefUnwindSafe` trait implementation\n@@ -23,7 +27,8 @@ fn assert_panics<F>(f: F) where F: FnOnce() {\n }\n \n fn test_fn_ptr_panic<T>(mut t: T)\n-    where T: Fn() -> !\n+where\n+    T: Fn() -> !,\n {\n     let as_fn = <T as Fn<()>>::call;\n     assert_panics(|| as_fn(&t, ()));"}, {"sha": "dca5c454b83beaacd5fe86ade3a37c68f2ea1d33", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/mir_calls_to_shims.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fmir_calls_to_shims.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n error: `UnwindSafe`, `RefUnwindSafe` trait implementation will change in Rust 2021\n-  --> $DIR/mir_calls_to_shims.rs:15:38\n+  --> $DIR/mir_calls_to_shims.rs:19:38\n    |\n LL |       let result = panic::catch_unwind(move || {\n    |  ______________________________________^\n@@ -12,8 +12,8 @@ LL | |     });\n note: the lint level is defined here\n   --> $DIR/mir_calls_to_shims.rs:3:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `f` to be fully captured\n    |"}, {"sha": "8b75e226ab59bcf2ee64ca663b38d7913c570dac", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/no_migrations.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fno_migrations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fno_migrations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fno_migrations.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,8 +2,7 @@\n \n // Set of test cases that don't need migrations\n \n-#![deny(disjoint_capture_migration)]\n-\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n // Copy types as copied by the closure instead of being moved into the closure\n // Therefore their drop order isn't tied to the closure and won't be requiring any\n@@ -53,7 +52,6 @@ fn test4_insignificant_drop_non_drop_aggregate() {\n     c();\n }\n \n-\n struct Foo(i32);\n impl Drop for Foo {\n     fn drop(&mut self) {\n@@ -80,5 +78,4 @@ fn main() {\n     test3_only_copy_types_move_closure();\n     test4_insignificant_drop_non_drop_aggregate();\n     test5_significant_drop_non_drop_aggregate();\n-\n }"}, {"sha": "16e3cca7b7714703ae5a0e786a3f201588d5d146", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/old_name.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -0,0 +1,9 @@\n+// check-pass\n+\n+// Ensure that the old name for `rust_2021_incompatible_closure_captures` is still\n+// accepted by the compiler\n+\n+#![allow(disjoint_capture_migration)]\n+//~^ WARN lint `disjoint_capture_migration` has been renamed\n+\n+fn main() {}"}, {"sha": "47cb689fa019375a9dc785627c2dda8d6ff84926", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/old_name.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fold_name.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -0,0 +1,10 @@\n+warning: lint `disjoint_capture_migration` has been renamed to `rust_2021_incompatible_closure_captures`\n+  --> $DIR/old_name.rs:6:10\n+   |\n+LL | #![allow(disjoint_capture_migration)]\n+   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rust_2021_incompatible_closure_captures`\n+   |\n+   = note: `#[warn(renamed_and_removed_lints)]` on by default\n+\n+warning: 1 warning emitted\n+"}, {"sha": "ba5e5b573f1d66be3358e5a858e3b75cbc70a8cd", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/precise.fixed", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n #[derive(Debug)]\n struct Foo(i32);\n@@ -17,8 +17,8 @@ fn test_precise_analysis_drop_paths_not_captured_by_move() {\n     let t = ConstainsDropField(Foo(10), Foo(20));\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _t = &t.1;\n     };\n@@ -28,8 +28,7 @@ fn test_precise_analysis_drop_paths_not_captured_by_move() {\n \n struct S;\n impl Drop for S {\n-    fn drop(&mut self) {\n-    }\n+    fn drop(&mut self) {}\n }\n \n struct T(S, S);\n@@ -40,8 +39,8 @@ fn test_precise_analysis_long_path_missing() {\n     let u = U(T(S, S), T(S, S));\n \n     let c = || { let _ = &u; \n-    //~^ ERROR: drop order\n-    //~| HELP: add a dummy let to cause `u` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| HELP: add a dummy let to cause `u` to be fully captured\n         let _x = u.0.0;\n         let _x = u.0.1;\n         let _x = u.1.0;"}, {"sha": "92b6f25c80dad71a36ba919d2d02651983343a46", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/precise.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-rustfix\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n #[derive(Debug)]\n struct Foo(i32);\n@@ -17,8 +17,8 @@ fn test_precise_analysis_drop_paths_not_captured_by_move() {\n     let t = ConstainsDropField(Foo(10), Foo(20));\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         let _t = &t.1;\n     };\n@@ -28,8 +28,7 @@ fn test_precise_analysis_drop_paths_not_captured_by_move() {\n \n struct S;\n impl Drop for S {\n-    fn drop(&mut self) {\n-    }\n+    fn drop(&mut self) {}\n }\n \n struct T(S, S);\n@@ -40,8 +39,8 @@ fn test_precise_analysis_long_path_missing() {\n     let u = U(T(S, S), T(S, S));\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| HELP: add a dummy let to cause `u` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| HELP: add a dummy let to cause `u` to be fully captured\n         let _x = u.0.0;\n         let _x = u.0.1;\n         let _x = u.1.0;"}, {"sha": "2788207296f1166242c445118687fa0c1ee1d101", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/precise.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -13,8 +13,8 @@ LL | |     };\n note: the lint level is defined here\n   --> $DIR/precise.rs:3:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `t` to be fully captured\n    |\n@@ -27,7 +27,7 @@ LL |     };\n    |\n \n error: drop order will change in Rust 2021\n-  --> $DIR/precise.rs:42:13\n+  --> $DIR/precise.rs:41:13\n    |\n LL |       let c = || {\n    |  _____________^"}, {"sha": "587d71c40fc6986d06364ae4ec36c3ddd0abd517", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/precise_no_migrations.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise_no_migrations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise_no_migrations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fprecise_no_migrations.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n // run-pass\n \n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n \n #[derive(Debug)]\n struct Foo(i32);\n@@ -73,8 +73,7 @@ fn test_precise_analysis_parent_captured_2() {\n \n struct S;\n impl Drop for S {\n-    fn drop(&mut self) {\n-    }\n+    fn drop(&mut self) {}\n }\n \n struct T(S, S);"}, {"sha": "58ed2de26b3a772217a43285efe7b1cc43cf77da", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/significant_drop.fixed", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test cases for types that implement a significant drop (user defined)\n@@ -23,9 +23,9 @@ fn test1_all_need_migration() {\n     let t2 = (Foo(0), Foo(0));\n \n     let c = || { let _ = (&t, &t1, &t2); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2.0;\n@@ -42,9 +42,9 @@ fn test2_only_precise_paths_need_migration() {\n     let t2 = (Foo(0), Foo(0));\n \n     let c = || { let _ = (&t, &t1); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -59,9 +59,9 @@ fn test3_only_by_value_need_migration() {\n     let t = (Foo(0), Foo(0));\n     let t1 = (Foo(0), Foo(0));\n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         println!(\"{:?}\", t1.1);\n     };\n@@ -77,9 +77,9 @@ fn test4_type_contains_drop_need_migration() {\n     let t = ConstainsDropField(Foo(0), Foo(0));\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -93,9 +93,9 @@ fn test5_drop_non_drop_aggregate_need_migration() {\n     let t = (Foo(0), Foo(0), 0i32);\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -107,9 +107,9 @@ fn test6_significant_insignificant_drop_aggregate_need_migration() {\n     let t = (Foo(0), String::new());\n \n     let c = || { let _ = &t; \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.1;\n     };\n \n@@ -123,9 +123,9 @@ fn test7_move_closures_non_copy_types_might_need_migration() {\n     let t1 = (Foo(0), Foo(0), Foo(0));\n \n     let c = move || { let _ = (&t1, &t); \n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n         println!(\"{:?} {:?}\", t1.1, t.1);\n     };\n "}, {"sha": "0890fc1c21256046597d6d6e7850377d492772a2", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/significant_drop.rs", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n // run-rustfix\n-#![deny(disjoint_capture_migration)]\n+#![deny(rust_2021_incompatible_closure_captures)]\n //~^ NOTE: the lint level is defined here\n \n // Test cases for types that implement a significant drop (user defined)\n@@ -23,9 +23,9 @@ fn test1_all_need_migration() {\n     let t2 = (Foo(0), Foo(0));\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2.0;\n@@ -42,9 +42,9 @@ fn test2_only_precise_paths_need_migration() {\n     let t2 = (Foo(0), Foo(0));\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t`, `t1` to be fully captured\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -59,9 +59,9 @@ fn test3_only_by_value_need_migration() {\n     let t = (Foo(0), Foo(0));\n     let t1 = (Foo(0), Foo(0));\n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n         println!(\"{:?}\", t1.1);\n     };\n@@ -77,9 +77,9 @@ fn test4_type_contains_drop_need_migration() {\n     let t = ConstainsDropField(Foo(0), Foo(0));\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -93,9 +93,9 @@ fn test5_drop_non_drop_aggregate_need_migration() {\n     let t = (Foo(0), Foo(0), 0i32);\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.0;\n     };\n \n@@ -107,9 +107,9 @@ fn test6_significant_insignificant_drop_aggregate_need_migration() {\n     let t = (Foo(0), String::new());\n \n     let c = || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t` to be fully captured\n         let _t = t.1;\n     };\n \n@@ -123,9 +123,9 @@ fn test7_move_closures_non_copy_types_might_need_migration() {\n     let t1 = (Foo(0), Foo(0), Foo(0));\n \n     let c = move || {\n-    //~^ ERROR: drop order\n-    //~| NOTE: for more information, see\n-    //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n+        //~^ ERROR: drop order\n+        //~| NOTE: for more information, see\n+        //~| HELP: add a dummy let to cause `t1`, `t` to be fully captured\n         println!(\"{:?} {:?}\", t1.1, t.1);\n     };\n "}, {"sha": "ebf9f169fd400e9fe5b0da13b3792f0a39fa89b5", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/significant_drop.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -14,8 +14,8 @@ LL | |     };\n note: the lint level is defined here\n   --> $DIR/significant_drop.rs:2:9\n    |\n-LL | #![deny(disjoint_capture_migration)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_closure_captures)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: for more information, see <https://doc.rust-lang.org/nightly/edition-guide/rust-2021/disjoint-capture-in-closures.html>\n help: add a dummy let to cause `t`, `t1`, `t2` to be fully captured\n    |"}, {"sha": "e4455d86a1440b7f183c7d96582f5557bcd6d5f2", "filename": "src/test/ui/consts/const-eval/const_panic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fconst_panic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fconst_panic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fconst_panic.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n #![feature(const_panic)]\n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n #![crate_type = \"lib\"]\n \n const MSG: &str = \"hello\";"}, {"sha": "b30e9a47a13e8bc4a76d13ae3208fd458cad0445", "filename": "src/test/ui/fmt/format-args-capture.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffmt%2Fformat-args-capture.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -16,13 +16,13 @@ fn main() {\n \n fn named_argument_takes_precedence_to_captured() {\n     let foo = \"captured\";\n-    let s = format!(\"{foo}\", foo=\"named\");\n+    let s = format!(\"{foo}\", foo = \"named\");\n     assert_eq!(&s, \"named\");\n \n-    let s = format!(\"{foo}-{foo}-{foo}\", foo=\"named\");\n+    let s = format!(\"{foo}-{foo}-{foo}\", foo = \"named\");\n     assert_eq!(&s, \"named-named-named\");\n \n-    let s = format!(\"{}-{bar}-{foo}\", \"positional\", bar=\"named\");\n+    let s = format!(\"{}-{bar}-{foo}\", \"positional\", bar = \"named\");\n     assert_eq!(&s, \"positional-named-captured\");\n }\n \n@@ -42,10 +42,11 @@ fn panic_with_single_argument_does_not_get_formatted() {\n     // RFC #2795 suggests that this may need to change so that captured arguments are formatted.\n     // For stability reasons this will need to part of an edition change.\n \n-    #[allow(non_fmt_panic)]\n+    #[allow(non_fmt_panics)]\n     let msg = std::panic::catch_unwind(|| {\n         panic!(\"{foo}\");\n-    }).unwrap_err();\n+    })\n+    .unwrap_err();\n \n     assert_eq!(msg.downcast_ref::<&str>(), Some(&\"{foo}\"))\n }\n@@ -55,8 +56,9 @@ fn panic_with_multiple_arguments_is_formatted() {\n     let foo = \"captured\";\n \n     let msg = std::panic::catch_unwind(|| {\n-        panic!(\"{}-{bar}-{foo}\", \"positional\", bar=\"named\");\n-    }).unwrap_err();\n+        panic!(\"{}-{bar}-{foo}\", \"positional\", bar = \"named\");\n+    })\n+    .unwrap_err();\n \n     assert_eq!(msg.downcast_ref::<String>(), Some(&\"positional-named-captured\".to_string()))\n }"}, {"sha": "753675872b9cac6f39228a89f28785a09c18002a", "filename": "src/test/ui/macros/assert-macro-owned.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fassert-macro-owned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fassert-macro-owned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert-macro-owned.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,7 +2,7 @@\n // error-pattern:panicked at 'test-assert-owned'\n // ignore-emscripten no processes\n \n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n \n fn main() {\n     assert!(false, \"test-assert-owned\".to_string());"}, {"sha": "780e158fe0b8f8bf46fd1ee6d961fc06f68d5f5b", "filename": "src/test/ui/macros/macro-comma-behavior-rpass.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-comma-behavior-rpass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-comma-behavior-rpass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-comma-behavior-rpass.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -14,11 +14,12 @@\n // revisions: std core\n \n // ignore-wasm32-bare compiled with panic=abort by default\n-\n #![cfg_attr(core, no_std)]\n \n-#[cfg(std)] use std::fmt;\n-#[cfg(core)] use core::fmt;\n+#[cfg(core)]\n+use core::fmt;\n+#[cfg(std)]\n+use std::fmt;\n \n // an easy mistake in the implementation of 'assert!'\n // would cause this to say \"explicit panic\"\n@@ -57,7 +58,7 @@ fn writeln_1arg() {\n //\n // (Example: Issue #48042)\n #[test]\n-#[allow(non_fmt_panic)]\n+#[allow(non_fmt_panics)]\n fn to_format_or_not_to_format() {\n     // (\"{}\" is the easiest string to test because if this gets\n     // sent to format_args!, it'll simply fail to compile.\n@@ -80,13 +81,17 @@ fn to_format_or_not_to_format() {\n     // format!(\"{}\",); // see check-fail\n     // format_args!(\"{}\",); // see check-fail\n \n-    if falsum() { panic!(\"{}\",); }\n+    if falsum() {\n+        panic!(\"{}\",);\n+    }\n \n     // print!(\"{}\",); // see check-fail\n     // println!(\"{}\",); // see check-fail\n     // unimplemented!(\"{}\",); // see check-fail\n \n-    if falsum() { unreachable!(\"{}\",); }\n+    if falsum() {\n+        unreachable!(\"{}\",);\n+    }\n \n     // write!(&mut stdout, \"{}\",); // see check-fail\n     // writeln!(&mut stdout, \"{}\",); // see check-fail"}, {"sha": "b0d56e9bb1ef0a5bd97923bf1b572401c1df7e38", "filename": "src/test/ui/macros/macro-or-patterns-back-compat.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // aux-build:or-pattern.rs\n \n-#![deny(or_patterns_back_compat)]\n+#![deny(rust_2021_incompatible_or_patterns)]\n #![allow(unused_macros)]\n \n #[macro_use]"}, {"sha": "9e24b5106b8bf528fbf3b5fdfdc71745a19ac4d5", "filename": "src/test/ui/macros/macro-or-patterns-back-compat.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // aux-build:or-pattern.rs\n \n-#![deny(or_patterns_back_compat)]\n+#![deny(rust_2021_incompatible_or_patterns)]\n #![allow(unused_macros)]\n \n #[macro_use]"}, {"sha": "eb6204fa02e69221dc89aee8af589b70bbbc1d97", "filename": "src/test/ui/macros/macro-or-patterns-back-compat.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacro-or-patterns-back-compat.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL | macro_rules! foo { ($x:pat | $y:pat) => {} }\n note: the lint level is defined here\n   --> $DIR/macro-or-patterns-back-compat.rs:4:9\n    |\n-LL | #![deny(or_patterns_back_compat)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![deny(rust_2021_incompatible_or_patterns)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2015) but is a hard error in Rust 2021!\n    = note: for more information, see issue #84869 <https://github.com/rust-lang/rust/issues/84869>\n "}, {"sha": "6aa2eb174e922166af0333ce180de8478dfedc85", "filename": "src/test/ui/non-fmt-panic.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fnon-fmt-panic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fnon-fmt-panic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnon-fmt-panic.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -4,7 +4,7 @@ warning: panic message contains a brace\n LL |     panic!(\"here's a brace: {\");\n    |                             ^\n    |\n-   = note: `#[warn(non_fmt_panic)]` on by default\n+   = note: `#[warn(non_fmt_panics)]` on by default\n    = note: this message is not used as a format string, but will be in Rust 2021\n help: add a \"{}\" format string to use the message literally\n    |"}, {"sha": "9d80357873488352e8078db797eae2f0c656e43c", "filename": "src/test/ui/panics/explicit-panic-msg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fexplicit-panic-msg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fexplicit-panic-msg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Fexplicit-panic-msg.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,6 +1,6 @@\n #![allow(unused_assignments)]\n #![allow(unused_variables)]\n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n \n // run-fail\n // error-pattern:wooooo"}, {"sha": "663bf6713d090e444e8f900d3687d1e3be383a5e", "filename": "src/test/ui/panics/panic-macro-any-wrapped.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any-wrapped.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any-wrapped.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any-wrapped.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,7 +2,7 @@\n // error-pattern:panicked at 'Box<dyn Any>'\n // ignore-emscripten no processes\n \n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n \n fn main() {\n     panic!(Box::new(612_i64));"}, {"sha": "08acc6e8078f9b8df2b804ee4a30e019f34f186f", "filename": "src/test/ui/panics/panic-macro-any.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Fpanic-macro-any.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -3,7 +3,7 @@\n // ignore-emscripten no processes\n \n #![feature(box_syntax)]\n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n \n fn main() {\n     panic!(box 413 as Box<dyn std::any::Any + Send>);"}, {"sha": "c5ff0b4bcd0f8cb3bdb74fb3d3d15ca4d5316b8a", "filename": "src/test/ui/rust-2021/future-prelude-collision-imported.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // edition:2018\n // check-pass\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n #![allow(dead_code)]\n #![allow(unused_imports)]\n "}, {"sha": "cd39eec47f2a4125416440a5053eee6b50d5841f", "filename": "src/test/ui/rust-2021/future-prelude-collision-imported.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // edition:2018\n // check-pass\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n #![allow(dead_code)]\n #![allow(unused_imports)]\n "}, {"sha": "61975876819229bfbfc8fbe123f3b10a20eff4ad", "filename": "src/test/ui/rust-2021/future-prelude-collision-imported.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-imported.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL |         let _: u32 = 3u8.try_into().unwrap();\n note: the lint level is defined here\n   --> $DIR/future-prelude-collision-imported.rs:4:9\n    |\n-LL | #![warn(future_prelude_collision)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![warn(rust_2021_prelude_collisions)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2018) but is a hard error in Rust 2021!\n    = note: for more information, see issue #85684 <https://github.com/rust-lang/rust/issues/85684>\n "}, {"sha": "27891a8d11db7474a64db2b7defdedc478e0b590", "filename": "src/test/ui/rust-2021/future-prelude-collision-shadow.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-shadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-shadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-shadow.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,5 +1,5 @@\n // edition:2018\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n #![allow(dead_code)]\n #![allow(unused_imports)]\n "}, {"sha": "4be82056ad59bdab71fc3310d7ac2681f67b2d6d", "filename": "src/test/ui/rust-2021/future-prelude-collision-unneeded.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-unneeded.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-unneeded.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision-unneeded.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,12 +1,14 @@\n // edition:2018\n // check-pass\n #![allow(unused)]\n-#![deny(future_prelude_collision)]\n+#![deny(rust_2021_prelude_collisions)]\n \n struct S;\n \n impl S {\n-    fn try_into(self) -> S { S }\n+    fn try_into(self) -> S {\n+        S\n+    }\n }\n \n // See https://github.com/rust-lang/rust/issues/86633"}, {"sha": "43b0ec1c3e6a709fab2eefc5670e7c80854b67a2", "filename": "src/test/ui/rust-2021/future-prelude-collision.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // edition:2018\n // check-pass\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait TryIntoU32 {\n     fn try_into(self) -> Result<u32, ()>;"}, {"sha": "4c7a47ffbe28ac0bca9213847beb2379c63c1175", "filename": "src/test/ui/rust-2021/future-prelude-collision.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // run-rustfix\n // edition:2018\n // check-pass\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait TryIntoU32 {\n     fn try_into(self) -> Result<u32, ()>;"}, {"sha": "03b89da00d970c934ece61e64ba817bc7f7eb4c4", "filename": "src/test/ui/rust-2021/future-prelude-collision.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Ffuture-prelude-collision.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL |     let _: u32 = 3u8.try_into().unwrap();\n note: the lint level is defined here\n   --> $DIR/future-prelude-collision.rs:4:9\n    |\n-LL | #![warn(future_prelude_collision)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![warn(rust_2021_prelude_collisions)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2018) but is a hard error in Rust 2021!\n    = note: for more information, see issue #85684 <https://github.com/rust-lang/rust/issues/85684>\n "}, {"sha": "feba7d19b6615750da3f1a06fd48fee2f602c823", "filename": "src/test/ui/rust-2021/generic-type-collision.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // check-pass\n // run-rustfix\n // edition 2018\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait MyTrait<A> {\n     fn from_iter(x: Option<A>);"}, {"sha": "335e7e520a495450d8e9cc2151a1c91afbcc2a0e", "filename": "src/test/ui/rust-2021/generic-type-collision.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,7 +1,7 @@\n // check-pass\n // run-rustfix\n // edition 2018\n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait MyTrait<A> {\n     fn from_iter(x: Option<A>);"}, {"sha": "d4999201c27f962bacb9586e0d7687fe91eb296b", "filename": "src/test/ui/rust-2021/generic-type-collision.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Fgeneric-type-collision.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL |     <Vec<i32>>::from_iter(None);\n note: the lint level is defined here\n   --> $DIR/generic-type-collision.rs:4:9\n    |\n-LL | #![warn(future_prelude_collision)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![warn(rust_2021_prelude_collisions)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2015) but is a hard error in Rust 2021!\n    = note: for more information, see issue #85684 <https://github.com/rust-lang/rust/issues/85684>\n "}, {"sha": "5789a90393bae56106f04d19020c575691bbffc8", "filename": "src/test/ui/rust-2021/inherent-dyn-collision.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -5,7 +5,7 @@\n // run-rustfix\n // edition:2018\n \n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait TryIntoU32 {\n     fn try_into(&self) -> Result<u32, ()>;"}, {"sha": "a3893c033e942cf1e7c9566ca41a9bcc66ee99f4", "filename": "src/test/ui/rust-2021/inherent-dyn-collision.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -5,7 +5,7 @@\n // run-rustfix\n // edition:2018\n \n-#![warn(future_prelude_collision)]\n+#![warn(rust_2021_prelude_collisions)]\n \n trait TryIntoU32 {\n     fn try_into(&self) -> Result<u32, ()>;"}, {"sha": "605f9ced9ebb72e559a81c5ae2d35bacdce59010", "filename": "src/test/ui/rust-2021/inherent-dyn-collision.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Finherent-dyn-collision.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL |         get_dyn_trait().try_into().unwrap()\n note: the lint level is defined here\n   --> $DIR/inherent-dyn-collision.rs:8:9\n    |\n-LL | #![warn(future_prelude_collision)]\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^\n+LL | #![warn(rust_2021_prelude_collisions)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2018) but is a hard error in Rust 2021!\n    = note: for more information, see issue #85684 <https://github.com/rust-lang/rust/issues/85684>\n "}, {"sha": "507105207d695e18794c876f7c5390c0cbf890dc", "filename": "src/test/ui/rust-2021/inherent-method-collision.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-method-collision.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Finherent-method-collision.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Finherent-method-collision.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,7 +2,7 @@\n //\n // check-pass\n \n-#![deny(future_prelude_collision)]\n+#![deny(rust_2021_prelude_collisions)]\n \n pub struct MySeq {}\n "}, {"sha": "e026f01e93fb038027d0b773c7a4ff53f709e42e", "filename": "src/test/ui/rust-2021/reserved-prefixes-migration.fixed", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.fixed?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,7 +2,7 @@\n // run-rustfix\n // compile-flags: -Z unstable-options --edition 2018\n \n-#![warn(reserved_prefix)]\n+#![warn(rust_2021_prefixes_incompatible_syntax)]\n \n macro_rules! m2 {\n     ($a:tt $b:tt) => {};\n@@ -14,16 +14,16 @@ macro_rules! m3 {\n \n fn main() {\n     m2!(z \"hey\");\n-    //~^ WARNING prefix `z` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `z` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m2!(prefix \"hey\");\n-    //~^ WARNING prefix `prefix` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `prefix` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m3!(hey #123);\n-    //~^ WARNING prefix `hey` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `hey` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m3!(hey #hey);\n-    //~^ WARNING prefix `hey` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `hey` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n }\n \n@@ -33,6 +33,6 @@ macro_rules! quote {\n \n quote! {\n     #name = #kind #value\n-    //~^ WARNING prefix `kind` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `kind` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n }"}, {"sha": "d24f29634806d9d70cee029979f0a6258a7b8869", "filename": "src/test/ui/rust-2021/reserved-prefixes-migration.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2,7 +2,7 @@\n // run-rustfix\n // compile-flags: -Z unstable-options --edition 2018\n \n-#![warn(reserved_prefix)]\n+#![warn(rust_2021_prefixes_incompatible_syntax)]\n \n macro_rules! m2 {\n     ($a:tt $b:tt) => {};\n@@ -14,16 +14,16 @@ macro_rules! m3 {\n \n fn main() {\n     m2!(z\"hey\");\n-    //~^ WARNING prefix `z` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `z` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m2!(prefix\"hey\");\n-    //~^ WARNING prefix `prefix` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `prefix` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m3!(hey#123);\n-    //~^ WARNING prefix `hey` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `hey` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n     m3!(hey#hey);\n-    //~^ WARNING prefix `hey` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `hey` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n }\n \n@@ -33,6 +33,6 @@ macro_rules! quote {\n \n quote! {\n     #name = #kind#value\n-    //~^ WARNING prefix `kind` is unknown [reserved_prefix]\n+    //~^ WARNING prefix `kind` is unknown [rust_2021_prefixes_incompatible_syntax]\n     //~| WARNING hard error in Rust 2021\n }"}, {"sha": "95105f932dcbd945f9777fba6c998e96b5952550", "filename": "src/test/ui/rust-2021/reserved-prefixes-migration.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2021%2Freserved-prefixes-migration.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -7,8 +7,8 @@ LL |     m2!(z\"hey\");\n note: the lint level is defined here\n   --> $DIR/reserved-prefixes-migration.rs:5:9\n    |\n-LL | #![warn(reserved_prefix)]\n-   |         ^^^^^^^^^^^^^^^\n+LL | #![warn(rust_2021_prefixes_incompatible_syntax)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = warning: this is accepted in the current edition (Rust 2018) but is a hard error in Rust 2021!\n    = note: for more information, see issue #84978 <https://github.com/rust-lang/rust/issues/84978>\n help: insert whitespace here to avoid this being parsed as a prefix in Rust 2021"}, {"sha": "421614057c577771c457fc6e129f071ed68e2de3", "filename": "src/tools/clippy/CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2FCHANGELOG.md?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -592,7 +592,7 @@ Released 2021-02-11\n \n * Previously deprecated [`str_to_string`] and [`string_to_string`] have been un-deprecated\n   as `restriction` lints [#6333](https://github.com/rust-lang/rust-clippy/pull/6333)\n-* Deprecate `panic_params` lint. This is now available in rustc as `non_fmt_panic`\n+* Deprecate `panic_params` lint. This is now available in rustc as `non_fmt_panics`\n   [#6351](https://github.com/rust-lang/rust-clippy/pull/6351)\n * Move [`map_err_ignore`] to `restriction`\n   [#6416](https://github.com/rust-lang/rust-clippy/pull/6416)"}, {"sha": "c29b3e7c74c2c113fd85fbd0893d52ab4aad2f30", "filename": "src/tools/clippy/clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -2171,7 +2171,7 @@ pub fn register_renamed(ls: &mut rustc_lint::LintStore) {\n     ls.register_renamed(\"clippy::unused_label\", \"unused_labels\");\n     ls.register_renamed(\"clippy::drop_bounds\", \"drop_bounds\");\n     ls.register_renamed(\"clippy::temporary_cstring_as_ptr\", \"temporary_cstring_as_ptr\");\n-    ls.register_renamed(\"clippy::panic_params\", \"non_fmt_panic\");\n+    ls.register_renamed(\"clippy::panic_params\", \"non_fmt_panics\");\n     ls.register_renamed(\"clippy::unknown_clippy_lints\", \"unknown_lints\");\n }\n "}, {"sha": "2180f848d62cd256f7538d100d6cf5c634398ec2", "filename": "src/tools/clippy/tests/ui/assertions_on_constants.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fassertions_on_constants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fassertions_on_constants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fassertions_on_constants.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -1,4 +1,4 @@\n-#![allow(non_fmt_panic)]\n+#![allow(non_fmt_panics)]\n \n macro_rules! assert_const {\n     ($len:expr) => {"}, {"sha": "c0002e5354310ab9bcc32c2f0753e534c02ff9eb", "filename": "src/tools/clippy/tests/ui/deprecated.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fdeprecated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fdeprecated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fdeprecated.stderr?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -60,11 +60,11 @@ error: lint `clippy::temporary_cstring_as_ptr` has been renamed to `temporary_cs\n LL | #[warn(clippy::temporary_cstring_as_ptr)]\n    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `temporary_cstring_as_ptr`\n \n-error: lint `clippy::panic_params` has been renamed to `non_fmt_panic`\n+error: lint `clippy::panic_params` has been renamed to `non_fmt_panics`\n   --> $DIR/deprecated.rs:11:8\n    |\n LL | #[warn(clippy::panic_params)]\n-   |        ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `non_fmt_panic`\n+   |        ^^^^^^^^^^^^^^^^^^^^ help: use the new name: `non_fmt_panics`\n \n error: lint `clippy::unknown_clippy_lints` has been renamed to `unknown_lints`\n   --> $DIR/deprecated.rs:12:8"}, {"sha": "e5c7f1257123801d48a39812cfb003967342ee6d", "filename": "src/tools/lint-docs/src/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Flint-docs%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c5e344f7747dbd7e7d4b209e3c480deb5979a56f/src%2Ftools%2Flint-docs%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flint-docs%2Fsrc%2Flib.rs?ref=c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "patch": "@@ -467,7 +467,9 @@ fn lint_name(line: &str) -> Result<String, &'static str> {\n                 return Err(\"lint name should end with comma\");\n             }\n             let name = &name[..name.len() - 1];\n-            if !name.chars().all(|ch| ch.is_uppercase() || ch == '_') || name.is_empty() {\n+            if !name.chars().all(|ch| ch.is_uppercase() || ch.is_ascii_digit() || ch == '_')\n+                || name.is_empty()\n+            {\n                 return Err(\"lint name did not have expected format\");\n             }\n             Ok(name.to_lowercase().to_string())"}]}