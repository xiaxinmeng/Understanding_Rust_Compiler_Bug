{"sha": "e075586d4fd428374a788eecc391e23ec4a17b46", "node_id": "C_kwDOAAsO6NoAKGUwNzU1ODZkNGZkNDI4Mzc0YTc4OGVlY2MzOTFlMjNlYzRhMTdiNDY", "commit": {"author": {"name": "cynecx", "email": "me@cynecx.net", "date": "2022-02-07T00:21:23Z"}, "committer": {"name": "cynecx", "email": "me@cynecx.net", "date": "2022-02-07T00:21:23Z"}, "message": "add tests and fix comments", "tree": {"sha": "19b6ae50a00420b9dc690d7722e231ebbdce612a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/19b6ae50a00420b9dc690d7722e231ebbdce612a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e075586d4fd428374a788eecc391e23ec4a17b46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e075586d4fd428374a788eecc391e23ec4a17b46", "html_url": "https://github.com/rust-lang/rust/commit/e075586d4fd428374a788eecc391e23ec4a17b46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e075586d4fd428374a788eecc391e23ec4a17b46/comments", "author": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03733ca65a09a9b54b2c2a674e4145b165bd1cab", "url": "https://api.github.com/repos/rust-lang/rust/commits/03733ca65a09a9b54b2c2a674e4145b165bd1cab", "html_url": "https://github.com/rust-lang/rust/commit/03733ca65a09a9b54b2c2a674e4145b165bd1cab"}], "stats": {"total": 44, "additions": 41, "deletions": 3}, "files": [{"sha": "0908e9d1ef9054152def2546e51ff129c8566f91", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e075586d4fd428374a788eecc391e23ec4a17b46/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e075586d4fd428374a788eecc391e23ec4a17b46/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=e075586d4fd428374a788eecc391e23ec4a17b46", "patch": "@@ -533,8 +533,8 @@ declare_features! (\n     ///\n     /// NOTE: A limited form of `union U { ... }` was accepted in 1.19.0.\n     (active, untagged_unions, \"1.13.0\", Some(55149), None),\n-    /// Allows using the `#[used(retain)]` attribute.\n-    (active, used_with_arg, \"1.60.0\", None, None),\n+    /// Allows using the `#[used(linker)]` (or `#[used(compiler)]`) attribute.\n+    (active, used_with_arg, \"1.60.0\", Some(00000), None),\n     /// Allows `extern \"wasm\" fn`\n     (active, wasm_abi, \"1.53.0\", Some(83788), None),\n     // !!!!    !!!!    !!!!    !!!!   !!!!    !!!!    !!!!    !!!!    !!!!    !!!!    !!!!"}, {"sha": "13b482cb469bd8be12767d382beca86c71d5c4bd", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e075586d4fd428374a788eecc391e23ec4a17b46/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e075586d4fd428374a788eecc391e23ec4a17b46/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=e075586d4fd428374a788eecc391e23ec4a17b46", "patch": "@@ -324,7 +324,7 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n     ungated!(export_name, Normal, template!(NameValueStr: \"name\"), FutureWarnPreceding),\n     ungated!(link_section, Normal, template!(NameValueStr: \"name\"), FutureWarnPreceding),\n     ungated!(no_mangle, Normal, template!(Word), WarnFollowing),\n-    ungated!(used, Normal, template!(Word, List: \"used\"), WarnFollowing),\n+    ungated!(used, Normal, template!(Word, List: \"compiler|linker\"), WarnFollowing),\n \n     // Limits:\n     ungated!(recursion_limit, CrateLevel, template!(NameValueStr: \"N\"), FutureWarnFollowing),"}, {"sha": "cd759b167c0df9c99d68a26ffe9bf2e3f37a565c", "filename": "src/test/codegen/used_with_arg.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fcodegen%2Fused_with_arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fcodegen%2Fused_with_arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fused_with_arg.rs?ref=e075586d4fd428374a788eecc391e23ec4a17b46", "patch": "@@ -0,0 +1,12 @@\n+// compile-flags: -O\n+\n+#![crate_type = \"lib\"]\n+#![feature(used_with_arg)]\n+\n+// CHECK: @llvm.used = appending global [1 x i8*]\n+#[used(linker)]\n+static mut USED_LINKER: [usize; 1] = [0];\n+\n+// CHECK-NEXT: @llvm.compiler.used = appending global [1 x i8*]\n+#[used(compiler)]\n+static mut USED_COMPILER: [usize; 1] = [0];"}, {"sha": "1c8f01bdef116b62b37e21d02f7b864aba5ff206", "filename": "src/test/ui/feature-gates/feature-gate-used_with_arg.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.rs?ref=e075586d4fd428374a788eecc391e23ec4a17b46", "patch": "@@ -0,0 +1,7 @@\n+#[used(linker)] //~ ERROR `#[used(linker)]` is currently unstable\n+static mut USED_LINKER: [usize; 1] = [0];\n+\n+#[used(compiler)] //~ ERROR `#[used(compiler)]` is currently unstable\n+static mut USED_COMPILER: [usize; 1] = [0];\n+\n+fn main() {}"}, {"sha": "aaf4ceaf7953761d9945064b81ee2a50d8399cb4", "filename": "src/test/ui/feature-gates/feature-gate-used_with_arg.stderr", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e075586d4fd428374a788eecc391e23ec4a17b46/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-used_with_arg.stderr?ref=e075586d4fd428374a788eecc391e23ec4a17b46", "patch": "@@ -0,0 +1,19 @@\n+error[E0658]: `#[used(linker)]` is currently unstable\n+  --> $DIR/feature-gate-used_with_arg.rs:1:1\n+   |\n+LL | #[used(linker)]\n+   | ^^^^^^^^^^^^^^^\n+   |\n+   = help: add `#![feature(used_with_arg)]` to the crate attributes to enable\n+\n+error[E0658]: `#[used(compiler)]` is currently unstable\n+  --> $DIR/feature-gate-used_with_arg.rs:4:1\n+   |\n+LL | #[used(compiler)]\n+   | ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: add `#![feature(used_with_arg)]` to the crate attributes to enable\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0658`."}]}