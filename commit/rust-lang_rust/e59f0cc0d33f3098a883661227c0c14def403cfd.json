{"sha": "e59f0cc0d33f3098a883661227c0c14def403cfd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1OWYwY2MwZDMzZjMwOThhODgzNjYxMjI3YzBjMTRkZWY0MDNjZmQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-20T18:00:34Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-05-22T14:46:36Z"}, "message": "Bump compiler-builtins to 0.1.15\n\nThis commit bumps the `compiler-builtins` dependency to 0.1.15 which\nexpects to have the source for `compiler-rt` provided externally if the\n`c` feature is enabled. This then plumbs through the necessary support\nin the build system to ensure that if the `llvm-project` directory is\nchecked out and present that we enable the `c` feature of\n`compiler-builtins` and compile in all the C intrinsics.", "tree": {"sha": "db105ba1cbd8c60bbdcca29cb40fc2171204f63e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db105ba1cbd8c60bbdcca29cb40fc2171204f63e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e59f0cc0d33f3098a883661227c0c14def403cfd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e59f0cc0d33f3098a883661227c0c14def403cfd", "html_url": "https://github.com/rust-lang/rust/commit/e59f0cc0d33f3098a883661227c0c14def403cfd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e59f0cc0d33f3098a883661227c0c14def403cfd/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37ff5d388f8c004ca248adb635f1cc84d347eda0", "url": "https://api.github.com/repos/rust-lang/rust/commits/37ff5d388f8c004ca248adb635f1cc84d347eda0", "html_url": "https://github.com/rust-lang/rust/commit/37ff5d388f8c004ca248adb635f1cc84d347eda0"}], "stats": {"total": 81, "additions": 53, "deletions": 28}, "files": [{"sha": "b651faac90281fc91b3f8841920634db87495337", "filename": "Cargo.lock", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/e59f0cc0d33f3098a883661227c0c14def403cfd/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e59f0cc0d33f3098a883661227c0c14def403cfd/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -25,7 +25,7 @@ dependencies = [\n name = \"alloc\"\n version = \"0.0.0\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n  \"rand 0.6.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rand_xorshift 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -123,7 +123,7 @@ version = \"0.1.27\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-std-workspace-core 1.0.0\",\n ]\n@@ -462,7 +462,7 @@ dependencies = [\n \n [[package]]\n name = \"compiler_builtins\"\n-version = \"0.1.14\"\n+version = \"0.1.15\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -744,7 +744,7 @@ name = \"dlmalloc\"\n version = \"0.1.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-std-workspace-core 1.0.0\",\n ]\n@@ -910,7 +910,7 @@ name = \"fortanix-sgx-abi\"\n version = \"0.3.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-std-workspace-core 1.0.0\",\n ]\n \n@@ -1071,7 +1071,7 @@ name = \"hashbrown\"\n version = \"0.3.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-std-workspace-alloc 1.0.0\",\n  \"rustc-std-workspace-core 1.0.0\",\n ]\n@@ -1772,7 +1772,7 @@ dependencies = [\n name = \"panic_abort\"\n version = \"0.0.0\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -1782,7 +1782,7 @@ name = \"panic_unwind\"\n version = \"0.0.0\"\n dependencies = [\n  \"alloc 0.0.0\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unwind 0.0.0\",\n@@ -1967,7 +1967,7 @@ name = \"profiler_builtins\"\n version = \"0.0.0\"\n dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n ]\n \n@@ -2492,7 +2492,7 @@ name = \"rustc-demangle\"\n version = \"0.1.10\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-std-workspace-core 1.0.0\",\n ]\n \n@@ -2620,7 +2620,7 @@ dependencies = [\n  \"alloc 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n ]\n \n@@ -2850,7 +2850,7 @@ dependencies = [\n  \"alloc 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n ]\n \n@@ -2912,7 +2912,7 @@ dependencies = [\n  \"alloc 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n ]\n \n@@ -3029,7 +3029,7 @@ dependencies = [\n  \"alloc 0.0.0\",\n  \"build_helper 0.1.0\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n ]\n \n@@ -3298,7 +3298,7 @@ dependencies = [\n  \"alloc 0.0.0\",\n  \"backtrace-sys 0.1.27 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n  \"dlmalloc 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"fortanix-sgx-abi 0.3.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -3889,7 +3889,7 @@ name = \"unwind\"\n version = \"0.0.0\"\n dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"core 0.0.0\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -4087,7 +4087,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum colored 1.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b0aa3473e85a3161b59845d6096b289bb577874cafeaf75ea1b1beaa6572c7fc\"\n \"checksum commoncrypto 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d056a8586ba25a1e4d61cb090900e495952c7886786fc55f909ab2f819b69007\"\n \"checksum commoncrypto-sys 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1fed34f46747aa73dfaa578069fd8279d2818ade2b55f38f22a9401c7f4083e2\"\n-\"checksum compiler_builtins 0.1.14 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e3f235c329e5cb9fa3d2ca2cc36256ba9a7f23fa76e0f4db6f68c23b73b2ac69\"\n+\"checksum compiler_builtins 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e899b947d7e71c3d35c0b6194d64025b84946640510e215090c815b20828964e\"\n \"checksum compiletest_rs 0.3.22 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f40ecc9332b68270998995c00f8051ee856121764a0d3230e64c9efd059d27b6\"\n \"checksum constant_time_eq 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8ff012e225ce166d4422e0e78419d901719760f62ae2b7969ca6b564d1b54a9e\"\n \"checksum core-foundation 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4e2640d6d0bf22e82bed1b73c6aef8d5dd31e5abe6666c57e6d45e2649f4f887\""}, {"sha": "2da5e1c5902c11deadf028842a0b1d3d34c59b8e", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -161,7 +161,33 @@ pub fn std_cargo(builder: &Builder<'_>,\n         cargo.env(\"MACOSX_DEPLOYMENT_TARGET\", target);\n     }\n \n+    // Determine if we're going to compile in optimized C intrinsics to\n+    // the `compiler-builtins` crate. These intrinsics live in LLVM's\n+    // `compiler-rt` repository, but our `src/llvm-project` submodule isn't\n+    // always checked out, so we need to conditionally look for this. (e.g. if\n+    // an external LLVM is used we skip the LLVM submodule checkout).\n+    //\n+    // Note that this shouldn't affect the correctness of `compiler-builtins`,\n+    // but only its speed. Some intrinsics in C haven't been translated to Rust\n+    // yet but that's pretty rare. Other intrinsics have optimized\n+    // implementations in C which have only had slower versions ported to Rust,\n+    // so we favor the C version where we can, but it's not critical.\n+    //\n+    // If `compiler-rt` is available ensure that the `c` feature of the\n+    // `compiler-builtins` crate is enabled and it's configured to learn where\n+    // `compiler-rt` is located.\n+    let compiler_builtins_root = builder.src.join(\"src/llvm-project/compiler-rt\");\n+    let compiler_builtins_c_feature = if compiler_builtins_root.exists() {\n+        cargo.env(\"RUST_COMPILER_RT_ROOT\", &compiler_builtins_root);\n+        \" compiler-builtins-c\".to_string()\n+    } else {\n+        String::new()\n+    };\n+\n     if builder.no_std(target) == Some(true) {\n+        let mut features = \"compiler-builtins-mem\".to_string();\n+        features.push_str(&compiler_builtins_c_feature);\n+\n         // for no-std targets we only compile a few no_std crates\n         cargo\n             .args(&[\"-p\", \"alloc\"])\n@@ -170,7 +196,8 @@ pub fn std_cargo(builder: &Builder<'_>,\n             .arg(\"--features\")\n             .arg(\"compiler-builtins-mem compiler-builtins-c\");\n     } else {\n-        let features = builder.std_features();\n+        let mut features = builder.std_features();\n+        features.push_str(&compiler_builtins_c_feature);\n \n         if compiler.stage != 0 && builder.config.sanitizers {\n             // This variable is used by the sanitizer runtime crates, e.g."}, {"sha": "8b00c1d81b08c4b6baf841b8c94d7b9daa2d5312", "filename": "src/build_helper/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Fbuild_helper%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Fbuild_helper%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbuild_helper%2Flib.rs?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -288,9 +288,9 @@ pub fn sanitizer_lib_boilerplate(sanitizer_name: &str)\n     } else {\n         format!(\"static={}\", link_name)\n     };\n-    // The source for `compiler-rt` comes from the `compiler-builtins` crate, so\n-    // load our env var set by cargo to find the source code.\n-    let dir = env::var_os(\"DEP_COMPILER_RT_COMPILER_RT\").unwrap();\n+    // This env var is provided by rustbuild to tell us where `compiler-rt`\n+    // lives.\n+    let dir = env::var_os(\"RUST_COMPILER_RT_ROOT\").unwrap();\n     let lib = native_lib_boilerplate(\n         dir.as_ref(),\n         sanitizer_name,"}, {"sha": "491986480deba1082cce16d4b955915c2bce3121", "filename": "src/libprofiler_builtins/build.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Flibprofiler_builtins%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Flibprofiler_builtins%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibprofiler_builtins%2Fbuild.rs?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -57,9 +57,7 @@ fn main() {\n         cfg.define(\"COMPILER_RT_HAS_ATOMICS\", Some(\"1\"));\n     }\n \n-    // The source for `compiler-rt` comes from the `compiler-builtins` crate, so\n-    // load our env var set by cargo to find the source code.\n-    let root = env::var_os(\"DEP_COMPILER_RT_COMPILER_RT\").unwrap();\n+    let root = env::var_os(\"RUST_COMPILER_RT_ROOT\").unwrap();\n     let root = Path::new(&root);\n \n     for src in profile_sources {"}, {"sha": "c4c1170e539ae6c213f5a52a9a6f13971f4c3f04", "filename": "src/libstd/Cargo.toml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Flibstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e59f0cc0d33f3098a883661227c0c14def403cfd/src%2Flibstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2FCargo.toml?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -19,7 +19,7 @@ panic_unwind = { path = \"../libpanic_unwind\", optional = true }\n panic_abort = { path = \"../libpanic_abort\" }\n core = { path = \"../libcore\" }\n libc = { version = \"0.2.51\", default-features = false, features = ['rustc-dep-of-std'] }\n-compiler_builtins = { version = \"0.1.14\" }\n+compiler_builtins = { version = \"0.1.15\" }\n profiler_builtins = { path = \"../libprofiler_builtins\", optional = true }\n unwind = { path = \"../libunwind\" }\n hashbrown = { version = \"0.3.0\", features = ['rustc-dep-of-std'] }\n@@ -49,12 +49,12 @@ fortanix-sgx-abi = { version = \"0.3.2\", features = ['rustc-dep-of-std'] }\n cc = \"1.0\"\n \n [features]\n-default = [\"compiler_builtins_c\", \"std_detect_file_io\", \"std_detect_dlsym_getauxval\"]\n+default = [\"std_detect_file_io\", \"std_detect_dlsym_getauxval\"]\n \n backtrace = [\"backtrace-sys\"]\n panic-unwind = [\"panic_unwind\"]\n profiler = [\"profiler_builtins\"]\n-compiler_builtins_c = [\"alloc/compiler-builtins-c\"]\n+compiler-builtins-c = [\"alloc/compiler-builtins-c\"]\n llvm-libunwind = [\"unwind/llvm-libunwind\"]\n \n # Make panics and failed asserts immediately abort without formatting any message"}, {"sha": "4efebe31651d5520bcba968878dbb8a4971d2045", "filename": "src/llvm-project", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fllvm-project?ref=e59f0cc0d33f3098a883661227c0c14def403cfd", "patch": "@@ -1 +1 @@\n-Subproject commit 2c5656ae593851d0b2336a727cc14b77a06b8ac0\n+Subproject commit 4efebe31651d5520bcba968878dbb8a4971d2045"}]}