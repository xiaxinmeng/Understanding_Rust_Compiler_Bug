{"sha": "eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "node_id": "C_kwDOAAsO6NoAKGViNjkwOTBlN2IwMmUxMWZiNzRkOTU2MGZhOTg3M2MzYTJmZGVmYTg", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-10-17T16:18:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-17T16:18:56Z"}, "message": "Rollup merge of #89888 - rusticstuff:download-ci-llvm-apple-arm64, r=Mark-Simulacrum\n\nMake `llvm.download-ci-llvm=\"if-available\"` work for tier 2 targets with host tools\n\n`llvm.download-ci-llvm=\"if-available\"` is used for most profiles configured via `x.py setup`. It allows downloading prebuilt LLVM tarballs from the CI artifacts for a configured list of platforms. Currently this list is restricted to tier 1 targets but it makes sense for all tier 2 targets with host tools.", "tree": {"sha": "9935b41d5262eb3ff60b5bbbddb8a3b3b95a76cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9935b41d5262eb3ff60b5bbbddb8a3b3b95a76cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhbEzwCRBK7hj4Ov3rIwAA3K8IAKRepT5PoifEpx7LKV8RdtKF\niPWL8o0txQaZqPfDLeZmTYD4vGca5q3EF37dNZrxUDNH5ooYfx3p5AY85NI2izTX\nND3tVBiYZlUSLCV27VX1Cd1PTJYrDhkoXOJLdunodc8TCEUI4+kEyOZLcfQeyYGH\nrOWD9JCtLLQdr8xQ9llu/1dDT/SY/gpL+QGcZtP4YA9kXciNfNyQRnQTbu0IogR0\nSRwvCd6wEDZ87e5fKW3MR9L/MJFwvNsITABu/Kn3B+kBkTMQOFhD58bTK3kBOYFn\nnrfWKurIgMXJnzV5OC9VhYH85rXm8H+MC2MEMTCeemHJdEWHiWVaEEU80yQ0dnk=\n=w9D+\n-----END PGP SIGNATURE-----\n", "payload": "tree 9935b41d5262eb3ff60b5bbbddb8a3b3b95a76cd\nparent 59dc2187adebcbe6fca9073b5410c51c64915f95\nparent ac298c9181a93a2fa8a041d9902a555a92faab6b\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1634487536 +0200\ncommitter GitHub <noreply@github.com> 1634487536 +0200\n\nRollup merge of #89888 - rusticstuff:download-ci-llvm-apple-arm64, r=Mark-Simulacrum\n\nMake `llvm.download-ci-llvm=\"if-available\"` work for tier 2 targets with host tools\n\n`llvm.download-ci-llvm=\"if-available\"` is used for most profiles configured via `x.py setup`. It allows downloading prebuilt LLVM tarballs from the CI artifacts for a configured list of platforms. Currently this list is restricted to tier 1 targets but it makes sense for all tier 2 targets with host tools.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "html_url": "https://github.com/rust-lang/rust/commit/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59dc2187adebcbe6fca9073b5410c51c64915f95", "url": "https://api.github.com/repos/rust-lang/rust/commits/59dc2187adebcbe6fca9073b5410c51c64915f95", "html_url": "https://github.com/rust-lang/rust/commit/59dc2187adebcbe6fca9073b5410c51c64915f95"}, {"sha": "ac298c9181a93a2fa8a041d9902a555a92faab6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac298c9181a93a2fa8a041d9902a555a92faab6b", "html_url": "https://github.com/rust-lang/rust/commit/ac298c9181a93a2fa8a041d9902a555a92faab6b"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "dc1447b4ae4d157e97367faa551432dfa6ba2718", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "patch": "@@ -492,10 +492,11 @@ def download_toolchain(self, stage0=True, rustc_channel=None):\n \n     def downloading_llvm(self):\n         opt = self.get_toml('download-ci-llvm', 'llvm')\n-        # This is currently all tier 1 targets (since others may not have CI\n-        # artifacts)\n+        # This is currently all tier 1 targets and tier 2 targets with host tools\n+        # (since others may not have CI artifacts)\n         # https://doc.rust-lang.org/rustc/platform-support.html#tier-1\n         supported_platforms = [\n+            # tier 1\n             \"aarch64-unknown-linux-gnu\",\n             \"i686-pc-windows-gnu\",\n             \"i686-pc-windows-msvc\",\n@@ -504,6 +505,26 @@ def downloading_llvm(self):\n             \"x86_64-apple-darwin\",\n             \"x86_64-pc-windows-gnu\",\n             \"x86_64-pc-windows-msvc\",\n+            # tier 2 with host tools\n+            \"aarch64-apple-darwin\",\n+            \"aarch64-pc-windows-msvc\",\n+            \"aarch64-unknown-linux-musl\",\n+            \"arm-unknown-linux-gnueabi\",\n+            \"arm-unknown-linux-gnueabihf\",\n+            \"armv7-unknown-linux-gnueabihf\",\n+            \"mips-unknown-linux-gnu\",\n+            \"mips64-unknown-linux-gnuabi64\",\n+            \"mips64el-unknown-linux-gnuabi64\",\n+            \"mipsel-unknown-linux-gnu\",\n+            \"powerpc-unknown-linux-gnu\",\n+            \"powerpc64-unknown-linux-gnu\",\n+            \"powerpc64le-unknown-linux-gnu\",\n+            \"riscv64gc-unknown-linux-gnu\",\n+            \"s390x-unknown-linux-gnu\",\n+            \"x86_64-unknown-freebsd\",\n+            \"x86_64-unknown-illumos\",\n+            \"x86_64-unknown-linux-musl\",\n+            \"x86_64-unknown-netbsd\",\n         ]\n         return opt == \"true\" \\\n             or (opt == \"if-available\" and self.build in supported_platforms)"}, {"sha": "9a48b768cb37db8a39c790288b949447c93a5cc7", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb69090e7b02e11fb74d9560fa9873c3a2fdefa8/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=eb69090e7b02e11fb74d9560fa9873c3a2fdefa8", "patch": "@@ -765,10 +765,12 @@ impl Config {\n             config.llvm_from_ci = match llvm.download_ci_llvm {\n                 Some(StringOrBool::String(s)) => {\n                     assert!(s == \"if-available\", \"unknown option `{}` for download-ci-llvm\", s);\n-                    // This is currently all tier 1 targets (since others may not have CI artifacts)\n+                    // This is currently all tier 1 targets and tier 2 targets with host tools\n+                    // (since others may not have CI artifacts)\n                     // https://doc.rust-lang.org/rustc/platform-support.html#tier-1\n                     // FIXME: this is duplicated in bootstrap.py\n                     let supported_platforms = [\n+                        // tier 1\n                         \"aarch64-unknown-linux-gnu\",\n                         \"i686-pc-windows-gnu\",\n                         \"i686-pc-windows-msvc\",\n@@ -777,6 +779,26 @@ impl Config {\n                         \"x86_64-apple-darwin\",\n                         \"x86_64-pc-windows-gnu\",\n                         \"x86_64-pc-windows-msvc\",\n+                        // tier 2 with host tools\n+                        \"aarch64-apple-darwin\",\n+                        \"aarch64-pc-windows-msvc\",\n+                        \"aarch64-unknown-linux-musl\",\n+                        \"arm-unknown-linux-gnueabi\",\n+                        \"arm-unknown-linux-gnueabihf\",\n+                        \"armv7-unknown-linux-gnueabihf\",\n+                        \"mips-unknown-linux-gnu\",\n+                        \"mips64-unknown-linux-gnuabi64\",\n+                        \"mips64el-unknown-linux-gnuabi64\",\n+                        \"mipsel-unknown-linux-gnu\",\n+                        \"powerpc-unknown-linux-gnu\",\n+                        \"powerpc64-unknown-linux-gnu\",\n+                        \"powerpc64le-unknown-linux-gnu\",\n+                        \"riscv64gc-unknown-linux-gnu\",\n+                        \"s390x-unknown-linux-gnu\",\n+                        \"x86_64-unknown-freebsd\",\n+                        \"x86_64-unknown-illumos\",\n+                        \"x86_64-unknown-linux-musl\",\n+                        \"x86_64-unknown-netbsd\",\n                     ];\n                     supported_platforms.contains(&&*config.build.triple)\n                 }"}]}