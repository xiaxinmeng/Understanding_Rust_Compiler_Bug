{"sha": "3d6ee0a14b351dd1f93025a199966d3661a33037", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkNmVlMGExNGIzNTFkZDFmOTMwMjVhMTk5OTY2ZDM2NjFhMzMwMzc=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2017-05-09T18:43:48Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2017-05-15T04:06:23Z"}, "message": "Force tool-rust-installer deps to build-only", "tree": {"sha": "fa017cb494f9b5350ccc2256cd9281a4e35a39c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa017cb494f9b5350ccc2256cd9281a4e35a39c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d6ee0a14b351dd1f93025a199966d3661a33037", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d6ee0a14b351dd1f93025a199966d3661a33037", "html_url": "https://github.com/rust-lang/rust/commit/3d6ee0a14b351dd1f93025a199966d3661a33037", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d6ee0a14b351dd1f93025a199966d3661a33037/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6edb4e22c46ae34b5b8ee0f2672f02d890944105", "url": "https://api.github.com/repos/rust-lang/rust/commits/6edb4e22c46ae34b5b8ee0f2672f02d890944105", "html_url": "https://github.com/rust-lang/rust/commit/6edb4e22c46ae34b5b8ee0f2672f02d890944105"}], "stats": {"total": 26, "additions": 17, "deletions": 9}, "files": [{"sha": "92666e8e63907caec309922aae24759a968fdd33", "filename": "src/bootstrap/step.rs", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3d6ee0a14b351dd1f93025a199966d3661a33037/src%2Fbootstrap%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d6ee0a14b351dd1f93025a199966d3661a33037/src%2Fbootstrap%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fstep.rs?ref=3d6ee0a14b351dd1f93025a199966d3661a33037", "patch": "@@ -708,7 +708,7 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n          .host(true)\n          .only_host_build(true)\n          .default(true)\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::rustc(build, s.stage, s.target));\n     rules.dist(\"dist-std\", \"src/libstd\")\n          .dep(move |s| {\n@@ -723,12 +723,12 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n          })\n          .default(true)\n          .only_host_build(true)\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::std(build, &s.compiler(), s.target));\n     rules.dist(\"dist-mingw\", \"path/to/nowhere\")\n          .default(true)\n          .only_host_build(true)\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| {\n              if s.target.contains(\"pc-windows-gnu\") {\n                  dist::mingw(build, s.target)\n@@ -739,25 +739,25 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n          .host(true)\n          .only_build(true)\n          .only_host_build(true)\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |_| dist::rust_src(build));\n     rules.dist(\"dist-docs\", \"src/doc\")\n          .default(true)\n          .only_host_build(true)\n          .dep(|s| s.name(\"default:doc\"))\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::docs(build, s.stage, s.target));\n     rules.dist(\"dist-analysis\", \"analysis\")\n          .default(build.config.extended)\n          .dep(|s| s.name(\"dist-std\"))\n          .only_host_build(true)\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::analysis(build, &s.compiler(), s.target));\n     rules.dist(\"dist-rls\", \"rls\")\n          .host(true)\n          .only_host_build(true)\n          .dep(|s| s.name(\"tool-rls\"))\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::rls(build, s.stage, s.target));\n     rules.dist(\"install\", \"path/to/nowhere\")\n          .dep(|s| s.name(\"default:dist\"))\n@@ -766,7 +766,7 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n          .host(true)\n          .only_host_build(true)\n          .dep(|s| s.name(\"tool-cargo\"))\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::cargo(build, s.stage, s.target));\n     rules.dist(\"dist-extended\", \"extended\")\n          .default(build.config.extended)\n@@ -779,7 +779,7 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n          .dep(|d| d.name(\"dist-cargo\"))\n          .dep(|d| d.name(\"dist-rls\"))\n          .dep(|d| d.name(\"dist-analysis\"))\n-         .dep(|s| s.name(\"tool-rust-installer\").stage(0))\n+         .dep(move |s| tool_rust_installer(build, s))\n          .run(move |s| dist::extended(build, s.stage, s.target));\n \n     rules.dist(\"dist-sign\", \"hash-and-sign\")\n@@ -791,6 +791,14 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n \n     rules.verify();\n     return rules;\n+\n+    /// Helper to depend on a stage0 build-only rust-installer tool.\n+    fn tool_rust_installer<'a>(build: &'a Build, step: &Step<'a>) -> Step<'a> {\n+        step.name(\"tool-rust-installer\")\n+            .host(&build.config.build)\n+            .target(&build.config.build)\n+            .stage(0)\n+    }\n }\n \n #[derive(PartialEq, Eq, Hash, Clone, Debug)]"}]}