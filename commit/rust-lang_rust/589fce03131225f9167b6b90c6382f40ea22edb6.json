{"sha": "589fce03131225f9167b6b90c6382f40ea22edb6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4OWZjZTAzMTMxMjI1ZjkxNjdiNmI5MGM2MzgyZjQwZWEyMmVkYjY=", "commit": {"author": {"name": "Caleb Zulawski", "email": "caleb.zulawski@gmail.com", "date": "2021-04-29T03:34:28Z"}, "committer": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2021-05-01T06:22:27Z"}, "message": "Attempt to workaround MIPS bug", "tree": {"sha": "a98d1282160da4bb96bbe3dd31aa7c0c676f18ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a98d1282160da4bb96bbe3dd31aa7c0c676f18ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/589fce03131225f9167b6b90c6382f40ea22edb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/589fce03131225f9167b6b90c6382f40ea22edb6", "html_url": "https://github.com/rust-lang/rust/commit/589fce03131225f9167b6b90c6382f40ea22edb6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/589fce03131225f9167b6b90c6382f40ea22edb6/comments", "author": {"login": "calebzulawski", "id": 563826, "node_id": "MDQ6VXNlcjU2MzgyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/563826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebzulawski", "html_url": "https://github.com/calebzulawski", "followers_url": "https://api.github.com/users/calebzulawski/followers", "following_url": "https://api.github.com/users/calebzulawski/following{/other_user}", "gists_url": "https://api.github.com/users/calebzulawski/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebzulawski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebzulawski/subscriptions", "organizations_url": "https://api.github.com/users/calebzulawski/orgs", "repos_url": "https://api.github.com/users/calebzulawski/repos", "events_url": "https://api.github.com/users/calebzulawski/events{/privacy}", "received_events_url": "https://api.github.com/users/calebzulawski/received_events", "type": "User", "site_admin": false}, "committer": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98dad135268e0da590a162d24da6f7e2d8781648", "url": "https://api.github.com/repos/rust-lang/rust/commits/98dad135268e0da590a162d24da6f7e2d8781648", "html_url": "https://github.com/rust-lang/rust/commit/98dad135268e0da590a162d24da6f7e2d8781648"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "f89bbefba631c6c281ff69ad6b93646768f2cfbb", "filename": "crates/core_simd/src/masks/full_masks.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/589fce03131225f9167b6b90c6382f40ea22edb6/crates%2Fcore_simd%2Fsrc%2Fmasks%2Ffull_masks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/589fce03131225f9167b6b90c6382f40ea22edb6/crates%2Fcore_simd%2Fsrc%2Fmasks%2Ffull_masks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Fsrc%2Fmasks%2Ffull_masks.rs?ref=589fce03131225f9167b6b90c6382f40ea22edb6", "patch": "@@ -112,7 +112,18 @@ macro_rules! define_mask {\n                     // TODO remove the transmute when rustc is more flexible\n                     assert_eq!(core::mem::size_of::<U::IntBitMask>(), core::mem::size_of::<U::BitMask>());\n                     let mask: U::IntBitMask = crate::intrinsics::simd_bitmask(self.0);\n-                    core::mem::transmute_copy(&mask)\n+                    let mut bitmask: U::BitMask = core::mem::transmute_copy(&mask);\n+\n+                    // There is a bug where LLVM appears to implement this operation with the wrong\n+                    // bit order.\n+                    // TODO fix this in a better way\n+                    if cfg!(any(target_arch = \"mips\", target_arch = \"mips64\")) {\n+                        for x in bitmask.as_mut() {\n+                            *x = x.reverse_bits();\n+                        }\n+                    }\n+\n+                    bitmask\n                 }\n             }\n         }"}, {"sha": "7021d58aa543ad34f63e77f4a8cf26bac7a4152f", "filename": "crates/core_simd/tests/masks.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/589fce03131225f9167b6b90c6382f40ea22edb6/crates%2Fcore_simd%2Ftests%2Fmasks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/589fce03131225f9167b6b90c6382f40ea22edb6/crates%2Fcore_simd%2Ftests%2Fmasks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcore_simd%2Ftests%2Fmasks.rs?ref=589fce03131225f9167b6b90c6382f40ea22edb6", "patch": "@@ -70,10 +70,10 @@ macro_rules! test_mask_api {\n             fn to_bitmask() {\n                 let values = [\n                     true, false, false, true, false, false, true, false,\n-                    false, false, false, false, false, false, false, false,\n+                    true, true, false, false, false, false, false, true,\n                 ];\n                 let mask = core_simd::$name::<16>::from_array(values);\n-                assert_eq!(mask.to_bitmask(), [0b01001001, 0]);\n+                assert_eq!(mask.to_bitmask(), [0b01001001, 0b10000011]);\n             }\n         }\n     }"}]}