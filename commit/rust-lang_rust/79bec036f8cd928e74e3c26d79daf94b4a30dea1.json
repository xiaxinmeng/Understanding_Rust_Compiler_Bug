{"sha": "79bec036f8cd928e74e3c26d79daf94b4a30dea1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5YmVjMDM2ZjhjZDkyOGU3NGUzYzI2ZDc5ZGFmOTRiNGEzMGRlYTE=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-09-05T11:34:28Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-09-05T11:34:28Z"}, "message": "Return impl Iterator instead of Vec<Lint>\n\nThis makes the API of `lib.rs` a bit more flexible.", "tree": {"sha": "f79b46e8cb7d3a26849b35dbf5c8cd8335643f24", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f79b46e8cb7d3a26849b35dbf5c8cd8335643f24"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79bec036f8cd928e74e3c26d79daf94b4a30dea1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIbBAABCAAGBQJbj79pAAoJELb6Bqbg4mZbda8P9j7vSJC8h2IiKjpo7I+BBG5C\nRHmWkhMO3dQuSAy0m8I7McRDn5/oaorHeVm8DmzMukmLVb56UZsTGXBNzsfZ8hsx\ngfGGP8F1NUIbbpuC/Kf53gHixsJBIG3RBcwjH9qykgXpwwpD1DKAu/h2JSVMFSnm\nyBOIAgP4aTeDUD49Kx8/Bp5KhMBK1XvpOurILhN8EQbgP76BAecyFcGYQyPlrd6X\nc25wRLiLhkS/9dPUZuv+c/0ObZ3AfZb6bvJo3GAwcGzTPs94McfzkoabuQ6J12hX\n2jFJa5ecu2j19/5L4OWk/wera2D6uorgQHwTCMfemftXcLxMupIeEQePOG4FziT5\n2d6S66le5TqhY2nhT0lb7eaD6RS0ANfJRDSiPFaOJMoQN346Az5CF2Xz84kfnaGB\niSxRFRfPAlGRDDeERFI49VlnPgSL0sc8deGgRUyLh3CoCYzgd4o0sVCNReAj0Iif\n8gR6AIdnYlFQVBhJ03DgcZVcIHbwMXAKoScwZ24C2NPx3LVd8f97dnPt0EGcsibU\nobIOa17rwbcRhF4YfnAuSlRY7XV58wCBgQDVsRecMB7L5leXskG7eRDJwTozBh9T\nDznP1qngZEyIWwQnBXCtNuc9q5Jns4GkuhVCTUEH1MFoFMGdzmkKQpULY6eVTOKm\noiQY/tQV0jQDcbWFY3M=\n=dPtk\n-----END PGP SIGNATURE-----", "payload": "tree f79b46e8cb7d3a26849b35dbf5c8cd8335643f24\nparent be995dc0e841cb2db46d7995958ba24bac91e1e2\nauthor Philipp Hansch <dev@phansch.net> 1536147268 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1536147268 +0200\n\nReturn impl Iterator instead of Vec<Lint>\n\nThis makes the API of `lib.rs` a bit more flexible.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79bec036f8cd928e74e3c26d79daf94b4a30dea1", "html_url": "https://github.com/rust-lang/rust/commit/79bec036f8cd928e74e3c26d79daf94b4a30dea1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79bec036f8cd928e74e3c26d79daf94b4a30dea1/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be995dc0e841cb2db46d7995958ba24bac91e1e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/be995dc0e841cb2db46d7995958ba24bac91e1e2", "html_url": "https://github.com/rust-lang/rust/commit/be995dc0e841cb2db46d7995958ba24bac91e1e2"}], "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "c499934346e1ecc98a592dc6033e9ec4d57778f9", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/79bec036f8cd928e74e3c26d79daf94b4a30dea1/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79bec036f8cd928e74e3c26d79daf94b4a30dea1/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=79bec036f8cd928e74e3c26d79daf94b4a30dea1", "patch": "@@ -46,8 +46,9 @@ impl Lint {\n         }\n     }\n \n-    pub fn active_lints(lints: &[Lint]) -> Vec<Lint> {\n-        lints.iter().filter(|l| l.deprecation.is_none()).cloned().collect::<Vec<Lint>>()\n+    /// Returns all non-deprecated lints\n+    pub fn active_lints(lints: &[Lint]) -> impl Iterator<Item=&Lint> {\n+        lints.iter().filter(|l| l.deprecation.is_none())\n     }\n \n     /// Returns the lints in a HashMap, grouped by the different lint groups\n@@ -56,22 +57,22 @@ impl Lint {\n     }\n }\n \n-pub fn collect_all() -> Vec<Lint> {\n+pub fn gather_all() -> impl Iterator<Item=Lint> {\n     let mut lints = vec![];\n     for dir_entry in lint_files() {\n-        lints.append(&mut collect_from_file(&dir_entry));\n+        lints.append(&mut gather_from_file(&dir_entry).collect());\n     }\n-    lints\n+    lints.into_iter()\n }\n \n-fn collect_from_file(dir_entry: &fs::DirEntry) -> Vec<Lint> {\n+fn gather_from_file(dir_entry: &fs::DirEntry) -> impl Iterator<Item=Lint> {\n     let mut file = fs::File::open(dir_entry.path()).unwrap();\n     let mut content = String::new();\n     file.read_to_string(&mut content).unwrap();\n     parse_contents(&content, dir_entry.path().file_stem().unwrap().to_str().unwrap())\n }\n \n-fn parse_contents(content: &str, filename: &str) -> Vec<Lint> {\n+fn parse_contents(content: &str, filename: &str) -> impl Iterator<Item=Lint> {\n     let mut lints: Vec<Lint> = DEC_CLIPPY_LINT_RE\n         .captures_iter(&content)\n         .map(|m| Lint::new(&m[\"name\"], &m[\"cat\"], &m[\"desc\"], None, filename))\n@@ -81,21 +82,20 @@ fn parse_contents(content: &str, filename: &str) -> Vec<Lint> {\n         .map(|m| Lint::new( &m[\"name\"], \"Deprecated\", &m[\"desc\"], Some(&m[\"desc\"]), filename))\n         .collect();\n     lints.append(&mut deprecated);\n-    lints\n+    lints.into_iter()\n }\n \n /// Collects all .rs files in the `clippy_lints/src` directory\n-fn lint_files() -> Vec<fs::DirEntry> {\n+fn lint_files() -> impl Iterator<Item=fs::DirEntry> {\n     let paths = fs::read_dir(\"../clippy_lints/src\").unwrap();\n     paths\n         .filter_map(|f| f.ok())\n         .filter(|f| f.path().extension() == Some(OsStr::new(\"rs\")))\n-        .collect::<Vec<fs::DirEntry>>()\n }\n \n #[test]\n fn test_parse_contents() {\n-    let result = parse_contents(\n+    let result: Vec<Lint> = parse_contents(\n         r#\"\n declare_clippy_lint! {\n     pub PTR_ARG,\n@@ -116,7 +116,7 @@ declare_deprecated_lint! {\n     \"`assert!()` will be more flexible with RFC 2011\"\n }\n     \"#,\n-    \"module_name\");\n+    \"module_name\").collect();\n \n     let expected = vec![\n         Lint::new(\"ptr_arg\", \"style\", \"really long text\", None, \"module_name\"),\n@@ -141,7 +141,7 @@ fn test_active_lints() {\n     let expected = vec![\n         Lint::new(\"should_assert_eq2\", \"Not Deprecated\", \"abc\", None, \"module_name\")\n     ];\n-    assert_eq!(expected, Lint::active_lints(&lints));\n+    assert_eq!(expected, Lint::active_lints(&lints).cloned().collect::<Vec<Lint>>());\n }\n \n #[test]"}, {"sha": "f45c52e2271db22aa22d6f760895382a50871c54", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/79bec036f8cd928e74e3c26d79daf94b4a30dea1/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79bec036f8cd928e74e3c26d79daf94b4a30dea1/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=79bec036f8cd928e74e3c26d79daf94b4a30dea1", "patch": "@@ -27,7 +27,7 @@ fn main() {\n }\n \n fn print_lints() {\n-    let lint_list = collect_all();\n+    let lint_list = gather_all().collect::<Vec<Lint>>();\n     let grouped_by_lint_group = Lint::by_lint_group(&lint_list);\n \n     for (lint_group, mut lints) in grouped_by_lint_group {\n@@ -41,5 +41,5 @@ fn print_lints() {\n         }\n     }\n \n-    println!(\"there are {} lints\", Lint::active_lints(&lint_list).len());\n+    println!(\"there are {} lints\", Lint::active_lints(&lint_list).count());\n }"}]}