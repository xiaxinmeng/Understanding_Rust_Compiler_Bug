{"sha": "fe84809394fbc6ad2d36f6f142671bea7a492a4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlODQ4MDkzOTRmYmM2YWQyZDM2ZjZmMTQyNjcxYmVhN2E0OTJhNGM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-10-22T16:06:30Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-10-22T16:08:21Z"}, "message": "relax ExactSizeIterator bound on write_bytes: too many iterators don't have that bound", "tree": {"sha": "20c80b72ffb3e5c8e6ffe04f4a66323819759f01", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20c80b72ffb3e5c8e6ffe04f4a66323819759f01"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe84809394fbc6ad2d36f6f142671bea7a492a4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe84809394fbc6ad2d36f6f142671bea7a492a4c", "html_url": "https://github.com/rust-lang/rust/commit/fe84809394fbc6ad2d36f6f142671bea7a492a4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe84809394fbc6ad2d36f6f142671bea7a492a4c/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6576f4be5af31a5e61dfc0cf50b7130e6c6dfb35", "url": "https://api.github.com/repos/rust-lang/rust/commits/6576f4be5af31a5e61dfc0cf50b7130e6c6dfb35", "html_url": "https://github.com/rust-lang/rust/commit/6576f4be5af31a5e61dfc0cf50b7130e6c6dfb35"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "aa8ac4902a8947bc758d8404fe771a490ef73480", "filename": "src/librustc/mir/interpret/allocation.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fe84809394fbc6ad2d36f6f142671bea7a492a4c/src%2Flibrustc%2Fmir%2Finterpret%2Fallocation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe84809394fbc6ad2d36f6f142671bea7a492a4c/src%2Flibrustc%2Fmir%2Finterpret%2Fallocation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Finterpret%2Fallocation.rs?ref=fe84809394fbc6ad2d36f6f142671bea7a492a4c", "patch": "@@ -353,11 +353,14 @@ impl<'tcx, Tag: Copy, Extra: AllocationExtra<Tag>> Allocation<Tag, Extra> {\n         &mut self,\n         cx: &impl HasDataLayout,\n         ptr: Pointer<Tag>,\n-        src: impl IntoIterator<Item=u8, IntoIter: iter::ExactSizeIterator>,\n+        src: impl IntoIterator<Item=u8>,\n     ) -> InterpResult<'tcx>\n     {\n         let mut src = src.into_iter();\n-        let bytes = self.get_bytes_mut(cx, ptr, Size::from_bytes(src.len() as u64))?;\n+        let (lower, upper) = src.size_hint();\n+        let len = upper.expect(\"can only write bounded iterators\");\n+        assert_eq!(lower, len, \"can only write iterators with a precise length\");\n+        let bytes = self.get_bytes_mut(cx, ptr, Size::from_bytes(len as u64))?;\n         // `zip` would stop when the first iterator ends; we want to definitely\n         // cover all of `bytes`.\n         for dest in bytes {"}, {"sha": "d113ee33162d26114c92c64d0995e013d1a26ff0", "filename": "src/librustc_mir/interpret/memory.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fe84809394fbc6ad2d36f6f142671bea7a492a4c/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe84809394fbc6ad2d36f6f142671bea7a492a4c/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs?ref=fe84809394fbc6ad2d36f6f142671bea7a492a4c", "patch": "@@ -7,7 +7,7 @@\n //! short-circuiting the empty case!\n \n use std::collections::VecDeque;\n-use std::{ptr, iter};\n+use std::ptr;\n use std::borrow::Cow;\n \n use rustc::ty::{self, Instance, ParamEnv, query::TyCtxtAt};\n@@ -791,11 +791,12 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> Memory<'mir, 'tcx, M> {\n     pub fn write_bytes(\n         &mut self,\n         ptr: Scalar<M::PointerTag>,\n-        src: impl IntoIterator<Item=u8, IntoIter: iter::ExactSizeIterator>,\n+        src: impl IntoIterator<Item=u8>,\n     ) -> InterpResult<'tcx>\n     {\n         let src = src.into_iter();\n-        let size = Size::from_bytes(src.len() as u64);\n+        let size = Size::from_bytes(src.size_hint().0 as u64);\n+        // `write_bytes` checks that this lower bound matches the upper bound matches reality.\n         let ptr = match self.check_ptr_access(ptr, size, Align::from_bytes(1).unwrap())? {\n             Some(ptr) => ptr,\n             None => return Ok(()), // zero-sized access"}]}