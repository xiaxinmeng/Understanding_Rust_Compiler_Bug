{"sha": "908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwOGJmNWEzMTBiNzI2NWEzZTdjMWQxZmEwMjFlM2IxMGFhNjcyOTM=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-12-02T20:39:05Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-12-02T21:05:24Z"}, "message": "rustc_metadata: Remove some dead code", "tree": {"sha": "1c3d34a3e31c20b9aeeaafd051b3e9a49d06ee86", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c3d34a3e31c20b9aeeaafd051b3e9a49d06ee86"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "html_url": "https://github.com/rust-lang/rust/commit/908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af69066aa6afa7bff771a6ee9548b2b84a02a88a", "url": "https://api.github.com/repos/rust-lang/rust/commits/af69066aa6afa7bff771a6ee9548b2b84a02a88a", "html_url": "https://github.com/rust-lang/rust/commit/af69066aa6afa7bff771a6ee9548b2b84a02a88a"}], "stats": {"total": 32, "additions": 4, "deletions": 28}, "files": [{"sha": "c571ed7b61262824d907fbb65bf731e84d00f3dc", "filename": "compiler/rustc_metadata/src/rmeta/decoder.rs", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs?ref=908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "patch": "@@ -1592,23 +1592,6 @@ impl<'a, 'tcx> CrateMetadataRef<'a> {\n         self.def_path_hash_unlocked(index, &mut def_path_hashes)\n     }\n \n-    fn all_def_path_hashes_and_def_ids(&self) -> Vec<(DefPathHash, DefId)> {\n-        let mut def_path_hashes = self.def_path_hash_cache.lock();\n-        let mut def_index_to_data = |index| {\n-            (self.def_path_hash_unlocked(index, &mut def_path_hashes), self.local_def_id(index))\n-        };\n-        if let Some(data) = &self.root.proc_macro_data {\n-            std::iter::once(CRATE_DEF_INDEX)\n-                .chain(data.macros.decode(self))\n-                .map(def_index_to_data)\n-                .collect()\n-        } else {\n-            (0..self.num_def_ids())\n-                .map(|index| def_index_to_data(DefIndex::from_usize(index)))\n-                .collect()\n-        }\n-    }\n-\n     /// Get the `DepNodeIndex` corresponding this crate. The result of this\n     /// method is cached in the `dep_node_index` field.\n     fn get_crate_dep_node_index(&self, tcx: TyCtxt<'tcx>) -> DepNodeIndex {"}, {"sha": "b7f22885217908e9d44388b39d1eab8e19ba04b3", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "patch": "@@ -456,6 +456,10 @@ impl CStore {\n     pub fn module_expansion_untracked(&self, def_id: DefId, sess: &Session) -> ExpnId {\n         self.get_crate_data(def_id.krate).module_expansion(def_id.index, sess)\n     }\n+\n+    pub fn num_def_ids(&self, cnum: CrateNum) -> usize {\n+        self.get_crate_data(cnum).num_def_ids()\n+    }\n }\n \n impl CrateStore for CStore {\n@@ -498,14 +502,6 @@ impl CrateStore for CStore {\n         self.get_crate_data(def.krate).def_path_hash(def.index)\n     }\n \n-    fn all_def_path_hashes_and_def_ids(&self, cnum: CrateNum) -> Vec<(DefPathHash, DefId)> {\n-        self.get_crate_data(cnum).all_def_path_hashes_and_def_ids()\n-    }\n-\n-    fn num_def_ids(&self, cnum: CrateNum) -> usize {\n-        self.get_crate_data(cnum).num_def_ids()\n-    }\n-\n     // See `CrateMetadataRef::def_path_hash_to_def_id` for more details\n     fn def_path_hash_to_def_id(\n         &self,"}, {"sha": "6d2c43874bc0fe59e2b0faa7c4b8c905be43caa8", "filename": "compiler/rustc_middle/src/middle/cstore.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fcstore.rs?ref=908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "patch": "@@ -189,8 +189,6 @@ pub trait CrateStore {\n     fn def_kind(&self, def: DefId) -> DefKind;\n     fn def_path(&self, def: DefId) -> DefPath;\n     fn def_path_hash(&self, def: DefId) -> DefPathHash;\n-    fn all_def_path_hashes_and_def_ids(&self, cnum: CrateNum) -> Vec<(DefPathHash, DefId)>;\n-    fn num_def_ids(&self, cnum: CrateNum) -> usize;\n     fn def_path_hash_to_def_id(\n         &self,\n         cnum: CrateNum,"}, {"sha": "97117ab13415a92a48ff65ffdedd79b52be9b8f9", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/908bf5a310b7265a3e7c1d1fa021e3b10aa67293/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=908bf5a310b7265a3e7c1d1fa021e3b10aa67293", "patch": "@@ -13,7 +13,6 @@ use rustc_hir::{\n };\n use rustc_interface::interface;\n use rustc_middle::hir::map::Map;\n-use rustc_middle::middle::cstore::CrateStore;\n use rustc_middle::middle::privacy::AccessLevels;\n use rustc_middle::ty::{ParamEnv, Ty, TyCtxt};\n use rustc_resolve as resolve;"}]}