{"sha": "057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1N2M0MGQ1YmQzZGM3MDBhZjdkOTlhMmRmZWJhMGZlNmMyYmExMTk=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2013-03-25T21:39:15Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2013-03-25T21:39:15Z"}, "message": "make ty_region give a useful span when it fails", "tree": {"sha": "af40d0e72775b851feea2b1ffb6acfe80b53997c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af40d0e72775b851feea2b1ffb6acfe80b53997c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "html_url": "https://github.com/rust-lang/rust/commit/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d4499ce4d948bf7b7b385b40e5b3536507ad3e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d4499ce4d948bf7b7b385b40e5b3536507ad3e8", "html_url": "https://github.com/rust-lang/rust/commit/6d4499ce4d948bf7b7b385b40e5b3536507ad3e8"}], "stats": {"total": 29, "additions": 18, "deletions": 11}, "files": [{"sha": "bab652a3d1e2f1ea89a43b4c137c699467fcb988", "filename": "src/librustc/middle/borrowck/gather_loans.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs?ref=057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "patch": "@@ -145,7 +145,7 @@ fn req_loans_in_expr(ex: @ast::expr,\n \n         // make sure that the thing we are pointing out stays valid\n         // for the lifetime `scope_r` of the resulting ptr:\n-        let scope_r = ty_region(tcx.ty(ex));\n+        let scope_r = ty_region(tcx, ex.span, tcx.ty(ex));\n         self.guarantee_valid(base_cmt, mutbl, scope_r);\n         visit::visit_expr(ex, self, vt);\n       }\n@@ -599,7 +599,8 @@ pub impl GatherLoanCtxt {\n                     // find the region of the resulting pointer (note that\n                     // the type of such a pattern will *always* be a\n                     // region pointer)\n-                    let scope_r = ty_region(self.tcx().ty(pat));\n+                    let scope_r = ty_region(self.tcx(), pat.span,\n+                                            self.tcx().ty(pat));\n \n                     // if the scope of the region ptr turns out to be\n                     // specific to this arm, wrap the categorization with"}, {"sha": "44245e0b4e1f8ff9d7294349283f2b31dda8723c", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "patch": "@@ -2794,13 +2794,18 @@ pub fn ty_vstore(ty: t) -> vstore {\n     }\n }\n \n-pub fn ty_region(ty: t) -> Region {\n+pub fn ty_region(tcx: ctxt,\n+                 span: span,\n+                 ty: t) -> Region {\n     match get(ty).sty {\n-      ty_rptr(r, _) => r,\n-      ty_evec(_, vstore_slice(r)) => r,\n-      ty_estr(vstore_slice(r)) => r,\n-      ref s => fail!(fmt!(\"ty_region() invoked on in appropriate ty: %?\",\n-          (*s)))\n+        ty_rptr(r, _) => r,\n+        ty_evec(_, vstore_slice(r)) => r,\n+        ty_estr(vstore_slice(r)) => r,\n+        ref s => {\n+            tcx.sess.span_bug(\n+                span,\n+                fmt!(\"ty_region() invoked on in appropriate ty: %?\", s));\n+        }\n     }\n }\n "}, {"sha": "3a02c19dbaf83ef3c23e12aa6bae4ff5be01c025", "filename": "src/librustc/middle/typeck/check/regionck.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs?ref=057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "patch": "@@ -616,8 +616,9 @@ pub mod guarantor {\n         // mk_subr should never fail.\n         let rptr_ty = rcx.resolve_node_type(id);\n         if !ty::type_is_error(rptr_ty) {\n-            debug!(\"rptr_ty=%s\", ty_to_str(rcx.fcx.ccx.tcx, rptr_ty));\n-            let r = ty::ty_region(rptr_ty);\n+            let tcx = rcx.fcx.ccx.tcx;\n+            debug!(\"rptr_ty=%s\", ty_to_str(tcx, rptr_ty));\n+            let r = ty::ty_region(tcx, span, rptr_ty);\n             infallibly_mk_subr(rcx, true, span, r, bound);\n         }\n     }\n@@ -890,7 +891,7 @@ pub mod guarantor {\n             ast::pat_region(p) => {\n                 let rptr_ty = rcx.resolve_node_type(pat.id);\n                 if !ty::type_is_error(rptr_ty) {\n-                    let r = ty::ty_region(rptr_ty);\n+                    let r = ty::ty_region(rcx.fcx.tcx(), pat.span, rptr_ty);\n                     link_ref_bindings_in_pat(rcx, p, Some(r));\n                 }\n             }"}]}