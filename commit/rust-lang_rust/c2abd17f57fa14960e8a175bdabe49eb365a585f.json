{"sha": "c2abd17f57fa14960e8a175bdabe49eb365a585f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyYWJkMTdmNTdmYTE0OTYwZThhMTc1YmRhYmU0OWViMzY1YTU4NWY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-27T23:13:52Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-11-27T23:13:52Z"}, "message": "Use ItemPtr for id", "tree": {"sha": "b81d0ee53fce2cb25f67c8cb9424935217eaecf4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b81d0ee53fce2cb25f67c8cb9424935217eaecf4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2abd17f57fa14960e8a175bdabe49eb365a585f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2abd17f57fa14960e8a175bdabe49eb365a585f", "html_url": "https://github.com/rust-lang/rust/commit/c2abd17f57fa14960e8a175bdabe49eb365a585f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2abd17f57fa14960e8a175bdabe49eb365a585f/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3922503205e2798e21273a22112f584951f25623", "url": "https://api.github.com/repos/rust-lang/rust/commits/3922503205e2798e21273a22112f584951f25623", "html_url": "https://github.com/rust-lang/rust/commit/3922503205e2798e21273a22112f584951f25623"}], "stats": {"total": 30, "additions": 12, "deletions": 18}, "files": [{"sha": "280218fd42ec056d5445e866c121c4de2dc61d37", "filename": "crates/ra_analysis/src/hir/function/mod.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Ffunction%2Fmod.rs?ref=c2abd17f57fa14960e8a175bdabe49eb365a585f", "patch": "@@ -11,17 +11,19 @@ use ra_syntax::{\n };\n \n use crate::{\n-    hir::HirDatabase,\n-    syntax_ptr::SyntaxPtr, FileId,\n+    hir::{HirDatabase, SourceItemId},\n+    FileId,\n };\n \n pub(crate) use self::scope::FnScopes;\n pub(crate) use crate::loc2id::FnId;\n \n impl FnId {\n     pub(crate) fn get(db: &impl HirDatabase, file_id: FileId, fn_def: ast::FnDef) -> FnId {\n-        let ptr = SyntaxPtr::new(file_id, fn_def.syntax());\n-        db.id_maps().fn_id(ptr)\n+        let file_items = db.file_items(file_id);\n+        let item_id = file_items.id_of(fn_def.syntax());\n+        let item_id = SourceItemId { file_id, item_id };\n+        db.id_maps().fn_id(item_id)\n     }\n }\n "}, {"sha": "6c633e9ab5e56e62af6e0e376e38b888ee0445d5", "filename": "crates/ra_analysis/src/hir/query_definitions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fhir%2Fquery_definitions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fhir%2Fquery_definitions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fhir%2Fquery_definitions.rs?ref=c2abd17f57fa14960e8a175bdabe49eb365a585f", "patch": "@@ -26,8 +26,8 @@ use crate::{\n \n /// Resolve `FnId` to the corresponding `SyntaxNode`\n pub(super) fn fn_syntax(db: &impl HirDatabase, fn_id: FnId) -> FnDefNode {\n-    let ptr = db.id_maps().fn_ptr(fn_id);\n-    let syntax = db.resolve_syntax_ptr(ptr);\n+    let item_id = db.id_maps().fn_item_id(fn_id);\n+    let syntax = db.file_item(item_id);\n     FnDef::cast(syntax.borrowed()).unwrap().owned()\n }\n "}, {"sha": "204708942d1abb75d4fc823c7457b5c0d5b409e0", "filename": "crates/ra_analysis/src/loc2id.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Floc2id.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Floc2id.rs?ref=c2abd17f57fa14960e8a175bdabe49eb365a585f", "patch": "@@ -9,7 +9,6 @@ use rustc_hash::FxHashMap;\n \n use crate::{\n     hir::{SourceItemId, ModuleId},\n-    syntax_ptr::SyntaxPtr,\n     input::SourceRootId,\n };\n \n@@ -112,10 +111,10 @@ pub(crate) struct IdMaps {\n }\n \n impl IdMaps {\n-    pub(crate) fn fn_id(&self, ptr: SyntaxPtr) -> FnId {\n-        self.inner.fns.lock().loc2id(&ptr)\n+    pub(crate) fn fn_id(&self, item_id: SourceItemId) -> FnId {\n+        self.inner.fns.lock().loc2id(&item_id)\n     }\n-    pub(crate) fn fn_ptr(&self, fn_id: FnId) -> SyntaxPtr {\n+    pub(crate) fn fn_item_id(&self, fn_id: FnId) -> SourceItemId {\n         self.inner.fns.lock().id2loc(fn_id)\n     }\n \n@@ -129,6 +128,6 @@ impl IdMaps {\n \n #[derive(Debug, Default)]\n struct IdMapsInner {\n-    fns: Mutex<Loc2IdMap<SyntaxPtr, FnId>>,\n+    fns: Mutex<Loc2IdMap<SourceItemId, FnId>>,\n     defs: Mutex<Loc2IdMap<DefLoc, DefId>>,\n }"}, {"sha": "7bbf1fc33a4ac4ce2698f1b238e3a216146d9a94", "filename": "crates/ra_analysis/src/syntax_ptr.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fsyntax_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2abd17f57fa14960e8a175bdabe49eb365a585f/crates%2Fra_analysis%2Fsrc%2Fsyntax_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fsyntax_ptr.rs?ref=c2abd17f57fa14960e8a175bdabe49eb365a585f", "patch": "@@ -17,13 +17,6 @@ pub(crate) struct SyntaxPtr {\n     local: LocalSyntaxPtr,\n }\n \n-impl SyntaxPtr {\n-    pub(crate) fn new(file_id: FileId, node: SyntaxNodeRef) -> SyntaxPtr {\n-        let local = LocalSyntaxPtr::new(node);\n-        SyntaxPtr { file_id, local }\n-    }\n-}\n-\n /// A pionter to a syntax node inside a file.\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub(crate) struct LocalSyntaxPtr {"}]}