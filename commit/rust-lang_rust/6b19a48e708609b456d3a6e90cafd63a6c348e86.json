{"sha": "6b19a48e708609b456d3a6e90cafd63a6c348e86", "node_id": "C_kwDOAAsO6NoAKDZiMTlhNDhlNzA4NjA5YjQ1NmQzYTZlOTBjYWZkNjNhNmMzNDhlODY", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-13T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-13T00:00:00Z"}, "message": "`assert_{inhabited,zero_valid,uninit_valid}` intrinsics are safe\n\nThose intrinsics either panic or do nothing. They are safe.", "tree": {"sha": "2e9811d10e49cdb15dc5d516eeef0e2bdde4cc9c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e9811d10e49cdb15dc5d516eeef0e2bdde4cc9c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b19a48e708609b456d3a6e90cafd63a6c348e86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b19a48e708609b456d3a6e90cafd63a6c348e86", "html_url": "https://github.com/rust-lang/rust/commit/6b19a48e708609b456d3a6e90cafd63a6c348e86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b19a48e708609b456d3a6e90cafd63a6c348e86/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75b7e52e92c3b00fc891b47f5b2efdff0a2be55a", "url": "https://api.github.com/repos/rust-lang/rust/commits/75b7e52e92c3b00fc891b47f5b2efdff0a2be55a", "html_url": "https://github.com/rust-lang/rust/commit/75b7e52e92c3b00fc891b47f5b2efdff0a2be55a"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "05686be5d4b3dfb081f327b2ab2d615053ce4a5c", "filename": "compiler/rustc_typeck/src/check/intrinsic.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b19a48e708609b456d3a6e90cafd63a6c348e86/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b19a48e708609b456d3a6e90cafd63a6c348e86/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fintrinsic.rs?ref=6b19a48e708609b456d3a6e90cafd63a6c348e86", "patch": "@@ -69,6 +69,9 @@ pub fn intrinsic_operation_unsafety(intrinsic: Symbol) -> hir::Unsafety {\n         // to note that it's safe to call, since\n         // safe extern fns are otherwise unprecedented.\n         sym::abort\n+        | sym::assert_inhabited\n+        | sym::assert_zero_valid\n+        | sym::assert_uninit_valid\n         | sym::size_of\n         | sym::min_align_of\n         | sym::needs_drop"}, {"sha": "3ce3e1bdbac0f9b6d4b30c12bce22173e38b0c0a", "filename": "src/test/ui/consts/assert-type-intrinsics.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b19a48e708609b456d3a6e90cafd63a6c348e86/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b19a48e708609b456d3a6e90cafd63a6c348e86/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.rs?ref=6b19a48e708609b456d3a6e90cafd63a6c348e86", "patch": "@@ -13,10 +13,10 @@ fn main() {\n     const _BAD1: () = unsafe {\n         MaybeUninit::<!>::uninit().assume_init();\n     };\n-    const _BAD2: () = unsafe {\n+    const _BAD2: () = {\n         intrinsics::assert_uninit_valid::<bool>();\n     };\n-    const _BAD3: () = unsafe {\n+    const _BAD3: () = {\n         intrinsics::assert_zero_valid::<&'static i32>();\n     };\n }"}, {"sha": "6eab10197b8553af4e006a64e6741a361bbda8bc", "filename": "src/test/ui/consts/assert-type-intrinsics.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b19a48e708609b456d3a6e90cafd63a6c348e86/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b19a48e708609b456d3a6e90cafd63a6c348e86/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fassert-type-intrinsics.stderr?ref=6b19a48e708609b456d3a6e90cafd63a6c348e86", "patch": "@@ -13,7 +13,7 @@ LL |         MaybeUninit::<!>::uninit().assume_init();\n error: any use of this value will cause an error\n   --> $DIR/assert-type-intrinsics.rs:17:9\n    |\n-LL |     const _BAD2: () = unsafe {\n+LL |     const _BAD2: () = {\n    |     ---------------\n LL |         intrinsics::assert_uninit_valid::<bool>();\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ aborted execution: attempted to leave type `bool` uninitialized, which is invalid\n@@ -24,7 +24,7 @@ LL |         intrinsics::assert_uninit_valid::<bool>();\n error: any use of this value will cause an error\n   --> $DIR/assert-type-intrinsics.rs:20:9\n    |\n-LL |     const _BAD3: () = unsafe {\n+LL |     const _BAD3: () = {\n    |     ---------------\n LL |         intrinsics::assert_zero_valid::<&'static i32>();\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ aborted execution: attempted to zero-initialize type `&i32`, which is invalid\n@@ -51,7 +51,7 @@ Future breakage diagnostic:\n error: any use of this value will cause an error\n   --> $DIR/assert-type-intrinsics.rs:17:9\n    |\n-LL |     const _BAD2: () = unsafe {\n+LL |     const _BAD2: () = {\n    |     ---------------\n LL |         intrinsics::assert_uninit_valid::<bool>();\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ aborted execution: attempted to leave type `bool` uninitialized, which is invalid\n@@ -64,7 +64,7 @@ Future breakage diagnostic:\n error: any use of this value will cause an error\n   --> $DIR/assert-type-intrinsics.rs:20:9\n    |\n-LL |     const _BAD3: () = unsafe {\n+LL |     const _BAD3: () = {\n    |     ---------------\n LL |         intrinsics::assert_zero_valid::<&'static i32>();\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ aborted execution: attempted to zero-initialize type `&i32`, which is invalid"}]}