{"sha": "7b0eac438ace0ba305b4633328b00474fbbf5120", "node_id": "C_kwDOAAsO6NoAKDdiMGVhYzQzOGFjZTBiYTMwNWI0NjMzMzI4YjAwNDc0ZmJiZjUxMjA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-06-14T11:24:42Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-06-14T11:24:42Z"}, "message": "Auto merge of #112400 - WaffleLapkin:vtable_stats, r=compiler-errors\n\nCollect VTable stats & add `-Zprint-vtable-sizes`\n\nThis is a bit hacky/buggy, but I'm not entirely sure how to fix it, so I want to ask reviewers for help...\n\nTo try this, use either of those:\n- `cargo clean && RUSTFLAGS=\"-Zprint-vtable-sizes\" cargo +toolchain b`\n- `cargo clean && cargo rustc +toolchain -Zprint-vtable-sizes`\n- `rustc +toolchain -Zprint-vtable-sizes ./file.rs`", "tree": {"sha": "9517105c6d97bf97c08d6c114e9183b331952877", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9517105c6d97bf97c08d6c114e9183b331952877"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b0eac438ace0ba305b4633328b00474fbbf5120", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b0eac438ace0ba305b4633328b00474fbbf5120", "html_url": "https://github.com/rust-lang/rust/commit/7b0eac438ace0ba305b4633328b00474fbbf5120", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b0eac438ace0ba305b4633328b00474fbbf5120/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ed2a10d173d6c2e0232776af338ca7d080b1cd4", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ed2a10d173d6c2e0232776af338ca7d080b1cd4", "html_url": "https://github.com/rust-lang/rust/commit/3ed2a10d173d6c2e0232776af338ca7d080b1cd4"}, {"sha": "af4631ad6e16679243a36487431afde477f7d552", "url": "https://api.github.com/repos/rust-lang/rust/commits/af4631ad6e16679243a36487431afde477f7d552", "html_url": "https://github.com/rust-lang/rust/commit/af4631ad6e16679243a36487431afde477f7d552"}], "stats": {"total": 237, "additions": 232, "deletions": 5}, "files": [{"sha": "f8dda23ef9cf6a6b530b34ec6a92f985c6d977d6", "filename": "compiler/rustc_driver_impl/src/lib.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_driver_impl%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_driver_impl%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver_impl%2Fsrc%2Flib.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -430,6 +430,13 @@ fn run_compiler(\n                 sess.code_stats.print_type_sizes();\n             }\n \n+            if sess.opts.unstable_opts.print_vtable_sizes {\n+                let crate_name =\n+                    compiler.session().opts.crate_name.as_deref().unwrap_or(\"<UNKNOWN_CRATE>\");\n+\n+                sess.code_stats.print_vtable_sizes(crate_name);\n+            }\n+\n             let linker = queries.linker()?;\n             Ok(Some(linker))\n         })?;"}, {"sha": "5e3ea71f0e768ef9f23b598e9197417b73c9c838", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -333,6 +333,7 @@ pub fn run_compiler<R: Send>(config: Config, f: impl FnOnce(&Compiler) -> R + Se\n                 };\n \n                 let prof = compiler.sess.prof.clone();\n+\n                 prof.generic_activity(\"drop_compiler\").run(move || drop(compiler));\n                 r\n             })"}, {"sha": "be2af94961ffa9b39bebc742e6590d9d38c8eaed", "filename": "compiler/rustc_interface/src/passes.rs", "status": "modified", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Fpasses.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -24,6 +24,7 @@ use rustc_parse::{parse_crate_from_file, parse_crate_from_source_str, validate_a\n use rustc_passes::{self, hir_stats, layout_test};\n use rustc_plugin_impl as plugin;\n use rustc_resolve::Resolver;\n+use rustc_session::code_stats::VTableSizeInfo;\n use rustc_session::config::{CrateType, Input, OutFileName, OutputFilenames, OutputType};\n use rustc_session::cstore::{MetadataLoader, Untracked};\n use rustc_session::output::filename_for_input;\n@@ -866,6 +867,92 @@ fn analysis(tcx: TyCtxt<'_>, (): ()) -> Result<()> {\n         sess.time(\"check_lint_expectations\", || tcx.check_expectations(None));\n     });\n \n+    if sess.opts.unstable_opts.print_vtable_sizes {\n+        let traits = tcx.traits(LOCAL_CRATE);\n+\n+        for &tr in traits {\n+            if !tcx.check_is_object_safe(tr) {\n+                continue;\n+            }\n+\n+            let name = ty::print::with_no_trimmed_paths!(tcx.def_path_str(tr));\n+\n+            let mut first_dsa = true;\n+\n+            // Number of vtable entries, if we didn't have upcasting\n+            let mut entries_ignoring_upcasting = 0;\n+            // Number of vtable entries needed solely for upcasting\n+            let mut entries_for_upcasting = 0;\n+\n+            let trait_ref = ty::Binder::dummy(ty::TraitRef::identity(tcx, tr));\n+\n+            // A slightly edited version of the code in `rustc_trait_selection::traits::vtable::vtable_entries`,\n+            // that works without self type and just counts number of entries.\n+            //\n+            // Note that this is technically wrong, for traits which have associated types in supertraits:\n+            //\n+            //   trait A: AsRef<Self::T> + AsRef<()> { type T; }\n+            //\n+            // Without self type we can't normalize `Self::T`, so we can't know if `AsRef<Self::T>` and\n+            // `AsRef<()>` are the same trait, thus we assume that those are different, and potentially\n+            // over-estimate how many vtable entries there are.\n+            //\n+            // Similarly this is wrong for traits that have methods with possibly-impossible bounds.\n+            // For example:\n+            //\n+            //   trait B<T> { fn f(&self) where T: Copy; }\n+            //\n+            // Here `dyn B<u8>` will have 4 entries, while `dyn B<String>` will only have 3.\n+            // However, since we don't know `T`, we can't know if `T: Copy` holds or not,\n+            // thus we lean on the bigger side and say it has 4 entries.\n+            traits::vtable::prepare_vtable_segments(tcx, trait_ref, |segment| {\n+                match segment {\n+                    traits::vtable::VtblSegment::MetadataDSA => {\n+                        // If this is the first dsa, it would be included either way,\n+                        // otherwise it's needed for upcasting\n+                        if std::mem::take(&mut first_dsa) {\n+                            entries_ignoring_upcasting += 3;\n+                        } else {\n+                            entries_for_upcasting += 3;\n+                        }\n+                    }\n+\n+                    traits::vtable::VtblSegment::TraitOwnEntries { trait_ref, emit_vptr } => {\n+                        // Lookup the shape of vtable for the trait.\n+                        let own_existential_entries =\n+                            tcx.own_existential_vtable_entries(trait_ref.def_id());\n+\n+                        // The original code here ignores the method if its predicates are impossible.\n+                        // We can't really do that as, for example, all not trivial bounds on generic\n+                        // parameters are impossible (since we don't know the parameters...),\n+                        // see the comment above.\n+                        entries_ignoring_upcasting += own_existential_entries.len();\n+\n+                        if emit_vptr {\n+                            entries_for_upcasting += 1;\n+                        }\n+                    }\n+                }\n+\n+                std::ops::ControlFlow::Continue::<std::convert::Infallible>(())\n+            });\n+\n+            sess.code_stats.record_vtable_size(\n+                tr,\n+                &name,\n+                VTableSizeInfo {\n+                    trait_name: name.clone(),\n+                    entries: entries_ignoring_upcasting + entries_for_upcasting,\n+                    entries_ignoring_upcasting,\n+                    entries_for_upcasting,\n+                    upcasting_cost_percent: entries_for_upcasting as f64\n+                        / entries_ignoring_upcasting as f64\n+                        * 100.,\n+                },\n+            )\n+        }\n+    }\n+\n     Ok(())\n }\n "}, {"sha": "cabe1c96bf7955f5627970591156510ed2ccdd41", "filename": "compiler/rustc_session/src/code_stats.rs", "status": "modified", "additions": 59, "deletions": 1, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Fcode_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Fcode_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fcode_stats.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -1,5 +1,6 @@\n-use rustc_data_structures::fx::FxHashSet;\n+use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n use rustc_data_structures::sync::Lock;\n+use rustc_span::def_id::DefId;\n use rustc_span::Symbol;\n use rustc_target::abi::{Align, Size};\n use std::cmp;\n@@ -65,9 +66,29 @@ pub struct TypeSizeInfo {\n     pub variants: Vec<VariantInfo>,\n }\n \n+pub struct VTableSizeInfo {\n+    pub trait_name: String,\n+\n+    /// Number of entries in a vtable with the current algorithm\n+    /// (i.e. with upcasting).\n+    pub entries: usize,\n+\n+    /// Number of entries in a vtable, as-if we did not have trait upcasting.\n+    pub entries_ignoring_upcasting: usize,\n+\n+    /// Number of entries in a vtable needed solely for upcasting\n+    /// (i.e. `entries - entries_ignoring_upcasting`).\n+    pub entries_for_upcasting: usize,\n+\n+    /// Cost of having upcasting in % relative to the number of entries without\n+    /// upcasting (i.e. `entries_for_upcasting / entries_ignoring_upcasting * 100%`).\n+    pub upcasting_cost_percent: f64,\n+}\n+\n #[derive(Default)]\n pub struct CodeStats {\n     type_sizes: Lock<FxHashSet<TypeSizeInfo>>,\n+    vtable_sizes: Lock<FxHashMap<DefId, VTableSizeInfo>>,\n }\n \n impl CodeStats {\n@@ -101,6 +122,14 @@ impl CodeStats {\n         self.type_sizes.borrow_mut().insert(info);\n     }\n \n+    pub fn record_vtable_size(&self, trait_did: DefId, trait_name: &str, info: VTableSizeInfo) {\n+        let prev = self.vtable_sizes.lock().insert(trait_did, info);\n+        assert!(\n+            prev.is_none(),\n+            \"size of vtable for `{trait_name}` ({trait_did:?}) is already recorded\"\n+        );\n+    }\n+\n     pub fn print_type_sizes(&self) {\n         let type_sizes = self.type_sizes.borrow();\n         let mut sorted: Vec<_> = type_sizes.iter().collect();\n@@ -196,4 +225,33 @@ impl CodeStats {\n             }\n         }\n     }\n+\n+    pub fn print_vtable_sizes(&self, crate_name: &str) {\n+        let mut infos = std::mem::take(&mut *self.vtable_sizes.lock())\n+            .into_iter()\n+            .map(|(_did, stats)| stats)\n+            .collect::<Vec<_>>();\n+\n+        // Primary sort: cost % in reverse order (from largest to smallest)\n+        // Secondary sort: trait_name\n+        infos.sort_by(|a, b| {\n+            a.upcasting_cost_percent\n+                .total_cmp(&b.upcasting_cost_percent)\n+                .reverse()\n+                .then_with(|| a.trait_name.cmp(&b.trait_name))\n+        });\n+\n+        for VTableSizeInfo {\n+            trait_name,\n+            entries,\n+            entries_ignoring_upcasting,\n+            entries_for_upcasting,\n+            upcasting_cost_percent,\n+        } in infos\n+        {\n+            println!(\n+                r#\"print-vtable-sizes {{ \"crate_name\": \"{crate_name}\", \"trait_name\": \"{trait_name}\", \"entries\": \"{entries}\", \"entries_ignoring_upcasting\": \"{entries_ignoring_upcasting}\", \"entries_for_upcasting\": \"{entries_for_upcasting}\", \"upcasting_cost_percent\": \"{upcasting_cost_percent}\" }}\"#\n+            );\n+        }\n+    }\n }"}, {"sha": "d57aa820fcb47b180b4b9f85db20fc3a160d0c9f", "filename": "compiler/rustc_session/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Flib.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -27,7 +27,7 @@ pub use lint::{declare_lint, declare_lint_pass, declare_tool_lint, impl_lint_pas\n pub use rustc_lint_defs as lint;\n pub mod parse;\n \n-mod code_stats;\n+pub mod code_stats;\n #[macro_use]\n pub mod config;\n pub mod cstore;"}, {"sha": "b626c721481dbd187097a9805dea59c6f77f0441", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -1632,6 +1632,8 @@ options! {\n         \"print the result of the monomorphization collection pass\"),\n     print_type_sizes: bool = (false, parse_bool, [UNTRACKED],\n         \"print layout information for each type encountered (default: no)\"),\n+    print_vtable_sizes: bool = (false, parse_bool, [UNTRACKED],\n+        \"print size comparison between old and new vtable layouts (default: no)\"),\n     proc_macro_backtrace: bool = (false, parse_bool, [UNTRACKED],\n          \"show backtraces for panics during proc-macro execution (default: no)\"),\n     proc_macro_execution_strategy: ProcMacroExecutionStrategy = (ProcMacroExecutionStrategy::SameThread,"}, {"sha": "ab58684ffd9c49a772d9ffe0b89a7dacf0cd6d67", "filename": "compiler/rustc_trait_selection/src/traits/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fmod.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -21,7 +21,7 @@ mod structural_match;\n mod structural_normalize;\n #[cfg_attr(not(bootstrap), allow(hidden_glob_reexports))]\n mod util;\n-mod vtable;\n+pub mod vtable;\n pub mod wf;\n \n use crate::infer::outlives::env::OutlivesEnvironment;"}, {"sha": "96b8e0b82b6af62a4df6d1e5650730456f8e15d7", "filename": "compiler/rustc_trait_selection/src/traits/vtable.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fvtable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fvtable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fvtable.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -15,13 +15,13 @@ use std::fmt::Debug;\n use std::ops::ControlFlow;\n \n #[derive(Clone, Debug)]\n-pub(super) enum VtblSegment<'tcx> {\n+pub enum VtblSegment<'tcx> {\n     MetadataDSA,\n     TraitOwnEntries { trait_ref: ty::PolyTraitRef<'tcx>, emit_vptr: bool },\n }\n \n /// Prepare the segments for a vtable\n-pub(super) fn prepare_vtable_segments<'tcx, T>(\n+pub fn prepare_vtable_segments<'tcx, T>(\n     tcx: TyCtxt<'tcx>,\n     trait_ref: ty::PolyTraitRef<'tcx>,\n     mut segment_visitor: impl FnMut(VtblSegment<'tcx>) -> ControlFlow<T>,"}, {"sha": "5656094990be6e06efc04d077cd1b37dd2d516c2", "filename": "tests/ui/traits/object/print_vtable_sizes.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.rs?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -0,0 +1,61 @@\n+// check-pass\n+// compile-flags: -Z print-vtable-sizes\n+#![crate_type = \"lib\"]\n+\n+trait A<T: help::V>: AsRef<[T::V]> + AsMut<[T::V]> {}\n+\n+trait B<T>: AsRef<T> + AsRef<T> + AsRef<T> + AsRef<T> {}\n+\n+trait C {\n+    fn x() {} // not object safe, shouldn't be reported\n+}\n+\n+// This ideally should not have any upcasting cost,\n+// but currently does due to a bug\n+trait D: Send + Sync + help::MarkerWithSuper {}\n+\n+// This can't have no cost without reordering,\n+// because `Super::f`.\n+trait E: help::MarkerWithSuper + Send + Sync {}\n+\n+trait F {\n+    fn a(&self);\n+    fn b(&self);\n+    fn c(&self);\n+\n+    fn d() -> Self\n+    where\n+        Self: Sized;\n+}\n+\n+trait G: AsRef<u8> + AsRef<u16> + help::MarkerWithSuper {\n+    fn a(&self);\n+    fn b(&self);\n+    fn c(&self);\n+    fn d(&self);\n+    fn e(&self);\n+\n+    fn f() -> Self\n+    where\n+        Self: Sized;\n+}\n+\n+// Traits with the same name\n+const _: () = {\n+    trait S {}\n+};\n+const _: () = {\n+    trait S {}\n+};\n+\n+mod help {\n+    pub trait V {\n+        type V;\n+    }\n+\n+    pub trait MarkerWithSuper: Super {}\n+\n+    pub trait Super {\n+        fn f(&self);\n+    }\n+}"}, {"sha": "3ba650bc36045621d2ffc81a23c6cf80be784f33", "filename": "tests/ui/traits/object/print_vtable_sizes.stdout", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7b0eac438ace0ba305b4633328b00474fbbf5120/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/7b0eac438ace0ba305b4633328b00474fbbf5120/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fobject%2Fprint_vtable_sizes.stdout?ref=7b0eac438ace0ba305b4633328b00474fbbf5120", "patch": "@@ -0,0 +1,11 @@\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"D\", \"entries\": \"7\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"3\", \"upcasting_cost_percent\": \"75\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"E\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"2\", \"upcasting_cost_percent\": \"50\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"G\", \"entries\": \"14\", \"entries_ignoring_upcasting\": \"11\", \"entries_for_upcasting\": \"3\", \"upcasting_cost_percent\": \"27.27272727272727\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"A\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"5\", \"entries_for_upcasting\": \"1\", \"upcasting_cost_percent\": \"20\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"B\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"F\", \"entries\": \"6\", \"entries_ignoring_upcasting\": \"6\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"_::S\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"_::S\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::MarkerWithSuper\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::Super\", \"entries\": \"4\", \"entries_ignoring_upcasting\": \"4\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }\n+print-vtable-sizes { \"crate_name\": \"<UNKNOWN_CRATE>\", \"trait_name\": \"help::V\", \"entries\": \"3\", \"entries_ignoring_upcasting\": \"3\", \"entries_for_upcasting\": \"0\", \"upcasting_cost_percent\": \"0\" }"}]}