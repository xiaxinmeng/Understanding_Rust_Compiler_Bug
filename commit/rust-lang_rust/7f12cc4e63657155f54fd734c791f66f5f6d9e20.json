{"sha": "7f12cc4e63657155f54fd734c791f66f5f6d9e20", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmMTJjYzRlNjM2NTcxNTVmNTRmZDczNGM3OTFmNjZmNWY2ZDllMjA=", "commit": {"author": {"name": "Tim Chevalier", "email": "catamorphism@gmail.com", "date": "2012-10-17T18:00:36Z"}, "committer": {"name": "Tim Chevalier", "email": "catamorphism@gmail.com", "date": "2012-10-17T18:00:36Z"}, "message": "Merge pull request #3716 from Blei/fix-3656\n\nrustc: fix size computation of structs for the FFI", "tree": {"sha": "efe3db84cd3d06df79d052d315949b638932d1fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efe3db84cd3d06df79d052d315949b638932d1fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f12cc4e63657155f54fd734c791f66f5f6d9e20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f12cc4e63657155f54fd734c791f66f5f6d9e20", "html_url": "https://github.com/rust-lang/rust/commit/7f12cc4e63657155f54fd734c791f66f5f6d9e20", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f12cc4e63657155f54fd734c791f66f5f6d9e20/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47c83f1844d033a2ee12aa05eed30112804f4585", "url": "https://api.github.com/repos/rust-lang/rust/commits/47c83f1844d033a2ee12aa05eed30112804f4585", "html_url": "https://github.com/rust-lang/rust/commit/47c83f1844d033a2ee12aa05eed30112804f4585"}, {"sha": "25096a212a9ccaa0d181630af5971532c3472182", "url": "https://api.github.com/repos/rust-lang/rust/commits/25096a212a9ccaa0d181630af5971532c3472182", "html_url": "https://github.com/rust-lang/rust/commit/25096a212a9ccaa0d181630af5971532c3472182"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "d307fcb5dca0fb0b271cb02f9140cbc8ec2011a8", "filename": "src/rustc/middle/trans/foreign.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7f12cc4e63657155f54fd734c791f66f5f6d9e20/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f12cc4e63657155f54fd734c791f66f5f6d9e20/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=7f12cc4e63657155f54fd734c791f66f5f6d9e20", "patch": "@@ -112,9 +112,10 @@ fn classify_ty(ty: TypeRef) -> ~[x86_64_reg_class] {\n             Float => 4,\n             Double => 8,\n             Struct => {\n-              do vec::foldl(0, struct_tys(ty)) |s, t| {\n-                    s + ty_size(*t)\n-                }\n+              let size = do vec::foldl(0, struct_tys(ty)) |s, t| {\n+                  align(s, *t) + ty_size(*t)\n+              };\n+              align(size, ty)\n             }\n             Array => {\n               let len = llvm::LLVMGetArrayLength(ty) as uint;"}, {"sha": "feb7ad1db7a8ee324d711f3d4393b8d278856723", "filename": "src/test/run-pass/issue-3656.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7f12cc4e63657155f54fd734c791f66f5f6d9e20/src%2Ftest%2Frun-pass%2Fissue-3656.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f12cc4e63657155f54fd734c791f66f5f6d9e20/src%2Ftest%2Frun-pass%2Fissue-3656.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-3656.rs?ref=7f12cc4e63657155f54fd734c791f66f5f6d9e20", "patch": "@@ -0,0 +1,20 @@\n+// Issue #3656\n+// Incorrect struct size computation in the FFI, because of not taking\n+// the alignment of elements into account.\n+\n+use libc::*;\n+\n+struct KEYGEN {\n+    hash_algorithm: [c_uint]/2,\n+    count: uint32_t,\n+    salt: *c_void,\n+    salt_size: uint32_t,\n+}\n+\n+extern {\n+    // Bogus signature, just need to test if it compiles.\n+    pub fn malloc(++data: KEYGEN);\n+}\n+\n+fn main() {\n+}"}]}