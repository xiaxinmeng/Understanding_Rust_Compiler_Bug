{"sha": "90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "node_id": "C_kwDOAAsO6NoAKDkwZTZkZGM4ZTc3ZWFkZjVjYzgzYmM5NGExZDgxZGZiNTFjNjQzNzE", "commit": {"author": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-04-07T11:08:29Z"}, "committer": {"name": "blyxyas", "email": "blyxyas@gmail.com", "date": "2023-04-07T11:11:18Z"}, "message": "New chapter: \"Type Checking\"", "tree": {"sha": "9c80c57468fb360fc232d8d0756b2f8ceb40c66e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c80c57468fb360fc232d8d0756b2f8ceb40c66e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEM3aofraJSaf7CtgpTTgXC1ovwzQFAmQv+lkACgkQTTgXC1ov\nwzSu7Q//ehIVHErLsut7DOVhU89zww8iRqdtBYFpy+BHOIa5z1Rb5e2jYhAd/QVI\nVYSmR9yGQ1/CiEnsS24NfofRO/H7dXAghOH2ghDsFumK1eciqdZ7E28WEGu0UwxV\nDN0Qqts6h2LFdIALuilgk9iIf3VurFI0SkDTdEqpruz5OFzBW6BpbnUnW+SvZem6\nI/9uI/1jgVFEcuDJ48utNQSGTuJxiOrvmq1CkYbX/kWMnXnZQttM0Yy8vP+5uPqG\nGmhbZQsNXBgHqS0KohVB9KXLJIVqGIrYYr+l9i8VblQySHtjftAh4kn7YiwnOAFa\nVBjtaw78NxbFGCjwxy+diCjXltUpLDcN2TqWmiMf8z3VewGvnVf07R1NIxIHkEol\n2Y+SUoOdT7kv4gyLRO3c+M6kig6Di/y8Xs2mQm5qYq4I3tCDMUjWQcpSAqrvzMUW\npKy3t3KZspqI4itTLIp4agdcY2ib712MYKC0bdym6T/Ew8sE+WNUkbQFSlSKN9tH\nspWoGDUlqVIgRO8fjikzLtdj88rwSs+tPEI4wC20ktijnte/PgnqZbAqP3ngJHM4\nfguW7ZLwvx6/Dxo3OYQUklg2+H3/D3Rz5JOzeUvu8UbdG872i7ApSmh32x5EzXlI\ngFwz8zgzFd392j/k1uExy2N7m/12ZponcI72GRwheF1wYIhZINA=\n=gkQQ\n-----END PGP SIGNATURE-----", "payload": "tree 9c80c57468fb360fc232d8d0756b2f8ceb40c66e\nparent b8cbce8e6aea52f694efe058df546e8028b224ef\nauthor blyxyas <blyxyas@gmail.com> 1680865709 +0200\ncommitter blyxyas <blyxyas@gmail.com> 1680865878 +0200\n\nNew chapter: \"Type Checking\"\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "html_url": "https://github.com/rust-lang/rust/commit/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371/comments", "author": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "blyxyas", "id": 73757586, "node_id": "MDQ6VXNlcjczNzU3NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/73757586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blyxyas", "html_url": "https://github.com/blyxyas", "followers_url": "https://api.github.com/users/blyxyas/followers", "following_url": "https://api.github.com/users/blyxyas/following{/other_user}", "gists_url": "https://api.github.com/users/blyxyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/blyxyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blyxyas/subscriptions", "organizations_url": "https://api.github.com/users/blyxyas/orgs", "repos_url": "https://api.github.com/users/blyxyas/repos", "events_url": "https://api.github.com/users/blyxyas/events{/privacy}", "received_events_url": "https://api.github.com/users/blyxyas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8cbce8e6aea52f694efe058df546e8028b224ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8cbce8e6aea52f694efe058df546e8028b224ef", "html_url": "https://github.com/rust-lang/rust/commit/b8cbce8e6aea52f694efe058df546e8028b224ef"}], "stats": {"total": 127, "additions": 127, "deletions": 0}, "files": [{"sha": "cbd73376dfa070b99071a41b9cb96313164a5ea2", "filename": "book/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371/book%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371/book%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/book%2Fsrc%2FSUMMARY.md?ref=90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "patch": "@@ -13,6 +13,7 @@\n - [Development](development/README.md)\n     - [Basics](development/basics.md)\n     - [Adding Lints](development/adding_lints.md)\n+    - [Type Checking](development/type_checking.md)\n     - [Common Tools](development/common_tools_writing_lints.md)\n     - [Infrastructure](development/infrastructure/README.md)\n         - [Syncing changes between Clippy and rust-lang/rust](development/infrastructure/sync.md)"}, {"sha": "ff08cb1e524001d644c9d3339ac81efde831be97", "filename": "book/src/development/type_checking.md", "status": "added", "additions": 126, "deletions": 0, "changes": 126, "blob_url": "https://github.com/rust-lang/rust/blob/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371/book%2Fsrc%2Fdevelopment%2Ftype_checking.md", "raw_url": "https://github.com/rust-lang/rust/raw/90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371/book%2Fsrc%2Fdevelopment%2Ftype_checking.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/book%2Fsrc%2Fdevelopment%2Ftype_checking.md?ref=90e6ddc8e77eadf5cc83bc94a1d81dfb51c64371", "patch": "@@ -0,0 +1,126 @@\n+# Type Checking\n+\n+When we work on a new lint or improve an existing lint, we might want\n+to retrieve the type `Ty` of an expression `Expr` for a variety of\n+reasons. This can be achieved by utilizing the [`LateContext`][LateContext]\n+that is available for [`LateLintPass`][LateLintPass].\n+\n+## `LateContext` and `TypeckResults`\n+\n+The lint context [`LateContext`][LateContext] and [`TypeckResults`][TypeckResults]\n+(returned by `LateContext::typeck_results`) are the two most useful data structures\n+in `LateLintPass`. They allow us to jump to type definitions and other compilation\n+stages such as HIR.\n+\n+> Note: `LateContext.typeck_results`'s return value is [`TypeckResults`][TypeckResults]\n+> and is created in the type checking step, it includes useful information such as types of\n+> expressions, ways to resolve methods and so on.\n+\n+`TypeckResults` contains useful methods such as [`expr_ty`][expr_ty],\n+which gives us access to the underlying structure [`Ty`][Ty] of a given expression.\n+\n+```rust\n+pub fn expr_ty(&self, expr: &Expr<'_>) -> Ty<'tcx>\n+```\n+\n+As a side note, besides `expr_ty`, [`TypeckResults`][TypeckResults] contains a\n+[`pat_ty()`][pat_ty] method that is useful for retrieving a type from a pattern.\n+\n+## `Ty`\n+\n+`Ty` struct contains the type information of an expression.\n+Let's take a look at `rustc_middle`'s [`Ty`][Ty] struct to examine this struct:\n+\n+```rust\n+pub struct Ty<'tcx>(Interned<'tcx, WithStableHash<TyS<'tcx>>>);\n+```\n+\n+At a first glance, this struct looks quite esoteric. But at a closer look,\n+we will see that this struct contains many useful methods for type checking.\n+\n+For instance, [`is_char`][is_char] checks if the given `Ty` struct corresponds\n+to the primitive character type.\n+\n+### `is_*` Usage\n+\n+In some scenarios, all we need to do is check if the `Ty` of an expression\n+is a specific type, such as `char` type, so we could write the following:\n+\n+```rust\n+impl LateLintPass<'_> for MyStructLint {\n+    fn check_expr(&mut self, cx: &LateContext<'_>, expr: &Expr<'_>) {\n+        // Get type of `expr`\n+        let ty = cx.typeck_results().expr_ty(expr);\n+        \n+        // Check if the `Ty` of this expression is of character type\n+        if ty.is_char() {\n+            println!(\"Our expression is a char!\");\n+        }\n+    }\n+}\n+```\n+\n+Furthermore, if we examine the [source code][is_char_source] for `is_char`,\n+we find something very interesting:\n+\n+```rust\n+#[inline]\n+pub fn is_char(self) -> bool {\n+    matches!(self.kind(), Char)\n+}\n+```\n+\n+Indeed, we just discovered `Ty`'s [`kind` method][kind], which provides us\n+with [`TyKind`][TyKind] of a `Ty`.\n+\n+## `TyKind`\n+\n+`TyKind` defines the kinds of types in Rust's type system.\n+Peeking into [`TyKind` documentation][TyKind], we will see that it is an\n+enum of 27 variants, including items such as `Bool`, `Int`, `Ref`, etc.\n+\n+### `kind` Usage\n+\n+The `TyKind` of `Ty` can be returned by calling [`Ty.kind` method][kind].\n+We often use this method to perform pattern matching in Clippy.\n+\n+For instance, if we want to check for a `struct`, we could examine if the\n+`ty.kind` corresponds to an [`Adt`][Adt] (algebraic data type) and if its\n+[`AdtDef`][AdtDef] is a struct:\n+\n+```rust\n+impl LateLintPass<'_> for MyStructLint {\n+    fn check_expr(&mut self, cx: &LateContext<'_>, expr: &Expr<'_>) {\n+        // Get type of `expr`\n+        let ty = cx.typeck_results().expr_ty(expr);\n+        // Match its kind to enter the type\n+        match ty.kind {\n+            ty::Adt(adt_def, _) if adt_def.is_struct() => println!(\"Our `expr` is a struct!\"),\n+            _ => ()\n+        }\n+    }\n+}\n+```\n+\n+## Useful Links\n+\n+Below are some useful links to further explore the concepts covered\n+in this chapter:\n+\n+- [Stages of compilation](https://rustc-dev-guide.rust-lang.org/compiler-src.html#the-main-stages-of-compilation)\n+- [Diagnostic items](https://rustc-dev-guide.rust-lang.org/diagnostics/diagnostic-items.html)\n+- [Type checking](https://rustc-dev-guide.rust-lang.org/type-checking.html)\n+- [Ty module](https://rustc-dev-guide.rust-lang.org/ty.html)\n+\n+[Adt]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/enum.TyKind.html#variant.Adt\n+[AdtDef]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/adt/struct.AdtDef.html\n+[expr_ty]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TypeckResults.html#method.expr_ty\n+[is_char]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.Ty.html#method.is_char\n+[is_char_source]: https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_middle/ty/sty.rs.html#1831-1834\n+[kind]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.Ty.html#method.kind\n+[LateContext]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/struct.LateContext.html\n+[LateLintPass]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_lint/trait.LateLintPass.html\n+[pat_ty]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/context/struct.TypeckResults.html#method.pat_ty\n+[Ty]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.Ty.html\n+[TyKind]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/enum.TyKind.html\n+[TypeckResults]: https://doc.rust-lang.org/nightly/nightly-rustc/rustc_middle/ty/struct.TypeckResults.html"}]}