{"sha": "2d6f3fede071514724e280a4394d915616b42634", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkNmYzZmVkZTA3MTUxNDcyNGUyODBhNDM5NGQ5MTU2MTZiNDI2MzQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-09-09T16:42:56Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-09-23T16:34:44Z"}, "message": "Move handling of `codegen-units` to `builder.rs`", "tree": {"sha": "8e5ea0d8d09dc7672e5a346999cbd532812aedd3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e5ea0d8d09dc7672e5a346999cbd532812aedd3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d6f3fede071514724e280a4394d915616b42634", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d6f3fede071514724e280a4394d915616b42634", "html_url": "https://github.com/rust-lang/rust/commit/2d6f3fede071514724e280a4394d915616b42634", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d6f3fede071514724e280a4394d915616b42634/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22699d31394489fd42ee53ba4fcf2543ca9a1ec6", "url": "https://api.github.com/repos/rust-lang/rust/commits/22699d31394489fd42ee53ba4fcf2543ca9a1ec6", "html_url": "https://github.com/rust-lang/rust/commit/22699d31394489fd42ee53ba4fcf2543ca9a1ec6"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "84bb539036029da28e25287694f43e0f16c515f4", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2d6f3fede071514724e280a4394d915616b42634/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d6f3fede071514724e280a4394d915616b42634/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=2d6f3fede071514724e280a4394d915616b42634", "patch": "@@ -165,10 +165,6 @@ fn main() {\n             cmd.arg(\"-C\").arg(format!(\"debug-assertions={}\", debug_assertions));\n         }\n \n-        if let Ok(s) = env::var(\"RUSTC_CODEGEN_UNITS\") {\n-            cmd.arg(\"-C\").arg(format!(\"codegen-units={}\", s));\n-        }\n-\n         if let Ok(map) = env::var(\"RUSTC_DEBUGINFO_MAP\") {\n             cmd.arg(\"--remap-path-prefix\").arg(&map);\n         }"}, {"sha": "776d163963a5957b1125d6a5d4865faaa15a0150", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2d6f3fede071514724e280a4394d915616b42634/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d6f3fede071514724e280a4394d915616b42634/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=2d6f3fede071514724e280a4394d915616b42634", "patch": "@@ -774,7 +774,17 @@ impl<'a> Builder<'a> {\n \n         cargo\n             .env(\"CARGO_TARGET_DIR\", out_dir)\n-            .arg(cmd);\n+            .arg(cmd)\n+            .arg(\"-Zconfig-profile\");\n+\n+        let profile_var = |name: &str| {\n+            let profile = if self.config.rust_optimize {\n+                \"RELEASE\"\n+            } else {\n+                \"DEV\"\n+            };\n+            format!(\"CARGO_PROFILE_{}_{}\", profile, name)\n+        };\n \n         // See comment in librustc_llvm/build.rs for why this is necessary, largely llvm-config\n         // needs to not accidentally link to libLLVM in stage0/lib.\n@@ -1190,7 +1200,7 @@ impl<'a> Builder<'a> {\n         match (mode, self.config.rust_codegen_units_std, self.config.rust_codegen_units) {\n             (Mode::Std, Some(n), _) |\n             (_, _, Some(n)) => {\n-                cargo.env(\"RUSTC_CODEGEN_UNITS\", n.to_string());\n+                cargo.env(profile_var(\"CODEGEN_UNITS\"), n.to_string());\n             }\n             _ => {\n                 // Don't set anything"}]}