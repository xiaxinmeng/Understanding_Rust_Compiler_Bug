{"sha": "a928f6446474cc122e7568e6c243d75dc3baa7c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5MjhmNjQ0NjQ3NGNjMTIyZTc1NjhlNmMyNDNkNzVkYzNiYWE3YzU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-04-03T20:55:07Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-03T20:55:07Z"}, "message": "Rollup merge of #70640 - jonas-schievink:async-ice, r=cramertj\n\nHide `task_context` when lowering body\n\nFixes https://github.com/rust-lang/rust/issues/70594", "tree": {"sha": "876530c94068287c60efc5e8014fc7e197ed69a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/876530c94068287c60efc5e8014fc7e197ed69a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a928f6446474cc122e7568e6c243d75dc3baa7c5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeh6KrCRBK7hj4Ov3rIwAAdHIIAJOATCjMkkFOo5vjFgc3S3SQ\nehtES34DeveMSJlUFKF3yCOCg6xeJFBTLF3Q//pMwp5XqJPTpGqIKiQR9vvMO5wY\nFztC5ksB25/aujzOwXvndRUznuqxhfghIwdXM248WTDQ6xd91A32ksEN1GRXSpj/\ndhq6jQrEUo+6yEGyMQJflX4QUX0l8yRqGog4QW6aH4hYZOAc+d4ige93iIFDio44\nM8ALIcQ6/MKdK47qoCo//7EyHCapwOtDyUvndxXvQ+glybbzlibygjkVggZjFtv9\nVKO+qBamfswiUm9g4AYBY8q8cPoAooH8DNiRjG36CkTV1nmET/jkxpgjebmrsws=\n=4YT7\n-----END PGP SIGNATURE-----\n", "payload": "tree 876530c94068287c60efc5e8014fc7e197ed69a6\nparent 1ea8653d0116365e09dca7b22c7264d0fc877433\nparent c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1585947307 +0200\ncommitter GitHub <noreply@github.com> 1585947307 +0200\n\nRollup merge of #70640 - jonas-schievink:async-ice, r=cramertj\n\nHide `task_context` when lowering body\n\nFixes https://github.com/rust-lang/rust/issues/70594\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a928f6446474cc122e7568e6c243d75dc3baa7c5", "html_url": "https://github.com/rust-lang/rust/commit/a928f6446474cc122e7568e6c243d75dc3baa7c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a928f6446474cc122e7568e6c243d75dc3baa7c5/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ea8653d0116365e09dca7b22c7264d0fc877433", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ea8653d0116365e09dca7b22c7264d0fc877433", "html_url": "https://github.com/rust-lang/rust/commit/1ea8653d0116365e09dca7b22c7264d0fc877433"}, {"sha": "c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44", "html_url": "https://github.com/rust-lang/rust/commit/c7d9d89e9b160ff629ffe5725fd52dc4cbdcff44"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "6005b607026fb4d006f32ecc26639c072d606157", "filename": "src/librustc_ast_lowering/item.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Flibrustc_ast_lowering%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Flibrustc_ast_lowering%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_lowering%2Fitem.rs?ref=a928f6446474cc122e7568e6c243d75dc3baa7c5", "patch": "@@ -972,8 +972,10 @@ impl<'hir> LoweringContext<'_, 'hir> {\n         f: impl FnOnce(&mut Self) -> (&'hir [hir::Param<'hir>], hir::Expr<'hir>),\n     ) -> hir::BodyId {\n         let prev_gen_kind = self.generator_kind.take();\n+        let task_context = self.task_context.take();\n         let (parameters, result) = f(self);\n         let body_id = self.record_body(parameters, result);\n+        self.task_context = task_context;\n         self.generator_kind = prev_gen_kind;\n         body_id\n     }"}, {"sha": "e78231a68512daf1f306cb1e24f6f19ee5841551", "filename": "src/test/ui/async-await/issue-70594.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.rs?ref=a928f6446474cc122e7568e6c243d75dc3baa7c5", "patch": "@@ -0,0 +1,12 @@\n+// edition:2018\n+\n+async fn fun() {\n+    [1; ().await];\n+    //~^ error: `await` is only allowed inside `async` functions and blocks\n+    //~| error: `.await` is not allowed in a `const`\n+    //~| error: `loop` is not allowed in a `const`\n+    //~| error: `.await` is not allowed in a `const`\n+    //~| error: the trait bound `(): std::future::Future` is not satisfied\n+}\n+\n+fn main() {}"}, {"sha": "d2fa7e58f6a9b7ec5e0ef540a071452959f53a5e", "filename": "src/test/ui/async-await/issue-70594.stderr", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a928f6446474cc122e7568e6c243d75dc3baa7c5/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-70594.stderr?ref=a928f6446474cc122e7568e6c243d75dc3baa7c5", "patch": "@@ -0,0 +1,44 @@\n+error[E0728]: `await` is only allowed inside `async` functions and blocks\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL | async fn fun() {\n+   |          --- this is not `async`\n+LL |     [1; ().await];\n+   |         ^^^^^^^^ only allowed inside `async` functions and blocks\n+\n+error[E0744]: `.await` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+\n+error[E0658]: `loop` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+   |\n+   = note: see issue #52000 <https://github.com/rust-lang/rust/issues/52000> for more information\n+   = help: add `#![feature(const_loop)]` to the crate attributes to enable\n+\n+error[E0744]: `.await` is not allowed in a `const`\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^\n+\n+error[E0277]: the trait bound `(): std::future::Future` is not satisfied\n+  --> $DIR/issue-70594.rs:4:9\n+   |\n+LL |     [1; ().await];\n+   |         ^^^^^^^^ the trait `std::future::Future` is not implemented for `()`\n+   | \n+  ::: $SRC_DIR/libcore/future/mod.rs:LL:COL\n+   |\n+LL |     F: Future,\n+   |        ------ required by this bound in `std::future::poll_with_context`\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0277, E0658, E0728, E0744.\n+For more information about an error, try `rustc --explain E0277`."}]}