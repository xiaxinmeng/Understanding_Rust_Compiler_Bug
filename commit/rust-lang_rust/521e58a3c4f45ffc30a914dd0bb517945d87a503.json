{"sha": "521e58a3c4f45ffc30a914dd0bb517945d87a503", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyMWU1OGEzYzRmNDVmZmMzMGE5MTRkZDBiYjUxNzk0NWQ4N2E1MDM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-23T23:15:57Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-23T23:16:14Z"}, "message": "rustdoc: Get the crate brief description from the 'desc' attr", "tree": {"sha": "723890fd3c7240a3ee133bf8f0e4c64bd8654e76", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/723890fd3c7240a3ee133bf8f0e4c64bd8654e76"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/521e58a3c4f45ffc30a914dd0bb517945d87a503", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/521e58a3c4f45ffc30a914dd0bb517945d87a503", "html_url": "https://github.com/rust-lang/rust/commit/521e58a3c4f45ffc30a914dd0bb517945d87a503", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/521e58a3c4f45ffc30a914dd0bb517945d87a503/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7857dcb88c7e6ab615415541655393aa2b44bb95", "url": "https://api.github.com/repos/rust-lang/rust/commits/7857dcb88c7e6ab615415541655393aa2b44bb95", "html_url": "https://github.com/rust-lang/rust/commit/7857dcb88c7e6ab615415541655393aa2b44bb95"}], "stats": {"total": 40, "additions": 35, "deletions": 5}, "files": [{"sha": "bb75270b3816851c15d77685fd9de1cb3f242aa9", "filename": "src/rustdoc/attr_parser.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Fattr_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Fattr_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_parser.rs?ref=521e58a3c4f45ffc30a914dd0bb517945d87a503", "patch": "@@ -13,7 +13,8 @@ export crate_attrs, mod_attrs, fn_attrs, arg_attrs;\n export parse_crate, parse_mod, parse_fn;\n \n type crate_attrs = {\n-    name: option<str>\n+    name: option<str>,\n+    desc: option<str>\n };\n \n type mod_attrs = {\n@@ -55,9 +56,11 @@ fn doc_meta(\n \n fn parse_crate(attrs: [ast::attribute]) -> crate_attrs {\n     let link_metas = attr::find_linkage_metas(attrs);\n+    let attr_metas = attr::attr_metas(attrs);\n \n     {\n-        name: attr::meta_item_value_from_list(link_metas, \"name\")\n+        name: attr::meta_item_value_from_list(link_metas, \"name\"),\n+        desc: attr::meta_item_value_from_list(attr_metas, \"desc\")\n     }\n }\n \n@@ -85,6 +88,14 @@ fn should_not_extract_crate_name_if_no_name_value_in_link_attribute() {\n     assert attrs.name == none;\n }\n \n+#[test]\n+fn should_extract_crate_desc() {\n+    let source = \"#[desc = \\\"Teddybears\\\"]\";\n+    let attrs = test::parse_attributes(source);\n+    let attrs = parse_crate(attrs);\n+    assert attrs.desc == some(\"Teddybears\");\n+}\n+\n fn parse_mod(attrs: [ast::attribute]) -> mod_attrs {\n     parse_short_doc_or(\n         attrs,"}, {"sha": "cc60268f0c73e5fcb4b125fc3d9d9fd4ad0e28c8", "filename": "src/rustdoc/attr_pass.rs", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Fattr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Fattr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_pass.rs?ref=521e58a3c4f45ffc30a914dd0bb517945d87a503", "patch": "@@ -36,14 +36,25 @@ fn fold_crate(\n     let srv = fold.ctxt;\n     let doc = fold::default_seq_fold_crate(fold, doc);\n \n+    // Use various crate attributes to set documentation on the top mod\n+\n     let attrs = astsrv::exec(srv) {|ctxt|\n         let attrs = ctxt.ast.node.attrs;\n         attr_parser::parse_crate(attrs)\n     };\n \n+    let brief = option::maybe(doc.topmod.brief, attrs.desc) {|desc|\n+        if option::is_some(doc.topmod.brief) {\n+            #warn(\"overriding crate brief doc attribute \\\n+                   with crate description\");\n+        }\n+        some(desc)\n+    };\n+\n     ~{\n         topmod: ~{\n-            name: option::from_maybe(doc.topmod.name, attrs.name)\n+            name: option::from_maybe(doc.topmod.name, attrs.name),\n+            brief: brief\n             with *doc.topmod\n         }\n     }\n@@ -59,6 +70,16 @@ fn should_replace_top_module_name_with_crate_name() {\n     assert doc.topmod.name == \"bond\";\n }\n \n+#[test]\n+fn should_replace_top_module_brief_with_crate_desc() {\n+    let source = \"#[desc = \\\"The Rust compiler\\\"];\";\n+    let srv = astsrv::mk_srv_from_str(source);\n+    let doc = extract::from_srv(srv, \"\");\n+    let fold = fold::default_seq_fold(srv);\n+    let doc = fold_crate(fold, doc);\n+    assert doc.topmod.brief == some(\"The Rust compiler\");\n+}\n+\n fn fold_mod(fold: fold::fold<astsrv::srv>, doc: doc::moddoc) -> doc::moddoc {\n     let srv = fold.ctxt;\n     let attrs = if doc.id == ast::crate_node_id {"}, {"sha": "8fa898b5a9d67083c5d589a10902bab435724db8", "filename": "src/rustdoc/rustdoc.rc", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Frustdoc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/521e58a3c4f45ffc30a914dd0bb517945d87a503/src%2Frustdoc%2Frustdoc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rc?ref=521e58a3c4f45ffc30a914dd0bb517945d87a503", "patch": "@@ -1,5 +1,3 @@\n-#[doc = \"Rustdoc - The Rust documentation generator\"];\n-\n #[link(name = \"rustdoc\",\n        vers = \"0.1\",\n        uuid = \"f8abd014-b281-484d-a0c3-26e3de8e2412\","}]}