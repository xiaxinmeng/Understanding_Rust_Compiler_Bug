{"sha": "5c82a5434b8370a9ed119577b0cf1afb995d6a17", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjODJhNTQzNGI4MzcwYTllZDExOTU3N2IwY2YxYWZiOTk1ZDZhMTc=", "commit": {"author": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2017-09-12T01:09:26Z"}, "committer": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2017-09-22T02:25:02Z"}, "message": "Trim and document libc shim", "tree": {"sha": "81e3f9392689de50136d9a54cecd06e90c9fa99e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81e3f9392689de50136d9a54cecd06e90c9fa99e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c82a5434b8370a9ed119577b0cf1afb995d6a17", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE/uKQcsWiEQj1Z6uEHB6YzI4Xu4kFAlnEdH8ACgkQHB6YzI4X\nu4nf6hAAngOZjNVViPskNAvPhD74YzsW4+BvviCdnXSM8av5Fme7ANJsBgv1Dw8U\n2vPqQ+ujr6/xbqQWh3si8a75MJFRBYNlyjZKibMyccegWT3SamcwZ8LUhk6BPDxq\nStMTSjGx2J1DIS0sPPB246m+PApgt2ypYvd/35HDp+eNrBMZwHrsKHsKA6xEFtLp\nT/Rw4Tjh4xA1I51SgXzEDi48PHkW5I2uyiH7n96yuNv4WpBk+qx3/GrkLH1kdZ6D\nLj6Ufyn/nlzgZNj6Ay/sCiPMFI2BIFMOr0Odlejd+yW9ZmsWlnS/vzDd8/bFFQuR\nJulqIl2QwHqM+PtVOcT3zRFb3CA66ZSztfYW1E+KMxEomH0ctAHwv6NRmpqp+rhp\nnalJsvpPx0PV8cwtGLIZdWJNDE4vu4C7c5lMxkTaeDwXxbX4813/yQpmjlETj7lb\n/maOoaLNkjm9XkG3pZJhPtStlxtHfywTjA/h4jzo0/E4/tQr+HZel+U45qrbNxud\nNiHBFzOoQUbqkHHahXUOvhUUeSInIXaZ76AHHM97efLYvnaUx/lQvfcAN+vrFMPg\nboreWO9LIf9fNZDEyJUyvbCz5mmjkzHV/KG460I2UHjPOqvP8QkwMH0ZAF5hRDh8\nnVzLYKkXKa1Gak8xWbhU1gwxTNNGpd0diQRD8GMx/bC5Gwnt+4g=\n=KAOt\n-----END PGP SIGNATURE-----", "payload": "tree 81e3f9392689de50136d9a54cecd06e90c9fa99e\nparent 17600c1ea77ad8709ea072ad1b258bf9398b9d38\nauthor Tamir Duberstein <tamird@gmail.com> 1505178566 -0400\ncommitter Tamir Duberstein <tamird@gmail.com> 1506047102 -0400\n\nTrim and document libc shim\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c82a5434b8370a9ed119577b0cf1afb995d6a17", "html_url": "https://github.com/rust-lang/rust/commit/5c82a5434b8370a9ed119577b0cf1afb995d6a17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c82a5434b8370a9ed119577b0cf1afb995d6a17/comments", "author": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "17600c1ea77ad8709ea072ad1b258bf9398b9d38", "url": "https://api.github.com/repos/rust-lang/rust/commits/17600c1ea77ad8709ea072ad1b258bf9398b9d38", "html_url": "https://github.com/rust-lang/rust/commit/17600c1ea77ad8709ea072ad1b258bf9398b9d38"}], "stats": {"total": 52, "additions": 24, "deletions": 28}, "files": [{"sha": "136bf195dfa546a3589f414c1dfe693aa6ff1018", "filename": "src/liblibc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblibc?ref=5c82a5434b8370a9ed119577b0cf1afb995d6a17", "patch": "@@ -1 +1 @@\n-Subproject commit 95848f9622deccc9cbadcd5d3a4faef01a90ead4\n+Subproject commit 136bf195dfa546a3589f414c1dfe693aa6ff1018"}, {"sha": "0c04402124a2de290c13d4c2f3b47c9083da6ea7", "filename": "src/rustc/libc_shim/Cargo.toml", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/5c82a5434b8370a9ed119577b0cf1afb995d6a17/src%2Frustc%2Flibc_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5c82a5434b8370a9ed119577b0cf1afb995d6a17/src%2Frustc%2Flibc_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Flibc_shim%2FCargo.toml?ref=5c82a5434b8370a9ed119577b0cf1afb995d6a17", "patch": "@@ -1,16 +1,7 @@\n-# This is a shim Cargo.toml over the \"real Cargo.toml\" found in the libc\n-# repository itself. The purpose for this is to add a build script which prints\n-# out `--cfg stdbuild` to mirror the makefiles' build system.\n-#\n-# Note that other than that this isn't actually needed, and we should probably\n-# remove this shim in favor of just working with cargo features directly with\n-# libc. That should make everything nicer!\n-\n [package]\n name = \"libc\"\n version = \"0.0.0\"\n authors = [\"The Rust Project Developers\"]\n-build = \"build.rs\"\n \n [lib]\n name = \"libc\"\n@@ -20,4 +11,27 @@ bench = false\n doc = false\n \n [dependencies]\n+# Specify the path to libcore; at the time of writing, removing this shim in\n+# favor of using libc from git results in a compilation failure:\n+#\n+# Building stage0 std artifacts (x86_64-apple-darwin -> x86_64-apple-darwin)\n+#    Compiling libc v0.0.0 (file:///Users/tamird/src/rust/src/rustc/libc_shim)\n+# error[E0463]: can't find crate for `core`\n+#\n+# error: aborting due to previous error\n+#\n+# error: Could not compile `libc`.\n+#\n+# Caused by:\n+#   process didn't exit successfully: `/Users/tamird/src/rust/build/bootstrap/debug/rustc --crate-name libc src/rustc/libc_shim/../../liblibc/src/lib.rs --error-format json --crate-type lib --emit=dep-info,link -C opt-level=2 --cfg feature=\"default\" --cfg feature=\"no_std\" --cfg feature=\"stdbuild\" -C metadata=d758f87058112d7d -C extra-filename=-d758f87058112d7d --out-dir /Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps --target x86_64-apple-darwin -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/release/deps` (exit code: 101)\n+# thread 'main' panicked at 'command did not execute successfully: \"/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0/bin/cargo\" \"build\" \"-j\" \"4\" \"--target\" \"x86_64-apple-darwin\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/Users/tamird/src/rust/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\n+# expected success, got: exit code: 101', src/bootstrap/compile.rs:883:8\n+#\n+# See https://github.com/rust-lang/rfcs/pull/1133.\n core = { path = \"../../libcore\" }\n+\n+[features]\n+# Certain parts of libc are conditionally compiled differently than when used\n+# outside rustc. See https://github.com/rust-lang/libc/search?l=Rust&q=stdbuild&type=&utf8=%E2%9C%93.\n+stdbuild = []\n+default = [\"stdbuild\"]"}, {"sha": "546f60482e7bcd21561227ecff7ed2b496baf2af", "filename": "src/rustc/libc_shim/build.rs", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/17600c1ea77ad8709ea072ad1b258bf9398b9d38/src%2Frustc%2Flibc_shim%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17600c1ea77ad8709ea072ad1b258bf9398b9d38/src%2Frustc%2Flibc_shim%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Flibc_shim%2Fbuild.rs?ref=17600c1ea77ad8709ea072ad1b258bf9398b9d38", "patch": "@@ -1,18 +0,0 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#![deny(warnings)]\n-\n-// See comments in Cargo.toml for why this exists\n-\n-fn main() {\n-    println!(\"cargo:rustc-cfg=stdbuild\");\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-}"}]}