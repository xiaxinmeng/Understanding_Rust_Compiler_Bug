{"sha": "0eda5098bd0931a22cb42930d0963306c92f15f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlZGE1MDk4YmQwOTMxYTIyY2I0MjkzMGQwOTYzMzA2YzkyZjE1ZjI=", "commit": {"author": {"name": "Deadbeef", "email": "fee1-dead-beef@protonmail.com", "date": "2021-05-30T02:54:50Z"}, "committer": {"name": "Deadbeef", "email": "fee1-dead-beef@protonmail.com", "date": "2021-05-30T02:54:50Z"}, "message": "Do not suggest ampmut if rhs is already mutable", "tree": {"sha": "c11be8a06d5bf5260c9d6c2c19c7e5576827b26c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c11be8a06d5bf5260c9d6c2c19c7e5576827b26c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0eda5098bd0931a22cb42930d0963306c92f15f2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEErZiERmmtiO2FTkTyyGmC8u3gwSgFAmCy/noACgkQyGmC8u3g\nwSjdTg//eBVay6/0TM0UmX8lmtMhweWn7KvPulTcU31G2nrNLrRW6m5FDo+zOH/Z\nR/kl/fgq3LcVhcBGpPzC1nIVy+bVszvPlzK1Sp0joJh4gPSYEbX2l+Pjm4NtoyI8\nId88+xNKLQS4u2nB2zXnn9UzPPMt0+d/AtDtho8L+9u+flsABJQpfYYxXQla+jmX\nh0OXdZKwSvku1aJ6PYhz0d5v7L5avFuiZKi/Wgu1r/jeXfRhCE3uO1VyW+b+dMyq\n2RAifzt4HGDcnvFbEVy6rlrY1Lxq1vR/NonD84Np8zZMteVA+dEU5y9Yph58E4Dw\nokPlYXz/QioM2fiv5Q99dZReI67wT0p5kdeosBFJXDq0YGpOifrDIzLtVmSXcJQu\nFZb44/bQ49hws+VpyPaAS396vfGV8r7zvOy/bl0oGP+yQLuoKjHw3ldVDHG1oLeu\nhIRUYVvx2wrBidOueED9ExTpjd43yW7Smpm1zZe2DfU9bZz/fc19e+chiC7WYB/+\nPor6ikpH5rywzQpqPiCjmmslMQyjcl+sXDcZrd3Riu+TxUk974MzDs4LX9qgLRP8\ng0VPc0mDTWovHBlt3V3LLp6boV+JYVk9B4yjY4zyrippJye54dX5u/kXvyNDhaYY\n63CD/h2XR8LqYF0J4i+0wzvJESSPi0eF6a4ntvG7UbUAvM2jFMI=\n=QjZp\n-----END PGP SIGNATURE-----", "payload": "tree c11be8a06d5bf5260c9d6c2c19c7e5576827b26c\nparent ce0d64e03ef9875e0935bb60e989542b7ec29579\nauthor Deadbeef <fee1-dead-beef@protonmail.com> 1622343290 +0800\ncommitter Deadbeef <fee1-dead-beef@protonmail.com> 1622343290 +0800\n\nDo not suggest ampmut if rhs is already mutable\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0eda5098bd0931a22cb42930d0963306c92f15f2", "html_url": "https://github.com/rust-lang/rust/commit/0eda5098bd0931a22cb42930d0963306c92f15f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0eda5098bd0931a22cb42930d0963306c92f15f2/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce0d64e03ef9875e0935bb60e989542b7ec29579", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce0d64e03ef9875e0935bb60e989542b7ec29579", "html_url": "https://github.com/rust-lang/rust/commit/ce0d64e03ef9875e0935bb60e989542b7ec29579"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "bf5f2c0eec23edc8382fc0819410dd4811600948", "filename": "compiler/rustc_mir/src/borrow_check/diagnostics/mutability_errors.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0eda5098bd0931a22cb42930d0963306c92f15f2/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Fdiagnostics%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eda5098bd0931a22cb42930d0963306c92f15f2/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Fdiagnostics%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Fdiagnostics%2Fmutability_errors.rs?ref=0eda5098bd0931a22cb42930d0963306c92f15f2", "patch": "@@ -902,9 +902,13 @@ fn suggest_ampmut<'tcx>(\n             {\n                 let lt_name = &src[1..ws_pos];\n                 let ty = &src[ws_pos..];\n-                return (assignment_rhs_span, format!(\"&{} mut {}\", lt_name, ty));\n+                if !ty.trim_start().starts_with(\"mut\") {\n+                    return (assignment_rhs_span, format!(\"&{} mut {}\", lt_name, ty));\n+                }\n             } else if let Some(stripped) = src.strip_prefix('&') {\n-                return (assignment_rhs_span, format!(\"&mut {}\", stripped));\n+                if !stripped.trim_start().starts_with(\"mut\") {\n+                    return (assignment_rhs_span, format!(\"&mut {}\", stripped));\n+                }\n             }\n         }\n     }"}, {"sha": "b82e0298158aa7c0a22af435a46a5efcd00d930c", "filename": "src/test/ui/borrowck/issue-85765.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0eda5098bd0931a22cb42930d0963306c92f15f2/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0eda5098bd0931a22cb42930d0963306c92f15f2/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.rs?ref=0eda5098bd0931a22cb42930d0963306c92f15f2", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    let mut test = Vec::new();\n+    let rofl: &Vec<Vec<i32>> = &mut test;\n+    //~^ HELP consider changing this to be a mutable reference\n+    rofl.push(Vec::new());\n+    //~^ ERROR cannot borrow `*rofl` as mutable, as it is behind a `&` reference\n+    //~| NOTE `rofl` is a `&` reference, so the data it refers to cannot be borrowed as mutable\n+}"}, {"sha": "863c2e8eccc8c65952cf31701ec247cb7c175e2f", "filename": "src/test/ui/borrowck/issue-85765.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0eda5098bd0931a22cb42930d0963306c92f15f2/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0eda5098bd0931a22cb42930d0963306c92f15f2/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-85765.stderr?ref=0eda5098bd0931a22cb42930d0963306c92f15f2", "patch": "@@ -0,0 +1,12 @@\n+error[E0596]: cannot borrow `*rofl` as mutable, as it is behind a `&` reference\n+  --> $DIR/issue-85765.rs:5:5\n+   |\n+LL |     let rofl: &Vec<Vec<i32>> = &mut test;\n+   |         ---- help: consider changing this to be a mutable reference: `&mut Vec<Vec<i32>>`\n+LL |\n+LL |     rofl.push(Vec::new());\n+   |     ^^^^ `rofl` is a `&` reference, so the data it refers to cannot be borrowed as mutable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0596`."}]}