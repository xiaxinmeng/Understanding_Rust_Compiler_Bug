{"sha": "79fb037cc5f34368de069e8958ffc3a21036d091", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5ZmIwMzdjYzVmMzQzNjhkZTA2OWU4OTU4ZmZjM2EyMTAzNmQwOTE=", "commit": {"author": {"name": "oli", "email": "oli@uhura.edef.eu", "date": "2020-10-06T12:25:08Z"}, "committer": {"name": "oli", "email": "github35764891676564198441@oli-obk.de", "date": "2020-11-28T17:13:47Z"}, "message": "Remove now-unnecessary `miri_static_root` invocation", "tree": {"sha": "2266d04136973722c5a010f6fbf33664919ccf8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2266d04136973722c5a010f6fbf33664919ccf8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/79fb037cc5f34368de069e8958ffc3a21036d091", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/79fb037cc5f34368de069e8958ffc3a21036d091", "html_url": "https://github.com/rust-lang/rust/commit/79fb037cc5f34368de069e8958ffc3a21036d091", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/79fb037cc5f34368de069e8958ffc3a21036d091/comments", "author": null, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aabe70f90e30c45f13dbdaaed1ea05776e541b8d", "url": "https://api.github.com/repos/rust-lang/rust/commits/aabe70f90e30c45f13dbdaaed1ea05776e541b8d", "html_url": "https://github.com/rust-lang/rust/commit/aabe70f90e30c45f13dbdaaed1ea05776e541b8d"}], "stats": {"total": 13, "additions": 0, "deletions": 13}, "files": [{"sha": "fb2bb0613ee88e96ddcf1dfd4d3cfa926bff6fa7", "filename": "library/std/src/sys/windows/thread_local_key.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/79fb037cc5f34368de069e8958ffc3a21036d091/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_key.rs", "raw_url": "https://github.com/rust-lang/rust/raw/79fb037cc5f34368de069e8958ffc3a21036d091/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_key.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_key.rs?ref=79fb037cc5f34368de069e8958ffc3a21036d091", "patch": "@@ -110,16 +110,6 @@ struct Node {\n     next: *mut Node,\n }\n \n-#[cfg(miri)]\n-extern \"Rust\" {\n-    /// Miri-provided extern function to mark the block `ptr` points to as a \"root\"\n-    /// for some static memory. This memory and everything reachable by it is not\n-    /// considered leaking even if it still exists when the program terminates.\n-    ///\n-    /// `ptr` has to point to the beginning of an allocated block.\n-    fn miri_static_root(ptr: *const u8);\n-}\n-\n unsafe fn register_dtor(key: Key, dtor: Dtor) {\n     let mut node = Box::new(Node { key, dtor, next: ptr::null_mut() });\n \n@@ -128,9 +118,6 @@ unsafe fn register_dtor(key: Key, dtor: Dtor) {\n         node.next = head;\n         match DTORS.compare_exchange(head, &mut *node, SeqCst, SeqCst) {\n             Ok(_) => {\n-                #[cfg(miri)]\n-                miri_static_root(&*node as *const _ as *const u8);\n-\n                 mem::forget(node);\n                 return;\n             }"}]}