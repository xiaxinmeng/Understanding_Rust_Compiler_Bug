{"sha": "f80ff7da394da0be629df6758b8fd513ee6ef438", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4MGZmN2RhMzk0ZGEwYmU2MjlkZjY3NThiOGZkNTEzZWU2ZWY0Mzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-06-11T02:50:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-06-11T02:50:42Z"}, "message": "Auto merge of #34174 - shepmaster:16-bit-mir, r=Aatch\n\nSupport 16-bit pointers in MIR", "tree": {"sha": "4bab96ba89dd04d81061b9112854692fdfa88032", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bab96ba89dd04d81061b9112854692fdfa88032"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f80ff7da394da0be629df6758b8fd513ee6ef438", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f80ff7da394da0be629df6758b8fd513ee6ef438", "html_url": "https://github.com/rust-lang/rust/commit/f80ff7da394da0be629df6758b8fd513ee6ef438", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f80ff7da394da0be629df6758b8fd513ee6ef438/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0554abac637800415bb1b30d8656898552a55ea0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0554abac637800415bb1b30d8656898552a55ea0", "html_url": "https://github.com/rust-lang/rust/commit/0554abac637800415bb1b30d8656898552a55ea0"}, {"sha": "1858cfb80d865f733aba16e679b842365f5ae4cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/1858cfb80d865f733aba16e679b842365f5ae4cd", "html_url": "https://github.com/rust-lang/rust/commit/1858cfb80d865f733aba16e679b842365f5ae4cd"}], "stats": {"total": 48, "additions": 26, "deletions": 22}, "files": [{"sha": "7551bc5c234ef3096bce47dfdbbae0de496603c0", "filename": "src/librustc_const_eval/eval.rs", "status": "modified", "additions": 5, "deletions": 20, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_eval%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_eval%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_const_eval%2Feval.rs?ref=f80ff7da394da0be629df6758b8fd513ee6ef438", "patch": "@@ -945,32 +945,23 @@ fn infer<'a, 'tcx>(i: ConstInt,\n         (&ty::TyInt(IntTy::I32), Infer(i)) => Ok(I32(i as i64 as i32)),\n         (&ty::TyInt(IntTy::I64), Infer(i)) => Ok(I64(i as i64)),\n         (&ty::TyInt(IntTy::Is), Infer(i)) => {\n-            match ConstIsize::new(i as i64, tcx.sess.target.int_type) {\n-                Ok(val) => Ok(Isize(val)),\n-                Err(_) => Ok(Isize(ConstIsize::Is32(i as i64 as i32))),\n-            }\n+            Ok(Isize(ConstIsize::new_truncating(i as i64, tcx.sess.target.int_type)))\n         },\n \n         (&ty::TyInt(IntTy::I8), InferSigned(i)) => Ok(I8(i as i8)),\n         (&ty::TyInt(IntTy::I16), InferSigned(i)) => Ok(I16(i as i16)),\n         (&ty::TyInt(IntTy::I32), InferSigned(i)) => Ok(I32(i as i32)),\n         (&ty::TyInt(IntTy::I64), InferSigned(i)) => Ok(I64(i)),\n         (&ty::TyInt(IntTy::Is), InferSigned(i)) => {\n-            match ConstIsize::new(i, tcx.sess.target.int_type) {\n-                Ok(val) => Ok(Isize(val)),\n-                Err(_) => Ok(Isize(ConstIsize::Is32(i as i32))),\n-            }\n+            Ok(Isize(ConstIsize::new_truncating(i, tcx.sess.target.int_type)))\n         },\n \n         (&ty::TyUint(UintTy::U8), Infer(i)) => Ok(U8(i as u8)),\n         (&ty::TyUint(UintTy::U16), Infer(i)) => Ok(U16(i as u16)),\n         (&ty::TyUint(UintTy::U32), Infer(i)) => Ok(U32(i as u32)),\n         (&ty::TyUint(UintTy::U64), Infer(i)) => Ok(U64(i)),\n         (&ty::TyUint(UintTy::Us), Infer(i)) => {\n-            match ConstUsize::new(i, tcx.sess.target.uint_type) {\n-                Ok(val) => Ok(Usize(val)),\n-                Err(_) => Ok(Usize(ConstUsize::Us32(i as u32))),\n-            }\n+            Ok(Usize(ConstUsize::new_truncating(i, tcx.sess.target.uint_type)))\n         },\n         (&ty::TyUint(_), InferSigned(_)) => Err(IntermediateUnsignedNegative),\n \n@@ -1052,20 +1043,14 @@ fn cast_const_int<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, val: ConstInt, ty: ty::\n         ty::TyInt(ast::IntTy::I32) => Ok(Integral(I32(v as i64 as i32))),\n         ty::TyInt(ast::IntTy::I64) => Ok(Integral(I64(v as i64))),\n         ty::TyInt(ast::IntTy::Is) => {\n-            match ConstIsize::new(v as i64, tcx.sess.target.int_type) {\n-                Ok(val) => Ok(Integral(Isize(val))),\n-                Err(_) => Ok(Integral(Isize(ConstIsize::Is32(v as i64 as i32)))),\n-            }\n+            Ok(Integral(Isize(ConstIsize::new_truncating(v as i64, tcx.sess.target.int_type))))\n         },\n         ty::TyUint(ast::UintTy::U8) => Ok(Integral(U8(v as u8))),\n         ty::TyUint(ast::UintTy::U16) => Ok(Integral(U16(v as u16))),\n         ty::TyUint(ast::UintTy::U32) => Ok(Integral(U32(v as u32))),\n         ty::TyUint(ast::UintTy::U64) => Ok(Integral(U64(v))),\n         ty::TyUint(ast::UintTy::Us) => {\n-            match ConstUsize::new(v, tcx.sess.target.uint_type) {\n-                Ok(val) => Ok(Integral(Usize(val))),\n-                Err(_) => Ok(Integral(Usize(ConstUsize::Us32(v as u32)))),\n-            }\n+            Ok(Integral(Usize(ConstUsize::new_truncating(v, tcx.sess.target.uint_type))))\n         },\n         ty::TyFloat(ast::FloatTy::F64) => match val.erase_type() {\n             Infer(u) => Ok(Float(F64(u as f64))),"}, {"sha": "ef92b628523e7b278c0fdba2372bbcb6d166eb96", "filename": "src/librustc_const_math/is.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_math%2Fis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_math%2Fis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_const_math%2Fis.rs?ref=f80ff7da394da0be629df6758b8fd513ee6ef438", "patch": "@@ -27,7 +27,8 @@ impl ConstIsize {\n             (Is16(i), ast::IntTy::I16) => i as i64,\n             (Is32(i), ast::IntTy::I32) => i as i64,\n             (Is64(i), ast::IntTy::I64) => i,\n-            _ => panic!(\"got invalid isize size for target\"),\n+            _ => panic!(\"unable to convert self ({:?}) to target isize ({:?})\",\n+                        self, target_int_ty),\n         }\n     }\n     pub fn new(i: i64, target_int_ty: ast::IntTy) -> Result<Self, ConstMathErr> {\n@@ -40,4 +41,12 @@ impl ConstIsize {\n             _ => unreachable!(),\n         }\n     }\n+    pub fn new_truncating(i: i64, target_int_ty: ast::IntTy) -> Self {\n+        match target_int_ty {\n+            ast::IntTy::I16 => Is16(i as i16),\n+            ast::IntTy::I32 => Is32(i as i32),\n+            ast::IntTy::I64 => Is64(i),\n+            _ => unreachable!(),\n+        }\n+    }\n }"}, {"sha": "bf73ff03c98959e025fe3ae04fb6f8065f5464b1", "filename": "src/librustc_const_math/us.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_math%2Fus.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_const_math%2Fus.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_const_math%2Fus.rs?ref=f80ff7da394da0be629df6758b8fd513ee6ef438", "patch": "@@ -27,7 +27,8 @@ impl ConstUsize {\n             (Us16(i), ast::UintTy::U16) => i as u64,\n             (Us32(i), ast::UintTy::U32) => i as u64,\n             (Us64(i), ast::UintTy::U64) => i,\n-            _ => panic!(\"got invalid usize size for target\"),\n+            _ => panic!(\"unable to convert self ({:?}) to target usize ({:?})\",\n+                        self, target_uint_ty),\n         }\n     }\n     pub fn new(i: u64, target_uint_ty: ast::UintTy) -> Result<Self, ConstMathErr> {\n@@ -40,4 +41,12 @@ impl ConstUsize {\n             _ => unreachable!(),\n         }\n     }\n+    pub fn new_truncating(i: u64, target_uint_ty: ast::UintTy) -> Self {\n+        match target_uint_ty {\n+            ast::UintTy::U16 => Us16(i as u16),\n+            ast::UintTy::U32 => Us32(i as u32),\n+            ast::UintTy::U64 => Us64(i),\n+            _ => unreachable!(),\n+        }\n+    }\n }"}, {"sha": "ab7bc4eec91cc99d86f03ef61ffbbfcf468fa25b", "filename": "src/librustc_mir/build/expr/as_rvalue.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f80ff7da394da0be629df6758b8fd513ee6ef438/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs?ref=f80ff7da394da0be629df6758b8fd513ee6ef438", "patch": "@@ -368,6 +368,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                     ast::IntTy::Is => {\n                         let int_ty = self.hir.tcx().sess.target.int_type;\n                         let min = match int_ty {\n+                            ast::IntTy::I16 => std::i16::MIN as i64,\n                             ast::IntTy::I32 => std::i32::MIN as i64,\n                             ast::IntTy::I64 => std::i64::MIN,\n                             _ => unreachable!()"}]}