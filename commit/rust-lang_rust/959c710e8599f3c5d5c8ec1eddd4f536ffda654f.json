{"sha": "959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1OWM3MTBlODU5OWYzYzVkNWM4ZWMxZWRkZDRmNTM2ZmZkYTY1NGY=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-14T23:26:49Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-15T12:33:00Z"}, "message": "Permit impls referencing errors to overlap", "tree": {"sha": "5926196f5b45f0575ea85ef367ea2045c9719426", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5926196f5b45f0575ea85ef367ea2045c9719426"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "html_url": "https://github.com/rust-lang/rust/commit/959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca3766e2e58f462a20922e42c821a37eaf0e13db", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca3766e2e58f462a20922e42c821a37eaf0e13db", "html_url": "https://github.com/rust-lang/rust/commit/ca3766e2e58f462a20922e42c821a37eaf0e13db"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "17eb4a8957fd5cd409081e9938df571319a9a576", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "patch": "@@ -2894,6 +2894,13 @@ impl<'tcx> TyCtxt<'tcx> {\n     pub fn impls_are_allowed_to_overlap(self, def_id1: DefId, def_id2: DefId)\n                                         -> Option<ImplOverlapKind>\n     {\n+        // If either trait impl references an error, they're allowed to overlap,\n+        // as one of them essentially doesn't exist.\n+        if self.impl_trait_ref(def_id1).map_or(false, |tr| tr.references_error()) ||\n+            self.impl_trait_ref(def_id2).map_or(false, |tr| tr.references_error()) {\n+            return Some(ImplOverlapKind::Permitted);\n+        }\n+\n         let is_legit = if self.features().overlapping_marker_traits {\n             let trait1_is_empty = self.impl_trait_ref(def_id1)\n                 .map_or(false, |trait_ref| {"}, {"sha": "3e0234b874d7b6d8aebcc9a855bcac85ff321736", "filename": "src/test/ui/coherence/conflicting-impl-with-err.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs", "raw_url": "https://github.com/rust-lang/rust/raw/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs?ref=959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "patch": "@@ -0,0 +1,16 @@\n+struct ErrorKind;\n+struct Error(ErrorKind);\n+\n+impl From<nope::Thing> for Error { //~ ERROR failed to resolve\n+    fn from(_: nope::Thing) -> Self { //~ ERROR failed to resolve\n+        unimplemented!()\n+    }\n+}\n+\n+impl From<ErrorKind> for Error {\n+    fn from(_: ErrorKind) -> Self {\n+        unimplemented!()\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "a8a5730accdd8a4c28bc94861f3ee5a08304fab4", "filename": "src/test/ui/coherence/conflicting-impl-with-err.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/959c710e8599f3c5d5c8ec1eddd4f536ffda654f/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr?ref=959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "patch": "@@ -0,0 +1,15 @@\n+error[E0433]: failed to resolve: use of undeclared type or module `nope`\n+  --> $DIR/conflicting-impl-with-err.rs:4:11\n+   |\n+LL | impl From<nope::Thing> for Error {\n+   |           ^^^^ use of undeclared type or module `nope`\n+\n+error[E0433]: failed to resolve: use of undeclared type or module `nope`\n+  --> $DIR/conflicting-impl-with-err.rs:5:16\n+   |\n+LL |     fn from(_: nope::Thing) -> Self {\n+   |                ^^^^ use of undeclared type or module `nope`\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0433`."}]}