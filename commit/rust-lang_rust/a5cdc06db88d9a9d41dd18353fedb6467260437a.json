{"sha": "a5cdc06db88d9a9d41dd18353fedb6467260437a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1Y2RjMDZkYjg4ZDlhOWQ0MWRkMTgzNTNmZWRiNjQ2NzI2MDQzN2E=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-09-10T10:54:29Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-09-10T10:54:29Z"}, "message": "ci: avoid moving the build directory on GHA\n\nWhile waiting for a PR job to start testing my code, I noticed the\nsymlink-build-dir step took 10 minutes to complete, so I investigated\nwhat caused that.\n\nIt seems like something changed in the build environment between version\n20200901.1 (where the step took 45 seconds) and version 20200908.1\n(where the step took 10 minutes). At the time of writing this commit,\nthe rust-lang organization is on vertsion 20200908.1, while the\nrust-lang-ci organization is at version 20200901.1 (and is not affected\nby this yet).\n\nThere is no need for this step anymore on GHA, as our XL builders got an\nincrease in the root paritition size, so this commit removes the code\nthat moved stuff around on GHA (while keeping it on Azure).\n\nFor the record, at the time of writing this, the disk situation is:\n\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       667G   60G  607G   9% /\n/dev/sdb1       110G  4.1G  101G   4% /mnt", "tree": {"sha": "061509e873e58f3e0c803f1240dea52b6ad655f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/061509e873e58f3e0c803f1240dea52b6ad655f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5cdc06db88d9a9d41dd18353fedb6467260437a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl9aCJkACgkQPgar6Auq\n8ZxWaRAAr1axr2RKebRE/HSw7+AX3jaUYc6xj0V9oILK+ialgUMM0nmdyR5FCfMc\n5nMgKMv+bolLRo3ONNrjCBgYqoY0FPPldz8uty0AfmVDEzv+uSo9bcnssKDDz/ws\nRlitPDvjbRzmURQ6Ysus1pEio1UD8Xgybw5SRpRxR0Wdm6sDLwiYVpTXdHLYRwU3\nq4xCH7PT3E0ZRKC5a5kHDMwehQXFkhQUI83HNCLYkc5gzyItYVxRfQXgPGR9J/oQ\nNnWesnJOogFuwwX+yusbYvgXljKh2awRcZRDgiyVA6If7mOIOs+gbMqzmlI3a4BU\nBiq37B2SYZfmLkt+xWJ6NZuOLhqU5/V23SdcZ/hUaivqT2f6bCTyfaK9zAMtWaEv\nF02lFssiT7jrVdJTlETo74ci3x1+KQHQnl0HuTyqBz2N2BL4s8zN+9D+CFeXRLiP\n8aWDAOdWd2m6aFzGX9AhljjJ3CMSibKIVwGXjoiVXK7cw8T/CjnRMkP+r17rAMhm\n6W+yh6z4auJgz1dxkO0T97Wy8h0frt6gVkdjhbbfEBY3pI8Ze2ij3Qny3LTcBOMK\nbInt1vjgTnNmzRJ7pHPv1/auwmjhVycUc166O20qKzrVYNIytMha8re6eUaqKh+o\ne664dgRogcbccq4QLJfmG6AsFz5Jb0rWJwADytwWpHrbCjObKhU=\n=CZhQ\n-----END PGP SIGNATURE-----", "payload": "tree 061509e873e58f3e0c803f1240dea52b6ad655f3\nparent a18b34d9793a88142c122f83fe53683f58f26ecc\nauthor Pietro Albini <pietro@pietroalbini.org> 1599735269 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1599735269 +0200\n\nci: avoid moving the build directory on GHA\n\nWhile waiting for a PR job to start testing my code, I noticed the\nsymlink-build-dir step took 10 minutes to complete, so I investigated\nwhat caused that.\n\nIt seems like something changed in the build environment between version\n20200901.1 (where the step took 45 seconds) and version 20200908.1\n(where the step took 10 minutes). At the time of writing this commit,\nthe rust-lang organization is on vertsion 20200908.1, while the\nrust-lang-ci organization is at version 20200901.1 (and is not affected\nby this yet).\n\nThere is no need for this step anymore on GHA, as our XL builders got an\nincrease in the root paritition size, so this commit removes the code\nthat moved stuff around on GHA (while keeping it on Azure).\n\nFor the record, at the time of writing this, the disk situation is:\n\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       667G   60G  607G   9% /\n/dev/sdb1       110G  4.1G  101G   4% /mnt\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5cdc06db88d9a9d41dd18353fedb6467260437a", "html_url": "https://github.com/rust-lang/rust/commit/a5cdc06db88d9a9d41dd18353fedb6467260437a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5cdc06db88d9a9d41dd18353fedb6467260437a/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a18b34d9793a88142c122f83fe53683f58f26ecc", "url": "https://api.github.com/repos/rust-lang/rust/commits/a18b34d9793a88142c122f83fe53683f58f26ecc", "html_url": "https://github.com/rust-lang/rust/commit/a18b34d9793a88142c122f83fe53683f58f26ecc"}], "stats": {"total": 18, "additions": 0, "deletions": 18}, "files": [{"sha": "23849f7047c546e173c94f3471a5749899ecae3d", "filename": "src/ci/scripts/symlink-build-dir.sh", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a5cdc06db88d9a9d41dd18353fedb6467260437a/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a5cdc06db88d9a9d41dd18353fedb6467260437a/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fsymlink-build-dir.sh?ref=a5cdc06db88d9a9d41dd18353fedb6467260437a", "patch": "@@ -12,22 +12,4 @@ source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n if isWindows && isAzurePipelines; then\n     cmd //c \"mkdir c:\\\\MORE_SPACE\"\n     cmd //c \"mklink /J build c:\\\\MORE_SPACE\"\n-elif isLinux && isGitHubActions && ! isSelfHostedGitHubActions; then\n-    sudo mkdir -p /mnt/more-space\n-    sudo chown -R \"$(whoami):\" /mnt/more-space\n-\n-    # Switch the whole workspace to the /mnt partition, which has more space.\n-    # We don't just symlink the `obj` directory as doing that creates problems\n-    # with the docker container.\n-    current_dir=\"$(readlink -f \"$(pwd)\")\"\n-    cd /tmp\n-    mv \"${current_dir}\" /mnt/more-space/workspace\n-    ln -s /mnt/more-space/workspace \"${current_dir}\"\n-    cd \"${current_dir}\"\n-\n-    # Move the Docker data directory to /mnt\n-    sudo systemctl stop docker.service\n-    sudo mv /var/lib/docker /mnt/docker\n-    sudo ln -s /mnt/docker /var/lib/docker\n-    sudo systemctl start docker.service\n fi"}]}