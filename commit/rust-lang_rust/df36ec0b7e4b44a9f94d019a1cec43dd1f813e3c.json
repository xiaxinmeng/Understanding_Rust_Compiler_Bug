{"sha": "df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmMzZlYzBiN2U0YjQ0YTlmOTRkMDE5YTFjZWM0M2RkMWY4MTNlM2M=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-05-07T20:51:03Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2020-05-09T00:33:50Z"}, "message": "x.py: allow configuring the build directory\n\nThis allows configuring the directory for build artifacts, instead of having it always be ./build. This means you can set it to a constant location, letting you reuse the same cache while working in several different directories.\n\nThe configuration lives in config.toml under build.build-dir. By default, it keeps the existing default of ./build, but it can be configured to any relative or absolute path. Additionally, it allows making outputs relative to the root of the git repository using $ROOT.", "tree": {"sha": "b63f110bdf00a7efa2f7eede8fc9f647710034cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b63f110bdf00a7efa2f7eede8fc9f647710034cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "html_url": "https://github.com/rust-lang/rust/commit/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a08c47310c7d49cbdc5d7afb38408ba519967ecd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a08c47310c7d49cbdc5d7afb38408ba519967ecd", "html_url": "https://github.com/rust-lang/rust/commit/a08c47310c7d49cbdc5d7afb38408ba519967ecd"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "e32beb1c611928de457b4aab7ea6670d4a95a9de", "filename": "config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "patch": "@@ -131,6 +131,10 @@\n # for each target triple.\n #target = [\"x86_64-unknown-linux-gnu\"] # defaults to just the build triple\n \n+# Use this directory to store build artifacts.\n+# You can use \"$ROOT\" to indicate the root of the git repository.\n+#build-dir = \"build\"\n+\n # Instead of downloading the src/stage0.txt version of Cargo specified, use\n # this Cargo binary instead to build all Rust code\n #cargo = \"/path/to/bin/cargo\""}, {"sha": "9a91f37c5deb681f0bbad7dcd795ba68f110d1d2", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "patch": "@@ -332,7 +332,7 @@ def __init__(self):\n         self.rustc_channel = ''\n         self.rustfmt_channel = ''\n         self.build = ''\n-        self.build_dir = os.path.join(os.getcwd(), \"build\")\n+        self.build_dir = ''\n         self.clean = False\n         self.config_toml = ''\n         self.rust_root = ''\n@@ -891,7 +891,11 @@ def bootstrap(help_triggered):\n     build.clean = args.clean\n \n     try:\n-        with open(args.config or 'config.toml') as config:\n+        toml_path = args.config or 'config.toml'\n+        if not os.path.exists(toml_path):\n+            toml_path = os.path.join(build.rust_root, toml_path)\n+\n+        with open(toml_path) as config:\n             build.config_toml = config.read()\n     except (OSError, IOError):\n         pass\n@@ -906,6 +910,9 @@ def bootstrap(help_triggered):\n \n     build.check_vendored_status()\n \n+    build_dir = build.get_toml('build-dir', 'build') or 'build'\n+    build.build_dir = os.path.abspath(build_dir.replace(\"$ROOT\", build.rust_root))\n+\n     data = stage0_data(build.rust_root)\n     build.date = data['date']\n     build.rustc_channel = data['rustc']"}, {"sha": "390630ee51b8de716b88db6cb5d4adebd7762228", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=df36ec0b7e4b44a9f94d019a1cec43dd1f813e3c", "patch": "@@ -212,6 +212,8 @@ struct Build {\n     host: Vec<String>,\n     #[serde(default)]\n     target: Vec<String>,\n+    // This is ignored, the rust code always gets the build directory from the `BUILD_DIR` env variable\n+    build_dir: Option<String>,\n     cargo: Option<String>,\n     rustc: Option<String>,\n     rustfmt: Option<String>, /* allow bootstrap.py to use rustfmt key */"}]}