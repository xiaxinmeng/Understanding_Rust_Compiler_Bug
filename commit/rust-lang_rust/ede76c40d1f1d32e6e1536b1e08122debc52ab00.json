{"sha": "ede76c40d1f1d32e6e1536b1e08122debc52ab00", "node_id": "C_kwDOAAsO6NoAKGVkZTc2YzQwZDFmMWQzMmU2ZTE1MzZiMWUwODEyMmRlYmM1MmFiMDA", "commit": {"author": {"name": "Tor Hovland", "email": "tor.hovland@bekk.no", "date": "2021-11-06T23:14:54Z"}, "committer": {"name": "Tor Hovland", "email": "tor.hovland@bekk.no", "date": "2021-11-07T08:32:05Z"}, "message": "Made temps-dir an unstable option.", "tree": {"sha": "fe34d1268d82a95d8081bf1741ff1813411e9c22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe34d1268d82a95d8081bf1741ff1813411e9c22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ede76c40d1f1d32e6e1536b1e08122debc52ab00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ede76c40d1f1d32e6e1536b1e08122debc52ab00", "html_url": "https://github.com/rust-lang/rust/commit/ede76c40d1f1d32e6e1536b1e08122debc52ab00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ede76c40d1f1d32e6e1536b1e08122debc52ab00/comments", "author": null, "committer": null, "parents": [{"sha": "d4bcee9638cf8fdf7e9297438e70e20b212c6535", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4bcee9638cf8fdf7e9297438e70e20b212c6535", "html_url": "https://github.com/rust-lang/rust/commit/d4bcee9638cf8fdf7e9297438e70e20b212c6535"}], "stats": {"total": 42, "additions": 18, "deletions": 24}, "files": [{"sha": "09fe3a552a0a624df7a317ffef7209f6a0b91ca2", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -215,15 +215,13 @@ fn run_compiler(\n \n     let cfg = interface::parse_cfgspecs(matches.opt_strs(\"cfg\"));\n     let (odir, ofile) = make_output(&matches);\n-    let temps_dir = make_temps_dir(&matches);\n     let mut config = interface::Config {\n         opts: sopts,\n         crate_cfg: cfg,\n         input: Input::File(PathBuf::new()),\n         input_path: None,\n         output_file: ofile,\n         output_dir: odir,\n-        temps_dir,\n         file_loader,\n         diagnostic_output,\n         stderr: None,\n@@ -458,11 +456,6 @@ fn make_output(matches: &getopts::Matches) -> (Option<PathBuf>, Option<PathBuf>)\n     (odir, ofile)\n }\n \n-// Extract temporary directory from matches.\n-fn make_temps_dir(matches: &getopts::Matches) -> Option<PathBuf> {\n-    matches.opt_str(\"temps-dir\").map(|o| PathBuf::from(&o))\n-}\n-\n // Extract input (string or file and optional path) from matches.\n fn make_input(\n     error_format: ErrorOutputType,"}, {"sha": "2904b3f5b7071bd5f54ed664a200d1bb0b1ac353", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -143,7 +143,6 @@ pub struct Config {\n     pub input_path: Option<PathBuf>,\n     pub output_dir: Option<PathBuf>,\n     pub output_file: Option<PathBuf>,\n-    pub temps_dir: Option<PathBuf>,\n     pub file_loader: Option<Box<dyn FileLoader + Send + Sync>>,\n     pub diagnostic_output: DiagnosticOutput,\n \n@@ -198,14 +197,16 @@ pub fn create_compiler_and_run<R>(config: Config, f: impl FnOnce(&Compiler) -> R\n         );\n     }\n \n+    let temps_dir = sess.opts.debugging_opts.temps_dir.as_ref().map(|o| PathBuf::from(&o));\n+\n     let compiler = Compiler {\n         sess,\n         codegen_backend,\n         input: config.input,\n         input_path: config.input_path,\n         output_dir: config.output_dir,\n         output_file: config.output_file,\n-        temps_dir: config.temps_dir,\n+        temps_dir,\n         register_lints: config.register_lints,\n         override_queries: config.override_queries,\n     };"}, {"sha": "eed2e07e890e72799ad76ad692c4148106dea7ca", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -685,6 +685,7 @@ fn test_debugging_options_tracking_hash() {\n     untracked!(span_debug, true);\n     untracked!(span_free_formats, true);\n     untracked!(strip, Strip::Debuginfo);\n+    untracked!(temps_dir, Some(String::from(\"abc\")));\n     untracked!(terminal_width, Some(80));\n     untracked!(threads, 99);\n     untracked!(time, true);"}, {"sha": "fe8a26a700e53ac088543b1471418c7e5fcfffc3", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -1110,7 +1110,6 @@ pub fn rustc_short_optgroups() -> Vec<RustcOptGroup> {\n              in <dir>\",\n             \"DIR\",\n         ),\n-        opt::opt_s(\"\", \"temps-dir\", \"Write temporary output files to <dir>\", \"DIR\"),\n         opt::opt_s(\n             \"\",\n             \"explain\","}, {"sha": "77a993a28ca790233d4accbced495e162a9971b7", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -1331,6 +1331,8 @@ options! {\n         \"which mangling version to use for symbol names ('legacy' (default) or 'v0')\"),\n     teach: bool = (false, parse_bool, [TRACKED],\n         \"show extended diagnostic help (default: no)\"),\n+    temps_dir: Option<String> = (None, parse_opt_string, [UNTRACKED],\n+        \"the directory the intermediate files are written to\"),\n     terminal_width: Option<usize> = (None, parse_opt_number, [UNTRACKED],\n         \"set the current terminal width\"),\n     tune_cpu: Option<String> = (None, parse_opt_string, [TRACKED],"}, {"sha": "7f482f0f2b1a084fd0c1501a4dac6f8906ffcb35", "filename": "src/doc/rustc/src/command-line-arguments.md", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Fdoc%2Frustc%2Fsrc%2Fcommand-line-arguments.md", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Fdoc%2Frustc%2Fsrc%2Fcommand-line-arguments.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fcommand-line-arguments.md?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -194,15 +194,6 @@ This flag controls the output filename.\n The outputted crate will be written to this directory. This flag is ignored if\n the [`-o` flag](#option-o-output) is used.\n \n-<a id=\"option-temps-dir\"></a>\n-## `--temps-dir`: directory to write the intermediate files in\n-\n-Intermediate files will be written to this directory. If not set, the output\n-directory is used. This option is useful if you are running more than one\n-instance of `rustc` (e.g. with different `--crate-type` settings), and you\n-need to make sure they are not overwriting each other's intermediate files.\n-No files are kept unless `-C save-temps=yes` is also set.\n-\n <a id=\"option-explain\"></a>\n ## `--explain`: provide a detailed explanation of an error message\n "}, {"sha": "e25011f71197b4fd6a67811de9092ad6be521b9c", "filename": "src/doc/unstable-book/src/compiler-flags/temps-dir.md", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftemps-dir.md", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftemps-dir.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Ftemps-dir.md?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -0,0 +1,10 @@\n+# `temps-dir`\n+\n+--------------------\n+\n+The `-Ztemps-dir` compiler flag specifies the directory to write the\n+intermediate files in. If not set, the output directory is used. This option is\n+useful if you are running more than one instance of `rustc` (e.g. with different\n+`--crate-type` settings), and you need to make sure they are not overwriting\n+each other's intermediate files. No files are kept unless `-C save-temps=yes` is\n+also set."}, {"sha": "b7251e8f57151cb3024ee2a40b77c2bb7dee9678", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -259,7 +259,6 @@ crate fn create_config(\n         input_path: cpath,\n         output_file: None,\n         output_dir: None,\n-        temps_dir: None,\n         file_loader: None,\n         diagnostic_output: DiagnosticOutput::Default,\n         stderr: None,"}, {"sha": "9b32ad979e385572cdd3878cdae54ff712b1b811", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -94,7 +94,6 @@ crate fn run(options: Options) -> Result<(), ErrorReported> {\n         input_path: None,\n         output_file: None,\n         output_dir: None,\n-        temps_dir: None,\n         file_loader: None,\n         diagnostic_output: DiagnosticOutput::Default,\n         stderr: None,"}, {"sha": "4acabbb70ede20672e52f9e7bd8690a8c5e79c69", "filename": "src/test/run-make-fulldeps/issue-19371/foo.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Ftest%2Frun-make-fulldeps%2Fissue-19371%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Ftest%2Frun-make-fulldeps%2Fissue-19371%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fissue-19371%2Ffoo.rs?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -53,7 +53,6 @@ fn compile(code: String, output: PathBuf, sysroot: PathBuf) {\n         input_path: None,\n         output_file: Some(output),\n         output_dir: None,\n-        temps_dir: None,\n         file_loader: None,\n         diagnostic_output: DiagnosticOutput::Default,\n         stderr: None,"}, {"sha": "28aa188c3926aba417417f7e8a64cdc43163d52b", "filename": "src/test/run-make/issue-10971-temps-dir/Makefile", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Ftest%2Frun-make%2Fissue-10971-temps-dir%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ede76c40d1f1d32e6e1536b1e08122debc52ab00/src%2Ftest%2Frun-make%2Fissue-10971-temps-dir%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-10971-temps-dir%2FMakefile?ref=ede76c40d1f1d32e6e1536b1e08122debc52ab00", "patch": "@@ -6,5 +6,5 @@ include ../../run-make-fulldeps/tools.mk\n all:\n \ttouch $(TMPDIR)/lib.rs\n \n-\t$(RUSTC) --crate-type=lib --temps-dir=$(TMPDIR)/temp1 $(TMPDIR)/lib.rs & \\\n-\t$(RUSTC) --crate-type=cdylib --temps-dir=$(TMPDIR)/temp2 $(TMPDIR)/lib.rs\n+\t$(RUSTC) --crate-type=lib -Z temps-dir=$(TMPDIR)/temp1 $(TMPDIR)/lib.rs & \\\n+\t$(RUSTC) --crate-type=cdylib -Z temps-dir=$(TMPDIR)/temp2 $(TMPDIR)/lib.rs"}]}