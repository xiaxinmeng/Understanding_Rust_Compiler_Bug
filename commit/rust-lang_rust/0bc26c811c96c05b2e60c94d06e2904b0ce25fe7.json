{"sha": "0bc26c811c96c05b2e60c94d06e2904b0ce25fe7", "node_id": "C_kwDOAAsO6NoAKDBiYzI2YzgxMWM5NmMwNWIyZTYwYzk0ZDA2ZTI5MDRiMGNlMjVmZTc", "commit": {"author": {"name": "Samuel E. Moelius III", "email": "sam@moeli.us", "date": "2022-07-29T21:46:09Z"}, "committer": {"name": "Samuel Moelius", "email": "samuel.moelius@trailofbits.com", "date": "2022-08-21T19:38:09Z"}, "message": "`needed_ref` -> `needs_ref`", "tree": {"sha": "a221c7838eca5c55dc694b699d3b97efc886f9cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a221c7838eca5c55dc694b699d3b97efc886f9cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7", "html_url": "https://github.com/rust-lang/rust/commit/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7/comments", "author": {"login": "smoelius", "id": 35515885, "node_id": "MDQ6VXNlcjM1NTE1ODg1", "avatar_url": "https://avatars.githubusercontent.com/u/35515885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smoelius", "html_url": "https://github.com/smoelius", "followers_url": "https://api.github.com/users/smoelius/followers", "following_url": "https://api.github.com/users/smoelius/following{/other_user}", "gists_url": "https://api.github.com/users/smoelius/gists{/gist_id}", "starred_url": "https://api.github.com/users/smoelius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smoelius/subscriptions", "organizations_url": "https://api.github.com/users/smoelius/orgs", "repos_url": "https://api.github.com/users/smoelius/repos", "events_url": "https://api.github.com/users/smoelius/events{/privacy}", "received_events_url": "https://api.github.com/users/smoelius/received_events", "type": "User", "site_admin": false}, "committer": {"login": "smoelius", "id": 35515885, "node_id": "MDQ6VXNlcjM1NTE1ODg1", "avatar_url": "https://avatars.githubusercontent.com/u/35515885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smoelius", "html_url": "https://github.com/smoelius", "followers_url": "https://api.github.com/users/smoelius/followers", "following_url": "https://api.github.com/users/smoelius/following{/other_user}", "gists_url": "https://api.github.com/users/smoelius/gists{/gist_id}", "starred_url": "https://api.github.com/users/smoelius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smoelius/subscriptions", "organizations_url": "https://api.github.com/users/smoelius/orgs", "repos_url": "https://api.github.com/users/smoelius/repos", "events_url": "https://api.github.com/users/smoelius/events{/privacy}", "received_events_url": "https://api.github.com/users/smoelius/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "687fcf14c4bd8b60640253800755123b2ba4b02a", "url": "https://api.github.com/repos/rust-lang/rust/commits/687fcf14c4bd8b60640253800755123b2ba4b02a", "html_url": "https://github.com/rust-lang/rust/commit/687fcf14c4bd8b60640253800755123b2ba4b02a"}], "stats": {"total": 10, "additions": 3, "deletions": 7}, "files": [{"sha": "9fb9fd99748b4b63eabb571073dcba3306d938fb", "filename": "clippy_lints/src/format_args.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7/clippy_lints%2Fsrc%2Fformat_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bc26c811c96c05b2e60c94d06e2904b0ce25fe7/clippy_lints%2Fsrc%2Fformat_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformat_args.rs?ref=0bc26c811c96c05b2e60c94d06e2904b0ce25fe7", "patch": "@@ -137,12 +137,8 @@ fn check_to_string_in_format_args(cx: &LateContext<'_>, name: Symbol, value: &Ex\n         if let Some(sized_trait_id) = cx.tcx.lang_items().sized_trait();\n         if let Some(receiver_snippet) = snippet_opt(cx, receiver.span);\n         then {\n-            let needed_ref = if implements_trait(cx, receiver_ty, sized_trait_id, &[]) {\n-                \"\"\n-            } else {\n-                \"&\"\n-            };\n-            if n_needed_derefs == 0 && needed_ref.is_empty() {\n+            let needs_ref = !implements_trait(cx, receiver_ty, sized_trait_id, &[]);\n+            if n_needed_derefs == 0 && !needs_ref {\n                 span_lint_and_sugg(\n                     cx,\n                     TO_STRING_IN_FORMAT_ARGS,\n@@ -167,7 +163,7 @@ fn check_to_string_in_format_args(cx: &LateContext<'_>, name: Symbol, value: &Ex\n                     \"use this\",\n                     format!(\n                         \"{}{:*>width$}{}\",\n-                        needed_ref,\n+                        if needs_ref { \"&\" } else { \"\" },\n                         \"\",\n                         receiver_snippet,\n                         width = n_needed_derefs"}]}