{"sha": "ab89c171bdb29194baca274decf86acfecd2bb9d", "node_id": "C_kwDOAAsO6NoAKGFiODljMTcxYmRiMjkxOTRiYWNhMjc0ZGVjZjg2YWNmZWNkMmJiOWQ", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-11-26T21:11:07Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-11-26T21:11:07Z"}, "message": "Ensure required submodules at the same time as updating existing submodules\n\nIn practice, this would always happen at the same time, but putting them next to each other makes that more obvious and ensures it doesn't change in the future.\nIt also avoids the difference avoiding `cargo metadata` somehow.", "tree": {"sha": "d4b2cf2ce8bfd0bf798f0043988038af7216df3c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4b2cf2ce8bfd0bf798f0043988038af7216df3c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ab89c171bdb29194baca274decf86acfecd2bb9d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ab89c171bdb29194baca274decf86acfecd2bb9d", "html_url": "https://github.com/rust-lang/rust/commit/ab89c171bdb29194baca274decf86acfecd2bb9d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ab89c171bdb29194baca274decf86acfecd2bb9d/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b771d901f735aa6d4078aed92b03e30eba35bf5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b771d901f735aa6d4078aed92b03e30eba35bf5a", "html_url": "https://github.com/rust-lang/rust/commit/b771d901f735aa6d4078aed92b03e30eba35bf5a"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "86b195fb89e024b211d842250aecf6a229fb6ada", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ab89c171bdb29194baca274decf86acfecd2bb9d/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ab89c171bdb29194baca274decf86acfecd2bb9d/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=ab89c171bdb29194baca274decf86acfecd2bb9d", "patch": "@@ -579,6 +579,8 @@ impl Build {\n             for s in rust_submodules {\n                 build.update_submodule(Path::new(s));\n             }\n+            // Now, update all existing submodules.\n+            build.update_existing_submodules();\n \n             build.verbose(\"learning about cargo\");\n             metadata::build(&mut build);\n@@ -660,7 +662,7 @@ impl Build {\n \n     /// If any submodule has been initialized already, sync it unconditionally.\n     /// This avoids contributors checking in a submodule change by accident.\n-    pub fn maybe_update_submodules(&self) {\n+    pub fn update_existing_submodules(&self) {\n         // Avoid running git when there isn't a git checkout.\n         if !self.config.submodules(&self.rust_info()) {\n             return;\n@@ -689,8 +691,6 @@ impl Build {\n             job::setup(self);\n         }\n \n-        self.maybe_update_submodules();\n-\n         if let Subcommand::Format { check, paths } = &self.config.cmd {\n             return format::format(&builder::Builder::new(&self), *check, &paths);\n         }"}]}