{"sha": "c4b4f0759297927248f2db0bed0a417e7f08ed1d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0YjRmMDc1OTI5NzkyNzI0OGYyZGIwYmVkMGE0MTdlN2YwOGVkMWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-02T09:19:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-02T09:19:27Z"}, "message": "Auto merge of #26727 - remram44:coerceunsized-weak, r=eddyb\n\nThis is a simple addition, shouldn't change behavior.\r\n\r\nFixes #26704\r\n\r\nI don't know if the coercion for `Rc` is tested, if it is this probably needs the same test with `Weak`.", "tree": {"sha": "da4fdfcc209f46e499089873edd3f944e5e1c7be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da4fdfcc209f46e499089873edd3f944e5e1c7be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4b4f0759297927248f2db0bed0a417e7f08ed1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4b4f0759297927248f2db0bed0a417e7f08ed1d", "html_url": "https://github.com/rust-lang/rust/commit/c4b4f0759297927248f2db0bed0a417e7f08ed1d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4b4f0759297927248f2db0bed0a417e7f08ed1d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f635b2f0adb2c06162efeea41345a9c7b6ab62c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f635b2f0adb2c06162efeea41345a9c7b6ab62c4", "html_url": "https://github.com/rust-lang/rust/commit/f635b2f0adb2c06162efeea41345a9c7b6ab62c4"}, {"sha": "3278e793b2d0332c6659b732178892aab11654ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/3278e793b2d0332c6659b732178892aab11654ee", "html_url": "https://github.com/rust-lang/rust/commit/3278e793b2d0332c6659b732178892aab11654ee"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "c84649f92e7ff6b18b22d504732743b9f58b0237", "filename": "src/liballoc/arc.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Fliballoc%2Farc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Fliballoc%2Farc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Farc.rs?ref=c4b4f0759297927248f2db0bed0a417e7f08ed1d", "patch": "@@ -145,6 +145,8 @@ pub struct Weak<T: ?Sized> {\n unsafe impl<T: ?Sized + Sync + Send> Send for Weak<T> { }\n unsafe impl<T: ?Sized + Sync + Send> Sync for Weak<T> { }\n \n+impl<T: ?Sized + Unsize<U>, U: ?Sized> CoerceUnsized<Weak<U>> for Weak<T> {}\n+\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<T: ?Sized + fmt::Debug> fmt::Debug for Weak<T> {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {"}, {"sha": "d461eeea0b7ebbef617707c72a5f5d86b24dcc1e", "filename": "src/liballoc/rc.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Fliballoc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Fliballoc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Frc.rs?ref=c4b4f0759297927248f2db0bed0a417e7f08ed1d", "patch": "@@ -734,6 +734,8 @@ pub struct Weak<T: ?Sized> {\n impl<T: ?Sized> !marker::Send for Weak<T> {}\n impl<T: ?Sized> !marker::Sync for Weak<T> {}\n \n+impl<T: ?Sized+Unsize<U>, U: ?Sized> CoerceUnsized<Weak<U>> for Weak<T> {}\n+\n #[unstable(feature = \"rc_weak\",\n            reason = \"Weak pointers may not belong in this module.\")]\n impl<T: ?Sized> Weak<T> {"}, {"sha": "f147a2dca63432dfe321f8cec58580211f3d392b", "filename": "src/test/run-pass/dst-coerce-rc.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Ftest%2Frun-pass%2Fdst-coerce-rc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4b4f0759297927248f2db0bed0a417e7f08ed1d/src%2Ftest%2Frun-pass%2Fdst-coerce-rc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fdst-coerce-rc.rs?ref=c4b4f0759297927248f2db0bed0a417e7f08ed1d", "patch": "@@ -10,10 +10,10 @@\n \n // Test a very simple custom DST coercion.\n \n-#![feature(core)]\n+#![feature(core, rc_weak)]\n \n use std::cell::RefCell;\n-use std::rc::Rc;\n+use std::rc::{Rc, Weak};\n \n trait Baz {\n     fn get(&self) -> i32;\n@@ -36,9 +36,13 @@ fn main() {\n     let b: Rc<Baz> = a.clone();\n     assert_eq!(b.get(), 42);\n \n+    let c: Weak<i32> = a.downgrade();\n+    let d: Weak<Baz> = c.clone();\n+\n     let _c = b.clone();\n \n     let a: Rc<RefCell<i32>> = Rc::new(RefCell::new(42));\n     let b: Rc<RefCell<Baz>> = a.clone();\n     assert_eq!(b.borrow().get(), 42);\n+    let c: Weak<RefCell<Baz>> = a.downgrade();\n }"}]}