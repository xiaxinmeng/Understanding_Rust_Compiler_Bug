{"sha": "0528effcd954bd92434daf11c97d5a07ebc0f227", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MjhlZmZjZDk1NGJkOTI0MzRkYWYxMWM5N2Q1YTA3ZWJjMGYyMjc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-10-22T16:01:34Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-10-22T16:01:50Z"}, "message": "mk: Prefer target libs coming from their host\n\nIt looks like the target libs aren't actually the same across hosts so instead\nof always packaging the target libs from CFG_BUILD take the target libs from the\nhost if we have them and then only failing that do we take them from CFG_BUILD.\n\nCloses #29228", "tree": {"sha": "b3a1384fa0a66493c4386af8db4b65ae92b022ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3a1384fa0a66493c4386af8db4b65ae92b022ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0528effcd954bd92434daf11c97d5a07ebc0f227", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0528effcd954bd92434daf11c97d5a07ebc0f227", "html_url": "https://github.com/rust-lang/rust/commit/0528effcd954bd92434daf11c97d5a07ebc0f227", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0528effcd954bd92434daf11c97d5a07ebc0f227/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca998fc2f100bce4eab9b4609bd5a0a5c5789872", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca998fc2f100bce4eab9b4609bd5a0a5c5789872", "html_url": "https://github.com/rust-lang/rust/commit/ca998fc2f100bce4eab9b4609bd5a0a5c5789872"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "a4c2c6b473887b502b0fafe1e8afda86863ee901", "filename": "mk/dist.mk", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0528effcd954bd92434daf11c97d5a07ebc0f227/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/0528effcd954bd92434daf11c97d5a07ebc0f227/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=0528effcd954bd92434daf11c97d5a07ebc0f227", "patch": "@@ -256,7 +256,25 @@ endef\n \n $(foreach host,$(CFG_HOST),\\\n   $(eval $(call DEF_INSTALLER,$(host))))\n-$(foreach target,$(CFG_TARGET),\\\n+\n+# When generating packages for the standard library, we've actually got a lot of\n+# artifacts to choose from. Each of the CFG_HOST compilers will have a copy of\n+# the standard library for each CFG_TARGET, but we only want to generate one\n+# standard library package. As a result, for each entry in CFG_TARGET we need to\n+# pick a CFG_HOST to get the standard library from.\n+#\n+# In theory it doesn't actually matter what host we choose as it should be the\n+# case that all hosts produce the same set of libraries for a target (regardless\n+# of the host itself). Currently there is a bug in the compiler, however, which\n+# means this is not the case (see #29228 and #29235). To solve the first of\n+# those bugs, we prefer to select a standard library from the host it was\n+# generated from, allowing plugins to work in more situations.\n+#\n+# For all CFG_TARGET entries in CFG_HOST, however, we just pick CFG_BUILD as the\n+# host we slurp up a standard library from.\n+$(foreach host,$(CFG_HOST),\\\n+  $(eval $(call DEF_INSTALLER_TARGETS,$(host),$(host))))\n+$(foreach target,$(filter-out $(CFG_HOST),$(CFG_TARGET)),\\\n   $(eval $(call DEF_INSTALLER_TARGETS,$(CFG_BUILD),$(target))))\n \n ifdef CFG_WINDOWSY_$(CFG_BUILD)"}]}