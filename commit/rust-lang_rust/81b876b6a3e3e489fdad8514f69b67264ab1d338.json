{"sha": "81b876b6a3e3e489fdad8514f69b67264ab1d338", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxYjg3NmI2YTNlM2U0ODlmZGFkODUxNGY2OWI2NzI2NGFiMWQzMzg=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-13T23:47:55Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-23T02:50:18Z"}, "message": "Hide \"type ascription is experimental error\" unless it's the only one\n\nIn order to minimize the verbosity of common syntax errors that are parsed\nas type ascription, hide the feature gate error unless there are no other\nerrors being emitted by the parser.", "tree": {"sha": "675bab6d388d01cf8108d380e79de1b3b6edacac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/675bab6d388d01cf8108d380e79de1b3b6edacac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/81b876b6a3e3e489fdad8514f69b67264ab1d338", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/81b876b6a3e3e489fdad8514f69b67264ab1d338", "html_url": "https://github.com/rust-lang/rust/commit/81b876b6a3e3e489fdad8514f69b67264ab1d338", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/81b876b6a3e3e489fdad8514f69b67264ab1d338/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "72a3089092da16c247d57915f5e4b99adf2fea4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/72a3089092da16c247d57915f5e4b99adf2fea4d", "html_url": "https://github.com/rust-lang/rust/commit/72a3089092da16c247d57915f5e4b99adf2fea4d"}], "stats": {"total": 37, "additions": 11, "deletions": 26}, "files": [{"sha": "2816efaeb70e0cbbcd5f3cf6164f0e2b3ec94971", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=81b876b6a3e3e489fdad8514f69b67264ab1d338", "patch": "@@ -1836,8 +1836,12 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 gate_feature_post!(&self, box_syntax, e.span, EXPLAIN_BOX_SYNTAX);\n             }\n             ast::ExprKind::Type(..) => {\n-                gate_feature_post!(&self, type_ascription, e.span,\n-                                  \"type ascription is experimental\");\n+                // To avoid noise about type ascription in common syntax errors, only emit if it\n+                // is the *only* error.\n+                if self.context.parse_sess.span_diagnostic.err_count() == 0 {\n+                    gate_feature_post!(&self, type_ascription, e.span,\n+                                       \"type ascription is experimental\");\n+                }\n             }\n             ast::ExprKind::ObsoleteInPlace(..) => {\n                 // these get a hard error in ast-validation"}, {"sha": "0e1c307502728c7c8bedf38e64887a2e894be3d2", "filename": "src/test/ui/suggestions/type-ascription-instead-of-let.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs", "raw_url": "https://github.com/rust-lang/rust/raw/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs?ref=81b876b6a3e3e489fdad8514f69b67264ab1d338", "patch": "@@ -4,7 +4,6 @@ fn main() {\n     let closure_annotated = |value: i32| -> i32 {\n         temp: i32 = fun(5i32);\n         //~^ ERROR cannot find value `temp` in this scope\n-        //~| ERROR type ascription is experimental\n         temp + value + 1\n         //~^ ERROR cannot find value `temp` in this scope\n     };"}, {"sha": "92e4b5798c88944db86f6afeb97669b913b3ca14", "filename": "src/test/ui/suggestions/type-ascription-instead-of-let.stderr", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr?ref=81b876b6a3e3e489fdad8514f69b67264ab1d338", "patch": "@@ -8,20 +8,11 @@ LL |         temp: i32 = fun(5i32);\n    |         help: maybe you meant to write an assignment here: `let temp`\n \n error[E0425]: cannot find value `temp` in this scope\n-  --> $DIR/type-ascription-instead-of-let.rs:8:9\n+  --> $DIR/type-ascription-instead-of-let.rs:7:9\n    |\n LL |         temp + value + 1\n    |         ^^^^ not found in this scope\n \n-error[E0658]: type ascription is experimental (see issue #23416)\n-  --> $DIR/type-ascription-instead-of-let.rs:5:9\n-   |\n-LL |         temp: i32 = fun(5i32);\n-   |         ^^^^^^^^^\n-   |\n-   = help: add #![feature(type_ascription)] to the crate attributes to enable\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors occurred: E0425, E0658.\n-For more information about an error, try `rustc --explain E0425`.\n+For more information about this error, try `rustc --explain E0425`."}, {"sha": "4c0fe6d8b5b4e29a3c65d4c882d31a049fb41be4", "filename": "src/test/ui/suggestions/type-ascription-instead-of-path.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs?ref=81b876b6a3e3e489fdad8514f69b67264ab1d338", "patch": "@@ -2,5 +2,4 @@ fn main() {\n     std:io::stdin();\n     //~^ ERROR failed to resolve: use of undeclared type or module `io`\n     //~| ERROR expected value, found module\n-    //~| ERROR type ascription is experimental\n }"}, {"sha": "1beb822d6a74946ec91823e537001384718bdef4", "filename": "src/test/ui/suggestions/type-ascription-instead-of-path.stderr", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/81b876b6a3e3e489fdad8514f69b67264ab1d338/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr?ref=81b876b6a3e3e489fdad8514f69b67264ab1d338", "patch": "@@ -12,15 +12,7 @@ LL |     std:io::stdin();\n    |     |\n    |     not a value\n \n-error[E0658]: type ascription is experimental (see issue #23416)\n-  --> $DIR/type-ascription-instead-of-path.rs:2:5\n-   |\n-LL |     std:io::stdin();\n-   |     ^^^^^^^^^^^^^^^\n-   |\n-   = help: add #![feature(type_ascription)] to the crate attributes to enable\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors occurred: E0423, E0433, E0658.\n+Some errors occurred: E0423, E0433.\n For more information about an error, try `rustc --explain E0423`."}]}