{"sha": "6b379322686c8b1552b2014ed560822de490cf27", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiMzc5MzIyNjg2YzhiMTU1MmIyMDE0ZWQ1NjA4MjJkZTQ5MGNmMjc=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-12-31T11:49:43Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-12-31T11:49:43Z"}, "message": "Fix blessing of test output in subdirectories\n\nThe core issue was the usage of `reference_file_path.file_name()`, which\nprovided a non-existent path if the file to be updated was in a\nsubdirectory.\n\nInstead we have to provide the whole path after 'tests/ui/' as the\n'filename'. This part of the path is called `test_name` in the code now.", "tree": {"sha": "fe85c58b083b2939cf56a02e9141adb6085d46e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe85c58b083b2939cf56a02e9141adb6085d46e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b379322686c8b1552b2014ed560822de490cf27", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE6VFioMHrom999LRAK0OZxL9Ny94FAl/tu3gACgkQK0OZxL9N\ny95DsxAAij/JmEjnhyziysUwfX+m3rjmYS79Ro6OdCLpmoSSlVRDXkQ/MVqXfN2d\nShdYNm0G4pUfk/xZShtWluzooEiAgyKfoaf8dMLhF0+ggi8pjxsiOny1sOLrgAlP\nJksEfJ+uSoLWVfSzvznKBfUc+/AGDr+Fyetz3XWMLc5YCs9mZlwgO2LuZJjqjZzv\nFNEmOILZIk6eLsInx4PPTCUdQY8o30mb1t3GuuReBWpkhFFbBtWOph+yPoLRi9mB\njnu8Z9bW2mpImHOME2ryBLe1VWHskb7ASukOFBwORAb1Ftuz4uDdsKauu3Ph5Hd1\nROqd0YOIr22IejeJBVJbYrzwAJsa53Hj1Zs8WmRMYXViIXGEedpXXLfC5k43bo0q\ntRqLSNAK2D0dQbWj+tXpRrJCYNkH6UH9ZW50OqZoLhX/O9HTKuiUuEfd72Y7L5v9\neweozM+2FmZ7qNSROb1RACuWvOlFSKe557gl+CgI43BZTlsW1iKd6+03Y9yfrm40\nOAnElGlqm2NerFmYgdSlMbyEQ52cfyzhI9lRcLRp3cMX5dqreQ3b9lsRMySodbFq\n0fezEjZ/RZD6TtqPrpfykSWLmBCHqAWpkHb3vFX8Yp+J/aXxa4n0OSltxZA3aiSu\nz1qouvPI1pPG7kOZenT//zN6iBJpvhmNJhprAmGYHY57HPKFTNg=\n=3SP+\n-----END PGP SIGNATURE-----", "payload": "tree fe85c58b083b2939cf56a02e9141adb6085d46e4\nparent 0d8a27a6f6a1b0cd69f531d34dfbda65bbcf1cfa\nauthor Philipp Hansch <dev@phansch.net> 1609415383 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1609415383 +0100\n\nFix blessing of test output in subdirectories\n\nThe core issue was the usage of `reference_file_path.file_name()`, which\nprovided a non-existent path if the file to be updated was in a\nsubdirectory.\n\nInstead we have to provide the whole path after 'tests/ui/' as the\n'filename'. This part of the path is called `test_name` in the code now.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b379322686c8b1552b2014ed560822de490cf27", "html_url": "https://github.com/rust-lang/rust/commit/6b379322686c8b1552b2014ed560822de490cf27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b379322686c8b1552b2014ed560822de490cf27/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d8a27a6f6a1b0cd69f531d34dfbda65bbcf1cfa", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d8a27a6f6a1b0cd69f531d34dfbda65bbcf1cfa", "html_url": "https://github.com/rust-lang/rust/commit/0d8a27a6f6a1b0cd69f531d34dfbda65bbcf1cfa"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "48a2458594c724f006785008a48fe2bdebd9f7da", "filename": "clippy_dev/src/bless.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6b379322686c8b1552b2014ed560822de490cf27/clippy_dev%2Fsrc%2Fbless.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b379322686c8b1552b2014ed560822de490cf27/clippy_dev%2Fsrc%2Fbless.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fbless.rs?ref=6b379322686c8b1552b2014ed560822de490cf27", "patch": "@@ -28,15 +28,17 @@ pub fn bless() {\n             .filter_map(Result::ok)\n             .filter(|f| f.path().extension() == Some(OsStr::new(\"rs\")))\n             .for_each(|f| {\n-                update_reference_file(f.path().with_extension(\"stdout\"));\n-                update_reference_file(f.path().with_extension(\"stderr\"));\n-                update_reference_file(f.path().with_extension(\"fixed\"));\n+                let test_name = f.path().strip_prefix(test_dir).unwrap();\n+\n+                update_reference_file(f.path().with_extension(\"stdout\"), test_name.with_extension(\"stdout\"));\n+                update_reference_file(f.path().with_extension(\"stderr\"), test_name.with_extension(\"stderr\"));\n+                update_reference_file(f.path().with_extension(\"fixed\"), test_name.with_extension(\"fixed\"));\n             });\n     }\n }\n \n-fn update_reference_file(reference_file_path: PathBuf) {\n-    let test_output_path = build_dir().join(PathBuf::from(reference_file_path.file_name().unwrap()));\n+fn update_reference_file(reference_file_path: PathBuf, test_name: PathBuf) {\n+    let test_output_path = build_dir().join(test_name);\n     let relative_reference_file_path = reference_file_path.strip_prefix(clippy_project_root()).unwrap();\n \n     // If compiletest did not write any changes during the test run,"}]}