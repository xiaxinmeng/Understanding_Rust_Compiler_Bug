{"sha": "a22e15b954d2be638ab0b15cee6e93cf301dc159", "node_id": "C_kwDOAAsO6NoAKGEyMmUxNWI5NTRkMmJlNjM4YWIwYjE1Y2VlNmU5M2NmMzAxZGMxNTk", "commit": {"author": {"name": "antoyo", "email": "antoyo@users.noreply.github.com", "date": "2022-03-23T16:11:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-23T16:11:28Z"}, "message": "Merge pull request #143 from yvt/sysroot-profile\n\nAdd `--release-sysroot` flag to `build.sh`", "tree": {"sha": "84de12469f6ee462e9dc5819c5877faacd5208c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84de12469f6ee462e9dc5819c5877faacd5208c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a22e15b954d2be638ab0b15cee6e93cf301dc159", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiO0awCRBK7hj4Ov3rIwAA54gIABqxo+FAdGSSll/mEPDodJJm\nmyT1rb/jqx2IFaRtiWllUixb6EbAs0wijEO/KREJfiU/459zu2ZaEG1tG9cM/4+z\nCPDSj5vwFaakhTWh4Ow7og1ZqRjyynvvHiU/fTnB2ynzz9J1XN2DZWgOIHviXBCs\nsitiQP6GmKMB0cx4S0EDDOgw7akliDupKPxeuEdqW/3Q7CSjLGosjD+JHVRlO+wi\nA4NhbKKRN7EkkpRP1vhxySm2w3oqcSsctVOCGqcV+R7NjFsd/w11q3vnyial2WFk\nq50kj3t6OZrkNjk9McB1VaHeFakLGqEHDLseL4yqVjeGfW8TwYRDFKa0QAj86SM=\n=eZrB\n-----END PGP SIGNATURE-----\n", "payload": "tree 84de12469f6ee462e9dc5819c5877faacd5208c6\nparent 44c0204af3ac285474a779f777f0adc158a8344b\nparent 842a5fba1ce9c82389f529ca88bb586749308f5c\nauthor antoyo <antoyo@users.noreply.github.com> 1648051888 -0400\ncommitter GitHub <noreply@github.com> 1648051888 -0400\n\nMerge pull request #143 from yvt/sysroot-profile\n\nAdd `--release-sysroot` flag to `build.sh`"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a22e15b954d2be638ab0b15cee6e93cf301dc159", "html_url": "https://github.com/rust-lang/rust/commit/a22e15b954d2be638ab0b15cee6e93cf301dc159", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a22e15b954d2be638ab0b15cee6e93cf301dc159/comments", "author": {"login": "antoyo", "id": 584972, "node_id": "MDQ6VXNlcjU4NDk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/584972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoyo", "html_url": "https://github.com/antoyo", "followers_url": "https://api.github.com/users/antoyo/followers", "following_url": "https://api.github.com/users/antoyo/following{/other_user}", "gists_url": "https://api.github.com/users/antoyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoyo/subscriptions", "organizations_url": "https://api.github.com/users/antoyo/orgs", "repos_url": "https://api.github.com/users/antoyo/repos", "events_url": "https://api.github.com/users/antoyo/events{/privacy}", "received_events_url": "https://api.github.com/users/antoyo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44c0204af3ac285474a779f777f0adc158a8344b", "url": "https://api.github.com/repos/rust-lang/rust/commits/44c0204af3ac285474a779f777f0adc158a8344b", "html_url": "https://github.com/rust-lang/rust/commit/44c0204af3ac285474a779f777f0adc158a8344b"}, {"sha": "842a5fba1ce9c82389f529ca88bb586749308f5c", "url": "https://api.github.com/repos/rust-lang/rust/commits/842a5fba1ce9c82389f529ca88bb586749308f5c", "html_url": "https://github.com/rust-lang/rust/commit/842a5fba1ce9c82389f529ca88bb586749308f5c"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "230ab7b6d42baf42715936bb3805c8e71ef4eb8b", "filename": "build.sh", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/a22e15b954d2be638ab0b15cee6e93cf301dc159/build.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a22e15b954d2be638ab0b15cee6e93cf301dc159/build.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.sh?ref=a22e15b954d2be638ab0b15cee6e93cf301dc159", "patch": "@@ -3,6 +3,26 @@\n #set -x\n set -e\n \n+codegen_channel=debug\n+sysroot_channel=debug\n+\n+while [[ $# -gt 0 ]]; do\n+    case $1 in\n+        --release)\n+            codegen_channel=release\n+            shift\n+            ;;\n+        --release-sysroot)\n+            sysroot_channel=release\n+            shift\n+            ;;\n+        *)\n+            echo \"Unknown option $1\"\n+            exit 1\n+            ;;\n+    esac\n+done\n+\n if [ -f ./gcc_path ]; then\n     export GCC_PATH=$(cat gcc_path)\n else\n@@ -21,7 +41,7 @@ if [[ \"$1\" == \"--features\" ]]; then\n     shift\n fi\n \n-if [[ \"$1\" == \"--release\" ]]; then\n+if [[ \"$codegen_channel\" == \"release\" ]]; then\n     export CHANNEL='release'\n     CARGO_INCREMENTAL=1 cargo rustc --release $features\n else\n@@ -36,4 +56,9 @@ rm -r target/out || true\n mkdir -p target/out/gccjit\n \n echo \"[BUILD] sysroot\"\n-time ./build_sysroot/build_sysroot.sh $CHANNEL\n+if [[ \"$sysroot_channel\" == \"release\" ]]; then\n+    time ./build_sysroot/build_sysroot.sh --release\n+else\n+    time ./build_sysroot/build_sysroot.sh\n+fi\n+"}]}