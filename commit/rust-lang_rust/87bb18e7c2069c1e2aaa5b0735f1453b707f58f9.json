{"sha": "87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "node_id": "C_kwDOAAsO6NoAKDg3YmIxOGU3YzIwNjljMWUyYWFhNWIwNzM1ZjE0NTNiNzA3ZjU4Zjk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-03T21:44:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-03T21:44:10Z"}, "message": "Auto merge of #88175 - camsteffen:let-desugar-span, r=Manishearth\n\nAdd expansion to while desugar spans\n\nIn the same vein as #88163, this reverts a change in Clippy behavior as a result of #80357 (and reverts some `#[allow]`s): This changes `clippy::blocks_in_if_conditions` to not fire on `while` loops. Though we might actually want Clippy to lint those cases, we should introduce the change purposefully, with tests, and possibly under a different lint name.\n\nThe actual change here is to add a desugaring expansion to the spans when lowering a `while` loop.\n\nr? `@Manishearth`", "tree": {"sha": "b2968d92d794519f84c6a89453ced5101693d2b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2968d92d794519f84c6a89453ced5101693d2b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "html_url": "https://github.com/rust-lang/rust/commit/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e165c129324c48a54d321b2dd77e2ff4c7ee9739", "url": "https://api.github.com/repos/rust-lang/rust/commits/e165c129324c48a54d321b2dd77e2ff4c7ee9739", "html_url": "https://github.com/rust-lang/rust/commit/e165c129324c48a54d321b2dd77e2ff4c7ee9739"}, {"sha": "9c2d52fabea21072029730cd895b8181afbc7f4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/9c2d52fabea21072029730cd895b8181afbc7f4e", "html_url": "https://github.com/rust-lang/rust/commit/9c2d52fabea21072029730cd895b8181afbc7f4e"}], "stats": {"total": 25, "additions": 11, "deletions": 14}, "files": [{"sha": "bb238c81ebc05376a3a60ffe49442101d5202b00", "filename": "tests/ui/crashes/issues_loop_mut_cond.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs?ref=87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "patch": "@@ -1,4 +1,3 @@\n-#![allow(clippy::blocks_in_if_conditions)]\n #![allow(dead_code)]\n \n /// Issue: https://github.com/rust-lang/rust-clippy/issues/2596"}, {"sha": "38e64b9ac0ada0a21fafdb086a9b3afa9c4f2200", "filename": "tests/ui/infinite_loop.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Finfinite_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Finfinite_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finfinite_loop.rs?ref=87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "patch": "@@ -1,5 +1,3 @@\n-#![allow(clippy::blocks_in_if_conditions)]\n-\n fn fn_val(i: i32) -> i32 {\n     unimplemented!()\n }"}, {"sha": "4ec7d900ade3dda39dc9dad2a8aadedd6b7ba249", "filename": "tests/ui/infinite_loop.stderr", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Finfinite_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87bb18e7c2069c1e2aaa5b0735f1453b707f58f9/tests%2Fui%2Finfinite_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finfinite_loop.stderr?ref=87bb18e7c2069c1e2aaa5b0735f1453b707f58f9", "patch": "@@ -1,5 +1,5 @@\n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:22:11\n+  --> $DIR/infinite_loop.rs:20:11\n    |\n LL |     while y < 10 {\n    |           ^^^^^^\n@@ -8,71 +8,71 @@ LL |     while y < 10 {\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:27:11\n+  --> $DIR/infinite_loop.rs:25:11\n    |\n LL |     while y < 10 && x < 3 {\n    |           ^^^^^^^^^^^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:34:11\n+  --> $DIR/infinite_loop.rs:32:11\n    |\n LL |     while !cond {\n    |           ^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:78:11\n+  --> $DIR/infinite_loop.rs:76:11\n    |\n LL |     while i < 3 {\n    |           ^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:83:11\n+  --> $DIR/infinite_loop.rs:81:11\n    |\n LL |     while i < 3 && j > 0 {\n    |           ^^^^^^^^^^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:87:11\n+  --> $DIR/infinite_loop.rs:85:11\n    |\n LL |     while i < 3 {\n    |           ^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:102:11\n+  --> $DIR/infinite_loop.rs:100:11\n    |\n LL |     while i < 3 {\n    |           ^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:107:11\n+  --> $DIR/infinite_loop.rs:105:11\n    |\n LL |     while i < 3 {\n    |           ^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:173:15\n+  --> $DIR/infinite_loop.rs:171:15\n    |\n LL |         while self.count < n {\n    |               ^^^^^^^^^^^^^^\n    |\n    = note: this may lead to an infinite or to a never running loop\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:181:11\n+  --> $DIR/infinite_loop.rs:179:11\n    |\n LL |     while y < 10 {\n    |           ^^^^^^\n@@ -82,7 +82,7 @@ LL |     while y < 10 {\n    = help: rewrite it as `if cond { loop { } }`\n \n error: variables in the condition are not mutated in the loop body\n-  --> $DIR/infinite_loop.rs:188:11\n+  --> $DIR/infinite_loop.rs:186:11\n    |\n LL |     while y < 10 {\n    |           ^^^^^^"}]}