{"sha": "152055451c552121be35a179bb77194e02800baa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1MjA1NTQ1MWM1NTIxMjFiZTM1YTE3OWJiNzcxOTRlMDI4MDBiYWE=", "commit": {"author": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2016-06-22T13:47:49Z"}, "committer": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2016-06-22T14:30:55Z"}, "message": "Allow different instruction set prefixes within the same architecture", "tree": {"sha": "e1d21f7728a6566e6e417d6fa9c2f14e4ee49b20", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1d21f7728a6566e6e417d6fa9c2f14e4ee49b20"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/152055451c552121be35a179bb77194e02800baa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/152055451c552121be35a179bb77194e02800baa", "html_url": "https://github.com/rust-lang/rust/commit/152055451c552121be35a179bb77194e02800baa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/152055451c552121be35a179bb77194e02800baa/comments", "author": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb4f54dc044ae85f567c0220fcf43db9bcd5c92d", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb4f54dc044ae85f567c0220fcf43db9bcd5c92d", "html_url": "https://github.com/rust-lang/rust/commit/cb4f54dc044ae85f567c0220fcf43db9bcd5c92d"}], "stats": {"total": 50, "additions": 37, "deletions": 13}, "files": [{"sha": "c8cda4077b79075b4d32a3db7bddcab04b5d4dfd", "filename": "src/etc/platform-intrinsics/aarch64.json", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Faarch64.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,6 +1,6 @@\n {\n-    \"platform\": \"aarch64\",\n-    \"intrinsic_prefix\": \"aarch64_v\",\n+    \"platform\": \"aarch64_v\",\n+    \"intrinsic_prefix\": \"\",\n     \"llvm_prefix\": \"llvm.aarch64.neon.\",\n     \"number_info\": {\n         \"signed\": {"}, {"sha": "39e49e239f34dfcc64e67a71933a0f89ec4037ed", "filename": "src/etc/platform-intrinsics/arm.json", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Farm.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Farm.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Farm.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,6 +1,6 @@\n {\n-    \"platform\": \"arm\",\n-    \"intrinsic_prefix\": \"arm_v\",\n+    \"platform\": \"arm_v\",\n+    \"intrinsic_prefix\": \"\",\n     \"llvm_prefix\": \"llvm.neon.v\",\n     \"number_info\": {\n         \"signed\": {"}, {"sha": "d2f40f167142904d3f947d19e6f89981907bb274", "filename": "src/etc/platform-intrinsics/generator.py", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fgenerator.py?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -26,18 +26,19 @@\n class PlatformInfo(object):\n     def __init__(self, json):\n         self._platform = json['platform']\n-        self._intrinsic_prefix = json['intrinsic_prefix']\n \n-    def intrinsic_prefix(self):\n-        return self._intrinsic_prefix\n+    def platform_prefix(self):\n+        return self._platform\n \n class IntrinsicSet(object):\n     def __init__(self, platform, json):\n+        \n         self._llvm_prefix = json['llvm_prefix']\n         self._type_info = json['number_info']\n         self._intrinsics = json['intrinsics']\n         self._widths = json['width_info']\n         self._platform = platform\n+        self._intrinsic_prefix = json['intrinsic_prefix']\n \n     def intrinsics(self):\n         for raw in self._intrinsics:\n@@ -48,6 +49,9 @@ def intrinsics(self):\n     def platform(self):\n         return self._platform\n \n+    def intrinsic_prefix(self):\n+        return self._intrinsic_prefix\n+\n     def llvm_prefix(self):\n         return self._llvm_prefix\n \n@@ -538,8 +542,14 @@ def intrinsic_suffix(self):\n                                       *self._args,\n                                       width = self._width)\n \n+    def platform_prefix(self):\n+        return self._platform.platform().platform_prefix()\n+\n+    def intrinsic_set_name(self):\n+        return self._platform.intrinsic_prefix()\n+\n     def intrinsic_name(self):\n-        return self._platform.platform().intrinsic_prefix() + self.intrinsic_suffix()\n+        return self._platform.intrinsic_prefix() + self.intrinsic_suffix()\n \n     def compiler_args(self):\n         return ', '.join(arg.compiler_ctor_ref() for arg in self._args_raw)\n@@ -751,8 +761,9 @@ def open(self, platform):\n         return 'extern \"platform-intrinsic\" {'\n \n     def render(self, mono):\n-        return '    fn {}{};'.format(mono.intrinsic_name(),\n-                                     mono.intrinsic_signature())\n+        return '    fn {}{}{};'.format(mono.platform_prefix(),\n+                                       mono.intrinsic_name(),\n+                                       mono.intrinsic_signature())\n \n     def close(self):\n         return '}'\n@@ -786,15 +797,15 @@ def open(self, platform):\n #[inline(never)]\n pub fn find(name: &str) -> Option<Intrinsic> {{\n     if !name.starts_with(\"{0}\") {{ return None }}\n-    Some(match &name[\"{0}\".len()..] {{'''.format(platform.intrinsic_prefix())\n+    Some(match &name[\"{0}\".len()..] {{'''.format(platform.platform_prefix())\n \n     def render(self, mono):\n         return '''\\\n         \"{}\" => Intrinsic {{\n             inputs: {{ static INPUTS: [&'static Type; {}] = [{}]; &INPUTS }},\n             output: {},\n             definition: Named(\"{}\")\n-        }},'''.format(mono.intrinsic_suffix(),\n+        }},'''.format(mono.intrinsic_set_name() + mono.intrinsic_suffix(),\n                       len(mono._args_raw),\n                       mono.compiler_args(),\n                       mono.compiler_ret(),"}, {"sha": "1f41e2ecf3e6d29ba0eb6d4d7d52c981faf40d94", "filename": "src/etc/platform-intrinsics/x86/avx.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.avx.\",\n     \"intrinsics\": [\n         {"}, {"sha": "4e006c1c4cf417c512e32a5c8582d5f86600f142", "filename": "src/etc/platform-intrinsics/x86/avx2.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Favx2.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.avx2.\",\n     \"intrinsics\": [\n         {"}, {"sha": "dcc26cd501c9bdbfaab71869e60baceba59f7663", "filename": "src/etc/platform-intrinsics/x86/fma.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Ffma.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.fma.\",\n     \"intrinsics\": [\n         {"}, {"sha": "8e90b8579c49ef996a33307d4903f6e95a4862f5", "filename": "src/etc/platform-intrinsics/x86/info.json", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Finfo.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,26 +1,30 @@\n {\n     \"platform\": \"x86\",\n-    \"intrinsic_prefix\": \"x86_mm\",\n     \"number_info\": {\n         \"signed\": {\n             \"kind\": \"s\",\n             \"kind_short\": \"\",\n             \"data_type\": { \"pattern\": \"epi{bitwidth}\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"8\": \"b\", \"16\": \"w\", \"32\": \"d\", \"64\": \"q\" }\n         },\n         \"unsigned\": {\n             \"kind\": \"u\",\n             \"kind_short\": \"u\",\n             \"data_type\": { \"pattern\": \"epu{bitwidth}\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"8\": \"b\", \"16\": \"w\", \"32\": \"d\", \"64\": \"q\" }\n         },\n         \"float\": {\n             \"kind\": \"f\",\n             \"data_type\": { \"32\": \"ps\", \"64\": \"pd\" },\n+            \"bitwidth\": { \"pattern\": \"{bitwidth}\" },\n             \"data_type_short\": { \"32\": \"ps\", \"64\": \"pd\" }\n         }\n     },\n     \"width_info\": {\n+        \"32\":  { \"width_mm\": \"32\", \"width_suffix\": \"\" },\n+        \"64\":  { \"width_mm\": \"64\", \"width_suffix\": \"\" },\n         \"128\": { \"width_mm\": \"\", \"width_suffix\": \"\" },\n         \"256\": { \"width_mm\": \"256\", \"width_suffix\": \".256\" },\n         \"512\": { \"width_mm\": \"512\", \"width_suffix\": \".512\" }"}, {"sha": "d8eef8a3514aec7267107d6526dcdc214d596ad2", "filename": "src/etc/platform-intrinsics/x86/sse.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse.\",\n     \"intrinsics\": [\n         {"}, {"sha": "4d6317d80a57e306ce117902e31570b33c21bb83", "filename": "src/etc/platform-intrinsics/x86/sse2.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse2.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse2.\",\n     \"intrinsics\": [\n         {"}, {"sha": "119bf208f7e3437d48e8e143f982891da8c176e7", "filename": "src/etc/platform-intrinsics/x86/sse3.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse3.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse3.\",\n     \"intrinsics\": [\n         {"}, {"sha": "b499637e0d3c6f5046a5a3107c5da7cfaf2afacf", "filename": "src/etc/platform-intrinsics/x86/sse41.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse41.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse41.\",\n     \"intrinsics\": [\n         {"}, {"sha": "fdee9c8a6671b9e2d914185b6629da4da20be93c", "filename": "src/etc/platform-intrinsics/x86/sse42.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fsse42.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.sse42.\",\n     \"intrinsics\": [\n         {"}, {"sha": "5a5617957b3e5b78597a0b4a86cadd3e4838d646", "filename": "src/etc/platform-intrinsics/x86/ssse3.json", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json", "raw_url": "https://github.com/rust-lang/rust/raw/152055451c552121be35a179bb77194e02800baa/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fplatform-intrinsics%2Fx86%2Fssse3.json?ref=152055451c552121be35a179bb77194e02800baa", "patch": "@@ -1,4 +1,5 @@\n {\n+    \"intrinsic_prefix\": \"_mm\",\n     \"llvm_prefix\": \"llvm.x86.ssse3.\",\n     \"intrinsics\": [\n         {"}]}