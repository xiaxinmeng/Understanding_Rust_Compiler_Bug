{"sha": "ea7197e2cf921211fb3b82ad45452c2095f5a589", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhNzE5N2UyY2Y5MjEyMTFmYjNiODJhZDQ1NDUyYzIwOTVmNWE1ODk=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-17T01:40:51Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-17T01:42:08Z"}, "message": "rustc: Add str_from_cstr() and str_from_buf() functions to the standard library, as well as a test case", "tree": {"sha": "7023e317dcc61a637388a42b746d91079413eed2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7023e317dcc61a637388a42b746d91079413eed2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea7197e2cf921211fb3b82ad45452c2095f5a589", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea7197e2cf921211fb3b82ad45452c2095f5a589", "html_url": "https://github.com/rust-lang/rust/commit/ea7197e2cf921211fb3b82ad45452c2095f5a589", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea7197e2cf921211fb3b82ad45452c2095f5a589/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "320ac6b8eba10b51ba10443198d319b8ea0a657d", "url": "https://api.github.com/repos/rust-lang/rust/commits/320ac6b8eba10b51ba10443198d319b8ea0a657d", "html_url": "https://github.com/rust-lang/rust/commit/320ac6b8eba10b51ba10443198d319b8ea0a657d"}], "stats": {"total": 48, "additions": 48, "deletions": 0}, "files": [{"sha": "16437310b7675bc71a12f3088f3b80d79b204b3f", "filename": "src/Makefile", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=ea7197e2cf921211fb3b82ad45452c2095f5a589", "patch": "@@ -498,6 +498,7 @@ TEST_XFAILS_RUSTC := $(addprefix test/run-pass/, \\\n                         lib-sha1.rs \\\n                         lib-sort.rs \\\n                         lib-str.rs \\\n+                        lib-str-buf.rs \\\n                         lib-task.rs \\\n                         lib-uint.rs \\\n                         lib-vec-str-conversions.rs \\"}, {"sha": "93d0a9f286a34b2f438c8986e643f554bde7d9a1", "filename": "src/lib/_str.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Flib%2F_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Flib%2F_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2F_str.rs?ref=ea7197e2cf921211fb3b82ad45452c2095f5a589", "patch": "@@ -8,6 +8,8 @@ native \"rust\" mod rustrt {\n     fn str_byte_len(str s) -> uint;\n     fn str_alloc(uint n_bytes) -> str;\n     fn str_from_vec(vec[u8] b) -> str;\n+    fn str_from_cstr(sbuf cstr) -> str;\n+    fn str_from_buf(sbuf buf, uint len) -> str;\n     fn refcount[T](str s) -> uint;\n }\n \n@@ -115,6 +117,14 @@ fn unsafe_from_byte(u8 u) -> str {\n     ret rustrt.str_from_vec(vec(u));\n }\n \n+unsafe fn str_from_cstr(sbuf cstr) -> str {\n+    ret rustrt.str_from_cstr(cstr);\n+}\n+\n+unsafe fn str_from_buf(sbuf buf, uint len) -> str {\n+    ret rustrt.str_from_buf(buf, len);\n+}\n+\n \n fn refcount(str s) -> uint {\n     auto r = rustrt.refcount[u8](s);"}, {"sha": "1f17fc8c0759d375aa7b20635771d7115602f0ab", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=ea7197e2cf921211fb3b82ad45452c2095f5a589", "patch": "@@ -207,6 +207,29 @@ str_from_vec(rust_task *task, rust_vec *v)\n     return st;\n }\n \n+extern \"C\" CDECL rust_str *\n+str_from_cstr(rust_task *task, char *sbuf)\n+{\n+    size_t len = strlen(sbuf) + 1;\n+    rust_str *st = vec_alloc_with_data(task, len, len, 1, sbuf);\n+    if (!st) {\n+        task->fail(2);\n+        return NULL;\n+    }\n+    return st;\n+}\n+\n+extern \"C\" CDECL rust_str *\n+str_from_buf(rust_task *task, char *buf, unsigned int len) {\n+    rust_str *st = vec_alloc_with_data(task, len + 1, len, 1, buf);\n+    if (!st) {\n+        task->fail(2);\n+        return NULL;\n+    }\n+    st->data[st->fill++] = '\\0';\n+    return st;\n+}\n+\n extern \"C\" CDECL void *\n rand_new(rust_task *task)\n {"}, {"sha": "7ba19e925d76d53f08b5c52e63b45123408bea87", "filename": "src/test/run-pass/lib-str-buf.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Ftest%2Frun-pass%2Flib-str-buf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea7197e2cf921211fb3b82ad45452c2095f5a589/src%2Ftest%2Frun-pass%2Flib-str-buf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-str-buf.rs?ref=ea7197e2cf921211fb3b82ad45452c2095f5a589", "patch": "@@ -0,0 +1,14 @@\n+// -*- rust -*-\n+\n+use std;\n+import std._str;\n+\n+fn main() {\n+    auto s = \"hello\";\n+    auto sb = _str.rustrt.str_buf(s);\n+    auto s_cstr = _str.rustrt.str_from_cstr(sb);\n+    check (_str.eq(s_cstr, s));\n+    auto s_buf = _str.rustrt.str_from_buf(sb, 5u);\n+    check (_str.eq(s_buf, s));\n+}\n+"}]}