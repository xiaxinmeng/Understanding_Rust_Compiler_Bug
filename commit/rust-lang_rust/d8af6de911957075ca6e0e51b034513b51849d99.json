{"sha": "d8af6de911957075ca6e0e51b034513b51849d99", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4YWY2ZGU5MTE5NTcwNzVjYTZlMGU1MWIwMzQ1MTNiNTE4NDlkOTk=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2021-02-07T16:26:33Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2021-02-07T17:08:45Z"}, "message": "Address review comments", "tree": {"sha": "1e23cb946482e0d8679f7d5586845c3f3392e39e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e23cb946482e0d8679f7d5586845c3f3392e39e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d8af6de911957075ca6e0e51b034513b51849d99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d8af6de911957075ca6e0e51b034513b51849d99", "html_url": "https://github.com/rust-lang/rust/commit/d8af6de911957075ca6e0e51b034513b51849d99", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d8af6de911957075ca6e0e51b034513b51849d99/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6caae52c1622a3c4f154eadaad615b577ceb6a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6caae52c1622a3c4f154eadaad615b577ceb6a8", "html_url": "https://github.com/rust-lang/rust/commit/f6caae52c1622a3c4f154eadaad615b577ceb6a8"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "196a774355e10d1b2c79dd9e45f24f07c5fe5a37", "filename": "compiler/rustc_expand/src/base.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d8af6de911957075ca6e0e51b034513b51849d99/compiler%2Frustc_expand%2Fsrc%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8af6de911957075ca6e0e51b034513b51849d99/compiler%2Frustc_expand%2Fsrc%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fbase.rs?ref=d8af6de911957075ca6e0e51b034513b51849d99", "patch": "@@ -141,6 +141,9 @@ impl Annotatable {\n     }\n \n     crate fn into_tokens(self, sess: &ParseSess) -> TokenStream {\n+        // Tokens of an attribute target may be invalidated by some outer `#[derive]` performing\n+        // \"full configuration\" (attributes following derives on the same item should be the most\n+        // common case), that's why synthesizing tokens is allowed.\n         nt_to_tokenstream(&self.into_nonterminal(), sess, CanSynthesizeMissingTokens::Yes)\n     }\n "}, {"sha": "d310e5806c560a961b4a283db0e720fc959fa26d", "filename": "src/test/ui/derives/derive-renamed.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fderives%2Fderive-renamed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fderives%2Fderive-renamed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fderives%2Fderive-renamed.rs?ref=d8af6de911957075ca6e0e51b034513b51849d99", "patch": "@@ -0,0 +1,11 @@\n+// check-pass\n+// edition:2018\n+\n+use derive as my_derive;\n+\n+#[my_derive(Debug)]\n+struct S;\n+\n+fn main() {\n+    println!(\"{:?}\", S); // OK\n+}"}, {"sha": "f0fec6782423ef73901040aaef98f12622e3b4d2", "filename": "src/test/ui/proc-macro/attribute-after-derive-feature-gate.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fattribute-after-derive-feature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fattribute-after-derive-feature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fattribute-after-derive-feature-gate.rs?ref=d8af6de911957075ca6e0e51b034513b51849d99", "patch": "@@ -25,4 +25,13 @@ struct S3 {\n     field: [u8; #[identity_attr] 10], //~ ERROR macro attributes in `#[derive]` output are unstable\n }\n \n+#[derive(Empty)]\n+struct S4 {\n+    field: [u8; {\n+        #[derive(Empty)] // OK, not gated\n+        struct Inner;\n+        10\n+    }]\n+}\n+\n fn main() {}"}, {"sha": "ca904900da0bb5a103e0c167c3cf8ea49cdfee86", "filename": "src/test/ui/proc-macro/derive-helper-legacy-limits.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.rs?ref=d8af6de911957075ca6e0e51b034513b51849d99", "patch": "@@ -0,0 +1,21 @@\n+// Support for legacy derive helpers is limited and heuristic-based\n+// (that's exactly the reason why they are deprecated).\n+\n+// edition:2018\n+// aux-build:test-macros.rs\n+\n+#[macro_use]\n+extern crate test_macros;\n+\n+use derive as my_derive;\n+\n+#[my_derive(Empty)]\n+#[empty_helper] // OK\n+struct S1;\n+\n+// Legacy helper detection doesn't see through `derive` renaming.\n+#[empty_helper] //~ ERROR cannot find attribute `empty_helper` in this scope\n+#[my_derive(Empty)]\n+struct S2;\n+\n+fn main() {}"}, {"sha": "186f38a00f9176e45bf07de7338266cc1600675d", "filename": "src/test/ui/proc-macro/derive-helper-legacy-limits.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d8af6de911957075ca6e0e51b034513b51849d99/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-legacy-limits.stderr?ref=d8af6de911957075ca6e0e51b034513b51849d99", "patch": "@@ -0,0 +1,8 @@\n+error: cannot find attribute `empty_helper` in this scope\n+  --> $DIR/derive-helper-legacy-limits.rs:17:3\n+   |\n+LL | #[empty_helper]\n+   |   ^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}