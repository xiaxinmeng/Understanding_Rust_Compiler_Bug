{"sha": "f21977318112a1b7491bbf462dfefbd8ec14743e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyMTk3NzMxODExMmExYjc0OTFiYmY0NjJkZmVmYmQ4ZWMxNDc0M2U=", "commit": {"author": {"name": "Piotr Czarnecki", "email": "pioczarn@gmail.com", "date": "2014-10-24T15:38:23Z"}, "committer": {"name": "Piotr Czarnecki", "email": "pioczarn@gmail.com", "date": "2014-10-24T17:07:52Z"}, "message": "regex: The first range in a character class can start with a left bracket", "tree": {"sha": "45d69384119d63e2f17a0ff57bee1f2eb7602f38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45d69384119d63e2f17a0ff57bee1f2eb7602f38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f21977318112a1b7491bbf462dfefbd8ec14743e", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f21977318112a1b7491bbf462dfefbd8ec14743e", "html_url": "https://github.com/rust-lang/rust/commit/f21977318112a1b7491bbf462dfefbd8ec14743e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f21977318112a1b7491bbf462dfefbd8ec14743e/comments", "author": {"login": "pczarn", "id": 3356767, "node_id": "MDQ6VXNlcjMzNTY3Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pczarn", "html_url": "https://github.com/pczarn", "followers_url": "https://api.github.com/users/pczarn/followers", "following_url": "https://api.github.com/users/pczarn/following{/other_user}", "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions", "organizations_url": "https://api.github.com/users/pczarn/orgs", "repos_url": "https://api.github.com/users/pczarn/repos", "events_url": "https://api.github.com/users/pczarn/events{/privacy}", "received_events_url": "https://api.github.com/users/pczarn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pczarn", "id": 3356767, "node_id": "MDQ6VXNlcjMzNTY3Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/3356767?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pczarn", "html_url": "https://github.com/pczarn", "followers_url": "https://api.github.com/users/pczarn/followers", "following_url": "https://api.github.com/users/pczarn/following{/other_user}", "gists_url": "https://api.github.com/users/pczarn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pczarn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pczarn/subscriptions", "organizations_url": "https://api.github.com/users/pczarn/orgs", "repos_url": "https://api.github.com/users/pczarn/repos", "events_url": "https://api.github.com/users/pczarn/events{/privacy}", "received_events_url": "https://api.github.com/users/pczarn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48daba088b0f353cc4fdaba144da7a2c1b1de87f", "url": "https://api.github.com/repos/rust-lang/rust/commits/48daba088b0f353cc4fdaba144da7a2c1b1de87f", "html_url": "https://github.com/rust-lang/rust/commit/48daba088b0f353cc4fdaba144da7a2c1b1de87f"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "35583be372cb34f65ae86cb62b33f5a0d916114c", "filename": "src/libregex/parse.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f21977318112a1b7491bbf462dfefbd8ec14743e/src%2Flibregex%2Fparse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f21977318112a1b7491bbf462dfefbd8ec14743e/src%2Flibregex%2Fparse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibregex%2Fparse.rs?ref=f21977318112a1b7491bbf462dfefbd8ec14743e", "patch": "@@ -374,10 +374,6 @@ impl<'a> Parser<'a> {\n         let mut ranges: Vec<(char, char)> = vec!();\n         let mut alts: Vec<Ast> = vec!();\n \n-        if self.peek_is(1, ']') {\n-            try!(self.expect(']'));\n-            ranges.push((']', ']'))\n-        }\n         while self.peek_is(1, '-') {\n             try!(self.expect('-'));\n             ranges.push(('-', '-'))\n@@ -411,7 +407,7 @@ impl<'a> Parser<'a> {\n                         ast => fail!(\"Unexpected AST item '{}'\", ast),\n                     }\n                 }\n-                ']' => {\n+                ']' if ranges.len() > 0 || alts.len() > 0 => {\n                     if ranges.len() > 0 {\n                         let flags = negated | (self.flags & FLAG_NOCASE);\n                         let mut ast = AstClass(combine_ranges(ranges), flags);"}, {"sha": "06f7db274189d74680d0e4c559ad831b78c2b56c", "filename": "src/libregex/test/tests.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f21977318112a1b7491bbf462dfefbd8ec14743e/src%2Flibregex%2Ftest%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f21977318112a1b7491bbf462dfefbd8ec14743e/src%2Flibregex%2Ftest%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibregex%2Ftest%2Ftests.rs?ref=f21977318112a1b7491bbf462dfefbd8ec14743e", "patch": "@@ -53,6 +53,13 @@ fn quoted_bracket_set() {\n     assert_eq!(ms, vec![(0, 1), (1, 2)]);\n }\n \n+#[test]\n+fn first_range_starts_with_left_bracket() {\n+    let re = regex!(r\"([[-z])\");\n+    let ms = re.find_iter(\"[]\").collect::<Vec<(uint, uint)>>();\n+    assert_eq!(ms, vec![(0, 1), (1, 2)]);\n+}\n+\n #[test]\n fn range_ends_with_escape() {\n     let re = regex!(r\"([\\[-\\x{5d}])\");"}]}