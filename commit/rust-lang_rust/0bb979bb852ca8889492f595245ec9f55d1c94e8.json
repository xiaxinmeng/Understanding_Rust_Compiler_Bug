{"sha": "0bb979bb852ca8889492f595245ec9f55d1c94e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiYjk3OWJiODUyY2E4ODg5NDkyZjU5NTI0NWVjOWY1NWQxYzk0ZTg=", "commit": {"author": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2015-10-23T18:36:38Z"}, "committer": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2015-10-23T18:37:45Z"}, "message": "Restore idempotence for chain formatting", "tree": {"sha": "46b3eaf9e903e38a21f66834f8f11cd5166015ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46b3eaf9e903e38a21f66834f8f11cd5166015ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0bb979bb852ca8889492f595245ec9f55d1c94e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0bb979bb852ca8889492f595245ec9f55d1c94e8", "html_url": "https://github.com/rust-lang/rust/commit/0bb979bb852ca8889492f595245ec9f55d1c94e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0bb979bb852ca8889492f595245ec9f55d1c94e8/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e76fad1f55945c196b32e6629ebaecc4ebfda74", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e76fad1f55945c196b32e6629ebaecc4ebfda74", "html_url": "https://github.com/rust-lang/rust/commit/7e76fad1f55945c196b32e6629ebaecc4ebfda74"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "ebe7aacf7cc8095ca2d3dd068eb9ede0045d4706", "filename": "src/chains.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0bb979bb852ca8889492f595245ec9f55d1c94e8/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bb979bb852ca8889492f595245ec9f55d1c94e8/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=0bb979bb852ca8889492f595245ec9f55d1c94e8", "patch": "@@ -82,11 +82,11 @@ pub fn rewrite_chain(mut expr: &ast::Expr,\n     let veto_single_line = if context.config.take_source_hints && subexpr_list.len() > 1 {\n         // Look at the source code. Unless all chain elements start on the same\n         // line, we won't consider putting them on a single line either.\n-        let first_line_no = context.codemap.lookup_char_pos(subexpr_list[0].span.lo).line;\n+        let last_span = context.snippet(mk_sp(subexpr_list[1].span.hi, total_span.hi));\n+        let first_span = context.snippet(subexpr_list[1].span);\n+        let last_iter = last_span.chars().take_while(|c| c.is_whitespace());\n \n-        subexpr_list[1..]\n-            .iter()\n-            .any(|ex| context.codemap.lookup_char_pos(ex.span.hi).line != first_line_no)\n+        first_span.chars().chain(last_iter).any(|c| c == '\\n')\n     } else {\n         false\n     };"}, {"sha": "bf1ed31afe70ec66dc5950cf195f32077a9425f2", "filename": "tests/source/chains.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Fsource%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Fsource%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fchains.rs?ref=0bb979bb852ca8889492f595245ec9f55d1c94e8", "patch": "@@ -101,3 +101,8 @@ fn floaters() {\n \n     a + match x { true => \"yay!\", false => \"boo!\" }.bar()\n }\n+\n+fn is_replaced_content() -> bool {\n+    constellat.send(ConstellationMsg::ViewportConstrained(\n+            self.id, constraints)).unwrap();\n+}"}, {"sha": "400db5f8df50753edab873484c159ee74aa9a919", "filename": "tests/target/chains-no-overflow.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Ftarget%2Fchains-no-overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Ftarget%2Fchains-no-overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains-no-overflow.rs?ref=0bb979bb852ca8889492f595245ec9f55d1c94e8", "patch": "@@ -2,7 +2,8 @@\n // Test chain formatting without overflowing the last item.\n \n fn main() {\n-    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc.ddddddddddddddddddddddddddd();\n+    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n+                       .ddddddddddddddddddddddddddd();\n \n     bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n                        .ddddddddddddddddddddddddddd"}, {"sha": "2fb201011a5c2ad4107a0d733c9952f0fecf8d35", "filename": "tests/target/chains.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Ftarget%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bb979bb852ca8889492f595245ec9f55d1c94e8/tests%2Ftarget%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains.rs?ref=0bb979bb852ca8889492f595245ec9f55d1c94e8", "patch": "@@ -7,7 +7,8 @@ fn main() {\n              .1\n              .foo(|x| x + 1);\n \n-    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc.ddddddddddddddddddddddddddd();\n+    bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n+                       .ddddddddddddddddddddddddddd();\n \n     bbbbbbbbbbbbbbbbbbb.ccccccccccccccccccccccccccccccccccccc\n                        .ddddddddddddddddddddddddddd\n@@ -126,3 +127,8 @@ fn floaters() {\n     }\n     .bar()\n }\n+\n+fn is_replaced_content() -> bool {\n+    constellat.send(ConstellationMsg::ViewportConstrained(self.id, constraints))\n+              .unwrap();\n+}"}]}