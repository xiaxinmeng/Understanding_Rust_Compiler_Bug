{"sha": "c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzNjRhNGUzMGYxMzY4NTQyYjA2MWRiZDRlYTQ4NjFmYmM3MWE3ZWU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-08-02T14:33:37Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2021-08-02T14:51:39Z"}, "message": "Assign E0784 to union expression error", "tree": {"sha": "753f195123f2944dfc9b537baa07489d5129660b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/753f195123f2944dfc9b537baa07489d5129660b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "html_url": "https://github.com/rust-lang/rust/commit/c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76d247c00a9203c69d6c11a84075392ebb8c3fc5", "url": "https://api.github.com/repos/rust-lang/rust/commits/76d247c00a9203c69d6c11a84075392ebb8c3fc5", "html_url": "https://github.com/rust-lang/rust/commit/76d247c00a9203c69d6c11a84075392ebb8c3fc5"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "6175e7a5a0844a2510e723a8f6f6c634f27ba6a1", "filename": "compiler/rustc_error_codes/src/error_codes.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs?ref=c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "patch": "@@ -478,6 +478,7 @@ E0780: include_str!(\"./error_codes/E0780.md\"),\n E0781: include_str!(\"./error_codes/E0781.md\"),\n E0782: include_str!(\"./error_codes/E0782.md\"),\n E0783: include_str!(\"./error_codes/E0783.md\"),\n+E0784: include_str!(\"./error_codes/E0784.md\"),\n ;\n //  E0006, // merged with E0005\n //  E0008, // cannot bind by-move into a pattern guard\n@@ -636,7 +637,7 @@ E0783: include_str!(\"./error_codes/E0783.md\"),\n     E0711, // a feature has been declared with conflicting stability attributes\n     E0717, // rustc_promotable without stability attribute\n //  E0721, // `await` keyword\n-//    E0723, unstable feature in `const` context\n+//  E0723, unstable feature in `const` context\n     E0726, // non-explicit (not `'_`) elided lifetime in unsupported position\n //  E0738, // Removed; errored on `#[track_caller] fn`s in `extern \"Rust\" { ... }`.\n     E0772, // `'static' obligation coming from `impl dyn Trait {}` or `impl Foo for dyn Bar {}`."}, {"sha": "b20b7039bf4720f565ca67a6f2e4de7973d500c4", "filename": "compiler/rustc_error_codes/src/error_codes/E0784.md", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0784.md", "raw_url": "https://github.com/rust-lang/rust/raw/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0784.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0784.md?ref=c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "patch": "@@ -0,0 +1,32 @@\n+A union expression does not have exactly one field.\n+\n+Erroneous code example:\n+\n+```compile_fail,E0784\n+union Bird {\n+    pigeon: u8,\n+    turtledove: u16,\n+}\n+\n+let bird = Bird {}; // error\n+let bird = Bird { pigeon: 0, turtledove: 1 }; // error\n+```\n+\n+The key property of unions is that all fields of a union share common storage.\n+As a result, writes to one field of a union can overwrite its other fields, and\n+size of a union is determined by the size of its largest field.\n+\n+You can find more information about the union types in the [Rust reference].\n+\n+Working example:\n+\n+```\n+union Bird {\n+    pigeon: u8,\n+    turtledove: u16,\n+}\n+\n+let bird = Bird { pigeon: 0 }; // OK\n+```\n+\n+[Rust reference]: https://doc.rust-lang.org/reference/items/unions.html"}, {"sha": "3f3640aee4f61f17ae9aa6608d0e8f4dabb5c2a8", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c364a4e30f1368542b061dbd4ea4861fbc71a7ee/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=c364a4e30f1368542b061dbd4ea4861fbc71a7ee", "patch": "@@ -1304,7 +1304,13 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         // Make sure the programmer specified correct number of fields.\n         if kind_name == \"union\" {\n             if ast_fields.len() != 1 {\n-                tcx.sess.span_err(span, \"union expressions should have exactly one field\");\n+                struct_span_err!(\n+                    tcx.sess,\n+                    span,\n+                    E0784,\n+                    \"union expressions should have exactly one field\",\n+                )\n+                .emit();\n             }\n         } else if check_completeness && !error_happened && !remaining_fields.is_empty() {\n             let no_accessible_remaining_fields = remaining_fields"}]}