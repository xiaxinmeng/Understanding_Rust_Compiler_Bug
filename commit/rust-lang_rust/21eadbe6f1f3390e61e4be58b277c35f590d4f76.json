{"sha": "21eadbe6f1f3390e61e4be58b277c35f590d4f76", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIxZWFkYmU2ZjFmMzM5MGU2MWU0YmU1OGIyNzdjMzVmNTkwZDRmNzY=", "commit": {"author": {"name": "Jyun-Yan You", "email": "jyyou@cs.nctu.edu.tw", "date": "2012-01-01T06:36:48Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-02T04:18:55Z"}, "message": "add missing library, enable segmented stacks for freebsd", "tree": {"sha": "b2be61a3bf4db80b4873ae527dbf8d521ae4f686", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2be61a3bf4db80b4873ae527dbf8d521ae4f686"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/21eadbe6f1f3390e61e4be58b277c35f590d4f76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/21eadbe6f1f3390e61e4be58b277c35f590d4f76", "html_url": "https://github.com/rust-lang/rust/commit/21eadbe6f1f3390e61e4be58b277c35f590d4f76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/21eadbe6f1f3390e61e4be58b277c35f590d4f76/comments", "author": {"login": "crabtw", "id": 36015, "node_id": "MDQ6VXNlcjM2MDE1", "avatar_url": "https://avatars.githubusercontent.com/u/36015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crabtw", "html_url": "https://github.com/crabtw", "followers_url": "https://api.github.com/users/crabtw/followers", "following_url": "https://api.github.com/users/crabtw/following{/other_user}", "gists_url": "https://api.github.com/users/crabtw/gists{/gist_id}", "starred_url": "https://api.github.com/users/crabtw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crabtw/subscriptions", "organizations_url": "https://api.github.com/users/crabtw/orgs", "repos_url": "https://api.github.com/users/crabtw/repos", "events_url": "https://api.github.com/users/crabtw/events{/privacy}", "received_events_url": "https://api.github.com/users/crabtw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4884b6c6e3ea6b4b9da305eb48250179448ad31", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4884b6c6e3ea6b4b9da305eb48250179448ad31", "html_url": "https://github.com/rust-lang/rust/commit/d4884b6c6e3ea6b4b9da305eb48250179448ad31"}], "stats": {"total": 21, "additions": 11, "deletions": 10}, "files": [{"sha": "a978ccc95aa16bee630cf195fd81f00b5c8cb59e", "filename": "mk/platform.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/21eadbe6f1f3390e61e4be58b277c35f590d4f76/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/21eadbe6f1f3390e61e4be58b277c35f590d4f76/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=21eadbe6f1f3390e61e4be58b277c35f590d4f76", "patch": "@@ -25,7 +25,7 @@ ifneq ($(findstring freebsd,$(CFG_OSTYPE)),)\n   CFG_LIB_NAME=lib$(1).so\n   CFG_LIB_GLOB=lib$(1)-*.so\n   CFG_GCCISH_CFLAGS += -fPIC -I/usr/local/include\n-  CFG_GCCISH_LINK_FLAGS += -shared -fPIC -lpthread -lrt\n+  CFG_GCCISH_LINK_FLAGS += -shared -fPIC -lpthread -lrt -L/usr/local/lib -lexecinfo\n   CFG_GCCISH_DEF_FLAG := -Wl,--export-dynamic,--dynamic-list=\n   CFG_GCCISH_PRE_LIB_FLAGS := -Wl,-whole-archive\n   CFG_GCCISH_POST_LIB_FLAGS := -Wl,-no-whole-archive"}, {"sha": "7f413735acd6fc0e2ddabddf0ea4442603569ad7", "filename": "src/comp/back/link.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/21eadbe6f1f3390e61e4be58b277c35f590d4f76/src%2Fcomp%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/21eadbe6f1f3390e61e4be58b277c35f590d4f76/src%2Fcomp%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Flink.rs?ref=21eadbe6f1f3390e61e4be58b277c35f590d4f76", "patch": "@@ -220,7 +220,6 @@ mod write {\n             } else { FileType = LLVMAssemblyFile; }\n             // Write optimized bitcode if --save-temps was on.\n \n-            let seg_stack = sess.get_targ_cfg().os != session::os_freebsd;\n             if opts.save_temps {\n                 // Always output the bitcode file with --save-temps\n \n@@ -245,7 +244,7 @@ mod write {\n                                     buf_o,\n                                     LLVMAssemblyFile,\n                                     CodeGenOptLevel,\n-                                    seg_stack)})});\n+                                    true)})});\n                 }\n \n \n@@ -265,7 +264,7 @@ mod write {\n                                         buf_o,\n                                         LLVMObjectFile,\n                                         CodeGenOptLevel,\n-                                        seg_stack)})});\n+                                        true)})});\n                 }\n             } else {\n                 // If we aren't saving temps then just output the file\n@@ -283,7 +282,7 @@ mod write {\n                                     buf_o,\n                                     FileType,\n                                     CodeGenOptLevel,\n-                                    seg_stack)})});\n+                                    true)})});\n             }\n             // Clean up and return\n \n@@ -661,7 +660,7 @@ fn link_binary(sess: session::session,\n     }\n \n     if sess.get_targ_cfg().os == session::os_freebsd {\n-        gcc_args += [\"-lrt\"];\n+        gcc_args += [\"-lrt\", \"-L/usr/local/lib\", \"-lexecinfo\"];\n     }\n \n     // OS X 10.6 introduced 'compact unwind info', which is produced by the"}, {"sha": "3b238d33c77870b8d6ad40f7c0e1bf2572985b2f", "filename": "src/rt/arch/x86_64/record_sp.S", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/21eadbe6f1f3390e61e4be58b277c35f590d4f76/src%2Frt%2Farch%2Fx86_64%2Frecord_sp.S", "raw_url": "https://github.com/rust-lang/rust/raw/21eadbe6f1f3390e61e4be58b277c35f590d4f76/src%2Frt%2Farch%2Fx86_64%2Frecord_sp.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Frecord_sp.S?ref=21eadbe6f1f3390e61e4be58b277c35f590d4f76", "patch": "@@ -14,21 +14,23 @@\n .globl GET_SP\n .globl CHECK_STACK\n \n-#if defined(__linux__) || defined(__FreeBSD__)\n+#if defined(__linux__)\n RECORD_SP:\n \tmovq %rdi, %fs:112\n \tret\n-#else\n-#if defined(__APPLE__)\n+#elif defined(__APPLE__)\n RECORD_SP:\n \tmovq $0x60+90*8, %rsi\n \tmovq %rdi, %gs:(%rsi)\n \tret\n+#elif defined(__FreeBSD__)\n+RECORD_SP:\n+\tmovq %rdi, %fs:24\n+\tret\n #else\n RECORD_SP:\n \tret\n #endif\n-#endif\n \n GET_SP:\n \tmovq %rsp, %rax"}]}