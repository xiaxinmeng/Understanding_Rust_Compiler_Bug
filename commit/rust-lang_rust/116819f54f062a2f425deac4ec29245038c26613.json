{"sha": "116819f54f062a2f425deac4ec29245038c26613", "node_id": "C_kwDOAAsO6NoAKDExNjgxOWY1NGYwNjJhMmY0MjVkZWFjNGVjMjkyNDUwMzhjMjY2MTM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-15T11:44:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-15T11:44:20Z"}, "message": "Auto merge of #99278 - Dylan-DPC:rollup-fcln6st, r=Dylan-DPC\n\nRollup of 5 pull requests\n\nSuccessful merges:\n\n - #88991 (Add Nintendo Switch as tier 3 target)\n - #98869 (Remove some usages of `guess_head_span`)\n - #99119 (Refactor: remove a string matching about methods)\n - #99209 (Correctly handle crate level page on docs.rs as well)\n - #99246 (Update RLS)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "4cad7f8973d8418c06df572f965090dcacd5332c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4cad7f8973d8418c06df572f965090dcacd5332c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/116819f54f062a2f425deac4ec29245038c26613", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/116819f54f062a2f425deac4ec29245038c26613", "html_url": "https://github.com/rust-lang/rust/commit/116819f54f062a2f425deac4ec29245038c26613", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/116819f54f062a2f425deac4ec29245038c26613/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6077b7cda466afa2b75a62b232ab46dbeb148bcb", "url": "https://api.github.com/repos/rust-lang/rust/commits/6077b7cda466afa2b75a62b232ab46dbeb148bcb", "html_url": "https://github.com/rust-lang/rust/commit/6077b7cda466afa2b75a62b232ab46dbeb148bcb"}, {"sha": "8e3dd62a95b359e00435c3dc82b25907d6e47773", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e3dd62a95b359e00435c3dc82b25907d6e47773", "html_url": "https://github.com/rust-lang/rust/commit/8e3dd62a95b359e00435c3dc82b25907d6e47773"}], "stats": {"total": 792, "additions": 468, "deletions": 324}, "files": [{"sha": "48a41c8bd245a3d8bdc892a017946f45e271c39c", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1824,6 +1824,14 @@ impl Expr<'_> {\n             _ => false,\n         }\n     }\n+\n+    pub fn method_ident(&self) -> Option<Ident> {\n+        match self.kind {\n+            ExprKind::MethodCall(receiver_method, ..) => Some(receiver_method.ident),\n+            ExprKind::Unary(_, expr) | ExprKind::AddrOf(.., expr) => expr.method_ident(),\n+            _ => None,\n+        }\n+    }\n }\n \n /// Checks if the specified expression is a built-in range literal."}, {"sha": "1e8b212276f2f310a4ef48d7e29d7c96a8e8fcc7", "filename": "compiler/rustc_infer/src/infer/canonical/query_response.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fquery_response.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fquery_response.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcanonical%2Fquery_response.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -714,10 +714,7 @@ impl<'tcx> TypeRelatingDelegate<'tcx> for QueryTypeRelatingDelegate<'_, 'tcx> {\n     }\n \n     fn const_equate(&mut self, _a: Const<'tcx>, _b: Const<'tcx>) {\n-        span_bug!(\n-            self.cause.span(self.infcx.tcx),\n-            \"generic_const_exprs: unreachable `const_equate`\"\n-        );\n+        span_bug!(self.cause.span(), \"generic_const_exprs: unreachable `const_equate`\");\n     }\n \n     fn normalization() -> NormalizationStrategy {"}, {"sha": "4f59215c70b9216d6d585c8683ac034937839dae", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1435,7 +1435,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n         swap_secondary_and_primary: bool,\n         force_label: bool,\n     ) {\n-        let span = cause.span(self.tcx);\n+        let span = cause.span();\n \n         // For some types of errors, expected-found does not make\n         // sense, so just ignore the values we were given.\n@@ -2085,7 +2085,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n \n         debug!(\"report_and_explain_type_error(trace={:?}, terr={:?})\", trace, terr);\n \n-        let span = trace.cause.span(self.tcx);\n+        let span = trace.cause.span();\n         let failure_code = trace.cause.as_failure_code(terr);\n         let mut diag = match failure_code {\n             FailureCode::Error0038(did) => {"}, {"sha": "998699158ff484d57c8154ae99c3793fd2748ed4", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/placeholder_error.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fplaceholder_error.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -204,7 +204,7 @@ impl<'tcx> NiceRegionError<'_, 'tcx> {\n         expected_substs: SubstsRef<'tcx>,\n         actual_substs: SubstsRef<'tcx>,\n     ) -> DiagnosticBuilder<'tcx, ErrorGuaranteed> {\n-        let span = cause.span(self.tcx());\n+        let span = cause.span();\n         let msg = format!(\n             \"implementation of `{}` is not general enough\",\n             self.tcx().def_path_str(trait_def_id),"}, {"sha": "95b6c4ce1f296085a59944675847c18be9f897e5", "filename": "compiler/rustc_infer/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -18,20 +18,19 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n         trait_item_def_id: DefId,\n         requirement: &dyn fmt::Display,\n     ) -> DiagnosticBuilder<'tcx, ErrorGuaranteed> {\n-        let msg = \"impl has stricter requirements than trait\";\n-        let sp = self.tcx.sess.source_map().guess_head_span(error_span);\n+        let mut err = struct_span_err!(\n+            self.tcx.sess,\n+            error_span,\n+            E0276,\n+            \"impl has stricter requirements than trait\"\n+        );\n \n-        let mut err = struct_span_err!(self.tcx.sess, sp, E0276, \"{}\", msg);\n-\n-        if trait_item_def_id.is_local() {\n+        if let Some(span) = self.tcx.hir().span_if_local(trait_item_def_id) {\n             let item_name = self.tcx.item_name(impl_item_def_id.to_def_id());\n-            err.span_label(\n-                self.tcx.def_span(trait_item_def_id),\n-                format!(\"definition of `{}` from trait\", item_name),\n-            );\n+            err.span_label(span, format!(\"definition of `{}` from trait\", item_name));\n         }\n \n-        err.span_label(sp, format!(\"impl has extra requirement {}\", requirement));\n+        err.span_label(error_span, format!(\"impl has extra requirement {}\", requirement));\n \n         err\n     }\n@@ -48,7 +47,6 @@ pub fn report_object_safety_error<'tcx>(\n         hir::Node::Item(item) => Some(item.ident.span),\n         _ => None,\n     });\n-    let span = tcx.sess.source_map().guess_head_span(span);\n     let mut err = struct_span_err!(\n         tcx.sess,\n         span,"}, {"sha": "50e9383cacc12519dc4b6198b3f446b1901fc267", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -694,9 +694,8 @@ pub trait LintContext: Sized {\n                     }\n \n                     if let Some(span) = in_test_module {\n-                        let def_span = self.sess().source_map().guess_head_span(span);\n                         db.span_help(\n-                            span.shrink_to_lo().to(def_span),\n+                            self.sess().source_map().guess_head_span(span),\n                             \"consider adding a `#[cfg(test)]` to the containing module\",\n                         );\n                     }"}, {"sha": "d8cc7d3feb0d0df5a519e73348d60c5fce1e39e9", "filename": "compiler/rustc_middle/src/traits/mod.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -139,13 +139,8 @@ impl<'tcx> ObligationCause<'tcx> {\n         ObligationCause { span, body_id: hir::CRATE_HIR_ID, code: Default::default() }\n     }\n \n-    pub fn span(&self, tcx: TyCtxt<'tcx>) -> Span {\n+    pub fn span(&self) -> Span {\n         match *self.code() {\n-            ObligationCauseCode::CompareImplMethodObligation { .. }\n-            | ObligationCauseCode::MainFunctionType\n-            | ObligationCauseCode::StartFunctionType => {\n-                tcx.sess.source_map().guess_head_span(self.span)\n-            }\n             ObligationCauseCode::MatchExpressionArm(box MatchExpressionArmCause {\n                 arm_span,\n                 .."}, {"sha": "5b21c0466477437ad543054e5b265ea477080e59", "filename": "compiler/rustc_privacy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_privacy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_privacy%2Fsrc%2Flib.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1759,8 +1759,7 @@ impl SearchInterfaceForPrivateItemsVisitor<'_> {\n                 || self.tcx.resolutions(()).has_pub_restricted\n             {\n                 let descr = descr.to_string();\n-                let vis_span =\n-                    self.tcx.sess.source_map().guess_head_span(self.tcx.def_span(def_id));\n+                let vis_span = self.tcx.def_span(def_id);\n                 if kind == \"trait\" {\n                     self.tcx.sess.emit_err(InPublicInterfaceTraits {\n                         span,"}, {"sha": "d5e65c0b4420aa2f13ad8ab5c6dafe94ecb38389", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1435,6 +1435,8 @@ symbols! {\n         thumb2,\n         thumb_mode: \"thumb-mode\",\n         tmm_reg,\n+        to_string,\n+        to_vec,\n         todo_macro,\n         tool_attributes,\n         tool_lints,"}, {"sha": "1b7161fbb85c5365aa42aae59836b80b2edba6b7", "filename": "compiler/rustc_target/src/spec/aarch64_nintendo_switch_freestanding.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -0,0 +1,26 @@\n+use super::{LinkerFlavor, LldFlavor, PanicStrategy, RelroLevel, Target, TargetOptions};\n+\n+const LINKER_SCRIPT: &str = include_str!(\"./aarch64_nintendo_switch_freestanding_linker_script.ld\");\n+\n+/// A base target for Nintendo Switch devices using a pure LLVM toolchain.\n+pub fn target() -> Target {\n+    Target {\n+        llvm_target: \"aarch64-unknown-none\".into(),\n+        pointer_width: 64,\n+        data_layout: \"e-m:e-i8:8:32-i16:16:32-i64:64-i128:128-n32:64-S128\".into(),\n+        arch: \"aarch64\".into(),\n+        options: TargetOptions {\n+            linker_flavor: LinkerFlavor::Lld(LldFlavor::Ld),\n+            linker: Some(\"rust-lld\".into()),\n+            link_script: Some(LINKER_SCRIPT.into()),\n+            os: \"horizon\".into(),\n+            max_atomic_width: Some(128),\n+            panic_strategy: PanicStrategy::Abort,\n+            position_independent_executables: true,\n+            dynamic_linking: true,\n+            executables: true,\n+            relro_level: RelroLevel::Off,\n+            ..Default::default()\n+        },\n+    }\n+}"}, {"sha": "f3441e65937821195840203f0e1ab5731bc9cb5f", "filename": "compiler/rustc_target/src/spec/aarch64_nintendo_switch_freestanding_linker_script.ld", "status": "added", "additions": 78, "deletions": 0, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding_linker_script.ld", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding_linker_script.ld", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Faarch64_nintendo_switch_freestanding_linker_script.ld?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -0,0 +1,78 @@\n+OUTPUT_FORMAT(elf64-littleaarch64)\n+OUTPUT_ARCH(aarch64)\n+ENTRY(_start)\n+\n+PHDRS\n+{\n+  text PT_LOAD FLAGS(5);\n+  rodata PT_LOAD FLAGS(4);\n+  data PT_LOAD FLAGS(6);\n+  bss PT_LOAD FLAGS(6);\n+  dynamic PT_DYNAMIC;\n+}\n+\n+SECTIONS\n+{\n+  . = 0;\n+\n+  .text : ALIGN(0x1000) {\n+    HIDDEN(__text_start = .);\n+    KEEP(*(.text.jmp))\n+\n+    . = 0x80;\n+\n+    *(.text .text.*)\n+    *(.plt .plt.*)\n+  }\n+\n+  /* Read-only sections */\n+\n+  . = ALIGN(0x1000);\n+\n+  .module_name : { *(.module_name) } :rodata\n+\n+  .rodata : { *(.rodata .rodata.*) } :rodata\n+  .hash : { *(.hash) }\n+  .dynsym : { *(.dynsym .dynsym.*) }\n+  .dynstr : { *(.dynstr .dynstr.*) }\n+  .rela.dyn : { *(.rela.dyn) }\n+\n+  .eh_frame : {\n+    HIDDEN(__eh_frame_start = .);\n+    *(.eh_frame .eh_frame.*)\n+    HIDDEN(__eh_frame_end = .);\n+  }\n+\n+  .eh_frame_hdr : {\n+    HIDDEN(__eh_frame_hdr_start = .);\n+    *(.eh_frame_hdr .eh_frame_hdr.*)\n+    HIDDEN(__eh_frame_hdr_end = .);\n+  }\n+\n+  /* Read-write sections */\n+\n+   . = ALIGN(0x1000);\n+\n+  .data : {\n+    *(.data .data.*)\n+    *(.got .got.*)\n+    *(.got.plt .got.plt.*)\n+  } :data\n+\n+  .dynamic : {\n+    HIDDEN(__dynamic_start = .);\n+    *(.dynamic)\n+  }\n+\n+  /* BSS section */\n+\n+  . = ALIGN(0x1000);\n+\n+  .bss : {\n+    HIDDEN(__bss_start = .);\n+    *(.bss .bss.*)\n+    *(COMMON)\n+    . = ALIGN(8);\n+    HIDDEN(__bss_end = .);\n+  } :bss\n+}"}, {"sha": "1a6bb4a2eaf3432c1d6cc88676aa93dfd6646504", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1035,6 +1035,8 @@ supported_targets! {\n \n     (\"armv6k-nintendo-3ds\", armv6k_nintendo_3ds),\n \n+    (\"aarch64-nintendo-switch-freestanding\", aarch64_nintendo_switch_freestanding),\n+\n     (\"armv7-unknown-linux-uclibceabi\", armv7_unknown_linux_uclibceabi),\n     (\"armv7-unknown-linux-uclibceabihf\", armv7_unknown_linux_uclibceabihf),\n "}, {"sha": "39fce3cf76935a31315c8d5f55382dd42a700337", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -823,10 +823,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n \n                     ty::PredicateKind::ClosureKind(closure_def_id, closure_substs, kind) => {\n                         let found_kind = self.closure_kind(closure_substs).unwrap();\n-                        let closure_span =\n-                            self.tcx.sess.source_map().guess_head_span(\n-                                self.tcx.hir().span_if_local(closure_def_id).unwrap(),\n-                            );\n+                        let closure_span = self.tcx.def_span(closure_def_id);\n                         let mut err = struct_span_err!(\n                             self.tcx.sess,\n                             closure_span,\n@@ -951,9 +948,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     _ => None,\n                 };\n \n-                let found_span = found_did\n-                    .and_then(|did| self.tcx.hir().span_if_local(did))\n-                    .map(|sp| self.tcx.sess.source_map().guess_head_span(sp)); // the sp could be an fn def\n+                let found_span = found_did.and_then(|did| self.tcx.hir().span_if_local(did));\n \n                 if self.reported_closure_mismatch.borrow().contains(&(span, found_span)) {\n                     // We check closures twice, with obligations flowing in different directions,\n@@ -1089,7 +1084,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                 kind: hir::ExprKind::Closure(&hir::Closure { body, fn_decl_span, .. }),\n                 ..\n             }) => (\n-                sm.guess_head_span(fn_decl_span),\n+                fn_decl_span,\n                 hir.body(body)\n                     .params\n                     .iter()"}, {"sha": "57d5e5436a691d1f1e12b675c1e09450014776e5", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1543,7 +1543,6 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n             ty::Generator(..) => \"generator\",\n             _ => \"function\",\n         };\n-        let span = self.tcx.sess.source_map().guess_head_span(span);\n         let mut err = struct_span_err!(\n             self.tcx.sess,\n             span,"}, {"sha": "81f5dcc45b93eab49dbbfba27c747d1b5bae2d04", "filename": "compiler/rustc_trait_selection/src/traits/fulfill.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ffulfill.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ffulfill.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ffulfill.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -603,7 +603,7 @@ impl<'a, 'b, 'tcx> ObligationProcessor for FulfillProcessor<'a, 'b, 'tcx> {\n                         ),\n                         (Err(ErrorHandled::Linted), _) | (_, Err(ErrorHandled::Linted)) => {\n                             span_bug!(\n-                                obligation.cause.span(self.selcx.tcx()),\n+                                obligation.cause.span(),\n                                 \"ConstEquate: const_eval_resolve returned an unexpected error\"\n                             )\n                         }"}, {"sha": "32669e23db96b7674b220146cd3434bbd3005b20", "filename": "compiler/rustc_trait_selection/src/traits/query/evaluate_obligation.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fquery%2Fevaluate_obligation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fquery%2Fevaluate_obligation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fquery%2Fevaluate_obligation.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -84,7 +84,7 @@ impl<'cx, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'cx, 'tcx> {\n         // Run canonical query. If overflow occurs, rerun from scratch but this time\n         // in standard trait query mode so that overflow is handled appropriately\n         // within `SelectionContext`.\n-        self.tcx.at(obligation.cause.span(self.tcx)).evaluate_obligation(c_pred)\n+        self.tcx.at(obligation.cause.span()).evaluate_obligation(c_pred)\n     }\n \n     // Helper function that canonicalizes and runs the query. If an"}, {"sha": "fa2d2c751d929660c52526b21ebc960a176b8b07", "filename": "compiler/rustc_trait_selection/src/traits/select/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -742,7 +742,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                         | (_, Err(ErrorHandled::Reported(_))) => Ok(EvaluatedToErr),\n                         (Err(ErrorHandled::Linted), _) | (_, Err(ErrorHandled::Linted)) => {\n                             span_bug!(\n-                                obligation.cause.span(self.tcx()),\n+                                obligation.cause.span(),\n                                 \"ConstEquate: const_eval_resolve returned an unexpected error\"\n                             )\n                         }"}, {"sha": "c3205aeb07477b395358b655545f986db8378121", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1958,11 +1958,8 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                         );\n                     }\n \n-                    if adt_def.did().is_local() {\n-                        err.span_label(\n-                            tcx.def_span(adt_def.did()),\n-                            format!(\"variant `{assoc_ident}` not found for this enum\"),\n-                        );\n+                    if let Some(sp) = tcx.hir().span_if_local(adt_def.did()) {\n+                        err.span_label(sp, format!(\"variant `{}` not found here\", assoc_ident));\n                     }\n \n                     err.emit()"}, {"sha": "7795e65132f5094cbd9d76e240849d9f3924f1da", "filename": "compiler/rustc_typeck/src/check/_match.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2F_match.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,6 +1,6 @@\n use crate::check::coercion::{AsCoercionSite, CoerceMany};\n use crate::check::{Diverges, Expectation, FnCtxt, Needs};\n-use rustc_errors::{Applicability, Diagnostic, MultiSpan};\n+use rustc_errors::{Applicability, MultiSpan};\n use rustc_hir::{self as hir, ExprKind};\n use rustc_infer::infer::type_variable::{TypeVariableOrigin, TypeVariableOriginKind};\n use rustc_infer::traits::Obligation;\n@@ -127,7 +127,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 &cause,\n                 Some(&arm.body),\n                 arm_ty,\n-                Some(&mut |err: &mut Diagnostic| {\n+                Some(&mut |err| {\n                     let Some(ret) = self.ret_type_span else {\n                         return;\n                     };"}, {"sha": "bd2e89a4dc541dcb9821880129717cd2e713c505", "filename": "compiler/rustc_typeck/src/check/check.rs", "status": "modified", "additions": 16, "deletions": 18, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -375,8 +375,9 @@ fn check_alloc_error_fn(\n     }\n }\n \n-fn check_struct(tcx: TyCtxt<'_>, def_id: LocalDefId, span: Span) {\n+fn check_struct(tcx: TyCtxt<'_>, def_id: LocalDefId) {\n     let def = tcx.adt_def(def_id);\n+    let span = tcx.def_span(def_id);\n     def.destructor(tcx); // force the destructor to be evaluated\n     check_representable(tcx, span, def_id);\n \n@@ -388,8 +389,9 @@ fn check_struct(tcx: TyCtxt<'_>, def_id: LocalDefId, span: Span) {\n     check_packed(tcx, span, def);\n }\n \n-fn check_union(tcx: TyCtxt<'_>, def_id: LocalDefId, span: Span) {\n+fn check_union(tcx: TyCtxt<'_>, def_id: LocalDefId) {\n     let def = tcx.adt_def(def_id);\n+    let span = tcx.def_span(def_id);\n     def.destructor(tcx); // force the destructor to be evaluated\n     check_representable(tcx, span, def_id);\n     check_transparent(tcx, span, def);\n@@ -471,13 +473,14 @@ fn check_union_fields(tcx: TyCtxt<'_>, span: Span, item_def_id: LocalDefId) -> b\n }\n \n /// Check that a `static` is inhabited.\n-fn check_static_inhabited<'tcx>(tcx: TyCtxt<'tcx>, def_id: LocalDefId, span: Span) {\n+fn check_static_inhabited<'tcx>(tcx: TyCtxt<'tcx>, def_id: LocalDefId) {\n     // Make sure statics are inhabited.\n     // Other parts of the compiler assume that there are no uninhabited places. In principle it\n     // would be enough to check this for `extern` statics, as statics with an initializer will\n     // have UB during initialization if they are uninhabited, but there also seems to be no good\n     // reason to allow any statics to be uninhabited.\n     let ty = tcx.type_of(def_id);\n+    let span = tcx.def_span(def_id);\n     let layout = match tcx.layout_of(ParamEnv::reveal_all().and(ty)) {\n         Ok(l) => l,\n         // Foreign statics that overflow their allowed size should emit an error\n@@ -524,9 +527,9 @@ pub(super) fn check_opaque<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     def_id: LocalDefId,\n     substs: SubstsRef<'tcx>,\n-    span: Span,\n     origin: &hir::OpaqueTyOrigin,\n ) {\n+    let span = tcx.def_span(def_id);\n     check_opaque_for_inheriting_lifetimes(tcx, def_id, span);\n     if tcx.type_of(def_id).references_error() {\n         return;\n@@ -785,8 +788,8 @@ fn check_item_type<'tcx>(tcx: TyCtxt<'tcx>, id: hir::ItemId) {\n     match tcx.def_kind(id.def_id) {\n         DefKind::Static(..) => {\n             tcx.ensure().typeck(id.def_id);\n-            maybe_check_static_with_link_section(tcx, id.def_id, tcx.def_span(id.def_id));\n-            check_static_inhabited(tcx, id.def_id, tcx.def_span(id.def_id));\n+            maybe_check_static_with_link_section(tcx, id.def_id);\n+            check_static_inhabited(tcx, id.def_id);\n         }\n         DefKind::Const => {\n             tcx.ensure().typeck(id.def_id);\n@@ -796,7 +799,7 @@ fn check_item_type<'tcx>(tcx: TyCtxt<'tcx>, id: hir::ItemId) {\n             let hir::ItemKind::Enum(ref enum_definition, _) = item.kind else {\n                 return;\n             };\n-            check_enum(tcx, item.span, &enum_definition.variants, item.def_id);\n+            check_enum(tcx, &enum_definition.variants, item.def_id);\n         }\n         DefKind::Fn => {} // entirely within check_item_body\n         DefKind::Impl => {\n@@ -847,10 +850,10 @@ fn check_item_type<'tcx>(tcx: TyCtxt<'tcx>, id: hir::ItemId) {\n             }\n         }\n         DefKind::Struct => {\n-            check_struct(tcx, id.def_id, tcx.def_span(id.def_id));\n+            check_struct(tcx, id.def_id);\n         }\n         DefKind::Union => {\n-            check_union(tcx, id.def_id, tcx.def_span(id.def_id));\n+            check_union(tcx, id.def_id);\n         }\n         DefKind::OpaqueTy => {\n             let item = tcx.hir().item(id);\n@@ -863,7 +866,7 @@ fn check_item_type<'tcx>(tcx: TyCtxt<'tcx>, id: hir::ItemId) {\n             // See https://github.com/rust-lang/rust/issues/75100\n             if !tcx.sess.opts.actually_rustdoc {\n                 let substs = InternalSubsts::identity_for_item(tcx, item.def_id.to_def_id());\n-                check_opaque(tcx, item.def_id, substs, item.span, &origin);\n+                check_opaque(tcx, item.def_id, substs, &origin);\n             }\n         }\n         DefKind::TyAlias => {\n@@ -927,7 +930,7 @@ fn check_item_type<'tcx>(tcx: TyCtxt<'tcx>, id: hir::ItemId) {\n                             require_c_abi_if_c_variadic(tcx, fn_decl, abi, item.span);\n                         }\n                         hir::ForeignItemKind::Static(..) => {\n-                            check_static_inhabited(tcx, def_id, item.span);\n+                            check_static_inhabited(tcx, def_id);\n                         }\n                         _ => {}\n                     }\n@@ -1328,7 +1331,6 @@ pub(super) fn check_transparent<'tcx>(tcx: TyCtxt<'tcx>, sp: Span, adt: ty::AdtD\n     if !adt.repr().transparent() {\n         return;\n     }\n-    let sp = tcx.sess.source_map().guess_head_span(sp);\n \n     if adt.is_union() && !tcx.features().transparent_unions {\n         feature_err(\n@@ -1442,13 +1444,9 @@ pub(super) fn check_transparent<'tcx>(tcx: TyCtxt<'tcx>, sp: Span, adt: ty::AdtD\n }\n \n #[allow(trivial_numeric_casts)]\n-fn check_enum<'tcx>(\n-    tcx: TyCtxt<'tcx>,\n-    sp: Span,\n-    vs: &'tcx [hir::Variant<'tcx>],\n-    def_id: LocalDefId,\n-) {\n+fn check_enum<'tcx>(tcx: TyCtxt<'tcx>, vs: &'tcx [hir::Variant<'tcx>], def_id: LocalDefId) {\n     let def = tcx.adt_def(def_id);\n+    let sp = tcx.def_span(def_id);\n     def.destructor(tcx); // force the destructor to be evaluated\n \n     if vs.is_empty() {"}, {"sha": "3a31df32298d76a753fce6a811c74fce2572e304", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 19, "deletions": 24, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -171,14 +171,7 @@ fn compare_predicate_entailment<'tcx>(\n     let trait_m_predicates = tcx.predicates_of(trait_m.def_id);\n \n     // Check region bounds.\n-    check_region_bounds_on_impl_item(\n-        tcx,\n-        impl_m_span,\n-        impl_m,\n-        trait_m,\n-        &trait_m_generics,\n-        &impl_m_generics,\n-    )?;\n+    check_region_bounds_on_impl_item(tcx, impl_m, trait_m, &trait_m_generics, &impl_m_generics)?;\n \n     // Create obligations for each predicate declared by the impl\n     // definition in the context of the trait's parameter\n@@ -298,7 +291,7 @@ fn compare_predicate_entailment<'tcx>(\n \n             let mut diag = struct_span_err!(\n                 tcx.sess,\n-                cause.span(tcx),\n+                cause.span(),\n                 E0053,\n                 \"method `{}` has an incompatible type for trait\",\n                 trait_m.name\n@@ -410,7 +403,6 @@ fn compare_predicate_entailment<'tcx>(\n \n fn check_region_bounds_on_impl_item<'tcx>(\n     tcx: TyCtxt<'tcx>,\n-    span: Span,\n     impl_m: &ty::AssocItem,\n     trait_m: &ty::AssocItem,\n     trait_generics: &ty::Generics,\n@@ -436,21 +428,25 @@ fn check_region_bounds_on_impl_item<'tcx>(\n     // are zero. Since I don't quite know how to phrase things at\n     // the moment, give a kind of vague error message.\n     if trait_params != impl_params {\n-        let item_kind = assoc_item_kind_str(impl_m);\n-        let def_span = tcx.sess.source_map().guess_head_span(span);\n-        let span = impl_m\n-            .def_id\n-            .as_local()\n-            .and_then(|did| tcx.hir().get_generics(did))\n-            .map_or(def_span, |g| g.span);\n-        let generics_span = trait_m.def_id.as_local().map(|did| {\n-            let def_sp = tcx.def_span(did);\n-            tcx.hir().get_generics(did).map_or(def_sp, |g| g.span)\n-        });\n+        let span = tcx\n+            .hir()\n+            .get_generics(impl_m.def_id.expect_local())\n+            .expect(\"expected impl item to have generics or else we can't compare them\")\n+            .span;\n+        let generics_span = if let Some(local_def_id) = trait_m.def_id.as_local() {\n+            Some(\n+                tcx.hir()\n+                    .get_generics(local_def_id)\n+                    .expect(\"expected trait item to have generics or else we can't compare them\")\n+                    .span,\n+            )\n+        } else {\n+            None\n+        };\n \n         let reported = tcx.sess.emit_err(LifetimesOrBoundsMismatchOnTrait {\n             span,\n-            item_kind,\n+            item_kind: assoc_item_kind_str(impl_m),\n             ident: impl_m.ident(tcx),\n             generics_span,\n         });\n@@ -490,7 +486,7 @@ fn extract_spans_for_error_reporting<'a, 'tcx>(\n         TypeError::ArgumentSorts(ExpectedFound { .. }, i) => {\n             (impl_args.nth(i).unwrap(), trait_args.and_then(|mut args| args.nth(i)))\n         }\n-        _ => (cause.span(tcx), tcx.hir().span_if_local(trait_m.def_id)),\n+        _ => (cause.span(), tcx.hir().span_if_local(trait_m.def_id)),\n     }\n }\n \n@@ -1199,7 +1195,6 @@ fn compare_type_predicate_entailment<'tcx>(\n \n     check_region_bounds_on_impl_item(\n         tcx,\n-        impl_ty_span,\n         impl_ty,\n         trait_ty,\n         &trait_ty_generics,"}, {"sha": "80feac184125c6afe67844723a220b2f1687727a", "filename": "compiler/rustc_typeck/src/check/fn_ctxt/suggestions.rs", "status": "modified", "additions": 50, "deletions": 51, "changes": 101, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Ffn_ctxt%2Fsuggestions.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -18,8 +18,6 @@ use rustc_span::symbol::sym;\n use rustc_span::Span;\n use rustc_trait_selection::traits::query::evaluate_obligation::InferCtxtExt;\n \n-use std::iter;\n-\n impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     pub(in super::super) fn suggest_semicolon_at_end(&self, span: Span, err: &mut Diagnostic) {\n         err.span_suggestion_short(\n@@ -183,59 +181,60 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         } else if let (ty::FnDef(def_id, ..), true) =\n             (&found.kind(), self.suggest_fn_call(err, expr, expected, found))\n         {\n-            if def_id.is_local() {\n-                err.span_label(self.tcx.def_span(def_id), &format!(\"{} defined here\", found));\n+            if let Some(sp) = self.tcx.hir().span_if_local(*def_id) {\n+                err.span_label(sp, format!(\"{found} defined here\"));\n             }\n         } else if !self.check_for_cast(err, expr, found, expected, expected_ty_expr) {\n-            let is_struct_pat_shorthand_field =\n-                self.maybe_get_struct_pattern_shorthand_field(expr).is_some();\n             let methods = self.get_conversion_methods(expr.span, expected, found, expr.hir_id);\n             if !methods.is_empty() {\n-                if let Ok(expr_text) = self.sess().source_map().span_to_snippet(expr.span) {\n-                    let mut suggestions = iter::zip(iter::repeat(&expr_text), &methods)\n-                        .filter_map(|(receiver, method)| {\n-                            let method_call = format!(\".{}()\", method.name);\n-                            if receiver.ends_with(&method_call) {\n-                                None // do not suggest code that is already there (#53348)\n-                            } else {\n-                                let method_call_list = [\".to_vec()\", \".to_string()\"];\n-                                let mut sugg = if receiver.ends_with(\".clone()\")\n-                                    && method_call_list.contains(&method_call.as_str())\n-                                {\n-                                    let max_len = receiver.rfind('.').unwrap();\n-                                    vec![(\n-                                        expr.span,\n-                                        format!(\"{}{}\", &receiver[..max_len], method_call),\n-                                    )]\n-                                } else {\n-                                    if expr.precedence().order()\n-                                        < ExprPrecedence::MethodCall.order()\n-                                    {\n-                                        vec![\n-                                            (expr.span.shrink_to_lo(), \"(\".to_string()),\n-                                            (expr.span.shrink_to_hi(), format!(\"){}\", method_call)),\n-                                        ]\n-                                    } else {\n-                                        vec![(expr.span.shrink_to_hi(), method_call)]\n-                                    }\n-                                };\n-                                if is_struct_pat_shorthand_field {\n-                                    sugg.insert(\n-                                        0,\n-                                        (expr.span.shrink_to_lo(), format!(\"{}: \", receiver)),\n-                                    );\n-                                }\n-                                Some(sugg)\n-                            }\n-                        })\n-                        .peekable();\n-                    if suggestions.peek().is_some() {\n-                        err.multipart_suggestions(\n-                            \"try using a conversion method\",\n-                            suggestions,\n-                            Applicability::MaybeIncorrect,\n-                        );\n-                    }\n+                let mut suggestions = methods.iter()\n+                    .filter_map(|conversion_method| {\n+                        let receiver_method_ident = expr.method_ident();\n+                        if let Some(method_ident) = receiver_method_ident\n+                            && method_ident.name == conversion_method.name\n+                        {\n+                            return None // do not suggest code that is already there (#53348)\n+                        }\n+\n+                        let method_call_list = [sym::to_vec, sym::to_string];\n+                        let mut sugg = if let ExprKind::MethodCall(receiver_method, ..) = expr.kind\n+                            && receiver_method.ident.name == sym::clone\n+                            && method_call_list.contains(&conversion_method.name)\n+                            // If receiver is `.clone()` and found type has one of those methods,\n+                            // we guess that the user wants to convert from a slice type (`&[]` or `&str`)\n+                            // to an owned type (`Vec` or `String`).  These conversions clone internally,\n+                            // so we remove the user's `clone` call.\n+                        {\n+                            vec![(\n+                                receiver_method.ident.span,\n+                                conversion_method.name.to_string()\n+                            )]\n+                        } else if expr.precedence().order()\n+                            < ExprPrecedence::MethodCall.order()\n+                        {\n+                            vec![\n+                                (expr.span.shrink_to_lo(), \"(\".to_string()),\n+                                (expr.span.shrink_to_hi(), format!(\").{}()\", conversion_method.name)),\n+                            ]\n+                        } else {\n+                            vec![(expr.span.shrink_to_hi(), format!(\".{}()\", conversion_method.name))]\n+                        };\n+                        let struct_pat_shorthand_field = self.maybe_get_struct_pattern_shorthand_field(expr);\n+                        if let Some(name) = struct_pat_shorthand_field {\n+                            sugg.insert(\n+                                0,\n+                                (expr.span.shrink_to_lo(), format!(\"{}: \", name)),\n+                            );\n+                        }\n+                        Some(sugg)\n+                    })\n+                    .peekable();\n+                if suggestions.peek().is_some() {\n+                    err.multipart_suggestions(\n+                        \"try using a conversion method\",\n+                        suggestions,\n+                        Applicability::MaybeIncorrect,\n+                    );\n                 }\n             } else if let ty::Adt(found_adt, found_substs) = found.kind()\n                 && self.tcx.is_diagnostic_item(sym::Option, found_adt.did())"}, {"sha": "d6160266dd7d9f4fbff298dfec38195a6f45fe80", "filename": "compiler/rustc_typeck/src/check/mod.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -534,7 +534,7 @@ fn fn_maybe_err(tcx: TyCtxt<'_>, sp: Span, abi: Abi) {\n     }\n }\n \n-fn maybe_check_static_with_link_section(tcx: TyCtxt<'_>, id: LocalDefId, span: Span) {\n+fn maybe_check_static_with_link_section(tcx: TyCtxt<'_>, id: LocalDefId) {\n     // Only restricted on wasm target for now\n     if !tcx.sess.target.is_like_wasm {\n         return;\n@@ -560,7 +560,7 @@ fn maybe_check_static_with_link_section(tcx: TyCtxt<'_>, id: LocalDefId, span: S\n         let msg = \"statics with a custom `#[link_section]` must be a \\\n                         simple list of bytes on the wasm target with no \\\n                         extra levels of indirection such as references\";\n-        tcx.sess.span_err(span, msg);\n+        tcx.sess.span_err(tcx.def_span(id), msg);\n     }\n }\n \n@@ -621,9 +621,8 @@ fn missing_items_err(\n     // adding the associated item at the end of its body.\n     let sugg_sp = full_impl_span.with_lo(hi).with_hi(hi);\n     // Obtain the level of indentation ending in `sugg_sp`.\n-    let indentation = tcx.sess.source_map().span_to_margin(sugg_sp).unwrap_or(0);\n-    // Make the whitespace that will make the suggestion have the right indentation.\n-    let padding: String = \" \".repeat(indentation);\n+    let padding =\n+        tcx.sess.source_map().indentation_before(sugg_sp).unwrap_or_else(|| String::new());\n \n     for trait_item in missing_items {\n         let snippet = suggestion_signature(trait_item, tcx);"}, {"sha": "e205eba44571f128a66d00a721d288efb3e77569", "filename": "compiler/rustc_typeck/src/check/wfcheck.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1838,7 +1838,7 @@ fn check_false_global_bounds(fcx: &FnCtxt<'_, '_>, mut span: Span, id: hir::HirI\n             if let Some(hir::Generics { predicates, .. }) =\n                 hir_node.and_then(|node| node.generics())\n             {\n-                let obligation_span = obligation.cause.span(fcx.tcx);\n+                let obligation_span = obligation.cause.span();\n \n                 span = predicates\n                     .iter()"}, {"sha": "03e076bf5ec894ab5c2c7984bb50721b279f7786", "filename": "compiler/rustc_typeck/src/coherence/inherent_impls_overlap.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Finherent_impls_overlap.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -76,17 +76,17 @@ impl<'tcx> InherentOverlapChecker<'tcx> {\n                 let name = item1.ident(self.tcx).normalize_to_macros_2_0();\n                 let mut err = struct_span_err!(\n                     self.tcx.sess,\n-                    self.tcx.span_of_impl(item1.def_id).unwrap(),\n+                    self.tcx.def_span(item1.def_id),\n                     E0592,\n                     \"duplicate definitions with name `{}`\",\n                     name\n                 );\n                 err.span_label(\n-                    self.tcx.span_of_impl(item1.def_id).unwrap(),\n+                    self.tcx.def_span(item1.def_id),\n                     format!(\"duplicate definitions for `{}`\", name),\n                 );\n                 err.span_label(\n-                    self.tcx.span_of_impl(item2.def_id).unwrap(),\n+                    self.tcx.def_span(item2.def_id),\n                     format!(\"other definition for `{}`\", name),\n                 );\n "}, {"sha": "ea0f78e2a6be9da2c9461497e2bafb53ca18b6ec", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -411,7 +411,7 @@ pub struct Target {\n impl Target {\n     pub fn from_triple(triple: &str) -> Self {\n         let mut target: Self = Default::default();\n-        if triple.contains(\"-none\") || triple.contains(\"nvptx\") {\n+        if triple.contains(\"-none\") || triple.contains(\"nvptx\") || triple.contains(\"switch\") {\n             target.no_std = true;\n         }\n         target"}, {"sha": "1895e2901489e187aa39fa6cf8ddae5711afd78b", "filename": "src/bootstrap/util.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Fbootstrap%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Fbootstrap%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Futil.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -298,7 +298,8 @@ pub fn use_host_linker(target: TargetSelection) -> bool {\n         || target.contains(\"nvptx\")\n         || target.contains(\"fortanix\")\n         || target.contains(\"fuchsia\")\n-        || target.contains(\"bpf\"))\n+        || target.contains(\"bpf\")\n+        || target.contains(\"switch\"))\n }\n \n pub fn is_valid_test_suite_arg<'a, P: AsRef<Path>>("}, {"sha": "f6348b2bddc88c7c0af94625f44fa569feec8e1f", "filename": "src/doc/rustc/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -17,6 +17,7 @@\n     - [Template for Target-specific Documentation](platform-support/TEMPLATE.md)\n     - [aarch64-apple-ios-sim](platform-support/aarch64-apple-ios-sim.md)\n     - [\\*-apple-watchos\\*](platform-support/apple-watchos.md)\n+    - [aarch64-nintendo-switch-freestanding](platform-support/aarch64-nintendo-switch-freestanding.md)\n     - [armv6k-nintendo-3ds](platform-support/armv6k-nintendo-3ds.md)\n     - [armv7-unknown-linux-uclibceabi](platform-support/armv7-unknown-linux-uclibceabi.md)\n     - [armv7-unknown-linux-uclibceabihf](platform-support/armv7-unknown-linux-uclibceabihf.md)"}, {"sha": "7a03238f13dff013976fb87b8477f4ff17943a21", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -209,6 +209,7 @@ target | std | host | notes\n `aarch64-apple-tvos` | * |  | ARM64 tvOS\n [`aarch64-apple-watchos-sim`](platform-support/apple-watchos.md) | \u2713 |  | ARM64 Apple WatchOS Simulator\n [`aarch64-kmc-solid_asp3`](platform-support/kmc-solid.md) | \u2713 |  | ARM64 SOLID with TOPPERS/ASP3\n+[`aarch64-nintendo-switch-freestanding`](platform-support/aarch64-nintendo-switch-freestanding.md) | * |  | ARM64 Nintendo Switch, Horizon\n [`aarch64-pc-windows-gnullvm`](platform-support/pc-windows-gnullvm.md) | \u2713 | \u2713 |\n `aarch64-unknown-freebsd` | \u2713 | \u2713 | ARM64 FreeBSD\n `aarch64-unknown-hermit` | \u2713 |  | ARM64 HermitCore"}, {"sha": "308e1fe2f92a04e3ed1cb1b1a259056a8702485c", "filename": "src/doc/rustc/src/platform-support/aarch64-nintendo-switch-freestanding.md", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Faarch64-nintendo-switch-freestanding.md", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Faarch64-nintendo-switch-freestanding.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Faarch64-nintendo-switch-freestanding.md?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -0,0 +1,49 @@\n+# aarch64-nintendo-switch-freestanding\n+\n+**Tier: 3**\n+\n+Nintendo Switch with pure-Rust toolchain.\n+\n+## Designated Developers\n+\n+* [@leo60228](https://github.com/leo60228)\n+* [@jam1garner](https://github.com/jam1garner)\n+\n+## Requirements\n+\n+This target is cross-compiled.\n+It has no special requirements for the host.\n+\n+## Building\n+\n+The target can be built by enabling it for a `rustc` build:\n+\n+```toml\n+[build]\n+build-stage = 1\n+target = [\"aarch64-nintendo-switch-freestanding\"]\n+```\n+\n+## Cross-compilation\n+\n+This target can be cross-compiled from any host.\n+\n+## Testing\n+\n+Currently there is no support to run the rustc test suite for this target.\n+\n+## Building Rust programs\n+\n+If `rustc` has support for that target and the library artifacts are available,\n+then Rust programs can be built for that target:\n+\n+```text\n+rustc --target aarch64-nintendo-switch-freestanding your-code.rs\n+```\n+\n+To generate binaries in the NRO format that can be easily run on-device, you\n+can use [cargo-nx](https://github.com/aarch64-switch-rs/cargo-nx):\n+\n+```text\n+cargo nx --triple=aarch64-nintendo-switch-freestanding\n+```"}, {"sha": "2aef978a072d289bc91a02fd12e87cb512f1f93d", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 14, "deletions": 17, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -479,23 +479,20 @@ function loadCss(cssFileName) {\n         }\n \n         if (sidebar) {\n-            const isModule = hasClass(document.body, \"mod\");\n-            if (!isModule) {\n-                block(\"primitive\", \"primitives\", \"Primitive Types\");\n-                block(\"mod\", \"modules\", \"Modules\");\n-                block(\"macro\", \"macros\", \"Macros\");\n-                block(\"struct\", \"structs\", \"Structs\");\n-                block(\"enum\", \"enums\", \"Enums\");\n-                block(\"union\", \"unions\", \"Unions\");\n-                block(\"constant\", \"constants\", \"Constants\");\n-                block(\"static\", \"static\", \"Statics\");\n-                block(\"trait\", \"traits\", \"Traits\");\n-                block(\"fn\", \"functions\", \"Functions\");\n-                block(\"type\", \"types\", \"Type Definitions\");\n-                block(\"foreigntype\", \"foreign-types\", \"Foreign Types\");\n-                block(\"keyword\", \"keywords\", \"Keywords\");\n-                block(\"traitalias\", \"trait-aliases\", \"Trait Aliases\");\n-            }\n+            block(\"primitive\", \"primitives\", \"Primitive Types\");\n+            block(\"mod\", \"modules\", \"Modules\");\n+            block(\"macro\", \"macros\", \"Macros\");\n+            block(\"struct\", \"structs\", \"Structs\");\n+            block(\"enum\", \"enums\", \"Enums\");\n+            block(\"union\", \"unions\", \"Unions\");\n+            block(\"constant\", \"constants\", \"Constants\");\n+            block(\"static\", \"static\", \"Statics\");\n+            block(\"trait\", \"traits\", \"Traits\");\n+            block(\"fn\", \"functions\", \"Functions\");\n+            block(\"type\", \"types\", \"Type Definitions\");\n+            block(\"foreigntype\", \"foreign-types\", \"Foreign Types\");\n+            block(\"keyword\", \"keywords\", \"Keywords\");\n+            block(\"traitalias\", \"trait-aliases\", \"Trait Aliases\");\n         }\n     }\n "}, {"sha": "9a551b68279d63ebf0c3820c5a979bf5ac20c476", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -39,7 +39,7 @@\n     {%- else if page.css_class == \"source\" -%}\n     <script defer src=\"{{static_root_path|safe}}source-script{{page.resource_suffix}}.js\"></script> {#- -#}\n     <script defer src=\"{{page.root_path|safe}}source-files{{page.resource_suffix}}.js\"></script> {#- -#}\n-    {%- else -%}\n+    {%- else if !page.css_class.contains(\"mod\") -%}\n     <script defer src=\"sidebar-items{{page.resource_suffix}}.js\"></script> {#- -#}\n     {%- endif -%}\n     <script defer src=\"{{static_root_path|safe}}main{{page.resource_suffix}}.js\"></script> {#- -#}"}, {"sha": "803bb06fcc2185486687d2b671877705f4dc7f15", "filename": "src/test/ui/enum-discriminant/arbitrary_enum_discriminant-no-repr.stderr", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,13 +1,8 @@\n error[E0732]: `#[repr(inttype)]` must be specified\n   --> $DIR/arbitrary_enum_discriminant-no-repr.rs:4:1\n    |\n-LL | / enum Enum {\n-LL | |\n-LL | |   Unit = 1,\n-LL | |   Tuple() = 2,\n-LL | |   Struct{} = 3,\n-LL | | }\n-   | |_^\n+LL | enum Enum {\n+   | ^^^^^^^^^\n \n error: aborting due to previous error\n "}, {"sha": "eacea86d67e5523cd3c2e93b7caf1b0ed28d7d69", "filename": "src/test/ui/enum/enum-discrim-autosizing.stderr", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fenum%2Fenum-discrim-autosizing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fenum%2Fenum-discrim-autosizing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum%2Fenum-discrim-autosizing.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,16 +1,14 @@\n error[E0081]: discriminant value `0` assigned more than once\n   --> $DIR/enum-discrim-autosizing.rs:6:1\n    |\n-LL | / enum Eu64 {\n-LL | |\n-LL | |     Au64 = 0,\n-   | |            - first assignment of `0`\n-LL | |\n-LL | |     Bu64 = 0x8000_0000_0000_0000\n-   | |            --------------------- second assignment of `0` (overflowed from `9223372036854775808`)\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum Eu64 {\n+   | ^^^^^^^^^\n+LL |\n+LL |     Au64 = 0,\n+   |            - first assignment of `0`\n+LL |\n+LL |     Bu64 = 0x8000_0000_0000_0000\n+   |            --------------------- second assignment of `0` (overflowed from `9223372036854775808`)\n \n error: aborting due to previous error\n "}, {"sha": "ff6113646bb8afbf211328a8d056ca4de7f4aa71", "filename": "src/test/ui/error-codes/E0081.stderr", "status": "modified", "additions": 27, "deletions": 34, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0081.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0081.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0081.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,48 +1,41 @@\n error[E0081]: discriminant value `3` assigned more than once\n   --> $DIR/E0081.rs:1:1\n    |\n-LL | / enum Enum {\n-LL | |\n-LL | |     P = 3,\n-   | |         - first assignment of `3`\n-LL | |\n-LL | |     X = 3,\n-   | |         - second assignment of `3`\n-LL | |\n-LL | |     Y = 5\n-LL | | }\n-   | |_^\n+LL | enum Enum {\n+   | ^^^^^^^^^\n+LL |\n+LL |     P = 3,\n+   |         - first assignment of `3`\n+LL |\n+LL |     X = 3,\n+   |         - second assignment of `3`\n \n error[E0081]: discriminant value `1` assigned more than once\n   --> $DIR/E0081.rs:11:1\n    |\n-LL | / enum EnumOverflowRepr {\n-LL | |\n-LL | |     P = 257,\n-   | |         --- first assignment of `1` (overflowed from `257`)\n-LL | |\n-LL | |     X = 513,\n-   | |         --- second assignment of `1` (overflowed from `513`)\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum EnumOverflowRepr {\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL |     P = 257,\n+   |         --- first assignment of `1` (overflowed from `257`)\n+LL |\n+LL |     X = 513,\n+   |         --- second assignment of `1` (overflowed from `513`)\n \n error[E0081]: discriminant value `-1` assigned more than once\n   --> $DIR/E0081.rs:20:1\n    |\n-LL | / enum NegDisEnum {\n-LL | |\n-LL | |     First = -1,\n-   | |             -- first assignment of `-1`\n-LL | |\n-LL | |     Second = -2,\n-   | |     ----------- assigned discriminant for `Last` was incremented from this discriminant\n-LL | |\n-LL | |     Last,\n-   | |     ---- second assignment of `-1`\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum NegDisEnum {\n+   | ^^^^^^^^^^^^^^^\n+LL |\n+LL |     First = -1,\n+   |             -- first assignment of `-1`\n+LL |\n+LL |     Second = -2,\n+   |     ----------- assigned discriminant for `Last` was incremented from this discriminant\n+LL |\n+LL |     Last,\n+   |     ---- second assignment of `-1`\n \n error: aborting due to 3 previous errors\n "}, {"sha": "e1bda22b8d19a9dde582623b792fcf1b3b7bbe49", "filename": "src/test/ui/error-codes/E0084.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0084.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0084.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0084.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -4,7 +4,7 @@ error[E0084]: unsupported representation for zero-variant enum\n LL | #[repr(i32)]\n    | ^^^^^^^^^^^^\n LL | enum Foo {}\n-   | ----------- zero-variant enum\n+   | -------- zero-variant enum\n \n error: aborting due to previous error\n "}, {"sha": "8d423484528a189e3f3e0a202f7f716e82776071", "filename": "src/test/ui/error-codes/E0658.stderr", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0658.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ferror-codes%2FE0658.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0658.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,10 +1,8 @@\n error[E0658]: repr with 128-bit type is unstable\n   --> $DIR/E0658.rs:2:1\n    |\n-LL | / enum Foo {\n-LL | |     Bar(u64),\n-LL | | }\n-   | |_^\n+LL | enum Foo {\n+   | ^^^^^^^^\n    |\n    = note: see issue #56071 <https://github.com/rust-lang/rust/issues/56071> for more information\n    = help: add `#![feature(repr128)]` to the crate attributes to enable"}, {"sha": "1c926399591c232db31f6dec9326bad44501ead4", "filename": "src/test/ui/extern/extern-static-size-overflow.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fextern%2Fextern-static-size-overflow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fextern%2Fextern-static-size-overflow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextern%2Fextern-static-size-overflow.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -2,19 +2,19 @@ error: extern static is too large for the current architecture\n   --> $DIR/extern-static-size-overflow.rs:38:5\n    |\n LL |     static BAZ: [u8; max_size()];\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: extern static is too large for the current architecture\n   --> $DIR/extern-static-size-overflow.rs:39:5\n    |\n LL |     static UWU: [usize; usize::MAX];\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: extern static is too large for the current architecture\n   --> $DIR/extern-static-size-overflow.rs:40:5\n    |\n LL |     static A: ReallyBig;\n-   |     ^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^\n \n error: aborting due to 3 previous errors\n "}, {"sha": "3999a6d2d2f896d836b2548f6bee54e7adcef3e7", "filename": "src/test/ui/feature-gates/feature-gate-repr128.stderr", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr128.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr128.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr128.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,10 +1,8 @@\n error[E0658]: repr with 128-bit type is unstable\n   --> $DIR/feature-gate-repr128.rs:2:1\n    |\n-LL | / enum A {\n-LL | |     A(u64)\n-LL | | }\n-   | |_^\n+LL | enum A {\n+   | ^^^^^^\n    |\n    = note: see issue #56071 <https://github.com/rust-lang/rust/issues/56071> for more information\n    = help: add `#![feature(repr128)]` to the crate attributes to enable"}, {"sha": "1195e0a346ddff0df37508d52559911c16a44426", "filename": "src/test/ui/issues/issue-15524.stderr", "status": "modified", "additions": 25, "deletions": 39, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fissues%2Fissue-15524.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fissues%2Fissue-15524.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-15524.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,53 +1,39 @@\n error[E0081]: discriminant value `1` assigned more than once\n   --> $DIR/issue-15524.rs:3:1\n    |\n-LL | / enum Foo {\n-LL | |\n-LL | |\n-LL | |\n-LL | |     A = 1,\n-   | |         - first assignment of `1`\n-LL | |     B = 1,\n-   | |         - second assignment of `1`\n-...  |\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum Foo {\n+   | ^^^^^^^^\n+...\n+LL |     A = 1,\n+   |         - first assignment of `1`\n+LL |     B = 1,\n+   |         - second assignment of `1`\n \n error[E0081]: discriminant value `1` assigned more than once\n   --> $DIR/issue-15524.rs:3:1\n    |\n-LL | / enum Foo {\n-LL | |\n-LL | |\n-LL | |\n-LL | |     A = 1,\n-   | |         - first assignment of `1`\n-LL | |     B = 1,\n-LL | |     C = 0,\n-   | |     ----- assigned discriminant for `D` was incremented from this discriminant\n-LL | |     D,\n-   | |     - second assignment of `1`\n-...  |\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum Foo {\n+   | ^^^^^^^^\n+...\n+LL |     A = 1,\n+   |         - first assignment of `1`\n+LL |     B = 1,\n+LL |     C = 0,\n+   |     ----- assigned discriminant for `D` was incremented from this discriminant\n+LL |     D,\n+   |     - second assignment of `1`\n \n error[E0081]: discriminant value `1` assigned more than once\n   --> $DIR/issue-15524.rs:3:1\n    |\n-LL | / enum Foo {\n-LL | |\n-LL | |\n-LL | |\n-LL | |     A = 1,\n-   | |         - first assignment of `1`\n-...  |\n-LL | |     E = N,\n-   | |         - second assignment of `1`\n-LL | |\n-LL | | }\n-   | |_^\n+LL | enum Foo {\n+   | ^^^^^^^^\n+...\n+LL |     A = 1,\n+   |         - first assignment of `1`\n+...\n+LL |     E = N,\n+   |         - second assignment of `1`\n \n error: aborting due to 3 previous errors\n "}, {"sha": "f9a25b69ff6210120212f96d52df10a2982e6ef5", "filename": "src/test/ui/issues/issue-34209.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-34209.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -2,7 +2,7 @@ error[E0599]: no variant named `B` found for enum `S`\n   --> $DIR/issue-34209.rs:7:12\n    |\n LL | enum S {\n-   | ------ variant `B` not found for this enum\n+   | ------ variant `B` not found here\n ...\n LL |         S::B {} => {},\n    |            ^ help: there is a variant with a similar name: `A`"}, {"sha": "df99baaf52293f81611fb6da475e6aae3edb7f63", "filename": "src/test/ui/repr/issue-83505-repr-simd.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Frepr%2Fissue-83505-repr-simd.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Frepr%2Fissue-83505-repr-simd.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Fissue-83505-repr-simd.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -22,7 +22,7 @@ LL | #[repr(simd)]\n    | ^^^^^^^^^^^^^\n ...\n LL | enum Es {}\n-   | ---------- zero-variant enum\n+   | ------- zero-variant enum\n \n error: aborting due to 3 previous errors\n "}, {"sha": "f1c570b952356e1217b303138f9429789974d05c", "filename": "src/test/ui/repr/repr-transparent.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-transparent.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -34,7 +34,7 @@ error[E0084]: unsupported representation for zero-variant enum\n LL | #[repr(transparent)]\n    | ^^^^^^^^^^^^^^^^^^^^\n LL | enum Void {}\n-   | ------------ zero-variant enum\n+   | --------- zero-variant enum\n \n error[E0731]: transparent enum needs exactly one variant, but has 0\n   --> $DIR/repr-transparent.rs:45:1"}, {"sha": "88ee4cbdc2efcd66d8d8597f1db913e7de83db3c", "filename": "src/test/ui/statics/uninhabited-static.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fstatics%2Funinhabited-static.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fstatics%2Funinhabited-static.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstatics%2Funinhabited-static.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -2,7 +2,7 @@ error: static of uninhabited type\n   --> $DIR/uninhabited-static.rs:6:5\n    |\n LL |     static VOID: Void;\n-   |     ^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^\n    |\n note: the lint level is defined here\n   --> $DIR/uninhabited-static.rs:2:9\n@@ -17,7 +17,7 @@ error: static of uninhabited type\n   --> $DIR/uninhabited-static.rs:8:5\n    |\n LL |     static NEVER: !;\n-   |     ^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #74840 <https://github.com/rust-lang/rust/issues/74840>"}, {"sha": "514690de4d045054fb3cc953b0de983fbb4944c4", "filename": "src/test/ui/suggestions/issue-52820.fixed", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.fixed?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -0,0 +1,15 @@\n+// run-rustfix\n+#![allow(dead_code)]\n+\n+struct Bravery {\n+    guts: String,\n+    brains: String,\n+}\n+\n+fn main() {\n+    let guts = \"mettle\";\n+    let _ = Bravery {\n+        guts: guts.to_string(), //~ ERROR mismatched types\n+        brains: guts.to_string(), //~ ERROR mismatched types\n+    };\n+}"}, {"sha": "17cd9224c57ec38fdda3342aa01154f9fcf9ce28", "filename": "src/test/ui/suggestions/issue-52820.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,3 +1,6 @@\n+// run-rustfix\n+#![allow(dead_code)]\n+\n struct Bravery {\n     guts: String,\n     brains: String,"}, {"sha": "09269ed4eee9983d6b2b605ac796e8162b712635", "filename": "src/test/ui/suggestions/issue-52820.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-52820.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,5 +1,5 @@\n error[E0308]: mismatched types\n-  --> $DIR/issue-52820.rs:9:9\n+  --> $DIR/issue-52820.rs:12:9\n    |\n LL |         guts,\n    |         ^^^^ expected struct `String`, found `&str`\n@@ -10,13 +10,13 @@ LL |         guts: guts.to_string(),\n    |         +++++     ++++++++++++\n \n error[E0308]: mismatched types\n-  --> $DIR/issue-52820.rs:10:17\n+  --> $DIR/issue-52820.rs:13:17\n    |\n LL |         brains: guts.clone(),\n-   |                 ^^^^^^^^^^^^\n-   |                 |\n+   |                 ^^^^^-----^^\n+   |                 |    |\n+   |                 |    help: try using a conversion method: `to_string`\n    |                 expected struct `String`, found `&str`\n-   |                 help: try using a conversion method: `guts.to_string()`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "35a677b4761867cb22b1ffafc2537b55097c0c0b", "filename": "src/test/ui/suggestions/issue-53692.fixed", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.fixed?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -0,0 +1,20 @@\n+// run-rustfix\n+#![allow(unused_variables)]\n+\n+fn main() {\n+    let items = vec![1, 2, 3];\n+    let ref_items: &[i32] = &items;\n+    let items_clone: Vec<i32> = ref_items.to_vec();\n+    //~^ ERROR mismatched types\n+\n+    // in that case no suggestion will be triggered\n+    let items_clone_2: Vec<i32> = items.clone();\n+\n+    let s = \"hi\";\n+    let string: String = s.to_string();\n+    //~^ ERROR mismatched types\n+\n+    // in that case no suggestion will be triggered\n+    let s2 = \"hi\";\n+    let string_2: String = s2.to_string();\n+}"}, {"sha": "6f6707be5f651c920d0cef778ac2c62fdefe242c", "filename": "src/test/ui/suggestions/issue-53692.rs", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.rs", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.rs?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,17 +1,20 @@\n+// run-rustfix\n+#![allow(unused_variables)]\n+\n fn main() {\n-        let items = vec![1, 2, 3];\n-        let ref_items: &[i32] = &items;\n-        let items_clone: Vec<i32> = ref_items.clone();\n-//~^ ERROR mismatched types\n+    let items = vec![1, 2, 3];\n+    let ref_items: &[i32] = &items;\n+    let items_clone: Vec<i32> = ref_items.clone();\n+    //~^ ERROR mismatched types\n \n-        // in that case no suggestion will be triggered\n-        let items_clone_2:Vec<i32> = items.clone();\n+    // in that case no suggestion will be triggered\n+    let items_clone_2: Vec<i32> = items.clone();\n \n-        let s = \"hi\";\n-        let string: String = s.clone();\n-//~^ ERROR mismatched types\n+    let s = \"hi\";\n+    let string: String = s.clone();\n+    //~^ ERROR mismatched types\n \n-        // in that case no suggestion will be triggered\n-        let s2 = \"hi\";\n-        let string_2: String = s2.to_string();\n+    // in that case no suggestion will be triggered\n+    let s2 = \"hi\";\n+    let string_2: String = s2.to_string();\n }"}, {"sha": "3a1b624f402f0db5ecc0576c329134de91c8419b", "filename": "src/test/ui/suggestions/issue-53692.stderr", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-53692.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,25 +1,25 @@\n error[E0308]: mismatched types\n-  --> $DIR/issue-53692.rs:4:37\n+  --> $DIR/issue-53692.rs:7:33\n    |\n-LL |         let items_clone: Vec<i32> = ref_items.clone();\n-   |                          --------   ^^^^^^^^^^^^^^^^^\n-   |                          |          |\n-   |                          |          expected struct `Vec`, found `&[i32]`\n-   |                          |          help: try using a conversion method: `ref_items.to_vec()`\n-   |                          expected due to this\n+LL |     let items_clone: Vec<i32> = ref_items.clone();\n+   |                      --------   ^^^^^^^^^^-----^^\n+   |                      |          |         |\n+   |                      |          |         help: try using a conversion method: `to_vec`\n+   |                      |          expected struct `Vec`, found `&[i32]`\n+   |                      expected due to this\n    |\n    = note: expected struct `Vec<i32>`\n            found reference `&[i32]`\n \n error[E0308]: mismatched types\n-  --> $DIR/issue-53692.rs:11:30\n+  --> $DIR/issue-53692.rs:14:26\n    |\n-LL |         let string: String = s.clone();\n-   |                     ------   ^^^^^^^^^\n-   |                     |        |\n-   |                     |        expected struct `String`, found `&str`\n-   |                     |        help: try using a conversion method: `s.to_string()`\n-   |                     expected due to this\n+LL |     let string: String = s.clone();\n+   |                 ------   ^^-----^^\n+   |                 |        | |\n+   |                 |        | help: try using a conversion method: `to_string`\n+   |                 |        expected struct `String`, found `&str`\n+   |                 expected due to this\n \n error: aborting due to 2 previous errors\n "}, {"sha": "a422bc65635418d5cb03faeb049fbde185c8e229", "filename": "src/test/ui/suggestions/suggest-variants.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fsuggest-variants.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -2,7 +2,7 @@ error[E0599]: no variant named `Squareee` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:12:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Squareee` not found for this enum\n+   | ---------- variant `Squareee` not found here\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Squareee { size: 5});\n    |                                         ^^^^^^^^ help: there is a variant with a similar name: `Square`\n@@ -11,7 +11,7 @@ error[E0599]: no variant named `Circl` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:13:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Circl` not found for this enum\n+   | ---------- variant `Circl` not found here\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Circl { size: 5});\n    |                                         ^^^^^ help: there is a variant with a similar name: `Circle`\n@@ -20,7 +20,7 @@ error[E0599]: no variant named `Rombus` found for enum `Shape`\n   --> $DIR/suggest-variants.rs:14:41\n    |\n LL | enum Shape {\n-   | ---------- variant `Rombus` not found for this enum\n+   | ---------- variant `Rombus` not found here\n ...\n LL |     println!(\"My shape is {:?}\", Shape::Rombus{ size: 5});\n    |                                         ^^^^^^ variant not found in `Shape`"}, {"sha": "6b1ba43d2ba6e79c89051577d75200d5511c62c0", "filename": "src/test/ui/tag-variant-disr-dup.stderr", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ftag-variant-disr-dup.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Ftag-variant-disr-dup.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftag-variant-disr-dup.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1,17 +1,13 @@\n error[E0081]: discriminant value `0` assigned more than once\n   --> $DIR/tag-variant-disr-dup.rs:3:1\n    |\n-LL | / enum Color {\n-LL | |\n-LL | |     Red = 0xff0000,\n-LL | |     Green = 0x00ff00,\n-LL | |     Blue = 0x0000ff,\n-LL | |     Black = 0x000000,\n-   | |             -------- first assignment of `0`\n-LL | |     White = 0x000000,\n-   | |             -------- second assignment of `0`\n-LL | | }\n-   | |_^\n+LL | enum Color {\n+   | ^^^^^^^^^^\n+...\n+LL |     Black = 0x000000,\n+   |             -------- first assignment of `0`\n+LL |     White = 0x000000,\n+   |             -------- second assignment of `0`\n \n error: aborting due to previous error\n "}, {"sha": "6d141a58ef953651f814fc6af964afcaf758c583", "filename": "src/test/ui/wf/wf-unsafe-trait-obj-match.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fwf%2Fwf-unsafe-trait-obj-match.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/116819f54f062a2f425deac4ec29245038c26613/src%2Ftest%2Fui%2Fwf%2Fwf-unsafe-trait-obj-match.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fwf%2Fwf-unsafe-trait-obj-match.stderr?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -31,8 +31,12 @@ LL | trait Trait: Sized {}\n error[E0038]: the trait `Trait` cannot be made into an object\n   --> $DIR/wf-unsafe-trait-obj-match.rs:25:25\n    |\n-LL |     let t: &dyn Trait = match opt() {\n-   |                         ^^^^^^^^^^^ `Trait` cannot be made into an object\n+LL |       let t: &dyn Trait = match opt() {\n+   |  _________________________^\n+LL | |         Some(()) => &S,\n+LL | |         None => &R,\n+LL | |     };\n+   | |_____^ `Trait` cannot be made into an object\n    |\n note: for a trait to be \"object safe\" it needs to allow building a vtable to allow the call to be resolvable dynamically; for more information visit <https://doc.rust-lang.org/reference/items/traits.html#object-safety>\n   --> $DIR/wf-unsafe-trait-obj-match.rs:6:14"}, {"sha": "fcf1f94c9ab2acc18cfd4368a4aeb38e77da9649", "filename": "src/tools/rls", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frls?ref=116819f54f062a2f425deac4ec29245038c26613", "patch": "@@ -1 +1 @@\n-Subproject commit ece09b88c0365947af79c0ffdeea02bc6c1eec25\n+Subproject commit fcf1f94c9ab2acc18cfd4368a4aeb38e77da9649"}]}