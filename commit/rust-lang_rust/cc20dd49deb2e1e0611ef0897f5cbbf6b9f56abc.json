{"sha": "cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc", "node_id": "C_kwDOAAsO6NoAKGNjMjBkZDQ5ZGViMmUxZTA2MTFlZjA4OTdmNWNiYmY2YjlmNTZhYmM", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-01-12T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-01-12T17:51:32Z"}, "message": "Migrate abi-sysv64 abi-sysv64-register-usage test to asm!", "tree": {"sha": "6a7619a3921e61492ede0dc561d798a7df0cb9c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a7619a3921e61492ede0dc561d798a7df0cb9c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc", "html_url": "https://github.com/rust-lang/rust/commit/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b315250b8888d34c5eb2b33760c46627362f8d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b315250b8888d34c5eb2b33760c46627362f8d6", "html_url": "https://github.com/rust-lang/rust/commit/0b315250b8888d34c5eb2b33760c46627362f8d6"}], "stats": {"total": 62, "additions": 30, "deletions": 32}, "files": [{"sha": "e3eff2eb1433e5b30186b1d83631c229454f4884", "filename": "src/test/ui/abi/abi-sysv64-register-usage.rs", "status": "modified", "additions": 30, "deletions": 32, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc/src%2Ftest%2Fui%2Fabi%2Fabi-sysv64-register-usage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc/src%2Ftest%2Fui%2Fabi%2Fabi-sysv64-register-usage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Fabi-sysv64-register-usage.rs?ref=cc20dd49deb2e1e0611ef0897f5cbbf6b9f56abc", "patch": "@@ -5,9 +5,7 @@\n // ignore-android\n // ignore-arm\n // ignore-aarch64\n-\n-#![feature(llvm_asm)]\n-#![allow(deprecated)] // llvm_asm!\n+#![feature(asm_sym)]\n \n #[cfg(target_arch = \"x86_64\")]\n pub extern \"sysv64\" fn all_the_registers(rdi: i64, rsi: i64, rdx: i64,\n@@ -54,37 +52,37 @@ pub extern \"sysv64\" fn large_struct_by_val(mut foo: LargeStruct) -> LargeStruct\n \n #[cfg(target_arch = \"x86_64\")]\n pub fn main() {\n+    use std::arch::asm;\n+\n     let result: i64;\n     unsafe {\n-        llvm_asm!(\"mov rdi, 1;\n-                   mov rsi, 2;\n-                   mov rdx, 3;\n-                   mov rcx, 4;\n-                   mov r8,  5;\n-                   mov r9,  6;\n-                   mov eax, 0x3F800000;\n-                   movd xmm0, eax;\n-                   mov eax, 0x40000000;\n-                   movd xmm1, eax;\n-                   mov eax, 0x40800000;\n-                   movd xmm2, eax;\n-                   mov eax, 0x41000000;\n-                   movd xmm3, eax;\n-                   mov eax, 0x41800000;\n-                   movd xmm4, eax;\n-                   mov eax, 0x42000000;\n-                   movd xmm5, eax;\n-                   mov eax, 0x42800000;\n-                   movd xmm6, eax;\n-                   mov eax, 0x43000000;\n-                   movd xmm7, eax;\n-                   call r10\n-                   \"\n-                 : \"={rax}\"(result)\n-                 : \"{r10}\"(all_the_registers as usize)\n-                 : \"rdi\", \"rsi\", \"rdx\", \"rcx\", \"r8\", \"r9\", \"r11\", \"cc\", \"memory\"\n-                 : \"intel\", \"alignstack\"\n-        )\n+        asm!(\"mov rdi, 1\",\n+             \"mov rsi, 2\",\n+             \"mov rdx, 3\",\n+             \"mov rcx, 4\",\n+             \"mov r8,  5\",\n+             \"mov r9,  6\",\n+             \"mov eax, 0x3F800000\",\n+             \"movd xmm0, eax\",\n+             \"mov eax, 0x40000000\",\n+             \"movd xmm1, eax\",\n+             \"mov eax, 0x40800000\",\n+             \"movd xmm2, eax\",\n+             \"mov eax, 0x41000000\",\n+             \"movd xmm3, eax\",\n+             \"mov eax, 0x41800000\",\n+             \"movd xmm4, eax\",\n+             \"mov eax, 0x42000000\",\n+             \"movd xmm5, eax\",\n+             \"mov eax, 0x42800000\",\n+             \"movd xmm6, eax\",\n+             \"mov eax, 0x43000000\",\n+             \"movd xmm7, eax\",\n+             \"call {0}\",\n+             sym all_the_registers,\n+             out(\"rax\") result,\n+             clobber_abi(\"sysv64\"),\n+        );\n     }\n     assert_eq!(result, 42);\n "}]}