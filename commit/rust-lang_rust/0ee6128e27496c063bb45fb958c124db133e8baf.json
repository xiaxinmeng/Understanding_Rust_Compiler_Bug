{"sha": "0ee6128e27496c063bb45fb958c124db133e8baf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlZTYxMjhlMjc0OTZjMDYzYmI0NWZiOTU4YzEyNGRiMTMzZThiYWY=", "commit": {"author": {"name": "Phil Turnbull", "email": "philip.turnbull@gmail.com", "date": "2016-11-25T14:54:07Z"}, "committer": {"name": "Phil Turnbull", "email": "philip.turnbull@gmail.com", "date": "2016-11-25T15:33:21Z"}, "message": "Convert DEREF_ADDROF to EarlyLintPass", "tree": {"sha": "03b4dca7fcc286cc948bcc6cfc07e9f708317790", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/03b4dca7fcc286cc948bcc6cfc07e9f708317790"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0ee6128e27496c063bb45fb958c124db133e8baf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0ee6128e27496c063bb45fb958c124db133e8baf", "html_url": "https://github.com/rust-lang/rust/commit/0ee6128e27496c063bb45fb958c124db133e8baf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0ee6128e27496c063bb45fb958c124db133e8baf/comments", "author": {"login": "philipturnbull", "id": 45588, "node_id": "MDQ6VXNlcjQ1NTg4", "avatar_url": "https://avatars.githubusercontent.com/u/45588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philipturnbull", "html_url": "https://github.com/philipturnbull", "followers_url": "https://api.github.com/users/philipturnbull/followers", "following_url": "https://api.github.com/users/philipturnbull/following{/other_user}", "gists_url": "https://api.github.com/users/philipturnbull/gists{/gist_id}", "starred_url": "https://api.github.com/users/philipturnbull/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philipturnbull/subscriptions", "organizations_url": "https://api.github.com/users/philipturnbull/orgs", "repos_url": "https://api.github.com/users/philipturnbull/repos", "events_url": "https://api.github.com/users/philipturnbull/events{/privacy}", "received_events_url": "https://api.github.com/users/philipturnbull/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philipturnbull", "id": 45588, "node_id": "MDQ6VXNlcjQ1NTg4", "avatar_url": "https://avatars.githubusercontent.com/u/45588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philipturnbull", "html_url": "https://github.com/philipturnbull", "followers_url": "https://api.github.com/users/philipturnbull/followers", "following_url": "https://api.github.com/users/philipturnbull/following{/other_user}", "gists_url": "https://api.github.com/users/philipturnbull/gists{/gist_id}", "starred_url": "https://api.github.com/users/philipturnbull/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philipturnbull/subscriptions", "organizations_url": "https://api.github.com/users/philipturnbull/orgs", "repos_url": "https://api.github.com/users/philipturnbull/repos", "events_url": "https://api.github.com/users/philipturnbull/events{/privacy}", "received_events_url": "https://api.github.com/users/philipturnbull/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d04038c569898097f5abea2ec15b730936e03a0", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d04038c569898097f5abea2ec15b730936e03a0", "html_url": "https://github.com/rust-lang/rust/commit/8d04038c569898097f5abea2ec15b730936e03a0"}], "stats": {"total": 32, "additions": 26, "deletions": 6}, "files": [{"sha": "537c34b4e2c4174a5e06877db1c9557214567de2", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6128e27496c063bb45fb958c124db133e8baf/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6128e27496c063bb45fb958c124db133e8baf/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=0ee6128e27496c063bb45fb958c124db133e8baf", "patch": "@@ -267,7 +267,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry) {\n     reg.register_late_lint_pass(box ok_if_let::Pass);\n     reg.register_late_lint_pass(box if_let_redundant_pattern_matching::Pass);\n     reg.register_late_lint_pass(box partialeq_ne_impl::Pass);\n-    reg.register_late_lint_pass(box reference::Pass);\n+    reg.register_early_lint_pass(box reference::Pass);\n \n     reg.register_lint_group(\"clippy_restrictions\", vec![\n         arithmetic::FLOAT_ARITHMETIC,"}, {"sha": "19e8a3c7d146efa196000aae610fc7b837a598d6", "filename": "clippy_lints/src/reference.rs", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6128e27496c063bb45fb958c124db133e8baf/clippy_lints%2Fsrc%2Freference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6128e27496c063bb45fb958c124db133e8baf/clippy_lints%2Fsrc%2Freference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freference.rs?ref=0ee6128e27496c063bb45fb958c124db133e8baf", "patch": "@@ -1,4 +1,4 @@\n-use rustc::hir::*;\n+use syntax::ast::{Expr,ExprKind,UnOp};\n use rustc::lint::*;\n use utils::{span_lint_and_then, snippet};\n \n@@ -29,10 +29,17 @@ impl LintPass for Pass {\n     }\n }\n \n-impl LateLintPass for Pass {\n-    fn check_expr(&mut self, cx: &LateContext, e: &Expr) {\n-        if let ExprUnary(UnDeref, ref deref_target) = e.node {\n-            if let ExprAddrOf(_, ref addrof_target) = deref_target.node {\n+fn without_parens(mut e: &Expr) -> &Expr {\n+    while let ExprKind::Paren(ref child_e) = e.node {\n+        e = child_e;\n+    }\n+    e\n+}\n+\n+impl EarlyLintPass for Pass {\n+    fn check_expr(&mut self, cx: &EarlyContext, e: &Expr) {\n+        if let ExprKind::Unary(UnOp::Deref, ref deref_target) = e.node {\n+            if let ExprKind::AddrOf(_, ref addrof_target) = without_parens(deref_target).node {\n                 span_lint_and_then(\n                     cx,\n                     DEREF_ADDROF,"}, {"sha": "faaae46af71821a94cc15536af1dd13b3966be2a", "filename": "tests/compile-fail/formatting.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6128e27496c063bb45fb958c124db133e8baf/tests%2Fcompile-fail%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6128e27496c063bb45fb958c124db133e8baf/tests%2Fcompile-fail%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fformatting.rs?ref=0ee6128e27496c063bb45fb958c124db133e8baf", "patch": "@@ -5,6 +5,7 @@\n #![allow(unused_variables)]\n #![allow(unused_assignments)]\n #![allow(if_same_then_else)]\n+#![allow(deref_addrof)]\n \n fn foo() -> bool { true }\n "}, {"sha": "b77afbc127025ea4969dafa202597b030dd674f1", "filename": "tests/compile-fail/reference.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0ee6128e27496c063bb45fb958c124db133e8baf/tests%2Fcompile-fail%2Freference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0ee6128e27496c063bb45fb958c124db133e8baf/tests%2Fcompile-fail%2Freference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Freference.rs?ref=0ee6128e27496c063bb45fb958c124db133e8baf", "patch": "@@ -34,11 +34,23 @@ fn main() {\n     //~|HELP try this\n     //~|SUGGESTION let b = bytes[1..2][0];\n \n+    //This produces a suggestion of 'let b = (a);' which\n+    //will trigger the 'unused_parens' lint\n+    let b = *&(a);\n+    //~^ERROR immediately dereferencing a reference\n+    //~|HELP try this\n+    //~|SUGGESTION let b = (a)\n+\n     let b = *(&a);\n     //~^ERROR immediately dereferencing a reference\n     //~|HELP try this\n     //~|SUGGESTION let b = a;\n \n+    let b = *((&a));\n+    //~^ERROR immediately dereferencing a reference\n+    //~|HELP try this\n+    //~|SUGGESTION let b = a\n+\n     let b = *&&a;\n     //~^ERROR immediately dereferencing a reference\n     //~|HELP try this"}]}