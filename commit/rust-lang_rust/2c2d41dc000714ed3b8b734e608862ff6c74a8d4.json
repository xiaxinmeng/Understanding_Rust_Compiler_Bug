{"sha": "2c2d41dc000714ed3b8b734e608862ff6c74a8d4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjMmQ0MWRjMDAwNzE0ZWQzYjhiNzM0ZTYwODg2MmZmNmM3NGE4ZDQ=", "commit": {"author": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2020-03-16T04:31:17Z"}, "committer": {"name": "mark", "email": "markm@cs.wisc.edu", "date": "2020-03-16T04:31:17Z"}, "message": "make article_and_description primarily use def_kind", "tree": {"sha": "23fc2d200509241c46c52d6fdb5ad8b014fa83a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23fc2d200509241c46c52d6fdb5ad8b014fa83a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c2d41dc000714ed3b8b734e608862ff6c74a8d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c2d41dc000714ed3b8b734e608862ff6c74a8d4", "html_url": "https://github.com/rust-lang/rust/commit/2c2d41dc000714ed3b8b734e608862ff6c74a8d4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c2d41dc000714ed3b8b734e608862ff6c74a8d4/comments", "author": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mark-i-m", "id": 8827840, "node_id": "MDQ6VXNlcjg4Mjc4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/8827840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mark-i-m", "html_url": "https://github.com/mark-i-m", "followers_url": "https://api.github.com/users/mark-i-m/followers", "following_url": "https://api.github.com/users/mark-i-m/following{/other_user}", "gists_url": "https://api.github.com/users/mark-i-m/gists{/gist_id}", "starred_url": "https://api.github.com/users/mark-i-m/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mark-i-m/subscriptions", "organizations_url": "https://api.github.com/users/mark-i-m/orgs", "repos_url": "https://api.github.com/users/mark-i-m/repos", "events_url": "https://api.github.com/users/mark-i-m/events{/privacy}", "received_events_url": "https://api.github.com/users/mark-i-m/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "131772c5e0ba40cd656dedb5e1990d36e3ea31cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/131772c5e0ba40cd656dedb5e1990d36e3ea31cf", "html_url": "https://github.com/rust-lang/rust/commit/131772c5e0ba40cd656dedb5e1990d36e3ea31cf"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "ada14ec4d0b25550af7a9905b73f089d5b1ee5c8", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 15, "deletions": 14, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/2c2d41dc000714ed3b8b734e608862ff6c74a8d4/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c2d41dc000714ed3b8b734e608862ff6c74a8d4/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=2c2d41dc000714ed3b8b734e608862ff6c74a8d4", "patch": "@@ -1515,20 +1515,21 @@ impl<'tcx> TyCtxt<'tcx> {\n \n     /// Returns a displayable description and article for the given `def_id` (e.g. `(\"a\", \"struct\")`).\n     pub fn article_and_description(&self, def_id: DefId) -> (&'static str, &'static str) {\n-        match self.def_key(def_id).disambiguated_data.data {\n-            DefPathData::TypeNs(..) | DefPathData::ValueNs(..) | DefPathData::MacroNs(..) => {\n-                let kind = self.def_kind(def_id).unwrap();\n-                (kind.article(), kind.descr(def_id))\n-            }\n-            DefPathData::ClosureExpr => match self.generator_kind(def_id) {\n-                None => (\"a\", \"closure\"),\n-                Some(rustc_hir::GeneratorKind::Async(..)) => (\"an\", \"async closure\"),\n-                Some(rustc_hir::GeneratorKind::Gen) => (\"a\", \"generator\"),\n-            },\n-            DefPathData::LifetimeNs(..) => (\"a\", \"lifetime\"),\n-            DefPathData::Impl => (\"an\", \"implementation\"),\n-            _ => bug!(\"article_and_description called on def_id {:?}\", def_id),\n-        }\n+        self.def_kind(def_id)\n+            .map(|def_kind| (def_kind.article(), def_kind.descr(def_id)))\n+            .unwrap_or_else(|| match self.def_key(def_id).disambiguated_data.data {\n+                DefPathData::ClosureExpr => match self.generator_kind(def_id) {\n+                    None => (\"a\", \"closure\"),\n+                    Some(rustc_hir::GeneratorKind::Async(..)) => (\"an\", \"async closure\"),\n+                    Some(rustc_hir::GeneratorKind::Gen) => (\"a\", \"generator\"),\n+                },\n+                DefPathData::LifetimeNs(..) => (\"a\", \"lifetime\"),\n+                DefPathData::Impl => (\"an\", \"implementation\"),\n+                DefPathData::TypeNs(..) | DefPathData::ValueNs(..) | DefPathData::MacroNs(..) => {\n+                    unreachable!()\n+                }\n+                _ => bug!(\"article_and_description called on def_id {:?}\", def_id),\n+            })\n     }\n }\n "}]}