{"sha": "68424e2f01ef6884af440114f7cf2ed01faf86e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4NDI0ZTJmMDFlZjY4ODRhZjQ0MDExNGY3Y2YyZWQwMWZhZjg2ZTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-24T05:39:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-24T05:39:07Z"}, "message": "Auto merge of #85515 - jedel1043:fix-85480, r=petrochenkov\n\nFix ast pretty printing for anonymous types\n\nFixes #85480.", "tree": {"sha": "5585dc2d1d57d780acf27889882c6cca3e366423", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5585dc2d1d57d780acf27889882c6cca3e366423"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68424e2f01ef6884af440114f7cf2ed01faf86e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68424e2f01ef6884af440114f7cf2ed01faf86e3", "html_url": "https://github.com/rust-lang/rust/commit/68424e2f01ef6884af440114f7cf2ed01faf86e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68424e2f01ef6884af440114f7cf2ed01faf86e3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f9646da57946ced0b494c3c57ebffdf67136fd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f9646da57946ced0b494c3c57ebffdf67136fd9", "html_url": "https://github.com/rust-lang/rust/commit/3f9646da57946ced0b494c3c57ebffdf67136fd9"}, {"sha": "d59b1f1ef4be692b67c1ff1b49ec810fd59452cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/d59b1f1ef4be692b67c1ff1b49ec810fd59452cf", "html_url": "https://github.com/rust-lang/rust/commit/d59b1f1ef4be692b67c1ff1b49ec810fd59452cf"}], "stats": {"total": 40, "additions": 30, "deletions": 10}, "files": [{"sha": "b7bb896f31802281214b5cc44e55e84606de1e8e", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/68424e2f01ef6884af440114f7cf2ed01faf86e3/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68424e2f01ef6884af440114f7cf2ed01faf86e3/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=68424e2f01ef6884af440114f7cf2ed01faf86e3", "patch": "@@ -955,12 +955,12 @@ impl<'a> State<'a> {\n                 self.pclose();\n             }\n             ast::TyKind::AnonymousStruct(ref fields, ..) => {\n-                self.s.word(\"struct\");\n-                self.print_record_struct_body(fields, ty.span);\n+                self.head(\"struct\");\n+                self.print_record_struct_body(&fields, ty.span);\n             }\n             ast::TyKind::AnonymousUnion(ref fields, ..) => {\n-                self.s.word(\"union\");\n-                self.print_record_struct_body(fields, ty.span);\n+                self.head(\"union\");\n+                self.print_record_struct_body(&fields, ty.span);\n             }\n             ast::TyKind::Paren(ref typ) => {\n                 self.popen();\n@@ -1397,12 +1397,7 @@ impl<'a> State<'a> {\n         }\n     }\n \n-    crate fn print_record_struct_body(\n-        &mut self,\n-        fields: &Vec<ast::FieldDef>,\n-        span: rustc_span::Span,\n-    ) {\n-        self.nbsp();\n+    crate fn print_record_struct_body(&mut self, fields: &[ast::FieldDef], span: rustc_span::Span) {\n         self.bopen();\n         self.hardbreak_if_not_bol();\n \n@@ -1451,6 +1446,7 @@ impl<'a> State<'a> {\n             }\n             ast::VariantData::Struct(ref fields, ..) => {\n                 self.print_where_clause(&generics.where_clause);\n+                self.nbsp();\n                 self.print_record_struct_body(fields, span);\n             }\n         }"}, {"sha": "5ff452e8e43c43a831b69be283dee79fca552681", "filename": "src/test/pretty/anonymous-types.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/68424e2f01ef6884af440114f7cf2ed01faf86e3/src%2Ftest%2Fpretty%2Fanonymous-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68424e2f01ef6884af440114f7cf2ed01faf86e3/src%2Ftest%2Fpretty%2Fanonymous-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fanonymous-types.rs?ref=68424e2f01ef6884af440114f7cf2ed01faf86e3", "patch": "@@ -0,0 +1,24 @@\n+// Test for issue 85480\n+// Pretty print anonymous struct and union types\n+\n+// pp-exact\n+// pretty-compare-only\n+\n+struct Foo {\n+    _: union {\n+           _: struct {\n+                  a: u8,\n+                  b: u16,\n+              },\n+           c: u32,\n+       },\n+    d: u64,\n+    e: f32,\n+}\n+\n+type A =\n+ struct {\n+     field: u8,\n+ };\n+\n+fn main() { }"}]}