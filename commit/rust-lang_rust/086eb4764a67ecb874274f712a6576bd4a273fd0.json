{"sha": "086eb4764a67ecb874274f712a6576bd4a273fd0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4NmViNDc2NGE2N2VjYjg3NDI3NGY3MTJhNjU3NmJkNGEyNzNmZDA=", "commit": {"author": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-07-02T16:00:08Z"}, "committer": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-07-02T16:00:08Z"}, "message": "Add a help message to `unused_doc_comments` lint", "tree": {"sha": "02c7e46bffafe5f64cddd894595821dc45c1e56b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/02c7e46bffafe5f64cddd894595821dc45c1e56b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/086eb4764a67ecb874274f712a6576bd4a273fd0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEx6scKn6IIf/+FpBu2rpbBylhwYoFAmDfOAgACgkQ2rpbBylh\nwYpBGg//W52FsZpdOm+mXwl38NF/fwE5yZP0Zqj3c2WcMqT4u6yrhufYVx5nRiNA\n07cetODIgnAD0TnzDsvoM8T6EnlOQU8oz6WhkSnDgQ0BzHNzcFRYRj95xLcFZrgf\nOaU3wy+kOWWNN2/y3f3SpEPxbWFIaxt2F1+zY2yhvoEInZj+tS3yFkE+Gx2pd6vk\nbqpbrgXbhnyNmNaADVCI+SotGM6rFvEepXGywcm6ky41i/phe9Yd6AsjkfZ0osU1\nmZ1hM2irCjXdnzTqs8lu2mbS++/252Hxg8JqXwLb2AqUQLzfyomZC7OKmR72K15E\nM9EnkAx65d6qn8L9yiskv+HMHjpdzay1ZichX8WT6pgOwLVGSY9hI99SY32oMsw2\n6UMC9/GypYZROyvvaovhXFcBZxNRO0YWS7x2qsThE4itXKlXV2fFHdc3FW9zXJDQ\noGuzBs1E2NyIuJFpamnHxQl1CuTvB9O0/hSBS5AGqENz/QT2X4iIlDct6s8yTpzF\nw22yoUcuBsu7k4kc6G6/XRSn81ZMrIA/6xn1teHINyxHzHZxYal/mm3DJUBhMC2c\nxLCf25OLgBzJaFgzvZBaXU/00QZnIMRgAMbBuaZ0MohXAZtV/WN3Y32Tj+EMT7dU\nYOLqhcvvqWE4PTBmXXhToRND56TZ4j7k8A+Qq8U4vNdk1QsBhjs=\n=7XPf\n-----END PGP SIGNATURE-----", "payload": "tree 02c7e46bffafe5f64cddd894595821dc45c1e56b\nparent ce331ee6ee010438d1a58c7da8ced4f26d69a20e\nauthor Yuki Okushi <yuki.okushi@huawei.com> 1625241608 +0900\ncommitter Yuki Okushi <yuki.okushi@huawei.com> 1625241608 +0900\n\nAdd a help message to `unused_doc_comments` lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/086eb4764a67ecb874274f712a6576bd4a273fd0", "html_url": "https://github.com/rust-lang/rust/commit/086eb4764a67ecb874274f712a6576bd4a273fd0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/086eb4764a67ecb874274f712a6576bd4a273fd0/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce331ee6ee010438d1a58c7da8ced4f26d69a20e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce331ee6ee010438d1a58c7da8ced4f26d69a20e", "html_url": "https://github.com/rust-lang/rust/commit/ce331ee6ee010438d1a58c7da8ced4f26d69a20e"}], "stats": {"total": 121, "additions": 119, "deletions": 2}, "files": [{"sha": "b303f55cf772b8af4a73efb55e3f5e6f0aad4190", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/086eb4764a67ecb874274f712a6576bd4a273fd0/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086eb4764a67ecb874274f712a6576bd4a273fd0/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=086eb4764a67ecb874274f712a6576bd4a273fd0", "patch": "@@ -984,13 +984,16 @@ impl EarlyLintPass for DeprecatedAttr {\n }\n \n fn warn_if_doc(cx: &EarlyContext<'_>, node_span: Span, node_kind: &str, attrs: &[ast::Attribute]) {\n+    use rustc_ast::token::CommentKind;\n+\n     let mut attrs = attrs.iter().peekable();\n \n     // Accumulate a single span for sugared doc comments.\n     let mut sugared_span: Option<Span> = None;\n \n     while let Some(attr) = attrs.next() {\n-        if attr.is_doc_comment() {\n+        let is_doc_comment = attr.is_doc_comment();\n+        if is_doc_comment {\n             sugared_span =\n                 Some(sugared_span.map_or(attr.span, |span| span.with_hi(attr.span.hi())));\n         }\n@@ -1001,13 +1004,21 @@ fn warn_if_doc(cx: &EarlyContext<'_>, node_span: Span, node_kind: &str, attrs: &\n \n         let span = sugared_span.take().unwrap_or(attr.span);\n \n-        if attr.is_doc_comment() || cx.sess().check_name(attr, sym::doc) {\n+        if is_doc_comment || cx.sess().check_name(attr, sym::doc) {\n             cx.struct_span_lint(UNUSED_DOC_COMMENTS, span, |lint| {\n                 let mut err = lint.build(\"unused doc comment\");\n                 err.span_label(\n                     node_span,\n                     format!(\"rustdoc does not generate documentation for {}\", node_kind),\n                 );\n+                match attr.kind {\n+                    AttrKind::DocComment(CommentKind::Line, _) | AttrKind::Normal(..) => {\n+                        err.help(\"use `//` for a plain comment\");\n+                    }\n+                    AttrKind::DocComment(CommentKind::Block, _) => {\n+                        err.help(\"use `/* */` for a plain comment\");\n+                    }\n+                }\n                 err.emit();\n             });\n         }"}, {"sha": "fd9baf8c6b9a28168e7433af05f1d3cd0ed15bb6", "filename": "src/test/ui/unused/unused-doc-comments-edge-cases.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.rs", "raw_url": "https://github.com/rust-lang/rust/raw/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.rs?ref=086eb4764a67ecb874274f712a6576bd4a273fd0", "patch": "@@ -0,0 +1,29 @@\n+#![deny(unused_doc_comments)]\n+\n+fn doc_comment_on_match_arms(num: u8) -> bool {\n+    match num {\n+        3 => true,\n+        /// useless doc comment\n+        //~^ ERROR: unused doc comment\n+        _ => false,\n+    }\n+}\n+\n+fn doc_comment_between_if_else(num: u8) -> bool {\n+    if num == 3 {\n+        true //~ ERROR: mismatched types\n+    }\n+    /// useless doc comment\n+    else { //~ ERROR: expected expression, found keyword `else`\n+        false\n+    }\n+}\n+\n+fn doc_comment_on_expr(num: u8) -> bool {\n+    /// useless doc comment\n+    //~^ ERROR: attributes on expressions are experimental\n+    //~| ERROR: unused doc comment\n+    num == 3\n+}\n+\n+fn main() {}"}, {"sha": "14db5f64b0c7406f7f11e1294918150a44585e1e", "filename": "src/test/ui/unused/unused-doc-comments-edge-cases.stderr", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused%2Funused-doc-comments-edge-cases.stderr?ref=086eb4764a67ecb874274f712a6576bd4a273fd0", "patch": "@@ -0,0 +1,61 @@\n+error: expected expression, found keyword `else`\n+  --> $DIR/unused-doc-comments-edge-cases.rs:17:5\n+   |\n+LL |     else {\n+   |     ^^^^ expected expression\n+\n+error[E0658]: attributes on expressions are experimental\n+  --> $DIR/unused-doc-comments-edge-cases.rs:23:5\n+   |\n+LL |     /// useless doc comment\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #15701 <https://github.com/rust-lang/rust/issues/15701> for more information\n+   = help: add `#![feature(stmt_expr_attributes)]` to the crate attributes to enable\n+   = help: `///` is for documentation comments. For a plain comment, use `//`.\n+\n+error: unused doc comment\n+  --> $DIR/unused-doc-comments-edge-cases.rs:6:9\n+   |\n+LL |         /// useless doc comment\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^\n+LL |\n+LL |         _ => false,\n+   |         ---------- rustdoc does not generate documentation for match arms\n+   |\n+note: the lint level is defined here\n+  --> $DIR/unused-doc-comments-edge-cases.rs:1:9\n+   |\n+LL | #![deny(unused_doc_comments)]\n+   |         ^^^^^^^^^^^^^^^^^^^\n+   = help: use `//` for a plain comment\n+\n+error: unused doc comment\n+  --> $DIR/unused-doc-comments-edge-cases.rs:23:5\n+   |\n+LL |     /// useless doc comment\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^\n+...\n+LL |     num == 3\n+   |     --- rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n+\n+error[E0308]: mismatched types\n+  --> $DIR/unused-doc-comments-edge-cases.rs:14:9\n+   |\n+LL | /     if num == 3 {\n+LL | |         true\n+   | |         ^^^^ expected `()`, found `bool`\n+LL | |     }\n+   | |_____- expected this to be `()`\n+   |\n+help: you might have meant to return this value\n+   |\n+LL |         return true;\n+   |         ^^^^^^     ^\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0308, E0658.\n+For more information about an error, try `rustc --explain E0308`."}, {"sha": "0054426fb1ec0cccf257bf1436f41f1040c8ac38", "filename": "src/test/ui/unused/useless-comment.stderr", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Fuseless-comment.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/086eb4764a67ecb874274f712a6576bd4a273fd0/src%2Ftest%2Fui%2Funused%2Fuseless-comment.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funused%2Fuseless-comment.stderr?ref=086eb4764a67ecb874274f712a6576bd4a273fd0", "patch": "@@ -26,6 +26,8 @@ LL |     /// a\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |     let x = 12;\n    |     ----------- rustdoc does not generate documentation for statements\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:16:5\n@@ -40,6 +42,8 @@ LL | |         1 => {},\n LL | |         _ => {}\n LL | |     }\n    | |_____- rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:20:9\n@@ -48,6 +52,8 @@ LL |         /// c\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |         1 => {},\n    |         ------- rustdoc does not generate documentation for match arms\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:25:5\n@@ -56,6 +62,8 @@ LL |     /// foo\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n LL |     unsafe {}\n    |     --------- rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:28:5\n@@ -65,6 +73,8 @@ LL |     #[doc = \"foo\"]\n LL |     #[doc = \"bar\"]\n LL |     3;\n    |     - rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:29:5\n@@ -73,12 +83,16 @@ LL |     #[doc = \"bar\"]\n    |     ^^^^^^^^^^^^^^\n LL |     3;\n    |     - rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:35:13\n    |\n LL |     let x = /** comment */ 47;\n    |             ^^^^^^^^^^^^^^ -- rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `/* */` for a plain comment\n \n error: unused doc comment\n   --> $DIR/useless-comment.rs:37:5\n@@ -89,6 +103,8 @@ LL | /     {\n LL | |\n LL | |     }\n    | |_____- rustdoc does not generate documentation for expressions\n+   |\n+   = help: use `//` for a plain comment\n \n error: aborting due to 10 previous errors\n "}]}