{"sha": "fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiYzViYjRjMGFlMTBlZjE1OWQxYzA2YTQwZmRmMmI3ODgzMDgzZDM=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-07-06T08:03:03Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2013-07-11T20:15:52Z"}, "message": "wire up makefile to run codegen tests and add one to start", "tree": {"sha": "538dd1317cb90729390b3069187017f707618ee6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/538dd1317cb90729390b3069187017f707618ee6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "html_url": "https://github.com/rust-lang/rust/commit/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e14cd392a4278223d858451a7b5cae327f76707c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e14cd392a4278223d858451a7b5cae327f76707c", "html_url": "https://github.com/rust-lang/rust/commit/e14cd392a4278223d858451a7b5cae327f76707c"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "8f757a0715f8cb0266bd1ff6adb86bc4b9f09383", "filename": "configure", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/configure", "raw_url": "https://github.com/rust-lang/rust/raw/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "patch": "@@ -731,6 +731,7 @@ do\n     make_dir $h/test/perf\n     make_dir $h/test/pretty\n     make_dir $h/test/debug-info\n+    make_dir $h/test/codegen\n     make_dir $h/test/doc-tutorial\n     make_dir $h/test/doc-tutorial-ffi\n     make_dir $h/test/doc-tutorial-macros"}, {"sha": "7a5a5dc15c30e5d08d0419a8a7dc6cfde2ebd42a", "filename": "mk/tests.mk", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "patch": "@@ -246,6 +246,7 @@ check-stage$(1)-T-$(2)-H-$(3)-exec:     \t\t\t\t\\\n         check-stage$(1)-T-$(2)-H-$(3)-crates-exec                      \\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-bench-exec\t\t\t\\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-debuginfo-exec \\\n+\tcheck-stage$(1)-T-$(2)-H-$(3)-codegen-exec \\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-doc-exec \\\n \tcheck-stage$(1)-T-$(2)-H-$(3)-pretty-exec\n \n@@ -430,6 +431,8 @@ CFAIL_RS := $(wildcard $(S)src/test/compile-fail/*.rs)\n BENCH_RS := $(wildcard $(S)src/test/bench/*.rs)\n PRETTY_RS := $(wildcard $(S)src/test/pretty/*.rs)\n DEBUGINFO_RS := $(wildcard $(S)src/test/debug-info/*.rs)\n+CODEGEN_RS := $(wildcard $(S)src/test/codegen/*.rs)\n+CODEGEN_CC := $(wildcard $(S)src/test/codegen/*.cc)\n \n # perf tests are the same as bench tests only they run under\n # a performance monitor.\n@@ -443,6 +446,7 @@ BENCH_TESTS := $(BENCH_RS)\n PERF_TESTS := $(PERF_RS)\n PRETTY_TESTS := $(PRETTY_RS)\n DEBUGINFO_TESTS := $(DEBUGINFO_RS)\n+CODEGEN_TESTS := $(CODEGEN_RS) $(CODEGEN_CC)\n \n CTEST_SRC_BASE_rpass = run-pass\n CTEST_BUILD_BASE_rpass = run-pass\n@@ -479,10 +483,19 @@ CTEST_BUILD_BASE_debuginfo = debug-info\n CTEST_MODE_debuginfo = debug-info\n CTEST_RUNTOOL_debuginfo = $(CTEST_RUNTOOL)\n \n+CTEST_SRC_BASE_codegen = codegen\n+CTEST_BUILD_BASE_codegen = codegen\n+CTEST_MODE_codegen = codegen\n+CTEST_RUNTOOL_codegen = $(CTEST_RUNTOOL)\n+\n ifeq ($(CFG_GDB),)\n CTEST_DISABLE_debuginfo = \"no gdb found\"\n endif\n \n+ifeq ($(CFG_CLANG),)\n+CTEST_DISABLE_codegen = \"no clang found\"\n+endif\n+\n ifeq ($(CFG_OSTYPE),apple-darwin)\n CTEST_DISABLE_debuginfo = \"gdb on darwing needs root\"\n endif\n@@ -507,6 +520,8 @@ CTEST_COMMON_ARGS$(1)-T-$(2)-H-$(3) :=\t\t\t\t\t\t\\\n \t\t--compile-lib-path $$(HLIB$(1)_H_$(3))\t\t\t\t\\\n         --run-lib-path $$(TLIB$(1)_T_$(2)_H_$(3))\t\t\t\\\n         --rustc-path $$(HBIN$(1)_H_$(3))/rustc$$(X_$(3))\t\t\t\\\n+        --clang-path $(if $(CFG_CLANG),$(CFG_CLANG),clang) \\\n+        --llvm-bin-path $(CFG_LLVM_INST_DIR_$(CFG_BUILD_TRIPLE))/bin \\\n         --aux-base $$(S)src/test/auxiliary/                 \\\n         --stage-id stage$(1)-$(2)\t\t\t\t\t\t\t\\\n         --target $(2)                                       \\\n@@ -522,6 +537,7 @@ CTEST_DEPS_cfail_$(1)-T-$(2)-H-$(3) = $$(CFAIL_TESTS)\n CTEST_DEPS_bench_$(1)-T-$(2)-H-$(3) = $$(BENCH_TESTS)\n CTEST_DEPS_perf_$(1)-T-$(2)-H-$(3) = $$(PERF_TESTS)\n CTEST_DEPS_debuginfo_$(1)-T-$(2)-H-$(3) = $$(DEBUGINFO_TESTS)\n+CTEST_DEPS_codegen_$(1)-T-$(2)-H-$(3) = $$(CODEGEN_TESTS)\n \n endef\n \n@@ -565,7 +581,7 @@ endif\n \n endef\n \n-CTEST_NAMES = rpass rpass-full rfail cfail bench perf debuginfo\n+CTEST_NAMES = rpass rpass-full rfail cfail bench perf debuginfo codegen\n \n $(foreach host,$(CFG_HOST_TRIPLES), \\\n  $(eval $(foreach target,$(CFG_TARGET_TRIPLES), \\\n@@ -674,6 +690,7 @@ TEST_GROUPS = \\\n \tbench \\\n \tperf \\\n \tdebuginfo \\\n+\tcodegen \\\n \tdoc \\\n \t$(foreach docname,$(DOC_TEST_NAMES),doc-$(docname)) \\\n \tpretty \\"}, {"sha": "01eae9b16bb6faf9c1cc84d8362726bcb5949cff", "filename": "src/test/codegen/hello.cc", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/src%2Ftest%2Fcodegen%2Fhello.cc", "raw_url": "https://github.com/rust-lang/rust/raw/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/src%2Ftest%2Fcodegen%2Fhello.cc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fhello.cc?ref=fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "patch": "@@ -0,0 +1,12 @@\n+#include <stddef.h>\n+\n+struct slice {\n+  char const *p;\n+  size_t len;\n+};\n+\n+extern \"C\"\n+void test() {\n+  struct slice s = { .p = \"hello\",\n+                     .len = 5 };\n+}"}, {"sha": "e7cd84f63f2b09d4c482cd02e1d2ada81def7401", "filename": "src/test/codegen/hello.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/src%2Ftest%2Fcodegen%2Fhello.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3/src%2Ftest%2Fcodegen%2Fhello.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fhello.rs?ref=fbc5bb4c0ae10ef159d1c06a40fdf2b7883083d3", "patch": "@@ -0,0 +1,4 @@\n+#[no_mangle]\n+fn test() {\n+    let _x = \"hello\";\n+}"}]}