{"sha": "f6b36c676e6b31313a8fd2b31e804bd3d6a4af73", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2YjM2YzY3NmU2YjMxMzEzYThmZDJiMzFlODA0YmQzZDZhNGFmNzM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-09-07T22:01:02Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-09-07T22:01:02Z"}, "message": "auto merge of #9046 : thestinger/rust/repr, r=alexcrichton\n\nCloses #8743", "tree": {"sha": "cd7032c60fb7b7e64c0ca4cdf2454cb4106a261e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd7032c60fb7b7e64c0ca4cdf2454cb4106a261e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73", "html_url": "https://github.com/rust-lang/rust/commit/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f8ada9acf128507106e67834c8d0d780f38636c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f8ada9acf128507106e67834c8d0d780f38636c", "html_url": "https://github.com/rust-lang/rust/commit/7f8ada9acf128507106e67834c8d0d780f38636c"}, {"sha": "f87578d9fbf37f76fc1ccd3eb92ef24f8b2a0b31", "url": "https://api.github.com/repos/rust-lang/rust/commits/f87578d9fbf37f76fc1ccd3eb92ef24f8b2a0b31", "html_url": "https://github.com/rust-lang/rust/commit/f87578d9fbf37f76fc1ccd3eb92ef24f8b2a0b31"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "9873317738d6a20ba0c0c67a2cfe9d85d7f2e4cc", "filename": "src/libstd/repr.rs", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73/src%2Flibstd%2Frepr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6b36c676e6b31313a8fd2b31e804bd3d6a4af73/src%2Flibstd%2Frepr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frepr.rs?ref=f6b36c676e6b31313a8fd2b31e804bd3d6a4af73", "patch": "@@ -178,7 +178,7 @@ impl<'self> ReprVisitor<'self> {\n     pub fn write_escaped_slice(&mut self, slice: &str) {\n         self.writer.write(['\"' as u8]);\n         for ch in slice.iter() {\n-            self.write_escaped_char(ch);\n+            self.write_escaped_char(ch, true);\n         }\n         self.writer.write(['\"' as u8]);\n     }\n@@ -230,14 +230,26 @@ impl<'self> ReprVisitor<'self> {\n                              v.fill, inner)\n     }\n \n-    fn write_escaped_char(&mut self, ch: char) {\n+    fn write_escaped_char(&mut self, ch: char, is_str: bool) {\n         match ch {\n             '\\t' => self.writer.write(\"\\\\t\".as_bytes()),\n             '\\r' => self.writer.write(\"\\\\r\".as_bytes()),\n             '\\n' => self.writer.write(\"\\\\n\".as_bytes()),\n             '\\\\' => self.writer.write(\"\\\\\\\\\".as_bytes()),\n-            '\\'' => self.writer.write(\"\\\\'\".as_bytes()),\n-            '\"' => self.writer.write(\"\\\\\\\"\".as_bytes()),\n+            '\\'' => {\n+                if is_str {\n+                    self.writer.write(\"'\".as_bytes())\n+                } else {\n+                    self.writer.write(\"\\\\'\".as_bytes())\n+                }\n+            }\n+            '\"' => {\n+                if is_str {\n+                    self.writer.write(\"\\\\\\\"\".as_bytes())\n+                } else {\n+                    self.writer.write(\"\\\"\".as_bytes())\n+                }\n+            }\n             '\\x20'..'\\x7e' => self.writer.write([ch as u8]),\n             _ => {\n                 do char::escape_unicode(ch) |c| {\n@@ -274,7 +286,7 @@ impl<'self> TyVisitor for ReprVisitor<'self> {\n     fn visit_char(&mut self) -> bool {\n         do self.get::<char> |this, &ch| {\n             this.writer.write(['\\'' as u8]);\n-            this.write_escaped_char(ch);\n+            this.write_escaped_char(ch, false);\n             this.writer.write(['\\'' as u8]);\n         }\n     }\n@@ -684,6 +696,11 @@ fn test_repr() {\n     exact_test(&(10u64, ~\"hello\"),\n                \"(10u64, ~\\\"hello\\\")\");\n \n+    exact_test(&'\\'', \"'\\\\''\");\n+    exact_test(&'\"', \"'\\\"'\");\n+    exact_test(&(\"'\"), \"\\\"'\\\"\");\n+    exact_test(&(\"\\\"\"), \"\\\"\\\\\\\"\\\"\");\n+\n     exact_test(&println, \"fn(&str)\");\n     exact_test(&swap::<int>, \"fn(&mut int, &mut int)\");\n     exact_test(&is_alphabetic, \"fn(char) -> bool\");"}]}