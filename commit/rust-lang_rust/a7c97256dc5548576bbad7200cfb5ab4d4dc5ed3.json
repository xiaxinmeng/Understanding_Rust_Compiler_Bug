{"sha": "a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3Yzk3MjU2ZGM1NTQ4NTc2YmJhZDcyMDBjZmI1YWI0ZDRkYzVlZDM=", "commit": {"author": {"name": "bootandy", "email": "bootandy@gmail.com", "date": "2018-02-21T16:25:18Z"}, "committer": {"name": "bootandy", "email": "bootandy@gmail.com", "date": "2018-02-21T16:29:08Z"}, "message": "Stop unwanted newlines being applied on unwrap_or", "tree": {"sha": "a4701fb8e444624d5ec22e8a958564491448faec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4701fb8e444624d5ec22e8a958564491448faec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "html_url": "https://github.com/rust-lang/rust/commit/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/comments", "author": {"login": "bootandy", "id": 311785, "node_id": "MDQ6VXNlcjMxMTc4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/311785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bootandy", "html_url": "https://github.com/bootandy", "followers_url": "https://api.github.com/users/bootandy/followers", "following_url": "https://api.github.com/users/bootandy/following{/other_user}", "gists_url": "https://api.github.com/users/bootandy/gists{/gist_id}", "starred_url": "https://api.github.com/users/bootandy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bootandy/subscriptions", "organizations_url": "https://api.github.com/users/bootandy/orgs", "repos_url": "https://api.github.com/users/bootandy/repos", "events_url": "https://api.github.com/users/bootandy/events{/privacy}", "received_events_url": "https://api.github.com/users/bootandy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bootandy", "id": 311785, "node_id": "MDQ6VXNlcjMxMTc4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/311785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bootandy", "html_url": "https://github.com/bootandy", "followers_url": "https://api.github.com/users/bootandy/followers", "following_url": "https://api.github.com/users/bootandy/following{/other_user}", "gists_url": "https://api.github.com/users/bootandy/gists{/gist_id}", "starred_url": "https://api.github.com/users/bootandy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bootandy/subscriptions", "organizations_url": "https://api.github.com/users/bootandy/orgs", "repos_url": "https://api.github.com/users/bootandy/repos", "events_url": "https://api.github.com/users/bootandy/events{/privacy}", "received_events_url": "https://api.github.com/users/bootandy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c708154c168dd198d0127f1a891dcbdba1796e2c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c708154c168dd198d0127f1a891dcbdba1796e2c", "html_url": "https://github.com/rust-lang/rust/commit/c708154c168dd198d0127f1a891dcbdba1796e2c"}], "stats": {"total": 64, "additions": 31, "deletions": 33}, "files": [{"sha": "1c02f73cc1a84f01bae2a510bf9c87133c2e6d1e", "filename": "clippy_lints/src/methods.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/clippy_lints%2Fsrc%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/clippy_lints%2Fsrc%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods.rs?ref=a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "patch": "@@ -691,7 +691,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n         }\n \n         match expr.node {\n-            hir::ExprMethodCall(ref method_call, _, ref args) => {\n+            hir::ExprMethodCall(ref method_call, ref method_span, ref args) => {\n                 // Chain calls\n                 // GET_UNWRAP needs to be checked before general `UNWRAP` lints\n                 if let Some(arglists) = method_chain_args(expr, &[\"get\", \"unwrap\"]) {\n@@ -744,7 +744,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                     lint_unnecessary_fold(cx, expr, arglists[0]);\n                 }\n \n-                lint_or_fun_call(cx, expr, &method_call.name.as_str(), args);\n+                lint_or_fun_call(cx, expr, method_span, &method_call.name.as_str(), args);\n \n                 let self_ty = cx.tables.expr_ty_adjusted(&args[0]);\n                 if args.len() == 1 && method_call.name == \"clone\" {\n@@ -845,7 +845,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n }\n \n /// Checks for the `OR_FUN_CALL` lint.\n-fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir::Expr]) {\n+fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, method_span: &Span, name: &str, args: &[hir::Expr]) {\n     /// Check for `unwrap_or(T::new())` or `unwrap_or(T::default())`.\n     fn check_unwrap_or_default(\n         cx: &LateContext,\n@@ -894,6 +894,7 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n     fn check_general_case(\n         cx: &LateContext,\n         name: &str,\n+        method_span: &Span,\n         fun_span: Span,\n         self_expr: &hir::Expr,\n         arg: &hir::Expr,\n@@ -913,8 +914,6 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n             return;\n         }\n \n-        let span_replace_word = self_expr.span.with_lo(span.hi());\n-\n         // don't lint for constant values\n         let owner_def = cx.tcx.hir.get_parent_did(arg.id);\n         let promotable = cx.tcx.rvalue_promotable_map(owner_def).contains(&arg.hir_id.local_id);\n@@ -941,13 +940,14 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n             (false, false) => format!(\"|| {}\", snippet(cx, arg.span, \"..\")).into(),\n             (false, true) => snippet(cx, fun_span, \"..\"),\n         };\n+        let span_replace_word = method_span.with_hi(span.hi());\n         span_lint_and_sugg(\n             cx,\n             OR_FUN_CALL,\n             span_replace_word,\n             &format!(\"use of `{}` followed by a function call\", name),\n             \"try this\",\n-            format!(\".{}_{}({})\", name, suffix, sugg),\n+            format!(\"{}_{}({})\", name, suffix, sugg),\n         );\n     }\n \n@@ -956,11 +956,11 @@ fn lint_or_fun_call(cx: &LateContext, expr: &hir::Expr, name: &str, args: &[hir:\n             hir::ExprCall(ref fun, ref or_args) => {\n                 let or_has_args = !or_args.is_empty();\n                 if !check_unwrap_or_default(cx, name, fun, &args[0], &args[1], or_has_args, expr.span) {\n-                    check_general_case(cx, name, fun.span, &args[0], &args[1], or_has_args, expr.span);\n+                    check_general_case(cx, name, method_span, fun.span, &args[0], &args[1], or_has_args, expr.span);\n                 }\n             },\n             hir::ExprMethodCall(_, span, ref or_args) => {\n-                check_general_case(cx, name, span, &args[0], &args[1], !or_args.is_empty(), expr.span)\n+                check_general_case(cx, name, method_span, span, &args[0], &args[1], !or_args.is_empty(), expr.span)\n             },\n             _ => {},\n         }"}, {"sha": "42cf3d3cbc55edd00b7d26dd12f0a850625113ec", "filename": "tests/ui/methods.stderr", "status": "modified", "additions": 18, "deletions": 18, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/tests%2Fui%2Fmethods.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/tests%2Fui%2Fmethods.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmethods.stderr?ref=a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "patch": "@@ -350,10 +350,10 @@ error: unnecessary structure name repetition\n     |                     ^^^ help: use the applicable keyword: `Self`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:307:21\n+   --> $DIR/methods.rs:307:22\n     |\n 307 |     with_constructor.unwrap_or(make());\n-    |                     ^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(make)`\n+    |                      ^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(make)`\n     |\n     = note: `-D or-fun-call` implied by `-D warnings`\n \n@@ -364,22 +364,22 @@ error: use of `unwrap_or` followed by a call to `new`\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `with_new.unwrap_or_default()`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:313:20\n+   --> $DIR/methods.rs:313:21\n     |\n 313 |     with_const_args.unwrap_or(Vec::with_capacity(12));\n-    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|| Vec::with_capacity(12))`\n+    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| Vec::with_capacity(12))`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:316:13\n+   --> $DIR/methods.rs:316:14\n     |\n 316 |     with_err.unwrap_or(make());\n-    |             ^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|_| make())`\n+    |              ^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|_| make())`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:319:18\n+   --> $DIR/methods.rs:319:19\n     |\n 319 |     with_err_args.unwrap_or(Vec::with_capacity(12));\n-    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|_| Vec::with_capacity(12))`\n+    |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|_| Vec::with_capacity(12))`\n \n error: use of `unwrap_or` followed by a call to `default`\n    --> $DIR/methods.rs:322:5\n@@ -394,34 +394,34 @@ error: use of `unwrap_or` followed by a call to `default`\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `with_default_type.unwrap_or_default()`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:328:13\n+   --> $DIR/methods.rs:328:14\n     |\n 328 |     with_vec.unwrap_or(vec![]);\n-    |             ^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|| < [ _ ] > :: into_vec ( box [ $ ( $ x ) , * ] ))`\n+    |              ^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| < [ _ ] > :: into_vec ( box [ $ ( $ x ) , * ] ))`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:333:20\n+   --> $DIR/methods.rs:333:21\n     |\n 333 |     without_default.unwrap_or(Foo::new());\n-    |                    ^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(Foo::new)`\n+    |                     ^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(Foo::new)`\n \n error: use of `or_insert` followed by a function call\n-   --> $DIR/methods.rs:336:18\n+   --> $DIR/methods.rs:336:19\n     |\n 336 |     map.entry(42).or_insert(String::new());\n-    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.or_insert_with(String::new)`\n+    |                   ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(String::new)`\n \n error: use of `or_insert` followed by a function call\n-   --> $DIR/methods.rs:339:20\n+   --> $DIR/methods.rs:339:21\n     |\n 339 |     btree.entry(42).or_insert(String::new());\n-    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.or_insert_with(String::new)`\n+    |                     ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(String::new)`\n \n error: use of `unwrap_or` followed by a function call\n-   --> $DIR/methods.rs:342:20\n+   --> $DIR/methods.rs:342:21\n     |\n 342 |     let _ = stringy.unwrap_or(\"\".to_owned());\n-    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|| \"\".to_owned())`\n+    |                     ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| \"\".to_owned())`\n \n error: called `.iter().nth()` on a Vec. Calling `.get()` is both faster and more readable\n    --> $DIR/methods.rs:353:23"}, {"sha": "e4704dd0e43787e33e3f68a53e291f101d98b99a", "filename": "tests/ui/unwrap_or.stderr", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/tests%2Fui%2Funwrap_or.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3/tests%2Fui%2Funwrap_or.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funwrap_or.stderr?ref=a7c97256dc5548576bbad7200cfb5ab4d4dc5ed3", "patch": "@@ -1,18 +1,16 @@\n error: use of `unwrap_or` followed by a function call\n- --> $DIR/unwrap_or.rs:4:46\n+ --> $DIR/unwrap_or.rs:4:47\n   |\n 4 |     let s = Some(String::from(\"test string\")).unwrap_or(\"Fail\".to_string()).len();\n-  |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `.unwrap_or_else(|| \"Fail\".to_string())`\n+  |                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| \"Fail\".to_string())`\n   |\n   = note: `-D or-fun-call` implied by `-D warnings`\n \n error: use of `unwrap_or` followed by a function call\n- --> $DIR/unwrap_or.rs:8:46\n+ --> $DIR/unwrap_or.rs:9:10\n   |\n-8 |       let s = Some(String::from(\"test string\"))\n-  |  ______________________________________________^\n-9 | |         .unwrap_or(\"Fail\".to_string())\n-  | |______________________________________^ help: try this: `.unwrap_or_else(|| \"Fail\".to_string())`\n+9 |         .unwrap_or(\"Fail\".to_string())\n+  |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| \"Fail\".to_string())`\n \n error: aborting due to 2 previous errors\n "}]}