{"sha": "5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "node_id": "C_kwDOAAsO6NoAKDVhZmMyNjFjNjY4OTZlZDNkMTRmOWQ5ZWNjYmM3YTEwOTBkMzc5ZDM", "commit": {"author": {"name": "Kartavya Vashishtha", "email": "sendtokartavya@gmail.com", "date": "2022-08-29T18:39:25Z"}, "committer": {"name": "Kartavya Vashishtha", "email": "sendtokartavya@gmail.com", "date": "2022-09-15T04:11:06Z"}, "message": "Add iter_kv_map lint", "tree": {"sha": "0af85ca7b48aa7464d3f980db8adb7bd6b1f7c60", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0af85ca7b48aa7464d3f980db8adb7bd6b1f7c60"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE+fRQYdEX7Emd36W/pQASwjJOXfAFAmMipfMACgkQpQASwjJO\nXfA2aA//cVUk6R8v2jOAA8JOp4aMxOI1ymxOZcJnvkT+zRq73vqomcV9toVK/7ST\n+sBvvyRoVOW8rVeoGITo/cncMxsFfKGpwwMvPQ7fDNn7nvv23euhCOur5lXBQ/qm\nCdjspyGOGp8//iFLA73CHrYeMuNC5GQG8d05LwPTaTVdhrthCen4E4s8jm/ie7GI\n52vWGSn8z0EIZ6tDVNCRBJb4uu/el3772Sv7Lu7xZa3zj7TwKKcN0HP1V62fCLXA\nLIuzemfGv5+GbC3Tn5v9CzPaGPlJH+X4ElmHCQM3mJw3xuLr76s9341mFPrQXtpd\nWc6Oxpm6veRVniQUa3gm3mB4KX8CYHLxbWEWRIXd816Sp9/0yHeeNfYcyxcF0Mxr\nTLVJm7ckjxyAFYX7TksoneaiPX7syyBNLGw2bWn3q8bpToGYxhav8YaHSOI88anY\nD5dti+uEEHSaO4eiy8+PBR4Wzz7w3Uu5DO6WN0yftouW9VoJijrmUKbO7k5JYDPQ\nzVKdFxL1KPy/DXSCenDiEktwXR9Z8IRgjfZju4boeN/I8MzoAYhGV3EisTu4xMti\ndy0gted4As3rZsZ2mKfx68Fqg6TEbR2Ph52wX04RUhKcoClgEcIOKIeJRwTASll4\n0bZ7ucZrKq7YHDPTAxwrZtBoo/Nj3IQ+cF8wknHBNwgKrlmGnVw=\n=EZAI\n-----END PGP SIGNATURE-----", "payload": "tree 0af85ca7b48aa7464d3f980db8adb7bd6b1f7c60\nparent 69f6009f855e33b5685f5b4c4fff479cee53410f\nauthor Kartavya Vashishtha <sendtokartavya@gmail.com> 1661798365 +0530\ncommitter Kartavya Vashishtha <sendtokartavya@gmail.com> 1663215066 +0530\n\nAdd iter_kv_map lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "html_url": "https://github.com/rust-lang/rust/commit/5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/comments", "author": {"login": "DesmondWillowbrook", "id": 51814158, "node_id": "MDQ6VXNlcjUxODE0MTU4", "avatar_url": "https://avatars.githubusercontent.com/u/51814158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DesmondWillowbrook", "html_url": "https://github.com/DesmondWillowbrook", "followers_url": "https://api.github.com/users/DesmondWillowbrook/followers", "following_url": "https://api.github.com/users/DesmondWillowbrook/following{/other_user}", "gists_url": "https://api.github.com/users/DesmondWillowbrook/gists{/gist_id}", "starred_url": "https://api.github.com/users/DesmondWillowbrook/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DesmondWillowbrook/subscriptions", "organizations_url": "https://api.github.com/users/DesmondWillowbrook/orgs", "repos_url": "https://api.github.com/users/DesmondWillowbrook/repos", "events_url": "https://api.github.com/users/DesmondWillowbrook/events{/privacy}", "received_events_url": "https://api.github.com/users/DesmondWillowbrook/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DesmondWillowbrook", "id": 51814158, "node_id": "MDQ6VXNlcjUxODE0MTU4", "avatar_url": "https://avatars.githubusercontent.com/u/51814158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DesmondWillowbrook", "html_url": "https://github.com/DesmondWillowbrook", "followers_url": "https://api.github.com/users/DesmondWillowbrook/followers", "following_url": "https://api.github.com/users/DesmondWillowbrook/following{/other_user}", "gists_url": "https://api.github.com/users/DesmondWillowbrook/gists{/gist_id}", "starred_url": "https://api.github.com/users/DesmondWillowbrook/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DesmondWillowbrook/subscriptions", "organizations_url": "https://api.github.com/users/DesmondWillowbrook/orgs", "repos_url": "https://api.github.com/users/DesmondWillowbrook/repos", "events_url": "https://api.github.com/users/DesmondWillowbrook/events{/privacy}", "received_events_url": "https://api.github.com/users/DesmondWillowbrook/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69f6009f855e33b5685f5b4c4fff479cee53410f", "url": "https://api.github.com/repos/rust-lang/rust/commits/69f6009f855e33b5685f5b4c4fff479cee53410f", "html_url": "https://github.com/rust-lang/rust/commit/69f6009f855e33b5685f5b4c4fff479cee53410f"}], "stats": {"total": 428, "additions": 428, "deletions": 0}, "files": [{"sha": "044cbff4b78e5a8156384bbc18e7a0d0a25ecb7c", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -3800,6 +3800,7 @@ Released 2018-09-13\n [`items_after_statements`]: https://rust-lang.github.io/rust-clippy/master/index.html#items_after_statements\n [`iter_cloned_collect`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_cloned_collect\n [`iter_count`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_count\n+[`iter_kv_map`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_kv_map\n [`iter_next_loop`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_next_loop\n [`iter_next_slice`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_next_slice\n [`iter_not_returning_iterator`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_not_returning_iterator"}, {"sha": "3e9af5a4d455cb6b81c1b54f8b635f1dbb47977e", "filename": "clippy_lints/src/lib.register_all.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_all.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -171,6 +171,7 @@ store.register_group(true, \"clippy::all\", Some(\"clippy_all\"), vec![\n     LintId::of(methods::ITERATOR_STEP_BY_ZERO),\n     LintId::of(methods::ITER_CLONED_COLLECT),\n     LintId::of(methods::ITER_COUNT),\n+    LintId::of(methods::ITER_KV_MAP),\n     LintId::of(methods::ITER_NEXT_SLICE),\n     LintId::of(methods::ITER_NTH),\n     LintId::of(methods::ITER_NTH_ZERO),"}, {"sha": "185189a6af5b63f02de49bb0384e59f5c4553af8", "filename": "clippy_lints/src/lib.register_complexity.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_complexity.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -40,6 +40,7 @@ store.register_group(true, \"clippy::complexity\", Some(\"clippy_complexity\"), vec!\n     LintId::of(methods::GET_LAST_WITH_LEN),\n     LintId::of(methods::INSPECT_FOR_EACH),\n     LintId::of(methods::ITER_COUNT),\n+    LintId::of(methods::ITER_KV_MAP),\n     LintId::of(methods::MANUAL_FILTER_MAP),\n     LintId::of(methods::MANUAL_FIND_MAP),\n     LintId::of(methods::MANUAL_SPLIT_ONCE),"}, {"sha": "446bc762fb476216ff288e1185470a304ae1e811", "filename": "clippy_lints/src/lib.register_lints.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Flib.register_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_lints.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -313,6 +313,7 @@ store.register_lints(&[\n     methods::ITERATOR_STEP_BY_ZERO,\n     methods::ITER_CLONED_COLLECT,\n     methods::ITER_COUNT,\n+    methods::ITER_KV_MAP,\n     methods::ITER_NEXT_SLICE,\n     methods::ITER_NTH,\n     methods::ITER_NTH_ZERO,"}, {"sha": "a7eecabd68495093b54fb67c0924caaa41c8acf0", "filename": "clippy_lints/src/methods/iter_kv_map.rs", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Fmethods%2Fiter_kv_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Fmethods%2Fiter_kv_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fiter_kv_map.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -0,0 +1,87 @@\n+#![allow(unused_imports)]\n+\n+use super::ITER_KV_MAP;\n+use clippy_utils::diagnostics::{multispan_sugg, span_lint_and_sugg, span_lint_and_then};\n+use clippy_utils::source::{snippet, snippet_with_applicability};\n+use clippy_utils::sugg;\n+use clippy_utils::ty::is_type_diagnostic_item;\n+use clippy_utils::visitors::is_local_used;\n+use rustc_hir::{BindingAnnotation, Body, BorrowKind, Expr, ExprKind, Mutability, Pat, PatKind};\n+use rustc_lint::{LateContext, LintContext};\n+use rustc_middle::ty;\n+use rustc_span::sym;\n+use rustc_span::Span;\n+\n+/// lint use of:\n+/// - `hashmap.iter().map(|(_, v)| v)`\n+/// - `hashmap.into_iter().map(|(_, v)| v)`\n+/// on `HashMaps` and `BTreeMaps` in std\n+\n+pub(super) fn check<'tcx>(\n+    cx: &LateContext<'tcx>,\n+    map_type: &'tcx str,     // iter / into_iter\n+    expr: &'tcx Expr<'tcx>,  // .iter().map(|(_, v_| v))\n+    recv: &'tcx Expr<'tcx>,  // hashmap\n+    m_arg: &'tcx Expr<'tcx>, // |(_, v)| v\n+) {\n+    if_chain! {\n+        if !expr.span.from_expansion();\n+        if let ExprKind::Closure(c) = m_arg.kind;\n+        if let Body {params: [p], value: body_expr, generator_kind: _ } = cx.tcx.hir().body(c.body);\n+        if let PatKind::Tuple([key_pat, val_pat], _) = p.pat.kind;\n+\n+        let (replacement_kind, binded_ident) = match (&key_pat.kind, &val_pat.kind) {\n+            (key, PatKind::Binding(_, _, value, _)) if pat_is_wild(cx, key, m_arg) => (\"value\", value),\n+            (PatKind::Binding(_, _, key, _), value) if pat_is_wild(cx, value, m_arg) => (\"key\", key),\n+            _ => return,\n+        };\n+\n+        let ty = cx.typeck_results().expr_ty(recv);\n+        if is_type_diagnostic_item(cx, ty, sym::HashMap) || is_type_diagnostic_item(cx, ty, sym::BTreeMap);\n+\n+        then {\n+            let mut applicability = rustc_errors::Applicability::MachineApplicable;\n+            let recv_snippet = snippet_with_applicability(cx, recv.span, \"map\", &mut applicability);\n+            let into_prefix = if map_type == \"into_iter\" {\"into_\"} else {\"\"};\n+\n+            if_chain! {\n+                if let ExprKind::Path(rustc_hir::QPath::Resolved(_, path)) = body_expr.kind;\n+                if let [local_ident] = path.segments;\n+                if local_ident.ident.as_str() == binded_ident.as_str();\n+\n+                then {\n+                    span_lint_and_sugg(\n+                        cx,\n+                        ITER_KV_MAP,\n+                        expr.span,\n+                        &format!(\"iterating on a map's {}s\", replacement_kind),\n+                        \"try\",\n+                        format!(\"{}.{}{}s()\", recv_snippet, into_prefix, replacement_kind),\n+                        applicability,\n+                    );\n+                } else {\n+                    span_lint_and_sugg(\n+                        cx,\n+                        ITER_KV_MAP,\n+                        expr.span,\n+                        &format!(\"iterating on a map's {}s\", replacement_kind),\n+                        \"try\",\n+                        format!(\"{}.{}{}s().map(|{}| {})\", recv_snippet, into_prefix, replacement_kind, binded_ident,\n+                            snippet_with_applicability(cx, body_expr.span, \"/* body */\", &mut applicability)),\n+                        applicability,\n+                    );\n+                }\n+            }\n+        }\n+    }\n+}\n+\n+/// Returns `true` if the pattern is a `PatWild`, or is an ident prefixed with `_`\n+/// that is not locally used.\n+fn pat_is_wild<'tcx>(cx: &LateContext<'tcx>, pat: &'tcx PatKind<'_>, body: &'tcx Expr<'_>) -> bool {\n+    match *pat {\n+        PatKind::Wild => true,\n+        PatKind::Binding(_, id, ident, None) if ident.as_str().starts_with('_') => !is_local_used(cx, body, id),\n+        _ => false,\n+    }\n+}"}, {"sha": "cdde4c54d6378d283c1ff22262d6062e3794f535", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -35,6 +35,7 @@ mod into_iter_on_ref;\n mod is_digit_ascii_radix;\n mod iter_cloned_collect;\n mod iter_count;\n+mod iter_kv_map;\n mod iter_next_slice;\n mod iter_nth;\n mod iter_nth_zero;\n@@ -3036,6 +3037,37 @@ declare_clippy_lint! {\n     \"use of `File::read_to_end` or `File::read_to_string`\"\n }\n \n+declare_clippy_lint! {\n+    /// ### What it does\n+    ///\n+    /// Checks for iterating a map (`HashMap` or `BTreeMap`) and\n+    /// ignoring either the keys or values.\n+    ///\n+    /// ### Why is this bad?\n+    ///\n+    /// Readability. There are `keys` and `values` methods that\n+    /// can be used to express that we only need the keys or the values.\n+    ///\n+    /// ### Example\n+    ///\n+    /// ```\n+    /// # use std::collections::HashMap;\n+    /// let map: HashMap<u32, u32> = HashMap::new();\n+    /// let values = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+    /// ```\n+    ///\n+    /// Use instead:\n+    /// ```\n+    /// # use std::collections::HashMap;\n+    /// let map: HashMap<u32, u32> = HashMap::new();\n+    /// let values = map.values().collect::<Vec<_>>();\n+    /// ```\n+    #[clippy::version = \"1.65.0\"]\n+    pub ITER_KV_MAP,\n+    complexity,\n+    \"iterating on map using `iter` when `keys` or `values` would do\"\n+}\n+\n pub struct Methods {\n     avoid_breaking_exported_api: bool,\n     msrv: Option<RustcVersion>,\n@@ -3159,6 +3191,7 @@ impl_lint_pass!(Methods => [\n     UNNECESSARY_SORT_BY,\n     VEC_RESIZE_TO_ZERO,\n     VERBOSE_FILE_READS,\n+    ITER_KV_MAP,\n ]);\n \n /// Extracts a method call name, args, and `Span` of the method name.\n@@ -3498,6 +3531,9 @@ impl Methods {\n                 (name @ (\"map\" | \"map_err\"), [m_arg]) => {\n                     if name == \"map\" {\n                         map_clone::check(cx, expr, recv, m_arg, self.msrv);\n+                        if let Some((map_name @ (\"iter\" | \"into_iter\"), recv2, _, _)) = method_call(recv) {\n+                            iter_kv_map::check(cx, map_name, expr, recv2, m_arg);\n+                        }\n                     } else {\n                         map_err_ignore::check(cx, expr, m_arg);\n                     }"}, {"sha": "036dd0078567e681b5790415250afe59a237d49b", "filename": "src/docs.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/src%2Fdocs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/src%2Fdocs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdocs.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -221,6 +221,7 @@ docs! {\n     \"items_after_statements\",\n     \"iter_cloned_collect\",\n     \"iter_count\",\n+    \"iter_kv_map\",\n     \"iter_next_loop\",\n     \"iter_next_slice\",\n     \"iter_not_returning_iterator\","}, {"sha": "a063c8195ef57f1d893d3662ab0bd90f2005ef4e", "filename": "src/docs/iter_kv_map.txt", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/src%2Fdocs%2Fiter_kv_map.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/src%2Fdocs%2Fiter_kv_map.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdocs%2Fiter_kv_map.txt?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -0,0 +1,22 @@\n+### What it does\n+\n+Checks for iterating a map (`HashMap` or `BTreeMap`) and\n+ignoring either the keys or values.\n+\n+### Why is this bad?\n+\n+Readability. There are `keys` and `values` methods that\n+can be used to express that we only need the keys or the values.\n+\n+### Example\n+\n+```\n+let map: HashMap<u32, u32> = HashMap::new();\n+let values = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+```\n+\n+Use instead:\n+```\n+let map: HashMap<u32, u32> = HashMap::new();\n+let values = map.values().collect::<Vec<_>>();\n+```\n\\ No newline at end of file"}, {"sha": "cf1292ecc23fb41a2ec6813bdc36f7a059d21dcc", "filename": "tests/ui/iter_kv_map.fixed", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_kv_map.fixed?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -0,0 +1,65 @@\n+// run-rustfix\n+\n+#![warn(clippy::iter_kv_map)]\n+#![allow(clippy::redundant_clone)]\n+#![allow(clippy::suspicious_map)]\n+\n+use std::collections::{BTreeMap, HashMap};\n+\n+fn main() {\n+    let get_key = |(key, _val)| key;\n+\n+    let map: HashMap<u32, u32> = HashMap::new();\n+\n+    let _ = map.keys().collect::<Vec<_>>();\n+    let _ = map.values().collect::<Vec<_>>();\n+    let _ = map.values().map(|v| v + 2).collect::<Vec<_>>();\n+    let _ = map.values().map(|val| {val}).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_keys().collect::<Vec<_>>();\n+    let _ = map.clone().into_keys().map(|key| key + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_values().collect::<Vec<_>>();\n+    let _ = map.clone().into_values().map(|val| val + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().values().collect::<Vec<_>>();\n+    map.keys().filter(|x| *x % 2 == 0).count();\n+\n+    // Don't lint\n+    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();\n+    map.iter().map(get_key).collect::<Vec<_>>();\n+\n+    // Linting the following could be an improvement to the lint\n+    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();\n+\n+    // Lint\n+    map.keys().map(|key| key * 9).count();\n+    map.values().map(|value| value * 17).count();\n+\n+    let map: BTreeMap<u32, u32> = BTreeMap::new();\n+\n+    let _ = map.keys().collect::<Vec<_>>();\n+    let _ = map.values().collect::<Vec<_>>();\n+    let _ = map.values().map(|v| v + 2).collect::<Vec<_>>();\n+    let _ = map.values().map(|val| {val}).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_keys().collect::<Vec<_>>();\n+    let _ = map.clone().into_keys().map(|key| key + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_values().collect::<Vec<_>>();\n+    let _ = map.clone().into_values().map(|val| val + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().values().collect::<Vec<_>>();\n+    map.keys().filter(|x| *x % 2 == 0).count();\n+\n+    // Don't lint\n+    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();\n+    map.iter().map(get_key).collect::<Vec<_>>();\n+\n+    // Linting the following could be an improvement to the lint\n+    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();\n+\n+    // Lint\n+    map.keys().map(|key| key * 9).count();\n+    map.values().map(|value| value * 17).count();\n+}"}, {"sha": "b27e559e8e5bd3f569cfe05309550f83fd04fba6", "filename": "tests/ui/iter_kv_map.rs", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_kv_map.rs?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -0,0 +1,65 @@\n+// run-rustfix\n+\n+#![warn(clippy::iter_kv_map)]\n+#![allow(clippy::redundant_clone)]\n+#![allow(clippy::suspicious_map)]\n+\n+use std::collections::{BTreeMap, HashMap};\n+\n+fn main() {\n+    let get_key = |(key, _val)| key;\n+\n+    let map: HashMap<u32, u32> = HashMap::new();\n+\n+    let _ = map.iter().map(|(key, _)| key).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, v)| v + 2).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, val)| val).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_iter().map(|(key, _)| key).collect::<Vec<_>>();\n+    let _ = map.clone().into_iter().map(|(key, _)| key + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_iter().map(|(_, val)| val).collect::<Vec<_>>();\n+    let _ = map.clone().into_iter().map(|(_, val)| val + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().iter().map(|(_, val)| val).collect::<Vec<_>>();\n+    map.iter().map(|(key, _)| key).filter(|x| *x % 2 == 0).count();\n+\n+    // Don't lint\n+    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();\n+    map.iter().map(get_key).collect::<Vec<_>>();\n+\n+    // Linting the following could be an improvement to the lint\n+    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();\n+\n+    // Lint\n+    map.iter().map(|(key, _value)| key * 9).count();\n+    map.iter().map(|(_key, value)| value * 17).count();\n+\n+    let map: BTreeMap<u32, u32> = BTreeMap::new();\n+\n+    let _ = map.iter().map(|(key, _)| key).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, v)| v + 2).collect::<Vec<_>>();\n+    let _ = map.iter().map(|(_, val)| val).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_iter().map(|(key, _)| key).collect::<Vec<_>>();\n+    let _ = map.clone().into_iter().map(|(key, _)| key + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().into_iter().map(|(_, val)| val).collect::<Vec<_>>();\n+    let _ = map.clone().into_iter().map(|(_, val)| val + 2).collect::<Vec<_>>();\n+\n+    let _ = map.clone().iter().map(|(_, val)| val).collect::<Vec<_>>();\n+    map.iter().map(|(key, _)| key).filter(|x| *x % 2 == 0).count();\n+\n+    // Don't lint\n+    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();\n+    map.iter().map(get_key).collect::<Vec<_>>();\n+\n+    // Linting the following could be an improvement to the lint\n+    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();\n+\n+    // Lint\n+    map.iter().map(|(key, _value)| key * 9).count();\n+    map.iter().map(|(_key, value)| value * 17).count();\n+}"}, {"sha": "a6697e423e7cda784c057923dc76841b730d795d", "filename": "tests/ui/iter_kv_map.stderr", "status": "added", "additions": 148, "deletions": 0, "changes": 148, "blob_url": "https://github.com/rust-lang/rust/blob/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5afc261c66896ed3d14f9d9eccbc7a1090d379d3/tests%2Fui%2Fiter_kv_map.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_kv_map.stderr?ref=5afc261c66896ed3d14f9d9eccbc7a1090d379d3", "patch": "@@ -0,0 +1,148 @@\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:14:13\n+   |\n+LL |     let _ = map.iter().map(|(key, _)| key).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys()`\n+   |\n+   = note: `-D clippy::iter-kv-map` implied by `-D warnings`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:15:13\n+   |\n+LL |     let _ = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values()`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:16:13\n+   |\n+LL |     let _ = map.iter().map(|(_, v)| v + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|v| v + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:17:13\n+   |\n+LL |     let _ = map.iter().map(|(_, val)| {val}).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|val| {val})`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:19:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(key, _)| key).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_keys()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:20:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(key, _)| key + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_keys().map(|key| key + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:22:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(_, val)| val).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_values()`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:23:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(_, val)| val + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_values().map(|val| val + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:25:13\n+   |\n+LL |     let _ = map.clone().iter().map(|(_, val)| val).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().values()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:26:5\n+   |\n+LL |     map.iter().map(|(key, _)| key).filter(|x| *x % 2 == 0).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:36:5\n+   |\n+LL |     map.iter().map(|(key, _value)| key * 9).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys().map(|key| key * 9)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:37:5\n+   |\n+LL |     map.iter().map(|(_key, value)| value * 17).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|value| value * 17)`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:41:13\n+   |\n+LL |     let _ = map.iter().map(|(key, _)| key).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys()`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:42:13\n+   |\n+LL |     let _ = map.iter().map(|(_, value)| value).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values()`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:43:13\n+   |\n+LL |     let _ = map.iter().map(|(_, v)| v + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|v| v + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:44:13\n+   |\n+LL |     let _ = map.iter().map(|(_, val)| {val}).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|val| {val})`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:46:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(key, _)| key).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_keys()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:47:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(key, _)| key + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_keys().map(|key| key + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:49:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(_, val)| val).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_values()`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:50:13\n+   |\n+LL |     let _ = map.clone().into_iter().map(|(_, val)| val + 2).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().into_values().map(|val| val + 2)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:52:13\n+   |\n+LL |     let _ = map.clone().iter().map(|(_, val)| val).collect::<Vec<_>>();\n+   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.clone().values()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:53:5\n+   |\n+LL |     map.iter().map(|(key, _)| key).filter(|x| *x % 2 == 0).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys()`\n+\n+error: iterating on a map's keys\n+  --> $DIR/iter_kv_map.rs:63:5\n+   |\n+LL |     map.iter().map(|(key, _value)| key * 9).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.keys().map(|key| key * 9)`\n+\n+error: iterating on a map's values\n+  --> $DIR/iter_kv_map.rs:64:5\n+   |\n+LL |     map.iter().map(|(_key, value)| value * 17).count();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `map.values().map(|value| value * 17)`\n+\n+error: aborting due to 24 previous errors\n+"}]}