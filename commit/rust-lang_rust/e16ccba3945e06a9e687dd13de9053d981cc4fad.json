{"sha": "e16ccba3945e06a9e687dd13de9053d981cc4fad", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxNmNjYmEzOTQ1ZTA2YTllNjg3ZGQxM2RlOTA1M2Q5ODFjYzRmYWQ=", "commit": {"author": {"name": "Muhammad Mominul Huque", "email": "mominul2082@gmail.com", "date": "2021-04-23T11:04:45Z"}, "committer": {"name": "Muhammad Mominul Huque", "email": "mominul2082@gmail.com", "date": "2021-04-23T11:04:45Z"}, "message": "Support -Ctarget-cpu", "tree": {"sha": "72a11a36015b4f777a0550a42c83fa63c5c2c939", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72a11a36015b4f777a0550a42c83fa63c5c2c939"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e16ccba3945e06a9e687dd13de9053d981cc4fad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e16ccba3945e06a9e687dd13de9053d981cc4fad", "html_url": "https://github.com/rust-lang/rust/commit/e16ccba3945e06a9e687dd13de9053d981cc4fad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e16ccba3945e06a9e687dd13de9053d981cc4fad/comments", "author": {"login": "mominul", "id": 9459891, "node_id": "MDQ6VXNlcjk0NTk4OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/9459891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mominul", "html_url": "https://github.com/mominul", "followers_url": "https://api.github.com/users/mominul/followers", "following_url": "https://api.github.com/users/mominul/following{/other_user}", "gists_url": "https://api.github.com/users/mominul/gists{/gist_id}", "starred_url": "https://api.github.com/users/mominul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mominul/subscriptions", "organizations_url": "https://api.github.com/users/mominul/orgs", "repos_url": "https://api.github.com/users/mominul/repos", "events_url": "https://api.github.com/users/mominul/events{/privacy}", "received_events_url": "https://api.github.com/users/mominul/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mominul", "id": 9459891, "node_id": "MDQ6VXNlcjk0NTk4OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/9459891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mominul", "html_url": "https://github.com/mominul", "followers_url": "https://api.github.com/users/mominul/followers", "following_url": "https://api.github.com/users/mominul/following{/other_user}", "gists_url": "https://api.github.com/users/mominul/gists{/gist_id}", "starred_url": "https://api.github.com/users/mominul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mominul/subscriptions", "organizations_url": "https://api.github.com/users/mominul/orgs", "repos_url": "https://api.github.com/users/mominul/repos", "events_url": "https://api.github.com/users/mominul/events{/privacy}", "received_events_url": "https://api.github.com/users/mominul/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdc0aa188e72ee100bd61943cf7c81ac28be9a81", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdc0aa188e72ee100bd61943cf7c81ac28be9a81", "html_url": "https://github.com/rust-lang/rust/commit/cdc0aa188e72ee100bd61943cf7c81ac28be9a81"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "02518cc0b19dcc4568a19612a75b88e8a7b7e0a1", "filename": "src/lib.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e16ccba3945e06a9e687dd13de9053d981cc4fad/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e16ccba3945e06a9e687dd13de9053d981cc4fad/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=e16ccba3945e06a9e687dd13de9053d981cc4fad", "patch": "@@ -273,9 +273,14 @@ fn build_isa(sess: &Session, backend_config: &BackendConfig) -> Box<dyn isa::Tar\n \n     let variant = cranelift_codegen::isa::BackendVariant::MachInst;\n     let mut isa_builder = cranelift_codegen::isa::lookup_variant(target_triple, variant).unwrap();\n-    // Don't use \"haswell\", as it implies `has_lzcnt`.macOS CI is still at Ivy Bridge EP, so `lzcnt`\n-    // is interpreted as `bsr`.\n-    isa_builder.enable(\"nehalem\").unwrap();\n+    \n+    if let Some(target_cpu) = sess.opts.cg.target_cpu.as_ref() {\n+        isa_builder.enable(target_cpu).unwrap();\n+    } else {\n+        // Don't use \"haswell\" as the default, as it implies `has_lzcnt`.\n+        // macOS CI is still at Ivy Bridge EP, so `lzcnt` is interpreted as `bsr`.\n+        isa_builder.enable(\"nehalem\").unwrap();\n+    }\n     isa_builder.finish(flags)\n }\n "}]}