{"sha": "459e86045707e39c692535e0e2394c143d08355e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ1OWU4NjA0NTcwN2UzOWM2OTI1MzVlMGUyMzk0YzE0M2QwODM1NWU=", "commit": {"author": {"name": "Or Brostovski", "email": "tohava@gmail.com", "date": "2010-08-06T14:15:55Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-07T00:34:31Z"}, "message": "Added forgotten handling for alt_type_else, and also for stmt_note", "tree": {"sha": "23ec51c4a079f56ec7c2e95187142aba5dc136dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23ec51c4a079f56ec7c2e95187142aba5dc136dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/459e86045707e39c692535e0e2394c143d08355e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/459e86045707e39c692535e0e2394c143d08355e", "html_url": "https://github.com/rust-lang/rust/commit/459e86045707e39c692535e0e2394c143d08355e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/459e86045707e39c692535e0e2394c143d08355e/comments", "author": {"login": "tohava", "id": 329651, "node_id": "MDQ6VXNlcjMyOTY1MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/329651?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tohava", "html_url": "https://github.com/tohava", "followers_url": "https://api.github.com/users/tohava/followers", "following_url": "https://api.github.com/users/tohava/following{/other_user}", "gists_url": "https://api.github.com/users/tohava/gists{/gist_id}", "starred_url": "https://api.github.com/users/tohava/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tohava/subscriptions", "organizations_url": "https://api.github.com/users/tohava/orgs", "repos_url": "https://api.github.com/users/tohava/repos", "events_url": "https://api.github.com/users/tohava/events{/privacy}", "received_events_url": "https://api.github.com/users/tohava/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "122ea68b12ec1587f0fe0bd4737ae866e2a56c39", "url": "https://api.github.com/repos/rust-lang/rust/commits/122ea68b12ec1587f0fe0bd4737ae866e2a56c39", "html_url": "https://github.com/rust-lang/rust/commit/122ea68b12ec1587f0fe0bd4737ae866e2a56c39"}], "stats": {"total": 36, "additions": 26, "deletions": 10}, "files": [{"sha": "efbd62ae20259be6f0863f1ebb72f89559fb799a", "filename": "src/boot/fe/ast.ml", "status": "modified", "additions": 26, "deletions": 10, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/459e86045707e39c692535e0e2394c143d08355e/src%2Fboot%2Ffe%2Fast.ml", "raw_url": "https://github.com/rust-lang/rust/raw/459e86045707e39c692535e0e2394c143d08355e/src%2Fboot%2Ffe%2Fast.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Ffe%2Fast.ml?ref=459e86045707e39c692535e0e2394c143d08355e", "patch": "@@ -254,7 +254,14 @@ and stmt_alt_type =\n     {\n       alt_type_lval: lval;\n       alt_type_arms: type_arm array;\n-      alt_type_else: stmt option;\n+      alt_type_else: block option;\n+    }\n+\n+and stmt_alt_port =\n+    {\n+      (* else lval is a timeout value. *)\n+      alt_port_arms: (lval * lval) array;\n+      alt_port_else: (lval * block) option;\n     }\n \n and block' = stmt array\n@@ -264,12 +271,6 @@ and stmt_decl =\n     DECL_mod_item of (ident * mod_item)\n   | DECL_slot of (slot_key * (slot identified))\n \n-and stmt_alt_port =\n-    {\n-      (* else lval is a timeout value. *)\n-      alt_port_arms: (lval * lval) array;\n-      alt_port_else: (lval * stmt) option;\n-    }\n \n and stmt_while =\n     {\n@@ -1233,10 +1234,25 @@ and fmt_stmt_body (ff:Format.formatter) (s:stmt) : unit =\n           fmt ff \") \";\n           fmt_obr ff;\n           Array.iter (fmt_type_arm ff) at.alt_type_arms;\n+          begin\n+            match at.alt_type_else with \n+                None -> ()\n+              | Some block ->\n+                  fmt ff \"@\\n\";\n+                  fmt_obox ff;\n+                  fmt ff \"case (_) \";\n+                  fmt_obr ff;\n+                  fmt_stmts ff block.node;\n+                  fmt_cbb ff;\n+          end;\n           fmt_cbb ff;\n-          \n       | STMT_alt_port _ -> fmt ff \"?stmt_alt_port?\"\n-      | STMT_note _ -> fmt ff \"?stmt_note?\"\n+      | STMT_note at -> \n+          begin\n+            fmt ff \"note \";\n+            fmt_atom ff at;\n+            fmt ff \";\"\n+          end\n       | STMT_slice (dst, src, slice) -> \n           fmt_lval ff dst;\n           fmt ff \" = \";\n@@ -1245,7 +1261,7 @@ and fmt_stmt_body (ff:Format.formatter) (s:stmt) : unit =\n           fmt_slice ff slice;\n           fmt ff \";\";\n   end\n-\n+    \n and fmt_arm \n     (ff:Format.formatter) \n     (fmt_arm_case_expr : Format.formatter -> unit)"}]}