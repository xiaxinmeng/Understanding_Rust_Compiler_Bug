{"sha": "b44fd97af6999e032f71e9e7c265b43163cb4052", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0NGZkOTdhZjY5OTllMDMyZjcxZTllN2MyNjViNDMxNjNjYjQwNTI=", "commit": {"author": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-08-19T15:43:09Z"}, "committer": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-08-19T15:43:09Z"}, "message": "Use host's rng when communication is enabled", "tree": {"sha": "487cc53ae706aa9084ced01e2420af90e53eff6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/487cc53ae706aa9084ced01e2420af90e53eff6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b44fd97af6999e032f71e9e7c265b43163cb4052", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b44fd97af6999e032f71e9e7c265b43163cb4052", "html_url": "https://github.com/rust-lang/rust/commit/b44fd97af6999e032f71e9e7c265b43163cb4052", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b44fd97af6999e032f71e9e7c265b43163cb4052/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f6f264c305ea30f1de90ad0c2f341e84d972b2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f6f264c305ea30f1de90ad0c2f341e84d972b2e", "html_url": "https://github.com/rust-lang/rust/commit/4f6f264c305ea30f1de90ad0c2f341e84d972b2e"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "1ab0580cc63155286774d30cda388811be95c323", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b44fd97af6999e032f71e9e7c265b43163cb4052/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b44fd97af6999e032f71e9e7c265b43163cb4052/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=b44fd97af6999e032f71e9e7c265b43163cb4052", "patch": "@@ -35,6 +35,7 @@ byteorder = { version = \"1.1\", features = [\"i128\"]}\n cargo_metadata = { version = \"0.8\", optional = true }\n directories = { version = \"2.0\", optional = true }\n rustc_version = { version = \"0.2.3\", optional = true }\n+getrandom = \"0.1.10\"\n env_logger = \"0.6\"\n log = \"0.4\"\n shell-escape = \"0.1.4\""}, {"sha": "d134a19f4c23d56202b6faf891dd96196ff2f451", "filename": "src/helpers.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b44fd97af6999e032f71e9e7c265b43163cb4052/src%2Fhelpers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b44fd97af6999e032f71e9e7c265b43163cb4052/src%2Fhelpers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fhelpers.rs?ref=b44fd97af6999e032f71e9e7c265b43163cb4052", "patch": "@@ -97,9 +97,18 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n             Align::from_bytes(1).unwrap()\n         )?.expect(\"we already checked for size 0\");\n \n-        let rng = this.memory_mut().extra.rng.get_mut();\n         let mut data = vec![0; len];\n-        rng.fill_bytes(&mut data);\n+\n+        if this.machine.communicate {\n+            // Fill the buffer using the host's rng.\n+            getrandom::getrandom(&mut data).map_err(|err| {\n+                InterpError::Unsupported(UnsupportedOpInfo::Unsupported(err.to_string()))\n+            })?;\n+        }\n+        else {\n+            let rng = this.memory_mut().extra.rng.get_mut();\n+            rng.fill_bytes(&mut data);\n+        }\n \n         let tcx = &{this.tcx.tcx};\n         this.memory_mut().get_mut(ptr.alloc_id)?.write_bytes(tcx, ptr, &data)"}]}