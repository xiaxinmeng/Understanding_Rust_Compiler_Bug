{"sha": "805ac666ca8cb2b643026ff454951e9ce3834d94", "node_id": "C_kwDOAAsO6NoAKDgwNWFjNjY2Y2E4Y2IyYjY0MzAyNmZmNDU0OTUxZTljZTM4MzRkOTQ", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-07-24T13:34:53Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-07-24T13:40:04Z"}, "message": "fix: consider assignee expressions in record fields exhaustiveness check", "tree": {"sha": "502fd9a1b4c713dcc5adeaa1300eeacffa5656a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/502fd9a1b4c713dcc5adeaa1300eeacffa5656a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/805ac666ca8cb2b643026ff454951e9ce3834d94", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmLdS7QACgkQ4laYqTBY\nYXEQBg//QAANaGIPUtxP/z7MufSaprcprxCs7rG7H0MeNz0jM/xxTqHuP9PnS9cQ\nWwjbPPOA4opyJCieWKbwKYGMNAnLYTj9RdH+eISHDMxo0HIn3RMtPktn7ILcow7u\nHIpdwssYa0MYMAL2LYIhIxbPEKD57Eq+0Gnyve8yhwG3Q58SvM4guAq5vVi+OGX4\ncJNqnXeESvd2EQXtjOSY/RwR+3EfXg4G8HL2O6cEUPY40JpzlR57N27SAMHmXpkc\nrlp7sICAly5kgkLQPqfny+c4QIs6VpIAwLVRvBolcf1awe/usvZ1gSkKwHQSdnPJ\nHYaGwZ9PdRa+w9iZ5pQlWkkUIKS3ADtl+sDTnQL0JgvsKWwhQbeL3Jxzxxqapt2a\nLridBudI7OVe6K4LlElLQn0j2ZThwwKbGSDWc040JYgOq0bO2QcV4Pu+df3TEDv7\nQ+irModk7YQB752IogCXfaVUARoqyeig3H25bMwXvdFOo7Rdt5kI2i1qZtRcJ80C\nnU9+fzIWidE3MpF5UYS/GyHG28y6LOwah7wMmSBb6jtZOuT9nExjk0Kl/5KlBahg\nL+TazM+pmif73LQd9JkSO0j6UBmGO0gcepRMEyc7KcLeg3qod+AjnG5X8VKIK1xa\nL/DGS8rAnp+RQbo3zzahJ0ioCOp+MaDcD25LlitD00Q0+QSb+kM=\n=WUAy\n-----END PGP SIGNATURE-----", "payload": "tree 502fd9a1b4c713dcc5adeaa1300eeacffa5656a1\nparent 64758bd48195241dbf39a63974ecbcdcd151f399\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1658669693 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1658670004 +0900\n\nfix: consider assignee expressions in record fields exhaustiveness check\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/805ac666ca8cb2b643026ff454951e9ce3834d94", "html_url": "https://github.com/rust-lang/rust/commit/805ac666ca8cb2b643026ff454951e9ce3834d94", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/805ac666ca8cb2b643026ff454951e9ce3834d94/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64758bd48195241dbf39a63974ecbcdcd151f399", "url": "https://api.github.com/repos/rust-lang/rust/commits/64758bd48195241dbf39a63974ecbcdcd151f399", "html_url": "https://github.com/rust-lang/rust/commit/64758bd48195241dbf39a63974ecbcdcd151f399"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "642e03edd230636ca3911a0e0eee44dc8989a41e", "filename": "crates/hir-ty/src/diagnostics/expr.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/805ac666ca8cb2b643026ff454951e9ce3834d94/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/805ac666ca8cb2b643026ff454951e9ce3834d94/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fdiagnostics%2Fexpr.rs?ref=805ac666ca8cb2b643026ff454951e9ce3834d94", "patch": "@@ -305,7 +305,10 @@ pub fn record_literal_missing_fields(\n     expr: &Expr,\n ) -> Option<(VariantId, Vec<LocalFieldId>, /*exhaustive*/ bool)> {\n     let (fields, exhaustive) = match expr {\n-        Expr::RecordLit { fields, spread, .. } => (fields, spread.is_none()),\n+        Expr::RecordLit { fields, spread, ellipsis, is_assignee_expr, .. } => {\n+            let exhaustive = if *is_assignee_expr { !*ellipsis } else { spread.is_none() };\n+            (fields, exhaustive)\n+        }\n         _ => return None,\n     };\n "}, {"sha": "edb1fc0919c242c9f83dc921a488f5b76813e3a4", "filename": "crates/ide-diagnostics/src/handlers/missing_fields.rs", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/805ac666ca8cb2b643026ff454951e9ce3834d94/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/805ac666ca8cb2b643026ff454951e9ce3834d94/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-diagnostics%2Fsrc%2Fhandlers%2Fmissing_fields.rs?ref=805ac666ca8cb2b643026ff454951e9ce3834d94", "patch": "@@ -292,6 +292,37 @@ fn x(a: S) {\n         )\n     }\n \n+    #[test]\n+    fn missing_record_expr_in_assignee_expr() {\n+        check_diagnostics(\n+            r\"\n+struct S { s: usize, t: usize }\n+struct S2 { s: S, t: () }\n+struct T(S);\n+fn regular(a: S) {\n+    let s;\n+    S { s, .. } = a;\n+}\n+fn nested(a: S2) {\n+    let s;\n+    S2 { s: S { s, .. }, .. } = a;\n+}\n+fn in_tuple(a: (S,)) {\n+    let s;\n+    (S { s, .. },) = a;\n+}\n+fn in_array(a: [S;1]) {\n+    let s;\n+    [S { s, .. },] = a;\n+}\n+fn in_tuple_struct(a: T) {\n+    let s;\n+    T(S { s, .. }) = a;\n+}\n+            \",\n+        );\n+    }\n+\n     #[test]\n     fn range_mapping_out_of_macros() {\n         check_fix("}]}