{"sha": "c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMxZmI0MmFkZDVhNzg1OWIxYjhlMjU4ZDNjMDNmZDVhMjkxMjljNDA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-04T16:31:31Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:03:04Z"}, "message": "ci: extract dumping the environment into a script", "tree": {"sha": "8b7c9e24559c0c51ae17363be3330c1e1f1d93e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b7c9e24559c0c51ae17363be3330c1e1f1d93e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAJgACgkQPgar6Auq\n8Zz5lg//S5DctRh+w3Js6r0+yh7MKP96Mx12zJmdB4kRb5uPNtt0eznmLHYdx7rb\n96jeqF//h5WMD3Fx9Xplq3wZlVXo1HQdNZSVBwkcGxwsOb1FHGncXkw9ZPG7VqQ0\ngfIoDl56eVmXztS52fnhdkAZYfrUYelCrKFKhEsggu0nl+WkwUd6B8MtzWzdd2tO\n268BojNvkotEfQsV53d1nFzCptGgfZ/Fai8g36EnNV1ksrjpKunns39QNOLhzXom\nKlu8dkxoBljiOLbzZOEExvQjGRn5cTGaKSr9chmfgDx6gR//J0MushOtQURuIQ4e\nkp2gqHa7+RQJTtkLtGvc9f1G3AUa3pV2muOsTTuB/EgORS9JSSy0Fa/XIn2kNOmG\nm6HiKqAVdjNEnz9uftW4Fc8V7PVAyrrGu8NqlZCme+ETMWthlxM8HjPQvED/rCuA\nTqs17yJiiC2gTsWNvwhaudo5TbplMq0O9iorf/vnR7UJhX44rRjR9vkzZztoNPkR\nOIS7yba0o1Uv6BzkCiS1RoU3uW4hWEnAQyHO7/kzNlYm3ISCLIUzN43iQZEW264l\nnPputmF5nbjso9ftTrlwT+OifMf4vyPb04v1hMuz9sSeIWpwWHtc4dEYWySJbC5Z\nnAiFbNikqYzLG6p8BgJpLWRaK4XsQ6HzFQn0abaPxkGkIWEplNE=\n=v+0J\n-----END PGP SIGNATURE-----", "payload": "tree 8b7c9e24559c0c51ae17363be3330c1e1f1d93e9\nparent 4f568f8a8134526aec633bc3a8435ae1340f2828\nauthor Pietro Albini <pietro@pietroalbini.org> 1570206691 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012184 +0200\n\nci: extract dumping the environment into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "html_url": "https://github.com/rust-lang/rust/commit/c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c1fb42add5a7859b1b8e258d3c03fd5a29129c40/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f568f8a8134526aec633bc3a8435ae1340f2828", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f568f8a8134526aec633bc3a8435ae1340f2828", "html_url": "https://github.com/rust-lang/rust/commit/4f568f8a8134526aec633bc3a8435ae1340f2828"}], "stats": {"total": 31, "additions": 21, "deletions": 10}, "files": [{"sha": "86399e5828f4658299da3c03151586128067f9e6", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c1fb42add5a7859b1b8e258d3c03fd5a29129c40/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/c1fb42add5a7859b1b8e258d3c03fd5a29129c40/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "patch": "@@ -48,16 +48,8 @@ steps:\n - bash: python src/ci/cpu-usage-over-time.py &> cpu-usage.csv &\n   displayName: \"Collect CPU-usage statistics in the background\"\n \n-- bash: printenv | sort\n-  displayName: Show environment variables\n-\n-- bash: |\n-    set -e\n-    df -h\n-    du . | sort -nr | head -n100\n-  displayName: Show disk usage\n-  # FIXME: this hasn't been tested, but maybe it works on Windows? Should test!\n-  condition: and(succeeded(), ne(variables['Agent.OS'], 'Windows_NT'))\n+- bash: src/ci/scripts/dump-environment.sh\n+  displayName: Show the current environment\n \n - template: install-sccache.yml\n - template: install-clang.yml"}, {"sha": "c6774b52ab92dc8d2af0159d1bf2b24b7896e825", "filename": "src/ci/scripts/dump-environment.sh", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c1fb42add5a7859b1b8e258d3c03fd5a29129c40/src%2Fci%2Fscripts%2Fdump-environment.sh", "raw_url": "https://github.com/rust-lang/rust/raw/c1fb42add5a7859b1b8e258d3c03fd5a29129c40/src%2Fci%2Fscripts%2Fdump-environment.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fdump-environment.sh?ref=c1fb42add5a7859b1b8e258d3c03fd5a29129c40", "patch": "@@ -0,0 +1,19 @@\n+#!/bin/bash\n+# This script dumps information about the build environment to stdout.\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+echo \"environment variables:\"\n+printenv | sort\n+echo\n+\n+echo \"disk usage:\"\n+df -h\n+echo\n+\n+echo \"biggest files in the working dir:\"\n+set +o pipefail\n+du . | sort -nr | head -n100\n+set -o pipefail\n+echo"}]}