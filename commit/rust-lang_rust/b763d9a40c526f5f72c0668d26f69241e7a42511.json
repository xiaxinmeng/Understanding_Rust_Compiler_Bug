{"sha": "b763d9a40c526f5f72c0668d26f69241e7a42511", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3NjNkOWE0MGM1MjZmNWY3MmMwNjY4ZDI2ZjY5MjQxZTdhNDI1MTE=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-02-03T17:11:28Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-03-01T22:35:35Z"}, "message": "Build both Python 2 and Python 3 on x86 dist builders\n\nPython 2 is needed for Clang 10, Python 3 for LLVM 12.\n\nThe Python 2 dependency could be removed by upgrading to Clang 11,\nbut that causes linker errors of unclear origin.", "tree": {"sha": "ad51120472030d184146a6f1ff736ebb59c5bc0c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad51120472030d184146a6f1ff736ebb59c5bc0c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b763d9a40c526f5f72c0668d26f69241e7a42511", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b763d9a40c526f5f72c0668d26f69241e7a42511", "html_url": "https://github.com/rust-lang/rust/commit/b763d9a40c526f5f72c0668d26f69241e7a42511", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b763d9a40c526f5f72c0668d26f69241e7a42511/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e21b2cba8c96e4ab930d7aad473e08ddb483a78", "html_url": "https://github.com/rust-lang/rust/commit/1e21b2cba8c96e4ab930d7aad473e08ddb483a78"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "247b539652b15971a49fff3ab396142fb1418319", "filename": "src/ci/docker/host-x86_64/dist-i686-linux/Dockerfile", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile?ref=b763d9a40c526f5f72c0668d26f69241e7a42511", "patch": "@@ -68,11 +68,13 @@ RUN ./build-binutils.sh\n COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n-# Debian 6 has Python 2.6 by default, but LLVM needs 2.7+\n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-RUN ./build-python.sh\n+# Build Python 2.7 needed for Clang 10.\n+RUN ./build-python.sh 2.7.12\n+# Build Python 3 needed for LLVM 12.\n+RUN ./build-python.sh 3.9.1\n \n-# LLVM needs cmake 3.4.3 or higher, and is planning to raise to 3.13.4.\n+# LLVM needs cmake 3.13.4 or higher.\n COPY host-x86_64/dist-x86_64-linux/build-cmake.sh /tmp/\n RUN ./build-cmake.sh\n "}, {"sha": "4dd4378f196922bbb97ebf809e61cfd869cb976d", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile?ref=b763d9a40c526f5f72c0668d26f69241e7a42511", "patch": "@@ -68,11 +68,13 @@ RUN ./build-binutils.sh\n COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n-# Debian 6 has Python 2.6 by default, but LLVM needs 2.7+\n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-RUN ./build-python.sh\n+# Build Python 2.7 needed for Clang 10.\n+RUN ./build-python.sh 2.7.12\n+# Build Python 3 needed for LLVM 12.\n+RUN ./build-python.sh 3.9.1\n \n-# LLVM needs cmake 3.4.3 or higher, and is planning to raise to 3.13.4.\n+# LLVM needs cmake 3.13.4 or higher.\n COPY host-x86_64/dist-x86_64-linux/build-cmake.sh /tmp/\n RUN ./build-cmake.sh\n "}, {"sha": "970d67b6db3ddc495ef6923411348eb8d045da42", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-python.sh", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b763d9a40c526f5f72c0668d26f69241e7a42511/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-python.sh?ref=b763d9a40c526f5f72c0668d26f69241e7a42511", "patch": "@@ -3,7 +3,8 @@\n set -ex\n source shared.sh\n \n-curl https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz | \\\n+VERSION=$1\n+curl https://www.python.org/ftp/python/$VERSION/Python-$VERSION.tgz | \\\n   tar xzf -\n \n mkdir python-build\n@@ -12,10 +13,10 @@ cd python-build\n # Gotta do some hackery to tell python about our custom OpenSSL build, but other\n # than that fairly normal.\n CFLAGS='-I /rustroot/include' LDFLAGS='-L /rustroot/lib -L /rustroot/lib64' \\\n-    hide_output ../Python-2.7.12/configure --prefix=/rustroot\n+    hide_output ../Python-$VERSION/configure --prefix=/rustroot\n hide_output make -j10\n hide_output make install\n \n cd ..\n rm -rf python-build\n-rm -rf Python-2.7.12\n+rm -rf Python-$VERSION"}]}