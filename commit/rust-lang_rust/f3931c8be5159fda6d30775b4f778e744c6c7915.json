{"sha": "f3931c8be5159fda6d30775b4f778e744c6c7915", "node_id": "C_kwDOAAsO6NoAKGYzOTMxYzhiZTUxNTlmZGE2ZDMwNzc1YjRmNzc4ZTc0NGM2Yzc5MTU", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-11-11T15:21:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-11T15:21:40Z"}, "message": "Rollup merge of #104202 - camsteffen:103748, r=estebank\n\nFix ICE #103748\n\nFixes #103748", "tree": {"sha": "e2d0728bda3e9d6936484cca08f89578bf24f1b7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2d0728bda3e9d6936484cca08f89578bf24f1b7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3931c8be5159fda6d30775b4f778e744c6c7915", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjbmiECRBK7hj4Ov3rIwAA5usIAGR8qNpwSGatKO6W0X4ld1PX\nPTTXko2eT+Hm1MC1zvn2eTslheA8tuk2MEPDKnjMmoiOgrW5ln1spNw7Zubod4oX\noSTbJmb0h4Ct1TACFv/19IRCzzvswb5zmt+td9ykprpAhW04RYRLmUjphMjvfNRK\nOTrLTP7MlGL1L6CtmO8P+R2d7fBdkkjGGgJWO05wFDA2UmVROqUza3cy2wHHNmAu\not0fQDmm+wNzWmZVOXSc7RxOOFaMAyNxHyUmWNR+Hs3FdKK/HuixSfJoZqDyDbDJ\nmIrcqavYbC9kGnjLboZDFWsBDWCvmqbHche3r7O9Td249j6EtBRh4XIU0zhoyzs=\n=mc4L\n-----END PGP SIGNATURE-----\n", "payload": "tree e2d0728bda3e9d6936484cca08f89578bf24f1b7\nparent eca27a2f949cc711e0989b8b01d75996fa6e8df9\nparent 76cab67ed87a23df318c43ab84ae9f87fdf203de\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1668180100 +0530\ncommitter GitHub <noreply@github.com> 1668180100 +0530\n\nRollup merge of #104202 - camsteffen:103748, r=estebank\n\nFix ICE #103748\n\nFixes #103748\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3931c8be5159fda6d30775b4f778e744c6c7915", "html_url": "https://github.com/rust-lang/rust/commit/f3931c8be5159fda6d30775b4f778e744c6c7915", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3931c8be5159fda6d30775b4f778e744c6c7915/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eca27a2f949cc711e0989b8b01d75996fa6e8df9", "url": "https://api.github.com/repos/rust-lang/rust/commits/eca27a2f949cc711e0989b8b01d75996fa6e8df9", "html_url": "https://github.com/rust-lang/rust/commit/eca27a2f949cc711e0989b8b01d75996fa6e8df9"}, {"sha": "76cab67ed87a23df318c43ab84ae9f87fdf203de", "url": "https://api.github.com/repos/rust-lang/rust/commits/76cab67ed87a23df318c43ab84ae9f87fdf203de", "html_url": "https://github.com/rust-lang/rust/commit/76cab67ed87a23df318c43ab84ae9f87fdf203de"}], "stats": {"total": 62, "additions": 61, "deletions": 1}, "files": [{"sha": "f4562cdfb88dcfdfa07c488896a761f3fef5872f", "filename": "compiler/rustc_middle/src/values.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f3931c8be5159fda6d30775b4f778e744c6c7915/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3931c8be5159fda6d30775b4f778e744c6c7915/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs?ref=f3931c8be5159fda6d30775b4f778e744c6c7915", "patch": "@@ -185,7 +185,8 @@ fn find_item_ty_spans(\n                 });\n                 if check_params && let Some(args) = path.segments.last().unwrap().args {\n                     let params_in_repr = tcx.params_in_repr(def_id);\n-                    for (i, arg) in args.args.iter().enumerate() {\n+                    // the domain size check is needed because the HIR may not be well-formed at this point\n+                    for (i, arg) in args.args.iter().enumerate().take(params_in_repr.domain_size()) {\n                         if let hir::GenericArg::Type(ty) = arg && params_in_repr.contains(i as u32) {\n                             find_item_ty_spans(tcx, ty, needle, spans, seen_representable);\n                         }"}, {"sha": "8012cb652bd8857b6ad3e9b299319664c57060d6", "filename": "src/test/ui/parser/issue-103748-ICE-wrong-braces.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f3931c8be5159fda6d30775b4f778e744c6c7915/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f3931c8be5159fda6d30775b4f778e744c6c7915/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs?ref=f3931c8be5159fda6d30775b4f778e744c6c7915", "patch": "@@ -0,0 +1,8 @@\n+#![crate_type = \"lib\"]\n+\n+struct Apple((Apple, Option(Banana ? Citron)));\n+//~^ ERROR invalid `?` in type\n+//~| ERROR expected one of `)` or `,`, found `Citron`\n+//~| ERROR cannot find type `Citron` in this scope [E0412]\n+//~| ERROR parenthesized type parameters may only be used with a `Fn` trait [E0214]\n+//~| ERROR recursive type `Apple` has infinite size [E0072]"}, {"sha": "b0d8b03ae08c3cd714db27b63c55365039696feb", "filename": "src/test/ui/parser/issue-103748-ICE-wrong-braces.stderr", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/f3931c8be5159fda6d30775b4f778e744c6c7915/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f3931c8be5159fda6d30775b4f778e744c6c7915/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr?ref=f3931c8be5159fda6d30775b4f778e744c6c7915", "patch": "@@ -0,0 +1,51 @@\n+error: invalid `?` in type\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:36\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                    ^ `?` is only allowed on expressions, not types\n+   |\n+help: if you meant to express that the type might not contain a value, use the `Option` wrapper type\n+   |\n+LL | struct Apple((Apple, Option(Option<Banana > Citron)));\n+   |                             +++++++       ~\n+\n+error: expected one of `)` or `,`, found `Citron`\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:38\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                     -^^^^^^ expected one of `)` or `,`\n+   |                                     |\n+   |                                     help: missing `,`\n+\n+error[E0412]: cannot find type `Citron` in this scope\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:38\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                      ^^^^^^ not found in this scope\n+\n+error[E0214]: parenthesized type parameters may only be used with a `Fn` trait\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:22\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                      ^^^^^^^^^^^^^^^^^^^^^^^ only `Fn` traits may use parentheses\n+   |\n+help: use angle brackets instead\n+   |\n+LL | struct Apple((Apple, Option<Banana ? Citron>));\n+   |                            ~               ~\n+\n+error[E0072]: recursive type `Apple` has infinite size\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:1\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   | ^^^^^^^^^^^^  ----- recursive without indirection\n+   |\n+help: insert some indirection (e.g., a `Box`, `Rc`, or `&`) to break the cycle\n+   |\n+LL | struct Apple((Box<Apple>, Option(Banana ? Citron)));\n+   |               ++++     +\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0072, E0214, E0412.\n+For more information about an error, try `rustc --explain E0072`."}]}