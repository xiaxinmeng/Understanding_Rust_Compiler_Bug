{"sha": "d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "node_id": "C_kwDOAAsO6NoAKGQ2Yjc0ODBjMmEwODZkOTI4NGNmZDRlZDNmM2UzNjEyODgwYTc1ZDc", "commit": {"author": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2022-07-15T10:10:35Z"}, "committer": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2022-07-15T10:10:35Z"}, "message": "Stabilize `core::ffi::CStr`, `alloc::ffi::CString`, and friends\n\nStabilize the `core_c_str` and `alloc_c_string` feature gates.\n\nChange `std::ffi` to re-export these types rather than creating type\naliases, since they now have matching stability.", "tree": {"sha": "c1f2b79c6238ac28ca97480c5044ed6a9daa5408", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c1f2b79c6238ac28ca97480c5044ed6a9daa5408"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "html_url": "https://github.com/rust-lang/rust/commit/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/comments", "author": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "522abf6d88a45f9f49a1b2217426eef1c3a09b52", "url": "https://api.github.com/repos/rust-lang/rust/commits/522abf6d88a45f9f49a1b2217426eef1c3a09b52", "html_url": "https://github.com/rust-lang/rust/commit/522abf6d88a45f9f49a1b2217426eef1c3a09b52"}], "stats": {"total": 48, "additions": 14, "deletions": 34}, "files": [{"sha": "ae61b1f1e8ed5f43496f959fb52108231dff61dd", "filename": "library/alloc/src/ffi/c_str.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fffi%2Fc_str.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -108,7 +108,7 @@ use crate::sync::Arc;\n /// and other memory errors.\n #[derive(PartialEq, PartialOrd, Eq, Ord, Hash, Clone)]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"cstring_type\")]\n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub struct CString {\n     // Invariant 1: the slice ends with a zero byte and has a length of at least one.\n     // Invariant 2: the slice contains only one zero byte.\n@@ -132,7 +132,7 @@ pub struct CString {\n /// let _: NulError = CString::new(b\"f\\0oo\".to_vec()).unwrap_err();\n /// ```\n #[derive(Clone, PartialEq, Eq, Debug)]\n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub struct NulError(usize, Vec<u8>);\n \n #[derive(Clone, PartialEq, Eq, Debug)]\n@@ -157,7 +157,7 @@ enum FromBytesWithNulErrorKind {\n /// let _: FromVecWithNulError = CString::from_vec_with_nul(b\"f\\0oo\".to_vec()).unwrap_err();\n /// ```\n #[derive(Clone, PartialEq, Eq, Debug)]\n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub struct FromVecWithNulError {\n     error_kind: FromBytesWithNulErrorKind,\n     bytes: Vec<u8>,\n@@ -223,7 +223,7 @@ impl FromVecWithNulError {\n /// This `struct` is created by [`CString::into_string()`]. See\n /// its documentation for more.\n #[derive(Clone, PartialEq, Eq, Debug)]\n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub struct IntoStringError {\n     inner: CString,\n     error: Utf8Error,"}, {"sha": "e8530fbc1f08f506bc1852b1a9537d3f980e74b3", "filename": "library/alloc/src/ffi/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Fffi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Fffi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fffi%2Fmod.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -78,11 +78,11 @@\n //! [`String`]: crate::string::String\n //! [`CStr`]: core::ffi::CStr\n \n-#![unstable(feature = \"alloc_ffi\", issue = \"94079\")]\n+#![stable(feature = \"alloc_ffi\", since = \"1.64.0\")]\n \n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub use self::c_str::FromVecWithNulError;\n-#[unstable(feature = \"alloc_c_string\", issue = \"94079\")]\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n pub use self::c_str::{CString, IntoStringError, NulError};\n \n mod c_str;"}, {"sha": "315469387e5ae86a6499b90931382794df4f3d04", "filename": "library/alloc/src/lib.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Flib.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -86,7 +86,6 @@\n #![allow(explicit_outlives_requirements)]\n //\n // Library features:\n-#![cfg_attr(not(no_global_oom_handling), feature(alloc_c_string))]\n #![feature(alloc_layout_extra)]\n #![feature(allocator_api)]\n #![feature(array_chunks)]\n@@ -106,7 +105,6 @@\n #![feature(const_maybe_uninit_write)]\n #![feature(const_maybe_uninit_as_mut_ptr)]\n #![feature(const_refs_to_cell)]\n-#![feature(core_c_str)]\n #![feature(core_intrinsics)]\n #![feature(const_eval_select)]\n #![feature(const_pin)]"}, {"sha": "c29e7b9c81efb0d985887809ccadaec3ff0d4092", "filename": "library/alloc/tests/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Falloc%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Flib.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -11,7 +11,6 @@\n #![feature(const_nonnull_slice_from_raw_parts)]\n #![feature(const_ptr_write)]\n #![feature(const_try)]\n-#![feature(core_c_str)]\n #![feature(core_intrinsics)]\n #![feature(drain_filter)]\n #![feature(exact_size_is_empty)]"}, {"sha": "ee9baf811e29c099c70d18323978f655a98e65a6", "filename": "library/core/src/ffi/c_str.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fcore%2Fsrc%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fcore%2Fsrc%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fffi%2Fc_str.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -76,7 +76,7 @@ use crate::str;\n /// [str]: prim@str \"str\"\n #[derive(Hash)]\n #[cfg_attr(not(test), rustc_diagnostic_item = \"CStr\")]\n-#[unstable(feature = \"core_c_str\", issue = \"94079\")]\n+#[stable(feature = \"core_c_str\", since = \"1.64.0\")]\n #[rustc_has_incoherent_inherent_impls]\n // FIXME:\n // `fn from` in `impl From<&CStr> for Box<CStr>` current implementation relies\n@@ -108,7 +108,7 @@ pub struct CStr {\n /// let _: FromBytesWithNulError = CStr::from_bytes_with_nul(b\"f\\0oo\").unwrap_err();\n /// ```\n #[derive(Clone, PartialEq, Eq, Debug)]\n-#[unstable(feature = \"core_c_str\", issue = \"94079\")]\n+#[stable(feature = \"core_c_str\", since = \"1.64.0\")]\n pub struct FromBytesWithNulError {\n     kind: FromBytesWithNulErrorKind,\n }"}, {"sha": "ec1eaa99f0b8e756cb4c7c713180a6368dfac458", "filename": "library/core/src/ffi/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fcore%2Fsrc%2Fffi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fcore%2Fsrc%2Fffi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fffi%2Fmod.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -14,7 +14,7 @@ use crate::marker::PhantomData;\n use crate::num::*;\n use crate::ops::{Deref, DerefMut};\n \n-#[unstable(feature = \"core_c_str\", issue = \"94079\")]\n+#[stable(feature = \"core_c_str\", since = \"1.64.0\")]\n pub use self::c_str::{CStr, FromBytesUntilNulError, FromBytesWithNulError};\n \n mod c_str;"}, {"sha": "d987bf69b25768919536407fde46130fec1005d4", "filename": "library/std/src/ffi/mod.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fstd%2Fsrc%2Fffi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fstd%2Fsrc%2Fffi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fffi%2Fmod.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -146,24 +146,10 @@\n \n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n \n-/// See [alloc::ffi::FromVecWithNulError].\n-#[stable(feature = \"cstring_from_vec_with_nul\", since = \"1.58.0\")]\n-pub type FromVecWithNulError = alloc::ffi::FromVecWithNulError;\n-/// See [alloc::ffi::CString].\n-#[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub type CString = alloc::ffi::CString;\n-/// See [alloc::ffi::IntoStringError].\n-#[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub type IntoStringError = alloc::ffi::IntoStringError;\n-/// See [alloc::ffi::NulError].\n-#[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub type NulError = alloc::ffi::NulError;\n-/// See [core::ffi::CStr].\n-#[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub type CStr = core::ffi::CStr;\n-/// See [core::ffi::FromBytesWithNulError].\n-#[stable(feature = \"cstr_from_bytes\", since = \"1.10.0\")]\n-pub type FromBytesWithNulError = core::ffi::FromBytesWithNulError;\n+#[stable(feature = \"alloc_c_string\", since = \"1.64.0\")]\n+pub use alloc::ffi::{CString, FromVecWithNulError, IntoStringError, NulError};\n+#[stable(feature = \"core_c_str\", since = \"1.64.0\")]\n+pub use core::ffi::{CStr, FromBytesWithNulError};\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub use self::os_str::{OsStr, OsString};"}, {"sha": "ab50845e2b208f17e6a34f541ec183a473bf5990", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6b7480c2a086d9284cfd4ed3f3e3612880a75d7/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=d6b7480c2a086d9284cfd4ed3f3e3612880a75d7", "patch": "@@ -264,7 +264,6 @@\n #![feature(atomic_mut_ptr)]\n #![feature(char_error_internals)]\n #![feature(char_internals)]\n-#![feature(core_c_str)]\n #![feature(core_intrinsics)]\n #![feature(cstr_from_bytes_until_nul)]\n #![feature(cstr_internals)]\n@@ -297,8 +296,6 @@\n //\n // Library features (alloc):\n #![feature(alloc_layout_extra)]\n-#![feature(alloc_c_string)]\n-#![feature(alloc_ffi)]\n #![feature(allocator_api)]\n #![feature(get_mut_unchecked)]\n #![feature(map_try_insert)]"}]}