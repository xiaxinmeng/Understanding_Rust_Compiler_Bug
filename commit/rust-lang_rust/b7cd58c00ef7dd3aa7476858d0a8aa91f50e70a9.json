{"sha": "b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3Y2Q1OGMwMGVmN2RkM2FhNzQ3Njg1OGQwYThhYTkxZjUwZTcwYTk=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-11-12T13:07:35Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-12-03T17:18:32Z"}, "message": "Decouple CguReuseTracker from Session", "tree": {"sha": "601f0bf62a0df498b37550f03e3083505ccaf5c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/601f0bf62a0df498b37550f03e3083505ccaf5c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "html_url": "https://github.com/rust-lang/rust/commit/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ea18337f7be37b5512cd81a7ac9a26f10f491f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ea18337f7be37b5512cd81a7ac9a26f10f491f4", "html_url": "https://github.com/rust-lang/rust/commit/2ea18337f7be37b5512cd81a7ac9a26f10f491f4"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "98f0574e9c2d08387aa22000ffb5d39a0f53559e", "filename": "src/librustc/dep_graph/cgu_reuse_tracker.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9/src%2Flibrustc%2Fdep_graph%2Fcgu_reuse_tracker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9/src%2Flibrustc%2Fdep_graph%2Fcgu_reuse_tracker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fcgu_reuse_tracker.rs?ref=b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "patch": "@@ -2,7 +2,6 @@\n //! compilation. This is used for incremental compilation tests and debug\n //! output.\n \n-use crate::session::Session;\n use rustc_data_structures::fx::FxHashMap;\n use std::sync::{Arc, Mutex};\n use syntax_pos::Span;\n@@ -94,7 +93,7 @@ impl CguReuseTracker {\n         }\n     }\n \n-    pub fn check_expected_reuse(&self, sess: &Session) {\n+    pub fn check_expected_reuse(&self, diag: &errors::Handler) {\n         if let Some(ref data) = self.data {\n             let data = data.lock().unwrap();\n \n@@ -120,14 +119,14 @@ impl CguReuseTracker {\n                                           actual_reuse,\n                                           at_least,\n                                           expected_reuse);\n-                        sess.span_err(error_span.0, &msg);\n+                        diag.span_err(error_span.0, &msg);\n                     }\n                 } else {\n                     let msg = format!(\"CGU-reuse for `{}` (mangled: `{}`) was \\\n                                        not recorded\",\n                                        cgu_user_name,\n                                        cgu_name);\n-                    sess.span_fatal(error_span.0, &msg);\n+                    diag.span_fatal(error_span.0, &msg).raise();\n                 }\n             }\n         }"}, {"sha": "7d9ceb0699b5358d8011b450fe9c0cdb2489fdd7", "filename": "src/librustc_codegen_ssa/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs?ref=b7cd58c00ef7dd3aa7476858d0a8aa91f50e70a9", "patch": "@@ -1752,7 +1752,7 @@ impl<B: ExtraBackendMethods> OngoingCodegen<B> {\n             }\n         };\n \n-        sess.cgu_reuse_tracker.check_expected_reuse(sess);\n+        sess.cgu_reuse_tracker.check_expected_reuse(sess.diagnostic());\n \n         sess.abort_if_errors();\n "}]}