{"sha": "42e31fffc40342fa269214e0dbc3550f4b64f3d3", "node_id": "C_kwDOAAsO6NoAKDQyZTMxZmZmYzQwMzQyZmEyNjkyMTRlMGRiYzM1NTBmNGI2NGYzZDM", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2021-12-02T22:14:38Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2021-12-03T01:31:38Z"}, "message": "Skip shim passes if they've already been run\n\nLooks like Generator drop shims already have `post_borrowck_cleanup` run\non them. That's a bit surprising, since it means they're getting const-\nand maybe borrow-checked? This merits further investigation, but for now\njust preserve the status quo.", "tree": {"sha": "7a347139785d5777f9bd302b9bd07e811101fc15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a347139785d5777f9bd302b9bd07e811101fc15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42e31fffc40342fa269214e0dbc3550f4b64f3d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42e31fffc40342fa269214e0dbc3550f4b64f3d3", "html_url": "https://github.com/rust-lang/rust/commit/42e31fffc40342fa269214e0dbc3550f4b64f3d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42e31fffc40342fa269214e0dbc3550f4b64f3d3/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71dd5422acd06a9cab95c6f202dbb5c577f91ef9", "url": "https://api.github.com/repos/rust-lang/rust/commits/71dd5422acd06a9cab95c6f202dbb5c577f91ef9", "html_url": "https://github.com/rust-lang/rust/commit/71dd5422acd06a9cab95c6f202dbb5c577f91ef9"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "193a9e6ad291fe98adb4785d26fd7e5cb8488811", "filename": "compiler/rustc_mir_transform/src/shim.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/42e31fffc40342fa269214e0dbc3550f4b64f3d3/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42e31fffc40342fa269214e0dbc3550f4b64f3d3/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fshim.rs?ref=42e31fffc40342fa269214e0dbc3550f4b64f3d3", "patch": "@@ -75,6 +75,14 @@ fn make_shim<'tcx>(tcx: TyCtxt<'tcx>, instance: ty::InstanceDef<'tcx>) -> Body<'\n     };\n     debug!(\"make_shim({:?}) = untransformed {:?}\", instance, result);\n \n+    // In some of the above cases, we seem to be invoking the passes for non-shim MIR bodies.\n+    // If that happens, there's no need to run them again.\n+    //\n+    // FIXME: Is this intentional?\n+    if result.phase >= MirPhase::Const {\n+        return result;\n+    }\n+\n     pm::run_passes(\n         tcx,\n         &mut result,"}]}