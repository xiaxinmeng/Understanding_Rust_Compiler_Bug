{"sha": "b2d115f6db5172c961dfeb50de15f35784dbc7c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyZDExNWY2ZGI1MTcyYzk2MWRmZWI1MGRlMTVmMzU3ODRkYmM3Yzk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-07T16:54:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-07T16:54:23Z"}, "message": "Auto merge of #75199 - Mark-Simulacrum:debug-asserts, r=pietroalbini\n\nRe-enable debug and LLVM assertions\n\nHistorically we've disabled these assertions on a number of platforms with the\ngoal of speeding up CI. Now, though, having migrated to GitHub actions, CI is\nalready pretty fast, and these debug assertions do bring us some value.\n\nThis does leave in some debug assertions that are performance-related: macOS\ncurrently hovers at just under 2 hours.\n\nThere are also some other builders which have debug and LLVM assertions\ndisabled:\n\nllvm-8, PR builder:\n\nIn one view, this builder tests our support for older LLVMs. But in reality, a\nlot of our tests already disable themselves on older LLVMs, and I think our\ngeneral stance is that we really only support the in-tree LLVM. Plus, we really\nwant CI times on this builder to be really low, as it's run on *every* PR --\nthat's a lot of CI time.\n\ntest-various:\n\nThis disables debug asserts still -- as noted in the Dockerfile, we test code\nsize, and we need debug asserts off for that to work well.\n\nHelps with #59637 -- but doesn't close it, macOS still has asserts off.\n\nr? `@pietroalbini`", "tree": {"sha": "e83547f8680c3223ba4429f628a3231165661c8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e83547f8680c3223ba4429f628a3231165661c8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2d115f6db5172c961dfeb50de15f35784dbc7c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2d115f6db5172c961dfeb50de15f35784dbc7c9", "html_url": "https://github.com/rust-lang/rust/commit/b2d115f6db5172c961dfeb50de15f35784dbc7c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2d115f6db5172c961dfeb50de15f35784dbc7c9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0256d065d4901b63def6c04013da4f781d0752bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/0256d065d4901b63def6c04013da4f781d0752bb", "html_url": "https://github.com/rust-lang/rust/commit/0256d065d4901b63def6c04013da4f781d0752bb"}, {"sha": "3ca882986b31a801820a757dec0a89256804c0a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ca882986b31a801820a757dec0a89256804c0a7", "html_url": "https://github.com/rust-lang/rust/commit/3ca882986b31a801820a757dec0a89256804c0a7"}], "stats": {"total": 49, "additions": 0, "deletions": 49}, "files": [{"sha": "c45832e815330d95c089c776ab21163ec64f6ee0", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -321,8 +321,6 @@ jobs:\n             env:\n               RUST_CONFIGURE_ARGS: \"--build=x86_64-pc-windows-msvc --enable-profiler\"\n               SCRIPT: make ci-subset-1\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: x86_64-msvc-2\n             env:\n@@ -333,23 +331,17 @@ jobs:\n             env:\n               RUST_CONFIGURE_ARGS: \"--build=i686-pc-windows-msvc\"\n               SCRIPT: make ci-subset-1\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: i686-msvc-2\n             env:\n               RUST_CONFIGURE_ARGS: \"--build=i686-pc-windows-msvc\"\n               SCRIPT: make ci-subset-2\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: x86_64-msvc-cargo\n             env:\n               SCRIPT: python x.py --stage 2 test src/tools/cargotest src/tools/cargo\n               RUST_CONFIGURE_ARGS: \"--build=x86_64-pc-windows-msvc --enable-lld\"\n               VCVARS_BAT: vcvars64.bat\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: x86_64-msvc-tools\n             env:\n@@ -361,8 +353,6 @@ jobs:\n               RUST_CONFIGURE_ARGS: \"--build=i686-pc-windows-gnu\"\n               SCRIPT: make ci-mingw-subset-1\n               CUSTOM_MINGW: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: i686-mingw-2\n             env:\n@@ -375,8 +365,6 @@ jobs:\n               SCRIPT: make ci-mingw-subset-1\n               RUST_CONFIGURE_ARGS: \"--build=x86_64-pc-windows-gnu --enable-profiler\"\n               CUSTOM_MINGW: 1\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             os: windows-latest-xl\n           - name: x86_64-mingw-2\n             env:"}, {"sha": "0e28ea9668f07f6ea9d03d69abc2189384959f3a", "filename": "src/ci/docker/host-x86_64/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -27,6 +27,3 @@ RUN echo \"optimize = false\" >> /config/nopt-std-config.toml\n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu --disable-optimize-tests\n ENV SCRIPT python3 ../x.py test --stage 0 --config /config/nopt-std-config.toml library/std \\\n   && python3 ../x.py --stage 2 test\n-\n-# FIXME(#59637) takes too long on CI right now\n-ENV NO_LLVM_ASSERTIONS=1 NO_DEBUG_ASSERTIONS=1"}, {"sha": "195601755f303599b4a1183f0451604351476583", "filename": "src/ci/docker/host-x86_64/i686-gnu/Dockerfile", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -28,6 +28,3 @@ ENV SCRIPT python3 ../x.py --stage 2 test \\\n   --exclude src/test/rustdoc-js \\\n   --exclude src/tools/error_index_generator \\\n   --exclude src/tools/linkchecker\n-\n-# FIXME(#59637) takes too long on CI right now\n-ENV NO_LLVM_ASSERTIONS=1 NO_DEBUG_ASSERTIONS=1"}, {"sha": "5faa0ccab568b988293413b9ad1bc025082d9667", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -22,10 +22,3 @@ RUN sh /scripts/sccache.sh\n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --set rust.ignore-git=false\n ENV SCRIPT python3 ../x.py --stage 2 test distcheck\n ENV DIST_SRC 1\n-\n-# The purpose of this builder is to test that we can `./x.py --stage 2 test` successfully\n-# from a tarball, not to test LLVM/rustc's own set of assertions. These cause a\n-# significant hit to CI compile time (over a half hour as observed in #61185),\n-# so disable assertions for this builder.\n-ENV NO_LLVM_ASSERTIONS=1\n-ENV NO_DEBUG_ASSERTIONS=1"}, {"sha": "bd046f802c8d05292ef9576c0643631981d1fe9f", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-llvm-8/Dockerfile", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-8%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-8%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-8%2FDockerfile?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -57,9 +57,3 @@ ENV SCRIPT python2.7 ../x.py --stage 2 test --exclude src/tools/tidy && \\\n            python2.7 ../x.py --stage 2 test src/test/ui --pass=check && \\\n            # Run tidy at the very end, after all the other tests.\n            python2.7 ../x.py --stage 2 test src/tools/tidy\n-\n-# The purpose of this container isn't to test with debug assertions and\n-# this is run on all PRs, so let's get speedier builds by disabling these extra\n-# checks.\n-ENV NO_DEBUG_ASSERTIONS=1\n-ENV NO_LLVM_ASSERTIONS=1"}, {"sha": "4cbb7b62cd628ef0a5ac6feafb020e51b6656a10", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b2d115f6db5172c961dfeb50de15f35784dbc7c9/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=b2d115f6db5172c961dfeb50de15f35784dbc7c9", "patch": "@@ -500,9 +500,6 @@ jobs:\n             env:\n               RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-profiler\n               SCRIPT: make ci-subset-1\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: x86_64-msvc-2\n@@ -515,28 +512,19 @@ jobs:\n             env:\n               RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n               SCRIPT: make ci-subset-1\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: i686-msvc-2\n             env:\n               RUST_CONFIGURE_ARGS: --build=i686-pc-windows-msvc\n               SCRIPT: make ci-subset-2\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: x86_64-msvc-cargo\n             env:\n               SCRIPT: python x.py --stage 2 test src/tools/cargotest src/tools/cargo\n               RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-lld\n               VCVARS_BAT: vcvars64.bat\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: x86_64-msvc-tools\n@@ -566,9 +554,6 @@ jobs:\n               RUST_CONFIGURE_ARGS: --build=i686-pc-windows-gnu\n               SCRIPT: make ci-mingw-subset-1\n               CUSTOM_MINGW: 1\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: i686-mingw-2\n@@ -583,9 +568,6 @@ jobs:\n               SCRIPT: make ci-mingw-subset-1\n               RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-gnu --enable-profiler\n               CUSTOM_MINGW: 1\n-              # FIXME(#59637)\n-              NO_DEBUG_ASSERTIONS: 1\n-              NO_LLVM_ASSERTIONS: 1\n             <<: *job-windows-xl\n \n           - name: x86_64-mingw-2"}]}