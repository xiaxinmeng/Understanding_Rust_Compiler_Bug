{"sha": "008ba7326b315abd1d6ef693d773b88ccb044ba4", "node_id": "C_kwDOAAsO6NoAKDAwOGJhNzMyNmIzMTVhYmQxZDZlZjY5M2Q3NzNiODhjY2IwNDRiYTQ", "commit": {"author": {"name": "Michael Schubart", "email": "michael@schubart.net", "date": "2023-03-12T14:56:14Z"}, "committer": {"name": "Michael Schubart", "email": "michael@schubart.net", "date": "2023-04-11T01:32:09Z"}, "message": "Ignore fake read access", "tree": {"sha": "05c2b5970d92bc741a4a84f497be5187206ff91c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05c2b5970d92bc741a4a84f497be5187206ff91c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/008ba7326b315abd1d6ef693d773b88ccb044ba4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/008ba7326b315abd1d6ef693d773b88ccb044ba4", "html_url": "https://github.com/rust-lang/rust/commit/008ba7326b315abd1d6ef693d773b88ccb044ba4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/008ba7326b315abd1d6ef693d773b88ccb044ba4/comments", "author": {"login": "schubart", "id": 75188, "node_id": "MDQ6VXNlcjc1MTg4", "avatar_url": "https://avatars.githubusercontent.com/u/75188?v=4", "gravatar_id": "", "url": "https://api.github.com/users/schubart", "html_url": "https://github.com/schubart", "followers_url": "https://api.github.com/users/schubart/followers", "following_url": "https://api.github.com/users/schubart/following{/other_user}", "gists_url": "https://api.github.com/users/schubart/gists{/gist_id}", "starred_url": "https://api.github.com/users/schubart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/schubart/subscriptions", "organizations_url": "https://api.github.com/users/schubart/orgs", "repos_url": "https://api.github.com/users/schubart/repos", "events_url": "https://api.github.com/users/schubart/events{/privacy}", "received_events_url": "https://api.github.com/users/schubart/received_events", "type": "User", "site_admin": false}, "committer": {"login": "schubart", "id": 75188, "node_id": "MDQ6VXNlcjc1MTg4", "avatar_url": "https://avatars.githubusercontent.com/u/75188?v=4", "gravatar_id": "", "url": "https://api.github.com/users/schubart", "html_url": "https://github.com/schubart", "followers_url": "https://api.github.com/users/schubart/followers", "following_url": "https://api.github.com/users/schubart/following{/other_user}", "gists_url": "https://api.github.com/users/schubart/gists{/gist_id}", "starred_url": "https://api.github.com/users/schubart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/schubart/subscriptions", "organizations_url": "https://api.github.com/users/schubart/orgs", "repos_url": "https://api.github.com/users/schubart/repos", "events_url": "https://api.github.com/users/schubart/events{/privacy}", "received_events_url": "https://api.github.com/users/schubart/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63030acf4ff453da2beb7f43b13cca8fb6cf425a", "url": "https://api.github.com/repos/rust-lang/rust/commits/63030acf4ff453da2beb7f43b13cca8fb6cf425a", "html_url": "https://github.com/rust-lang/rust/commit/63030acf4ff453da2beb7f43b13cca8fb6cf425a"}], "stats": {"total": 32, "additions": 23, "deletions": 9}, "files": [{"sha": "5e2eb5789f6271bc4a05c38d609397cc7a417267", "filename": "clippy_lints/src/collection_is_never_read.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/008ba7326b315abd1d6ef693d773b88ccb044ba4/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs", "raw_url": "https://github.com/rust-lang/rust/raw/008ba7326b315abd1d6ef693d773b88ccb044ba4/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcollection_is_never_read.rs?ref=008ba7326b315abd1d6ef693d773b88ccb044ba4", "patch": "@@ -120,6 +120,15 @@ fn has_no_read_access<'tcx>(cx: &LateContext<'tcx>, id: HirId, block: &'tcx Bloc\n             if let Some(Node::Stmt(..)) = get_parent_node(cx.tcx, parent.hir_id) {\n                 return ControlFlow::Continue(());\n             }\n+\n+            // The method call is not a statement, so its return value is used somehow but its type is the\n+            // unit type, so this is not a real read access. Examples:\n+            //\n+            // let y = x.clear();\n+            // println!(\"{:?}\", x.clear());\n+            if cx.typeck_results().expr_ty(parent).is_unit() {\n+                return ControlFlow::Continue(());\n+            }\n         }\n \n         // Any other access to `id` is a read access. Stop searching."}, {"sha": "4f9431be72a7fcd69477c5dda821f15046e975df", "filename": "tests/ui/collection_is_never_read.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/008ba7326b315abd1d6ef693d773b88ccb044ba4/tests%2Fui%2Fcollection_is_never_read.rs", "raw_url": "https://github.com/rust-lang/rust/raw/008ba7326b315abd1d6ef693d773b88ccb044ba4/tests%2Fui%2Fcollection_is_never_read.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcollection_is_never_read.rs?ref=008ba7326b315abd1d6ef693d773b88ccb044ba4", "patch": "@@ -85,9 +85,8 @@ fn shadowing_2() {\n \n #[allow(clippy::let_unit_value)]\n fn fake_read() {\n-    let mut x = vec![1, 2, 3]; // Ok\n+    let mut x = vec![1, 2, 3]; // WARNING\n     x.reverse();\n-    // `collection_is_never_read` gets fooled, but other lints should catch this.\n     let _: () = x.clear();\n }\n "}, {"sha": "cfb392983391e970e8243fe03e5bc39d31c70d99", "filename": "tests/ui/collection_is_never_read.stderr", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/008ba7326b315abd1d6ef693d773b88ccb044ba4/tests%2Fui%2Fcollection_is_never_read.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/008ba7326b315abd1d6ef693d773b88ccb044ba4/tests%2Fui%2Fcollection_is_never_read.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcollection_is_never_read.stderr?ref=008ba7326b315abd1d6ef693d773b88ccb044ba4", "patch": "@@ -25,40 +25,46 @@ LL |     let mut x = HashMap::new(); // WARNING\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:95:5\n+  --> $DIR/collection_is_never_read.rs:88:5\n    |\n LL |     let mut x = vec![1, 2, 3]; // WARNING\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:102:5\n+  --> $DIR/collection_is_never_read.rs:94:5\n    |\n LL |     let mut x = vec![1, 2, 3]; // WARNING\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:119:5\n+  --> $DIR/collection_is_never_read.rs:101:5\n+   |\n+LL |     let mut x = vec![1, 2, 3]; // WARNING\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: collection is never read\n+  --> $DIR/collection_is_never_read.rs:118:5\n    |\n LL |     let mut x = HashSet::new(); // WARNING\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:133:5\n+  --> $DIR/collection_is_never_read.rs:132:5\n    |\n LL |     let x = vec![1, 2, 3]; // WARNING\n    |     ^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:169:5\n+  --> $DIR/collection_is_never_read.rs:168:5\n    |\n LL |     let mut s = String::new();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: collection is never read\n-  --> $DIR/collection_is_never_read.rs:182:5\n+  --> $DIR/collection_is_never_read.rs:181:5\n    |\n LL |     let mut s = String::from(\"Hello, World!\");\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 10 previous errors\n+error: aborting due to 11 previous errors\n "}]}