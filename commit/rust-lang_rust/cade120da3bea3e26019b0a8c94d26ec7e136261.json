{"sha": "cade120da3bea3e26019b0a8c94d26ec7e136261", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhZGUxMjBkYTNiZWEzZTI2MDE5YjBhOGM5NGQyNmVjN2UxMzYyNjE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-20T19:16:41Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-20T20:59:07Z"}, "message": "Rollup merge of #38463 - japaric:asm-args, r=alexcrichton\n\ntarget spec: add an asm-args field to pass arguments to the external ..\n\nassembler\n\nThe main use case is the (still out of tree) msp430 target. For that target we use an external assembler, `mps430-elf-gcc`, to produce object files from the assembly rustc/llvm outputs. The problem is that by default `msp430-elf-gcc` produces object files for the MSP430**X** ABI but we want to use produce objects using the MSP430 (note: no X) ABI. To do that we have to pass `-mcpu=msp430` to the assembler and that's what this flag is for.\n\nr? @alexcrichton\ncc @pftbest", "tree": {"sha": "d8e0b0aec0229bc9e92555be88c78727a6b00b6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8e0b0aec0229bc9e92555be88c78727a6b00b6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cade120da3bea3e26019b0a8c94d26ec7e136261", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cade120da3bea3e26019b0a8c94d26ec7e136261", "html_url": "https://github.com/rust-lang/rust/commit/cade120da3bea3e26019b0a8c94d26ec7e136261", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cade120da3bea3e26019b0a8c94d26ec7e136261/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60842c1c1fdb69bccc58613e26f1c9661ca8bd39", "url": "https://api.github.com/repos/rust-lang/rust/commits/60842c1c1fdb69bccc58613e26f1c9661ca8bd39", "html_url": "https://github.com/rust-lang/rust/commit/60842c1c1fdb69bccc58613e26f1c9661ca8bd39"}, {"sha": "bd85a6dbe71807774764e52600aa5429ac878b1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd85a6dbe71807774764e52600aa5429ac878b1d", "html_url": "https://github.com/rust-lang/rust/commit/bd85a6dbe71807774764e52600aa5429ac878b1d"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "13333be66f5701a0dbb4c7123e1da9ab05d20cdd", "filename": "src/librustc_back/target/mod.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cade120da3bea3e26019b0a8c94d26ec7e136261/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cade120da3bea3e26019b0a8c94d26ec7e136261/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fmod.rs?ref=cade120da3bea3e26019b0a8c94d26ec7e136261", "patch": "@@ -267,6 +267,9 @@ pub struct TargetOptions {\n     /// user-defined libraries.\n     pub post_link_args: Vec<String>,\n \n+    /// Extra arguments to pass to the external assembler (when used)\n+    pub asm_args: Vec<String>,\n+\n     /// Default CPU to pass to LLVM. Corresponds to `llc -mcpu=$cpu`. Defaults\n     /// to \"generic\".\n     pub cpu: String,\n@@ -394,6 +397,7 @@ impl Default for TargetOptions {\n             ar: option_env!(\"CFG_DEFAULT_AR\").unwrap_or(\"ar\").to_string(),\n             pre_link_args: Vec::new(),\n             post_link_args: Vec::new(),\n+            asm_args: Vec::new(),\n             cpu: \"generic\".to_string(),\n             features: \"\".to_string(),\n             dynamic_linking: false,\n@@ -561,6 +565,7 @@ impl Target {\n         key!(late_link_args, list);\n         key!(post_link_objects, list);\n         key!(post_link_args, list);\n+        key!(asm_args, list);\n         key!(cpu);\n         key!(features);\n         key!(dynamic_linking, bool);\n@@ -723,6 +728,7 @@ impl ToJson for Target {\n         target_option_val!(late_link_args);\n         target_option_val!(post_link_objects);\n         target_option_val!(post_link_args);\n+        target_option_val!(asm_args);\n         target_option_val!(cpu);\n         target_option_val!(features);\n         target_option_val!(dynamic_linking);"}, {"sha": "de8814f143e04f62b4c07b046a7c5ac0039b01f7", "filename": "src/librustc_trans/back/write.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cade120da3bea3e26019b0a8c94d26ec7e136261/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cade120da3bea3e26019b0a8c94d26ec7e136261/src%2Flibrustc_trans%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fwrite.rs?ref=cade120da3bea3e26019b0a8c94d26ec7e136261", "patch": "@@ -1085,6 +1085,10 @@ fn run_work_multithreaded(sess: &Session,\n pub fn run_assembler(sess: &Session, outputs: &OutputFilenames) {\n     let (pname, mut cmd, _) = get_linker(sess);\n \n+    for arg in &sess.target.target.options.asm_args {\n+        cmd.arg(arg);\n+    }\n+\n     cmd.arg(\"-c\").arg(\"-o\").arg(&outputs.path(OutputType::Object))\n                            .arg(&outputs.temp_path(OutputType::Assembly, None));\n     debug!(\"{:?}\", cmd);"}]}