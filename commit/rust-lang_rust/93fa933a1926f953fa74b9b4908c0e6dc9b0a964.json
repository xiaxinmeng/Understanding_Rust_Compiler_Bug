{"sha": "93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzZmE5MzNhMTkyNmY5NTNmYTc0YjliNDkwOGMwZTZkYzliMGE5NjQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-03T10:46:18Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-06T03:39:56Z"}, "message": "rt: Move some locking from rust_port to rust_task", "tree": {"sha": "9f57404b2ec833a25f66b98eff4b32563d2a99ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f57404b2ec833a25f66b98eff4b32563d2a99ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "html_url": "https://github.com/rust-lang/rust/commit/93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93fa933a1926f953fa74b9b4908c0e6dc9b0a964/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3ccac8ed3b447ffecfbba7402760c083b9e51e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3ccac8ed3b447ffecfbba7402760c083b9e51e2", "html_url": "https://github.com/rust-lang/rust/commit/e3ccac8ed3b447ffecfbba7402760c083b9e51e2"}], "stats": {"total": 8, "additions": 2, "deletions": 6}, "files": [{"sha": "46e18ba1acb5287b5a3ab26a9ab6a3c07d75ac2f", "filename": "src/rt/rust_port.cpp", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/93fa933a1926f953fa74b9b4908c0e6dc9b0a964/src%2Frt%2Frust_port.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/93fa933a1926f953fa74b9b4908c0e6dc9b0a964/src%2Frt%2Frust_port.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_port.cpp?ref=93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "patch": "@@ -21,11 +21,7 @@ rust_port::~rust_port() {\n }\n \n void rust_port::detach() {\n-    I(task->thread, !task->port_lock.lock_held_by_current_thread());\n-    scoped_lock with(task->port_lock);\n-    {\n-        task->release_port(id);\n-    }\n+    task->release_port(id);\n }\n \n void rust_port::send(void *sptr) {"}, {"sha": "c9838b193e688837caca1140477c79c5d50e8dd4", "filename": "src/rt/rust_task.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/93fa933a1926f953fa74b9b4908c0e6dc9b0a964/src%2Frt%2Frust_task.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/93fa933a1926f953fa74b9b4908c0e6dc9b0a964/src%2Frt%2Frust_task.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_task.cpp?ref=93fa933a1926f953fa74b9b4908c0e6dc9b0a964", "patch": "@@ -481,7 +481,7 @@ rust_port_id rust_task::register_port(rust_port *port) {\n }\n \n void rust_task::release_port(rust_port_id id) {\n-    I(thread, port_lock.lock_held_by_current_thread());\n+    scoped_lock with(port_lock);\n     port_table.remove(id);\n }\n "}]}