{"sha": "f07338bae2e4209d5e47e69f131bfa9efc56c890", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwNzMzOGJhZTJlNDIwOWQ1ZTQ3ZTY5ZjEzMWJmYTllZmM1NmM4OTA=", "commit": {"author": {"name": "adamrk", "email": "ark.email@gmail.com", "date": "2020-06-20T09:43:40Z"}, "committer": {"name": "adamrk", "email": "ark.email@gmail.com", "date": "2020-06-20T09:43:40Z"}, "message": "Add test for dyn Fn Output", "tree": {"sha": "158221def6fd8930454a9d411b8bb298be3a15f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/158221def6fd8930454a9d411b8bb298be3a15f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f07338bae2e4209d5e47e69f131bfa9efc56c890", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f07338bae2e4209d5e47e69f131bfa9efc56c890", "html_url": "https://github.com/rust-lang/rust/commit/f07338bae2e4209d5e47e69f131bfa9efc56c890", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f07338bae2e4209d5e47e69f131bfa9efc56c890/comments", "author": {"login": "adamrk", "id": 16367467, "node_id": "MDQ6VXNlcjE2MzY3NDY3", "avatar_url": "https://avatars.githubusercontent.com/u/16367467?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamrk", "html_url": "https://github.com/adamrk", "followers_url": "https://api.github.com/users/adamrk/followers", "following_url": "https://api.github.com/users/adamrk/following{/other_user}", "gists_url": "https://api.github.com/users/adamrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamrk/subscriptions", "organizations_url": "https://api.github.com/users/adamrk/orgs", "repos_url": "https://api.github.com/users/adamrk/repos", "events_url": "https://api.github.com/users/adamrk/events{/privacy}", "received_events_url": "https://api.github.com/users/adamrk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "adamrk", "id": 16367467, "node_id": "MDQ6VXNlcjE2MzY3NDY3", "avatar_url": "https://avatars.githubusercontent.com/u/16367467?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamrk", "html_url": "https://github.com/adamrk", "followers_url": "https://api.github.com/users/adamrk/followers", "following_url": "https://api.github.com/users/adamrk/following{/other_user}", "gists_url": "https://api.github.com/users/adamrk/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamrk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamrk/subscriptions", "organizations_url": "https://api.github.com/users/adamrk/orgs", "repos_url": "https://api.github.com/users/adamrk/repos", "events_url": "https://api.github.com/users/adamrk/events{/privacy}", "received_events_url": "https://api.github.com/users/adamrk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "436dcd9656b89b10a9719828a3421b4586ac331f", "url": "https://api.github.com/repos/rust-lang/rust/commits/436dcd9656b89b10a9719828a3421b4586ac331f", "html_url": "https://github.com/rust-lang/rust/commit/436dcd9656b89b10a9719828a3421b4586ac331f"}], "stats": {"total": 68, "additions": 68, "deletions": 0}, "files": [{"sha": "dd5bdd2d01186bd80df07b065b997a53fe985858", "filename": "crates/ra_hir_ty/src/tests/traits.rs", "status": "modified", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/f07338bae2e4209d5e47e69f131bfa9efc56c890/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f07338bae2e4209d5e47e69f131bfa9efc56c890/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=f07338bae2e4209d5e47e69f131bfa9efc56c890", "patch": "@@ -3043,3 +3043,71 @@ fn infer_box_fn_arg() {\n     \"###\n     );\n }\n+\n+#[test]\n+fn infer_dyn_fn_output() {\n+    assert_snapshot!(\n+        infer(\n+            r#\"\n+            //- /lib.rs deps:std\n+\n+            #[lang = \"fn_once\"]\n+            pub trait FnOnce<Args> {\n+                type Output;\n+\n+                extern \"rust-call\" fn call_once(self, args: Args) -> Self::Output;\n+            }\n+\n+            #[lang = \"fn\"]\n+            pub trait Fn<Args>:FnOnce<Args> {\n+                extern \"rust-call\" fn call(&self, args: Args) -> Self::Output;\n+            }\n+\n+            #[lang = \"deref\"]\n+            pub trait Deref {\n+                type Target: ?Sized;\n+\n+                fn deref(&self) -> &Self::Target;\n+            }\n+\n+            #[lang = \"owned_box\"]\n+            pub struct Box<T: ?Sized> {\n+                inner: *mut T,\n+            }\n+\n+            impl<T: ?Sized> Deref for Box<T> {\n+                type Target = T;\n+\n+                fn deref(&self) -> &T {\n+                    &self.inner\n+                }\n+            }\n+\n+            fn foo() {\n+                let f: Box<dyn Fn() -> i32> = box(|| 5);\n+                let x = f();\n+            }\n+        \"#\n+        ),\n+        @r###\"\n+    182..186 'self': Self\n+    188..192 'args': Args\n+    349..353 'self': &Self\n+    355..359 'args': Args\n+    523..527 'self': &Self\n+    789..793 'self': &Box<T>\n+    801..852 '{     ...     }': &T\n+    823..834 '&self.inner': &*mut T\n+    824..828 'self': &Box<T>\n+    824..834 'self.inner': *mut T\n+    889..990 '{     ...     }': ()\n+    911..912 'f': Box<dyn Fn<(), Output = i32>>\n+    937..946 'box(|| 5)': Box<|| -> i32>\n+    941..945 '|| 5': || -> i32\n+    944..945 '5': i32\n+    968..969 'x': i32\n+    972..973 'f': Box<dyn Fn<(), Output = i32>>\n+    972..975 'f()': i32\n+    \"###\n+    );\n+}"}]}