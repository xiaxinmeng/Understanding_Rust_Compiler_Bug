{"sha": "37bfef023dab045852ea577dbe40693147a810f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3YmZlZjAyM2RhYjA0NTg1MmVhNTc3ZGJlNDA2OTMxNDdhODEwZjU=", "commit": {"author": {"name": "Jeremy Soller", "email": "jackpot51@gmail.com", "date": "2016-10-30T15:36:04Z"}, "committer": {"name": "Jeremy Soller", "email": "jackpot51@gmail.com", "date": "2016-10-30T15:36:04Z"}, "message": "Implement thread", "tree": {"sha": "9fc8b7f11ecd36805f2d2b0da592b85cbf686b05", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fc8b7f11ecd36805f2d2b0da592b85cbf686b05"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37bfef023dab045852ea577dbe40693147a810f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37bfef023dab045852ea577dbe40693147a810f5", "html_url": "https://github.com/rust-lang/rust/commit/37bfef023dab045852ea577dbe40693147a810f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37bfef023dab045852ea577dbe40693147a810f5/comments", "author": {"login": "jackpot51", "id": 7741236, "node_id": "MDQ6VXNlcjc3NDEyMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7741236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackpot51", "html_url": "https://github.com/jackpot51", "followers_url": "https://api.github.com/users/jackpot51/followers", "following_url": "https://api.github.com/users/jackpot51/following{/other_user}", "gists_url": "https://api.github.com/users/jackpot51/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackpot51/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackpot51/subscriptions", "organizations_url": "https://api.github.com/users/jackpot51/orgs", "repos_url": "https://api.github.com/users/jackpot51/repos", "events_url": "https://api.github.com/users/jackpot51/events{/privacy}", "received_events_url": "https://api.github.com/users/jackpot51/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jackpot51", "id": 7741236, "node_id": "MDQ6VXNlcjc3NDEyMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7741236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackpot51", "html_url": "https://github.com/jackpot51", "followers_url": "https://api.github.com/users/jackpot51/followers", "following_url": "https://api.github.com/users/jackpot51/following{/other_user}", "gists_url": "https://api.github.com/users/jackpot51/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackpot51/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackpot51/subscriptions", "organizations_url": "https://api.github.com/users/jackpot51/orgs", "repos_url": "https://api.github.com/users/jackpot51/repos", "events_url": "https://api.github.com/users/jackpot51/events{/privacy}", "received_events_url": "https://api.github.com/users/jackpot51/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea6f5aa1b19655035475c7155441f658eeccdc5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea6f5aa1b19655035475c7155441f658eeccdc5a", "html_url": "https://github.com/rust-lang/rust/commit/ea6f5aa1b19655035475c7155441f658eeccdc5a"}], "stats": {"total": 26, "additions": 12, "deletions": 14}, "files": [{"sha": "46bc6346a6a80563f1a52c1c1a35c487d671f0b3", "filename": "src/libstd/sys/redox/thread.rs", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/37bfef023dab045852ea577dbe40693147a810f5/src%2Flibstd%2Fsys%2Fredox%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37bfef023dab045852ea577dbe40693147a810f5/src%2Flibstd%2Fsys%2Fredox%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fthread.rs?ref=37bfef023dab045852ea577dbe40693147a810f5", "patch": "@@ -15,6 +15,7 @@ use io;\n use libc;\n use mem;\n use sys_common::thread::start_thread;\n+use sys::cvt;\n use time::Duration;\n \n pub struct Thread {\n@@ -30,11 +31,15 @@ impl Thread {\n     pub unsafe fn new<'a>(_stack: usize, p: Box<FnBox() + 'a>) -> io::Result<Thread> {\n         let p = box p;\n \n-        start_thread(&*p as *const _ as *mut _);\n-\n-        ::sys_common::util::dumb_print(format_args!(\"thread\\n\"));\n-\n-        unimplemented!();\n+        let id = cvt(libc::clone(libc::CLONE_VM | libc::CLONE_FS | libc::CLONE_FILES))?;\n+        if id == 0 {\n+            start_thread(&*p as *const _ as *mut _);\n+            let _ = libc::exit(0);\n+            panic!(\"thread failed to exit\");\n+        } else {\n+            mem::forget(p);\n+            Ok(Thread { id: id })\n+        }\n     }\n \n     pub fn yield_now() {\n@@ -69,8 +74,8 @@ impl Thread {\n     }\n \n     pub fn join(self) {\n-        ::sys_common::util::dumb_print(format_args!(\"Thread::join\"));\n-        unimplemented!();\n+        let mut status = 0;\n+        libc::waitpid(self.id, &mut status, 0).unwrap();\n     }\n \n     pub fn id(&self) -> libc::pid_t { self.id }\n@@ -82,13 +87,6 @@ impl Thread {\n     }\n }\n \n-impl Drop for Thread {\n-    fn drop(&mut self) {\n-        ::sys_common::util::dumb_print(format_args!(\"Thread::drop\"));\n-        unimplemented!();\n-    }\n-}\n-\n pub mod guard {\n     pub unsafe fn current() -> Option<usize> { None }\n     pub unsafe fn init() -> Option<usize> { None }"}]}