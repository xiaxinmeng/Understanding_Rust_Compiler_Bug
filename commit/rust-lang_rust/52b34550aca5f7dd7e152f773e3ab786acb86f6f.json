{"sha": "52b34550aca5f7dd7e152f773e3ab786acb86f6f", "node_id": "C_kwDOAAsO6NoAKDUyYjM0NTUwYWNhNWY3ZGQ3ZTE1MmY3NzNlM2FiNzg2YWNiODZmNmY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-15T20:13:35Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-15T20:13:35Z"}, "message": "Auto merge of #94973 - GuillaumeGomez:more-gui-tests, r=notriddle\n\nAdd GUI test to check URLs\n\nThe first commit merges both file doing kinda the same thing. Didn't make much sense to keep them separated.\n\nThe second commit add checks to ensure the URL has the expected value depending if the search is displayed or not.\n\nr? `@notriddle`", "tree": {"sha": "8b75b5476a5271846c581d34f0fed5bf320d42f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b75b5476a5271846c581d34f0fed5bf320d42f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52b34550aca5f7dd7e152f773e3ab786acb86f6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52b34550aca5f7dd7e152f773e3ab786acb86f6f", "html_url": "https://github.com/rust-lang/rust/commit/52b34550aca5f7dd7e152f773e3ab786acb86f6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52b34550aca5f7dd7e152f773e3ab786acb86f6f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83460d5e624e9dff72ea8c8f6e79c10af10a3aa1", "url": "https://api.github.com/repos/rust-lang/rust/commits/83460d5e624e9dff72ea8c8f6e79c10af10a3aa1", "html_url": "https://github.com/rust-lang/rust/commit/83460d5e624e9dff72ea8c8f6e79c10af10a3aa1"}, {"sha": "372271e3dd5dce4ff5de7861f3b281d7a092343f", "url": "https://api.github.com/repos/rust-lang/rust/commits/372271e3dd5dce4ff5de7861f3b281d7a092343f", "html_url": "https://github.com/rust-lang/rust/commit/372271e3dd5dce4ff5de7861f3b281d7a092343f"}], "stats": {"total": 45, "additions": 26, "deletions": 19}, "files": [{"sha": "6e305e81eeec04b6ff7861c6a90b44d86bc25cff", "filename": "src/test/rustdoc-gui/escape-key.goml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "raw_url": "https://github.com/rust-lang/rust/raw/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml?ref=52b34550aca5f7dd7e152f773e3ab786acb86f6f", "patch": "@@ -6,23 +6,28 @@ write: (\".search-input\", \"test\")\n wait-for: \"#search h1\" // The search element is empty before the first search \n assert-attribute: (\"#search\", {\"class\": \"content\"})\n assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})\n+assert-document-property: ({\"URL\": \"index.html?search=test\"}, ENDS_WITH)\n press-key: \"Escape\"\n assert-attribute: (\"#search\", {\"class\": \"content hidden\"})\n assert-attribute: (\"#main-content\", {\"class\": \"content\"})\n+assert-document-property: ({\"URL\": \"index.html\"}, [ENDS_WITH])\n \n // Check that focusing the search input brings back the search results\n focus: \".search-input\"\n assert-attribute: (\"#search\", {\"class\": \"content\"})\n assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})\n+assert-document-property: ({\"URL\": \"index.html?search=test\"}, ENDS_WITH)\n \n // Now let's check that when the help popup is displayed and we press Escape, it doesn't\n // hide the search results too.\n click: \"#help-button\"\n+assert-document-property: ({\"URL\": \"index.html?search=test\"}, [ENDS_WITH])\n assert-attribute: (\"#help\", {\"class\": \"\"})\n press-key: \"Escape\"\n assert-attribute: (\"#help\", {\"class\": \"hidden\"})\n assert-attribute: (\"#search\", {\"class\": \"content\"})\n assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})\n+assert-document-property: ({\"URL\": \"index.html?search=test\"}, [ENDS_WITH])\n \n // Check that Escape hides the search results when a search result is focused.\n focus: \".search-input\""}, {"sha": "3f78d60f28cdfa19110ea4dd560cb8bc05fabe8d", "filename": "src/test/rustdoc-gui/search-filter.goml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "raw_url": "https://github.com/rust-lang/rust/raw/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml?ref=52b34550aca5f7dd7e152f773e3ab786acb86f6f", "patch": "@@ -15,6 +15,7 @@ press-key: \"ArrowDown\"\n press-key: \"Enter\"\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n+assert-document-property: ({\"URL\": \"&filter-crate=\"}, CONTAINS)\n // We check that there is no more \"test_docs\" appearing.\n assert-false: \"#results .externcrate\"\n // We also check that \"lib2\" is the filter crate."}, {"sha": "901634fe0e635a381124505e25d849499b70b398", "filename": "src/test/rustdoc-gui/search-result-color.goml", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml", "raw_url": "https://github.com/rust-lang/rust/raw/52b34550aca5f7dd7e152f773e3ab786acb86f6f/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-color.goml?ref=52b34550aca5f7dd7e152f773e3ab786acb86f6f", "patch": "@@ -74,3 +74,23 @@ assert-css: (\n     \"//*[@class='result-name']//*[text()='(keyword)']\",\n     {\"color\": \"rgb(0, 0, 0)\"},\n )\n+\n+// Check the alias more specifically in the dark theme.\n+goto: file://|DOC_PATH|/test_docs/index.html\n+// We set the theme so we're sure that the correct values will be used, whatever the computer\n+// this test is running on.\n+local-storage: {\n+    \"rustdoc-theme\": \"dark\",\n+    \"rustdoc-preferred-dark-theme\": \"dark\",\n+    \"rustdoc-use-system-theme\": \"false\",\n+}\n+// If the text isn't displayed, the browser doesn't compute color style correctly...\n+show-text: true\n+// We reload the page so the local storage settings are being used.\n+reload:\n+write: (\".search-input\", \"thisisanalias\")\n+// Waiting for the search results to appear...\n+wait-for: \"#titles\"\n+// Checking that the colors for the alias element are the ones expected.\n+assert-css: (\".result-name > .alias\", {\"color\": \"rgb(255, 255, 255)\"})\n+assert-css: (\".result-name > .alias > .grey\", {\"color\": \"rgb(204, 204, 204)\"})"}, {"sha": "872df5fc3f95b9dc4d869c0dac832ad3647f3475", "filename": "src/test/rustdoc-gui/search-result-colors.goml", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/83460d5e624e9dff72ea8c8f6e79c10af10a3aa1/src%2Ftest%2Frustdoc-gui%2Fsearch-result-colors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/83460d5e624e9dff72ea8c8f6e79c10af10a3aa1/src%2Ftest%2Frustdoc-gui%2Fsearch-result-colors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-result-colors.goml?ref=83460d5e624e9dff72ea8c8f6e79c10af10a3aa1", "patch": "@@ -1,19 +0,0 @@\n-// Checks that the result colors are as expected.\n-goto: file://|DOC_PATH|/test_docs/index.html\n-// We set the theme so we're sure that the correct values will be used, whatever the computer\n-// this test is running on.\n-local-storage: {\n-    \"rustdoc-theme\": \"dark\",\n-    \"rustdoc-preferred-dark-theme\": \"dark\",\n-    \"rustdoc-use-system-theme\": \"false\",\n-}\n-// If the text isn't displayed, the browser doesn't compute color style correctly...\n-show-text: true\n-// We reload the page so the local storage settings are being used.\n-reload:\n-write: (\".search-input\", \"thisisanalias\")\n-// Waiting for the search results to appear...\n-wait-for: \"#titles\"\n-// Checking that the colors for the alias element are the ones expected.\n-assert-css: (\".result-name > .alias\", {\"color\": \"rgb(255, 255, 255)\"})\n-assert-css: (\".result-name > .alias > .grey\", {\"color\": \"rgb(204, 204, 204)\"})"}]}