{"sha": "51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxY2JjYzUzNDY4YTRmOWZiZWFlOGIxMWYxYjFiMGYwOWE5ZDM0NTQ=", "commit": {"author": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-05-30T16:37:02Z"}, "committer": {"name": "cynecx", "email": "me@cynecx.net", "date": "2021-05-30T17:21:08Z"}, "message": "hir_ty: don't pass where clauses of associated types down to chalk (temp. fix #9052)", "tree": {"sha": "c501ce084b291fdc28dc99b534130a794b08d649", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c501ce084b291fdc28dc99b534130a794b08d649"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "html_url": "https://github.com/rust-lang/rust/commit/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454/comments", "author": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cynecx", "id": 5961244, "node_id": "MDQ6VXNlcjU5NjEyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5961244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cynecx", "html_url": "https://github.com/cynecx", "followers_url": "https://api.github.com/users/cynecx/followers", "following_url": "https://api.github.com/users/cynecx/following{/other_user}", "gists_url": "https://api.github.com/users/cynecx/gists{/gist_id}", "starred_url": "https://api.github.com/users/cynecx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cynecx/subscriptions", "organizations_url": "https://api.github.com/users/cynecx/orgs", "repos_url": "https://api.github.com/users/cynecx/repos", "events_url": "https://api.github.com/users/cynecx/events{/privacy}", "received_events_url": "https://api.github.com/users/cynecx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1d163ba51b7a06e2e34ea2b27c4c948a0ff2320", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1d163ba51b7a06e2e34ea2b27c4c948a0ff2320", "html_url": "https://github.com/rust-lang/rust/commit/f1d163ba51b7a06e2e34ea2b27c4c948a0ff2320"}], "stats": {"total": 39, "additions": 28, "deletions": 11}, "files": [{"sha": "4e042bf4223e165d38fccf36788dc48d22c06550", "filename": "crates/hir_ty/src/chalk_db.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454/crates%2Fhir_ty%2Fsrc%2Fchalk_db.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454/crates%2Fhir_ty%2Fsrc%2Fchalk_db.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fchalk_db.rs?ref=51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "patch": "@@ -383,7 +383,7 @@ pub(crate) fn associated_ty_data_query(\n     // Lower bounds -- we could/should maybe move this to a separate query in `lower`\n     let type_alias_data = db.type_alias_data(type_alias);\n     let generic_params = generics(db.upcast(), type_alias.into());\n-    let bound_vars = generic_params.bound_vars_subst(DebruijnIndex::INNERMOST);\n+    // let bound_vars = generic_params.bound_vars_subst(DebruijnIndex::INNERMOST);\n     let resolver = hir_def::resolver::HasResolver::resolver(type_alias, db.upcast());\n     let ctx = crate::TyLoweringContext::new(db, &resolver)\n         .with_type_param_mode(crate::lower::TypeParamLoweringMode::Variable);\n@@ -396,8 +396,10 @@ pub(crate) fn associated_ty_data_query(\n         .filter_map(|pred| generic_predicate_to_inline_bound(db, &pred, &self_ty))\n         .collect();\n \n-    let where_clauses = convert_where_clauses(db, type_alias.into(), &bound_vars);\n-    let bound_data = rust_ir::AssociatedTyDatumBound { bounds, where_clauses };\n+    // FIXME: Re-enable where clauses on associated types when an upstream chalk bug is fixed.\n+    //        (rust-analyzer#9052)\n+    // let where_clauses = convert_where_clauses(db, type_alias.into(), &bound_vars);\n+    let bound_data = rust_ir::AssociatedTyDatumBound { bounds, where_clauses: vec![] };\n     let datum = AssociatedTyDatum {\n         trait_id: to_chalk_trait_id(trait_),\n         id,"}, {"sha": "49add4ab99d6fe98fec2d5d4f1e366b28203fe41", "filename": "crates/hir_ty/src/tests/traits.rs", "status": "modified", "additions": 23, "deletions": 8, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=51cbcc53468a4f9fbeae8b11f1b1b0f09a9d3454", "patch": "@@ -161,7 +161,7 @@ mod result {\n }\n \n #[test]\n-fn infer_tryv2() {\n+fn infer_try_trait_v2() {\n     check_types(\n         r#\"\n //- /main.rs crate:main deps:core\n@@ -172,26 +172,41 @@ fn test() {\n } //^ i32\n \n //- /core.rs crate:core\n-#[prelude_import] use ops::*;\n mod ops {\n-    trait Try {\n-        type Output;\n-        type Residual;\n+    mod try_trait {\n+        pub trait Try: FromResidual {\n+            type Output;\n+            type Residual;\n+        }\n+        pub trait FromResidual<R = <Self as Try>::Residual> {}\n     }\n+\n+    pub use self::try_trait::FromResidual;\n+    pub use self::try_trait::Try;\n+}\n+\n+mov convert {\n+    pub trait From<T> {}\n+    impl<T> From<T> for T {}\n }\n \n #[prelude_import] use result::*;\n mod result {\n-    enum Infallible {}\n-    enum Result<O, E> {\n+    use crate::convert::From;\n+    use crate::ops::{Try, FromResidual};\n+\n+    pub enum Infallible {}\n+    pub enum Result<O, E> {\n         Ok(O),\n         Err(E)\n     }\n \n-    impl<O, E> crate::ops::Try for Result<O, E> {\n+    impl<O, E> Try for Result<O, E> {\n         type Output = O;\n         type Error = Result<Infallible, E>;\n     }\n+\n+    impl<T, E, F: From<E>> FromResidual<Result<Infallible, E>> for Result<T, F> {}\n }\n \"#,\n     );"}]}