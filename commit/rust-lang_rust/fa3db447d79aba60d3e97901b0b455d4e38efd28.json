{"sha": "fa3db447d79aba60d3e97901b0b455d4e38efd28", "node_id": "C_kwDOAAsO6NoAKGZhM2RiNDQ3ZDc5YWJhNjBkM2U5NzkwMWIwYjQ1NWQ0ZTM4ZWZkMjg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-11T07:36:42Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-11T07:36:42Z"}, "message": "Auto merge of #14536 - ClSlaid:feat/reorder-impl-items/not-applicative-editing-assoc-items, r=Veykril\n\nfix: restrict applicable range of `reorder-impl-trait-items`\n\nThis PR should complete the need for restricting the applicable range of `reorder-impl-trait-items`.\n\nWhen the cursor is in the associated items of the `impl` range, the assist will be disabled.\n\nFix: #14515\n\n## Showcases\nNote: If there is any available `code-action` (`ide-assist`) available, a lightbulb icon from `lspsaga` will show in the left.\n\n- cursor in `impl` headers\n![code action available](https://user-images.githubusercontent.com/44747719/230756854-7b236018-cfa8-4005-b589-2996ec42917f.png)\nCode action is available. And it is reordering impl items.\n![code action detail](https://user-images.githubusercontent.com/44747719/230756971-341c7fbc-f2ba-4715-a1e5-b1add984d4dd.png)\n\n- cursor in `impl` associated items\n![code action unavailable](\nhttps://user-images.githubusercontent.com/44747719/230756906-bee7784e-bd9d-49b2-801b-743c94b4af54.png)", "tree": {"sha": "869207b03e81cff4a88ab91622182151fdcb77af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/869207b03e81cff4a88ab91622182151fdcb77af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa3db447d79aba60d3e97901b0b455d4e38efd28", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa3db447d79aba60d3e97901b0b455d4e38efd28", "html_url": "https://github.com/rust-lang/rust/commit/fa3db447d79aba60d3e97901b0b455d4e38efd28", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa3db447d79aba60d3e97901b0b455d4e38efd28/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "208a74ca5079d2f605f7dd7cd3864e355c12be22", "url": "https://api.github.com/repos/rust-lang/rust/commits/208a74ca5079d2f605f7dd7cd3864e355c12be22", "html_url": "https://github.com/rust-lang/rust/commit/208a74ca5079d2f605f7dd7cd3864e355c12be22"}, {"sha": "475aa2839f3edd814369f067fc382f576dbb31de", "url": "https://api.github.com/repos/rust-lang/rust/commits/475aa2839f3edd814369f067fc382f576dbb31de", "html_url": "https://github.com/rust-lang/rust/commit/475aa2839f3edd814369f067fc382f576dbb31de"}], "stats": {"total": 43, "additions": 39, "deletions": 4}, "files": [{"sha": "af96950761ea0ab74ac37535252e24b8353550c3", "filename": "crates/ide-assists/src/handlers/reorder_impl_items.rs", "status": "modified", "additions": 38, "deletions": 3, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/fa3db447d79aba60d3e97901b0b455d4e38efd28/crates%2Fide-assists%2Fsrc%2Fhandlers%2Freorder_impl_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa3db447d79aba60d3e97901b0b455d4e38efd28/crates%2Fide-assists%2Fsrc%2Fhandlers%2Freorder_impl_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-assists%2Fsrc%2Fhandlers%2Freorder_impl_items.rs?ref=fa3db447d79aba60d3e97901b0b455d4e38efd28", "patch": "@@ -21,7 +21,7 @@ use crate::{AssistContext, AssistId, AssistKind, Assists};\n // }\n //\n // struct Bar;\n-// $0impl Foo for Bar {\n+// $0impl Foo for Bar$0 {\n //     const B: u8 = 17;\n //     fn c() {}\n //     type A = String;\n@@ -45,6 +45,16 @@ use crate::{AssistContext, AssistId, AssistKind, Assists};\n pub(crate) fn reorder_impl_items(acc: &mut Assists, ctx: &AssistContext<'_>) -> Option<()> {\n     let impl_ast = ctx.find_node_at_offset::<ast::Impl>()?;\n     let items = impl_ast.assoc_item_list()?;\n+\n+    // restrict the range\n+    // if cursor is in assoc_items, abort\n+    let assoc_range = items.syntax().text_range();\n+    let cursor_position = ctx.offset();\n+    if assoc_range.contains_inclusive(cursor_position) {\n+        cov_mark::hit!(not_applicable_editing_assoc_items);\n+        return None;\n+    }\n+\n     let assoc_items = items.assoc_items().collect::<Vec<_>>();\n \n     let path = impl_ast\n@@ -264,9 +274,9 @@ trait Bar {\n }\n \n struct Foo;\n-impl Bar for Foo {\n+$0impl Bar for Foo {\n     type Fooo = ();\n-    type Foo = ();$0\n+    type Foo = ();\n }\"#,\n             r#\"\n trait Bar {\n@@ -281,4 +291,29 @@ impl Bar for Foo {\n }\"#,\n         )\n     }\n+\n+    #[test]\n+    fn not_applicable_editing_assoc_items() {\n+        cov_mark::check!(not_applicable_editing_assoc_items);\n+        check_assist_not_applicable(\n+            reorder_impl_items,\n+            r#\"\n+trait Bar {\n+    type T;\n+    const C: ();\n+    fn a() {}\n+    fn z() {}\n+    fn b() {}\n+}\n+struct Foo;\n+impl Bar for Foo {\n+    type T = ();$0\n+    const C: () = ();\n+    fn z() {}\n+    fn a() {}\n+    fn b() {}\n+}\n+        \"#,\n+        )\n+    }\n }"}, {"sha": "0096254ecb781a258204c110b260b594a5385ae7", "filename": "crates/ide-assists/src/tests/generated.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fa3db447d79aba60d3e97901b0b455d4e38efd28/crates%2Fide-assists%2Fsrc%2Ftests%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fa3db447d79aba60d3e97901b0b455d4e38efd28/crates%2Fide-assists%2Fsrc%2Ftests%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-assists%2Fsrc%2Ftests%2Fgenerated.rs?ref=fa3db447d79aba60d3e97901b0b455d4e38efd28", "patch": "@@ -2141,7 +2141,7 @@ trait Foo {\n }\n \n struct Bar;\n-$0impl Foo for Bar {\n+$0impl Foo for Bar$0 {\n     const B: u8 = 17;\n     fn c() {}\n     type A = String;"}]}