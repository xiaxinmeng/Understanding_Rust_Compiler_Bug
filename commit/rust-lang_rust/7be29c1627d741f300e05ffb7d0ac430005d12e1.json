{"sha": "7be29c1627d741f300e05ffb7d0ac430005d12e1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiZTI5YzE2MjdkNzQxZjMwMGUwNWZmYjdkMGFjNDMwMDA1ZDEyZTE=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-07-07T03:17:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-07T03:17:43Z"}, "message": "Rollup merge of #86907 - pietroalbini:ci-cpu-stats-python3, r=Mark-Simulacrum\n\nMigrate `cpu-usage-over-time.py` to Python 3\n\nThe only change here is a fix for `sys.platform` on Linux. Python 3.3 changed the API to return `\"linux\"` instead of `\"linux2\"`/`\"linux3\"`, so this PR uses `.startswith(\"linux\")` to make the code work on Python 3 without breaking Python 2.", "tree": {"sha": "039476bdd03da5853b8fdf46e7f766e3adc5f110", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/039476bdd03da5853b8fdf46e7f766e3adc5f110"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7be29c1627d741f300e05ffb7d0ac430005d12e1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg5RzXCRBK7hj4Ov3rIwAAZosIAHf0KxK4DpjXXMLqMx5fHzum\nrvEKDFjWfKzjM/RYuUiI18gE6QaphwDSY/GA8mjz0H2yWdwkn2V8MR6B3wHssio9\nosOncMFegScy/6t/H/u54zrJbUIWa4XtWQTh6D6Wkq86vCNyPs2gs5JwuRhuR7Ea\nispVwmbxeVEZPKnkW/rKWRekVALMUKrC0bdE8P8AnrIaZrISKzvlFIKNUxoSEUf2\nwx5/4CqLfGNPri6Hfw0tU6ZV7K9HK1M4lHhI0LEfLV+v8LBy9sUtJDNGARBeBqCE\n5X77C4pS5fb/t8DEPmwnjqs5uNw0fqlCUq6cQXByEKwJk+mTzQxx7L+8yRVJ10c=\n=7SWQ\n-----END PGP SIGNATURE-----\n", "payload": "tree 039476bdd03da5853b8fdf46e7f766e3adc5f110\nparent fe3d6a74d9483a8c0f74c80c3b647e07e5ce7a6d\nparent 0b3653bbdd70ff0c19edc5c59a794f4c4cd86f31\nauthor Yuki Okushi <jtitor@2k36.org> 1625627863 +0900\ncommitter GitHub <noreply@github.com> 1625627863 +0900\n\nRollup merge of #86907 - pietroalbini:ci-cpu-stats-python3, r=Mark-Simulacrum\n\nMigrate `cpu-usage-over-time.py` to Python 3\n\nThe only change here is a fix for `sys.platform` on Linux. Python 3.3 changed the API to return `\"linux\"` instead of `\"linux2\"`/`\"linux3\"`, so this PR uses `.startswith(\"linux\")` to make the code work on Python 3 without breaking Python 2.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7be29c1627d741f300e05ffb7d0ac430005d12e1", "html_url": "https://github.com/rust-lang/rust/commit/7be29c1627d741f300e05ffb7d0ac430005d12e1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7be29c1627d741f300e05ffb7d0ac430005d12e1/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe3d6a74d9483a8c0f74c80c3b647e07e5ce7a6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe3d6a74d9483a8c0f74c80c3b647e07e5ce7a6d", "html_url": "https://github.com/rust-lang/rust/commit/fe3d6a74d9483a8c0f74c80c3b647e07e5ce7a6d"}, {"sha": "0b3653bbdd70ff0c19edc5c59a794f4c4cd86f31", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b3653bbdd70ff0c19edc5c59a794f4c4cd86f31", "html_url": "https://github.com/rust-lang/rust/commit/0b3653bbdd70ff0c19edc5c59a794f4c4cd86f31"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "267c3964d0d692d2e8e975fa5868943a547c00fc", "filename": "src/ci/cpu-usage-over-time.py", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7be29c1627d741f300e05ffb7d0ac430005d12e1/src%2Fci%2Fcpu-usage-over-time.py", "raw_url": "https://github.com/rust-lang/rust/raw/7be29c1627d741f300e05ffb7d0ac430005d12e1/src%2Fci%2Fcpu-usage-over-time.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fcpu-usage-over-time.py?ref=7be29c1627d741f300e05ffb7d0ac430005d12e1", "patch": "@@ -1,4 +1,4 @@\n-#!/usr/bin/env python\n+#!/usr/bin/env python3\n # ignore-tidy-linelength\n \n # This is a small script that we use on CI to collect CPU usage statistics of\n@@ -37,7 +37,10 @@\n import sys\n import time\n \n-if sys.platform == 'linux2':\n+# Python 3.3 changed the value of `sys.platform` on Linux from \"linux2\" to just\n+# \"linux\". We check here with `.startswith` to keep compatibility with older\n+# Python versions (especially Python 2.7).\n+if sys.platform.startswith('linux'):\n     class State:\n         def __init__(self):\n             with open('/proc/stat', 'r') as file:"}, {"sha": "853b4628fab2f3d1c487afcc46db4018ec9ae988", "filename": "src/ci/scripts/collect-cpu-stats.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7be29c1627d741f300e05ffb7d0ac430005d12e1/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh", "raw_url": "https://github.com/rust-lang/rust/raw/7be29c1627d741f300e05ffb7d0ac430005d12e1/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fcollect-cpu-stats.sh?ref=7be29c1627d741f300e05ffb7d0ac430005d12e1", "patch": "@@ -6,4 +6,4 @@\n set -euo pipefail\n IFS=$'\\n\\t'\n \n-python src/ci/cpu-usage-over-time.py &> cpu-usage.csv &\n+python3 src/ci/cpu-usage-over-time.py &> cpu-usage.csv &"}]}