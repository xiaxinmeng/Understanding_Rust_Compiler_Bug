{"sha": "7d42172899663993a9fd2e3445ddb58ab5d10a79", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkNDIxNzI4OTk2NjM5OTNhOWZkMmUzNDQ1ZGRiNThhYjVkMTBhNzk=", "commit": {"author": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2021-01-01T18:38:11Z"}, "committer": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2021-01-07T21:54:12Z"}, "message": "Reintroduce hir::ExprKind::If", "tree": {"sha": "6ee2780ee6c40c64fbe496e86681774682cccf8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ee2780ee6c40c64fbe496e86681774682cccf8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7d42172899663993a9fd2e3445ddb58ab5d10a79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7d42172899663993a9fd2e3445ddb58ab5d10a79", "html_url": "https://github.com/rust-lang/rust/commit/7d42172899663993a9fd2e3445ddb58ab5d10a79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7d42172899663993a9fd2e3445ddb58ab5d10a79/comments", "author": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "committer": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "053afe4907fa7ac7ff6d08d42583bde9a4d4414c", "url": "https://api.github.com/repos/rust-lang/rust/commits/053afe4907fa7ac7ff6d08d42583bde9a4d4414c", "html_url": "https://github.com/rust-lang/rust/commit/053afe4907fa7ac7ff6d08d42583bde9a4d4414c"}], "stats": {"total": 283, "additions": 152, "deletions": 131}, "files": [{"sha": "aa431f0596cca9c12ac22d5a7f35d173a64e445c", "filename": "clippy_lints/src/assertions_on_constants.rs", "status": "modified", "additions": 10, "deletions": 20, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fassertions_on_constants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fassertions_on_constants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fassertions_on_constants.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,8 +1,7 @@\n use crate::consts::{constant, Constant};\n use crate::utils::{is_direct_expn_of, is_expn_of, match_panic_call, snippet_opt, span_lint_and_help};\n use if_chain::if_chain;\n-use rustc_ast::ast::LitKind;\n-use rustc_hir::{Expr, ExprKind, PatKind, UnOp};\n+use rustc_hir::{Expr, ExprKind, UnOp};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -102,31 +101,22 @@ enum AssertKind {\n /// Check if the expression matches\n ///\n /// ```rust,ignore\n-/// match { let _t = !c; _t } {\n-///     true => {\n-///         {\n-///             ::std::rt::begin_panic(message, _)\n-///         }\n-///     }\n-///     _ => { }\n-/// };\n+/// if !c {\n+///   {\n+///     ::std::rt::begin_panic(message, _)\n+///   }\n+/// }\n /// ```\n ///\n /// where `message` is any expression and `c` is a constant bool.\n fn match_assert_with_message<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) -> Option<AssertKind> {\n     if_chain! {\n-        if let ExprKind::Match(ref expr, ref arms, _) = expr.kind;\n-        // matches { let _t = expr; _t }\n-        if let ExprKind::DropTemps(ref expr) = expr.kind;\n-        if let ExprKind::Unary(UnOp::UnNot, ref expr) = expr.kind;\n+        if let ExprKind::If(ref cond, ref then, _) = expr.kind;\n+        if let ExprKind::Unary(UnOp::UnNot, ref expr) = cond.kind;\n         // bind the first argument of the `assert!` macro\n         if let Some((Constant::Bool(is_true), _)) = constant(cx, cx.typeck_results(), expr);\n-        // arm 1 pattern\n-        if let PatKind::Lit(ref lit_expr) = arms[0].pat.kind;\n-        if let ExprKind::Lit(ref lit) = lit_expr.kind;\n-        if let LitKind::Bool(true) = lit.node;\n-        // arm 1 block\n-        if let ExprKind::Block(ref block, _) = arms[0].body.kind;\n+        // block\n+        if let ExprKind::Block(ref block, _) = then.kind;\n         if block.stmts.is_empty();\n         if let Some(block_expr) = &block.expr;\n         // inner block is optional. unwrap it if it exists, or use the expression as is otherwise."}, {"sha": "4efca10bcdf13d650cdff8067231ae3f8f32d4f5", "filename": "clippy_lints/src/blocks_in_if_conditions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fblocks_in_if_conditions.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{differing_macro_contexts, higher, snippet_block_with_applicability, span_lint, span_lint_and_sugg};\n+use crate::utils::{differing_macro_contexts, snippet_block_with_applicability, span_lint, span_lint_and_sugg};\n use rustc_errors::Applicability;\n use rustc_hir::intravisit::{walk_expr, NestedVisitorMap, Visitor};\n use rustc_hir::{BlockCheckMode, Expr, ExprKind};\n@@ -75,7 +75,7 @@ impl<'tcx> LateLintPass<'tcx> for BlocksInIfConditions {\n         if in_external_macro(cx.sess(), expr.span) {\n             return;\n         }\n-        if let Some((cond, _, _)) = higher::if_block(&expr) {\n+        if let ExprKind::If(cond, _, _) = &expr.kind {\n             if let ExprKind::Block(block, _) = &cond.kind {\n                 if block.rules == BlockCheckMode::DefaultBlock {\n                     if block.stmts.is_empty() {"}, {"sha": "b3ebdf4ca30d8d21119c6559b51f9782456d2bc2", "filename": "clippy_lints/src/cognitive_complexity.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fcognitive_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fcognitive_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcognitive_complexity.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -147,6 +147,9 @@ impl<'tcx> Visitor<'tcx> for CCHelper {\n     fn visit_expr(&mut self, e: &'tcx Expr<'_>) {\n         walk_expr(self, e);\n         match e.kind {\n+            ExprKind::If(_, _, _) => {\n+                self.cc += 1;\n+            },\n             ExprKind::Match(_, ref arms, _) => {\n                 if arms.len() > 1 {\n                     self.cc += 1;"}, {"sha": "166eadf86c177f49aa221145bcfaf4ba6c5342c3", "filename": "clippy_lints/src/consts.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconsts.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,6 +1,6 @@\n #![allow(clippy::float_cmp)]\n \n-use crate::utils::{clip, higher, sext, unsext};\n+use crate::utils::{clip, sext, unsext};\n use if_chain::if_chain;\n use rustc_ast::ast::{FloatTy, LitFloatType, LitKind};\n use rustc_data_structures::sync::Lrc;\n@@ -228,9 +228,6 @@ pub struct ConstEvalLateContext<'a, 'tcx> {\n impl<'a, 'tcx> ConstEvalLateContext<'a, 'tcx> {\n     /// Simple constant folding: Insert an expression, get a constant or none.\n     pub fn expr(&mut self, e: &Expr<'_>) -> Option<Constant> {\n-        if let Some((ref cond, ref then, otherwise)) = higher::if_block(&e) {\n-            return self.ifthenelse(cond, then, otherwise);\n-        }\n         match e.kind {\n             ExprKind::Path(ref qpath) => self.fetch_path(qpath, e.hir_id, self.typeck_results.expr_ty(e)),\n             ExprKind::Block(ref block, _) => self.block(block),\n@@ -249,6 +246,7 @@ impl<'a, 'tcx> ConstEvalLateContext<'a, 'tcx> {\n                 UnOp::UnNeg => self.constant_negate(&o, self.typeck_results.expr_ty(e)),\n                 UnOp::UnDeref => Some(if let Constant::Ref(r) = o { *r } else { o }),\n             }),\n+            ExprKind::If(ref cond, ref then, ref otherwise) => self.ifthenelse(cond, then, *otherwise),\n             ExprKind::Binary(op, ref left, ref right) => self.binop(op, left, right),\n             ExprKind::Call(ref callee, ref args) => {\n                 // We only handle a few const functions for now."}, {"sha": "6f48ffeb0e9c9255190cfd19e41335a1f07b789f", "filename": "clippy_lints/src/copies.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fcopies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fcopies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcopies.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,6 +1,6 @@\n use crate::utils::{eq_expr_value, in_macro, search_same, SpanlessEq, SpanlessHash};\n-use crate::utils::{get_parent_expr, higher, if_sequence, span_lint_and_note};\n-use rustc_hir::{Block, Expr};\n+use crate::utils::{get_parent_expr, if_sequence, span_lint_and_note};\n+use rustc_hir::{Block, Expr, ExprKind};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n \n@@ -109,11 +109,12 @@ impl<'tcx> LateLintPass<'tcx> for CopyAndPaste {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n         if !expr.span.from_expansion() {\n             // skip ifs directly in else, it will be checked in the parent if\n-            if let Some(expr) = get_parent_expr(cx, expr) {\n-                if let Some((_, _, Some(ref else_expr))) = higher::if_block(&expr) {\n-                    if else_expr.hir_id == expr.hir_id {\n-                        return;\n-                    }\n+            if let Some(&Expr {\n+                kind: ExprKind::If(_, _, Some(ref else_expr)),\n+                ..\n+            }) = get_parent_expr(cx, expr) {\n+                if else_expr.hir_id == expr.hir_id {\n+                    return;\n                 }\n             }\n "}, {"sha": "37948e06869c3bfc4100d814663dd00c823dc37f", "filename": "clippy_lints/src/entry.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fentry.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::SpanlessEq;\n-use crate::utils::{get_item_name, higher, is_type_diagnostic_item, match_type, paths, snippet, snippet_opt};\n+use crate::utils::{get_item_name, is_type_diagnostic_item, match_type, paths, snippet, snippet_opt};\n use crate::utils::{snippet_with_applicability, span_lint_and_then};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n@@ -54,7 +54,7 @@ declare_lint_pass!(HashMapPass => [MAP_ENTRY]);\n \n impl<'tcx> LateLintPass<'tcx> for HashMapPass {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n-        if let Some((ref check, ref then_block, ref else_block)) = higher::if_block(&expr) {\n+        if let ExprKind::If(ref check, ref then_block, ref else_block) = expr.kind {\n             if let ExprKind::Unary(UnOp::UnNot, ref check) = check.kind {\n                 if let Some((ty, map, key)) = check_cond(cx, check) {\n                     // in case of `if !m.contains_key(&k) { m.insert(k, v); }`"}, {"sha": "ffef78aac806770f6108d9f5c17c17359aab1855", "filename": "clippy_lints/src/floating_point_arithmetic.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ffloating_point_arithmetic.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -2,7 +2,7 @@ use crate::consts::{\n     constant, constant_simple, Constant,\n     Constant::{Int, F32, F64},\n };\n-use crate::utils::{eq_expr_value, get_parent_expr, higher, numeric_literal, span_lint_and_sugg, sugg};\n+use crate::utils::{eq_expr_value, get_parent_expr, numeric_literal, span_lint_and_sugg, sugg};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir::{BinOpKind, Expr, ExprKind, PathSegment, UnOp};\n@@ -556,11 +556,11 @@ fn are_negated<'a>(cx: &LateContext<'_>, expr1: &'a Expr<'a>, expr2: &'a Expr<'a\n \n fn check_custom_abs(cx: &LateContext<'_>, expr: &Expr<'_>) {\n     if_chain! {\n-        if let Some((cond, body, Some(else_body))) = higher::if_block(&expr);\n+        if let ExprKind::If(cond, body, else_body) = expr.kind;\n         if let ExprKind::Block(block, _) = body.kind;\n         if block.stmts.is_empty();\n         if let Some(if_body_expr) = block.expr;\n-        if let ExprKind::Block(else_block, _) = else_body.kind;\n+        if let Some(ExprKind::Block(else_block, _)) = else_body.map(|el| &el.kind);\n         if else_block.stmts.is_empty();\n         if let Some(else_body_expr) = else_block.expr;\n         if let Some((if_expr_positive, body)) = are_negated(cx, if_body_expr, else_body_expr);"}, {"sha": "109d90ff772b57b8172761cb06c353283304fdf0", "filename": "clippy_lints/src/implicit_return.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fimplicit_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fimplicit_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fimplicit_return.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -81,6 +81,13 @@ fn expr_match(cx: &LateContext<'_>, expr: &Expr<'_>) {\n                 lint(cx, expr.span, break_expr.span, LINT_BREAK);\n             }\n         },\n+        ExprKind::If(.., if_expr, else_expr) => {\n+            expr_match(cx, if_expr);\n+\n+            if let Some(else_expr) = else_expr {\n+                expr_match(cx, else_expr);\n+            }\n+        },\n         ExprKind::Match(.., arms, source) => {\n             let check_all_arms = match source {\n                 MatchSource::IfLetDesugar {"}, {"sha": "16e162badb5ee64a0172a3e23810490e13e2624b", "filename": "clippy_lints/src/implicit_saturating_sub.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{higher, in_macro, match_qpath, span_lint_and_sugg, SpanlessEq};\n+use crate::utils::{in_macro, match_qpath, span_lint_and_sugg, SpanlessEq};\n use if_chain::if_chain;\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n@@ -42,7 +42,7 @@ impl<'tcx> LateLintPass<'tcx> for ImplicitSaturatingSub {\n             return;\n         }\n         if_chain! {\n-            if let Some((ref cond, ref then, None)) = higher::if_block(&expr);\n+            if let ExprKind::If(cond, then, None) = &expr.kind;\n \n             // Check if the conditional expression is a binary operation\n             if let ExprKind::Binary(ref cond_op, ref cond_left, ref cond_right) = cond.kind;"}, {"sha": "db717cd1240a41b38a9f1d871595f3561b02c2b0", "filename": "clippy_lints/src/let_if_seq.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Flet_if_seq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Flet_if_seq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flet_if_seq.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,5 +1,4 @@\n-use crate::utils::visitors::LocalUsedVisitor;\n-use crate::utils::{higher, qpath_res, snippet, span_lint_and_then};\n+use crate::utils::{qpath_res, snippet, span_lint_and_then, visitors::LocalUsedVisitor};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir as hir;\n@@ -64,7 +63,7 @@ impl<'tcx> LateLintPass<'tcx> for LetIfSeq {\n                 if let hir::StmtKind::Local(ref local) = stmt.kind;\n                 if let hir::PatKind::Binding(mode, canonical_id, ident, None) = local.pat.kind;\n                 if let hir::StmtKind::Expr(ref if_) = expr.kind;\n-                if let Some((ref cond, ref then, ref else_)) = higher::if_block(&if_);\n+                if let hir::ExprKind::If(ref cond, ref then, ref else_) = if_.kind;\n                 if !LocalUsedVisitor::new(canonical_id).check_expr(cond);\n                 if let hir::ExprKind::Block(ref then, _) = then.kind;\n                 if let Some(value) = check_assign(cx, canonical_id, &*then);"}, {"sha": "281964ee5e8f3bb4a01d61303934f9421a4f25d0", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -742,6 +742,14 @@ fn never_loop_expr(expr: &Expr<'_>, main_loop_id: HirId) -> NeverLoopResult {\n             // Break can come from the inner loop so remove them.\n             absorb_break(&never_loop_block(b, main_loop_id))\n         },\n+        ExprKind::If(ref e, ref e2, ref e3) => {\n+            let e1 = never_loop_expr(e, main_loop_id);\n+            let e2 = never_loop_expr(e2, main_loop_id);\n+            let e3 = e3\n+                .as_ref()\n+                .map_or(NeverLoopResult::Otherwise, |e| never_loop_expr(e, main_loop_id));\n+            combine_seq(e1, combine_branches(e2, e3))\n+        },\n         ExprKind::Match(ref e, ref arms, _) => {\n             let e = never_loop_expr(e, main_loop_id);\n             if arms.is_empty() {\n@@ -2594,7 +2602,7 @@ fn is_loop(expr: &Expr<'_>) -> bool {\n }\n \n fn is_conditional(expr: &Expr<'_>) -> bool {\n-    matches!(expr.kind, ExprKind::Match(..))\n+    matches!(expr.kind, ExprKind::If(..) | ExprKind::Match(..))\n }\n \n fn is_nested(cx: &LateContext<'_>, match_expr: &Expr<'_>, iter_expr: &Expr<'_>) -> bool {"}, {"sha": "a0cfe145a301cb68649f8ab1f8bf23d35296d4aa", "filename": "clippy_lints/src/manual_strip.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmanual_strip.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmanual_strip.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmanual_strip.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -80,7 +80,7 @@ impl<'tcx> LateLintPass<'tcx> for ManualStrip {\n         }\n \n         if_chain! {\n-            if let Some((cond, then, _)) = higher::if_block(&expr);\n+            if let ExprKind::If(cond, then, _) = &expr.kind;\n             if let ExprKind::MethodCall(_, _, [target_arg, pattern], _) = cond.kind;\n             if let Some(method_def_id) = cx.typeck_results().type_dependent_def_id(cond.hir_id);\n             if let ExprKind::Path(target_path) = &target_arg.kind;"}, {"sha": "2234890d6e94fddbf491caeb790c3f157bc71bd6", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -2048,6 +2048,7 @@ fn lint_expect_fun_call(\n             hir::ExprKind::Call(..)\n             | hir::ExprKind::MethodCall(..)\n             // These variants are debatable or require further examination\n+            | hir::ExprKind::If(..)\n             | hir::ExprKind::Match(..)\n             | hir::ExprKind::Block{ .. } => true,\n             _ => false,"}, {"sha": "d98e6160d308561d2b1f115c1ce5e5372e3ba27f", "filename": "clippy_lints/src/methods/unnecessary_filter_map.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Funnecessary_filter_map.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -90,6 +90,12 @@ fn check_expression<'tcx>(cx: &LateContext<'tcx>, arg_id: hir::HirId, expr: &'tc\n             }\n             (found_mapping, found_filtering)\n         },\n+        // There must be an else_arm or there will be a type error\n+        hir::ExprKind::If(_, ref if_arm, Some(ref else_arm)) => {\n+            let if_check = check_expression(cx, arg_id, if_arm);\n+            let else_check = check_expression(cx, arg_id, else_arm);\n+            (if_check.0 | else_check.0, if_check.1 | else_check.1)\n+        },\n         hir::ExprKind::Path(path) if match_qpath(path, &paths::OPTION_NONE) => (false, true),\n         _ => (true, true),\n     }"}, {"sha": "71f91eb4bfbe39bc8e648819f84c1c052315fee8", "filename": "clippy_lints/src/mutable_debug_assertion.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmutable_debug_assertion.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -90,6 +90,10 @@ impl<'a, 'tcx> Visitor<'tcx> for MutArgVisitor<'a, 'tcx> {\n                 self.found = true;\n                 return;\n             },\n+            ExprKind::If(..) => {\n+                self.found = true;\n+                return;\n+            },\n             ExprKind::Path(_) => {\n                 if let Some(adj) = self.cx.typeck_results().adjustments().get(expr.hir_id) {\n                     if adj"}, {"sha": "6b9a37b525201b203f16a665f1e15b9df5294b25", "filename": "clippy_lints/src/needless_bool.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fneedless_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fneedless_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_bool.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -4,7 +4,7 @@\n \n use crate::utils::sugg::Sugg;\n use crate::utils::{\n-    higher, is_expn_of, parent_node_is_if_expr, snippet_with_applicability, span_lint, span_lint_and_sugg,\n+    is_expn_of, parent_node_is_if_expr, snippet_with_applicability, span_lint, span_lint_and_sugg,\n };\n use rustc_ast::ast::LitKind;\n use rustc_errors::Applicability;\n@@ -71,7 +71,7 @@ declare_lint_pass!(NeedlessBool => [NEEDLESS_BOOL]);\n impl<'tcx> LateLintPass<'tcx> for NeedlessBool {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, e: &'tcx Expr<'_>) {\n         use self::Expression::{Bool, RetBool};\n-        if let Some((ref pred, ref then_block, Some(ref else_expr))) = higher::if_block(&e) {\n+        if let ExprKind::If(ref pred, ref then_block, Some(ref else_expr)) = e.kind {\n             let reduce = |ret, not| {\n                 let mut applicability = Applicability::MachineApplicable;\n                 let snip = Sugg::hir_with_applicability(cx, pred, \"<predicate>\", &mut applicability);"}, {"sha": "391f893ef35ff404bdded2704183df5ccfe38646", "filename": "clippy_lints/src/option_if_let_else.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Foption_if_let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Foption_if_let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Foption_if_let_else.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -109,25 +109,26 @@ fn extract_body_from_arm<'a>(arm: &'a Arm<'a>) -> Option<&'a Expr<'a>> {\n /// it in curly braces. Otherwise, we don't.\n fn should_wrap_in_braces(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n     utils::get_enclosing_block(cx, expr.hir_id).map_or(false, |parent| {\n+        let mut should_wrap = false;\n+        \n         if let Some(Expr {\n             kind:\n                 ExprKind::Match(\n                     _,\n                     arms,\n-                    MatchSource::IfDesugar {\n-                        contains_else_clause: true,\n-                    }\n-                    | MatchSource::IfLetDesugar {\n+                    MatchSource::IfLetDesugar {\n                         contains_else_clause: true,\n                     },\n                 ),\n             ..\n         }) = parent.expr\n         {\n-            expr.hir_id == arms[1].body.hir_id\n-        } else {\n-            false\n+            should_wrap = expr.hir_id == arms[1].body.hir_id;\n+        } else if let Some(Expr { kind: ExprKind::If(_, _, Some(else_clause)), .. }) = parent.expr {\n+            should_wrap = expr.hir_id == else_clause.hir_id;\n         }\n+\n+        should_wrap\n     })\n }\n "}, {"sha": "6c480d48c7561245a0ab0150e49edcf1a5803f1b", "filename": "clippy_lints/src/question_mark.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fquestion_mark.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -8,7 +8,7 @@ use rustc_span::sym;\n \n use crate::utils::sugg::Sugg;\n use crate::utils::{\n-    eq_expr_value, higher, is_type_diagnostic_item, match_def_path, match_qpath, paths, snippet_with_applicability,\n+    eq_expr_value, is_type_diagnostic_item, match_def_path, match_qpath, paths, snippet_with_applicability,\n     span_lint_and_sugg,\n };\n \n@@ -50,7 +50,7 @@ impl QuestionMark {\n     /// If it matches, it will suggest to use the question mark operator instead\n     fn check_is_none_and_early_return_none(cx: &LateContext<'_>, expr: &Expr<'_>) {\n         if_chain! {\n-            if let Some((if_expr, body, else_)) = higher::if_block(&expr);\n+            if let ExprKind::If(if_expr, body, else_) = &expr.kind;\n             if let ExprKind::MethodCall(segment, _, args, _) = &if_expr.kind;\n             if segment.ident.name == sym!(is_none);\n             if Self::expression_returns_none(cx, body);"}, {"sha": "35827e027aab81615fbb21fe3c7e178828bc1708", "filename": "clippy_lints/src/returns.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freturns.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -184,6 +184,14 @@ fn check_final_expr<'tcx>(\n         ExprKind::Block(ref block, _) => {\n             check_block_return(cx, block);\n         },\n+        ExprKind::If(_, then, else_clause_opt) => {\n+            if let ExprKind::Block(ref ifblock, _) = then.kind {\n+                check_block_return(cx, ifblock);\n+            }\n+            if let Some(else_clause) = else_clause_opt {\n+                check_final_expr(cx, else_clause, None, RetReplacement::Empty);\n+            }\n+        },\n         // a match expr, check all arms\n         // an if/if let expr, check both exprs\n         // note, if without else is going to be a type checking error anyways\n@@ -194,9 +202,6 @@ fn check_final_expr<'tcx>(\n                     check_final_expr(cx, &arm.body, Some(arm.body.span), RetReplacement::Block);\n                 }\n             },\n-            MatchSource::IfDesugar {\n-                contains_else_clause: true,\n-            }\n             | MatchSource::IfLetDesugar {\n                 contains_else_clause: true,\n             } => {"}, {"sha": "f2f3dfa09a7d4099440e6788e1358c8a0f647f5e", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -333,6 +333,13 @@ fn check_expr<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, bindings: &mut\n                 check_expr(cx, e, bindings)\n             }\n         },\n+        ExprKind::If(ref cond, ref then, ref otherwise) => {\n+            check_expr(cx, cond, bindings);\n+            check_expr(cx, &**then, bindings);\n+            if let Some(ref o) = *otherwise {\n+                check_expr(cx, o, bindings);\n+            }\n+        },\n         ExprKind::Match(ref init, arms, _) => {\n             check_expr(cx, init, bindings);\n             let len = bindings.len();"}, {"sha": "6a87f534369803dcc60d37bb78066fb4ea8a1d17", "filename": "clippy_lints/src/unwrap.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Funwrap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Funwrap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funwrap.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,5 +1,5 @@\n use crate::utils::{\n-    differing_macro_contexts, higher::if_block, is_type_diagnostic_item, span_lint_and_then,\n+    differing_macro_contexts, is_type_diagnostic_item, span_lint_and_then,\n     usage::is_potentially_mutated,\n };\n use if_chain::if_chain;\n@@ -158,7 +158,7 @@ impl<'a, 'tcx> Visitor<'tcx> for UnwrappableVariablesVisitor<'a, 'tcx> {\n         if in_external_macro(self.cx.tcx.sess, expr.span) {\n             return;\n         }\n-        if let Some((cond, then, els)) = if_block(&expr) {\n+        if let ExprKind::If(cond, then, els) = &expr.kind {\n             walk_expr(self, cond);\n             self.visit_branch(cond, then, false);\n             if let Some(els) = els {"}, {"sha": "43afa65de3e5518a1bf9c701c1dddf224d7f8775", "filename": "clippy_lints/src/utils/author.rs", "status": "modified", "additions": 20, "deletions": 31, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fauthor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fauthor.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,7 +1,7 @@\n //! A group of attributes that can be attached to Rust code in order\n //! to generate a clippy lint detecting said code automatically.\n \n-use crate::utils::{get_attr, higher};\n+use crate::utils::get_attr;\n use rustc_ast::ast::{Attribute, LitFloatType, LitKind};\n use rustc_ast::walk_list;\n use rustc_data_structures::fx::FxHashMap;\n@@ -201,32 +201,6 @@ impl<'tcx> Visitor<'tcx> for PrintVisitor {\n \n     #[allow(clippy::too_many_lines)]\n     fn visit_expr(&mut self, expr: &Expr<'_>) {\n-        // handle if desugarings\n-        // TODO add more desugarings here\n-        if let Some((cond, then, opt_else)) = higher::if_block(&expr) {\n-            let cond_pat = self.next(\"cond\");\n-            let then_pat = self.next(\"then\");\n-            if let Some(else_) = opt_else {\n-                let else_pat = self.next(\"else_\");\n-                println!(\n-                    \"    if let Some((ref {}, ref {}, Some({}))) = higher::if_block(&{});\",\n-                    cond_pat, then_pat, else_pat, self.current\n-                );\n-                self.current = else_pat;\n-                self.visit_expr(else_);\n-            } else {\n-                println!(\n-                    \"    if let Some((ref {}, ref {}, None)) = higher::if_block(&{});\",\n-                    cond_pat, then_pat, self.current\n-                );\n-            }\n-            self.current = cond_pat;\n-            self.visit_expr(cond);\n-            self.current = then_pat;\n-            self.visit_expr(then);\n-            return;\n-        }\n-\n         print!(\"    if let ExprKind::\");\n         let current = format!(\"{}.kind\", self.current);\n         match expr.kind {\n@@ -351,6 +325,25 @@ impl<'tcx> Visitor<'tcx> for PrintVisitor {\n                 self.current = body_pat;\n                 self.visit_block(body);\n             },\n+            ExprKind::If(ref cond, ref then, ref opt_else) => {\n+                let cond_pat = self.next(\"cond\");\n+                let then_pat = self.next(\"then\");\n+                if let Some(ref else_) = *opt_else {\n+                    let else_pat = self.next(\"else_\");\n+                    println!(\n+                        \"If(ref {}, ref {}, Some(ref {})) = {};\",\n+                        cond_pat, then_pat, else_pat, current\n+                    );\n+                    self.current = else_pat;\n+                    self.visit_expr(else_);\n+                } else {\n+                    println!(\"If(ref {}, ref {}, None) = {};\", cond_pat, then_pat, current);\n+                }\n+                self.current = cond_pat;\n+                self.visit_expr(cond);\n+                self.current = then_pat;\n+                self.visit_expr(then);\n+            },\n             ExprKind::Match(ref expr, ref arms, desugaring) => {\n                 let des = desugaring_name(desugaring);\n                 let expr_pat = self.next(\"expr\");\n@@ -743,10 +736,6 @@ fn desugaring_name(des: hir::MatchSource) -> String {\n             contains_else_clause\n         ),\n         hir::MatchSource::IfLetGuardDesugar => \"MatchSource::IfLetGuardDesugar\".to_string(),\n-        hir::MatchSource::IfDesugar { contains_else_clause } => format!(\n-            \"MatchSource::IfDesugar {{ contains_else_clause: {} }}\",\n-            contains_else_clause\n-        ),\n         hir::MatchSource::AwaitDesugar => \"MatchSource::AwaitDesugar\".to_string(),\n     }\n }"}, {"sha": "2f157c5030f4466be1ba2cd83068702e95f85210", "filename": "clippy_lints/src/utils/eager_or_lazy.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Feager_or_lazy.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -62,6 +62,7 @@ fn identify_some_pure_patterns(expr: &Expr<'_>) -> bool {\n         | ExprKind::Type(..)\n         | ExprKind::DropTemps(..)\n         | ExprKind::Loop(..)\n+        | ExprKind::If(..)\n         | ExprKind::Match(..)\n         | ExprKind::Closure(..)\n         | ExprKind::Block(..)"}, {"sha": "9b3585865da3236c0c7523a2a1058131b5b21542", "filename": "clippy_lints/src/utils/higher.rs", "status": "modified", "additions": 3, "deletions": 31, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fhigher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fhigher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fhigher.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -170,33 +170,6 @@ pub fn while_loop<'tcx>(expr: &'tcx hir::Expr<'tcx>) -> Option<(&'tcx hir::Expr<\n     None\n }\n \n-/// Recover the essential nodes of a desugared if block\n-/// `if cond { then } else { els }` becomes `(cond, then, Some(els))`\n-pub fn if_block<'tcx>(\n-    expr: &'tcx hir::Expr<'tcx>,\n-) -> Option<(\n-    &'tcx hir::Expr<'tcx>,\n-    &'tcx hir::Expr<'tcx>,\n-    Option<&'tcx hir::Expr<'tcx>>,\n-)> {\n-    if let hir::ExprKind::Match(ref cond, ref arms, hir::MatchSource::IfDesugar { contains_else_clause }) = expr.kind {\n-        let cond = if let hir::ExprKind::DropTemps(ref cond) = cond.kind {\n-            cond\n-        } else {\n-            panic!(\"If block desugar must contain DropTemps\");\n-        };\n-        let then = &arms[0].body;\n-        let els = if contains_else_clause {\n-            Some(&*arms[1].body)\n-        } else {\n-            None\n-        };\n-        Some((cond, then, els))\n-    } else {\n-        None\n-    }\n-}\n-\n /// Represent the pre-expansion arguments of a `vec!` invocation.\n pub enum VecArgs<'a> {\n     /// `vec![elem; len]`\n@@ -267,12 +240,11 @@ pub fn extract_assert_macro_args<'tcx>(e: &'tcx Expr<'tcx>) -> Option<Vec<&'tcx\n \n     if let ExprKind::Block(ref block, _) = e.kind {\n         if block.stmts.len() == 1 {\n-            if let StmtKind::Semi(ref matchexpr) = block.stmts[0].kind {\n+            if let StmtKind::Semi(ref matchexpr) = block.stmts.get(0)?.kind {\n                 // macros with unique arg: `{debug_}assert!` (e.g., `debug_assert!(some_condition)`)\n                 if_chain! {\n-                    if let ExprKind::Match(ref ifclause, _, _) = matchexpr.kind;\n-                    if let ExprKind::DropTemps(ref droptmp) = ifclause.kind;\n-                    if let ExprKind::Unary(UnOp::UnNot, condition) = droptmp.kind;\n+                    if let ExprKind::If(ref clause, _, _)  = matchexpr.kind;\n+                    if let ExprKind::Unary(UnOp::UnNot, condition) = clause.kind;\n                     then {\n                         return Some(vec![condition]);\n                     }"}, {"sha": "b5cc2bdc4636a22128673979712f58861628633a", "filename": "clippy_lints/src/utils/hir_utils.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fhir_utils.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -119,6 +119,9 @@ impl<'a, 'tcx> SpanlessEq<'a, 'tcx> {\n             (&ExprKind::Index(ref la, ref li), &ExprKind::Index(ref ra, ref ri)) => {\n                 self.eq_expr(la, ra) && self.eq_expr(li, ri)\n             },\n+            (&ExprKind::If(ref lc, ref lt, ref le), &ExprKind::If(ref rc, ref rt, ref re)) => {\n+                self.eq_expr(lc, rc) && self.eq_expr(&**lt, &**rt) && both(le, re, |l, r| self.eq_expr(l, r))\n+            },\n             (&ExprKind::Lit(ref l), &ExprKind::Lit(ref r)) => l.node == r.node,\n             (&ExprKind::Loop(ref lb, ref ll, ref lls), &ExprKind::Loop(ref rb, ref rl, ref rls)) => {\n                 lls == rls && self.eq_block(lb, rb) && both(ll, rl, |l, r| l.ident.as_str() == r.ident.as_str())\n@@ -564,6 +567,15 @@ impl<'a, 'tcx> SpanlessHash<'a, 'tcx> {\n                     self.hash_name(i.ident.name);\n                 }\n             },\n+            ExprKind::If(ref cond, ref then, ref else_opt) => {\n+                let c: fn(_, _, _) -> _ = ExprKind::If;\n+                c.hash(&mut self.s);\n+                self.hash_expr(cond);\n+                self.hash_expr(&**then);\n+                if let Some(ref e) = *else_opt {\n+                    self.hash_expr(e);\n+                }\n+            },\n             ExprKind::Match(ref e, arms, ref s) => {\n                 self.hash_expr(e);\n "}, {"sha": "71c11788d93ac34735b949250c1dc7d383873ed5", "filename": "clippy_lints/src/utils/inspector.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Finspector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finspector.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -213,6 +213,15 @@ fn print_expr(cx: &LateContext<'_>, expr: &hir::Expr<'_>, indent: usize) {\n         hir::ExprKind::Loop(..) => {\n             println!(\"{}Loop\", ind);\n         },\n+        hir::ExprKind::If(ref cond, _, ref else_opt) => {\n+            println!(\"{}If\", ind);\n+            println!(\"{}condition:\", ind);\n+            print_expr(cx, cond, indent + 1);\n+            if let Some(ref els) = *else_opt {\n+                println!(\"{}else:\", ind);\n+                print_expr(cx, els, indent + 1);\n+            }\n+        },\n         hir::ExprKind::Match(ref cond, _, ref source) => {\n             println!(\"{}Match\", ind);\n             println!(\"{}condition:\", ind);"}, {"sha": "bd103246e4ef8ce85e602544eedc613dd9f70f20", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1405,7 +1405,7 @@ pub fn if_sequence<'tcx>(\n     let mut conds = SmallVec::new();\n     let mut blocks: SmallVec<[&Block<'_>; 1]> = SmallVec::new();\n \n-    while let Some((ref cond, ref then_expr, ref else_expr)) = higher::if_block(&expr) {\n+    while let ExprKind::If(ref cond, ref then_expr, ref else_expr) = expr.kind {\n         conds.push(&**cond);\n         if let ExprKind::Block(ref block, _) = then_expr.kind {\n             blocks.push(block);\n@@ -1434,11 +1434,11 @@ pub fn parent_node_is_if_expr(expr: &Expr<'_>, cx: &LateContext<'_>) -> bool {\n     let map = cx.tcx.hir();\n     let parent_id = map.get_parent_node(expr.hir_id);\n     let parent_node = map.get(parent_id);\n-\n-    match parent_node {\n-        Node::Expr(e) => higher::if_block(&e).is_some(),\n-        Node::Arm(e) => higher::if_block(&e.body).is_some(),\n-        _ => false,\n+    if let Node::Expr(Expr { kind: ExprKind::If(_, _, _), .. }) = parent_node {\n+        true\n+    }\n+    else {\n+        false\n     }\n }\n "}, {"sha": "03678db575f0daceef3b58445d55d80c0172b6fd", "filename": "clippy_lints/src/utils/sugg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fsugg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fsugg.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -103,6 +103,7 @@ impl<'a> Sugg<'a> {\n         match expr.kind {\n             hir::ExprKind::AddrOf(..)\n             | hir::ExprKind::Box(..)\n+            | hir::ExprKind::If(..)\n             | hir::ExprKind::Closure(..)\n             | hir::ExprKind::Unary(..)\n             | hir::ExprKind::Match(..) => Sugg::MaybeParen(snippet),"}, {"sha": "b769a18802b6b8a1292d51af378cf5de8718ed51", "filename": "clippy_lints/src/utils/visitors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fvisitors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/clippy_lints%2Fsrc%2Futils%2Fvisitors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fvisitors.rs?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -101,6 +101,13 @@ where\n                 }\n             } else {\n                 match expr.kind {\n+                    hir::ExprKind::If(cond, then, else_opt) => {\n+                        self.inside_stmt(true).visit_expr(cond);\n+                        self.visit_expr(then);\n+                        if let Some(el) = else_opt {\n+                            self.visit_expr(el);\n+                        }\n+                    }\n                     hir::ExprKind::Match(cond, arms, _) => {\n                         self.inside_stmt(true).visit_expr(cond);\n                         for arm in arms {"}, {"sha": "cac64a3f40b41fbd3052577107cdb6fd8cb86779", "filename": "tests/ui/author/if.stdout", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/tests%2Fui%2Fauthor%2Fif.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/tests%2Fui%2Fauthor%2Fif.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauthor%2Fif.stdout?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -1,7 +1,7 @@\n if_chain! {\n     if let StmtKind::Local(ref local) = stmt.kind;\n     if let Some(ref init) = local.init;\n-    if let Some((ref cond, ref then, Some(else_))) = higher::if_block(&init);\n+    if let ExprKind::If(ref cond, ref then, Some(ref else_)) = init.kind;\n     if let ExprKind::Block(ref block) = else_.kind;\n     if let Some(trailing_expr) = &block.expr;\n     if block.stmts.len() == 1;"}, {"sha": "a17f043737d4e009fae59b46d62399e6c8ae3a5d", "filename": "tests/ui/panic_in_result_fn_assertions.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7d42172899663993a9fd2e3445ddb58ab5d10a79/tests%2Fui%2Fpanic_in_result_fn_assertions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7d42172899663993a9fd2e3445ddb58ab5d10a79/tests%2Fui%2Fpanic_in_result_fn_assertions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fpanic_in_result_fn_assertions.stderr?ref=7d42172899663993a9fd2e3445ddb58ab5d10a79", "patch": "@@ -14,7 +14,7 @@ note: return Err() instead of panicking\n   --> $DIR/panic_in_result_fn_assertions.rs:9:9\n    |\n LL |         assert!(x == 5, \"wrong argument\");\n-   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: used `unimplemented!()`, `unreachable!()`, `todo!()`, `panic!()` or assertion in a function that returns `Result`"}]}