{"sha": "f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "node_id": "C_kwDOAAsO6NoAKGY3ZTBmOTc2MzEyODYwM2QyMjQ5ZDNjYjFjNDFhMjNmMjYxZDZlMWU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-04T13:58:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-04T13:58:57Z"}, "message": "Rollup merge of #93402 - ehuss:llvm-dialog, r=michaelwoerister\n\nWindows: Disable LLVM crash dialog boxes.\n\nThis disables the crash dialog box on Windows. When LLVM hits an assertion, it will open a dialog box with Abort/Retry/Ignore. This is annoying on CI because CI will just hang until it times out (which can take hours).\n\nInstead of opening a dialog box, it will print a message like this:\n\n```\nAssertion failed: isa<X>(Val) && \"cast<Ty>() argument of incompatible type!\", file D:\\Proj\\rust\\rust\\src\\llvm-project\\llvm\\include\\llvm/Support/Casting.h, line 255\n```\n\nCloses #92829", "tree": {"sha": "a418078e2d663dec1ba3e9fd6f7d9eb2f2fc2746", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a418078e2d663dec1ba3e9fd6f7d9eb2f2fc2746"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh/TEhCRBK7hj4Ov3rIwAACiwIAAHip1dsKPHHdqYWHbtWjPOx\nMA/skeqbDd5Icb+L25NZS3TeEIXSPeufjI3odKkj3r+X4QUgsTuPXwV1ibr3f4KA\nLdvQeKfppm1lWQ45xvo/fTn+acZ9l9JQfzDvotX+zCW393aBbuutQtPI9wKPRIKk\n1Dd5bHCqMiRvP/+DZ6eZ90sINrY2Z5cp3Bk0YROXZ7f5uel/NQbalY7uGtMGtLOO\nG6viF3RQF3caIpy7QUEuPD/MjbBSO4r5b+rc8jWlQKBFZUnXmr7xd3g1mx3RBz9B\nFuNEIAHZaA6eeQ+lg1ma4DCW+SVU9JlXraf18cSfe2lzE7V2WDoyied4Lx2icbA=\n=EYDV\n-----END PGP SIGNATURE-----\n", "payload": "tree a418078e2d663dec1ba3e9fd6f7d9eb2f2fc2746\nparent f2721fab23d06d58453de09ec6a91f78614fca94\nparent c64d6bf5af368066af7ecc2f69555b1721cfd0b5\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1643983137 +0100\ncommitter GitHub <noreply@github.com> 1643983137 +0100\n\nRollup merge of #93402 - ehuss:llvm-dialog, r=michaelwoerister\n\nWindows: Disable LLVM crash dialog boxes.\n\nThis disables the crash dialog box on Windows. When LLVM hits an assertion, it will open a dialog box with Abort/Retry/Ignore. This is annoying on CI because CI will just hang until it times out (which can take hours).\n\nInstead of opening a dialog box, it will print a message like this:\n\n```\nAssertion failed: isa<X>(Val) && \"cast<Ty>() argument of incompatible type!\", file D:\\Proj\\rust\\rust\\src\\llvm-project\\llvm\\include\\llvm/Support/Casting.h, line 255\n```\n\nCloses #92829\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "html_url": "https://github.com/rust-lang/rust/commit/f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2721fab23d06d58453de09ec6a91f78614fca94", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2721fab23d06d58453de09ec6a91f78614fca94", "html_url": "https://github.com/rust-lang/rust/commit/f2721fab23d06d58453de09ec6a91f78614fca94"}, {"sha": "c64d6bf5af368066af7ecc2f69555b1721cfd0b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/c64d6bf5af368066af7ecc2f69555b1721cfd0b5", "html_url": "https://github.com/rust-lang/rust/commit/c64d6bf5af368066af7ecc2f69555b1721cfd0b5"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "367c86a1dc942ebb77ff4c45b3a1602f3e2d89cd", "filename": "compiler/rustc_codegen_llvm/src/llvm/ffi.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs?ref=f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "patch": "@@ -987,6 +987,7 @@ pub type SelfProfileAfterPassCallback = unsafe extern \"C\" fn(*mut c_void);\n \n extern \"C\" {\n     pub fn LLVMRustInstallFatalErrorHandler();\n+    pub fn LLVMRustDisableSystemDialogsOnCrash();\n \n     // Create and destroy contexts.\n     pub fn LLVMRustContextCreate(shouldDiscardNames: bool) -> &'static mut Context;"}, {"sha": "f91fad2d9c9635b796069fec0e32ab3820eb0486", "filename": "compiler/rustc_codegen_llvm/src/llvm_util.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs?ref=f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "patch": "@@ -46,6 +46,12 @@ unsafe fn configure_llvm(sess: &Session) {\n     let mut llvm_args = Vec::with_capacity(n_args + 1);\n \n     llvm::LLVMRustInstallFatalErrorHandler();\n+    // On Windows, an LLVM assertion will open an Abort/Retry/Ignore dialog\n+    // box for the purpose of launching a debugger. However, on CI this will\n+    // cause it to hang until it times out, which can take several hours.\n+    if std::env::var_os(\"CI\").is_some() {\n+        llvm::LLVMRustDisableSystemDialogsOnCrash();\n+    }\n \n     fn llvm_arg_to_arg_name(full_arg: &str) -> &str {\n         full_arg.trim().split(|c: char| c == '=' || c.is_whitespace()).next().unwrap_or(\"\")"}, {"sha": "d871290744f8bae8ca20b908c41015358c85bd60", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/f7e0f9763128603d2249d3cb1c41a23f261d6e1e/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=f7e0f9763128603d2249d3cb1c41a23f261d6e1e", "patch": "@@ -76,6 +76,10 @@ extern \"C\" void LLVMRustInstallFatalErrorHandler() {\n   install_fatal_error_handler(FatalErrorHandler);\n }\n \n+extern \"C\" void LLVMRustDisableSystemDialogsOnCrash() {\n+  sys::DisableSystemDialogsOnCrash();\n+}\n+\n extern \"C\" char *LLVMRustGetLastError(void) {\n   char *Ret = LastError;\n   LastError = nullptr;"}]}