{"sha": "16063416979e1f8643375e62e331b019a3ac8d4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE2MDYzNDE2OTc5ZTFmODY0MzM3NWU2MmUzMzFiMDE5YTNhYzhkNGM=", "commit": {"author": {"name": "Segev Finer", "email": "segev208@gmail.com", "date": "2018-01-16T23:18:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-01-16T23:18:04Z"}, "message": "Document the mingw -lmsvcrt hack better", "tree": {"sha": "4bb42eb3e963d4baeb2b6772c8ecfcb743ea1efe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bb42eb3e963d4baeb2b6772c8ecfcb743ea1efe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/16063416979e1f8643375e62e331b019a3ac8d4c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaXogsCRBK7hj4Ov3rIwAAdHIIAD+grhpZ7O5LPhhznyO8zBFX\n7ysqqUagBIjEyZFABK8Yzu/+giqJv2LgY+puRWpG1JxpYBhoP9Lfhc7PDtsD9bvQ\ntmpSM4+uGqCCbAerHMKMrK6ronMqpEI0OGkqvABOHHi0jXQ8bHcZFXnW1C5l8CL3\nRgGTK6go7mbF3qUCpIcmRtJtgFa6TMNt/7OMcrppgDiAnJ8Hj8QqbzpgAJecwMt4\nMnQakQH/CfsLvQg2tuMx3WPlSCD5AKClI4WQpeUjEecwEfT/SfZjjqGmThyVvyh9\nR2Zn9KXuBKMQ/1SqksjisMwJ198hr0h4Ww/Emu4vIkbMgTF5TgPUVLgmrMZ3JAw=\n=l0oR\n-----END PGP SIGNATURE-----\n", "payload": "tree 4bb42eb3e963d4baeb2b6772c8ecfcb743ea1efe\nparent bfde33f2fb00864302d034e91cd40f17d43ce961\nauthor Segev Finer <segev208@gmail.com> 1516144684 +0200\ncommitter GitHub <noreply@github.com> 1516144684 +0200\n\nDocument the mingw -lmsvcrt hack better"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/16063416979e1f8643375e62e331b019a3ac8d4c", "html_url": "https://github.com/rust-lang/rust/commit/16063416979e1f8643375e62e331b019a3ac8d4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/16063416979e1f8643375e62e331b019a3ac8d4c/comments", "author": {"login": "segevfiner", "id": 24731903, "node_id": "MDQ6VXNlcjI0NzMxOTAz", "avatar_url": "https://avatars.githubusercontent.com/u/24731903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segevfiner", "html_url": "https://github.com/segevfiner", "followers_url": "https://api.github.com/users/segevfiner/followers", "following_url": "https://api.github.com/users/segevfiner/following{/other_user}", "gists_url": "https://api.github.com/users/segevfiner/gists{/gist_id}", "starred_url": "https://api.github.com/users/segevfiner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segevfiner/subscriptions", "organizations_url": "https://api.github.com/users/segevfiner/orgs", "repos_url": "https://api.github.com/users/segevfiner/repos", "events_url": "https://api.github.com/users/segevfiner/events{/privacy}", "received_events_url": "https://api.github.com/users/segevfiner/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfde33f2fb00864302d034e91cd40f17d43ce961", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfde33f2fb00864302d034e91cd40f17d43ce961", "html_url": "https://github.com/rust-lang/rust/commit/bfde33f2fb00864302d034e91cd40f17d43ce961"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "cc40b8b0529836440b766579f87f76f5e3ee0530", "filename": "src/librustc_back/target/windows_base.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/16063416979e1f8643375e62e331b019a3ac8d4c/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16063416979e1f8643375e62e331b019a3ac8d4c/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fwindows_base.rs?ref=16063416979e1f8643375e62e331b019a3ac8d4c", "patch": "@@ -59,7 +59,15 @@ pub fn opts() -> TargetOptions {\n         \"-lmingw32\".to_string(),\n         \"-lgcc\".to_string(), // alas, mingw* libraries above depend on libgcc\n         \"-lmsvcrt\".to_string(),\n-        \"-lmsvcrt\".to_string(), // mingw is insane...?\n+        // mingw's msvcrt is a weird hybrid import library and static library.\n+        // And it seems that the linker fails to use import symbols from msvcrt\n+        // that are required from functions in msvcrt in certain cases. For example\n+        // `_fmode` that is used by an implementation of `__p__fmode` in x86_64.\n+        // Listing the library twice seems to fix that, and seems to also be done\n+        // by mingw's gcc (Though not sure if it's done on purpose, or by mistake).\n+        //\n+        // See https://github.com/rust-lang/rust/pull/47483\n+        \"-lmsvcrt\".to_string(),\n         \"-luser32\".to_string(),\n         \"-lkernel32\".to_string(),\n     ]);"}]}