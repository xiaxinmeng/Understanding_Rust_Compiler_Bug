{"sha": "5835a4cc8ed075f048c089350002f515383b7df4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4MzVhNGNjOGVkMDc1ZjA0OGMwODkzNTAwMDJmNTE1MzgzYjdkZjQ=", "commit": {"author": {"name": "Josh Matthews", "email": "josh@joshmatthews.net", "date": "2012-03-21T23:01:04Z"}, "committer": {"name": "Josh Matthews", "email": "josh@joshmatthews.net", "date": "2012-03-21T23:01:04Z"}, "message": "Merge remote-tracking branch 'mozilla/master'", "tree": {"sha": "8e89a1d511b8b65941391ae545d06b870f5479de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e89a1d511b8b65941391ae545d06b870f5479de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5835a4cc8ed075f048c089350002f515383b7df4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5835a4cc8ed075f048c089350002f515383b7df4", "html_url": "https://github.com/rust-lang/rust/commit/5835a4cc8ed075f048c089350002f515383b7df4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5835a4cc8ed075f048c089350002f515383b7df4/comments", "author": {"login": "jdm", "id": 27658, "node_id": "MDQ6VXNlcjI3NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdm", "html_url": "https://github.com/jdm", "followers_url": "https://api.github.com/users/jdm/followers", "following_url": "https://api.github.com/users/jdm/following{/other_user}", "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdm/subscriptions", "organizations_url": "https://api.github.com/users/jdm/orgs", "repos_url": "https://api.github.com/users/jdm/repos", "events_url": "https://api.github.com/users/jdm/events{/privacy}", "received_events_url": "https://api.github.com/users/jdm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jdm", "id": 27658, "node_id": "MDQ6VXNlcjI3NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdm", "html_url": "https://github.com/jdm", "followers_url": "https://api.github.com/users/jdm/followers", "following_url": "https://api.github.com/users/jdm/following{/other_user}", "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdm/subscriptions", "organizations_url": "https://api.github.com/users/jdm/orgs", "repos_url": "https://api.github.com/users/jdm/repos", "events_url": "https://api.github.com/users/jdm/events{/privacy}", "received_events_url": "https://api.github.com/users/jdm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "81424389382316220944322305c9935119dba5ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/81424389382316220944322305c9935119dba5ce", "html_url": "https://github.com/rust-lang/rust/commit/81424389382316220944322305c9935119dba5ce"}, {"sha": "b0f6dad5e3a3fcb2a19077e5beb3833473bec5e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0f6dad5e3a3fcb2a19077e5beb3833473bec5e7", "html_url": "https://github.com/rust-lang/rust/commit/b0f6dad5e3a3fcb2a19077e5beb3833473bec5e7"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "8a7df2c56932f79ea1ce567f4b94014ec9fcf355", "filename": "src/rustc/middle/ty.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/5835a4cc8ed075f048c089350002f515383b7df4/src%2Frustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5835a4cc8ed075f048c089350002f515383b7df4/src%2Frustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Fty.rs?ref=5835a4cc8ed075f048c089350002f515383b7df4", "patch": "@@ -1690,6 +1690,34 @@ mod unify {\n         ret nxt(mk_var(cx.tcx, key));\n     }\n \n+    fn record_region_binding<T:copy>(\n+        cx: @uctxt, key: uint,\n+        r: region, base_mt: mt, variance: variance,\n+        nxt: fn(t) -> ures<T>) -> ures<T> {\n+\n+        let rb = alt cx.st {\n+            in_region_bindings(_, rb) { rb }\n+            in_bindings(_) | precise { fail; }\n+        };\n+\n+        ufind::grow(rb.sets, key + 1u);\n+        let root = ufind::find(rb.sets, key);\n+        let mut result_region = r;\n+        alt smallintmap::find(rb.regions, root) {\n+          some(old_region) {\n+            alt unify_regions(cx, old_region, r, variance, {|v| ok(v)}) {\n+              ok(unified_region) { result_region = unified_region; }\n+              err(e) { ret err(e); }\n+            }\n+          }\n+          none {/* fall through */ }\n+        }\n+        smallintmap::insert(rb.regions, root, result_region);\n+\n+        // FIXME: This should be re_var instead.\n+        ret nxt(mk_rptr(cx.tcx, re_param(key), base_mt));\n+    }\n+\n     // Simple structural type comparison.\n     fn struct_cmp<T:copy>(\n         cx: @uctxt, expected: t, actual: t,"}]}