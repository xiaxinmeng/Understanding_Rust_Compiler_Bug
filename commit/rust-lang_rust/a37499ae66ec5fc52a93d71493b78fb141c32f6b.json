{"sha": "a37499ae66ec5fc52a93d71493b78fb141c32f6b", "node_id": "C_kwDOAAsO6NoAKGEzNzQ5OWFlNjZlYzVmYzUyYTkzZDcxNDkzYjc4ZmIxNDFjMzJmNmI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-18T14:10:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-09-18T14:10:57Z"}, "message": "Auto merge of #101332 - sashashura:patch-1, r=pietroalbini\n\nGitHub Workflows security hardening\n\nThis PR adds explicit [permissions section](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#permissions) to workflows. This is a security best practice because by default workflows run with [extended set of permissions](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token) (except from `on: pull_request` [from external forks](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)). By specifying any permission explicitly all others are set to none. By using the principle of least privilege the damage a compromised workflow can do (because of an [injection](https://securitylab.github.com/research/github-actions-untrusted-input/) or compromised third party tool or action) is restricted.\nIt is recommended to have [most strict permissions on the top level](https://github.com/ossf/scorecard/blob/main/docs/checks.md#token-permissions) and grant write permissions on [job level](https://docs.github.com/en/actions/using-jobs/assigning-permissions-to-jobs) case by case.", "tree": {"sha": "26d26f1a75711967d423745d419c8bd98ed14808", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26d26f1a75711967d423745d419c8bd98ed14808"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a37499ae66ec5fc52a93d71493b78fb141c32f6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a37499ae66ec5fc52a93d71493b78fb141c32f6b", "html_url": "https://github.com/rust-lang/rust/commit/a37499ae66ec5fc52a93d71493b78fb141c32f6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a37499ae66ec5fc52a93d71493b78fb141c32f6b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4af79ccd5e23c7cbaabcd7aefdda3b715abde606", "url": "https://api.github.com/repos/rust-lang/rust/commits/4af79ccd5e23c7cbaabcd7aefdda3b715abde606", "html_url": "https://github.com/rust-lang/rust/commit/4af79ccd5e23c7cbaabcd7aefdda3b715abde606"}, {"sha": "bd5aad3ee28fbc1f7cb4bd2c52763dbadaeae34a", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd5aad3ee28fbc1f7cb4bd2c52763dbadaeae34a", "html_url": "https://github.com/rust-lang/rust/commit/bd5aad3ee28fbc1f7cb4bd2c52763dbadaeae34a"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "6693182e0c57872fc1127af0de4779e438ca9d44", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a37499ae66ec5fc52a93d71493b78fb141c32f6b/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a37499ae66ec5fc52a93d71493b78fb141c32f6b/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=a37499ae66ec5fc52a93d71493b78fb141c32f6b", "patch": "@@ -25,11 +25,15 @@ name: CI\n   pull_request:\n     branches:\n       - \"**\"\n+permissions:\n+  contents: read\n defaults:\n   run:\n     shell: bash\n jobs:\n   pr:\n+    permissions:\n+      actions: write\n     name: PR\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n@@ -142,6 +146,8 @@ jobs:\n           AWS_SECRET_ACCESS_KEY: \"${{ secrets[format('AWS_SECRET_ACCESS_KEY_{0}', env.ARTIFACTS_AWS_ACCESS_KEY_ID)] }}\"\n         if: \"success() && !env.SKIP_JOB && (github.event_name == 'push' || env.DEPLOY == '1' || env.DEPLOY_ALT == '1')\"\n   auto:\n+    permissions:\n+      actions: write\n     name: auto\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n@@ -547,6 +553,8 @@ jobs:\n           AWS_SECRET_ACCESS_KEY: \"${{ secrets[format('AWS_SECRET_ACCESS_KEY_{0}', env.ARTIFACTS_AWS_ACCESS_KEY_ID)] }}\"\n         if: \"success() && !env.SKIP_JOB && (github.event_name == 'push' || env.DEPLOY == '1' || env.DEPLOY_ALT == '1')\"\n   try:\n+    permissions:\n+      actions: write\n     name: try\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\""}, {"sha": "f020c31079e5ef93c5ee1b283a29e37b205a3ca1", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a37499ae66ec5fc52a93d71493b78fb141c32f6b/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/a37499ae66ec5fc52a93d71493b78fb141c32f6b/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=a37499ae66ec5fc52a93d71493b78fb141c32f6b", "patch": "@@ -264,6 +264,9 @@ on:\n     branches:\n       - \"**\"\n \n+permissions:\n+  contents: read\n+\n defaults:\n   run:\n     # On Linux, macOS, and Windows, use the system-provided bash as the default\n@@ -273,6 +276,8 @@ defaults:\n \n jobs:\n   pr:\n+    permissions:\n+      actions: write # for rust-lang/simpleinfra/github-actions/cancel-outdated-builds\n     <<: *base-ci-job\n     name: PR\n     env:\n@@ -293,6 +298,8 @@ jobs:\n             <<: *job-linux-xl\n \n   auto:\n+    permissions:\n+      actions: write # for rust-lang/simpleinfra/github-actions/cancel-outdated-builds\n     <<: *base-ci-job\n     name: auto\n     env:\n@@ -719,6 +726,8 @@ jobs:\n             <<: *job-windows-xl\n \n   try:\n+    permissions:\n+      actions: write # for rust-lang/simpleinfra/github-actions/cancel-outdated-builds\n     <<: *base-ci-job\n     name: try\n     env:"}]}