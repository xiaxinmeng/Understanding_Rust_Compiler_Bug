{"sha": "14e09245c49dbba9316e2662a6b85d10070f653a", "node_id": "C_kwDOAAsO6NoAKDE0ZTA5MjQ1YzQ5ZGJiYTkzMTZlMjY2MmE2Yjg1ZDEwMDcwZjY1M2E", "commit": {"author": {"name": "antoyo", "email": "antoyo@users.noreply.github.com", "date": "2022-07-05T18:24:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-05T18:24:10Z"}, "message": "Merge pull request #195 from GuillaumeGomez/split-rustc-tests\n\nSplit rustc tests in two", "tree": {"sha": "91e68306aecc5b082b009d9f10b8d5f59d70dced", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/91e68306aecc5b082b009d9f10b8d5f59d70dced"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/14e09245c49dbba9316e2662a6b85d10070f653a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJixIHKCRBK7hj4Ov3rIwAAntQIAHUHGbZymZriK8iT7EivOJfu\nVrGYi+jIIbHaTJIpomNmxjv5DyC4/AHFC6v59WLjoad6yWdiqpdd1BXASt6D5aeS\niBinch/Jk3Mi20PM+NR2MIHXEAJ8BaRY3r/uzR7dxGHXn4OvP8ElB1FeCV394ep+\niprKYKH0+9CNk8ebQ+OGnvkdJ2m25FF4TbTIGinpUGRkYQ3M1nysnGmACRQszCCr\n6EPV7wdSG0ssPsWgIuq5iUxvNt0y00u6+h99DcLhi1A7DrmJsYcNfNsbteWxOrmn\npKi+uHnW0QnKeQFww+r4Rt1ubPi0LjKHEBq341i2BUIfWXB8NjtJvfRXMXEI9mA=\n=6Ust\n-----END PGP SIGNATURE-----\n", "payload": "tree 91e68306aecc5b082b009d9f10b8d5f59d70dced\nparent 9edaf82a0389aa3465659c4d0769bf2269975e07\nparent 0ba53c821127f2b05f77f1a35f70d757272f0b54\nauthor antoyo <antoyo@users.noreply.github.com> 1657045450 -0400\ncommitter GitHub <noreply@github.com> 1657045450 -0400\n\nMerge pull request #195 from GuillaumeGomez/split-rustc-tests\n\nSplit rustc tests in two"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/14e09245c49dbba9316e2662a6b85d10070f653a", "html_url": "https://github.com/rust-lang/rust/commit/14e09245c49dbba9316e2662a6b85d10070f653a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/14e09245c49dbba9316e2662a6b85d10070f653a/comments", "author": {"login": "antoyo", "id": 584972, "node_id": "MDQ6VXNlcjU4NDk3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/584972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoyo", "html_url": "https://github.com/antoyo", "followers_url": "https://api.github.com/users/antoyo/followers", "following_url": "https://api.github.com/users/antoyo/following{/other_user}", "gists_url": "https://api.github.com/users/antoyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoyo/subscriptions", "organizations_url": "https://api.github.com/users/antoyo/orgs", "repos_url": "https://api.github.com/users/antoyo/repos", "events_url": "https://api.github.com/users/antoyo/events{/privacy}", "received_events_url": "https://api.github.com/users/antoyo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9edaf82a0389aa3465659c4d0769bf2269975e07", "url": "https://api.github.com/repos/rust-lang/rust/commits/9edaf82a0389aa3465659c4d0769bf2269975e07", "html_url": "https://github.com/rust-lang/rust/commit/9edaf82a0389aa3465659c4d0769bf2269975e07"}, {"sha": "0ba53c821127f2b05f77f1a35f70d757272f0b54", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ba53c821127f2b05f77f1a35f70d757272f0b54", "html_url": "https://github.com/rust-lang/rust/commit/0ba53c821127f2b05f77f1a35f70d757272f0b54"}], "stats": {"total": 110, "additions": 108, "deletions": 2}, "files": [{"sha": "2e69168dda8c2ba93a1773a7f5014fffe3f74643", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/14e09245c49dbba9316e2662a6b85d10070f653a/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/14e09245c49dbba9316e2662a6b85d10070f653a/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=14e09245c49dbba9316e2662a6b85d10070f653a", "patch": "@@ -24,7 +24,8 @@ jobs:\n           \"--std-tests\",\n           \"--test-libcore\",\n           \"--extended-tests\",\n-          \"--test-rustc\",\n+          \"--test-successful-rustc\",\n+          \"--test-failing-rustc\",\n         ]\n \n     steps:\n@@ -111,6 +112,10 @@ jobs:\n         command: build\n         args: --release\n \n+    - name: Add more failing tests for GCC 12\n+      if: ${{ matrix.libgccjit_version.gcc == 'libgccjit12.so' }}\n+      run: cat failing-ui-tests12.txt >> failing-ui-tests.txt\n+\n     - name: Run tests\n       run: |\n         ./test.sh --release --clean --build-sysroot ${{ matrix.commands }} ${{ matrix.libgccjit_version.extra }}"}, {"sha": "717d0d39331f672e4b85d0c95f0baa68e5076662", "filename": "failing-ui-tests.txt", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/14e09245c49dbba9316e2662a6b85d10070f653a/failing-ui-tests.txt", "raw_url": "https://github.com/rust-lang/rust/raw/14e09245c49dbba9316e2662a6b85d10070f653a/failing-ui-tests.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/failing-ui-tests.txt?ref=14e09245c49dbba9316e2662a6b85d10070f653a", "patch": "@@ -0,0 +1,55 @@\n+src/test/ui/alloc-error/default-alloc-error-hook.rs\n+src/test/ui/allocator/custom-in-block.rs\n+src/test/ui/allocator/custom-in-submodule.rs\n+src/test/ui/allocator/custom.rs\n+src/test/ui/allocator/hygiene.rs\n+src/test/ui/allocator/no_std-alloc-error-handler-custom.rs\n+src/test/ui/allocator/no_std-alloc-error-handler-default.rs\n+src/test/ui/allocator/xcrate-use.rs\n+src/test/ui/allocator/xcrate-use2.rs\n+src/test/ui/asm/may_unwind.rs\n+src/test/ui/asm/x86_64/const.rs\n+src/test/ui/asm/x86_64/multiple-clobber-abi.rs\n+src/test/ui/async-await/async-fn-size-moved-locals.rs\n+src/test/ui/async-await/async-fn-size-uninit-locals.rs\n+src/test/ui/backtrace.rs\n+src/test/ui/cfg/cfg-panic.rs\n+src/test/ui/debuginfo/debuginfo-emit-llvm-ir-and-split-debuginfo.rs\n+src/test/ui/functions-closures/parallel-codegen-closures.rs\n+src/test/ui/generator/size-moved-locals.rs\n+src/test/ui/issues/issue-32518.rs\n+src/test/ui/issues/issue-47364.rs\n+src/test/ui/issues/issue-74564-if-expr-stack-overflow.rs\n+src/test/ui/linkage-attr/linkage1.rs\n+src/test/ui/lto/dylib-works.rs\n+src/test/ui/mir/mir_heavy_promoted.rs\n+src/test/ui/numbers-arithmetic/saturating-float-casts.rs\n+src/test/ui/polymorphization/promoted-function.rs\n+src/test/ui/runtime/rt-explody-panic-payloads.rs\n+src/test/ui/sepcomp/sepcomp-cci.rs\n+src/test/ui/sepcomp/sepcomp-extern.rs\n+src/test/ui/sepcomp/sepcomp-fns-backwards.rs\n+src/test/ui/sepcomp/sepcomp-fns.rs\n+src/test/ui/sepcomp/sepcomp-lib.rs\n+src/test/ui/sepcomp/sepcomp-statics.rs\n+src/test/ui/simd/generics.rs\n+src/test/ui/simd/intrinsic/float-math-pass.rs\n+src/test/ui/simd/intrinsic/float-minmax-pass.rs\n+src/test/ui/simd/intrinsic/generic-arithmetic-pass.rs\n+src/test/ui/simd/intrinsic/generic-as.rs\n+src/test/ui/simd/intrinsic/generic-bitmask-pass.rs\n+src/test/ui/simd/intrinsic/generic-comparison-pass.rs\n+src/test/ui/simd/intrinsic/generic-gather-pass.rs\n+src/test/ui/simd/intrinsic/generic-reduction-pass.rs\n+src/test/ui/simd/intrinsic/generic-select-pass.rs\n+src/test/ui/simd/issue-17170.rs\n+src/test/ui/simd/issue-39720.rs\n+src/test/ui/simd/issue-85915-simd-ptrs.rs\n+src/test/ui/simd/issue-89193.rs\n+src/test/ui/simd/libm_std_can_float.rs\n+src/test/ui/simd/simd-bitmask.rs\n+src/test/ui/simd/type-generic-monomorphisation-extern-nonnull-ptr.rs\n+src/test/ui/sse2.rs\n+src/test/ui/statics/issue-91050-1.rs\n+src/test/ui/statics/issue-91050-2.rs\n+src/test/ui/target-feature/missing-plusminus.rs"}, {"sha": "0a50c0a2ce136dc2892197d7f82e850cd2736d31", "filename": "failing-ui-tests12.txt", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/14e09245c49dbba9316e2662a6b85d10070f653a/failing-ui-tests12.txt", "raw_url": "https://github.com/rust-lang/rust/raw/14e09245c49dbba9316e2662a6b85d10070f653a/failing-ui-tests12.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/failing-ui-tests12.txt?ref=14e09245c49dbba9316e2662a6b85d10070f653a", "patch": "@@ -0,0 +1,17 @@\n+src/test/ui/intrinsics/const-eval-select-x86_64.rs\n+src/test/ui/packed/packed-struct-drop-aligned.rs\n+src/test/ui/packed/packed-struct-generic-layout.rs\n+src/test/ui/packed/packed-struct-layout.rs\n+src/test/ui/packed/packed-struct-optimized-enum.rs\n+src/test/ui/packed/packed-struct-size.rs\n+src/test/ui/packed/packed-struct-vec.rs\n+src/test/ui/packed/packed-tuple-struct-layout.rs\n+src/test/ui/simd/array-type.rs\n+src/test/ui/simd/intrinsic/generic-arithmetic-saturating-pass.rs\n+src/test/ui/simd/intrinsic/generic-cast-pass.rs\n+src/test/ui/simd/intrinsic/generic-cast-pointer-width.rs\n+src/test/ui/simd/intrinsic/generic-elements-pass.rs\n+src/test/ui/simd/intrinsic/inlining-issue67557-ice.rs\n+src/test/ui/simd/intrinsic/inlining-issue67557.rs\n+src/test/ui/simd/monomorphize-shuffle-index.rs\n+src/test/ui/simd/shuffle.rs"}, {"sha": "32fe8cf0586b3bfcddf0d1462937618a5b00b9cb", "filename": "test.sh", "status": "modified", "additions": 30, "deletions": 1, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/14e09245c49dbba9316e2662a6b85d10070f653a/test.sh", "raw_url": "https://github.com/rust-lang/rust/raw/14e09245c49dbba9316e2662a6b85d10070f653a/test.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test.sh?ref=14e09245c49dbba9316e2662a6b85d10070f653a", "patch": "@@ -42,7 +42,15 @@ while [[ $# -gt 0 ]]; do\n             shift\n             ;;\n         \"--test-rustc\")\n-            funcs+=(test_rustc)\n+            funcs=(test_rustc)\n+            shift\n+            ;;\n+        \"--test-successful-rustc\")\n+            funcs+=(test_successful_rustc)\n+            shift\n+            ;;\n+        \"--test-failing-rustc\")\n+            funcs+=(test_failing_rustc)\n             shift\n             ;;\n \n@@ -276,10 +284,31 @@ EOF\n \n     RUSTC_ARGS=\"-Zpanic-abort-tests -Csymbol-mangling-version=v0 -Zcodegen-backend=\"$(pwd)\"/../target/\"$CHANNEL\"/librustc_codegen_gcc.\"$dylib_ext\" --sysroot \"$(pwd)\"/../build_sysroot/sysroot -Cpanic=abort\"\n \n+    if [ $# -eq 0 ]; then\n+        # No argument supplied to the function. Doing nothing.\n+        echo \"No argument provided. Keeping all UI tests\"\n+    elif [ $1 = \"0\" ]; then\n+        # Removing the failing tests.\n+        xargs -a ../failing-ui-tests.txt -d'\\n' rm\n+    else\n+        # Removing all tests.\n+        find src/test/ui -type f -name '*.rs' -exec rm {} \\;\n+        # Putting back only the failing ones.\n+        xargs -a ../failing-ui-tests.txt -d'\\n' git checkout --\n+    fi\n+\n     echo \"[TEST] rustc test suite\"\n     COMPILETEST_FORCE_STAGE0=1 ./x.py test --run always --stage 0 src/test/ui/ --rustc-args \"$RUSTC_ARGS\"\n }\n \n+function test_failing_rustc() {\n+    test_rustc \"1\"\n+}\n+\n+function test_successful_rustc() {\n+    test_rustc \"0\"\n+}\n+\n function clean_ui_tests() {\n     find rust/build/x86_64-unknown-linux-gnu/test/ui/ -name stamp -exec rm -rf {} \\;\n }"}]}