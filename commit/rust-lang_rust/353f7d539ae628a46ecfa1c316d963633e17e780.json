{"sha": "353f7d539ae628a46ecfa1c316d963633e17e780", "node_id": "C_kwDOAAsO6NoAKDM1M2Y3ZDUzOWFlNjI4YTQ2ZWNmYTFjMzE2ZDk2MzYzM2UxN2U3ODA", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-08-04T13:55:18Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-08-06T18:51:03Z"}, "message": "add special exception for std_miri_test crate to call std-only functions", "tree": {"sha": "83d28436aa8bcef7043e20c4346632c445cdee8a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83d28436aa8bcef7043e20c4346632c445cdee8a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/353f7d539ae628a46ecfa1c316d963633e17e780", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/353f7d539ae628a46ecfa1c316d963633e17e780", "html_url": "https://github.com/rust-lang/rust/commit/353f7d539ae628a46ecfa1c316d963633e17e780", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/353f7d539ae628a46ecfa1c316d963633e17e780/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f633537f3e4d47a2e1f96daee68e1063e0da17d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/f633537f3e4d47a2e1f96daee68e1063e0da17d4", "html_url": "https://github.com/rust-lang/rust/commit/f633537f3e4d47a2e1f96daee68e1063e0da17d4"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "7c9f8740eb420a26c857d1fd6797626d2384fff3", "filename": "src/helpers.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/353f7d539ae628a46ecfa1c316d963633e17e780/src%2Fhelpers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/353f7d539ae628a46ecfa1c316d963633e17e780/src%2Fhelpers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fhelpers.rs?ref=353f7d539ae628a46ecfa1c316d963633e17e780", "patch": "@@ -803,7 +803,12 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n         // Fall back to the instance of the function itself.\n         let instance = instance.unwrap_or(frame.instance);\n         // Now check if this is in the same crate as start_fn.\n-        this.tcx.def_path(instance.def_id()).krate == this.tcx.def_path(start_fn).krate\n+        // As a special exception we also allow unit tests from\n+        // <https://github.com/rust-lang/miri-test-libstd/tree/master/std_miri_test> to call these\n+        // shims.\n+        let frame_crate = this.tcx.def_path(instance.def_id()).krate;\n+        frame_crate == this.tcx.def_path(start_fn).krate\n+            || this.tcx.crate_name(frame_crate).as_str() == \"std_miri_test\"\n     }\n \n     /// Handler that should be called when unsupported functionality is encountered."}]}