{"sha": "dd6a83875e4236966cb846236b243fd3ccaf56af", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkNmE4Mzg3NWU0MjM2OTY2Y2I4NDYyMzZiMjQzZmQzY2NhZjU2YWY=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2020-01-18T01:28:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-18T01:28:22Z"}, "message": "Rollup merge of #68314 - oli-obk:true_unwind, r=eddyb\n\nStop treating `FalseEdges` and `FalseUnwind` as having semantic value for const eval\n\nThis change does not expose loops or conditions to stable const fns because we check those at the HIR level and in the regular const validity checks.\n\ncc @ecstatic-morse\n\nr? @eddyb", "tree": {"sha": "495ac7508e3e632dc876fb35218ebe48b455f53c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/495ac7508e3e632dc876fb35218ebe48b455f53c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd6a83875e4236966cb846236b243fd3ccaf56af", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeIl82CRBK7hj4Ov3rIwAAdHIIAKzvNcFKvRBHqluQl5m6+fNx\nrMS4TESdlT5hPE1HRH2bgFKPCjdTJLzwsCxQkgswJwgeZ+Q0L8/kkumVRcb17sNA\nyuzbL3zY6pfFRZUDPnjLdKc+5pf/0FiTQSWJ/ZkelOPyI3fYpv7f/rsO+A4lEXuX\n0ys7bY7an/NA5fdqTL6XL1X2MkK/LRgweH3Y7y1xWVJuV9s2ANPBmnWrmljmgKtp\nD6IkeAIMolso3djdfDi0mctqvCealYbjD3PyH1LcXAXbVR9F+4Bl0jAESwQgTIpI\nq/Xh4a2RBp8PL2Y6nk172qecXmnLSiBKf4RMXNXHOSDYNp/kh6qp9fuvg1wWrcA=\n=YKcz\n-----END PGP SIGNATURE-----\n", "payload": "tree 495ac7508e3e632dc876fb35218ebe48b455f53c\nparent 9d9c8c69e3a1206480a0382f22da24b6bb85e191\nparent cdc828e7f92c5835db4188f27cbdb7170d32c94e\nauthor Tyler Mandry <tmandry@gmail.com> 1579310902 -0800\ncommitter GitHub <noreply@github.com> 1579310902 -0800\n\nRollup merge of #68314 - oli-obk:true_unwind, r=eddyb\n\nStop treating `FalseEdges` and `FalseUnwind` as having semantic value for const eval\n\nThis change does not expose loops or conditions to stable const fns because we check those at the HIR level and in the regular const validity checks.\n\ncc @ecstatic-morse\n\nr? @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd6a83875e4236966cb846236b243fd3ccaf56af", "html_url": "https://github.com/rust-lang/rust/commit/dd6a83875e4236966cb846236b243fd3ccaf56af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd6a83875e4236966cb846236b243fd3ccaf56af/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d9c8c69e3a1206480a0382f22da24b6bb85e191", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d9c8c69e3a1206480a0382f22da24b6bb85e191", "html_url": "https://github.com/rust-lang/rust/commit/9d9c8c69e3a1206480a0382f22da24b6bb85e191"}, {"sha": "cdc828e7f92c5835db4188f27cbdb7170d32c94e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdc828e7f92c5835db4188f27cbdb7170d32c94e", "html_url": "https://github.com/rust-lang/rust/commit/cdc828e7f92c5835db4188f27cbdb7170d32c94e"}], "stats": {"total": 19, "additions": 6, "deletions": 13}, "files": [{"sha": "d927553c72e8b4afdc1bd9eb2b31ba70688d9555", "filename": "src/librustc_mir/transform/qualify_min_const_fn.rs", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/dd6a83875e4236966cb846236b243fd3ccaf56af/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd6a83875e4236966cb846236b243fd3ccaf56af/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs?ref=dd6a83875e4236966cb846236b243fd3ccaf56af", "patch": "@@ -309,21 +309,22 @@ fn check_terminator(\n ) -> McfResult {\n     let span = terminator.source_info.span;\n     match &terminator.kind {\n-        TerminatorKind::Goto { .. } | TerminatorKind::Return | TerminatorKind::Resume => Ok(()),\n+        TerminatorKind::FalseEdges { .. }\n+        | TerminatorKind::FalseUnwind { .. }\n+        | TerminatorKind::Goto { .. }\n+        | TerminatorKind::Return\n+        | TerminatorKind::Resume => Ok(()),\n \n         TerminatorKind::Drop { location, .. } => check_place(tcx, location, span, def_id, body),\n         TerminatorKind::DropAndReplace { location, value, .. } => {\n             check_place(tcx, location, span, def_id, body)?;\n             check_operand(tcx, value, span, def_id, body)\n         }\n \n-        TerminatorKind::FalseEdges { .. } | TerminatorKind::SwitchInt { .. }\n-            if !feature_allowed(tcx, def_id, sym::const_if_match) =>\n-        {\n+        TerminatorKind::SwitchInt { .. } if !feature_allowed(tcx, def_id, sym::const_if_match) => {\n             Err((span, \"loops and conditional expressions are not stable in const fn\".into()))\n         }\n \n-        TerminatorKind::FalseEdges { .. } => Ok(()),\n         TerminatorKind::SwitchInt { discr, switch_ty: _, values: _, targets: _ } => {\n             check_operand(tcx, discr, span, def_id, body)\n         }\n@@ -367,13 +368,5 @@ fn check_terminator(\n         TerminatorKind::Assert { cond, expected: _, msg: _, target: _, cleanup: _ } => {\n             check_operand(tcx, cond, span, def_id, body)\n         }\n-\n-        TerminatorKind::FalseUnwind { .. } if feature_allowed(tcx, def_id, sym::const_loop) => {\n-            Ok(())\n-        }\n-\n-        TerminatorKind::FalseUnwind { .. } => {\n-            Err((span, \"loops are not allowed in const fn\".into()))\n-        }\n     }\n }"}]}