{"sha": "d779062758d2a4da2a888752ec9b4ebf58a6c003", "node_id": "C_kwDOAAsO6NoAKGQ3NzkwNjI3NThkMmE0ZGEyYTg4ODc1MmVjOWI0ZWJmNThhNmMwMDM", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-12-01T13:22:29Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-12-01T13:22:29Z"}, "message": "Extend tests to cover runtime promotion cases, too", "tree": {"sha": "2fd524a29f1393ccc2216298030d8fc5c65f93f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fd524a29f1393ccc2216298030d8fc5c65f93f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d779062758d2a4da2a888752ec9b4ebf58a6c003", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d779062758d2a4da2a888752ec9b4ebf58a6c003", "html_url": "https://github.com/rust-lang/rust/commit/d779062758d2a4da2a888752ec9b4ebf58a6c003", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d779062758d2a4da2a888752ec9b4ebf58a6c003/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ec72dfe72cb4f37e1bf3794459d68ce234bab31", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ec72dfe72cb4f37e1bf3794459d68ce234bab31", "html_url": "https://github.com/rust-lang/rust/commit/9ec72dfe72cb4f37e1bf3794459d68ce234bab31"}], "stats": {"total": 112, "additions": 106, "deletions": 6}, "files": [{"sha": "cd71939f5619fcd3a9970e7df3a87f5b184cd0f2", "filename": "src/test/ui/consts/promoted_const_call.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.rs?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -9,4 +9,8 @@ pub const C: () = {\n     //~| ERROR: temporary value dropped while borrowed\n };\n \n-fn main() {}\n+fn main() {\n+    let _: &'static _ = &id(&Panic);\n+    //~^ ERROR: temporary value dropped while borrowed\n+    //~| ERROR: temporary value dropped while borrowed\n+}"}, {"sha": "502b432587fcf831ee7f007675e6945666f31f72", "filename": "src/test/ui/consts/promoted_const_call.stderr", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call.stderr?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -18,6 +18,26 @@ LL |     let _: &'static _ = &id(&Panic);\n    |            |                 creates a temporary value which is freed while still in use\n    |            type annotation requires that borrow lasts for `'static`\n \n-error: aborting due to 2 previous errors\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call.rs:13:26\n+   |\n+LL |     let _: &'static _ = &id(&Panic);\n+   |            ----------    ^^^^^^^^^^ creates a temporary value which is freed while still in use\n+   |            |\n+   |            type annotation requires that borrow lasts for `'static`\n+...\n+LL | }\n+   | - temporary value is freed at the end of this statement\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call.rs:13:30\n+   |\n+LL |     let _: &'static _ = &id(&Panic);\n+   |            ----------        ^^^^^ - temporary value is freed at the end of this statement\n+   |            |                 |\n+   |            |                 creates a temporary value which is freed while still in use\n+   |            type annotation requires that borrow lasts for `'static`\n+\n+error: aborting due to 4 previous errors\n \n For more information about this error, try `rustc --explain E0716`."}, {"sha": "f332cd18cea3743952cf0806812d0b788a3576e5", "filename": "src/test/ui/consts/promoted_const_call2.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.rs?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -7,4 +7,8 @@ pub const C: () = {\n     //~| ERROR: destructor of `String` cannot be evaluated at compile-time\n };\n \n-fn main() {}\n+fn main() {\n+    let _: &'static _ = &id(&String::new());\n+    //~^ ERROR: temporary value dropped while borrowed\n+    //~| ERROR: temporary value dropped while borrowed\n+}"}, {"sha": "13d864ed3dbbd05442363b20a8b38d3d45e6ee46", "filename": "src/test/ui/consts/promoted_const_call2.stderr", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call2.stderr?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -18,13 +18,33 @@ LL |     let _: &'static _ = &id(&String::new());\n    |            |                 creates a temporary value which is freed while still in use\n    |            type annotation requires that borrow lasts for `'static`\n \n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call2.rs:11:26\n+   |\n+LL |     let _: &'static _ = &id(&String::new());\n+   |            ----------    ^^^^^^^^^^^^^^^^^^ creates a temporary value which is freed while still in use\n+   |            |\n+   |            type annotation requires that borrow lasts for `'static`\n+...\n+LL | }\n+   | - temporary value is freed at the end of this statement\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call2.rs:11:30\n+   |\n+LL |     let _: &'static _ = &id(&String::new());\n+   |            ----------        ^^^^^^^^^^^^^ - temporary value is freed at the end of this statement\n+   |            |                 |\n+   |            |                 creates a temporary value which is freed while still in use\n+   |            type annotation requires that borrow lasts for `'static`\n+\n error[E0493]: destructor of `String` cannot be evaluated at compile-time\n   --> $DIR/promoted_const_call2.rs:4:30\n    |\n LL |     let _: &'static _ = &id(&String::new());\n    |                              ^^^^^^^^^^^^^ the destructor for this type cannot be evaluated in constants\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 5 previous errors\n \n Some errors have detailed explanations: E0493, E0716.\n For more information about an error, try `rustc --explain E0493`."}, {"sha": "6d68a2de70e471bc930a529b8a5c52ef4e34271d", "filename": "src/test/ui/consts/promoted_const_call3.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.rs?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -13,4 +13,14 @@ pub const C: () = {\n     //~^ ERROR: temporary value dropped while borrowed\n };\n \n-fn main() {}\n+fn main() {\n+    let _: &'static _ = &String::new();\n+    //~^ ERROR: temporary value dropped while borrowed\n+\n+    let _: &'static _ = &id(&String::new());\n+    //~^ ERROR: temporary value dropped while borrowed\n+    //~| ERROR: temporary value dropped while borrowed\n+\n+    let _: &'static _ = &std::mem::ManuallyDrop::new(String::new());\n+    //~^ ERROR: temporary value dropped while borrowed\n+}"}, {"sha": "af17457a10a1bcfae54c041e9c27e6356e6a2323", "filename": "src/test/ui/consts/promoted_const_call3.stderr", "status": "modified", "additions": 43, "deletions": 1, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d779062758d2a4da2a888752ec9b4ebf58a6c003/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fpromoted_const_call3.stderr?ref=d779062758d2a4da2a888752ec9b4ebf58a6c003", "patch": "@@ -57,7 +57,49 @@ LL |\n LL | };\n    | - temporary value is freed at the end of this statement\n \n-error: aborting due to 6 previous errors\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call3.rs:17:26\n+   |\n+LL |     let _: &'static _ = &String::new();\n+   |            ----------    ^^^^^^^^^^^^^ creates a temporary value which is freed while still in use\n+   |            |\n+   |            type annotation requires that borrow lasts for `'static`\n+...\n+LL | }\n+   | - temporary value is freed at the end of this statement\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call3.rs:20:26\n+   |\n+LL |     let _: &'static _ = &id(&String::new());\n+   |            ----------    ^^^^^^^^^^^^^^^^^^ creates a temporary value which is freed while still in use\n+   |            |\n+   |            type annotation requires that borrow lasts for `'static`\n+...\n+LL | }\n+   | - temporary value is freed at the end of this statement\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call3.rs:20:30\n+   |\n+LL |     let _: &'static _ = &id(&String::new());\n+   |            ----------        ^^^^^^^^^^^^^ - temporary value is freed at the end of this statement\n+   |            |                 |\n+   |            |                 creates a temporary value which is freed while still in use\n+   |            type annotation requires that borrow lasts for `'static`\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/promoted_const_call3.rs:24:26\n+   |\n+LL |     let _: &'static _ = &std::mem::ManuallyDrop::new(String::new());\n+   |            ----------    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ creates a temporary value which is freed while still in use\n+   |            |\n+   |            type annotation requires that borrow lasts for `'static`\n+LL |\n+LL | }\n+   | - temporary value is freed at the end of this statement\n+\n+error: aborting due to 10 previous errors\n \n Some errors have detailed explanations: E0493, E0716.\n For more information about an error, try `rustc --explain E0493`."}]}