{"sha": "3da40237e542e7859adab48049ec15cf18154817", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkYTQwMjM3ZTU0MmU3ODU5YWRhYjQ4MDQ5ZWMxNWNmMTgxNTQ4MTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-03-24T21:09:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-03-24T21:09:34Z"}, "message": "Auto merge of #40779 - arielb1:bad-arm, r=alexcrichton\n\nupdate LLVM with fix for PR32379\n\nFixes #40593.\n\nThe \"root\" codegen bug fixed here is that, when generating ARM code, unpatched LLVM 3.9/3.9.1 miscompiles bit operations in rare circumstances - this can cause user code compiled via LLVM (through both `rustc` and `clang`) to subtly return incorrect results - for more details, see the test in this PR or in the LLVM rare report.\n\nOne effect of that LLVM bug is that `rustc` 1.17 (and possibly other versions) is miscompiled on ARM. The code generated by a miscompiled `rustc` lacks destructor calls in many circumstances.\n\nUsers who run an affected/miscompiled `rustc` - 1.17 or above - on an ARM build machine will be affected by the (fairly blatant) missing destructor bug, regardless of the target architecture (this includes the official `1.17.0-beta.1`, `1.17.0-beta.2`, and some official 1.17/1.18 nightlies).\n\nUsers who use an affected LLVM (that's any unpatched LLVM 3.9/3.9.1), whether through `rustc` (in any version that supports 3.9 - that's 1.12 or above) or through `clang`, who compile code to an ARM target architecture might be affected by the (fairly hard to hit) bit operation bug, regardless of the build machine.\n\nDistributors and user who want to compile rustc using their own LLVM should apply the [patch](https://github.com/llvm-mirror/llvm/commit/cdc303e5ed4d3110e6f70931775a70bb1de44ed6) to avoid miscompilations.\n\nr? @alexcrichton\nBeta-nominating because regression (rustc 1.16 is not blatantly miscompiled). This also picks a fix for the (MSVC-affecting) PR29151.", "tree": {"sha": "b6ebb1c86934b3553c5700115868210413ed8e0f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6ebb1c86934b3553c5700115868210413ed8e0f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3da40237e542e7859adab48049ec15cf18154817", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3da40237e542e7859adab48049ec15cf18154817", "html_url": "https://github.com/rust-lang/rust/commit/3da40237e542e7859adab48049ec15cf18154817", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3da40237e542e7859adab48049ec15cf18154817/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7", "html_url": "https://github.com/rust-lang/rust/commit/8cf8fc9d8973a4d523c01dcba2ef991e0f2393d7"}, {"sha": "bd52ff1cc3ff9ecce129d20ed56c61ec0b0c5653", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd52ff1cc3ff9ecce129d20ed56c61ec0b0c5653", "html_url": "https://github.com/rust-lang/rust/commit/bd52ff1cc3ff9ecce129d20ed56c61ec0b0c5653"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "2e951c3ae354bcbd2e50b30798e232949a926b75", "filename": "src/llvm", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fllvm?ref=3da40237e542e7859adab48049ec15cf18154817", "patch": "@@ -1 +1 @@\n-Subproject commit d5ef27a79661d4f0d57d7b7d2cdbe9204f790a4a\n+Subproject commit 2e951c3ae354bcbd2e50b30798e232949a926b75"}, {"sha": "c8732e27b82528e9e988d4ebfe21385aa5d41c72", "filename": "src/rustllvm/llvm-rebuild-trigger", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3da40237e542e7859adab48049ec15cf18154817/src%2Frustllvm%2Fllvm-rebuild-trigger", "raw_url": "https://github.com/rust-lang/rust/raw/3da40237e542e7859adab48049ec15cf18154817/src%2Frustllvm%2Fllvm-rebuild-trigger", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2Fllvm-rebuild-trigger?ref=3da40237e542e7859adab48049ec15cf18154817", "patch": "@@ -1,4 +1,4 @@\n # If this file is modified, then llvm will be (optionally) cleaned and then rebuilt.\n # The actual contents of this file do not matter, but to trigger a change on the\n # build bots then the contents should be changed so git updates the mtime.\n-2017-03-19\n+2017-03-23"}, {"sha": "a7b15bda3362729777986b39d70526755f5c1750", "filename": "src/test/run-pass/auxiliary/llvm_pr32379.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/3da40237e542e7859adab48049ec15cf18154817/src%2Ftest%2Frun-pass%2Fauxiliary%2Fllvm_pr32379.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3da40237e542e7859adab48049ec15cf18154817/src%2Ftest%2Frun-pass%2Fauxiliary%2Fllvm_pr32379.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fauxiliary%2Fllvm_pr32379.rs?ref=3da40237e542e7859adab48049ec15cf18154817", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+pub fn pr32379(mut data: u64, f1: bool, f2: bool) -> u64 {\n+    if f1 { data &= !2; }\n+    if f2 { data |= 2; }\n+    data\n+}"}, {"sha": "5625e81c0e63ca8c3fba2bda21cd0647e5aeb97c", "filename": "src/test/run-pass/llvm-pr32379.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/3da40237e542e7859adab48049ec15cf18154817/src%2Ftest%2Frun-pass%2Fllvm-pr32379.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3da40237e542e7859adab48049ec15cf18154817/src%2Ftest%2Frun-pass%2Fllvm-pr32379.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fllvm-pr32379.rs?ref=3da40237e542e7859adab48049ec15cf18154817", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:llvm_pr32379.rs\n+\n+// LLVM PR #32379 (https://bugs.llvm.org/show_bug.cgi?id=32379), which\n+// applies to upstream LLVM 3.9.1, is known to cause rustc itself to be\n+// miscompiled on ARM (Rust issue #40593). Because cross builds don't test\n+// our *compiler* on ARM, have a test for the miscompilation directly.\n+\n+extern crate llvm_pr32379;\n+\n+pub fn main() {\n+    let val = llvm_pr32379::pr32379(2, false, false);\n+    assert_eq!(val, 2);\n+}"}]}