{"sha": "91efb2a67f387773750b4ebc2290f16b14bf8e13", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxZWZiMmE2N2YzODc3NzM3NTBiNGViYzIyOTBmMTZiMTRiZjhlMTM=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@gmail", "date": "2013-12-13T16:46:10Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@gmail", "date": "2013-12-16T09:23:28Z"}, "message": "debuginfo: Set correct source position for function calls.", "tree": {"sha": "84aec455fb869f1221c1c516df9176646bb14b59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84aec455fb869f1221c1c516df9176646bb14b59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91efb2a67f387773750b4ebc2290f16b14bf8e13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91efb2a67f387773750b4ebc2290f16b14bf8e13", "html_url": "https://github.com/rust-lang/rust/commit/91efb2a67f387773750b4ebc2290f16b14bf8e13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91efb2a67f387773750b4ebc2290f16b14bf8e13/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b0100c5a0f43b5a2fadf839d90b6174dbddd0547", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0100c5a0f43b5a2fadf839d90b6174dbddd0547", "html_url": "https://github.com/rust-lang/rust/commit/b0100c5a0f43b5a2fadf839d90b6174dbddd0547"}], "stats": {"total": 26, "additions": 21, "deletions": 5}, "files": [{"sha": "abb3e22edb72dd6b59b5b695e22f8292665ba990", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=91efb2a67f387773750b4ebc2290f16b14bf8e13", "patch": "@@ -875,8 +875,11 @@ pub fn trans_external_path(ccx: &mut CrateContext, did: ast::DefId, t: ty::t) ->\n     }\n }\n \n-pub fn invoke(bcx: @mut Block, llfn: ValueRef, llargs: ~[ValueRef],\n-              attributes: &[(uint, lib::llvm::Attribute)])\n+pub fn invoke(bcx: @mut Block,\n+              llfn: ValueRef,\n+              llargs: ~[ValueRef],\n+              attributes: &[(uint, lib::llvm::Attribute)],\n+              call_info: Option<NodeInfo>)\n            -> (ValueRef, @mut Block) {\n     let _icx = push_ctxt(\"invoke_\");\n     if bcx.unreachable {\n@@ -899,11 +902,18 @@ pub fn invoke(bcx: @mut Block, llfn: ValueRef, llargs: ~[ValueRef],\n             }\n         }\n         let normal_bcx = sub_block(bcx, \"normal return\");\n+        let landing_pad = get_landing_pad(bcx);\n+\n+        match call_info {\n+            Some(info) => debuginfo::set_source_location(bcx.fcx, info.id, info.span),\n+            None => debuginfo::clear_source_location(bcx.fcx)\n+        };\n+\n         let llresult = Invoke(bcx,\n                               llfn,\n                               llargs,\n                               normal_bcx.llbb,\n-                              get_landing_pad(bcx),\n+                              landing_pad,\n                               attributes);\n         return (llresult, normal_bcx);\n     } else {\n@@ -913,6 +923,12 @@ pub fn invoke(bcx: @mut Block, llfn: ValueRef, llargs: ~[ValueRef],\n                 debug!(\"arg: {}\", llarg);\n             }\n         }\n+\n+        match call_info {\n+            Some(info) => debuginfo::set_source_location(bcx.fcx, info.id, info.span),\n+            None => debuginfo::clear_source_location(bcx.fcx)\n+        };\n+\n         let llresult = Call(bcx, llfn, llargs, attributes);\n         return (llresult, bcx);\n     }"}, {"sha": "db193b9200ae12cf0883f50bd493647dff6cbb67", "filename": "src/librustc/middle/trans/callee.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs?ref=91efb2a67f387773750b4ebc2290f16b14bf8e13", "patch": "@@ -697,7 +697,7 @@ pub fn trans_call_inner(in_cx: @mut Block,\n             }\n \n             // Invoke the actual rust fn and update bcx/llresult.\n-            let (llret, b) = base::invoke(bcx, llfn, llargs, attrs);\n+            let (llret, b) = base::invoke(bcx, llfn, llargs, attrs, call_info);\n             bcx = b;\n             llresult = llret;\n "}, {"sha": "acbe2d13d12d0744ef78acb9a0c8f9936902d621", "filename": "src/librustc/middle/trans/glue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91efb2a67f387773750b4ebc2290f16b14bf8e13/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fglue.rs?ref=91efb2a67f387773750b4ebc2290f16b14bf8e13", "patch": "@@ -429,7 +429,7 @@ pub fn trans_struct_drop(bcx: @mut Block, t: ty::t, v0: ValueRef, dtor_did: ast:\n             add_clean(bcx, llfld_a, fld.mt.ty);\n         }\n \n-        let (_, bcx) = invoke(bcx, dtor_addr, args, []);\n+        let (_, bcx) = invoke(bcx, dtor_addr, args, [], None);\n         bcx\n     })\n }"}]}