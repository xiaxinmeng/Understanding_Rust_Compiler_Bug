{"sha": "b7a6d830beaa2669f6ddff3167eb94b941e73339", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3YTZkODMwYmVhYTI2NjlmNmRkZmYzMTY3ZWI5NGI5NDFlNzMzMzk=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-16T14:16:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-16T14:16:47Z"}, "message": "Merge #7687\n\n7687: Specialization for async traits r=matklad a=arnaudgolfouse\n\nFixes #7669.\r\n\r\nAdapting the parser seemed to be all that was needed, but I am not very experienced with the codebase. Is this enough ?\n\nCo-authored-by: Arnaud <arnaud.golfouse@laposte.net>", "tree": {"sha": "623696cb6b985de75ddcf3809feba421a19128c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/623696cb6b985de75ddcf3809feba421a19128c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7a6d830beaa2669f6ddff3167eb94b941e73339", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgK9PPCRBK7hj4Ov3rIwAAdHIIALJ3N7f0cS9Kp/ZuyKFqpbhf\nWfEz2ToGGnuZiS6+pcdyfIV/PiF0PyBIvIMLI1Lko2g4JD7JdzZ/QQ+FzEoH+D5w\nSQqATqwVv+rkwatqzdmlhDzw2rclyyTe9go8BQjgbgUFE1bzg1OQZaZNwUehnvse\nGOAUgJNdofxRMTOn6FIgwR8tKw1730C2xh+RtXsSaXJsS5iNFCaopVIZvIwudF86\nfB3TfhoFeJnIgvNuAVVZQAPkd+qSswdDCU1KiK08d/E5jG6/IpV5uMNmnTdseFw4\n/7fB7XtuG/cfMs+H42KnVI1xcgKwjYJZQv5KtYL97rqOnZTYYcW1jwVySK9mMt0=\n=uLwI\n-----END PGP SIGNATURE-----\n", "payload": "tree 623696cb6b985de75ddcf3809feba421a19128c6\nparent 88e8b0a5fa17075475c75941932056f7289c5bcf\nparent 95d239da99cb1b7ba60f5f20f6df54e1397a1bca\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1613485007 +0000\ncommitter GitHub <noreply@github.com> 1613485007 +0000\n\nMerge #7687\n\n7687: Specialization for async traits r=matklad a=arnaudgolfouse\n\nFixes #7669.\r\n\r\nAdapting the parser seemed to be all that was needed, but I am not very experienced with the codebase. Is this enough ?\n\nCo-authored-by: Arnaud <arnaud.golfouse@laposte.net>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7a6d830beaa2669f6ddff3167eb94b941e73339", "html_url": "https://github.com/rust-lang/rust/commit/b7a6d830beaa2669f6ddff3167eb94b941e73339", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7a6d830beaa2669f6ddff3167eb94b941e73339/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88e8b0a5fa17075475c75941932056f7289c5bcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/88e8b0a5fa17075475c75941932056f7289c5bcf", "html_url": "https://github.com/rust-lang/rust/commit/88e8b0a5fa17075475c75941932056f7289c5bcf"}, {"sha": "95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "url": "https://api.github.com/repos/rust-lang/rust/commits/95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "html_url": "https://github.com/rust-lang/rust/commit/95d239da99cb1b7ba60f5f20f6df54e1397a1bca"}], "stats": {"total": 116, "additions": 116, "deletions": 0}, "files": [{"sha": "adec74ef3dc2a54c93ae72bc794dca68814b8f27", "filename": "crates/parser/src/grammar/items.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs?ref=b7a6d830beaa2669f6ddff3167eb94b941e73339", "patch": "@@ -83,6 +83,7 @@ pub(super) fn item_or_macro(p: &mut Parser, stop_on_r_curly: bool) {\n     }\n }\n \n+/// Try to parse an item, completing `m` in case of success.\n pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n     // test_err pub_expr\n     // fn foo() { pub 92; }\n@@ -143,6 +144,33 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n                     has_mods = true;\n                 }\n             }\n+            T![async] => {\n+                // test default_async_fn\n+                // impl T for Foo {\n+                //     default async fn foo() {}\n+                // }\n+\n+                // test default_async_unsafe_fn\n+                // impl T for Foo {\n+                //     default async unsafe fn foo() {}\n+                // }\n+                let mut maybe_fn = p.nth(2);\n+                let is_unsafe = if matches!(maybe_fn, T![unsafe]) {\n+                    maybe_fn = p.nth(3);\n+                    true\n+                } else {\n+                    false\n+                };\n+\n+                if matches!(maybe_fn, T![fn]) {\n+                    p.bump_remap(T![default]);\n+                    p.bump(T![async]);\n+                    if is_unsafe {\n+                        p.bump(T![unsafe])\n+                    }\n+                    has_mods = true;\n+                }\n+            }\n             _ => (),\n         }\n     }"}, {"sha": "61c17333a4cba8fee5003f2653cd0e2ce85fd5db", "filename": "crates/syntax/test_data/parser/inline/ok/0162_default_async_unsafe_fn.rast", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast", "raw_url": "https://github.com/rust-lang/rust/raw/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast?ref=b7a6d830beaa2669f6ddff3167eb94b941e73339", "patch": "@@ -0,0 +1,42 @@\n+SOURCE_FILE@0..56\n+  IMPL@0..55\n+    IMPL_KW@0..4 \"impl\"\n+    WHITESPACE@4..5 \" \"\n+    PATH_TYPE@5..6\n+      PATH@5..6\n+        PATH_SEGMENT@5..6\n+          NAME_REF@5..6\n+            IDENT@5..6 \"T\"\n+    WHITESPACE@6..7 \" \"\n+    FOR_KW@7..10 \"for\"\n+    WHITESPACE@10..11 \" \"\n+    PATH_TYPE@11..14\n+      PATH@11..14\n+        PATH_SEGMENT@11..14\n+          NAME_REF@11..14\n+            IDENT@11..14 \"Foo\"\n+    WHITESPACE@14..15 \" \"\n+    ASSOC_ITEM_LIST@15..55\n+      L_CURLY@15..16 \"{\"\n+      WHITESPACE@16..21 \"\\n    \"\n+      FN@21..53\n+        DEFAULT_KW@21..28 \"default\"\n+        WHITESPACE@28..29 \" \"\n+        ASYNC_KW@29..34 \"async\"\n+        WHITESPACE@34..35 \" \"\n+        UNSAFE_KW@35..41 \"unsafe\"\n+        WHITESPACE@41..42 \" \"\n+        FN_KW@42..44 \"fn\"\n+        WHITESPACE@44..45 \" \"\n+        NAME@45..48\n+          IDENT@45..48 \"foo\"\n+        PARAM_LIST@48..50\n+          L_PAREN@48..49 \"(\"\n+          R_PAREN@49..50 \")\"\n+        WHITESPACE@50..51 \" \"\n+        BLOCK_EXPR@51..53\n+          L_CURLY@51..52 \"{\"\n+          R_CURLY@52..53 \"}\"\n+      WHITESPACE@53..54 \"\\n\"\n+      R_CURLY@54..55 \"}\"\n+  WHITESPACE@55..56 \"\\n\""}, {"sha": "05c20a68fe827f07cea6e08bbf66b4b952237516", "filename": "crates/syntax/test_data/parser/inline/ok/0162_default_async_unsafe_fn.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs?ref=b7a6d830beaa2669f6ddff3167eb94b941e73339", "patch": "@@ -0,0 +1,3 @@\n+impl T for Foo {\n+    default async unsafe fn foo() {}\n+}"}, {"sha": "9c43ccea5251f3fe8ad19e28263f427bbafb88e4", "filename": "crates/syntax/test_data/parser/inline/ok/0163_default_async_fn.rast", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast", "raw_url": "https://github.com/rust-lang/rust/raw/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast?ref=b7a6d830beaa2669f6ddff3167eb94b941e73339", "patch": "@@ -0,0 +1,40 @@\n+SOURCE_FILE@0..49\n+  IMPL@0..48\n+    IMPL_KW@0..4 \"impl\"\n+    WHITESPACE@4..5 \" \"\n+    PATH_TYPE@5..6\n+      PATH@5..6\n+        PATH_SEGMENT@5..6\n+          NAME_REF@5..6\n+            IDENT@5..6 \"T\"\n+    WHITESPACE@6..7 \" \"\n+    FOR_KW@7..10 \"for\"\n+    WHITESPACE@10..11 \" \"\n+    PATH_TYPE@11..14\n+      PATH@11..14\n+        PATH_SEGMENT@11..14\n+          NAME_REF@11..14\n+            IDENT@11..14 \"Foo\"\n+    WHITESPACE@14..15 \" \"\n+    ASSOC_ITEM_LIST@15..48\n+      L_CURLY@15..16 \"{\"\n+      WHITESPACE@16..21 \"\\n    \"\n+      FN@21..46\n+        DEFAULT_KW@21..28 \"default\"\n+        WHITESPACE@28..29 \" \"\n+        ASYNC_KW@29..34 \"async\"\n+        WHITESPACE@34..35 \" \"\n+        FN_KW@35..37 \"fn\"\n+        WHITESPACE@37..38 \" \"\n+        NAME@38..41\n+          IDENT@38..41 \"foo\"\n+        PARAM_LIST@41..43\n+          L_PAREN@41..42 \"(\"\n+          R_PAREN@42..43 \")\"\n+        WHITESPACE@43..44 \" \"\n+        BLOCK_EXPR@44..46\n+          L_CURLY@44..45 \"{\"\n+          R_CURLY@45..46 \"}\"\n+      WHITESPACE@46..47 \"\\n\"\n+      R_CURLY@47..48 \"}\"\n+  WHITESPACE@48..49 \"\\n\""}, {"sha": "78c3b4d85fb28ab5465cd6f718087603d808e13a", "filename": "crates/syntax/test_data/parser/inline/ok/0163_default_async_fn.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a6d830beaa2669f6ddff3167eb94b941e73339/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs?ref=b7a6d830beaa2669f6ddff3167eb94b941e73339", "patch": "@@ -0,0 +1,3 @@\n+impl T for Foo {\n+    default async fn foo() {}\n+}"}]}