{"sha": "44900f823696a04a7512be538c4994c148ecbef7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0OTAwZjgyMzY5NmEwNGE3NTEyYmU1MzhjNDk5NGMxNDhlY2JlZjc=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-06-23T07:34:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-23T07:34:06Z"}, "message": "Rollup merge of #73590 - davidtwco:bootstrap-fix-config-env-var, r=Mark-Simulacrum\n\nbootstrap: no `config.toml` exists regression\n\nFixes #73574.\n\nThis PR fixes a regression introduced in #73317 where an oversight meant that `config.toml` was assumed to exist.", "tree": {"sha": "c5ebbaf8584177b43c475bd36c4639323e7d4dbd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c5ebbaf8584177b43c475bd36c4639323e7d4dbd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44900f823696a04a7512be538c4994c148ecbef7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe8bBvCRBK7hj4Ov3rIwAAdHIIAFFNmy5+zARa3rpGJmLhPKGP\nSJtidTSPOjinLJLUoUT1gfjP5MLj83QbnLBKZQSMKar1HGbr57m0ddNqaLcF9Rln\nRrBShMzrLHZgowsqCeZ2lficqTpjhYFSjpBmz2UlPrI5ymu5dm1h+0GBjDCa8zcK\n098ITZM+qCEJNS/nI5d+4+8OeB4DqSftcW9/NaR6sP0uTewtN6MZZgFP+VT+Kutc\nVdM5InF+PwKzOzhUbQGhWSilMrSXd8s93YagQlgApU5PSi6MSDjb65SxCoVnR49p\nCf2rq5GQ+rQcPVZDMZzIqH3AZ4NVd6fBqeXld1XcbweSZ6v4rAoJNqhnBEAT6yg=\n=VmB2\n-----END PGP SIGNATURE-----\n", "payload": "tree c5ebbaf8584177b43c475bd36c4639323e7d4dbd\nparent 84bd1e776b9593b3cb7c5e503483b56ebe01dba1\nparent b60ec47a0694b6eb10bdafc2aa28f877473f61d5\nauthor Manish Goregaokar <manishsmail@gmail.com> 1592897646 -0700\ncommitter GitHub <noreply@github.com> 1592897646 -0700\n\nRollup merge of #73590 - davidtwco:bootstrap-fix-config-env-var, r=Mark-Simulacrum\n\nbootstrap: no `config.toml` exists regression\n\nFixes #73574.\n\nThis PR fixes a regression introduced in #73317 where an oversight meant that `config.toml` was assumed to exist.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44900f823696a04a7512be538c4994c148ecbef7", "html_url": "https://github.com/rust-lang/rust/commit/44900f823696a04a7512be538c4994c148ecbef7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44900f823696a04a7512be538c4994c148ecbef7/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84bd1e776b9593b3cb7c5e503483b56ebe01dba1", "url": "https://api.github.com/repos/rust-lang/rust/commits/84bd1e776b9593b3cb7c5e503483b56ebe01dba1", "html_url": "https://github.com/rust-lang/rust/commit/84bd1e776b9593b3cb7c5e503483b56ebe01dba1"}, {"sha": "b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/b60ec47a0694b6eb10bdafc2aa28f877473f61d5", "html_url": "https://github.com/rust-lang/rust/commit/b60ec47a0694b6eb10bdafc2aa28f877473f61d5"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "82a755c7892b13d1652de7c616a298499230a444", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/44900f823696a04a7512be538c4994c148ecbef7/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/44900f823696a04a7512be538c4994c148ecbef7/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=44900f823696a04a7512be538c4994c148ecbef7", "patch": "@@ -893,15 +893,18 @@ def bootstrap(help_triggered):\n     build.verbose = args.verbose\n     build.clean = args.clean\n \n-    try:\n-        toml_path = os.getenv('RUST_BOOTSTRAP_CONFIG') or args.config or 'config.toml'\n+    # Read from `RUST_BOOTSTRAP_CONFIG`, then `--config`, then fallback to `config.toml` (if it\n+    # exists).\n+    toml_path = os.getenv('RUST_BOOTSTRAP_CONFIG') or args.config\n+    if not toml_path and os.path.exists('config.toml'):\n+        toml_path = 'config.toml'\n+\n+    if toml_path:\n         if not os.path.exists(toml_path):\n             toml_path = os.path.join(build.rust_root, toml_path)\n \n         with open(toml_path) as config:\n             build.config_toml = config.read()\n-    except (OSError, IOError):\n-        pass\n \n     config_verbose = build.get_toml('verbose', 'build')\n     if config_verbose is not None:\n@@ -947,11 +950,12 @@ def bootstrap(help_triggered):\n     env[\"SRC\"] = build.rust_root\n     env[\"BOOTSTRAP_PARENT_ID\"] = str(os.getpid())\n     env[\"BOOTSTRAP_PYTHON\"] = sys.executable\n-    env[\"BOOTSTRAP_CONFIG\"] = toml_path\n     env[\"BUILD_DIR\"] = build.build_dir\n     env[\"RUSTC_BOOTSTRAP\"] = '1'\n     env[\"CARGO\"] = build.cargo()\n     env[\"RUSTC\"] = build.rustc()\n+    if toml_path:\n+        env[\"BOOTSTRAP_CONFIG\"] = toml_path\n     if build.rustfmt():\n         env[\"RUSTFMT\"] = build.rustfmt()\n     run(args, env=env, verbose=build.verbose)"}]}