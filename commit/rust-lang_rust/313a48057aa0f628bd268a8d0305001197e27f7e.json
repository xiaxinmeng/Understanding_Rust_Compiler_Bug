{"sha": "313a48057aa0f628bd268a8d0305001197e27f7e", "node_id": "C_kwDOAAsO6NoAKDMxM2E0ODA1N2FhMGY2MjhiZDI2OGE4ZDAzMDUwMDExOTdlMjdmN2U", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-09T08:45:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-09T08:45:18Z"}, "message": "Auto merge of #14110 - dqkqd:auto-completion-for-missing-body, r=Veykril\n\nAdd completion for function without body\n\nFix #13802", "tree": {"sha": "6f1e35e12420217ca7e27d6a2d377b7e3be504ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f1e35e12420217ca7e27d6a2d377b7e3be504ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/313a48057aa0f628bd268a8d0305001197e27f7e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/313a48057aa0f628bd268a8d0305001197e27f7e", "html_url": "https://github.com/rust-lang/rust/commit/313a48057aa0f628bd268a8d0305001197e27f7e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/313a48057aa0f628bd268a8d0305001197e27f7e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eaed19c5399064393e846ad5dddd7b0b290d2582", "url": "https://api.github.com/repos/rust-lang/rust/commits/eaed19c5399064393e846ad5dddd7b0b290d2582", "html_url": "https://github.com/rust-lang/rust/commit/eaed19c5399064393e846ad5dddd7b0b290d2582"}, {"sha": "74cd8ecc7ebe2782044f6b91ea94f0ac95b9fefa", "url": "https://api.github.com/repos/rust-lang/rust/commits/74cd8ecc7ebe2782044f6b91ea94f0ac95b9fefa", "html_url": "https://github.com/rust-lang/rust/commit/74cd8ecc7ebe2782044f6b91ea94f0ac95b9fefa"}], "stats": {"total": 57, "additions": 54, "deletions": 3}, "files": [{"sha": "4bff665ab1d770815e1502f1a87772c753bd1b13", "filename": "crates/ide-completion/src/context/analysis.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/313a48057aa0f628bd268a8d0305001197e27f7e/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/313a48057aa0f628bd268a8d0305001197e27f7e/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Fcontext%2Fanalysis.rs?ref=313a48057aa0f628bd268a8d0305001197e27f7e", "patch": "@@ -675,10 +675,10 @@ fn classify_name_ref(\n         {\n             if let Some(item) = ast::Item::cast(n) {\n                 let is_inbetween = match &item {\n-                    ast::Item::Const(it) => it.body().is_none(),\n+                    ast::Item::Const(it) => it.body().is_none() && it.semicolon_token().is_none(),\n                     ast::Item::Enum(it) => it.variant_list().is_none(),\n                     ast::Item::ExternBlock(it) => it.extern_item_list().is_none(),\n-                    ast::Item::Fn(it) => it.body().is_none(),\n+                    ast::Item::Fn(it) => it.body().is_none() && it.semicolon_token().is_none(),\n                     ast::Item::Impl(it) => it.assoc_item_list().is_none(),\n                     ast::Item::Module(it) => {\n                         it.item_list().is_none() && it.semicolon_token().is_none()\n@@ -688,7 +688,7 @@ fn classify_name_ref(\n                         it.field_list().is_none() && it.semicolon_token().is_none()\n                     }\n                     ast::Item::Trait(it) => it.assoc_item_list().is_none(),\n-                    ast::Item::TypeAlias(it) => it.ty().is_none(),\n+                    ast::Item::TypeAlias(it) => it.ty().is_none() && it.semicolon_token().is_none(),\n                     ast::Item::Union(it) => it.record_field_list().is_none(),\n                     _ => false,\n                 };"}, {"sha": "9fc731bb11d576604604c335e975244888a45cfe", "filename": "crates/ide-completion/src/tests/item_list.rs", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/313a48057aa0f628bd268a8d0305001197e27f7e/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/313a48057aa0f628bd268a8d0305001197e27f7e/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-completion%2Fsrc%2Ftests%2Fitem_list.rs?ref=313a48057aa0f628bd268a8d0305001197e27f7e", "patch": "@@ -214,6 +214,57 @@ fn in_trait_assoc_item_list() {\n     );\n }\n \n+#[test]\n+fn in_trait_assoc_fn_missing_body() {\n+    check(\n+        r#\"trait Foo { fn function(); $0 }\"#,\n+        expect![[r#\"\n+            ma makro!(\u2026) macro_rules! makro\n+            md module\n+            kw const\n+            kw crate::\n+            kw fn\n+            kw self::\n+            kw type\n+            kw unsafe\n+        \"#]],\n+    );\n+}\n+\n+#[test]\n+fn in_trait_assoc_const_missing_body() {\n+    check(\n+        r#\"trait Foo { const CONST: (); $0 }\"#,\n+        expect![[r#\"\n+            ma makro!(\u2026) macro_rules! makro\n+            md module\n+            kw const\n+            kw crate::\n+            kw fn\n+            kw self::\n+            kw type\n+            kw unsafe\n+        \"#]],\n+    );\n+}\n+\n+#[test]\n+fn in_trait_assoc_type_aliases_missing_ty() {\n+    check(\n+        r#\"trait Foo { type Type; $0 }\"#,\n+        expect![[r#\"\n+            ma makro!(\u2026) macro_rules! makro\n+            md module\n+            kw const\n+            kw crate::\n+            kw fn\n+            kw self::\n+            kw type\n+            kw unsafe\n+        \"#]],\n+    );\n+}\n+\n #[test]\n fn in_trait_impl_assoc_item_list() {\n     check("}]}