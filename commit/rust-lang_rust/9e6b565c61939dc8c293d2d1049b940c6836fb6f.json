{"sha": "9e6b565c61939dc8c293d2d1049b940c6836fb6f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNmI1NjVjNjE5MzlkYzhjMjkzZDJkMTA0OWI5NDBjNjgzNmZiNmY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-09T16:16:21Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-09T16:27:17Z"}, "message": "Rollup merge of #45051 - k0pernicus:master, r=michaelwoerister\n\nDebugger pretty printer files are take into account in test execution time-stamping\n\nThis PR is proposed to solve the issue #45022.", "tree": {"sha": "8a736ed1ab9b3e15923e08e5494a6b4364a47d53", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a736ed1ab9b3e15923e08e5494a6b4364a47d53"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e6b565c61939dc8c293d2d1049b940c6836fb6f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlnbo2YACgkQ/vbIBR0O\nATyFSQ//QQb/YpqcxE3UBMDAodYta7PbApw221W8WD21l1K+rLQtnzzjAq5tp+4I\nl0Pz1OtsR28eOrxEm5MZ/fD6JD8pOF2sTBh+XRNgXr5ysoVBn1QrruW9t4VWu33d\nWKkBAX+lrttcszcAihC5GZbMXxNwAbQzq57qUcruqajSb/bG2c67oR0aEx56sDd4\nZeDTsqpgQTHBFIafgB76etXSxmqPaTVX/hqNS8Hc+sUt/44LBDyTwkxtfEGNc6v4\nmUB5CnFxm+O33C3GEZK39UJC86uu6vSBt98Rkc0FN37SkoZP3a8GpDcP+6cPfhOo\nhIM/bb7qprr/67kPAL6Vi6GvFt7Cre5mnwqX6YD6bVwM4s4WzXj0PvSGK3gyQmCd\nIY/xtTPd+uI1dJgmZRNrRB5FN4PNNcLSqJw6w1mDNrtYE8n29M44akRKT+oJQoP7\ndBOBHsX9UIfpAabCNtLcB8xEJDTdZeFoxiQpRhn0xelRkotcrQoDvO2G9PWQT6JM\nCQuBC4gf+KaByq5F9BVbS/glBkxqkLT/dnu0d59vA/bxt3yWAwSUIskSXfG9qGGp\nCUV9AnveZKAMvpae3dmfGHelLFWz2hv9RvzicYLiERfgahm3bq5L++eQHmJdU0xi\nHQOHSVDqMVYasUy5rMYw+M/SjM37M0cUVrv2VGSKxA2jqz2py+Q=\n=1Ow8\n-----END PGP SIGNATURE-----", "payload": "tree 8a736ed1ab9b3e15923e08e5494a6b4364a47d53\nparent dad731cc80b97adf452d9ce8a02c0771a93cb1aa\nparent 53a648522b0263aa13752b78c9e27464d6caf579\nauthor kennytm <kennytm@gmail.com> 1507565781 +0800\ncommitter kennytm <kennytm@gmail.com> 1507566437 +0800\n\nRollup merge of #45051 - k0pernicus:master, r=michaelwoerister\n\nDebugger pretty printer files are take into account in test execution time-stamping\n\nThis PR is proposed to solve the issue #45022.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e6b565c61939dc8c293d2d1049b940c6836fb6f", "html_url": "https://github.com/rust-lang/rust/commit/9e6b565c61939dc8c293d2d1049b940c6836fb6f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e6b565c61939dc8c293d2d1049b940c6836fb6f/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dad731cc80b97adf452d9ce8a02c0771a93cb1aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/dad731cc80b97adf452d9ce8a02c0771a93cb1aa", "html_url": "https://github.com/rust-lang/rust/commit/dad731cc80b97adf452d9ce8a02c0771a93cb1aa"}, {"sha": "53a648522b0263aa13752b78c9e27464d6caf579", "url": "https://api.github.com/repos/rust-lang/rust/commits/53a648522b0263aa13752b78c9e27464d6caf579", "html_url": "https://github.com/rust-lang/rust/commit/53a648522b0263aa13752b78c9e27464d6caf579"}], "stats": {"total": 76, "additions": 47, "deletions": 29}, "files": [{"sha": "191958387912e811f29114e0443b05a01a2f5f3e", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=9e6b565c61939dc8c293d2d1049b940c6836fb6f", "patch": "@@ -567,6 +567,19 @@ impl Config {\n             None\n         }\n     }\n+\n+    pub fn find_rust_src_root(&self) -> Option<PathBuf> {\n+        let mut path = self.src_base.clone();\n+        let path_postfix = Path::new(\"src/etc/lldb_batchmode.py\");\n+\n+        while path.pop() {\n+            if path.join(&path_postfix).is_file() {\n+                return Some(path);\n+            }\n+        }\n+\n+        None\n+    }\n }\n \n pub fn lldb_version_to_int(version_string: &str) -> isize {"}, {"sha": "306497da9e3f9df5d2cd67b7f1502ae97c6050b1", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=9e6b565c61939dc8c293d2d1049b940c6836fb6f", "patch": "@@ -489,15 +489,28 @@ fn stamp(config: &Config, testpaths: &TestPaths) -> PathBuf {\n }\n \n fn up_to_date(config: &Config, testpaths: &TestPaths, props: &EarlyProps) -> bool {\n+    let rust_src_dir = config.find_rust_src_root().expect(\n+        \"Could not find Rust source root\",\n+    );\n     let stamp = mtime(&stamp(config, testpaths));\n-    let mut inputs = vec![\n-        mtime(&testpaths.file),\n-        mtime(&config.rustc_path),\n-    ];\n+    let mut inputs = vec![mtime(&testpaths.file), mtime(&config.rustc_path)];\n     for aux in props.aux.iter() {\n-        inputs.push(mtime(&testpaths.file.parent().unwrap()\n-                                         .join(\"auxiliary\")\n-                                         .join(aux)));\n+        inputs.push(mtime(\n+            &testpaths.file.parent().unwrap().join(\"auxiliary\").join(\n+                aux,\n+            ),\n+        ));\n+    }\n+    // Relevant pretty printer files\n+    let pretty_printer_files = [\n+        \"src/etc/debugger_pretty_printers_common.py\",\n+        \"src/etc/gdb_load_rust_pretty_printers.py\",\n+        \"src/etc/gdb_rust_pretty_printing.py\",\n+        \"src/etc/lldb_batchmode.py\",\n+        \"src/etc/lldb_rust_formatters.py\",\n+    ];\n+    for pretty_printer_file in &pretty_printer_files {\n+        inputs.push(mtime(&rust_src_dir.join(pretty_printer_file)));\n     }\n     for lib in config.run_lib_path.read_dir().unwrap() {\n         let lib = lib.unwrap();"}, {"sha": "870e08cc6e595b59269e43b3454c00f50b4f8734", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 14, "deletions": 22, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6b565c61939dc8c293d2d1049b940c6836fb6f/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=9e6b565c61939dc8c293d2d1049b940c6836fb6f", "patch": "@@ -571,9 +571,10 @@ actual:\\n\\\n                 }\n             }\n \n-            _=> {\n-                let rust_src_root = self.find_rust_src_root()\n-                                        .expect(\"Could not find Rust source root\");\n+            _ => {\n+                let rust_src_root = self.config.find_rust_src_root().expect(\n+                    \"Could not find Rust source root\",\n+                );\n                 let rust_pp_module_rel_path = Path::new(\"./src/etc\");\n                 let rust_pp_module_abs_path = rust_src_root.join(rust_pp_module_rel_path)\n                                                            .to_str()\n@@ -664,19 +665,6 @@ actual:\\n\\\n         self.check_debugger_output(&debugger_run_result, &check_lines);\n     }\n \n-    fn find_rust_src_root(&self) -> Option<PathBuf> {\n-        let mut path = self.config.src_base.clone();\n-        let path_postfix = Path::new(\"src/etc/lldb_batchmode.py\");\n-\n-        while path.pop() {\n-            if path.join(&path_postfix).is_file() {\n-                return Some(path);\n-            }\n-        }\n-\n-        None\n-    }\n-\n     fn run_debuginfo_lldb_test(&self) {\n         assert!(self.revision.is_none(), \"revisions not relevant here\");\n \n@@ -735,7 +723,9 @@ actual:\\n\\\n         script_str.push_str(\"version\\n\");\n \n         // Switch LLDB into \"Rust mode\"\n-        let rust_src_root = self.find_rust_src_root().expect(\"Could not find Rust source root\");\n+        let rust_src_root = self.config.find_rust_src_root().expect(\n+            \"Could not find Rust source root\",\n+        );\n         let rust_pp_module_rel_path = Path::new(\"./src/etc/lldb_rust_formatters.py\");\n         let rust_pp_module_abs_path = rust_src_root.join(rust_pp_module_rel_path)\n                                                    .to_str()\n@@ -1717,11 +1707,13 @@ actual:\\n\\\n         if self.props.check_test_line_numbers_match {\n             self.check_rustdoc_test_option(proc_res);\n         } else {\n-            let root = self.find_rust_src_root().unwrap();\n-            let res = self.cmd2procres(Command::new(&self.config.docck_python)\n-                                       .arg(root.join(\"src/etc/htmldocck.py\"))\n-                                       .arg(out_dir)\n-                                       .arg(&self.testpaths.file));\n+            let root = self.config.find_rust_src_root().unwrap();\n+            let res = self.cmd2procres(\n+                Command::new(&self.config.docck_python)\n+                    .arg(root.join(\"src/etc/htmldocck.py\"))\n+                    .arg(out_dir)\n+                    .arg(&self.testpaths.file),\n+            );\n             if !res.status.success() {\n                 self.fatal_proc_rec(\"htmldocck failed!\", &res);\n             }"}]}