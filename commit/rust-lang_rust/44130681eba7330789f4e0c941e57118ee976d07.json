{"sha": "44130681eba7330789f4e0c941e57118ee976d07", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0MTMwNjgxZWJhNzMzMDc4OWY0ZTBjOTQxZTU3MTE4ZWU5NzZkMDc=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-30T03:37:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-30T03:37:36Z"}, "message": "Rollup merge of #63087 - crlf0710:tidy_2018, r=Mark-Simulacrum\n\nAdd very simple edition check to tidy.\n\nFixes #58099.", "tree": {"sha": "186fdf3414844dc196dd1b95078ee71307612c63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/186fdf3414844dc196dd1b95078ee71307612c63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44130681eba7330789f4e0c941e57118ee976d07", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdP7uACRBK7hj4Ov3rIwAAdHIIAEFBztnOqbuSyi0BJPFaRy8M\nN8HYJnznq694WTkNbTsqpNDbBQ7CT6n8u6QwlnEj2JzA/Lr094KP1tPddTbO2XEb\nBU0nmK5ezlTRgJLxhJS7vZtIsqVwkz584KS/+7Pye5u33XZTKESrrDDNYs4CVW11\n3ek10dCoAhfHThUH7IJA2YklBOF9VSwU1hM8+oFH95fhxEmLigfgfJ3z96wcgqbq\nFPSPQLP966qGYyJZL8tf0GfZfQ7L55gFAUd0igTw+lbaMb9D2sCEiI/dpjQa8emF\nQiQpDVFxE/YsAM0C+O2CWVnwfW9dRfj3+LNXAsQUE4DuT3NrMSjQxtcv1jJK4sw=\n=xNZH\n-----END PGP SIGNATURE-----\n", "payload": "tree 186fdf3414844dc196dd1b95078ee71307612c63\nparent 652f13d838d7b017e2d0ce4bbdb3c4d7a1a866d9\nparent 870efe34c8c86a3aef4db628b429425a216b41bd\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1564457856 +0200\ncommitter GitHub <noreply@github.com> 1564457856 +0200\n\nRollup merge of #63087 - crlf0710:tidy_2018, r=Mark-Simulacrum\n\nAdd very simple edition check to tidy.\n\nFixes #58099.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44130681eba7330789f4e0c941e57118ee976d07", "html_url": "https://github.com/rust-lang/rust/commit/44130681eba7330789f4e0c941e57118ee976d07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44130681eba7330789f4e0c941e57118ee976d07/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "652f13d838d7b017e2d0ce4bbdb3c4d7a1a866d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/652f13d838d7b017e2d0ce4bbdb3c4d7a1a866d9", "html_url": "https://github.com/rust-lang/rust/commit/652f13d838d7b017e2d0ce4bbdb3c4d7a1a866d9"}, {"sha": "870efe34c8c86a3aef4db628b429425a216b41bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/870efe34c8c86a3aef4db628b429425a216b41bd", "html_url": "https://github.com/rust-lang/rust/commit/870efe34c8c86a3aef4db628b429425a216b41bd"}], "stats": {"total": 66, "additions": 56, "deletions": 10}, "files": [{"sha": "73fdee71f0c0ba6a2f265be059a5f4736306975e", "filename": "src/test/run-make/thumb-none-qemu/example/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -2,7 +2,7 @@\n name = \"example\"\n version = \"0.1.0\"\n authors = [\"Hideki Sekine <sekineh@me.com>\"]\n-# edition = \"2018\"\n+edition = \"2018\"\n \n [dependencies]\n cortex-m = \"0.5.4\""}, {"sha": "4a08419a07e14e885ff57b0cf767cd66d58f6739", "filename": "src/test/run-make/thumb-none-qemu/example/src/main.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -1,16 +1,14 @@\n // #![feature(stdsimd)]\n #![no_main]\n #![no_std]\n-\n-extern crate cortex_m;\n-\n-extern crate cortex_m_rt as rt;\n-extern crate cortex_m_semihosting as semihosting;\n-extern crate panic_halt;\n-\n use core::fmt::Write;\n use cortex_m::asm;\n-use rt::entry;\n+use cortex_m_rt::entry;\n+use cortex_m_semihosting as semihosting;\n+\n+//FIXME: This imports the provided #[panic_handler].\n+#[allow(rust_2018_idioms)]\n+extern crate panic_halt;\n \n entry!(main);\n \n@@ -22,7 +20,7 @@ fn main() -> ! {\n \n         // write something through semihosting interface\n         let mut hstdout = semihosting::hio::hstdout().unwrap();\n-        write!(hstdout, \"x = {}\\n\", x);\n+        let _ = write!(hstdout, \"x = {}\\n\", x);\n \n         // exit from qemu\n         semihosting::debug::exit(semihosting::debug::EXIT_SUCCESS);"}, {"sha": "ef7dc812af9d4f4681cfa6160ea0a52aafe6793a", "filename": "src/tools/rustc-std-workspace-alloc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Frustc-std-workspace-alloc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Frustc-std-workspace-alloc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustc-std-workspace-alloc%2FCargo.toml?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -6,6 +6,7 @@ license = 'MIT OR Apache-2.0'\n description = \"\"\"\n Hack for the compiler's own build system\n \"\"\"\n+edition = \"2018\"\n \n [lib]\n path = \"lib.rs\""}, {"sha": "4a2e49fd1c3c77938fb242503008c04c7ecc9cd6", "filename": "src/tools/tidy/src/edition.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fedition.rs?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -0,0 +1,45 @@\n+//! Tidy check to ensure that crate `edition` is '2018'\n+//!\n+\n+use std::path::Path;\n+\n+fn filter_dirs(path: &Path) -> bool {\n+    // FIXME: just use super::filter_dirs after the submodules are updated.\n+    if super::filter_dirs(path) {\n+        return true;\n+    }\n+    let skip = [\n+        \"src/doc/book/second-edition\",\n+        \"src/doc/book/2018-edition\",\n+        \"src/doc/book/ci/stable-check\",\n+        \"src/doc/reference/stable-check\",\n+    ];\n+    skip.iter().any(|p| path.ends_with(p))\n+}\n+\n+fn is_edition_2018(mut line: &str) -> bool {\n+    line = line.trim();\n+    line == \"edition = \\\"2018\\\"\" || line == \"edition = \\'2018\\'\"\n+}\n+\n+pub fn check(path: &Path, bad: &mut bool) {\n+    super::walk(\n+        path,\n+        &mut |path| filter_dirs(path) || path.ends_with(\"src/test\"),\n+        &mut |entry, contents| {\n+            let file = entry.path();\n+            let filename = file.file_name().unwrap();\n+            if filename != \"Cargo.toml\" {\n+                return;\n+            }\n+            let has_edition = contents.lines().any(is_edition_2018);\n+            if !has_edition {\n+                tidy_error!(\n+                    bad,\n+                    \"{} doesn't have `edition = \\\"2018\\\"` on a separate line\",\n+                    file.display()\n+                );\n+            }\n+        },\n+    );\n+}"}, {"sha": "e01184e3658b525da78e97feeafe87661e3f0f81", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -34,6 +34,7 @@ pub mod style;\n pub mod errors;\n pub mod features;\n pub mod cargo;\n+pub mod edition;\n pub mod pal;\n pub mod deps;\n pub mod extdeps;"}, {"sha": "5deac52f08b5eeb5108c0a2d3499512aeac56aba", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44130681eba7330789f4e0c941e57118ee976d07/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=44130681eba7330789f4e0c941e57118ee976d07", "patch": "@@ -22,6 +22,7 @@ fn main() {\n     style::check(&path, &mut bad);\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n+    edition::check(&path, &mut bad);\n     let collected = features::check(&path, &mut bad, verbose);\n     pal::check(&path, &mut bad);\n     unstable_book::check(&path, collected, &mut bad);"}]}