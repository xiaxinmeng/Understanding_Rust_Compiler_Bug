{"sha": "8d561587b2be3c09116142aeb837811656257c63", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkNTYxNTg3YjJiZTNjMDkxMTYxNDJhZWI4Mzc4MTE2NTYyNTdjNjM=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-07-17T02:29:19Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-07-17T17:30:32Z"}, "message": "stop initializing ref_count for stack closures\n\nthe only part of the header ~fn and &fn should be touching right now is\nthe tydesc", "tree": {"sha": "08cb36d66da0f78aa527d1511d1b426d009ae67d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08cb36d66da0f78aa527d1511d1b426d009ae67d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d561587b2be3c09116142aeb837811656257c63", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d561587b2be3c09116142aeb837811656257c63", "html_url": "https://github.com/rust-lang/rust/commit/8d561587b2be3c09116142aeb837811656257c63", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d561587b2be3c09116142aeb837811656257c63/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93c270c63d158805a068b8e7ced660df1051c3ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/93c270c63d158805a068b8e7ced660df1051c3ca", "html_url": "https://github.com/rust-lang/rust/commit/93c270c63d158805a068b8e7ced660df1051c3ca"}], "stats": {"total": 11, "additions": 0, "deletions": 11}, "files": [{"sha": "77fc168a67d0d397397514bdecf1df72aa4f93dc", "filename": "src/librustc/middle/trans/closure.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8d561587b2be3c09116142aeb837811656257c63/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d561587b2be3c09116142aeb837811656257c63/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fclosure.rs?ref=8d561587b2be3c09116142aeb837811656257c63", "patch": "@@ -174,16 +174,6 @@ pub fn allocate_cbox(bcx: block, sigil: ast::Sigil, cdata_ty: ty::t)\n     let ccx = bcx.ccx();\n     let tcx = ccx.tcx;\n \n-    fn nuke_ref_count(bcx: block, llbox: ValueRef) {\n-        let _icx = push_ctxt(\"closure::nuke_ref_count\");\n-        // Initialize ref count to arbitrary value for debugging:\n-        let ccx = bcx.ccx();\n-        let llbox = PointerCast(bcx, llbox, Type::opaque_box(ccx).ptr_to());\n-        let ref_cnt = GEPi(bcx, llbox, [0u, abi::box_field_refcnt]);\n-        let rc = C_int(ccx, 0x12345678);\n-        Store(bcx, rc, ref_cnt);\n-    }\n-\n     // Allocate and initialize the box:\n     match sigil {\n         ast::ManagedSigil => {\n@@ -195,7 +185,6 @@ pub fn allocate_cbox(bcx: block, sigil: ast::Sigil, cdata_ty: ty::t)\n         ast::BorrowedSigil => {\n             let cbox_ty = tuplify_box_ty(tcx, cdata_ty);\n             let llbox = alloc_ty(bcx, cbox_ty, \"__closure\");\n-            nuke_ref_count(bcx, llbox);\n             rslt(bcx, llbox)\n         }\n     }"}]}