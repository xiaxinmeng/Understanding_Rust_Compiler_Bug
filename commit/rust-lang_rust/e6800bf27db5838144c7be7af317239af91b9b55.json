{"sha": "e6800bf27db5838144c7be7af317239af91b9b55", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2ODAwYmYyN2RiNTgzODE0NGM3YmU3YWYzMTcyMzlhZjkxYjliNTU=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-11-13T02:40:16Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-11-13T02:40:54Z"}, "message": "remove closure_block_indent_threshold option", "tree": {"sha": "d2b1f99b8feb5057acde91e198c01713cfb8e472", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2b1f99b8feb5057acde91e198c01713cfb8e472"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e6800bf27db5838144c7be7af317239af91b9b55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e6800bf27db5838144c7be7af317239af91b9b55", "html_url": "https://github.com/rust-lang/rust/commit/e6800bf27db5838144c7be7af317239af91b9b55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e6800bf27db5838144c7be7af317239af91b9b55/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "html_url": "https://github.com/rust-lang/rust/commit/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b"}], "stats": {"total": 121, "additions": 5, "deletions": 116}, "files": [{"sha": "99f4f2dacbcd8e224e20b6bb15b1a8ead2fc9b6f", "filename": "Configurations.md", "status": "modified", "additions": 0, "deletions": 34, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/e6800bf27db5838144c7be7af317239af91b9b55/Configurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/e6800bf27db5838144c7be7af317239af91b9b55/Configurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Configurations.md?ref=e6800bf27db5838144c7be7af317239af91b9b55", "patch": "@@ -266,40 +266,6 @@ let files = fs::read_dir(\"tests/coverage/source\")\n \n See also [`chain_width`](#chain_width).\n \n-## `closure_block_indent_threshold`\n-\n-How many lines a closure must have before it is block indented. -1 means never use block indent.\n-\n-- **Default value**: `7`\n-- **Possible values**: `-1`, or any positive integer\n-\n-#### Closures shorter than `closure_block_indent_threshold`:\n-```rust\n-lorem_ipsum(|| {\n-                println!(\"lorem\");\n-                println!(\"ipsum\");\n-                println!(\"dolor\");\n-                println!(\"sit\");\n-                println!(\"amet\");\n-            });\n-```\n-\n-#### Closures longer than `closure_block_indent_threshold`:\n-```rust\n-lorem_ipsum(|| {\n-    println!(\"lorem\");\n-    println!(\"ipsum\");\n-    println!(\"dolor\");\n-    println!(\"sit\");\n-    println!(\"amet\");\n-    println!(\"consectetur\");\n-    println!(\"adipiscing\");\n-    println!(\"elit\");\n-});\n-```\n-\n-**Note**: This option only takes effect when `fn_call_indent` is set to `\"Visual\"`.\n-\n ## `combine_control_expr`\n \n Combine control expressions with function calls."}, {"sha": "15bfae4553bef12f0ea8a79f63c2c1b229d323ed", "filename": "src/closures.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fclosures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fclosures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fclosures.rs?ref=e6800bf27db5838144c7be7af317239af91b9b55", "patch": "@@ -13,16 +13,15 @@ use syntax::codemap::Span;\n use syntax::parse::classify;\n \n use codemap::SpanUtils;\n-use expr::{block_contains_comment, is_simple_block, is_unsafe_block, need_block_indent,\n-           rewrite_cond, ToExpr};\n+use expr::{block_contains_comment, is_simple_block, is_unsafe_block, rewrite_cond, ToExpr};\n use items::{span_hi_for_arg, span_lo_for_arg};\n use lists::{definitive_tactic, itemize_list, write_list, DefinitiveListTactic, ListFormatting,\n             ListTactic, Separator, SeparatorPlace, SeparatorTactic};\n use rewrite::{Rewrite, RewriteContext};\n use shape::Shape;\n use utils::{last_line_width, left_most_sub_expr, stmt_expr};\n \n-// This functions is pretty messy because of the rules around closures and blocks:\n+// This module is pretty messy because of the rules around closures and blocks:\n // FIXME - the below is probably no longer true in full.\n //   * if there is a return type, then there must be braces,\n //   * given a closure with braces, whether that is parsed to give an inner block\n@@ -31,6 +30,8 @@ use utils::{last_line_width, left_most_sub_expr, stmt_expr};\n //   * if the first expression in the body ends with a block (i.e., is a\n //     statement without needing a semi-colon), then adding or removing braces\n //     can change whether it is treated as an expression or statement.\n+\n+\n pub fn rewrite_closure(\n     capture: ast::CaptureBy,\n     fn_decl: &ast::FnDecl,\n@@ -137,21 +138,6 @@ fn rewrite_closure_block(\n     context: &RewriteContext,\n     shape: Shape,\n ) -> Option<String> {\n-    // Start with visual indent, then fall back to block indent if the\n-    // closure is large.\n-    let block_threshold = context.config.closure_block_indent_threshold();\n-    if block_threshold >= 0 {\n-        if let Some(block_str) = block.rewrite(context, shape) {\n-            if block_str.matches('\\n').count() <= block_threshold as usize\n-                && !need_block_indent(&block_str, shape)\n-            {\n-                return Some(format!(\"{} {}\", prefix, block_str));\n-            }\n-        }\n-    }\n-\n-    // The body of the closure is big enough to be block indented, that\n-    // means we must re-format.\n     let block_shape = shape.block();\n     let block_str = block.rewrite(context, block_shape)?;\n     Some(format!(\"{} {}\", prefix, block_str))"}, {"sha": "98939e9e1918abe654cbacc139804990ce5ad2d5", "filename": "src/config.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfig.rs?ref=e6800bf27db5838144c7be7af317239af91b9b55", "patch": "@@ -621,9 +621,6 @@ create_config! {\n                                     indentation level as the match keyword\";\n     match_pattern_separator_break_point: SeparatorPlace, SeparatorPlace::Back, false,\n         \"Put a match sub-patterns' separator in front or back.\";\n-    closure_block_indent_threshold: isize, 7, false,\n-        \"How many lines a closure must have before it is block indented. \\\n-        -1 means never use block indent.\";\n     space_before_type_annotation: bool, false, false,\n         \"Leave a space before the colon in a type annotation\";\n     space_after_type_annotation_colon: bool, true, false,"}, {"sha": "d6c025422af9ee88c51bde345815ca484f743105", "filename": "src/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e6800bf27db5838144c7be7af317239af91b9b55/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=e6800bf27db5838144c7be7af317239af91b9b55", "patch": "@@ -1851,7 +1851,7 @@ where\n     ))\n }\n \n-pub fn need_block_indent(s: &str, shape: Shape) -> bool {\n+fn need_block_indent(s: &str, shape: Shape) -> bool {\n     s.lines().skip(1).any(|s| {\n         s.find(|c| !char::is_whitespace(c))\n             .map_or(false, |w| w + 1 < shape.indent.width())"}, {"sha": "166f825b2397c8ebaf82d2c5608c55524ecc5fc6", "filename": "tests/source/configs-closure_block_indent_threshold--1.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold--1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold--1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-closure_block_indent_threshold--1.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,5 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: -1\n-\n-fn issue1755() {\n-    b.iter(|| dfkljdklgjdlkfgjdlkgjldkjfgkdjgldjfgkljdfklgjlkdjfgkljdflkgjlkdfjgdjfsas::expect(\"parse\"));\n-}"}, {"sha": "21b47a8d7ca65720f6f490c1c5a9c53782a1cdfc", "filename": "tests/source/configs-closure_block_indent_threshold-10.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-10.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-10.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-10.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,12 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: 10\n-// Closure block indent threshold\n-\n-fn main() {\n-    lorem_ipsum(|| {\n-        println!(\"lorem\");\n-        println!(\"ipsum\");\n-        println!(\"dolor\");\n-        println!(\"sit\");\n-        println!(\"amet\");\n-    });\n-}"}, {"sha": "089ac3288ef9b964a1bb113118ee58b40d19ef54", "filename": "tests/source/configs-closure_block_indent_threshold-2.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fconfigs-closure_block_indent_threshold-2.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,12 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: 2\n-// Closure block indent threshold\n-\n-fn main() {\n-    lorem_ipsum(|| {\n-        println!(\"lorem\");\n-        println!(\"ipsum\");\n-        println!(\"dolor\");\n-        println!(\"sit\");\n-        println!(\"amet\");\n-    });\n-}"}, {"sha": "3a62e6a27edb9f9fb6829429919a9d51ff126a99", "filename": "tests/target/configs-closure_block_indent_threshold--1.rs", "status": "removed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold--1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold--1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold--1.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,7 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: -1\n-\n-fn issue1755() {\n-    b.iter(|| {\n-        dfkljdklgjdlkfgjdlkgjldkjfgkdjgldjfgkljdfklgjlkdjfgkljdflkgjlkdfjgdjfsas::expect(\"parse\")\n-    });\n-}"}, {"sha": "21b47a8d7ca65720f6f490c1c5a9c53782a1cdfc", "filename": "tests/target/configs-closure_block_indent_threshold-10.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-10.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-10.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-10.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,12 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: 10\n-// Closure block indent threshold\n-\n-fn main() {\n-    lorem_ipsum(|| {\n-        println!(\"lorem\");\n-        println!(\"ipsum\");\n-        println!(\"dolor\");\n-        println!(\"sit\");\n-        println!(\"amet\");\n-    });\n-}"}, {"sha": "089ac3288ef9b964a1bb113118ee58b40d19ef54", "filename": "tests/target/configs-closure_block_indent_threshold-2.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ff2cb23f5ab228845ec3395c669b98bd0e14b2b/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fconfigs-closure_block_indent_threshold-2.rs?ref=7ff2cb23f5ab228845ec3395c669b98bd0e14b2b", "patch": "@@ -1,12 +0,0 @@\n-// rustfmt-closure_block_indent_threshold: 2\n-// Closure block indent threshold\n-\n-fn main() {\n-    lorem_ipsum(|| {\n-        println!(\"lorem\");\n-        println!(\"ipsum\");\n-        println!(\"dolor\");\n-        println!(\"sit\");\n-        println!(\"amet\");\n-    });\n-}"}]}