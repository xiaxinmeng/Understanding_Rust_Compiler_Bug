{"sha": "51c93553d4344472f2e291b3a4f110f884062a37", "node_id": "C_kwDOAAsO6NoAKDUxYzkzNTUzZDQzNDQ0NzJmMmUyOTFiM2E0ZjExMGY4ODQwNjJhMzc", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2023-02-03T07:05:59Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2023-03-29T03:56:11Z"}, "message": "Test that TLS access works outside of the dylib it's defined in", "tree": {"sha": "9208fde9195a20d1aa035e29f15afbb4ad11cc2b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9208fde9195a20d1aa035e29f15afbb4ad11cc2b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51c93553d4344472f2e291b3a4f110f884062a37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51c93553d4344472f2e291b3a4f110f884062a37", "html_url": "https://github.com/rust-lang/rust/commit/51c93553d4344472f2e291b3a4f110f884062a37", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51c93553d4344472f2e291b3a4f110f884062a37/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdbbce0a9e5c839295cf9a8714798af45d541e20", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdbbce0a9e5c839295cf9a8714798af45d541e20", "html_url": "https://github.com/rust-lang/rust/commit/cdbbce0a9e5c839295cf9a8714798af45d541e20"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "aab48f871c9b8bd11a9e058794d3908f9347479a", "filename": "tests/ui/thread-local/auxiliary/tls-export.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-export.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-export.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-export.rs?ref=51c93553d4344472f2e291b3a4f110f884062a37", "patch": "@@ -0,0 +1,16 @@\n+#![crate_type = \"dylib\"]\n+#![feature(thread_local)]\n+#![feature(cfg_target_thread_local)]\n+#![cfg(target_thread_local)]\n+\n+extern crate tls_rlib;\n+\n+pub use tls_rlib::*;\n+\n+#[thread_local]\n+pub static FOO: bool = true;\n+\n+#[inline(never)]\n+pub fn foo_addr() -> usize {\n+    &FOO as *const bool as usize\n+}"}, {"sha": "0fbcf387b5fa96bcf49f5268bbb5ada379eb069a", "filename": "tests/ui/thread-local/auxiliary/tls-rlib.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-rlib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-rlib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fthread-local%2Fauxiliary%2Ftls-rlib.rs?ref=51c93553d4344472f2e291b3a4f110f884062a37", "patch": "@@ -0,0 +1,14 @@\n+// no-prefer-dynamic\n+\n+#![crate_type = \"rlib\"]\n+#![feature(thread_local)]\n+#![feature(cfg_target_thread_local)]\n+#![cfg(target_thread_local)]\n+\n+#[thread_local]\n+pub static BAR: bool = true;\n+\n+#[inline(never)]\n+pub fn bar_addr() -> usize {\n+    &BAR as *const bool as usize\n+}"}, {"sha": "12c46113cead1203c06c0650614aaf7f5e187c18", "filename": "tests/ui/thread-local/tls-dylib-access.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Ftls-dylib-access.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51c93553d4344472f2e291b3a4f110f884062a37/tests%2Fui%2Fthread-local%2Ftls-dylib-access.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fthread-local%2Ftls-dylib-access.rs?ref=51c93553d4344472f2e291b3a4f110f884062a37", "patch": "@@ -0,0 +1,19 @@\n+// aux-build: tls-rlib.rs\n+// aux-build: tls-export.rs\n+// run-pass\n+\n+#![feature(cfg_target_thread_local)]\n+\n+#[cfg(target_thread_local)]\n+extern crate tls_export;\n+\n+fn main() {\n+    #[cfg(target_thread_local)]\n+    {\n+        // Check that we get the real address of the `FOO` TLS in the dylib\n+        assert_eq!(&tls_export::FOO as *const bool as usize, tls_export::foo_addr());\n+\n+        // Check that we get the real address of the `BAR` TLS in the rlib linked into the dylib\n+        assert_eq!(&tls_export::BAR as *const bool as usize, tls_export::bar_addr());\n+    }\n+}"}]}