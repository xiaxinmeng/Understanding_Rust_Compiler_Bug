{"sha": "1fd18f020dcf01a441925ac0a368a31f3ddf4047", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFmZDE4ZjAyMGRjZjAxYTQ0MTkyNWFjMGEzNjhhMzFmM2RkZjQwNDc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-25T20:27:16Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-25T20:27:16Z"}, "message": ":arrow_up: salsa", "tree": {"sha": "8468850033bff56da6829451922e5d90ce804fd2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8468850033bff56da6829451922e5d90ce804fd2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1fd18f020dcf01a441925ac0a368a31f3ddf4047", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1fd18f020dcf01a441925ac0a368a31f3ddf4047", "html_url": "https://github.com/rust-lang/rust/commit/1fd18f020dcf01a441925ac0a368a31f3ddf4047", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1fd18f020dcf01a441925ac0a368a31f3ddf4047/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d65dca6bb3844d71ca14c396497783cbf9650e4a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d65dca6bb3844d71ca14c396497783cbf9650e4a", "html_url": "https://github.com/rust-lang/rust/commit/d65dca6bb3844d71ca14c396497783cbf9650e4a"}], "stats": {"total": 57, "additions": 29, "deletions": 28}, "files": [{"sha": "473a74a32364450c815f81448a2642def1000d15", "filename": "Cargo.lock", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -726,7 +726,7 @@ dependencies = [\n  \"ra_syntax 0.1.0\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"salsa 0.10.0-alpha4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -746,7 +746,6 @@ dependencies = [\n  \"ra_syntax 0.1.0\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -768,7 +767,6 @@ dependencies = [\n  \"rayon 1.0.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n  \"unicase 2.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -1091,7 +1089,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"salsa\"\n-version = \"0.10.0-alpha3\"\n+version = \"0.10.0-alpha4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"derive-new 0.5.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1100,13 +1098,13 @@ dependencies = [\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"salsa-macros 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"salsa-macros 0.10.0-alpha4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"smallvec 0.6.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"salsa-macros\"\n-version = \"0.10.0-alpha3\"\n+version = \"0.10.0-alpha4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"heck 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1697,8 +1695,8 @@ dependencies = [\n \"checksum rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a\"\n \"checksum rusty-fork 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9591f190d2852720b679c21f66ad929f9f1d7bb09d1193c26167586029d8489c\"\n \"checksum ryu 0.2.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eb9e9b8cde282a9fe6a42dd4681319bfb63f121b8a8ee9439c6f4107e58a46f7\"\n-\"checksum salsa 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"135c0977b23f8a9dc16744dd5495989110e3763ba5ea41e386741c7f8901e285\"\n-\"checksum salsa-macros 0.10.0-alpha3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c9c93b5efed7281334c4bed8470b278076d1ccd6a60da59a15cd0d57792afff8\"\n+\"checksum salsa 0.10.0-alpha4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3f442595eae948da8fbb2aa1e13940d9d2d70031753a27a5d1434f91b706ff12\"\n+\"checksum salsa-macros 0.10.0-alpha4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2e6c1a1bee4eb44881438e80c1a26db1c3b957b6cc51765615d429019babdec2\"\n \"checksum same-file 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8f20c4be53a8a1ff4c1f1b2bd14570d2f634628709752f0702ecdd2b3f9a5267\"\n \"checksum scopeguard 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"94258f53601af11e6a49f722422f6e3425c52b06245a5cf9bc09908b174f5e27\"\n \"checksum semver 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\""}, {"sha": "9aa77f72e08a41fdcc644db5b1ee34af50e85760", "filename": "crates/ra_db/Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_db%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_db%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_db%2FCargo.toml?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -6,9 +6,10 @@ authors = [\"Aleksey Kladov <aleksey.kladov@gmail.com>\"]\n \n [dependencies]\n relative-path = \"0.4.0\"\n-salsa = \"0.10.0-alpha3\"\n+salsa = \"0.10.0-alpha4\"\n rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n+\n ra_arena = { path = \"../ra_arena\" }\n ra_syntax = { path = \"../ra_syntax\" }\n test_utils = { path = \"../test_utils\" }"}, {"sha": "3a0aa7d24683f504959aff03ca27d9a4b69e2268", "filename": "crates/ra_db/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_db%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_db%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_db%2Fsrc%2Flib.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -63,7 +63,7 @@ pub struct FileRange {\n     pub range: TextRange,\n }\n \n-#[salsa::query_group]\n+#[salsa::query_group(FilesDatabaseStorage)]\n pub trait FilesDatabase: salsa::Database {\n     /// Text of the file.\n     #[salsa::input]\n@@ -102,7 +102,7 @@ fn source_root_crates(db: &impl FilesDatabase, id: SourceRootId) -> Arc<Vec<Crat\n     Arc::new(res)\n }\n \n-#[salsa::query_group]\n+#[salsa::query_group(SyntaxDatabaseStorage)]\n pub trait SyntaxDatabase: FilesDatabase + BaseDatabase {\n     fn source_file(&self, file_id: FileId) -> TreeArc<SourceFile>;\n }"}, {"sha": "57a4b155bb7643d3da5bedc46f24db5cb8005add", "filename": "crates/ra_hir/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2FCargo.toml?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -12,7 +12,6 @@ rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n ena = \"0.11\"\n join_to_string = \"0.1.3\"\n-salsa = \"0.10.0-alpha3\"\n \n ra_syntax = { path = \"../ra_syntax\" }\n ra_arena = { path = \"../ra_arena\" }"}, {"sha": "dfbf41bd661cc4cea51b762557d0aa85b3491abd", "filename": "crates/ra_hir/src/db.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fdb.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -18,7 +18,7 @@ use crate::{\n     generics::{GenericParams, GenericDef},\n };\n \n-#[salsa::query_group]\n+#[salsa::query_group(HirDatabaseStorage)]\n pub trait HirDatabase: SyntaxDatabase + AsRef<HirInterner> {\n     #[salsa::invoke(HirFileId::hir_source_file)]\n     fn hir_source_file(&self, file_id: HirFileId) -> TreeArc<SourceFile>;"}, {"sha": "2dc252b1ee8a49ec92a24110d1b487799aaefce6", "filename": "crates/ra_hir/src/mock.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2Fsrc%2Fmock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_hir%2Fsrc%2Fmock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fmock.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -2,7 +2,7 @@ use std::{sync::Arc, panic};\n \n use parking_lot::Mutex;\n use ra_db::{\n-    BaseDatabase, FilePosition, FileId, CrateGraph, SourceRoot, SourceRootId, FilesDatabase,\n+    BaseDatabase, FilePosition, FileId, CrateGraph, SourceRoot, SourceRootId, FilesDatabase, salsa,\n };\n use relative_path::RelativePathBuf;\n use test_utils::{parse_fixture, CURSOR_MARKER, extract_offset};\n@@ -11,7 +11,11 @@ use crate::{db, HirInterner};\n \n pub const WORKSPACE: SourceRootId = SourceRootId(0);\n \n-#[salsa::database(ra_db::FilesDatabase, ra_db::SyntaxDatabase, db::HirDatabase)]\n+#[salsa::database(\n+    ra_db::FilesDatabaseStorage,\n+    ra_db::SyntaxDatabaseStorage,\n+    db::HirDatabaseStorage\n+)]\n #[derive(Debug)]\n pub(crate) struct MockDatabase {\n     events: Mutex<Option<Vec<salsa::Event<MockDatabase>>>>,"}, {"sha": "79e473463fba22a2285b332f9d8d1b601bf8689c", "filename": "crates/ra_ide_api/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2FCargo.toml?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -14,7 +14,6 @@ fst = \"0.3.1\"\n rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n unicase = \"2.2.0\"\n-salsa = \"0.10.0-alpha3\"\n \n ra_syntax = { path = \"../ra_syntax\" }\n ra_ide_api_light = { path = \"../ra_ide_api_light\" }"}, {"sha": "30891aed49e5ba2cc9d5be8980f8bca72dd48c21", "filename": "crates/ra_ide_api/src/db.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fdb.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -8,11 +8,11 @@ use ra_db::{\n use crate::{symbol_index, LineIndex};\n \n #[salsa::database(\n-    ra_db::FilesDatabase,\n-    ra_db::SyntaxDatabase,\n-    LineIndexDatabase,\n-    symbol_index::SymbolsDatabase,\n-    hir::db::HirDatabase\n+    ra_db::FilesDatabaseStorage,\n+    ra_db::SyntaxDatabaseStorage,\n+    LineIndexDatabaseStorage,\n+    symbol_index::SymbolsDatabaseStorage,\n+    hir::db::HirDatabaseStorage\n )]\n #[derive(Debug)]\n pub(crate) struct RootDatabase {\n@@ -62,7 +62,7 @@ impl AsRef<hir::HirInterner> for RootDatabase {\n     }\n }\n \n-#[salsa::query_group]\n+#[salsa::query_group(LineIndexDatabaseStorage)]\n pub(crate) trait LineIndexDatabase: ra_db::FilesDatabase + BaseDatabase {\n     fn line_index(&self, file_id: FileId) -> Arc<LineIndex>;\n }"}, {"sha": "bd9e3f1e3c789fc1e45bbc325acd63352d30ada7", "filename": "crates/ra_ide_api/src/imp.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fimp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fimp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fimp.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -5,7 +5,7 @@ use hir::{\n };\n use ra_db::{\n     FilesDatabase, SourceRoot, SourceRootId, SyntaxDatabase,\n-    salsa::Database,\n+    salsa::{Database, SweepStrategy},\n };\n use ra_ide_api_light::{self, assists, LocalEdit, Severity};\n use ra_syntax::{\n@@ -77,13 +77,13 @@ impl db::RootDatabase {\n     /// for some reason. Needs investigation.\n     pub(crate) fn collect_garbage(&mut self) {\n         self.query(ra_db::SourceFileQuery)\n-            .sweep(salsa::SweepStrategy::default().discard_values());\n+            .sweep(SweepStrategy::default().discard_values());\n         self.query(hir::db::HirSourceFileQuery)\n-            .sweep(salsa::SweepStrategy::default().discard_values());\n+            .sweep(SweepStrategy::default().discard_values());\n         self.query(hir::db::FileItemsQuery)\n-            .sweep(salsa::SweepStrategy::default().discard_values());\n+            .sweep(SweepStrategy::default().discard_values());\n         self.query(hir::db::FileItemQuery)\n-            .sweep(salsa::SweepStrategy::default().discard_values());\n+            .sweep(SweepStrategy::default().discard_values());\n     }\n }\n "}, {"sha": "e073a349ef3479a983f7d80f4e3ec3e3f4b1fabb", "filename": "crates/ra_ide_api/src/symbol_index.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1fd18f020dcf01a441925ac0a368a31f3ddf4047/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fsymbol_index.rs?ref=1fd18f020dcf01a441925ac0a368a31f3ddf4047", "patch": "@@ -44,7 +44,7 @@ use crate::{\n     db::RootDatabase,\n };\n \n-#[salsa::query_group]\n+#[salsa::query_group(SymbolsDatabaseStorage)]\n pub(crate) trait SymbolsDatabase: hir::db::HirDatabase {\n     fn file_symbols(&self, file_id: FileId) -> Arc<SymbolIndex>;\n     #[salsa::input]"}]}