{"sha": "0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "node_id": "C_kwDOAAsO6NoAKDBhMWNlODI3N2MwYThkN2VlZDdhN2QwYTYyY2UwYWRjYmEzNDI1NzI", "commit": {"author": {"name": "Dan Gohman", "email": "dev@sunfishcode.online", "date": "2022-04-20T00:16:24Z"}, "committer": {"name": "Dan Gohman", "email": "dev@sunfishcode.online", "date": "2022-04-20T00:22:54Z"}, "message": "Make `BorrowedFd::borrow_raw` a const fn.\n\nMaking `BorrowedFd::borrow_raw` a const fn allows it to be used to\ncreate a constant `BorrowedFd<'static>` holding constants such as\n`AT_FDCWD`. This will allow [`rustix::fs::cwd`] to become a const fn.\n\nFor consistency, make similar changes to `BorrowedHandle::borrow_raw`\nand `BorrowedSocket::borrow_raw`.\n\n[`rustix::fs::cwd`]: https://docs.rs/rustix/latest/rustix/fs/fn.cwd.html", "tree": {"sha": "adeb64b7f60d27767b2605d17c69f2022d575a2d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/adeb64b7f60d27767b2605d17c69f2022d575a2d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "html_url": "https://github.com/rust-lang/rust/commit/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/comments", "author": {"login": "sunfishcode", "id": 4503403, "node_id": "MDQ6VXNlcjQ1MDM0MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/4503403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunfishcode", "html_url": "https://github.com/sunfishcode", "followers_url": "https://api.github.com/users/sunfishcode/followers", "following_url": "https://api.github.com/users/sunfishcode/following{/other_user}", "gists_url": "https://api.github.com/users/sunfishcode/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunfishcode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunfishcode/subscriptions", "organizations_url": "https://api.github.com/users/sunfishcode/orgs", "repos_url": "https://api.github.com/users/sunfishcode/repos", "events_url": "https://api.github.com/users/sunfishcode/events{/privacy}", "received_events_url": "https://api.github.com/users/sunfishcode/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sunfishcode", "id": 4503403, "node_id": "MDQ6VXNlcjQ1MDM0MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/4503403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sunfishcode", "html_url": "https://github.com/sunfishcode", "followers_url": "https://api.github.com/users/sunfishcode/followers", "following_url": "https://api.github.com/users/sunfishcode/following{/other_user}", "gists_url": "https://api.github.com/users/sunfishcode/gists{/gist_id}", "starred_url": "https://api.github.com/users/sunfishcode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sunfishcode/subscriptions", "organizations_url": "https://api.github.com/users/sunfishcode/orgs", "repos_url": "https://api.github.com/users/sunfishcode/repos", "events_url": "https://api.github.com/users/sunfishcode/events{/privacy}", "received_events_url": "https://api.github.com/users/sunfishcode/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5ae66c12c6bdf1a5739ae1fce8057fd76ba0f47", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5ae66c12c6bdf1a5739ae1fce8057fd76ba0f47", "html_url": "https://github.com/rust-lang/rust/commit/d5ae66c12c6bdf1a5739ae1fce8057fd76ba0f47"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "bfc5ce0156415cf7c7f4ecd5efa88b248995e82b", "filename": "library/std/src/os/fd/owned.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Ffd%2Fowned.rs?ref=0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "patch": "@@ -66,8 +66,8 @@ impl BorrowedFd<'_> {\n     /// the returned `BorrowedFd`, and it must not have the value `-1`.\n     #[inline]\n     #[unstable(feature = \"io_safety\", issue = \"87074\")]\n-    pub unsafe fn borrow_raw(fd: RawFd) -> Self {\n-        assert_ne!(fd, u32::MAX as RawFd);\n+    pub const unsafe fn borrow_raw(fd: RawFd) -> Self {\n+        assert!(fd != u32::MAX as RawFd);\n         // SAFETY: we just asserted that the value is in the valid range and isn't `-1` (the only value bigger than `0xFF_FF_FF_FE` unsigned)\n         unsafe { Self { fd, _phantom: PhantomData } }\n     }"}, {"sha": "bf2d354cda672ffb8a2f5777a4c0dfaeb75b7899", "filename": "library/std/src/os/windows/io/handle.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fhandle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fhandle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fhandle.rs?ref=0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "patch": "@@ -137,7 +137,7 @@ impl BorrowedHandle<'_> {\n     /// [here]: https://devblogs.microsoft.com/oldnewthing/20040302-00/?p=40443\n     #[inline]\n     #[unstable(feature = \"io_safety\", issue = \"87074\")]\n-    pub unsafe fn borrow_raw(handle: RawHandle) -> Self {\n+    pub const unsafe fn borrow_raw(handle: RawHandle) -> Self {\n         Self { handle, _phantom: PhantomData }\n     }\n }"}, {"sha": "c14a1d6192fa2b9a465a05f548248569438a40b3", "filename": "library/std/src/os/windows/io/socket.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fsocket.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fsocket.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Fwindows%2Fio%2Fsocket.rs?ref=0a1ce8277c0a8d7eed7a7d0a62ce0adcba342572", "patch": "@@ -71,8 +71,8 @@ impl BorrowedSocket<'_> {\n     /// `INVALID_SOCKET`.\n     #[inline]\n     #[unstable(feature = \"io_safety\", issue = \"87074\")]\n-    pub unsafe fn borrow_raw(socket: RawSocket) -> Self {\n-        debug_assert_ne!(socket, c::INVALID_SOCKET as RawSocket);\n+    pub const unsafe fn borrow_raw(socket: RawSocket) -> Self {\n+        assert!(socket != c::INVALID_SOCKET as RawSocket);\n         Self { socket, _phantom: PhantomData }\n     }\n }"}]}