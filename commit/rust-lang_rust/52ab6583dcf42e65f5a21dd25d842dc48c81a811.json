{"sha": "52ab6583dcf42e65f5a21dd25d842dc48c81a811", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyYWI2NTgzZGNmNDJlNjVmNWEyMWRkMjVkODQyZGM0OGM4MWE4MTE=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-10-27T16:23:37Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-10-27T16:23:37Z"}, "message": "Better clif file writing", "tree": {"sha": "2501517579aed1e8b113ce381137bb425d606b57", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2501517579aed1e8b113ce381137bb425d606b57"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52ab6583dcf42e65f5a21dd25d842dc48c81a811", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52ab6583dcf42e65f5a21dd25d842dc48c81a811", "html_url": "https://github.com/rust-lang/rust/commit/52ab6583dcf42e65f5a21dd25d842dc48c81a811", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52ab6583dcf42e65f5a21dd25d842dc48c81a811/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42c735dd78418fa86681e8a36a797daf491b6cdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/42c735dd78418fa86681e8a36a797daf491b6cdb", "html_url": "https://github.com/rust-lang/rust/commit/42c735dd78418fa86681e8a36a797daf491b6cdb"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "3ae1acbee30360bb5da74c79deb6e449871c83ce", "filename": "src/base.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/52ab6583dcf42e65f5a21dd25d842dc48c81a811/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52ab6583dcf42e65f5a21dd25d842dc48c81a811/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=52ab6583dcf42e65f5a21dd25d842dc48c81a811", "patch": "@@ -121,9 +121,15 @@ fn trans_fn<'a, 'tcx: 'a>(\n     if cfg!(debug_assertions) {\n         ::cranelift::codegen::write::decorate_function(&mut writer, &mut cton, &func, None)\n             .unwrap();\n-        let clif_file_name = concat!(env!(\"CARGO_MANIFEST_DIR\"), \"/target/out/clif/\").to_string()\n-            + &tcx.symbol_name(instance).as_str();\n-        ::std::fs::write(clif_file_name, cton.as_bytes()).unwrap();\n+        let clif_file_name = format!(\n+            \"{}/{}__{}.clif\",\n+            concat!(env!(\"CARGO_MANIFEST_DIR\"), \"/target/out/clif\"),\n+            tcx.crate_name(LOCAL_CRATE),\n+            tcx.symbol_name(instance).as_str(),\n+        );\n+        if let Err(e) = ::std::fs::write(clif_file_name, cton.as_bytes()) {\n+            tcx.sess.warn(&format!(\"err writing clif file: {:?}\", e));\n+        }\n     }\n \n     // Step 8. Verify function"}]}