{"sha": "a009e2838b25df2761093d727d322a59f69d8f68", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwMDllMjgzOGIyNWRmMjc2MTA5M2Q3MjdkMzIyYTU5ZjY5ZDhmNjg=", "commit": {"author": {"name": "Cassandra Fridkin", "email": "cass@swag.lgbt", "date": "2020-09-05T01:00:58Z"}, "committer": {"name": "Cassandra Fridkin", "email": "cass@swag.lgbt", "date": "2020-09-05T01:00:58Z"}, "message": "There isn't a way to pass --remove yet, but you can rm if u like", "tree": {"sha": "b5277bfaa2f1d1af9d8ffaa6802f3a4644bd525b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5277bfaa2f1d1af9d8ffaa6802f3a4644bd525b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a009e2838b25df2761093d727d322a59f69d8f68", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdn8arGOPUN7UUjx9sGOAzKYTMzoFAl9S44UACgkQsGOAzKYT\nMzoauBAAmm+XlsdggRi//m/30LTPWW2n2l36PiQ7oXibGaAhPyGsBE2ezhdNswdo\nf2eoAmWwU+2sRAoz456y5e/AUQR9+FgxIafKAOEj7uD9FkBqWHbPf2PUI1jp2ubx\n+sNyezYz6XaaDown7GL91uftk2aNRCK93Vc5WSWlM1CSDsgfOYl2wVFOLl7MgC7i\ne+rWAlI1u/HDG1kenykSGh+Qq6sDo1VZgh/lQtrq4BHfo+rC/GagRynDP/75Zt+A\nwb85SWCe2/jVSEkMZ9j3c+1IstLGukpfC7sx3T5I3+YeA6Y3tqL2HI4WZCJ+y9Gu\n2RHZYUlkpwKhNCeSVN6w0kX1wDeP3tY4C8C9eGK1Vh8nyPGUkg0q+/v5K/b24EBr\n2LofvBs+TZ4qC8y98c3OjIWXbHVC+cBCF0yP91ADxNHdH1ViuIUSJ/mLk+B0cn+h\n4nW19+emyb0hn6NpNUmp+7xZD0ighOGtKHsxkXFo2Ww0NFbAfIfZMX5ZLKWsCVAs\nkv7G59LMy08Ws1Mly6EJzrwGaUsHl7SUml32qsY+sce6AFYqV1ZgMtGaY4olsOmg\nDx4Ub1rh3m53GGc93aR2ej6zvET1SCuqOrrNFTyYM4EC3lElj/z9uMj0lroq0e29\nFYM0Y7tD78kRU6U7ttiN2OzWHBGtqjSXrhSXbXl6GykpLi0fei0=\n=LqxS\n-----END PGP SIGNATURE-----", "payload": "tree b5277bfaa2f1d1af9d8ffaa6802f3a4644bd525b\nparent d2454643e137bde519786ee9e650c455d7ad6f34\nauthor Cassandra Fridkin <cass@swag.lgbt> 1599267658 -0400\ncommitter Cassandra Fridkin <cass@swag.lgbt> 1599267658 -0400\n\nThere isn't a way to pass --remove yet, but you can rm if u like\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a009e2838b25df2761093d727d322a59f69d8f68", "html_url": "https://github.com/rust-lang/rust/commit/a009e2838b25df2761093d727d322a59f69d8f68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a009e2838b25df2761093d727d322a59f69d8f68/comments", "author": {"login": "caass", "id": 25358963, "node_id": "MDQ6VXNlcjI1MzU4OTYz", "avatar_url": "https://avatars.githubusercontent.com/u/25358963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caass", "html_url": "https://github.com/caass", "followers_url": "https://api.github.com/users/caass/followers", "following_url": "https://api.github.com/users/caass/following{/other_user}", "gists_url": "https://api.github.com/users/caass/gists{/gist_id}", "starred_url": "https://api.github.com/users/caass/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caass/subscriptions", "organizations_url": "https://api.github.com/users/caass/orgs", "repos_url": "https://api.github.com/users/caass/repos", "events_url": "https://api.github.com/users/caass/events{/privacy}", "received_events_url": "https://api.github.com/users/caass/received_events", "type": "User", "site_admin": false}, "committer": {"login": "caass", "id": 25358963, "node_id": "MDQ6VXNlcjI1MzU4OTYz", "avatar_url": "https://avatars.githubusercontent.com/u/25358963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caass", "html_url": "https://github.com/caass", "followers_url": "https://api.github.com/users/caass/followers", "following_url": "https://api.github.com/users/caass/following{/other_user}", "gists_url": "https://api.github.com/users/caass/gists{/gist_id}", "starred_url": "https://api.github.com/users/caass/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caass/subscriptions", "organizations_url": "https://api.github.com/users/caass/orgs", "repos_url": "https://api.github.com/users/caass/repos", "events_url": "https://api.github.com/users/caass/events{/privacy}", "received_events_url": "https://api.github.com/users/caass/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2454643e137bde519786ee9e650c455d7ad6f34", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2454643e137bde519786ee9e650c455d7ad6f34", "html_url": "https://github.com/rust-lang/rust/commit/d2454643e137bde519786ee9e650c455d7ad6f34"}], "stats": {"total": 71, "additions": 70, "deletions": 1}, "files": [{"sha": "4e6c1fca35123877b94b7d083175fd000fbadaa0", "filename": "Cargo.lock", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -1407,6 +1407,10 @@ dependencies = [\n  \"hashbrown\",\n ]\n \n+[[package]]\n+name = \"install-git-hook\"\n+version = \"0.1.0\"\n+\n [[package]]\n name = \"installer\"\n version = \"0.0.0\""}, {"sha": "4156ef8f124a72601c08b023b2618450f85cbfe7", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -8,6 +8,7 @@ members = [\n   \"src/tools/clippy\",\n   \"src/tools/compiletest\",\n   \"src/tools/error_index_generator\",\n+  \"src/tools/install-git-hook\",\n   \"src/tools/linkchecker\",\n   \"src/tools/rustbook\",\n   \"src/tools/unstable-book-gen\","}, {"sha": "0a7df6e595c6ce6bb06fde2a6aaf92cadbecaf3b", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -487,7 +487,7 @@ impl<'a> Builder<'a> {\n                 install::Src,\n                 install::Rustc\n             ),\n-            Kind::Run => describe!(run::ExpandYamlAnchors,),\n+            Kind::Run => describe!(run::ExpandYamlAnchors, run::InstallGitHook),\n         }\n     }\n "}, {"sha": "34170898a548fe05f4fd80b22fd00cd438be8277", "filename": "src/bootstrap/run.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Frun.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Frun.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Frun.rs?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -41,3 +41,27 @@ fn try_run(builder: &Builder<'_>, cmd: &mut Command) -> bool {\n     }\n     true\n }\n+\n+#[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n+pub struct InstallGitHook;\n+\n+impl Step for InstallGitHook {\n+    type Output = ();\n+\n+    /// Runs the `install-git-hook` tool.\n+    ///\n+    /// This tool in `src/tools` installs a git hook to automatically run\n+    /// `tidy --bless` before each commit, so you don't forget to do it\n+    fn run(self, builder: &Builder<'_>) {\n+        builder.info(\"Installing git hook\");\n+        try_run(builder, &mut builder.tool_cmd(Tool::InstallGitHook).arg(&builder.src));\n+    }\n+\n+    fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {\n+        run.path(\"src/tools/install-git-hook\")\n+    }\n+\n+    fn make_run(run: RunConfig<'_>) {\n+        run.builder.ensure(InstallGitHook);\n+    }\n+}"}, {"sha": "5d9bdc9d843f0e438978eace3dcf469f6f474794", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -365,6 +365,7 @@ bootstrap_tool!(\n     RustInstaller, \"src/tools/rust-installer\", \"fabricate\", is_external_tool = true;\n     RustdocTheme, \"src/tools/rustdoc-themes\", \"rustdoc-themes\";\n     ExpandYamlAnchors, \"src/tools/expand-yaml-anchors\", \"expand-yaml-anchors\";\n+    InstallGitHook, \"src/tools/install-git-hook\", \"install-git-hook\";\n );\n \n #[derive(Debug, Copy, Clone, Hash, PartialEq, Eq, Ord, PartialOrd)]"}, {"sha": "1b089a84da880f56d2b1e385eb721944c35a8d4c", "filename": "src/tools/install-git-hook/Cargo.toml", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Finstall-git-hook%2FCargo.toml?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -0,0 +1,5 @@\n+[package]\n+name = \"install-git-hook\"\n+version = \"0.1.0\"\n+authors = [\"Cass Fridkin <cass@swag.lgbt>\"]\n+edition = \"2018\"\n\\ No newline at end of file"}, {"sha": "64b5233dfb398e2160bea2d0ff645eec763e78cb", "filename": "src/tools/install-git-hook/src/main.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fmain.rs?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -0,0 +1,16 @@\n+//! Small helper program to install a git hook to automatically run\n+//! `x.py test tidy --bless` before each commit.\n+\n+use std::env;\n+use std::fs;\n+use std::path::PathBuf;\n+\n+fn main() {\n+    let root_path: PathBuf = env::args_os().nth(1).expect(\"need path to root of repo\").into();\n+    let script_path: PathBuf = root_path.join(\"src/tools/install-git-hook/src/pre-commit.sh\");\n+    let hook_path: PathBuf = root_path.join(\".git/hooks/pre-commit\");\n+\n+    fs::copy(&script_path, &hook_path).expect(\n+        format!(\"Failed to copy pre-commit script to {}\", &hook_path.to_string_lossy()).as_str(),\n+    );\n+}"}, {"sha": "f47ca3e039ac990994893c191fc572afad2e59d2", "filename": "src/tools/install-git-hook/src/pre-commit.sh", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fpre-commit.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a009e2838b25df2761093d727d322a59f69d8f68/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fpre-commit.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Finstall-git-hook%2Fsrc%2Fpre-commit.sh?ref=a009e2838b25df2761093d727d322a59f69d8f68", "patch": "@@ -0,0 +1,18 @@\n+#!/bin/sh\n+#\n+# Call `tidy --bless` before each commit\n+#\n+# To enable this hook, run `./x.py run install-git-hook`.\n+# To disable it, run `./x.py run install-git-hook --remove`\n+set -Eeuo pipefail\n+\n+ROOT_DIR=$(git rev-parse --show-toplevel);\n+COMMAND=\"$ROOT_DIR/x.py test tidy --bless\";\n+\n+if [[ \"$OSTYPE\" == \"msys\" || \"$OSTYPE\" == \"win32\" ]]; then\n+  COMMAND=\"python $COMMAND\"\n+fi\n+\n+echo \"Running pre-commit script $COMMAND\";\n+\n+$COMMAND;"}]}