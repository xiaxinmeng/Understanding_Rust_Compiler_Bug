{"sha": "a73b424e3bcf3e211f87d5a9b175a89231848c6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3M2I0MjRlM2JjZjNlMjExZjg3ZDVhOWIxNzVhODkyMzE4NDhjNmQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-09-06T18:57:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-06T18:57:32Z"}, "message": "Merge #1783\n\n1783: simplify r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "ecad5e9135c43a94be8cd6304f0d9bc200eef542", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecad5e9135c43a94be8cd6304f0d9bc200eef542"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a73b424e3bcf3e211f87d5a9b175a89231848c6d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdcqwcCRBK7hj4Ov3rIwAAdHIIAJTGEhFHcSaHac1kSST4gzQ7\nq5j02kbke3YJ+WBqYlf4CJtFoHN++jDoJ/L3P9Fktr82OJ3g1yxy6yiLIknCjjph\n+aK1n5zC5w/InCCUeXx3Pu+YunGvwI1YxSWTyH1c8NfBMARhEpm8a/C7omMbEj5S\nvH8fkVqTDLuf8zHoUTL0BMG50YFd7GH+V0M3GL0VaxhodnY9zeOx96R+TNl3qDt4\nCzEyMaItPMcYsLuKPzOEbPLOM2fGj1kWwtFvX4AM7Gfn+mXo4C/B2Cg/W7cMe7El\n5fYQPngFcI5SMkxdGOkiq2BFivM8ndjZbB88CtXTJls9/9eJZihYdyPDBvN0drw=\n=2Lr9\n-----END PGP SIGNATURE-----\n", "payload": "tree ecad5e9135c43a94be8cd6304f0d9bc200eef542\nparent 3bd99af197ea238043b364b995ec6d6069804635\nparent 6c11935712d1c4aeb8549af12112b0f8dd521944\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1567796252 +0000\ncommitter GitHub <noreply@github.com> 1567796252 +0000\n\nMerge #1783\n\n1783: simplify r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a73b424e3bcf3e211f87d5a9b175a89231848c6d", "html_url": "https://github.com/rust-lang/rust/commit/a73b424e3bcf3e211f87d5a9b175a89231848c6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a73b424e3bcf3e211f87d5a9b175a89231848c6d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bd99af197ea238043b364b995ec6d6069804635", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bd99af197ea238043b364b995ec6d6069804635", "html_url": "https://github.com/rust-lang/rust/commit/3bd99af197ea238043b364b995ec6d6069804635"}, {"sha": "6c11935712d1c4aeb8549af12112b0f8dd521944", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c11935712d1c4aeb8549af12112b0f8dd521944", "html_url": "https://github.com/rust-lang/rust/commit/6c11935712d1c4aeb8549af12112b0f8dd521944"}], "stats": {"total": 78, "additions": 40, "deletions": 38}, "files": [{"sha": "67fb7ba4ef298293db54ca6fd9cc7af47cb3141e", "filename": "crates/ra_ide_api/src/completion/complete_scope.rs", "status": "modified", "additions": 40, "deletions": 38, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/a73b424e3bcf3e211f87d5a9b175a89231848c6d/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a73b424e3bcf3e211f87d5a9b175a89231848c6d/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=a73b424e3bcf3e211f87d5a9b175a89231848c6d", "patch": "@@ -6,46 +6,48 @@ use rustc_hash::FxHashMap;\n use crate::completion::{CompletionContext, CompletionItem, CompletionKind, Completions};\n \n pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) {\n-    if ctx.is_trivial_path {\n-        let names = ctx.analyzer.all_names(ctx.db);\n-        names.into_iter().for_each(|(name, res)| acc.add_resolution(ctx, name.to_string(), &res));\n+    if !ctx.is_trivial_path {\n+        return;\n+    }\n \n-        // auto-import\n-        // We fetch ident from the original file, because we need to pre-filter auto-imports\n-        if ast::NameRef::cast(ctx.token.parent()).is_some() {\n-            let import_resolver = ImportResolver::new();\n-            let import_names = import_resolver.all_names(ctx.token.text());\n-            import_names.into_iter().for_each(|(name, path)| {\n-                let edit = {\n-                    let mut builder = TextEditBuilder::default();\n-                    builder.replace(ctx.source_range(), name.to_string());\n-                    auto_import::auto_import_text_edit(\n-                        &ctx.token.parent(),\n-                        &ctx.token.parent(),\n-                        &path,\n-                        &mut builder,\n-                    );\n-                    builder.finish()\n-                };\n+    let names = ctx.analyzer.all_names(ctx.db);\n+    names.into_iter().for_each(|(name, res)| acc.add_resolution(ctx, name.to_string(), &res));\n \n-                // Hack: copied this check form conv.rs beacause auto import can produce edits\n-                // that invalidate assert in conv_with.\n-                if edit\n-                    .as_atoms()\n-                    .iter()\n-                    .filter(|atom| !ctx.source_range().is_subrange(&atom.delete))\n-                    .all(|atom| ctx.source_range().intersection(&atom.delete).is_none())\n-                {\n-                    CompletionItem::new(\n-                        CompletionKind::Reference,\n-                        ctx.source_range(),\n-                        build_import_label(&name, &path),\n-                    )\n-                    .text_edit(edit)\n-                    .add_to(acc);\n-                }\n-            });\n-        }\n+    // auto-import\n+    // We fetch ident from the original file, because we need to pre-filter auto-imports\n+    if ast::NameRef::cast(ctx.token.parent()).is_some() {\n+        let import_resolver = ImportResolver::new();\n+        let import_names = import_resolver.all_names(ctx.token.text());\n+        import_names.into_iter().for_each(|(name, path)| {\n+            let edit = {\n+                let mut builder = TextEditBuilder::default();\n+                builder.replace(ctx.source_range(), name.to_string());\n+                auto_import::auto_import_text_edit(\n+                    &ctx.token.parent(),\n+                    &ctx.token.parent(),\n+                    &path,\n+                    &mut builder,\n+                );\n+                builder.finish()\n+            };\n+\n+            // Hack: copied this check form conv.rs beacause auto import can produce edits\n+            // that invalidate assert in conv_with.\n+            if edit\n+                .as_atoms()\n+                .iter()\n+                .filter(|atom| !ctx.source_range().is_subrange(&atom.delete))\n+                .all(|atom| ctx.source_range().intersection(&atom.delete).is_none())\n+            {\n+                CompletionItem::new(\n+                    CompletionKind::Reference,\n+                    ctx.source_range(),\n+                    build_import_label(&name, &path),\n+                )\n+                .text_edit(edit)\n+                .add_to(acc);\n+            }\n+        });\n     }\n }\n "}]}