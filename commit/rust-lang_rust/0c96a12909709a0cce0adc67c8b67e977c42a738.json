{"sha": "0c96a12909709a0cce0adc67c8b67e977c42a738", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBjOTZhMTI5MDk3MDlhMGNjZTBhZGM2N2M4YjY3ZTk3N2M0MmE3Mzg=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-10-07T08:36:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-07T08:36:45Z"}, "message": "Rollup merge of #63948 - crlf0710:path_to_raw_dylib, r=Centril\n\nAdd feature gate for raw_dylib.\n\nThis PR adds the feature gate for RFC 2627 (https://github.com/rust-lang/rust/issues/58713). It doesn't contain the actual functionality.\nAdd I'm not sure whether i did it correctly, since this is the first time i did this.\n\nr? @Centril", "tree": {"sha": "c61006e8acfdf7ebd7694702ab949b281d634cf8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c61006e8acfdf7ebd7694702ab949b281d634cf8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0c96a12909709a0cce0adc67c8b67e977c42a738", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdmvkdCRBK7hj4Ov3rIwAAdHIIAIitt+c1KLFfJO7mJyE59Sbv\nbiSkr8BHt4mKaMfgIaACe7ymF91tTw6YD3d3ssVXbQOUANdgR9uNbbpT3o47aiI6\n3O2ELeLgh4QeO0lSKghO98SJp0qMa4RltG343TdDOffpy2jCTOap8UV+N/S8+Eqx\nWutqkZb3fdo3wTjBEzTPm5Rg0Gz+Y8HOWNumKwIQ6CjMOtNhltfS+F0ws+kgk0gG\nigZhXadV+AfNgYYYPJdEzWo25VkF4pb/NDmReNpcfANV20CReEGOuLNp+tF3o+Ee\nJXW/GDD1D6SaJP2I4O5Chf6OPEqv9KtFJwdNZljtZtekqV+MwgoFjGuXa3zIjs8=\n=tYk1\n-----END PGP SIGNATURE-----\n", "payload": "tree c61006e8acfdf7ebd7694702ab949b281d634cf8\nparent 4ac4809ccf5f77083ae7155dcc83e921341c2614\nparent 2dab187024a80e46689149399249668765c512ea\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1570437405 +0200\ncommitter GitHub <noreply@github.com> 1570437405 +0200\n\nRollup merge of #63948 - crlf0710:path_to_raw_dylib, r=Centril\n\nAdd feature gate for raw_dylib.\n\nThis PR adds the feature gate for RFC 2627 (https://github.com/rust-lang/rust/issues/58713). It doesn't contain the actual functionality.\nAdd I'm not sure whether i did it correctly, since this is the first time i did this.\n\nr? @Centril\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0c96a12909709a0cce0adc67c8b67e977c42a738", "html_url": "https://github.com/rust-lang/rust/commit/0c96a12909709a0cce0adc67c8b67e977c42a738", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0c96a12909709a0cce0adc67c8b67e977c42a738/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4ac4809ccf5f77083ae7155dcc83e921341c2614", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ac4809ccf5f77083ae7155dcc83e921341c2614", "html_url": "https://github.com/rust-lang/rust/commit/4ac4809ccf5f77083ae7155dcc83e921341c2614"}, {"sha": "2dab187024a80e46689149399249668765c512ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dab187024a80e46689149399249668765c512ea", "html_url": "https://github.com/rust-lang/rust/commit/2dab187024a80e46689149399249668765c512ea"}], "stats": {"total": 225, "additions": 221, "deletions": 4}, "files": [{"sha": "30b050366887766b8b8844235d9f02e966a1821e", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -2669,6 +2669,11 @@ pub struct CodegenFnAttrs {\n     /// probably isn't set when this is set, this is for foreign items while\n     /// `#[export_name]` is for Rust-defined functions.\n     pub link_name: Option<Symbol>,\n+    /// The `#[link_ordinal = \"...\"]` attribute, indicating an ordinal an\n+    /// imported function has in the dynamic library. Note that this must not\n+    /// be set when `link_name` is set. This is for foreign items with the\n+    /// \"raw-dylib\" kind.\n+    pub link_ordinal: Option<usize>,\n     /// The `#[target_feature(enable = \"...\")]` attribute and the enabled\n     /// features (only enabled features are supported right now).\n     pub target_features: Vec<Symbol>,\n@@ -2728,6 +2733,7 @@ impl CodegenFnAttrs {\n             optimize: OptimizeAttr::None,\n             export_name: None,\n             link_name: None,\n+            link_ordinal: None,\n             target_features: vec![],\n             linkage: None,\n             link_section: None,"}, {"sha": "065959ed09fd1da00ab9385ed7ae4f1785d5ffef", "filename": "src/librustc/middle/cstore.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcstore.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -96,6 +96,8 @@ pub enum NativeLibraryKind {\n     NativeStaticNobundle,\n     /// macOS-specific\n     NativeFramework,\n+    /// Windows dynamic library without import library.\n+    NativeRawDylib,\n     /// default way to specify a dynamic library\n     NativeUnknown,\n }"}, {"sha": "50d9c088a85e975fbd0e724eb4c8ee208803aba7", "filename": "src/librustc_codegen_ssa/back/link.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -323,6 +323,7 @@ fn link_rlib<'a, B: ArchiveBuilder<'a>>(sess: &'a Session,\n             NativeLibraryKind::NativeStatic => {}\n             NativeLibraryKind::NativeStaticNobundle |\n             NativeLibraryKind::NativeFramework |\n+            NativeLibraryKind::NativeRawDylib |\n             NativeLibraryKind::NativeUnknown => continue,\n         }\n         if let Some(name) = lib.name {\n@@ -883,7 +884,8 @@ pub fn print_native_static_libs(sess: &Session, all_native_libs: &[NativeLibrary\n                     Some(format!(\"-framework {}\", name))\n                 },\n                 // These are included, no need to print them\n-                NativeLibraryKind::NativeStatic => None,\n+                NativeLibraryKind::NativeStatic |\n+                NativeLibraryKind::NativeRawDylib => None,\n             }\n         })\n         .collect();\n@@ -1293,7 +1295,11 @@ pub fn add_local_native_libraries(cmd: &mut dyn Linker,\n             NativeLibraryKind::NativeUnknown => cmd.link_dylib(name),\n             NativeLibraryKind::NativeFramework => cmd.link_framework(name),\n             NativeLibraryKind::NativeStaticNobundle => cmd.link_staticlib(name),\n-            NativeLibraryKind::NativeStatic => cmd.link_whole_staticlib(name, &search_path)\n+            NativeLibraryKind::NativeStatic => cmd.link_whole_staticlib(name, &search_path),\n+            NativeLibraryKind::NativeRawDylib => {\n+                // FIXME(#58713): Proper handling for raw dylibs.\n+                bug!(\"raw_dylib feature not yet implemented\");\n+            },\n         }\n     }\n }\n@@ -1678,7 +1684,11 @@ pub fn add_upstream_native_libraries(\n                 // ignore statically included native libraries here as we've\n                 // already included them when we included the rust library\n                 // previously\n-                NativeLibraryKind::NativeStatic => {}\n+                NativeLibraryKind::NativeStatic => {},\n+                NativeLibraryKind::NativeRawDylib => {\n+                    // FIXME(#58713): Proper handling for raw dylibs.\n+                    bug!(\"raw_dylib feature not yet implemented\");\n+                },\n             }\n         }\n     }"}, {"sha": "cce0900bef3dde658af98a6113cfcb74ae5402cb", "filename": "src/librustc_metadata/cstore_impl.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_metadata%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_metadata%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcstore_impl.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -270,7 +270,11 @@ pub fn provide(providers: &mut Providers<'_>) {\n     // resolve! Does this work? Unsure! That's what the issue is about\n     *providers = Providers {\n         is_dllimport_foreign_item: |tcx, id| {\n-            tcx.native_library_kind(id) == Some(NativeLibraryKind::NativeUnknown)\n+            match tcx.native_library_kind(id) {\n+                Some(NativeLibraryKind::NativeUnknown) |\n+                Some(NativeLibraryKind::NativeRawDylib) => true,\n+                _ => false,\n+            }\n         },\n         is_statically_included_foreign_item: |tcx, id| {\n             match tcx.native_library_kind(id) {"}, {"sha": "24ed8fcd8dd09c11d5bba67b6d533c8c8b8a9106", "filename": "src/librustc_metadata/native_libs.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_metadata%2Fnative_libs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_metadata%2Fnative_libs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fnative_libs.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -73,6 +73,7 @@ impl ItemLikeVisitor<'tcx> for Collector<'tcx> {\n                         \"static-nobundle\" => cstore::NativeStaticNobundle,\n                         \"dylib\" => cstore::NativeUnknown,\n                         \"framework\" => cstore::NativeFramework,\n+                        \"raw-dylib\" => cstore::NativeRawDylib,\n                         k => {\n                             struct_span_err!(self.tcx.sess, item.span(), E0458,\n                                       \"unknown kind: `{}`\", k)\n@@ -169,6 +170,14 @@ impl Collector<'tcx> {\n                                            GateIssue::Language,\n                                            \"kind=\\\"static-nobundle\\\" is unstable\");\n         }\n+        if lib.kind == cstore::NativeRawDylib &&\n+           !self.tcx.features().raw_dylib {\n+            feature_gate::emit_feature_err(&self.tcx.sess.parse_sess,\n+                                           sym::raw_dylib,\n+                                           span.unwrap_or_else(|| syntax_pos::DUMMY_SP),\n+                                           GateIssue::Language,\n+                                           \"kind=\\\"raw-dylib\\\" is unstable\");\n+        }\n         self.libs.push(lib);\n     }\n "}, {"sha": "64eca1371447b2519cd6d14630ac812569f9adef", "filename": "src/librustc_typeck/collect.rs", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_typeck%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibrustc_typeck%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcollect.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -2560,6 +2560,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n     let whitelist = tcx.target_features_whitelist(LOCAL_CRATE);\n \n     let mut inline_span = None;\n+    let mut link_ordinal_span = None;\n     for attr in attrs.iter() {\n         if attr.check_name(sym::cold) {\n             codegen_fn_attrs.flags |= CodegenFnAttrFlags::COLD;\n@@ -2641,6 +2642,11 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n             }\n         } else if attr.check_name(sym::link_name) {\n             codegen_fn_attrs.link_name = attr.value_str();\n+        } else if attr.check_name(sym::link_ordinal) {\n+            link_ordinal_span = Some(attr.span);\n+            if let ordinal @ Some(_) = check_link_ordinal(tcx, attr) {\n+                codegen_fn_attrs.link_ordinal = ordinal;\n+            }\n         }\n     }\n \n@@ -2718,6 +2724,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n     // purpose functions as they wouldn't have the right target features\n     // enabled. For that reason we also forbid #[inline(always)] as it can't be\n     // respected.\n+\n     if codegen_fn_attrs.target_features.len() > 0 {\n         if codegen_fn_attrs.inline == InlineAttr::Always {\n             if let Some(span) = inline_span {\n@@ -2742,6 +2749,7 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n         codegen_fn_attrs.export_name = Some(name);\n         codegen_fn_attrs.link_name = Some(name);\n     }\n+    check_link_name_xor_ordinal(tcx, &codegen_fn_attrs, link_ordinal_span);\n \n     // Internal symbols to the standard library all have no_mangle semantics in\n     // that they have defined symbol names present in the function name. This\n@@ -2752,3 +2760,48 @@ fn codegen_fn_attrs(tcx: TyCtxt<'_>, id: DefId) -> CodegenFnAttrs {\n \n     codegen_fn_attrs\n }\n+\n+fn check_link_ordinal(tcx: TyCtxt<'_>, attr: &ast::Attribute) -> Option<usize> {\n+    use syntax::ast::{Lit, LitIntType, LitKind};\n+    let meta_item_list = attr.meta_item_list();\n+    let meta_item_list: Option<&[ast::NestedMetaItem]> = meta_item_list.as_ref().map(Vec::as_ref);\n+    let sole_meta_list = match meta_item_list {\n+        Some([item]) => item.literal(),\n+        _ => None,\n+    };\n+    if let Some(Lit { kind: LitKind::Int(ordinal, LitIntType::Unsuffixed), .. }) = sole_meta_list {\n+        if *ordinal <= std::usize::MAX as u128 {\n+            Some(*ordinal as usize)\n+        } else {\n+            let msg = format!(\n+                \"ordinal value in `link_ordinal` is too large: `{}`\",\n+                &ordinal\n+            );\n+            tcx.sess.struct_span_err(attr.span, &msg)\n+                .note(\"the value may not exceed `std::usize::MAX`\")\n+                .emit();\n+            None\n+        }\n+    } else {\n+        tcx.sess.struct_span_err(attr.span, \"illegal ordinal format in `link_ordinal`\")\n+            .note(\"an unsuffixed integer value, e.g., `1`, is expected\")\n+            .emit();\n+        None\n+    }\n+}\n+\n+fn check_link_name_xor_ordinal(\n+    tcx: TyCtxt<'_>,\n+    codegen_fn_attrs: &CodegenFnAttrs,\n+    inline_span: Option<Span>,\n+) {\n+    if codegen_fn_attrs.link_name.is_none() || codegen_fn_attrs.link_ordinal.is_none() {\n+        return;\n+    }\n+    let msg = \"cannot use `#[link_name]` with `#[link_ordinal]`\";\n+    if let Some(span) = inline_span {\n+        tcx.sess.span_err(span, msg);\n+    } else {\n+        tcx.sess.err(msg);\n+    }\n+}"}, {"sha": "19ef430318d3ed1466080eb762fb2a8c16a7610a", "filename": "src/libsyntax/feature_gate/active.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax%2Ffeature_gate%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax%2Ffeature_gate%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate%2Factive.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -522,6 +522,9 @@ declare_features! (\n     /// Allows the definition of `const extern fn` and `const unsafe extern fn`.\n     (active, const_extern_fn, \"1.40.0\", Some(64926), None),\n \n+    // Allows the use of raw-dylibs (RFC 2627).\n+    (active, raw_dylib, \"1.40.0\", Some(58713), None),\n+\n     // -------------------------------------------------------------------------\n     // feature-group-end: actual feature gates\n     // -------------------------------------------------------------------------\n@@ -536,4 +539,5 @@ pub const INCOMPLETE_FEATURES: &[Symbol] = &[\n     sym::const_generics,\n     sym::or_patterns,\n     sym::let_chains,\n+    sym::raw_dylib,\n ];"}, {"sha": "c12d0ce06ffefd5d37acd4b843422299e7d664ef", "filename": "src/libsyntax/feature_gate/builtin_attrs.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate%2Fbuiltin_attrs.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -276,6 +276,10 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n         \"the `link_args` attribute is experimental and not portable across platforms, \\\n         it is recommended to use `#[link(name = \\\"foo\\\")] instead\",\n     ),\n+    gated!(\n+        link_ordinal, Whitelisted, template!(List: \"ordinal\"), raw_dylib,\n+        experimental!(link_ordinal)\n+    ),\n \n     // Plugins:\n     ("}, {"sha": "c7230d5ca15224e5276b6deb2c6edf1623f0de51", "filename": "src/libsyntax_pos/symbol.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax_pos%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Flibsyntax_pos%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Fsymbol.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -389,6 +389,7 @@ symbols! {\n         link_cfg,\n         link_llvm_intrinsics,\n         link_name,\n+        link_ordinal,\n         link_section,\n         LintPass,\n         lint_reasons,\n@@ -531,6 +532,7 @@ symbols! {\n         RangeInclusive,\n         RangeTo,\n         RangeToInclusive,\n+        raw_dylib,\n         raw_identifiers,\n         Ready,\n         reason,"}, {"sha": "14345bad6e5b9b8127b671900819146ec9cf7674", "filename": "src/test/ui/rfc-2627-raw-dylib/feature-gate-raw-dylib-2.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,8 @@\n+#[link(name=\"foo\")]\n+extern {\n+    #[link_ordinal(42)]\n+    //~^ ERROR: the `#[link_ordinal]` attribute is an experimental feature\n+    fn foo();\n+}\n+\n+fn main() {}"}, {"sha": "0869d7ad48a8c4b43858c3e596cc908ac083733f", "filename": "src/test/ui/rfc-2627-raw-dylib/feature-gate-raw-dylib-2.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib-2.stderr?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: the `#[link_ordinal]` attribute is an experimental feature\n+  --> $DIR/feature-gate-raw-dylib-2.rs:3:5\n+   |\n+LL |     #[link_ordinal(42)]\n+   |     ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/58713\n+   = help: add `#![feature(raw_dylib)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "f0f83e0426dd683f1e6aa04f1503af4dc50cde76", "filename": "src/test/ui/rfc-2627-raw-dylib/feature-gate-raw-dylib.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,5 @@\n+#[link(name=\"foo\", kind=\"raw-dylib\")]\n+//~^ ERROR: kind=\"raw-dylib\" is unstable\n+extern {}\n+\n+fn main() {}"}, {"sha": "0ca9de28be1ac00d2d5d54768c6e8b199c978226", "filename": "src/test/ui/rfc-2627-raw-dylib/feature-gate-raw-dylib.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Ffeature-gate-raw-dylib.stderr?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: kind=\"raw-dylib\" is unstable\n+  --> $DIR/feature-gate-raw-dylib.rs:1:1\n+   |\n+LL | #[link(name=\"foo\", kind=\"raw-dylib\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: for more information, see https://github.com/rust-lang/rust/issues/58713\n+   = help: add `#![feature(raw_dylib)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}, {"sha": "5769366fb45a49ef5811a594904c77966f7e1bf7", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-and-name.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,12 @@\n+#![feature(raw_dylib)]\n+//~^ WARN the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+\n+#[link(name=\"foo\")]\n+extern {\n+    #[link_name=\"foo\"]\n+    #[link_ordinal(42)]\n+    //~^ ERROR cannot use `#[link_name]` with `#[link_ordinal]`\n+    fn foo();\n+}\n+\n+fn main() {}"}, {"sha": "303a1c02eb85facda66d59be53eec0264d5dc649", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-and-name.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,16 @@\n+warning: the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+  --> $DIR/link-ordinal-and-name.rs:1:12\n+   |\n+LL | #![feature(raw_dylib)]\n+   |            ^^^^^^^^^\n+   |\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error: cannot use `#[link_name]` with `#[link_ordinal]`\n+  --> $DIR/link-ordinal-and-name.rs:7:5\n+   |\n+LL |     #[link_ordinal(42)]\n+   |     ^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "82fb1151c23df9d7db661d94003a923ec2bc18a0", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-invalid-format.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,11 @@\n+#![feature(raw_dylib)]\n+//~^ WARN the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+\n+#[link(name=\"foo\")]\n+extern {\n+    #[link_ordinal(\"JustMonika\")]\n+    //~^ ERROR illegal ordinal format in `link_ordinal`\n+    fn foo();\n+}\n+\n+fn main() {}"}, {"sha": "14556a7262b1ca863d9762fcbdfae3bf52336ebb", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-invalid-format.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,18 @@\n+warning: the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+  --> $DIR/link-ordinal-invalid-format.rs:1:12\n+   |\n+LL | #![feature(raw_dylib)]\n+   |            ^^^^^^^^^\n+   |\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error: illegal ordinal format in `link_ordinal`\n+  --> $DIR/link-ordinal-invalid-format.rs:6:5\n+   |\n+LL |     #[link_ordinal(\"JustMonika\")]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: an unsuffixed integer value, e.g., `1`, is expected\n+\n+error: aborting due to previous error\n+"}, {"sha": "69596ad04fff3cbe7816704d94b41838c28f26fb", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-large.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,11 @@\n+#![feature(raw_dylib)]\n+//~^ WARN the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+\n+#[link(name=\"foo\")]\n+extern {\n+    #[link_ordinal(18446744073709551616)]\n+    //~^ ERROR ordinal value in `link_ordinal` is too large: `18446744073709551616`\n+    fn foo();\n+}\n+\n+fn main() {}"}, {"sha": "b3b22f9776df74b4258e7667f97c3a999210802b", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-large.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0c96a12909709a0cce0adc67c8b67e977c42a738/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr?ref=0c96a12909709a0cce0adc67c8b67e977c42a738", "patch": "@@ -0,0 +1,18 @@\n+warning: the feature `raw_dylib` is incomplete and may cause the compiler to crash\n+  --> $DIR/link-ordinal-too-large.rs:1:12\n+   |\n+LL | #![feature(raw_dylib)]\n+   |            ^^^^^^^^^\n+   |\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error: ordinal value in `link_ordinal` is too large: `18446744073709551616`\n+  --> $DIR/link-ordinal-too-large.rs:6:5\n+   |\n+LL |     #[link_ordinal(18446744073709551616)]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: the value may not exceed `std::usize::MAX`\n+\n+error: aborting due to previous error\n+"}]}