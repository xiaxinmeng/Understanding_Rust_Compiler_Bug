{"sha": "a907b7c51929eccd5af8774c60ac412772f2cacd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5MDdiN2M1MTkyOWVjY2Q1YWY4Nzc0YzYwYWM0MTI3NzJmMmNhY2Q=", "commit": {"author": {"name": "Alessandro Decina", "email": "alessandro.d@gmail.com", "date": "2019-07-08T08:13:30Z"}, "committer": {"name": "Alessandro Decina", "email": "alessandro.d@gmail.com", "date": "2019-07-15T00:28:17Z"}, "message": "Normalize type parameters in create_mono_items_for_default_impls.\n\nFixes http://github.com/rust-lang/rust/issues/58375", "tree": {"sha": "b2b64a499a9f7b3508fcb1edab05f500bee4c091", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2b64a499a9f7b3508fcb1edab05f500bee4c091"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a907b7c51929eccd5af8774c60ac412772f2cacd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a907b7c51929eccd5af8774c60ac412772f2cacd", "html_url": "https://github.com/rust-lang/rust/commit/a907b7c51929eccd5af8774c60ac412772f2cacd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a907b7c51929eccd5af8774c60ac412772f2cacd/comments", "author": {"login": "alessandrod", "id": 62002, "node_id": "MDQ6VXNlcjYyMDAy", "avatar_url": "https://avatars.githubusercontent.com/u/62002?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alessandrod", "html_url": "https://github.com/alessandrod", "followers_url": "https://api.github.com/users/alessandrod/followers", "following_url": "https://api.github.com/users/alessandrod/following{/other_user}", "gists_url": "https://api.github.com/users/alessandrod/gists{/gist_id}", "starred_url": "https://api.github.com/users/alessandrod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alessandrod/subscriptions", "organizations_url": "https://api.github.com/users/alessandrod/orgs", "repos_url": "https://api.github.com/users/alessandrod/repos", "events_url": "https://api.github.com/users/alessandrod/events{/privacy}", "received_events_url": "https://api.github.com/users/alessandrod/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alessandrod", "id": 62002, "node_id": "MDQ6VXNlcjYyMDAy", "avatar_url": "https://avatars.githubusercontent.com/u/62002?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alessandrod", "html_url": "https://github.com/alessandrod", "followers_url": "https://api.github.com/users/alessandrod/followers", "following_url": "https://api.github.com/users/alessandrod/following{/other_user}", "gists_url": "https://api.github.com/users/alessandrod/gists{/gist_id}", "starred_url": "https://api.github.com/users/alessandrod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alessandrod/subscriptions", "organizations_url": "https://api.github.com/users/alessandrod/orgs", "repos_url": "https://api.github.com/users/alessandrod/repos", "events_url": "https://api.github.com/users/alessandrod/events{/privacy}", "received_events_url": "https://api.github.com/users/alessandrod/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83e4eed16ef7adb54a802e3b684427e0e912c2b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/83e4eed16ef7adb54a802e3b684427e0e912c2b7", "html_url": "https://github.com/rust-lang/rust/commit/83e4eed16ef7adb54a802e3b684427e0e912c2b7"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "acf438dc66bff6da718f0bb252579a8d98b17e3c", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a907b7c51929eccd5af8774c60ac412772f2cacd/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a907b7c51929eccd5af8774c60ac412772f2cacd/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=a907b7c51929eccd5af8774c60ac412772f2cacd", "patch": "@@ -1166,8 +1166,13 @@ fn create_mono_items_for_default_impls<'tcx>(\n                         }\n                     });\n \n+                    let param_env = ty::ParamEnv::reveal_all();\n+                    let substs = tcx.normalize_erasing_regions(\n+                        param_env,\n+                        substs,\n+                    );\n                     let instance = ty::Instance::resolve(tcx,\n-                                                         ty::ParamEnv::reveal_all(),\n+                                                         param_env,\n                                                          method.def_id,\n                                                          substs).unwrap();\n "}, {"sha": "e4ae72927a4ed5b07baa6cff295e3aff124e0f35", "filename": "src/test/run-pass/issue-58375-monomorphize-default-impls.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/a907b7c51929eccd5af8774c60ac412772f2cacd/src%2Ftest%2Frun-pass%2Fissue-58375-monomorphize-default-impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a907b7c51929eccd5af8774c60ac412772f2cacd/src%2Ftest%2Frun-pass%2Fissue-58375-monomorphize-default-impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-58375-monomorphize-default-impls.rs?ref=a907b7c51929eccd5af8774c60ac412772f2cacd", "patch": "@@ -0,0 +1,23 @@\n+// Make sure that the mono-item collector does not crash when trying to\n+// instantiate a default impl for DecodeUtf16<<u8 as A>::Item>\n+// See https://github.com/rust-lang/rust/issues/58375\n+// compile-flags:-C link-dead-code\n+\n+#![crate_type = \"rlib\"]\n+\n+pub struct DecodeUtf16<I>(I);\n+\n+pub trait Arbitrary {\n+    fn arbitrary() {}\n+}\n+\n+pub trait A {\n+    type Item;\n+}\n+\n+impl A for u8 {\n+    type Item = char;\n+}\n+\n+impl Arbitrary for DecodeUtf16<<u8 as A>::Item>  {\n+}\n\\ No newline at end of file"}]}