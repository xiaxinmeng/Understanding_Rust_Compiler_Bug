{"sha": "8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "node_id": "C_kwDOAAsO6NoAKDhmNWZhZGE4NmRmMjZhYWNjYmY0ZjVlNTg1MWFjMDQwYjVlYTU4NTI", "commit": {"author": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-08-21T04:51:33Z"}, "committer": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-08-30T18:27:42Z"}, "message": "ADD - migrate InvalidDefPath to new diagnostics infra", "tree": {"sha": "d08a9e2d4932bde65e0da0652d53c64fde2db123", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d08a9e2d4932bde65e0da0652d53c64fde2db123"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "html_url": "https://github.com/rust-lang/rust/commit/8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/comments", "author": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd83bbc93adce97e34c1c4d5d8d74f7b19068326", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd83bbc93adce97e34c1c4d5d8d74f7b19068326", "html_url": "https://github.com/rust-lang/rust/commit/bd83bbc93adce97e34c1c4d5d8d74f7b19068326"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "55d6fbbf86f33029d86bae9e7cdf6f3f968922eb", "filename": "compiler/rustc_error_messages/locales/en-US/symbol_mangling.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsymbol_mangling.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsymbol_mangling.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fsymbol_mangling.ftl?ref=8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "patch": "@@ -3,3 +3,5 @@ symbol_mangling_invalid_symbol_name = symbol-name({$mangled_formatted})\n symbol_mangling_invalid_trait_item = demangling({$demangling_formatted})\n \n symbol_mangling_alt_invalid_trait_item = demangling-alt({$alt_demangling_formatted})\n+\n+symbol_mangling_invalid_def_path = def-path({$def_path})"}, {"sha": "4872dfa2653a6934be81421d84dbc89ec9b62be5", "filename": "compiler/rustc_symbol_mangling/src/errors.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_symbol_mangling%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_symbol_mangling%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Ferrors.rs?ref=8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "patch": "@@ -26,3 +26,11 @@ pub struct AltInvalidTraitItem {\n     pub span: Span,\n     pub alt_demangling_formatted: String,\n }\n+\n+#[derive(SessionDiagnostic)]\n+#[error(symbol_mangling::invalid_def_path)]\n+pub struct InvalidDefPath {\n+    #[primary_span]\n+    pub span: Span,\n+    pub def_path: String,\n+}"}, {"sha": "b1c4cab11eb8e184772f74b8535e329072254381", "filename": "compiler/rustc_symbol_mangling/src/test.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f5fada86df26aaccbf4f5e5851ac040b5ea5852/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs?ref=8f5fada86df26aaccbf4f5e5851ac040b5ea5852", "patch": "@@ -4,7 +4,7 @@\n //! def-path. This is used for unit testing the code that generates\n //! paths etc in all kinds of annoying scenarios.\n \n-use crate::errors::{AltInvalidTraitItem, InvalidSymbolName, InvalidTraitItem};\n+use crate::errors::{AltInvalidTraitItem, InvalidDefPath, InvalidSymbolName, InvalidTraitItem};\n use rustc_hir::def_id::LocalDefId;\n use rustc_middle::ty::print::with_no_trimmed_paths;\n use rustc_middle::ty::{subst::InternalSubsts, Instance, TyCtxt};\n@@ -77,8 +77,10 @@ impl SymbolNamesTest<'_> {\n         }\n \n         for attr in tcx.get_attrs(def_id.to_def_id(), DEF_PATH) {\n-            let path = with_no_trimmed_paths!(tcx.def_path_str(def_id.to_def_id()));\n-            tcx.sess.span_err(attr.span, &format!(\"def-path({})\", path));\n+            tcx.sess.emit_err(InvalidDefPath {\n+                span: attr.span,\n+                def_path: with_no_trimmed_paths!(tcx.def_path_str(def_id.to_def_id())),\n+            });\n         }\n     }\n }"}]}