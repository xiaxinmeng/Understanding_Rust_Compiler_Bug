{"sha": "41807938d2fbc7928d75b1d68ac08899682168a2", "node_id": "C_kwDOAAsO6NoAKDQxODA3OTM4ZDJmYmM3OTI4ZDc1YjFkNjhhYzA4ODk5NjgyMTY4YTI", "commit": {"author": {"name": "The 8472", "email": "git@infinite-source.de", "date": "2023-03-27T12:56:14Z"}, "committer": {"name": "The 8472", "email": "git@infinite-source.de", "date": "2023-03-27T14:03:30Z"}, "message": "fix advance_by impl for vec_deque and add tests", "tree": {"sha": "8f4c5b446fe3c09500a9d8d207f6a386d0f36553", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f4c5b446fe3c09500a9d8d207f6a386d0f36553"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41807938d2fbc7928d75b1d68ac08899682168a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41807938d2fbc7928d75b1d68ac08899682168a2", "html_url": "https://github.com/rust-lang/rust/commit/41807938d2fbc7928d75b1d68ac08899682168a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41807938d2fbc7928d75b1d68ac08899682168a2/comments", "author": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "committer": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9cd9da2cd1c365791c7bf41be5759ebc34180aa0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9cd9da2cd1c365791c7bf41be5759ebc34180aa0", "html_url": "https://github.com/rust-lang/rust/commit/9cd9da2cd1c365791c7bf41be5759ebc34180aa0"}], "stats": {"total": 37, "additions": 30, "deletions": 7}, "files": [{"sha": "e2b40f7912e0f308ca57b7652b75ef5430651733", "filename": "library/alloc/src/collections/vec_deque/into_iter.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/41807938d2fbc7928d75b1d68ac08899682168a2/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Finto_iter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41807938d2fbc7928d75b1d68ac08899682168a2/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Finto_iter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Finto_iter.rs?ref=41807938d2fbc7928d75b1d68ac08899682168a2", "patch": "@@ -56,10 +56,10 @@ impl<T, A: Allocator> Iterator for IntoIter<T, A> {\n \n     #[inline]\n     fn advance_by(&mut self, n: usize) -> Result<(), NonZeroUsize> {\n-        let rem = if self.inner.len < n {\n-            let len = self.inner.len;\n+        let len = self.inner.len;\n+        let rem = if len < n {\n             self.inner.clear();\n-            len - n\n+            n - len\n         } else {\n             self.inner.drain(..n);\n             0\n@@ -186,12 +186,12 @@ impl<T, A: Allocator> DoubleEndedIterator for IntoIter<T, A> {\n     #[inline]\n     fn advance_back_by(&mut self, n: usize) -> Result<(), NonZeroUsize> {\n         let len = self.inner.len;\n-        let rem = if len >= n {\n-            self.inner.truncate(len - n);\n-            0\n-        } else {\n+        let rem = if len < n {\n             self.inner.clear();\n             n - len\n+        } else {\n+            self.inner.truncate(len - n);\n+            0\n         };\n         NonZeroUsize::new(rem).map_or(Ok(()), Err)\n     }"}, {"sha": "ddc27e34ed994c7be4a86ac4f2f8f20647a2647c", "filename": "library/alloc/tests/vec_deque.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/41807938d2fbc7928d75b1d68ac08899682168a2/library%2Falloc%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/41807938d2fbc7928d75b1d68ac08899682168a2/library%2Falloc%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fvec_deque.rs?ref=41807938d2fbc7928d75b1d68ac08899682168a2", "patch": "@@ -1,3 +1,4 @@\n+use core::num::NonZeroUsize;\n use std::assert_matches::assert_matches;\n use std::collections::TryReserveErrorKind::*;\n use std::collections::{vec_deque::Drain, VecDeque};\n@@ -426,6 +427,28 @@ fn test_into_iter() {\n         assert_eq!(it.next(), Some(7));\n         assert_eq!(it.size_hint(), (5, Some(5)));\n     }\n+\n+    // advance_by\n+    {\n+        let mut d = VecDeque::new();\n+        for i in 0..=4 {\n+            d.push_back(i);\n+        }\n+        for i in 6..=8 {\n+            d.push_front(i);\n+        }\n+\n+        let mut it = d.into_iter();\n+        assert_eq!(it.advance_by(1), Ok(()));\n+        assert_eq!(it.next(), Some(7));\n+        assert_eq!(it.advance_back_by(1), Ok(()));\n+        assert_eq!(it.next_back(), Some(3));\n+\n+        let mut it = VecDeque::from(vec![1, 2, 3, 4, 5]).into_iter();\n+        assert_eq!(it.advance_by(10), Err(NonZeroUsize::new(5).unwrap()));\n+        let mut it = VecDeque::from(vec![1, 2, 3, 4, 5]).into_iter();\n+        assert_eq!(it.advance_back_by(10), Err(NonZeroUsize::new(5).unwrap()));\n+    }\n }\n \n #[test]"}]}