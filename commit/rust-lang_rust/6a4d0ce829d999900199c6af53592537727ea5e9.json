{"sha": "6a4d0ce829d999900199c6af53592537727ea5e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhNGQwY2U4MjlkOTk5OTAwMTk5YzZhZjUzNTkyNTM3NzI3ZWE1ZTk=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-07-29T22:10:10Z"}, "committer": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-07-29T22:29:38Z"}, "message": "Add in some missing cases for typestate with closures.", "tree": {"sha": "7a73bacf26ea1de9d49183a4cca64fcda29070c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a73bacf26ea1de9d49183a4cca64fcda29070c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a4d0ce829d999900199c6af53592537727ea5e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a4d0ce829d999900199c6af53592537727ea5e9", "html_url": "https://github.com/rust-lang/rust/commit/6a4d0ce829d999900199c6af53592537727ea5e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a4d0ce829d999900199c6af53592537727ea5e9/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7efbad674ab1cdec36af3143d7b64baa5133b067", "url": "https://api.github.com/repos/rust-lang/rust/commits/7efbad674ab1cdec36af3143d7b64baa5133b067", "html_url": "https://github.com/rust-lang/rust/commit/7efbad674ab1cdec36af3143d7b64baa5133b067"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "1a8119a1786eb3f64567ad04b09f6921c9052748", "filename": "src/comp/middle/tstate/auxiliary.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6a4d0ce829d999900199c6af53592537727ea5e9/src%2Fcomp%2Fmiddle%2Ftstate%2Fauxiliary.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a4d0ce829d999900199c6af53592537727ea5e9/src%2Fcomp%2Fmiddle%2Ftstate%2Fauxiliary.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fauxiliary.rs?ref=6a4d0ce829d999900199c6af53592537727ea5e9", "patch": "@@ -510,6 +510,9 @@ fn node_id_to_def_strict(cx: &ty::ctxt, id: node_id) -> def {\n fn node_id_to_def(ccx: &crate_ctxt, id: node_id) -> option::t[def] {\n     ret ccx.tcx.def_map.find(id);\n }\n+fn node_id_to_def_upvar(cx: &fn_ctxt, id: node_id) -> option::t[def] {\n+    ret freevars::def_lookup(cx.ccx.tcx, cx.id, id);\n+}\n \n fn norm_a_constraint(id: def_id, c: &constraint) -> norm_constraint[] {\n     alt c {"}, {"sha": "99293239cb9e1bd3caf93b8f7ab2d55892f965b8", "filename": "src/comp/middle/tstate/pre_post_conditions.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6a4d0ce829d999900199c6af53592537727ea5e9/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a4d0ce829d999900199c6af53592537727ea5e9/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs?ref=6a4d0ce829d999900199c6af53592537727ea5e9", "patch": "@@ -218,7 +218,7 @@ fn join_then_else(fcx: &fn_ctxt, antec: &@expr, conseq: &blk,\n \n fn gen_if_local(fcx: &fn_ctxt, lhs: @expr, rhs: @expr, larger_id: node_id,\n                 new_var: node_id, pth: &path) {\n-    alt node_id_to_def(fcx.ccx, new_var) {\n+    alt node_id_to_def_upvar(fcx, new_var) {\n       some(d) {\n         alt d {\n           def_local(d_id) {\n@@ -257,7 +257,7 @@ fn handle_update(fcx: &fn_ctxt, parent: &@expr, lhs: &@expr, rhs: &@expr,\n           }\n           _ {\n             // pure and assign_op require the lhs to be init'd\n-            let df = node_id_to_def_strict(fcx.ccx.tcx, lhs.id);\n+            let df = node_id_to_def_upvar_strict(fcx, lhs.id);\n             alt df {\n               def_local(d_id) {\n                 let i ="}]}