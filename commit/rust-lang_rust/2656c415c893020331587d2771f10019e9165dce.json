{"sha": "2656c415c893020331587d2771f10019e9165dce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2NTZjNDE1Yzg5MzAyMDMzMTU4N2QyNzcxZjEwMDE5ZTkxNjVkY2U=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-03T16:35:43Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-03T16:35:43Z"}, "message": "Use expect for rename tests", "tree": {"sha": "5c31759dd331957f9b02319676680c2b8cc41a34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c31759dd331957f9b02319676680c2b8cc41a34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2656c415c893020331587d2771f10019e9165dce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2656c415c893020331587d2771f10019e9165dce", "html_url": "https://github.com/rust-lang/rust/commit/2656c415c893020331587d2771f10019e9165dce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2656c415c893020331587d2771f10019e9165dce/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee7ab0104d7d46e4ffc9933a53c6597160a1533c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee7ab0104d7d46e4ffc9933a53c6597160a1533c", "html_url": "https://github.com/rust-lang/rust/commit/ee7ab0104d7d46e4ffc9933a53c6597160a1533c"}], "stats": {"total": 250, "additions": 57, "deletions": 193}, "files": [{"sha": "fbc10d3bba579f613a513c10e7d4a8202ae06af6", "filename": "crates/ra_ide/src/references/rename.rs", "status": "modified", "additions": 57, "deletions": 193, "changes": 250, "blob_url": "https://github.com/rust-lang/rust/blob/2656c415c893020331587d2771f10019e9165dce/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2656c415c893020331587d2771f10019e9165dce/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Freferences%2Frename.rs?ref=2656c415c893020331587d2771f10019e9165dce", "patch": "@@ -271,7 +271,7 @@ fn rename_reference(\n \n #[cfg(test)]\n mod tests {\n-    use insta::assert_debug_snapshot;\n+    use expect::{expect, Expect};\n     use ra_text_edit::TextEditBuilder;\n     use stdx::trim_indent;\n     use test_utils::{assert_eq_text, mark};\n@@ -297,6 +297,12 @@ mod tests {\n         assert_eq_text!(ra_fixture_after, &*result);\n     }\n \n+    fn check_expect(new_name: &str, ra_fixture: &str, expect: Expect) {\n+        let (analysis, position) = analysis_and_position(ra_fixture);\n+        let source_change = analysis.rename(position, new_name).unwrap().unwrap();\n+        expect.assert_debug_eq(&source_change)\n+    }\n+\n     #[test]\n     fn test_rename_to_underscore() {\n         check(\n@@ -650,7 +656,8 @@ fn baz(j: i32) -> Self {\n \n     #[test]\n     fn test_rename_mod() {\n-        let (analysis, position) = analysis_and_position(\n+        check_expect(\n+            \"foo2\",\n             r#\"\n //- /lib.rs\n mod bar;\n@@ -659,53 +666,49 @@ mod bar;\n mod foo<|>;\n \n //- /bar/foo.rs\n-// emtpy\n-            \"#,\n-        );\n-        let new_name = \"foo2\";\n-        let source_change = analysis.rename(position, new_name).unwrap();\n-        assert_debug_snapshot!(&source_change,\n-@r###\"\n-        Some(\n-            RangeInfo {\n-                range: 4..7,\n-                info: SourceChange {\n-                    source_file_edits: [\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                2,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"foo2\",\n-                                        delete: 4..7,\n-                                    },\n-                                ],\n+// empty\n+\"#,\n+            expect![[r#\"\n+                RangeInfo {\n+                    range: 4..7,\n+                    info: SourceChange {\n+                        source_file_edits: [\n+                            SourceFileEdit {\n+                                file_id: FileId(\n+                                    2,\n+                                ),\n+                                edit: TextEdit {\n+                                    indels: [\n+                                        Indel {\n+                                            insert: \"foo2\",\n+                                            delete: 4..7,\n+                                        },\n+                                    ],\n+                                },\n                             },\n-                        },\n-                    ],\n-                    file_system_edits: [\n-                        MoveFile {\n-                            src: FileId(\n-                                3,\n-                            ),\n-                            anchor: FileId(\n-                                2,\n-                            ),\n-                            dst: \"foo2.rs\",\n-                        },\n-                    ],\n-                    is_snippet: false,\n-                },\n-            },\n-        )\n-        \"###);\n+                        ],\n+                        file_system_edits: [\n+                            MoveFile {\n+                                src: FileId(\n+                                    3,\n+                                ),\n+                                anchor: FileId(\n+                                    2,\n+                                ),\n+                                dst: \"foo2.rs\",\n+                            },\n+                        ],\n+                        is_snippet: false,\n+                    },\n+                }\n+            \"#]],\n+        );\n     }\n \n     #[test]\n     fn test_rename_mod_in_use_tree() {\n-        let (analysis, position) = analysis_and_position(\n+        check_expect(\n+            \"quux\",\n             r#\"\n //- /main.rs\n pub mod foo;\n@@ -717,112 +720,23 @@ pub struct FooContent;\n \n //- /bar.rs\n use crate::foo<|>::FooContent;\n-            \"#,\n+\"#,\n+            expect![[]],\n         );\n-        let new_name = \"qux\";\n-        let source_change = analysis.rename(position, new_name).unwrap();\n-        assert_debug_snapshot!(&source_change,\n-@r###\"\n-        Some(\n-            RangeInfo {\n-                range: 11..14,\n-                info: SourceChange {\n-                    source_file_edits: [\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                1,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"qux\",\n-                                        delete: 8..11,\n-                                    },\n-                                ],\n-                            },\n-                        },\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                3,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"qux\",\n-                                        delete: 11..14,\n-                                    },\n-                                ],\n-                            },\n-                        },\n-                    ],\n-                    file_system_edits: [\n-                        MoveFile {\n-                            src: FileId(\n-                                2,\n-                            ),\n-                            anchor: FileId(\n-                                3,\n-                            ),\n-                            dst: \"qux.rs\",\n-                        },\n-                    ],\n-                    is_snippet: false,\n-                },\n-            },\n-        )\n-        \"###);\n     }\n \n     #[test]\n     fn test_rename_mod_in_dir() {\n-        let (analysis, position) = analysis_and_position(\n+        check_expect(\n+            \"foo2\",\n             r#\"\n //- /lib.rs\n mod fo<|>o;\n //- /foo/mod.rs\n // emtpy\n-            \"#,\n+\"#,\n+            expect![[]],\n         );\n-        let new_name = \"foo2\";\n-        let source_change = analysis.rename(position, new_name).unwrap();\n-        assert_debug_snapshot!(&source_change,\n-        @r###\"\n-        Some(\n-            RangeInfo {\n-                range: 4..7,\n-                info: SourceChange {\n-                    source_file_edits: [\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                1,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"foo2\",\n-                                        delete: 4..7,\n-                                    },\n-                                ],\n-                            },\n-                        },\n-                    ],\n-                    file_system_edits: [\n-                        MoveFile {\n-                            src: FileId(\n-                                2,\n-                            ),\n-                            anchor: FileId(\n-                                1,\n-                            ),\n-                            dst: \"../foo2/mod.rs\",\n-                        },\n-                    ],\n-                    is_snippet: false,\n-                },\n-            },\n-        )\n-        \"###\n-               );\n     }\n \n     #[test]\n@@ -852,7 +766,8 @@ fn main() {\n \n     #[test]\n     fn test_rename_mod_filename_and_path() {\n-        let (analysis, position) = analysis_and_position(\n+        check_expect(\n+            \"foo2\",\n             r#\"\n //- /lib.rs\n mod bar;\n@@ -865,60 +780,9 @@ pub mod foo<|>;\n \n //- /bar/foo.rs\n // pub fn fun() {}\n-            \"#,\n+\"#,\n+            expect![[]],\n         );\n-        let new_name = \"foo2\";\n-        let source_change = analysis.rename(position, new_name).unwrap();\n-        assert_debug_snapshot!(&source_change,\n-@r###\"\n-        Some(\n-            RangeInfo {\n-                range: 8..11,\n-                info: SourceChange {\n-                    source_file_edits: [\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                2,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"foo2\",\n-                                        delete: 8..11,\n-                                    },\n-                                ],\n-                            },\n-                        },\n-                        SourceFileEdit {\n-                            file_id: FileId(\n-                                1,\n-                            ),\n-                            edit: TextEdit {\n-                                indels: [\n-                                    Indel {\n-                                        insert: \"foo2\",\n-                                        delete: 27..30,\n-                                    },\n-                                ],\n-                            },\n-                        },\n-                    ],\n-                    file_system_edits: [\n-                        MoveFile {\n-                            src: FileId(\n-                                3,\n-                            ),\n-                            anchor: FileId(\n-                                2,\n-                            ),\n-                            dst: \"foo2.rs\",\n-                        },\n-                    ],\n-                    is_snippet: false,\n-                },\n-            },\n-        )\n-        \"###);\n     }\n \n     #[test]"}]}