{"sha": "eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViOWUzMDczYTA3YTA5NmFjMTkzNWQyODA3ODdhZDZlMzRmM2EwYTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-25T09:50:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-07-25T09:50:06Z"}, "message": "Auto merge of #1856 - RalfJung:no-mir, r=RalfJung\n\nshow proper error when using a sysroot without MIR\n\nFixes https://github.com/rust-lang/miri/issues/1834", "tree": {"sha": "5fdd656f50310d6bf1d93600d2af49b5904197f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5fdd656f50310d6bf1d93600d2af49b5904197f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "html_url": "https://github.com/rust-lang/rust/commit/eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb9e3073a07a096ac1935d280787ad6e34f3a0a5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1677946d74e411b497cf06e69749e7e1b15afa09", "url": "https://api.github.com/repos/rust-lang/rust/commits/1677946d74e411b497cf06e69749e7e1b15afa09", "html_url": "https://github.com/rust-lang/rust/commit/1677946d74e411b497cf06e69749e7e1b15afa09"}, {"sha": "46d31f92303c3dd8905aef1b71150acbd46e88c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/46d31f92303c3dd8905aef1b71150acbd46e88c1", "html_url": "https://github.com/rust-lang/rust/commit/46d31f92303c3dd8905aef1b71150acbd46e88c1"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "0d91f5246151ffa4246a3e6fb07adef65e297698", "filename": "src/diagnostics.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/eb9e3073a07a096ac1935d280787ad6e34f3a0a5/src%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb9e3073a07a096ac1935d280787ad6e34f3a0a5/src%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdiagnostics.rs?ref=eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "patch": "@@ -132,8 +132,6 @@ pub fn report_error<'tcx, 'mir>(\n             };\n             #[rustfmt::skip]\n             let helps = match e.kind() {\n-                Unsupported(UnsupportedOpInfo::NoMirFor(..)) =>\n-                    vec![(None, format!(\"make sure to use a Miri sysroot, which you can prepare with `cargo miri setup`\"))],\n                 Unsupported(UnsupportedOpInfo::ThreadLocalStatic(_) | UnsupportedOpInfo::ReadExternStatic(_)) =>\n                     panic!(\"Error should never be raised by Miri: {:?}\", e.kind()),\n                 Unsupported(_) =>"}, {"sha": "02feae4a3503cf4efe13644227d7fe8ae265f8d5", "filename": "src/eval.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/eb9e3073a07a096ac1935d280787ad6e34f3a0a5/src%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb9e3073a07a096ac1935d280787ad6e34f3a0a5/src%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Feval.rs?ref=eb9e3073a07a096ac1935d280787ad6e34f3a0a5", "patch": "@@ -138,6 +138,12 @@ pub fn create_ecx<'mir, 'tcx: 'mir>(\n     EnvVars::init(&mut ecx, config.excluded_env_vars)?;\n     MemoryExtra::init_extern_statics(&mut ecx)?;\n \n+    // Make sure we have MIR. We check MIR for some stable monomorphic function in libcore.\n+    let sentinel = ecx.resolve_path(&[\"core\", \"ascii\", \"escape_default\"]);\n+    if !tcx.is_mir_available(sentinel.def.def_id()) {\n+        tcx.sess.fatal(\"the current sysroot was built without `-Zalways-encode-mir`. Use `cargo miri setup` to prepare a sysroot that is suitable for Miri.\");\n+    }\n+\n     // Setup first stack-frame\n     let main_instance = ty::Instance::mono(tcx, main_id);\n     let main_mir = ecx.load_mir(main_instance.def, None)?;"}]}