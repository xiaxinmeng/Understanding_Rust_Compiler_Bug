{"sha": "20d8478864333b2633509c530b66d52ffef91fbb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwZDg0Nzg4NjQzMzNiMjYzMzUwOWM1MzBiNjZkNTJmZmVmOTFmYmI=", "commit": {"author": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2021-01-18T03:02:47Z"}, "committer": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2021-01-19T00:43:59Z"}, "message": "Fix intersperse_fold", "tree": {"sha": "7fd50817e18f76f8d8648ca67980fd072cfdec7f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fd50817e18f76f8d8648ca67980fd072cfdec7f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20d8478864333b2633509c530b66d52ffef91fbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20d8478864333b2633509c530b66d52ffef91fbb", "html_url": "https://github.com/rust-lang/rust/commit/20d8478864333b2633509c530b66d52ffef91fbb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20d8478864333b2633509c530b66d52ffef91fbb/comments", "author": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4df63f47f37cfb8fff80919be560e4d51ae9a44", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4df63f47f37cfb8fff80919be560e4d51ae9a44", "html_url": "https://github.com/rust-lang/rust/commit/c4df63f47f37cfb8fff80919be560e4d51ae9a44"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "2143509d71dc75cf4b509a914b772314421b9369", "filename": "library/core/src/iter/adapters/intersperse.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/20d8478864333b2633509c530b66d52ffef91fbb/library%2Fcore%2Fsrc%2Fiter%2Fadapters%2Fintersperse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20d8478864333b2633509c530b66d52ffef91fbb/library%2Fcore%2Fsrc%2Fiter%2Fadapters%2Fintersperse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fiter%2Fadapters%2Fintersperse.rs?ref=20d8478864333b2633509c530b66d52ffef91fbb", "patch": "@@ -160,7 +160,7 @@ where\n }\n \n fn intersperse_fold<I, B, F, G>(\n-    mut iter: Peekable<I>,\n+    mut iter: I,\n     init: B,\n     mut f: F,\n     mut separator: G,\n@@ -173,8 +173,7 @@ where\n {\n     let mut accum = init;\n \n-    // Use `peek()` first to avoid calling `next()` on an empty iterator.\n-    if !needs_sep || iter.peek().is_some() {\n+    if !needs_sep {\n         if let Some(x) = iter.next() {\n             accum = f(accum, x);\n         }"}, {"sha": "fa259e68a4370f0eea42c56c4d2d464ae6064ff4", "filename": "library/core/tests/iter.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/20d8478864333b2633509c530b66d52ffef91fbb/library%2Fcore%2Ftests%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20d8478864333b2633509c530b66d52ffef91fbb/library%2Fcore%2Ftests%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fiter.rs?ref=20d8478864333b2633509c530b66d52ffef91fbb", "patch": "@@ -3562,6 +3562,35 @@ fn test_intersperse_size_hint() {\n     assert_eq!([].iter().intersperse(&()).size_hint(), (0, Some(0)));\n }\n \n+#[test]\n+fn test_intersperse_fold() {\n+    let v = (1..4).intersperse(9).fold(Vec::new(), |mut acc, x| {\n+        acc.push(x);\n+        acc\n+    });\n+    assert_eq!(v.as_slice(), [1, 9, 2, 9, 3]);\n+\n+    let mut iter = (1..4).intersperse(9);\n+    assert_eq!(iter.next(), Some(1));\n+    let v = iter.fold(Vec::new(), |mut acc, x| {\n+        acc.push(x);\n+        acc\n+    });\n+    assert_eq!(v.as_slice(), [9, 2, 9, 3]);\n+}\n+\n+#[test]\n+fn test_intersperse_collect_string() {\n+    let contents = vec![1, 2, 3];\n+\n+    let contents_string = contents\n+        .into_iter()\n+        .map(|id| id.to_string())\n+        .intersperse(\", \".to_owned())\n+        .collect::<String>();\n+    assert_eq!(contents_string, \"1, 2, 3\");\n+}\n+\n #[test]\n fn test_fold_specialization_intersperse() {\n     let mut iter = (1..2).intersperse(0);"}]}