{"sha": "4c02d9f6bf2404f0a077cced12cf434c70979fd9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjMDJkOWY2YmYyNDA0ZjBhMDc3Y2NlZDEyY2Y0MzRjNzA5NzlmZDk=", "commit": {"author": {"name": "Matthew Dawson", "email": "matthew@mjdsystems.ca", "date": "2017-01-20T14:22:16Z"}, "committer": {"name": "Matthew Dawson", "email": "matthew@mjdsystems.ca", "date": "2017-01-20T16:46:51Z"}, "message": "Fix rustbuild to work with --libdir.\n\nSimilar to the makefiles, pass CFG_LIBDIR_RELATIVE to cargo when building\nrustc in stages > 0.  This tells rustc to check the different directory.", "tree": {"sha": "4bb0d18e8ae484d905b1b1c891023e972929eda4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bb0d18e8ae484d905b1b1c891023e972929eda4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c02d9f6bf2404f0a077cced12cf434c70979fd9", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEkRWwpe7qWxgM14Ep+0kv31Jtww0FAliCPvwACgkQ+0kv31Jt\nww0WyQ//dzcTnqL6dmClx0tTbwfH7Szlq9ygfMNhWDHqdSINLDLbdZJbiBn7mkza\nMnwsV9+IWTphQ/TIvN2SBulbdsTjtrU6z1Er4mFQ/ZSiPpE58F9JIUhWNNp5pU14\nsgJRIEzbgELPN+6GPDg9QrLu/7ckRJu47xhCCBkRN9vx7Ky1XySWxPzTAwRfXg22\nzHNDUtHPCp9sPgbRkSM1l248d2UlHLryTFDF2+bIijfnCzn7PE77auwdthNOB7Pi\nOYl/JT1hHGCs+xdk3pl39jNQ4KMxXv8pHnOI/n5p1haVyc5y+q8WlzODpvERk4+v\nkehQafb3Febj15UleU9Ef0OSTYRDFgUZnNImP1b3EMsrKNoRwKam4CuFhv75ecnr\nOJCRdfD+P708jMem7U20My2QhrdVlhAV/IakZs8KpcrKZCLmtNqMSqRxV6F5WfMm\nNs8HW3r/I/el6h5UfiU0yYS+2s2ty0PZ+71QtwmoYcngUVYpcp+PryrsJ/9b/dnA\nMdL2JD5uuxb0rXYXtAiCsf2MWuheIjLBGk4cviHQht3DB7R1QiQ9hAgYuq0lgW8l\nx25sMAKWfyItUUjnI5bp95sNQtxF44pEHexW7w6Woml//PWSr319SZ3fVOrsyX/A\ngIJngc/87nMzorBAA3d7bmQUgYvbi4UHEuhnZvwbkyR+0CgKA34=\n=W+ZG\n-----END PGP SIGNATURE-----", "payload": "tree 4bb0d18e8ae484d905b1b1c891023e972929eda4\nparent b7ca2b9e143248c8fc33353636c0051f91d7f77f\nauthor Matthew Dawson <matthew@mjdsystems.ca> 1484922136 -0500\ncommitter Matthew Dawson <matthew@mjdsystems.ca> 1484930811 -0500\n\nFix rustbuild to work with --libdir.\n\nSimilar to the makefiles, pass CFG_LIBDIR_RELATIVE to cargo when building\nrustc in stages > 0.  This tells rustc to check the different directory.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c02d9f6bf2404f0a077cced12cf434c70979fd9", "html_url": "https://github.com/rust-lang/rust/commit/4c02d9f6bf2404f0a077cced12cf434c70979fd9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c02d9f6bf2404f0a077cced12cf434c70979fd9/comments", "author": {"login": "MJDSys", "id": 2875429, "node_id": "MDQ6VXNlcjI4NzU0Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/2875429?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MJDSys", "html_url": "https://github.com/MJDSys", "followers_url": "https://api.github.com/users/MJDSys/followers", "following_url": "https://api.github.com/users/MJDSys/following{/other_user}", "gists_url": "https://api.github.com/users/MJDSys/gists{/gist_id}", "starred_url": "https://api.github.com/users/MJDSys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MJDSys/subscriptions", "organizations_url": "https://api.github.com/users/MJDSys/orgs", "repos_url": "https://api.github.com/users/MJDSys/repos", "events_url": "https://api.github.com/users/MJDSys/events{/privacy}", "received_events_url": "https://api.github.com/users/MJDSys/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MJDSys", "id": 2875429, "node_id": "MDQ6VXNlcjI4NzU0Mjk=", "avatar_url": "https://avatars.githubusercontent.com/u/2875429?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MJDSys", "html_url": "https://github.com/MJDSys", "followers_url": "https://api.github.com/users/MJDSys/followers", "following_url": "https://api.github.com/users/MJDSys/following{/other_user}", "gists_url": "https://api.github.com/users/MJDSys/gists{/gist_id}", "starred_url": "https://api.github.com/users/MJDSys/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MJDSys/subscriptions", "organizations_url": "https://api.github.com/users/MJDSys/orgs", "repos_url": "https://api.github.com/users/MJDSys/repos", "events_url": "https://api.github.com/users/MJDSys/events{/privacy}", "received_events_url": "https://api.github.com/users/MJDSys/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7ca2b9e143248c8fc33353636c0051f91d7f77f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7ca2b9e143248c8fc33353636c0051f91d7f77f", "html_url": "https://github.com/rust-lang/rust/commit/b7ca2b9e143248c8fc33353636c0051f91d7f77f"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "b91955f89650e342521c0a192173fc4c536b085d", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4c02d9f6bf2404f0a077cced12cf434c70979fd9/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c02d9f6bf2404f0a077cced12cf434c70979fd9/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=4c02d9f6bf2404f0a077cced12cf434c70979fd9", "patch": "@@ -185,8 +185,14 @@ pub fn rustc(build: &Build, target: &str, compiler: &Compiler) {\n     cargo.env(\"CFG_RELEASE\", &build.release)\n          .env(\"CFG_RELEASE_CHANNEL\", &build.config.channel)\n          .env(\"CFG_VERSION\", &build.version)\n-         .env(\"CFG_PREFIX\", build.config.prefix.clone().unwrap_or(PathBuf::new()))\n-         .env(\"CFG_LIBDIR_RELATIVE\", \"lib\");\n+         .env(\"CFG_PREFIX\", build.config.prefix.clone().unwrap_or(PathBuf::new()));\n+\n+    if compiler.stage == 0 {\n+        cargo.env(\"CFG_LIBDIR_RELATIVE\", \"lib\");\n+    } else {\n+        let libdir_relative = build.config.libdir_relative.clone().unwrap_or(PathBuf::from(\"lib\"));\n+        cargo.env(\"CFG_LIBDIR_RELATIVE\", libdir_relative);\n+    }\n \n     // If we're not building a compiler with debugging information then remove\n     // these two env vars which would be set otherwise."}, {"sha": "152164342cdd2ba042a73babc851cc52263eddc2", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4c02d9f6bf2404f0a077cced12cf434c70979fd9/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c02d9f6bf2404f0a077cced12cf434c70979fd9/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=4c02d9f6bf2404f0a077cced12cf434c70979fd9", "patch": "@@ -90,6 +90,7 @@ pub struct Config {\n     pub prefix: Option<PathBuf>,\n     pub docdir: Option<PathBuf>,\n     pub libdir: Option<PathBuf>,\n+    pub libdir_relative: Option<PathBuf>,\n     pub mandir: Option<PathBuf>,\n     pub codegen_tests: bool,\n     pub nodejs: Option<PathBuf>,\n@@ -477,6 +478,9 @@ impl Config {\n                 \"CFG_LIBDIR\" => {\n                     self.libdir = Some(PathBuf::from(value));\n                 }\n+                \"CFG_LIBDIR_RELATIVE\" => {\n+                    self.libdir_relative = Some(PathBuf::from(value));\n+                }\n                 \"CFG_MANDIR\" => {\n                     self.mandir = Some(PathBuf::from(value));\n                 }"}]}