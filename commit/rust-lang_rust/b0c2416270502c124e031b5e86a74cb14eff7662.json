{"sha": "b0c2416270502c124e031b5e86a74cb14eff7662", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwYzI0MTYyNzA1MDJjMTI0ZTAzMWI1ZTg2YTc0Y2IxNGVmZjc2NjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-07T22:14:36Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-07T22:14:36Z"}, "message": "Clean up logging output. Closes #1088", "tree": {"sha": "23bc6e7dead38a7e8f07d40270ca164ad81a22a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23bc6e7dead38a7e8f07d40270ca164ad81a22a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0c2416270502c124e031b5e86a74cb14eff7662", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0c2416270502c124e031b5e86a74cb14eff7662", "html_url": "https://github.com/rust-lang/rust/commit/b0c2416270502c124e031b5e86a74cb14eff7662", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0c2416270502c124e031b5e86a74cb14eff7662/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "369fc5e4802ec618ba10a52cf52fa52069fa5e77", "url": "https://api.github.com/repos/rust-lang/rust/commits/369fc5e4802ec618ba10a52cf52fa52069fa5e77", "html_url": "https://github.com/rust-lang/rust/commit/369fc5e4802ec618ba10a52cf52fa52069fa5e77"}], "stats": {"total": 26, "additions": 16, "deletions": 10}, "files": [{"sha": "226ff2ff1590a4327f06d12813168e96a6278de7", "filename": "src/rt/rust_log.cpp", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_log.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_log.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_log.cpp?ref=b0c2416270502c124e031b5e86a74cb14eff7662", "patch": "@@ -13,7 +13,6 @@\n  * Synchronizes access to the underlying logging mechanism.\n  */\n static lock_and_signal _log_lock;\n-static uint32_t _last_thread_id;\n \n rust_log::rust_log(rust_srv *srv, rust_scheduler *sched) :\n     _srv(srv),\n@@ -67,26 +66,29 @@ append_string(char *buffer, const char *format, ...) {\n }\n \n void\n-rust_log::trace_ln(uint32_t thread_id, char *prefix, char *message) {\n+rust_log::trace_ln(char *prefix, char *message) {\n     char buffer[BUF_BYTES] = \"\";\n     _log_lock.lock();\n-    append_string(buffer, \"%-34s\", prefix);\n+    append_string(buffer, \"%s\", prefix);\n     append_string(buffer, \"%s\", message);\n-    if (_last_thread_id != thread_id) {\n-        _last_thread_id = thread_id;\n-        _srv->log(\"---\");\n-    }\n     _srv->log(buffer);\n     _log_lock.unlock();\n }\n \n void\n rust_log::trace_ln(rust_task *task, uint32_t level, char *message) {\n+\n+\n+    // FIXME: The scheduler and task names used to have meaning,\n+    // but they are always equal to 'main' currently\n+#if 0\n+\n #if defined(__WIN32__)\n     uint32_t thread_id = 0;\n #else\n     uint32_t thread_id = hash((uintptr_t) pthread_self());\n #endif\n+\n     char prefix[BUF_BYTES] = \"\";\n     if (_sched && _sched->name) {\n         append_string(prefix, \"%04\" PRIxPTR \":%.10s:\",\n@@ -102,7 +104,11 @@ rust_log::trace_ln(rust_task *task, uint32_t level, char *message) {\n             append_string(prefix, \"0x%08\" PRIxPTR \":\", (uintptr_t) task);\n         }\n     }\n-    trace_ln(thread_id, prefix, message);\n+#else\n+    char prefix[BUF_BYTES] = \"\";\n+#endif\n+\n+    trace_ln(prefix, message);\n }\n \n // Reading log directives and setting log level vars"}, {"sha": "eac3bf62fb84e18856ea224dd38a7d42586a42dd", "filename": "src/rt/rust_log.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_log.h", "raw_url": "https://github.com/rust-lang/rust/raw/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_log.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_log.h?ref=b0c2416270502c124e031b5e86a74cb14eff7662", "patch": "@@ -42,7 +42,7 @@ class rust_log {\n     virtual ~rust_log();\n \n     void trace_ln(rust_task *task, uint32_t level, char *message);\n-    void trace_ln(uint32_t thread_id, char *prefix, char *message);\n+    void trace_ln(char *prefix, char *message);\n     bool is_tracing(uint32_t type_bits);\n \n private:"}, {"sha": "758174a4ebb119c479d2029cf5bb4540767b38bc", "filename": "src/rt/rust_srv.cpp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_srv.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b0c2416270502c124e031b5e86a74cb14eff7662/src%2Frt%2Frust_srv.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_srv.cpp?ref=b0c2416270502c124e031b5e86a74cb14eff7662", "patch": "@@ -25,7 +25,7 @@ rust_srv::realloc(void *p, size_t bytes) {\n \n void\n rust_srv::log(char const *msg) {\n-    printf(\"rt: %s\\n\", msg);\n+    printf(\"rust: %s\\n\", msg);\n     // FIXME: flushing each time is expensive, but at the moment\n     // necessary to get output through before a rust_task::fail\n     // call. This should be changed."}]}