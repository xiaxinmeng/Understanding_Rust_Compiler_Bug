{"sha": "00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwZjFjZGRiOWM4ZWNkODJhZGE0ZWEzMDQzMGNiNmNmMTc4YzUwYmE=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-02-25T13:54:52Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-03-05T20:58:38Z"}, "message": "Test Windows cross-compilation on CI", "tree": {"sha": "12fb297b2d3221774cdbaecbcfad74aca3bdcea1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12fb297b2d3221774cdbaecbcfad74aca3bdcea1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "html_url": "https://github.com/rust-lang/rust/commit/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d23b12fa62b30a30eba42a33fb2d1ff3932815db", "url": "https://api.github.com/repos/rust-lang/rust/commits/d23b12fa62b30a30eba42a33fb2d1ff3932815db", "html_url": "https://github.com/rust-lang/rust/commit/d23b12fa62b30a30eba42a33fb2d1ff3932815db"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "e06a1fb88bad806b6e217ed17478296c809486d3", "filename": ".github/workflows/main.yml", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba/.github%2Fworkflows%2Fmain.yml", "raw_url": "https://github.com/rust-lang/rust/raw/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba/.github%2Fworkflows%2Fmain.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmain.yml?ref=00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "patch": "@@ -11,7 +11,13 @@ jobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        os: [ubuntu-latest, macos-latest]\n+        include:\n+          - os: ubuntu-latest\n+          - os: macos-latest\n+          # cross-compile from Linux to Windows using mingw\n+          - os: ubuntu-latest\n+            env:\n+              TARGET_TRIPLE: x86_64-pc-windows-gnu\n \n     steps:\n     - uses: actions/checkout@v2\n@@ -36,13 +42,21 @@ jobs:\n         path: target\n         key: ${{ runner.os }}-cargo-build-target-${{ hashFiles('rust-toolchain', '**/Cargo.lock') }}\n \n+    - name: Install MinGW toolchain and wine\n+      if: matrix.os == 'ubuntu-latest' && matrix.env.TARGET_TRIPLE == 'x86_64-pc-windows-gnu'\n+      run: |\n+        sudo apt-get install -y gcc-mingw-w64-x86-64 wine-stable\n+        rustup target add x86_64-pc-windows-gnu\n+\n     - name: Prepare dependencies\n       run: |\n         git config --global user.email \"user@example.com\"\n         git config --global user.name \"User\"\n         ./prepare.sh\n \n     - name: Test\n+      env:\n+        TARGET_TRIPLE: ${{ matrix.env.TARGET_TRIPLE }}\n       run: |\n         # Enable backtraces for easier debugging\n         export RUST_BACKTRACE=1\n@@ -57,6 +71,7 @@ jobs:\n       run: tar cvfJ cg_clif.tar.xz build\n \n     - name: Upload prebuilt cg_clif\n+      if: matrix.env.TARGET_TRIPLE != 'x86_64-pc-windows-gnu'\n       uses: actions/upload-artifact@v2\n       with:\n         name: cg_clif-${{ runner.os }}"}, {"sha": "ee995ffcfa9f7df9692746f6ca56506de949ef2b", "filename": "prepare.sh", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba/prepare.sh", "raw_url": "https://github.com/rust-lang/rust/raw/00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba/prepare.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/prepare.sh?ref=00f1cddb9c8ecd82ada4ea30430cb6cf178c50ba", "patch": "@@ -2,7 +2,6 @@\n set -e\n \n rustup component add rust-src rustc-dev llvm-tools-preview\n-rustup target add x86_64-pc-windows-gnu\n ./build_sysroot/prepare_sysroot_src.sh\n cargo install hyperfine || echo \"Skipping hyperfine install\"\n "}]}