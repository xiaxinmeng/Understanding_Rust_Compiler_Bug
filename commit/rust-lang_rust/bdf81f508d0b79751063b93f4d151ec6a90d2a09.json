{"sha": "bdf81f508d0b79751063b93f4d151ec6a90d2a09", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkZjgxZjUwOGQwYjc5NzUxMDYzYjkzZjRkMTUxZWM2YTkwZDJhMDk=", "commit": {"author": {"name": "Raoul Strackx", "email": "raoul.strackx@fortanix.com", "date": "2020-03-26T14:05:43Z"}, "committer": {"name": "Raoul Strackx", "email": "raoul.strackx@fortanix.com", "date": "2020-09-25T13:02:15Z"}, "message": "test hardening C inline assembly code (cc crate)", "tree": {"sha": "bc9680919dbd89f92f56a17ca2a0275544a9a3b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc9680919dbd89f92f56a17ca2a0275544a9a3b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdf81f508d0b79751063b93f4d151ec6a90d2a09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdf81f508d0b79751063b93f4d151ec6a90d2a09", "html_url": "https://github.com/rust-lang/rust/commit/bdf81f508d0b79751063b93f4d151ec6a90d2a09", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdf81f508d0b79751063b93f4d151ec6a90d2a09/comments", "author": {"login": "raoulstrackx", "id": 56830709, "node_id": "MDQ6VXNlcjU2ODMwNzA5", "avatar_url": "https://avatars.githubusercontent.com/u/56830709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raoulstrackx", "html_url": "https://github.com/raoulstrackx", "followers_url": "https://api.github.com/users/raoulstrackx/followers", "following_url": "https://api.github.com/users/raoulstrackx/following{/other_user}", "gists_url": "https://api.github.com/users/raoulstrackx/gists{/gist_id}", "starred_url": "https://api.github.com/users/raoulstrackx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raoulstrackx/subscriptions", "organizations_url": "https://api.github.com/users/raoulstrackx/orgs", "repos_url": "https://api.github.com/users/raoulstrackx/repos", "events_url": "https://api.github.com/users/raoulstrackx/events{/privacy}", "received_events_url": "https://api.github.com/users/raoulstrackx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "raoulstrackx", "id": 56830709, "node_id": "MDQ6VXNlcjU2ODMwNzA5", "avatar_url": "https://avatars.githubusercontent.com/u/56830709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raoulstrackx", "html_url": "https://github.com/raoulstrackx", "followers_url": "https://api.github.com/users/raoulstrackx/followers", "following_url": "https://api.github.com/users/raoulstrackx/following{/other_user}", "gists_url": "https://api.github.com/users/raoulstrackx/gists{/gist_id}", "starred_url": "https://api.github.com/users/raoulstrackx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raoulstrackx/subscriptions", "organizations_url": "https://api.github.com/users/raoulstrackx/orgs", "repos_url": "https://api.github.com/users/raoulstrackx/repos", "events_url": "https://api.github.com/users/raoulstrackx/events{/privacy}", "received_events_url": "https://api.github.com/users/raoulstrackx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0526e750cd4e88fbb24ea92e809dfb6eefbf8fa0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0526e750cd4e88fbb24ea92e809dfb6eefbf8fa0", "html_url": "https://github.com/rust-lang/rust/commit/0526e750cd4e88fbb24ea92e809dfb6eefbf8fa0"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "d1fae3d495fb1254c023da523dd202cdd940d244", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/cc_plus_one_c_asm.checks", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fcc_plus_one_c_asm.checks", "raw_url": "https://github.com/rust-lang/rust/raw/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fcc_plus_one_c_asm.checks", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fcc_plus_one_c_asm.checks?ref=bdf81f508d0b79751063b93f4d151ec6a90d2a09", "patch": "@@ -0,0 +1,15 @@\n+CHECK: cc_plus_one_c_asm\n+CHECK:      lfence\n+CHECK:      lfence\n+CHECK:      lfence\n+CHECK:      lfence\n+CHECK:      lfence\n+CHECK-NEXT: incl\n+CHECK-NEXT: jmp\n+CHECK-NEXT: shlq    $0, (%rsp)\n+CHECK-NEXT: lfence\n+CHECK-NEXT: retq\n+CHECK:      popq\n+CHECK-NEXT: popq [[REGISTER:%[a-z]+]]\n+CHECK-NEXT: lfence\n+CHECK-NEXT: jmpq *[[REGISTER]]"}, {"sha": "b0d0b42a30d15d08f1073de27044636f018729a9", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/enclave/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fbuild.rs?ref=bdf81f508d0b79751063b93f4d151ec6a90d2a09", "patch": "@@ -1,5 +1,5 @@\n fn main() {\n     cc::Build::new()\n         .file(\"foo.c\")\n-        .compile(\"foo\");\n+        .compile(\"foo_c\");\n }"}, {"sha": "971dfa9d171dd5f3ff8e0bbfbec049ab5a59682b", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/enclave/foo.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Ffoo.c", "raw_url": "https://github.com/rust-lang/rust/raw/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Ffoo.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Ffoo.c?ref=bdf81f508d0b79751063b93f4d151ec6a90d2a09", "patch": "@@ -2,3 +2,17 @@\n int cc_plus_one_c(int *arg) {\n     return *arg + 1;\n }\n+\n+int cc_plus_one_c_asm(int *arg) {\n+    int value = 0;\n+\n+    asm volatile ( \"    movl (%1), %0\\n\"\n+                   \"    inc %0\\n\"\n+                   \"    jmp 1f\\n\"\n+                   \"    retq\\n\"  // never executed, but a shortcut to determine how the assembler deals with `ret` instructions\n+                   \"1:\\n\"\n+                   : \"=r\"(value)\n+                   : \"r\"(arg) );\n+\n+    return value;\n+}"}, {"sha": "f8a27255ed081f6e19d35b030ef681b950dc0ca4", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/enclave/src/main.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fenclave%2Fsrc%2Fmain.rs?ref=bdf81f508d0b79751063b93f4d151ec6a90d2a09", "patch": "@@ -1,11 +1,13 @@\n extern {\n     fn cc_plus_one_c(arg : &u32) -> u32;\n+    fn cc_plus_one_c_asm(arg : &u32) -> u32;\n }\n \n fn main() {\n     let value : u32 = 41;\n     \n     unsafe{\n         println!(\"Answer to the Ultimate Question of Life, the Universe, and Everything: {}!\", cc_plus_one_c(&value));\n+        println!(\"Answer to the Ultimate Question of Life, the Universe, and Everything: {}!\", cc_plus_one_c_asm(&value));\n     }\n }"}, {"sha": "91f7ee45b5492ef67364ed86bb77efa140ec2c03", "filename": "src/test/run-make/x86_64-fortanix-unknown-sgx-lvi/script.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fscript.sh", "raw_url": "https://github.com/rust-lang/rust/raw/bdf81f508d0b79751063b93f4d151ec6a90d2a09/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fscript.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fx86_64-fortanix-unknown-sgx-lvi%2Fscript.sh?ref=bdf81f508d0b79751063b93f4d151ec6a90d2a09", "patch": "@@ -39,3 +39,4 @@ build\n \n check \"std::io::stdio::_print::h87f0c238421c45bc\" print.checks\n check cc_plus_one_c cc_plus_one_c.checks\n+check cc_plus_one_c_asm cc_plus_one_c_asm.checks"}]}