{"sha": "b2a97ff415ca950e49448c3ad766246cf3a48443", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyYTk3ZmY0MTVjYTk1MGU0OTQ0OGMzYWQ3NjYyNDZjZjNhNDg0NDM=", "commit": {"author": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2021-02-21T11:19:50Z"}, "committer": {"name": "Tom Eccles", "email": "tom.eccles@codethink.co.uk", "date": "2021-03-28T15:50:16Z"}, "message": "bootstrap: don't run linkcheck when crosscompiling\n\nWhen we cross compile, some things (and their documentation) are built\nfor the host (e.g. rustc), while others (and their documentation) are built\nfor the target. This generated documentation will have broken links\nbetween documentation for different platforms e.g. between rustc and\ncargo.", "tree": {"sha": "5cc070f5f6c3e80f662738b29fbaf5c58deaa1a0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5cc070f5f6c3e80f662738b29fbaf5c58deaa1a0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2a97ff415ca950e49448c3ad766246cf3a48443", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2a97ff415ca950e49448c3ad766246cf3a48443", "html_url": "https://github.com/rust-lang/rust/commit/b2a97ff415ca950e49448c3ad766246cf3a48443", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2a97ff415ca950e49448c3ad766246cf3a48443/comments", "author": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tblah", "id": 3716681, "node_id": "MDQ6VXNlcjM3MTY2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3716681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tblah", "html_url": "https://github.com/tblah", "followers_url": "https://api.github.com/users/tblah/followers", "following_url": "https://api.github.com/users/tblah/following{/other_user}", "gists_url": "https://api.github.com/users/tblah/gists{/gist_id}", "starred_url": "https://api.github.com/users/tblah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tblah/subscriptions", "organizations_url": "https://api.github.com/users/tblah/orgs", "repos_url": "https://api.github.com/users/tblah/repos", "events_url": "https://api.github.com/users/tblah/events{/privacy}", "received_events_url": "https://api.github.com/users/tblah/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b40dd1f50db8ed3086ada80d42f9d834723ed58", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b40dd1f50db8ed3086ada80d42f9d834723ed58", "html_url": "https://github.com/rust-lang/rust/commit/8b40dd1f50db8ed3086ada80d42f9d834723ed58"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "248c8a5f82b882f7bee8b86ab3364f42649fff1c", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b2a97ff415ca950e49448c3ad766246cf3a48443/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2a97ff415ca950e49448c3ad766246cf3a48443/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=b2a97ff415ca950e49448c3ad766246cf3a48443", "patch": "@@ -122,7 +122,21 @@ impl Step for Linkcheck {\n \n     fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {\n         let builder = run.builder;\n-        run.path(\"src/tools/linkchecker\").default_condition(builder.config.docs)\n+        let run = run.path(\"src/tools/linkchecker\");\n+        let hosts = &builder.hosts;\n+        let targets = &builder.targets;\n+\n+        // if we have different hosts and targets, some things may be built for\n+        // the host (e.g. rustc) and others for the target (e.g. std). The\n+        // documentation built for each will contain broken links to\n+        // docs built for the other platform (e.g. rustc linking to cargo)\n+        if (hosts != targets) && !hosts.is_empty() && !targets.is_empty() {\n+            panic!(\n+                \"Linkcheck currently does not support builds with different hosts and targets.\n+You can skip linkcheck with --exclude src/tools/linkchecker\"\n+            );\n+        }\n+        run.default_condition(builder.config.docs)\n     }\n \n     fn make_run(run: RunConfig<'_>) {"}]}