{"sha": "eda4c63fdcfe4717ade45333b90bd1568ebcc949", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkYTRjNjNmZGNmZTQ3MTdhZGU0NTMzM2I5MGJkMTU2OGViY2M5NDk=", "commit": {"author": {"name": "Nicolas Koch", "email": "nioko1337@googlemail.com", "date": "2020-12-01T13:44:40Z"}, "committer": {"name": "Nicolas Koch", "email": "nioko1337@googlemail.com", "date": "2020-12-01T13:44:40Z"}, "message": "Add benchmark for File to UnixStream copy", "tree": {"sha": "d3552973f5324d26236b88e0fc2d06ef03ca27e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d3552973f5324d26236b88e0fc2d06ef03ca27e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eda4c63fdcfe4717ade45333b90bd1568ebcc949", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eda4c63fdcfe4717ade45333b90bd1568ebcc949", "html_url": "https://github.com/rust-lang/rust/commit/eda4c63fdcfe4717ade45333b90bd1568ebcc949", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eda4c63fdcfe4717ade45333b90bd1568ebcc949/comments", "author": {"login": "nicokoch", "id": 3924281, "node_id": "MDQ6VXNlcjM5MjQyODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3924281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicokoch", "html_url": "https://github.com/nicokoch", "followers_url": "https://api.github.com/users/nicokoch/followers", "following_url": "https://api.github.com/users/nicokoch/following{/other_user}", "gists_url": "https://api.github.com/users/nicokoch/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicokoch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicokoch/subscriptions", "organizations_url": "https://api.github.com/users/nicokoch/orgs", "repos_url": "https://api.github.com/users/nicokoch/repos", "events_url": "https://api.github.com/users/nicokoch/events{/privacy}", "received_events_url": "https://api.github.com/users/nicokoch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nicokoch", "id": 3924281, "node_id": "MDQ6VXNlcjM5MjQyODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3924281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nicokoch", "html_url": "https://github.com/nicokoch", "followers_url": "https://api.github.com/users/nicokoch/followers", "following_url": "https://api.github.com/users/nicokoch/following{/other_user}", "gists_url": "https://api.github.com/users/nicokoch/gists{/gist_id}", "starred_url": "https://api.github.com/users/nicokoch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nicokoch/subscriptions", "organizations_url": "https://api.github.com/users/nicokoch/orgs", "repos_url": "https://api.github.com/users/nicokoch/repos", "events_url": "https://api.github.com/users/nicokoch/events{/privacy}", "received_events_url": "https://api.github.com/users/nicokoch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fa9d31c41cfa5f60dbce1204104eb8d8261be5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fa9d31c41cfa5f60dbce1204104eb8d8261be5f", "html_url": "https://github.com/rust-lang/rust/commit/0fa9d31c41cfa5f60dbce1204104eb8d8261be5f"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "554ebd94022341dfd08d7f1bc56cc3d8dba17bcb", "filename": "library/std/src/sys/unix/kernel_copy/tests.rs", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/eda4c63fdcfe4717ade45333b90bd1568ebcc949/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fkernel_copy%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eda4c63fdcfe4717ade45333b90bd1568ebcc949/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fkernel_copy%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fkernel_copy%2Ftests.rs?ref=eda4c63fdcfe4717ade45333b90bd1568ebcc949", "patch": "@@ -118,6 +118,35 @@ fn bench_file_to_socket_copy(b: &mut test::Bencher) {\n     });\n }\n \n+#[bench]\n+fn bench_file_to_uds_copy(b: &mut test::Bencher) {\n+    const BYTES: usize = 128 * 1024;\n+    let src_path = temp_dir().join(\"uds-copy-bench-src\");\n+    let mut src = OpenOptions::new()\n+        .create(true)\n+        .truncate(true)\n+        .read(true)\n+        .write(true)\n+        .open(src_path)\n+        .unwrap();\n+    src.write(&vec![0u8; BYTES]).unwrap();\n+\n+    let (mut sink, mut sink_drainer) = crate::os::unix::net::UnixStream::pair().unwrap();\n+\n+    crate::thread::spawn(move || {\n+        let mut sink_buf = vec![0u8; 1024 * 1024];\n+        loop {\n+            sink_drainer.read(&mut sink_buf[..]).unwrap();\n+        }\n+    });\n+\n+    b.bytes = BYTES as u64;\n+    b.iter(|| {\n+        src.seek(SeekFrom::Start(0)).unwrap();\n+        assert_eq!(BYTES as u64, io::copy(&mut src, &mut sink).unwrap());\n+    });\n+}\n+\n #[cfg(any(target_os = \"linux\", target_os = \"android\"))]\n #[bench]\n fn bench_socket_pipe_socket_copy(b: &mut test::Bencher) {"}]}