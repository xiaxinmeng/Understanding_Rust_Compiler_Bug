{"sha": "eb8ede7f659da6c07d1f475aff9b0d46e5b49a79", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViOGVkZTdmNjU5ZGE2YzA3ZDFmNDc1YWZmOWIwZDQ2ZTViNDlhNzk=", "commit": {"author": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-08-23T09:29:06Z"}, "committer": {"name": "Eduardo Broto", "email": "ebroto@tutanota.com", "date": "2020-08-23T09:33:59Z"}, "message": "Improve documentation related to the sync process", "tree": {"sha": "206d4f645dbf475f40ebd49470629273b9f9c836", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/206d4f645dbf475f40ebd49470629273b9f9c836"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79", "html_url": "https://github.com/rust-lang/rust/commit/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79/comments", "author": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ebroto", "id": 816908, "node_id": "MDQ6VXNlcjgxNjkwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/816908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebroto", "html_url": "https://github.com/ebroto", "followers_url": "https://api.github.com/users/ebroto/followers", "following_url": "https://api.github.com/users/ebroto/following{/other_user}", "gists_url": "https://api.github.com/users/ebroto/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebroto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebroto/subscriptions", "organizations_url": "https://api.github.com/users/ebroto/orgs", "repos_url": "https://api.github.com/users/ebroto/repos", "events_url": "https://api.github.com/users/ebroto/events{/privacy}", "received_events_url": "https://api.github.com/users/ebroto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd07860b839a46782e3750a8924ecf380486c460", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd07860b839a46782e3750a8924ecf380486c460", "html_url": "https://github.com/rust-lang/rust/commit/dd07860b839a46782e3750a8924ecf380486c460"}], "stats": {"total": 56, "additions": 47, "deletions": 9}, "files": [{"sha": "631064cd92c0662a34df834840194f6072b7f17e", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 47, "deletions": 9, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/eb8ede7f659da6c07d1f475aff9b0d46e5b49a79/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=eb8ede7f659da6c07d1f475aff9b0d46e5b49a79", "patch": "@@ -189,6 +189,35 @@ Clippy in the `rust-lang/rust` repository.\n For general information about `subtree`s in the Rust repository see [Rust's\n `CONTRIBUTING.md`][subtree].\n \n+### Patching git-subtree to work with big repos\n+\n+Currently there's a bug in `git-subtree` that prevents it from working properly\n+with the [`rust-lang/rust`] repo. There's an open PR to fix that, but it's stall.\n+Before continuing with the following steps, we need to manually apply that fix to\n+our local copy of `git-subtree`.\n+\n+You can get the patched version of `git-subtree` from [here][gitgitgadget-pr].\n+Put this file under `/usr/lib/git-core` (taking a backup of the previous file)\n+and make sure it has the proper permissions:\n+\n+```bash\n+sudo cp --backup /path/to/patched/git-subtree.sh /usr/lib/git-core/git-subtree\n+sudo chmod --reference=/usr/lib/git-core/git-subtree~ /usr/lib/git-core/git-subtree\n+sudo chown root:root /usr/lib/git-core/git-subtree\n+```\n+\n+_Note:_ The first time running `git subtree push` a cache has to be built. This\n+involves going through the complete Clippy history once. For this you have to\n+increase the stack limit though, which you can do with `ulimit -s 60000`.\n+Make sure to run the `ulimit` command from the same session you call git subtree.\n+\n+_Note:_ If you are a Debian user, `dash` is the shell used by default for scripts instead of `sh`.\n+This shell has a hardcoded recursion limit set to 1000. In order to make this process work,\n+you need to force the script to run `bash` instead. You can do this by editing the first\n+line of the `git-subtree` script and changing `sh` to `bash`.\n+\n+### Performing the sync\n+\n Here is a TL;DR version of the sync process (all of the following commands have\n to be run inside the `rust` directory):\n \n@@ -198,6 +227,7 @@ to be run inside the `rust` directory):\n     # Make sure to change `your-github-name` to your github name in the following command\n     git subtree push -P src/tools/clippy git@github.com:your-github-name/rust-clippy sync-from-rust\n     ```\n+\n     _Note:_ This will directly push to the remote repository. You can also push\n     to your local copy by replacing the remote address with `/path/to/rust-clippy`\n     directory.\n@@ -213,14 +243,28 @@ to be run inside the `rust` directory):\n 3. Open a PR to `rust-lang/rust-clippy` and wait for it to get merged (to\n    accelerate the process ping the `@rust-lang/clippy` team in your PR and/or\n    ~~annoy~~ ask them in the [Discord] channel.)\n-4. Sync the `rust-lang/rust-clippy` master to the rust-copy of Clippy:\n+   \n+### Syncing back changes in Clippy to [`rust-lang/rust`]\n+\n+To avoid flooding the [`rust-lang/rust`] PR queue, changes in Clippy's repo are synced back\n+in a bi-weekly basis if there's no urgent changes. This is done starting on the day of\n+the Rust stable release and then every two other weeks. That way we guarantee that\n+every feature in Clippy is available for 2 weeks in nightly, before it can get to beta.\n+For reference, the first sync following this cadence was performed the 2020-08-27. \n+\n+1. Make sure Clippy itself is up-to-date by following the steps outlined in the previous\n+section if necessary.\n+\n+2. Sync the `rust-lang/rust-clippy` master to the rust-copy of Clippy:\n     ```bash\n     git checkout -b sync-from-clippy\n     git subtree pull -P src/tools/clippy https://github.com/rust-lang/rust-clippy master\n     ```\n-5. Open a PR to [`rust-lang/rust`]\n+3. Open a PR to [`rust-lang/rust`]\n \n-Also, you may want to define remotes, so you don't have to type out the remote\n+### Defining remotes\n+\n+You may want to define remotes, so you don't have to type out the remote\n addresses on every sync. You can do this with the following commands (these\n commands still have to be run inside the `rust` directory):\n \n@@ -241,12 +285,6 @@ You can then sync with the remote names from above, e.g.:\n $ git subtree push -P src/tools/clippy clippy-local sync-from-rust\n ```\n \n-_Note:_ The first time running `git subtree push` a cache has to be built. This\n-involves going through the complete Clippy history once. For this you have to\n-increase the stack limit though, which you can do with `ulimit -s 60000`. For\n-this to work, you will need the fix of `git subtree` available\n-[here][gitgitgadget-pr].\n-\n [gitgitgadget-pr]: https://github.com/gitgitgadget/git/pull/493\n [subtree]: https://rustc-dev-guide.rust-lang.org/contributing.html#external-dependencies-subtree\n [`rust-lang/rust`]: https://github.com/rust-lang/rust"}]}