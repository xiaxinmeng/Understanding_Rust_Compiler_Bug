{"sha": "2019d69f6158be1f2108c12264b2beb94af0aafe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMTlkNjlmNjE1OGJlMWYyMTA4YzEyMjY0YjJiZWI5NGFmMGFhZmU=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2017-12-19T18:28:13Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-12-20T19:38:13Z"}, "message": "feature nll implies two-phase-borrows", "tree": {"sha": "2e76fdf9371481627db01bb65f356280bca402a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e76fdf9371481627db01bb65f356280bca402a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2019d69f6158be1f2108c12264b2beb94af0aafe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2019d69f6158be1f2108c12264b2beb94af0aafe", "html_url": "https://github.com/rust-lang/rust/commit/2019d69f6158be1f2108c12264b2beb94af0aafe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2019d69f6158be1f2108c12264b2beb94af0aafe/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b2db1e6163cb9860a9ec83254d30eac1c9b90e7", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b2db1e6163cb9860a9ec83254d30eac1c9b90e7", "html_url": "https://github.com/rust-lang/rust/commit/0b2db1e6163cb9860a9ec83254d30eac1c9b90e7"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "f897ba4df1d054e50aecc4c148210aee849c98ea", "filename": "src/librustc/session/mod.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Flibrustc%2Fsession%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Flibrustc%2Fsession%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fmod.rs?ref=2019d69f6158be1f2108c12264b2beb94af0aafe", "patch": "@@ -443,6 +443,9 @@ impl Session {\n     pub fn nll_dump_cause(&self) -> bool {\n         self.opts.debugging_opts.nll_dump_cause\n     }\n+    pub fn two_phase_borrows(&self) -> bool {\n+        self.features.borrow().nll || self.opts.debugging_opts.two_phase_borrows\n+    }\n     pub fn emit_end_regions(&self) -> bool {\n         self.opts.debugging_opts.emit_end_regions ||\n             (self.opts.debugging_opts.mir_emit_validate > 0) ||"}, {"sha": "b53e3e4c17a6b5100295aa3e9a35bbadb7f6589c", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=2019d69f6158be1f2108c12264b2beb94af0aafe", "patch": "@@ -774,7 +774,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n \n                 (Read(kind), BorrowKind::Unique) | (Read(kind), BorrowKind::Mut) => {\n                     // Reading from mere reservations of mutable-borrows is OK.\n-                    if this.tcx.sess.opts.debugging_opts.two_phase_borrows && index.is_reservation()\n+                    if this.tcx.sess.two_phase_borrows() && index.is_reservation()\n                     {\n                         return Control::Continue;\n                     }\n@@ -922,7 +922,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                     BorrowKind::Shared => (Deep, Read(ReadKind::Borrow(bk))),\n                     BorrowKind::Unique | BorrowKind::Mut => {\n                         let wk = WriteKind::MutableBorrow(bk);\n-                        if self.tcx.sess.opts.debugging_opts.two_phase_borrows {\n+                        if self.tcx.sess.two_phase_borrows() {\n                             (Deep, Reservation(wk))\n                         } else {\n                             (Deep, Write(wk))\n@@ -1112,7 +1112,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n         span: Span,\n         flow_state: &Flows<'cx, 'gcx, 'tcx>,\n     ) {\n-        if !self.tcx.sess.opts.debugging_opts.two_phase_borrows {\n+        if !self.tcx.sess.two_phase_borrows() {\n             return;\n         }\n "}, {"sha": "162314a8b79ab41a4daa32f89d058caa1a4b78d0", "filename": "src/test/run-pass/borrowck/two-phase-control-flow-split-before-activation.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Ftest%2Frun-pass%2Fborrowck%2Ftwo-phase-control-flow-split-before-activation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2019d69f6158be1f2108c12264b2beb94af0aafe/src%2Ftest%2Frun-pass%2Fborrowck%2Ftwo-phase-control-flow-split-before-activation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fborrowck%2Ftwo-phase-control-flow-split-before-activation.rs?ref=2019d69f6158be1f2108c12264b2beb94af0aafe", "patch": "@@ -10,7 +10,9 @@\n \n // revisions: lxl nll\n //[lxl]compile-flags: -Z borrowck=mir -Z two-phase-borrows\n-//[nll]compile-flags: -Z borrowck=mir -Z two-phase-borrows -Z nll\n+//[nll]compile-flags: -Z borrowck=mir\n+\n+#![cfg_attr(nll, feature(nll))]\n \n fn main() {\n     let mut a = 0;"}]}