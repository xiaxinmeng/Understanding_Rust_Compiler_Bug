{"sha": "835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzNTIwNWI4ZGE4NmExZWVlZTA3ZWZlMTNiZWRmN2ZlYzFhYTdjYmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-20T07:54:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-20T07:54:25Z"}, "message": "Auto merge of #4401 - JJJollyjim:literal-separation-suggestion, r=flip1995\n\nAdd autofixable suggestion for unseparated integer literal suffixes\n\nchangelog: Add autofixable suggestion for unseparated integer literal suffixes\n\nSomewhat WIP, since I haven't been able to get this working when adding `// run-rustfix` to `ui/literals.rs`. I think the issue is that there are multiple suggestions operating on one numerical literal, and I'm not sure what the best approach is to work around that.\n\nThanks", "tree": {"sha": "dab82958edac763fe7e1e65e0c66b3a15c75b7c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dab82958edac763fe7e1e65e0c66b3a15c75b7c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "html_url": "https://github.com/rust-lang/rust/commit/835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd3df6bee0ee07c7dbb562b29576a0b513a4331b", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd3df6bee0ee07c7dbb562b29576a0b513a4331b", "html_url": "https://github.com/rust-lang/rust/commit/cd3df6bee0ee07c7dbb562b29576a0b513a4331b"}, {"sha": "370433f6339856a2863ae85b98b6c2b09813a17a", "url": "https://api.github.com/repos/rust-lang/rust/commits/370433f6339856a2863ae85b98b6c2b09813a17a", "html_url": "https://github.com/rust-lang/rust/commit/370433f6339856a2863ae85b98b6c2b09813a17a"}], "stats": {"total": 177, "additions": 116, "deletions": 61}, "files": [{"sha": "c8ac26044ebc06cca21d01a1115da2e1eac22c94", "filename": "clippy_lints/src/misc_early.rs", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/clippy_lints%2Fsrc%2Fmisc_early.rs", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/clippy_lints%2Fsrc%2Fmisc_early.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc_early.rs?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -1,4 +1,6 @@\n-use crate::utils::{constants, snippet, snippet_opt, span_help_and_lint, span_lint, span_lint_and_then};\n+use crate::utils::{\n+    constants, snippet, snippet_opt, span_help_and_lint, span_lint, span_lint_and_sugg, span_lint_and_then,\n+};\n use if_chain::if_chain;\n use rustc::lint::{in_external_macro, EarlyContext, EarlyLintPass, LintArray, LintContext, LintPass};\n use rustc::{declare_lint_pass, declare_tool_lint};\n@@ -396,11 +398,18 @@ impl MiscEarlyLints {\n             if char::to_digit(firstch, 10).is_some();\n             then {\n                 let mut prev = '\\0';\n-                for ch in src.chars() {\n+                for (idx, ch) in src.chars().enumerate() {\n                     if ch == 'i' || ch == 'u' {\n                         if prev != '_' {\n-                            span_lint(cx, UNSEPARATED_LITERAL_SUFFIX, lit.span,\n-                                        \"integer type suffix should be separated by an underscore\");\n+                            span_lint_and_sugg(\n+                                cx,\n+                                UNSEPARATED_LITERAL_SUFFIX,\n+                                lit.span,\n+                                \"integer type suffix should be separated by an underscore\",\n+                                \"add an underscore\",\n+                                format!(\"{}_{}\", &src[0..idx], &src[idx..]),\n+                                Applicability::MachineApplicable,\n+                            );\n                         }\n                         break;\n                     }\n@@ -451,11 +460,18 @@ impl MiscEarlyLints {\n             if char::to_digit(firstch, 10).is_some();\n             then {\n                 let mut prev = '\\0';\n-                for ch in src.chars() {\n+                for (idx, ch) in src.chars().enumerate() {\n                     if ch == 'f' {\n                         if prev != '_' {\n-                            span_lint(cx, UNSEPARATED_LITERAL_SUFFIX, lit.span,\n-                                        \"float type suffix should be separated by an underscore\");\n+                            span_lint_and_sugg(\n+                                cx,\n+                                UNSEPARATED_LITERAL_SUFFIX,\n+                                lit.span,\n+                                \"float type suffix should be separated by an underscore\",\n+                                \"add an underscore\",\n+                                format!(\"{}_{}\", &src[0..idx], &src[idx..]),\n+                                Applicability::MachineApplicable,\n+                            );\n                         }\n                         break;\n                     }"}, {"sha": "be1d2ed2f4d6110e520fbcef235530d6c81b1ea4", "filename": "tests/ui/literals.rs", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Fliterals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Fliterals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fliterals.rs?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -1,7 +1,7 @@\n #![warn(clippy::large_digit_groups)]\n #![warn(clippy::mixed_case_hex_literals)]\n-#![warn(clippy::unseparated_literal_suffix)]\n #![warn(clippy::zero_prefixed_literal)]\n+#![allow(clippy::unseparated_literal_suffix)]\n #![allow(dead_code)]\n \n fn main() {\n@@ -15,15 +15,6 @@ fn main() {\n     let fail2 = 0xabCD_isize;\n     let fail_multi_zero = 000_123usize;\n \n-    let ok6 = 1234_i32;\n-    let ok7 = 1234_f32;\n-    let ok8 = 1234_isize;\n-    let fail3 = 1234i32;\n-    let fail4 = 1234u32;\n-    let fail5 = 1234isize;\n-    let fail6 = 1234usize;\n-    let fail7 = 1.5f32;\n-\n     let ok9 = 0;\n     let ok10 = 0_i64;\n     let fail8 = 0123;"}, {"sha": "4f3d430c4d9992bd7b02a79c120b15933065f39f", "filename": "tests/ui/literals.stderr", "status": "modified", "additions": 6, "deletions": 44, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Fliterals.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Fliterals.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fliterals.stderr?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -18,14 +18,6 @@ error: inconsistent casing in hexadecimal literal\n LL |     let fail2 = 0xabCD_isize;\n    |                 ^^^^^^^^^^^^\n \n-error: integer type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:16:27\n-   |\n-LL |     let fail_multi_zero = 000_123usize;\n-   |                           ^^^^^^^^^^^^\n-   |\n-   = note: `-D clippy::unseparated-literal-suffix` implied by `-D warnings`\n-\n error: this is a decimal constant\n   --> $DIR/literals.rs:16:27\n    |\n@@ -42,38 +34,8 @@ help: if you mean to use an octal constant, use `0o`\n LL |     let fail_multi_zero = 0o123usize;\n    |                           ^^^^^^^^^^\n \n-error: integer type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:21:17\n-   |\n-LL |     let fail3 = 1234i32;\n-   |                 ^^^^^^^\n-\n-error: integer type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:22:17\n-   |\n-LL |     let fail4 = 1234u32;\n-   |                 ^^^^^^^\n-\n-error: integer type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:23:17\n-   |\n-LL |     let fail5 = 1234isize;\n-   |                 ^^^^^^^^^\n-\n-error: integer type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:24:17\n-   |\n-LL |     let fail6 = 1234usize;\n-   |                 ^^^^^^^^^\n-\n-error: float type suffix should be separated by an underscore\n-  --> $DIR/literals.rs:25:17\n-   |\n-LL |     let fail7 = 1.5f32;\n-   |                 ^^^^^^\n-\n error: this is a decimal constant\n-  --> $DIR/literals.rs:29:17\n+  --> $DIR/literals.rs:20:17\n    |\n LL |     let fail8 = 0123;\n    |                 ^^^^\n@@ -87,32 +49,32 @@ LL |     let fail8 = 0o123;\n    |                 ^^^^^\n \n error: digit groups should be smaller\n-  --> $DIR/literals.rs:40:18\n+  --> $DIR/literals.rs:31:18\n    |\n LL |     let fail13 = 0x1_23456_78901_usize;\n    |                  ^^^^^^^^^^^^^^^^^^^^^ help: consider: `0x0123_4567_8901_usize`\n    |\n    = note: `-D clippy::large-digit-groups` implied by `-D warnings`\n \n error: digits grouped inconsistently by underscores\n-  --> $DIR/literals.rs:42:18\n+  --> $DIR/literals.rs:33:18\n    |\n LL |     let fail19 = 12_3456_21;\n    |                  ^^^^^^^^^^ help: consider: `12_345_621`\n    |\n    = note: `-D clippy::inconsistent-digit-grouping` implied by `-D warnings`\n \n error: digits grouped inconsistently by underscores\n-  --> $DIR/literals.rs:43:18\n+  --> $DIR/literals.rs:34:18\n    |\n LL |     let fail22 = 3__4___23;\n    |                  ^^^^^^^^^ help: consider: `3_423`\n \n error: digits grouped inconsistently by underscores\n-  --> $DIR/literals.rs:44:18\n+  --> $DIR/literals.rs:35:18\n    |\n LL |     let fail23 = 3__16___23;\n    |                  ^^^^^^^^^^ help: consider: `31_623`\n \n-error: aborting due to 15 previous errors\n+error: aborting due to 9 previous errors\n "}, {"sha": "1948b18d16392c71f8072c44bb22e23bb73603c2", "filename": "tests/ui/unseparated_prefix_literals.fixed", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funseparated_prefix_literals.fixed?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -0,0 +1,20 @@\n+// run-rustfix\n+\n+#![warn(clippy::unseparated_literal_suffix)]\n+#![allow(dead_code)]\n+\n+fn main() {\n+    let _ok1 = 1234_i32;\n+    let _ok2 = 1234_isize;\n+    let _ok3 = 0x123_isize;\n+    let _fail1 = 1234_i32;\n+    let _fail2 = 1234_u32;\n+    let _fail3 = 1234_isize;\n+    let _fail4 = 1234_usize;\n+    let _fail5 = 0x123_isize;\n+\n+    let _okf1 = 1.5_f32;\n+    let _okf2 = 1_f32;\n+    let _failf1 = 1.5_f32;\n+    let _failf2 = 1_f32;\n+}"}, {"sha": "d70b1cf29f53f06195fd1f72c210efd1f5f691fb", "filename": "tests/ui/unseparated_prefix_literals.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.rs", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funseparated_prefix_literals.rs?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -0,0 +1,20 @@\n+// run-rustfix\n+\n+#![warn(clippy::unseparated_literal_suffix)]\n+#![allow(dead_code)]\n+\n+fn main() {\n+    let _ok1 = 1234_i32;\n+    let _ok2 = 1234_isize;\n+    let _ok3 = 0x123_isize;\n+    let _fail1 = 1234i32;\n+    let _fail2 = 1234u32;\n+    let _fail3 = 1234isize;\n+    let _fail4 = 1234usize;\n+    let _fail5 = 0x123isize;\n+\n+    let _okf1 = 1.5_f32;\n+    let _okf2 = 1_f32;\n+    let _failf1 = 1.5f32;\n+    let _failf2 = 1f32;\n+}"}, {"sha": "2b8121db3fc045b99de060f8e29c744e220e2621", "filename": "tests/ui/unseparated_prefix_literals.stderr", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/835205b8da86a1eeee07efe13bedf7fec1aa7cbc/tests%2Fui%2Funseparated_prefix_literals.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funseparated_prefix_literals.stderr?ref=835205b8da86a1eeee07efe13bedf7fec1aa7cbc", "patch": "@@ -0,0 +1,46 @@\n+error: integer type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:10:18\n+   |\n+LL |     let _fail1 = 1234i32;\n+   |                  ^^^^^^^ help: add an underscore: `1234_i32`\n+   |\n+   = note: `-D clippy::unseparated-literal-suffix` implied by `-D warnings`\n+\n+error: integer type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:11:18\n+   |\n+LL |     let _fail2 = 1234u32;\n+   |                  ^^^^^^^ help: add an underscore: `1234_u32`\n+\n+error: integer type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:12:18\n+   |\n+LL |     let _fail3 = 1234isize;\n+   |                  ^^^^^^^^^ help: add an underscore: `1234_isize`\n+\n+error: integer type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:13:18\n+   |\n+LL |     let _fail4 = 1234usize;\n+   |                  ^^^^^^^^^ help: add an underscore: `1234_usize`\n+\n+error: integer type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:14:18\n+   |\n+LL |     let _fail5 = 0x123isize;\n+   |                  ^^^^^^^^^^ help: add an underscore: `0x123_isize`\n+\n+error: float type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:18:19\n+   |\n+LL |     let _failf1 = 1.5f32;\n+   |                   ^^^^^^ help: add an underscore: `1.5_f32`\n+\n+error: float type suffix should be separated by an underscore\n+  --> $DIR/unseparated_prefix_literals.rs:19:19\n+   |\n+LL |     let _failf2 = 1f32;\n+   |                   ^^^^ help: add an underscore: `1_f32`\n+\n+error: aborting due to 7 previous errors\n+"}]}