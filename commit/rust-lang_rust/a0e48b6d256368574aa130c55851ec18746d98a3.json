{"sha": "a0e48b6d256368574aa130c55851ec18746d98a3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwZTQ4YjZkMjU2MzY4NTc0YWExMzBjNTU4NTFlYzE4NzQ2ZDk4YTM=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-14T21:53:14Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-14T23:43:39Z"}, "message": "Warn on no_start, crate_id attribute use\n\nThese attributes are now deprecated; they don't have any use anymore.", "tree": {"sha": "875938abbdb60568ee88b49252b6250b6c778d93", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/875938abbdb60568ee88b49252b6250b6c778d93"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a0e48b6d256368574aa130c55851ec18746d98a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a0e48b6d256368574aa130c55851ec18746d98a3", "html_url": "https://github.com/rust-lang/rust/commit/a0e48b6d256368574aa130c55851ec18746d98a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a0e48b6d256368574aa130c55851ec18746d98a3/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "457666860cf198ddacc3d235b7360499eec3b897", "url": "https://api.github.com/repos/rust-lang/rust/commits/457666860cf198ddacc3d235b7360499eec3b897", "html_url": "https://github.com/rust-lang/rust/commit/457666860cf198ddacc3d235b7360499eec3b897"}], "stats": {"total": 52, "additions": 37, "deletions": 15}, "files": [{"sha": "cf19a9eb147a8c1560bfa9d860a9d3cb58f6990f", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -669,6 +669,22 @@ impl DeprecatedAttr {\n     }\n }\n \n+fn lint_deprecated_attr(\n+    cx: &EarlyContext<'_>,\n+    attr: &ast::Attribute,\n+    msg: &str,\n+    suggestion: Option<&str>,\n+) {\n+    cx.struct_span_lint(DEPRECATED, attr.span, &msg)\n+        .span_suggestion_short(\n+            attr.span,\n+            suggestion.unwrap_or(\"remove this attribute\"),\n+            String::new(),\n+            Applicability::MachineApplicable\n+        )\n+        .emit();\n+}\n+\n impl EarlyLintPass for DeprecatedAttr {\n     fn check_attribute(&mut self, cx: &EarlyContext<'_>, attr: &ast::Attribute) {\n         for &&(n, _, _, ref g) in &self.depr_attrs {\n@@ -679,18 +695,15 @@ impl EarlyLintPass for DeprecatedAttr {\n                                              _) = g {\n                     let msg = format!(\"use of deprecated attribute `{}`: {}. See {}\",\n                                       name, reason, link);\n-                    let mut err = cx.struct_span_lint(DEPRECATED, attr.span, &msg);\n-                    err.span_suggestion_short(\n-                        attr.span,\n-                        suggestion.unwrap_or(\"remove this attribute\"),\n-                        String::new(),\n-                        Applicability::MachineApplicable\n-                    );\n-                    err.emit();\n+                    lint_deprecated_attr(cx, attr, &msg, suggestion);\n                 }\n                 return;\n             }\n         }\n+        if attr.check_name(sym::no_start) || attr.check_name(sym::crate_id) {\n+            let msg = format!(\"use of deprecated attribute `{}`: no longer used.\", attr.path);\n+            lint_deprecated_attr(cx, attr, &msg, None);\n+        }\n     }\n }\n "}, {"sha": "79cd0f5fbc358d62626cf332b6629fccf67daeb9", "filename": "src/test/ui/attributes/item-attributes.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fitem-attributes.rs?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -11,8 +11,6 @@\n #![rustc_dummy]\n #![rustc_dummy(attr5)]\n \n-#![crate_id=\"foobar#0.1\"]\n-\n // These are attributes of the following mod\n #[rustc_dummy = \"val\"]\n #[rustc_dummy = \"val\"]"}, {"sha": "68ff95e420895159f2daf9c957b74041e2e0bc63", "filename": "src/test/ui/feature-gate/issue-43106-gating-of-builtin-attrs.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.rs?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -84,12 +84,12 @@\n #![crate_name = \"0900\"]\n #![crate_type = \"bin\"] // cannot pass \"0800\" here\n \n-// For #![crate_id], see issue #43142. (I cannot bear to enshrine current behavior in a test)\n+#![crate_id = \"10\"] //~ WARN use of deprecated attribute\n \n // FIXME(#44232) we should warn that this isn't used.\n #![feature(rust1)]\n \n-// For #![no_start], see issue #43144. (I cannot bear to enshrine current behavior in a test)\n+#![no_start] //~ WARN use of deprecated attribute\n \n // (cannot easily gating state of crate-level #[no_main]; but non crate-level is below at \"0400\")\n #![no_builtins]"}, {"sha": "b2a6018b5354d145970352633e826e321034fab8", "filename": "src/test/ui/feature-gate/issue-43106-gating-of-builtin-attrs.stderr", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gate%2Fissue-43106-gating-of-builtin-attrs.stderr?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -186,6 +186,20 @@ LL |     mod inner { #![macro_escape] }\n    |\n    = help: consider an outer attribute, `#[macro_use]` mod ...\n \n+warning: use of deprecated attribute `crate_id`: no longer used.\n+  --> $DIR/issue-43106-gating-of-builtin-attrs.rs:87:1\n+   |\n+LL | #![crate_id = \"10\"]\n+   | ^^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+   = note: `#[warn(deprecated)]` on by default\n+\n+warning: use of deprecated attribute `no_start`: no longer used.\n+  --> $DIR/issue-43106-gating-of-builtin-attrs.rs:92:1\n+   |\n+LL | #![no_start]\n+   | ^^^^^^^^^^^^ help: remove this attribute\n+\n warning: the feature `rust1` has been stable since 1.0.0 and no longer requires an attribute to enable\n   --> $DIR/issue-43106-gating-of-builtin-attrs.rs:90:12\n    |"}, {"sha": "77278ecda6ecb1d20ed85df56c21e991733d85d6", "filename": "src/test/ui/issues/issue-1251.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-1251.rs?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -6,8 +6,6 @@\n \n #![feature(rustc_private)]\n \n-#![crate_id=\"rust_get_test_int\"]\n-\n mod rustrt {\n     extern crate libc;\n "}, {"sha": "6f1e1f97708efd41a9c68f09f1a87a7727c7a435", "filename": "src/test/ui/issues/issue-6919.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a0e48b6d256368574aa130c55851ec18746d98a3/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-6919.rs?ref=a0e48b6d256368574aa130c55851ec18746d98a3", "patch": "@@ -4,7 +4,6 @@\n \n // pretty-expanded FIXME #23616\n \n-#![crate_id=\"issue-6919\"]\n extern crate issue6919_3;\n \n pub fn main() {"}]}