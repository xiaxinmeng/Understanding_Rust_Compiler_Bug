{"sha": "d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyZjcxYmYyM2Y2N2IxOGZiZGI2NGYxMTczYWYxYTBkZGM2NDk0MjE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-07T09:36:12Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-07T09:36:12Z"}, "message": "Auto merge of #44860 - kennytm:fix-44731, r=alexcrichton\n\nFix issue #44731.\n\nAlso excludes `impl Trait` from everybody_loops if it appears in the path.\n\nFixes #44731.", "tree": {"sha": "61e4b407172484312fd6a6b410bba5ec0ad66855", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/61e4b407172484312fd6a6b410bba5ec0ad66855"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "html_url": "https://github.com/rust-lang/rust/commit/d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2f71bf23f67b18fbdb64f1173af1a0ddc649421/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cce93436d3628f5fa8288c7e84f4b695542c6ae3", "url": "https://api.github.com/repos/rust-lang/rust/commits/cce93436d3628f5fa8288c7e84f4b695542c6ae3", "html_url": "https://github.com/rust-lang/rust/commit/cce93436d3628f5fa8288c7e84f4b695542c6ae3"}, {"sha": "16c110f78b464f1c57a9142f6abb38c2a53c05ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/16c110f78b464f1c57a9142f6abb38c2a53c05ad", "html_url": "https://github.com/rust-lang/rust/commit/16c110f78b464f1c57a9142f6abb38c2a53c05ad"}], "stats": {"total": 69, "additions": 68, "deletions": 1}, "files": [{"sha": "e6d89f77f2163aaf9961ea68ca447fd77593c576", "filename": "src/librustc_driver/pretty.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d2f71bf23f67b18fbdb64f1173af1a0ddc649421/src%2Flibrustc_driver%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2f71bf23f67b18fbdb64f1173af1a0ddc649421/src%2Flibrustc_driver%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fpretty.rs?ref=d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "patch": "@@ -659,10 +659,26 @@ impl ReplaceBodyWithLoop {\n                     ast::TyKind::Ptr(ast::MutTy { ty: ref subty, .. }) |\n                     ast::TyKind::Rptr(_, ast::MutTy { ty: ref subty, .. }) |\n                     ast::TyKind::Paren(ref subty) => involves_impl_trait(subty),\n-                    ast::TyKind::Tup(ref tys) => tys.iter().any(|subty| involves_impl_trait(subty)),\n+                    ast::TyKind::Tup(ref tys) => any_involves_impl_trait(tys.iter()),\n+                    ast::TyKind::Path(_, ref path) => path.segments.iter().any(|seg| {\n+                        match seg.parameters.as_ref().map(|p| &**p) {\n+                            None => false,\n+                            Some(&ast::PathParameters::AngleBracketed(ref data)) =>\n+                                any_involves_impl_trait(data.types.iter()) ||\n+                                any_involves_impl_trait(data.bindings.iter().map(|b| &b.ty)),\n+                            Some(&ast::PathParameters::Parenthesized(ref data)) =>\n+                                any_involves_impl_trait(data.inputs.iter()) ||\n+                                any_involves_impl_trait(data.output.iter()),\n+                        }\n+                    }),\n                     _ => false,\n                 }\n             }\n+\n+            fn any_involves_impl_trait<'a, I: Iterator<Item = &'a P<ast::Ty>>>(mut it: I) -> bool {\n+                it.any(|subty| involves_impl_trait(subty))\n+            }\n+\n             involves_impl_trait(ty)\n         } else {\n             false"}, {"sha": "4670c5386c83c358ac7b52e6c7db983a87c71959", "filename": "src/test/rustdoc/issue-43869.rs", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/d2f71bf23f67b18fbdb64f1173af1a0ddc649421/src%2Ftest%2Frustdoc%2Fissue-43869.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2f71bf23f67b18fbdb64f1173af1a0ddc649421/src%2Ftest%2Frustdoc%2Fissue-43869.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-43869.rs?ref=d2f71bf23f67b18fbdb64f1173af1a0ddc649421", "patch": "@@ -26,7 +26,58 @@ pub fn j() -> impl Iterator<Item=u8> + Clone {\n     Some(1u8).into_iter()\n }\n \n+pub fn k() -> [impl Clone; 2] {\n+    [123u32, 456u32]\n+}\n+\n+pub fn l() -> (impl Clone, impl Default) {\n+    (789u32, -123i32)\n+}\n+\n+pub fn m() -> &'static impl Clone {\n+    &1u8\n+}\n+\n+pub fn n() -> *const impl Clone {\n+    &1u8\n+}\n+\n+pub fn o() -> &'static [impl Clone] {\n+    b\":)\"\n+}\n+\n+// issue #44731\n+pub fn test_44731_0() -> Box<impl Iterator<Item=u8>> {\n+    Box::new(g())\n+}\n+\n+pub fn test_44731_1() -> Result<Box<impl Clone>, ()> {\n+    Ok(Box::new(j()))\n+}\n+\n+pub fn test_44731_2() -> Box<Fn(impl Clone)> {\n+    Box::new(|_: u32| {})\n+}\n+\n+pub fn test_44731_3() -> Box<Fn() -> impl Clone> {\n+    Box::new(|| 0u32)\n+}\n+\n+pub fn test_44731_4() -> Box<Iterator<Item=impl Clone>> {\n+    Box::new(g())\n+}\n+\n // @has issue_43869/fn.g.html\n // @has issue_43869/fn.h.html\n // @has issue_43869/fn.i.html\n // @has issue_43869/fn.j.html\n+// @has issue_43869/fn.k.html\n+// @has issue_43869/fn.l.html\n+// @has issue_43869/fn.m.html\n+// @has issue_43869/fn.n.html\n+// @has issue_43869/fn.o.html\n+// @has issue_43869/fn.test_44731_0.html\n+// @has issue_43869/fn.test_44731_1.html\n+// @has issue_43869/fn.test_44731_2.html\n+// @has issue_43869/fn.test_44731_3.html\n+// @has issue_43869/fn.test_44731_4.html"}]}