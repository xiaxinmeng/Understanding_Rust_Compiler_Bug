{"sha": "2941434d1b20231a277cc69c84df3e09ad9a0401", "node_id": "C_kwDOAAsO6NoAKDI5NDE0MzRkMWIyMDIzMWEyNzdjYzY5Yzg0ZGYzZTA5YWQ5YTA0MDE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-05-20T17:54:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-20T17:54:43Z"}, "message": "Rollup merge of #97208 - fmease:fix-issue-97205, r=oli-obk\n\nDo not emit the lint `unused_attributes` for *inherent* `#[doc(hidden)]` associated items\n\nFixes #97205 (embarrassing oversight from #96008).\n\n`@rustbot` label A-lint", "tree": {"sha": "46d2e6a9e8a65dce705eb506a55a5f1b635d06b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46d2e6a9e8a65dce705eb506a55a5f1b635d06b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2941434d1b20231a277cc69c84df3e09ad9a0401", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJih9XkCRBK7hj4Ov3rIwAAhboIADlH97K5o1egWedTOFqTXP40\nnrn51dR/FKZf3GfX0WtBso5QD2x1XDmrJR2i7l0uV8HMfi90VFZK8T5/7vwJkEEP\nK9aj9hlkk/tQSvQl2Gmla4hdQyvoR4ciaaNAyg2Cq2pfxLZcDXTIMjO/c20bD5XN\nUQSjCl4pWyVkYlX4xIhOmVGh0wyuyyrCQWBHddspKkQnO2Y8KYR42mwgr8qKxCNv\n4S16WMKokmieWePeQvYCgG0/CWwEFXwhcvAqhXUJ3tRbAQzJcXpv0p/TdERrzjTJ\noOhZ/U0Lt6eLiTtP54bZiEpxtbLgd0JFb2kh3XPzLV+PsIJeHGVkMF98LrDiFCE=\n=y1l7\n-----END PGP SIGNATURE-----\n", "payload": "tree 46d2e6a9e8a65dce705eb506a55a5f1b635d06b9\nparent 7c46bb60d19262af4388a11e274d81b38469c85b\nparent e7252739cdaf75d52dcdd6fb8abfa7d495e22a09\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1653069283 +0200\ncommitter GitHub <noreply@github.com> 1653069283 +0200\n\nRollup merge of #97208 - fmease:fix-issue-97205, r=oli-obk\n\nDo not emit the lint `unused_attributes` for *inherent* `#[doc(hidden)]` associated items\n\nFixes #97205 (embarrassing oversight from #96008).\n\n`@rustbot` label A-lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2941434d1b20231a277cc69c84df3e09ad9a0401", "html_url": "https://github.com/rust-lang/rust/commit/2941434d1b20231a277cc69c84df3e09ad9a0401", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2941434d1b20231a277cc69c84df3e09ad9a0401/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c46bb60d19262af4388a11e274d81b38469c85b", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c46bb60d19262af4388a11e274d81b38469c85b", "html_url": "https://github.com/rust-lang/rust/commit/7c46bb60d19262af4388a11e274d81b38469c85b"}, {"sha": "e7252739cdaf75d52dcdd6fb8abfa7d495e22a09", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7252739cdaf75d52dcdd6fb8abfa7d495e22a09", "html_url": "https://github.com/rust-lang/rust/commit/e7252739cdaf75d52dcdd6fb8abfa7d495e22a09"}], "stats": {"total": 46, "additions": 36, "deletions": 10}, "files": [{"sha": "3d5da114ecfde758cbb09e21d9738b8b0cb1d564", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2941434d1b20231a277cc69c84df3e09ad9a0401/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2941434d1b20231a277cc69c84df3e09ad9a0401/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=2941434d1b20231a277cc69c84df3e09ad9a0401", "patch": "@@ -832,7 +832,7 @@ impl CheckAttrVisitor<'_> {\n             let parent_hir_id = self.tcx.hir().get_parent_item(hir_id);\n             let containing_item = self.tcx.hir().expect_item(parent_hir_id);\n \n-            if Target::from_item(containing_item) == Target::Impl {\n+            if let hir::ItemKind::Impl(hir::Impl { of_trait: Some(_), .. }) = containing_item.kind {\n                 let meta_items = attr.meta_item_list().unwrap();\n \n                 let (span, replacement_span) = if meta_items.len() == 1 {"}, {"sha": "362ad55707a4a37fc2c715880cd6c6f4df191361", "filename": "src/test/ui/lint/unused/unused-attr-doc-hidden.fixed", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.fixed?ref=2941434d1b20231a277cc69c84df3e09ad9a0401", "patch": "@@ -1,5 +1,7 @@\n-#![deny(unused_attributes)]\n+#![feature(inherent_associated_types)]\n+#![allow(dead_code, incomplete_features)]\n #![crate_type = \"lib\"]\n+#![deny(unused_attributes)]\n // run-rustfix\n \n pub trait Trait {\n@@ -12,6 +14,17 @@ pub trait Trait {\n \n pub struct Implementor;\n \n+impl Implementor {\n+    #[doc(hidden)] // no error\n+    type Inh = ();\n+\n+    #[doc(hidden)] // no error\n+    const INH: () = ();\n+\n+    #[doc(hidden)] // no error\n+    fn inh() {}\n+}\n+\n impl Trait for Implementor {\n     \n     type It = ();"}, {"sha": "d493ed6dae2065ba01f36624ac7b70021df6ca7d", "filename": "src/test/ui/lint/unused/unused-attr-doc-hidden.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.rs?ref=2941434d1b20231a277cc69c84df3e09ad9a0401", "patch": "@@ -1,5 +1,7 @@\n-#![deny(unused_attributes)]\n+#![feature(inherent_associated_types)]\n+#![allow(dead_code, incomplete_features)]\n #![crate_type = \"lib\"]\n+#![deny(unused_attributes)]\n // run-rustfix\n \n pub trait Trait {\n@@ -12,6 +14,17 @@ pub trait Trait {\n \n pub struct Implementor;\n \n+impl Implementor {\n+    #[doc(hidden)] // no error\n+    type Inh = ();\n+\n+    #[doc(hidden)] // no error\n+    const INH: () = ();\n+\n+    #[doc(hidden)] // no error\n+    fn inh() {}\n+}\n+\n impl Trait for Implementor {\n     #[doc(hidden)]\n     type It = ();"}, {"sha": "f167bd460db3edd8ccdb3915eb5dae59a3eee5e3", "filename": "src/test/ui/lint/unused/unused-attr-doc-hidden.stderr", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2941434d1b20231a277cc69c84df3e09ad9a0401/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Funused-attr-doc-hidden.stderr?ref=2941434d1b20231a277cc69c84df3e09ad9a0401", "patch": "@@ -1,19 +1,19 @@\n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:16:5\n+  --> $DIR/unused-attr-doc-hidden.rs:29:5\n    |\n LL |     #[doc(hidden)]\n    |     ^^^^^^^^^^^^^^ help: remove this attribute\n    |\n note: the lint level is defined here\n-  --> $DIR/unused-attr-doc-hidden.rs:1:9\n+  --> $DIR/unused-attr-doc-hidden.rs:4:9\n    |\n LL | #![deny(unused_attributes)]\n    |         ^^^^^^^^^^^^^^^^^\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: whether the impl item is `doc(hidden)` or not entirely depends on the corresponding trait item\n \n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:21:5\n+  --> $DIR/unused-attr-doc-hidden.rs:34:5\n    |\n LL |     #[doc(hidden)]\n    |     ^^^^^^^^^^^^^^ help: remove this attribute\n@@ -22,7 +22,7 @@ LL |     #[doc(hidden)]\n    = note: whether the impl item is `doc(hidden)` or not entirely depends on the corresponding trait item\n \n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:26:11\n+  --> $DIR/unused-attr-doc-hidden.rs:39:11\n    |\n LL |     #[doc(hidden, alias = \"aka\")]\n    |           ^^^^^^--\n@@ -33,7 +33,7 @@ LL |     #[doc(hidden, alias = \"aka\")]\n    = note: whether the impl item is `doc(hidden)` or not entirely depends on the corresponding trait item\n \n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:31:27\n+  --> $DIR/unused-attr-doc-hidden.rs:44:27\n    |\n LL |     #[doc(alias = \"this\", hidden,)]\n    |                           ^^^^^^-\n@@ -44,7 +44,7 @@ LL |     #[doc(alias = \"this\", hidden,)]\n    = note: whether the impl item is `doc(hidden)` or not entirely depends on the corresponding trait item\n \n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:36:11\n+  --> $DIR/unused-attr-doc-hidden.rs:49:11\n    |\n LL |     #[doc(hidden, hidden)]\n    |           ^^^^^^--\n@@ -55,7 +55,7 @@ LL |     #[doc(hidden, hidden)]\n    = note: whether the impl item is `doc(hidden)` or not entirely depends on the corresponding trait item\n \n error: `#[doc(hidden)]` is ignored on trait impl items\n-  --> $DIR/unused-attr-doc-hidden.rs:36:19\n+  --> $DIR/unused-attr-doc-hidden.rs:49:19\n    |\n LL |     #[doc(hidden, hidden)]\n    |                   ^^^^^^ help: remove this attribute"}]}