{"sha": "f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "node_id": "C_kwDOAAsO6NoAKGY1OGMyNmUwYmEzZTRjYzBiM2VmZTQzMDdiMTdlODc1YzYyOWYzZWQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-10T14:20:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-10T14:20:46Z"}, "message": "Auto merge of #12501 - Veykril:dashmap, r=Veykril\n\ninternal: Update dashmap and freeze its version", "tree": {"sha": "950b2a1111ffb742fb9d2c9b2ae06fe97604a1c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/950b2a1111ffb742fb9d2c9b2ae06fe97604a1c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "html_url": "https://github.com/rust-lang/rust/commit/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79a4a464b07d626de17bd4b5f2382b5634644f7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/79a4a464b07d626de17bd4b5f2382b5634644f7d", "html_url": "https://github.com/rust-lang/rust/commit/79a4a464b07d626de17bd4b5f2382b5634644f7d"}, {"sha": "0cf677ab42a37e5139efd100af153d48bfb985ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/0cf677ab42a37e5139efd100af153d48bfb985ae", "html_url": "https://github.com/rust-lang/rust/commit/0cf677ab42a37e5139efd100af153d48bfb985ae"}], "stats": {"total": 41, "additions": 19, "deletions": 22}, "files": [{"sha": "b736e00400db27105c1dba7b8f815794ca152ecc", "filename": "Cargo.lock", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "patch": "@@ -294,13 +294,14 @@ dependencies = [\n \n [[package]]\n name = \"dashmap\"\n-version = \"5.2.0\"\n+version = \"5.3.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4c8858831f7781322e539ea39e72449c46b059638250c14344fec8d0aa6e539c\"\n+checksum = \"3495912c9c1ccf2e18976439f4443f3fee0fd61f424ff99fde6a66b15ecb448f\"\n dependencies = [\n  \"cfg-if\",\n- \"num_cpus\",\n- \"parking_lot 0.12.0\",\n+ \"hashbrown 0.12.1\",\n+ \"lock_api\",\n+ \"parking_lot_core 0.9.3\",\n ]\n \n [[package]]\n@@ -505,15 +506,14 @@ dependencies = [\n  \"either\",\n  \"expect-test\",\n  \"fst\",\n+ \"hashbrown 0.12.1\",\n  \"hir-expand\",\n  \"indexmap\",\n  \"itertools\",\n  \"la-arena\",\n  \"limit\",\n- \"lock_api\",\n  \"mbe\",\n  \"once_cell\",\n- \"parking_lot 0.12.0\",\n  \"profile\",\n  \"rustc-hash\",\n  \"smallvec\","}, {"sha": "def8428d732178daa2216f76aa60b9a079e60759", "filename": "crates/hir-def/Cargo.toml", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/crates%2Fhir-def%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/crates%2Fhir-def%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2FCargo.toml?ref=f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "patch": "@@ -10,23 +10,23 @@ rust-version = \"1.57\"\n doctest = false\n \n [dependencies]\n+anymap = \"0.12.1\"\n+arrayvec = \"0.7.2\"\n bitflags = \"1.3.2\"\n cov-mark = \"2.0.0-pre.1\"\n-dashmap = { version = \"5.2.0\", features = [\"raw-api\"] }\n-lock_api = \"0.4.6\"\n-parking_lot = \"0.12.0\"\n-tracing = \"0.1.32\"\n-once_cell = \"1.10.0\"\n-rustc-hash = \"1.1.0\"\n-either = \"1.6.1\"\n-anymap = \"0.12.1\"\n+# We need to freeze the version of the crate, as the raw-api feature is considered unstable\n+dashmap = { version = \"=5.3.4\", features = [\"raw-api\"] }\n drop_bomb = \"0.1.5\"\n+either = \"1.6.1\"\n fst = { version = \"0.4.7\", default-features = false }\n-itertools = \"0.10.3\"\n+hashbrown = { version = \"0.12.1\", default-features = false }\n indexmap = \"1.8.0\"\n-smallvec = \"1.8.0\"\n-arrayvec = \"0.7.2\"\n+itertools = \"0.10.3\"\n la-arena = { version = \"0.3.0\", path = \"../../lib/la-arena\" }\n+once_cell = \"1.10.0\"\n+rustc-hash = \"1.1.0\"\n+smallvec = \"1.8.0\"\n+tracing = \"0.1.32\"\n \n stdx = { path = \"../stdx\", version = \"0.0.0\" }\n base-db = { path = \"../base-db\", version = \"0.0.0\" }"}, {"sha": "f08521a34032b7b79846785af3f92daa174d11fd", "filename": "crates/hir-def/src/intern.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/crates%2Fhir-def%2Fsrc%2Fintern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed/crates%2Fhir-def%2Fsrc%2Fintern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fintern.rs?ref=f58c26e0ba3e4cc0b3efe4307b17e875c629f3ed", "patch": "@@ -3,25 +3,22 @@\n //! Eventually this should probably be replaced with salsa-based interning.\n \n use std::{\n-    collections::HashMap,\n     fmt::{self, Debug, Display},\n     hash::{BuildHasherDefault, Hash, Hasher},\n     ops::Deref,\n     sync::Arc,\n };\n \n use dashmap::{DashMap, SharedValue};\n-use lock_api::RwLockWriteGuard;\n+use hashbrown::HashMap;\n use once_cell::sync::OnceCell;\n-use parking_lot::RawRwLock;\n use rustc_hash::FxHasher;\n \n use crate::generics::GenericParams;\n \n type InternMap<T> = DashMap<Arc<T>, (), BuildHasherDefault<FxHasher>>;\n-type Guard<T> = RwLockWriteGuard<\n+type Guard<T> = dashmap::RwLockWriteGuard<\n     'static,\n-    RawRwLock,\n     HashMap<Arc<T>, SharedValue<()>, BuildHasherDefault<FxHasher>>,\n >;\n "}]}