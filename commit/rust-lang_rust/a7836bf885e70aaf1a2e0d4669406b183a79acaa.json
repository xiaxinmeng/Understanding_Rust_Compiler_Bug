{"sha": "a7836bf885e70aaf1a2e0d4669406b183a79acaa", "node_id": "C_kwDOAAsO6NoAKGE3ODM2YmY4ODVlNzBhYWYxYTJlMGQ0NjY5NDA2YjE4M2E3OWFjYWE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-26T06:44:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-26T06:44:00Z"}, "message": "Auto merge of #91181 - GuillaumeGomez:improve-rustdoc-gui-ci, r=jsha\n\nImprove rustdoc-gui CI\n\nAs commented [here](https://github.com/rust-lang/rust/pull/91179#discussion_r756023009):\n\nWhen the text isn't displayed, the color returned by puppeteer is always `rgba(0,0,0,0)`, which is definitely not the right value. To prevent this error from happening again, `browser-ui-test` will now fail if a CSS color check is run when the text isn't displayed.\n\nEither this PR or #91179 is merged first, they'll conflict because I made changes to the same test file.\n\ncc `@jyn514`\nr? `@jsha`", "tree": {"sha": "14ed3eef0a3ffcf0e0b8bcd41a29f2d256cd6db1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14ed3eef0a3ffcf0e0b8bcd41a29f2d256cd6db1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7836bf885e70aaf1a2e0d4669406b183a79acaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7836bf885e70aaf1a2e0d4669406b183a79acaa", "html_url": "https://github.com/rust-lang/rust/commit/a7836bf885e70aaf1a2e0d4669406b183a79acaa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7836bf885e70aaf1a2e0d4669406b183a79acaa/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9adfd9db78b274bd710a94d7778cbd5db11b9241", "url": "https://api.github.com/repos/rust-lang/rust/commits/9adfd9db78b274bd710a94d7778cbd5db11b9241", "html_url": "https://github.com/rust-lang/rust/commit/9adfd9db78b274bd710a94d7778cbd5db11b9241"}, {"sha": "e340478f5d4b9b5552a93f60a40c0b4d44b47ae7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e340478f5d4b9b5552a93f60a40c0b4d44b47ae7", "html_url": "https://github.com/rust-lang/rust/commit/e340478f5d4b9b5552a93f60a40c0b4d44b47ae7"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "f71282a1b52d47bd1411e2331df71f32a8557e9c", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-tools/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile?ref=a7836bf885e70aaf1a2e0d4669406b183a79acaa", "patch": "@@ -72,7 +72,7 @@ ENV PATH=\"/node-v14.4.0-linux-x64/bin:${PATH}\"\n # https://github.com/puppeteer/puppeteer/issues/375\n #\n # We also specify the version in case we need to update it to go around cache limitations.\n-RUN npm install -g browser-ui-test@0.4.5 --unsafe-perm=true\n+RUN npm install -g browser-ui-test@0.5.0 --unsafe-perm=true\n \n ENV RUST_CONFIGURE_ARGS \\\n   --build=x86_64-unknown-linux-gnu \\"}, {"sha": "5f809f9aa4ed4b033b2d3bd54a7954bfe3846b8e", "filename": "src/test/rustdoc-gui/anchors.goml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Ftest%2Frustdoc-gui%2Fanchors.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fanchors.goml?ref=a7836bf885e70aaf1a2e0d4669406b183a79acaa", "patch": "@@ -1,5 +1,6 @@\n // This test is to ensure that the anchors (`\u00a7`) have the expected color.\n goto: file://|DOC_PATH|/test_docs/struct.HeavilyDocumentedStruct.html\n+show-text: true\n \n // This is needed to ensure that the text color is computed.\n show-text: true"}, {"sha": "7a8f8ca5311adf90a4ba46a13243115f901c775f", "filename": "src/test/rustdoc-gui/search-filter.goml", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a7836bf885e70aaf1a2e0d4669406b183a79acaa/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml?ref=a7836bf885e70aaf1a2e0d4669406b183a79acaa", "patch": "@@ -1,9 +1,11 @@\n goto: file://|DOC_PATH|/test_docs/index.html\n+show-text: true\n write: (\".search-input\", \"test\")\n // Waiting for the search results to appear...\n wait-for: \"#titles\"\n assert-text: (\"#results .externcrate\", \"test_docs\")\n-text: (\".search-input\", \"\")\n+\n+goto: file://|DOC_PATH|/test_docs/index.html\n // We now want to change the crate filter.\n click: \"#crate-search\"\n // We select \"lib2\" option then press enter to change the filter."}]}