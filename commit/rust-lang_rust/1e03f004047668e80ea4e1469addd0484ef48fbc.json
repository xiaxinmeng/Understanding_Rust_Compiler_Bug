{"sha": "1e03f004047668e80ea4e1469addd0484ef48fbc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlMDNmMDA0MDQ3NjY4ZTgwZWE0ZTE0NjlhZGRkMDQ4NGVmNDhmYmM=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-05-06T18:21:51Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-05-06T18:21:51Z"}, "message": "Use #env to bake a git revision string into rustc's --version output.", "tree": {"sha": "852fa5123f4b03475a87a1930d98c3ab44532e3c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/852fa5123f4b03475a87a1930d98c3ab44532e3c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e03f004047668e80ea4e1469addd0484ef48fbc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e03f004047668e80ea4e1469addd0484ef48fbc", "html_url": "https://github.com/rust-lang/rust/commit/1e03f004047668e80ea4e1469addd0484ef48fbc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e03f004047668e80ea4e1469addd0484ef48fbc/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8df37716ce040e34b0097f7c3f9a48f9f3749aae", "url": "https://api.github.com/repos/rust-lang/rust/commits/8df37716ce040e34b0097f7c3f9a48f9f3749aae", "html_url": "https://github.com/rust-lang/rust/commit/8df37716ce040e34b0097f7c3f9a48f9f3749aae"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "c32ac1e498670ec5541bd94bf8d8596d0a2c2bca", "filename": "Makefile.in", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1e03f004047668e80ea4e1469addd0484ef48fbc/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/1e03f004047668e80ea4e1469addd0484ef48fbc/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=1e03f004047668e80ea4e1469addd0484ef48fbc", "patch": "@@ -35,6 +35,14 @@ CFG_RUNTIME :=$(call CFG_LIB_NAME,rustrt)\n CFG_RUSTLLVM :=$(call CFG_LIB_NAME,rustllvm)\n CFG_STDLIB :=$(call CFG_LIB_NAME,std)\n \n+# version-string calculation\n+CFG_GIT_DIR := $(CFG_SRC_DIR).git\n+CFG_VERSION := prerelease\n+ifneq ($(wildcard $(CFG_GIT_DIR)),)\n+    CFG_VERSION += $(shell git --git-dir=$(CFG_GIT_DIR) log -1 \\\n+                     --pretty=format:'(%h %ci)')\n+endif\n+\n ifdef CFG_OCAMLC_OPT\n   $(info cfg: have ocaml native compiler)\n   OPT=.opt\n@@ -140,6 +148,7 @@ SREQ2 := stage2/rustc$(X) $(LREQ) stage3/glue.o stage3/$(CFG_STDLIB)\n ######################################################################\n \n export CFG_SRC_DIR\n+export CFG_VERSION\n \n ######################################################################\n # Subprograms"}, {"sha": "aef6ef3bdcd7697c6bd060c8395183f0655fd26c", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1e03f004047668e80ea4e1469addd0484ef48fbc/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e03f004047668e80ea4e1469addd0484ef48fbc/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=1e03f004047668e80ea4e1469addd0484ef48fbc", "patch": "@@ -127,11 +127,12 @@ fn pretty_print_input(session.session sess,\n }\n \n fn version(str argv0) {\n-    auto git_rev = \"\"; // when snapshotted to extenv: #env(\"GIT_REV\");\n-    if (_str.byte_len(git_rev) != 0u) {\n-        git_rev = #fmt(\" (git: %s)\", git_rev);\n+    auto vers = \"unknown version\";\n+    auto env_vers = #env(\"CFG_VERSION\");\n+    if (_str.byte_len(env_vers) != 0u) {\n+        vers = env_vers;\n     }\n-    io.stdout().write_str(#fmt(\"%s prerelease%s\\n\", argv0, git_rev));\n+    io.stdout().write_str(#fmt(\"%s %s\\n\", argv0, vers));\n }\n \n fn usage(str argv0) {"}]}