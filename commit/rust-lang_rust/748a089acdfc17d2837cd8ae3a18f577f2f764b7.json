{"sha": "748a089acdfc17d2837cd8ae3a18f577f2f764b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0OGEwODlhY2RmYzE3ZDI4MzdjZDhhZTNhMThmNTc3ZjJmNzY0Yjc=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-08-27T16:36:18Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-08-30T10:46:07Z"}, "message": "Disallow the aapcs CC on Aarch64\n\nThis never really worked and makes LLVM assert.", "tree": {"sha": "7f918541ff8f3c8eccd4a18be992f0533295cbda", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f918541ff8f3c8eccd4a18be992f0533295cbda"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/748a089acdfc17d2837cd8ae3a18f577f2f764b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/748a089acdfc17d2837cd8ae3a18f577f2f764b7", "html_url": "https://github.com/rust-lang/rust/commit/748a089acdfc17d2837cd8ae3a18f577f2f764b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/748a089acdfc17d2837cd8ae3a18f577f2f764b7/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbb0fe9d803f7fa8688b33306266a6b054c2c3f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbb0fe9d803f7fa8688b33306266a6b054c2c3f4", "html_url": "https://github.com/rust-lang/rust/commit/dbb0fe9d803f7fa8688b33306266a6b054c2c3f4"}], "stats": {"total": 129, "additions": 101, "deletions": 28}, "files": [{"sha": "4d0cad80764e946ab950711644c2d3ffd56b14fe", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -1501,7 +1501,8 @@ impl Target {\n             | Cdecl\n             | EfiApi => true,\n             X86Interrupt => [\"x86\", \"x86_64\"].contains(&&self.arch[..]),\n-            Aapcs | CCmseNonSecureCall => [\"arm\", \"aarch64\"].contains(&&self.arch[..]),\n+            Aapcs => \"arm\" == self.arch,\n+            CCmseNonSecureCall => [\"arm\", \"aarch64\"].contains(&&self.arch[..]),\n             Win64 | SysV64 => self.arch == \"x86_64\",\n             PtxKernel => self.arch == \"nvptx64\",\n             Msp430Interrupt => self.arch == \"msp430\","}, {"sha": "225d49e05a3fa49fef67994992f726d6c772bbcf", "filename": "src/test/ui/abi/unsupported.aarch64.stderr", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.aarch64.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.aarch64.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Funsupported.aarch64.stderr?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -1,41 +1,47 @@\n error[E0570]: `\"ptx-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:24:1\n+  --> $DIR/unsupported.rs:26:1\n    |\n LL | extern \"ptx-kernel\" fn ptx() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"amdgpu-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:26:1\n+  --> $DIR/unsupported.rs:28:1\n    |\n LL | extern \"amdgpu-kernel\" fn amdgpu() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"wasm\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:28:1\n+  --> $DIR/unsupported.rs:30:1\n    |\n LL | extern \"wasm\" fn wasm() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^\n \n+error[E0570]: `\"aapcs\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:32:1\n+   |\n+LL | extern \"aapcs\" fn aapcs() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error[E0570]: `\"msp430-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:33:1\n+  --> $DIR/unsupported.rs:36:1\n    |\n LL | extern \"msp430-interrupt\" fn msp430() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"avr-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:35:1\n+  --> $DIR/unsupported.rs:38:1\n    |\n LL | extern \"avr-interrupt\" fn avr() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"x86-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:37:1\n+  --> $DIR/unsupported.rs:40:1\n    |\n LL | extern \"x86-interrupt\" fn x86() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: use of calling convention not supported on this target\n-  --> $DIR/unsupported.rs:39:1\n+  --> $DIR/unsupported.rs:43:1\n    |\n LL | extern \"stdcall\" fn stdcall() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -45,14 +51,14 @@ LL | extern \"stdcall\" fn stdcall() {}\n    = note: for more information, see issue #87678 <https://github.com/rust-lang/rust/issues/87678>\n \n warning: use of calling convention not supported on this target\n-  --> $DIR/unsupported.rs:44:1\n+  --> $DIR/unsupported.rs:50:1\n    |\n LL | extern \"thiscall\" fn thiscall() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #87678 <https://github.com/rust-lang/rust/issues/87678>\n \n-error: aborting due to 6 previous errors; 2 warnings emitted\n+error: aborting due to 7 previous errors; 2 warnings emitted\n \n For more information about this error, try `rustc --explain E0570`."}, {"sha": "b050ee0aa3148501b5bc94661152b5d2a07633b3", "filename": "src/test/ui/abi/unsupported.arm.stderr", "status": "added", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.arm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.arm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Funsupported.arm.stderr?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -0,0 +1,58 @@\n+error[E0570]: `\"ptx-kernel\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:26:1\n+   |\n+LL | extern \"ptx-kernel\" fn ptx() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0570]: `\"amdgpu-kernel\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:28:1\n+   |\n+LL | extern \"amdgpu-kernel\" fn amdgpu() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0570]: `\"wasm\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:30:1\n+   |\n+LL | extern \"wasm\" fn wasm() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0570]: `\"msp430-interrupt\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:36:1\n+   |\n+LL | extern \"msp430-interrupt\" fn msp430() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0570]: `\"avr-interrupt\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:38:1\n+   |\n+LL | extern \"avr-interrupt\" fn avr() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0570]: `\"x86-interrupt\"` is not a supported ABI for the current target\n+  --> $DIR/unsupported.rs:40:1\n+   |\n+LL | extern \"x86-interrupt\" fn x86() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+warning: use of calling convention not supported on this target\n+  --> $DIR/unsupported.rs:43:1\n+   |\n+LL | extern \"stdcall\" fn stdcall() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `#[warn(unsupported_calling_conventions)]` on by default\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #87678 <https://github.com/rust-lang/rust/issues/87678>\n+\n+warning: use of calling convention not supported on this target\n+  --> $DIR/unsupported.rs:50:1\n+   |\n+LL | extern \"thiscall\" fn thiscall() {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #87678 <https://github.com/rust-lang/rust/issues/87678>\n+\n+error: aborting due to 6 previous errors; 2 warnings emitted\n+\n+For more information about this error, try `rustc --explain E0570`."}, {"sha": "7ca93516db989f7bb536c73ae800635300b0b59a", "filename": "src/test/ui/abi/unsupported.i686.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.i686.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.i686.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Funsupported.i686.stderr?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -1,35 +1,35 @@\n error[E0570]: `\"ptx-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:24:1\n+  --> $DIR/unsupported.rs:26:1\n    |\n LL | extern \"ptx-kernel\" fn ptx() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"amdgpu-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:26:1\n+  --> $DIR/unsupported.rs:28:1\n    |\n LL | extern \"amdgpu-kernel\" fn amdgpu() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"wasm\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:28:1\n+  --> $DIR/unsupported.rs:30:1\n    |\n LL | extern \"wasm\" fn wasm() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"aapcs\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:30:1\n+  --> $DIR/unsupported.rs:32:1\n    |\n LL | extern \"aapcs\" fn aapcs() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"msp430-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:33:1\n+  --> $DIR/unsupported.rs:36:1\n    |\n LL | extern \"msp430-interrupt\" fn msp430() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"avr-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:35:1\n+  --> $DIR/unsupported.rs:38:1\n    |\n LL | extern \"avr-interrupt\" fn avr() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "9319eac8d30d84bd84be935d7bd7fe0ba49fe17d", "filename": "src/test/ui/abi/unsupported.rs", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.rs", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Funsupported.rs?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -1,11 +1,13 @@\n-// revisions: x64 i686 aarch64\n+// revisions: x64 i686 aarch64 arm\n //\n // [x64] needs-llvm-components: x86\n-// [x64]compile-flags: --target=x86_64-unknown-linux-gnu --crate-type=rlib\n+// [x64] compile-flags: --target=x86_64-unknown-linux-gnu --crate-type=rlib\n // [i686] needs-llvm-components: x86\n-// [i686]compile-flags: --target=i686-unknown-linux-gnu --crate-type=rlib\n+// [i686] compile-flags: --target=i686-unknown-linux-gnu --crate-type=rlib\n // [aarch64] needs-llvm-components: aarch64\n-// [aarch64]compile-flags: --target=aarch64-unknown-linux-gnu --crate-type=rlib\n+// [aarch64] compile-flags: --target=aarch64-unknown-linux-gnu --crate-type=rlib\n+// [arm] needs-llvm-components: arm\n+// [arm] compile-flags: --target=armv7-unknown-linux-gnueabihf --crate-type=rlib\n #![no_core]\n #![feature(\n     no_core,\n@@ -30,19 +32,25 @@ extern \"wasm\" fn wasm() {}\n extern \"aapcs\" fn aapcs() {}\n //[x64]~^ ERROR is not a supported ABI\n //[i686]~^^ ERROR is not a supported ABI\n+//[aarch64]~^^^ ERROR is not a supported ABI\n extern \"msp430-interrupt\" fn msp430() {}\n //~^ ERROR is not a supported ABI\n extern \"avr-interrupt\" fn avr() {}\n //~^ ERROR is not a supported ABI\n extern \"x86-interrupt\" fn x86() {}\n //[aarch64]~^ ERROR is not a supported ABI\n+//[arm]~^^ ERROR is not a supported ABI\n extern \"stdcall\" fn stdcall() {}\n //[x64]~^ WARN use of calling convention not supported\n //[x64]~^^ WARN this was previously accepted\n //[aarch64]~^^^ WARN use of calling convention not supported\n //[aarch64]~^^^^ WARN this was previously accepted\n+//[arm]~^^^^^ WARN use of calling convention not supported\n+//[arm]~^^^^^^ WARN this was previously accepted\n extern \"thiscall\" fn thiscall() {}\n //[x64]~^ WARN use of calling convention not supported\n //[x64]~^^ WARN this was previously accepted\n //[aarch64]~^^^ WARN use of calling convention not supported\n //[aarch64]~^^^^ WARN this was previously accepted\n+//[arm]~^^^^^ WARN use of calling convention not supported\n+//[arm]~^^^^^^ WARN this was previously accepted"}, {"sha": "f2f52683324dba69576e9759aa00e298d88a7c3c", "filename": "src/test/ui/abi/unsupported.x64.stderr", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.x64.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/748a089acdfc17d2837cd8ae3a18f577f2f764b7/src%2Ftest%2Fui%2Fabi%2Funsupported.x64.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fabi%2Funsupported.x64.stderr?ref=748a089acdfc17d2837cd8ae3a18f577f2f764b7", "patch": "@@ -1,41 +1,41 @@\n error[E0570]: `\"ptx-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:24:1\n+  --> $DIR/unsupported.rs:26:1\n    |\n LL | extern \"ptx-kernel\" fn ptx() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"amdgpu-kernel\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:26:1\n+  --> $DIR/unsupported.rs:28:1\n    |\n LL | extern \"amdgpu-kernel\" fn amdgpu() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"wasm\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:28:1\n+  --> $DIR/unsupported.rs:30:1\n    |\n LL | extern \"wasm\" fn wasm() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"aapcs\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:30:1\n+  --> $DIR/unsupported.rs:32:1\n    |\n LL | extern \"aapcs\" fn aapcs() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"msp430-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:33:1\n+  --> $DIR/unsupported.rs:36:1\n    |\n LL | extern \"msp430-interrupt\" fn msp430() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error[E0570]: `\"avr-interrupt\"` is not a supported ABI for the current target\n-  --> $DIR/unsupported.rs:35:1\n+  --> $DIR/unsupported.rs:38:1\n    |\n LL | extern \"avr-interrupt\" fn avr() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n warning: use of calling convention not supported on this target\n-  --> $DIR/unsupported.rs:39:1\n+  --> $DIR/unsupported.rs:43:1\n    |\n LL | extern \"stdcall\" fn stdcall() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -45,7 +45,7 @@ LL | extern \"stdcall\" fn stdcall() {}\n    = note: for more information, see issue #87678 <https://github.com/rust-lang/rust/issues/87678>\n \n warning: use of calling convention not supported on this target\n-  --> $DIR/unsupported.rs:44:1\n+  --> $DIR/unsupported.rs:50:1\n    |\n LL | extern \"thiscall\" fn thiscall() {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}]}