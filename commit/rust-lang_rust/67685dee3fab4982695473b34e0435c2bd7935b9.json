{"sha": "67685dee3fab4982695473b34e0435c2bd7935b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY3Njg1ZGVlM2ZhYjQ5ODI2OTU0NzNiMzRlMDQzNWMyYmQ3OTM1Yjk=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-07-20T04:46:06Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-07-20T04:46:06Z"}, "message": "always get number of live variables from the map", "tree": {"sha": "09571cefaca93b87bc2163f20df6e939719223c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09571cefaca93b87bc2163f20df6e939719223c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/67685dee3fab4982695473b34e0435c2bd7935b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/67685dee3fab4982695473b34e0435c2bd7935b9", "html_url": "https://github.com/rust-lang/rust/commit/67685dee3fab4982695473b34e0435c2bd7935b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/67685dee3fab4982695473b34e0435c2bd7935b9/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9910dee6776e967993b5a95b74390da179a479a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/9910dee6776e967993b5a95b74390da179a479a6", "html_url": "https://github.com/rust-lang/rust/commit/9910dee6776e967993b5a95b74390da179a479a6"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "5ef4a9e235788fc6651f96ff129b0899e648f7b8", "filename": "src/librustc_mir/util/liveness.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/67685dee3fab4982695473b34e0435c2bd7935b9/src%2Flibrustc_mir%2Futil%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/67685dee3fab4982695473b34e0435c2bd7935b9/src%2Flibrustc_mir%2Futil%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fliveness.rs?ref=67685dee3fab4982695473b34e0435c2bd7935b9", "patch": "@@ -168,21 +168,21 @@ pub fn liveness_of_locals<'tcx, V: Idx>(\n     mode: LivenessMode,\n     map: &impl LiveVariableMap<LiveVar = V>,\n ) -> LivenessResult<V> {\n-    let locals = map.num_variables();\n+    let num_live_vars = map.num_variables();\n \n     let def_use: IndexVec<_, DefsUses<V>> = mir\n         .basic_blocks()\n         .iter()\n-        .map(|b| block(mode, map, b, locals))\n+        .map(|b| block(mode, map, b, num_live_vars))\n         .collect();\n \n     let mut outs: IndexVec<_, LocalSet<V>> = mir\n         .basic_blocks()\n         .indices()\n-        .map(|_| LocalSet::new_empty(locals))\n+        .map(|_| LocalSet::new_empty(num_live_vars))\n         .collect();\n \n-    let mut bits = LocalSet::new_empty(locals);\n+    let mut bits = LocalSet::new_empty(num_live_vars);\n \n     // queue of things that need to be re-processed, and a set containing\n     // the things currently in the queue\n@@ -239,13 +239,13 @@ impl<V: Idx> LivenessResult<V> {\n             block,\n             statement_index,\n         };\n-        let locals = mir.local_decls.len();\n+        let num_live_vars = map.num_variables();\n         let mut visitor = DefsUsesVisitor {\n             mode: self.mode,\n             map,\n             defs_uses: DefsUses {\n-                defs: LocalSet::new_empty(locals),\n-                uses: LocalSet::new_empty(locals),\n+                defs: LocalSet::new_empty(num_live_vars),\n+                uses: LocalSet::new_empty(num_live_vars),\n             },\n         };\n         // Visit the various parts of the basic block in reverse. If we go"}]}