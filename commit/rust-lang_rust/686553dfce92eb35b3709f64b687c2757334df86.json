{"sha": "686553dfce92eb35b3709f64b687c2757334df86", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4NjU1M2RmY2U5MmViMzViMzcwOWY2NGI2ODdjMjc1NzMzNGRmODY=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-08-13T07:36:48Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-08-13T07:52:35Z"}, "message": "ci: add a check for clock drift\n\nRecently we encountered multiple spurious failures where the crates.io\ncertificate was reported as expired, even though it's currently due to\nexpire in a few months. This adds some code to our CI to check for clock\ndrifts, to possibly find the cause or rule out a bad VM clock.", "tree": {"sha": "86cbf531c26660c011d0314489afc288051814a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86cbf531c26660c011d0314489afc288051814a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/686553dfce92eb35b3709f64b687c2757334df86", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl1SbEYACgkQPgar6Auq\n8ZxESg/+MoQIvFhrTr/y8HwBZ/IROpkIeuifd7MGBYxbkNxrvgiQIPV23AG8Ep/o\nanYELv6haZOKS3Ei+w7iyHRTZ0kWD+KwoZel+m6TLVKP0jcTlE7mrwANPV7R30i0\niT46bowRDHs+hajZX2iV6AgxNZwSH2Zcbt3ckpCNUe3rbCSp88TRUtIMshSbdcph\n9pSXvGud9sZC492/gv6Tm6Wl/nhyypL9B5ADkhshf3kIutSC5p6gYLj2vdwDvXO4\n/wT4K49l13UrnG8xAw4n4d5EZKL3/qb+r5Kh5bAxQSC+19phzD3Kus77qh1bKa2K\n8NnYfjo4qeOqc8vKQyVl6In6f4+Kt0M5wjjjBZDAOqLs6hEA7OGanFkeidI+vac0\nZ4qz3OJhkiZUZpkc36W+Ri4OldAgCWorSUCecZ8xcUu6c0bIVZ5Js2ozVm3madoy\n86OK0lYvWrDVmgT6XeQ5YmxnYiAGgLL4h6yFWgQrJX4OC/B4QsYprVFRlWt3P1P1\nCpvra/ZEPDM0c3FvyEDiAaAgN6NNjLAxuccdvtPLkba9Bz/YUXT5EuFa0DYeYGdv\nQworEsc6B3+ivzAVNY24ASi+4XBuM6ui8Sbklh6vS0C1iRN9W1x4sPGkifbeqzRR\nEGiPnStWv3koV/4cSr94PUDNlQvy2O+kYhMK2v6nUqChwWhDsR8=\n=+wgu\n-----END PGP SIGNATURE-----", "payload": "tree 86cbf531c26660c011d0314489afc288051814a9\nparent 60960a260f7b5c695fd0717311d72ce62dd4eb43\nauthor Pietro Albini <pietro@pietroalbini.org> 1565681808 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1565682755 +0200\n\nci: add a check for clock drift\n\nRecently we encountered multiple spurious failures where the crates.io\ncertificate was reported as expired, even though it's currently due to\nexpire in a few months. This adds some code to our CI to check for clock\ndrifts, to possibly find the cause or rule out a bad VM clock.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/686553dfce92eb35b3709f64b687c2757334df86", "html_url": "https://github.com/rust-lang/rust/commit/686553dfce92eb35b3709f64b687c2757334df86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/686553dfce92eb35b3709f64b687c2757334df86/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60960a260f7b5c695fd0717311d72ce62dd4eb43", "url": "https://api.github.com/repos/rust-lang/rust/commits/60960a260f7b5c695fd0717311d72ce62dd4eb43", "html_url": "https://github.com/rust-lang/rust/commit/60960a260f7b5c695fd0717311d72ce62dd4eb43"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "457ba9717120710623411d44e7d8afdca1831882", "filename": "src/ci/run.sh", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/686553dfce92eb35b3709f64b687c2757334df86/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/686553dfce92eb35b3709f64b687c2757334df86/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=686553dfce92eb35b3709f64b687c2757334df86", "patch": "@@ -78,6 +78,21 @@ if [ \"$RUST_RELEASE_CHANNEL\" = \"nightly\" ] || [ \"$DIST_REQUIRE_ALL_TOOLS\" = \"\" ]\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-missing-tools\"\n fi\n \n+# Print the date from the local machine and the date from an external source to\n+# check for clock drifts. An HTTP URL is used instead of HTTPS since on Azure\n+# Pipelines it happened that the certificates were marked as expired.\n+datecheck() {\n+  echo \"== clock drift check ==\"\n+  echo -n \"  local time: \"\n+  date\n+  echo -n \"  network time: \"\n+  curl -fs --head http://detectportal.firefox.com/success.txt | grep ^Date: \\\n+      | sed 's/Date: //g' || true\n+  echo \"== end clock drift check ==\"\n+}\n+datecheck\n+trap datecheck EXIT\n+\n # We've had problems in the past of shell scripts leaking fds into the sccache\n # server (#48192) which causes Cargo to erroneously think that a build script\n # hasn't finished yet. Try to solve that problem by starting a very long-lived"}]}