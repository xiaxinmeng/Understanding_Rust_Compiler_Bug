{"sha": "c524c50edf85b3489734beb6b6619082307de116", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1MjRjNTBlZGY4NWIzNDg5NzM0YmViNmI2NjE5MDgyMzA3ZGUxMTY=", "commit": {"author": {"name": "Mark-Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2016-11-10T23:04:53Z"}, "committer": {"name": "Mark-Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2016-11-11T01:37:41Z"}, "message": "compiletest: detect nodejs binary, allow override\n\nAllow passing a custom nodejs directory in configure.", "tree": {"sha": "a5c2511d2989104cf680520949c02898375f7ee3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a5c2511d2989104cf680520949c02898375f7ee3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c524c50edf85b3489734beb6b6619082307de116", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c524c50edf85b3489734beb6b6619082307de116", "html_url": "https://github.com/rust-lang/rust/commit/c524c50edf85b3489734beb6b6619082307de116", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c524c50edf85b3489734beb6b6619082307de116/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3dced6f71e6e8cf8f59e3614194a61427a3a408b", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dced6f71e6e8cf8f59e3614194a61427a3a408b", "html_url": "https://github.com/rust-lang/rust/commit/3dced6f71e6e8cf8f59e3614194a61427a3a408b"}], "stats": {"total": 22, "additions": 14, "deletions": 8}, "files": [{"sha": "f88bb04fb1078f5b8f77ce2c450a49d536f587c3", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c524c50edf85b3489734beb6b6619082307de116/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c524c50edf85b3489734beb6b6619082307de116/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=c524c50edf85b3489734beb6b6619082307de116", "patch": "@@ -128,6 +128,7 @@ struct Build {\n     submodules: Option<bool>,\n     gdb: Option<String>,\n     vendor: Option<bool>,\n+    nodejs: Option<String>,\n }\n \n /// TOML representation of how the LLVM build is configured.\n@@ -232,6 +233,7 @@ impl Config {\n         }\n         config.rustc = build.rustc.map(PathBuf::from);\n         config.cargo = build.cargo.map(PathBuf::from);\n+        config.nodejs = build.nodejs.map(PathBuf::from);\n         config.gdb = build.gdb.map(PathBuf::from);\n         set(&mut config.compiler_docs, build.compiler_docs);\n         set(&mut config.docs, build.docs);"}, {"sha": "a541ba0b2f3fdad203f18452ebf716c2efe49d49", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c524c50edf85b3489734beb6b6619082307de116/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c524c50edf85b3489734beb6b6619082307de116/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=c524c50edf85b3489734beb6b6619082307de116", "patch": "@@ -81,15 +81,16 @@ pub fn check(build: &mut Build) {\n \n     need_cmd(\"python\".as_ref());\n \n-    // Look for the nodejs command, needed for emscripten testing\n-    if let Some(node) = have_cmd(\"node\".as_ref()) {\n-        build.config.nodejs = Some(node);\n-    } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n-        build.config.nodejs = Some(node);\n-    }\n \n     if let Some(ref s) = build.config.nodejs {\n         need_cmd(s.as_ref());\n+    } else {\n+        // Look for the nodejs command, needed for emscripten testing\n+        if let Some(node) = have_cmd(\"node\".as_ref()) {\n+            build.config.nodejs = Some(node);\n+        } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n+            build.config.nodejs = Some(node);\n+        }\n     }\n \n     if let Some(ref gdb) = build.config.gdb {"}, {"sha": "4c024434e17c6adacaa62acf9fc709509c50b909", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c524c50edf85b3489734beb6b6619082307de116/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c524c50edf85b3489734beb6b6619082307de116/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=c524c50edf85b3489734beb6b6619082307de116", "patch": "@@ -1456,8 +1456,11 @@ actual:\\n\\\n \n         // If this is emscripten, then run tests under nodejs\n         if self.config.target.contains(\"emscripten\") {\n-            let nodejs = self.config.nodejs.clone().unwrap_or(\"nodejs\".to_string());\n-            args.push(nodejs);\n+            if let Some(ref p) = self.config.nodejs {\n+                args.push(p.clone());\n+            } else {\n+                self.fatal(\"no NodeJS binary found (--nodejs)\");\n+            }\n         }\n \n         let exe_file = self.make_exe_name();"}]}