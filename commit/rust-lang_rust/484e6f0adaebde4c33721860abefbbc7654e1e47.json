{"sha": "484e6f0adaebde4c33721860abefbbc7654e1e47", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4NGU2ZjBhZGFlYmRlNGMzMzcyMTg2MGFiZWZiYmM3NjU0ZTFlNDc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-11T19:38:16Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-11T19:38:16Z"}, "message": "Rollup merge of #49730 - sinkuu:fix_ice_49556, r=cramertj\n\nFix ICE with impl Trait\n\nFixes https://github.com/rust-lang/rust/issues/49556#issuecomment-379154713. May or may not fix 49556 itself. Closures like `|x: &'a _| x` has `ClosureSubsts` of `fn(&'a _) -> &'(ReScope) _`, so `tcx.note_and_explain_free_region` (called [here](https://github.com/rust-lang/rust/blob/a143462783cec88b7b733e8aa09990bfeb59f754/src/librustc/infer/anon_types/mod.rs#L572)) panics.", "tree": {"sha": "664faea66d08995acee8407cda89d111bbe00316", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/664faea66d08995acee8407cda89d111bbe00316"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/484e6f0adaebde4c33721860abefbbc7654e1e47", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlrOZCgACgkQ/vbIBR0O\nATw1fg//agjPHuAZacRwR05khSwjlw+FqmgvPrOOPFuAMTvynuvDRaTYgoUVnylk\ndVBRGqPRLxM+Gl7dAxQcAIUvNLkGWZ3MAgVq9zISLPEjA7CkKxoskQhp0VLN8CGg\nradsYTROc5pl28VLECwU5ATECbt7iysglSYmyXsirwcoKxUUHGMutXVBNgFSouTC\niiAxjVqDPHArZtMXH+4TLwj5HlBdDRsPR+dkSdeuBHMAbeBrFJzf1Jm9JNMQWljk\nAPyjkGHbxlVmGNZhnVclzWYBz3/cbqSgHMZ5kSn0xLhjqA1y23SM96Rh1jVhCvgI\nZIy5n5MEHV39z0KrGztkvyw1MUk79T7g7sJSJcB+out6vcKeafOTFBXsDR8/U2M4\nhpofYsujLWMXP0wyleHmUQLRKKJJ17U5kRqys2OmEz1jxkbvvyouLdEZPblrQYGn\nR2PVn+/DOkfK6CbVFH9iu+4EeTJi16QMxflqXLg2tw7G4StVrEiPcenIcFfVspOn\nRbFE3LdEEUHa8bb6w5JZKjYT81TVp13Rsw8WzYdXPFrQZwmRMoSTscBQyxeqmuO8\no3UGvmOwOcJdsazkZ12GFcWEBcUL8lNtEUkiJssX4YmV+J9STKw6XfedFX2a+9aX\nZWt9ZXYvL5PJg7iQNJQ94QaDPCx2tRcXGZAtHfXUaKxOse56i1I=\n=hbaV\n-----END PGP SIGNATURE-----", "payload": "tree 664faea66d08995acee8407cda89d111bbe00316\nparent 574c0502f1eb9fa1aa562e0181d8749b026d3b09\nparent b9e04e51db3495816271c0312eb1e172701957aa\nauthor kennytm <kennytm@gmail.com> 1523475496 +0800\ncommitter kennytm <kennytm@gmail.com> 1523475496 +0800\n\nRollup merge of #49730 - sinkuu:fix_ice_49556, r=cramertj\n\nFix ICE with impl Trait\n\nFixes https://github.com/rust-lang/rust/issues/49556#issuecomment-379154713. May or may not fix 49556 itself. Closures like `|x: &'a _| x` has `ClosureSubsts` of `fn(&'a _) -> &'(ReScope) _`, so `tcx.note_and_explain_free_region` (called [here](https://github.com/rust-lang/rust/blob/a143462783cec88b7b733e8aa09990bfeb59f754/src/librustc/infer/anon_types/mod.rs#L572)) panics.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/484e6f0adaebde4c33721860abefbbc7654e1e47", "html_url": "https://github.com/rust-lang/rust/commit/484e6f0adaebde4c33721860abefbbc7654e1e47", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/484e6f0adaebde4c33721860abefbbc7654e1e47/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "574c0502f1eb9fa1aa562e0181d8749b026d3b09", "url": "https://api.github.com/repos/rust-lang/rust/commits/574c0502f1eb9fa1aa562e0181d8749b026d3b09", "html_url": "https://github.com/rust-lang/rust/commit/574c0502f1eb9fa1aa562e0181d8749b026d3b09"}, {"sha": "b9e04e51db3495816271c0312eb1e172701957aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9e04e51db3495816271c0312eb1e172701957aa", "html_url": "https://github.com/rust-lang/rust/commit/b9e04e51db3495816271c0312eb1e172701957aa"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "725ea9734abf4b2540dee577c378dd90ebe4d334", "filename": "src/librustc/infer/anon_types/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Flibrustc%2Finfer%2Fanon_types%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Flibrustc%2Finfer%2Fanon_types%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fanon_types%2Fmod.rs?ref=484e6f0adaebde4c33721860abefbbc7654e1e47", "patch": "@@ -533,10 +533,14 @@ impl<'cx, 'gcx, 'tcx> TypeFolder<'gcx, 'tcx> for ReverseMapper<'cx, 'gcx, 'tcx>\n         match r {\n             // ignore bound regions that appear in the type (e.g., this\n             // would ignore `'r` in a type like `for<'r> fn(&'r u32)`.\n-            ty::ReLateBound(..) => return r,\n+            ty::ReLateBound(..) |\n \n             // ignore `'static`, as that can appear anywhere\n-            ty::ReStatic => return r,\n+            ty::ReStatic |\n+\n+            // ignore `ReScope`, as that can appear anywhere\n+            // See `src/test/run-pass/issue-49556.rs` for example.\n+            ty::ReScope(..) => return r,\n \n             _ => { }\n         }"}, {"sha": "8d314e251972d140e1b173b931b1b71d306b5a40", "filename": "src/librustc/infer/error_reporting/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=484e6f0adaebde4c33721860abefbbc7654e1e47", "patch": "@@ -181,7 +181,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n                 self.msg_span_from_early_bound_and_free_regions(region)\n             },\n             ty::ReStatic => (\"the static lifetime\".to_owned(), None),\n-            _ => bug!(),\n+            _ => bug!(\"{:?}\", region),\n         }\n     }\n "}, {"sha": "70ccee99f664d835f61b5aa185f9af9fd84c60f3", "filename": "src/test/run-pass/issue-49556.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Ftest%2Frun-pass%2Fissue-49556.rs", "raw_url": "https://github.com/rust-lang/rust/raw/484e6f0adaebde4c33721860abefbbc7654e1e47/src%2Ftest%2Frun-pass%2Fissue-49556.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-49556.rs?ref=484e6f0adaebde4c33721860abefbbc7654e1e47", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn iter<'a>(data: &'a [usize]) -> impl Iterator<Item = usize> + 'a {\n+    data.iter()\n+        .map(\n+            |x| x // fn(&'a usize) -> &'(ReScope) usize\n+        )\n+        .map(\n+            |x| *x // fn(&'(ReScope) usize) -> usize\n+        )\n+}\n+\n+fn main() {\n+}"}]}