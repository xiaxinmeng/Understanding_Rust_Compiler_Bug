{"sha": "93781297bf0ff9ab40b102353b0b4b03616e4e32", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzNzgxMjk3YmYwZmY5YWI0MGIxMDIzNTNiMGI0YjAzNjE2ZTRlMzI=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-10-14T19:22:20Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-02T21:13:22Z"}, "message": "enable building with different target arch", "tree": {"sha": "d5ed5fd8bc5521ab6a9bf2ff5a8e54faa88d534a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d5ed5fd8bc5521ab6a9bf2ff5a8e54faa88d534a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93781297bf0ff9ab40b102353b0b4b03616e4e32", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93781297bf0ff9ab40b102353b0b4b03616e4e32", "html_url": "https://github.com/rust-lang/rust/commit/93781297bf0ff9ab40b102353b0b4b03616e4e32", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93781297bf0ff9ab40b102353b0b4b03616e4e32/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f05761ddb3e96b5933d0cac9f140f73d2402bf6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f05761ddb3e96b5933d0cac9f140f73d2402bf6a", "html_url": "https://github.com/rust-lang/rust/commit/f05761ddb3e96b5933d0cac9f140f73d2402bf6a"}], "stats": {"total": 47, "additions": 15, "deletions": 32}, "files": [{"sha": "85aaf87988931a2b0345bf71194c0cee2bc9cbdd", "filename": "Makefile.in", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/93781297bf0ff9ab40b102353b0b4b03616e4e32/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/93781297bf0ff9ab40b102353b0b4b03616e4e32/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=93781297bf0ff9ab40b102353b0b4b03616e4e32", "patch": "@@ -325,7 +325,6 @@ config.mk: $(S)configure $(S)Makefile.in $(S)src/snapshots.txt\n # Primary-target makefiles\n ######################################################################\n \n-include $(CFG_SRC_DIR)/mk/intrinsics.mk\n include $(CFG_SRC_DIR)/mk/target.mk\n include $(CFG_SRC_DIR)/mk/host.mk\n include $(CFG_SRC_DIR)/mk/stage0.mk"}, {"sha": "7676074e99e6fe2b91fa5c2898af27417a9b7c05", "filename": "configure", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/93781297bf0ff9ab40b102353b0b4b03616e4e32/configure", "raw_url": "https://github.com/rust-lang/rust/raw/93781297bf0ff9ab40b102353b0b4b03616e4e32/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=93781297bf0ff9ab40b102353b0b4b03616e4e32", "patch": "@@ -229,6 +229,7 @@ then\n     printf \"    %-32s %s\\n\" \"CFG_LLVM_ROOT\" \"The host LLVM install\"\n     printf \"    %-32s %s\\n\" \"CFG_PREFIX\" \"The installation prefix\"\n     printf \"    %-32s %s\\n\" \"CFG_ONLY_GCC\" \"Prefer gcc to clang for building the runtime\"\n+    printf \"    %-32s %s\\n\" \"CFG_TARGET_TRIPLES\" \"LLVM target triples\"\n     echo \"\"\n     exit 0\n fi\n@@ -363,8 +364,10 @@ then\n     fi\n fi\n \n-# FIXME: add support for extending the target-triples list\n-CFG_TARGET_TRIPLES=\"${CFG_HOST_TRIPLE}\"\n+if [ -z \"$CFG_TARGET_TRIPLES\" ]\n+then\n+    CFG_TARGET_TRIPLES=\"${CFG_HOST_TRIPLE}\"\n+fi\n \n putvar CFG_HOST_TRIPLE\n putvar CFG_TARGET_TRIPLES"}, {"sha": "2a43b7c1667aef051ddd6e49e9956b0b6fed51c0", "filename": "mk/intrinsics.mk", "status": "removed", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f05761ddb3e96b5933d0cac9f140f73d2402bf6a/mk%2Fintrinsics.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f05761ddb3e96b5933d0cac9f140f73d2402bf6a/mk%2Fintrinsics.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fintrinsics.mk?ref=f05761ddb3e96b5933d0cac9f140f73d2402bf6a", "patch": "@@ -1,19 +0,0 @@\n-######################################################################\n-# intrinsics.bc rules\n-######################################################################\n-\n-# TODO: Use clang to compile the C++.\n-INTRINSICS_LL_IN := $(S)src/rt/intrinsics/intrinsics.ll.in\n-INTRINSICS_LL := intrinsics/intrinsics.ll\n-INTRINSICS_BC := intrinsics/intrinsics.bc\n-\n-$(INTRINSICS_LL):  $(INTRINSICS_LL_IN) $(MKFILES)\n-\t@$(call E, mkdir: intrinsics)\n-\t$(Q)mkdir -p intrinsics\n-\t@$(call E, sed: $@)\n-\t$(Q)sed s/@CFG_TARGET_TRIPLE@/$(CFG_LLVM_TRIPLE)/g $< > $@\n-\n-$(INTRINSICS_BC):   $(INTRINSICS_LL) $(MKFILES)\n-\t@$(call E, llvm-as: $@)\n-\t$(Q)$(LLVM_AS) -o $@ $<\n-"}, {"sha": "8d082399ff7197da7e701d786122938e4db57e77", "filename": "mk/target.mk", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=93781297bf0ff9ab40b102353b0b4b03616e4e32", "patch": "@@ -15,17 +15,17 @@ INTR_HOST := $$(subst i686,i386,$$(TARGET_HOST))\n $$(TARGET_LIB$(1)$(2))/intrinsics.ll: \\\n \t\t$$(S)src/rt/intrinsics/intrinsics.$$(INTR_HOST).ll.in\n \t@$$(call E, sed: $$@)\n-\tsed s/@CFG_TARGET_TRIPLE@/$(2)/ $$< > $$@\n+\t$$(Q)sed s/@CFG_TARGET_TRIPLE@/$(2)/ $$< > $$@\n \n $$(TARGET_LIB$(1)$(2))/intrinsics.bc: $$(TARGET_LIB$(1)$(2))/intrinsics.ll\n \t@$$(call E, llvms-as: $$@)\n-\t$$(LLVM_AS) -o $$@ $$<\n+\t$$(Q)$$(LLVM_AS) -o $$@ $$<\n \n $$(TARGET_LIB$(1)$(2))/$$(CFG_STDLIB): \\\n \t$$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n         $$(TARGET_SREQ$(1)$(2))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1))  --lib -o $$@ $$<\n+\t$$(STAGE$(1)_$(2))  --lib -o $$@ $$<\n \n ifeq ($(1), 0)\n # FIXME: temporary\n@@ -38,7 +38,7 @@ $$(TARGET_LIB$(1)$(2))/libstd.rlib: \\\n \t$$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n         $$(TARGET_SREQ$(1)$(2))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) --lib --static -o $$@ $$<\n+\t$$(STAGE$(1)_$(2)) --lib --static -o $$@ $$<\n \n $$(TARGET_LIB$(1)$(2))/$$(CFG_RUNTIME): rt/$$(CFG_RUNTIME)\n \t@$$(call E, cp: $$@)\n@@ -54,15 +54,15 @@ $$(TARGET_BIN$(1)$(2))/rustc$$(X): \\\n \t$$(TARGET_LIB$(1)$(2))/$$(CFG_RUSTLLVM) \\\n \t$$(TARGET_STDLIB_DEFAULT$(1)$(2))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$<\n+\t$$(STAGE$(1)_$(2)) -o $$@ $$<\n \n $$(TARGET_LIB$(1)$(2))/$$(CFG_LIBRUSTC): \\\n \t$$(COMPILER_CRATE) $$(COMPILER_INPUTS) \\\n \t$$(TARGET_SREQ$(1)$(2)) \\\n \t$$(TARGET_LIB$(1)$(2))/$$(CFG_RUSTLLVM) \\\n \t$$(TARGET_STDLIB_DEFAULT$(1)$(2))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) --lib -o $$@ $$<\n+\t$$(STAGE$(1)_$(2)) --lib -o $$@ $$<\n \n endef\n "}, {"sha": "145829f3437987222c721247a896afef4234c0a4", "filename": "mk/tests.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=93781297bf0ff9ab40b102353b0b4b03616e4e32", "patch": "@@ -150,7 +150,7 @@ check-stage$(1)-pretty-pretty: check-stage$(1)-pretty-pretty-dummy\n test/stdtest.stage$(1)$$(X): $$(STDTEST_CRATE) $$(STDTEST_INPUTS) \\\n                              $$(SREQ$(1)$$(CFG_HOST_TRIPLE))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$< --test\n+\t$$(STAGE$(1)_$$(CFG_HOST_TRIPLE)) -o $$@ $$< --test\n \n check-stage$(1)-std-dummy: test/stdtest.stage$(1)$$(X)\n \t@$$(call E, run: $$<)\n@@ -166,7 +166,7 @@ test/rustctest.stage$(1)$$(X): \\\n \t$$(TARGET_LIB$(1)$$(CFG_HOST_TRIPLE))/$$(CFG_RUSTLLVM) \\\n \t$$(TARGET_LIB$(1)$$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB)\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$< --test\n+\t$$(STAGE$(1)_$$(CFG_HOST_TRIPLE)) -o $$@ $$< --test\n \n check-stage$(1)-rustc-dummy: test/rustctest.stage$(1)$$(X)\n \t@$$(call E, run: $$<)"}, {"sha": "2bc495345b75c9d84956f547aa3ff309e6bfa643", "filename": "mk/tools.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/93781297bf0ff9ab40b102353b0b4b03616e4e32/mk%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftools.mk?ref=93781297bf0ff9ab40b102353b0b4b03616e4e32", "patch": "@@ -18,7 +18,7 @@ $$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/fuzzer$$(X): \\\n \t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB) \\\n \t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_LIBRUSTC)\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$<\n+\t$$(STAGE$(1)_$(CFG_HOST_TRIPLE)) -o $$@ $$<\n \n # Promote the stageN target to stageN+1 host\n # FIXME: Shouldn't need to depend on host/librustc.so once\n@@ -35,7 +35,7 @@ $$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/compiletest$$(X): \\\n \t$$(TARGET_SREQ$(1)$(CFG_HOST_TRIPLE)) \\\n \t$$(TARGET_LIB$(1)$(CFG_HOST_TRIPLE))/$$(CFG_STDLIB)\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -o $$@ $$<\n+\t$$(STAGE$(1)_$(CFG_HOST_TRIPLE)) -o $$@ $$<\n \n $$(HOST_BIN$(2))/compiletest$$(X): \\\n \t$$(TARGET_BIN$(1)$(CFG_HOST_TRIPLE))/compiletest$$(X) \\"}]}