{"sha": "f5403aef9686c8d5337ac2aae99b2da54646143c", "node_id": "C_kwDOAAsO6NoAKGY1NDAzYWVmOTY4NmM4ZDUzMzdhYzJhYWU5OWIyZGE1NDY0NjE0M2M", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-04-14T11:00:08Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-04-14T11:00:08Z"}, "message": "simplify", "tree": {"sha": "6a3ab90e2183356f329a2a57487d59b90307edba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a3ab90e2183356f329a2a57487d59b90307edba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5403aef9686c8d5337ac2aae99b2da54646143c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5403aef9686c8d5337ac2aae99b2da54646143c", "html_url": "https://github.com/rust-lang/rust/commit/f5403aef9686c8d5337ac2aae99b2da54646143c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5403aef9686c8d5337ac2aae99b2da54646143c/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5620d25972b5aaf045ac53078b992c903742ca20", "url": "https://api.github.com/repos/rust-lang/rust/commits/5620d25972b5aaf045ac53078b992c903742ca20", "html_url": "https://github.com/rust-lang/rust/commit/5620d25972b5aaf045ac53078b992c903742ca20"}], "stats": {"total": 16, "additions": 5, "deletions": 11}, "files": [{"sha": "4de4def2e86b33e4a029c23b3be5a39ab7320f0c", "filename": "crates/ide_assists/src/handlers/expand_glob_import.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f5403aef9686c8d5337ac2aae99b2da54646143c/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fexpand_glob_import.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5403aef9686c8d5337ac2aae99b2da54646143c/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fexpand_glob_import.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fexpand_glob_import.rs?ref=f5403aef9686c8d5337ac2aae99b2da54646143c", "patch": "@@ -52,7 +52,7 @@ pub(crate) fn expand_glob_import(acc: &mut Assists, ctx: &AssistContext) -> Opti\n     let current_scope = ctx.sema.scope(&star.parent()?)?;\n     let current_module = current_scope.module();\n \n-    let refs_in_target = find_refs_in_mod(ctx, target_module, Some(current_module))?;\n+    let refs_in_target = find_refs_in_mod(ctx, target_module, current_module)?;\n     let imported_defs = find_imported_defs(ctx, star)?;\n \n     let target = parent.either(|n| n.syntax().clone(), |n| n.syntax().clone());\n@@ -168,18 +168,12 @@ impl Refs {\n     }\n }\n \n-fn find_refs_in_mod(\n-    ctx: &AssistContext,\n-    module: Module,\n-    visible_from: Option<Module>,\n-) -> Option<Refs> {\n-    if let Some(from) = visible_from {\n-        if !is_mod_visible_from(ctx, module, from) {\n-            return None;\n-        }\n+fn find_refs_in_mod(ctx: &AssistContext, module: Module, visible_from: Module) -> Option<Refs> {\n+    if !is_mod_visible_from(ctx, module, visible_from) {\n+        return None;\n     }\n \n-    let module_scope = module.scope(ctx.db(), visible_from);\n+    let module_scope = module.scope(ctx.db(), Some(visible_from));\n     let refs = module_scope.into_iter().filter_map(|(n, d)| Ref::from_scope_def(n, d)).collect();\n     Some(Refs(refs))\n }"}]}