{"sha": "f5db0c7110fc728701444c40a7372f0ea3cd40ce", "node_id": "C_kwDOAAsO6NoAKGY1ZGIwYzcxMTBmYzcyODcwMTQ0NGM0MGE3MzcyZjBlYTNjZDQwY2U", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-13T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-23T14:24:59Z"}, "message": "Use renamed atomic intrinsics in panic_unwind", "tree": {"sha": "a38e2a5309559e10f54cf2aa65c5fc234caf099b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a38e2a5309559e10f54cf2aa65c5fc234caf099b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f5db0c7110fc728701444c40a7372f0ea3cd40ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f5db0c7110fc728701444c40a7372f0ea3cd40ce", "html_url": "https://github.com/rust-lang/rust/commit/f5db0c7110fc728701444c40a7372f0ea3cd40ce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f5db0c7110fc728701444c40a7372f0ea3cd40ce/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bc5e322cf2f6371540e443c6a9ee53acbe68390", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bc5e322cf2f6371540e443c6a9ee53acbe68390", "html_url": "https://github.com/rust-lang/rust/commit/3bc5e322cf2f6371540e443c6a9ee53acbe68390"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "b243333c48e5fa091e55430ae879a76d409ef1d4", "filename": "library/panic_unwind/src/seh.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f5db0c7110fc728701444c40a7372f0ea3cd40ce/library%2Fpanic_unwind%2Fsrc%2Fseh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f5db0c7110fc728701444c40a7372f0ea3cd40ce/library%2Fpanic_unwind%2Fsrc%2Fseh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fpanic_unwind%2Fsrc%2Fseh.rs?ref=f5db0c7110fc728701444c40a7372f0ea3cd40ce", "patch": "@@ -256,7 +256,7 @@ cfg_if::cfg_if! {\n }\n \n pub unsafe fn panic(data: Box<dyn Any + Send>) -> u32 {\n-    use core::intrinsics::atomic_store;\n+    use core::intrinsics::atomic_store_seqcst;\n \n     // _CxxThrowException executes entirely on this stack frame, so there's no\n     // need to otherwise transfer `data` to the heap. We just pass a stack\n@@ -288,20 +288,23 @@ pub unsafe fn panic(data: Box<dyn Any + Send>) -> u32 {\n     //\n     // In any case, we basically need to do something like this until we can\n     // express more operations in statics (and we may never be able to).\n-    atomic_store(&mut THROW_INFO.pmfnUnwind as *mut _ as *mut u32, ptr!(exception_cleanup) as u32);\n-    atomic_store(\n+    atomic_store_seqcst(\n+        &mut THROW_INFO.pmfnUnwind as *mut _ as *mut u32,\n+        ptr!(exception_cleanup) as u32,\n+    );\n+    atomic_store_seqcst(\n         &mut THROW_INFO.pCatchableTypeArray as *mut _ as *mut u32,\n         ptr!(&CATCHABLE_TYPE_ARRAY as *const _) as u32,\n     );\n-    atomic_store(\n+    atomic_store_seqcst(\n         &mut CATCHABLE_TYPE_ARRAY.arrayOfCatchableTypes[0] as *mut _ as *mut u32,\n         ptr!(&CATCHABLE_TYPE as *const _) as u32,\n     );\n-    atomic_store(\n+    atomic_store_seqcst(\n         &mut CATCHABLE_TYPE.pType as *mut _ as *mut u32,\n         ptr!(&TYPE_DESCRIPTOR as *const _) as u32,\n     );\n-    atomic_store(\n+    atomic_store_seqcst(\n         &mut CATCHABLE_TYPE.copyFunction as *mut _ as *mut u32,\n         ptr!(exception_copy) as u32,\n     );"}]}