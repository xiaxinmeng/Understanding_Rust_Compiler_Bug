{"sha": "71e824de26189c514150840cae493f596e362f1c", "node_id": "C_kwDOAAsO6NoAKDcxZTgyNGRlMjYxODljNTE0MTUwODQwY2FlNDkzZjU5NmUzNjJmMWM", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-10-26T15:51:20Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-10-27T11:07:32Z"}, "message": "Add tests for source line numbers colors", "tree": {"sha": "a01be9207dc4c03715e2b75dc4398be97416f43f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a01be9207dc4c03715e2b75dc4398be97416f43f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/71e824de26189c514150840cae493f596e362f1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/71e824de26189c514150840cae493f596e362f1c", "html_url": "https://github.com/rust-lang/rust/commit/71e824de26189c514150840cae493f596e362f1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/71e824de26189c514150840cae493f596e362f1c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0185be2ce45efdd988df2b2ee69b764f9e3c7f6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/0185be2ce45efdd988df2b2ee69b764f9e3c7f6c", "html_url": "https://github.com/rust-lang/rust/commit/0185be2ce45efdd988df2b2ee69b764f9e3c7f6c"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "a2dac2aa681d553058bb1c9397afa492d55533f4", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 43, "deletions": 1, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/71e824de26189c514150840cae493f596e362f1c/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/71e824de26189c514150840cae493f596e362f1c/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=71e824de26189c514150840cae493f596e362f1c", "patch": "@@ -1,5 +1,6 @@\n // Checks that the interactions with the source code pages are working as expected.\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n+show-text: true\n // Check that we can click on the line number.\n click: \".src-line-numbers > span:nth-child(4)\" // This is the span for line 4.\n // Ensure that the page URL was updated.\n@@ -12,6 +13,48 @@ assert-attribute: (\".src-line-numbers > span:nth-child(4)\", {\"class\": \"line-high\n assert-attribute: (\".src-line-numbers > span:nth-child(5)\", {\"class\": \"line-highlighted\"})\n assert-attribute: (\".src-line-numbers > span:nth-child(6)\", {\"class\": \"line-highlighted\"})\n assert-attribute-false: (\".src-line-numbers > span:nth-child(7)\", {\"class\": \"line-highlighted\"})\n+\n+define-function: (\n+    \"check-colors\",\n+    (theme, color, background_color, highlight_color, highlight_background_color),\n+    [\n+        (\"local-storage\", {\"rustdoc-theme\": |theme|, \"rustdoc-use-system-theme\": \"false\"}),\n+        (\"reload\"),\n+        (\"assert-css\", (\n+            \".src-line-numbers > span:not(.line-highlighted)\",\n+            {\"color\": |color|, \"background-color\": |background_color|},\n+            ALL,\n+        )),\n+        (\"assert-css\", (\n+            \".src-line-numbers > span.line-highlighted\",\n+            {\"color\": |highlight_color|, \"background-color\": |highlight_background_color|},\n+            ALL,\n+        )),\n+    ],\n+)\n+\n+call-function: (\"check-colors\", {\n+    \"theme\": \"ayu\",\n+    \"color\": \"rgb(92, 103, 115)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(112, 128, 144)\",\n+    \"highlight_background_color\": \"rgba(255, 236, 164, 0.06)\",\n+})\n+call-function: (\"check-colors\", {\n+    \"theme\": \"dark\",\n+    \"color\": \"rgb(59, 145, 226)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(59, 145, 226)\",\n+    \"highlight_background_color\": \"rgb(10, 4, 47)\",\n+})\n+call-function: (\"check-colors\", {\n+    \"theme\": \"light\",\n+    \"color\": \"rgb(198, 126, 45)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(198, 126, 45)\",\n+    \"highlight_background_color\": \"rgb(253, 255, 211)\",\n+})\n+\n // This is to ensure that the content is correctly align with the line numbers.\n compare-elements-position: (\"//*[@id='1']\", \".rust > code > span\", (\"y\"))\n \n@@ -20,7 +63,6 @@ assert-css: (\".src-line-numbers\", {\"text-align\": \"right\"})\n \n // Now let's check that clicking on something else than the line number doesn't\n // do anything (and certainly not add a `#NaN` to the URL!).\n-show-text: true\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n // We use this assert-position to know where we will click.\n assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 112})"}]}