{"sha": "4e376852e709844d67f94430d9dc954d5be722b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlMzc2ODUyZTcwOTg0NGQ2N2Y5NDQzMGQ5ZGM5NTRkNWJlNzIyYjQ=", "commit": {"author": {"name": "Roy Frostig", "email": "rfrostig@mozilla.com", "date": "2010-08-12T23:21:08Z"}, "committer": {"name": "Roy Frostig", "email": "rfrostig@mozilla.com", "date": "2010-08-12T23:21:08Z"}, "message": "Fix max_sz bug that ended up causing us to index incorrectly into a vec of tag types.  Add a testcase.", "tree": {"sha": "fb23b6a4ffc16914b89ab161ad4ace54c1a2b7ff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb23b6a4ffc16914b89ab161ad4ace54c1a2b7ff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e376852e709844d67f94430d9dc954d5be722b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e376852e709844d67f94430d9dc954d5be722b4", "html_url": "https://github.com/rust-lang/rust/commit/4e376852e709844d67f94430d9dc954d5be722b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e376852e709844d67f94430d9dc954d5be722b4/comments", "author": {"login": "froystig", "id": 123903, "node_id": "MDQ6VXNlcjEyMzkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/123903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/froystig", "html_url": "https://github.com/froystig", "followers_url": "https://api.github.com/users/froystig/followers", "following_url": "https://api.github.com/users/froystig/following{/other_user}", "gists_url": "https://api.github.com/users/froystig/gists{/gist_id}", "starred_url": "https://api.github.com/users/froystig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/froystig/subscriptions", "organizations_url": "https://api.github.com/users/froystig/orgs", "repos_url": "https://api.github.com/users/froystig/repos", "events_url": "https://api.github.com/users/froystig/events{/privacy}", "received_events_url": "https://api.github.com/users/froystig/received_events", "type": "User", "site_admin": false}, "committer": {"login": "froystig", "id": 123903, "node_id": "MDQ6VXNlcjEyMzkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/123903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/froystig", "html_url": "https://github.com/froystig", "followers_url": "https://api.github.com/users/froystig/followers", "following_url": "https://api.github.com/users/froystig/following{/other_user}", "gists_url": "https://api.github.com/users/froystig/gists{/gist_id}", "starred_url": "https://api.github.com/users/froystig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/froystig/subscriptions", "organizations_url": "https://api.github.com/users/froystig/orgs", "repos_url": "https://api.github.com/users/froystig/repos", "events_url": "https://api.github.com/users/froystig/events{/privacy}", "received_events_url": "https://api.github.com/users/froystig/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6bce296d9fe42a54276198e06389aa8cd85a4262", "url": "https://api.github.com/repos/rust-lang/rust/commits/6bce296d9fe42a54276198e06389aa8cd85a4262", "html_url": "https://github.com/rust-lang/rust/commit/6bce296d9fe42a54276198e06389aa8cd85a4262"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "49c533319dab05f3a5b92a3fd1a0b6eb15fc6209", "filename": "src/Makefile", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4e376852e709844d67f94430d9dc954d5be722b4/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/4e376852e709844d67f94430d9dc954d5be722b4/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=4e376852e709844d67f94430d9dc954d5be722b4", "patch": "@@ -507,6 +507,7 @@ TEST_XFAILS_LLVM := $(TASK_XFAILS) \\\n                       rec-tup.rs \\\n                       rec.rs \\\n                       simple-obj.rs \\\n+                      size-and-align.rs \\\n                       spawn-fn.rs \\\n                       spawn-module-qualified.rs \\\n                       spawn.rs \\"}, {"sha": "7b0f7848e0ee1ed6dc6ea6cd64b0c7c90526ac58", "filename": "src/boot/util/common.ml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4e376852e709844d67f94430d9dc954d5be722b4/src%2Fboot%2Futil%2Fcommon.ml", "raw_url": "https://github.com/rust-lang/rust/raw/4e376852e709844d67f94430d9dc954d5be722b4/src%2Fboot%2Futil%2Fcommon.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Futil%2Fcommon.ml?ref=4e376852e709844d67f94430d9dc954d5be722b4", "patch": "@@ -686,7 +686,7 @@ let rec max_sz (a:size) (b:size) : size =\n       | (SIZE_rt_max (b, c), a) when a = c -> max_sz a b\n       | (SIZE_fixed a, SIZE_fixed b) -> SIZE_fixed (i64_max a b)\n       | (SIZE_fixed 0L, b) when no_negs b -> b\n-      | (a, SIZE_fixed 0L) when no_negs a -> b\n+      | (a, SIZE_fixed 0L) when no_negs a -> a\n       | (a, SIZE_fixed b) -> max_sz (SIZE_fixed b) a\n       | (a, b) when a = b -> a\n       | (a, b) -> SIZE_rt_max (a, b)"}, {"sha": "94fa3bc1419597934f44beef233e0df7fe897d04", "filename": "src/test/run-pass/size-and-align.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4e376852e709844d67f94430d9dc954d5be722b4/src%2Ftest%2Frun-pass%2Fsize-and-align.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e376852e709844d67f94430d9dc954d5be722b4/src%2Ftest%2Frun-pass%2Fsize-and-align.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsize-and-align.rs?ref=4e376852e709844d67f94430d9dc954d5be722b4", "patch": "@@ -0,0 +1,18 @@\n+// -*- rust -*-\n+\n+use std;\n+import std._vec;\n+\n+type clam[T] = tag(a(T, int), b());\n+\n+fn uhoh[T](vec[clam[T]] v) {\n+  alt (v.(1)) {\n+    case (a[T](t, u)) { log \"incorrect\"; log u; fail; }\n+    case (b[T]()) { log \"correct\"; }\n+  }\n+}\n+\n+fn main() {\n+  let vec[clam[int]] v = vec(b[int](), b[int](), a[int](42, 17));\n+  uhoh[int](v);\n+}"}]}