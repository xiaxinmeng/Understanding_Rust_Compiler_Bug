{"sha": "518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxOGIyN2I1N2FlMmNlOWUzYTEwZjE2N2MzNjM4NWIxZGJiYmY2MTQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-08-22T18:52:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-08-22T18:52:55Z"}, "message": "Rollup merge of #88229 - m-ou-se:macro-suggest-right-kind, r=estebank\n\nSuggest importing the right kind of macro.\n\nFixes #88228.\n\nr? `@estebank`", "tree": {"sha": "59350f79900e3785875ace9b84f97dd4c9feb3bd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59350f79900e3785875ace9b84f97dd4c9feb3bd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhIp0HCRBK7hj4Ov3rIwAAMmMIAArAob24/odAVMCC1EM8IYlt\nWhjru+I/wbexmeswohjUcJi0nAs1hNIGFnSUxNaVNgpOriOAerpFBhYpHn6/03kr\ndMsacEeea1g5DKgMFiU/KBJxiSV56K3eIwKBAu6Vc4stuDWjBYb8sRUkW6EMnVan\nVjdFNrPfWg20pDpfIsJOm4RpjlJlI9mm18lZ9NjsokTrCvIhmQM+HRyZBO1w5I8G\ne3sAwIsdpjKEEfvb+j8hYofgoJHKJsiQUYDk0LKoVf0tAmUUJVsF56R1wSk39nan\nBIJ8eGr6ZwenIlDutTQgkj+5hKR8va6O9Ie3qZjgHQHN6itv+QC59Xm77djFL2w=\n=6cuO\n-----END PGP SIGNATURE-----\n", "payload": "tree 59350f79900e3785875ace9b84f97dd4c9feb3bd\nparent 167ae26a889649fd6d6499eaeef3e7acd5c9c5df\nparent bcc5ecb969579eb1c5fd4df0f7855105b66fe907\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1629658375 +0200\ncommitter GitHub <noreply@github.com> 1629658375 +0200\n\nRollup merge of #88229 - m-ou-se:macro-suggest-right-kind, r=estebank\n\nSuggest importing the right kind of macro.\n\nFixes #88228.\n\nr? `@estebank`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "html_url": "https://github.com/rust-lang/rust/commit/518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "167ae26a889649fd6d6499eaeef3e7acd5c9c5df", "url": "https://api.github.com/repos/rust-lang/rust/commits/167ae26a889649fd6d6499eaeef3e7acd5c9c5df", "html_url": "https://github.com/rust-lang/rust/commit/167ae26a889649fd6d6499eaeef3e7acd5c9c5df"}, {"sha": "bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "url": "https://api.github.com/repos/rust-lang/rust/commits/bcc5ecb969579eb1c5fd4df0f7855105b66fe907", "html_url": "https://github.com/rust-lang/rust/commit/bcc5ecb969579eb1c5fd4df0f7855105b66fe907"}], "stats": {"total": 56, "additions": 53, "deletions": 3}, "files": [{"sha": "3cf042687562ba62dddc6eecbd0dbae3b7719cdc", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "patch": "@@ -950,9 +950,7 @@ impl<'a> Resolver<'a> {\n         self.add_typo_suggestion(err, suggestion, ident.span);\n \n         let import_suggestions =\n-            self.lookup_import_candidates(ident, Namespace::MacroNS, parent_scope, |res| {\n-                matches!(res, Res::Def(DefKind::Macro(MacroKind::Bang), _))\n-            });\n+            self.lookup_import_candidates(ident, Namespace::MacroNS, parent_scope, is_expected);\n         show_candidates(err, None, &import_suggestions, false, true);\n \n         if macro_kind == MacroKind::Derive && (ident.name == sym::Send || ident.name == sym::Sync) {"}, {"sha": "615b865e9f1e1e43e133bfcc37b8045c71245854", "filename": "src/test/ui/macros/issue-88228.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs", "raw_url": "https://github.com/rust-lang/rust/raw/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.rs?ref=518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "patch": "@@ -0,0 +1,22 @@\n+// compile-flags: -Z deduplicate-diagnostics=yes\n+// edition:2018\n+\n+mod hey {\n+    pub use Copy as Bla;\n+    pub use std::println as bla;\n+}\n+\n+#[derive(Bla)]\n+//~^ ERROR cannot find derive macro `Bla`\n+//~| NOTE consider importing this derive macro\n+struct A;\n+\n+#[derive(println)]\n+//~^ ERROR cannot find derive macro `println`\n+struct B;\n+\n+fn main() {\n+    bla!();\n+    //~^ ERROR cannot find macro `bla`\n+    //~| NOTE consider importing this macro\n+}"}, {"sha": "b164e39064c97be5067be82e278fa7822f242a4a", "filename": "src/test/ui/macros/issue-88228.stderr", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fissue-88228.stderr?ref=518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "patch": "@@ -0,0 +1,26 @@\n+error: cannot find macro `bla` in this scope\n+  --> $DIR/issue-88228.rs:19:5\n+   |\n+LL |     bla!();\n+   |     ^^^\n+   |\n+   = note: consider importing this macro:\n+           crate::hey::bla\n+\n+error: cannot find derive macro `println` in this scope\n+  --> $DIR/issue-88228.rs:14:10\n+   |\n+LL | #[derive(println)]\n+   |          ^^^^^^^\n+\n+error: cannot find derive macro `Bla` in this scope\n+  --> $DIR/issue-88228.rs:9:10\n+   |\n+LL | #[derive(Bla)]\n+   |          ^^^\n+   |\n+   = note: consider importing this derive macro:\n+           crate::hey::Bla\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "3b160935a2f8d91d37fb2011485f587bb74eca40", "filename": "src/test/ui/proc-macro/derive-helper-shadowing.stderr", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/518b27b57ae2ce9e3a10f167c36385b1dbbbf614/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fderive-helper-shadowing.stderr?ref=518b27b57ae2ce9e3a10f167c36385b1dbbbf614", "patch": "@@ -16,6 +16,8 @@ error: cannot find attribute `empty_helper` in this scope\n LL |             #[derive(GenHelperUse)]\n    |                      ^^^^^^^^^^^^\n    |\n+   = note: consider importing this attribute macro:\n+           empty_helper\n    = note: this error originates in the derive macro `GenHelperUse` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: cannot find attribute `empty_helper` in this scope\n@@ -27,6 +29,8 @@ LL |         #[empty_helper]\n LL |             gen_helper_use!();\n    |             ------------------ in this macro invocation\n    |\n+   = note: consider importing this attribute macro:\n+           crate::empty_helper\n    = note: this error originates in the macro `gen_helper_use` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error[E0659]: `empty_helper` is ambiguous (name vs any other name during import resolution)"}]}