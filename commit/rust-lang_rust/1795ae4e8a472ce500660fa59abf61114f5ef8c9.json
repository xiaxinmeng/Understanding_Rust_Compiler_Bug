{"sha": "1795ae4e8a472ce500660fa59abf61114f5ef8c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3OTVhZTRlOGE0NzJjZTUwMDY2MGZhNTlhYmY2MTExNGY1ZWY4Yzk=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-11-06T05:38:08Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-11-26T19:49:10Z"}, "message": "add `#[thread_local]` attribute\n\nThis provides a building block for fast thread-local storage. It does\nnot change the safety semantics of `static mut`.\n\nCloses #10310", "tree": {"sha": "5443d91db53a3d4fcccdf48971689a1cd4bbf26a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5443d91db53a3d4fcccdf48971689a1cd4bbf26a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1795ae4e8a472ce500660fa59abf61114f5ef8c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1795ae4e8a472ce500660fa59abf61114f5ef8c9", "html_url": "https://github.com/rust-lang/rust/commit/1795ae4e8a472ce500660fa59abf61114f5ef8c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1795ae4e8a472ce500660fa59abf61114f5ef8c9/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e03f17eb214e925b15f2c684ddb69a48fbd3d8f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e03f17eb214e925b15f2c684ddb69a48fbd3d8f2", "html_url": "https://github.com/rust-lang/rust/commit/e03f17eb214e925b15f2c684ddb69a48fbd3d8f2"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "f15e767ca82a9cc7655929ac3d64c1b920dfbd4f", "filename": "doc/rust.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1795ae4e8a472ce500660fa59abf61114f5ef8c9/doc%2Frust.md", "raw_url": "https://github.com/rust-lang/rust/raw/1795ae4e8a472ce500660fa59abf61114f5ef8c9/doc%2Frust.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Frust.md?ref=1795ae4e8a472ce500660fa59abf61114f5ef8c9", "patch": "@@ -1754,6 +1754,8 @@ names are effectively reserved. Some significant attributes include:\n * The `deriving` attribute, for automatically generating\n   implementations of certain traits.\n * The `static_assert` attribute, for asserting that a static bool is true at compiletime\n+* The `thread_local` attribute, for defining a `static mut` as a thread-local. Note that this is\n+  only a low-level building block, and is not local to a *task*, nor does it provide safety.\n \n Other attributes may be added or removed during development of the language.\n "}, {"sha": "66f6e6a4746f1af10ec583044ba823d6a08b7df2", "filename": "src/librustc/lib/llvm.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Flib%2Fllvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Flib%2Fllvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib%2Fllvm.rs?ref=1795ae4e8a472ce500660fa59abf61114f5ef8c9", "patch": "@@ -1749,6 +1749,12 @@ pub fn SetUnnamedAddr(Global: ValueRef, Unnamed: bool) {\n     }\n }\n \n+pub fn set_thread_local(global: ValueRef, is_thread_local: bool) {\n+    unsafe {\n+        llvm::LLVMSetThreadLocal(global, is_thread_local as Bool);\n+    }\n+}\n+\n pub fn ConstICmp(Pred: IntPredicate, V1: ValueRef, V2: ValueRef) -> ValueRef {\n     unsafe {\n         llvm::LLVMConstICmp(Pred as c_ushort, V1, V2)"}, {"sha": "a08afcfd7c5e0018505e3c43c4623ea0f4988582", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=1795ae4e8a472ce500660fa59abf61114f5ef8c9", "patch": "@@ -816,6 +816,7 @@ static obsolete_attrs: &'static [(&'static str, &'static str)] = &[\n static other_attrs: &'static [&'static str] = &[\n     // item-level\n     \"address_insignificant\", // can be crate-level too\n+    \"thread_local\", // for statics\n     \"allow\", \"deny\", \"forbid\", \"warn\", // lint options\n     \"deprecated\", \"experimental\", \"unstable\", \"stable\", \"locked\", \"frozen\", //item stability\n     \"crate_map\", \"cfg\", \"doc\", \"export_name\", \"link_section\", \"no_freeze\","}, {"sha": "20cc2f8944e373d30ca62165cfaee3b0a2127f99", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1795ae4e8a472ce500660fa59abf61114f5ef8c9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=1795ae4e8a472ce500660fa59abf61114f5ef8c9", "patch": "@@ -2543,6 +2543,10 @@ pub fn get_item_val(ccx: @mut CrateContext, id: ast::NodeId) -> ValueRef {\n                                     inlineable = true;\n                                 }\n \n+                                if attr::contains_name(i.attrs, \"thread_local\") {\n+                                    lib::llvm::set_thread_local(g, true);\n+                                }\n+\n                                 if !inlineable {\n                                     debug!(\"{} not inlined\", sym);\n                                     ccx.non_inlineable_statics.insert(id);"}]}