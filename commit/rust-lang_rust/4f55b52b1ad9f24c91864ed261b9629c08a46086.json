{"sha": "4f55b52b1ad9f24c91864ed261b9629c08a46086", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmNTViNTJiMWFkOWYyNGM5MTg2NGVkMjYxYjk2MjljMDhhNDYwODY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-07-20T09:31:29Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-07-20T09:31:29Z"}, "message": "auto merge of #15785 : treeman/rust/fix-15780, r=alexcrichton\n\nFix for #15780.", "tree": {"sha": "d077c17f4bff8ed5d98ea253a1fcdb3cef8fd159", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d077c17f4bff8ed5d98ea253a1fcdb3cef8fd159"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f55b52b1ad9f24c91864ed261b9629c08a46086", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f55b52b1ad9f24c91864ed261b9629c08a46086", "html_url": "https://github.com/rust-lang/rust/commit/4f55b52b1ad9f24c91864ed261b9629c08a46086", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f55b52b1ad9f24c91864ed261b9629c08a46086/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50481f55030f02543e1b3b6ae008d77b1cef3e98", "url": "https://api.github.com/repos/rust-lang/rust/commits/50481f55030f02543e1b3b6ae008d77b1cef3e98", "html_url": "https://github.com/rust-lang/rust/commit/50481f55030f02543e1b3b6ae008d77b1cef3e98"}, {"sha": "820a55857a132a14f5a69960f7cfbeec39b5360f", "url": "https://api.github.com/repos/rust-lang/rust/commits/820a55857a132a14f5a69960f7cfbeec39b5360f", "html_url": "https://github.com/rust-lang/rust/commit/820a55857a132a14f5a69960f7cfbeec39b5360f"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "4b245f2c9fd48ffc981a211d772292ee234957ec", "filename": "src/libsyntax/ext/format.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4f55b52b1ad9f24c91864ed261b9629c08a46086/src%2Flibsyntax%2Fext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f55b52b1ad9f24c91864ed261b9629c08a46086/src%2Flibsyntax%2Fext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fformat.rs?ref=4f55b52b1ad9f24c91864ed261b9629c08a46086", "patch": "@@ -215,12 +215,21 @@ impl<'a, 'b> Context<'a, 'b> {\n         }\n     }\n \n+    fn describe_num_args(&self) -> String {\n+        match self.args.len() {\n+            0 => \"no arguments given\".to_string(),\n+            1 => \"there is 1 argument\".to_string(),\n+            x => format!(\"there are {} arguments\", x),\n+        }\n+    }\n+\n     fn verify_arg_type(&mut self, arg: Position, ty: ArgumentType) {\n         match arg {\n             Exact(arg) => {\n                 if self.args.len() <= arg {\n-                    let msg = format!(\"invalid reference to argument `{}` (there \\\n-                                    are {} arguments)\", arg, self.args.len());\n+                    let msg = format!(\"invalid reference to argument `{}` ({:s})\",\n+                                      arg, self.describe_num_args());\n+\n                     self.ecx.span_err(self.fmtsp, msg.as_slice());\n                     return;\n                 }"}, {"sha": "6829b1e2721a77252f739e458fd94f24a4ffa659", "filename": "src/test/compile-fail/ifmt-bad-arg.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4f55b52b1ad9f24c91864ed261b9629c08a46086/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f55b52b1ad9f24c91864ed261b9629c08a46086/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs?ref=4f55b52b1ad9f24c91864ed261b9629c08a46086", "patch": "@@ -29,6 +29,21 @@ fn main() {\n     format!(\"{foo}\", foo=1, foo=2);    //~ ERROR: duplicate argument\n     format!(\"\", foo=1, 2);             //~ ERROR: positional arguments cannot follow\n \n+    // bad number of arguments, see #15780\n+\n+    format!(\"{0}\");\n+    //~^ ERROR invalid reference to argument `0` (no arguments given)\n+\n+    format!(\"{0} {1}\", 1);\n+    //~^ ERROR invalid reference to argument `1` (there is 1 argument)\n+\n+    format!(\"{0} {1} {2}\", 1, 2);\n+    //~^ ERROR invalid reference to argument `2` (there are 2 arguments)\n+\n+    format!(\"{0} {1}\");\n+    //~^ ERROR invalid reference to argument `0` (no arguments given)\n+    //~^^ ERROR invalid reference to argument `1` (no arguments given)\n+\n     // bad syntax of the format string\n \n     format!(\"{\"); //~ ERROR: expected `}` but string was terminated"}]}