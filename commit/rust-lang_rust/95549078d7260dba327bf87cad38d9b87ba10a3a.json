{"sha": "95549078d7260dba327bf87cad38d9b87ba10a3a", "node_id": "C_kwDOAAsO6NoAKDk1NTQ5MDc4ZDcyNjBkYmEzMjdiZjg3Y2FkMzhkOWI4N2JhMTBhM2E", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-02T07:43:53Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-11-02T07:43:53Z"}, "message": "fix ./miri bench", "tree": {"sha": "572ba6defc505e2af1dcbb53bccedf7cb7a5e69b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/572ba6defc505e2af1dcbb53bccedf7cb7a5e69b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95549078d7260dba327bf87cad38d9b87ba10a3a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95549078d7260dba327bf87cad38d9b87ba10a3a", "html_url": "https://github.com/rust-lang/rust/commit/95549078d7260dba327bf87cad38d9b87ba10a3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95549078d7260dba327bf87cad38d9b87ba10a3a/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02c5dedb605e8177bf6b72aea7cd994d33f3b768", "url": "https://api.github.com/repos/rust-lang/rust/commits/02c5dedb605e8177bf6b72aea7cd994d33f3b768", "html_url": "https://github.com/rust-lang/rust/commit/02c5dedb605e8177bf6b72aea7cd994d33f3b768"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "f0986bfb1cdbe847216bff42cd684ee19924c745", "filename": "src/tools/miri/miri", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/95549078d7260dba327bf87cad38d9b87ba10a3a/src%2Ftools%2Fmiri%2Fmiri", "raw_url": "https://github.com/rust-lang/rust/raw/95549078d7260dba327bf87cad38d9b87ba10a3a/src%2Ftools%2Fmiri%2Fmiri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fmiri?ref=95549078d7260dba327bf87cad38d9b87ba10a3a", "patch": "@@ -79,6 +79,8 @@ shift\n MIRIDIR=$(python3 -c 'import os, sys; print(os.path.dirname(os.path.realpath(sys.argv[1])))' \"$0\")\n # Used for rustc syncs.\n JOSH_FILTER=\":at_commit=75dd959a3a40eb5b4574f8d2e23aa6efbeb33573[:prefix=src/tools/miri]:/src/tools/miri\"\n+# Needed for `./miri bench`.\n+TOOLCHAIN=$(cd \"$MIRIDIR\"; rustup show active-toolchain | head -n 1 | cut -d ' ' -f 1)\n \n ## Early commands, that don't do auto-things and don't want the environment-altering things happening below.\n case \"$COMMAND\" in\n@@ -189,6 +191,8 @@ if [ -z \"$MIRI_AUTO_OPS\" ]; then\n     # other code has run.\n     if [ -f \"$MIRIDIR/.auto-everything\" ] || [ -f \"$MIRIDIR/.auto-toolchain\" ] ; then\n         $0 toolchain\n+        # Let's make sure to actually use that toolchain, too.\n+        TOOLCHAIN=miri\n     fi\n \n     if [ -f \"$MIRIDIR/.auto-everything\" ] || [ -f \"$MIRIDIR/.auto-fmt\" ] ; then\n@@ -202,7 +206,6 @@ fi\n \n ## Prepare the environment\n # Determine some toolchain properties\n-TOOLCHAIN=$(cd \"$MIRIDIR\"; rustup show active-toolchain | head -n 1 | cut -d ' ' -f 1)\n TARGET=$(rustc +$TOOLCHAIN --version --verbose | grep \"^host:\" | cut -d ' ' -f 2)\n SYSROOT=$(rustc +$TOOLCHAIN --print sysroot)\n LIBDIR=$SYSROOT/lib/rustlib/$TARGET/lib"}]}