{"sha": "7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmNjZkZjcxNGE5NDhjNzZmOTNhZWY5ZmNkZDc5NGNkMWVkNmIyNmQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-07T22:49:52Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-03-07T22:50:39Z"}, "message": "rustdoc: Support #[doc(hidden)]", "tree": {"sha": "7bdd7727314f47f1473493d16d46e86e4e618a2f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7bdd7727314f47f1473493d16d46e86e4e618a2f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "html_url": "https://github.com/rust-lang/rust/commit/7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90ac69904f758cc4ae3d86d4b6bf4a1602606b3f", "url": "https://api.github.com/repos/rust-lang/rust/commits/90ac69904f758cc4ae3d86d4b6bf4a1602606b3f", "html_url": "https://github.com/rust-lang/rust/commit/90ac69904f758cc4ae3d86d4b6bf4a1602606b3f"}], "stats": {"total": 89, "additions": 89, "deletions": 0}, "files": [{"sha": "bccf57129d6f2fc9f91da620c30b9e9fccb1bc62", "filename": "src/rustdoc/attr_parser.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Fattr_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Fattr_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_parser.rs?ref=7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "patch": "@@ -13,6 +13,7 @@ export crate_attrs, basic_attrs, fn_attrs, arg_attrs,\n        variant_attrs, res_attrs, method_attrs;\n export parse_crate, parse_basic, parse_fn,\n        parse_variant, parse_res, parse_method;\n+export parse_hidden;\n \n type crate_attrs = {\n     name: option<str>\n@@ -363,3 +364,28 @@ fn shoulde_parse_resource_arg() {\n fn parse_method(attrs: [ast::attribute]) -> method_attrs {\n     parse_fn(attrs)\n }\n+\n+fn parse_hidden(attrs: [ast::attribute]) -> bool {\n+    parse_short_doc_or(\n+        attrs,\n+        {|_desc| false },\n+        {|metas, _brief, _desc|\n+            let hiddens = attr::find_meta_items_by_name(metas, \"hidden\");\n+            vec::is_not_empty(hiddens)\n+        }\n+    )\n+}\n+\n+#[test]\n+fn shoulde_parse_hidden_attribute() {\n+    let source = \"#[doc(hidden)]\";\n+    let attrs = test::parse_attributes(source);\n+    assert parse_hidden(attrs) == true;\n+}\n+\n+#[test]\n+fn shoulde_not_parse_non_hidden_attribute() {\n+    let source = \"#[doc = \\\"\\\"]\";\n+    let attrs = test::parse_attributes(source);\n+    assert parse_hidden(attrs) == false;\n+}"}, {"sha": "862018a9b80a3743569b76c4add0b356f4dec470", "filename": "src/rustdoc/prune_hidden_pass.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Fprune_hidden_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Fprune_hidden_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fprune_hidden_pass.rs?ref=7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "patch": "@@ -0,0 +1,61 @@\n+#[doc = \"Prunes things with the #[doc(hidden)] attribute\"];\n+\n+export mk_pass;\n+\n+fn mk_pass() -> pass {\n+    {\n+        name: \"prune_hidden\",\n+        f: run\n+    }\n+}\n+\n+fn run(srv: astsrv::srv, doc: doc::doc) -> doc::doc {\n+    let fold = fold::fold({\n+        fold_mod: fold_mod\n+        with *fold::default_any_fold(srv)\n+    });\n+    fold.fold_doc(fold, doc)\n+}\n+\n+fn fold_mod(\n+    fold: fold::fold<astsrv::srv>,\n+    doc: doc::moddoc\n+) -> doc::moddoc {\n+    let doc = fold::default_any_fold_mod(fold, doc);\n+\n+    {\n+        items: vec::filter(doc.items) {|itemtag|\n+            !is_hidden(fold.ctxt, itemtag.item())\n+        }\n+        with doc\n+    }\n+}\n+\n+fn is_hidden(srv: astsrv::srv, doc: doc::itemdoc) -> bool {\n+    import rustc::middle::ast_map;\n+\n+    let id = doc.id;\n+    astsrv::exec(srv) {|ctxt|\n+        let attrs = alt ctxt.ast_map.get(id) {\n+          ast_map::node_item(item, _) { item.attrs }\n+          _ { [] }\n+        };\n+        attr_parser::parse_hidden(attrs)\n+    }\n+}\n+\n+#[test]\n+fn should_prune_hidden_items() {\n+    let doc = test::mk_doc(\"#[doc(hidden)] mod a { }\");\n+    assert vec::is_empty(doc.cratemod().mods())\n+}\n+\n+#[cfg(test)]\n+mod test {\n+    fn mk_doc(source: str) -> doc::doc {\n+        astsrv::from_str(source) {|srv|\n+            let doc = extract::from_srv(srv, \"\");\n+            run(srv, doc)\n+        }\n+    }\n+}"}, {"sha": "903c3abd92030dca72614291507023c1c4ff3b68", "filename": "src/rustdoc/rustdoc.rc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Frustdoc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Frustdoc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rc?ref=7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "patch": "@@ -27,6 +27,7 @@ mod tystr_pass;\n mod prune_undoc_details_pass;\n mod prune_undoc_items_pass;\n mod prune_unexported_pass;\n+mod prune_hidden_pass;\n mod desc_to_brief_pass;\n mod desc_pass;\n mod unindent_pass;"}, {"sha": "c99a1139e6c8ac7ccc97e44ba4510183e76f8681", "filename": "src/rustdoc/rustdoc.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f66df714a948c76f93aef9fcdd794cd1ed6b26d/src%2Frustdoc%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Frustdoc.rs?ref=7f66df714a948c76f93aef9fcdd794cd1ed6b26d", "patch": "@@ -146,6 +146,7 @@ fn run(config: config::config) {\n             prune_undoc_details_pass::mk_pass(),\n             // FIXME: This pass should be optional\n             // prune_undoc_items_pass::mk_pass(),\n+            prune_hidden_pass::mk_pass(),\n             desc_to_brief_pass::mk_pass(),\n             trim_pass::mk_pass(),\n             unindent_pass::mk_pass(),"}]}