{"sha": "ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "node_id": "C_kwDOAAsO6NoAKGZmMzNkNmU3MTJlYmYxMDY4ZThkNjEwOWU1NmYyZjVkMWU4MjA1NGM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-16T03:11:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-16T03:11:06Z"}, "message": "Auto merge of #9655 - llogiq:unbox-default, r=dswij\n\nfix `box-default` linting `no_std` non-boxes\n\nThis fixes #9653 by doing the check against the `Box` type correctly even if `Box` isn't there, as in `no_std` code. Thanks to `@lukas-code` for opening the issue and supplying a reproducer!\n\n---\n\nchangelog: none", "tree": {"sha": "71b125d0e5f1fc27fbe9c17fa56e9e1d5fbe4fd6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71b125d0e5f1fc27fbe9c17fa56e9e1d5fbe4fd6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "html_url": "https://github.com/rust-lang/rust/commit/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50f192f86a12d4b39d8f7f061fbd8e0ba8007932", "url": "https://api.github.com/repos/rust-lang/rust/commits/50f192f86a12d4b39d8f7f061fbd8e0ba8007932", "html_url": "https://github.com/rust-lang/rust/commit/50f192f86a12d4b39d8f7f061fbd8e0ba8007932"}, {"sha": "f8ae2f580774c0d7743c5c6adf8e246735a28c92", "url": "https://api.github.com/repos/rust-lang/rust/commits/f8ae2f580774c0d7743c5c6adf8e246735a28c92", "html_url": "https://github.com/rust-lang/rust/commit/f8ae2f580774c0d7743c5c6adf8e246735a28c92"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "bb0307e8856d56c7205091e868ada984db7a8388", "filename": "clippy_lints/src/box_default.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c/clippy_lints%2Fsrc%2Fbox_default.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c/clippy_lints%2Fsrc%2Fbox_default.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbox_default.rs?ref=ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "patch": "@@ -46,7 +46,7 @@ impl LateLintPass<'_> for BoxDefault {\n             && !in_external_macro(cx.sess(), expr.span)\n             && (expr.span.eq_ctxt(arg.span) || is_vec_expn(cx, arg))\n             && seg.ident.name == sym::new\n-            && path_def_id(cx, ty) == cx.tcx.lang_items().owned_box()\n+            && path_def_id(cx, ty).map_or(false, |id| Some(id) == cx.tcx.lang_items().owned_box())\n             && is_default_equivalent(cx, arg)\n         {\n             let arg_ty = cx.typeck_results().expr_ty(arg);"}, {"sha": "4326abc9a5410526b0a272b1ad43fcc8e4582462", "filename": "tests/ui/box_default_no_std.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c/tests%2Fui%2Fbox_default_no_std.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ff33d6e712ebf1068e8d6109e56f2f5d1e82054c/tests%2Fui%2Fbox_default_no_std.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fbox_default_no_std.rs?ref=ff33d6e712ebf1068e8d6109e56f2f5d1e82054c", "patch": "@@ -0,0 +1,33 @@\n+#![feature(lang_items, start, libc)]\n+#![warn(clippy::box_default)]\n+#![no_std]\n+\n+pub struct NotBox<T> {\n+    _value: T,\n+}\n+\n+impl<T> NotBox<T> {\n+    pub fn new(value: T) -> Self {\n+        Self { _value: value }\n+    }\n+}\n+\n+impl<T: Default> Default for NotBox<T> {\n+    fn default() -> Self {\n+        Self::new(T::default())\n+    }\n+}\n+\n+#[start]\n+fn main(_argc: isize, _argv: *const *const u8) -> isize {\n+    let _p = NotBox::new(isize::default());\n+    0\n+}\n+\n+#[panic_handler]\n+fn panic(_info: &core::panic::PanicInfo) -> ! {\n+    loop {}\n+}\n+\n+#[lang = \"eh_personality\"]\n+extern \"C\" fn eh_personality() {}"}]}