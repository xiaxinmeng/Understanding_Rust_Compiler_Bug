{"sha": "f7629eff32cf23680074ae72144ed748139100fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3NjI5ZWZmMzJjZjIzNjgwMDc0YWU3MjE0NGVkNzQ4MTM5MTAwZmU=", "commit": {"author": {"name": "Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2018-10-25T16:28:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-25T16:28:14Z"}, "message": "Explain a comment in more detail", "tree": {"sha": "6778386ecb173cd55fe9cba417673a5351ce66f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6778386ecb173cd55fe9cba417673a5351ce66f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7629eff32cf23680074ae72144ed748139100fe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb0e8eCRBK7hj4Ov3rIwAAdHIIAFCoBuSEZ8foftMiWbe0oMYH\n0BoaazXl/C3B4Fpt56d6nYphv4QhF0M/LznhnAqTbaLhfxNq+733wYRKw9YJClFp\n4RJOTjRPDMbLLOexBkVEbiboE48JGlj55sYcyvei9mxuYfHl01K5I8Sq1Emh33yW\nna3zI6mqDxATtuGRrk8YAxX0IkWHyK4sb99wMyJ9+jMhzURmkrUaYGlH9Q4uuqBj\npQsskpr7ogBtYpBMgvQPJJ0RQT/c+q0vORMsT9R3IHIjrb7ysDcLUlHzSAaiZhrn\nwRFKcMoj20MLEK0dJ0vwqu9Xwt+FzPUqTZeW/XkorzywuiJ12X4BOSgIAcQd9as=\n=h5Km\n-----END PGP SIGNATURE-----\n", "payload": "tree 6778386ecb173cd55fe9cba417673a5351ce66f4\nparent 8b097c4ce92869b012c36ba0c7c0a2a096a17849\nauthor Oliver S\u0336c\u0336h\u0336n\u0336e\u0336i\u0336d\u0336e\u0336r Scherer <github35764891676564198441@oli-obk.de> 1540484894 +0200\ncommitter GitHub <noreply@github.com> 1540484894 +0200\n\nExplain a comment in more detail"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7629eff32cf23680074ae72144ed748139100fe", "html_url": "https://github.com/rust-lang/rust/commit/f7629eff32cf23680074ae72144ed748139100fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7629eff32cf23680074ae72144ed748139100fe/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b097c4ce92869b012c36ba0c7c0a2a096a17849", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b097c4ce92869b012c36ba0c7c0a2a096a17849", "html_url": "https://github.com/rust-lang/rust/commit/8b097c4ce92869b012c36ba0c7c0a2a096a17849"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "99ccf4f3cf5bb3e9c3fc3892afb307a468e6e6a5", "filename": "src/librustc_mir/transform/qualify_consts.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f7629eff32cf23680074ae72144ed748139100fe/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7629eff32cf23680074ae72144ed748139100fe/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs?ref=f7629eff32cf23680074ae72144ed748139100fe", "patch": "@@ -979,8 +979,15 @@ impl<'a, 'tcx> Visitor<'tcx> for Qualifier<'a, 'tcx, 'tcx> {\n                     if !constant_arguments.contains(&i) {\n                         return\n                     }\n-                    // if the argument requires a constant, we care about constness, not\n-                    // promotability\n+                    // Since the argument is required to be constant,\n+                    // we care about constness, not promotability.\n+                    // If we checked for promotability, we'd miss out on\n+                    // the results of function calls (which are never promoted)\n+                    // This is not a problem, because the argument explicitly\n+                    // requests constness, in contrast to regular promotion\n+                    // which happens even without the user requesting it.\n+                    // We can error out with a hard error if the argument is not\n+                    // constant here.\n                     if (this.qualif - Qualif::NOT_PROMOTABLE).is_empty() {\n                         this.promotion_candidates.push(candidate);\n                     } else {"}]}