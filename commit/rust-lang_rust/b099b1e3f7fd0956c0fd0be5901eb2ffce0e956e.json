{"sha": "b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwOTliMWUzZjdmZDA5NTZjMGZkMGJlNTkwMWViMmZmY2UwZTk1NmU=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-08-29T20:46:25Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-08-29T20:46:49Z"}, "message": "Make std::istr::push_byte efficient\n\nIt used to allocate two (!) heap values per pushed byte. It now goes through\na runtime function that simply grows the istr and writes the byte.", "tree": {"sha": "f9f139308378da84884cb5f295521f9cccb5d678", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f9f139308378da84884cb5f295521f9cccb5d678"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "comment_count": 6, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "html_url": "https://github.com/rust-lang/rust/commit/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "14567c5eb05b6dd7ba9706a605c8d3ee8c5d8742", "url": "https://api.github.com/repos/rust-lang/rust/commits/14567c5eb05b6dd7ba9706a605c8d3ee8c5d8742", "html_url": "https://github.com/rust-lang/rust/commit/14567c5eb05b6dd7ba9706a605c8d3ee8c5d8742"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "e94c5a4904d091cc4e429cb21f325e9a8a325445", "filename": "src/lib/istr.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Flib%2Fistr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Flib%2Fistr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fistr.rs?ref=b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "patch": "@@ -8,6 +8,10 @@ as_buf, push_byte;\n \n export from_estr, to_estr, from_estrs, to_estrs;\n \n+native \"rust\" mod rustrt {\n+    fn rust_istr_push(s: &mutable istr, ch: u8);\n+}\n+\n fn from_estr(s: &str) -> istr {\n     let s2 = ~\"\";\n     for u in s {\n@@ -361,12 +365,12 @@ fn pop_byte(s: &mutable istr) -> u8 {\n }\n \n fn push_byte(s: &mutable istr, b: u8) {\n-    s += unsafe_from_byte(b);\n+    rustrt::rust_istr_push(s, b);\n }\n \n fn push_bytes(s: &mutable istr, bytes: &[u8]) {\n     for byte in bytes {\n-        push_byte(s, byte);\n+        rustrt::rust_istr_push(s, byte);\n     }\n }\n "}, {"sha": "679a04b93d63a0c0c8e23ac1ae327a849dd386e3", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "patch": "@@ -243,6 +243,15 @@ vec_from_buf_shared(rust_task *task, type_desc *ty,\n     return v;\n }\n \n+extern \"C\" CDECL void\n+rust_istr_push(rust_task* task, rust_vec** sp, uint8_t byte) {\n+    size_t fill = (*sp)->fill;\n+    reserve_vec(task, sp, fill + 1);\n+    (*sp)->data[fill-1] = byte;\n+    (*sp)->data[fill] = 0;\n+    (*sp)->fill = fill + 1;\n+}\n+\n extern \"C\" CDECL rust_str *\n str_from_cstr(rust_task *task, char *sbuf)\n {"}, {"sha": "77c7cf1a113be28bd319d817ddeabe9af8525512", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "patch": "@@ -353,7 +353,7 @@ upcall_vec_grow(rust_task* task, rust_vec** vp, size_t new_sz) {\n \n extern \"C\" CDECL void\n upcall_vec_push(rust_task* task, rust_vec** vp, type_desc* elt_ty,\n-                 void* elt) {\n+                void* elt) {\n     LOG_UPCALL_ENTRY(task);\n     size_t new_sz = (*vp)->fill + elt_ty->size;\n     reserve_vec(task, vp, new_sz);\n@@ -362,7 +362,6 @@ upcall_vec_push(rust_task* task, rust_vec** vp, type_desc* elt_ty,\n     v->fill += elt_ty->size;\n }\n \n-\n /**\n  * Returns a token that can be used to deallocate all of the allocated space\n  * space in the dynamic stack."}, {"sha": "ea71a05a88d8a9f704679a55d9dd4e1302a01acd", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=b099b1e3f7fd0956c0fd0be5901eb2ffce0e956e", "patch": "@@ -84,6 +84,7 @@ upcall_get_type_desc\n upcall_grow_task\n upcall_vec_grow\n upcall_vec_push\n+upcall_istr_push\n upcall_kill\n upcall_log_double\n upcall_log_float"}]}