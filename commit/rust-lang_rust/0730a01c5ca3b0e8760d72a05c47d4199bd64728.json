{"sha": "0730a01c5ca3b0e8760d72a05c47d4199bd64728", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3MzBhMDFjNWNhM2IwZTg3NjBkNzJhMDVjNDdkNDE5OWJkNjQ3Mjg=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-04-05T21:51:07Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2019-04-05T21:51:07Z"}, "message": "Use for_each to extend collections\n\nThis updates the `Extend` implementations to use `for_each` for many\ncollections: `BinaryHeap`, `BTreeMap`, `BTreeSet`, `LinkedList`, `Path`,\n`TokenStream`, `VecDeque`, and `Wtf8Buf`.\n\nFolding with `for_each` enables better performance than a `for`-loop for\nsome iterators, especially if they can just forward to internal\niterators, like `Chain` and `FlatMap` do.", "tree": {"sha": "5af6502b9735c82450876e518ccfce9fd977debf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5af6502b9735c82450876e518ccfce9fd977debf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0730a01c5ca3b0e8760d72a05c47d4199bd64728", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0730a01c5ca3b0e8760d72a05c47d4199bd64728", "html_url": "https://github.com/rust-lang/rust/commit/0730a01c5ca3b0e8760d72a05c47d4199bd64728", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0730a01c5ca3b0e8760d72a05c47d4199bd64728/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200", "url": "https://api.github.com/repos/rust-lang/rust/commits/acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200", "html_url": "https://github.com/rust-lang/rust/commit/acd8dd6a50d505057a7d7ad8d0d7a4c2bd274200"}], "stats": {"total": 32, "additions": 10, "deletions": 22}, "files": [{"sha": "8c142a3d317c6f12476e44a4147a473e3f285250", "filename": "src/liballoc/collections/binary_heap.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbinary_heap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbinary_heap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Fbinary_heap.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -1177,9 +1177,7 @@ impl<T: Ord> BinaryHeap<T> {\n \n         self.reserve(lower);\n \n-        for elem in iterator {\n-            self.push(elem);\n-        }\n+        iterator.for_each(move |elem| self.push(elem));\n     }\n }\n "}, {"sha": "6b079fc87cc78905f431a097a2aa8aaee7a33f3b", "filename": "src/liballoc/collections/btree/map.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Fbtree%2Fmap.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -1727,9 +1727,9 @@ impl<K: Ord, V> FromIterator<(K, V)> for BTreeMap<K, V> {\n impl<K: Ord, V> Extend<(K, V)> for BTreeMap<K, V> {\n     #[inline]\n     fn extend<T: IntoIterator<Item = (K, V)>>(&mut self, iter: T) {\n-        for (k, v) in iter {\n+        iter.into_iter().for_each(move |(k, v)| {\n             self.insert(k, v);\n-        }\n+        });\n     }\n }\n "}, {"sha": "16a96ca19b82462b4a99f2e234f3e1c85b630e4f", "filename": "src/liballoc/collections/btree/set.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Fbtree%2Fset.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -883,9 +883,9 @@ impl<'a, T> IntoIterator for &'a BTreeSet<T> {\n impl<T: Ord> Extend<T> for BTreeSet<T> {\n     #[inline]\n     fn extend<Iter: IntoIterator<Item = T>>(&mut self, iter: Iter) {\n-        for elem in iter {\n+        iter.into_iter().for_each(move |elem| {\n             self.insert(elem);\n-        }\n+        });\n     }\n }\n "}, {"sha": "d6d84a4f083d060ca380ffccca8cece42deccc11", "filename": "src/liballoc/collections/linked_list.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Flinked_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Flinked_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Flinked_list.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -1107,9 +1107,7 @@ impl<T> Extend<T> for LinkedList<T> {\n \n impl<I: IntoIterator> SpecExtend<I> for LinkedList<I::Item> {\n     default fn spec_extend(&mut self, iter: I) {\n-        for elt in iter {\n-            self.push_back(elt);\n-        }\n+        iter.into_iter().for_each(move |elt| self.push_back(elt));\n     }\n }\n "}, {"sha": "4bea615ab861face0477a12fc36446c2f32874c2", "filename": "src/liballoc/collections/vec_deque.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Fliballoc%2Fcollections%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fcollections%2Fvec_deque.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -2677,9 +2677,7 @@ impl<'a, T> IntoIterator for &'a mut VecDeque<T> {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<A> Extend<A> for VecDeque<A> {\n     fn extend<T: IntoIterator<Item = A>>(&mut self, iter: T) {\n-        for elt in iter {\n-            self.push_back(elt);\n-        }\n+        iter.into_iter().for_each(move |elt| self.push_back(elt));\n     }\n }\n "}, {"sha": "1e0f1ed578aaed4a99016f92b92bf0ba1e377aeb", "filename": "src/libproc_macro/lib.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibproc_macro%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibproc_macro%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibproc_macro%2Flib.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -160,9 +160,7 @@ impl iter::FromIterator<TokenTree> for TokenStream {\n impl iter::FromIterator<TokenStream> for TokenStream {\n     fn from_iter<I: IntoIterator<Item = TokenStream>>(streams: I) -> Self {\n         let mut builder = bridge::client::TokenStreamBuilder::new();\n-        for stream in streams {\n-            builder.push(stream.0);\n-        }\n+        streams.into_iter().for_each(|stream| builder.push(stream.0));\n         TokenStream(builder.build())\n     }\n }"}, {"sha": "1bbda9b5bcb1aa2e5d7f81b863a62f35c892705c", "filename": "src/libstd/path.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibstd%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibstd%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fpath.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -1551,9 +1551,7 @@ impl<P: AsRef<Path>> iter::FromIterator<P> for PathBuf {\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<P: AsRef<Path>> iter::Extend<P> for PathBuf {\n     fn extend<I: IntoIterator<Item = P>>(&mut self, iter: I) {\n-        for p in iter {\n-            self.push(p.as_ref())\n-        }\n+        iter.into_iter().for_each(move |p| self.push(p.as_ref()));\n     }\n }\n "}, {"sha": "f17020de44ec538ecbbf88f7e7aea934f6685cf0", "filename": "src/libstd/sys_common/wtf8.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibstd%2Fsys_common%2Fwtf8.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0730a01c5ca3b0e8760d72a05c47d4199bd64728/src%2Flibstd%2Fsys_common%2Fwtf8.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys_common%2Fwtf8.rs?ref=0730a01c5ca3b0e8760d72a05c47d4199bd64728", "patch": "@@ -388,9 +388,7 @@ impl Extend<CodePoint> for Wtf8Buf {\n         let (low, _high) = iterator.size_hint();\n         // Lower bound of one byte per code point (ASCII only)\n         self.bytes.reserve(low);\n-        for code_point in iterator {\n-            self.push(code_point);\n-        }\n+        iterator.for_each(move |code_point| self.push(code_point));\n     }\n }\n "}]}