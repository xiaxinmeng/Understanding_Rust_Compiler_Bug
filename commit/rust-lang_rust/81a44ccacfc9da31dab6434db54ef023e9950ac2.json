{"sha": "81a44ccacfc9da31dab6434db54ef023e9950ac2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxYTQ0Y2NhY2ZjOWRhMzFkYWI2NDM0ZGI1NGVmMDIzZTk5NTBhYzI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-22T00:43:31Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-10-22T00:47:31Z"}, "message": "Remove hack to break the AST fold cycle. Closes #998", "tree": {"sha": "36d9327edd28e1172c4b40c753ae8708b1341af0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36d9327edd28e1172c4b40c753ae8708b1341af0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/81a44ccacfc9da31dab6434db54ef023e9950ac2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/81a44ccacfc9da31dab6434db54ef023e9950ac2", "html_url": "https://github.com/rust-lang/rust/commit/81a44ccacfc9da31dab6434db54ef023e9950ac2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/81a44ccacfc9da31dab6434db54ef023e9950ac2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "160c56e76870efd9d1bf836e609f8bae092f9269", "url": "https://api.github.com/repos/rust-lang/rust/commits/160c56e76870efd9d1bf836e609f8bae092f9269", "html_url": "https://github.com/rust-lang/rust/commit/160c56e76870efd9d1bf836e609f8bae092f9269"}], "stats": {"total": 40, "additions": 2, "deletions": 38}, "files": [{"sha": "126487aed983e3083ebcf6eb91d60c50783c7981", "filename": "src/comp/syntax/fold.rs", "status": "modified", "additions": 2, "deletions": 38, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/81a44ccacfc9da31dab6434db54ef023e9950ac2/src%2Fcomp%2Fsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/81a44ccacfc9da31dab6434db54ef023e9950ac2/src%2Fcomp%2Fsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Ffold.rs?ref=81a44ccacfc9da31dab6434db54ef023e9950ac2", "patch": "@@ -7,7 +7,6 @@ export ast_fold_precursor;\n export ast_fold;\n export default_ast_fold;\n export make_fold;\n-export dummy_out;\n export noop_fold_crate;\n export noop_fold_item;\n export noop_fold_expr;\n@@ -529,42 +528,7 @@ fn default_ast_fold() -> @ast_fold_precursor {\n           new_span: noop_span};\n }\n \n-fn dummy_out(a: ast_fold) {\n-    *a =\n-        {fold_crate: nf_crate_dummy,\n-         fold_crate_directive: nf_crate_directive_dummy,\n-         fold_view_item: nf_view_item_dummy,\n-         fold_native_item: nf_native_item_dummy,\n-         fold_item: nf_item_dummy,\n-         fold_item_underscore: nf_item_underscore_dummy,\n-         fold_method: nf_method_dummy,\n-         fold_block: nf_blk_dummy,\n-         fold_stmt: nf_stmt_dummy,\n-         fold_arm: nf_arm_dummy,\n-         fold_pat: nf_pat_dummy,\n-         fold_decl: nf_decl_dummy,\n-         fold_expr: nf_expr_dummy,\n-         fold_ty: nf_ty_dummy,\n-         fold_constr: nf_constr_dummy,\n-         fold_fn: nf_fn_dummy,\n-         fold_mod: nf_mod_dummy,\n-         fold_native_mod: nf_native_mod_dummy,\n-         fold_variant: nf_variant_dummy,\n-         fold_ident: nf_ident_dummy,\n-         fold_path: nf_path_dummy,\n-         fold_local: nf_local_dummy,\n-         map_exprs: noop_map_exprs,\n-         new_id: noop_id,\n-         new_span: noop_span};\n-}\n-\n-// FIXME: Fold has a circular reference that has to be broken. With GC this\n-// can go away\n-resource foldres(f: ast_fold) {\n-    dummy_out(f);\n-}\n-\n-fn make_fold(afp: ast_fold_precursor) -> @foldres {\n+fn make_fold(afp: ast_fold_precursor) -> ast_fold {\n     // FIXME: Have to bind all the bare functions into shared functions\n     // because @mutable is invariant with respect to its contents\n     let result: ast_fold =\n@@ -702,7 +666,7 @@ fn make_fold(afp: ast_fold_precursor) -> @foldres {\n          map_exprs: afp.map_exprs,\n          new_id: afp.new_id,\n          new_span: afp.new_span};\n-    ret @foldres(result);\n+    ret result;\n }\n \n "}]}