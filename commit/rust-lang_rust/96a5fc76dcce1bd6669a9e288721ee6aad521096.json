{"sha": "96a5fc76dcce1bd6669a9e288721ee6aad521096", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2YTVmYzc2ZGNjZTFiZDY2NjlhOWUyODg3MjFlZTZhYWQ1MjEwOTY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-12T19:36:52Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-14T23:40:18Z"}, "message": "rustbuild: Add sccache support\n\nThis commit adds support for sccache, a ccache-like compiler which works on MSVC\nand stores results into an S3 bucket. This also switches over all Travis and\nAppVeyor automation to using sccache to ensure a shared and unified cache over\ntime which can be shared across builders.\n\nThe support for sccache manifests as a new `--enable-sccache` option which\ninstructs us to configure LLVM differently to use a 'sccache' binary instead of\na 'ccache' binary. All docker images for Travis builds are updated to download\nMozilla's tooltool builds of sccache onto various containers and systems.\nAdditionally a new `rust-lang-ci-sccache` bucket is configured to hold all of\nour ccache goodies.", "tree": {"sha": "9fb1678923a567cd6de665b3e3acbbb004aace1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fb1678923a567cd6de665b3e3acbbb004aace1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96a5fc76dcce1bd6669a9e288721ee6aad521096", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96a5fc76dcce1bd6669a9e288721ee6aad521096", "html_url": "https://github.com/rust-lang/rust/commit/96a5fc76dcce1bd6669a9e288721ee6aad521096", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96a5fc76dcce1bd6669a9e288721ee6aad521096/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d558d012a4be0273e547864923bfe29b14e30d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d558d012a4be0273e547864923bfe29b14e30d5", "html_url": "https://github.com/rust-lang/rust/commit/0d558d012a4be0273e547864923bfe29b14e30d5"}], "stats": {"total": 187, "additions": 152, "deletions": 35}, "files": [{"sha": "7e5f4b25d2eef505bbb74a28a39cae04423e3831", "filename": ".travis.yml", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -30,25 +30,34 @@ matrix:\n         RUST_CONFIGURE_ARGS=--target=x86_64-apple-darwin\n         SRC=.\n       os: osx\n-      install: brew install ccache\n+      install: &osx_install_sccache >\n+        curl -L https://api.pub.build.mozilla.org/tooltool/sha512/d0025b286468cc5ada83b23d3fafbc936b9f190eaa7d4a981715b18e8e3bf720a7bcee7bfe758cfdeb8268857f6098fd52dcdd8818232692a30ce91039936596 |\n+          tar xJf - -C /usr/local/bin --strip-components=1\n     - env: >\n         RUST_CHECK_TARGET=check\n         RUST_CONFIGURE_ARGS=--target=i686-apple-darwin\n         SRC=.\n       os: osx\n-      install: brew install ccache\n+      install: *osx_install_sccache\n     - env: >\n         RUST_CHECK_TARGET=check\n         RUST_CONFIGURE_ARGS=--target=x86_64-apple-darwin --disable-rustbuild\n         SRC=.\n       os: osx\n-      install: brew install ccache\n+      install: *osx_install_sccache\n     - env: >\n         RUST_CHECK_TARGET=\n         RUST_CONFIGURE_ARGS=--target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios\n         SRC=.\n       os: osx\n-      install: brew install ccache\n+      install: *osx_install_sccache\n+\n+env:\n+  global:\n+    - SCCACHE_BUCKET=rust-lang-ci-sccache\n+    - AWS_ACCESS_KEY_ID=AKIAIMX7VLAS3PZAVLUQ\n+    # AWS_SECRET_ACCESS_KEY=...\n+    - secure: \"Pixhh0hXDqGCdOyLtGFjli3J2AtDWIpyb2btIrLe956nCBDRutRoMm6rv5DI9sFZN07Mms7VzNNvhc9wCW1y63JAm414d2Co7Ob8kWMZlz9l9t7ACHuktUiis8yr+S4Quq1Vqd6pqi7pf2J++UxC8R/uLeqVrubzr6+X7AbmEFE=\"\n \n script:\n   - >\n@@ -77,5 +86,3 @@ notifications:\n cache:\n   directories:\n     - $HOME/docker\n-    - $HOME/.ccache\n-    - $HOME/.cargo"}, {"sha": "cb3b50cbaeff24734345a44270d19ad343e17831", "filename": "appveyor.yml", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -1,4 +1,9 @@\n environment:\n+  SCCACHE_BUCKET: rust-lang-ci-sccache\n+  AWS_ACCESS_KEY_ID: AKIAIMX7VLAS3PZAVLUQ\n+  AWS_SECRET_ACCESS_KEY:\n+    secure: 1UkmbiDd15tWtYbMm5O2Uqm0b0Ur8v1MoSlydxl4ojcroPeerRMlUges0l57py8c\n+  SCCACHE_DIGEST: f808afabb4a4eb1d7112bcb3fa6be03b61e93412890c88e177c667eb37f46353d7ec294e559b16f9f4b5e894f2185fe7670a0df15fd064889ecbd80f0c34166c\n   matrix:\n   # 32/64 bit MSVC\n   - MSYS_BITS: 64\n@@ -84,6 +89,13 @@ install:\n   # Otherwise pull in the MinGW installed on appveyor\n   - if NOT defined MINGW_URL set PATH=C:\\msys64\\mingw%MSYS_BITS%\\bin;C:\\msys64\\usr\\bin;%PATH%\n \n+  # Download and install sccache\n+  - appveyor DownloadFile https://api.pub.build.mozilla.org/tooltool/sha512/%SCCACHE_DIGEST%\n+  - mv %SCCACHE_DIGEST% sccache.tar.bz2\n+  - 7z x -y sccache.tar.bz2 > nul\n+  - 7z x -y sccache.tar > nul\n+  - set PATH=%PATH%;%CD%\\sccache2\n+\n test_script:\n   - git submodule update --init\n   - set SRC=."}, {"sha": "e495c0d3abdcaa3d550565c43fe1d652b3e2ec00", "filename": "configure", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/configure", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -621,6 +621,7 @@ opt llvm-assertions 0 \"build LLVM with assertions\"\n opt debug-assertions 0 \"build with debugging assertions\"\n opt fast-make 0 \"use .gitmodules as timestamp for submodule deps\"\n opt ccache 0 \"invoke gcc/clang via ccache to reuse object files between builds\"\n+opt sccache 0 \"invoke gcc/clang via sccache to reuse object files between builds\"\n opt local-rust 0 \"use an installed rustc rather than downloading a snapshot\"\n opt local-rebuild 0 \"assume local-rust matches the current version, for rebuilds; implies local-rust, and is implied if local-rust already matches the current version\"\n opt llvm-static-stdcpp 0 \"statically link to libstdc++ for LLVM\"\n@@ -1677,11 +1678,23 @@ do\n             LLVM_CC_64_ARG1=\"gcc\"\n             ;;\n         (\"gcc\")\n-            LLVM_CXX_32=\"g++\"\n-            LLVM_CC_32=\"gcc\"\n+            if [ -z \"$CFG_ENABLE_SCCACHE\" ]; then\n+                LLVM_CXX_32=\"g++\"\n+                LLVM_CC_32=\"gcc\"\n \n-            LLVM_CXX_64=\"g++\"\n-            LLVM_CC_64=\"gcc\"\n+                LLVM_CXX_64=\"g++\"\n+                LLVM_CC_64=\"gcc\"\n+            else\n+                LLVM_CXX_32=\"sccache\"\n+                LLVM_CC_32=\"sccache\"\n+                LLVM_CXX_32_ARG1=\"g++\"\n+                LLVM_CC_32_ARG1=\"gcc\"\n+\n+                LLVM_CXX_64=\"sccache\"\n+                LLVM_CC_64=\"sccache\"\n+                LLVM_CXX_64_ARG1=\"g++\"\n+                LLVM_CC_64_ARG1=\"gcc\"\n+            fi\n             ;;\n \n         (*)"}, {"sha": "b8abcb28c4e33506d1fb06c2c53fe0433e067415", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 29, "deletions": 4, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -38,7 +38,7 @@ use util::push_exe_path;\n /// `src/bootstrap/config.toml.example`.\n #[derive(Default)]\n pub struct Config {\n-    pub ccache: bool,\n+    pub ccache: Option<String>,\n     pub ninja: bool,\n     pub verbose: bool,\n     pub submodules: bool,\n@@ -138,7 +138,7 @@ struct Build {\n /// TOML representation of how the LLVM build is configured.\n #[derive(RustcDecodable, Default)]\n struct Llvm {\n-    ccache: Option<bool>,\n+    ccache: Option<StringOrBool>,\n     ninja: Option<bool>,\n     assertions: Option<bool>,\n     optimize: Option<bool>,\n@@ -147,6 +147,18 @@ struct Llvm {\n     static_libstdcpp: Option<bool>,\n }\n \n+#[derive(RustcDecodable)]\n+enum StringOrBool {\n+    String(String),\n+    Bool(bool),\n+}\n+\n+impl Default for StringOrBool {\n+    fn default() -> StringOrBool {\n+        StringOrBool::Bool(false)\n+    }\n+}\n+\n /// TOML representation of how the Rust build is configured.\n #[derive(RustcDecodable, Default)]\n struct Rust {\n@@ -247,7 +259,15 @@ impl Config {\n         set(&mut config.vendor, build.vendor);\n \n         if let Some(ref llvm) = toml.llvm {\n-            set(&mut config.ccache, llvm.ccache);\n+            match llvm.ccache {\n+                Some(StringOrBool::String(ref s)) => {\n+                    config.ccache = Some(s.to_string())\n+                }\n+                Some(StringOrBool::Bool(true)) => {\n+                    config.ccache = Some(\"ccache\".to_string());\n+                }\n+                Some(StringOrBool::Bool(false)) | None => {}\n+            }\n             set(&mut config.ninja, llvm.ninja);\n             set(&mut config.llvm_assertions, llvm.assertions);\n             set(&mut config.llvm_optimize, llvm.optimize);\n@@ -338,7 +358,6 @@ impl Config {\n             }\n \n             check! {\n-                (\"CCACHE\", self.ccache),\n                 (\"MANAGE_SUBMODULES\", self.submodules),\n                 (\"COMPILER_DOCS\", self.compiler_docs),\n                 (\"DOCS\", self.docs),\n@@ -475,6 +494,12 @@ impl Config {\n                     let path = parse_configure_path(value);\n                     self.python = Some(path);\n                 }\n+                \"CFG_ENABLE_CCACHE\" if value == \"1\" => {\n+                    self.ccache = Some(\"ccache\".to_string());\n+                }\n+                \"CFG_ENABLE_SCCACHE\" if value == \"1\" => {\n+                    self.ccache = Some(\"sccache\".to_string());\n+                }\n                 _ => {}\n             }\n         }"}, {"sha": "9e50e71bf7d313d809be3d5c9a6db2cfc804f023", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -25,6 +25,8 @@\n \n # Indicates whether ccache is used when building LLVM\n #ccache = false\n+# or alternatively ...\n+#ccache = \"/path/to/ccache\"\n \n # If an external LLVM root is specified, we automatically check the version by\n # default to make sure it's within the range that we're expecting, but setting"}, {"sha": "6ba6b8e6c86205899d7213c89e291d1b000ba2bd", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -109,10 +109,10 @@ pub fn llvm(build: &Build, target: &str) {\n \n     // MSVC handles compiler business itself\n     if !target.contains(\"msvc\") {\n-        if build.config.ccache {\n-           cfg.define(\"CMAKE_C_COMPILER\", \"ccache\")\n+        if let Some(ref ccache) = build.config.ccache {\n+           cfg.define(\"CMAKE_C_COMPILER\", ccache)\n               .define(\"CMAKE_C_COMPILER_ARG1\", build.cc(target))\n-              .define(\"CMAKE_CXX_COMPILER\", \"ccache\")\n+              .define(\"CMAKE_CXX_COMPILER\", ccache)\n               .define(\"CMAKE_CXX_COMPILER_ARG1\", build.cxx(target));\n         } else {\n            cfg.define(\"CMAKE_C_COMPILER\", build.cc(target))"}, {"sha": "2992099687d9a58e288e3f1fd37d5ae403067122", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -223,4 +223,8 @@ $ pacman -R cmake && pacman -S mingw-w64-x86_64-cmake\n     if build.lldb_version.is_some() {\n         build.lldb_python_dir = run(Command::new(\"lldb\").arg(\"-P\")).ok();\n     }\n+\n+    if let Some(ref s) = build.config.ccache {\n+        need_cmd(s.as_ref());\n+    }\n }"}, {"sha": "8911b4ff0cb87e5353a818201f6a2853ee740b1c", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -16,7 +16,8 @@ RUN dpkg --add-architecture i386 && \\\n   expect \\\n   openjdk-9-jre \\\n   sudo \\\n-  libstdc++6:i386\n+  libstdc++6:i386 \\\n+  xz-utils\n \n WORKDIR /android/\n ENV PATH=$PATH:/android/ndk-arm-9/bin:/android/sdk/tools:/android/sdk/platform-tools\n@@ -33,6 +34,10 @@ COPY start-emulator.sh /android/\n \n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\", \"/android/start-emulator.sh\"]\n \n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n ENV TARGETS=arm-linux-androideabi\n ENV TARGETS=$TARGETS,i686-linux-android\n ENV TARGETS=$TARGETS,aarch64-linux-android"}, {"sha": "08b436313f6378c60efa525e65e0f4323d613489", "filename": "src/ci/docker/cross/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -21,7 +21,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gcc-powerpc-linux-gnu libc6-dev-powerpc-cross \\\n   gcc-powerpc64-linux-gnu libc6-dev-ppc64-cross \\\n   gcc-powerpc64le-linux-gnu libc6-dev-ppc64el-cross \\\n-  gcc-s390x-linux-gnu libc6-dev-s390x-cross\n+  gcc-s390x-linux-gnu libc6-dev-s390x-cross \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "1da33c94c7b18d6caece93cbfb0d638cc7c8ccfa", "filename": "src/ci/docker/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fi686-gnu-nopt%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "9e5b0e0435e8b88dcec18a96b50ba4932572cc69", "filename": "src/ci/docker/i686-gnu/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "ce8b49a92dce5db7a30148054ae1ae42e2b58636", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -25,7 +25,6 @@ docker \\\n   -t rust-ci \\\n   \"`dirname \"$script\"`/$image\"\n \n-mkdir -p $HOME/.ccache\n mkdir -p $HOME/.cargo\n mkdir -p $root_dir/obj\n \n@@ -35,8 +34,9 @@ exec docker \\\n   --volume \"$root_dir/obj:/checkout/obj\" \\\n   --workdir /checkout/obj \\\n   --env SRC=/checkout \\\n-  --env CCACHE_DIR=/ccache \\\n-  --volume \"$HOME/.ccache:/ccache\" \\\n+  --env SCCACHE_BUCKET=$SCCACHE_BUCKET \\\n+  --env AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \\\n+  --env AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \\\n   --env CARGO_HOME=/cargo \\\n   --env LOCAL_USER_ID=`id -u` \\\n   --volume \"$HOME/.cargo:/cargo\" \\"}, {"sha": "75f3174e2c0443458eaf592e52af065f0e29271b", "filename": "src/ci/docker/x86_64-freebsd/Dockerfile", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-freebsd%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -23,6 +23,10 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n     rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n ENV \\\n     AR_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-ar \\\n     CC_x86_64_unknown_freebsd=x86_64-unknown-freebsd10-gcc"}, {"sha": "0d9835e86d2a7f3a2ce8edff53af55709131f784", "filename": "src/ci/docker/x86_64-gnu-cargotest/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-cargotest%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-cargotest%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-cargotest%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   libssl-dev \\\n-  sudo\n+  sudo \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "eec88442293a4c2bbdf62231db3e06be061688fb", "filename": "src/ci/docker/x86_64-gnu-debug/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-debug%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "4c9198d88eb2129fe53ac18924fb4c9eed95b375", "filename": "src/ci/docker/x86_64-gnu-llvm-3.7/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.7%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -14,7 +14,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   llvm-3.7-tools \\\n   libedit-dev \\\n-  zlib1g-dev\n+  zlib1g-dev \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "1c503aea13d5087d803ef3a8304fb52de6a83b30", "filename": "src/ci/docker/x86_64-gnu-make/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-make%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-make%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-make%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "66de6ea13ac67c830210516d9a9c45359992e7b3", "filename": "src/ci/docker/x86_64-gnu-nopt/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-nopt%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "3d71b7ffb9a3a04a1554e1c6549e34c27bc45cd3", "filename": "src/ci/docker/x86_64-gnu/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -11,7 +11,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   ccache \\\n   sudo \\\n-  gdb\n+  gdb \\\n+  xz-utils\n+\n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\"}, {"sha": "96b38067cbb1479be05ec81c5f144deac440d442", "filename": "src/ci/docker/x86_64-musl/Dockerfile", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Fdocker%2Fx86_64-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-musl%2FDockerfile?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -23,6 +23,10 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n     rm dumb-init_*.deb\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n+ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n+RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\\n+      tar xJf - -C /usr/local/bin --strip-components=1\n+\n ENV RUST_CONFIGURE_ARGS \\\n       --target=x86_64-unknown-linux-musl \\\n       --musl-root-x86_64=/musl-x86_64"}, {"sha": "152694346aa25bf34a786e00566efe8b7eab96ec", "filename": "src/ci/run.sh", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/96a5fc76dcce1bd6669a9e288721ee6aad521096/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=96a5fc76dcce1bd6669a9e288721ee6aad521096", "patch": "@@ -26,17 +26,13 @@ if [ \"$NO_VENDOR\" = \"\" ]; then\n   ENABLE_VENDOR=--enable-vendor\n fi\n \n-if [ \"$NO_CCACHE\" = \"\" ]; then\n-  ENABLE_CCACHE=--enable-ccache\n-fi\n-\n set -ex\n \n $SRC/configure \\\n   --disable-manage-submodules \\\n   --enable-debug-assertions \\\n   --enable-quiet-tests \\\n-  $ENABLE_CCACHE \\\n+  --enable-sccache \\\n   $ENABLE_VENDOR \\\n   $ENABLE_LLVM_ASSERTIONS \\\n   $RUST_CONFIGURE_ARGS"}]}