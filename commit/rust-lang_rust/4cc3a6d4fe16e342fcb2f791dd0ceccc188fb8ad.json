{"sha": "4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjYzNhNmQ0ZmUxNmUzNDJmY2IyZjc5MWRkMGNlY2NjMTg4ZmI4YWQ=", "commit": {"author": {"name": "Nick Spain", "email": "nicholas.spain@stileeducation.com", "date": "2020-12-31T05:22:59Z"}, "committer": {"name": "Nick Spain", "email": "nicholas.spain@stileeducation.com", "date": "2020-12-31T05:23:05Z"}, "message": "Fix completion of Default struct update syntax\n\nPreviously the inserted text was always `..Default::default()` which ends up as `...Default::default()`\nif `.` was typed. Now  checks if the current token is `.` and inserts `.Default::default()`\nif it is, so `..Default::default()` is correctly completed.\n\nFixes #6969", "tree": {"sha": "b14ad3f33cbef2370685eda791e3e6ef3e7386ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b14ad3f33cbef2370685eda791e3e6ef3e7386ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad", "html_url": "https://github.com/rust-lang/rust/commit/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad/comments", "author": {"login": "nick96", "id": 9591268, "node_id": "MDQ6VXNlcjk1OTEyNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/9591268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nick96", "html_url": "https://github.com/nick96", "followers_url": "https://api.github.com/users/nick96/followers", "following_url": "https://api.github.com/users/nick96/following{/other_user}", "gists_url": "https://api.github.com/users/nick96/gists{/gist_id}", "starred_url": "https://api.github.com/users/nick96/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nick96/subscriptions", "organizations_url": "https://api.github.com/users/nick96/orgs", "repos_url": "https://api.github.com/users/nick96/repos", "events_url": "https://api.github.com/users/nick96/events{/privacy}", "received_events_url": "https://api.github.com/users/nick96/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nick96", "id": 9591268, "node_id": "MDQ6VXNlcjk1OTEyNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/9591268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nick96", "html_url": "https://github.com/nick96", "followers_url": "https://api.github.com/users/nick96/followers", "following_url": "https://api.github.com/users/nick96/following{/other_user}", "gists_url": "https://api.github.com/users/nick96/gists{/gist_id}", "starred_url": "https://api.github.com/users/nick96/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nick96/subscriptions", "organizations_url": "https://api.github.com/users/nick96/orgs", "repos_url": "https://api.github.com/users/nick96/repos", "events_url": "https://api.github.com/users/nick96/events{/privacy}", "received_events_url": "https://api.github.com/users/nick96/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bed7be9ed9f3eb905ae1c377f154fe0990b4c87f", "url": "https://api.github.com/repos/rust-lang/rust/commits/bed7be9ed9f3eb905ae1c377f154fe0990b4c87f", "html_url": "https://github.com/rust-lang/rust/commit/bed7be9ed9f3eb905ae1c377f154fe0990b4c87f"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "8f904adfda01c1e3d2a7fe35d8a06e98e22513c2", "filename": "crates/completion/src/completions/record.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad/crates%2Fcompletion%2Fsrc%2Fcompletions%2Frecord.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad/crates%2Fcompletion%2Fsrc%2Fcompletions%2Frecord.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcompletion%2Fsrc%2Fcompletions%2Frecord.rs?ref=4cc3a6d4fe16e342fcb2f791dd0ceccc188fb8ad", "patch": "@@ -20,13 +20,18 @@ pub(crate) fn complete_record(acc: &mut Completions, ctx: &CompletionContext) ->\n \n             let missing_fields = ctx.sema.record_literal_missing_fields(record_lit);\n             if impl_default_trait && !missing_fields.is_empty() {\n+                let completion_text = if ctx.token.to_string() == \".\" {\n+                    \".Default::default()\"\n+                } else {\n+                    \"..Default::default()\"\n+                };\n                 acc.add(\n                     CompletionItem::new(\n                         CompletionKind::Snippet,\n                         ctx.source_range(),\n                         \"..Default::default()\",\n                     )\n-                    .insert_text(\"..Default::default()\")\n+                    .insert_text(completion_text)\n                     .kind(CompletionItemKind::Field)\n                     .build(),\n                 );"}]}