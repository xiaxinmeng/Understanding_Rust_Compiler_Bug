{"sha": "8092b6487f301bf9219c55fc714744fa2616fb9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgwOTJiNjQ4N2YzMDFiZjkyMTljNTVmYzcxNDc0NGZhMjYxNmZiOWE=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-19T10:30:43Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-04-19T10:30:43Z"}, "message": "Add block matcher", "tree": {"sha": "ea65ea5146b62c5505737c81c7026bae9973693d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea65ea5146b62c5505737c81c7026bae9973693d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8092b6487f301bf9219c55fc714744fa2616fb9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8092b6487f301bf9219c55fc714744fa2616fb9a", "html_url": "https://github.com/rust-lang/rust/commit/8092b6487f301bf9219c55fc714744fa2616fb9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8092b6487f301bf9219c55fc714744fa2616fb9a/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ab0a96586fd54858106cb6ac112d61eb657426f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab0a96586fd54858106cb6ac112d61eb657426f6", "html_url": "https://github.com/rust-lang/rust/commit/ab0a96586fd54858106cb6ac112d61eb657426f6"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "8e3167e55b1fb7b839432491eb48e6cf680c3821", "filename": "crates/ra_mbe/src/lib.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Flib.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -731,4 +731,16 @@ MACRO_ITEMS@[0; 40)\n         }\n \"#, r#\"extern crate a ; mod b ; mod c {} use d ; const E : i32 = 0 ; static F : i32 = 0 ; impl G {} struct H ; enum I {Foo} trait J {} fn h () {} extern {} type T = u8 ;\"#);\n     }\n+\n+    #[test]\n+    fn test_block() {\n+        let rules = create_rules(\n+            r#\"\n+        macro_rules! foo {\n+            ($ i:block) => { fn foo() $ i }\n+        }\n+\"#,\n+        );\n+        assert_expansion(&rules, \"foo! { { 1; } }\", \"fn foo () {1 ;}\");\n+    }\n }"}, {"sha": "a74e477d6c5acd57221f1b6a349969bcda8f05e6", "filename": "crates/ra_mbe/src/mbe_expander.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fmbe_expander.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -161,6 +161,11 @@ fn match_lhs(pattern: &crate::Subtree, input: &mut TtCursor) -> Result<Bindings,\n                             let pat = input.eat_stmt().ok_or(ExpandError::UnexpectedToken)?.clone();\n                             res.inner.insert(text.clone(), Binding::Simple(pat.into()));\n                         }\n+                        \"block\" => {\n+                            let block =\n+                                input.eat_block().ok_or(ExpandError::UnexpectedToken)?.clone();\n+                            res.inner.insert(text.clone(), Binding::Simple(block.into()));\n+                        }\n                         \"item\" => {\n                             let item =\n                                 input.eat_item().ok_or(ExpandError::UnexpectedToken)?.clone();"}, {"sha": "2b11186c43a908751a1f56f5fa1150235d137f02", "filename": "crates/ra_mbe/src/subtree_parser.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Fsubtree_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Fsubtree_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fsubtree_parser.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -46,6 +46,10 @@ impl<'a> Parser<'a> {\n         self.parse(|src, sink| ra_parser::parse_stmt(src, sink, false))\n     }\n \n+    pub fn parse_block(self) -> Option<tt::TokenTree> {\n+        self.parse(ra_parser::parse_block)\n+    }\n+\n     pub fn parse_item(self) -> Option<tt::TokenTree> {\n         self.parse(ra_parser::parse_item)\n     }"}, {"sha": "d700aad6929e8016c27cc8d36a3bb7bf0001ba37", "filename": "crates/ra_mbe/src/tt_cursor.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Ftt_cursor.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -104,6 +104,11 @@ impl<'a> TtCursor<'a> {\n         parser.parse_stmt()\n     }\n \n+    pub(crate) fn eat_block(&mut self) -> Option<tt::TokenTree> {\n+        let parser = Parser::new(&mut self.pos, self.subtree);\n+        parser.parse_block()\n+    }\n+\n     pub(crate) fn eat_item(&mut self) -> Option<tt::TokenTree> {\n         let parser = Parser::new(&mut self.pos, self.subtree);\n         parser.parse_item()"}, {"sha": "7bae0bc7bc798cc78477c8869163ac4ca2501240", "filename": "crates/ra_parser/src/grammar.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_parser%2Fsrc%2Fgrammar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -95,6 +95,10 @@ pub(crate) fn stmt(p: &mut Parser, with_semi: bool) {\n     expressions::stmt(p, with_semi)\n }\n \n+pub(crate) fn block(p: &mut Parser) {\n+    expressions::block(p);\n+}\n+\n pub(crate) fn item(p: &mut Parser) {\n     items::item_or_macro(p, true, items::ItemFlavor::Mod)\n }"}, {"sha": "1e6a0064295ad78a6c5cf1f2ced461da531b2a50", "filename": "crates/ra_parser/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_parser%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8092b6487f301bf9219c55fc714744fa2616fb9a/crates%2Fra_parser%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Flib.rs?ref=8092b6487f301bf9219c55fc714744fa2616fb9a", "patch": "@@ -93,6 +93,11 @@ pub fn parse_stmt(token_source: &dyn TokenSource, tree_sink: &mut dyn TreeSink,\n     parse_from_tokens(token_source, tree_sink, |p| grammar::stmt(p, with_semi));\n }\n \n+/// Parse given tokens into the given sink as a block\n+pub fn parse_block(token_source: &dyn TokenSource, tree_sink: &mut dyn TreeSink) {\n+    parse_from_tokens(token_source, tree_sink, grammar::block);\n+}\n+\n /// Parse given tokens into the given sink as an item\n pub fn parse_item(token_source: &dyn TokenSource, tree_sink: &mut dyn TreeSink) {\n     parse_from_tokens(token_source, tree_sink, grammar::item);"}]}