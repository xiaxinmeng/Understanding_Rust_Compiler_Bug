{"sha": "8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiODJmNjg1YTU3ZDZhMWEzNTY3YzJjYTZlNzdlZmVkYmVkZWZhYzI=", "commit": {"author": {"name": "Alexey Shmalko", "email": "rasen.dubi@gmail.com", "date": "2019-04-29T17:01:46Z"}, "committer": {"name": "Alexey Shmalko", "email": "rasen.dubi@gmail.com", "date": "2019-05-02T13:38:23Z"}, "message": "Make find_attr_val a little bit more precise\n\n`find_attr_val(&line, \"since\")` returns `Some(\", issue = \")` when\n`line` is set to the following line:\n\n```\n[unstable(feature = \"checked_duration_since\", issue = \"58402\")]\n```\n\nMake `find_attr_val` use regex that is a little bit more\nprecise (requires `=` after key name).\n\nIt still does not handle all cases (e.g., extra leading chars in key\nname, or escaped quotes in value), but is good enough for now.", "tree": {"sha": "212ed497e30a03c39aa2962a9219644e917dc606", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/212ed497e30a03c39aa2962a9219644e917dc606"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "html_url": "https://github.com/rust-lang/rust/commit/8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/comments", "author": {"login": "rasendubi", "id": 1366419, "node_id": "MDQ6VXNlcjEzNjY0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1366419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasendubi", "html_url": "https://github.com/rasendubi", "followers_url": "https://api.github.com/users/rasendubi/followers", "following_url": "https://api.github.com/users/rasendubi/following{/other_user}", "gists_url": "https://api.github.com/users/rasendubi/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasendubi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasendubi/subscriptions", "organizations_url": "https://api.github.com/users/rasendubi/orgs", "repos_url": "https://api.github.com/users/rasendubi/repos", "events_url": "https://api.github.com/users/rasendubi/events{/privacy}", "received_events_url": "https://api.github.com/users/rasendubi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rasendubi", "id": 1366419, "node_id": "MDQ6VXNlcjEzNjY0MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1366419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasendubi", "html_url": "https://github.com/rasendubi", "followers_url": "https://api.github.com/users/rasendubi/followers", "following_url": "https://api.github.com/users/rasendubi/following{/other_user}", "gists_url": "https://api.github.com/users/rasendubi/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasendubi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasendubi/subscriptions", "organizations_url": "https://api.github.com/users/rasendubi/orgs", "repos_url": "https://api.github.com/users/rasendubi/repos", "events_url": "https://api.github.com/users/rasendubi/events{/privacy}", "received_events_url": "https://api.github.com/users/rasendubi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "758dc9af504e2fe75813bd362619231ecc727898", "url": "https://api.github.com/repos/rust-lang/rust/commits/758dc9af504e2fe75813bd362619231ecc727898", "html_url": "https://github.com/rust-lang/rust/commit/758dc9af504e2fe75813bd362619231ecc727898"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "79ef359bdac5fd4e8867a6a15c5ef768c8d3567e", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "patch": "@@ -3565,6 +3565,7 @@ dependencies = [\n name = \"tidy\"\n version = \"0.1.0\"\n dependencies = [\n+ \"regex 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde 1.0.82 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_derive 1.0.81 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.33 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "f5db2487618d6e116ffc10138ee6205e8cfdf2c2", "filename": "src/tools/tidy/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2FCargo.toml?ref=8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "patch": "@@ -4,6 +4,7 @@ version = \"0.1.0\"\n authors = [\"Alex Crichton <alex@alexcrichton.com>\"]\n \n [dependencies]\n+regex = \"1\"\n serde = \"1.0.8\"\n serde_derive = \"1.0.8\"\n serde_json = \"1.0.2\""}, {"sha": "f2b17c7471109dba047947d6a6ea8fcfc4be6856", "filename": "src/tools/tidy/src/features.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs?ref=8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "patch": "@@ -14,6 +14,8 @@ use std::fs::{self, File};\n use std::io::prelude::*;\n use std::path::Path;\n \n+use regex::{Regex, escape};\n+\n #[derive(Debug, PartialEq, Clone)]\n pub enum Status {\n     Stable,\n@@ -151,10 +153,19 @@ pub fn check(path: &Path, bad: &mut bool, quiet: bool) {\n }\n \n fn find_attr_val<'a>(line: &'a str, attr: &str) -> Option<&'a str> {\n-    line.find(attr)\n-        .and_then(|i| line[i..].find('\"').map(|j| i + j + 1))\n-        .and_then(|i| line[i..].find('\"').map(|j| (i, i + j)))\n-        .map(|(i, j)| &line[i..j])\n+    let r = Regex::new(&format!(r#\"{} *= *\"([^\"]*)\"\"#, escape(attr)))\n+        .expect(\"malformed regex for find_attr_val\");\n+    r.captures(line)\n+        .and_then(|c| c.get(1))\n+        .map(|m| m.as_str())\n+}\n+\n+#[test]\n+fn test_find_attr_val() {\n+    let s = r#\"#[unstable(feature = \"checked_duration_since\", issue = \"58402\")]\"#;\n+    assert_eq!(find_attr_val(s, \"feature\"), Some(\"checked_duration_since\"));\n+    assert_eq!(find_attr_val(s, \"issue\"), Some(\"58402\"));\n+    assert_eq!(find_attr_val(s, \"since\"), None);\n }\n \n fn test_filen_gate(filen_underscore: &str, features: &mut Features) -> bool {"}, {"sha": "30080452edc0199959474d61bf9b5c9558bb9e3b", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b82f685a57d6a1a3567c2ca6e77efedbedefac2/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=8b82f685a57d6a1a3567c2ca6e77efedbedefac2", "patch": "@@ -5,6 +5,7 @@\n \n #![deny(rust_2018_idioms)]\n \n+extern crate regex;\n extern crate serde_json;\n #[macro_use]\n extern crate serde_derive;"}]}