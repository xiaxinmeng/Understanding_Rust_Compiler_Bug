{"sha": "92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyYWEwZjljODcxYTkzMDhlYTNkYjFiMWM0YjdlNDJkODgzNDhlMzA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-18T09:05:16Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-18T09:24:20Z"}, "message": "Don't use additional_text_edits API internally", "tree": {"sha": "ce785e530a547e3aede708b7725b4a95e666f45f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce785e530a547e3aede708b7725b4a95e666f45f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "html_url": "https://github.com/rust-lang/rust/commit/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79f35cc6992d18e97b0bb9e309a2dc37f6f286e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/79f35cc6992d18e97b0bb9e309a2dc37f6f286e8", "html_url": "https://github.com/rust-lang/rust/commit/79f35cc6992d18e97b0bb9e309a2dc37f6f286e8"}], "stats": {"total": 1684, "additions": 1300, "deletions": 384}, "files": [{"sha": "ce3d6ed3cb6c26944e49ddb68ef98c3afa7b2963", "filename": "crates/ra_ide_api/src/completion/complete_postfix.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -16,15 +16,16 @@ use ra_syntax::{\n use ra_text_edit::TextEditBuilder;\n \n fn postfix_snippet(ctx: &CompletionContext, label: &str, detail: &str, snippet: &str) -> Builder {\n-    let replace_range = ctx.source_range();\n-    let receiver_range = ctx.dot_receiver.expect(\"no receiver available\").syntax().range();\n-    let delete_range = TextRange::from_to(receiver_range.start(), replace_range.start());\n-    let mut builder = TextEditBuilder::default();\n-    builder.delete(delete_range);\n-    CompletionItem::new(CompletionKind::Postfix, replace_range, label)\n-        .insert_snippet(snippet)\n+    let edit = {\n+        let receiver_range = ctx.dot_receiver.expect(\"no receiver available\").syntax().range();\n+        let delete_range = TextRange::from_to(receiver_range.start(), ctx.source_range().end());\n+        let mut builder = TextEditBuilder::default();\n+        builder.replace(delete_range, snippet.to_string());\n+        builder.finish()\n+    };\n+    CompletionItem::new(CompletionKind::Postfix, ctx.source_range(), label)\n         .detail(detail)\n-        .text_edit(builder.finish())\n+        .snippet_edit(edit)\n }\n \n pub(super) fn complete_postfix(acc: &mut Completions, ctx: &CompletionContext) {"}, {"sha": "9aa9768d1bd07b4c60dc1b3dbadffb4b71dbdb80", "filename": "crates/ra_ide_api/src/completion/completion_item.rs", "status": "modified", "additions": 62, "deletions": 41, "changes": 103, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcompletion_item.rs?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -2,7 +2,7 @@ use std::fmt;\n \n use hir::{Docs, Documentation, PerNs, Resolution};\n use ra_syntax::TextRange;\n-use ra_text_edit::TextEdit;\n+use ra_text_edit::{ TextEditBuilder, TextEdit};\n use test_utils::tested_by;\n \n use crate::completion::{\n@@ -17,29 +17,47 @@ use crate::completion::{\n /// `CompletionItem`, use `new` method and the `Builder` struct.\n pub struct CompletionItem {\n     /// Used only internally in tests, to check only specific kind of\n-    /// completion.\n+    /// completion (postfix, keyword, reference, etc).\n     #[allow(unused)]\n     completion_kind: CompletionKind,\n+    /// Label in the completion pop up which identifies completion.\n     label: String,\n+    /// Range of identifier that is being completed.\n+    ///\n+    /// It should be used primarily for UI, but we also use this to convert\n+    /// genetic TextEdit into LSP's completion edit (see conv.rs).\n+    ///\n+    /// `source_range` must contain the completion offset. `insert_text` should\n+    /// start with what `source_range` points to, or VSCode will filter out the\n+    /// completion silently.\n+    source_range: TextRange,\n+    /// What happens when user selects this item.\n+    ///\n+    /// Typically, replaces `source_range` with new identifier.\n+    text_edit: TextEdit,\n+    insert_text_format: InsertTextFormat,\n+\n+    /// What item (struct, function, etc) are we completing.\n     kind: Option<CompletionItemKind>,\n+\n+    /// Lookup is used to check if completion item indeed can complete current\n+    /// ident.\n+    ///\n+    /// That is, in `foo.bar<|>` lookup of `abracadabra` will be accepted (it\n+    /// contains `bar` sub sequence), and `quux` will rejected.\n     lookup: Option<String>,\n+\n+    /// Additional info to show in the UI pop up.\n     detail: Option<String>,\n     documentation: Option<Documentation>,\n-    insert_text: Option<String>,\n-    insert_text_format: InsertTextFormat,\n-    /// Where completion occurs. `source_range` must contain the completion offset.\n-    /// `insert_text` should start with what `source_range` points to, or VSCode\n-    /// will filter out the completion silently.\n-    source_range: TextRange,\n-    /// Additional text edit, ranges in `text_edit` must never intersect with `source_range`.\n-    /// Or VSCode will drop it silently.\n-    text_edit: Option<TextEdit>,\n }\n \n impl fmt::Debug for CompletionItem {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n         let mut s = f.debug_struct(\"CompletionItem\");\n-        s.field(\"label\", &self.label()).field(\"source_range\", &self.source_range());\n+        s.field(\"label\", &self.label())\n+            .field(\"source_range\", &self.source_range())\n+            .field(\"text_edit\", &self.text_edit);\n         if let Some(kind) = self.kind().as_ref() {\n             s.field(\"kind\", kind);\n         }\n@@ -52,13 +70,6 @@ impl fmt::Debug for CompletionItem {\n         if let Some(documentation) = self.documentation() {\n             s.field(\"documentation\", &documentation);\n         }\n-        if self.insert_text() != self.label() {\n-            s.field(\"insert_text\", &self.insert_text())\n-                .field(\"insert_text_format\", &self.insert_text_format());\n-        }\n-        if let Some(edit) = self.text_edit.as_ref() {\n-            s.field(\"text_edit\", edit);\n-        }\n         s.finish()\n     }\n }\n@@ -103,12 +114,12 @@ pub enum InsertTextFormat {\n impl CompletionItem {\n     pub(crate) fn new(\n         completion_kind: CompletionKind,\n-        replace_range: TextRange,\n+        source_range: TextRange,\n         label: impl Into<String>,\n     ) -> Builder {\n         let label = label.into();\n         Builder {\n-            source_range: replace_range,\n+            source_range,\n             completion_kind,\n             label,\n             insert_text: None,\n@@ -124,6 +135,18 @@ impl CompletionItem {\n     pub fn label(&self) -> &str {\n         &self.label\n     }\n+    pub fn source_range(&self) -> TextRange {\n+        self.source_range\n+    }\n+\n+    pub fn insert_text_format(&self) -> InsertTextFormat {\n+        self.insert_text_format\n+    }\n+\n+    pub fn text_edit(&self) -> &TextEdit {\n+        &self.text_edit\n+    }\n+\n     /// Short one-line additional information, like a type\n     pub fn detail(&self) -> Option<&str> {\n         self.detail.as_ref().map(|it| it.as_str())\n@@ -137,24 +160,9 @@ impl CompletionItem {\n         self.lookup.as_ref().map(|it| it.as_str()).unwrap_or_else(|| self.label())\n     }\n \n-    pub fn insert_text_format(&self) -> InsertTextFormat {\n-        self.insert_text_format\n-    }\n-    pub fn insert_text(&self) -> String {\n-        match &self.insert_text {\n-            Some(t) => t.clone(),\n-            None => self.label.clone(),\n-        }\n-    }\n     pub fn kind(&self) -> Option<CompletionItemKind> {\n         self.kind\n     }\n-    pub fn take_text_edit(&mut self) -> Option<TextEdit> {\n-        self.text_edit.take()\n-    }\n-    pub fn source_range(&self) -> TextRange {\n-        self.source_range\n-    }\n }\n \n /// A helper to make `CompletionItem`s.\n@@ -178,17 +186,27 @@ impl Builder {\n     }\n \n     pub(crate) fn build(self) -> CompletionItem {\n+        let label = self.label;\n+        let text_edit = match self.text_edit {\n+            Some(it) => it,\n+            None => {\n+                let mut builder = TextEditBuilder::default();\n+                builder\n+                    .replace(self.source_range, self.insert_text.unwrap_or_else(|| label.clone()));\n+                builder.finish()\n+            }\n+        };\n+\n         CompletionItem {\n             source_range: self.source_range,\n-            label: self.label,\n+            label,\n+            insert_text_format: self.insert_text_format,\n+            text_edit,\n             detail: self.detail,\n             documentation: self.documentation,\n-            insert_text_format: self.insert_text_format,\n             lookup: self.lookup,\n             kind: self.kind,\n             completion_kind: self.completion_kind,\n-            text_edit: self.text_edit,\n-            insert_text: self.insert_text,\n         }\n     }\n     pub(crate) fn lookup_by(mut self, lookup: impl Into<String>) -> Builder {\n@@ -207,11 +225,14 @@ impl Builder {\n         self.kind = Some(kind);\n         self\n     }\n-    #[allow(unused)]\n     pub(crate) fn text_edit(mut self, edit: TextEdit) -> Builder {\n         self.text_edit = Some(edit);\n         self\n     }\n+    pub(crate) fn snippet_edit(mut self, edit: TextEdit) -> Builder {\n+        self.insert_text_format = InsertTextFormat::Snippet;\n+        self.text_edit(edit)\n+    }\n     #[allow(unused)]\n     pub(crate) fn detail(self, detail: impl Into<String>) -> Builder {\n         self.set_detail(Some(detail))"}, {"sha": "e6e389fbd75aa8ee71a75a4c3e71ad64d38f889e", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__bindings_from_for.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_for.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_for.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_for.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.736783986Z\"\n+created: \"2019-02-18T09:10:52.089782502Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"quux\",\n         source_range: [83; 83),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"quux()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux()\",\n-        insert_text: \"quux()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux()\"\n     },\n     CompletionItem {\n         label: \"x\",\n         source_range: [83; 83),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"x\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     }\n ]"}, {"sha": "badaed8fe09deb9e1bd72f70e56c3d1c8e94d43f", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__bindings_from_if_let.snap", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.739513594Z\"\n+created: \"2019-02-18T09:10:52.092577354Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,19 +8,41 @@ expression: kind_completions\n     CompletionItem {\n         label: \"a\",\n         source_range: [214; 214),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [214; 214),\n+                    insert: \"a\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     },\n     CompletionItem {\n         label: \"b\",\n         source_range: [214; 214),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [214; 214),\n+                    insert: \"b\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     },\n     CompletionItem {\n         label: \"quux\",\n         source_range: [214; 214),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [214; 214),\n+                    insert: \"quux()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux()\",\n-        insert_text: \"quux()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux()\"\n     }\n ]"}, {"sha": "1b4cbf91e337fc3e8ad0010322f0928fbfdc2de8", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__bindings_from_let.snap", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.739513592Z\"\n+created: \"2019-02-18T09:10:52.090000719Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,19 +8,41 @@ expression: kind_completions\n     CompletionItem {\n         label: \"quux\",\n         source_range: [79; 79),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [79; 79),\n+                    insert: \"quux($0)\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux(x: i32)\",\n-        insert_text: \"quux($0)\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux(x: i32)\"\n     },\n     CompletionItem {\n         label: \"x\",\n         source_range: [79; 79),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [79; 79),\n+                    insert: \"x\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     },\n     CompletionItem {\n         label: \"y\",\n         source_range: [79; 79),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [79; 79),\n+                    insert: \"y\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     }\n ]"}, {"sha": "74f6fcd7702891bbbdb0430c086b6a9aea58871a", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__completes_break_and_continue_in_loops1.snap", "status": "modified", "additions": 64, "deletions": 22, "changes": 86, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops1.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.630948152Z\"\n+created: \"2019-02-18T09:10:51.974241301Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,50 +8,92 @@ expression: kind_completions\n     CompletionItem {\n         label: \"break\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"break;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"break;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"continue\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"continue;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"continue;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"if\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"return $0;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"return $0;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [55; 55),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [55; 55),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "225ca4c7f0933d789218aa48d982471e0019ac81", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__completes_break_and_continue_in_loops2.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_break_and_continue_in_loops2.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.662074625Z\"\n+created: \"2019-02-18T09:10:52.011157905Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [60; 60),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [60; 60),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [60; 60),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [60; 60),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [60; 60),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [60; 60),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [60; 60),\n-        kind: Keyword,\n-        insert_text: \"return $0;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [60; 60),\n+                    insert: \"return $0;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [60; 60),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [60; 60),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "58515b86f2fc2ae94a588843ee2c6d4eb1d0926a", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__completes_prelude.snap", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_prelude.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_prelude.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_prelude.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.774580359Z\"\n+created: \"2019-02-18T09:10:52.125606390Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,19 +8,41 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Option\",\n         source_range: [18; 18),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [18; 18),\n+                    insert: \"Option\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"foo\",\n         source_range: [18; 18),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [18; 18),\n+                    insert: \"foo()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn foo()\",\n-        insert_text: \"foo()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn foo()\"\n     },\n     CompletionItem {\n         label: \"std\",\n         source_range: [18; 18),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [18; 18),\n+                    insert: \"std\"\n+                }\n+            ]\n+        },\n         kind: Module\n     }\n ]"}, {"sha": "3b6ff57c187ea3417a96c3f38df02822898a9781", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__completes_use_paths_across_crates.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_use_paths_across_crates.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_use_paths_across_crates.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__completes_use_paths_across_crates.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.729954589Z\"\n+created: \"2019-02-18T09:10:52.081693428Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"bar\",\n         source_range: [9; 9),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [9; 9),\n+                    insert: \"bar\"\n+                }\n+            ]\n+        },\n         kind: Module\n     }\n ]"}, {"sha": "1fb15ee0d17d10fd43cb042a3d174f3e985e1de6", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__deeply_nested_use_tree.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__deeply_nested_use_tree.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__deeply_nested_use_tree.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__deeply_nested_use_tree.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.663233766Z\"\n+created: \"2019-02-18T09:10:52.018717911Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Spam\",\n         source_range: [23; 25),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [23; 25),\n+                    insert: \"Spam\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     }\n ]"}, {"sha": "34e75ef803cea40da4dd08bd39fde4c3e905ab68", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_add_semi_after_return_if_not_a_statement.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_add_semi_after_return_if_not_a_statement.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_add_semi_after_return_if_not_a_statement.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_add_semi_after_return_if_not_a_statement.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.637726929Z\"\n+created: \"2019-02-18T09:10:51.979744970Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [85; 85),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [85; 85),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [85; 85),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [85; 85),\n-        kind: Keyword,\n-        insert_text: \"return $0\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"return $0\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [85; 85),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "89ae3d405758bfdb997a9b9ed4c3d9ead9c2a67b", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_if_already_call.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.812347626Z\"\n+created: \"2019-02-18T09:10:52.163807552Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,12 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"frobnicate\",\n         source_range: [35; 39),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [35; 39),\n+                    insert: \"frobnicate\"\n+                }\n+            ]\n+        },\n         kind: Function,\n         detail: \"fn frobnicate()\"\n     },\n     CompletionItem {\n         label: \"main\",\n         source_range: [35; 39),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [35; 39),\n+                    insert: \"main\"\n+                }\n+            ]\n+        },\n         kind: Function,\n         detail: \"fn main()\"\n     }"}, {"sha": "ab4075c50108169456a173d8067ee85f0d842af2", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_if_already_call_assoc_fn.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.843178841Z\"\n+created: \"2019-02-18T09:10:52.194798097Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"new\",\n         source_range: [67; 69),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [67; 69),\n+                    insert: \"new\"\n+                }\n+            ]\n+        },\n         kind: Method,\n         detail: \"fn new() -> Foo\"\n     }"}, {"sha": "259f9fc6278cb0d08a4b09555f48444dfb55c4b7", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_render_function_parens_in_use_item.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_render_function_parens_in_use_item.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.808400485Z\"\n+created: \"2019-02-18T09:10:52.156083575Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"foo\",\n         source_range: [40; 41),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [40; 41),\n+                    insert: \"foo\"\n+                }\n+            ]\n+        },\n         kind: Function,\n         detail: \"pub fn foo()\"\n     }"}, {"sha": "7af2f3eb97a7f61301161680f786e450e0d739bf", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_show_both_completions_for_shadowing.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.810202671Z\"\n+created: \"2019-02-18T09:10:52.134207539Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"bar\",\n         source_range: [129; 129),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [129; 129),\n+                    insert: \"bar\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     },\n     CompletionItem {\n         label: \"foo\",\n         source_range: [129; 129),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [129; 129),\n+                    insert: \"foo()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn foo() ->\",\n-        insert_text: \"foo()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn foo() ->\"\n     }\n ]"}, {"sha": "7f36a5ec50bc2eb0e16d27e8cc2289700444f563", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__enum_variant.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.672144115Z\"\n+created: \"2019-02-18T09:10:52.033853029Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Bar\",\n         source_range: [116; 116),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [116; 116),\n+                    insert: \"Bar\"\n+                }\n+            ]\n+        },\n         kind: EnumVariant,\n         detail: \"(i32)\",\n         documentation: Documentation(\n@@ -17,6 +25,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Foo\",\n         source_range: [116; 116),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [116; 116),\n+                    insert: \"Foo\"\n+                }\n+            ]\n+        },\n         kind: EnumVariant,\n         detail: \"()\",\n         documentation: Documentation("}, {"sha": "0d2390eb2f263a68a18ced0ca0d6199c7765b6be", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__enum_variant_with_details.snap", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant_with_details.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant_with_details.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__enum_variant_with_details.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.686329490Z\"\n+created: \"2019-02-18T09:10:52.039179076Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Bar\",\n         source_range: [180; 180),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [180; 180),\n+                    insert: \"Bar\"\n+                }\n+            ]\n+        },\n         kind: EnumVariant,\n         detail: \"(i32, u32)\",\n         documentation: Documentation(\n@@ -17,6 +25,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Foo\",\n         source_range: [180; 180),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [180; 180),\n+                    insert: \"Foo\"\n+                }\n+            ]\n+        },\n         kind: EnumVariant,\n         detail: \"()\",\n         documentation: Documentation(\n@@ -26,6 +42,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"S\",\n         source_range: [180; 180),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [180; 180),\n+                    insert: \"S\"\n+                }\n+            ]\n+        },\n         kind: EnumVariant,\n         detail: \"(S)\"\n     }"}, {"sha": "249b51311d75cd5cf8a0f117e088277a9ee8e813", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__extern_prelude.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__extern_prelude.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__extern_prelude.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__extern_prelude.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.763042807Z\"\n+created: \"2019-02-18T09:10:52.097703010Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"other_crate\",\n         source_range: [4; 4),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [4; 4),\n+                    insert: \"other_crate\"\n+                }\n+            ]\n+        },\n         kind: Module\n     }\n ]"}, {"sha": "d73860e72f7a3ffcbc65145497a73aac27d3d397", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__generic_params.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.765665697Z\"\n+created: \"2019-02-18T09:10:52.113095718Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"T\",\n         source_range: [44; 44),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [44; 44),\n+                    insert: \"T\"\n+                }\n+            ]\n+        },\n         kind: TypeParam\n     },\n     CompletionItem {\n         label: \"quux\",\n         source_range: [44; 44),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [44; 44),\n+                    insert: \"quux()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux<T>()\",\n-        insert_text: \"quux()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux<T>()\"\n     }\n ]"}, {"sha": "b75350f0e257ec0a1e582a498c7aaef387251b65", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__generic_params_in_struct.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params_in_struct.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params_in_struct.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__generic_params_in_struct.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.768275744Z\"\n+created: \"2019-02-18T09:10:52.117910091Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,11 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"T\",\n         source_range: [46; 46),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [46; 46),\n+                    insert: \"T\"\n+                }\n+            ]\n+        },\n         kind: TypeParam\n     },\n     CompletionItem {\n         label: \"X\",\n         source_range: [46; 46),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [46; 46),\n+                    insert: \"X\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     }\n ]"}, {"sha": "9a42b6c12990930d5a9a5ceceab1c5aae4a0cf43", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls1.snap", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls1.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.808403924Z\"\n+created: \"2019-02-18T09:10:52.160884429Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,17 +8,29 @@ expression: kind_completions\n     CompletionItem {\n         label: \"main\",\n         source_range: [53; 56),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [53; 56),\n+                    insert: \"main()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn main()\",\n-        insert_text: \"main()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn main()\"\n     },\n     CompletionItem {\n         label: \"no_args\",\n         source_range: [53; 56),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [53; 56),\n+                    insert: \"no_args()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn no_args()\",\n-        insert_text: \"no_args()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn no_args()\"\n     }\n ]"}, {"sha": "5397a0bbe61653db613f145e9394ddf19598a787", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls2.snap", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls2.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.843178843Z\"\n+created: \"2019-02-18T09:10:52.192876554Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,17 +8,29 @@ expression: kind_completions\n     CompletionItem {\n         label: \"main\",\n         source_range: [72; 77),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [72; 77),\n+                    insert: \"main()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn main()\",\n-        insert_text: \"main()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn main()\"\n     },\n     CompletionItem {\n         label: \"with_args\",\n         source_range: [72; 77),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [72; 77),\n+                    insert: \"with_args($0)\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn with_args(x: i32, y: String)\",\n-        insert_text: \"with_args($0)\",\n-        insert_text_format: Snippet\n+        detail: \"fn with_args(x: i32, y: String)\"\n     }\n ]"}, {"sha": "97c128dcb823090964173b949d3c524c67060949", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__inserts_parens_for_function_calls3.snap", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__inserts_parens_for_function_calls3.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.877573951Z\"\n+created: \"2019-02-18T09:10:52.224275781Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,9 +8,15 @@ expression: kind_completions\n     CompletionItem {\n         label: \"foo\",\n         source_range: [139; 140),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [139; 140),\n+                    insert: \"foo()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n-        detail: \"fn foo(&self)\",\n-        insert_text: \"foo()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn foo(&self)\"\n     }\n ]"}, {"sha": "18f1aa84675a7ed1a55eeba3a99318d1aea7fcf8", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_function1.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function1.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.639066512Z\"\n+created: \"2019-02-18T09:10:51.982940400Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"return;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"return;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "07e673852776c036fb7a51080a5fc73920dea7e9", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_function2.snap", "status": "modified", "additions": 64, "deletions": 22, "changes": 86, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function2.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.630760038Z\"\n+created: \"2019-02-18T09:10:51.986894362Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,50 +8,92 @@ expression: kind_completions\n     CompletionItem {\n         label: \"else\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"else {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"else {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"else if\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"else if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"else if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"if\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"return;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"return;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [92; 92),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [92; 92),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "a31881175c05b53cb309803a95c7a8bf66ad5552", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_function3.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function3.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function3.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function3.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.659527166Z\"\n+created: \"2019-02-18T09:10:52.010821546Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [48; 48),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [48; 48),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [48; 48),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [48; 48),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [48; 48),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [48; 48),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [48; 48),\n-        kind: Keyword,\n-        insert_text: \"return $0;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [48; 48),\n+                    insert: \"return $0;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [48; 48),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [48; 48),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "8e66260f66eee6e93751e2b35c169e7a3ff70a92", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_function4.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function4.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function4.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_function4.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.696757543Z\"\n+created: \"2019-02-18T09:10:52.039207401Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"return;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"return;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [41; 41),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [41; 41),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "facd37bd93eec252da4c2fd77257e7ed7bbf641c", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_use_stmt1.snap", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt1.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.633925638Z\"\n+created: \"2019-02-18T09:10:51.979744931Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,20 +8,40 @@ expression: kind_completions\n     CompletionItem {\n         label: \"crate\",\n         source_range: [17; 17),\n-        kind: Keyword,\n-        insert_text: \"crate::\",\n-        insert_text_format: PlainText\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [17; 17),\n+                    insert: \"crate::\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"self\",\n         source_range: [17; 17),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [17; 17),\n+                    insert: \"self\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"super\",\n         source_range: [17; 17),\n-        kind: Keyword,\n-        insert_text: \"super::\",\n-        insert_text_format: PlainText\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [17; 17),\n+                    insert: \"super::\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "7a9792b0ec3af6a5ad129c7fc1da8347945be918", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_use_stmt2.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt2.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.658885169Z\"\n+created: \"2019-02-18T09:10:52.008665355Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,13 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"self\",\n         source_range: [20; 20),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [20; 20),\n+                    insert: \"self\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"super\",\n         source_range: [20; 20),\n-        kind: Keyword,\n-        insert_text: \"super::\",\n-        insert_text_format: PlainText\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [20; 20),\n+                    insert: \"super::\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "9f0731aa1ae5405d713a4655ff1a9dbc1e7b4eda", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__keywords_in_use_stmt3.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt3.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt3.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__keywords_in_use_stmt3.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.688856977Z\"\n+created: \"2019-02-18T09:10:52.032133616Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,13 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"self\",\n         source_range: [24; 24),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [24; 24),\n+                    insert: \"self\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"super\",\n         source_range: [24; 24),\n-        kind: Keyword,\n-        insert_text: \"super::\",\n-        insert_text_format: PlainText\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [24; 24),\n+                    insert: \"super::\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "7d90ef4f366c8ae6759c050794ac4b74d4226a20", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__last_return_in_block_has_semi1.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi1.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi1.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi1.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.638715790Z\"\n+created: \"2019-02-18T09:10:51.985317165Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"return $0;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"return $0;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "94e3a2dcb6e285df046c3725bedccf7ab49631ec", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__last_return_in_block_has_semi2.snap", "status": "modified", "additions": 46, "deletions": 16, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi2.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi2.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__last_return_in_block_has_semi2.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.661936290Z\"\n+created: \"2019-02-18T09:10:52.013549824Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,36 +8,66 @@ expression: kind_completions\n     CompletionItem {\n         label: \"if\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"return $0;\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"return $0;\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [83; 83),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [83; 83),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "9e4062641a0cac02350b06c82f774de89bcb2105", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__method_attr_filtering.snap", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_attr_filtering.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_attr_filtering.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_attr_filtering.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.598946710Z\"\n+created: \"2019-02-18T09:10:51.944926087Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,9 +8,15 @@ expression: kind_completions\n     CompletionItem {\n         label: \"the_method\",\n         source_range: [249; 249),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [249; 249),\n+                    insert: \"the_method()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n-        detail: \"fn the_method(&self)\",\n-        insert_text: \"the_method()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn the_method(&self)\"\n     }\n ]"}, {"sha": "f8b142b715ebc455c2ac0fe5c1fa0607912a0c31", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__method_completion.snap", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_completion.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_completion.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__method_completion.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.598948318Z\"\n+created: \"2019-02-18T09:10:51.944760801Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,9 +8,15 @@ expression: kind_completions\n     CompletionItem {\n         label: \"the_method\",\n         source_range: [144; 144),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [144; 144),\n+                    insert: \"the_method()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n-        detail: \"fn the_method(&self)\",\n-        insert_text: \"the_method()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn the_method(&self)\"\n     }\n ]"}, {"sha": "670803b6f0febaa5129cdccc1d3634ae583c58cf", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__mod_with_docs.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__mod_with_docs.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__mod_with_docs.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__mod_with_docs.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.682030298Z\"\n+created: \"2019-02-18T09:10:52.036530210Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"my\",\n         source_range: [23; 25),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [23; 25),\n+                    insert: \"my\"\n+                }\n+            ]\n+        },\n         kind: Module,\n         documentation: Documentation(\n             \"Some simple\\ndocs describing `mod my`.\""}, {"sha": "d082a9c2f9083dcbc0c6814927e8f930d868bd41", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__module_items.snap", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.770568686Z\"\n+created: \"2019-02-18T09:10:52.120932427Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,19 +8,41 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Baz\",\n         source_range: [89; 89),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [89; 89),\n+                    insert: \"Baz\"\n+                }\n+            ]\n+        },\n         kind: Enum\n     },\n     CompletionItem {\n         label: \"Foo\",\n         source_range: [89; 89),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [89; 89),\n+                    insert: \"Foo\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"quux\",\n         source_range: [89; 89),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [89; 89),\n+                    insert: \"quux()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux()\",\n-        insert_text: \"quux()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux()\"\n     }\n ]"}, {"sha": "daa3026fa7224a3762dc2b4e3a1b9a86a116d241", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__module_items_in_nested_modules.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items_in_nested_modules.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items_in_nested_modules.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__module_items_in_nested_modules.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.770992040Z\"\n+created: \"2019-02-18T09:10:52.120931050Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Bar\",\n         source_range: [101; 101),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [101; 101),\n+                    insert: \"Bar\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"quux\",\n         source_range: [101; 101),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [101; 101),\n+                    insert: \"quux()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn quux()\",\n-        insert_text: \"quux()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn quux()\"\n     }\n ]"}, {"sha": "0536d2cd52b60ac6da68b31af25bc51ca766e2a9", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__nested_use_tree.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__nested_use_tree.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__nested_use_tree.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__nested_use_tree.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.689653720Z\"\n+created: \"2019-02-18T09:10:52.039178133Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,11 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Spam\",\n         source_range: [12; 14),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [12; 14),\n+                    insert: \"Spam\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"foo\",\n         source_range: [12; 14),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [12; 14),\n+                    insert: \"foo\"\n+                }\n+            ]\n+        },\n         kind: Module\n     }\n ]"}, {"sha": "42f736d74c37cc5e945b3a9b73c88ff1e3ce2aa2", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__no_semi_after_break_continue_in_expr.snap", "status": "modified", "additions": 61, "deletions": 13, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__no_semi_after_break_continue_in_expr.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__no_semi_after_break_continue_in_expr.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__no_semi_after_break_continue_in_expr.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.641375216Z\"\n+created: \"2019-02-18T09:10:51.988658363Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,44 +8,92 @@ expression: kind_completions\n     CompletionItem {\n         label: \"break\",\n         source_range: [106; 108),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"break\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"continue\",\n         source_range: [106; 108),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"continue\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"if\",\n         source_range: [106; 108),\n-        kind: Keyword,\n-        insert_text: \"if $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"if $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"loop\",\n         source_range: [106; 108),\n-        kind: Keyword,\n-        insert_text: \"loop {$0}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"loop {$0}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [106; 108),\n-        kind: Keyword,\n-        insert_text: \"match $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"match $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     },\n     CompletionItem {\n         label: \"return\",\n         source_range: [106; 108),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"return\"\n+                }\n+            ]\n+        },\n         kind: Keyword\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [106; 108),\n-        kind: Keyword,\n-        insert_text: \"while $0 {}\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [106; 108),\n+                    insert: \"while $0 {}\"\n+                }\n+            ]\n+        },\n+        kind: Keyword\n     }\n ]"}, {"sha": "0c651f26ed97e2a4ae80f9be011b8f5d86770080", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_last_param.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_last_param.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.606265507Z\"\n+created: \"2019-02-18T09:10:51.951199574Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"file_id: FileId\",\n         source_range: [98; 102),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [98; 102),\n+                    insert: \"file_id: FileId\"\n+                }\n+            ]\n+        },\n         lookup: \"file_id\"\n     }\n ]"}, {"sha": "1064e28c5d9c134a759c6590a11969c284cd22f4", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_nth_param.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_nth_param.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.606265538Z\"\n+created: \"2019-02-18T09:10:51.951199556Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"file_id: FileId\",\n         source_range: [98; 102),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [98; 102),\n+                    insert: \"file_id: FileId\"\n+                }\n+            ]\n+        },\n         lookup: \"file_id\"\n     }\n ]"}, {"sha": "548c0c9ce7d7c9a67531f498f786769be28eca53", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__param_completion_trait_param.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__param_completion_trait_param.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.628419014Z\"\n+created: \"2019-02-18T09:10:51.973234775Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"file_id: FileId\",\n         source_range: [269; 273),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [269; 273),\n+                    insert: \"file_id: FileId\"\n+                }\n+            ]\n+        },\n         lookup: \"file_id\"\n     }\n ]"}, {"sha": "fcca19b771d2b12e86cc7c00dca0ea422a165ec3", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__postfix_completion_works_for_trivial_path_expression.snap", "status": "modified", "additions": 22, "deletions": 36, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__postfix_completion_works_for_trivial_path_expression.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__postfix_completion_works_for_trivial_path_expression.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__postfix_completion_works_for_trivial_path_expression.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.734401559Z\"\n+created: \"2019-02-18T09:10:52.087222569Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,106 +8,92 @@ expression: kind_completions\n     CompletionItem {\n         label: \"dbg\",\n         source_range: [76; 76),\n-        detail: \"dbg!(expr)\",\n-        insert_text: \"dbg!(bar)\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"dbg!(bar)\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"dbg!(expr)\"\n     },\n     CompletionItem {\n         label: \"if\",\n         source_range: [76; 76),\n-        detail: \"if expr {}\",\n-        insert_text: \"if bar {$0}\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"if bar {$0}\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"if expr {}\"\n     },\n     CompletionItem {\n         label: \"match\",\n         source_range: [76; 76),\n-        detail: \"match expr {}\",\n-        insert_text: \"match bar {\\n${1:_} => {$0\\\\},\\n}\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"match bar {\\n${1:_} => {$0\\\\},\\n}\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"match expr {}\"\n     },\n     CompletionItem {\n         label: \"not\",\n         source_range: [76; 76),\n-        detail: \"!expr\",\n-        insert_text: \"!bar\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"!bar\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"!expr\"\n     },\n     CompletionItem {\n         label: \"ref\",\n         source_range: [76; 76),\n-        detail: \"&expr\",\n-        insert_text: \"&bar\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"&bar\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"&expr\"\n     },\n     CompletionItem {\n         label: \"refm\",\n         source_range: [76; 76),\n-        detail: \"&mut expr\",\n-        insert_text: \"&mut bar\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"&mut bar\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"&mut expr\"\n     },\n     CompletionItem {\n         label: \"while\",\n         source_range: [76; 76),\n-        detail: \"while expr {}\",\n-        insert_text: \"while bar {\\n$0\\n}\",\n-        insert_text_format: Snippet,\n         text_edit: TextEdit {\n             atoms: [\n                 AtomTextEdit {\n                     delete: [72; 76),\n-                    insert: \"\"\n+                    insert: \"while bar {\\n$0\\n}\"\n                 }\n             ]\n-        }\n+        },\n+        detail: \"while expr {}\"\n     }\n ]"}, {"sha": "954d1b4bcf9267787a9e1c50e752b2ef8a7c31e9", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__return_type.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__return_type.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__return_type.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__return_type.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.780512486Z\"\n+created: \"2019-02-18T09:10:52.125606324Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Foo\",\n         source_range: [47; 47),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [47; 47),\n+                    insert: \"Foo\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"x\",\n         source_range: [47; 47),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [47; 47),\n+                    insert: \"x()$0\"\n+                }\n+            ]\n+        },\n         kind: Function,\n-        detail: \"fn x() ->\",\n-        insert_text: \"x()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn x() ->\"\n     }\n ]"}, {"sha": "3a88b7fbc9d94f4567ae4addea54f760538d0afc", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__self_in_methods.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.774705610Z\"\n+created: \"2019-02-18T09:10:52.129525933Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,11 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Self\",\n         source_range: [25; 25),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [25; 25),\n+                    insert: \"Self\"\n+                }\n+            ]\n+        },\n         kind: TypeParam\n     },\n     CompletionItem {\n         label: \"self\",\n         source_range: [25; 25),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [25; 25),\n+                    insert: \"self\"\n+                }\n+            ]\n+        },\n         kind: Binding\n     }\n ]"}, {"sha": "9bd6fe91df7995f6bbf5fbca50b61629cd2a8505", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__snippets_in_expressions.snap", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_expressions.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.799497268Z\"\n+created: \"2019-02-18T09:10:52.156085697Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,15 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"pd\",\n         source_range: [17; 17),\n-        kind: Snippet,\n-        insert_text: \"eprintln!(\\\"$0 = {:?}\\\", $0);\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [17; 17),\n+                    insert: \"eprintln!(\\\"$0 = {:?}\\\", $0);\"\n+                }\n+            ]\n+        },\n+        kind: Snippet\n     },\n     CompletionItem {\n         label: \"ppd\",\n         source_range: [17; 17),\n-        kind: Snippet,\n-        insert_text: \"eprintln!(\\\"$0 = {:#?}\\\", $0);\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [17; 17),\n+                    insert: \"eprintln!(\\\"$0 = {:#?}\\\", $0);\"\n+                }\n+            ]\n+        },\n+        kind: Snippet\n     }\n ]"}, {"sha": "486b353effb907b3e884d3dc5acd77e6f18845e8", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__snippets_in_items.snap", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__snippets_in_items.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.800831987Z\"\n+created: \"2019-02-18T09:10:52.152402422Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,16 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Test function\",\n         source_range: [66; 66),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [66; 66),\n+                    insert: \"#[test]\\nfn ${1:feature}() {\\n    $0\\n}\"\n+                }\n+            ]\n+        },\n         kind: Snippet,\n-        lookup: \"tfn\",\n-        insert_text: \"#[test]\\nfn ${1:feature}() {\\n    $0\\n}\",\n-        insert_text_format: Snippet\n+        lookup: \"tfn\"\n     },\n     CompletionItem {\n         label: \"pub(crate)\",\n         source_range: [66; 66),\n-        kind: Snippet,\n-        insert_text: \"pub(crate) $0\",\n-        insert_text_format: Snippet\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [66; 66),\n+                    insert: \"pub(crate) $0\"\n+                }\n+            ]\n+        },\n+        kind: Snippet\n     }\n ]"}, {"sha": "b34f6f26f163a82aa806fd3412efd85ff9a59b8b", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_associated_const.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_const.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_const.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_const.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.704544613Z\"\n+created: \"2019-02-18T09:10:52.050659483Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"C\",\n         source_range: [107; 107),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [107; 107),\n+                    insert: \"C\"\n+                }\n+            ]\n+        },\n         kind: Const,\n         detail: \"const C: i32 = 42;\",\n         documentation: Documentation("}, {"sha": "f6c95074a92d186ec5efa46b77b558a615e603d6", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_associated_method.snap", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_method.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_method.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_method.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.704544615Z\"\n+created: \"2019-02-18T09:10:52.050659480Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,12 +8,18 @@ expression: kind_completions\n     CompletionItem {\n         label: \"m\",\n         source_range: [100; 100),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [100; 100),\n+                    insert: \"m()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n         detail: \"fn m()\",\n         documentation: Documentation(\n             \"An associated method\"\n-        ),\n-        insert_text: \"m()$0\",\n-        insert_text_format: Snippet\n+        )\n     }\n ]"}, {"sha": "79168702c7e65ef152b5c7b7a4b037cdb9b23403", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_associated_type.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_type.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_type.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_associated_type.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.725668999Z\"\n+created: \"2019-02-18T09:10:52.066746177Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"T\",\n         source_range: [101; 101),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [101; 101),\n+                    insert: \"T\"\n+                }\n+            ]\n+        },\n         kind: TypeAlias,\n         detail: \"type T = i32;\",\n         documentation: Documentation("}, {"sha": "f22bbd987bf92832f2a8e2e81343e4ce7065abba", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_field_completion.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.599230647Z\"\n+created: \"2019-02-18T09:10:51.944776686Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"the_field\",\n         source_range: [85; 85),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [85; 85),\n+                    insert: \"the_field\"\n+                }\n+            ]\n+        },\n         kind: Field,\n         detail: \"u32\"\n     }"}, {"sha": "8b53d5e952e51d4e15fee45fbfe9bb2075072a7c", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_field_completion_autoderef.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_autoderef.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_autoderef.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_autoderef.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.598966298Z\"\n+created: \"2019-02-18T09:10:51.944780241Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"foo\",\n         source_range: [126; 126),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [126; 126),\n+                    insert: \"foo()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n-        detail: \"fn foo(&self)\",\n-        insert_text: \"foo()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn foo(&self)\"\n     },\n     CompletionItem {\n         label: \"the_field\",\n         source_range: [126; 126),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [126; 126),\n+                    insert: \"the_field\"\n+                }\n+            ]\n+        },\n         kind: Field,\n         detail: \"(u32, i32)\"\n     }"}, {"sha": "f20e4dcab8781719595a734224e1006c5f4f767a", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__struct_field_completion_self.snap", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__struct_field_completion_self.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.598965593Z\"\n+created: \"2019-02-18T09:10:51.944941588Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,14 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"foo\",\n         source_range: [187; 187),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [187; 187),\n+                    insert: \"foo()$0\"\n+                }\n+            ]\n+        },\n         kind: Method,\n-        detail: \"fn foo(self)\",\n-        insert_text: \"foo()$0\",\n-        insert_text_format: Snippet\n+        detail: \"fn foo(self)\"\n     },\n     CompletionItem {\n         label: \"the_field\",\n         source_range: [187; 187),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [187; 187),\n+                    insert: \"the_field\"\n+                }\n+            ]\n+        },\n         kind: Field,\n         detail: \"(u32,)\",\n         documentation: Documentation("}, {"sha": "b1ebac40b383775023acf32fec16fe2ed9a6d789", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__tuple_field_completion.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__tuple_field_completion.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__tuple_field_completion.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__tuple_field_completion.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.598973382Z\"\n+created: \"2019-02-18T09:10:51.944941196Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,12 +8,28 @@ expression: kind_completions\n     CompletionItem {\n         label: \"0\",\n         source_range: [75; 75),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [75; 75),\n+                    insert: \"0\"\n+                }\n+            ]\n+        },\n         kind: Field,\n         detail: \"i32\"\n     },\n     CompletionItem {\n         label: \"1\",\n         source_range: [75; 75),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [75; 75),\n+                    insert: \"1\"\n+                }\n+            ]\n+        },\n         kind: Field,\n         detail: \"f64\"\n     }"}, {"sha": "30a67db61956bf303ff878b412e3dbdeb4f304e7", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__use_item_starting_with_crate.snap", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_crate.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_crate.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_crate.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.726365989Z\"\n+created: \"2019-02-18T09:10:52.063155992Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,11 +8,27 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Spam\",\n         source_range: [11; 13),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [11; 13),\n+                    insert: \"Spam\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     },\n     CompletionItem {\n         label: \"foo\",\n         source_range: [11; 13),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [11; 13),\n+                    insert: \"foo\"\n+                }\n+            ]\n+        },\n         kind: Module\n     }\n ]"}, {"sha": "a8257ef12605bf68082a657e4862bd5a60fae453", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__use_item_starting_with_self.snap", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_self.snap", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_self.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__use_item_starting_with_self.snap?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-02-18T07:29:59.731789946Z\"\n+created: \"2019-02-18T09:10:52.075119580Z\"\n creator: insta@0.6.2\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -8,6 +8,14 @@ expression: kind_completions\n     CompletionItem {\n         label: \"Bar\",\n         source_range: [26; 26),\n+        text_edit: TextEdit {\n+            atoms: [\n+                AtomTextEdit {\n+                    delete: [26; 26),\n+                    insert: \"Bar\"\n+                }\n+            ]\n+        },\n         kind: Struct\n     }\n ]"}, {"sha": "f0f67b6636137f7303a62f207f5af57058ec1ed2", "filename": "crates/ra_lsp_server/src/conv.rs", "status": "modified", "additions": 26, "deletions": 6, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92aa0f9c871a9308ea3db1b1c4b7e42d88348e30/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fconv.rs?ref=92aa0f9c871a9308ea3db1b1c4b7e42d88348e30", "patch": "@@ -79,19 +79,39 @@ impl ConvWith for CompletionItem {\n     type Ctx = LineIndex;\n     type Output = ::lsp_types::CompletionItem;\n \n-    fn conv_with(mut self, ctx: &LineIndex) -> ::lsp_types::CompletionItem {\n-        let atom_text_edit = AtomTextEdit::replace(self.source_range(), self.insert_text());\n-        let text_edit = (&atom_text_edit).conv_with(ctx);\n-        let additional_text_edits =\n-            if let Some(edit) = self.take_text_edit() { Some(edit.conv_with(ctx)) } else { None };\n+    fn conv_with(self, ctx: &LineIndex) -> ::lsp_types::CompletionItem {\n+        let mut additional_text_edits = Vec::new();\n+        let mut text_edit = None;\n+        // LSP does not allow arbitrary edits in completion, so we have to do a\n+        // non-trivial mapping here.\n+        for atom_edit in self.text_edit().as_atoms() {\n+            if self.source_range().is_subrange(&atom_edit.delete) {\n+                text_edit = Some(if atom_edit.delete == self.source_range() {\n+                    atom_edit.conv_with(ctx)\n+                } else {\n+                    assert!(self.source_range().end() == atom_edit.delete.end());\n+                    let range1 =\n+                        TextRange::from_to(atom_edit.delete.start(), self.source_range().start());\n+                    let range2 = self.source_range();\n+                    let edit1 = AtomTextEdit::replace(range1, String::new());\n+                    let edit2 = AtomTextEdit::replace(range2, atom_edit.insert.clone());\n+                    additional_text_edits.push(edit1.conv_with(ctx));\n+                    edit2.conv_with(ctx)\n+                })\n+            } else {\n+                assert!(self.source_range().intersection(&atom_edit.delete).is_none());\n+                additional_text_edits.push(atom_edit.conv_with(ctx));\n+            }\n+        }\n+        let text_edit = text_edit.unwrap();\n \n         let mut res = lsp_types::CompletionItem {\n             label: self.label().to_string(),\n             detail: self.detail().map(|it| it.to_string()),\n             filter_text: Some(self.lookup().to_string()),\n             kind: self.kind().map(|it| it.conv()),\n             text_edit: Some(text_edit),\n-            additional_text_edits,\n+            additional_text_edits: Some(additional_text_edits),\n             documentation: self.documentation().map(|it| it.conv()),\n             ..Default::default()\n         };"}]}