{"sha": "6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "node_id": "C_kwDOAAsO6NoAKDZjOTFjZTI3YzM2MzliM2I0YjRiNGMwMzhkYzUzNWMwMmRjOWRmYmQ", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-08T20:24:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-08T20:24:50Z"}, "message": "Rollup merge of #108686 - notriddle:notriddle/jank-all, r=jsha\n\nrustdoc: include link on all.html location header\n\nThis avoids a subtle layout shift when switching from the crate page to all items.\n\n## Before\n\n| index.html | all.html |\n|------------|----------|\n| ![image](https://user-images.githubusercontent.com/1593513/222607866-4eac3f55-314c-4273-9664-503f2a79ad0a.png) | ![image](https://user-images.githubusercontent.com/1593513/222607895-2d6bac3b-f66a-47d4-b234-360f6f8e1ee3.png) |\n\n## After\n\n| index.html | all.html |\n|------------|----------|\n| ![image](https://user-images.githubusercontent.com/1593513/222607866-4eac3f55-314c-4273-9664-503f2a79ad0a.png) | ![image](https://user-images.githubusercontent.com/1593513/222607997-e72c48a0-02c7-42a7-80c2-cd6bed48bd15.png) |", "tree": {"sha": "a445fbaac22905f22871fb97ce9cf01358f6e50d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a445fbaac22905f22871fb97ce9cf01358f6e50d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkCO8SCRBK7hj4Ov3rIwAANWMIAEcoeqjNH9X7E9OAY5+X7Xj5\nK+cst62QXlMNENr7FlA86OZE+/O+oON017ZS89Ic60U5vC8623A9VmddI6DVnHGp\nYhA75LQnsyFxj1IkfGdwVO9+KkI3yAg8tNwD8rxt7NKkPXBlEAcSXhinsaFjembA\nxNp5kFEv0QvHMghYUhElH527gapN/U8e2iim9aU4HjqfhsiNkN9n201Rw6FJ/OdL\nrKi3VvrA3DKs8mlVtCXL9sd/mG9uK334eX7lAEDQnvFA+86pbSnnWh0bnTIrwCoe\niURzHM7HQ2wLtJX42CT9UqWcPda+o55wgySpDykdefBojVtXi6wLsqUQU/U7qJY=\n=eOf0\n-----END PGP SIGNATURE-----\n", "payload": "tree a445fbaac22905f22871fb97ce9cf01358f6e50d\nparent 7c306f6dcd600b1fcc74439c780e8ebef338d84c\nparent af664be4230d4052df32e7821a4a85ae9d13a474\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1678307090 +0100\ncommitter GitHub <noreply@github.com> 1678307090 +0100\n\nRollup merge of #108686 - notriddle:notriddle/jank-all, r=jsha\n\nrustdoc: include link on all.html location header\n\nThis avoids a subtle layout shift when switching from the crate page to all items.\n\n## Before\n\n| index.html | all.html |\n|------------|----------|\n| ![image](https://user-images.githubusercontent.com/1593513/222607866-4eac3f55-314c-4273-9664-503f2a79ad0a.png) | ![image](https://user-images.githubusercontent.com/1593513/222607895-2d6bac3b-f66a-47d4-b234-360f6f8e1ee3.png) |\n\n## After\n\n| index.html | all.html |\n|------------|----------|\n| ![image](https://user-images.githubusercontent.com/1593513/222607866-4eac3f55-314c-4273-9664-503f2a79ad0a.png) | ![image](https://user-images.githubusercontent.com/1593513/222607997-e72c48a0-02c7-42a7-80c2-cd6bed48bd15.png) |\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "html_url": "https://github.com/rust-lang/rust/commit/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c306f6dcd600b1fcc74439c780e8ebef338d84c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c306f6dcd600b1fcc74439c780e8ebef338d84c", "html_url": "https://github.com/rust-lang/rust/commit/7c306f6dcd600b1fcc74439c780e8ebef338d84c"}, {"sha": "af664be4230d4052df32e7821a4a85ae9d13a474", "url": "https://api.github.com/repos/rust-lang/rust/commits/af664be4230d4052df32e7821a4a85ae9d13a474", "html_url": "https://github.com/rust-lang/rust/commit/af664be4230d4052df32e7821a4a85ae9d13a474"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "1030fe747475856f9fa6f8b1084ba388773571e1", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "patch": "@@ -600,9 +600,7 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n         };\n         let all = shared.all.replace(AllTypes::new());\n         let mut sidebar = Buffer::html();\n-        if shared.cache.crate_version.is_some() {\n-            write!(sidebar, \"<h2 class=\\\"location\\\">Crate {}</h2>\", crate_name)\n-        };\n+        write!(sidebar, \"<h2 class=\\\"location\\\"><a href=\\\"#\\\">Crate {}</a></h2>\", crate_name);\n \n         let mut items = Buffer::html();\n         sidebar_module_like(&mut items, all.item_sections());"}, {"sha": "473ab8fc960c560e8a75034f8aebf0057c89ce2e", "filename": "tests/rustdoc-gui/sidebar.goml", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd/tests%2Frustdoc-gui%2Fsidebar.goml", "raw_url": "https://github.com/rust-lang/rust/raw/6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd/tests%2Frustdoc-gui%2Fsidebar.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Fsidebar.goml?ref=6c91ce27c3639b3b4b4b4c038dc535c02dc9dfbd", "patch": "@@ -149,3 +149,17 @@ assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n click: \"#toggle-all-docs\"\n assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n+\n+// Checks that all.html and index.html have their sidebar link in the same place.\n+goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n+store-property: (index_sidebar_width, \".sidebar .location a\", \"clientWidth\")\n+store-property: (index_sidebar_height, \".sidebar .location a\", \"clientHeight\")\n+store-property: (index_sidebar_x, \".sidebar .location a\", \"offsetTop\")\n+store-property: (index_sidebar_y, \".sidebar .location a\", \"offsetLeft\")\n+goto: \"file://\" + |DOC_PATH| + \"/test_docs/all.html\"\n+assert-property: (\".sidebar .location a\", {\n+    \"clientWidth\": |index_sidebar_width|,\n+    \"clientHeight\": |index_sidebar_height|,\n+    \"offsetTop\": |index_sidebar_x|,\n+    \"offsetLeft\": |index_sidebar_y|,\n+})"}]}