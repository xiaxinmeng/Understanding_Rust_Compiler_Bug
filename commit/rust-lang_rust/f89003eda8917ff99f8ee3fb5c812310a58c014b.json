{"sha": "f89003eda8917ff99f8ee3fb5c812310a58c014b", "node_id": "C_kwDOAAsO6NoAKGY4OTAwM2VkYTg5MTdmZjk5ZjhlZTNmYjVjODEyMzEwYTU4YzAxNGI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-02T10:21:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-02T10:21:53Z"}, "message": "Auto merge of #106301 - notriddle:notriddle/dir-entry, r=GuillaumeGomez\n\nrustdoc: use the regular arrow indicator for dir-entry CSS\n\nThis mostly reverts 468acca108e65101b802821bded17149dc1d86c9, while still fixing the problem it fixed by using an internal list-style-position. It results in a slight change in the hover indicator, but nothing misleading.\n\nPreview: http://notriddle.com/notriddle-rustdoc-demos/dir-entry/src/std/lib.rs.html\n\n## Before\n\n![image](https://user-images.githubusercontent.com/1593513/210104247-642e6df0-07d3-452a-a2ab-4c700bc22e0e.png)\n\n## After\n\n![image](https://user-images.githubusercontent.com/1593513/210104271-a3832784-1e4d-4516-983e-6ecb9051857b.png)", "tree": {"sha": "4db143a6d6c509c1de4f8ebb92a74ede8782b112", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4db143a6d6c509c1de4f8ebb92a74ede8782b112"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f89003eda8917ff99f8ee3fb5c812310a58c014b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f89003eda8917ff99f8ee3fb5c812310a58c014b", "html_url": "https://github.com/rust-lang/rust/commit/f89003eda8917ff99f8ee3fb5c812310a58c014b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f89003eda8917ff99f8ee3fb5c812310a58c014b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5a7ddd99f5e43116ec452777f08fddbde7f42fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5a7ddd99f5e43116ec452777f08fddbde7f42fd", "html_url": "https://github.com/rust-lang/rust/commit/d5a7ddd99f5e43116ec452777f08fddbde7f42fd"}, {"sha": "399fe5d0cd93f7b78e6464111546788c43ba1f61", "url": "https://api.github.com/repos/rust-lang/rust/commits/399fe5d0cd93f7b78e6464111546788c43ba1f61", "html_url": "https://github.com/rust-lang/rust/commit/399fe5d0cd93f7b78e6464111546788c43ba1f61"}], "stats": {"total": 114, "additions": 87, "deletions": 27}, "files": [{"sha": "bc0458bcd28f2c3687efefd32f18fcd3f7f1db23", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 2, "deletions": 23, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/f89003eda8917ff99f8ee3fb5c812310a58c014b/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/f89003eda8917ff99f8ee3fb5c812310a58c014b/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=f89003eda8917ff99f8ee3fb5c812310a58c014b", "patch": "@@ -1387,31 +1387,10 @@ details.dir-entry {\n \tpadding-left: 4px;\n }\n \n-details.dir-entry > summary::after {\n-\tcontent: \" \u25ba\";\n-\tposition: absolute;\n-\tleft: -15px;\n-\ttop: 0px;\n-\tfont-size: 80%;\n-\tpadding: 2px 0px;\n-\t/* set width to cover gap between arrow and text */\n-\twidth: 25px;\n-}\n-\n-details[open].dir-entry > summary::after {\n-\tcontent: \" \u25bc\";\n-}\n-\n-details.dir-entry > summary::-webkit-details-marker,\n-details.dir-entry > summary::marker {\n-\tdisplay: none;\n-}\n-\n details.dir-entry > summary {\n-\tmargin: 0 0 0 13px;\n-\tlist-style: none;\n+\tmargin: 0 0 0 -4px;\n+\tpadding: 0 0 0 4px;\n \tcursor: pointer;\n-\tposition: relative;\n }\n \n details.dir-entry div.folders, details.dir-entry div.files {"}, {"sha": "aa79219696020726ead0c3ed38077cf6ebc3aa6e", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 85, "deletions": 4, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/f89003eda8917ff99f8ee3fb5c812310a58c014b/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/f89003eda8917ff99f8ee3fb5c812310a58c014b/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=f89003eda8917ff99f8ee3fb5c812310a58c014b", "patch": "@@ -111,8 +111,57 @@ assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"true\"})\n click: \"#source-sidebar details:first-of-type > summary\"\n assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"false\"})\n \n-// Check the spacing.\n-assert-css: (\"#source-sidebar > details.dir-entry\", {\"padding-left\": \"4px\"})\n+// And open it again, since it'll be the reference we use to check positions.\n+click: \"#source-sidebar details:first-of-type > summary\"\n+assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"true\"})\n+\n+// Check the sidebar directory entries have a marker and spacing (desktop).\n+store-property: (\n+    link_height,\n+    \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+    \"offsetHeight\"\n+)\n+define-function: (\n+    \"check-sidebar-dir-entry\",\n+    (x, y),\n+    [\n+        (\"assert\", \"details:first-of-type.dir-entry[open] > summary::marker\"),\n+        (\"assert-css\", (\"#source-sidebar > details:first-of-type.dir-entry\", {\"padding-left\": \"4px\"})),\n+        // This check ensures that the summary is only one line.\n+       (\"assert-property\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > summary\",\n+            {\"offsetHeight\": |link_height|}\n+        )),\n+        (\"assert-position\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > summary\",\n+            {\"x\": |x|, \"y\": |y|}\n+        )),\n+        (\"assert-property\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+            {\"offsetHeight\": |link_height|}\n+        )),\n+        (\"assert-position\", (\n+            \"#source-sidebar > details:first-of-type.dir-entry[open] > .files > a\",\n+            // left margin\n+            {\"x\": |x| + 27, \"y\": |y| + |link_height|}\n+        )),\n+    ]\n+)\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    // border + margin = 6\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})\n \n // Check the search form\n assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n@@ -125,13 +174,45 @@ assert-property: (\"nav.sub form\", {\"offsetTop\": 28, \"offsetHeight\": 34})\n assert-property: (\"#main-content\", {\"offsetTop\": 90})\n // 28 = 90 - 34 - 28\n \n-// Now do the same check on moderately-sized mobile.\n+// Now do the same check on moderately-sized, tablet mobile.\n size: (700, 700)\n assert-css: (\"nav.sub\", {\"flex-direction\": \"row\"})\n assert-property: (\"nav.sub form\", {\"offsetTop\": 21, \"offsetHeight\": 34})\n assert-property: (\"#main-content\", {\"offsetTop\": 76})\n // 21 = 76 - 34 - 21\n \n-// Tiny mobile gets a different display where the logo is stacked on top.\n+// Check the sidebar directory entries have a marker and spacing (tablet).\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})\n+\n+// Tiny, phone mobile gets a different display where the logo is stacked on top.\n size: (450, 700)\n assert-css: (\"nav.sub\", {\"flex-direction\": \"column\"})\n+\n+// Check the sidebar directory entries have a marker and spacing (phone).\n+store-property: (\n+    source_sidebar_title_height,\n+    \"#source-sidebar > .title\",\n+    \"offsetHeight\"\n+)\n+store-property: (\n+    source_sidebar_title_y,\n+    \"#source-sidebar > .title\",\n+    \"offsetTop\"\n+)\n+call-function: (\"check-sidebar-dir-entry\", {\n+    \"x\": 0,\n+    \"y\": |source_sidebar_title_y| + |source_sidebar_title_height| + 6,\n+})"}]}