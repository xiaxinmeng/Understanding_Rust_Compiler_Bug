{"sha": "aa20d96c31fed2dad509391109545d8ebba824c7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhMjBkOTZjMzFmZWQyZGFkNTA5MzkxMTA5NTQ1ZDhlYmJhODI0Yzc=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-03-17T14:08:11Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-03-17T17:29:20Z"}, "message": "Don't prepend with space before paren", "tree": {"sha": "9f815344017af45a22edad738c15aafe0949bd2d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f815344017af45a22edad738c15aafe0949bd2d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa20d96c31fed2dad509391109545d8ebba824c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa20d96c31fed2dad509391109545d8ebba824c7", "html_url": "https://github.com/rust-lang/rust/commit/aa20d96c31fed2dad509391109545d8ebba824c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa20d96c31fed2dad509391109545d8ebba824c7/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59f4ba95045e91a63e921e0d736242d7e1ffabec", "url": "https://api.github.com/repos/rust-lang/rust/commits/59f4ba95045e91a63e921e0d736242d7e1ffabec", "html_url": "https://github.com/rust-lang/rust/commit/59f4ba95045e91a63e921e0d736242d7e1ffabec"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "bb73e982a9c28aa098bfaf993f6797a3deb8428e", "filename": "src/librustc_ast_pretty/pprust.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/aa20d96c31fed2dad509391109545d8ebba824c7/src%2Flibrustc_ast_pretty%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa20d96c31fed2dad509391109545d8ebba824c7/src%2Flibrustc_ast_pretty%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast_pretty%2Fpprust.rs?ref=aa20d96c31fed2dad509391109545d8ebba824c7", "patch": "@@ -148,12 +148,19 @@ pub fn to_string(f: impl FnOnce(&mut State<'_>)) -> String {\n \n // This makes comma-separated lists look slightly nicer,\n // and also addresses a specific regression described in issue #63896.\n-fn tt_prepend_space(tt: &TokenTree) -> bool {\n+fn tt_prepend_space(tt: &TokenTree, prev: &TokenTree) -> bool {\n     match tt {\n         TokenTree::Token(token) => match token.kind {\n             token::Comma => false,\n             _ => true,\n         },\n+        TokenTree::Delimited(_, DelimToken::Paren, _) => match prev {\n+            TokenTree::Token(token) => match token.kind {\n+                token::Ident(_, _) => false,\n+                _ => true,\n+            },\n+            _ => true,\n+        },\n         _ => true,\n     }\n }\n@@ -650,11 +657,14 @@ pub trait PrintState<'a>: std::ops::Deref<Target = pp::Printer> + std::ops::Dere\n     }\n \n     fn print_tts(&mut self, tts: tokenstream::TokenStream, convert_dollar_crate: bool) {\n-        for (i, tt) in tts.into_trees().enumerate() {\n-            if i != 0 && tt_prepend_space(&tt) {\n+        let mut iter = tts.into_trees().peekable();\n+        while let Some(tt) = iter.next() {\n+            let show_space =\n+                if let Some(next) = iter.peek() { tt_prepend_space(next, &tt) } else { false };\n+            self.print_tt(tt, convert_dollar_crate);\n+            if show_space {\n                 self.space();\n             }\n-            self.print_tt(tt, convert_dollar_crate);\n         }\n     }\n "}]}