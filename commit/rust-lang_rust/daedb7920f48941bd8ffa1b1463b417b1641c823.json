{"sha": "daedb7920f48941bd8ffa1b1463b417b1641c823", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhZWRiNzkyMGY0ODk0MWJkOGZmYTFiMTQ2M2I0MTdiMTY0MWM4MjM=", "commit": {"author": {"name": "Raoul Strackx", "email": "raoul.strackx@fortanix.com", "date": "2020-06-17T16:07:12Z"}, "committer": {"name": "Raoul Strackx", "email": "raoul.strackx@fortanix.com", "date": "2020-06-18T10:11:39Z"}, "message": "Prevent attacker from manipulating FPU tag word used in SGX enclave\n\nInsufficient sanitization of the x87 FPU tag word in the trusted enclave runtime allowed unprivileged adversaries in the containing host application to induce incoherent or unexpected results for ABI-compliant compiled enclave application code that uses the x87 FPU.\n\nVulnerability was disclosed to us by Fritz Alder, Jo Van Bulck, David Oswald and Frank Piessens", "tree": {"sha": "a7e3319a001b114e67fba0148eacd5ea671886e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7e3319a001b114e67fba0148eacd5ea671886e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/daedb7920f48941bd8ffa1b1463b417b1641c823", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/daedb7920f48941bd8ffa1b1463b417b1641c823", "html_url": "https://github.com/rust-lang/rust/commit/daedb7920f48941bd8ffa1b1463b417b1641c823", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/daedb7920f48941bd8ffa1b1463b417b1641c823/comments", "author": {"login": "raoulstrackx", "id": 56830709, "node_id": "MDQ6VXNlcjU2ODMwNzA5", "avatar_url": "https://avatars.githubusercontent.com/u/56830709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raoulstrackx", "html_url": "https://github.com/raoulstrackx", "followers_url": "https://api.github.com/users/raoulstrackx/followers", "following_url": "https://api.github.com/users/raoulstrackx/following{/other_user}", "gists_url": "https://api.github.com/users/raoulstrackx/gists{/gist_id}", "starred_url": "https://api.github.com/users/raoulstrackx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raoulstrackx/subscriptions", "organizations_url": "https://api.github.com/users/raoulstrackx/orgs", "repos_url": "https://api.github.com/users/raoulstrackx/repos", "events_url": "https://api.github.com/users/raoulstrackx/events{/privacy}", "received_events_url": "https://api.github.com/users/raoulstrackx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "raoulstrackx", "id": 56830709, "node_id": "MDQ6VXNlcjU2ODMwNzA5", "avatar_url": "https://avatars.githubusercontent.com/u/56830709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raoulstrackx", "html_url": "https://github.com/raoulstrackx", "followers_url": "https://api.github.com/users/raoulstrackx/followers", "following_url": "https://api.github.com/users/raoulstrackx/following{/other_user}", "gists_url": "https://api.github.com/users/raoulstrackx/gists{/gist_id}", "starred_url": "https://api.github.com/users/raoulstrackx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raoulstrackx/subscriptions", "organizations_url": "https://api.github.com/users/raoulstrackx/orgs", "repos_url": "https://api.github.com/users/raoulstrackx/repos", "events_url": "https://api.github.com/users/raoulstrackx/events{/privacy}", "received_events_url": "https://api.github.com/users/raoulstrackx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e55d3f9c5213fe1a25366450127bdff67ad1eca2", "url": "https://api.github.com/repos/rust-lang/rust/commits/e55d3f9c5213fe1a25366450127bdff67ad1eca2", "html_url": "https://github.com/rust-lang/rust/commit/e55d3f9c5213fe1a25366450127bdff67ad1eca2"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "0c3afa77a60f3155015d34e237f1abc125f7c1d8", "filename": "src/libstd/sys/sgx/abi/entry.S", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/daedb7920f48941bd8ffa1b1463b417b1641c823/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fentry.S", "raw_url": "https://github.com/rust-lang/rust/raw/daedb7920f48941bd8ffa1b1463b417b1641c823/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fentry.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fentry.S?ref=daedb7920f48941bd8ffa1b1463b417b1641c823", "patch": "@@ -177,6 +177,13 @@ sgx_entry:\n     jz .Lskip_debug_init\n     mov %r10,%gs:tcsls_debug_panic_buf_ptr\n .Lskip_debug_init:\n+/*  reset cpu state */\n+    mov %rdx, %r10\n+    mov $-1, %rax\n+    mov $-1, %rdx\n+    xrstor .Lxsave_clear(%rip)\n+    mov %r10, %rdx\n+\n /*  check if returning from usercall */\n     mov %gs:tcsls_last_rsp,%r11\n     test %r11,%r11"}]}