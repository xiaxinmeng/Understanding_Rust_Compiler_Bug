{"sha": "3b42ddae601fbd73f672e82028e04c3abdf1252d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiNDJkZGFlNjAxZmJkNzNmNjcyZTgyMDI4ZTA0YzNhYmRmMTI1MmQ=", "commit": {"author": {"name": "Adolfo Ochagav\u00eda", "email": "aochagavia92@gmail.com", "date": "2018-11-04T15:45:22Z"}, "committer": {"name": "Adolfo Ochagav\u00eda", "email": "aochagavia92@gmail.com", "date": "2018-11-04T20:16:38Z"}, "message": "Introduce SyntaxErrorKind and TextRange in SyntaxError", "tree": {"sha": "d63c4114d2fccf1c085502dfd1048b4b5f68266b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d63c4114d2fccf1c085502dfd1048b4b5f68266b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b42ddae601fbd73f672e82028e04c3abdf1252d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b42ddae601fbd73f672e82028e04c3abdf1252d", "html_url": "https://github.com/rust-lang/rust/commit/3b42ddae601fbd73f672e82028e04c3abdf1252d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b42ddae601fbd73f672e82028e04c3abdf1252d/comments", "author": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "576b9a0727ebbf00521bc1131cda808145696d06", "url": "https://api.github.com/repos/rust-lang/rust/commits/576b9a0727ebbf00521bc1131cda808145696d06", "html_url": "https://github.com/rust-lang/rust/commit/576b9a0727ebbf00521bc1131cda808145696d06"}], "stats": {"total": 219, "additions": 155, "deletions": 64}, "files": [{"sha": "25124dbe3de59e29acae892c2dd4469a2e71f879", "filename": "crates/ra_editor/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_editor%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_editor%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Flib.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -103,8 +103,8 @@ pub fn diagnostics(file: &File) -> Vec<Diagnostic> {\n     file.errors()\n         .into_iter()\n         .map(|err| Diagnostic {\n-            range: TextRange::offset_len(err.offset, 1.into()),\n-            msg: \"Syntax Error: \".to_string() + &err.msg,\n+            range: err.range,\n+            msg: format!(\"Syntax Error: {}\", err.kind),\n         })\n         .collect()\n }"}, {"sha": "ced09bcffe4e1c30b7f2e72702219367203d1192", "filename": "crates/ra_syntax/src/parser_impl/event.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fevent.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -13,6 +13,10 @@ use crate::{\n     SmolStr,\n     SyntaxKind::{self, *},\n     TextRange, TextUnit,\n+    yellow::syntax_error::{\n+        ParseError,\n+        SyntaxErrorKind,\n+    },\n };\n use std::mem;\n \n@@ -75,7 +79,7 @@ pub(crate) enum Event {\n     },\n \n     Error {\n-        msg: String,\n+        msg: ParseError,\n     },\n }\n \n@@ -157,7 +161,10 @@ impl<'a, S: Sink> EventProcessor<'a, S> {\n                         .sum::<TextUnit>();\n                     self.leaf(kind, len, n_raw_tokens);\n                 }\n-                Event::Error { msg } => self.sink.error(msg, self.text_pos),\n+                Event::Error { msg } => self.sink.error(\n+                    SyntaxErrorKind::ParseError(msg),\n+                    TextRange::offset_len(self.text_pos, 1.into()),\n+                ),\n             }\n         }\n         self.sink"}, {"sha": "ade25770b9ae0f17e26906063c90b44633756c29", "filename": "crates/ra_syntax/src/parser_impl/mod.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fparser_impl%2Fmod.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -10,7 +10,11 @@ use crate::{\n         event::{Event, EventProcessor},\n         input::{InputPosition, ParserInput},\n     },\n-    SmolStr, TextUnit,\n+    SmolStr, TextRange,\n+    yellow::syntax_error::{\n+        ParseError,\n+        SyntaxErrorKind,\n+    },\n };\n \n use crate::SyntaxKind::{self, EOF, TOMBSTONE};\n@@ -21,7 +25,7 @@ pub(crate) trait Sink {\n     fn leaf(&mut self, kind: SyntaxKind, text: SmolStr);\n     fn start_internal(&mut self, kind: SyntaxKind);\n     fn finish_internal(&mut self);\n-    fn error(&mut self, message: String, offset: TextUnit);\n+    fn error(&mut self, kind: SyntaxErrorKind, offset: TextRange);\n     fn finish(self) -> Self::Tree;\n }\n \n@@ -144,7 +148,9 @@ impl<'t> ParserImpl<'t> {\n     }\n \n     pub(super) fn error(&mut self, msg: String) {\n-        self.event(Event::Error { msg })\n+        self.event(Event::Error {\n+            msg: ParseError(msg),\n+        })\n     }\n \n     pub(super) fn complete(&mut self, pos: u32, kind: SyntaxKind) {"}, {"sha": "9f5baf1ef55dde1e9d92d9eb32639caa21860fe2", "filename": "crates/ra_syntax/src/reparsing.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Freparsing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Freparsing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Freparsing.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -165,19 +165,19 @@ fn merge_errors(\n ) -> Vec<SyntaxError> {\n     let mut res = Vec::new();\n     for e in old_errors {\n-        if e.offset <= old_node.range().start() {\n+        if e.range.start() <= old_node.range().start() {\n             res.push(e)\n-        } else if e.offset >= old_node.range().end() {\n+        } else if e.range.start() >= old_node.range().end() {\n             res.push(SyntaxError {\n-                msg: e.msg,\n-                offset: e.offset + TextUnit::of_str(&edit.insert) - edit.delete.len(),\n+                kind: e.kind,\n+                range: e.range + TextUnit::of_str(&edit.insert) - edit.delete.len(),\n             })\n         }\n     }\n     for e in new_errors {\n         res.push(SyntaxError {\n-            msg: e.msg,\n-            offset: e.offset + old_node.range().start(),\n+            kind: e.kind,\n+            range: e.range + old_node.range().start(),\n         })\n     }\n     res"}, {"sha": "f0812ff289d6d205c4b760bfc5946041dd9ff784", "filename": "crates/ra_syntax/src/string_lexing/mod.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fstring_lexing%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fstring_lexing%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fstring_lexing%2Fmod.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -100,10 +100,6 @@ impl<'a> Parser<'a> {\n     // Char parsing methods\n \n     fn parse_unicode_escape(&mut self, start: TextUnit) -> CharComponent {\n-        // Note: validation of UnicodeEscape will be done elsewhere:\n-        // * Only hex digits or underscores allowed\n-        // * Max 6 chars\n-        // * Within allowed range (must be at most 10FFFF)\n         match self.peek() {\n             Some('{') => {\n                 self.advance();\n@@ -127,9 +123,6 @@ impl<'a> Parser<'a> {\n     }\n \n     fn parse_ascii_code_escape(&mut self, start: TextUnit) -> CharComponent {\n-        // Note: validation of AsciiCodeEscape will be done elsewhere:\n-        // * First digit is octal\n-        // * Second digit is hex\n         let code_start = self.get_pos();\n         while let Some(next) = self.peek() {\n             if next == '\\'' || (self.get_pos() - code_start == 2.into()) {\n@@ -144,9 +137,6 @@ impl<'a> Parser<'a> {\n     }\n \n     fn parse_escape(&mut self, start: TextUnit) -> CharComponent {\n-        // Note: validation of AsciiEscape will be done elsewhere:\n-        // * The escape sequence is non-empty\n-        // * The escape sequence is valid\n         if self.peek().is_none() {\n             return CharComponent::new(TextRange::from_to(start, start), AsciiEscape);\n         }"}, {"sha": "f55568d94bc9f3a445a6657d28069495c0ea0316", "filename": "crates/ra_syntax/src/utils.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Futils.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -4,7 +4,7 @@ use std::fmt::Write;\n /// Parse a file and create a string representation of the resulting parse tree.\n pub fn dump_tree(syntax: SyntaxNodeRef) -> String {\n     let mut errors: Vec<_> = syntax.root_data().to_vec();\n-    errors.sort_by_key(|e| e.offset);\n+    errors.sort_by_key(|e| e.range.start());\n     let mut err_pos = 0;\n     let mut level = 0;\n     let mut buf = String::new();\n@@ -23,9 +23,9 @@ pub fn dump_tree(syntax: SyntaxNodeRef) -> String {\n                 writeln!(buf, \"{:?}\", node).unwrap();\n                 if node.first_child().is_none() {\n                     let off = node.range().end();\n-                    while err_pos < errors.len() && errors[err_pos].offset <= off {\n+                    while err_pos < errors.len() && errors[err_pos].range.start() <= off {\n                         indent!();\n-                        writeln!(buf, \"err: `{}`\", errors[err_pos].msg).unwrap();\n+                        writeln!(buf, \"err: `{}`\", errors[err_pos].kind).unwrap();\n                         err_pos += 1;\n                     }\n                 }\n@@ -37,7 +37,7 @@ pub fn dump_tree(syntax: SyntaxNodeRef) -> String {\n \n     assert_eq!(level, 0);\n     for err in errors[err_pos..].iter() {\n-        writeln!(buf, \"err: `{}`\", err.msg).unwrap();\n+        writeln!(buf, \"err: `{}`\", err.kind).unwrap();\n     }\n \n     buf"}, {"sha": "06e6e75056d8b28cd68848f29a05f3d4ce7fe989", "filename": "crates/ra_syntax/src/validation.rs", "status": "modified", "additions": 76, "deletions": 23, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fvalidation.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -1,40 +1,93 @@\n use crate::{\n+    algo::visit::{visitor_ctx, VisitorCtx},\n     ast::{self, AstNode},\n     File,\n-    string_lexing,\n+    string_lexing::{self, CharComponentKind},\n     yellow::{\n         SyntaxError,\n+        SyntaxErrorKind::*,\n     },\n };\n \n pub(crate) fn validate(file: &File) -> Vec<SyntaxError> {\n     let mut errors = Vec::new();\n-    for d in file.root.borrowed().descendants() {\n-        if let Some(c) = ast::Char::cast(d) {\n-            let components = &mut string_lexing::parse_char_literal(c.text());\n-            let len = components.count();\n+    for node in file.root.borrowed().descendants() {\n+        let _ = visitor_ctx(&mut errors)\n+            .visit::<ast::Char, _>(validate_char)\n+            .accept(node);\n+    }\n+    errors\n+}\n \n-            if !components.has_closing_quote {\n-                errors.push(SyntaxError {\n-                    msg: \"Unclosed char literal\".to_string(),\n-                    offset: d.range().start(),\n-                });\n-            }\n+fn validate_char(node: ast::Char, errors: &mut Vec<SyntaxError>) {\n+    let mut components = string_lexing::parse_char_literal(node.text());\n+    let mut len = 0;\n+    for component in &mut components {\n+        len += 1;\n \n-            if len == 0 {\n-                errors.push(SyntaxError {\n-                    msg: \"Empty char literal\".to_string(),\n-                    offset: d.range().start(),\n-                });\n+        // Validate escapes\n+        let text = &node.text()[component.range];\n+        let range = component.range + node.syntax().range().start();\n+        use self::CharComponentKind::*;\n+        match component.kind {\n+            AsciiEscape => {\n+                if text.len() == 1 {\n+                    // Escape sequence consists only of leading `\\`\n+                    errors.push(SyntaxError {\n+                        kind: EmptyAsciiEscape,\n+                        range: range,\n+                    });\n+                } else {\n+                    let escape_code = text.chars().skip(1).next().unwrap();\n+                    if !is_ascii_escape(escape_code) {\n+                        errors.push(SyntaxError {\n+                            kind: InvalidAsciiEscape,\n+                            range: range,\n+                        });\n+                    }\n+                }\n             }\n-\n-            if len > 1 {\n-                errors.push(SyntaxError {\n-                    msg: \"Character literal should be only one character long\".to_string(),\n-                    offset: d.range().start(),\n-                });\n+            AsciiCodeEscape => {\n+                // TODO:\n+                // * First digit is octal\n+                // * Second digit is hex\n+            }\n+            UnicodeEscape => {\n+                // TODO:\n+                // * Only hex digits or underscores allowed\n+                // * Max 6 chars\n+                // * Within allowed range (must be at most 10FFFF)\n             }\n+            // Code points are always valid\n+            CodePoint => (),\n         }\n     }\n-    errors\n+\n+    if !components.has_closing_quote {\n+        errors.push(SyntaxError {\n+            kind: UnclosedChar,\n+            range: node.syntax().range(),\n+        });\n+    }\n+\n+    if len == 0 {\n+        errors.push(SyntaxError {\n+            kind: EmptyChar,\n+            range: node.syntax().range(),\n+        });\n+    }\n+\n+    if len > 1 {\n+        errors.push(SyntaxError {\n+            kind: LongChar,\n+            range: node.syntax().range(),\n+        });\n+    }\n+}\n+\n+fn is_ascii_escape(code: char) -> bool {\n+    match code {\n+        '\\'' | '\"' | 'n' | 'r' | 't' | '0' => true,\n+        _ => false,\n+    }\n }"}, {"sha": "dbe2df125927a461a077d9d914edb69c5eef97a6", "filename": "crates/ra_syntax/src/yellow/builder.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fbuilder.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -1,7 +1,7 @@\n use crate::{\n     parser_impl::Sink,\n-    yellow::{GreenNode, RaTypes, SyntaxError},\n-    SmolStr, SyntaxKind, TextUnit,\n+    yellow::{GreenNode, RaTypes, SyntaxError, SyntaxErrorKind},\n+    SmolStr, SyntaxKind, TextRange,\n };\n use rowan::GreenNodeBuilder;\n \n@@ -34,11 +34,8 @@ impl Sink for GreenBuilder {\n         self.inner.finish_internal();\n     }\n \n-    fn error(&mut self, message: String, offset: TextUnit) {\n-        let error = SyntaxError {\n-            msg: message,\n-            offset,\n-        };\n+    fn error(&mut self, kind: SyntaxErrorKind, range: TextRange) {\n+        let error = SyntaxError { kind, range };\n         self.errors.push(error)\n     }\n "}, {"sha": "fd2b5bd3374f36eb212de1de608e18669ee8ea59", "filename": "crates/ra_syntax/src/yellow/mod.rs", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -1,15 +1,17 @@\n mod builder;\n+pub mod syntax_error;\n mod syntax_text;\n \n use self::syntax_text::SyntaxText;\n-use crate::{SmolStr, SyntaxKind, TextRange, TextUnit};\n+use crate::{SmolStr, SyntaxKind, TextRange};\n use rowan::Types;\n use std::{\n     fmt,\n     hash::{Hash, Hasher},\n };\n \n pub(crate) use self::builder::GreenBuilder;\n+pub use self::syntax_error::{SyntaxError, SyntaxErrorKind};\n pub use rowan::{TreeRoot, WalkEvent};\n \n #[derive(Debug, Clone, Copy)]\n@@ -24,12 +26,6 @@ pub type RefRoot<'a> = ::rowan::RefRoot<'a, RaTypes>;\n \n pub type GreenNode = ::rowan::GreenNode<RaTypes>;\n \n-#[derive(Debug, Clone, PartialEq, Eq, Hash, Ord, PartialOrd)]\n-pub struct SyntaxError {\n-    pub msg: String,\n-    pub offset: TextUnit,\n-}\n-\n #[derive(Clone, Copy)]\n pub struct SyntaxNode<R: TreeRoot<RaTypes> = OwnedRoot>(::rowan::SyntaxNode<RaTypes, R>);\n pub type SyntaxNodeRef<'a> = SyntaxNode<RefRoot<'a>>;"}, {"sha": "e8c818dc69a6c6ee1c8bb665ac63c7b9b02c3c29", "filename": "crates/ra_syntax/src/yellow/syntax_error.rs", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b42ddae601fbd73f672e82028e04c3abdf1252d/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_error.rs?ref=3b42ddae601fbd73f672e82028e04c3abdf1252d", "patch": "@@ -0,0 +1,42 @@\n+use std::fmt;\n+\n+use crate::TextRange;\n+\n+#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+pub struct SyntaxError {\n+    pub kind: SyntaxErrorKind,\n+    pub range: TextRange,\n+}\n+\n+impl SyntaxError {\n+    pub fn new(kind: SyntaxErrorKind, range: TextRange) -> SyntaxError {\n+        SyntaxError { kind, range }\n+    }\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+pub enum SyntaxErrorKind {\n+    ParseError(ParseError),\n+    EmptyChar,\n+    UnclosedChar,\n+    LongChar,\n+    EmptyAsciiEscape,\n+    InvalidAsciiEscape,\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+pub struct ParseError(pub String);\n+\n+impl fmt::Display for SyntaxErrorKind {\n+    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n+        use self::SyntaxErrorKind::*;\n+        match self {\n+            EmptyAsciiEscape => write!(f, \"Empty escape sequence\"),\n+            InvalidAsciiEscape => write!(f, \"Invalid escape sequence\"),\n+            EmptyChar => write!(f, \"Empty char literal\"),\n+            UnclosedChar => write!(f, \"Unclosed char literal\"),\n+            LongChar => write!(f, \"Char literal should be one character long\"),\n+            ParseError(msg) => write!(f, \"{}\", msg.0),\n+        }\n+    }\n+}"}]}