{"sha": "1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkMjcyNjcyNmY4ZjMxMjhlOTgxOTFlNGM2Y2I5NGJkNzZkMGRkZDQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-10-21T17:44:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-10-21T17:44:48Z"}, "message": "Auto merge of #78195 - tmiasko:instcombine, r=jonas-schievink\n\nDisable \"optimization to avoid load of address\" in InstCombine\n\nThe transformation is incorrect #78192. Disable it.", "tree": {"sha": "4df0f66fa5beaeb1ea7e813d33d0736ba0c17fe4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4df0f66fa5beaeb1ea7e813d33d0736ba0c17fe4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "html_url": "https://github.com/rust-lang/rust/commit/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22e6b9c68941996daa45786b4145e6196e51f0f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/22e6b9c68941996daa45786b4145e6196e51f0f4", "html_url": "https://github.com/rust-lang/rust/commit/22e6b9c68941996daa45786b4145e6196e51f0f4"}, {"sha": "e200a4a0d21473de9cc8ff817a0e4eba304e7e69", "url": "https://api.github.com/repos/rust-lang/rust/commits/e200a4a0d21473de9cc8ff817a0e4eba304e7e69", "html_url": "https://github.com/rust-lang/rust/commit/e200a4a0d21473de9cc8ff817a0e4eba304e7e69"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "c0b3d5ff18b5c99e9f8fd10ba882e36b21e8843e", "filename": "compiler/rustc_mir/src/transform/instcombine.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finstcombine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finstcombine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Finstcombine.rs?ref=1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "patch": "@@ -119,6 +119,11 @@ impl OptimizationFinder<'b, 'tcx> {\n     }\n \n     fn find_deref_of_address(&mut self, rvalue: &Rvalue<'tcx>, location: Location) -> Option<()> {\n+        // FIXME(#78192): This optimization can result in unsoundness.\n+        if !self.tcx.sess.opts.debugging_opts.unsound_mir_opts {\n+            return None;\n+        }\n+\n         // Look for the sequence\n         //\n         // _2 = &_1;"}, {"sha": "4fd1b8b2276496da04fbbff47073b6ba27f79122", "filename": "src/test/mir-opt/const_prop/ref_deref.main.ConstProp.diff", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref.main.ConstProp.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref.main.ConstProp.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref.main.ConstProp.diff?ref=1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "patch": "@@ -19,7 +19,7 @@\n                                            // + span: $DIR/ref_deref.rs:5:6: 5:10\n                                            // + literal: Const { ty: &i32, val: Unevaluated(WithOptConstParam { did: DefId(0:3 ~ ref_deref[317d]::main), const_param_did: None }, [], Some(promoted[0])) }\n           _2 = _4;                         // scope 0 at $DIR/ref_deref.rs:5:6: 5:10\n--         _1 = (*_4);                      // scope 0 at $DIR/ref_deref.rs:5:5: 5:10\n+-         _1 = (*_2);                      // scope 0 at $DIR/ref_deref.rs:5:5: 5:10\n +         _1 = const 4_i32;                // scope 0 at $DIR/ref_deref.rs:5:5: 5:10\n           StorageDead(_2);                 // scope 0 at $DIR/ref_deref.rs:5:10: 5:11\n           StorageDead(_1);                 // scope 0 at $DIR/ref_deref.rs:5:10: 5:11"}, {"sha": "812c7c9771801d5809b7c9a89eff69fc76f922cc", "filename": "src/test/mir-opt/const_prop/ref_deref_project.main.ConstProp.diff", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref_project.main.ConstProp.diff", "raw_url": "https://github.com/rust-lang/rust/raw/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref_project.main.ConstProp.diff", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fconst_prop%2Fref_deref_project.main.ConstProp.diff?ref=1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "patch": "@@ -19,7 +19,7 @@\n                                            // + span: $DIR/ref_deref_project.rs:5:6: 5:17\n                                            // + literal: Const { ty: &(i32, i32), val: Unevaluated(WithOptConstParam { did: DefId(0:3 ~ ref_deref_project[317d]::main), const_param_did: None }, [], Some(promoted[0])) }\n           _2 = &((*_4).1: i32);            // scope 0 at $DIR/ref_deref_project.rs:5:6: 5:17\n-          _1 = ((*_4).1: i32);             // scope 0 at $DIR/ref_deref_project.rs:5:5: 5:17\n+          _1 = (*_2);                      // scope 0 at $DIR/ref_deref_project.rs:5:5: 5:17\n           StorageDead(_2);                 // scope 0 at $DIR/ref_deref_project.rs:5:17: 5:18\n           StorageDead(_1);                 // scope 0 at $DIR/ref_deref_project.rs:5:17: 5:18\n           _0 = const ();                   // scope 0 at $DIR/ref_deref_project.rs:4:11: 6:2"}, {"sha": "78361c336607c671b5f9635101d6edc54ef9468b", "filename": "src/test/mir-opt/inst_combine_deref.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Finst_combine_deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d2726726f8f3128e98191e4c6cb94bd76d0ddd4/src%2Ftest%2Fmir-opt%2Finst_combine_deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finst_combine_deref.rs?ref=1d2726726f8f3128e98191e4c6cb94bd76d0ddd4", "patch": "@@ -1,4 +1,4 @@\n-// compile-flags: -O\n+// compile-flags: -O -Zunsound-mir-opts\n // EMIT_MIR inst_combine_deref.simple_opt.InstCombine.diff\n fn simple_opt() -> u64 {\n     let x = 5;"}]}