{"sha": "6612100de547446f20aa51f5887a8b769078b0fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2MTIxMDBkZTU0NzQ0NmYyMGFhNTFmNTg4N2E4Yjc2OTA3OGIwZmU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-11-21T23:24:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-11-21T23:24:15Z"}, "message": "Auto merge of #56065 - oli-obk:min_const_fn_loop_ice, r=davidtwco\n\nReplace the ICEing on const fn loops with an error\n\nfixes #56035", "tree": {"sha": "b4313ec2f04091a752c4961f8304bb639f260ad0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4313ec2f04091a752c4961f8304bb639f260ad0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6612100de547446f20aa51f5887a8b769078b0fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6612100de547446f20aa51f5887a8b769078b0fe", "html_url": "https://github.com/rust-lang/rust/commit/6612100de547446f20aa51f5887a8b769078b0fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6612100de547446f20aa51f5887a8b769078b0fe/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b9f19dff1347e29bf4362ab5a8fab84b43023b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b9f19dff1347e29bf4362ab5a8fab84b43023b5", "html_url": "https://github.com/rust-lang/rust/commit/0b9f19dff1347e29bf4362ab5a8fab84b43023b5"}, {"sha": "8ee9711a6c00a0994f7fc69586273c86ab45e396", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ee9711a6c00a0994f7fc69586273c86ab45e396", "html_url": "https://github.com/rust-lang/rust/commit/8ee9711a6c00a0994f7fc69586273c86ab45e396"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "958e5efe3ec74e9b3ffde0f33324917fdd1d38ff", "filename": "src/librustc_mir/transform/qualify_min_const_fn.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6612100de547446f20aa51f5887a8b769078b0fe/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6612100de547446f20aa51f5887a8b769078b0fe/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs?ref=6612100de547446f20aa51f5887a8b769078b0fe", "patch": "@@ -365,10 +365,8 @@ fn check_terminator(\n             cleanup: _,\n         } => check_operand(tcx, mir, cond, span),\n \n-        | TerminatorKind::FalseUnwind { .. } => span_bug!(\n-            terminator.source_info.span,\n-            \"min_const_fn encountered `{:#?}`\",\n-            terminator\n-        ),\n+        TerminatorKind::FalseUnwind { .. } => {\n+            Err((span, \"loops are not allowed in const fn\".into()))\n+        },\n     }\n }"}, {"sha": "4278a8e2d0036b51271c3e5111895d148ab5af55", "filename": "src/test/ui/consts/min_const_fn/loop_ice.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6612100de547446f20aa51f5887a8b769078b0fe/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6612100de547446f20aa51f5887a8b769078b0fe/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.rs?ref=6612100de547446f20aa51f5887a8b769078b0fe", "patch": "@@ -0,0 +1,5 @@\n+const fn foo() {\n+    loop {} //~ ERROR loops are not allowed in const fn\n+}\n+\n+fn main() {}"}, {"sha": "1424cea65afd55dd11ac835a708fbac534212c71", "filename": "src/test/ui/consts/min_const_fn/loop_ice.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6612100de547446f20aa51f5887a8b769078b0fe/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6612100de547446f20aa51f5887a8b769078b0fe/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Floop_ice.stderr?ref=6612100de547446f20aa51f5887a8b769078b0fe", "patch": "@@ -0,0 +1,8 @@\n+error: loops are not allowed in const fn\n+  --> $DIR/loop_ice.rs:2:5\n+   |\n+LL |     loop {} //~ ERROR loops are not allowed in const fn\n+   |     ^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}