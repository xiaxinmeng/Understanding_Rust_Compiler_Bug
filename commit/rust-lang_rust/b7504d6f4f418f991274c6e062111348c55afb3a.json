{"sha": "b7504d6f4f418f991274c6e062111348c55afb3a", "node_id": "C_kwDOAAsO6NoAKGI3NTA0ZDZmNGY0MThmOTkxMjc0YzZlMDYyMTExMzQ4YzU1YWZiM2E", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2022-09-12T20:47:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-12T20:47:13Z"}, "message": "Rollup merge of #100185 - compiler-errors:issue-100183, r=wesleywiser\n\nFix `ReErased` leaking into typeck due to `typeof(...)` recovery\n\nFixes #100183", "tree": {"sha": "06a44ee5e96155d32751a9866ee9f7cb65229f9a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06a44ee5e96155d32751a9866ee9f7cb65229f9a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7504d6f4f418f991274c6e062111348c55afb3a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjH5rRCRBK7hj4Ov3rIwAARloIAK3NZtnWWbcUOqurMo6rUFra\nsp6aHfdz6KEUKdcTT/SnW7oAxJHWs4h9byOgRLlDtnz1ZrVfap7tP9BDuzkfER5V\nrIIMkHBIXHAt3I0hauWruwSqUrSDK8V46wz+3qaEUuXsn6sruG5WG9re62eg4pcG\nh0iAJ+t92/8eam/pjs+GP6HR/c5TyrYqEqIiW0/M/MdyaO8huGeHwkJ7zbkuikxZ\naxVTlcMP7PEm8TbToNyskqMfjNJCQ30YoxEGSWBFOHv6Wye6+XVYoP8ElHJu80Y3\nwiz6SV/FCgkvvzaB6fOzr4z7yAZOKWP0T/gF8Ek+SKX0XtMczFmJwJwtQ2CKpxc=\n=N8Ru\n-----END PGP SIGNATURE-----\n", "payload": "tree 06a44ee5e96155d32751a9866ee9f7cb65229f9a\nparent 52e003a6e93940ae49cbfc806c72ed5b0217cf4e\nparent 315d12d73d511efb277426c813e5d40157a0d70a\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1663015633 +0200\ncommitter GitHub <noreply@github.com> 1663015633 +0200\n\nRollup merge of #100185 - compiler-errors:issue-100183, r=wesleywiser\n\nFix `ReErased` leaking into typeck due to `typeof(...)` recovery\n\nFixes #100183\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7504d6f4f418f991274c6e062111348c55afb3a", "html_url": "https://github.com/rust-lang/rust/commit/b7504d6f4f418f991274c6e062111348c55afb3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7504d6f4f418f991274c6e062111348c55afb3a/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52e003a6e93940ae49cbfc806c72ed5b0217cf4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/52e003a6e93940ae49cbfc806c72ed5b0217cf4e", "html_url": "https://github.com/rust-lang/rust/commit/52e003a6e93940ae49cbfc806c72ed5b0217cf4e"}, {"sha": "315d12d73d511efb277426c813e5d40157a0d70a", "url": "https://api.github.com/repos/rust-lang/rust/commits/315d12d73d511efb277426c813e5d40157a0d70a", "html_url": "https://github.com/rust-lang/rust/commit/315d12d73d511efb277426c813e5d40157a0d70a"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "95c7e3e39aa12fcffed79593b6120a09086db555", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b7504d6f4f418f991274c6e062111348c55afb3a/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7504d6f4f418f991274c6e062111348c55afb3a/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=b7504d6f4f418f991274c6e062111348c55afb3a", "patch": "@@ -2672,7 +2672,10 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                 self.normalize_ty(ast_ty.span, array_ty)\n             }\n             hir::TyKind::Typeof(ref e) => {\n-                let ty = tcx.type_of(tcx.hir().local_def_id(e.hir_id));\n+                let ty_erased = tcx.type_of(tcx.hir().local_def_id(e.hir_id));\n+                let ty = tcx.fold_regions(ty_erased, |r, _| {\n+                    if r.is_erased() { tcx.lifetimes.re_static } else { r }\n+                });\n                 let span = ast_ty.span;\n                 tcx.sess.emit_err(TypeofReservedKeywordUsed {\n                     span,"}, {"sha": "13e9493eaa59b2d7ff37d189d43a25d42281206d", "filename": "src/test/ui/typeof/issue-100183.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b7504d6f4f418f991274c6e062111348c55afb3a/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7504d6f4f418f991274c6e062111348c55afb3a/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.rs?ref=b7504d6f4f418f991274c6e062111348c55afb3a", "patch": "@@ -0,0 +1,6 @@\n+struct Struct {\n+    y: (typeof(\"hey\"),),\n+    //~^ ERROR `typeof` is a reserved keyword but unimplemented\n+}\n+\n+fn main() {}"}, {"sha": "01d3079b246d179683a5e9f0c490598168ad850f", "filename": "src/test/ui/typeof/issue-100183.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b7504d6f4f418f991274c6e062111348c55afb3a/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b7504d6f4f418f991274c6e062111348c55afb3a/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeof%2Fissue-100183.stderr?ref=b7504d6f4f418f991274c6e062111348c55afb3a", "patch": "@@ -0,0 +1,14 @@\n+error[E0516]: `typeof` is a reserved keyword but unimplemented\n+  --> $DIR/issue-100183.rs:2:9\n+   |\n+LL |     y: (typeof(\"hey\"),),\n+   |         ^^^^^^^^^^^^^ reserved keyword\n+   |\n+help: consider replacing `typeof(...)` with an actual type\n+   |\n+LL |     y: (&'static str,),\n+   |         ~~~~~~~~~~~~\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0516`."}]}