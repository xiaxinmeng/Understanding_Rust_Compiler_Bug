{"sha": "c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5Y2YwMzQ0ZWVkOWE1YTQ3NWM4NmE3YTFlOGJlNDI2ZDFmODk5ZWY=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-10-12T08:54:37Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-10-12T08:54:37Z"}, "message": "enable validation for compile-fail tests, and add some new ones", "tree": {"sha": "a419c919977fc367f20b20bb1a79cc8fd394a13c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a419c919977fc367f20b20bb1a79cc8fd394a13c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "html_url": "https://github.com/rust-lang/rust/commit/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62b819ba18a4a32833bb823afeb32778fd28bbde", "url": "https://api.github.com/repos/rust-lang/rust/commits/62b819ba18a4a32833bb823afeb32778fd28bbde", "html_url": "https://github.com/rust-lang/rust/commit/62b819ba18a4a32833bb823afeb32778fd28bbde"}], "stats": {"total": 88, "additions": 48, "deletions": 40}, "files": [{"sha": "cbf370e0236300addd9a3df43b951f29c9e12cbd", "filename": "tests/compile-fail/cast_box_int_to_fn_ptr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fcast_box_int_to_fn_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fcast_box_int_to_fn_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fcast_box_int_to_fn_ptr.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n fn main() {\n     let b = Box::new(42);"}, {"sha": "2a08d9f1f9f85080fabd5bec569f188b1bb9d3ad", "filename": "tests/compile-fail/cast_int_to_fn_ptr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fcast_int_to_fn_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fcast_int_to_fn_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fcast_int_to_fn_ptr.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n fn main() {\n     let g = unsafe {"}, {"sha": "2f8fea38d8f9f984463bfa085767417327c7f400", "filename": "tests/compile-fail/execute_memory.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fexecute_memory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fexecute_memory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fexecute_memory.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n #![feature(box_syntax)]\n "}, {"sha": "e6d1da1e0736a9dc2b6d5e049a5303c38cf6c54b", "filename": "tests/compile-fail/fn_ptr_offset.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Ffn_ptr_offset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Ffn_ptr_offset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Ffn_ptr_offset.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n use std::mem;\n "}, {"sha": "af4ad67a4f0999db940cabdb65cff97b6433b0b3", "filename": "tests/compile-fail/invalid_bool.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_bool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_bool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_bool.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,9 +1,3 @@\n-//ignore-test FIXME: do some basic validation of invariants for all values in flight\n-//This does currently not get caught becuase it compiles to SwitchInt, which\n-//has no knowledge about data invariants.\n-\n fn main() {\n-    let b = unsafe { std::mem::transmute::<u8, bool>(2) };\n-    if b { unreachable!() } else { unreachable!() } //~ ERROR constant evaluation error\n-    //~^ NOTE invalid boolean value read\n+    let _b = unsafe { std::mem::transmute::<u8, bool>(2) }; //~ ERROR encountered 2, but expected something in the range 0..=1\n }"}, {"sha": "2348c62559b00523cbe626d9d055e023f88690ce", "filename": "tests/compile-fail/invalid_bool2.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_bool2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_bool2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_bool2.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,3 +1,6 @@\n+// Validation makes this fail in the wrong place\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n+\n fn main() {\n     let b = unsafe { std::mem::transmute::<u8, bool>(2) };\n     let _x = b == true; //~ ERROR invalid boolean value read"}, {"sha": "3ff0ed60f664c53e3a247a6c8e03470deb450a06", "filename": "tests/compile-fail/invalid_char.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_char.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_char.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_char.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    assert!(std::char::from_u32(-1_i32 as u32).is_none());\n+    let _ = match unsafe { std::mem::transmute::<i32, char>(-1) } { //~ ERROR encountered 4294967295, but expected something in the range 0..=1114111\n+        'a' => {true},\n+        'b' => {false},\n+        _ => {true},\n+    };\n+}"}, {"sha": "5de2d073f3231f752d099ae670a6214b808d34a8", "filename": "tests/compile-fail/invalid_char2.rs", "status": "renamed", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_char2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_char2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_char2.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,3 +1,6 @@\n+// Validation makes this fail in the wrong place\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n+\n fn main() {\n     assert!(std::char::from_u32(-1_i32 as u32).is_none());\n     let c = unsafe { std::mem::transmute::<i32, char>(-1) };", "previous_filename": "tests/compile-fail/match_char2.rs"}, {"sha": "543a797d44f20de0fa0492bbd4fcc35f21fdcdd8", "filename": "tests/compile-fail/invalid_enum_discriminant.rs", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_enum_discriminant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_enum_discriminant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_enum_discriminant.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,17 +1,8 @@\n-// Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n-\n #[repr(C)]\n pub enum Foo {\n     A, B, C, D\n }\n \n fn main() {\n-    let f = unsafe { std::mem::transmute::<i32, Foo>(42) };\n-    match f {\n-        Foo::A => {}, //~ ERROR invalid enum discriminant\n-        Foo::B => {},\n-        Foo::C => {},\n-        Foo::D => {},\n-    }\n+    let _f = unsafe { std::mem::transmute::<i32, Foo>(42) }; //~ ERROR encountered invalid enum discriminant 42\n }"}, {"sha": "ea94081693e1bea559248e79dd8b8b3526a4cad8", "filename": "tests/compile-fail/invalid_enum_discriminant2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_enum_discriminant2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Finvalid_enum_discriminant2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Finvalid_enum_discriminant2.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // Validation makes this fail in the wrong place\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n // error-pattern: invalid enum discriminant\n "}, {"sha": "e7fee1e3e36112f76d3d847daa6a885d1418cb05", "filename": "tests/compile-fail/match_char.rs", "status": "removed", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/62b819ba18a4a32833bb823afeb32778fd28bbde/tests%2Fcompile-fail%2Fmatch_char.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62b819ba18a4a32833bb823afeb32778fd28bbde/tests%2Fcompile-fail%2Fmatch_char.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fmatch_char.rs?ref=62b819ba18a4a32833bb823afeb32778fd28bbde", "patch": "@@ -1,13 +0,0 @@\n-//ignore-test FIXME: do some basic validation of invariants for all values in flight\n-//This does currently not get caught becuase it compiles to SwitchInt, which\n-//has no knowledge about data invariants.\n-\n-fn main() {\n-    assert!(std::char::from_u32(-1_i32 as u32).is_none());\n-    let _ = match unsafe { std::mem::transmute::<i32, char>(-1) } { //~ ERROR constant evaluation error\n-        //~^ NOTE tried to interpret an invalid 32-bit value as a char: 4294967295\n-        'a' => {true},\n-        'b' => {false},\n-        _ => {true},\n-    };\n-}"}, {"sha": "9821723deb3bc828eb4686d1a24be57649dee8a4", "filename": "tests/compile-fail/never_say_never.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_say_never.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_say_never.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fnever_say_never.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // This should fail even without validation\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n #![feature(never_type)]\n #![allow(unreachable_code)]"}, {"sha": "c5c53d4231c7c516f18c4c50db30d18e3e766d9a", "filename": "tests/compile-fail/never_transmute_humans.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_transmute_humans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_transmute_humans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fnever_transmute_humans.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // This should fail even without validation\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n #![feature(never_type)]\n #![allow(unreachable_code)]"}, {"sha": "11fc0f068de0d80104f54df2c5c5739ae61bc386", "filename": "tests/compile-fail/never_transmute_void.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_transmute_void.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fnever_transmute_void.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fnever_transmute_void.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // This should fail even without validation\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n #![feature(never_type)]\n #![allow(unreachable_code)]"}, {"sha": "d18f314c8aaa168c3d75628a17613783fd1bba15", "filename": "tests/compile-fail/reference_to_packed.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Freference_to_packed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Freference_to_packed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Freference_to_packed.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,5 +1,5 @@\n // This should fail even without validation\n-// compile-flags: -Zmir-emit-validate=0\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n \n #![allow(dead_code, unused_variables)]\n "}, {"sha": "69917dce8591073b314170c02ce61281d742bcd5", "filename": "tests/compile-fail/storage_dead_dangling.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fstorage_dead_dangling.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fstorage_dead_dangling.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fstorage_dead_dangling.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -1,3 +1,6 @@\n+// This should fail even without validation\n+// compile-flags: -Zmir-emit-validate=0 -Zmiri-disable-validation\n+\n static mut LEAK: usize = 0;\n \n fn fill(v: &mut i32) {"}, {"sha": "82f2d10ee4bb5e94439135fc8dcda014c390b904", "filename": "tests/compile-fail/validation_cast_fn_ptr1.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr1.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -0,0 +1,10 @@\n+fn main() {\n+    // Cast a function pointer such that on a call, the argument gets transmuted\n+    // from raw ptr to reference.  This is ABI-compatible, so it's not the call that\n+    // should fail, but validation should.\n+    fn f(_x: &i32) { }\n+\n+    let g: fn(*const i32) = unsafe { std::mem::transmute(f as fn(&i32)) };\n+\n+    g(0usize as *const i32) //~ ERROR encountered 0, but expected something greater or equal to 1\n+}"}, {"sha": "2f3b91a53e622a2b7c91db07fc6827b831595686", "filename": "tests/compile-fail/validation_cast_fn_ptr2.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fvalidation_cast_fn_ptr2.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -0,0 +1,10 @@\n+fn main() {\n+    // Cast a function pointer such that when returning, the return value gets transmuted\n+    // from raw ptr to reference.  This is ABI-compatible, so it's not the call that\n+    // should fail, but validation should.\n+    fn f() -> *const i32 { 0usize as *const i32 }\n+\n+    let g: fn() -> &'static i32 = unsafe { std::mem::transmute(f as fn() -> *const i32) };\n+\n+    let _x = g(); //~ ERROR encountered 0, but expected something greater or equal to 1\n+}"}, {"sha": "82a2144a337ded071212f909089a1e803e25b3b1", "filename": "tests/compiletest.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9cf0344eed9a5a475c86a7a1e8be426d1f899ef/tests%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompiletest.rs?ref=c9cf0344eed9a5a475c86a7a1e8be426d1f899ef", "patch": "@@ -64,7 +64,6 @@ fn compile_fail(sysroot: &Path, path: &str, target: &str, host: &str, need_fullm\n     flags.push(\"-Dwarnings -Dunused\".to_owned()); // overwrite the -Aunused in compiletest-rs\n     config.src_base = PathBuf::from(path.to_string());\n     flags.push(\"-Zmir-emit-validate=1\".to_owned());\n-    flags.push(\"-Zmiri-disable-validation\".to_owned());\n     config.target_rustcflags = Some(flags.join(\" \"));\n     config.target = target.to_owned();\n     config.host = host.to_owned();"}]}