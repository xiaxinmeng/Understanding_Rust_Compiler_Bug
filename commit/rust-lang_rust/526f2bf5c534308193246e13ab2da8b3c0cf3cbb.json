{"sha": "526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyNmYyYmY1YzUzNDMwODE5MzI0NmUxM2FiMmRhOGIzYzBjZjNjYmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-09T11:44:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-09T11:44:43Z"}, "message": "Auto merge of #32786 - brson:cargotest, r=alexcrichton\n\nFix cargotest\n\nTested in dev.", "tree": {"sha": "25b36205b027074df078d08c2f3b417f1a52bb92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25b36205b027074df078d08c2f3b417f1a52bb92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "html_url": "https://github.com/rust-lang/rust/commit/526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/42ea682fc495b6ec362db0aafba69e56c7aa0a9c", "html_url": "https://github.com/rust-lang/rust/commit/42ea682fc495b6ec362db0aafba69e56c7aa0a9c"}, {"sha": "8019922621ec03b36ab026c3cb401dd231185d08", "url": "https://api.github.com/repos/rust-lang/rust/commits/8019922621ec03b36ab026c3cb401dd231185d08", "html_url": "https://github.com/rust-lang/rust/commit/8019922621ec03b36ab026c3cb401dd231185d08"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "a2445ae498a77451b960c3458706e08fcfd3c385", "filename": "src/bootstrap/build/check.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Fbootstrap%2Fbuild%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Fbootstrap%2Fbuild%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fcheck.rs?ref=526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "patch": "@@ -18,9 +18,18 @@ pub fn linkcheck(build: &Build, stage: u32, host: &str) {\n }\n \n pub fn cargotest(build: &Build, stage: u32, host: &str) {\n+\n     let ref compiler = Compiler::new(stage, host);\n+\n+    // Configure PATH to find the right rustc. NB. we have to use PATH\n+    // and not RUSTC because the Cargo test suite has tests that will\n+    // fail if rustc is not spelled `rustc`.\n+    let path = build.sysroot(compiler).join(\"bin\");\n+    let old_path = ::std::env::var(\"PATH\").expect(\"\");\n+    let sep = if cfg!(windows) { \";\" } else {\":\" };\n+    let ref newpath = format!(\"{}{}{}\", path.display(), sep, old_path);\n+\n     build.run(build.tool_cmd(compiler, \"cargotest\")\n-              .env(\"RUSTC\", build.compiler_path(compiler))\n-              .env(\"RUSTDOC\", build.rustdoc(compiler))\n+              .env(\"PATH\", newpath)\n               .arg(&build.cargo));\n }"}, {"sha": "80fcc32e5371d5c4504e9d911750c0b6bee139a4", "filename": "src/bootstrap/build/step.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Fbootstrap%2Fbuild%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Fbootstrap%2Fbuild%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fstep.rs?ref=526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "patch": "@@ -325,7 +325,7 @@ impl<'a> Step<'a> {\n                 vec![self.librustc(self.compiler(stage))]\n             }\n             Source::ToolCargoTest { stage } => {\n-                vec![self.libstd(self.compiler(stage))]\n+                vec![self.librustc(self.compiler(stage))]\n             }\n \n             Source::DistDocs { stage } => vec![self.doc(stage)],"}, {"sha": "87a0103867595fd192418febe6297f8d752a6473", "filename": "src/tools/cargotest/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Ftools%2Fcargotest%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/526f2bf5c534308193246e13ab2da8b3c0cf3cbb/src%2Ftools%2Fcargotest%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcargotest%2Fmain.rs?ref=526f2bf5c534308193246e13ab2da8b3c0cf3cbb", "patch": "@@ -19,7 +19,7 @@ use std::io::Write;\n \n const TEST_REPOS: &'static [(&'static str, &'static str, Option<&'static str>)] = &[\n     (\"https://github.com/rust-lang/cargo\",\n-     \"ff02b156f094fb83e70acd965c83c9286411914e\",\n+     \"fae9c539388f1b7c70c31fd0a21b5dd9cd071177\",\n      None),\n     (\"https://github.com/iron/iron\",\n      \"16c858ec2901e2992fe5e529780f59fa8ed12903\","}]}