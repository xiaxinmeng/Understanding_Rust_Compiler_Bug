{"sha": "a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2ZDhjOWM1ZWJlYTU4NTMwNGRmNzRiZGY1NmNmZjE4NmFkOGVmMWE=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-03-04T09:17:15Z"}, "committer": {"name": "Eric Huss", "email": "eric@huss.org", "date": "2020-03-04T16:30:26Z"}, "message": "more toolstate comments", "tree": {"sha": "090f40d3f98e62a072a23503c9cf70fb179e4380", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/090f40d3f98e62a072a23503c9cf70fb179e4380"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "html_url": "https://github.com/rust-lang/rust/commit/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0e1cd5935faf9240850c07afb2b7fd8d582c5e25", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e1cd5935faf9240850c07afb2b7fd8d582c5e25", "html_url": "https://github.com/rust-lang/rust/commit/0e1cd5935faf9240850c07afb2b7fd8d582c5e25"}], "stats": {"total": 21, "additions": 12, "deletions": 9}, "files": [{"sha": "c8d8a29ac4e16573f4d024c85abf37f94f65613b", "filename": "src/bootstrap/toolstate.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Fbootstrap%2Ftoolstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Fbootstrap%2Ftoolstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftoolstate.rs?ref=a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "patch": "@@ -330,11 +330,11 @@ fn prepare_toolstate_config(token: &str) {\n             Err(_) => false,\n         };\n         if !success {\n-            panic!(\"git config key={} value={} successful (status: {:?})\", key, value, status);\n+            panic!(\"git config key={} value={} failed (status: {:?})\", key, value, status);\n         }\n     }\n \n-    // If changing anything here, then please check that src/ci/publish_toolstate.sh is up to date\n+    // If changing anything here, then please check that `src/ci/publish_toolstate.sh` is up to date\n     // as well.\n     git_config(\"user.email\", \"7378925+rust-toolstate-update@users.noreply.github.com\");\n     git_config(\"user.name\", \"Rust Toolstate Update\");\n@@ -382,7 +382,9 @@ fn commit_toolstate_change(current_toolstate: &ToolstateData) {\n     let message = format!(\"({} CI update)\", OS.expect(\"linux/windows only\"));\n     let mut success = false;\n     for _ in 1..=5 {\n-        // Update the toolstate results (the new commit-to-toolstate mapping) in the toolstate repo.\n+        // Upload the test results (the new commit-to-toolstate mapping) to the toolstate repo.\n+        // This does *not* change the \"current toolstate\"; that only happens post-landing\n+        // via `src/ci/docker/publish_toolstate.sh`.\n         change_toolstate(&current_toolstate);\n \n         // `git commit` failing means nothing to commit."}, {"sha": "691df04e754a6fac9d1ccb6824ec4d63b1ca2ed4", "filename": "src/ci/publish_toolstate.sh", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Fci%2Fpublish_toolstate.sh", "raw_url": "https://github.com/rust-lang/rust/raw/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Fci%2Fpublish_toolstate.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpublish_toolstate.sh?ref=a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "patch": "@@ -23,7 +23,9 @@ GIT_COMMIT_MSG=\"$(git log --format=%s -n1 HEAD)\"\n cd rust-toolstate\n FAILURE=1\n for RETRY_COUNT in 1 2 3 4 5; do\n-    #  The purpose is to publish the new \"current\" toolstate in the toolstate repo.\n+    # The purpose of this is to publish the new \"current\" toolstate in the toolstate repo.\n+    # This happens post-landing, on master.\n+    # (Publishing the per-commit test results happens pre-landing in src/bootstrap/toolstate.rs).\n     \"$(ciCheckoutPath)/src/tools/publish_toolstate.py\" \"$GIT_COMMIT\" \\\n         \"$GIT_COMMIT_MSG\" \\\n         \"$MESSAGE_FILE\" \\"}, {"sha": "b389cd0373cc4da052b52f36660472b1f98089a9", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/a6d8c9c5ebea585304df74bdf56cff186ad8ef1a/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=a6d8c9c5ebea585304df74bdf56cff186ad8ef1a", "patch": "@@ -1,11 +1,10 @@\n #!/usr/bin/env python\n # -*- coding: utf-8 -*-\n \n-# This script publishes the new \"current\" toolstate in the toolstate repo (not to be\n-# confused with publishing the test results, which happens in\n-# `src/ci/docker/x86_64-gnu-tools/checktools.sh`).\n-# It is set as callback for `src/ci/docker/x86_64-gnu-tools/repo.sh` by the CI scripts\n-# when a new commit lands on `master` (i.e., after it passed all checks on `auto`).\n+# This script computes the new \"current\" toolstate for the toolstate repo (not to be\n+# confused with publishing the test results, which happens in `src/bootstrap/toolstate.rs`).\n+# It gets called from `src/ci/publish_toolstate.sh` when a new commit lands on `master`\n+# (i.e., after it passed all checks on `auto`).\n \n from __future__ import print_function\n "}]}