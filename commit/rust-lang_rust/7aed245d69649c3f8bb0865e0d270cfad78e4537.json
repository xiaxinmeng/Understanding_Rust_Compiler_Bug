{"sha": "7aed245d69649c3f8bb0865e0d270cfad78e4537", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhZWQyNDVkNjk2NDljM2Y4YmIwODY1ZTBkMjcwY2ZhZDc4ZTQ1Mzc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-13T15:08:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-01-13T15:08:07Z"}, "message": "Auto merge of #30779 - michaelwoerister:closure-mir-in-metadata, r=nikomatsakis", "tree": {"sha": "845968fa147397168198b4c29e9e51b9b1fb52d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/845968fa147397168198b4c29e9e51b9b1fb52d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7aed245d69649c3f8bb0865e0d270cfad78e4537", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7aed245d69649c3f8bb0865e0d270cfad78e4537", "html_url": "https://github.com/rust-lang/rust/commit/7aed245d69649c3f8bb0865e0d270cfad78e4537", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7aed245d69649c3f8bb0865e0d270cfad78e4537/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d3c83fef245f1cb2e523c8913b8968c98faec1f4", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3c83fef245f1cb2e523c8913b8968c98faec1f4", "html_url": "https://github.com/rust-lang/rust/commit/d3c83fef245f1cb2e523c8913b8968c98faec1f4"}, {"sha": "c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8a547a638a4e651b89dd8d4a68563b30e50c6d3", "html_url": "https://github.com/rust-lang/rust/commit/c8a547a638a4e651b89dd8d4a68563b30e50c6d3"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "22da853dfedb5325902a4b0d629f56a3940fc7d1", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/7aed245d69649c3f8bb0865e0d270cfad78e4537/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7aed245d69649c3f8bb0865e0d270cfad78e4537/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=7aed245d69649c3f8bb0865e0d270cfad78e4537", "patch": "@@ -806,18 +806,18 @@ fn encode_inlined_item(ecx: &EncodeContext,\n     let eii: &mut EncodeInlinedItem = &mut *eii;\n     eii(ecx, rbml_w, ii);\n \n-    encode_mir(ecx, rbml_w, ii);\n-}\n-\n-fn encode_mir(ecx: &EncodeContext, rbml_w: &mut Encoder, ii: InlinedItemRef) {\n-    let id = match ii {\n+    let node_id = match ii {\n         InlinedItemRef::Item(item) => item.id,\n         InlinedItemRef::TraitItem(_, trait_item) => trait_item.id,\n         InlinedItemRef::ImplItem(_, impl_item) => impl_item.id,\n         InlinedItemRef::Foreign(foreign_item) => foreign_item.id\n     };\n \n-    if let Some(mir) = ecx.mir_map.get(&id) {\n+    encode_mir(ecx, rbml_w, node_id);\n+}\n+\n+fn encode_mir(ecx: &EncodeContext, rbml_w: &mut Encoder, node_id: NodeId) {\n+    if let Some(mir) = ecx.mir_map.get(&node_id) {\n         rbml_w.start_tag(tag_mir as usize);\n         rbml_w.emit_opaque(|opaque_encoder| {\n             tls::enter_encoding_context(ecx, opaque_encoder, |_, opaque_encoder| {\n@@ -1436,6 +1436,9 @@ fn my_visit_expr(expr: &hir::Expr,\n \n             ecx.tcx.map.with_path(expr.id, |path| encode_path(rbml_w, path));\n \n+            assert!(ecx.mir_map.contains_key(&expr.id));\n+            encode_mir(ecx, rbml_w, expr.id);\n+\n             rbml_w.end_tag();\n         }\n         _ => { }"}]}