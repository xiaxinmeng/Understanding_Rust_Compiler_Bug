{"sha": "4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8", "node_id": "C_kwDOAAsO6NoAKDRhNWQyYTU2MWM2ZjgyZjkyOGQ2ZjE0ZmU2ZThmOWFkMjQxNWI5YTg", "commit": {"author": {"name": "Ding Xiang Fei", "email": "dingxiangfei2009@protonmail.ch", "date": "2022-09-13T14:07:16Z"}, "committer": {"name": "Ding Xiang Fei", "email": "dingxiangfei2009@protonmail.ch", "date": "2022-09-15T02:08:14Z"}, "message": "add diagram to explain the MIR structure", "tree": {"sha": "063a71927fa6294c9f5f5fa5e4499f1c8511be45", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/063a71927fa6294c9f5f5fa5e4499f1c8511be45"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE0u8S3YU336XkLsQOPNdIZH7vY1kFAmMiiQ4ACgkQPNdIZH7v\nY1m9ag/9HN1eqz40PxGRnSfq6Gl0opNzJ+RHDp20+wz9QcMkB6ROb7PWVcAlg31a\nrJHkKI6Le7aCvOTnwXtPfbKdkm/lTbH9GwoQXRJaT1lVPOnKVIc8RtcpSSEPDEDz\nE/D1uXFdfn7L2/uAwBmPGa7r5PucVN/hjbd4btzLyUnT/Eo+pcyWlHc5A9gaM9lw\nnPMTmj1xW1Sd1BBJUkpyEoiS4KURejF4JVATZ7x6cXleDR3ZHWjnlnOZRIFUFl0A\nUxqG1UqskEs9aMwlZWBKiK+g3lcVf8BvdrEK+uEIAQRqYMWii2MQ5WbyogbEfWar\nJPP4Ld9122sje+iod+vdlq15Q4koqVF15RfuHQbh7Ym41fjKjiZKaBSVN7J4y2XI\ngiQhpKadFRHIf7z5VbC42nVX3vN7Z4pAu2QSt+XSaCU/YWYb0xsjcpcibV6yX40K\nTOIkV1q4qF493TOuYnkviUSz2Ctz5WNR5JUpEce96G21epNWX/gllh19UfZTYxuh\nT0i+2g7MRFijAyiKDuq11AY/F/EN8OSyUb/fdtqDjUVewzUH1fbOqh4qHGUqgSL1\n7JMKH1C6Kpc7VKTBfPuNFUkLopekRg/9XzVhN+j32Jh6Ckt5SJ9V0Il4lgV70S0f\npKKCKx+mjlhVhHMb7Cy0K9ZuaH2tYttPxilJevp9+viAs+AXovI=\n=6OcH\n-----END PGP SIGNATURE-----", "payload": "tree 063a71927fa6294c9f5f5fa5e4499f1c8511be45\nparent c7d1c9b66fdd1cbec64a7dc263557eee895b70ef\nauthor Ding Xiang Fei <dingxiangfei2009@protonmail.ch> 1663078036 +0800\ncommitter Ding Xiang Fei <dingxiangfei2009@protonmail.ch> 1663207694 +0800\n\nadd diagram to explain the MIR structure\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8", "html_url": "https://github.com/rust-lang/rust/commit/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8/comments", "author": {"login": "dingxiangfei2009", "id": 6884440, "node_id": "MDQ6VXNlcjY4ODQ0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6884440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dingxiangfei2009", "html_url": "https://github.com/dingxiangfei2009", "followers_url": "https://api.github.com/users/dingxiangfei2009/followers", "following_url": "https://api.github.com/users/dingxiangfei2009/following{/other_user}", "gists_url": "https://api.github.com/users/dingxiangfei2009/gists{/gist_id}", "starred_url": "https://api.github.com/users/dingxiangfei2009/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dingxiangfei2009/subscriptions", "organizations_url": "https://api.github.com/users/dingxiangfei2009/orgs", "repos_url": "https://api.github.com/users/dingxiangfei2009/repos", "events_url": "https://api.github.com/users/dingxiangfei2009/events{/privacy}", "received_events_url": "https://api.github.com/users/dingxiangfei2009/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dingxiangfei2009", "id": 6884440, "node_id": "MDQ6VXNlcjY4ODQ0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6884440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dingxiangfei2009", "html_url": "https://github.com/dingxiangfei2009", "followers_url": "https://api.github.com/users/dingxiangfei2009/followers", "following_url": "https://api.github.com/users/dingxiangfei2009/following{/other_user}", "gists_url": "https://api.github.com/users/dingxiangfei2009/gists{/gist_id}", "starred_url": "https://api.github.com/users/dingxiangfei2009/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dingxiangfei2009/subscriptions", "organizations_url": "https://api.github.com/users/dingxiangfei2009/orgs", "repos_url": "https://api.github.com/users/dingxiangfei2009/repos", "events_url": "https://api.github.com/users/dingxiangfei2009/events{/privacy}", "received_events_url": "https://api.github.com/users/dingxiangfei2009/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7d1c9b66fdd1cbec64a7dc263557eee895b70ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7d1c9b66fdd1cbec64a7dc263557eee895b70ef", "html_url": "https://github.com/rust-lang/rust/commit/c7d1c9b66fdd1cbec64a7dc263557eee895b70ef"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "7ab7870c4642f523226f32558b235bd41016804f", "filename": "compiler/rustc_mir_build/src/build/block.rs", "status": "modified", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fbuild%2Fblock.rs?ref=4a5d2a561c6f82f928d6f14fe6e8f9ad2415b9a8", "patch": "@@ -132,6 +132,59 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                     // failure in pattern matching.\n                     // For this reason, we declare those storages as live but we do not schedule\n                     // any drop yet- they are scheduled later after the pattern matching.\n+                    // The generated MIR will have `StorageDead` whenever the control flow breaks out\n+                    // of the parent scope, regardless of the result of the pattern matching.\n+                    // However, the drops are inserted in MIR only when the control flow breaks out of\n+                    // the scope of the remainder scope associated with this `let .. else` statement.\n+                    // Pictorial explanation of the scope structure:\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+                    // \u2502  Scope of the enclosing block,  \u2502\n+                    // \u2502  or the last remainder scope    \u2502\n+                    // \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n+                    // \u2502  \u2502  Scope for <else> block   \u2502  \u2502\n+                    // \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n+                    // \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n+                    // \u2502  \u2502  Remainder scope of       \u2502  \u2502\n+                    // \u2502  \u2502  this let-else statement  \u2502  \u2502\n+                    // \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n+                    // \u2502  \u2502  \u2502 <expr> scope        \u2502  \u2502  \u2502\n+                    // \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n+                    // \u2502  \u2502  extended temporaries in  \u2502  \u2502\n+                    // \u2502  \u2502  <expr> lives in this     \u2502  \u2502\n+                    // \u2502  \u2502  scope                    \u2502  \u2502\n+                    // \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n+                    // \u2502  \u2502  \u2502 Scopes for the rest \u2502  \u2502  \u2502\n+                    // \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n+                    // \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+                    // Generated control flow:\n+                    //          \u2502 let Some(x) = y() else { return; }\n+                    //          \u2502\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+                    // \u2502 evaluate y()   \u2502\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+                    //          \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502Drop temporaries\u2502\n+                    // \u2502Test the pattern\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u25bain y()          \u2502\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502because breaking\u2502\n+                    //          \u2502              \u2502out of <expr>   \u2502\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502scope           \u2502\n+                    // \u2502Move value into \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+                    // \u2502binding x       \u2502              \u2502\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+                    //          \u2502              \u2502Drop extended   \u2502\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502temporaries in  \u2502\n+                    // \u2502Drop temporaries\u2502      \u2502<expr> because  \u2502\n+                    // \u2502in y()          \u2502      \u2502breaking out of \u2502\n+                    // \u2502because breaking\u2502      \u2502remainder scope \u2502\n+                    // \u2502out of <expr>   \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+                    // \u2502scope           \u2502              \u2502\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n+                    //          \u2502              \u2502Enter <else>    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n+                    // \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502block           \u2502 return;\n+                    // \u2502Continue...     \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+                    // \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n+\n                     let ignores_expr_result = matches!(pattern.kind, PatKind::Wild);\n                     this.block_context.push(BlockFrame::Statement { ignores_expr_result });\n "}]}