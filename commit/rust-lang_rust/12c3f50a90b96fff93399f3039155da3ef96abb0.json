{"sha": "12c3f50a90b96fff93399f3039155da3ef96abb0", "node_id": "C_kwDOAAsO6NoAKDEyYzNmNTBhOTBiOTZmZmY5MzM5OWYzMDM5MTU1ZGEzZWY5NmFiYjA", "commit": {"author": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-09-27T21:03:08Z"}, "committer": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-09-27T22:11:21Z"}, "message": "PassWrapper: handle function rename from upstream D36850\n\nthinLTOResolvePrevailingInModule became thinLTOFinalizeInModule and\ngained the ability to propagate noRecurse and noUnwind function\nattributes. I ran codegen tests with it both on and off, as the upstream\npatch uses it in both modes, and the tests pass both ways. Given that,\nit seemed reasonable to go ahead and let the propagation be enabled in\nrustc, and see what happens. See https://reviews.llvm.org/D36850 for\nmore examples of how the new version of the function gets used.", "tree": {"sha": "c7a310ae4277aacb5f96a9e70cfd7a53f6ec6613", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c7a310ae4277aacb5f96a9e70cfd7a53f6ec6613"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/12c3f50a90b96fff93399f3039155da3ef96abb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/12c3f50a90b96fff93399f3039155da3ef96abb0", "html_url": "https://github.com/rust-lang/rust/commit/12c3f50a90b96fff93399f3039155da3ef96abb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/12c3f50a90b96fff93399f3039155da3ef96abb0/comments", "author": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "committer": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b6ed3b675475abc01ce7e68bb75b457f0c85684", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b6ed3b675475abc01ce7e68bb75b457f0c85684", "html_url": "https://github.com/rust-lang/rust/commit/2b6ed3b675475abc01ce7e68bb75b457f0c85684"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "ddb5f7dcebfad5777cb9e364513c53f40ab4294f", "filename": "compiler/rustc_llvm/llvm-wrapper/PassWrapper.cpp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/12c3f50a90b96fff93399f3039155da3ef96abb0/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/12c3f50a90b96fff93399f3039155da3ef96abb0/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp?ref=12c3f50a90b96fff93399f3039155da3ef96abb0", "patch": "@@ -1572,7 +1572,11 @@ extern \"C\" bool\n LLVMRustPrepareThinLTOResolveWeak(const LLVMRustThinLTOData *Data, LLVMModuleRef M) {\n   Module &Mod = *unwrap(M);\n   const auto &DefinedGlobals = Data->ModuleToDefinedGVSummaries.lookup(Mod.getModuleIdentifier());\n+#if LLVM_VERSION_GE(14, 0)\n+  thinLTOFinalizeInModule(Mod, DefinedGlobals, /*PropagateAttrs=*/true);\n+#else\n   thinLTOResolvePrevailingInModule(Mod, DefinedGlobals);\n+#endif\n   return true;\n }\n "}]}