{"sha": "eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViNWE0NjE3YTVlZjRjYjg4NDBhZTQwYTMxY2Q1NmY5ZWQyNDNlZTU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-05T18:13:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-05T18:13:44Z"}, "message": "Rollup merge of #46030 - Zoxc:asm-volatile, r=nikomatsakis\n\nMake inline assembly volatile if it has no outputs. Fixes #46026", "tree": {"sha": "4f5b7a52c2d54f3c65a375ab01cd0c82ce6ecece", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f5b7a52c2d54f3c65a375ab01cd0c82ce6ecece"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaeJ7YCRBK7hj4Ov3rIwAAdHIIAJNZDyefAzkzOlMAXIupcChR\n2G0L5hyk6OICvUQxfa0jufQzFmQEHxO2pGaN415lTqvq+sexBXGhvdYyNbe+A1TW\n4k/4yJJlpmuVQ2Hd2/+hNlRl4xymTEhwZ7EkHbdcXAJC6yhbLk2xOY8P0FfNw3Gx\nFcNbqn3kYyJACv64b10SrxEjSUmxMbnBHGau0B0p1XKSQm20emDfHJqO6aZZ7q//\nknYEapc5+jlSj2hlw0Wqxny2ujnj5gKBVVGmJFXpAzFmB0UvC/uqA/hbiebgnNYq\nQM7Mmsj5BVjrwDK+rWxEsCCDST+7P1sl6oj8hojk4PB5e43NWACS4SlgA4BpU8U=\n=7CqJ\n-----END PGP SIGNATURE-----\n", "payload": "tree 4f5b7a52c2d54f3c65a375ab01cd0c82ce6ecece\nparent 6c04c41034c46730fba97bfe9cfa2dd0687c2a5f\nparent a29d8545b573d008e364571a83fcd865748a8ad8\nauthor kennytm <kennytm@gmail.com> 1517854424 +0800\ncommitter GitHub <noreply@github.com> 1517854424 +0800\n\nRollup merge of #46030 - Zoxc:asm-volatile, r=nikomatsakis\n\nMake inline assembly volatile if it has no outputs. Fixes #46026\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "html_url": "https://github.com/rust-lang/rust/commit/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c04c41034c46730fba97bfe9cfa2dd0687c2a5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c04c41034c46730fba97bfe9cfa2dd0687c2a5f", "html_url": "https://github.com/rust-lang/rust/commit/6c04c41034c46730fba97bfe9cfa2dd0687c2a5f"}, {"sha": "a29d8545b573d008e364571a83fcd865748a8ad8", "url": "https://api.github.com/repos/rust-lang/rust/commits/a29d8545b573d008e364571a83fcd865748a8ad8", "html_url": "https://github.com/rust-lang/rust/commit/a29d8545b573d008e364571a83fcd865748a8ad8"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "d1de4dccd00430b4d3885c3635d7d556b1c1eb00", "filename": "src/libsyntax_ext/asm.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5/src%2Flibsyntax_ext%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5/src%2Flibsyntax_ext%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fasm.rs?ref=eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "patch": "@@ -239,6 +239,12 @@ pub fn expand_asm<'cx>(cx: &'cx mut ExtCtxt,\n         }\n     }\n \n+    // If there are no outputs, the inline assembly is executed just for its side effects,\n+    // so ensure that it is volatile\n+    if outputs.is_empty() {\n+        volatile = true;\n+    }\n+\n     MacEager::expr(P(ast::Expr {\n         id: ast::DUMMY_NODE_ID,\n         node: ast::ExprKind::InlineAsm(P(ast::InlineAsm {"}, {"sha": "457d706a8ffef21f6c6cbf9834cffa47596e7964", "filename": "src/test/codegen/no-output-asm-is-volatile.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fno-output-asm-is-volatile.rs?ref=eb5a4617a5ef4cb8840ae40a31cd56f9ed243ee5", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: -O\n+\n+// ignore-asmjs\n+\n+#![feature(asm)]\n+#![crate_type = \"lib\"]\n+\n+// Check that inline assembly expressions without any outputs\n+// are marked as having side effects / being volatile\n+\n+// CHECK-LABEL: @assembly\n+#[no_mangle]\n+pub fn assembly() {\n+    unsafe { asm!(\"\") }\n+// CHECK: tail call void asm sideeffect \"\", {{.*}}\n+}"}]}