{"sha": "0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlMWE0YTRkYTI5Y2FhZGJhNWQ1Y2Q4NmE1Y2QyNTg3ZmRiMDc1NWQ=", "commit": {"author": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-08-25T23:53:44Z"}, "committer": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-08-31T03:40:52Z"}, "message": "libcore: rewrite vec::unsafe::from_buf in pure rust", "tree": {"sha": "2f810735541c4c8c3b74070a1f733617e6a2845e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f810735541c4c8c3b74070a1f733617e6a2845e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "html_url": "https://github.com/rust-lang/rust/commit/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/comments", "author": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "536cb90a216a08870fbaac6aad93f77f0681537d", "url": "https://api.github.com/repos/rust-lang/rust/commits/536cb90a216a08870fbaac6aad93f77f0681537d", "html_url": "https://github.com/rust-lang/rust/commit/536cb90a216a08870fbaac6aad93f77f0681537d"}], "stats": {"total": 32, "additions": 7, "deletions": 25}, "files": [{"sha": "448678abf7c60f42d23251f77776f66d1098eec0", "filename": "src/libcore/vec.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Flibcore%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Flibcore%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fvec.rs?ref=0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "patch": "@@ -102,9 +102,6 @@ extern mod rustrt {\n     fn vec_reserve_shared(++t: *sys::TypeDesc,\n                           ++v: **unsafe::VecRepr,\n                           ++n: libc::size_t);\n-    fn vec_from_buf_shared(++t: *sys::TypeDesc,\n-                           ++ptr: *(),\n-                           ++count: libc::size_t) -> *unsafe::VecRepr;\n }\n \n #[abi = \"rust-intrinsic\"]\n@@ -1727,10 +1724,11 @@ mod unsafe {\n      */\n     #[inline(always)]\n     unsafe fn from_buf<T>(ptr: *T, elts: uint) -> ~[T] {\n-        return ::unsafe::reinterpret_cast(\n-            rustrt::vec_from_buf_shared(sys::get_type_desc::<T>(),\n-                                        ptr as *(),\n-                                        elts as size_t));\n+        let mut dst = ~[];\n+        reserve(dst, elts);\n+        set_len(dst, elts);\n+        as_buf(dst, |p_dst, _len_dst| ptr::memcpy(p_dst, ptr, elts));\n+        dst\n     }\n \n     /**"}, {"sha": "a74f5985d36c2eabd78243d5e6e37d52b50be733", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "patch": "@@ -148,22 +148,6 @@ str_reserve_shared(rust_vec_box** sp,\n     reserve_vec_exact(task, sp, n_elts + 1);\n }\n \n-/**\n- * Copies elements in an unsafe buffer to the given interior vector. The\n- * vector must have size zero.\n- */\n-extern \"C\" CDECL rust_vec_box*\n-vec_from_buf_shared(type_desc *ty, void *ptr, size_t count) {\n-    rust_task *task = rust_get_current_task();\n-    size_t fill = ty->size * count;\n-    rust_vec_box* v = (rust_vec_box*)\n-        task->kernel->malloc(fill + sizeof(rust_vec_box),\n-                             \"vec_from_buf\");\n-    v->body.fill = v->body.alloc = fill;\n-    memmove(&v->body.data[0], ptr, fill);\n-    return v;\n-}\n-\n extern \"C\" CDECL void\n rust_str_push(rust_vec_box** sp, uint8_t byte) {\n     rust_task *task = rust_get_current_task();\n@@ -515,8 +499,9 @@ void tm_to_rust_tm(tm* in_tm, rust_tm* out_tm, int32_t gmtoff,\n     out_tm->tm_nsec = nsec;\n \n     if (zone != NULL) {\n+        rust_task *task = rust_get_current_task();\n         size_t size = strlen(zone);\n-        str_reserve_shared(&out_tm->tm_zone, size);\n+        reserve_vec_exact(task, &out_tm->tm_zone, size + 1);\n         memcpy(out_tm->tm_zone->body.data, zone, size);\n         out_tm->tm_zone->body.fill = size + 1;\n         out_tm->tm_zone->body.data[size] = '\\0';"}, {"sha": "141937356e6e8be1e27b2c5f421915a9b4c5db66", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=0e1a4a4da29caadba5d5cd86a5cd2587fdb0755d", "patch": "@@ -63,7 +63,6 @@ start_task\n vec_reserve_shared_actual\n vec_reserve_shared\n str_reserve_shared\n-vec_from_buf_shared\n task_clear_event_reject\n task_wait_event\n task_signal_event"}]}