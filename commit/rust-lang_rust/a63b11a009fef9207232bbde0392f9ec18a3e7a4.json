{"sha": "a63b11a009fef9207232bbde0392f9ec18a3e7a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2M2IxMWEwMDlmZWY5MjA3MjMyYmJkZTAzOTJmOWVjMThhM2U3YTQ=", "commit": {"author": {"name": "ILyoan", "email": "ilyoan@gmail.com", "date": "2013-01-15T07:28:20Z"}, "committer": {"name": "ILyoan", "email": "ilyoan@gmail.com", "date": "2013-01-15T08:06:37Z"}, "message": "when test, just remove #[main] attr", "tree": {"sha": "25f0462becfcd046a269b1a5c08bc9b9d8d74215", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25f0462becfcd046a269b1a5c08bc9b9d8d74215"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a63b11a009fef9207232bbde0392f9ec18a3e7a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a63b11a009fef9207232bbde0392f9ec18a3e7a4", "html_url": "https://github.com/rust-lang/rust/commit/a63b11a009fef9207232bbde0392f9ec18a3e7a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a63b11a009fef9207232bbde0392f9ec18a3e7a4/comments", "author": {"login": "ILyoan", "id": 2672194, "node_id": "MDQ6VXNlcjI2NzIxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2672194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ILyoan", "html_url": "https://github.com/ILyoan", "followers_url": "https://api.github.com/users/ILyoan/followers", "following_url": "https://api.github.com/users/ILyoan/following{/other_user}", "gists_url": "https://api.github.com/users/ILyoan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ILyoan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ILyoan/subscriptions", "organizations_url": "https://api.github.com/users/ILyoan/orgs", "repos_url": "https://api.github.com/users/ILyoan/repos", "events_url": "https://api.github.com/users/ILyoan/events{/privacy}", "received_events_url": "https://api.github.com/users/ILyoan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ILyoan", "id": 2672194, "node_id": "MDQ6VXNlcjI2NzIxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2672194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ILyoan", "html_url": "https://github.com/ILyoan", "followers_url": "https://api.github.com/users/ILyoan/followers", "following_url": "https://api.github.com/users/ILyoan/following{/other_user}", "gists_url": "https://api.github.com/users/ILyoan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ILyoan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ILyoan/subscriptions", "organizations_url": "https://api.github.com/users/ILyoan/orgs", "repos_url": "https://api.github.com/users/ILyoan/repos", "events_url": "https://api.github.com/users/ILyoan/events{/privacy}", "received_events_url": "https://api.github.com/users/ILyoan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb8fd119c65c67f3b1b8268cc7341c22d39b7b61", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb8fd119c65c67f3b1b8268cc7341c22d39b7b61", "html_url": "https://github.com/rust-lang/rust/commit/eb8fd119c65c67f3b1b8268cc7341c22d39b7b61"}], "stats": {"total": 20, "additions": 8, "deletions": 12}, "files": [{"sha": "e89a0a8170135e99e6d8aa3a55033e6d2889ff52", "filename": "src/librustc/front/test.rs", "status": "modified", "additions": 8, "deletions": 12, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/a63b11a009fef9207232bbde0392f9ec18a3e7a4/src%2Flibrustc%2Ffront%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a63b11a009fef9207232bbde0392f9ec18a3e7a4/src%2Flibrustc%2Ffront%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ffront%2Ftest.rs?ref=a63b11a009fef9207232bbde0392f9ec18a3e7a4", "patch": "@@ -86,24 +86,20 @@ fn strip_test_functions(crate: @ast::crate) -> @ast::crate {\n \n fn fold_mod(cx: test_ctxt, m: ast::_mod, fld: fold::ast_fold) -> ast::_mod {\n \n-    // Remove any defined main function from the AST so it doesn't clash with\n+    // Remove any #[main] from the AST so it doesn't clash with\n     // the one we're going to add. Only if compiling an executable.\n \n-    fn nomain(cx: test_ctxt, item: @ast::item) -> Option<@ast::item> {\n-        match item.node {\n-          ast::item_fn(*) => {\n-            if attrs_contains_name(item.attrs, ~\"main\")\n-                    && !cx.sess.building_library {\n-                option::None\n-            } else { option::Some(item) }\n-          }\n-          _ => option::Some(item)\n-        }\n+    fn nomain(cx: test_ctxt, item: @ast::item) -> @ast::item {\n+        if !cx.sess.building_library {\n+            @ast::item{attrs: item.attrs.filtered(|attr| {\n+                               attr::get_attr_name(*attr) != ~\"main\"\n+                           }),.. copy *item}\n+        } else { item }\n     }\n \n     let mod_nomain =\n         {view_items: /*bad*/copy m.view_items,\n-         items: vec::filter_map(m.items, |i| nomain(cx, *i))};\n+         items: vec::map(m.items, |i| nomain(cx, *i))};\n     return fold::noop_fold_mod(mod_nomain, fld);\n }\n "}]}