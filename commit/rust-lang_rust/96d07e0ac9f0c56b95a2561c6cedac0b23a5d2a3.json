{"sha": "96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2ZDA3ZTBhYzlmMGM1NmI5NWEyNTYxYzZjZWRhYzBiMjNhNWQyYTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-09-15T16:21:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-09-15T16:21:34Z"}, "message": "Auto merge of #64474 - Mark-Simulacrum:permit-err-overlap, r=matthewjasper\n\nPermit impls referencing errors to overlap\n\nFixes #43400; previously this would emit an overlapping impls error, but no longer does.", "tree": {"sha": "552afbd527cd65a3ea1767ea3094b0b821824e67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/552afbd527cd65a3ea1767ea3094b0b821824e67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "html_url": "https://github.com/rust-lang/rust/commit/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60895fd1f9ad24ee41bb3dac67fc2c5f127ecdb4", "url": "https://api.github.com/repos/rust-lang/rust/commits/60895fd1f9ad24ee41bb3dac67fc2c5f127ecdb4", "html_url": "https://github.com/rust-lang/rust/commit/60895fd1f9ad24ee41bb3dac67fc2c5f127ecdb4"}, {"sha": "959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "url": "https://api.github.com/repos/rust-lang/rust/commits/959c710e8599f3c5d5c8ec1eddd4f536ffda654f", "html_url": "https://github.com/rust-lang/rust/commit/959c710e8599f3c5d5c8ec1eddd4f536ffda654f"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "17eb4a8957fd5cd409081e9938df571319a9a576", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "patch": "@@ -2894,6 +2894,13 @@ impl<'tcx> TyCtxt<'tcx> {\n     pub fn impls_are_allowed_to_overlap(self, def_id1: DefId, def_id2: DefId)\n                                         -> Option<ImplOverlapKind>\n     {\n+        // If either trait impl references an error, they're allowed to overlap,\n+        // as one of them essentially doesn't exist.\n+        if self.impl_trait_ref(def_id1).map_or(false, |tr| tr.references_error()) ||\n+            self.impl_trait_ref(def_id2).map_or(false, |tr| tr.references_error()) {\n+            return Some(ImplOverlapKind::Permitted);\n+        }\n+\n         let is_legit = if self.features().overlapping_marker_traits {\n             let trait1_is_empty = self.impl_trait_ref(def_id1)\n                 .map_or(false, |trait_ref| {"}, {"sha": "3e0234b874d7b6d8aebcc9a855bcac85ff321736", "filename": "src/test/ui/coherence/conflicting-impl-with-err.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.rs?ref=96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "patch": "@@ -0,0 +1,16 @@\n+struct ErrorKind;\n+struct Error(ErrorKind);\n+\n+impl From<nope::Thing> for Error { //~ ERROR failed to resolve\n+    fn from(_: nope::Thing) -> Self { //~ ERROR failed to resolve\n+        unimplemented!()\n+    }\n+}\n+\n+impl From<ErrorKind> for Error {\n+    fn from(_: ErrorKind) -> Self {\n+        unimplemented!()\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "a8a5730accdd8a4c28bc94861f3ee5a08304fab4", "filename": "src/test/ui/coherence/conflicting-impl-with-err.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcoherence%2Fconflicting-impl-with-err.stderr?ref=96d07e0ac9f0c56b95a2561c6cedac0b23a5d2a3", "patch": "@@ -0,0 +1,15 @@\n+error[E0433]: failed to resolve: use of undeclared type or module `nope`\n+  --> $DIR/conflicting-impl-with-err.rs:4:11\n+   |\n+LL | impl From<nope::Thing> for Error {\n+   |           ^^^^ use of undeclared type or module `nope`\n+\n+error[E0433]: failed to resolve: use of undeclared type or module `nope`\n+  --> $DIR/conflicting-impl-with-err.rs:5:16\n+   |\n+LL |     fn from(_: nope::Thing) -> Self {\n+   |                ^^^^ use of undeclared type or module `nope`\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0433`."}]}