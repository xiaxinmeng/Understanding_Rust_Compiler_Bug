{"sha": "4fcb617cbe6a92dabac763bd38862d2c40b4d247", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmY2I2MTdjYmU2YTkyZGFiYWM3NjNiZDM4ODYyZDJjNDBiNGQyNDc=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-11-15T02:02:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-15T02:02:53Z"}, "message": "Rollup merge of #78980 - thiolliere:gui-fix-qpath, r=estebank\n\nFix rustc_ast_pretty print_qpath resulting in invalid macro input\n\nrelated https://github.com/rust-lang/rust/issues/76874 (third case)\n\n### Issue:\n\nThe input for a procedural macro is incorrect, for the rust code:\n```rust\n\nmod m {\n    pub trait Tr {\n        type Ts: super::Tu;\n    }\n}\n\ntrait Tu {\n    fn dummy() { }\n}\n\n#[may_proc_macro]\nfn foo() {\n    <T as m::Tr>::Ts::dummy();\n}\n```\nthe macro will get the input:\n```rust\nfn foo() {\n    <T as m::Tr>::dummy();\n}\n```\nThus `Ts` has disappeared.\n\n### Fix:\n\nThis is due to invalid pretty print of qpath. This PR fix it.", "tree": {"sha": "995cc7ddde058a542fe0f67c0a7216daae41c6b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/995cc7ddde058a542fe0f67c0a7216daae41c6b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fcb617cbe6a92dabac763bd38862d2c40b4d247", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfsIxNCRBK7hj4Ov3rIwAAdHIIAH0UzOYW/ensrUWCunWlqEJl\nsMEqgVBb5AYt0xFtfRnK/WSKnZWHzt9ecTQOCOiKcu9XIWfI1mjRKzwJQUJymtkq\n3P57Qd7b66gzMaQOvFXpeu30BvyIeS7RKvMT8xcni1K8LIt0QCacIJXwZiRz4j6T\n75QZM6HixrgOb9CneKT2TpfhsDlUvDy0zg1rCLqji4ZaF18U1s63VTRtV5y9cJiA\ncU5wIYTX9vFx52IFbInC8n2+nbTwRLQi36EIsgCwxNTPlNXakCSt2K8RIvaT/U5u\nIKcYYkmQDrhzVqHBMUMW465SArlTktvIvJiCOlMV22j8ENDZXwzIYvgMy1nOhBw=\n=QfPK\n-----END PGP SIGNATURE-----\n", "payload": "tree 995cc7ddde058a542fe0f67c0a7216daae41c6b6\nparent 7e0441dc36d293ed93a41b93ddfa0ace05dec28b\nparent 775f1e5acdeae38eae7de41b22bdf6ab71e34efd\nauthor Dylan DPC <dylan.dpc@gmail.com> 1605405773 +0100\ncommitter GitHub <noreply@github.com> 1605405773 +0100\n\nRollup merge of #78980 - thiolliere:gui-fix-qpath, r=estebank\n\nFix rustc_ast_pretty print_qpath resulting in invalid macro input\n\nrelated https://github.com/rust-lang/rust/issues/76874 (third case)\n\n### Issue:\n\nThe input for a procedural macro is incorrect, for the rust code:\n```rust\n\nmod m {\n    pub trait Tr {\n        type Ts: super::Tu;\n    }\n}\n\ntrait Tu {\n    fn dummy() { }\n}\n\n#[may_proc_macro]\nfn foo() {\n    <T as m::Tr>::Ts::dummy();\n}\n```\nthe macro will get the input:\n```rust\nfn foo() {\n    <T as m::Tr>::dummy();\n}\n```\nThus `Ts` has disappeared.\n\n### Fix:\n\nThis is due to invalid pretty print of qpath. This PR fix it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fcb617cbe6a92dabac763bd38862d2c40b4d247", "html_url": "https://github.com/rust-lang/rust/commit/4fcb617cbe6a92dabac763bd38862d2c40b4d247", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fcb617cbe6a92dabac763bd38862d2c40b4d247/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e0441dc36d293ed93a41b93ddfa0ace05dec28b", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e0441dc36d293ed93a41b93ddfa0ace05dec28b", "html_url": "https://github.com/rust-lang/rust/commit/7e0441dc36d293ed93a41b93ddfa0ace05dec28b"}, {"sha": "775f1e5acdeae38eae7de41b22bdf6ab71e34efd", "url": "https://api.github.com/repos/rust-lang/rust/commits/775f1e5acdeae38eae7de41b22bdf6ab71e34efd", "html_url": "https://github.com/rust-lang/rust/commit/775f1e5acdeae38eae7de41b22bdf6ab71e34efd"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "958219cbebf3fd051faf3f242b0c6d9540c451e2", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4fcb617cbe6a92dabac763bd38862d2c40b4d247/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fcb617cbe6a92dabac763bd38862d2c40b4d247/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=4fcb617cbe6a92dabac763bd38862d2c40b4d247", "patch": "@@ -2327,11 +2327,12 @@ impl<'a> State<'a> {\n             self.print_path(path, false, depth);\n         }\n         self.s.word(\">\");\n-        self.s.word(\"::\");\n-        let item_segment = path.segments.last().unwrap();\n-        self.print_ident(item_segment.ident);\n-        if let Some(ref args) = item_segment.args {\n-            self.print_generic_args(args, colons_before_params)\n+        for item_segment in &path.segments[qself.position..] {\n+            self.s.word(\"::\");\n+            self.print_ident(item_segment.ident);\n+            if let Some(ref args) = item_segment.args {\n+                self.print_generic_args(args, colons_before_params)\n+            }\n         }\n     }\n "}, {"sha": "e06885e03882bc6d5d99a79b76c1d3b8b51a9b4e", "filename": "src/test/pretty/qpath-associated-type-bound.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4fcb617cbe6a92dabac763bd38862d2c40b4d247/src%2Ftest%2Fpretty%2Fqpath-associated-type-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fcb617cbe6a92dabac763bd38862d2c40b4d247/src%2Ftest%2Fpretty%2Fqpath-associated-type-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fpretty%2Fqpath-associated-type-bound.rs?ref=4fcb617cbe6a92dabac763bd38862d2c40b4d247", "patch": "@@ -0,0 +1,16 @@\n+// pp-exact\n+\n+\n+mod m {\n+    pub trait Tr {\n+        type Ts: super::Tu;\n+    }\n+}\n+\n+trait Tu {\n+    fn dummy() { }\n+}\n+\n+fn foo<T: m::Tr>() { <T as m::Tr>::Ts::dummy(); }\n+\n+fn main() { }"}]}