{"sha": "20231d774bcda2d6f9bd52fe402fd22f2d22d223", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMjMxZDc3NGJjZGEyZDZmOWJkNTJmZTQwMmZkMjJmMmQyMmQyMjM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-02T21:53:18Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-02T21:53:18Z"}, "message": "Fixed detection of test-fail for doctests.", "tree": {"sha": "e254a6c50ac2077333ea23d6737517146ac38551", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e254a6c50ac2077333ea23d6737517146ac38551"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20231d774bcda2d6f9bd52fe402fd22f2d22d223", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAls6ns8ACgkQ/vbIBR0O\nATx/+Q//RQWRMUCfRYmCzmC9+NI5Z7qyXIXVuFQb+5aHdCU9zTzliT3CVb4OsEjC\n8pXrMMVB1mIjMvq/Q4g6fpqQbO6xQra/+zKNIfAoUpzL/QpaQ9mL6ITu6shVMNh1\nh8c1u2giPUgdWSsWLbXUwpP/0g1iYKCrGxPlVaDdWMSz4irLM3l8H+hNTazc7DKg\nOSeVeaJsd2KTMBMh/Mrm6xE6g5KGEHJRi67xqcKNmvHbzrobBxePft0qE9REfmAx\n7R6E6j0FghlogWsGeRwKBOKNuI76oo7Sv+HDiG/pKJ/MQD5R0dYq5MzLkIuakMI0\n4bWqYpDMVxLxMZIP87JZWQn+jkdUPYEjkPn7ka9/PsnQ1oOOja3FfUlZmSzEfmxQ\nJ99gKBWhx6b3gmQVdJ2zYwAxZUYEjg94xIasoD3dDyZiNqwVfV/FqKm4doTbC6HK\n6o2U9MjfmbDnemXx9g7/00D42arNzZbR088SYzpBVPUiw7Rq/gWRPSOTDTM8yAPx\nDeswbKy5uxH13QIsY2HLz9MgEAB1HvbHSzgHC31aW29tIqqlKY21frBWQxZSE+y8\nF8LIxukYOy64kE6p5bVHZJOo9Jfw1GVugQ6ohx5seTO83c/OePL+/MQSwPRpaFRj\nlUBpSsprSf6RX55eh55we0nj4nPd6YQVVmDa22C+7zNP2rn5VB4=\n=IZrY\n-----END PGP SIGNATURE-----", "payload": "tree e254a6c50ac2077333ea23d6737517146ac38551\nparent d91457495b2f551e34ecbe1111885d6ccceceb15\nauthor kennytm <kennytm@gmail.com> 1530568398 +0800\ncommitter kennytm <kennytm@gmail.com> 1530568398 +0800\n\nFixed detection of test-fail for doctests.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20231d774bcda2d6f9bd52fe402fd22f2d22d223", "html_url": "https://github.com/rust-lang/rust/commit/20231d774bcda2d6f9bd52fe402fd22f2d22d223", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20231d774bcda2d6f9bd52fe402fd22f2d22d223/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d91457495b2f551e34ecbe1111885d6ccceceb15", "url": "https://api.github.com/repos/rust-lang/rust/commits/d91457495b2f551e34ecbe1111885d6ccceceb15", "html_url": "https://github.com/rust-lang/rust/commit/d91457495b2f551e34ecbe1111885d6ccceceb15"}], "stats": {"total": 14, "additions": 6, "deletions": 8}, "files": [{"sha": "3adfbb5e36b51d2088ba4f6aa7f18b11b21fc7b7", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/20231d774bcda2d6f9bd52fe402fd22f2d22d223/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20231d774bcda2d6f9bd52fe402fd22f2d22d223/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=20231d774bcda2d6f9bd52fe402fd22f2d22d223", "patch": "@@ -1269,17 +1269,15 @@ impl Step for DocTest {\n \n         files.sort();\n \n+        let mut toolstate = ToolState::TestPass;\n         for file in files {\n-            let test_result = markdown_test(builder, compiler, &file);\n-            if self.is_ext_doc {\n-                let toolstate = if test_result {\n-                    ToolState::TestPass\n-                } else {\n-                    ToolState::TestFail\n-                };\n-                builder.save_toolstate(self.name, toolstate);\n+            if !markdown_test(builder, compiler, &file) {\n+                toolstate = ToolState::TestFail;\n             }\n         }\n+        if self.is_ext_doc {\n+            builder.save_toolstate(self.name, toolstate);\n+        }\n     }\n }\n "}]}