{"sha": "af4acbe5e7e2295c42e50c83b029f7c4ce3b0931", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmNGFjYmU1ZTdlMjI5NWM0MmU1MGM4M2IwMjlmN2M0Y2UzYjA5MzE=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-05-31T20:17:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-31T20:17:14Z"}, "message": "Rollup merge of #51213 - nicokoch:copy_permissions, r=cramertj\n\nfs: copy: Use File::set_permissions instead of fs::set_permissions\n\nWe already got the open file descriptor at this point.\nDon't make the kernel resolve the path again.", "tree": {"sha": "800b5512a2842c62cf6ba790ec108f536878a9ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/800b5512a2842c62cf6ba790ec108f536878a9ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbEFhKCRBK7hj4Ov3rIwAAdHIIAKpUyK0mOIlp16g5QSM/nM7S\nPaFGXgjEG9opv9lMpldQnUboOgtnfyQIDElCUPddKQrX5q35pHtHweQvkYWFmqlP\nFpUgBh1Xef/iI4uZxRARcjRL9MRHnSOOaruTwC/NaI/6m/b9xU7vAHiHf3nyM7hb\nG9HqItY3TZR+zTWle8za7aHYiKbyodcyNKkOoutI+TrgqzUJxfThop8haLo1A7DD\njCfj1MudsUM5aQD/DFXwpG7B5Ccj1xTiGtbTGN+cWld/BY/tnYeNCGuVBLoJ0x8Q\nOAlnp/D3utSxF34vmMlf9k7+KiVxETj2J/Jh/nvAXWSZ0Q4TAw2FxKCPFXmJRQ4=\n=03nc\n-----END PGP SIGNATURE-----\n", "payload": "tree 800b5512a2842c62cf6ba790ec108f536878a9ad\nparent 8efecc110266dd614503f0a8b9c1a31d5b52a144\nparent c5ee3b6df1db2c4410b0e8d7a80a2885cf5628f1\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1527797834 +0200\ncommitter GitHub <noreply@github.com> 1527797834 +0200\n\nRollup merge of #51213 - nicokoch:copy_permissions, r=cramertj\n\nfs: copy: Use File::set_permissions instead of fs::set_permissions\n\nWe already got the open file descriptor at this point.\nDon't make the kernel resolve the path again.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931", "html_url": "https://github.com/rust-lang/rust/commit/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8efecc110266dd614503f0a8b9c1a31d5b52a144", "url": "https://api.github.com/repos/rust-lang/rust/commits/8efecc110266dd614503f0a8b9c1a31d5b52a144", "html_url": "https://github.com/rust-lang/rust/commit/8efecc110266dd614503f0a8b9c1a31d5b52a144"}, {"sha": "c5ee3b6df1db2c4410b0e8d7a80a2885cf5628f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5ee3b6df1db2c4410b0e8d7a80a2885cf5628f1", "html_url": "https://github.com/rust-lang/rust/commit/c5ee3b6df1db2c4410b0e8d7a80a2885cf5628f1"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "c4092dcd3889d40004c2a30284c57400dee4bd28", "filename": "src/libstd/sys/unix/fs.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931/src%2Flibstd%2Fsys%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af4acbe5e7e2295c42e50c83b029f7c4ce3b0931/src%2Flibstd%2Fsys%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Ffs.rs?ref=af4acbe5e7e2295c42e50c83b029f7c4ce3b0931", "patch": "@@ -817,7 +817,7 @@ pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {\n \n #[cfg(not(any(target_os = \"linux\", target_os = \"android\")))]\n pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n-    use fs::{File, set_permissions};\n+    use fs::File;\n     if !from.is_file() {\n         return Err(Error::new(ErrorKind::InvalidInput,\n                               \"the source path is not an existing regular file\"))\n@@ -828,14 +828,14 @@ pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n     let perm = reader.metadata()?.permissions();\n \n     let ret = io::copy(&mut reader, &mut writer)?;\n-    set_permissions(to, perm)?;\n+    writer.set_permissions(perm)?;\n     Ok(ret)\n }\n \n #[cfg(any(target_os = \"linux\", target_os = \"android\"))]\n pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n     use cmp;\n-    use fs::{File, set_permissions};\n+    use fs::File;\n     use sync::atomic::{AtomicBool, Ordering};\n \n     // Kernel prior to 4.5 don't have copy_file_range\n@@ -907,14 +907,14 @@ pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n                         // Try again with fallback method\n                         assert_eq!(written, 0);\n                         let ret = io::copy(&mut reader, &mut writer)?;\n-                        set_permissions(to, perm)?;\n+                        writer.set_permissions(perm)?;\n                         return Ok(ret)\n                     },\n                     _ => return Err(err),\n                 }\n             }\n         }\n     }\n-    set_permissions(to, perm)?;\n+    writer.set_permissions(perm)?;\n     Ok(written)\n }"}]}