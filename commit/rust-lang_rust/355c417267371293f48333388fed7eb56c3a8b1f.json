{"sha": "355c417267371293f48333388fed7eb56c3a8b1f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1NWM0MTcyNjczNzEyOTNmNDgzMzMzODhmZWQ3ZWI1NmMzYThiMWY=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-14T02:27:04Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-14T02:27:04Z"}, "message": "rustc: Add some interior vector spill code, untested as of yet", "tree": {"sha": "904f57aa87d8af05a179d867cadce9622ce1110d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/904f57aa87d8af05a179d867cadce9622ce1110d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/355c417267371293f48333388fed7eb56c3a8b1f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/355c417267371293f48333388fed7eb56c3a8b1f", "html_url": "https://github.com/rust-lang/rust/commit/355c417267371293f48333388fed7eb56c3a8b1f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/355c417267371293f48333388fed7eb56c3a8b1f/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3bf7d07e98109a1143567a3c658cadf387febeb", "url": "https://api.github.com/repos/rust-lang/rust/commits/c3bf7d07e98109a1143567a3c658cadf387febeb", "html_url": "https://github.com/rust-lang/rust/commit/c3bf7d07e98109a1143567a3c658cadf387febeb"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "411d72cc110d0d3f25c1402c291ba57de9fc1c1b", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/355c417267371293f48333388fed7eb56c3a8b1f/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/355c417267371293f48333388fed7eb56c3a8b1f/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=355c417267371293f48333388fed7eb56c3a8b1f", "patch": "@@ -585,12 +585,23 @@ upcall_ivec_resize(rust_task *task,\n     task->fail(4);\n }\n \n+/**\n+ * Spills an interior vector to the heap.\n+ */\n extern \"C\" CDECL void\n upcall_ivec_spill(rust_task *task,\n                   rust_ivec *v,\n                   size_t newsz) {\n-    // TODO\n-    task->fail(4);\n+    size_t new_alloc = next_power_of_two(newsz);\n+\n+    rust_ivec_heap *heap_part = (rust_ivec_heap *)\n+        task->malloc(new_alloc + sizeof(size_t));\n+    heap_part->fill = newsz;\n+    memcpy(&heap_part->data, v->payload.data, v->fill);\n+\n+    v->fill = 0;\n+    v->alloc = new_alloc;\n+    v->payload.ptr = heap_part;\n }\n \n //"}]}