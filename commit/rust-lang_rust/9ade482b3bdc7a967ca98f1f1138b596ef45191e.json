{"sha": "9ade482b3bdc7a967ca98f1f1138b596ef45191e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhZGU0ODJiM2JkYzdhOTY3Y2E5OGYxZjExMzhiNTk2ZWY0NTE5MWU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-15T17:12:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-15T17:12:55Z"}, "message": "auto merge of #21077 : eddyb/rust/expr-qpath, r=nikomatsakis\n\nWorking towards #16293, this adds support for `<T as Trait>::method` in expressions.", "tree": {"sha": "84335c40ee3bd03d89f14d22a8d60c479a0d2c51", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84335c40ee3bd03d89f14d22a8d60c479a0d2c51"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ade482b3bdc7a967ca98f1f1138b596ef45191e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ade482b3bdc7a967ca98f1f1138b596ef45191e", "html_url": "https://github.com/rust-lang/rust/commit/9ade482b3bdc7a967ca98f1f1138b596ef45191e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ade482b3bdc7a967ca98f1f1138b596ef45191e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c78ad937b4da9dd872b0a865025f3e2e885f90d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c78ad937b4da9dd872b0a865025f3e2e885f90d", "html_url": "https://github.com/rust-lang/rust/commit/1c78ad937b4da9dd872b0a865025f3e2e885f90d"}, {"sha": "85ba8178e2e995c0da6eb9268612baca8a6ba2e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/85ba8178e2e995c0da6eb9268612baca8a6ba2e3", "html_url": "https://github.com/rust-lang/rust/commit/85ba8178e2e995c0da6eb9268612baca8a6ba2e3"}], "stats": {"total": 343, "additions": 256, "deletions": 87}, "files": [{"sha": "59808b302f47dff362678a63eb41cf1b073fffbf", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -1731,7 +1731,7 @@ impl LintPass for Stability {\n         let mut span = e.span;\n \n         let id = match e.node {\n-            ast::ExprPath(..) | ast::ExprStruct(..) => {\n+            ast::ExprPath(..) | ast::ExprQPath(..) | ast::ExprStruct(..) => {\n                 match cx.tcx.def_map.borrow().get(&e.id) {\n                     Some(&def) => def.def_id(),\n                     None => return"}, {"sha": "07b520e5865b233b28e666d4b9dcfe1d32b7d118", "filename": "src/librustc/middle/cfg/construct.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -495,7 +495,8 @@ impl<'a, 'tcx> CFGBuilder<'a, 'tcx> {\n             ast::ExprMac(..) |\n             ast::ExprClosure(..) |\n             ast::ExprLit(..) |\n-            ast::ExprPath(..) => {\n+            ast::ExprPath(..) |\n+            ast::ExprQPath(..) => {\n                 self.straightline(expr, pred, None::<ast::Expr>.iter())\n             }\n         }"}, {"sha": "202020a9033ed9ced58f1411ddf0573dbcf9ef5a", "filename": "src/librustc/middle/check_const.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_const.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -111,7 +111,7 @@ fn check_expr(v: &mut CheckCrateVisitor, e: &ast::Expr) {\n                            expression\");\n             }\n         }\n-        ast::ExprPath(_) => {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => {\n             match v.tcx.def_map.borrow()[e.id] {\n                 DefStatic(..) | DefConst(..) |\n                 DefFn(..) | DefStaticMethod(..) | DefMethod(..) |"}, {"sha": "026aa3c5ccf837d710b72c5db398759c010aa9c1", "filename": "src/librustc/middle/check_static.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_static.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_static.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_static.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -228,7 +228,7 @@ impl<'a, 'tcx, 'v> Visitor<'v> for CheckStaticVisitor<'a, 'tcx> {\n                           \"{} are not allowed to have custom pointers\",\n                           self.msg());\n             }\n-            ast::ExprPath(..) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 match ty::resolve_expr(self.tcx, e) {\n                     def::DefStatic(..) if self.mode == InConstant => {\n                         let msg = \"constants cannot refer to other statics, \\"}, {"sha": "86a58dae45aa4c96676b6df893f1a8a2ba46a0c5", "filename": "src/librustc/middle/check_static_recursion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_static_recursion.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -93,7 +93,7 @@ impl<'a, 'ast, 'v> Visitor<'v> for CheckItemRecursionVisitor<'a, 'ast> {\n \n     fn visit_expr(&mut self, e: &ast::Expr) {\n         match e.node {\n-            ast::ExprPath(..) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 match self.def_map.borrow().get(&e.id) {\n                     Some(&DefStatic(def_id, _)) |\n                     Some(&DefConst(def_id)) if"}, {"sha": "c998d178c22459b8c91a898ab4544370eed060d4", "filename": "src/librustc/middle/const_eval.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fconst_eval.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -244,7 +244,7 @@ impl<'a, 'tcx> ConstEvalVisitor<'a, 'tcx> {\n \n             // FIXME: (#3728) we can probably do something CCI-ish\n             // surrounding nonlocal constants. But we don't yet.\n-            ast::ExprPath(_) => self.lookup_constness(e),\n+            ast::ExprPath(_) | ast::ExprQPath(_) => self.lookup_constness(e),\n \n             ast::ExprRepeat(..) => general_const,\n \n@@ -356,6 +356,13 @@ pub fn const_expr_to_pat(tcx: &ty::ctxt, expr: &Expr) -> P<ast::Pat> {\n             }\n         }\n \n+        ast::ExprQPath(_) => {\n+            match lookup_const(tcx, expr) {\n+                Some(actual) => return const_expr_to_pat(tcx, actual),\n+                _ => unreachable!()\n+            }\n+        }\n+\n         _ => ast::PatLit(P(expr.clone()))\n     };\n     P(ast::Pat { id: expr.id, node: pat, span: expr.span })\n@@ -542,7 +549,7 @@ pub fn eval_const_expr_partial(tcx: &ty::ctxt, e: &Expr) -> Result<const_val, St\n                 ty::ty_float(ast::TyF64) => (f64, const_float, f64)\n             }))\n       }\n-      ast::ExprPath(_) => {\n+      ast::ExprPath(_) | ast::ExprQPath(_) => {\n           match lookup_const(tcx, e) {\n               Some(actual_e) => eval_const_expr_partial(tcx, &*actual_e),\n               None => Err(\"non-constant path in constant expr\".to_string())"}, {"sha": "abb8f35f662b5e07604f03d873a7d0861a8b9c99", "filename": "src/librustc/middle/effect.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Feffect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Feffect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Feffect.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -175,7 +175,7 @@ impl<'a, 'tcx, 'v> Visitor<'v> for EffectCheckVisitor<'a, 'tcx> {\n             ast::ExprInlineAsm(..) => {\n                 self.require_unsafe(expr.span, \"use of inline assembly\");\n             }\n-            ast::ExprPath(..) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 if let def::DefStatic(_, true) = ty::resolve_expr(self.tcx, expr) {\n                     self.require_unsafe(expr.span, \"use of mutable static\");\n                 }"}, {"sha": "a5f2dc398e9e2fddb71b4a1ff81811a591a65d3d", "filename": "src/librustc/middle/expr_use_visitor.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -424,7 +424,7 @@ impl<'d,'t,'tcx,TYPER:mc::Typer<'tcx>> ExprUseVisitor<'d,'t,'tcx,TYPER> {\n                 self.walk_expr(&**subexpr)\n             }\n \n-            ast::ExprPath(..) => { }\n+            ast::ExprPath(_) | ast::ExprQPath(_) => { }\n \n             ast::ExprUnary(ast::UnDeref, ref base) => {      // *base\n                 if !self.walk_overloaded_operator(expr, &**base, Vec::new(), PassArgs::ByRef) {"}, {"sha": "6b9e5b2ceea3a6d4ba40df2e5724cc09717f9430", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -447,7 +447,7 @@ fn visit_arm(ir: &mut IrMaps, arm: &ast::Arm) {\n fn visit_expr(ir: &mut IrMaps, expr: &Expr) {\n     match expr.node {\n       // live nodes required for uses or definitions of variables:\n-      ast::ExprPath(_) => {\n+      ast::ExprPath(_) | ast::ExprQPath(_) => {\n         let def = ir.tcx.def_map.borrow()[expr.id].clone();\n         debug!(\"expr {}: path that leads to {:?}\", expr.id, def);\n         if let DefLocal(..) = def {\n@@ -960,7 +960,7 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n         match expr.node {\n           // Interesting cases with control flow or which gen/kill\n \n-          ast::ExprPath(_) => {\n+          ast::ExprPath(_) | ast::ExprQPath(_) => {\n               self.access_path(expr, succ, ACC_READ | ACC_USE)\n           }\n \n@@ -1289,7 +1289,7 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n         // just ignore such cases and treat them as reads.\n \n         match expr.node {\n-            ast::ExprPath(_) => succ,\n+            ast::ExprPath(_) | ast::ExprQPath(_) => succ,\n             ast::ExprField(ref e, _) => self.propagate_through_expr(&**e, succ),\n             ast::ExprTupField(ref e, _) => self.propagate_through_expr(&**e, succ),\n             _ => self.propagate_through_expr(expr, succ)\n@@ -1300,7 +1300,9 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n     fn write_lvalue(&mut self, expr: &Expr, succ: LiveNode, acc: uint)\n                     -> LiveNode {\n         match expr.node {\n-          ast::ExprPath(_) => self.access_path(expr, succ, acc),\n+          ast::ExprPath(_) | ast::ExprQPath(_) => {\n+              self.access_path(expr, succ, acc)\n+          }\n \n           // We do not track other lvalues, so just propagate through\n           // to their subcomponents.  Also, it may happen that\n@@ -1492,7 +1494,7 @@ fn check_expr(this: &mut Liveness, expr: &Expr) {\n       ast::ExprBlock(..) | ast::ExprMac(..) | ast::ExprAddrOf(..) |\n       ast::ExprStruct(..) | ast::ExprRepeat(..) | ast::ExprParen(..) |\n       ast::ExprClosure(..) | ast::ExprPath(..) | ast::ExprBox(..) |\n-      ast::ExprRange(..) => {\n+      ast::ExprRange(..) | ast::ExprQPath(..) => {\n         visit::walk_expr(this, expr);\n       }\n       ast::ExprIfLet(..) => {\n@@ -1583,7 +1585,7 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n \n     fn check_lvalue(&mut self, expr: &Expr) {\n         match expr.node {\n-            ast::ExprPath(_) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 if let DefLocal(nid) = self.ir.tcx.def_map.borrow()[expr.id].clone() {\n                     // Assignment to an immutable variable or argument: only legal\n                     // if there is no later assignment. If this local is actually"}, {"sha": "90fe6b4991138d3fd8b45072efd8cf63f228be30", "filename": "src/librustc/middle/mem_categorization.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -520,7 +520,7 @@ impl<'t,'tcx,TYPER:Typer<'tcx>> MemCategorizationContext<'t,TYPER> {\n             }\n           }\n \n-          ast::ExprPath(_) => {\n+          ast::ExprPath(_) | ast::ExprQPath(_) => {\n             let def = (*self.tcx().def_map.borrow())[expr.id];\n             self.cat_def(expr.id, expr.span, expr_ty, def)\n           }"}, {"sha": "b92870cfa42b0d181ce1e8f3be12771646bd588e", "filename": "src/librustc/middle/privacy.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fprivacy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fprivacy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fprivacy.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -920,7 +920,7 @@ impl<'a, 'tcx, 'v> Visitor<'v> for PrivacyVisitor<'a, 'tcx> {\n                                                             struct type?!\"),\n                 }\n             }\n-            ast::ExprPath(..) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 let guard = |&: did: ast::DefId| {\n                     let fields = ty::lookup_struct_fields(self.tcx, did);\n                     let any_priv = fields.iter().any(|f| {"}, {"sha": "b7e6da8c5f63aa29664cbaa9e7bfcd4a53fd20f4", "filename": "src/librustc/middle/reachable.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Freachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Freachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Freachable.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -104,7 +104,7 @@ impl<'a, 'tcx, 'v> Visitor<'v> for ReachableContext<'a, 'tcx> {\n     fn visit_expr(&mut self, expr: &ast::Expr) {\n \n         match expr.node {\n-            ast::ExprPath(_) => {\n+            ast::ExprPath(_) | ast::ExprQPath(_) => {\n                 let def = match self.tcx.def_map.borrow().get(&expr.id) {\n                     Some(&def) => def,\n                     None => {"}, {"sha": "525fe86cf24e6a710e712b7fd359d49bbcb42169", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -4515,7 +4515,7 @@ pub fn expr_kind(tcx: &ctxt, expr: &ast::Expr) -> ExprKind {\n     }\n \n     match expr.node {\n-        ast::ExprPath(..) => {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => {\n             match resolve_expr(tcx, expr) {\n                 def::DefVariant(tid, vid, _) => {\n                     let variant_info = enum_variant_with_id(tcx, tid, vid);"}, {"sha": "789a87bbcdafcd63a2f1aca5e8d2df7739e00223", "filename": "src/librustc_back/svh.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_back%2Fsvh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_back%2Fsvh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Fsvh.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -252,6 +252,7 @@ mod svh_visitor {\n         SawExprIndex,\n         SawExprRange,\n         SawExprPath,\n+        SawExprQPath,\n         SawExprAddrOf(ast::Mutability),\n         SawExprRet,\n         SawExprInlineAsm(&'a ast::InlineAsm),\n@@ -285,6 +286,7 @@ mod svh_visitor {\n             ExprIndex(..)            => SawExprIndex,\n             ExprRange(..)            => SawExprRange,\n             ExprPath(..)             => SawExprPath,\n+            ExprQPath(..)            => SawExprQPath,\n             ExprAddrOf(m, _)         => SawExprAddrOf(m),\n             ExprBreak(id)            => SawExprBreak(id.map(content)),\n             ExprAgain(id)            => SawExprAgain(id.map(content)),"}, {"sha": "7743a437858d2e97d3b4a350b8d81dfc7a750d4a", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 28, "deletions": 25, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -61,7 +61,7 @@ use rustc::util::lev_distance::lev_distance;\n use syntax::ast::{Arm, BindByRef, BindByValue, BindingMode, Block, Crate, CrateNum};\n use syntax::ast::{DefId, Expr, ExprAgain, ExprBreak, ExprField};\n use syntax::ast::{ExprClosure, ExprForLoop, ExprLoop, ExprWhile, ExprMethodCall};\n-use syntax::ast::{ExprPath, ExprStruct, FnDecl};\n+use syntax::ast::{ExprPath, ExprQPath, ExprStruct, FnDecl};\n use syntax::ast::{ForeignItemFn, ForeignItemStatic, Generics};\n use syntax::ast::{Ident, ImplItem, Item, ItemConst, ItemEnum, ItemFn};\n use syntax::ast::{ItemForeignMod, ItemImpl, ItemMac, ItemMod, ItemStatic};\n@@ -3169,7 +3169,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                     TraitImplementation        => \"implement\",\n                     TraitDerivation            => \"derive\",\n                     TraitObject                => \"reference\",\n-                    TraitQPath                 => \"extract an associated type from\",\n+                    TraitQPath                 => \"extract an associated item from\",\n                 };\n \n                 let msg = format!(\"attempt to {} a nonexistent trait `{}`\", usage_str, path_str);\n@@ -3565,31 +3565,17 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                     }\n                 }\n \n-                match result_def {\n-                    None => {\n-                        match self.resolve_path(ty.id, path, TypeNS, true) {\n-                            Some(def) => {\n-                                debug!(\"(resolving type) resolved `{:?}` to \\\n-                                        type {:?}\",\n-                                       token::get_ident(path.segments.last().unwrap() .identifier),\n-                                       def);\n-                                result_def = Some(def);\n-                            }\n-                            None => {\n-                                result_def = None;\n-                            }\n-                        }\n-                    }\n-                    Some(_) => {}   // Continue.\n+                if let None = result_def {\n+                    result_def = self.resolve_path(ty.id, path, TypeNS, true);\n                 }\n \n                 match result_def {\n                     Some(def) => {\n                         // Write the result into the def map.\n                         debug!(\"(resolving type) writing resolution for `{}` \\\n-                                (id {})\",\n+                                (id {}) = {:?}\",\n                                self.path_names_to_string(path),\n-                               path_id);\n+                               path_id, def);\n                         self.record_def(path_id, def);\n                     }\n                     None => {\n@@ -3609,6 +3595,12 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             TyQPath(ref qpath) => {\n                 self.resolve_type(&*qpath.self_type);\n                 self.resolve_trait_reference(ty.id, &*qpath.trait_ref, TraitQPath);\n+                for ty in qpath.item_path.parameters.types().into_iter() {\n+                    self.resolve_type(&**ty);\n+                }\n+                for binding in qpath.item_path.parameters.bindings().into_iter() {\n+                    self.resolve_type(&*binding.ty);\n+                }\n             }\n \n             TyPolyTraitRef(ref bounds) => {\n@@ -4400,15 +4392,25 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             // The interpretation of paths depends on whether the path has\n             // multiple elements in it or not.\n \n-            ExprPath(ref path) => {\n+            ExprPath(_) | ExprQPath(_) => {\n+                let mut path_from_qpath;\n+                let path = match expr.node {\n+                    ExprPath(ref path) => path,\n+                    ExprQPath(ref qpath) => {\n+                        self.resolve_type(&*qpath.self_type);\n+                        self.resolve_trait_reference(expr.id, &*qpath.trait_ref, TraitQPath);\n+                        path_from_qpath = qpath.trait_ref.path.clone();\n+                        path_from_qpath.segments.push(qpath.item_path.clone());\n+                        &path_from_qpath\n+                    }\n+                    _ => unreachable!()\n+                };\n                 // This is a local path in the value namespace. Walk through\n                 // scopes looking for it.\n-\n-                let path_name = self.path_names_to_string(path);\n-\n                 match self.resolve_path(expr.id, path, ValueNS, true) {\n                     // Check if struct variant\n                     Some((DefVariant(_, _, true), _)) => {\n+                        let path_name = self.path_names_to_string(path);\n                         self.resolve_error(expr.span,\n                                 format!(\"`{}` is a struct variant name, but \\\n                                          this expression \\\n@@ -4423,7 +4425,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                     Some(def) => {\n                         // Write the result into the def map.\n                         debug!(\"(resolving expr) resolved `{}`\",\n-                               path_name);\n+                               self.path_names_to_string(path));\n \n                         self.record_def(expr.id, def);\n                     }\n@@ -4432,6 +4434,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                         // (The pattern matching def_tys where the id is in self.structs\n                         // matches on regular structs while excluding tuple- and enum-like\n                         // structs, which wouldn't result in this error.)\n+                        let path_name = self.path_names_to_string(path);\n                         match self.with_no_errors(|this|\n                             this.resolve_path(expr.id, path, TypeNS, false)) {\n                             Some((DefTy(struct_id, _), _))"}, {"sha": "f2a67029170b756df54a1f049aa44ff60783fe71", "filename": "src/librustc_trans/save/mod.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Fsave%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fsave%2Fmod.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -767,7 +767,7 @@ impl <'l, 'tcx> DxrVisitor<'l, 'tcx> {\n                     span: Span,\n                     path: &ast::Path,\n                     ref_kind: Option<recorder::Row>) {\n-        if generated_code(path.span) {\n+        if generated_code(span) {\n             return\n         }\n \n@@ -1307,9 +1307,15 @@ impl<'l, 'tcx, 'v> Visitor<'v> for DxrVisitor<'l, 'tcx> {\n                 visit::walk_expr(self, ex);\n             },\n             ast::ExprPath(ref path) => {\n-                self.process_path(ex.id, ex.span, path, None);\n+                self.process_path(ex.id, path.span, path, None);\n                 visit::walk_path(self, path);\n             }\n+            ast::ExprQPath(ref qpath) => {\n+                let mut path = qpath.trait_ref.path.clone();\n+                path.segments.push(qpath.item_path.clone());\n+                self.process_path(ex.id, ex.span, &path, None);\n+                visit::walk_qpath(self, ex.span, &**qpath);\n+            }\n             ast::ExprStruct(ref path, ref fields, ref base) =>\n                 self.process_struct_lit(ex, path, fields, base),\n             ast::ExprMethodCall(_, _, ref args) => self.process_method_call(ex, args),\n@@ -1439,7 +1445,7 @@ impl<'l, 'tcx, 'v> Visitor<'v> for DxrVisitor<'l, 'tcx> {\n                                           \"\")\n                 }\n                 def::DefVariant(..) => {\n-                    paths_to_process.push((id, p.span, p.clone(), Some(ref_kind)))\n+                    paths_to_process.push((id, p.clone(), Some(ref_kind)))\n                 }\n                 // FIXME(nrc) what are these doing here?\n                 def::DefStatic(_, _) => {}\n@@ -1448,8 +1454,8 @@ impl<'l, 'tcx, 'v> Visitor<'v> for DxrVisitor<'l, 'tcx> {\n                             *def)\n             }\n         }\n-        for &(id, span, ref path, ref_kind) in paths_to_process.iter() {\n-            self.process_path(id, span, path, ref_kind);\n+        for &(id, ref path, ref_kind) in paths_to_process.iter() {\n+            self.process_path(id, path.span, path, ref_kind);\n         }\n         self.collecting = false;\n         self.collected_paths.clear();"}, {"sha": "b01604bd397532af2bf893c8caab5890ac287df1", "filename": "src/librustc_trans/trans/_match.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2F_match.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -1235,7 +1235,7 @@ pub fn trans_match<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n /// Checks whether the binding in `discr` is assigned to anywhere in the expression `body`\n fn is_discr_reassigned(bcx: Block, discr: &ast::Expr, body: &ast::Expr) -> bool {\n     let (vid, field) = match discr.node {\n-        ast::ExprPath(..) => match bcx.def(discr.id) {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => match bcx.def(discr.id) {\n             def::DefLocal(vid) | def::DefUpvar(vid, _, _) => (vid, None),\n             _ => return false\n         },"}, {"sha": "11006f37531d2b5ebcb90ddfa27c0379b5bcf782", "filename": "src/librustc_trans/trans/callee.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcallee.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -91,8 +91,11 @@ fn trans<'blk, 'tcx>(bcx: Block<'blk, 'tcx>, expr: &ast::Expr)\n     debug!(\"callee::trans(expr={})\", expr.repr(bcx.tcx()));\n \n     // pick out special kinds of expressions that can be called:\n-    if let ast::ExprPath(_) = expr.node {\n-        return trans_def(bcx, bcx.def(expr.id), expr);\n+    match expr.node {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => {\n+            return trans_def(bcx, bcx.def(expr.id), expr);\n+        }\n+        _ => {}\n     }\n \n     // any other expressions are closures:"}, {"sha": "29cf9f72ef8e88e6d6f06ce974ece47a272b5428", "filename": "src/librustc_trans/trans/consts.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fconsts.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -600,7 +600,7 @@ fn const_expr_unadjusted(cx: &CrateContext, e: &ast::Expr) -> ValueRef {\n                 C_array(llunitty, &vs[])\n             }\n           }\n-          ast::ExprPath(_) => {\n+          ast::ExprPath(_) | ast::ExprQPath(_) => {\n             let def = cx.tcx().def_map.borrow()[e.id];\n             match def {\n                 def::DefFn(..) | def::DefStaticMethod(..) | def::DefMethod(..) => {"}, {"sha": "d5416ae0631fcde6dc36d96865031a0d1e4002bf", "filename": "src/librustc_trans/trans/debuginfo.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -3526,7 +3526,8 @@ fn create_scope_map(cx: &CrateContext,\n             ast::ExprLit(_)   |\n             ast::ExprBreak(_) |\n             ast::ExprAgain(_) |\n-            ast::ExprPath(_)  => {}\n+            ast::ExprPath(_)  |\n+            ast::ExprQPath(_) => {}\n \n             ast::ExprCast(ref sub_exp, _)     |\n             ast::ExprAddrOf(_, ref sub_exp)  |"}, {"sha": "0e921d8e5228373e3bd407c91e86bb0c61760567", "filename": "src/librustc_trans/trans/expr.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_trans%2Ftrans%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fexpr.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -564,7 +564,7 @@ fn trans_datum_unadjusted<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n         ast::ExprParen(ref e) => {\n             trans(bcx, &**e)\n         }\n-        ast::ExprPath(_) => {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => {\n             trans_def(bcx, expr, bcx.def(expr.id))\n         }\n         ast::ExprField(ref base, ident) => {\n@@ -997,7 +997,7 @@ fn trans_rvalue_dps_unadjusted<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n         ast::ExprParen(ref e) => {\n             trans_into(bcx, &**e, dest)\n         }\n-        ast::ExprPath(_) => {\n+        ast::ExprPath(_) | ast::ExprQPath(_) => {\n             trans_def_dps_unadjusted(bcx, expr, bcx.def(expr.id), dest)\n         }\n         ast::ExprIf(ref cond, ref thn, ref els) => {"}, {"sha": "27d31a3a2f7288674a4e9a2ae1d174981232e580", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -1001,9 +1001,12 @@ fn qpath_to_ty<'tcx>(this: &AstConv<'tcx>,\n \n     debug!(\"qpath_to_ty: trait_ref={}\", trait_ref.repr(this.tcx()));\n \n+    // `<T as Trait>::U<V>` shouldn't parse right now.\n+    assert!(qpath.item_path.parameters.is_empty());\n+\n     return this.projected_ty(ast_ty.span,\n                              trait_ref,\n-                             qpath.item_name.name);\n+                             qpath.item_path.identifier.name);\n }\n \n // Parses the programmer's textual representation of a type into our"}, {"sha": "47346592c86bb859220ba8186d4470cf6002952b", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -467,7 +467,7 @@ pub fn check_pat_struct<'a, 'tcx>(pcx: &pat_ctxt<'a, 'tcx>, pat: &ast::Pat,\n     };\n \n     instantiate_path(pcx.fcx, path, ty::lookup_item_type(tcx, enum_def_id),\n-                     def, pat.span, pat.id);\n+                     None, def, pat.span, pat.id);\n \n     let pat_ty = fcx.node_ty(pat.id);\n     demand::eqtype(fcx, pat.span, expected, pat_ty);\n@@ -505,7 +505,7 @@ pub fn check_pat_enum<'a, 'tcx>(pcx: &pat_ctxt<'a, 'tcx>, pat: &ast::Pat,\n     } else {\n         ctor_scheme\n     };\n-    instantiate_path(pcx.fcx, path, path_scheme, def, pat.span, pat.id);\n+    instantiate_path(pcx.fcx, path, path_scheme, None, def, pat.span, pat.id);\n \n     let pat_ty = fcx.node_ty(pat.id);\n     demand::eqtype(fcx, pat.span, expected, pat_ty);"}, {"sha": "e4c333a0e1ea593a96f2591ff651c4d6401b63e0", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -3553,10 +3553,25 @@ fn check_expr_with_unifier<'a, 'tcx, F>(fcx: &FnCtxt<'a, 'tcx>,\n         };\n         fcx.write_ty(id, oprnd_t);\n       }\n-      ast::ExprPath(ref pth) => {\n-          let defn = lookup_def(fcx, pth.span, id);\n+      ast::ExprPath(ref path) => {\n+          let defn = lookup_def(fcx, path.span, id);\n           let pty = type_scheme_for_def(fcx, expr.span, defn);\n-          instantiate_path(fcx, pth, pty, defn, expr.span, expr.id);\n+          instantiate_path(fcx, path, pty, None, defn, expr.span, expr.id);\n+\n+          // We always require that the type provided as the value for\n+          // a type parameter outlives the moment of instantiation.\n+          constrain_path_type_parameters(fcx, expr);\n+      }\n+      ast::ExprQPath(ref qpath) => {\n+          // Require explicit type params for the trait.\n+          let self_ty = fcx.to_ty(&*qpath.self_type);\n+          astconv::instantiate_trait_ref(fcx, fcx, &*qpath.trait_ref, Some(self_ty), None);\n+\n+          let defn = lookup_def(fcx, expr.span, id);\n+          let pty = type_scheme_for_def(fcx, expr.span, defn);\n+          let mut path = qpath.trait_ref.path.clone();\n+          path.segments.push(qpath.item_path.clone());\n+          instantiate_path(fcx, &path, pty, Some(self_ty), defn, expr.span, expr.id);\n \n           // We always require that the type provided as the value for\n           // a type parameter outlives the moment of instantiation.\n@@ -4619,6 +4634,7 @@ pub fn type_scheme_for_def<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n pub fn instantiate_path<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n                                   path: &ast::Path,\n                                   type_scheme: TypeScheme<'tcx>,\n+                                  opt_self_ty: Option<Ty<'tcx>>,\n                                   def: def::Def,\n                                   span: Span,\n                                   node_id: ast::NodeId) {\n@@ -4776,6 +4792,11 @@ pub fn instantiate_path<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n             }\n         }\n     }\n+    if let Some(self_ty) = opt_self_ty {\n+        // `<T as Trait>::foo` shouldn't have resolved to a `Self`-less item.\n+        assert_eq!(type_defs.len(subst::SelfSpace), 1);\n+        substs.types.push(subst::SelfSpace, self_ty);\n+    }\n \n     // Now we have to compare the types that the user *actually*\n     // provided against the types that were *expected*. If the user"}, {"sha": "8dc3adad3b27a010feae9758f61c427960daaf76", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -1614,7 +1614,7 @@ impl<'tcx> Clean<Type> for ty::Ty<'tcx> {\n impl Clean<Type> for ast::QPath {\n     fn clean(&self, cx: &DocContext) -> Type {\n         Type::QPath {\n-            name: self.item_name.clean(cx),\n+            name: self.item_path.identifier.clean(cx),\n             self_type: box self.self_type.clean(cx),\n             trait_: box self.trait_ref.clean(cx)\n         }"}, {"sha": "61bc1865517f6cf5157c557fa7f1d0648e662aaa", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -747,6 +747,8 @@ pub enum Expr_ {\n     /// Variable reference, possibly containing `::` and/or\n     /// type parameters, e.g. foo::bar::<baz>\n     ExprPath(Path),\n+    /// A \"qualified path\", e.g. `<Vec<T> as SomeTrait>::SomeType`\n+    ExprQPath(P<QPath>),\n \n     ExprAddrOf(Mutability, P<Expr>),\n     ExprBreak(Option<Ident>),\n@@ -771,12 +773,12 @@ pub enum Expr_ {\n ///\n ///     <Vec<T> as SomeTrait>::SomeAssociatedItem\n ///      ^~~~~     ^~~~~~~~~   ^~~~~~~~~~~~~~~~~~\n-///      self_type  trait_name  item_name\n+///      self_type  trait_name  item_path\n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable, Hash, Show)]\n pub struct QPath {\n     pub self_type: P<Ty>,\n     pub trait_ref: P<TraitRef>,\n-    pub item_name: Ident, // FIXME(#20301) -- should use Name\n+    pub item_path: PathSegment,\n }\n \n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable, Hash, Show, Copy)]"}, {"sha": "2a7043492959fb925027541dc583a5b478a6e2c2", "filename": "src/libsyntax/fold.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffold.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -454,7 +454,10 @@ pub fn noop_fold_qpath<T: Folder>(qpath: P<QPath>, fld: &mut T) -> P<QPath> {\n         QPath {\n             self_type: fld.fold_ty(qpath.self_type),\n             trait_ref: qpath.trait_ref.map(|tr| fld.fold_trait_ref(tr)),\n-            item_name: fld.fold_ident(qpath.item_name),\n+            item_path: PathSegment {\n+                identifier: fld.fold_ident(qpath.item_path.identifier),\n+                parameters: fld.fold_path_parameters(qpath.item_path.parameters),\n+            }\n         }\n     })\n }\n@@ -1381,6 +1384,7 @@ pub fn noop_fold_expr<T: Folder>(Expr {id, node, span}: Expr, folder: &mut T) ->\n                           e2.map(|x| folder.fold_expr(x)))\n             }\n             ExprPath(pth) => ExprPath(folder.fold_path(pth)),\n+            ExprQPath(qpath) => ExprQPath(folder.fold_qpath(qpath)),\n             ExprBreak(opt_ident) => ExprBreak(opt_ident.map(|x| folder.fold_ident(x))),\n             ExprAgain(opt_ident) => ExprAgain(opt_ident.map(|x| folder.fold_ident(x))),\n             ExprRet(e) => ExprRet(e.map(|x| folder.fold_expr(x))),"}, {"sha": "543b746849955d4f83558acaa07c848043f1f6ec", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 37, "deletions": 7, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -25,7 +25,7 @@ use ast::{ExprAssign, ExprAssignOp, ExprBinary, ExprBlock, ExprBox};\n use ast::{ExprBreak, ExprCall, ExprCast};\n use ast::{ExprField, ExprTupField, ExprClosure, ExprIf, ExprIfLet, ExprIndex};\n use ast::{ExprLit, ExprLoop, ExprMac, ExprRange};\n-use ast::{ExprMethodCall, ExprParen, ExprPath};\n+use ast::{ExprMethodCall, ExprParen, ExprPath, ExprQPath};\n use ast::{ExprRepeat, ExprRet, ExprStruct, ExprTup, ExprUnary};\n use ast::{ExprVec, ExprWhile, ExprWhileLet, ExprForLoop, Field, FnDecl};\n use ast::{FnUnboxedClosureKind, FnMutUnboxedClosureKind};\n@@ -1573,7 +1573,10 @@ impl<'a> Parser<'a> {\n             TyQPath(P(QPath {\n                 self_type: self_type,\n                 trait_ref: P(trait_ref),\n-                item_name: item_name,\n+                item_path: ast::PathSegment {\n+                    identifier: item_name,\n+                    parameters: ast::PathParameters::none()\n+                }\n             }))\n         } else if self.check(&token::ModSep) ||\n                   self.token.is_ident() ||\n@@ -1894,11 +1897,7 @@ impl<'a> Parser<'a> {\n             if !self.eat(&token::ModSep) {\n                 segments.push(ast::PathSegment {\n                     identifier: identifier,\n-                    parameters: ast::AngleBracketedParameters(ast::AngleBracketedParameterData {\n-                        lifetimes: Vec::new(),\n-                        types: OwnedSlice::empty(),\n-                        bindings: OwnedSlice::empty(),\n-                    })\n+                    parameters: ast::PathParameters::none()\n                 });\n                 return segments;\n             }\n@@ -2253,6 +2252,37 @@ impl<'a> Parser<'a> {\n                 hi = self.last_span.hi;\n             }\n             _ => {\n+                if self.eat_lt() {\n+                    // QUALIFIED PATH `<TYPE as TRAIT_REF>::item::<'a, T>`\n+                    let self_type = self.parse_ty_sum();\n+                    self.expect_keyword(keywords::As);\n+                    let trait_ref = self.parse_trait_ref();\n+                    self.expect(&token::Gt);\n+                    self.expect(&token::ModSep);\n+                    let item_name = self.parse_ident();\n+                    let parameters = if self.eat(&token::ModSep) {\n+                        self.expect_lt();\n+                        // Consumed `item::<`, go look for types\n+                        let (lifetimes, types, bindings) =\n+                            self.parse_generic_values_after_lt();\n+                        ast::AngleBracketedParameters(ast::AngleBracketedParameterData {\n+                            lifetimes: lifetimes,\n+                            types: OwnedSlice::from_vec(types),\n+                            bindings: OwnedSlice::from_vec(bindings),\n+                        })\n+                    } else {\n+                        ast::PathParameters::none()\n+                    };\n+                    let hi = self.span.hi;\n+                    return self.mk_expr(lo, hi, ExprQPath(P(QPath {\n+                        self_type: self_type,\n+                        trait_ref: P(trait_ref),\n+                        item_path: ast::PathSegment {\n+                            identifier: item_name,\n+                            parameters: parameters\n+                        }\n+                    })));\n+                }\n                 if self.eat_keyword(keywords::Move) {\n                     return self.parse_lambda_expr(CaptureByValue);\n                 }"}, {"sha": "ec6672d22a97a3dd9ba1b3f704c043ba99c0c16f", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 18, "deletions": 8, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -727,14 +727,7 @@ impl<'a> State<'a> {\n                 try!(self.print_bounds(\"\", &bounds[]));\n             }\n             ast::TyQPath(ref qpath) => {\n-                try!(word(&mut self.s, \"<\"));\n-                try!(self.print_type(&*qpath.self_type));\n-                try!(space(&mut self.s));\n-                try!(self.word_space(\"as\"));\n-                try!(self.print_trait_ref(&*qpath.trait_ref));\n-                try!(word(&mut self.s, \">\"));\n-                try!(word(&mut self.s, \"::\"));\n-                try!(self.print_ident(qpath.item_name));\n+                try!(self.print_qpath(&**qpath, false))\n             }\n             ast::TyFixedLengthVec(ref ty, ref v) => {\n                 try!(word(&mut self.s, \"[\"));\n@@ -1749,6 +1742,7 @@ impl<'a> State<'a> {\n                 }\n             }\n             ast::ExprPath(ref path) => try!(self.print_path(path, true)),\n+            ast::ExprQPath(ref qpath) => try!(self.print_qpath(&**qpath, true)),\n             ast::ExprBreak(opt_ident) => {\n                 try!(word(&mut self.s, \"break\"));\n                 try!(space(&mut self.s));\n@@ -1933,6 +1927,22 @@ impl<'a> State<'a> {\n         Ok(())\n     }\n \n+    fn print_qpath(&mut self,\n+                   qpath: &ast::QPath,\n+                   colons_before_params: bool)\n+                   -> IoResult<()>\n+    {\n+        try!(word(&mut self.s, \"<\"));\n+        try!(self.print_type(&*qpath.self_type));\n+        try!(space(&mut self.s));\n+        try!(self.word_space(\"as\"));\n+        try!(self.print_trait_ref(&*qpath.trait_ref));\n+        try!(word(&mut self.s, \">\"));\n+        try!(word(&mut self.s, \"::\"));\n+        try!(self.print_ident(qpath.item_path.identifier));\n+        self.print_path_parameters(&qpath.item_path.parameters, colons_before_params)\n+    }\n+\n     fn print_path_parameters(&mut self,\n                              parameters: &ast::PathParameters,\n                              colons_before_params: bool)"}, {"sha": "7778b4fa34aa1e7c19c258dbba2f10ec30c0cf0b", "filename": "src/libsyntax/visit.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Flibsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fvisit.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -126,6 +126,9 @@ pub trait Visitor<'v> : Sized {\n     fn visit_path(&mut self, path: &'v Path, _id: ast::NodeId) {\n         walk_path(self, path)\n     }\n+    fn visit_qpath(&mut self, qpath_span: Span, qpath: &'v QPath) {\n+        walk_qpath(self, qpath_span, qpath)\n+    }\n     fn visit_path_segment(&mut self, path_span: Span, path_segment: &'v PathSegment) {\n         walk_path_segment(self, path_span, path_segment)\n     }\n@@ -419,9 +422,7 @@ pub fn walk_ty<'v, V: Visitor<'v>>(visitor: &mut V, typ: &'v Ty) {\n             walk_ty_param_bounds_helper(visitor, bounds);\n         }\n         TyQPath(ref qpath) => {\n-            visitor.visit_ty(&*qpath.self_type);\n-            visitor.visit_trait_ref(&*qpath.trait_ref);\n-            visitor.visit_ident(typ.span, qpath.item_name);\n+            visitor.visit_qpath(typ.span, &**qpath);\n         }\n         TyFixedLengthVec(ref ty, ref expression) => {\n             visitor.visit_ty(&**ty);\n@@ -450,6 +451,14 @@ pub fn walk_path<'v, V: Visitor<'v>>(visitor: &mut V, path: &'v Path) {\n     }\n }\n \n+pub fn walk_qpath<'v, V: Visitor<'v>>(visitor: &mut V,\n+                                      qpath_span: Span,\n+                                      qpath: &'v QPath) {\n+    visitor.visit_ty(&*qpath.self_type);\n+    visitor.visit_trait_ref(&*qpath.trait_ref);\n+    visitor.visit_path_segment(qpath_span, &qpath.item_path);\n+}\n+\n pub fn walk_path_segment<'v, V: Visitor<'v>>(visitor: &mut V,\n                                              path_span: Span,\n                                              segment: &'v PathSegment) {\n@@ -881,6 +890,9 @@ pub fn walk_expr<'v, V: Visitor<'v>>(visitor: &mut V, expression: &'v Expr) {\n         ExprPath(ref path) => {\n             visitor.visit_path(path, expression.id)\n         }\n+        ExprQPath(ref qpath) => {\n+            visitor.visit_qpath(expression.span, &**qpath)\n+        }\n         ExprBreak(_) | ExprAgain(_) => {}\n         ExprRet(ref optional_expression) => {\n             walk_expr_opt(visitor, optional_expression)"}, {"sha": "5fa66eb98e1af47f33625facccae8107559e1f47", "filename": "src/test/compile-fail/ufcs-qpath-missing-params.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-missing-params.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-missing-params.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-missing-params.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::borrow::IntoCow;\n+\n+fn main() {\n+    <String as IntoCow>::into_cow(\"foo\".to_string());\n+    //~^ ERROR wrong number of type arguments: expected 2, found 0\n+}\n+"}, {"sha": "868c1eae4a9e1fd80c868847aba8e576885c8f29", "filename": "src/test/compile-fail/ufcs-qpath-self-mismatch.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-self-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-self-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fufcs-qpath-self-mismatch.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::ops::Add;\n+\n+fn main() {\n+    <i32 as Add<u32>>::add(1, 2);\n+    //~^ ERROR the trait `core::ops::Add<u32>` is not implemented for the type `i32`\n+    <i32 as Add<i32>>::add(1u32, 2);\n+    //~^ ERROR mismatched types\n+    <i32 as Add<i32>>::add(1, 2u32);\n+    //~^ ERROR mismatched types\n+}\n+"}, {"sha": "f8f92a56adb1a687c65033f37c1747f13b9a74d0", "filename": "src/test/run-pass/const-polymorphic-paths.rs", "status": "modified", "additions": 27, "deletions": 3, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Frun-pass%2Fconst-polymorphic-paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ade482b3bdc7a967ca98f1f1138b596ef45191e/src%2Ftest%2Frun-pass%2Fconst-polymorphic-paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fconst-polymorphic-paths.rs?ref=9ade482b3bdc7a967ca98f1f1138b596ef45191e", "patch": "@@ -10,9 +10,11 @@\n \n #![feature(macro_rules)]\n \n+use std::borrow::{Cow, IntoCow};\n use std::collections::Bitv;\n use std::default::Default;\n use std::iter::FromIterator;\n+use std::ops::Add;\n use std::option::IntoIter as OptionIter;\n use std::rand::Rand;\n use std::rand::XorShiftRng as DummyRng;\n@@ -28,6 +30,11 @@ fn u8_as_i8(x: u8) -> i8 { x as i8 }\n fn odd(x: uint) -> bool { x % 2 == 1 }\n fn dummy_rng() -> DummyRng { DummyRng::new_unseeded() }\n \n+trait Size: Sized {\n+    fn size() -> uint { std::mem::size_of::<Self>() }\n+}\n+impl<T> Size for T {}\n+\n macro_rules! tests {\n     ($($expr:expr, $ty:ty, ($($test:expr),*);)+) => (pub fn main() {$({\n         const C: $ty = $expr;\n@@ -70,14 +77,31 @@ tests! {\n     //    , (vec![b'f', b'o', b'o'], u8_as_i8);\n \n     // Trait static methods.\n-    // FIXME qualified path expressions aka UFCS i.e. <T as Trait>::method.\n+    <bool as Size>::size, fn() -> uint, ();\n     Default::default, fn() -> int, ();\n+    <int as Default>::default, fn() -> int, ();\n     Rand::rand, fn(&mut DummyRng) -> int, (&mut dummy_rng());\n+    <int as Rand>::rand, fn(&mut DummyRng) -> int, (&mut dummy_rng());\n     Rand::rand::<DummyRng>, fn(&mut DummyRng) -> int, (&mut dummy_rng());\n+    <int as Rand>::rand::<DummyRng>, fn(&mut DummyRng) -> int, (&mut dummy_rng());\n \n     // Trait non-static methods.\n     Clone::clone, fn(&int) -> int, (&5);\n+    <int as Clone>::clone, fn(&int) -> int, (&5);\n     FromIterator::from_iter, fn(OptionIter<int>) -> Vec<int>, (Some(5).into_iter());\n-    FromIterator::from_iter::<OptionIter<int>>, fn(OptionIter<int>) -> Vec<int>\n-       , (Some(5).into_iter());\n+    <Vec<_> as FromIterator<_>>::from_iter, fn(OptionIter<int>) -> Vec<int>,\n+        (Some(5).into_iter());\n+    <Vec<int> as FromIterator<_>>::from_iter, fn(OptionIter<int>) -> Vec<int>,\n+        (Some(5).into_iter());\n+    FromIterator::from_iter::<OptionIter<int>>, fn(OptionIter<int>) -> Vec<int>,\n+        (Some(5).into_iter());\n+    <Vec<int> as FromIterator<_>>::from_iter::<OptionIter<int>>, fn(OptionIter<int>) -> Vec<int>,\n+        (Some(5).into_iter());\n+    Add::add, fn(i32, i32) -> i32, (5, 6);\n+    <i32 as Add<_>>::add, fn(i32, i32) -> i32, (5, 6);\n+    <i32 as Add<i32>>::add, fn(i32, i32) -> i32, (5, 6);\n+    <String as IntoCow<_, _>>::into_cow, fn(String) -> Cow<'static, String, str>,\n+        (\"foo\".to_string());\n+    <String as IntoCow<'static, _, _>>::into_cow, fn(String) -> Cow<'static, String, str>,\n+        (\"foo\".to_string());\n }"}]}