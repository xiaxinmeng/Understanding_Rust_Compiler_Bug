{"sha": "935830d05bcf5f0c648e636dcbc8848a201467c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzNTgzMGQwNWJjZjVmMGM2NDhlNjM2ZGNiYzg4NDhhMjAxNDY3YzA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-12T18:20:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-12T18:20:27Z"}, "message": "Merge #7655\n\n7655: Include a commit log summary in the changelog r=matklad a=lnicola\n\nThis version omits any direct pushes, and maybe even pull requests merged from the GitHub UI. But I think it makes writing the release notes easier.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "ff289b26eb96e2dd9fdfaf24f5c73f0f2487a2d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff289b26eb96e2dd9fdfaf24f5c73f0f2487a2d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/935830d05bcf5f0c648e636dcbc8848a201467c0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgJsbrCRBK7hj4Ov3rIwAAdHIIAE/inKVlZfwCfcf+IFOG18nL\n6zVbb9cGPNBjIc2Rw2NrNk6KGPYmenHOid6+08lRLqulGF96jn/f+9bheB49p5gS\nerhkEAYPJwjEH4bHwH/DSR5o4f8Kk+PkIPd0lmjyygGnanR/umX7U/B/WdYxq5L6\nZWGk04V6rRa11SOFLNFnVWfQyDVer/2SNCpsg4a9t+oKn70sICSTfS4uDOzSWr6d\nCN24GqI1ke8GstGh621K1ExfMY3n4AduBp0/iSt8PRLL6qLy3YXuUuzg0pI/iKLA\nbHFjGz2/8uTjfGcgF9E1OOWC4PiaQGVYUSMl/lphvwv90UjXfFgMqnbWhu1H51I=\n=bkVd\n-----END PGP SIGNATURE-----\n", "payload": "tree ff289b26eb96e2dd9fdfaf24f5c73f0f2487a2d1\nparent 88253907f4bc3beaa7b8f2e58cb652f653f92d56\nparent 8814d1368d6712fd85074d77e33be610f01566c4\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1613154027 +0000\ncommitter GitHub <noreply@github.com> 1613154027 +0000\n\nMerge #7655\n\n7655: Include a commit log summary in the changelog r=matklad a=lnicola\n\nThis version omits any direct pushes, and maybe even pull requests merged from the GitHub UI. But I think it makes writing the release notes easier.\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/935830d05bcf5f0c648e636dcbc8848a201467c0", "html_url": "https://github.com/rust-lang/rust/commit/935830d05bcf5f0c648e636dcbc8848a201467c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/935830d05bcf5f0c648e636dcbc8848a201467c0/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88253907f4bc3beaa7b8f2e58cb652f653f92d56", "url": "https://api.github.com/repos/rust-lang/rust/commits/88253907f4bc3beaa7b8f2e58cb652f653f92d56", "html_url": "https://github.com/rust-lang/rust/commit/88253907f4bc3beaa7b8f2e58cb652f653f92d56"}, {"sha": "8814d1368d6712fd85074d77e33be610f01566c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8814d1368d6712fd85074d77e33be610f01566c4", "html_url": "https://github.com/rust-lang/rust/commit/8814d1368d6712fd85074d77e33be610f01566c4"}], "stats": {"total": 58, "additions": 33, "deletions": 25}, "files": [{"sha": "d6fae52959aaa5638bc46ccca51d0075cbd398b3", "filename": "docs/dev/README.md", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/935830d05bcf5f0c648e636dcbc8848a201467c0/docs%2Fdev%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/935830d05bcf5f0c648e636dcbc8848a201467c0/docs%2Fdev%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2FREADME.md?ref=935830d05bcf5f0c648e636dcbc8848a201467c0", "patch": "@@ -218,8 +218,7 @@ Release steps:\n      * makes a GitHub release\n      * pushes VS Code extension to the marketplace\n    * create new changelog in `rust-analyzer.github.io`\n-   * create `rust-analyzer.github.io/git.log` file with the log of merge commits since last release\n-2. While the release is in progress, fill-in the changelog using `git.log`\n+2. While the release is in progress, fill in the changelog\n 3. Commit & push the changelog\n 4. Tweet\n 5. Inside `rust-analyzer`, run `cargo xtask promote` -- this will create a PR to rust-lang/rust updating rust-analyzer's submodule."}, {"sha": "63556476ddfab346a66035ff35edfb6d9b26f146", "filename": "xtask/src/release.rs", "status": "modified", "additions": 32, "deletions": 23, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/935830d05bcf5f0c648e636dcbc8848a201467c0/xtask%2Fsrc%2Frelease.rs", "raw_url": "https://github.com/rust-lang/rust/raw/935830d05bcf5f0c648e636dcbc8848a201467c0/xtask%2Fsrc%2Frelease.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Frelease.rs?ref=935830d05bcf5f0c648e636dcbc8848a201467c0", "patch": "@@ -1,3 +1,5 @@\n+use std::fmt::Write;\n+\n use xshell::{cmd, cp, pushd, read_dir, write_file};\n \n use crate::{codegen, date_iso, is_release_tag, project_root, Mode, Result};\n@@ -24,6 +26,34 @@ impl ReleaseCmd {\n         let commit = cmd!(\"git rev-parse HEAD\").read()?;\n         let changelog_n = read_dir(changelog_dir.as_path())?.len();\n \n+        for &adoc in [\n+            \"manual.adoc\",\n+            \"generated_assists.adoc\",\n+            \"generated_config.adoc\",\n+            \"generated_diagnostic.adoc\",\n+            \"generated_features.adoc\",\n+        ]\n+        .iter()\n+        {\n+            let src = project_root().join(\"./docs/user/\").join(adoc);\n+            let dst = website_root.join(adoc);\n+            cp(src, dst)?;\n+        }\n+\n+        let tags = cmd!(\"git tag --list\").read()?;\n+        let prev_tag = tags.lines().filter(|line| is_release_tag(line)).last().unwrap();\n+\n+        let git_log = cmd!(\"git log {prev_tag}..HEAD --merges --reverse\").read()?;\n+        let mut git_log_summary = String::new();\n+        for line in git_log.lines() {\n+            let line = line.trim_start();\n+            if let Some(p) = line.find(':') {\n+                if let Ok(pr) = line[..p].parse::<u32>() {\n+                    writeln!(git_log_summary, \"* pr:{}[]{}\", pr, &line[p + 1..]).unwrap();\n+                }\n+            }\n+        }\n+\n         let contents = format!(\n             \"\\\n = Changelog #{}\n@@ -40,39 +70,18 @@ https://github.com/sponsors/rust-analyzer[GitHub Sponsors].\n \n == New Features\n \n-* pr:[] .\n+{}\n \n == Fixes\n \n == Internal Improvements\n \",\n-            changelog_n, commit, today\n+            changelog_n, commit, today, git_log_summary\n         );\n \n         let path = changelog_dir.join(format!(\"{}-changelog-{}.adoc\", today, changelog_n));\n         write_file(&path, &contents)?;\n \n-        for &adoc in [\n-            \"manual.adoc\",\n-            \"generated_assists.adoc\",\n-            \"generated_config.adoc\",\n-            \"generated_diagnostic.adoc\",\n-            \"generated_features.adoc\",\n-        ]\n-        .iter()\n-        {\n-            let src = project_root().join(\"./docs/user/\").join(adoc);\n-            let dst = website_root.join(adoc);\n-            cp(src, dst)?;\n-        }\n-\n-        let tags = cmd!(\"git tag --list\").read()?;\n-        let prev_tag = tags.lines().filter(|line| is_release_tag(line)).last().unwrap();\n-\n-        let git_log = cmd!(\"git log {prev_tag}..HEAD --merges --reverse\").read()?;\n-        let git_log_dst = website_root.join(\"git.log\");\n-        write_file(git_log_dst, &git_log)?;\n-\n         Ok(())\n     }\n }"}]}