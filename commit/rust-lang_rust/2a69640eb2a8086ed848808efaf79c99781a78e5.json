{"sha": "2a69640eb2a8086ed848808efaf79c99781a78e5", "node_id": "C_kwDOAAsO6NoAKDJhNjk2NDBlYjJhODA4NmVkODQ4ODA4ZWZhZjc5Yzk5NzgxYTc4ZTU", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-27T13:08:02Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-30T07:59:21Z"}, "message": "lint: port enum intrinsics diagnostics\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "e990e95251a1b75cde6517798dba30f6e6586bac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e990e95251a1b75cde6517798dba30f6e6586bac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a69640eb2a8086ed848808efaf79c99781a78e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a69640eb2a8086ed848808efaf79c99781a78e5", "html_url": "https://github.com/rust-lang/rust/commit/2a69640eb2a8086ed848808efaf79c99781a78e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a69640eb2a8086ed848808efaf79c99781a78e5/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f4c4c5e1842f63ab869d75ea8c891078a64ca55", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f4c4c5e1842f63ab869d75ea8c891078a64ca55", "html_url": "https://github.com/rust-lang/rust/commit/0f4c4c5e1842f63ab869d75ea8c891078a64ca55"}], "stats": {"total": 38, "additions": 15, "deletions": 23}, "files": [{"sha": "2ad077514c853168008b93a728ab741f5c3c4ff9", "filename": "compiler/rustc_error_messages/locales/en-US/lint.ftl", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2a69640eb2a8086ed848808efaf79c99781a78e5/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/2a69640eb2a8086ed848808efaf79c99781a78e5/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl?ref=2a69640eb2a8086ed848808efaf79c99781a78e5", "patch": "@@ -4,3 +4,11 @@ lint-array-into-iter =\n     .remove-into-iter-suggestion = or remove `.into_iter()` to iterate by value\n     .use-explicit-into-iter-suggestion =\n         or use `IntoIterator::into_iter(..)` instead of `.into_iter()` to explicitly iterate by value\n+\n+lint-enum-intrinsics-mem-discriminant =\n+    the return value of `mem::discriminant` is unspecified when called with a non-enum type\n+    .note = the argument to `discriminant` should be a reference to an enum, but it was passed a reference to a `{$ty_param}`, which is not an enum.\n+\n+lint-enum-intrinsics-mem-variant =\n+    the return value of `mem::variant_count` is unspecified when called with a non-enum type\n+    .note = the type parameter of `variant_count` should be an enum, but it was instantiated with the type `{$ty_param}`, which is not an enum."}, {"sha": "5d212768d0d8bf68c867fca07b71495867891c50", "filename": "compiler/rustc_lint/src/enum_intrinsics_non_enums.rs", "status": "modified", "additions": 7, "deletions": 23, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/2a69640eb2a8086ed848808efaf79c99781a78e5/compiler%2Frustc_lint%2Fsrc%2Fenum_intrinsics_non_enums.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a69640eb2a8086ed848808efaf79c99781a78e5/compiler%2Frustc_lint%2Fsrc%2Fenum_intrinsics_non_enums.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fenum_intrinsics_non_enums.rs?ref=2a69640eb2a8086ed848808efaf79c99781a78e5", "patch": "@@ -1,4 +1,5 @@\n use crate::{context::LintContext, LateContext, LateLintPass};\n+use rustc_errors::fluent;\n use rustc_hir as hir;\n use rustc_middle::ty::{fold::TypeFoldable, Ty};\n use rustc_span::{symbol::sym, Span};\n@@ -51,19 +52,9 @@ fn enforce_mem_discriminant(\n     if is_non_enum(ty_param) {\n         cx.struct_span_lint(ENUM_INTRINSICS_NON_ENUMS, expr_span, |builder| {\n             builder\n-                .build(\n-                    \"the return value of `mem::discriminant` is \\\n-                        unspecified when called with a non-enum type\",\n-                )\n-                .span_note(\n-                    args_span,\n-                    &format!(\n-                        \"the argument to `discriminant` should be a \\\n-                            reference to an enum, but it was passed \\\n-                            a reference to a `{}`, which is not an enum.\",\n-                        ty_param,\n-                    ),\n-                )\n+                .build(fluent::lint::enum_intrinsics_mem_discriminant)\n+                .set_arg(\"ty_param\", ty_param)\n+                .span_note(args_span, fluent::lint::note)\n                 .emit();\n         });\n     }\n@@ -74,16 +65,9 @@ fn enforce_mem_variant_count(cx: &LateContext<'_>, func_expr: &hir::Expr<'_>, sp\n     if is_non_enum(ty_param) {\n         cx.struct_span_lint(ENUM_INTRINSICS_NON_ENUMS, span, |builder| {\n             builder\n-                .build(\n-                    \"the return value of `mem::variant_count` is \\\n-                        unspecified when called with a non-enum type\",\n-                )\n-                .note(&format!(\n-                    \"the type parameter of `variant_count` should \\\n-                            be an enum, but it was instantiated with \\\n-                            the type `{}`, which is not an enum.\",\n-                    ty_param,\n-                ))\n+                .build(fluent::lint::enum_intrinsics_mem_variant)\n+                .set_arg(\"ty_param\", ty_param)\n+                .note(fluent::lint::note)\n                 .emit();\n         });\n     }"}]}