{"sha": "5b447701028a74bc47d42045fd5448fe9eaf806f", "node_id": "C_kwDOAAsO6NoAKDViNDQ3NzAxMDI4YTc0YmM0N2Q0MjA0NWZkNTQ0OGZlOWVhZjgwNmY", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T10:24:48Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-10T10:24:48Z"}, "message": "move test", "tree": {"sha": "d7651245593b799317a211f3f87b8ba940f61497", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d7651245593b799317a211f3f87b8ba940f61497"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b447701028a74bc47d42045fd5448fe9eaf806f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b447701028a74bc47d42045fd5448fe9eaf806f", "html_url": "https://github.com/rust-lang/rust/commit/5b447701028a74bc47d42045fd5448fe9eaf806f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b447701028a74bc47d42045fd5448fe9eaf806f/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e255e9577f672fb6aff6004a88ed3e520f6c8326", "url": "https://api.github.com/repos/rust-lang/rust/commits/e255e9577f672fb6aff6004a88ed3e520f6c8326", "html_url": "https://github.com/rust-lang/rust/commit/e255e9577f672fb6aff6004a88ed3e520f6c8326"}], "stats": {"total": 137, "additions": 41, "deletions": 96}, "files": [{"sha": "b028cf25e0d0d3b35c4aeaffca57e7569cd4502b", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/5b447701028a74bc47d42045fd5448fe9eaf806f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b447701028a74bc47d42045fd5448fe9eaf806f/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=5b447701028a74bc47d42045fd5448fe9eaf806f", "patch": "@@ -1427,3 +1427,44 @@ macro_rules! foo {\n \"#]],\n     );\n }\n+\n+// The following tests are based on real world situations\n+#[test]\n+fn test_vec() {\n+    check(\n+        r#\"\n+macro_rules! vec {\n+   ($($item:expr),*) => {{\n+           let mut v = Vec::new();\n+           $( v.push($item); )*\n+           v\n+    }};\n+}\n+fn main() {\n+    vec!();\n+    vec![1u32,2];\n+}\n+\"#,\n+        expect![[r#\"\n+macro_rules! vec {\n+   ($($item:expr),*) => {{\n+           let mut v = Vec::new();\n+           $( v.push($item); )*\n+           v\n+    }};\n+}\n+fn main() {\n+     {\n+        let mut v = Vec::new();\n+        v\n+    };\n+     {\n+        let mut v = Vec::new();\n+        v.push(1u32);\n+        v.push(2);\n+        v\n+    };\n+}\n+\"#]],\n+    );\n+}"}, {"sha": "9c0f5273f0c724816c32933e296e509c65bc0167", "filename": "crates/mbe/src/tests/expand.rs", "status": "modified", "additions": 0, "deletions": 96, "changes": 96, "blob_url": "https://github.com/rust-lang/rust/blob/5b447701028a74bc47d42045fd5448fe9eaf806f/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b447701028a74bc47d42045fd5448fe9eaf806f/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftests%2Fexpand.rs?ref=5b447701028a74bc47d42045fd5448fe9eaf806f", "patch": "@@ -98,102 +98,6 @@ fn test_attr_to_token_tree() {\n     );\n }\n \n-// The following tests are based on real world situations\n-#[test]\n-fn test_vec() {\n-    let fixture = parse_macro(\n-        r#\"\n-         macro_rules! vec {\n-            ($($item:expr),*) => {\n-                {\n-                    let mut v = Vec::new();\n-                    $(\n-                        v.push($item);\n-                    )*\n-                    v\n-                }\n-            };\n-}\n-\"#,\n-    );\n-    fixture\n-        .assert_expand_items(r#\"vec!();\"#, r#\"{let mut v = Vec :: new () ; v}\"#)\n-        .assert_expand_items(\n-            r#\"vec![1u32,2];\"#,\n-            r#\"{let mut v = Vec :: new () ; v . push (1u32) ; v . push (2) ; v}\"#,\n-        );\n-\n-    let tree = fixture.expand_expr(r#\"vec![1u32,2];\"#);\n-\n-    assert_eq_text!(\n-        &format!(\"{:#?}\", tree),\n-        r#\"BLOCK_EXPR@0..45\n-  STMT_LIST@0..45\n-    L_CURLY@0..1 \"{\"\n-    LET_STMT@1..20\n-      LET_KW@1..4 \"let\"\n-      IDENT_PAT@4..8\n-        MUT_KW@4..7 \"mut\"\n-        NAME@7..8\n-          IDENT@7..8 \"v\"\n-      EQ@8..9 \"=\"\n-      CALL_EXPR@9..19\n-        PATH_EXPR@9..17\n-          PATH@9..17\n-            PATH@9..12\n-              PATH_SEGMENT@9..12\n-                NAME_REF@9..12\n-                  IDENT@9..12 \"Vec\"\n-            COLON2@12..14 \"::\"\n-            PATH_SEGMENT@14..17\n-              NAME_REF@14..17\n-                IDENT@14..17 \"new\"\n-        ARG_LIST@17..19\n-          L_PAREN@17..18 \"(\"\n-          R_PAREN@18..19 \")\"\n-      SEMICOLON@19..20 \";\"\n-    EXPR_STMT@20..33\n-      METHOD_CALL_EXPR@20..32\n-        PATH_EXPR@20..21\n-          PATH@20..21\n-            PATH_SEGMENT@20..21\n-              NAME_REF@20..21\n-                IDENT@20..21 \"v\"\n-        DOT@21..22 \".\"\n-        NAME_REF@22..26\n-          IDENT@22..26 \"push\"\n-        ARG_LIST@26..32\n-          L_PAREN@26..27 \"(\"\n-          LITERAL@27..31\n-            INT_NUMBER@27..31 \"1u32\"\n-          R_PAREN@31..32 \")\"\n-      SEMICOLON@32..33 \";\"\n-    EXPR_STMT@33..43\n-      METHOD_CALL_EXPR@33..42\n-        PATH_EXPR@33..34\n-          PATH@33..34\n-            PATH_SEGMENT@33..34\n-              NAME_REF@33..34\n-                IDENT@33..34 \"v\"\n-        DOT@34..35 \".\"\n-        NAME_REF@35..39\n-          IDENT@35..39 \"push\"\n-        ARG_LIST@39..42\n-          L_PAREN@39..40 \"(\"\n-          LITERAL@40..41\n-            INT_NUMBER@40..41 \"2\"\n-          R_PAREN@41..42 \")\"\n-      SEMICOLON@42..43 \";\"\n-    PATH_EXPR@43..44\n-      PATH@43..44\n-        PATH_SEGMENT@43..44\n-          NAME_REF@43..44\n-            IDENT@43..44 \"v\"\n-    R_CURLY@44..45 \"}\"\n-\"#\n-    );\n-}\n-\n #[test]\n fn test_winapi_struct() {\n     // from https://github.com/retep998/winapi-rs/blob/a7ef2bca086aae76cf6c4ce4c2552988ed9798ad/src/macros.rs#L366"}]}