{"sha": "e110c7889a568cd7ef375796028ce5eaacd81664", "node_id": "C_kwDOAAsO6NoAKGUxMTBjNzg4OWE1NjhjZDdlZjM3NTc5NjAyOGNlNWVhYWNkODE2NjQ", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-11-01T16:18:17Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-11-01T16:18:17Z"}, "message": "Revert \"Record diverging match arms in `InferenceResult`\"\n\nThis reverts commit 319611b7382fc4c84170519dade68f4f558a44b1.", "tree": {"sha": "492c0211263fb07aa7a237a55b5ee74dae199ca9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/492c0211263fb07aa7a237a55b5ee74dae199ca9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e110c7889a568cd7ef375796028ce5eaacd81664", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e110c7889a568cd7ef375796028ce5eaacd81664", "html_url": "https://github.com/rust-lang/rust/commit/e110c7889a568cd7ef375796028ce5eaacd81664", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e110c7889a568cd7ef375796028ce5eaacd81664/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f1bb17a1bb683a50a62c371803b07144b1bfc5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9f1bb17a1bb683a50a62c371803b07144b1bfc5a", "html_url": "https://github.com/rust-lang/rust/commit/9f1bb17a1bb683a50a62c371803b07144b1bfc5a"}], "stats": {"total": 30, "additions": 0, "deletions": 30}, "files": [{"sha": "31e56dec62593770bb938e2ddaa7dc7f6b39731c", "filename": "crates/hir-ty/src/infer.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir-ty%2Fsrc%2Finfer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir-ty%2Fsrc%2Finfer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Finfer.rs?ref=e110c7889a568cd7ef375796028ce5eaacd81664", "patch": "@@ -333,8 +333,6 @@ pub struct InferenceResult {\n     assoc_resolutions: FxHashMap<ExprOrPatId, AssocItemId>,\n     pub diagnostics: Vec<InferenceDiagnostic>,\n     pub type_of_expr: ArenaMap<ExprId, Ty>,\n-    /// For each match expr, record diverging arm's expr.\n-    pub diverging_arms: FxHashMap<ExprId, Vec<ExprId>>,\n     /// For each pattern record the type it resolves to.\n     ///\n     /// **Note**: When a pattern type is resolved it may still contain"}, {"sha": "f56108b26c45bdaea3096f4616828c28ba260d12", "filename": "crates/hir-ty/src/infer/expr.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir-ty%2Fsrc%2Finfer%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir-ty%2Fsrc%2Finfer%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Finfer%2Fexpr.rs?ref=e110c7889a568cd7ef375796028ce5eaacd81664", "patch": "@@ -375,7 +375,6 @@ impl<'a> InferenceContext<'a> {\n \n                 let matchee_diverges = self.diverges;\n                 let mut all_arms_diverge = Diverges::Always;\n-                let mut diverging_arms = Vec::new();\n \n                 for arm in arms.iter() {\n                     self.diverges = Diverges::Maybe;\n@@ -388,15 +387,11 @@ impl<'a> InferenceContext<'a> {\n                     }\n \n                     let arm_ty = self.infer_expr_inner(arm.expr, &expected);\n-                    if self.diverges.is_always() {\n-                        diverging_arms.push(arm.expr);\n-                    }\n                     all_arms_diverge &= self.diverges;\n                     coerce.coerce(self, Some(arm.expr), &arm_ty);\n                 }\n \n                 self.diverges = matchee_diverges | all_arms_diverge;\n-                self.result.diverging_arms.insert(tgt_expr, diverging_arms);\n \n                 coerce.complete()\n             }"}, {"sha": "119ec3210e175b0ca417420c3c480f57805b9156", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=e110c7889a568cd7ef375796028ce5eaacd81664", "patch": "@@ -481,10 +481,6 @@ impl<'db, DB: HirDatabase> Semantics<'db, DB> {\n     pub fn is_unsafe_ident_pat(&self, ident_pat: &ast::IdentPat) -> bool {\n         self.imp.is_unsafe_ident_pat(ident_pat)\n     }\n-\n-    pub fn is_diverging_match_arm(&self, match_arm: &ast::MatchArm) -> Option<bool> {\n-        self.imp.is_diverging_match_arm(match_arm)\n-    }\n }\n \n impl<'db> SemanticsImpl<'db> {\n@@ -1425,10 +1421,6 @@ impl<'db> SemanticsImpl<'db> {\n             .map(|ty| ty.original.is_packed(self.db))\n             .unwrap_or(false)\n     }\n-\n-    fn is_diverging_match_arm(&self, match_arm: &ast::MatchArm) -> Option<bool> {\n-        self.analyze(match_arm.syntax())?.is_diverging_match_arm(self.db, match_arm)\n-    }\n }\n \n fn macro_call_to_macro_id("}, {"sha": "f86c571005367e5b4015472c55d1b8fd694c2d99", "filename": "crates/hir/src/source_analyzer.rs", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e110c7889a568cd7ef375796028ce5eaacd81664/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs?ref=e110c7889a568cd7ef375796028ce5eaacd81664", "patch": "@@ -782,21 +782,6 @@ impl SourceAnalyzer {\n         false\n     }\n \n-    pub(crate) fn is_diverging_match_arm(\n-        &self,\n-        db: &dyn HirDatabase,\n-        match_arm: &ast::MatchArm,\n-    ) -> Option<bool> {\n-        let infer = self.infer.as_ref()?;\n-        let match_expr = match_arm.syntax().ancestors().find_map(ast::MatchExpr::cast)?;\n-        let match_id = self.expr_id(db, &match_expr.into())?;\n-        let diverging_arms = infer.diverging_arms.get(&match_id)?;\n-        let match_arm_expr = match_arm.expr()?;\n-        let match_arm_expr_id = self.expr_id(db, &match_arm_expr)?;\n-\n-        Some(diverging_arms.contains(&match_arm_expr_id))\n-    }\n-\n     fn resolve_impl_method_or_trait_def(\n         &self,\n         db: &dyn HirDatabase,"}]}