{"sha": "dd4613cbc091860d4b56f506b195b92c87f022a1", "node_id": "C_kwDOAAsO6NoAKGRkNDYxM2NiYzA5MTg2MGQ0YjU2ZjUwNmIxOTViOTJjODdmMDIyYTE", "commit": {"author": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-08-11T13:59:58Z"}, "committer": {"name": "Jacob Hoffman-Andrews", "email": "github@hoffman-andrews.com", "date": "2022-08-12T00:00:17Z"}, "message": "rustdoc: don't generate DOM element for operator\n\nIn our source page highlighting, we were generating `<span class=\"op\">`\ntags for all \"operators\", including e.g. `<` `>` around generic\nparameters, `*`, `&`. This contributed significantly to DOM size, but\nwe don't actually style `.op` except in the ayu theme.\n\nRemove the styles for `.op` in ayu, and stop generating the `<span>`s.\n\nThis reduces DOM size of an example page[1] from 265,938 HTML elements\nto 242,165 elements, a 9% reduction.\n\n[1]:\nhttps://doc.rust-lang.org/nightly/src/core/up/up/stdarch/crates/core_arch/src/x86/avx512f.rs.html", "tree": {"sha": "7fde84e81aff1c81461163fe380627704c9a5af8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fde84e81aff1c81461163fe380627704c9a5af8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd4613cbc091860d4b56f506b195b92c87f022a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd4613cbc091860d4b56f506b195b92c87f022a1", "html_url": "https://github.com/rust-lang/rust/commit/dd4613cbc091860d4b56f506b195b92c87f022a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd4613cbc091860d4b56f506b195b92c87f022a1/comments", "author": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "187654481fd828e495919295369d33827f10e1c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/187654481fd828e495919295369d33827f10e1c4", "html_url": "https://github.com/rust-lang/rust/commit/187654481fd828e495919295369d33827f10e1c4"}], "stats": {"total": 56, "additions": 25, "deletions": 31}, "files": [{"sha": "2cef2c99930c7d0de2ece9b543571e727402c365", "filename": "src/librustdoc/html/highlight.rs", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight.rs?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -133,7 +133,6 @@ enum Class {\n     // Keywords that do pointer/reference stuff.\n     RefKeyWord,\n     Self_(Span),\n-    Op,\n     Macro(Span),\n     MacroNonTerminal,\n     String,\n@@ -157,7 +156,6 @@ impl Class {\n             Class::KeyWord => \"kw\",\n             Class::RefKeyWord => \"kw-2\",\n             Class::Self_(_) => \"self\",\n-            Class::Op => \"op\",\n             Class::Macro(_) => \"macro\",\n             Class::MacroNonTerminal => \"macro-nonterminal\",\n             Class::String => \"string\",\n@@ -182,7 +180,6 @@ impl Class {\n             | Self::Attribute\n             | Self::KeyWord\n             | Self::RefKeyWord\n-            | Self::Op\n             | Self::MacroNonTerminal\n             | Self::String\n             | Self::Number\n@@ -494,7 +491,7 @@ impl<'a> Classifier<'a> {\n             // or a reference or pointer type. Unless, of course, it looks like\n             // a logical and or a multiplication operator: `&&` or `* `.\n             TokenKind::Star => match self.tokens.peek() {\n-                Some((TokenKind::Whitespace, _)) => Class::Op,\n+                Some((TokenKind::Whitespace, _)) => return no_highlight(sink),\n                 Some((TokenKind::Ident, \"mut\")) => {\n                     self.next();\n                     sink(Highlight::Token { text: \"*mut\", class: Some(Class::RefKeyWord) });\n@@ -510,15 +507,15 @@ impl<'a> Classifier<'a> {\n             TokenKind::And => match self.tokens.peek() {\n                 Some((TokenKind::And, _)) => {\n                     self.next();\n-                    sink(Highlight::Token { text: \"&&\", class: Some(Class::Op) });\n+                    sink(Highlight::Token { text: \"&&\", class: None });\n                     return;\n                 }\n                 Some((TokenKind::Eq, _)) => {\n                     self.next();\n-                    sink(Highlight::Token { text: \"&=\", class: Some(Class::Op) });\n+                    sink(Highlight::Token { text: \"&=\", class: None });\n                     return;\n                 }\n-                Some((TokenKind::Whitespace, _)) => Class::Op,\n+                Some((TokenKind::Whitespace, _)) => return no_highlight(sink),\n                 Some((TokenKind::Ident, \"mut\")) => {\n                     self.next();\n                     sink(Highlight::Token { text: \"&mut\", class: Some(Class::RefKeyWord) });\n@@ -531,15 +528,15 @@ impl<'a> Classifier<'a> {\n             TokenKind::Eq => match lookahead {\n                 Some(TokenKind::Eq) => {\n                     self.next();\n-                    sink(Highlight::Token { text: \"==\", class: Some(Class::Op) });\n+                    sink(Highlight::Token { text: \"==\", class: None });\n                     return;\n                 }\n                 Some(TokenKind::Gt) => {\n                     self.next();\n                     sink(Highlight::Token { text: \"=>\", class: None });\n                     return;\n                 }\n-                _ => Class::Op,\n+                _ => return no_highlight(sink),\n             },\n             TokenKind::Minus if lookahead == Some(TokenKind::Gt) => {\n                 self.next();\n@@ -556,7 +553,7 @@ impl<'a> Classifier<'a> {\n             | TokenKind::Percent\n             | TokenKind::Bang\n             | TokenKind::Lt\n-            | TokenKind::Gt => Class::Op,\n+            | TokenKind::Gt => return no_highlight(sink),\n \n             // Miscellaneous, no highlighting.\n             TokenKind::Dot"}, {"sha": "ae4dba116d637329226c0529ddf5e1f61c25928e", "filename": "src/librustdoc/html/highlight/fixtures/decorations.html", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fdecorations.html", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fdecorations.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fdecorations.html?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -1,2 +1,2 @@\n-<span class=\"example\"><span class=\"kw\">let</span> <span class=\"ident\">x</span> <span class=\"op\">=</span> <span class=\"number\">1</span>;</span>\n-<span class=\"kw\">let</span> <span class=\"ident\">y</span> <span class=\"op\">=</span> <span class=\"number\">2</span>;\n\\ No newline at end of file\n+<span class=\"example\"><span class=\"kw\">let</span> <span class=\"ident\">x</span> = <span class=\"number\">1</span>;</span>\n+<span class=\"kw\">let</span> <span class=\"ident\">y</span> = <span class=\"number\">2</span>;\n\\ No newline at end of file"}, {"sha": "17f23278ec1f2e4f5c0e7391e8cf284c673588b9", "filename": "src/librustdoc/html/highlight/fixtures/highlight.html", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fhighlight.html", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fhighlight.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fhighlight.html?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -1,4 +1,4 @@\n <span class=\"kw\">use</span> <span class=\"ident\"><span class=\"kw\">crate</span>::a::foo</span>;\n <span class=\"kw\">use</span> <span class=\"ident\"><span class=\"self\">self</span>::whatever</span>;\n-<span class=\"kw\">let</span> <span class=\"ident\">x</span> <span class=\"op\">=</span> <span class=\"ident\"><span class=\"kw\">super</span>::b::foo</span>;\n-<span class=\"kw\">let</span> <span class=\"ident\">y</span> <span class=\"op\">=</span> <span class=\"ident\"><span class=\"self\">Self</span>::whatever</span>;\n\\ No newline at end of file\n+<span class=\"kw\">let</span> <span class=\"ident\">x</span> = <span class=\"ident\"><span class=\"kw\">super</span>::b::foo</span>;\n+<span class=\"kw\">let</span> <span class=\"ident\">y</span> = <span class=\"ident\"><span class=\"self\">Self</span>::whatever</span>;\n\\ No newline at end of file"}, {"sha": "ea797fd99d3f45e81f76db3212755e337af60882", "filename": "src/librustdoc/html/highlight/fixtures/sample.html", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Fsample.html?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -8,23 +8,23 @@\n .lifetime { color: #B76514; }\n .question-mark { color: #ff9011; }\n </style>\n-<pre><code><span class=\"attribute\">#![<span class=\"ident\">crate_type</span> <span class=\"op\">=</span> <span class=\"string\">&quot;lib&quot;</span>]</span>\n+<pre><code><span class=\"attribute\">#![<span class=\"ident\">crate_type</span> = <span class=\"string\">&quot;lib&quot;</span>]</span>\n \n <span class=\"kw\">use</span> <span class=\"ident\">std::path</span>::{<span class=\"ident\">Path</span>, <span class=\"ident\">PathBuf</span>};\n \n-<span class=\"attribute\">#[<span class=\"ident\">cfg</span>(<span class=\"ident\">target_os</span> <span class=\"op\">=</span> <span class=\"string\">&quot;linux&quot;</span>)]</span>\n+<span class=\"attribute\">#[<span class=\"ident\">cfg</span>(<span class=\"ident\">target_os</span> = <span class=\"string\">&quot;linux&quot;</span>)]</span>\n <span class=\"kw\">fn</span> <span class=\"ident\">main</span>() -&gt; () {\n-    <span class=\"kw\">let</span> <span class=\"ident\">foo</span> <span class=\"op\">=</span> <span class=\"bool-val\">true</span> <span class=\"op\">&amp;&amp;</span> <span class=\"bool-val\">false</span> <span class=\"op\">|</span><span class=\"op\">|</span> <span class=\"bool-val\">true</span>;\n-    <span class=\"kw\">let</span> <span class=\"kw\">_</span>: <span class=\"kw-2\">*const</span> () <span class=\"op\">=</span> <span class=\"number\">0</span>;\n-    <span class=\"kw\">let</span> <span class=\"kw\">_</span> <span class=\"op\">=</span> <span class=\"kw-2\">&amp;</span><span class=\"ident\">foo</span>;\n-    <span class=\"kw\">let</span> <span class=\"kw\">_</span> <span class=\"op\">=</span> <span class=\"op\">&amp;&amp;</span><span class=\"ident\">foo</span>;\n-    <span class=\"kw\">let</span> <span class=\"kw\">_</span> <span class=\"op\">=</span> <span class=\"kw-2\">*</span><span class=\"ident\">foo</span>;\n+    <span class=\"kw\">let</span> <span class=\"ident\">foo</span> = <span class=\"bool-val\">true</span> &amp;&amp; <span class=\"bool-val\">false</span> || <span class=\"bool-val\">true</span>;\n+    <span class=\"kw\">let</span> <span class=\"kw\">_</span>: <span class=\"kw-2\">*const</span> () = <span class=\"number\">0</span>;\n+    <span class=\"kw\">let</span> <span class=\"kw\">_</span> = <span class=\"kw-2\">&amp;</span><span class=\"ident\">foo</span>;\n+    <span class=\"kw\">let</span> <span class=\"kw\">_</span> = &amp;&amp;<span class=\"ident\">foo</span>;\n+    <span class=\"kw\">let</span> <span class=\"kw\">_</span> = <span class=\"kw-2\">*</span><span class=\"ident\">foo</span>;\n     <span class=\"macro\">mac!</span>(<span class=\"ident\">foo</span>, <span class=\"kw-2\">&amp;mut</span> <span class=\"ident\">bar</span>);\n-    <span class=\"macro\">assert!</span>(<span class=\"self\">self</span>.<span class=\"ident\">length</span> <span class=\"op\">&lt;</span> <span class=\"ident\">N</span> <span class=\"op\">&amp;&amp;</span> <span class=\"ident\">index</span> <span class=\"op\">&lt;</span><span class=\"op\">=</span> <span class=\"self\">self</span>.<span class=\"ident\">length</span>);\n+    <span class=\"macro\">assert!</span>(<span class=\"self\">self</span>.<span class=\"ident\">length</span> &lt; <span class=\"ident\">N</span> &amp;&amp; <span class=\"ident\">index</span> &lt;= <span class=\"self\">self</span>.<span class=\"ident\">length</span>);\n     <span class=\"ident\">::std::env::var</span>(<span class=\"string\">&quot;gateau&quot;</span>).<span class=\"ident\">is_ok</span>();\n     <span class=\"attribute\">#[<span class=\"ident\">rustfmt::skip</span>]</span>\n-    <span class=\"kw\">let</span> <span class=\"ident\">s</span>:<span class=\"ident\">std::path::PathBuf</span> <span class=\"op\">=</span> <span class=\"ident\">std::path::PathBuf::new</span>();\n-    <span class=\"kw\">let</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">s</span> <span class=\"op\">=</span> <span class=\"ident\">String::new</span>();\n+    <span class=\"kw\">let</span> <span class=\"ident\">s</span>:<span class=\"ident\">std::path::PathBuf</span> = <span class=\"ident\">std::path::PathBuf::new</span>();\n+    <span class=\"kw\">let</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">s</span> = <span class=\"ident\">String::new</span>();\n \n     <span class=\"kw\">match</span> <span class=\"kw-2\">&amp;</span><span class=\"ident\">s</span> {\n         <span class=\"kw-2\">ref</span> <span class=\"kw-2\">mut</span> <span class=\"ident\">x</span> =&gt; {}"}, {"sha": "ac8bd28f6c362e765035327cb11a814458122963", "filename": "src/librustdoc/html/highlight/fixtures/union.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Funion.html", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Funion.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fhighlight%2Ffixtures%2Funion.html?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -4,5 +4,5 @@\n }\n \n <span class=\"kw\">fn</span> <span class=\"ident\">main</span>() {\n-    <span class=\"kw\">let</span> <span class=\"ident\">union</span> <span class=\"op\">=</span> <span class=\"number\">0</span>;\n+    <span class=\"kw\">let</span> <span class=\"ident\">union</span> = <span class=\"number\">0</span>;\n }"}, {"sha": "14a61f72c34bab056dccba012a8367c4cf31072b", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -239,7 +239,7 @@ details.rustdoc-toggle > summary::before {\n pre.rust .number, pre.rust .string { color: #b8cc52; }\n pre.rust .kw, pre.rust .kw-2, pre.rust .prelude-ty,\n pre.rust .bool-val, pre.rust .prelude-val,\n-pre.rust .op, pre.rust .lifetime { color: #ff7733; }\n+pre.rust .lifetime { color: #ff7733; }\n pre.rust .macro, pre.rust .macro-nonterminal { color: #a37acc; }\n pre.rust .question-mark {\n \tcolor: #ff9011;\n@@ -251,7 +251,7 @@ pre.rust .self {\n pre.rust .attribute {\n \tcolor: #e6e1cf;\n }\n-pre.rust .attribute .ident, pre.rust .attribute .op {\n+pre.rust .attribute .ident {\n \tcolor: #e6e1cf;\n }\n "}, {"sha": "131c53ec24bc46b05c799d95c7edefe4b2aaf87a", "filename": "src/test/rustdoc/macro_rules-matchers.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Ftest%2Frustdoc%2Fmacro_rules-matchers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd4613cbc091860d4b56f506b195b92c87f022a1/src%2Ftest%2Frustdoc%2Fmacro_rules-matchers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fmacro_rules-matchers.rs?ref=dd4613cbc091860d4b56f506b195b92c87f022a1", "patch": "@@ -6,16 +6,13 @@\n // @has 'foo/macro.todo.html'\n // @has - '//span[@class=\"macro\"]' 'macro_rules!'\n // @has - '//span[@class=\"ident\"]' 'todo'\n-// Note: the only op is the `+`\n-// @count - '//pre[@class=\"rust macro\"]//span[@class=\"op\"]' 1\n \n // @has - '{ () =&gt; { ... }; ($('\n // @has - '//span[@class=\"macro-nonterminal\"]' '$'\n // @has - '//span[@class=\"macro-nonterminal\"]' 'arg'\n // @has - ':'\n // @has - '//span[@class=\"ident\"]' 'tt'\n-// @has - '),'\n-// @has - '//span[@class=\"op\"]' '+'\n+// @has - ')+'\n // @has - ') =&gt; { ... }; }'\n pub use std::todo;\n "}]}