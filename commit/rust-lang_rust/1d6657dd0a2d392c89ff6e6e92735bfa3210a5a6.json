{"sha": "1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkNjY1N2RkMGEyZDM5MmM4OWZmNmU2ZTkyNzM1YmZhMzIxMGE1YTY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-23T08:25:17Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-23T08:25:17Z"}, "message": "Rollup merge of #58199 - clintfred:partial-move-err-msg, r=estebank\n\nAdd better error message for partial move\n\ncloses #56657\n\nr? @davidtwco", "tree": {"sha": "bbfa5f69d25955a67f6cc576bf6f6da50e97ac99", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbfa5f69d25955a67f6cc576bf6f6da50e97ac99"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJccQNtCRBK7hj4Ov3rIwAAdHIIAJHkuwGL4ObjC8FqVVil5jJW\n3qoZGpd+Rl6Zr4aOehmx8jKgNSvTQxtzyhts1jXnzbxGnncaukJpwlFIk4KsSWEO\nVUYaH5/EfXOjBh4NOF/g0JFhYN2N89UCPwMMPVWGjiIl9PCQOY7lDPg2krJS7qcJ\nBdmdjo/ORBQtHJ7dINsD+k7muEmr6+vzVvcQFUgDAfhWYo5bZyuWidDXtUeD1LLR\nXgdIZEUcln1iaEgq5MZd3UGil8NRmr4r8PzBLYMZQDkuTqIROfXFqduAjL+JCuMx\nd8ulnaYdVdL6Sr39HVHIEchyeyAAUMNv0MWg7rTrFz4MAut3ndHKLIXPwti/oN4=\n=SycB\n-----END PGP SIGNATURE-----\n", "payload": "tree bbfa5f69d25955a67f6cc576bf6f6da50e97ac99\nparent f19bec89d784dfa8b5a372b4cefeb83c5196a3ef\nparent 02fe6a7ba6b0d1733c9abbe40ac85c26bba38403\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550910317 +0100\ncommitter GitHub <noreply@github.com> 1550910317 +0100\n\nRollup merge of #58199 - clintfred:partial-move-err-msg, r=estebank\n\nAdd better error message for partial move\n\ncloses #56657\n\nr? @davidtwco\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "html_url": "https://github.com/rust-lang/rust/commit/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f19bec89d784dfa8b5a372b4cefeb83c5196a3ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/f19bec89d784dfa8b5a372b4cefeb83c5196a3ef", "html_url": "https://github.com/rust-lang/rust/commit/f19bec89d784dfa8b5a372b4cefeb83c5196a3ef"}, {"sha": "02fe6a7ba6b0d1733c9abbe40ac85c26bba38403", "url": "https://api.github.com/repos/rust-lang/rust/commits/02fe6a7ba6b0d1733c9abbe40ac85c26bba38403", "html_url": "https://github.com/rust-lang/rust/commit/02fe6a7ba6b0d1733c9abbe40ac85c26bba38403"}], "stats": {"total": 30, "additions": 18, "deletions": 12}, "files": [{"sha": "739125729d41a329ee446c50a74b7d2ebe7c42d9", "filename": "src/librustc_mir/borrow_check/error_reporting.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -130,6 +130,11 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n             );\n \n             let mut is_loop_move = false;\n+            let is_partial_move = move_site_vec.iter().any(|move_site| {\n+                let move_out = self.move_data.moves[(*move_site).moi];\n+                let moved_place = &self.move_data.move_paths[move_out.path].place;\n+                used_place != moved_place && used_place.is_prefix_of(moved_place)\n+            });\n             for move_site in &move_site_vec {\n                 let move_out = self.move_data.moves[(*move_site).moi];\n                 let moved_place = &self.move_data.move_paths[move_out.path].place;\n@@ -175,8 +180,9 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                 err.span_label(\n                     span,\n                     format!(\n-                        \"value {} here after move\",\n-                        desired_action.as_verb_in_past_tense()\n+                        \"value {} here {}\",\n+                        desired_action.as_verb_in_past_tense(),\n+                        if is_partial_move { \"after partial move\" } else { \"after move\" },\n                     ),\n                 );\n             }"}, {"sha": "99cbf64fd5d466b6a3701d981fa651ef60760b53", "filename": "src/test/ui/borrowck/borrowck-uninit-field-access.ast.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.ast.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.ast.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.ast.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -20,7 +20,7 @@ error[E0382]: use of moved value: `line2`\n LL |     let _moved = (line2.origin, line2.middle);\n    |                                 ------------ value moved here\n LL |     line2.consume(); //[ast]~ ERROR use of partially moved value: `line2` [E0382]\n-   |     ^^^^^ value used here after move\n+   |     ^^^^^ value used here after partial move\n    |\n    = note: move occurs because `line2.middle` has type `Point`, which does not implement the `Copy` trait\n "}, {"sha": "99cbf64fd5d466b6a3701d981fa651ef60760b53", "filename": "src/test/ui/borrowck/borrowck-uninit-field-access.mir.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.mir.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.mir.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fborrowck-uninit-field-access.mir.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -20,7 +20,7 @@ error[E0382]: use of moved value: `line2`\n LL |     let _moved = (line2.origin, line2.middle);\n    |                                 ------------ value moved here\n LL |     line2.consume(); //[ast]~ ERROR use of partially moved value: `line2` [E0382]\n-   |     ^^^^^ value used here after move\n+   |     ^^^^^ value used here after partial move\n    |\n    = note: move occurs because `line2.middle` has type `Point`, which does not implement the `Copy` trait\n "}, {"sha": "5f0d2b42671de71633e5053db328e0981ad9fc52", "filename": "src/test/ui/moves/moves-based-on-type-cyclic-types-issue-4821.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-cyclic-types-issue-4821.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-cyclic-types-issue-4821.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-cyclic-types-issue-4821.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -5,7 +5,7 @@ LL |         Some(right) => consume(right),\n    |              ----- value moved here\n ...\n LL |     consume(node) + r //~ ERROR use of partially moved value: `node`\n-   |             ^^^^ value used here after move\n+   |             ^^^^ value used here after partial move\n    |\n    = note: move occurs because value has type `std::boxed::Box<List>`, which does not implement the `Copy` trait\n "}, {"sha": "6d523fc09c08b9dcddcc025f7bbd6934963868f1", "filename": "src/test/ui/moves/moves-based-on-type-match-bindings.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-match-bindings.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-match-bindings.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmoves%2Fmoves-based-on-type-match-bindings.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -5,7 +5,7 @@ LL |         Foo {f} => {}\n    |              - value moved here\n ...\n LL |     touch(&x); //~ ERROR use of partially moved value: `x`\n-   |           ^^ value borrowed here after move\n+   |           ^^ value borrowed here after partial move\n    |\n    = note: move occurs because `x.f` has type `std::string::String`, which does not implement the `Copy` trait\n "}, {"sha": "8b52cc113ccc5fc1660eb5e3955d22c1fd231868", "filename": "src/test/ui/nll/move-subpaths-moves-root.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fnll%2Fmove-subpaths-moves-root.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fnll%2Fmove-subpaths-moves-root.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fmove-subpaths-moves-root.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -4,7 +4,7 @@ error[E0382]: use of moved value: `x`\n LL |     drop(x.0);\n    |          --- value moved here\n LL |     drop(x); //~ ERROR use of moved value\n-   |          ^ value used here after move\n+   |          ^ value used here after partial move\n    |\n    = note: move occurs because `x.0` has type `std::vec::Vec<i32>`, which does not implement the `Copy` trait\n "}, {"sha": "402f3c77cdb7b27330752f2bae1648e10c328abf", "filename": "src/test/ui/ref-suggestion.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fref-suggestion.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Fref-suggestion.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fref-suggestion.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -25,7 +25,7 @@ LL |         (Some(y), ()) => {},\n    |               - value moved here\n ...\n LL |     x; //~ ERROR use of partially moved value\n-   |     ^ value used here after move\n+   |     ^ value used here after partial move\n    |\n    = note: move occurs because value has type `std::vec::Vec<i32>`, which does not implement the `Copy` trait\n "}, {"sha": "010e182674b75b2e4458811f250e06a132cbb546", "filename": "src/test/ui/unsized-locals/borrow-after-move.nll.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Funsized-locals%2Fborrow-after-move.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Funsized-locals%2Fborrow-after-move.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized-locals%2Fborrow-after-move.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -5,7 +5,7 @@ LL |         let y = *x;\n    |                 -- value moved here\n LL |         drop_unsized(y);\n LL |         println!(\"{}\", &x);\n-   |                        ^^ value borrowed here after move\n+   |                        ^^ value borrowed here after partial move\n    |\n    = note: move occurs because `*x` has type `str`, which does not implement the `Copy` trait\n \n@@ -27,7 +27,7 @@ LL |         let y = *x;\n    |                 -- value moved here\n LL |         y.foo();\n LL |         println!(\"{}\", &x);\n-   |                        ^^ value borrowed here after move\n+   |                        ^^ value borrowed here after partial move\n    |\n    = note: move occurs because `*x` has type `str`, which does not implement the `Copy` trait\n \n@@ -48,7 +48,7 @@ error[E0382]: borrow of moved value: `x`\n LL |         x.foo();\n    |         - value moved here\n LL |         println!(\"{}\", &x);\n-   |                        ^^ value borrowed here after move\n+   |                        ^^ value borrowed here after partial move\n    |\n    = note: move occurs because `*x` has type `str`, which does not implement the `Copy` trait\n "}, {"sha": "c0c3e436f535be5b7b43840fa18916a89f488f37", "filename": "src/test/ui/unsized-locals/double-move.nll.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Funsized-locals%2Fdouble-move.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6/src%2Ftest%2Fui%2Funsized-locals%2Fdouble-move.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsized-locals%2Fdouble-move.nll.stderr?ref=1d6657dd0a2d392c89ff6e6e92735bfa3210a5a6", "patch": "@@ -14,7 +14,7 @@ error[E0382]: use of moved value: `x`\n LL |         let _y = *x;\n    |                  -- value moved here\n LL |         drop_unsized(x); //~ERROR use of moved value\n-   |                      ^ value used here after move\n+   |                      ^ value used here after partial move\n    |\n    = note: move occurs because `*x` has type `str`, which does not implement the `Copy` trait\n "}]}