{"sha": "ac880e5e3952c09fbce4df3da86537d33ea7ece2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjODgwZTVlMzk1MmMwOWZiY2U0ZGYzZGE4NjUzN2QzM2VhN2VjZTI=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-07-04T22:13:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-04T22:13:23Z"}, "message": "Rollup merge of #86623 - GuillaumeGomez:prevent-explanation-removal, r=Mark-Simulacrum\n\nAdd check to ensure error code explanations are not removed anymore even if not emitted\n\nThe error explanations are useful in case you use older version of the compiler. Even more if they had an explanation. If they are not emitted, their explanations should be updated but not removed (as we did for a few of them, like E0001).\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "c9c8929e1a0c54e7101ce1bd2bee95428b038067", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c9c8929e1a0c54e7101ce1bd2bee95428b038067"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac880e5e3952c09fbce4df3da86537d33ea7ece2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg4jKECRBK7hj4Ov3rIwAAa1YIAG7QWFfuhkZyLOwam4PtRNh9\nwc5YoI4txWdOEVcrfXi1K+jVhBehMrEZhG1bLL3OiWmk/TC+EPcHxAcPye7zEWB5\n8RmnYelnQ7NecjKE9KiEZe8grWQVcwxKPZVu8zbwcYwafM3QX8z8ptMEg7u44U/2\ng/6rkN4BxuM1adbLK5ASn6G9V+vAr+80dSoIlsBJZb9yB71bsNaHkpRH03hTULs7\ntWD6Z5Wd1lHI2eI72LDc6VXm+qZAeaM2aA+smS5DUGAj0rZa3jJjhQYSFAJHlNfc\nGOPsIbBn7lM6L1jjzatEvozf7JaMeeZeCAiUgMmHdT8dXLXpCEd7YgW6KOZR2Rw=\n=511O\n-----END PGP SIGNATURE-----\n", "payload": "tree c9c8929e1a0c54e7101ce1bd2bee95428b038067\nparent 5d555bf239b10d375484a41e965d39d27ff61365\nparent d6962ffb31d2f06081511884291fa163961a98e6\nauthor Yuki Okushi <jtitor@2k36.org> 1625436803 +0900\ncommitter GitHub <noreply@github.com> 1625436803 +0900\n\nRollup merge of #86623 - GuillaumeGomez:prevent-explanation-removal, r=Mark-Simulacrum\n\nAdd check to ensure error code explanations are not removed anymore even if not emitted\n\nThe error explanations are useful in case you use older version of the compiler. Even more if they had an explanation. If they are not emitted, their explanations should be updated but not removed (as we did for a few of them, like E0001).\n\nr? `@Mark-Simulacrum`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac880e5e3952c09fbce4df3da86537d33ea7ece2", "html_url": "https://github.com/rust-lang/rust/commit/ac880e5e3952c09fbce4df3da86537d33ea7ece2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac880e5e3952c09fbce4df3da86537d33ea7ece2/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5d555bf239b10d375484a41e965d39d27ff61365", "url": "https://api.github.com/repos/rust-lang/rust/commits/5d555bf239b10d375484a41e965d39d27ff61365", "html_url": "https://github.com/rust-lang/rust/commit/5d555bf239b10d375484a41e965d39d27ff61365"}, {"sha": "d6962ffb31d2f06081511884291fa163961a98e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6962ffb31d2f06081511884291fa163961a98e6", "html_url": "https://github.com/rust-lang/rust/commit/d6962ffb31d2f06081511884291fa163961a98e6"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "8066ea3a944b39543b393ac48698178cfc75b6f8", "filename": "src/ci/docker/host-x86_64/mingw-check/Dockerfile", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2FDockerfile?ref=ac880e5e3952c09fbce4df3da86537d33ea7ece2", "patch": "@@ -28,6 +28,7 @@ COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n COPY host-x86_64/mingw-check/validate-toolstate.sh /scripts/\n+COPY host-x86_64/mingw-check/validate-error-codes.sh /scripts/\n \n ENV RUN_CHECK_WITH_PARALLEL_QUERIES 1\n ENV SCRIPT python3 ../x.py --stage 2 test src/tools/expand-yaml-anchors && \\\n@@ -37,6 +38,7 @@ ENV SCRIPT python3 ../x.py --stage 2 test src/tools/expand-yaml-anchors && \\\n            python3 ../x.py test --stage 2 src/tools/tidy && \\\n            python3 ../x.py doc --stage 0 library/test && \\\n            /scripts/validate-toolstate.sh && \\\n+           /scripts/validate-error-codes.sh && \\\n            # Runs checks to ensure that there are no ES5 issues in our JS code.\n            es-check es5 ../src/librustdoc/html/static/*.js && \\\n            eslint ../src/librustdoc/html/static/*.js"}, {"sha": "e9aa948eb877fa67d6a512aff1c50c18ca654f8c", "filename": "src/ci/docker/host-x86_64/mingw-check/validate-error-codes.sh", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-error-codes.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-error-codes.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check%2Fvalidate-error-codes.sh?ref=ac880e5e3952c09fbce4df3da86537d33ea7ece2", "patch": "@@ -0,0 +1,20 @@\n+#!/bin/bash\n+# Checks that no error code explanation is removed.\n+\n+set -eo pipefail\n+\n+if [[ -z \"$BASE_COMMIT\" ]]; then\n+    echo \"not checking error code explanations removal\"\n+    exit 0\n+fi\n+\n+echo \"Check if an error code explanation was removed...\"\n+\n+if (git diff \"$BASE_COMMIT\" --name-status | grep '^D' \\\n+        | grep --quiet \"compiler/rustc_error_codes/src/error_codes/\"); then\n+    echo \"Error code explanations should never be removed!\"\n+    echo \"Take a look at E0001 to see how to handle it.\"\n+    exit 1\n+fi\n+\n+echo \"No error code explanation was removed!\""}, {"sha": "489c3d76601958aa56217d232199b56085dd304f", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ac880e5e3952c09fbce4df3da86537d33ea7ece2/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=ac880e5e3952c09fbce4df3da86537d33ea7ece2", "patch": "@@ -219,6 +219,14 @@ else\n   command=\"/checkout/src/ci/run.sh\"\n fi\n \n+if [ \"$CI\" != \"\" ]; then\n+    # Get some needed information for $BASE_COMMIT\n+    git fetch \"https://github.com/$GITHUB_REPOSITORY\" \"$GITHUB_BASE_REF\"\n+    BASE_COMMIT=\"$(git merge-base FETCH_HEAD HEAD)\"\n+else\n+    BASE_COMMIT=\"\"\n+fi\n+\n docker \\\n   run \\\n   --workdir /checkout/obj \\\n@@ -237,6 +245,7 @@ docker \\\n   --env TOOLSTATE_PUBLISH \\\n   --env RUST_CI_OVERRIDE_RELEASE_CHANNEL \\\n   --env CI_JOB_NAME=\"${CI_JOB_NAME-$IMAGE}\" \\\n+  --env BASE_COMMIT=\"$BASE_COMMIT\" \\\n   --init \\\n   --rm \\\n   rust-ci \\"}]}