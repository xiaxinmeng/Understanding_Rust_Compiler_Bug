{"sha": "906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwNmJiOGQwZThiYmQwMjZmYzkzM2ZlM2Y1YjgyOWJlNWU0YWM2OWU=", "commit": {"author": {"name": "YI", "email": "uuuuuu@protonmail.com", "date": "2020-03-09T17:51:08Z"}, "committer": {"name": "YI", "email": "uuuuuu@protonmail.com", "date": "2020-03-10T01:30:24Z"}, "message": "fix #62456", "tree": {"sha": "c444760e076eb79ef74f2aed82afea77669aec3c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c444760e076eb79ef74f2aed82afea77669aec3c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "html_url": "https://github.com/rust-lang/rust/commit/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/comments", "author": {"login": "contrun", "id": 32609395, "node_id": "MDQ6VXNlcjMyNjA5Mzk1", "avatar_url": "https://avatars.githubusercontent.com/u/32609395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/contrun", "html_url": "https://github.com/contrun", "followers_url": "https://api.github.com/users/contrun/followers", "following_url": "https://api.github.com/users/contrun/following{/other_user}", "gists_url": "https://api.github.com/users/contrun/gists{/gist_id}", "starred_url": "https://api.github.com/users/contrun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/contrun/subscriptions", "organizations_url": "https://api.github.com/users/contrun/orgs", "repos_url": "https://api.github.com/users/contrun/repos", "events_url": "https://api.github.com/users/contrun/events{/privacy}", "received_events_url": "https://api.github.com/users/contrun/received_events", "type": "User", "site_admin": false}, "committer": {"login": "contrun", "id": 32609395, "node_id": "MDQ6VXNlcjMyNjA5Mzk1", "avatar_url": "https://avatars.githubusercontent.com/u/32609395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/contrun", "html_url": "https://github.com/contrun", "followers_url": "https://api.github.com/users/contrun/followers", "following_url": "https://api.github.com/users/contrun/following{/other_user}", "gists_url": "https://api.github.com/users/contrun/gists{/gist_id}", "starred_url": "https://api.github.com/users/contrun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/contrun/subscriptions", "organizations_url": "https://api.github.com/users/contrun/orgs", "repos_url": "https://api.github.com/users/contrun/repos", "events_url": "https://api.github.com/users/contrun/events{/privacy}", "received_events_url": "https://api.github.com/users/contrun/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3dbade652ed8ebac70f903e01f51cd92c4e4302c", "url": "https://api.github.com/repos/rust-lang/rust/commits/3dbade652ed8ebac70f903e01f51cd92c4e4302c", "html_url": "https://github.com/rust-lang/rust/commit/3dbade652ed8ebac70f903e01f51cd92c4e4302c"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "859a219c95a21d151f46ee7a9a70a72c69dee168", "filename": "src/librustc_typeck/check/expr.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fexpr.rs?ref=906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "patch": "@@ -18,6 +18,7 @@ use crate::type_error_struct;\n use crate::util::common::ErrorReported;\n \n use rustc::middle::lang_items;\n+use rustc::mir::interpret::ErrorHandled;\n use rustc::ty;\n use rustc::ty::adjustment::{Adjust, Adjustment, AllowTwoPhase, AutoBorrow, AutoBorrowMutability};\n use rustc::ty::Ty;\n@@ -1039,11 +1040,18 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         };\n \n         if element_ty.references_error() {\n-            tcx.types.err\n-        } else if let Ok(count) = count {\n-            tcx.mk_ty(ty::Array(t, count))\n-        } else {\n-            tcx.types.err\n+            return tcx.types.err;\n+        }\n+        match count {\n+            Ok(count) => tcx.mk_ty(ty::Array(t, count)),\n+            Err(ErrorHandled::TooGeneric) => {\n+                self.tcx.sess.span_err(\n+                    tcx.def_span(count_def_id),\n+                    \"array lengths can't depend on generic parameters\",\n+                );\n+                tcx.types.err\n+            }\n+            Err(ErrorHandled::Reported) => tcx.types.err,\n         }\n     }\n "}, {"sha": "c5e6fe9104bc979ab5342426b2110f1a2884ed59", "filename": "src/test/ui/const-generics/issues/issue-62456.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.rs", "raw_url": "https://github.com/rust-lang/rust/raw/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.rs?ref=906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "patch": "@@ -0,0 +1,9 @@\n+#![feature(const_generics)]\n+//~^ WARN the feature `const_generics` is incomplete and may cause the compiler to crash\n+\n+fn foo<const N: usize>() {\n+    let _ = [0u64; N + 1];\n+    //~^ ERROR array lengths can't depend on generic parameters\n+}\n+\n+fn main() {}"}, {"sha": "9cdccf8407c9bf6fae0bb6ffc53ac1d4cc3e6f14", "filename": "src/test/ui/const-generics/issues/issue-62456.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-62456.stderr?ref=906bb8d0e8bbd026fc933fe3f5b829be5e4ac69e", "patch": "@@ -0,0 +1,16 @@\n+warning: the feature `const_generics` is incomplete and may cause the compiler to crash\n+  --> $DIR/issue-62456.rs:1:12\n+   |\n+LL | #![feature(const_generics)]\n+   |            ^^^^^^^^^^^^^^\n+   |\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+error: array lengths can't depend on generic parameters\n+  --> $DIR/issue-62456.rs:5:20\n+   |\n+LL |     let _ = [0u64; N + 1];\n+   |                    ^^^^^\n+\n+error: aborting due to previous error\n+"}]}