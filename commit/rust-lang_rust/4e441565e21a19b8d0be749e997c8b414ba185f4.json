{"sha": "4e441565e21a19b8d0be749e997c8b414ba185f4", "node_id": "C_kwDOAAsO6NoAKDRlNDQxNTY1ZTIxYTE5YjhkMGJlNzQ5ZTk5N2M4YjQxNGJhMTg1ZjQ", "commit": {"author": {"name": "Ali MJ Al-Nasrawy", "email": "alimjalnasrawy@gmail.com", "date": "2023-02-01T10:52:44Z"}, "committer": {"name": "Ali MJ Al-Nasrawy", "email": "alimjalnasrawy@gmail.com", "date": "2023-03-09T08:15:23Z"}, "message": "resolve regions before implied bounds", "tree": {"sha": "28dba3ebf8a6fcc5867d857526384fb5a614ca18", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/28dba3ebf8a6fcc5867d857526384fb5a614ca18"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e441565e21a19b8d0be749e997c8b414ba185f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e441565e21a19b8d0be749e997c8b414ba185f4", "html_url": "https://github.com/rust-lang/rust/commit/4e441565e21a19b8d0be749e997c8b414ba185f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e441565e21a19b8d0be749e997c8b414ba185f4/comments", "author": {"login": "aliemjay", "id": 28497461, "node_id": "MDQ6VXNlcjI4NDk3NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/28497461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliemjay", "html_url": "https://github.com/aliemjay", "followers_url": "https://api.github.com/users/aliemjay/followers", "following_url": "https://api.github.com/users/aliemjay/following{/other_user}", "gists_url": "https://api.github.com/users/aliemjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliemjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliemjay/subscriptions", "organizations_url": "https://api.github.com/users/aliemjay/orgs", "repos_url": "https://api.github.com/users/aliemjay/repos", "events_url": "https://api.github.com/users/aliemjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aliemjay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aliemjay", "id": 28497461, "node_id": "MDQ6VXNlcjI4NDk3NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/28497461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliemjay", "html_url": "https://github.com/aliemjay", "followers_url": "https://api.github.com/users/aliemjay/followers", "following_url": "https://api.github.com/users/aliemjay/following{/other_user}", "gists_url": "https://api.github.com/users/aliemjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliemjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliemjay/subscriptions", "organizations_url": "https://api.github.com/users/aliemjay/orgs", "repos_url": "https://api.github.com/users/aliemjay/repos", "events_url": "https://api.github.com/users/aliemjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aliemjay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95bcca85ff9a07e70f160e4e48a67d2e70b7c207", "url": "https://api.github.com/repos/rust-lang/rust/commits/95bcca85ff9a07e70f160e4e48a67d2e70b7c207", "html_url": "https://github.com/rust-lang/rust/commit/95bcca85ff9a07e70f160e4e48a67d2e70b7c207"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "e2c198fabde6dc46129333cb69fe756b6d5ac685", "filename": "compiler/rustc_trait_selection/src/traits/outlives_bounds.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4e441565e21a19b8d0be749e997c8b414ba185f4/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Foutlives_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4e441565e21a19b8d0be749e997c8b414ba185f4/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Foutlives_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Foutlives_bounds.rs?ref=4e441565e21a19b8d0be749e997c8b414ba185f4", "patch": "@@ -3,7 +3,8 @@ use crate::traits::query::type_op::{self, TypeOp, TypeOpOutput};\n use crate::traits::query::NoSolution;\n use crate::traits::ObligationCause;\n use rustc_data_structures::fx::FxIndexSet;\n-use rustc_middle::ty::{self, ParamEnv, Ty};\n+use rustc_infer::infer::resolve::OpportunisticRegionResolver;\n+use rustc_middle::ty::{self, ParamEnv, Ty, TypeFolder, TypeVisitableExt};\n use rustc_span::def_id::LocalDefId;\n \n pub use rustc_middle::traits::query::OutlivesBound;\n@@ -52,6 +53,10 @@ impl<'a, 'tcx: 'a> InferCtxtExt<'a, 'tcx> for InferCtxt<'tcx> {\n         body_id: LocalDefId,\n         ty: Ty<'tcx>,\n     ) -> Vec<OutlivesBound<'tcx>> {\n+        let ty = self.resolve_vars_if_possible(ty);\n+        let ty = OpportunisticRegionResolver::new(self).fold_ty(ty);\n+        assert!(!ty.needs_infer());\n+\n         let span = self.tcx.def_span(body_id);\n         let result = param_env\n             .and(type_op::implied_outlives_bounds::ImpliedOutlivesBounds { ty })\n@@ -105,10 +110,7 @@ impl<'a, 'tcx: 'a> InferCtxtExt<'a, 'tcx> for InferCtxt<'tcx> {\n         tys: FxIndexSet<Ty<'tcx>>,\n     ) -> Bounds<'a, 'tcx> {\n         tys.into_iter()\n-            .map(move |ty| {\n-                let ty = self.resolve_vars_if_possible(ty);\n-                self.implied_outlives_bounds(param_env, body_id, ty)\n-            })\n+            .map(move |ty| self.implied_outlives_bounds(param_env, body_id, ty))\n             .flatten()\n     }\n }"}]}