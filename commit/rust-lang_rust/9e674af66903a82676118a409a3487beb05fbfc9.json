{"sha": "9e674af66903a82676118a409a3487beb05fbfc9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNjc0YWY2NjkwM2E4MjY3NjExOGE0MDlhMzQ4N2JlYjA1ZmJmYzk=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-06-03T09:37:17Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-06-03T09:40:54Z"}, "message": "fix testing Miri with --stage 0", "tree": {"sha": "955045d1756453dd53ea64b56f415c8b5056da4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/955045d1756453dd53ea64b56f415c8b5056da4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e674af66903a82676118a409a3487beb05fbfc9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e674af66903a82676118a409a3487beb05fbfc9", "html_url": "https://github.com/rust-lang/rust/commit/9e674af66903a82676118a409a3487beb05fbfc9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e674af66903a82676118a409a3487beb05fbfc9/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2f601ef527a37de9fb181c5fb1a6c06d06218ed3", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f601ef527a37de9fb181c5fb1a6c06d06218ed3", "html_url": "https://github.com/rust-lang/rust/commit/2f601ef527a37de9fb181c5fb1a6c06d06218ed3"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "da298f7edb9f45b7141963a92c4739c09e0d85dd", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=9e674af66903a82676118a409a3487beb05fbfc9", "patch": "@@ -709,7 +709,15 @@ impl<'a> Builder<'a> {\n             return;\n         }\n \n-        add_dylib_path(vec![self.rustc_libdir(compiler)], cmd);\n+        let mut dylib_dirs = vec![self.rustc_libdir(compiler)];\n+\n+        // Ensure that the downloaded LLVM libraries can be found.\n+        if self.config.llvm_from_ci {\n+            let ci_llvm_lib = self.out.join(&*compiler.host.triple).join(\"ci-llvm\").join(\"lib\");\n+            dylib_dirs.push(ci_llvm_lib);\n+        }\n+\n+        add_dylib_path(dylib_dirs, cmd);\n     }\n \n     /// Gets a path to the compiler specified."}, {"sha": "7bd29c61b0cdb7b4e6b9f7168fbc4ab7751e9329", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=9e674af66903a82676118a409a3487beb05fbfc9", "patch": "@@ -449,6 +449,7 @@ impl Step for Miri {\n                 SourceType::Submodule,\n                 &[],\n             );\n+            cargo.add_rustc_lib_path(builder, compiler);\n             cargo.arg(\"--\").arg(\"miri\").arg(\"setup\");\n \n             // Tell `cargo miri setup` where to find the sources.\n@@ -500,6 +501,7 @@ impl Step for Miri {\n                 SourceType::Submodule,\n                 &[],\n             );\n+            cargo.add_rustc_lib_path(builder, compiler);\n \n             // miri tests need to know about the stage sysroot\n             cargo.env(\"MIRI_SYSROOT\", miri_sysroot);\n@@ -508,8 +510,6 @@ impl Step for Miri {\n \n             cargo.arg(\"--\").args(builder.config.cmd.test_args());\n \n-            cargo.add_rustc_lib_path(builder, compiler);\n-\n             let mut cargo = Command::from(cargo);\n             if !try_run(builder, &mut cargo) {\n                 return;"}, {"sha": "4c1cd758f0d1577f8dd06fa30680495bae3e8b01", "filename": "src/bootstrap/util.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e674af66903a82676118a409a3487beb05fbfc9/src%2Fbootstrap%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Futil.rs?ref=9e674af66903a82676118a409a3487beb05fbfc9", "patch": "@@ -45,6 +45,7 @@ pub fn libdir(target: TargetSelection) -> &'static str {\n }\n \n /// Adds a list of lookup paths to `cmd`'s dynamic library lookup path.\n+/// If The dylib_path_par is already set for this cmd, the old value will be overwritten!\n pub fn add_dylib_path(path: Vec<PathBuf>, cmd: &mut Command) {\n     let mut list = dylib_path();\n     for path in path {"}]}