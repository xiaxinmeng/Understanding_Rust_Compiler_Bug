{"sha": "5660b8bfb5130a6840931c63623a2aaf99775844", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2NjBiOGJmYjUxMzBhNjg0MDkzMWM2MzYyM2EyYWFmOTk3NzU4NDQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-01-23T23:29:09Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-01-24T00:04:14Z"}, "message": "add msgsend.rs to benchmarks", "tree": {"sha": "c8eeb3280085a40505ba1f2690f3c072db8159c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8eeb3280085a40505ba1f2690f3c072db8159c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5660b8bfb5130a6840931c63623a2aaf99775844", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5660b8bfb5130a6840931c63623a2aaf99775844", "html_url": "https://github.com/rust-lang/rust/commit/5660b8bfb5130a6840931c63623a2aaf99775844", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5660b8bfb5130a6840931c63623a2aaf99775844/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6db688e893f69632624fb8d2e3b747a3b81000b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/6db688e893f69632624fb8d2e3b747a3b81000b0", "html_url": "https://github.com/rust-lang/rust/commit/6db688e893f69632624fb8d2e3b747a3b81000b0"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "bae12896a78eb11ad09482815dee33cb96466d9b", "filename": "src/test/bench/msgsend.rs", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/5660b8bfb5130a6840931c63623a2aaf99775844/src%2Ftest%2Fbench%2Fmsgsend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5660b8bfb5130a6840931c63623a2aaf99775844/src%2Ftest%2Fbench%2Fmsgsend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fmsgsend.rs?ref=5660b8bfb5130a6840931c63623a2aaf99775844", "patch": "@@ -0,0 +1,60 @@\n+// A port of the simplistic benchmark from\n+//\n+//    http://github.com/PaulKeeble/ScalaVErlangAgents\n+//\n+// I *think* it's the same, more or less.\n+\n+use std;\n+import std::io::writer;\n+import std::io::writer_util;\n+\n+enum request {\n+    get_count,\n+    bytes(uint),\n+    stop\n+}\n+\n+fn server(requests: comm::port<request>, responses: comm::chan<uint>) {\n+    let count = 0u;\n+    let done = false;\n+    while !done {\n+        alt comm::recv(requests) {\n+          get_count { comm::send(responses, copy count); }\n+          bytes(b) { count += b; }\n+          stop { done = true; }\n+        }\n+    }\n+    comm::send(responses, count);\n+}\n+\n+fn run(args: [str]) {\n+    let server = task::spawn_connected(server);\n+    let size = uint::from_str(args[1]);\n+    let workers = uint::from_str(args[2]);\n+    let start = std::time::precise_time_s();\n+    let to_child = server.to_child;\n+    let worker_tasks = [];\n+    uint::range(0u, workers) {|_i|\n+        worker_tasks += [task::spawn_joinable {||\n+            uint::range(0u, size / workers) {|_i|\n+                comm::send(to_child, bytes(100u));\n+            }\n+        }];\n+    }\n+    vec::iter(worker_tasks) {|t| task::join(t); }\n+    comm::send(server.to_child, stop);\n+    let result = comm::recv(server.from_child);\n+    let end = std::time::precise_time_s();\n+    let elapsed = end - start;\n+    std::io::stdout().write_str(#fmt(\"Count is %?\\n\", result));\n+    std::io::stdout().write_str(#fmt(\"Test took %? seconds\\n\", elapsed));\n+    let thruput = (size / workers * workers as float) / (elapsed as float);\n+    std::io::stdout().write_str(#fmt(\"Throughput=%f per sec\\n\", thruput));\n+}\n+\n+fn main(args: [str]) {\n+    let args1 = if vec::len(args) <= 1u { [\"\", \"10000\", \"4\"] } else { args };\n+    #debug(\"%?\", args1);\n+    run(args1);\n+}\n+"}]}