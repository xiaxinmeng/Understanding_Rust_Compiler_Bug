{"sha": "388eed383f05dbc322d5808faf7d52091d0c0fca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM4OGVlZDM4M2YwNWRiYzMyMmQ1ODA4ZmFmN2Q1MjA5MWQwYzBmY2E=", "commit": {"author": {"name": "Haitao Li", "email": "lihaitao@gmail.com", "date": "2011-11-17T04:23:43Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-11-17T08:28:30Z"}, "message": "rustc: Add a flag '--warn-unused-imports'\n\nFollowup of issue #889", "tree": {"sha": "44236821d2641d1f713b551275f676d5f1c1c926", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44236821d2641d1f713b551275f676d5f1c1c926"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/388eed383f05dbc322d5808faf7d52091d0c0fca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/388eed383f05dbc322d5808faf7d52091d0c0fca", "html_url": "https://github.com/rust-lang/rust/commit/388eed383f05dbc322d5808faf7d52091d0c0fca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/388eed383f05dbc322d5808faf7d52091d0c0fca/comments", "author": {"login": "lht", "id": 19508, "node_id": "MDQ6VXNlcjE5NTA4", "avatar_url": "https://avatars.githubusercontent.com/u/19508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lht", "html_url": "https://github.com/lht", "followers_url": "https://api.github.com/users/lht/followers", "following_url": "https://api.github.com/users/lht/following{/other_user}", "gists_url": "https://api.github.com/users/lht/gists{/gist_id}", "starred_url": "https://api.github.com/users/lht/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lht/subscriptions", "organizations_url": "https://api.github.com/users/lht/orgs", "repos_url": "https://api.github.com/users/lht/repos", "events_url": "https://api.github.com/users/lht/events{/privacy}", "received_events_url": "https://api.github.com/users/lht/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fe6484d3e6edbcc84805bae053180cb2cdf27805", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe6484d3e6edbcc84805bae053180cb2cdf27805", "html_url": "https://github.com/rust-lang/rust/commit/fe6484d3e6edbcc84805bae053180cb2cdf27805"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "55b9a3d574369d46fa28a2cceae27604f6631862", "filename": "man/rustc.1", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/388eed383f05dbc322d5808faf7d52091d0c0fca/man%2Frustc.1", "raw_url": "https://github.com/rust-lang/rust/raw/388eed383f05dbc322d5808faf7d52091d0c0fca/man%2Frustc.1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/man%2Frustc.1?ref=388eed383f05dbc322d5808faf7d52091d0c0fca", "patch": "@@ -123,6 +123,9 @@ Build a test harness.\n .TP\n \\fB--stack-growth\\fR:\n \\fBEXPERIMENTAL\\fR. Perform stack growth checks.\n+.TP\n+\\fB--warn-unused-imports\\fR:\n+Warn about unnecessary imports.\n .SH \"BUGS\"\n See \\fBhttps://github.com/graydon/rust/issues\\fR for a list of known bugs.\n .SH \"AUTHOR\""}, {"sha": "1a684c1bf6c7c9f91a5d44861e461191501fb5c0", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=388eed383f05dbc322d5808faf7d52091d0c0fca", "patch": "@@ -274,6 +274,8 @@ options:\n     --test             build test harness\n     --gc               garbage collect shared data (experimental/temporary)\n     --stack-growth     perform stack checks (experimental)\n+    --warn-unused-imports\n+                       warn about unnecessary imports\n \n \");\n }\n@@ -397,6 +399,7 @@ fn build_session_options(match: getopts::match)\n     let test = opt_present(match, \"test\");\n     let do_gc = opt_present(match, \"gc\");\n     let stack_growth = opt_present(match, \"stack-growth\");\n+    let warn_unused_imports = opt_present(match, \"warn-unused-imports\");\n     let sopts: @session::options =\n         @{library: library,\n           static: static,\n@@ -417,7 +420,8 @@ fn build_session_options(match: getopts::match)\n           no_trans: no_trans,\n           do_gc: do_gc,\n           stack_growth: stack_growth,\n-          no_asm_comments: no_asm_comments};\n+          no_asm_comments: no_asm_comments,\n+          warn_unused_imports: warn_unused_imports};\n     ret sopts;\n }\n \n@@ -457,7 +461,8 @@ fn opts() -> [getopts::opt] {\n          optmulti(\"cfg\"), optflag(\"test\"),\n          optflag(\"lib\"), optflag(\"static\"), optflag(\"gc\"),\n          optflag(\"stack-growth\"),\n-         optflag(\"no-asm-comments\")];\n+         optflag(\"no-asm-comments\"),\n+         optflag(\"warn-unused-imports\")];\n }\n \n fn build_output_filenames(ifile: str, ofile: option::t<str>,"}, {"sha": "4d7c53790ea0cabd4d2590bfee5c82fc0824ef9d", "filename": "src/comp/driver/session.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Fsession.rs?ref=388eed383f05dbc322d5808faf7d52091d0c0fca", "patch": "@@ -43,7 +43,8 @@ type options =\n      no_trans: bool,\n      do_gc: bool,\n      stack_growth: bool,\n-     no_asm_comments: bool};\n+     no_asm_comments: bool,\n+     warn_unused_imports: bool};\n \n type crate_metadata = {name: str, data: [u8]};\n "}, {"sha": "21b10280b0d39330acb70a46a1e468aac8dc8d92", "filename": "src/comp/middle/resolve.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Fcomp%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fresolve.rs?ref=388eed383f05dbc322d5808faf7d52091d0c0fca", "patch": "@@ -139,7 +139,9 @@ fn resolve_crate(sess: session, amap: ast_map::map, crate: @ast::crate) ->\n     check_for_collisions(e, *crate);\n     check_bad_exports(e);\n     resolve_names(e, crate);\n-    check_unused_imports(e);\n+    if sess.get_opts().warn_unused_imports {\n+        check_unused_imports(e);\n+    }\n     ret {def_map: e.def_map, ext_map: e.ext_map};\n }\n "}, {"sha": "f3ed51314557da8a621ab1b86bc19de5f2d9600a", "filename": "src/test/compile-fail/unused-imports-warn.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/388eed383f05dbc322d5808faf7d52091d0c0fca/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funused-imports-warn.rs?ref=388eed383f05dbc322d5808faf7d52091d0c0fca", "patch": "@@ -1,4 +1,5 @@\n // error-pattern:unused import\n+// compile-flags:--warn-unused-imports\n import cal = bar::c::cc;\n \n mod foo {"}]}