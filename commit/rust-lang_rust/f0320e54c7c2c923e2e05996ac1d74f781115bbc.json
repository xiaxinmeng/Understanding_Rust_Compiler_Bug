{"sha": "f0320e54c7c2c923e2e05996ac1d74f781115bbc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwMzIwZTU0YzdjMmM5MjNlMmUwNTk5NmFjMWQ3NGY3ODExMTViYmM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-09-16T15:09:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-09-16T15:09:38Z"}, "message": "Rollup merge of #64446 - ehuss:fix-sanitizer-build, r=alexcrichton\n\nFix build script sanitizer check.\n\n#64166 changed the way the sanitizer build scripts work. However, they were changed so that they switch between new-style to old-style cargo fingerprints. This trips up on https://github.com/rust-lang/cargo/issues/6779.\n\nIt also causes rustbuild to panic.  If you build stage1 std (with sanitizers off), and then enable sanitizers, it panics.  (This is because the build scripts don't declare that they need to re-run.)\n\nThis PR will trip https://github.com/rust-lang/cargo/issues/6779 again, unfortunately. I've been having way too many unexplained rebuilds in rust-lang/rust recently, but at least I'll know why this time.\n\nThis doesn't fix all problems with the build scripts, but arguably they should be fixed in cargo. For example, the build scripts change which rerun-if statements they declare between runs which triggers https://github.com/rust-lang/cargo/issues/7362.\n\nThe test for this is:\n1. Turn off sanitizers (which is the default)\n2. `./x.py build --stage=1 src/libstd`\n3. `./x.py build --stage=1 src/libstd` again should be a null build.\n4. Enable sanitizers.\n5. `./x.py build --stage=1 src/libstd` should rebuild with sanitizers enabled.\n6. `./x.py build --stage=1 src/libstd` again should be a null build. This actually rebuilds due to https://github.com/rust-lang/cargo/issues/7362 because the rerun-if directives changed between step 3 and 5. A 3rd attempt should be a null build.", "tree": {"sha": "cefd69da02b61b16ae4fa194ffcc5183e7304782", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cefd69da02b61b16ae4fa194ffcc5183e7304782"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0320e54c7c2c923e2e05996ac1d74f781115bbc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdf6WzCRBK7hj4Ov3rIwAAdHIIAKJPai8lV1Q7U1H6l8+78Q5Y\nQlBE/rS9EdWdkkoOABi+fGDN4KCWav4vkV0Tgv0KD6uOgD2pmDlL2DM9uk1Otb7v\nuK5VrAFnXYcXnA/cBJAzkZZUkoDhH4ARhDcP9hu0/4aAvUviPX/eAWCtXU2EAtrp\nHTQK76niNihspi6YMqFPxbgrEY6pXzxsqdwnG3ZQGOoRbuXj/OxRDBZcly5fAiWM\n2s4jkwIMoWwytcgIXVDooSIyaYQ76EGQTppiEyTwTK9swSIX/6s7qg5PDFL9kfQB\nHgRS0wCDtiv9VN68mdsZFBtv3G4VWI0xL0geWGb+kLLbLyBfbSzlreNDsyCjoHg=\n=BaGg\n-----END PGP SIGNATURE-----\n", "payload": "tree cefd69da02b61b16ae4fa194ffcc5183e7304782\nparent 2a6a342aafdbd407b41cd886a6ae33a025cd27ab\nparent 88e755607b0bd65c223fcac40756cb703449c09f\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1568646578 +0200\ncommitter GitHub <noreply@github.com> 1568646578 +0200\n\nRollup merge of #64446 - ehuss:fix-sanitizer-build, r=alexcrichton\n\nFix build script sanitizer check.\n\n#64166 changed the way the sanitizer build scripts work. However, they were changed so that they switch between new-style to old-style cargo fingerprints. This trips up on https://github.com/rust-lang/cargo/issues/6779.\n\nIt also causes rustbuild to panic.  If you build stage1 std (with sanitizers off), and then enable sanitizers, it panics.  (This is because the build scripts don't declare that they need to re-run.)\n\nThis PR will trip https://github.com/rust-lang/cargo/issues/6779 again, unfortunately. I've been having way too many unexplained rebuilds in rust-lang/rust recently, but at least I'll know why this time.\n\nThis doesn't fix all problems with the build scripts, but arguably they should be fixed in cargo. For example, the build scripts change which rerun-if statements they declare between runs which triggers https://github.com/rust-lang/cargo/issues/7362.\n\nThe test for this is:\n1. Turn off sanitizers (which is the default)\n2. `./x.py build --stage=1 src/libstd`\n3. `./x.py build --stage=1 src/libstd` again should be a null build.\n4. Enable sanitizers.\n5. `./x.py build --stage=1 src/libstd` should rebuild with sanitizers enabled.\n6. `./x.py build --stage=1 src/libstd` again should be a null build. This actually rebuilds due to https://github.com/rust-lang/cargo/issues/7362 because the rerun-if directives changed between step 3 and 5. A 3rd attempt should be a null build.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0320e54c7c2c923e2e05996ac1d74f781115bbc", "html_url": "https://github.com/rust-lang/rust/commit/f0320e54c7c2c923e2e05996ac1d74f781115bbc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0320e54c7c2c923e2e05996ac1d74f781115bbc/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a6a342aafdbd407b41cd886a6ae33a025cd27ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a6a342aafdbd407b41cd886a6ae33a025cd27ab", "html_url": "https://github.com/rust-lang/rust/commit/2a6a342aafdbd407b41cd886a6ae33a025cd27ab"}, {"sha": "88e755607b0bd65c223fcac40756cb703449c09f", "url": "https://api.github.com/repos/rust-lang/rust/commits/88e755607b0bd65c223fcac40756cb703449c09f", "html_url": "https://github.com/rust-lang/rust/commit/88e755607b0bd65c223fcac40756cb703449c09f"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "645707ccc03388efebfbee407ef4411cf96ba0fe", "filename": "src/librustc_asan/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_asan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_asan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_asan%2Fbuild.rs?ref=f0320e54c7c2c923e2e05996ac1d74f781115bbc", "patch": "@@ -4,6 +4,7 @@ use build_helper::sanitizer_lib_boilerplate;\n use cmake::Config;\n \n fn main() {\n+    println!(\"cargo:rerun-if-env-changed=RUSTC_BUILD_SANITIZERS\");\n     if env::var(\"RUSTC_BUILD_SANITIZERS\") != Ok(\"1\".to_string()) {\n         return;\n     }"}, {"sha": "73720d8c2d64ec32b65855c84edfc2cbf240a6b7", "filename": "src/librustc_lsan/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_lsan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_lsan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lsan%2Fbuild.rs?ref=f0320e54c7c2c923e2e05996ac1d74f781115bbc", "patch": "@@ -4,6 +4,7 @@ use build_helper::sanitizer_lib_boilerplate;\n use cmake::Config;\n \n fn main() {\n+    println!(\"cargo:rerun-if-env-changed=RUSTC_BUILD_SANITIZERS\");\n     if env::var(\"RUSTC_BUILD_SANITIZERS\") != Ok(\"1\".to_string()) {\n         return;\n     }"}, {"sha": "a81786ee36d04e946f486a1d02504d72d1a4ab6d", "filename": "src/librustc_msan/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_msan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_msan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_msan%2Fbuild.rs?ref=f0320e54c7c2c923e2e05996ac1d74f781115bbc", "patch": "@@ -4,6 +4,7 @@ use build_helper::sanitizer_lib_boilerplate;\n use cmake::Config;\n \n fn main() {\n+    println!(\"cargo:rerun-if-env-changed=RUSTC_BUILD_SANITIZERS\");\n     if env::var(\"RUSTC_BUILD_SANITIZERS\") != Ok(\"1\".to_string()) {\n         return;\n     }"}, {"sha": "f9333e15023277832c69de2aa524f2357734a39a", "filename": "src/librustc_tsan/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_tsan%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0320e54c7c2c923e2e05996ac1d74f781115bbc/src%2Flibrustc_tsan%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_tsan%2Fbuild.rs?ref=f0320e54c7c2c923e2e05996ac1d74f781115bbc", "patch": "@@ -4,6 +4,7 @@ use build_helper::sanitizer_lib_boilerplate;\n use cmake::Config;\n \n fn main() {\n+    println!(\"cargo:rerun-if-env-changed=RUSTC_BUILD_SANITIZERS\");\n     if env::var(\"RUSTC_BUILD_SANITIZERS\") != Ok(\"1\".to_string()) {\n         return;\n     }"}]}