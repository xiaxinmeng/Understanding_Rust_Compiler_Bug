{"sha": "b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzYjJmMWIwZDYyNmU3OWMwYTRkZDg2NTAwNDJmYjgwNWI3OWE2YzQ=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2016-12-18T21:45:39Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2016-12-18T21:56:50Z"}, "message": "Use exec for the wrapper on UNIXes\n\nThis not only avoids the small \u2013 and unnecessary \u2013 constant overhead for each compiler invocation,\nbut also helps somewhat by only having \u201ccorrect\u201d rustc processes to look for in `/proc/`.\n\nThis also makes the wrapper behave effectively as a regular exec wrapper its intended to be.", "tree": {"sha": "964c4073d3ec9b869f7da252e873156b27f956d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/964c4073d3ec9b869f7da252e873156b27f956d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4", "html_url": "https://github.com/rust-lang/rust/commit/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8327b5afafde7cdd6fd4e939d9a8fe12f76503ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/8327b5afafde7cdd6fd4e939d9a8fe12f76503ef", "html_url": "https://github.com/rust-lang/rust/commit/8327b5afafde7cdd6fd4e939d9a8fe12f76503ef"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "c5684e69994ea86618740f82ff9ba62c4cae663b", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=b3b2f1b0d626e79c0a4dd8650042fb805b79a6c4", "patch": "@@ -30,7 +30,7 @@ extern crate bootstrap;\n use std::env;\n use std::ffi::OsString;\n use std::path::PathBuf;\n-use std::process::Command;\n+use std::process::{Command, ExitStatus};\n \n fn main() {\n     let args = env::args_os().skip(1).collect::<Vec<_>>();\n@@ -180,8 +180,19 @@ fn main() {\n     }\n \n     // Actually run the compiler!\n-    std::process::exit(match cmd.status() {\n-        Ok(s) => s.code().unwrap_or(1),\n+    std::process::exit(match exec_cmd(&mut cmd) {\n+        Ok(s) => s.code().unwrap_or(0xfe),\n         Err(e) => panic!(\"\\n\\nfailed to run {:?}: {}\\n\\n\", cmd, e),\n     })\n }\n+\n+#[cfg(unix)]\n+fn exec_cmd(cmd: &mut Command) -> ::std::io::Result<ExitStatus> {\n+    use std::os::unix::process::CommandExt;\n+    Err(cmd.exec())\n+}\n+\n+#[cfg(not(unix))]\n+fn exec_cmd(cmd: &mut Command) -> ::std::io::Result<ExitStatus> {\n+    cmd.status()\n+}"}]}