{"sha": "cde22aba1c2cf55251365807bcd7170a9d34441c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkZTIyYWJhMWMyY2Y1NTI1MTM2NTgwN2JjZDcxNzBhOWQzNDQ0MWM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-01-21T14:15:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-21T14:15:14Z"}, "message": "Merge #7371\n\n7371: Change directory before running rustfmt to respect rustfmt.toml r=matklad a=lnicola\n\nFixes #6973\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>", "tree": {"sha": "861ecbf56eb8e3596aeef5ce17dc5ed6bfbe50ba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/861ecbf56eb8e3596aeef5ce17dc5ed6bfbe50ba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cde22aba1c2cf55251365807bcd7170a9d34441c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgCYxzCRBK7hj4Ov3rIwAAdHIIAI21o7Iy6GyjTtk/Ml7B4QFW\nkrqncnb9L4qdTmzBNjsINd36qAhc5YPcjTZi439Ief3oEORk3fN21akMMr7KnsxS\n2XYwYdmH4m/xJOhVCQgFwAKivZf1lZgYz0Exzyx8yApuo09//1/308OsfbcmMX4A\nlXX0fcVPhNSnyfUzUIf6476R3FspMvwXFjvFqIXdv8iORSLgRb+D9Pmhnh4U76DO\nmcDpjvu0SmAnKlSidanMUZhl9A4GqfZktB/ig8DIPpYqPbgewpFsbl2+CE9b5+lS\ndetZYM/bY+ZU9eT3VG/Hk60cL+LheCg42+VQ0DV1jRhWNGE0xqr/8OoAUKnqDSM=\n=YpFo\n-----END PGP SIGNATURE-----\n", "payload": "tree 861ecbf56eb8e3596aeef5ce17dc5ed6bfbe50ba\nparent 0045d7c6db0d9e1e5f88702249c90c096f1882d8\nparent c067ca505a5ca48e3bf97fe15501ad61e9a12b6a\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1611238514 +0000\ncommitter GitHub <noreply@github.com> 1611238514 +0000\n\nMerge #7371\n\n7371: Change directory before running rustfmt to respect rustfmt.toml r=matklad a=lnicola\n\nFixes #6973\n\nCo-authored-by: Lauren\u021biu Nicola <lnicola@dend.ro>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cde22aba1c2cf55251365807bcd7170a9d34441c", "html_url": "https://github.com/rust-lang/rust/commit/cde22aba1c2cf55251365807bcd7170a9d34441c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cde22aba1c2cf55251365807bcd7170a9d34441c/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0045d7c6db0d9e1e5f88702249c90c096f1882d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0045d7c6db0d9e1e5f88702249c90c096f1882d8", "html_url": "https://github.com/rust-lang/rust/commit/0045d7c6db0d9e1e5f88702249c90c096f1882d8"}, {"sha": "c067ca505a5ca48e3bf97fe15501ad61e9a12b6a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c067ca505a5ca48e3bf97fe15501ad61e9a12b6a", "html_url": "https://github.com/rust-lang/rust/commit/c067ca505a5ca48e3bf97fe15501ad61e9a12b6a"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "42451cd2d5e5c0eddc7326a569237666291b045c", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/cde22aba1c2cf55251365807bcd7170a9d34441c/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cde22aba1c2cf55251365807bcd7170a9d34441c/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=cde22aba1c2cf55251365807bcd7170a9d34441c", "patch": "@@ -858,6 +858,23 @@ pub(crate) fn handle_formatting(\n         RustfmtConfig::Rustfmt { extra_args } => {\n             let mut cmd = process::Command::new(toolchain::rustfmt());\n             cmd.args(extra_args);\n+            // try to chdir to the file so we can respect `rustfmt.toml`\n+            // FIXME: use `rustfmt --config-path` once\n+            // https://github.com/rust-lang/rustfmt/issues/4660 gets fixed\n+            match params.text_document.uri.to_file_path() {\n+                Ok(mut path) => {\n+                    // pop off file name\n+                    if path.pop() && path.is_dir() {\n+                        cmd.current_dir(path);\n+                    }\n+                }\n+                Err(_) => {\n+                    log::error!(\n+                        \"Unable to get file path for {}, rustfmt.toml might be ignored\",\n+                        params.text_document.uri\n+                    );\n+                }\n+            }\n             if let Some(&crate_id) = crate_ids.first() {\n                 // Assume all crates are in the same edition\n                 let edition = snap.analysis.crate_edition(crate_id)?;"}]}