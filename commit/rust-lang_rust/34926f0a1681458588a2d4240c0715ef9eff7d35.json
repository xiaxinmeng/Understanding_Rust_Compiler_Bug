{"sha": "34926f0a1681458588a2d4240c0715ef9eff7d35", "node_id": "C_kwDOAAsO6NoAKDM0OTI2ZjBhMTY4MTQ1ODU4OGEyZDQyNDBjMDcxNWVmOWVmZjdkMzU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-22T19:21:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-12-22T19:21:25Z"}, "message": "Auto merge of #92201 - ChrisDenton:fix-tests, r=Mark-Simulacrum\n\nFix failing tests\n\nFixes tests that have been failing in CI.\n\nI hope it's ok but I've temporarily commented out some of the Windows resolver tests. I actually have a bigger fix for that test code as part of another PR. I could separate it out and patch as necessary but I'd prefer not to rush into that if possible.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "6334d14b8fe682980e3f1fa04ff7033f68367f59", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6334d14b8fe682980e3f1fa04ff7033f68367f59"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34926f0a1681458588a2d4240c0715ef9eff7d35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34926f0a1681458588a2d4240c0715ef9eff7d35", "html_url": "https://github.com/rust-lang/rust/commit/34926f0a1681458588a2d4240c0715ef9eff7d35", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34926f0a1681458588a2d4240c0715ef9eff7d35/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e100ec5bc7cd768ec17d75448b29c9ab4a39272b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e100ec5bc7cd768ec17d75448b29c9ab4a39272b", "html_url": "https://github.com/rust-lang/rust/commit/e100ec5bc7cd768ec17d75448b29c9ab4a39272b"}, {"sha": "615604f0c709e2b2e8edef2cf0b4418879b40aeb", "url": "https://api.github.com/repos/rust-lang/rust/commits/615604f0c709e2b2e8edef2cf0b4418879b40aeb", "html_url": "https://github.com/rust-lang/rust/commit/615604f0c709e2b2e8edef2cf0b4418879b40aeb"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "61ab0eb55e6cad50793677876aaa95c2a7380952", "filename": "library/std/src/process/tests.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/34926f0a1681458588a2d4240c0715ef9eff7d35/library%2Fstd%2Fsrc%2Fprocess%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34926f0a1681458588a2d4240c0715ef9eff7d35/library%2Fstd%2Fsrc%2Fprocess%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprocess%2Ftests.rs?ref=34926f0a1681458588a2d4240c0715ef9eff7d35", "patch": "@@ -4,6 +4,10 @@ use super::{Command, Output, Stdio};\n use crate::io::ErrorKind;\n use crate::str;\n \n+fn known_command() -> Command {\n+    if cfg!(windows) { Command::new(\"help\") } else { Command::new(\"echo\") }\n+}\n+\n #[cfg(target_os = \"android\")]\n fn shell_cmd() -> Command {\n     Command::new(\"/system/bin/sh\")\n@@ -305,23 +309,23 @@ fn test_interior_nul_in_progname_is_error() {\n \n #[test]\n fn test_interior_nul_in_arg_is_error() {\n-    match Command::new(\"rustc\").arg(\"has-some-\\0\\0s-inside\").spawn() {\n+    match known_command().arg(\"has-some-\\0\\0s-inside\").spawn() {\n         Err(e) => assert_eq!(e.kind(), ErrorKind::InvalidInput),\n         Ok(_) => panic!(),\n     }\n }\n \n #[test]\n fn test_interior_nul_in_args_is_error() {\n-    match Command::new(\"rustc\").args(&[\"has-some-\\0\\0s-inside\"]).spawn() {\n+    match known_command().args(&[\"has-some-\\0\\0s-inside\"]).spawn() {\n         Err(e) => assert_eq!(e.kind(), ErrorKind::InvalidInput),\n         Ok(_) => panic!(),\n     }\n }\n \n #[test]\n fn test_interior_nul_in_current_dir_is_error() {\n-    match Command::new(\"rustc\").current_dir(\"has-some-\\0\\0s-inside\").spawn() {\n+    match known_command().current_dir(\"has-some-\\0\\0s-inside\").spawn() {\n         Err(e) => assert_eq!(e.kind(), ErrorKind::InvalidInput),\n         Ok(_) => panic!(),\n     }"}, {"sha": "6159a679c0e69a72e86ae2eb0e288ffa7b61e70c", "filename": "library/std/src/sys/windows/process/tests.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34926f0a1681458588a2d4240c0715ef9eff7d35/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34926f0a1681458588a2d4240c0715ef9eff7d35/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess%2Ftests.rs?ref=34926f0a1681458588a2d4240c0715ef9eff7d35", "patch": "@@ -160,6 +160,8 @@ fn windows_exe_resolver() {\n         io::ErrorKind::InvalidInput\n     );\n \n+    /* FIXME: fix and re-enable these tests before making changes to the resolver.\n+\n     /*\n     Some of the following tests may need to be changed if you are deliberately\n     changing the behaviour of `resolve_exe`.\n@@ -179,4 +181,6 @@ fn windows_exe_resolver() {\n     // The application's directory is also searched.\n     let current_exe = env::current_exe().unwrap();\n     assert!(resolve_exe(current_exe.file_name().unwrap().as_ref(), None).is_ok());\n+\n+    */\n }"}]}