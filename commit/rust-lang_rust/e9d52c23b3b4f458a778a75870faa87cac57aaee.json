{"sha": "e9d52c23b3b4f458a778a75870faa87cac57aaee", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU5ZDUyYzIzYjNiNGY0NThhNzc4YTc1ODcwZmFhODdjYWM1N2FhZWU=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-07-04T08:26:03Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-07-04T08:30:56Z"}, "message": "minor: fix lint completion sourcegen", "tree": {"sha": "8d6c5df0adebc892fcc867ac03d429dbceca87c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d6c5df0adebc892fcc867ac03d429dbceca87c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e9d52c23b3b4f458a778a75870faa87cac57aaee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e9d52c23b3b4f458a778a75870faa87cac57aaee", "html_url": "https://github.com/rust-lang/rust/commit/e9d52c23b3b4f458a778a75870faa87cac57aaee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e9d52c23b3b4f458a778a75870faa87cac57aaee/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "266636450d816c74fbf5103e09cb2959fb708759", "url": "https://api.github.com/repos/rust-lang/rust/commits/266636450d816c74fbf5103e09cb2959fb708759", "html_url": "https://github.com/rust-lang/rust/commit/266636450d816c74fbf5103e09cb2959fb708759"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "ed3ac7203b9f057b12dfa81cf5c873f562ac336e", "filename": "crates/ide_completion/src/tests/sourcegen.rs", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e9d52c23b3b4f458a778a75870faa87cac57aaee/crates%2Fide_completion%2Fsrc%2Ftests%2Fsourcegen.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e9d52c23b3b4f458a778a75870faa87cac57aaee/crates%2Fide_completion%2Fsrc%2Ftests%2Fsourcegen.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Ftests%2Fsourcegen.rs?ref=e9d52c23b3b4f458a778a75870faa87cac57aaee", "patch": "@@ -1,9 +1,5 @@\n //! Generates descriptors structure for unstable feature from Unstable Book\n-use std::{\n-    borrow::Cow,\n-    fs,\n-    path::{Path, PathBuf},\n-};\n+use std::{borrow::Cow, fs, path::Path};\n \n use stdx::format_to;\n use test_utils::project_root;\n@@ -29,11 +25,14 @@ pub struct Lint {\n     generate_lint_descriptor(&mut contents);\n     contents.push('\\n');\n \n-    generate_feature_descriptor(&mut contents, \"./target/rust/src/doc/unstable-book/src\".into());\n+    generate_feature_descriptor(&mut contents, &rust_repo.join(\"src/doc/unstable-book/src\"));\n     contents.push('\\n');\n \n-    cmd!(\"curl https://rust-lang.github.io/rust-clippy/master/lints.json --output ./target/clippy_lints.json\").run().unwrap();\n-    generate_descriptor_clippy(&mut contents, Path::new(\"./target/clippy_lints.json\"));\n+    let lints_json = project_root().join(\"./target/clippy_lints.json\");\n+    cmd!(\"curl https://rust-lang.github.io/rust-clippy/master/lints.json --output {lints_json}\")\n+        .run()\n+        .unwrap();\n+    generate_descriptor_clippy(&mut contents, &lints_json);\n \n     let contents =\n         sourcegen::add_preamble(\"sourcegen_lint_completions\", sourcegen::reformat(contents));\n@@ -79,7 +78,7 @@ fn generate_lint_descriptor(buf: &mut String) {\n     buf.push_str(\"];\\n\");\n }\n \n-fn generate_feature_descriptor(buf: &mut String, src_dir: PathBuf) {\n+fn generate_feature_descriptor(buf: &mut String, src_dir: &Path) {\n     let mut features = [\"language-features\", \"library-features\"]\n         .iter()\n         .flat_map(|it| sourcegen::list_files(&src_dir.join(it)))"}]}