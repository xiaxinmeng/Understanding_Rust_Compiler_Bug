{"sha": "de1e1ad706fa80fb2950b4173f655379521651b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlMWUxYWQ3MDZmYTgwZmIyOTUwYjQxNzNmNjU1Mzc5NTIxNjUxYjQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-27T05:26:11Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-27T05:26:11Z"}, "message": "Stabilize repr_align_enum in 1.37.0.", "tree": {"sha": "38cd7c74c3c148afa699be87445c17173ca5f759", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/38cd7c74c3c148afa699be87445c17173ca5f759"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de1e1ad706fa80fb2950b4173f655379521651b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de1e1ad706fa80fb2950b4173f655379521651b4", "html_url": "https://github.com/rust-lang/rust/commit/de1e1ad706fa80fb2950b4173f655379521651b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de1e1ad706fa80fb2950b4173f655379521651b4/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed2a5115daaffdab30b102405ffcfb222decf444", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed2a5115daaffdab30b102405ffcfb222decf444", "html_url": "https://github.com/rust-lang/rust/commit/ed2a5115daaffdab30b102405ffcfb222decf444"}], "stats": {"total": 101, "additions": 11, "deletions": 90}, "files": [{"sha": "415c6ebe8b4bcfe7e45026f4e0dda575da807bcb", "filename": "src/doc/unstable-book/src/language-features/repr-align-enum.md", "status": "removed", "additions": 0, "deletions": 42, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md", "raw_url": "https://github.com/rust-lang/rust/raw/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Frepr-align-enum.md?ref=ed2a5115daaffdab30b102405ffcfb222decf444", "patch": "@@ -1,42 +0,0 @@\n-# `repr_align_enum`\n-\n-The tracking issue for this feature is: [#57996]\n-\n-[#57996]: https://github.com/rust-lang/rust/issues/57996\n-\n-------------------------\n-\n-The `repr_align_enum` feature allows using the `#[repr(align(x))]` attribute\n-on enums, similarly to structs.\n-\n-# Examples\n-\n-```rust\n-#![feature(repr_align_enum)]\n-\n-#[repr(align(8))]\n-enum Aligned {\n-    Foo,\n-    Bar { value: u32 },\n-}\n-\n-fn main() {\n-    assert_eq!(std::mem::align_of::<Aligned>(), 8);\n-}\n-```\n-\n-This is equivalent to using an aligned wrapper struct everywhere:\n-\n-```rust\n-#[repr(align(8))]\n-struct Aligned(Unaligned);\n-\n-enum Unaligned {\n-    Foo,\n-    Bar { value: u32 },\n-}\n-\n-fn main() {\n-    assert_eq!(std::mem::align_of::<Aligned>(), 8);\n-}\n-```"}, {"sha": "cebddbc556e2ea9c638f93422842ab1fa5b1564f", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 14, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -548,9 +548,6 @@ declare_features! (\n     // Allows using `#[optimize(X)]`.\n     (active, optimize_attribute, \"1.34.0\", Some(54882), None),\n \n-    // Allows using `#[repr(align(X))]` on enums.\n-    (active, repr_align_enum, \"1.34.0\", Some(57996), None),\n-\n     // Allows using C-variadics.\n     (active, c_variadic, \"1.34.0\", Some(44930), None),\n \n@@ -833,6 +830,9 @@ declare_features! (\n     (accepted, extern_crate_self, \"1.34.0\", Some(56409), None),\n     // Allows arbitrary delimited token streams in non-macro attributes.\n     (accepted, unrestricted_attribute_tokens, \"1.34.0\", Some(55208), None),\n+    // Allows using `#[repr(align(X))]` on enums with equivalent semantics\n+    // to wrapping an enum in a wrapper struct with `#[repr(align(X))]`.\n+    (accepted, repr_align_enum, \"1.37.0\", Some(57996), None),\n \n     // -------------------------------------------------------------------------\n     // feature-group-end: accepted features\n@@ -1995,17 +1995,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 }\n             }\n \n-            ast::ItemKind::Enum(..) => {\n-                for attr in attr::filter_by_name(&i.attrs[..], sym::repr) {\n-                    for item in attr.meta_item_list().unwrap_or_else(Vec::new) {\n-                        if item.check_name(sym::align) {\n-                            gate_feature_post!(&self, repr_align_enum, attr.span,\n-                                               \"`#[repr(align(x))]` on enums is experimental\");\n-                        }\n-                    }\n-                }\n-            }\n-\n             ast::ItemKind::Impl(_, polarity, defaultness, _, _, _, _) => {\n                 if polarity == ast::ImplPolarity::Negative {\n                     gate_feature_post!(&self, optin_builtin_traits,"}, {"sha": "4241fcea8047dd68f7ecb08f8082946c12eb2d0e", "filename": "src/test/codegen/align-enum.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fcodegen%2Falign-enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fcodegen%2Falign-enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Falign-enum.rs?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -3,7 +3,6 @@\n // min-llvm-version 7.0\n \n #![crate_type = \"lib\"]\n-#![feature(repr_align_enum)]\n \n #[repr(align(64))]\n pub enum Align64 {"}, {"sha": "fa872caa3b47edf003d5d94369072b4be858e5f5", "filename": "src/test/run-pass/structs-enums/align-enum.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstructs-enums%2Falign-enum.rs?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -1,6 +1,5 @@\n // run-pass\n #![allow(dead_code)]\n-#![feature(repr_align_enum)]\n \n use std::mem;\n "}, {"sha": "ef64dfe20bc9dc59fec15e6f99b8d626b80ba898", "filename": "src/test/ui/attr-usage-repr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Fattr-usage-repr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Fattr-usage-repr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattr-usage-repr.rs?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -1,5 +1,4 @@\n #![feature(repr_simd)]\n-#![feature(repr_align_enum)]\n \n #[repr(C)] //~ ERROR: attribute should be applied to struct, enum or union\n fn f() {}"}, {"sha": "d1f4f3bfeb2cbad20a6f463a09c49712e8002450", "filename": "src/test/ui/attr-usage-repr.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Fattr-usage-repr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Fattr-usage-repr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattr-usage-repr.stderr?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -1,29 +1,29 @@\n error[E0517]: attribute should be applied to struct, enum or union\n-  --> $DIR/attr-usage-repr.rs:4:8\n+  --> $DIR/attr-usage-repr.rs:3:8\n    |\n LL | #[repr(C)]\n    |        ^\n LL | fn f() {}\n    | --------- not a struct, enum or union\n \n error[E0517]: attribute should be applied to enum\n-  --> $DIR/attr-usage-repr.rs:16:8\n+  --> $DIR/attr-usage-repr.rs:15:8\n    |\n LL | #[repr(i8)]\n    |        ^^\n LL | struct SInt(f64, f64);\n    | ---------------------- not an enum\n \n error[E0517]: attribute should be applied to struct or union\n-  --> $DIR/attr-usage-repr.rs:25:8\n+  --> $DIR/attr-usage-repr.rs:24:8\n    |\n LL | #[repr(packed)]\n    |        ^^^^^^\n LL | enum EPacked { A, B }\n    | --------------------- not a struct or union\n \n error[E0517]: attribute should be applied to struct\n-  --> $DIR/attr-usage-repr.rs:28:8\n+  --> $DIR/attr-usage-repr.rs:27:8\n    |\n LL | #[repr(simd)]\n    |        ^^^^"}, {"sha": "8b68caa6f5b0ed498a8904c435bf65b7b13e88ef", "filename": "src/test/ui/feature-gates/feature-gate-repr_align_enum.rs", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.rs?ref=ed2a5115daaffdab30b102405ffcfb222decf444", "patch": "@@ -1,10 +0,0 @@\n-#[repr(align(16))]\n-struct Foo(u64);\n-\n-#[repr(align(8))] //~ ERROR `#[repr(align(x))]` on enums is experimental\n-enum Bar {\n-    Foo { foo: Foo },\n-    Baz,\n-}\n-\n-fn main() { }"}, {"sha": "36924f4c167ca0b7e11ae67d5ac886ef2ebcc036", "filename": "src/test/ui/feature-gates/feature-gate-repr_align_enum.stderr", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ed2a5115daaffdab30b102405ffcfb222decf444/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-repr_align_enum.stderr?ref=ed2a5115daaffdab30b102405ffcfb222decf444", "patch": "@@ -1,12 +0,0 @@\n-error[E0658]: `#[repr(align(x))]` on enums is experimental\n-  --> $DIR/feature-gate-repr_align_enum.rs:4:1\n-   |\n-LL | #[repr(align(8))]\n-   | ^^^^^^^^^^^^^^^^^\n-   |\n-   = note: for more information, see https://github.com/rust-lang/rust/issues/57996\n-   = help: add #![feature(repr_align_enum)] to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "2e90360aff2f19fbbd531d2357dab9aa897ce3c4", "filename": "src/test/ui/repr/repr-align.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-align.rs?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -1,4 +1,3 @@\n-#![feature(repr_align_enum)]\n #![allow(dead_code)]\n \n #[repr(align(16.0))] //~ ERROR: invalid `repr(align)` attribute: not an unsuffixed integer"}, {"sha": "645ed0c8ad3b15cb3abc5d03d838c419bc991eef", "filename": "src/test/ui/repr/repr-align.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/de1e1ad706fa80fb2950b4173f655379521651b4/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frepr%2Frepr-align.stderr?ref=de1e1ad706fa80fb2950b4173f655379521651b4", "patch": "@@ -1,23 +1,23 @@\n error[E0589]: invalid `repr(align)` attribute: not an unsuffixed integer\n-  --> $DIR/repr-align.rs:4:8\n+  --> $DIR/repr-align.rs:3:8\n    |\n LL | #[repr(align(16.0))]\n    |        ^^^^^^^^^^^\n \n error[E0589]: invalid `repr(align)` attribute: not a power of two\n-  --> $DIR/repr-align.rs:7:8\n+  --> $DIR/repr-align.rs:6:8\n    |\n LL | #[repr(align(15))]\n    |        ^^^^^^^^^\n \n error[E0589]: invalid `repr(align)` attribute: larger than 2^29\n-  --> $DIR/repr-align.rs:10:8\n+  --> $DIR/repr-align.rs:9:8\n    |\n LL | #[repr(align(4294967296))]\n    |        ^^^^^^^^^^^^^^^^^\n \n error[E0589]: invalid `repr(align)` attribute: not a power of two\n-  --> $DIR/repr-align.rs:16:8\n+  --> $DIR/repr-align.rs:15:8\n    |\n LL | #[repr(align(15))]\n    |        ^^^^^^^^^"}]}