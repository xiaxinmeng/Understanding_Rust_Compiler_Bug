{"sha": "c4b6216943eebbf17e6ea5641a0f32976633c4f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0YjYyMTY5NDNlZWJiZjE3ZTZlYTU2NDFhMGYzMjk3NjYzM2M0ZjI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-21T06:55:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-07-21T06:55:27Z"}, "message": "auto merge of #7913 : brson/rust/rm-install-snap, r=graydon", "tree": {"sha": "e5688a3906a053870ddc51b49eb70729237658c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e5688a3906a053870ddc51b49eb70729237658c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4b6216943eebbf17e6ea5641a0f32976633c4f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4b6216943eebbf17e6ea5641a0f32976633c4f2", "html_url": "https://github.com/rust-lang/rust/commit/c4b6216943eebbf17e6ea5641a0f32976633c4f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4b6216943eebbf17e6ea5641a0f32976633c4f2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c325cb0a42c2b2c0b12eeb1ebf4cc22bca0fe994", "url": "https://api.github.com/repos/rust-lang/rust/commits/c325cb0a42c2b2c0b12eeb1ebf4cc22bca0fe994", "html_url": "https://github.com/rust-lang/rust/commit/c325cb0a42c2b2c0b12eeb1ebf4cc22bca0fe994"}, {"sha": "79677f05562ecc076feb2ee26958f53fb5fe5603", "url": "https://api.github.com/repos/rust-lang/rust/commits/79677f05562ecc076feb2ee26958f53fb5fe5603", "html_url": "https://github.com/rust-lang/rust/commit/79677f05562ecc076feb2ee26958f53fb5fe5603"}], "stats": {"total": 41, "additions": 2, "deletions": 39}, "files": [{"sha": "f4044c91494e75e1a97d5428f8b114854f716887", "filename": "mk/snap.mk", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c4b6216943eebbf17e6ea5641a0f32976633c4f2/mk%2Fsnap.mk", "raw_url": "https://github.com/rust-lang/rust/raw/c4b6216943eebbf17e6ea5641a0f32976633c4f2/mk%2Fsnap.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fsnap.mk?ref=c4b6216943eebbf17e6ea5641a0f32976633c4f2", "patch": "@@ -12,13 +12,8 @@ define DEF_SNAP_FOR_STAGE_H\n # $(1) stage\n # $(2) triple\n \n-ifdef CFG_INSTALL_SNAP\n-snap-stage$(1)-H-$(2): $$(HSREQ$(1)_H_$(2))\n-\t$(CFG_PYTHON) $(S)src/etc/make-snapshot.py stage$(1) $(2) install\n-else\n snap-stage$(1)-H-$(2): $$(HSREQ$(1)_H_$(2))\n \t$(CFG_PYTHON) $(S)src/etc/make-snapshot.py stage$(1) $(2)\n-endif\n \n endef\n "}, {"sha": "a60d26673d8ce7e75875b9410422bdff48e8af8a", "filename": "src/etc/make-snapshot.py", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c4b6216943eebbf17e6ea5641a0f32976633c4f2/src%2Fetc%2Fmake-snapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/c4b6216943eebbf17e6ea5641a0f32976633c4f2/src%2Fetc%2Fmake-snapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fmake-snapshot.py?ref=c4b6216943eebbf17e6ea5641a0f32976633c4f2", "patch": "@@ -3,7 +3,4 @@\n \n import snapshot, sys\n \n-if len(sys.argv) == 3:\n-    print(snapshot.make_snapshot(sys.argv[1], sys.argv[2], \"\"))\n-else:\n-    print(snapshot.make_snapshot(sys.argv[1], sys.argv[2], sys.argv[3]))\n+print(snapshot.make_snapshot(sys.argv[1], sys.argv[2]))"}, {"sha": "8169b46c63f16fe401964486d4ce1c6f25a4588c", "filename": "src/etc/snapshot.py", "status": "modified", "additions": 1, "deletions": 30, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/c4b6216943eebbf17e6ea5641a0f32976633c4f2/src%2Fetc%2Fsnapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/c4b6216943eebbf17e6ea5641a0f32976633c4f2/src%2Fetc%2Fsnapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fsnapshot.py?ref=c4b6216943eebbf17e6ea5641a0f32976633c4f2", "patch": "@@ -156,7 +156,7 @@ def hash_file(x):\n     return scrub(h.hexdigest())\n \n \n-def make_snapshot(stage, triple, flag):\n+def make_snapshot(stage, triple):\n     kernel = get_kernel(triple)\n     platform = get_platform(triple)\n     rev = local_rev_short_sha()\n@@ -190,33 +190,4 @@ def in_tar_name(fn):\n \n     shutil.move(file0, file1)\n \n-    if flag == \"install\":\n-      # FIXME (#2664): this is an ugly quick hack; pls make it better\n-      path  = file1\n-      comps = path.split(\"-\")\n-      parts = { 'year': comps[2], \\\n-                'month': comps[3], \\\n-                'date': comps[4], \\\n-                'check': comps[5], \\\n-                'plat': comps[6], \\\n-                'arch': comps[7], \\\n-                'sha': comps[8].split(\".\")[0] }\n-\n-      shutil.move(path, \"dl/\" + path)\n-      shutil.move('src/snapshots.txt', 'src/snapshots-old.txt')\n-\n-      newf = open('src/snapshots.txt', 'w')\n-      newf.write(\"T %(year)s-%(month)s-%(date)s %(check)s\\n\" % parts)\n-      newf.write(\"  %(plat)s-%(arch)s %(sha)s\\n\\n\" % parts)\n-\n-      oldf = open('src/snapshots-old.txt', 'r')\n-      for line in oldf:\n-        newf.write(line)\n-      oldf.close()\n-\n-      newf.close()\n-\n-      os.remove('src/snapshots-old.txt')\n-\n-\n     return file1"}]}