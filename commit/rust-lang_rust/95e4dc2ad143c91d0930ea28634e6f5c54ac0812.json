{"sha": "95e4dc2ad143c91d0930ea28634e6f5c54ac0812", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1ZTRkYzJhZDE0M2M5MWQwOTMwZWEyODYzNGU2ZjVjNTRhYzA4MTI=", "commit": {"author": {"name": "Vitali Lovich", "email": "vlovich@google.com", "date": "2018-02-05T23:11:00Z"}, "committer": {"name": "Vitali Lovich", "email": "vlovich@google.com", "date": "2018-02-05T23:11:00Z"}, "message": "Simplify wait_timeout_until & fix condition typo", "tree": {"sha": "8d42679e28f49b3d3788d453dfb5e4436a30a5a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8d42679e28f49b3d3788d453dfb5e4436a30a5a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95e4dc2ad143c91d0930ea28634e6f5c54ac0812", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95e4dc2ad143c91d0930ea28634e6f5c54ac0812", "html_url": "https://github.com/rust-lang/rust/commit/95e4dc2ad143c91d0930ea28634e6f5c54ac0812", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95e4dc2ad143c91d0930ea28634e6f5c54ac0812/comments", "author": null, "committer": null, "parents": [{"sha": "e72bd6df5398dd7ee02c6057b861537c49649b4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e72bd6df5398dd7ee02c6057b861537c49649b4e", "html_url": "https://github.com/rust-lang/rust/commit/e72bd6df5398dd7ee02c6057b861537c49649b4e"}], "stats": {"total": 15, "additions": 7, "deletions": 8}, "files": [{"sha": "e6a3388aa2587a4e46563da5a91df16a676e4b4e", "filename": "src/libstd/sync/condvar.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/95e4dc2ad143c91d0930ea28634e6f5c54ac0812/src%2Flibstd%2Fsync%2Fcondvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95e4dc2ad143c91d0930ea28634e6f5c54ac0812/src%2Flibstd%2Fsync%2Fcondvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Fcondvar.rs?ref=95e4dc2ad143c91d0930ea28634e6f5c54ac0812", "patch": "@@ -475,17 +475,16 @@ impl Condvar {\n                                         mut dur: Duration, mut condition: F)\n                                         -> LockResult<(MutexGuard<'a, T>, WaitTimeoutResult)>\n                                         where F: FnMut(&mut T) -> bool {\n-        let timed_out = Duration::new(0, 0);\n+        let start = Instant::now();\n         loop {\n-            if !condition(&mut *guard) {\n+            if condition(&mut *guard) {\n                 return Ok((guard, WaitTimeoutResult(false)));\n-            } else if dur == timed_out {\n-                return Ok((guard, WaitTimeoutResult(true)));\n             }\n-            let wait_timer = Instant::now();\n-            let wait_result = self.wait_timeout(guard, dur)?;\n-            dur = dur.checked_sub(wait_timer.elapsed()).unwrap_or(timed_out);\n-            guard = wait_result.0;\n+            let timeout = match dur.checked_sub(start.elapsed()) {\n+                Some(timeout) => timeout,\n+                None => return Ok((guard, WaitTimeoutResult(true))),\n+            }\n+            guard = self.wait_timeout(guard, dur)?.0;\n         }\n     }\n "}]}