{"sha": "f0fcdbc021e9f166120755ee340f15558cd23bbe", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYwZmNkYmMwMjFlOWYxNjYxMjA3NTVlZTM0MGYxNTU1OGNkMjNiYmU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-11-20T16:22:19Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-11-20T18:51:05Z"}, "message": "Properly handle reexport of foreign items.\n\nHandles `pub use` of `extern { fn, static, type }`. Also plug in some more\n`match` arms where handling `extern type` is reasonable.\n\nFixed #46098.", "tree": {"sha": "f43e19e3ec813f3e9ed9a705e2b7f08437977eb6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f43e19e3ec813f3e9ed9a705e2b7f08437977eb6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f0fcdbc021e9f166120755ee340f15558cd23bbe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAloTJBkACgkQ/vbIBR0O\nATxPzQ//XLLgsSHJiBk++R9VYCja52cxk3JL1seURMBDXyLJ/uNCbiEDuMZVjFhn\nm+LEFBJNjyRBA9oSc+VDu8D0hTXVBZHUHpzeNw59HYltl6pcZNnW08YBGas1RDGa\n8zlD09izaDTZjZzTkAgQz48Iw7gOuaY4RWlakOB5pK+gNIV4/DVAdKvBSZh3eAIA\nUFG/HCi9t4uvCX8b0BBPbFtLEWpVHe/Neubnf19hJ0veHqkzITiYN1bnzLo5F1i2\nIHJ0Gh4XfOzM0RtI7p3LO9BE+yAgqHTXTIMpt/wAPcgq2c7Og0pH/8W/n4X3Mkkx\ntvNIUqxh5WVMSvFgdM+fp37+HSTmTEE8Na2uETxKvGFsHlNPjhzquYb80H/JmLsr\nFgYMd99Ppa12VyGwyofNK3AK0JaNX++12DRKYCe/HzvuXDNkQ8HX+IIlhUkjv3+b\n5IeXZT8IlSstRtP/VlHB+PGckQDQlF+fIMLq7d/He+Tzbo+pK+cAiXbHvp3YPkrN\nFr0GSZ6GgH5coEaVThvPvh4rjvrMe/15kk+CDFSj7XzXFMr89xcc4oz7Fe0PywWC\nJ5InZCDfV481GFFD9Ym5a4vfex3NesXCeuLL3XEOnNphnxfIX5mjzYdtp7/0CSPa\niagIRwt5lv8lvDpjgCGArmMakhy9B7cNnWLUn05RDoOCeJPrPPw=\n=hlny\n-----END PGP SIGNATURE-----", "payload": "tree f43e19e3ec813f3e9ed9a705e2b7f08437977eb6\nparent e06138338f78cd2695f857855e685e9e50a2486b\nauthor kennytm <kennytm@gmail.com> 1511194939 +0800\ncommitter kennytm <kennytm@gmail.com> 1511203865 +0800\n\nProperly handle reexport of foreign items.\n\nHandles `pub use` of `extern { fn, static, type }`. Also plug in some more\n`match` arms where handling `extern type` is reasonable.\n\nFixed #46098.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f0fcdbc021e9f166120755ee340f15558cd23bbe", "html_url": "https://github.com/rust-lang/rust/commit/f0fcdbc021e9f166120755ee340f15558cd23bbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f0fcdbc021e9f166120755ee340f15558cd23bbe/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e06138338f78cd2695f857855e685e9e50a2486b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e06138338f78cd2695f857855e685e9e50a2486b", "html_url": "https://github.com/rust-lang/rust/commit/e06138338f78cd2695f857855e685e9e50a2486b"}], "stats": {"total": 79, "additions": 79, "deletions": 0}, "files": [{"sha": "101874e495b05e28dabe4a70b334a4581d39329c", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=f0fcdbc021e9f166120755ee340f15558cd23bbe", "patch": "@@ -2970,6 +2970,7 @@ fn register_def(cx: &DocContext, def: Def) -> DefId {\n         Def::Struct(i) => (i, TypeKind::Struct),\n         Def::Union(i) => (i, TypeKind::Union),\n         Def::Mod(i) => (i, TypeKind::Module),\n+        Def::TyForeign(i) => (i, TypeKind::Foreign),\n         Def::Static(i, _) => (i, TypeKind::Static),\n         Def::Variant(i) => (cx.tcx.parent_def_id(i).unwrap(), TypeKind::Enum),\n         Def::SelfTy(Some(def_id), _) => (def_id, TypeKind::Trait),"}, {"sha": "fe1dac36be1f9beb7267dee65fb4b6bbefe477a9", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=f0fcdbc021e9f166120755ee340f15558cd23bbe", "patch": "@@ -306,6 +306,7 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n                 Def::Struct(did) |\n                 Def::Union(did) |\n                 Def::Enum(did) |\n+                Def::TyForeign(did) |\n                 Def::TyAlias(did) if !self_is_hidden => {\n                     self.cx.access_levels.borrow_mut().map.insert(did, AccessLevel::Public);\n                 },\n@@ -348,6 +349,17 @@ impl<'a, 'tcx> RustdocVisitor<'a, 'tcx> {\n                 self.inlining = prev;\n                 true\n             }\n+            hir_map::NodeForeignItem(it) if !glob => {\n+                // generate a fresh `extern {}` block if we want to inline a foreign item.\n+                om.foreigns.push(hir::ForeignMod {\n+                    abi: tcx.hir.get_foreign_abi(it.id),\n+                    items: vec![hir::ForeignItem {\n+                        name: renamed.unwrap_or(it.name),\n+                        .. it.clone()\n+                    }].into(),\n+                });\n+                true\n+            }\n             _ => false,\n         };\n         self.view_item_stack.remove(&def_node_id);"}, {"sha": "714222de529ee33e01afe2bbb5281319627d475b", "filename": "src/test/rustdoc/foreigntype-reexport.rs", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Ftest%2Frustdoc%2Fforeigntype-reexport.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f0fcdbc021e9f166120755ee340f15558cd23bbe/src%2Ftest%2Frustdoc%2Fforeigntype-reexport.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fforeigntype-reexport.rs?ref=f0fcdbc021e9f166120755ee340f15558cd23bbe", "patch": "@@ -0,0 +1,66 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(extern_types)]\n+\n+mod sub {\n+    extern {\n+        /// Another extern type.\n+        pub type C2;\n+        pub fn f2();\n+        pub static K: usize;\n+    }\n+}\n+\n+pub mod sub2 {\n+    extern {\n+        // @has foreigntype_reexport/sub2/foreigntype.C.html\n+        pub type C;\n+        // @has foreigntype_reexport/sub2/fn.f.html\n+        pub fn f();\n+        // @has foreigntype_reexport/sub2/static.K3.html\n+        pub static K3: usize;\n+    }\n+}\n+\n+mod sub3 {\n+    extern {\n+        pub type C4;\n+        pub fn f4();\n+        pub static K4: usize;\n+        type X4;\n+    }\n+}\n+\n+// @has foreigntype_reexport/foreigntype.C2.html\n+// @has foreigntype_reexport/fn.f2.html\n+// @has foreigntype_reexport/static.K2.html\n+// @has foreigntype_reexport/index.html '//a[@class=\"foreigntype\"]' 'C2'\n+// @has foreigntype_reexport/index.html '//a[@class=\"fn\"]' 'f2'\n+// @has foreigntype_reexport/index.html '//a[@class=\"static\"]' 'K2'\n+pub use self::sub::{C2, f2, K as K2};\n+\n+// @has foreigntype_reexport/index.html '//a[@class=\"foreigntype\"]' 'C'\n+// @has foreigntype_reexport/index.html '//a[@class=\"fn\"]' 'f'\n+// @has foreigntype_reexport/index.html '//a[@class=\"static\"]' 'K3'\n+// @has foreigntype_reexport/index.html '//code' 'pub use self::sub2::C as C3;'\n+// @has foreigntype_reexport/index.html '//code' 'pub use self::sub2::f as f3;'\n+// @has foreigntype_reexport/index.html '//code' 'pub use self::sub2::K3;'\n+pub use self::sub2::{C as C3, f as f3, K3};\n+\n+// @has foreigntype_reexport/foreigntype.C4.html\n+// @has foreigntype_reexport/fn.f4.html\n+// @has foreigntype_reexport/static.K4.html\n+// @!has foreigntype_reexport/foreigntype.X4.html\n+// @has foreigntype_reexport/index.html '//a[@class=\"foreigntype\"]' 'C4'\n+// @has foreigntype_reexport/index.html '//a[@class=\"fn\"]' 'f4'\n+// @has foreigntype_reexport/index.html '//a[@class=\"static\"]' 'K4'\n+// @!has foreigntype_reexport/index.html '//a[@class=\"foreigntype\"]' 'X4'\n+pub use self::sub3::*;"}]}