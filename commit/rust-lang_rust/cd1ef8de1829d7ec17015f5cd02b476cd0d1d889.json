{"sha": "cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNkMWVmOGRlMTgyOWQ3ZWMxNzAxNWY1Y2QwMmI0NzZjZDBkMWQ4ODk=", "commit": {"author": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-06-17T14:54:49Z"}, "committer": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-06-21T09:31:53Z"}, "message": "Fix extract_function with await", "tree": {"sha": "6f55d82065d6e79cf93e1b6493ab9266d9985e0a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f55d82065d6e79cf93e1b6493ab9266d9985e0a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "html_url": "https://github.com/rust-lang/rust/commit/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889/comments", "author": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3898387f3bd579c0c5415ecb7c7b3d3923947f2f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3898387f3bd579c0c5415ecb7c7b3d3923947f2f", "html_url": "https://github.com/rust-lang/rust/commit/3898387f3bd579c0c5415ecb7c7b3d3923947f2f"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "62edc4850f47127431df301755e9abbcbe445f1c", "filename": "crates/ide_assists/src/handlers/extract_function.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs?ref=cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "patch": "@@ -994,6 +994,9 @@ fn format_replacement(ctx: &AssistContext, fun: &Function, indent: IndentLevel)\n         }\n     }\n     format_to!(buf, \"{}\", expr);\n+    if body_contains_await(&fun.body) {\n+        buf.push_str(\".await\");\n+    }\n     if fun.ret_ty.is_unit()\n         && (!fun.vars_defined_in_body_and_outlive.is_empty() || !expr.is_block_like())\n     {\n@@ -3681,7 +3684,7 @@ async fn some_function() {\n \"#,\n             r#\"\n fn main() {\n-    fun_name();\n+    fun_name().await;\n }\n \n async fn $0fun_name() {\n@@ -3710,7 +3713,7 @@ async fn some_function() {\n \"#,\n             r#\"\n fn main() {\n-    fun_name();\n+    fun_name().await;\n }\n \n async fn $0fun_name() {"}]}