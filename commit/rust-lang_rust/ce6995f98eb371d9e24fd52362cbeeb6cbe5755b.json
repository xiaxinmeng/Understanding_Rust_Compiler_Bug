{"sha": "ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlNjk5NWY5OGViMzcxZDllMjRmZDUyMzYyY2JlZWI2Y2JlNTc1NWI=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2020-01-16T14:09:49Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2020-01-20T11:00:43Z"}, "message": "Add regression test for shared-generics x dylibs (#67276).", "tree": {"sha": "b71db46ea54040ebf1e9bf7d553336305ac4f312", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b71db46ea54040ebf1e9bf7d553336305ac4f312"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "html_url": "https://github.com/rust-lang/rust/commit/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31095d7e3799e1e9d403ac88fa10b3906eb8ba37", "url": "https://api.github.com/repos/rust-lang/rust/commits/31095d7e3799e1e9d403ac88fa10b3906eb8ba37", "html_url": "https://github.com/rust-lang/rust/commit/31095d7e3799e1e9d403ac88fa10b3906eb8ba37"}], "stats": {"total": 74, "additions": 74, "deletions": 0}, "files": [{"sha": "c6b5efcb4cdd8269ff14e1370dbc9dacf47568b7", "filename": "src/test/run-make-fulldeps/share-generics-dylib/Makefile", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2FMakefile?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,22 @@\n+# This test makes sure all generic instances get re-exported from Rust dylibs for use by\n+# `-Zshare-generics`. There are two rlibs (`instance_provider_a` and `instance_provider_b`)\n+# which both provide an instance of `Cell<i32>::set`. There is `instance_user_dylib` which is\n+# supposed to re-export both these instances, and then there are `instance_user_a_rlib` and\n+# `instance_user_b_rlib` which each rely on a specific instance to be available.\n+#\n+# In the end everything is linked together into `linked_leaf`. If `instance_user_dylib` does\n+# not export both then we'll get an `undefined reference` error for one of the instances.\n+#\n+# This is regression test for https://github.com/rust-lang/rust/issues/67276.\n+\n+-include ../../run-make-fulldeps/tools.mk\n+\n+COMMON_ARGS=-Cprefer-dynamic -Zshare-generics=yes -Ccodegen-units=1 -Zsymbol-mangling-version=v0\n+\n+all:\n+\t$(RUSTC) instance_provider_a.rs $(COMMON_ARGS) --crate-type=rlib\n+\t$(RUSTC) instance_provider_b.rs $(COMMON_ARGS) --crate-type=rlib\n+\t$(RUSTC) instance_user_dylib.rs $(COMMON_ARGS) --crate-type=dylib\n+\t$(RUSTC) instance_user_a_rlib.rs $(COMMON_ARGS) --crate-type=rlib\n+\t$(RUSTC) instance_user_b_rlib.rs $(COMMON_ARGS) --crate-type=rlib\n+\t$(RUSTC) linked_leaf.rs $(COMMON_ARGS) --crate-type=bin"}, {"sha": "b4e125ac0523ae72b491238fa0fe43afd5c68057", "filename": "src/test/run-make-fulldeps/share-generics-dylib/instance_provider_a.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_a.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_a.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_a.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,6 @@\n+use std::cell::Cell;\n+\n+pub fn foo() {\n+    let a: Cell<i32> = Cell::new(1);\n+    a.set(123);\n+}"}, {"sha": "f613db873e6c6c41d6e1380db7fcf755a4328f34", "filename": "src/test/run-make-fulldeps/share-generics-dylib/instance_provider_b.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_b.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_b.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_provider_b.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,6 @@\n+use std::cell::Cell;\n+\n+pub fn foo() {\n+    let b: Cell<i32> = Cell::new(1);\n+    b.set(123);\n+}"}, {"sha": "c8e6ab95cf9ceccf9e40bf25005b1c1952098a44", "filename": "src/test/run-make-fulldeps/share-generics-dylib/instance_user_a_rlib.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_a_rlib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_a_rlib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_a_rlib.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,9 @@\n+extern crate instance_provider_a as upstream;\n+use std::cell::Cell;\n+\n+pub fn foo() {\n+    upstream::foo();\n+\n+    let b: Cell<i32> = Cell::new(1);\n+    b.set(123);\n+}"}, {"sha": "7c34af6d0dc8705842175a0be2ca1bc0024d57be", "filename": "src/test/run-make-fulldeps/share-generics-dylib/instance_user_b_rlib.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_b_rlib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_b_rlib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_b_rlib.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,9 @@\n+extern crate instance_provider_b as upstream;\n+use std::cell::Cell;\n+\n+pub fn foo() {\n+    upstream::foo();\n+\n+    let b: Cell<i32> = Cell::new(1);\n+    b.set(123);\n+}"}, {"sha": "7c8368eec654b4e8f5d256871d90a0f96048dc97", "filename": "src/test/run-make-fulldeps/share-generics-dylib/instance_user_dylib.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_dylib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_dylib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Finstance_user_dylib.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,7 @@\n+extern crate instance_provider_a;\n+extern crate instance_provider_b;\n+\n+pub fn foo() {\n+    instance_provider_a::foo();\n+    instance_provider_b::foo();\n+}"}, {"sha": "e510dad691c572e97b37348c28b69652e3087ba7", "filename": "src/test/run-make-fulldeps/share-generics-dylib/linked_leaf.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Flinked_leaf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce6995f98eb371d9e24fd52362cbeeb6cbe5755b/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Flinked_leaf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fshare-generics-dylib%2Flinked_leaf.rs?ref=ce6995f98eb371d9e24fd52362cbeeb6cbe5755b", "patch": "@@ -0,0 +1,15 @@\n+extern crate instance_user_dylib;\n+extern crate instance_user_a_rlib;\n+extern crate instance_user_b_rlib;\n+\n+use std::cell::Cell;\n+\n+fn main() {\n+\n+    instance_user_a_rlib::foo();\n+    instance_user_b_rlib::foo();\n+    instance_user_dylib::foo();\n+\n+    let a: Cell<i32> = Cell::new(1);\n+    a.set(123);\n+}"}]}