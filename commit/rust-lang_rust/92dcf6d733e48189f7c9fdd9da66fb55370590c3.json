{"sha": "92dcf6d733e48189f7c9fdd9da66fb55370590c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyZGNmNmQ3MzNlNDgxODlmN2M5ZmRkOWRhNjZmYjU1MzcwNTkwYzM=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-18T14:46:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-18T14:46:25Z"}, "message": "Rollup merge of #78999 - petrochenkov:deprid, r=eddyb\n\nstability: More precise location for deprecation lint on macros\n\nOne missing piece of https://github.com/rust-lang/rust/pull/73178.", "tree": {"sha": "be1b0fe5aac331abc86d3068f261f65a58269f1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be1b0fe5aac331abc86d3068f261f65a58269f1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92dcf6d733e48189f7c9fdd9da66fb55370590c3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJftTPBCRBK7hj4Ov3rIwAAdHIIABBJDqwj/2GDPkE7dnszegv3\nkXaLlRdGQZX6ibPo2HASgLlOp7lb4biJ8xZ7t5Zi1EaiJizGsgTbbwADDDQMy5DW\n+JCraXLAaJW3Fo4OVfCPIXgf1+oNZ0oIR5W9FzKccvK/JqIFQSxpy2R25bYUGdfJ\n1e+U2Zv++jAI2tXacoQwP1RjXdgSRIT2dSR0Nk+tQH7j/2KpOnkzaaRhHYZXrHBN\n2npzRzaU5pnsGFdd1Fm5p9VoBPGaCJUVmcZL5PwpSELOaai49OCnyicyoCSqpTWE\n+4KHGLcDAGbN861lwgwa+iP2Ko3o6VHOkv1Z7CE90lyx1krXilpcPJrVGFpzfHQ=\n=KLXb\n-----END PGP SIGNATURE-----\n", "payload": "tree be1b0fe5aac331abc86d3068f261f65a58269f1d\nparent 61134aa54cd70f6d6a540f9ce221310456b683ce\nparent 909c8945b172662494c0d0bd4cc89af618a41ffb\nauthor Mara Bos <m-ou.se@m-ou.se> 1605710785 +0100\ncommitter GitHub <noreply@github.com> 1605710785 +0100\n\nRollup merge of #78999 - petrochenkov:deprid, r=eddyb\n\nstability: More precise location for deprecation lint on macros\n\nOne missing piece of https://github.com/rust-lang/rust/pull/73178.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92dcf6d733e48189f7c9fdd9da66fb55370590c3", "html_url": "https://github.com/rust-lang/rust/commit/92dcf6d733e48189f7c9fdd9da66fb55370590c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92dcf6d733e48189f7c9fdd9da66fb55370590c3/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61134aa54cd70f6d6a540f9ce221310456b683ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/61134aa54cd70f6d6a540f9ce221310456b683ce", "html_url": "https://github.com/rust-lang/rust/commit/61134aa54cd70f6d6a540f9ce221310456b683ce"}, {"sha": "909c8945b172662494c0d0bd4cc89af618a41ffb", "url": "https://api.github.com/repos/rust-lang/rust/commits/909c8945b172662494c0d0bd4cc89af618a41ffb", "html_url": "https://github.com/rust-lang/rust/commit/909c8945b172662494c0d0bd4cc89af618a41ffb"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "47c140e0b18829b4e82b051f1dbd9000edda2e7f", "filename": "compiler/rustc_middle/src/middle/stability.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/92dcf6d733e48189f7c9fdd9da66fb55370590c3/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92dcf6d733e48189f7c9fdd9da66fb55370590c3/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs?ref=92dcf6d733e48189f7c9fdd9da66fb55370590c3", "patch": "@@ -4,7 +4,7 @@\n pub use self::StabilityLevel::*;\n \n use crate::ty::{self, TyCtxt};\n-use rustc_ast::CRATE_NODE_ID;\n+use rustc_ast::NodeId;\n use rustc_attr::{self as attr, ConstStability, Deprecation, Stability};\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n use rustc_errors::{Applicability, DiagnosticBuilder};\n@@ -211,13 +211,14 @@ pub fn early_report_deprecation(\n     suggestion: Option<Symbol>,\n     lint: &'static Lint,\n     span: Span,\n+    node_id: NodeId,\n ) {\n     if span.in_derive_expansion() {\n         return;\n     }\n \n     let diag = BuiltinLintDiagnostics::DeprecatedMacro(suggestion, span);\n-    lint_buffer.buffer_lint_with_diagnostic(lint, CRATE_NODE_ID, span, message, diag);\n+    lint_buffer.buffer_lint_with_diagnostic(lint, node_id, span, message, diag);\n }\n \n fn late_report_deprecation("}, {"sha": "21e43be20456b654697fc376f997a0243867e536", "filename": "compiler/rustc_resolve/src/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/92dcf6d733e48189f7c9fdd9da66fb55370590c3/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92dcf6d733e48189f7c9fdd9da66fb55370590c3/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs?ref=92dcf6d733e48189f7c9fdd9da66fb55370590c3", "patch": "@@ -1034,6 +1034,7 @@ impl<'a> Resolver<'a> {\n                 depr.suggestion,\n                 lint,\n                 span,\n+                node_id,\n             );\n         }\n     }"}, {"sha": "a9c7ac363b0b31261b0993c550d84dc99c5badb7", "filename": "src/test/ui/lint/expansion-time.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92dcf6d733e48189f7c9fdd9da66fb55370590c3/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92dcf6d733e48189f7c9fdd9da66fb55370590c3/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs?ref=92dcf6d733e48189f7c9fdd9da66fb55370590c3", "patch": "@@ -12,6 +12,16 @@ mod benches {\n     fn foo() {}\n }\n \n+#[deprecated = \"reason\"]\n+macro_rules! deprecated {\n+    () => {}\n+}\n+\n+#[allow(deprecated)]\n+mod deprecated {\n+    deprecated!(); // No warning\n+}\n+\n #[warn(incomplete_include)]\n fn main() {\n     // WARN see in the stderr file, the warning points to the included file."}, {"sha": "24e2733064e48029f0be9f6eab9977db04e861b3", "filename": "src/test/ui/lint/expansion-time.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/92dcf6d733e48189f7c9fdd9da66fb55370590c3/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/92dcf6d733e48189f7c9fdd9da66fb55370590c3/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr?ref=92dcf6d733e48189f7c9fdd9da66fb55370590c3", "patch": "@@ -33,7 +33,7 @@ LL | 2\n    | ^\n    |\n note: the lint level is defined here\n-  --> $DIR/expansion-time.rs:15:8\n+  --> $DIR/expansion-time.rs:25:8\n    |\n LL | #[warn(incomplete_include)]\n    |        ^^^^^^^^^^^^^^^^^^"}]}