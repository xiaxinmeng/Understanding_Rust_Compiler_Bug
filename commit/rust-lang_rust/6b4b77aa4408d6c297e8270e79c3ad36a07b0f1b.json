{"sha": "6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiNGI3N2FhNDQwOGQ2YzI5N2U4MjcwZTc5YzNhZDM2YTA3YjBmMWI=", "commit": {"author": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2021-09-09T15:33:28Z"}, "committer": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2021-09-13T04:29:24Z"}, "message": "Update test for needless-borrow FP for mutable ref", "tree": {"sha": "fe70a28e3a09b88c743b0a4177b6a34d45dee541", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe70a28e3a09b88c743b0a4177b6a34d45dee541"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b", "html_url": "https://github.com/rust-lang/rust/commit/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b/comments", "author": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a64b7698a44c2bf090049798a6fac906e96296ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/a64b7698a44c2bf090049798a6fac906e96296ec", "html_url": "https://github.com/rust-lang/rust/commit/a64b7698a44c2bf090049798a6fac906e96296ec"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "31977416bc7028738fb91c94c0a3d6dd0af4c9f9", "filename": "tests/ui/needless_borrow.rs", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b/tests%2Fui%2Fneedless_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b/tests%2Fui%2Fneedless_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.rs?ref=6b4b77aa4408d6c297e8270e79c3ad36a07b0f1b", "patch": "@@ -1,17 +1,16 @@\n // run-rustfix\n \n-#![allow(clippy::needless_borrowed_reference)]\n-\n-fn x(y: &i32) -> i32 {\n-    *y\n-}\n-\n #[warn(clippy::all, clippy::needless_borrow)]\n #[allow(unused_variables)]\n fn main() {\n     let a = 5;\n-    let b = x(&a);\n-    let c = x(&&a);\n+    let _ = x(&a); // no warning\n+    let _ = x(&&a); // warn\n+\n+    let mut b = 5;\n+    mut_ref(&mut b); // no warning\n+    mut_ref(&mut &mut b); // warn\n+\n     let s = &String::from(\"hi\");\n     let s_ident = f(&s); // should not error, because `&String` implements Copy, but `String` does not\n     let g_val = g(&Vec::new()); // should not error, because `&Vec<T>` derefs to `&[T]`\n@@ -29,6 +28,15 @@ fn main() {\n     };\n }\n \n+#[allow(clippy::needless_borrowed_reference)]\n+fn x(y: &i32) -> i32 {\n+    *y\n+}\n+\n+fn mut_ref(y: &mut i32) {\n+    *y = 5;\n+}\n+\n fn f<T: Copy>(y: &T) -> T {\n     *y\n }"}]}