{"sha": "07d56cba8ffd854f1c8b91bb1372130e5abe6169", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3ZDU2Y2JhOGZmZDg1NGYxYzhiOTFiYjEzNzIxMzBlNWFiZTYxNjk=", "commit": {"author": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2020-07-11T13:48:21Z"}, "committer": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2020-07-19T09:29:11Z"}, "message": "Fix panic as passing wrong format to `extract_gdb_version`", "tree": {"sha": "97ca97dce874a1e1337e3b5f1af1120699074cd9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/97ca97dce874a1e1337e3b5f1af1120699074cd9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07d56cba8ffd854f1c8b91bb1372130e5abe6169", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07d56cba8ffd854f1c8b91bb1372130e5abe6169", "html_url": "https://github.com/rust-lang/rust/commit/07d56cba8ffd854f1c8b91bb1372130e5abe6169", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07d56cba8ffd854f1c8b91bb1372130e5abe6169/comments", "author": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d778f326c385b2df7053b84fb5e3f89361b5fc3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d778f326c385b2df7053b84fb5e3f89361b5fc3a", "html_url": "https://github.com/rust-lang/rust/commit/d778f326c385b2df7053b84fb5e3f89361b5fc3a"}], "stats": {"total": 19, "additions": 8, "deletions": 11}, "files": [{"sha": "dc561352642b35af677cbcf162edd68fab799a96", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/07d56cba8ffd854f1c8b91bb1372130e5abe6169/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07d56cba8ffd854f1c8b91bb1372130e5abe6169/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=07d56cba8ffd854f1c8b91bb1372130e5abe6169", "patch": "@@ -132,32 +132,29 @@ impl EarlyProps {\n \n         fn ignore_gdb(config: &Config, line: &str) -> bool {\n             if let Some(actual_version) = config.gdb_version {\n-                if line.starts_with(\"min-gdb-version\") {\n-                    let (start_ver, end_ver) = extract_gdb_version_range(line);\n+                if let Some(rest) = line.strip_prefix(\"min-gdb-version:\").map(str::trim) {\n+                    let (start_ver, end_ver) = extract_gdb_version_range(rest);\n \n                     if start_ver != end_ver {\n                         panic!(\"Expected single GDB version\")\n                     }\n                     // Ignore if actual version is smaller the minimum required\n                     // version\n-                    actual_version < start_ver\n-                } else if line.starts_with(\"ignore-gdb-version\") {\n-                    let (min_version, max_version) = extract_gdb_version_range(line);\n+                    return actual_version < start_ver;\n+                } else if let Some(rest) = line.strip_prefix(\"ignore-gdb-version:\").map(str::trim) {\n+                    let (min_version, max_version) = extract_gdb_version_range(rest);\n \n                     if max_version < min_version {\n                         panic!(\"Malformed GDB version range: max < min\")\n                     }\n \n-                    actual_version >= min_version && actual_version <= max_version\n-                } else {\n-                    false\n+                    return actual_version >= min_version && actual_version <= max_version;\n                 }\n-            } else {\n-                false\n             }\n+            false\n         }\n \n-        // Takes a directive of the form \"ignore-gdb-version <version1> [- <version2>]\",\n+        // Takes a directive of the form \"<version1> [- <version2>]\",\n         // returns the numeric representation of <version1> and <version2> as\n         // tuple: (<version1> as u32, <version2> as u32)\n         // If the <version2> part is omitted, the second component of the tuple"}]}