{"sha": "2492235c323e012ed49d93391754a59ce715ebc5", "node_id": "C_kwDOAAsO6NoAKDI0OTIyMzVjMzIzZTAxMmVkNDlkOTMzOTE3NTRhNTljZTcxNWViYzU", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2022-12-14T02:00:24Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2022-12-15T19:47:40Z"}, "message": "Consider lifetimes when comparing assoc types in method chain\n\nDo not say \"Type changed to X here\" when the only difference is caused\nby lifetimes.", "tree": {"sha": "ac5120f2267e11457d631c2864732d98cf1719f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac5120f2267e11457d631c2864732d98cf1719f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2492235c323e012ed49d93391754a59ce715ebc5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2492235c323e012ed49d93391754a59ce715ebc5", "html_url": "https://github.com/rust-lang/rust/commit/2492235c323e012ed49d93391754a59ce715ebc5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2492235c323e012ed49d93391754a59ce715ebc5/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b938f73f380542b3572600111442e769591f9e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b938f73f380542b3572600111442e769591f9e5", "html_url": "https://github.com/rust-lang/rust/commit/3b938f73f380542b3572600111442e769591f9e5"}], "stats": {"total": 58, "additions": 44, "deletions": 14}, "files": [{"sha": "e77b9da08f51a7040c2df44069861afc815315f4", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2492235c323e012ed49d93391754a59ce715ebc5/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2492235c323e012ed49d93391754a59ce715ebc5/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=2492235c323e012ed49d93391754a59ce715ebc5", "patch": "@@ -3333,7 +3333,7 @@ impl<'tcx> TypeErrCtxtExt<'tcx> for TypeErrCtxt<'_, 'tcx> {\n                         let ty_str = with_forced_trimmed_paths!(self.ty_to_string(ty));\n \n                         let assoc = with_forced_trimmed_paths!(self.tcx.def_path_str(assoc));\n-                        if ty != *prev_ty {\n+                        if self.can_eq(param_env, ty, *prev_ty).is_err() {\n                             if type_diffs.iter().any(|diff| {\n                                 let Sorts(expected_found) = diff else { return false; };\n                                 self.can_eq(param_env, expected_found.found, ty).is_ok()"}, {"sha": "ebdf33303c982b311d80fb1b066cf82b52cc6946", "filename": "src/test/ui/iterators/invalid-iterator-chain.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2492235c323e012ed49d93391754a59ce715ebc5/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2492235c323e012ed49d93391754a59ce715ebc5/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.rs?ref=2492235c323e012ed49d93391754a59ce715ebc5", "patch": "@@ -1,3 +1,11 @@\n+use std::collections::hash_set::Iter;\n+use std::collections::HashSet;\n+\n+fn iter_to_vec<'b, X>(i: Iter<'b, X>) -> Vec<X> {\n+    let i = i.map(|x| x.clone());\n+    i.collect() //~ ERROR E0277\n+}\n+\n fn main() {\n     let scores = vec![(0, 0)]\n         .iter()\n@@ -38,4 +46,8 @@ fn main() {\n     });\n     let f = e.filter(|_| false);\n     let g: Vec<i32> = f.collect(); //~ ERROR E0277\n+\n+    let mut s = HashSet::new();\n+    s.insert(1u8);\n+    println!(\"{:?}\", iter_to_vec(s.iter()));\n }"}, {"sha": "d76a4bfb7b3ea886c68b8e90b2593fb4e7c477ea", "filename": "src/test/ui/iterators/invalid-iterator-chain.stderr", "status": "modified", "additions": 31, "deletions": 13, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/2492235c323e012ed49d93391754a59ce715ebc5/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2492235c323e012ed49d93391754a59ce715ebc5/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fiterators%2Finvalid-iterator-chain.stderr?ref=2492235c323e012ed49d93391754a59ce715ebc5", "patch": "@@ -1,5 +1,23 @@\n+error[E0277]: a value of type `Vec<X>` cannot be built from an iterator over elements of type `&X`\n+  --> $DIR/invalid-iterator-chain.rs:6:7\n+   |\n+LL |     i.collect()\n+   |       ^^^^^^^ value of type `Vec<X>` cannot be built from `std::iter::Iterator<Item=&X>`\n+   |\n+   = help: the trait `FromIterator<&X>` is not implemented for `Vec<X>`\n+   = help: the trait `FromIterator<T>` is implemented for `Vec<T>`\n+note: the method call chain might not have had the expected associated types\n+  --> $DIR/invalid-iterator-chain.rs:4:26\n+   |\n+LL | fn iter_to_vec<'b, X>(i: Iter<'b, X>) -> Vec<X> {\n+   |                          ^^^^^^^^^^^ `Iterator::Item` is `&X` here\n+LL |     let i = i.map(|x| x.clone());\n+   |               ------------------ `Iterator::Item` remains `&X` here\n+note: required by a bound in `collect`\n+  --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n+\n error[E0277]: a value of type `i32` cannot be made by summing an iterator over elements of type `()`\n-  --> $DIR/invalid-iterator-chain.rs:7:27\n+  --> $DIR/invalid-iterator-chain.rs:15:27\n    |\n LL |     println!(\"{}\", scores.sum::<i32>());\n    |                           ^^^ value of type `i32` cannot be made by summing a `std::iter::Iterator<Item=()>`\n@@ -9,7 +27,7 @@ LL |     println!(\"{}\", scores.sum::<i32>());\n              <i32 as Sum<&'a i32>>\n              <i32 as Sum>\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:4:10\n+  --> $DIR/invalid-iterator-chain.rs:12:10\n    |\n LL |       let scores = vec![(0, 0)]\n    |                    ------------ this expression has type `Vec<({integer}, {integer})>`\n@@ -24,7 +42,7 @@ note: required by a bound in `std::iter::Iterator::sum`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n error[E0277]: a value of type `i32` cannot be made by summing an iterator over elements of type `()`\n-  --> $DIR/invalid-iterator-chain.rs:18:14\n+  --> $DIR/invalid-iterator-chain.rs:26:14\n    |\n LL |             .sum::<i32>(),\n    |              ^^^ value of type `i32` cannot be made by summing a `std::iter::Iterator<Item=()>`\n@@ -34,7 +52,7 @@ LL |             .sum::<i32>(),\n              <i32 as Sum<&'a i32>>\n              <i32 as Sum>\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:12:14\n+  --> $DIR/invalid-iterator-chain.rs:20:14\n    |\n LL |         vec![0, 1]\n    |         ---------- this expression has type `Vec<{integer}>`\n@@ -56,7 +74,7 @@ note: required by a bound in `std::iter::Iterator::sum`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n error[E0277]: a value of type `i32` cannot be made by summing an iterator over elements of type `f64`\n-  --> $DIR/invalid-iterator-chain.rs:28:14\n+  --> $DIR/invalid-iterator-chain.rs:36:14\n    |\n LL |             .sum::<i32>(),\n    |              ^^^ value of type `i32` cannot be made by summing a `std::iter::Iterator<Item=f64>`\n@@ -66,7 +84,7 @@ LL |             .sum::<i32>(),\n              <i32 as Sum<&'a i32>>\n              <i32 as Sum>\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:24:14\n+  --> $DIR/invalid-iterator-chain.rs:32:14\n    |\n LL |         vec![0, 1]\n    |         ---------- this expression has type `Vec<{integer}>`\n@@ -84,7 +102,7 @@ note: required by a bound in `std::iter::Iterator::sum`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n error[E0277]: a value of type `i32` cannot be made by summing an iterator over elements of type `()`\n-  --> $DIR/invalid-iterator-chain.rs:30:54\n+  --> $DIR/invalid-iterator-chain.rs:38:54\n    |\n LL |     println!(\"{}\", vec![0, 1].iter().map(|x| { x; }).sum::<i32>());\n    |                                                      ^^^ value of type `i32` cannot be made by summing a `std::iter::Iterator<Item=()>`\n@@ -94,7 +112,7 @@ LL |     println!(\"{}\", vec![0, 1].iter().map(|x| { x; }).sum::<i32>());\n              <i32 as Sum<&'a i32>>\n              <i32 as Sum>\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:30:38\n+  --> $DIR/invalid-iterator-chain.rs:38:38\n    |\n LL |     println!(\"{}\", vec![0, 1].iter().map(|x| { x; }).sum::<i32>());\n    |                    ---------- ------ ^^^^^^^^^^^^^^^ `Iterator::Item` changed to `()` here\n@@ -105,7 +123,7 @@ note: required by a bound in `std::iter::Iterator::sum`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n error[E0277]: a value of type `i32` cannot be made by summing an iterator over elements of type `&()`\n-  --> $DIR/invalid-iterator-chain.rs:31:40\n+  --> $DIR/invalid-iterator-chain.rs:39:40\n    |\n LL |     println!(\"{}\", vec![(), ()].iter().sum::<i32>());\n    |                                        ^^^ value of type `i32` cannot be made by summing a `std::iter::Iterator<Item=&()>`\n@@ -115,7 +133,7 @@ LL |     println!(\"{}\", vec![(), ()].iter().sum::<i32>());\n              <i32 as Sum<&'a i32>>\n              <i32 as Sum>\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:31:33\n+  --> $DIR/invalid-iterator-chain.rs:39:33\n    |\n LL |     println!(\"{}\", vec![(), ()].iter().sum::<i32>());\n    |                    ------------ ^^^^^^ `Iterator::Item` is `&()` here\n@@ -125,15 +143,15 @@ note: required by a bound in `std::iter::Iterator::sum`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n error[E0277]: a value of type `Vec<i32>` cannot be built from an iterator over elements of type `()`\n-  --> $DIR/invalid-iterator-chain.rs:40:25\n+  --> $DIR/invalid-iterator-chain.rs:48:25\n    |\n LL |     let g: Vec<i32> = f.collect();\n    |                         ^^^^^^^ value of type `Vec<i32>` cannot be built from `std::iter::Iterator<Item=()>`\n    |\n    = help: the trait `FromIterator<()>` is not implemented for `Vec<i32>`\n    = help: the trait `FromIterator<T>` is implemented for `Vec<T>`\n note: the method call chain might not have had the expected associated types\n-  --> $DIR/invalid-iterator-chain.rs:36:15\n+  --> $DIR/invalid-iterator-chain.rs:44:15\n    |\n LL |       let a = vec![0];\n    |               ------- this expression has type `Vec<{integer}>`\n@@ -153,6 +171,6 @@ LL |       let f = e.filter(|_| false);\n note: required by a bound in `collect`\n   --> $SRC_DIR/core/src/iter/traits/iterator.rs:LL:COL\n \n-error: aborting due to 6 previous errors\n+error: aborting due to 7 previous errors\n \n For more information about this error, try `rustc --explain E0277`."}]}