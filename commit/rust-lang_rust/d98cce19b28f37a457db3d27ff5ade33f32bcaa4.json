{"sha": "d98cce19b28f37a457db3d27ff5ade33f32bcaa4", "node_id": "C_kwDOAAsO6NoAKGQ5OGNjZTE5YjI4ZjM3YTQ1N2RiM2QyN2ZmNWFkZTMzZjMyYmNhYTQ", "commit": {"author": {"name": "Jakob Degen", "email": "jakob.e.degen@gmail.com", "date": "2022-11-04T06:19:59Z"}, "committer": {"name": "Jakob Degen", "email": "jakob.e.degen@gmail.com", "date": "2022-11-04T06:19:59Z"}, "message": "Make mir opt unused file check blessable", "tree": {"sha": "374dbebcf0f995c90cf173e0fa0cd8ef22a9e9df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/374dbebcf0f995c90cf173e0fa0cd8ef22a9e9df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d98cce19b28f37a457db3d27ff5ade33f32bcaa4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d98cce19b28f37a457db3d27ff5ade33f32bcaa4", "html_url": "https://github.com/rust-lang/rust/commit/d98cce19b28f37a457db3d27ff5ade33f32bcaa4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d98cce19b28f37a457db3d27ff5ade33f32bcaa4/comments", "author": {"login": "JakobDegen", "id": 51179609, "node_id": "MDQ6VXNlcjUxMTc5NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/51179609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakobDegen", "html_url": "https://github.com/JakobDegen", "followers_url": "https://api.github.com/users/JakobDegen/followers", "following_url": "https://api.github.com/users/JakobDegen/following{/other_user}", "gists_url": "https://api.github.com/users/JakobDegen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakobDegen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakobDegen/subscriptions", "organizations_url": "https://api.github.com/users/JakobDegen/orgs", "repos_url": "https://api.github.com/users/JakobDegen/repos", "events_url": "https://api.github.com/users/JakobDegen/events{/privacy}", "received_events_url": "https://api.github.com/users/JakobDegen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JakobDegen", "id": 51179609, "node_id": "MDQ6VXNlcjUxMTc5NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/51179609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakobDegen", "html_url": "https://github.com/JakobDegen", "followers_url": "https://api.github.com/users/JakobDegen/followers", "following_url": "https://api.github.com/users/JakobDegen/following{/other_user}", "gists_url": "https://api.github.com/users/JakobDegen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakobDegen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakobDegen/subscriptions", "organizations_url": "https://api.github.com/users/JakobDegen/orgs", "repos_url": "https://api.github.com/users/JakobDegen/repos", "events_url": "https://api.github.com/users/JakobDegen/events{/privacy}", "received_events_url": "https://api.github.com/users/JakobDegen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6718ea1cff98da785c10079cac1c1ecc30c12d52", "url": "https://api.github.com/repos/rust-lang/rust/commits/6718ea1cff98da785c10079cac1c1ecc30c12d52", "html_url": "https://github.com/rust-lang/rust/commit/6718ea1cff98da785c10079cac1c1ecc30c12d52"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "018573284ea7959f6db074e64a11226a21ea8c69", "filename": "src/tools/tidy/src/mir_opt_tests.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d98cce19b28f37a457db3d27ff5ade33f32bcaa4/src%2Ftools%2Ftidy%2Fsrc%2Fmir_opt_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d98cce19b28f37a457db3d27ff5ade33f32bcaa4/src%2Ftools%2Ftidy%2Fsrc%2Fmir_opt_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmir_opt_tests.rs?ref=d98cce19b28f37a457db3d27ff5ade33f32bcaa4", "patch": "@@ -3,7 +3,7 @@\n use std::collections::HashSet;\n use std::path::{Path, PathBuf};\n \n-fn check_unused_files(path: &Path, bad: &mut bool) {\n+fn check_unused_files(path: &Path, bless: bool, bad: &mut bool) {\n     let mut rs_files = Vec::<PathBuf>::new();\n     let mut output_files = HashSet::<PathBuf>::new();\n     let files = walkdir::WalkDir::new(&path.join(\"test/mir-opt\")).into_iter();\n@@ -27,11 +27,15 @@ fn check_unused_files(path: &Path, bad: &mut bool) {\n \n     for extra in output_files {\n         if extra.file_name() != Some(\"README.md\".as_ref()) {\n-            tidy_error!(\n-                bad,\n-                \"the following output file is not associated with any mir-opt test, you can remove it: {}\",\n-                extra.display()\n-            );\n+            if !bless {\n+                tidy_error!(\n+                    bad,\n+                    \"the following output file is not associated with any mir-opt test, you can remove it: {}\",\n+                    extra.display()\n+                );\n+            } else {\n+                let _ = std::fs::remove_file(extra);\n+            }\n         }\n     }\n }\n@@ -65,6 +69,6 @@ fn check_dash_files(path: &Path, bless: bool, bad: &mut bool) {\n }\n \n pub fn check(path: &Path, bless: bool, bad: &mut bool) {\n-    check_unused_files(path, bad);\n+    check_unused_files(path, bless, bad);\n     check_dash_files(path, bless, bad);\n }"}]}