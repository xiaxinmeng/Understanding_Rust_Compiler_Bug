{"sha": "5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "node_id": "C_kwDOAAsO6NoAKDVjMGY1NWQ1MDhiNDlkYmVhNWI1ZDY5YTQxZDk5OGEwMGU3ZDk1ZDI", "commit": {"author": {"name": "Mu42", "email": "mu001999@outlook.com", "date": "2023-03-06T13:05:23Z"}, "committer": {"name": "Mu42", "email": "mu001999@outlook.com", "date": "2023-03-06T13:05:23Z"}, "message": "Moves the negative impls into a separate test file", "tree": {"sha": "99a351a1f6992c519dffc3b732654014a6757813", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99a351a1f6992c519dffc3b732654014a6757813"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "html_url": "https://github.com/rust-lang/rust/commit/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/comments", "author": {"login": "MU001999", "id": 21022101, "node_id": "MDQ6VXNlcjIxMDIyMTAx", "avatar_url": "https://avatars.githubusercontent.com/u/21022101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MU001999", "html_url": "https://github.com/MU001999", "followers_url": "https://api.github.com/users/MU001999/followers", "following_url": "https://api.github.com/users/MU001999/following{/other_user}", "gists_url": "https://api.github.com/users/MU001999/gists{/gist_id}", "starred_url": "https://api.github.com/users/MU001999/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MU001999/subscriptions", "organizations_url": "https://api.github.com/users/MU001999/orgs", "repos_url": "https://api.github.com/users/MU001999/repos", "events_url": "https://api.github.com/users/MU001999/events{/privacy}", "received_events_url": "https://api.github.com/users/MU001999/received_events", "type": "User", "site_admin": false}, "committer": {"login": "MU001999", "id": 21022101, "node_id": "MDQ6VXNlcjIxMDIyMTAx", "avatar_url": "https://avatars.githubusercontent.com/u/21022101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MU001999", "html_url": "https://github.com/MU001999", "followers_url": "https://api.github.com/users/MU001999/followers", "following_url": "https://api.github.com/users/MU001999/following{/other_user}", "gists_url": "https://api.github.com/users/MU001999/gists{/gist_id}", "starred_url": "https://api.github.com/users/MU001999/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MU001999/subscriptions", "organizations_url": "https://api.github.com/users/MU001999/orgs", "repos_url": "https://api.github.com/users/MU001999/repos", "events_url": "https://api.github.com/users/MU001999/events{/privacy}", "received_events_url": "https://api.github.com/users/MU001999/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2fe288fd2974a781991f6050cdc13bd39e97563d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2fe288fd2974a781991f6050cdc13bd39e97563d", "html_url": "https://github.com/rust-lang/rust/commit/2fe288fd2974a781991f6050cdc13bd39e97563d"}], "stats": {"total": 182, "additions": 115, "deletions": 67}, "files": [{"sha": "7712e84f4a243b0127c965bbb80e41edea9006aa", "filename": "tests/ui/auto-traits/suspicious-impls-lint.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.rs?ref=5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "patch": "@@ -1,4 +1,3 @@\n-#![feature(negative_impls)]\n #![deny(suspicious_auto_trait_impls)]\n \n use std::marker::PhantomData;\n@@ -22,9 +21,6 @@ struct ContainsVec<T>(Vec<T>);\n unsafe impl Send for ContainsVec<i32> {}\n //~^ ERROR\n //~| WARNING this will change its meaning\n-impl !Send for ContainsVec<u32> {}\n-//~^ ERROR\n-//~| WARNING this will change its meaning\n \n struct TwoParams<T, U>(T, U);\n unsafe impl<T: Send, U: Send> Send for TwoParams<T, U> {} // ok\n@@ -44,17 +40,11 @@ pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n unsafe impl<T> Send for WithPhantomDataSend<*const T, i8> {}\n //~^ ERROR\n //~| WARNING this will change its meaning\n-impl<T> !Send for WithPhantomDataSend<*const T, u8> {}\n-//~^ ERROR\n-//~| WARNING this will change its meaning\n \n pub struct WithLifetime<'a, T>(&'a (), T);\n unsafe impl<T> Send for WithLifetime<'static, T> {} // ok\n unsafe impl<T> Sync for WithLifetime<'static, Vec<T>> {}\n //~^ ERROR\n //~| WARNING this will change its meaning\n-impl<T> !Sync for WithLifetime<'static, Option<T>> {}\n-//~^ ERROR\n-//~| WARNING this will change its meaning\n \n fn main() {}"}, {"sha": "9cd4e79f851ebb4ef59148789df1baaa8f86674a", "filename": "tests/ui/auto-traits/suspicious-impls-lint.stderr", "status": "modified", "additions": 12, "deletions": 57, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fsuspicious-impls-lint.stderr?ref=5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "patch": "@@ -1,5 +1,5 @@\n error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:10:1\n+  --> $DIR/suspicious-impls-lint.rs:9:1\n    |\n LL | unsafe impl<T: Send> Send for MayImplementSendErr<&T> {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -8,18 +8,18 @@ LL | unsafe impl<T: Send> Send for MayImplementSendErr<&T> {}\n    = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n    = note: `&T` is not a generic parameter\n note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:9:1\n+  --> $DIR/suspicious-impls-lint.rs:8:1\n    |\n LL | struct MayImplementSendErr<T>(T);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n note: the lint level is defined here\n-  --> $DIR/suspicious-impls-lint.rs:2:9\n+  --> $DIR/suspicious-impls-lint.rs:1:9\n    |\n LL | #![deny(suspicious_auto_trait_impls)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:22:1\n+  --> $DIR/suspicious-impls-lint.rs:21:1\n    |\n LL | unsafe impl Send for ContainsVec<i32> {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -28,28 +28,13 @@ LL | unsafe impl Send for ContainsVec<i32> {}\n    = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n    = note: `i32` is not a generic parameter\n note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:21:1\n+  --> $DIR/suspicious-impls-lint.rs:20:1\n    |\n LL | struct ContainsVec<T>(Vec<T>);\n    | ^^^^^^^^^^^^^^^^^^^^^\n \n error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:25:1\n-   |\n-LL | impl !Send for ContainsVec<u32> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = warning: this will change its meaning in a future release!\n-   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n-   = note: `u32` is not a generic parameter\n-note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:21:1\n-   |\n-LL | struct ContainsVec<T>(Vec<T>);\n-   | ^^^^^^^^^^^^^^^^^^^^^\n-\n-error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:36:1\n+  --> $DIR/suspicious-impls-lint.rs:32:1\n    |\n LL | unsafe impl<T: Send> Send for TwoParamsSame<T, T> {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -58,13 +43,13 @@ LL | unsafe impl<T: Send> Send for TwoParamsSame<T, T> {}\n    = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n    = note: `T` is mentioned multiple times\n note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:35:1\n+  --> $DIR/suspicious-impls-lint.rs:31:1\n    |\n LL | struct TwoParamsSame<T, U>(T, U);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:44:1\n+  --> $DIR/suspicious-impls-lint.rs:40:1\n    |\n LL | unsafe impl<T> Send for WithPhantomDataSend<*const T, i8> {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -73,28 +58,13 @@ LL | unsafe impl<T> Send for WithPhantomDataSend<*const T, i8> {}\n    = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n    = note: `*const T` is not a generic parameter\n note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:43:1\n-   |\n-LL | pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: cross-crate traits with a default impl, like `Send`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:47:1\n-   |\n-LL | impl<T> !Send for WithPhantomDataSend<*const T, u8> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = warning: this will change its meaning in a future release!\n-   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n-   = note: `*const T` is not a generic parameter\n-note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:43:1\n+  --> $DIR/suspicious-impls-lint.rs:39:1\n    |\n LL | pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: cross-crate traits with a default impl, like `Sync`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:53:1\n+  --> $DIR/suspicious-impls-lint.rs:46:1\n    |\n LL | unsafe impl<T> Sync for WithLifetime<'static, Vec<T>> {}\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n@@ -103,25 +73,10 @@ LL | unsafe impl<T> Sync for WithLifetime<'static, Vec<T>> {}\n    = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n    = note: `Vec<T>` is not a generic parameter\n note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:51:1\n-   |\n-LL | pub struct WithLifetime<'a, T>(&'a (), T);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: cross-crate traits with a default impl, like `Sync`, should not be specialized\n-  --> $DIR/suspicious-impls-lint.rs:56:1\n-   |\n-LL | impl<T> !Sync for WithLifetime<'static, Option<T>> {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = warning: this will change its meaning in a future release!\n-   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n-   = note: `Option<T>` is not a generic parameter\n-note: try using the same sequence of generic parameters as the struct definition\n-  --> $DIR/suspicious-impls-lint.rs:51:1\n+  --> $DIR/suspicious-impls-lint.rs:44:1\n    |\n LL | pub struct WithLifetime<'a, T>(&'a (), T);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: aborting due to 5 previous errors\n "}, {"sha": "34842e5944b463c4003104d7c130b0351f68c638", "filename": "tests/ui/auto-traits/suspicious-negative-impls-lint.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.rs?ref=5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "patch": "@@ -0,0 +1,21 @@\n+#![feature(negative_impls)]\n+#![deny(suspicious_auto_trait_impls)]\n+\n+use std::marker::PhantomData;\n+\n+struct ContainsVec<T>(Vec<T>);\n+impl !Send for ContainsVec<u32> {}\n+//~^ ERROR\n+//~| WARNING this will change its meaning\n+\n+pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n+impl<T> !Send for WithPhantomDataSend<*const T, u8> {}\n+//~^ ERROR\n+//~| WARNING this will change its meaning\n+\n+pub struct WithLifetime<'a, T>(&'a (), T);\n+impl<T> !Sync for WithLifetime<'static, Option<T>> {}\n+//~^ ERROR\n+//~| WARNING this will change its meaning\n+\n+fn main() {}"}, {"sha": "14785b98a17dd3cd879975232fe55224552c24dd", "filename": "tests/ui/auto-traits/suspicious-negative-impls-lint.stderr", "status": "added", "additions": 82, "deletions": 0, "changes": 82, "blob_url": "https://github.com/rust-lang/rust/blob/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5c0f55d508b49dbea5b5d69a41d998a00e7d95d2/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauto-traits%2Fsuspicious-negative-impls-lint.stderr?ref=5c0f55d508b49dbea5b5d69a41d998a00e7d95d2", "patch": "@@ -0,0 +1,82 @@\n+error: cross-crate traits with a default impl, like `Send`, should not be specialized\n+  --> $DIR/suspicious-negative-impls-lint.rs:7:1\n+   |\n+LL | impl !Send for ContainsVec<u32> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this will change its meaning in a future release!\n+   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n+   = note: `u32` is not a generic parameter\n+note: try using the same sequence of generic parameters as the struct definition\n+  --> $DIR/suspicious-negative-impls-lint.rs:6:1\n+   |\n+LL | struct ContainsVec<T>(Vec<T>);\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+note: the lint level is defined here\n+  --> $DIR/suspicious-negative-impls-lint.rs:2:9\n+   |\n+LL | #![deny(suspicious_auto_trait_impls)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cross-crate traits with a default impl, like `Send`, should not be specialized\n+  --> $DIR/suspicious-negative-impls-lint.rs:12:1\n+   |\n+LL | unsafe impl<T> Send for WithPhantomDataSend<*const T, i8> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this will change its meaning in a future release!\n+   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n+   = note: `*const T` is not a generic parameter\n+note: try using the same sequence of generic parameters as the struct definition\n+  --> $DIR/suspicious-negative-impls-lint.rs:11:1\n+   |\n+LL | pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cross-crate traits with a default impl, like `Send`, should not be specialized\n+  --> $DIR/suspicious-negative-impls-lint.rs:15:1\n+   |\n+LL | impl<T> !Send for WithPhantomDataSend<*const T, u8> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this will change its meaning in a future release!\n+   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n+   = note: `*const T` is not a generic parameter\n+note: try using the same sequence of generic parameters as the struct definition\n+  --> $DIR/suspicious-negative-impls-lint.rs:11:1\n+   |\n+LL | pub struct WithPhantomDataSend<T, U>(PhantomData<T>, U);\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cross-crate traits with a default impl, like `Sync`, should not be specialized\n+  --> $DIR/suspicious-negative-impls-lint.rs:21:1\n+   |\n+LL | unsafe impl<T> Sync for WithLifetime<'static, Vec<T>> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this will change its meaning in a future release!\n+   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n+   = note: `Vec<T>` is not a generic parameter\n+note: try using the same sequence of generic parameters as the struct definition\n+  --> $DIR/suspicious-negative-impls-lint.rs:19:1\n+   |\n+LL | pub struct WithLifetime<'a, T>(&'a (), T);\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: cross-crate traits with a default impl, like `Sync`, should not be specialized\n+  --> $DIR/suspicious-negative-impls-lint.rs:24:1\n+   |\n+LL | impl<T> !Sync for WithLifetime<'static, Option<T>> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = warning: this will change its meaning in a future release!\n+   = note: for more information, see issue #93367 <https://github.com/rust-lang/rust/issues/93367>\n+   = note: `Option<T>` is not a generic parameter\n+note: try using the same sequence of generic parameters as the struct definition\n+  --> $DIR/suspicious-negative-impls-lint.rs:19:1\n+   |\n+LL | pub struct WithLifetime<'a, T>(&'a (), T);\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 5 previous errors\n+"}]}