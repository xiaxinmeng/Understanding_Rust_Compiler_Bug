{"sha": "0db95fc812d2c839e847527b774dfda170266cec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYjk1ZmM4MTJkMmM4MzllODQ3NTI3Yjc3NGRmZGExNzAyNjZjZWM=", "commit": {"author": {"name": "Ville Penttinen", "email": "villem.penttinen@gmail.com", "date": "2019-03-03T20:03:37Z"}, "committer": {"name": "Ville Penttinen", "email": "villem.penttinen@gmail.com", "date": "2019-03-03T20:03:37Z"}, "message": "Allow syntax tree to update when changing files\n\nPreviously when using the file based syntax tree, it would not update until a\nchange had been made in the new file. Now we automatically update the syntax\ntree to match the current file.", "tree": {"sha": "89f05d9798cf77a2798ff5fd643649cbb9071e77", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/89f05d9798cf77a2798ff5fd643649cbb9071e77"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0db95fc812d2c839e847527b774dfda170266cec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0db95fc812d2c839e847527b774dfda170266cec", "html_url": "https://github.com/rust-lang/rust/commit/0db95fc812d2c839e847527b774dfda170266cec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0db95fc812d2c839e847527b774dfda170266cec/comments", "author": {"login": "vipentti", "id": 4726680, "node_id": "MDQ6VXNlcjQ3MjY2ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/4726680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipentti", "html_url": "https://github.com/vipentti", "followers_url": "https://api.github.com/users/vipentti/followers", "following_url": "https://api.github.com/users/vipentti/following{/other_user}", "gists_url": "https://api.github.com/users/vipentti/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipentti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipentti/subscriptions", "organizations_url": "https://api.github.com/users/vipentti/orgs", "repos_url": "https://api.github.com/users/vipentti/repos", "events_url": "https://api.github.com/users/vipentti/events{/privacy}", "received_events_url": "https://api.github.com/users/vipentti/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vipentti", "id": 4726680, "node_id": "MDQ6VXNlcjQ3MjY2ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/4726680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vipentti", "html_url": "https://github.com/vipentti", "followers_url": "https://api.github.com/users/vipentti/followers", "following_url": "https://api.github.com/users/vipentti/following{/other_user}", "gists_url": "https://api.github.com/users/vipentti/gists{/gist_id}", "starred_url": "https://api.github.com/users/vipentti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vipentti/subscriptions", "organizations_url": "https://api.github.com/users/vipentti/orgs", "repos_url": "https://api.github.com/users/vipentti/repos", "events_url": "https://api.github.com/users/vipentti/events{/privacy}", "received_events_url": "https://api.github.com/users/vipentti/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b4e0ec1c868c7f2a0eef1e59bfa382db85a6900", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b4e0ec1c868c7f2a0eef1e59bfa382db85a6900", "html_url": "https://github.com/rust-lang/rust/commit/1b4e0ec1c868c7f2a0eef1e59bfa382db85a6900"}], "stats": {"total": 43, "additions": 26, "deletions": 17}, "files": [{"sha": "64be562250e18fb2bb40eb5b70b48b9d0b445c46", "filename": "editors/code/src/events/change_active_text_editor.ts", "status": "modified", "additions": 24, "deletions": 15, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/0db95fc812d2c839e847527b774dfda170266cec/editors%2Fcode%2Fsrc%2Fevents%2Fchange_active_text_editor.ts", "raw_url": "https://github.com/rust-lang/rust/raw/0db95fc812d2c839e847527b774dfda170266cec/editors%2Fcode%2Fsrc%2Fevents%2Fchange_active_text_editor.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fevents%2Fchange_active_text_editor.ts?ref=0db95fc812d2c839e847527b774dfda170266cec", "patch": "@@ -1,23 +1,32 @@\n import { TextEditor } from 'vscode';\n import { TextDocumentIdentifier } from 'vscode-languageclient';\n \n+import {\n+    SyntaxTreeContentProvider,\n+    syntaxTreeUri\n+} from '../commands/syntaxTree';\n import { Decoration } from '../highlighting';\n import { Server } from '../server';\n \n-export async function handle(editor: TextEditor | undefined) {\n-    if (\n-        !Server.config.highlightingOn ||\n-        !editor ||\n-        editor.document.languageId !== 'rust'\n-    ) {\n-        return;\n-    }\n-    const params: TextDocumentIdentifier = {\n-        uri: editor.document.uri.toString()\n+export function makeHandler(syntaxTreeProvider: SyntaxTreeContentProvider) {\n+    return async function handle(editor: TextEditor | undefined) {\n+        if (!editor || editor.document.languageId !== 'rust') {\n+            return;\n+        }\n+\n+        syntaxTreeProvider.eventEmitter.fire(syntaxTreeUri);\n+\n+        if (!Server.config.highlightingOn) {\n+            return;\n+        }\n+\n+        const params: TextDocumentIdentifier = {\n+            uri: editor.document.uri.toString()\n+        };\n+        const decorations = await Server.client.sendRequest<Decoration[]>(\n+            'rust-analyzer/decorationsRequest',\n+            params\n+        );\n+        Server.highlighter.setHighlights(editor, decorations);\n     };\n-    const decorations = await Server.client.sendRequest<Decoration[]>(\n-        'rust-analyzer/decorationsRequest',\n-        params\n-    );\n-    Server.highlighter.setHighlights(editor, decorations);\n }"}, {"sha": "941beba180733704e450cf9b62e60c9e5d39d9fe", "filename": "editors/code/src/extension.ts", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0db95fc812d2c839e847527b774dfda170266cec/editors%2Fcode%2Fsrc%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/0db95fc812d2c839e847527b774dfda170266cec/editors%2Fcode%2Fsrc%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fextension.ts?ref=0db95fc812d2c839e847527b774dfda170266cec", "patch": "@@ -94,13 +94,13 @@ export function activate(context: vscode.ExtensionContext) {\n             notifications.publishDecorations.handle\n         ]\n     ];\n+    const syntaxTreeContentProvider = new SyntaxTreeContentProvider();\n \n     // The events below are plain old javascript events, triggered and handled by vscode\n     vscode.window.onDidChangeActiveTextEditor(\n-        events.changeActiveTextEditor.handle\n+        events.changeActiveTextEditor.makeHandler(syntaxTreeContentProvider)\n     );\n \n-    const syntaxTreeContentProvider = new SyntaxTreeContentProvider();\n     disposeOnDeactivation(\n         vscode.workspace.registerTextDocumentContentProvider(\n             'rust-analyzer',"}]}