{"sha": "3e57b203918bc64e05c95849672ba7c23090c984", "node_id": "C_kwDOAAsO6NoAKDNlNTdiMjAzOTE4YmM2NGUwNWM5NTg0OTY3MmJhN2MyMzA5MGM5ODQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-17T23:48:26Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-02-18T20:36:39Z"}, "message": "Add test", "tree": {"sha": "98a98c11dd2091ded394a165089b6a914bb49a4a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98a98c11dd2091ded394a165089b6a914bb49a4a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e57b203918bc64e05c95849672ba7c23090c984", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e57b203918bc64e05c95849672ba7c23090c984", "html_url": "https://github.com/rust-lang/rust/commit/3e57b203918bc64e05c95849672ba7c23090c984", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e57b203918bc64e05c95849672ba7c23090c984/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d42a3fbd69e5051c803d37d47fc91f41deacf069", "url": "https://api.github.com/repos/rust-lang/rust/commits/d42a3fbd69e5051c803d37d47fc91f41deacf069", "html_url": "https://github.com/rust-lang/rust/commit/d42a3fbd69e5051c803d37d47fc91f41deacf069"}], "stats": {"total": 77, "additions": 77, "deletions": 0}, "files": [{"sha": "0fd1a2703db998ecd8d85544e483b5f658821194", "filename": "tests/ui/async-await/in-trait/async-default-fn-overridden.rs", "status": "added", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/3e57b203918bc64e05c95849672ba7c23090c984/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e57b203918bc64e05c95849672ba7c23090c984/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.rs?ref=3e57b203918bc64e05c95849672ba7c23090c984", "patch": "@@ -0,0 +1,66 @@\n+// run-pass\n+// edition:2021\n+\n+#![feature(async_fn_in_trait)]\n+//~^ WARN the feature `async_fn_in_trait` is incomplete and may not be safe to use\n+\n+use std::future::Future;\n+\n+trait AsyncTrait {\n+    async fn default_impl() {\n+        assert!(false);\n+    }\n+\n+    async fn call_default_impl() {\n+        Self::default_impl().await\n+    }\n+}\n+\n+struct AsyncType;\n+\n+impl AsyncTrait for AsyncType {\n+    async fn default_impl() {\n+        // :)\n+    }\n+}\n+\n+async fn async_main() {\n+    // Should not assert false\n+    AsyncType::call_default_impl().await;\n+}\n+\n+// ------------------------------------------------------------------------- //\n+// Implementation Details Below...\n+\n+use std::pin::Pin;\n+use std::task::*;\n+\n+pub fn noop_waker() -> Waker {\n+    let raw = RawWaker::new(std::ptr::null(), &NOOP_WAKER_VTABLE);\n+\n+    // SAFETY: the contracts for RawWaker and RawWakerVTable are upheld\n+    unsafe { Waker::from_raw(raw) }\n+}\n+\n+const NOOP_WAKER_VTABLE: RawWakerVTable = RawWakerVTable::new(noop_clone, noop, noop, noop);\n+\n+unsafe fn noop_clone(_p: *const ()) -> RawWaker {\n+    RawWaker::new(std::ptr::null(), &NOOP_WAKER_VTABLE)\n+}\n+\n+unsafe fn noop(_p: *const ()) {}\n+\n+fn main() {\n+    let mut fut = async_main();\n+\n+    // Poll loop, just to test the future...\n+    let waker = noop_waker();\n+    let ctx = &mut Context::from_waker(&waker);\n+\n+    loop {\n+        match unsafe { Pin::new_unchecked(&mut fut).poll(ctx) } {\n+            Poll::Pending => {}\n+            Poll::Ready(()) => break,\n+        }\n+    }\n+}"}, {"sha": "61a826258d09f0c351b2ee6775b6aac15cb4f424", "filename": "tests/ui/async-await/in-trait/async-default-fn-overridden.stderr", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3e57b203918bc64e05c95849672ba7c23090c984/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3e57b203918bc64e05c95849672ba7c23090c984/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync-await%2Fin-trait%2Fasync-default-fn-overridden.stderr?ref=3e57b203918bc64e05c95849672ba7c23090c984", "patch": "@@ -0,0 +1,11 @@\n+warning: the feature `async_fn_in_trait` is incomplete and may not be safe to use and/or cause compiler crashes\n+  --> $DIR/async-default-fn-overridden.rs:4:12\n+   |\n+LL | #![feature(async_fn_in_trait)]\n+   |            ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #91611 <https://github.com/rust-lang/rust/issues/91611> for more information\n+   = note: `#[warn(incomplete_features)]` on by default\n+\n+warning: 1 warning emitted\n+"}]}