{"sha": "bea4e60327d36d6f42034f51a4d3d9ac3f391363", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlYTRlNjAzMjdkMzZkNmY0MjAzNGY1MWE0ZDNkOWFjM2YzOTEzNjM=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "arielb1@mail.tau.ac.il", "date": "2017-06-29T08:40:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-06-29T08:40:01Z"}, "message": "Rollup merge of #42219 - pwoolcoc:add-allow-fail-to-libtest, r=GuillaumeGomez\n\nadd `allow_fail` test attribute\n\nThis change allows the user to add an `#[allow_fail]` attribute to\ntests that will cause the test to compile & run, but if the test fails\nit will not cause the entire test run to fail. The test output will\nshow the failure, but in yellow instead of red, and also indicate that\nit was an allowed failure.\n\nHere is an example of the output: http://imgur.com/a/wt7ga", "tree": {"sha": "972e351297da32796245c35b5fce80d98b6d797d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/972e351297da32796245c35b5fce80d98b6d797d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bea4e60327d36d6f42034f51a4d3d9ac3f391363", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bea4e60327d36d6f42034f51a4d3d9ac3f391363", "html_url": "https://github.com/rust-lang/rust/commit/bea4e60327d36d6f42034f51a4d3d9ac3f391363", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bea4e60327d36d6f42034f51a4d3d9ac3f391363/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc2003b7cc1af7d7beee0b1ceec3d811c28cb35e", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc2003b7cc1af7d7beee0b1ceec3d811c28cb35e", "html_url": "https://github.com/rust-lang/rust/commit/dc2003b7cc1af7d7beee0b1ceec3d811c28cb35e"}, {"sha": "4154f895d388b1a8634a95ff76892419bebe9cc3", "url": "https://api.github.com/repos/rust-lang/rust/commits/4154f895d388b1a8634a95ff76892419bebe9cc3", "html_url": "https://github.com/rust-lang/rust/commit/4154f895d388b1a8634a95ff76892419bebe9cc3"}], "stats": {"total": 170, "additions": 140, "deletions": 30}, "files": [{"sha": "03da451fd9a0a2477fe9226b04f53a23ff08ed2b", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 27, "deletions": 18, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -769,7 +769,7 @@ pub fn old_find_testable_code(doc: &str, tests: &mut ::test::Collector, position\n                                block_info.should_panic, block_info.no_run,\n                                block_info.ignore, block_info.test_harness,\n                                block_info.compile_fail, block_info.error_codes,\n-                               line, filename);\n+                               line, filename, block_info.allow_fail);\n             } else {\n                 tests.add_old_test(text, filename);\n             }\n@@ -859,7 +859,7 @@ pub fn find_testable_code(doc: &str, tests: &mut ::test::Collector, position: Sp\n                                block_info.should_panic, block_info.no_run,\n                                block_info.ignore, block_info.test_harness,\n                                block_info.compile_fail, block_info.error_codes,\n-                               line, filename);\n+                               line, filename, block_info.allow_fail);\n                 prev_offset = offset;\n             }\n             Event::Start(Tag::Header(level)) => {\n@@ -889,6 +889,7 @@ struct LangString {\n     test_harness: bool,\n     compile_fail: bool,\n     error_codes: Vec<String>,\n+    allow_fail: bool,\n }\n \n impl LangString {\n@@ -902,6 +903,7 @@ impl LangString {\n             test_harness: false,\n             compile_fail: false,\n             error_codes: Vec::new(),\n+            allow_fail: false,\n         }\n     }\n \n@@ -930,6 +932,7 @@ impl LangString {\n                 }\n                 \"no_run\" => { data.no_run = true; seen_rust_tags = !seen_other_tags; }\n                 \"ignore\" => { data.ignore = true; seen_rust_tags = !seen_other_tags; }\n+                \"allow_fail\" => { data.allow_fail = true; seen_rust_tags = !seen_other_tags; }\n                 \"rust\" => { data.rust = true; seen_rust_tags = true; }\n                 \"test_harness\" => {\n                     data.test_harness = true;\n@@ -1118,7 +1121,7 @@ mod tests {\n     fn test_lang_string_parse() {\n         fn t(s: &str,\n             should_panic: bool, no_run: bool, ignore: bool, rust: bool, test_harness: bool,\n-            compile_fail: bool, error_codes: Vec<String>) {\n+            compile_fail: bool, allow_fail: bool, error_codes: Vec<String>) {\n             assert_eq!(LangString::parse(s), LangString {\n                 should_panic: should_panic,\n                 no_run: no_run,\n@@ -1128,25 +1131,31 @@ mod tests {\n                 compile_fail: compile_fail,\n                 error_codes: error_codes,\n                 original: s.to_owned(),\n+                allow_fail: allow_fail,\n             })\n         }\n \n+        fn v() -> Vec<String> {\n+            Vec::new()\n+        }\n+\n         // marker                | should_panic| no_run| ignore| rust | test_harness| compile_fail\n-        //                       | error_codes\n-        t(\"\",                      false,        false,  false,  true,  false, false, Vec::new());\n-        t(\"rust\",                  false,        false,  false,  true,  false, false, Vec::new());\n-        t(\"sh\",                    false,        false,  false,  false, false, false, Vec::new());\n-        t(\"ignore\",                false,        false,  true,   true,  false, false, Vec::new());\n-        t(\"should_panic\",          true,         false,  false,  true,  false, false, Vec::new());\n-        t(\"no_run\",                false,        true,   false,  true,  false, false, Vec::new());\n-        t(\"test_harness\",          false,        false,  false,  true,  true,  false, Vec::new());\n-        t(\"compile_fail\",          false,        true,   false,  true,  false, true,  Vec::new());\n-        t(\"{.no_run .example}\",    false,        true,   false,  true,  false, false, Vec::new());\n-        t(\"{.sh .should_panic}\",   true,         false,  false,  false, false, false, Vec::new());\n-        t(\"{.example .rust}\",      false,        false,  false,  true,  false, false, Vec::new());\n-        t(\"{.test_harness .rust}\", false,        false,  false,  true,  true,  false, Vec::new());\n-        t(\"text, no_run\",          false,        true,   false,  false, false, false, Vec::new());\n-        t(\"text,no_run\",           false,        true,   false,  false, false, false, Vec::new());\n+        //                       | allow_fail | error_codes\n+        t(\"\",                      false,        false,  false,  true,  false, false, false, v());\n+        t(\"rust\",                  false,        false,  false,  true,  false, false, false, v());\n+        t(\"sh\",                    false,        false,  false,  false, false, false, false, v());\n+        t(\"ignore\",                false,        false,  true,   true,  false, false, false, v());\n+        t(\"should_panic\",          true,         false,  false,  true,  false, false, false, v());\n+        t(\"no_run\",                false,        true,   false,  true,  false, false, false, v());\n+        t(\"test_harness\",          false,        false,  false,  true,  true,  false, false, v());\n+        t(\"compile_fail\",          false,        true,   false,  true,  false, true,  false, v());\n+        t(\"allow_fail\",            false,        false,  false,  true,  false, false, true,  v());\n+        t(\"{.no_run .example}\",    false,        true,   false,  true,  false, false, false, v());\n+        t(\"{.sh .should_panic}\",   true,         false,  false,  false, false, false, false, v());\n+        t(\"{.example .rust}\",      false,        false,  false,  true,  false, false, false, v());\n+        t(\"{.test_harness .rust}\", false,        false,  false,  true,  true,  false, false, v());\n+        t(\"text, no_run\",          false,        true,   false,  false, false, false, false, v());\n+        t(\"text,no_run\",           false,        true,   false,  false, false, false, false, v());\n     }\n \n     #[test]"}, {"sha": "4766778eed1b88bc00b505f708ad78b39bc83b97", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -467,7 +467,7 @@ impl Collector {\n     pub fn add_test(&mut self, test: String,\n                     should_panic: bool, no_run: bool, should_ignore: bool,\n                     as_test_harness: bool, compile_fail: bool, error_codes: Vec<String>,\n-                    line: usize, filename: String) {\n+                    line: usize, filename: String, allow_fail: bool) {\n         let name = self.generate_name(line, &filename);\n         // to be removed when hoedown is removed\n         if self.render_type == RenderType::Pulldown {\n@@ -499,6 +499,7 @@ impl Collector {\n                 ignore: should_ignore,\n                 // compiler failures are test failures\n                 should_panic: testing::ShouldPanic::No,\n+                allow_fail: allow_fail,\n             },\n             testfn: testing::DynTestFn(box move |()| {\n                 let panic = io::set_panic(None);"}, {"sha": "74bf19b841e886fe04a3d3788ba57c29c1ad3acc", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -354,6 +354,9 @@ declare_features! (\n \n     // rustc internal\n     (active, abi_thiscall, \"1.19.0\", None),\n+\n+    // Allows a test to fail without failing the whole suite\n+    (active, allow_fail, \"1.19.0\", Some(42219)),\n );\n \n declare_features! (\n@@ -812,6 +815,11 @@ pub const BUILTIN_ATTRIBUTES: &'static [(&'static str, AttributeType, AttributeG\n                                              \"used internally by rustc\",\n                                              cfg_fn!(rustc_attrs))),\n \n+    (\"allow_fail\", Normal, Gated(Stability::Unstable,\n+                                 \"allow_fail\",\n+                                 \"allow_fail attribute is currently unstable\",\n+                                 cfg_fn!(allow_fail))),\n+\n     // Crate level attributes\n     (\"crate_name\", CrateLevel, Ungated),\n     (\"crate_type\", CrateLevel, Ungated),"}, {"sha": "86f5f42eac79614c5e74646b26754db314024a8d", "filename": "src/libsyntax/test.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibsyntax%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibsyntax%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ftest.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -52,7 +52,8 @@ struct Test {\n     path: Vec<Ident> ,\n     bench: bool,\n     ignore: bool,\n-    should_panic: ShouldPanic\n+    should_panic: ShouldPanic,\n+    allow_fail: bool,\n }\n \n struct TestCtxt<'a> {\n@@ -133,7 +134,8 @@ impl<'a> fold::Folder for TestHarnessGenerator<'a> {\n                         path: self.cx.path.clone(),\n                         bench: is_bench_fn(&self.cx, &i),\n                         ignore: is_ignored(&i),\n-                        should_panic: should_panic(&i, &self.cx)\n+                        should_panic: should_panic(&i, &self.cx),\n+                        allow_fail: is_allowed_fail(&i),\n                     };\n                     self.cx.testfns.push(test);\n                     self.tests.push(i.ident);\n@@ -383,6 +385,10 @@ fn is_ignored(i: &ast::Item) -> bool {\n     i.attrs.iter().any(|attr| attr.check_name(\"ignore\"))\n }\n \n+fn is_allowed_fail(i: &ast::Item) -> bool {\n+    i.attrs.iter().any(|attr| attr.check_name(\"allow_fail\"))\n+}\n+\n fn should_panic(i: &ast::Item, cx: &TestCtxt) -> ShouldPanic {\n     match i.attrs.iter().find(|attr| attr.check_name(\"should_panic\")) {\n         Some(attr) => {\n@@ -668,14 +674,16 @@ fn mk_test_desc_and_fn_rec(cx: &TestCtxt, test: &Test) -> P<ast::Expr> {\n             }\n         }\n     };\n+    let allow_fail_expr = ecx.expr_bool(span, test.allow_fail);\n \n     // self::test::TestDesc { ... }\n     let desc_expr = ecx.expr_struct(\n         span,\n         test_path(\"TestDesc\"),\n         vec![field(\"name\", name_expr),\n              field(\"ignore\", ignore_expr),\n-             field(\"should_panic\", fail_expr)]);\n+             field(\"should_panic\", fail_expr),\n+             field(\"allow_fail\", allow_fail_expr)]);\n \n \n     let mut visible_path = match cx.toplevel_reexport {"}, {"sha": "92cfb862b16691dafde886409044a087a9736780", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 50, "deletions": 8, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -212,6 +212,7 @@ pub struct TestDesc {\n     pub name: TestName,\n     pub ignore: bool,\n     pub should_panic: ShouldPanic,\n+    pub allow_fail: bool,\n }\n \n #[derive(Clone)]\n@@ -523,6 +524,7 @@ pub enum TestResult {\n     TrFailed,\n     TrFailedMsg(String),\n     TrIgnored,\n+    TrAllowedFail,\n     TrMetrics(MetricMap),\n     TrBench(BenchSamples),\n }\n@@ -543,6 +545,7 @@ struct ConsoleTestState<T> {\n     passed: usize,\n     failed: usize,\n     ignored: usize,\n+    allowed_fail: usize,\n     filtered_out: usize,\n     measured: usize,\n     metrics: MetricMap,\n@@ -572,6 +575,7 @@ impl<T: Write> ConsoleTestState<T> {\n             passed: 0,\n             failed: 0,\n             ignored: 0,\n+            allowed_fail: 0,\n             filtered_out: 0,\n             measured: 0,\n             metrics: MetricMap::new(),\n@@ -594,6 +598,10 @@ impl<T: Write> ConsoleTestState<T> {\n         self.write_short_result(\"ignored\", \"i\", term::color::YELLOW)\n     }\n \n+    pub fn write_allowed_fail(&mut self) -> io::Result<()> {\n+        self.write_short_result(\"FAILED (allowed)\", \"a\", term::color::YELLOW)\n+    }\n+\n     pub fn write_metric(&mut self) -> io::Result<()> {\n         self.write_pretty(\"metric\", term::color::CYAN)\n     }\n@@ -669,6 +677,7 @@ impl<T: Write> ConsoleTestState<T> {\n             TrOk => self.write_ok(),\n             TrFailed | TrFailedMsg(_) => self.write_failed(),\n             TrIgnored => self.write_ignored(),\n+            TrAllowedFail => self.write_allowed_fail(),\n             TrMetrics(ref mm) => {\n                 self.write_metric()?;\n                 self.write_plain(&format!(\": {}\\n\", mm.fmt_metrics()))\n@@ -702,6 +711,7 @@ impl<T: Write> ConsoleTestState<T> {\n                         TrFailed => \"failed\".to_owned(),\n                         TrFailedMsg(ref msg) => format!(\"failed: {}\", msg),\n                         TrIgnored => \"ignored\".to_owned(),\n+                        TrAllowedFail => \"failed (allowed)\".to_owned(),\n                         TrMetrics(ref mm) => mm.fmt_metrics(),\n                         TrBench(ref bs) => fmt_bench_samples(bs),\n                     },\n@@ -761,7 +771,8 @@ impl<T: Write> ConsoleTestState<T> {\n     }\n \n     pub fn write_run_finish(&mut self) -> io::Result<bool> {\n-        assert!(self.passed + self.failed + self.ignored + self.measured == self.total);\n+        assert!(self.passed + self.failed + self.ignored + self.measured +\n+                    self.allowed_fail == self.total);\n \n         if self.options.display_output {\n             self.write_outputs()?;\n@@ -778,12 +789,24 @@ impl<T: Write> ConsoleTestState<T> {\n         } else {\n             self.write_pretty(\"FAILED\", term::color::RED)?;\n         }\n-        let s = format!(\". {} passed; {} failed; {} ignored; {} measured; {} filtered out\\n\\n\",\n-                        self.passed,\n-                        self.failed,\n-                        self.ignored,\n-                        self.measured,\n-                        self.filtered_out);\n+        let s = if self.allowed_fail > 0 {\n+            format!(\n+                \". {} passed; {} failed ({} allowed); {} ignored; {} measured; {} filtered out\\n\\n\",\n+                self.passed,\n+                self.failed + self.allowed_fail,\n+                self.allowed_fail,\n+                self.ignored,\n+                self.measured,\n+                self.filtered_out)\n+        } else {\n+            format!(\n+                \". {} passed; {} failed; {} ignored; {} measured; {} filtered out\\n\\n\",\n+                self.passed,\n+                self.failed,\n+                self.ignored,\n+                self.measured,\n+                self.filtered_out)\n+        };\n         self.write_plain(&s)?;\n         return Ok(success);\n     }\n@@ -891,6 +914,7 @@ pub fn run_tests_console(opts: &TestOpts, tests: Vec<TestDescAndFn>) -> io::Resu\n                         st.not_failures.push((test, stdout));\n                     }\n                     TrIgnored => st.ignored += 1,\n+                    TrAllowedFail => st.allowed_fail += 1,\n                     TrMetrics(mm) => {\n                         let tname = test.name;\n                         let MetricMap(mm) = mm;\n@@ -945,12 +969,14 @@ fn should_sort_failures_before_printing_them() {\n         name: StaticTestName(\"a\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n+        allow_fail: false,\n     };\n \n     let test_b = TestDesc {\n         name: StaticTestName(\"b\"),\n         ignore: false,\n         should_panic: ShouldPanic::No,\n+        allow_fail: false,\n     };\n \n     let mut st = ConsoleTestState {\n@@ -962,6 +988,7 @@ fn should_sort_failures_before_printing_them() {\n         passed: 0,\n         failed: 0,\n         ignored: 0,\n+        allowed_fail: 0,\n         filtered_out: 0,\n         measured: 0,\n         max_name_len: 10,\n@@ -1471,8 +1498,13 @@ fn calc_result(desc: &TestDesc, task_result: Result<(), Box<Any + Send>>) -> Tes\n                   .unwrap_or(false) {\n                 TrOk\n             } else {\n-                TrFailedMsg(format!(\"Panic did not include expected string '{}'\", msg))\n+                if desc.allow_fail {\n+                    TrAllowedFail\n+                } else {\n+                    TrFailedMsg(format!(\"Panic did not include expected string '{}'\", msg))\n+                }\n             },\n+        _ if desc.allow_fail => TrAllowedFail,\n         _ => TrFailed,\n     }\n }\n@@ -1706,6 +1738,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: true,\n                 should_panic: ShouldPanic::No,\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1723,6 +1756,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: true,\n                 should_panic: ShouldPanic::No,\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1742,6 +1776,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: false,\n                 should_panic: ShouldPanic::Yes,\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1761,6 +1796,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: false,\n                 should_panic: ShouldPanic::YesWithMessage(\"error message\"),\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1782,6 +1818,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: false,\n                 should_panic: ShouldPanic::YesWithMessage(expected),\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1799,6 +1836,7 @@ mod tests {\n                 name: StaticTestName(\"whatever\"),\n                 ignore: false,\n                 should_panic: ShouldPanic::Yes,\n+                allow_fail: false,\n             },\n             testfn: DynTestFn(Box::new(move |()| f())),\n         };\n@@ -1832,6 +1870,7 @@ mod tests {\n                                  name: StaticTestName(\"1\"),\n                                  ignore: true,\n                                  should_panic: ShouldPanic::No,\n+                                 allow_fail: false,\n                              },\n                              testfn: DynTestFn(Box::new(move |()| {})),\n                          },\n@@ -1840,6 +1879,7 @@ mod tests {\n                                  name: StaticTestName(\"2\"),\n                                  ignore: false,\n                                  should_panic: ShouldPanic::No,\n+                                 allow_fail: false,\n                              },\n                              testfn: DynTestFn(Box::new(move |()| {})),\n                          }];\n@@ -1863,6 +1903,7 @@ mod tests {\n                     name: StaticTestName(name),\n                     ignore: false,\n                     should_panic: ShouldPanic::No,\n+                    allow_fail: false,\n                 },\n                 testfn: DynTestFn(Box::new(move |()| {}))\n             })\n@@ -1944,6 +1985,7 @@ mod tests {\n                         name: DynTestName((*name).clone()),\n                         ignore: false,\n                         should_panic: ShouldPanic::No,\n+                        allow_fail: false,\n                     },\n                     testfn: DynTestFn(Box::new(move |()| testfn())),\n                 };"}, {"sha": "1124740280960de2f7a63106294cec0df364f7b4", "filename": "src/test/compile-fail/feature-gate-allow_fail.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftest%2Fcompile-fail%2Ffeature-gate-allow_fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftest%2Fcompile-fail%2Ffeature-gate-allow_fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ffeature-gate-allow_fail.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// check that #[allow_fail] is feature-gated\n+\n+#[allow_fail] //~ ERROR allow_fail attribute is currently unstable\n+fn ok_to_fail() {\n+    assert!(false);\n+}\n+"}, {"sha": "aa9cf76617f6930761001dd74a6217e441122dbd", "filename": "src/test/run-pass/test-allow-fail-attr.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftest%2Frun-pass%2Ftest-allow-fail-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftest%2Frun-pass%2Ftest-allow-fail-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftest-allow-fail-attr.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: --test\n+#![feature(allow_fail)]\n+\n+#[test]\n+#[allow_fail]\n+fn test1() {\n+    panic!();\n+}\n+\n+#[test]\n+#[allow_fail]\n+fn test2() {\n+    assert!(true);\n+}"}, {"sha": "b4663b0ee6c00677313f7e3c590f1e3e0cdf6420", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bea4e60327d36d6f42034f51a4d3d9ac3f391363/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=bea4e60327d36d6f42034f51a4d3d9ac3f391363", "patch": "@@ -476,6 +476,7 @@ pub fn make_test(config: &Config, testpaths: &TestPaths) -> test::TestDescAndFn\n             name: make_test_name(config, testpaths),\n             ignore: ignore,\n             should_panic: should_panic,\n+            allow_fail: false,\n         },\n         testfn: make_test_closure(config, testpaths),\n     }"}]}