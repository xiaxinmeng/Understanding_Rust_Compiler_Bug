{"sha": "a4d46b3d87e9c83ffb78489a513a100e5422ac81", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE0ZDQ2YjNkODdlOWM4M2ZmYjc4NDg5YTUxM2ExMDBlNTQyMmFjODE=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-03T22:13:32Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-03T22:13:32Z"}, "message": "Tweak to mir borrow in a loop diagnostic", "tree": {"sha": "7a3681036aaf93c1bd55cdc5bf7d35db27cc774b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a3681036aaf93c1bd55cdc5bf7d35db27cc774b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a4d46b3d87e9c83ffb78489a513a100e5422ac81", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a4d46b3d87e9c83ffb78489a513a100e5422ac81", "html_url": "https://github.com/rust-lang/rust/commit/a4d46b3d87e9c83ffb78489a513a100e5422ac81", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a4d46b3d87e9c83ffb78489a513a100e5422ac81/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e027f5a99e16d2509478c71856e0246e11148322", "url": "https://api.github.com/repos/rust-lang/rust/commits/e027f5a99e16d2509478c71856e0246e11148322", "html_url": "https://github.com/rust-lang/rust/commit/e027f5a99e16d2509478c71856e0246e11148322"}], "stats": {"total": 23, "additions": 12, "deletions": 11}, "files": [{"sha": "19bebea7cb8f100794e11e0fb09274111fa0da2e", "filename": "src/librustc_mir/borrow_check/error_reporting.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a4d46b3d87e9c83ffb78489a513a100e5422ac81/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a4d46b3d87e9c83ffb78489a513a100e5422ac81/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs?ref=a4d46b3d87e9c83ffb78489a513a100e5422ac81", "patch": "@@ -62,13 +62,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                 Origin::Mir,\n             );\n \n-            err.span_label(\n-                span,\n-                format!(\n-                    \"value {} here after move\",\n-                    desired_action.as_verb_in_past_tense()\n-                ),\n-            );\n+            let mut is_loop_move = false;\n             for moi in mois {\n                 let move_msg = \"\"; //FIXME: add \" (into closure)\"\n                 let move_span = self.mir.source_info(self.move_data.moves[*moi].source).span;\n@@ -77,10 +71,20 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                         span,\n                         format!(\"value moved{} here in previous iteration of loop\", move_msg),\n                     );\n+                    is_loop_move = true;\n                 } else {\n                     err.span_label(move_span, format!(\"value moved{} here\", move_msg));\n                 };\n             }\n+            if !is_loop_move {\n+                err.span_label(\n+                    span,\n+                    format!(\n+                        \"value {} here after move\",\n+                        desired_action.as_verb_in_past_tense()\n+                    ),\n+                );\n+            }\n \n             if let Some(ty) = self.retrieve_type_for_place(place) {\n                 let needs_note = match ty.sty {"}, {"sha": "50d51c4d907fda2670983df05578830c1b18461d", "filename": "src/test/ui/borrowck/issue-41962.stderr", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a4d46b3d87e9c83ffb78489a513a100e5422ac81/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a4d46b3d87e9c83ffb78489a513a100e5422ac81/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fborrowck%2Fissue-41962.stderr?ref=a4d46b3d87e9c83ffb78489a513a100e5422ac81", "patch": "@@ -31,10 +31,7 @@ error[E0382]: use of moved value: `maybe.0` (Mir)\n   --> $DIR/issue-41962.rs:17:21\n    |\n 17 |         if let Some(thing) = maybe {\n-   |                     ^^^^^\n-   |                     |\n-   |                     value used here after move\n-   |                     value moved here in previous iteration of loop\n+   |                     ^^^^^ value moved here in previous iteration of loop\n    |\n    = note: move occurs because `maybe.0` has type `std::vec::Vec<bool>`, which does not implement the `Copy` trait\n "}]}