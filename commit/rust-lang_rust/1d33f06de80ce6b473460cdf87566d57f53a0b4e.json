{"sha": "1d33f06de80ce6b473460cdf87566d57f53a0b4e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkMzNmMDZkZTgwY2U2YjQ3MzQ2MGNkZjg3NTY2ZDU3ZjUzYTBiNGU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-14T22:41:46Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-09-14T22:43:48Z"}, "message": "Don't mark expression with attributes as not needing parentheses\n\nThis is not perfectly correct as `#[attr] (5)` will still not lint, but\nit does seem good enough, in particular as the parentheses in that case\nare not unambiguously incorrect.", "tree": {"sha": "9043d6a61fa9cfe09a8fd124be3d6fdc00d0ba0f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9043d6a61fa9cfe09a8fd124be3d6fdc00d0ba0f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d33f06de80ce6b473460cdf87566d57f53a0b4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d33f06de80ce6b473460cdf87566d57f53a0b4e", "html_url": "https://github.com/rust-lang/rust/commit/1d33f06de80ce6b473460cdf87566d57f53a0b4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d33f06de80ce6b473460cdf87566d57f53a0b4e/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca3766e2e58f462a20922e42c821a37eaf0e13db", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca3766e2e58f462a20922e42c821a37eaf0e13db", "html_url": "https://github.com/rust-lang/rust/commit/ca3766e2e58f462a20922e42c821a37eaf0e13db"}], "stats": {"total": 45, "additions": 25, "deletions": 20}, "files": [{"sha": "20c05800889cf5e43a70bd385988a3abf229ebc2", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=1d33f06de80ce6b473460cdf87566d57f53a0b4e", "patch": "@@ -370,7 +370,8 @@ impl UnusedParens {\n                                      right_pos: Option<BytePos>) {\n         match value.node {\n             ast::ExprKind::Paren(ref inner) => {\n-                if !Self::is_expr_parens_necessary(inner, followed_by_block) {\n+                if !Self::is_expr_parens_necessary(inner, followed_by_block) &&\n+                    value.attrs.is_empty() {\n                     let expr_text = if let Ok(snippet) = cx.sess().source_map()\n                         .span_to_snippet(value.span) {\n                             snippet"}, {"sha": "7dcbdd0863cbd9f2a5c07010632ef2530e30d45d", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.rs?ref=1d33f06de80ce6b473460cdf87566d57f53a0b4e", "patch": "@@ -1,4 +1,4 @@\n-#![feature(box_patterns)]\n+#![feature(box_patterns, stmt_expr_attributes)]\n \n #![feature(or_patterns)]\n //~^ WARN the feature `or_patterns` is incomplete\n@@ -17,6 +17,10 @@ fn lint_on_top_level() {\n     let _ = |(a): u8| 0; //~ ERROR unnecessary parentheses around pattern\n }\n \n+fn _no_lint_attr() {\n+    let _x = #[allow(dead_code)] (1 + 2);\n+}\n+\n // Don't lint in these cases (#64106).\n fn or_patterns_no_lint() {\n     match Box::new(0) {"}, {"sha": "675dd4f07def63a3b943ba6070a01f50c8892a09", "filename": "src/test/ui/lint/issue-54538-unused-parens-lint.stderr", "status": "modified", "additions": 18, "deletions": 18, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1d33f06de80ce6b473460cdf87566d57f53a0b4e/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-54538-unused-parens-lint.stderr?ref=1d33f06de80ce6b473460cdf87566d57f53a0b4e", "patch": "@@ -49,109 +49,109 @@ LL |     let _ = |(a): u8| 0;\n    |              ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:41:12\n+  --> $DIR/issue-54538-unused-parens-lint.rs:45:12\n    |\n LL |     if let (0 | 1) = 0 {}\n    |            ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:42:13\n+  --> $DIR/issue-54538-unused-parens-lint.rs:46:13\n    |\n LL |     if let ((0 | 1),) = (0,) {}\n    |             ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:43:13\n+  --> $DIR/issue-54538-unused-parens-lint.rs:47:13\n    |\n LL |     if let [(0 | 1)] = [0] {}\n    |             ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:44:16\n+  --> $DIR/issue-54538-unused-parens-lint.rs:48:16\n    |\n LL |     if let 0 | (1 | 2) = 0 {}\n    |                ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:46:15\n+  --> $DIR/issue-54538-unused-parens-lint.rs:50:15\n    |\n LL |     if let TS((0 | 1)) = TS(0) {}\n    |               ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:48:20\n+  --> $DIR/issue-54538-unused-parens-lint.rs:52:20\n    |\n LL |     if let NS { f: (0 | 1) } = (NS { f: 0 }) {}\n    |                    ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:58:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:62:9\n    |\n LL |         (_) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:59:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:63:9\n    |\n LL |         (y) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:60:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:64:9\n    |\n LL |         (ref r) => {}\n    |         ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:61:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:65:9\n    |\n LL |         (e @ 1...2) => {}\n    |         ^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:67:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:71:9\n    |\n LL |         (e @ &(1...2)) => {}\n    |         ^^^^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:68:10\n+  --> $DIR/issue-54538-unused-parens-lint.rs:72:10\n    |\n LL |         &(_) => {}\n    |          ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:79:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:83:9\n    |\n LL |         (_) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:80:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:84:9\n    |\n LL |         (y) => {}\n    |         ^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:81:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:85:9\n    |\n LL |         (ref r) => {}\n    |         ^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:82:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:86:9\n    |\n LL |         (e @ 1..=2) => {}\n    |         ^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:88:9\n+  --> $DIR/issue-54538-unused-parens-lint.rs:92:9\n    |\n LL |         (e @ &(1..=2)) => {}\n    |         ^^^^^^^^^^^^^^ help: remove these parentheses\n \n error: unnecessary parentheses around pattern\n-  --> $DIR/issue-54538-unused-parens-lint.rs:89:10\n+  --> $DIR/issue-54538-unused-parens-lint.rs:93:10\n    |\n LL |         &(_) => {}\n    |          ^^^ help: remove these parentheses"}]}