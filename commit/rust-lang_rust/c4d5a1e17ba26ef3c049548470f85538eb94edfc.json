{"sha": "c4d5a1e17ba26ef3c049548470f85538eb94edfc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0ZDVhMWUxN2JhMjZlZjNjMDQ5NTQ4NDcwZjg1NTM4ZWI5NGVkZmM=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-09-01T15:45:46Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-09-04T09:03:19Z"}, "message": "Produce expansion info for more builtin macros", "tree": {"sha": "cfeaa91f05c773d5a328434171860a63e22db09d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfeaa91f05c773d5a328434171860a63e22db09d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4d5a1e17ba26ef3c049548470f85538eb94edfc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEYFTdM4NKd7XQft77pp+NIls619kFAlmtFtkACgkQpp+NIls6\n19m2Dg//WBi9DBmimd3IieBujSFeaDGUc5MEeY4KjDxQ9MZscnAzL7xTwJIzsFYX\nnxKRnMn3//0nEsYPXmgk0bVTt3bvp9NxlAKBiEh6U9qvyNTXcuORNFZ1VAgtmWih\nXd/rtTjK/qjX/sj0mWcIiqClk0k/1Mwkbg9PAWPZeTomkCCe07vABql0TfXTBWWH\n9MpNu4V1tApiDjbP6kpJqK1oq5HoBZHd2uf27S84msd7Qd36J4ofWn4rA3RDTOsn\nkOFDKbecyV2JdAZ+D9l0YIIQHDU8jzT+CCHCSGadqrz5S8xlDAeZGB6JDWxIGq3b\nTxlN6Rxc76qqJlK0EBPTXUYX2MKF5GkZRNeWPd/aDZCD51rgwsZ9ely4XFaK7gdG\n9hlqUPN6CFVShX7tI88qMXzdkVaKAoWOe/c+E+u5ME9tseteQM+0rMc3pS5Dm4aR\n5FmDXw3sMYc5Sg0G2FrhhLvyOdwmaMrOlaxDIS8msjKmime5rxjsdiyX7m/PXECM\nbC3dlzoKXf/s2bOL8F9+uirzIgljsWCTPzXrsVVEFy+zXxonnsdej9epvwGmdTjH\nE2ZqAmJUwM3KqbRBdmlBHTnIJ1yNalk9Sj+KvblSNm3KJEV6P+IvEJK3DvmCC7Cx\n+Xh4Hzxv4nwSP2DECPZZVQRUViA//7OgyOjZouU7kYMSMVIhL1Q=\n=CBBH\n-----END PGP SIGNATURE-----", "payload": "tree cfeaa91f05c773d5a328434171860a63e22db09d\nparent a59a6d8a5687dd6aee871de0e7c9f734709ac544\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1504280746 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1504515799 +0200\n\nProduce expansion info for more builtin macros\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4d5a1e17ba26ef3c049548470f85538eb94edfc", "html_url": "https://github.com/rust-lang/rust/commit/c4d5a1e17ba26ef3c049548470f85538eb94edfc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4d5a1e17ba26ef3c049548470f85538eb94edfc/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a59a6d8a5687dd6aee871de0e7c9f734709ac544", "url": "https://api.github.com/repos/rust-lang/rust/commits/a59a6d8a5687dd6aee871de0e7c9f734709ac544", "html_url": "https://github.com/rust-lang/rust/commit/a59a6d8a5687dd6aee871de0e7c9f734709ac544"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "780d34d570170247f5faf8ffb64114afa02f52cd", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -44,7 +44,7 @@ use std::collections::HashSet;\n use syntax::ast;\n use syntax::attr;\n use syntax::feature_gate::{AttributeGate, AttributeType, Stability, deprecated_attributes};\n-use syntax_pos::Span;\n+use syntax_pos::{Span, SyntaxContext};\n use syntax::symbol::keywords;\n \n use rustc::hir::{self, PatKind};\n@@ -75,9 +75,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for WhileTrue {\n         if let hir::ExprWhile(ref cond, ..) = e.node {\n             if let hir::ExprLit(ref lit) = cond.node {\n                 if let ast::LitKind::Bool(true) = lit.node {\n-                    cx.span_lint(WHILE_TRUE,\n-                                 e.span,\n-                                 \"denote infinite loops with loop { ... }\");\n+                    if lit.span.ctxt() == SyntaxContext::empty() {\n+                        cx.span_lint(WHILE_TRUE,\n+                                    e.span,\n+                                    \"denote infinite loops with loop { ... }\");\n+                    }\n                 }\n             }\n         }"}, {"sha": "1d8dc4064685bdc06a34e2d70e150c2ad172c670", "filename": "src/libsyntax_ext/cfg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fcfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fcfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fcfg.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -24,6 +24,7 @@ pub fn expand_cfg<'cx>(cx: &mut ExtCtxt,\n                        sp: Span,\n                        tts: &[tokenstream::TokenTree])\n                        -> Box<base::MacResult + 'static> {\n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     let mut p = cx.new_parser_from_tts(tts);\n     let cfg = panictry!(p.parse_meta_item());\n "}, {"sha": "c79e7867c5f5ef8602bdd2defde8642ba5b8b0cb", "filename": "src/libsyntax_ext/concat.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fconcat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fconcat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fconcat.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -57,5 +57,6 @@ pub fn expand_syntax_ext(cx: &mut base::ExtCtxt,\n             }\n         }\n     }\n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     base::MacEager::expr(cx.expr_str(sp, Symbol::intern(&accumulator)))\n }"}, {"sha": "8d0104e512bfb41cee35e57c50110faab655fcdf", "filename": "src/libsyntax_ext/concat_idents.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fconcat_idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fconcat_idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fconcat_idents.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -92,6 +92,6 @@ pub fn expand_syntax_ext<'cx>(cx: &'cx mut ExtCtxt,\n \n     Box::new(Result {\n         ident: res,\n-        span: sp,\n+        span: sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark)),\n     })\n }"}, {"sha": "fcad065be52bcaf1868a5594dc95e1ea5d89fea5", "filename": "src/libsyntax_ext/env.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Flibsyntax_ext%2Fenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fenv.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -32,6 +32,7 @@ pub fn expand_option_env<'cx>(cx: &'cx mut ExtCtxt,\n         Some(v) => v,\n     };\n \n+    let sp = sp.with_ctxt(sp.ctxt().apply_mark(cx.current_expansion.mark));\n     let e = match env::var(&*var.as_str()) {\n         Err(..) => {\n             cx.expr_path(cx.path_all(sp,"}, {"sha": "54a720d75b5ad1a067a78c1c53bf12ec79a70f99", "filename": "src/test/compile-fail/lint-impl-fn.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4d5a1e17ba26ef3c049548470f85538eb94edfc/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-impl-fn.rs?ref=c4d5a1e17ba26ef3c049548470f85538eb94edfc", "patch": "@@ -36,3 +36,8 @@ mod foo {\n fn main() {\n     while true {} //~ ERROR: infinite loops\n }\n+\n+#[deny(while_true)]\n+fn bar() {\n+    while cfg!(unix) {} // no error\n+}"}]}