{"sha": "91dfc38979e462510178f0c7365a76d3ad82b045", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxZGZjMzg5NzllNDYyNTEwMTc4ZjBjNzM2NWE3NmQzYWQ4MmIwNDU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-04-29T22:45:44Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-04-29T22:45:44Z"}, "message": "rollup merge of #24903: pnkfelix/fsk-enum-swapindrop\n\nrename `schedule_drop_{enum,adt}_contents`.\n\naddresses review nit from #24765 (it was my mistake for not doing this earlier before it landed).", "tree": {"sha": "8451f8cc8b114dc349dfb8bd9e6121293fcd3073", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8451f8cc8b114dc349dfb8bd9e6121293fcd3073"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91dfc38979e462510178f0c7365a76d3ad82b045", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91dfc38979e462510178f0c7365a76d3ad82b045", "html_url": "https://github.com/rust-lang/rust/commit/91dfc38979e462510178f0c7365a76d3ad82b045", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91dfc38979e462510178f0c7365a76d3ad82b045/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4ff558cdba03907b699eb908ad4ce8e0d62791b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/4ff558cdba03907b699eb908ad4ce8e0d62791b1", "html_url": "https://github.com/rust-lang/rust/commit/4ff558cdba03907b699eb908ad4ce8e0d62791b1"}, {"sha": "0930d383cb6801edc67f481bfe1e0856aabe33db", "url": "https://api.github.com/repos/rust-lang/rust/commits/0930d383cb6801edc67f481bfe1e0856aabe33db", "html_url": "https://github.com/rust-lang/rust/commit/0930d383cb6801edc67f481bfe1e0856aabe33db"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "637325881436dd8e2e1b1c6ad2b076b017f2773c", "filename": "src/librustc_trans/trans/cleanup.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/91dfc38979e462510178f0c7365a76d3ad82b045/src%2Flibrustc_trans%2Ftrans%2Fcleanup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91dfc38979e462510178f0c7365a76d3ad82b045/src%2Flibrustc_trans%2Ftrans%2Fcleanup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcleanup.rs?ref=91dfc38979e462510178f0c7365a76d3ad82b045", "patch": "@@ -438,10 +438,10 @@ impl<'blk, 'tcx> CleanupMethods<'blk, 'tcx> for FunctionContext<'blk, 'tcx> {\n     /// `ty`. The scheduled code handles extracting the discriminant\n     /// and dropping the contents associated with that variant\n     /// *without* executing any associated drop implementation.\n-    fn schedule_drop_enum_contents(&self,\n-                                   cleanup_scope: ScopeId,\n-                                   val: ValueRef,\n-                                   ty: Ty<'tcx>) {\n+    fn schedule_drop_adt_contents(&self,\n+                                  cleanup_scope: ScopeId,\n+                                  val: ValueRef,\n+                                  ty: Ty<'tcx>) {\n         // `if` below could be \"!contents_needs_drop\"; skipping drop\n         // is just an optimization, so sound to be conservative.\n         if !self.type_needs_drop(ty) { return; }\n@@ -455,7 +455,7 @@ impl<'blk, 'tcx> CleanupMethods<'blk, 'tcx> for FunctionContext<'blk, 'tcx> {\n             skip_dtor: true,\n         };\n \n-        debug!(\"schedule_drop_enum_contents({:?}, val={}, ty={}) fill_on_drop={} skip_dtor={}\",\n+        debug!(\"schedule_drop_adt_contents({:?}, val={}, ty={}) fill_on_drop={} skip_dtor={}\",\n                cleanup_scope,\n                self.ccx.tn().val_to_string(val),\n                ty.repr(self.ccx.tcx()),\n@@ -1240,10 +1240,10 @@ pub trait CleanupMethods<'blk, 'tcx> {\n                                   cleanup_scope: ScopeId,\n                                   val: ValueRef,\n                                   ty: Ty<'tcx>);\n-    fn schedule_drop_enum_contents(&self,\n-                                   cleanup_scope: ScopeId,\n-                                   val: ValueRef,\n-                                   ty: Ty<'tcx>);\n+    fn schedule_drop_adt_contents(&self,\n+                                  cleanup_scope: ScopeId,\n+                                  val: ValueRef,\n+                                  ty: Ty<'tcx>);\n     fn schedule_drop_immediate(&self,\n                                cleanup_scope: ScopeId,\n                                val: ValueRef,"}, {"sha": "a2a9e89ff6351cd5a0d8fd05d72ad7f65693c965", "filename": "src/librustc_trans/trans/glue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/91dfc38979e462510178f0c7365a76d3ad82b045/src%2Flibrustc_trans%2Ftrans%2Fglue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91dfc38979e462510178f0c7365a76d3ad82b045/src%2Flibrustc_trans%2Ftrans%2Fglue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fglue.rs?ref=91dfc38979e462510178f0c7365a76d3ad82b045", "patch": "@@ -383,7 +383,7 @@ fn trans_struct_drop<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n \n     // Issue #23611: schedule cleanup of contents, re-inspecting the\n     // discriminant (if any) in case of variant swap in drop code.\n-    bcx.fcx.schedule_drop_enum_contents(cleanup::CustomScope(contents_scope), v0, t);\n+    bcx.fcx.schedule_drop_adt_contents(cleanup::CustomScope(contents_scope), v0, t);\n \n     let glue_type = get_drop_glue_type(bcx.ccx(), t);\n     let dtor_ty = ty::mk_ctor_fn(bcx.tcx(), class_did, &[glue_type], ty::mk_nil(bcx.tcx()));"}]}