{"sha": "ffde78b4564301888fcb4d5b970d8e9475bd33e9", "node_id": "C_kwDOAAsO6NoAKGZmZGU3OGI0NTY0MzAxODg4ZmNiNGQ1Yjk3MGQ4ZTk0NzViZDMzZTk", "commit": {"author": {"name": "Yoav Lavi", "email": "yoavlavi122@gmail.com", "date": "2022-04-08T13:02:49Z"}, "committer": {"name": "Yoav Lavi", "email": "yoavlavi122@gmail.com", "date": "2022-04-09T14:50:10Z"}, "message": "Allow passing --remove to `cargo dev setup <SUBCOMMAND>`\n\nadd missing args\n\nunque name not needed\n\nmore descriptive help\n\nformatting fixes\n\nmissing quote", "tree": {"sha": "cacc631fb6722fd93c35c8fab9f60b90f8cec9f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cacc631fb6722fd93c35c8fab9f60b90f8cec9f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ffde78b4564301888fcb4d5b970d8e9475bd33e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ffde78b4564301888fcb4d5b970d8e9475bd33e9", "html_url": "https://github.com/rust-lang/rust/commit/ffde78b4564301888fcb4d5b970d8e9475bd33e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ffde78b4564301888fcb4d5b970d8e9475bd33e9/comments", "author": {"login": "yoav-lavi", "id": 14347895, "node_id": "MDQ6VXNlcjE0MzQ3ODk1", "avatar_url": "https://avatars.githubusercontent.com/u/14347895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoav-lavi", "html_url": "https://github.com/yoav-lavi", "followers_url": "https://api.github.com/users/yoav-lavi/followers", "following_url": "https://api.github.com/users/yoav-lavi/following{/other_user}", "gists_url": "https://api.github.com/users/yoav-lavi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoav-lavi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoav-lavi/subscriptions", "organizations_url": "https://api.github.com/users/yoav-lavi/orgs", "repos_url": "https://api.github.com/users/yoav-lavi/repos", "events_url": "https://api.github.com/users/yoav-lavi/events{/privacy}", "received_events_url": "https://api.github.com/users/yoav-lavi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yoav-lavi", "id": 14347895, "node_id": "MDQ6VXNlcjE0MzQ3ODk1", "avatar_url": "https://avatars.githubusercontent.com/u/14347895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoav-lavi", "html_url": "https://github.com/yoav-lavi", "followers_url": "https://api.github.com/users/yoav-lavi/followers", "following_url": "https://api.github.com/users/yoav-lavi/following{/other_user}", "gists_url": "https://api.github.com/users/yoav-lavi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoav-lavi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoav-lavi/subscriptions", "organizations_url": "https://api.github.com/users/yoav-lavi/orgs", "repos_url": "https://api.github.com/users/yoav-lavi/repos", "events_url": "https://api.github.com/users/yoav-lavi/events{/privacy}", "received_events_url": "https://api.github.com/users/yoav-lavi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a63308be0a66fe34aa1ccefef76fa6a0bc50d2a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a63308be0a66fe34aa1ccefef76fa6a0bc50d2a3", "html_url": "https://github.com/rust-lang/rust/commit/a63308be0a66fe34aa1ccefef76fa6a0bc50d2a3"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "833b7393ff8b9748fa99c663a64b0a572cf2b86c", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 44, "deletions": 7, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/ffde78b4564301888fcb4d5b970d8e9475bd33e9/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ffde78b4564301888fcb4d5b970d8e9475bd33e9/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=ffde78b4564301888fcb4d5b970d8e9475bd33e9", "patch": "@@ -36,13 +36,31 @@ fn main() {\n             }\n         },\n         (\"setup\", Some(sub_command)) => match sub_command.subcommand() {\n-            (\"intellij\", Some(matches)) => setup::intellij::setup_rustc_src(\n-                matches\n-                    .value_of(\"rustc-repo-path\")\n-                    .expect(\"this field is mandatory and therefore always valid\"),\n-            ),\n-            (\"git-hook\", Some(matches)) => setup::git_hook::install_hook(matches.is_present(\"force-override\")),\n-            (\"vscode-tasks\", Some(matches)) => setup::vscode::install_tasks(matches.is_present(\"force-override\")),\n+            (\"intellij\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::intellij::remove_rustc_src();\n+                } else {\n+                    setup::intellij::setup_rustc_src(\n+                        matches\n+                            .value_of(\"rustc-repo-path\")\n+                            .expect(\"this field is mandatory and therefore always valid\"),\n+                    );\n+                }\n+            },\n+            (\"git-hook\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::git_hook::remove_hook();\n+                } else {\n+                    setup::git_hook::install_hook(matches.is_present(\"force-override\"));\n+                }\n+            },\n+            (\"vscode-tasks\", Some(matches)) => {\n+                if matches.is_present(\"remove\") {\n+                    setup::vscode::remove_tasks();\n+                } else {\n+                    setup::vscode::install_tasks(matches.is_present(\"force-override\"));\n+                }\n+            },\n             _ => {},\n         },\n         (\"remove\", Some(sub_command)) => match sub_command.subcommand() {\n@@ -167,19 +185,32 @@ fn get_clap_config<'a>() -> ArgMatches<'a> {\n                 .subcommand(\n                     SubCommand::with_name(\"intellij\")\n                         .about(\"Alter dependencies so Intellij Rust can find rustc internals\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the dependencies added with 'cargo dev setup intellij'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"rustc-repo-path\")\n                                 .long(\"repo-path\")\n                                 .short(\"r\")\n                                 .help(\"The path to a rustc repo that will be used for setting the dependencies\")\n                                 .takes_value(true)\n                                 .value_name(\"path\")\n+                                .conflicts_with(\"remove\")\n                                 .required(true),\n                         ),\n                 )\n                 .subcommand(\n                     SubCommand::with_name(\"git-hook\")\n                         .about(\"Add a pre-commit git hook that formats your code to make it look pretty\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the pre-commit hook added with 'cargo dev setup git-hook'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"force-override\")\n                                 .long(\"force-override\")\n@@ -191,6 +222,12 @@ fn get_clap_config<'a>() -> ArgMatches<'a> {\n                 .subcommand(\n                     SubCommand::with_name(\"vscode-tasks\")\n                         .about(\"Add several tasks to vscode for formatting, validation and testing\")\n+                        .arg(\n+                            Arg::with_name(\"remove\")\n+                                .long(\"remove\")\n+                                .help(\"Remove the tasks added with 'cargo dev setup vscode-tasks'\")\n+                                .required(false),\n+                        )\n                         .arg(\n                             Arg::with_name(\"force-override\")\n                                 .long(\"force-override\")"}]}