{"sha": "8fbd2923f1981f2662c0c4631e962c958794537e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmYmQyOTIzZjE5ODFmMjY2MmMwYzQ2MzFlOTYyYzk1ODc5NDUzN2U=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-11-11T07:29:54Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-11-11T07:29:54Z"}, "message": "Auto merge of #29752 - tamird:fix-compiletest-stage1, r=alexcrichton\n\nFixes #29751.", "tree": {"sha": "a03e5b4457729673674209180ecc15a0b0b5834d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a03e5b4457729673674209180ecc15a0b0b5834d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8fbd2923f1981f2662c0c4631e962c958794537e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8fbd2923f1981f2662c0c4631e962c958794537e", "html_url": "https://github.com/rust-lang/rust/commit/8fbd2923f1981f2662c0c4631e962c958794537e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8fbd2923f1981f2662c0c4631e962c958794537e/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b53020a5f4e031371a0f6de4b47b67d822195923", "url": "https://api.github.com/repos/rust-lang/rust/commits/b53020a5f4e031371a0f6de4b47b67d822195923", "html_url": "https://github.com/rust-lang/rust/commit/b53020a5f4e031371a0f6de4b47b67d822195923"}, {"sha": "f5e9a4ae154c2428992b3f623bc8fda532db21ce", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5e9a4ae154c2428992b3f623bc8fda532db21ce", "html_url": "https://github.com/rust-lang/rust/commit/f5e9a4ae154c2428992b3f623bc8fda532db21ce"}], "stats": {"total": 27, "additions": 5, "deletions": 22}, "files": [{"sha": "0cf90ec95f38e3c838e40e08ce6e2f57580cb080", "filename": "src/compiletest/raise_fd_limit.rs", "status": "modified", "additions": 5, "deletions": 22, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/8fbd2923f1981f2662c0c4631e962c958794537e/src%2Fcompiletest%2Fraise_fd_limit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fbd2923f1981f2662c0c4631e962c958794537e/src%2Fcompiletest%2Fraise_fd_limit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fraise_fd_limit.rs?ref=8fbd2923f1981f2662c0c4631e962c958794537e", "patch": "@@ -23,25 +23,8 @@ pub unsafe fn raise_fd_limit() {\n     use std::mem::size_of_val;\n     use std::ptr::null_mut;\n \n-    type rlim_t = libc::uint64_t;\n-\n-    #[repr(C)]\n-    struct rlimit {\n-        rlim_cur: rlim_t,\n-        rlim_max: rlim_t\n-    }\n-    extern {\n-        // name probably doesn't need to be mut, but the C function doesn't\n-        // specify const\n-        fn sysctl(name: *mut libc::c_int, namelen: libc::c_uint,\n-                  oldp: *mut libc::c_void, oldlenp: *mut libc::size_t,\n-                  newp: *mut libc::c_void, newlen: libc::size_t) -> libc::c_int;\n-        fn getrlimit(resource: libc::c_int, rlp: *mut rlimit) -> libc::c_int;\n-        fn setrlimit(resource: libc::c_int, rlp: *const rlimit) -> libc::c_int;\n-    }\n     static CTL_KERN: libc::c_int = 1;\n     static KERN_MAXFILESPERPROC: libc::c_int = 29;\n-    static RLIMIT_NOFILE: libc::c_int = 8;\n \n     // The strategy here is to fetch the current resource limits, read the\n     // kern.maxfilesperproc sysctl value, and bump the soft resource limit for\n@@ -51,25 +34,25 @@ pub unsafe fn raise_fd_limit() {\n     let mut mib: [libc::c_int; 2] = [CTL_KERN, KERN_MAXFILESPERPROC];\n     let mut maxfiles: libc::c_int = 0;\n     let mut size: libc::size_t = size_of_val(&maxfiles) as libc::size_t;\n-    if sysctl(&mut mib[0], 2, &mut maxfiles as *mut _ as *mut _, &mut size,\n+    if libc::sysctl(&mut mib[0], 2, &mut maxfiles as *mut _ as *mut _, &mut size,\n               null_mut(), 0) != 0 {\n         let err = io::Error::last_os_error();\n         panic!(\"raise_fd_limit: error calling sysctl: {}\", err);\n     }\n \n     // Fetch the current resource limits\n-    let mut rlim = rlimit{rlim_cur: 0, rlim_max: 0};\n-    if getrlimit(RLIMIT_NOFILE, &mut rlim) != 0 {\n+    let mut rlim = libc::rlimit{rlim_cur: 0, rlim_max: 0};\n+    if libc::getrlimit(libc::RLIMIT_NOFILE, &mut rlim) != 0 {\n         let err = io::Error::last_os_error();\n         panic!(\"raise_fd_limit: error calling getrlimit: {}\", err);\n     }\n \n     // Bump the soft limit to the smaller of kern.maxfilesperproc and the hard\n     // limit\n-    rlim.rlim_cur = cmp::min(maxfiles as rlim_t, rlim.rlim_max);\n+    rlim.rlim_cur = cmp::min(maxfiles as libc::rlim_t, rlim.rlim_max);\n \n     // Set our newly-increased resource limit\n-    if setrlimit(RLIMIT_NOFILE, &rlim) != 0 {\n+    if libc::setrlimit(libc::RLIMIT_NOFILE, &rlim) != 0 {\n         let err = io::Error::last_os_error();\n         panic!(\"raise_fd_limit: error calling setrlimit: {}\", err);\n     }"}]}