{"sha": "c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3", "node_id": "C_kwDOAAsO6NoAKGM1MTg3MWM0NjlmN2VkM2IzNWFlMjVkN2U2ZTc3YmM3M2ZiZGQwZTM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-10T10:53:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-05-10T10:53:47Z"}, "message": "Auto merge of #94799 - lcnr:list-ty-perf, r=petrochenkov\n\nupdate `hash_stable` for `List<Ty<'tcx>>`\n\ncc https://github.com/rust-lang/rust/pull/93505#issuecomment-1047538798\n\nthis is the hottest part changed since the pre-merge perf run", "tree": {"sha": "b803c7532ecf211c28f6efd79a4b170145b76422", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b803c7532ecf211c28f6efd79a4b170145b76422"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3", "html_url": "https://github.com/rust-lang/rust/commit/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d53f1e8fbf891cf84fcb11eb078a27e528df795a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d53f1e8fbf891cf84fcb11eb078a27e528df795a", "html_url": "https://github.com/rust-lang/rust/commit/d53f1e8fbf891cf84fcb11eb078a27e528df795a"}, {"sha": "5b6b348b8525686d828621ecfa30a282a7269d0c", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b6b348b8525686d828621ecfa30a282a7269d0c", "html_url": "https://github.com/rust-lang/rust/commit/5b6b348b8525686d828621ecfa30a282a7269d0c"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "65c9b1aed050e63d9c247c7a85df23996a47f0ec", "filename": "compiler/rustc_middle/src/ty/impls_ty.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fimpls_ty.rs?ref=c51871c469f7ed3b35ae25d7e6e77bc73fbdd0e3", "patch": "@@ -86,18 +86,16 @@ impl<'a, 'tcx> HashStable<StableHashingContext<'a>> for ty::subst::GenericArgKin\n             //\n             // In order to make it very unlikely for the sequence of bytes being hashed for\n             // a `GenericArgKind::Type` to be the same as the sequence of bytes being\n-            // hashed for one of the other variants, we hash a `0xFF` byte before hashing\n-            // their discriminant (since the discriminant of `TyKind` is unlikely to ever start\n-            // with 0xFF).\n+            // hashed for one of the other variants, we hash some very high number instead\n+            // of their actual discriminant since `TyKind` should never start with anything\n+            // that high.\n             ty::subst::GenericArgKind::Type(ty) => ty.hash_stable(hcx, hasher),\n             ty::subst::GenericArgKind::Const(ct) => {\n-                0xFFu8.hash_stable(hcx, hasher);\n-                mem::discriminant(self).hash_stable(hcx, hasher);\n+                0xF3u8.hash_stable(hcx, hasher);\n                 ct.hash_stable(hcx, hasher);\n             }\n             ty::subst::GenericArgKind::Lifetime(lt) => {\n-                0xFFu8.hash_stable(hcx, hasher);\n-                mem::discriminant(self).hash_stable(hcx, hasher);\n+                0xF5u8.hash_stable(hcx, hasher);\n                 lt.hash_stable(hcx, hasher);\n             }\n         }"}]}