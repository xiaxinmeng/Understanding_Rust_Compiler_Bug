{"sha": "715948eb51920d5e4a791e4757652daf9fa925ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxNTk0OGViNTE5MjBkNWU0YTc5MWU0NzU3NjUyZGFmOWZhOTI1ZWQ=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-24T11:14:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-24T11:14:22Z"}, "message": "Rollup merge of #71428 - tromey:gdb-10-parsing, r=tromey\n\nLet compiletest recognize gdb 10.x\n\ngit gdb has moved to version 10.  My build prints this as its\n--version:\n\n    GNU gdb (GDB) 10.0.50.20200420-git\n\nUnfortunately this conflicts with this comment in compiletest:\n\n    // We limit major to 1 digit, otherwise, on openSUSE, we parse the openSUSE version\n\nThis patch changes the version parsing to follow the GNU coding\nstandard, which accounts for both the openSUSE case as well as\nhandling gdb 10.\n\nMy debuginfo test run now says:\n\nNOTE: compiletest thinks it is using GDB with native rust support\nNOTE: compiletest thinks it is using GDB version 10000050\n\n... where previously it failed to find that gdb 10 had rust support.", "tree": {"sha": "fb9681a1a7bccb6f137488b4d56b3508ecc48800", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fb9681a1a7bccb6f137488b4d56b3508ecc48800"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/715948eb51920d5e4a791e4757652daf9fa925ed", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeosoPCRBK7hj4Ov3rIwAAdHIIAF21NUI5Ihl7nUxHDXC/to5q\nUq0lu3T5SStJ2SyENZaxzigxEZngtpZ05/yY0wqIwM93H9mQFyw6mT8DrhucmQ3b\njkf6cg1IQGQX+SCKqtI0hd80Hoq0QB0eWxWQPKTMflLZ9e4Vga+DsqNB65rloAh3\nNriVXsQxin6ulXqKaB3FEF0jvEoz+KBn2QtZ6WAoZRGAyB7RrcyIg7hOMgWeDDOQ\nb+E3jdLWBbETTlF7sBGcZ9FfcrMwEgQujzIwTdzPvEMHrLsu2PY/phyCAi8Z4Lpq\nTQgAsyo+S+2NSpXGzUXo2yu0WHv5Yg3wAo/VxvleRhL7OlizDC0yuP610X/btiQ=\n=enl+\n-----END PGP SIGNATURE-----\n", "payload": "tree fb9681a1a7bccb6f137488b4d56b3508ecc48800\nparent 2846aa2f2f7adf764aaae1ed8221fc8084973db7\nparent 90b4a97efe2af42bd4e124ede1e802f47f1fbc08\nauthor Dylan DPC <dylan.dpc@gmail.com> 1587726862 +0200\ncommitter GitHub <noreply@github.com> 1587726862 +0200\n\nRollup merge of #71428 - tromey:gdb-10-parsing, r=tromey\n\nLet compiletest recognize gdb 10.x\n\ngit gdb has moved to version 10.  My build prints this as its\n--version:\n\n    GNU gdb (GDB) 10.0.50.20200420-git\n\nUnfortunately this conflicts with this comment in compiletest:\n\n    // We limit major to 1 digit, otherwise, on openSUSE, we parse the openSUSE version\n\nThis patch changes the version parsing to follow the GNU coding\nstandard, which accounts for both the openSUSE case as well as\nhandling gdb 10.\n\nMy debuginfo test run now says:\n\nNOTE: compiletest thinks it is using GDB with native rust support\nNOTE: compiletest thinks it is using GDB version 10000050\n\n... where previously it failed to find that gdb 10 had rust support.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/715948eb51920d5e4a791e4757652daf9fa925ed", "html_url": "https://github.com/rust-lang/rust/commit/715948eb51920d5e4a791e4757652daf9fa925ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/715948eb51920d5e4a791e4757652daf9fa925ed/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2846aa2f2f7adf764aaae1ed8221fc8084973db7", "url": "https://api.github.com/repos/rust-lang/rust/commits/2846aa2f2f7adf764aaae1ed8221fc8084973db7", "html_url": "https://github.com/rust-lang/rust/commit/2846aa2f2f7adf764aaae1ed8221fc8084973db7"}, {"sha": "90b4a97efe2af42bd4e124ede1e802f47f1fbc08", "url": "https://api.github.com/repos/rust-lang/rust/commits/90b4a97efe2af42bd4e124ede1e802f47f1fbc08", "html_url": "https://github.com/rust-lang/rust/commit/90b4a97efe2af42bd4e124ede1e802f47f1fbc08"}], "stats": {"total": 26, "additions": 21, "deletions": 5}, "files": [{"sha": "3a8a5491255a0dce0d093c82747f4c6c6487362c", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/715948eb51920d5e4a791e4757652daf9fa925ed/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/715948eb51920d5e4a791e4757652daf9fa925ed/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=715948eb51920d5e4a791e4757652daf9fa925ed", "patch": "@@ -831,12 +831,28 @@ fn extract_gdb_version(full_version_line: &str) -> Option<u32> {\n     // GDB versions look like this: \"major.minor.patch?.yyyymmdd?\", with both\n     // of the ? sections being optional\n \n-    // We will parse up to 3 digits for minor and patch, ignoring the date\n-    // We limit major to 1 digit, otherwise, on openSUSE, we parse the openSUSE version\n+    // We will parse up to 3 digits for each component, ignoring the date\n+\n+    // We skip text in parentheses.  This avoids accidentally parsing\n+    // the openSUSE version, which looks like:\n+    //  GNU gdb (GDB; openSUSE Leap 15.0) 8.1\n+    // This particular form is documented in the GNU coding standards:\n+    // https://www.gnu.org/prep/standards/html_node/_002d_002dversion.html#g_t_002d_002dversion\n \n     // don't start parsing in the middle of a number\n     let mut prev_was_digit = false;\n+    let mut in_parens = false;\n     for (pos, c) in full_version_line.char_indices() {\n+        if in_parens {\n+            if c == ')' {\n+                in_parens = false;\n+            }\n+            continue;\n+        } else if c == '(' {\n+            in_parens = true;\n+            continue;\n+        }\n+\n         if prev_was_digit || !c.is_digit(10) {\n             prev_was_digit = c.is_digit(10);\n             continue;\n@@ -876,7 +892,7 @@ fn extract_gdb_version(full_version_line: &str) -> Option<u32> {\n             None => (line, None),\n         };\n \n-        if major.len() != 1 || minor.is_empty() {\n+        if minor.is_empty() {\n             continue;\n         }\n "}, {"sha": "31c151d29e916c75bc2607870bfa354ac5ecc0c3", "filename": "src/tools/compiletest/src/tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/715948eb51920d5e4a791e4757652daf9fa925ed/src%2Ftools%2Fcompiletest%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/715948eb51920d5e4a791e4757652daf9fa925ed/src%2Ftools%2Fcompiletest%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Ftests.rs?ref=715948eb51920d5e4a791e4757652daf9fa925ed", "patch": "@@ -7,9 +7,9 @@ fn test_extract_gdb_version() {\n     )*}}}\n \n     test! {\n-        7000001: \"GNU gdb (GDB) CentOS (7.0.1-45.el5.centos)\",\n+        7000001: \"GNU gdb (GDB) CentOS 7.0.1-45.el5.centos\",\n \n-        7002000: \"GNU gdb (GDB) Red Hat Enterprise Linux (7.2-90.el6)\",\n+        7002000: \"GNU gdb (GDB) Red Hat Enterprise Linux 7.2-90.el6\",\n \n         7004000: \"GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1) 7.4-2012.04\",\n         7004001: \"GNU gdb (GDB) 7.4.1-debian\","}]}