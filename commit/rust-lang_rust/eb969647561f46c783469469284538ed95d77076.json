{"sha": "eb969647561f46c783469469284538ed95d77076", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViOTY5NjQ3NTYxZjQ2Yzc4MzQ2OTQ2OTI4NDUzOGVkOTVkNzcwNzY=", "commit": {"author": {"name": "Charles Lew", "email": "crlf0710@gmail.com", "date": "2020-09-16T16:21:34Z"}, "committer": {"name": "Charles Lew", "email": "crlf0710@gmail.com", "date": "2020-09-16T16:21:34Z"}, "message": "Add a test.", "tree": {"sha": "fd9373e31b4de5ea6d8b5f5a3c20ae13efe66321", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd9373e31b4de5ea6d8b5f5a3c20ae13efe66321"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb969647561f46c783469469284538ed95d77076", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb969647561f46c783469469284538ed95d77076", "html_url": "https://github.com/rust-lang/rust/commit/eb969647561f46c783469469284538ed95d77076", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb969647561f46c783469469284538ed95d77076/comments", "author": {"login": "crlf0710", "id": 451806, "node_id": "MDQ6VXNlcjQ1MTgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/451806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crlf0710", "html_url": "https://github.com/crlf0710", "followers_url": "https://api.github.com/users/crlf0710/followers", "following_url": "https://api.github.com/users/crlf0710/following{/other_user}", "gists_url": "https://api.github.com/users/crlf0710/gists{/gist_id}", "starred_url": "https://api.github.com/users/crlf0710/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crlf0710/subscriptions", "organizations_url": "https://api.github.com/users/crlf0710/orgs", "repos_url": "https://api.github.com/users/crlf0710/repos", "events_url": "https://api.github.com/users/crlf0710/events{/privacy}", "received_events_url": "https://api.github.com/users/crlf0710/received_events", "type": "User", "site_admin": false}, "committer": {"login": "crlf0710", "id": 451806, "node_id": "MDQ6VXNlcjQ1MTgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/451806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crlf0710", "html_url": "https://github.com/crlf0710", "followers_url": "https://api.github.com/users/crlf0710/followers", "following_url": "https://api.github.com/users/crlf0710/following{/other_user}", "gists_url": "https://api.github.com/users/crlf0710/gists{/gist_id}", "starred_url": "https://api.github.com/users/crlf0710/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crlf0710/subscriptions", "organizations_url": "https://api.github.com/users/crlf0710/orgs", "repos_url": "https://api.github.com/users/crlf0710/repos", "events_url": "https://api.github.com/users/crlf0710/events{/privacy}", "received_events_url": "https://api.github.com/users/crlf0710/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "389d9a6c2d297d838b4cfa754565b6bea5f8c757", "url": "https://api.github.com/repos/rust-lang/rust/commits/389d9a6c2d297d838b4cfa754565b6bea5f8c757", "html_url": "https://github.com/rust-lang/rust/commit/389d9a6c2d297d838b4cfa754565b6bea5f8c757"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "690f9d66ea50d507241bb5bde5bb034160a9b0b3", "filename": "crates/hir_ty/src/tests/method_resolution.rs", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/eb969647561f46c783469469284538ed95d77076/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb969647561f46c783469469284538ed95d77076/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs?ref=eb969647561f46c783469469284538ed95d77076", "patch": "@@ -1051,3 +1051,41 @@ fn dyn_trait_super_trait_not_in_scope() {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn method_resolution_foreign_opaque_type() {\n+    check_infer(\n+        r#\"\n+        extern \"C\" {\n+            type S;\n+            fn f() -> &'static S;\n+        }\n+\n+        impl S {\n+            fn foo(&self) -> bool {\n+                true\n+            }\n+        }\n+\n+        fn test() {\n+            let s = unsafe { f() };\n+            s.foo();\n+        }\n+        \"#,\n+        // FIXME: 's.foo()' should be `bool`.\n+        expect![[r#\"\n+            75..79 'self': &S\n+            89..109 '{     ...     }': bool\n+            99..103 'true': bool\n+            123..167 '{     ...o(); }': ()\n+            133..134 's': &S\n+            137..151 'unsafe { f() }': &S\n+            144..151 '{ f() }': &S\n+            146..147 'f': fn f() -> &S\n+            146..149 'f()': &S\n+            157..158 's': &S\n+            157..164 's.foo()': {unknown}\n+        \"#]],\n+    );\n+}\n+"}]}