{"sha": "520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyMGM5YTI1ZGZjNzhjYTFlMWQxOThlNTViYjRiY2I4NDRiMDc5MWU=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-03-27T19:37:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-27T19:37:04Z"}, "message": "Rollup merge of #81351 - lcnr:big-money-big-prices, r=oli-obk\n\ncombine: stop eagerly evaluating consts\n\n`super_relate_consts` eagerly evaluates constants which doesn't seem too great.\n\nI now also finally understand why all of the unused substs test passed. The reason being\nthat we just evaluated the constants in `super_relate_consts` :laughing:\n\nWhile this change isn't strictly necessary as evaluating consts here doesn't hurt, it still feels a lot cleaner to do it this way\n\nr? `@oli-obk` `@nikomatsakis`", "tree": {"sha": "e007583c06fd7a26f8cb73a0b197993c3e289dfa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e007583c06fd7a26f8cb73a0b197993c3e289dfa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgX4lgCRBK7hj4Ov3rIwAAdHIIAHTYjSNeyUMuzpnLaDf1toYi\nHSCTpyFfr1ufzHcqgp6yL4U1NwutUeQmJfxKgWi4Ai6Qumcd2ocSYIcec7NSDCTE\nl/8BazQjDMat1L6I2hoLw2TVlhMBiMtAr6fQpRAfKh3OMD/5WqIa4Y5ZTFNtOKnz\n5mIZX0KZfSuwo4Or67aPvIuZ5GkldzqCTIi8ZFlWP3kSFOIfcEu12LgXlt7SUMFo\nCxUL7CHVSGsQNZ8CA3NjM2CXzGTl6ceZhQI7xYtgozSzDznGmpoK1nSFzwVZ6zcY\n1CPovX8iEzg+Q/cPss0aHYJEhMdx03Uy/HJiOXrPVy/CTfOlwMW8f18B7xMVeeY=\n=DTHM\n-----END PGP SIGNATURE-----\n", "payload": "tree e007583c06fd7a26f8cb73a0b197993c3e289dfa\nparent afaf33dcafe9c7068b63eb997df221aa08db7c29\nparent e461dddf5828d729b872e27d1a7a7335437ce413\nauthor Dylan DPC <dylan.dpc@gmail.com> 1616873824 +0100\ncommitter GitHub <noreply@github.com> 1616873824 +0100\n\nRollup merge of #81351 - lcnr:big-money-big-prices, r=oli-obk\n\ncombine: stop eagerly evaluating consts\n\n`super_relate_consts` eagerly evaluates constants which doesn't seem too great.\n\nI now also finally understand why all of the unused substs test passed. The reason being\nthat we just evaluated the constants in `super_relate_consts` :laughing:\n\nWhile this change isn't strictly necessary as evaluating consts here doesn't hurt, it still feels a lot cleaner to do it this way\n\nr? `@oli-obk` `@nikomatsakis`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "html_url": "https://github.com/rust-lang/rust/commit/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "afaf33dcafe9c7068b63eb997df221aa08db7c29", "url": "https://api.github.com/repos/rust-lang/rust/commits/afaf33dcafe9c7068b63eb997df221aa08db7c29", "html_url": "https://github.com/rust-lang/rust/commit/afaf33dcafe9c7068b63eb997df221aa08db7c29"}, {"sha": "e461dddf5828d729b872e27d1a7a7335437ce413", "url": "https://api.github.com/repos/rust-lang/rust/commits/e461dddf5828d729b872e27d1a7a7335437ce413", "html_url": "https://github.com/rust-lang/rust/commit/e461dddf5828d729b872e27d1a7a7335437ce413"}], "stats": {"total": 139, "additions": 109, "deletions": 30}, "files": [{"sha": "ffe947d209dd605a5b3bbd0572f880684a1c528a", "filename": "compiler/rustc_infer/src/infer/combine.rs", "status": "modified", "additions": 20, "deletions": 8, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcombine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcombine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fcombine.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -543,10 +543,6 @@ impl TypeRelation<'tcx> for Generalizer<'_, 'tcx> {\n         true\n     }\n \n-    fn visit_ct_substs(&self) -> bool {\n-        true\n-    }\n-\n     fn binders<T>(\n         &mut self,\n         a: ty::Binder<T>,\n@@ -737,6 +733,16 @@ impl TypeRelation<'tcx> for Generalizer<'_, 'tcx> {\n                     }\n                 }\n             }\n+            ty::ConstKind::Unevaluated(ty::Unevaluated { def, substs, promoted })\n+                if self.tcx().lazy_normalization() =>\n+            {\n+                assert_eq!(promoted, None);\n+                let substs = self.relate_with_variance(ty::Variance::Invariant, substs, substs)?;\n+                Ok(self.tcx().mk_const(ty::Const {\n+                    ty: c.ty,\n+                    val: ty::ConstKind::Unevaluated(ty::Unevaluated { def, substs, promoted }),\n+                }))\n+            }\n             _ => relate::super_relate_consts(self, c, c),\n         }\n     }\n@@ -822,10 +828,6 @@ impl TypeRelation<'tcx> for ConstInferUnifier<'_, 'tcx> {\n         true\n     }\n \n-    fn visit_ct_substs(&self) -> bool {\n-        true\n-    }\n-\n     fn relate_with_variance<T: Relate<'tcx>>(\n         &mut self,\n         _variance: ty::Variance,\n@@ -959,6 +961,16 @@ impl TypeRelation<'tcx> for ConstInferUnifier<'_, 'tcx> {\n                     }\n                 }\n             }\n+            ty::ConstKind::Unevaluated(ty::Unevaluated { def, substs, promoted })\n+                if self.tcx().lazy_normalization() =>\n+            {\n+                assert_eq!(promoted, None);\n+                let substs = self.relate_with_variance(ty::Variance::Invariant, substs, substs)?;\n+                Ok(self.tcx().mk_const(ty::Const {\n+                    ty: c.ty,\n+                    val: ty::ConstKind::Unevaluated(ty::Unevaluated { def, substs, promoted }),\n+                }))\n+            }\n             _ => relate::super_relate_consts(self, c, c),\n         }\n     }"}, {"sha": "bc979b885b4958cdbdf7904165f7506cc8491255", "filename": "compiler/rustc_middle/src/ty/relate.rs", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/compiler%2Frustc_middle%2Fsrc%2Fty%2Frelate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/compiler%2Frustc_middle%2Fsrc%2Fty%2Frelate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Frelate.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -33,15 +33,6 @@ pub trait TypeRelation<'tcx>: Sized {\n     /// relation. Just affects error messages.\n     fn a_is_expected(&self) -> bool;\n \n-    /// Whether we should look into the substs of unevaluated constants\n-    /// even if `feature(const_evaluatable_checked)` is active.\n-    ///\n-    /// This is needed in `combine` to prevent accidentially creating\n-    /// infinite types as we abuse `TypeRelation` to walk a type there.\n-    fn visit_ct_substs(&self) -> bool {\n-        false\n-    }\n-\n     fn with_cause<F, R>(&mut self, _cause: Cause, f: F) -> R\n     where\n         F: FnOnce(&mut Self) -> R,\n@@ -432,9 +423,9 @@ pub fn super_relate_tys<R: TypeRelation<'tcx>>(\n                     let sz_a = sz_a.try_eval_usize(tcx, relation.param_env());\n                     let sz_b = sz_b.try_eval_usize(tcx, relation.param_env());\n                     match (sz_a, sz_b) {\n-                        (Some(sz_a_val), Some(sz_b_val)) => Err(TypeError::FixedArraySize(\n-                            expected_found(relation, sz_a_val, sz_b_val),\n-                        )),\n+                        (Some(sz_a_val), Some(sz_b_val)) if sz_a_val != sz_b_val => Err(\n+                            TypeError::FixedArraySize(expected_found(relation, sz_a_val, sz_b_val)),\n+                        ),\n                         _ => Err(err),\n                     }\n                 }\n@@ -532,7 +523,7 @@ pub fn super_relate_consts<R: TypeRelation<'tcx>>(\n         }\n \n         (ty::ConstKind::Unevaluated(au), ty::ConstKind::Unevaluated(bu))\n-            if tcx.features().const_evaluatable_checked && !relation.visit_ct_substs() =>\n+            if tcx.features().const_evaluatable_checked =>\n         {\n             tcx.try_unify_abstract_consts(((au.def, au.substs), (bu.def, bu.substs)))\n         }"}, {"sha": "45318ca68fcc586f03da6804d73fbccac8cf0c03", "filename": "src/test/ui/const-generics/issues/issue-69654-run-pass.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -1,4 +1,3 @@\n-// run-pass\n #![feature(const_generics)]\n #![allow(incomplete_features, unused_braces)]\n \n@@ -15,4 +14,5 @@ where\n \n fn main() {\n     Foo::foo();\n+    //~^ ERROR the function or associated item\n }"}, {"sha": "a82a60696b36b1cb27ffbcf7129cded6e27d559e", "filename": "src/test/ui/const-generics/issues/issue-69654-run-pass.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654-run-pass.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -0,0 +1,15 @@\n+error[E0599]: the function or associated item `foo` exists for struct `Foo<{_: usize}>`, but its trait bounds were not satisfied\n+  --> $DIR/issue-69654-run-pass.rs:16:10\n+   |\n+LL | struct Foo<const N: usize> {}\n+   | -------------------------- function or associated item `foo` not found for this\n+...\n+LL |     Foo::foo();\n+   |          ^^^ function or associated item cannot be called on `Foo<{_: usize}>` due to unsatisfied trait bounds\n+   |\n+   = note: the following trait bounds were not satisfied:\n+           `[u8; _]: Bar<[(); _]>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0599`."}, {"sha": "b1214b12a14403114b984c7358bbc7e3a2f3c1cd", "filename": "src/test/ui/const-generics/issues/issue-69654.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -15,4 +15,5 @@ where\n \n fn main() {\n     Foo::foo();\n+    //~^ ERROR the function or associated item\n }"}, {"sha": "0ce7640f685774a07c20c5b6b8db7d6854d487d0", "filename": "src/test/ui/const-generics/issues/issue-69654.stderr", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fissues%2Fissue-69654.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -4,6 +4,19 @@ error[E0423]: expected value, found type parameter `T`\n LL | impl<T> Bar<T> for [u8; T] {}\n    |                         ^ not a value\n \n-error: aborting due to previous error\n+error[E0599]: the function or associated item `foo` exists for struct `Foo<{_: usize}>`, but its trait bounds were not satisfied\n+  --> $DIR/issue-69654.rs:17:10\n+   |\n+LL | struct Foo<const N: usize> {}\n+   | -------------------------- function or associated item `foo` not found for this\n+...\n+LL |     Foo::foo();\n+   |          ^^^ function or associated item cannot be called on `Foo<{_: usize}>` due to unsatisfied trait bounds\n+   |\n+   = note: the following trait bounds were not satisfied:\n+           `[u8; _]: Bar<[(); _]>`\n+\n+error: aborting due to 2 previous errors\n \n-For more information about this error, try `rustc --explain E0423`.\n+Some errors have detailed explanations: E0423, E0599.\n+For more information about an error, try `rustc --explain E0423`."}, {"sha": "6ded9f13bc4fadacbd90a041e571a7522bdaeb55", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-1.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -1,4 +1,3 @@\n-// build-pass\n #![feature(const_generics)]\n #![allow(incomplete_features)]\n \n@@ -10,5 +9,5 @@ where\n     A<N>: Bar<N>;\n \n fn main() {\n-    let _ = A;\n+    let _ = A; //~ERROR the trait bound\n }"}, {"sha": "6830288acc0ad25c49e82e5b1b7fcf36c5a085b1", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-1.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-1.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -0,0 +1,17 @@\n+error[E0277]: the trait bound `A<{_: usize}>: Bar<{_: usize}>` is not satisfied\n+  --> $DIR/unused-substs-1.rs:12:13\n+   |\n+LL | / struct A<const N: usize>\n+LL | | where\n+LL | |     A<N>: Bar<N>;\n+   | |_________________- required by `A`\n+...\n+LL |       let _ = A;\n+   |               ^ the trait `Bar<{_: usize}>` is not implemented for `A<{_: usize}>`\n+   |\n+   = help: the following implementations were found:\n+             <A<7_usize> as Bar<N>>\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "2d00141fbf70bb1393262a56a7d2e1b76a1d6d60", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-2.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -1,4 +1,3 @@\n-// check-pass\n #![feature(const_generics)]\n #![allow(incomplete_features)]\n \n@@ -24,4 +23,6 @@ fn main() {\n     // `t` is `ty::Infer(TyVar(_#1t))`\n     // `foo` contains `ty::Infer(TyVar(_#1t))` in its substs\n     t = foo;\n+    //~^ ERROR mismatched types\n+    //~| NOTE cyclic type\n }"}, {"sha": "9532fc21a31b70aebe4fbb69ee60b18f84c2627c", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-2.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-2.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -0,0 +1,9 @@\n+error[E0308]: mismatched types\n+  --> $DIR/unused-substs-2.rs:25:9\n+   |\n+LL |     t = foo;\n+   |         ^^^ cyclic type of infinite size\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "2e306f8c4c88fd46eb1784c962b10d3df9384aa7", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-3.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -1,4 +1,3 @@\n-// check-pass\n #![feature(const_generics)]\n #![allow(incomplete_features)]\n \n@@ -15,4 +14,6 @@ fn main() {\n     // `t` is `ty::Infer(TyVar(_#1t))`\n     // `foo` contains `ty::Infer(TyVar(_#1t))` in its substs\n     t = foo;\n+    //~^ ERROR mismatched types\n+    //~| NOTE cyclic type\n }"}, {"sha": "2551d68f9747499f22da42dfc54f41dc6c29b647", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-3.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-3.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/unused-substs-3.rs:16:9\n+   |\n+LL |     t = foo;\n+   |         ^^^\n+   |         |\n+   |         cyclic type of infinite size\n+   |         help: try using a conversion method: `foo.to_vec()`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "9c7f5ab91edb13298a6a868b4909ae6f201e6fdf", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-4.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.rs?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -1,4 +1,3 @@\n-// build-pass\n #![feature(const_generics)]\n #![allow(incomplete_features)]\n \n@@ -8,5 +7,5 @@ fn bind<const N: usize>(value: [u8; N]) -> [u8; 3 + 4] {\n \n fn main() {\n     let mut arr = Default::default();\n-    arr = bind(arr);\n+    arr = bind(arr); //~ ERROR mismatched type\n }"}, {"sha": "5685eedbdeca82b205fff2130f46f69612e52568", "filename": "src/test/ui/const-generics/occurs-check/unused-substs-4.stderr", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/520c9a25dfc78ca1e1d198e55bb4bcb844b0791e/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Foccurs-check%2Funused-substs-4.stderr?ref=520c9a25dfc78ca1e1d198e55bb4bcb844b0791e", "patch": "@@ -0,0 +1,9 @@\n+error[E0308]: mismatched types\n+  --> $DIR/unused-substs-4.rs:10:11\n+   |\n+LL |     arr = bind(arr);\n+   |           ^^^^^^^^^ encountered a self-referencing constant\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}