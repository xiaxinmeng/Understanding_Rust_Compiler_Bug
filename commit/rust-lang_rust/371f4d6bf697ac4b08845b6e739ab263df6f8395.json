{"sha": "371f4d6bf697ac4b08845b6e739ab263df6f8395", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3MWY0ZDZiZjY5N2FjNGIwODg0NWI2ZTczOWFiMjYzZGY2ZjgzOTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-28T14:33:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-28T14:33:48Z"}, "message": "Auto merge of #38626 - redox-os:args_fix, r=alexcrichton\n\nFix argument handling on Redox\n\nAfter switching the start code to be handled in libc, we are no longer passing in slices as arguments into the libstd main function. This means that handling had to be rewritten to match the unix way of doing things.\n\nAdditional commits on this branch are going to be merged in this PR: https://github.com/rust-lang/rust/pull/38577#issuecomment-269138394", "tree": {"sha": "c26eddb3a9020558787e77dae71244a24eb7384d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c26eddb3a9020558787e77dae71244a24eb7384d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/371f4d6bf697ac4b08845b6e739ab263df6f8395", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/371f4d6bf697ac4b08845b6e739ab263df6f8395", "html_url": "https://github.com/rust-lang/rust/commit/371f4d6bf697ac4b08845b6e739ab263df6f8395", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/371f4d6bf697ac4b08845b6e739ab263df6f8395/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "469fd779ee24f8348acd438f471c8c3a5cef309a", "url": "https://api.github.com/repos/rust-lang/rust/commits/469fd779ee24f8348acd438f471c8c3a5cef309a", "html_url": "https://github.com/rust-lang/rust/commit/469fd779ee24f8348acd438f471c8c3a5cef309a"}, {"sha": "88df0e391842f89dbd95fb8e375e11d8263ae156", "url": "https://api.github.com/repos/rust-lang/rust/commits/88df0e391842f89dbd95fb8e375e11d8263ae156", "html_url": "https://github.com/rust-lang/rust/commit/88df0e391842f89dbd95fb8e375e11d8263ae156"}], "stats": {"total": 14, "additions": 5, "deletions": 9}, "files": [{"sha": "212895d7b76fc661e2db49144288813d0ccffb5c", "filename": "src/libstd/sys/redox/args.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/371f4d6bf697ac4b08845b6e739ab263df6f8395/src%2Flibstd%2Fsys%2Fredox%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/371f4d6bf697ac4b08845b6e739ab263df6f8395/src%2Flibstd%2Fsys%2Fredox%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fargs.rs?ref=371f4d6bf697ac4b08845b6e739ab263df6f8395", "patch": "@@ -52,10 +52,9 @@ impl DoubleEndedIterator for Args {\n mod imp {\n     use os::unix::prelude::*;\n     use mem;\n-    use ffi::OsString;\n+    use ffi::{CStr, OsString};\n     use marker::PhantomData;\n-    use slice;\n-    use str;\n+    use libc;\n     use super::Args;\n \n     use sys_common::mutex::Mutex;\n@@ -64,12 +63,9 @@ mod imp {\n     static LOCK: Mutex = Mutex::new();\n \n     pub unsafe fn init(argc: isize, argv: *const *const u8) {\n-        let mut args: Vec<Vec<u8>> = Vec::new();\n-        for i in 0..argc {\n-            let len = *(argv.offset(i * 2)) as usize;\n-            let ptr = *(argv.offset(i * 2 + 1));\n-            args.push(slice::from_raw_parts(ptr, len).to_vec());\n-        }\n+        let args = (0..argc).map(|i| {\n+            CStr::from_ptr(*argv.offset(i) as *const libc::c_char).to_bytes().to_vec()\n+        }).collect();\n \n         LOCK.lock();\n         let ptr = get_global_ptr();"}]}