{"sha": "389e8e3b8172f1d878eb1358e047573a7e76e853", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM4OWU4ZTNiODE3MmYxZDg3OGViMTM1OGUwNDc1NzNhN2U3NmU4NTM=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2015-12-25T16:17:45Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas@schievink.net", "date": "2015-12-25T16:17:45Z"}, "message": "Delete the AST after lowering", "tree": {"sha": "13642024b353e1dc24e27d83d702a444d7a57add", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/13642024b353e1dc24e27d83d702a444d7a57add"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/389e8e3b8172f1d878eb1358e047573a7e76e853", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/389e8e3b8172f1d878eb1358e047573a7e76e853", "html_url": "https://github.com/rust-lang/rust/commit/389e8e3b8172f1d878eb1358e047573a7e76e853", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/389e8e3b8172f1d878eb1358e047573a7e76e853/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93a655940da888a52ec84b9ab49c01466e8ee41f", "url": "https://api.github.com/repos/rust-lang/rust/commits/93a655940da888a52ec84b9ab49c01466e8ee41f", "html_url": "https://github.com/rust-lang/rust/commit/93a655940da888a52ec84b9ab49c01466e8ee41f"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "d1c7da1d1075fcb1d6672e1d058400be9d402444", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/389e8e3b8172f1d878eb1358e047573a7e76e853/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/389e8e3b8172f1d878eb1358e047573a7e76e853/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=389e8e3b8172f1d878eb1358e047573a7e76e853", "patch": "@@ -622,6 +622,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n           \"force nonzeroing move optimization on\"),\n     keep_mtwt_tables: bool = (false, parse_bool,\n           \"don't clear the resolution tables after analysis\"),\n+    keep_ast: bool = (false, parse_bool,\n+          \"keep the AST after lowering it to HIR\"),\n }\n \n pub fn default_lib_output() -> CrateType {"}, {"sha": "1ac1b5978cfb609cacc6bd9ccf055e9e635ab35b", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/389e8e3b8172f1d878eb1358e047573a7e76e853/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/389e8e3b8172f1d878eb1358e047573a7e76e853/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=389e8e3b8172f1d878eb1358e047573a7e76e853", "patch": "@@ -144,6 +144,14 @@ pub fn compile_input(sess: Session,\n              \"early lint checks\",\n              || lint::check_ast_crate(&sess, &expanded_crate));\n \n+        let opt_crate = if sess.opts.debugging_opts.keep_ast ||\n+                           sess.opts.debugging_opts.save_analysis {\n+            Some(&expanded_crate)\n+        } else {\n+            drop(expanded_crate);\n+            None\n+        };\n+\n         phase_3_run_analysis_passes(&sess,\n                                     &cstore,\n                                     hir_map,\n@@ -157,7 +165,7 @@ pub fn compile_input(sess: Session,\n                                                 CompileState::state_after_analysis(input,\n                                                                                    &tcx.sess,\n                                                                                    outdir,\n-                                                                                   &expanded_crate,\n+                                                                                   opt_crate,\n                                                                                    tcx.map.krate(),\n                                                                                    &analysis,\n                                                                                    &mir_map,\n@@ -360,7 +368,7 @@ impl<'a, 'ast, 'tcx> CompileState<'a, 'ast, 'tcx> {\n     fn state_after_analysis(input: &'a Input,\n                             session: &'a Session,\n                             out_dir: &'a Option<PathBuf>,\n-                            krate: &'a ast::Crate,\n+                            krate: Option<&'a ast::Crate>,\n                             hir_crate: &'a hir::Crate,\n                             analysis: &'a ty::CrateAnalysis,\n                             mir_map: &'a MirMap<'tcx>,\n@@ -372,7 +380,7 @@ impl<'a, 'ast, 'tcx> CompileState<'a, 'ast, 'tcx> {\n             analysis: Some(analysis),\n             mir_map: Some(mir_map),\n             tcx: Some(tcx),\n-            krate: Some(krate),\n+            krate: krate,\n             hir_crate: Some(hir_crate),\n             lcx: Some(lcx),\n             crate_name: Some(crate_name),"}]}