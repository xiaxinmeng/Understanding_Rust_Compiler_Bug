{"sha": "bf09e0499e30a39426695c149c8a45c0c06bf715", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmMDllMDQ5OWUzMGEzOTQyNjY5NWMxNDljOGE0NWMwYzA2YmY3MTU=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-02-18T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-02-18T00:00:00Z"}, "message": "Implement -Z hir-stats for nested foreign items\n\nAn attempt to compute HIR stats for crates with nested foreign items results in an ICE.\n\n```\nfn main() {\n    extern \"C\" { fn f(); }\n}\n```\n\n```\nthread 'rustc' panicked at 'visit_nested_xxx must be manually implemented in this visitor'\n```\n\nProvide required implementation of visitor method.", "tree": {"sha": "c976049f3ff4985c1029c219211ba7e8b6160f66", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c976049f3ff4985c1029c219211ba7e8b6160f66"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf09e0499e30a39426695c149c8a45c0c06bf715", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf09e0499e30a39426695c149c8a45c0c06bf715", "html_url": "https://github.com/rust-lang/rust/commit/bf09e0499e30a39426695c149c8a45c0c06bf715", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf09e0499e30a39426695c149c8a45c0c06bf715/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb2effd44e667d133e31ef334e30d10195218ce6", "url": "https://api.github.com/repos/rust-lang/rust/commits/cb2effd44e667d133e31ef334e30d10195218ce6", "html_url": "https://github.com/rust-lang/rust/commit/cb2effd44e667d133e31ef334e30d10195218ce6"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "177e4e2d08fa23d8ff6715b0ae6c93f4deab20c2", "filename": "compiler/rustc_passes/src/hir_stats.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bf09e0499e30a39426695c149c8a45c0c06bf715/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf09e0499e30a39426695c149c8a45c0c06bf715/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs?ref=bf09e0499e30a39426695c149c8a45c0c06bf715", "patch": "@@ -114,6 +114,11 @@ impl<'v> hir_visit::Visitor<'v> for StatCollector<'v> {\n         self.visit_impl_item(nested_impl_item)\n     }\n \n+    fn visit_nested_foreign_item(&mut self, id: hir::ForeignItemId) {\n+        let nested_foreign_item = self.krate.unwrap().foreign_item(id);\n+        self.visit_foreign_item(nested_foreign_item);\n+    }\n+\n     fn visit_nested_body(&mut self, body_id: hir::BodyId) {\n         let nested_body = self.krate.unwrap().body(body_id);\n         self.visit_body(nested_body)"}]}