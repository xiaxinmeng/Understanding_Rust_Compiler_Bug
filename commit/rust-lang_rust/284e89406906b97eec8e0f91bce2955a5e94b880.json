{"sha": "284e89406906b97eec8e0f91bce2955a5e94b880", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4NGU4OTQwNjkwNmI5N2VlYzhlMGY5MWJjZTI5NTVhNWU5NGI4ODA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-21T22:34:22Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-12-21T22:42:26Z"}, "message": "cleanup", "tree": {"sha": "a49f15f70dc20c4429afd62d2d5027d6a8efc607", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a49f15f70dc20c4429afd62d2d5027d6a8efc607"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/284e89406906b97eec8e0f91bce2955a5e94b880", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/284e89406906b97eec8e0f91bce2955a5e94b880", "html_url": "https://github.com/rust-lang/rust/commit/284e89406906b97eec8e0f91bce2955a5e94b880", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/284e89406906b97eec8e0f91bce2955a5e94b880/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25dda42f3773b1d002a5809c0182c2adc6c47027", "url": "https://api.github.com/repos/rust-lang/rust/commits/25dda42f3773b1d002a5809c0182c2adc6c47027", "html_url": "https://github.com/rust-lang/rust/commit/25dda42f3773b1d002a5809c0182c2adc6c47027"}], "stats": {"total": 63, "additions": 34, "deletions": 29}, "files": [{"sha": "2c789192052f319f7ec607069e9121beb4e0d4f8", "filename": "crates/ra_analysis/src/completion/complete_keyword.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs?ref=284e89406906b97eec8e0f91bce2955a5e94b880", "patch": "@@ -5,7 +5,13 @@ use ra_syntax::{\n     SyntaxKind::*, SyntaxNodeRef,\n };\n \n-use crate::completion::{CompletionContext, CompletionItem, Completions, CompletionKind::*};\n+use crate::completion::{CompletionContext, CompletionItem, Completions, CompletionKind};\n+\n+fn keyword(kw: &str, snippet: &str) -> CompletionItem {\n+    CompletionItem::new(CompletionKind::Keyword, kw)\n+        .snippet(snippet)\n+        .build()\n+}\n \n pub(super) fn complete_expr_keyword(acc: &mut Completions, ctx: &CompletionContext) {\n     if !ctx.is_trivial_path {\n@@ -60,10 +66,6 @@ fn complete_return(fn_def: ast::FnDef, is_stmt: bool) -> Option<CompletionItem>\n     Some(keyword(\"return\", snip))\n }\n \n-fn keyword(kw: &str, snippet: &str) -> CompletionItem {\n-    CompletionItem::new(Keyword, kw).snippet(snippet).build()\n-}\n-\n #[cfg(test)]\n mod tests {\n     use crate::completion::{CompletionKind, check_completion};"}, {"sha": "802f4abe46962f498f0230987fcc03e76905b15b", "filename": "crates/ra_analysis/src/completion/complete_path.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_path.rs?ref=284e89406906b97eec8e0f91bce2955a5e94b880", "patch": "@@ -1,6 +1,6 @@\n use crate::{\n     Cancelable,\n-    completion::{CompletionItem, Completions, CompletionKind::*, CompletionContext},\n+    completion::{CompletionItem, Completions, CompletionKind, CompletionContext},\n };\n \n pub(super) fn complete_path(acc: &mut Completions, ctx: &CompletionContext) -> Cancelable<()> {\n@@ -17,9 +17,9 @@ pub(super) fn complete_path(acc: &mut Completions, ctx: &CompletionContext) -> C\n         _ => return Ok(()),\n     };\n     let module_scope = target_module.scope(ctx.db)?;\n-    module_scope\n-        .entries()\n-        .for_each(|(name, _res)| CompletionItem::new(Reference, name.to_string()).add_to(acc));\n+    module_scope.entries().for_each(|(name, _res)| {\n+        CompletionItem::new(CompletionKind::Reference, name.to_string()).add_to(acc)\n+    });\n     Ok(())\n }\n "}, {"sha": "fb87be4b153536a37d24d9a957093bde84abf27a", "filename": "crates/ra_analysis/src/completion/complete_scope.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=284e89406906b97eec8e0f91bce2955a5e94b880", "patch": "@@ -3,7 +3,7 @@ use ra_syntax::TextUnit;\n \n use crate::{\n     Cancelable,\n-    completion::{CompletionItem, Completions, CompletionKind::*, CompletionContext},\n+    completion::{CompletionItem, Completions, CompletionKind, CompletionContext},\n };\n \n pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) -> Cancelable<()> {\n@@ -29,7 +29,9 @@ pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) ->\n                     }\n                 }\n             })\n-            .for_each(|(name, _res)| CompletionItem::new(Reference, name.to_string()).add_to(acc));\n+            .for_each(|(name, _res)| {\n+                CompletionItem::new(CompletionKind::Reference, name.to_string()).add_to(acc)\n+            });\n     }\n \n     Ok(())\n@@ -41,9 +43,11 @@ fn complete_fn(acc: &mut Completions, scopes: &hir::FnScopes, offset: TextUnit)\n         .scope_chain_for_offset(offset)\n         .flat_map(|scope| scopes.entries(scope).iter())\n         .filter(|entry| shadowed.insert(entry.name()))\n-        .for_each(|entry| CompletionItem::new(Reference, entry.name().to_string()).add_to(acc));\n+        .for_each(|entry| {\n+            CompletionItem::new(CompletionKind::Reference, entry.name().to_string()).add_to(acc)\n+        });\n     if scopes.self_param.is_some() {\n-        CompletionItem::new(Reference, \"self\").add_to(acc);\n+        CompletionItem::new(CompletionKind::Reference, \"self\").add_to(acc);\n     }\n }\n "}, {"sha": "1feb332b98bd175072f66ded666f818549e71d6f", "filename": "crates/ra_analysis/src/completion/complete_snippet.rs", "status": "modified", "additions": 15, "deletions": 16, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284e89406906b97eec8e0f91bce2955a5e94b880/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_analysis%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs?ref=284e89406906b97eec8e0f91bce2955a5e94b880", "patch": "@@ -1,34 +1,33 @@\n-use crate::completion::{CompletionItem, Completions, CompletionKind::*, CompletionContext};\n+use crate::completion::{CompletionItem, Completions, CompletionKind, CompletionContext, completion_item::Builder};\n+\n+fn snippet(label: &str, snippet: &str) -> Builder {\n+    CompletionItem::new(CompletionKind::Snippet, label).snippet(snippet)\n+}\n \n pub(super) fn complete_expr_snippet(acc: &mut Completions, ctx: &CompletionContext) {\n     if !(ctx.is_trivial_path && ctx.enclosing_fn.is_some()) {\n         return;\n     }\n-    CompletionItem::new(Snippet, \"pd\")\n-        .snippet(\"eprintln!(\\\"$0 = {:?}\\\", $0);\")\n-        .add_to(acc);\n-    CompletionItem::new(Snippet, \"ppd\")\n-        .snippet(\"eprintln!(\\\"$0 = {:#?}\\\", $0);\")\n-        .add_to(acc);\n+    snippet(\"pd\", \"eprintln!(\\\"$0 = {:?}\\\", $0);\").add_to(acc);\n+    snippet(\"ppd\", \"eprintln!(\\\"$0 = {:#?}\\\", $0);\").add_to(acc);\n }\n \n pub(super) fn complete_item_snippet(acc: &mut Completions, ctx: &CompletionContext) {\n     if !ctx.is_new_item {\n         return;\n     }\n-    CompletionItem::new(Snippet, \"Test function\")\n-        .lookup_by(\"tfn\")\n-        .snippet(\n-            \"\\\n+    snippet(\n+        \"Test function\",\n+        \"\\\n #[test]\n fn ${1:feature}() {\n     $0\n }\",\n-        )\n-        .add_to(acc);\n-    CompletionItem::new(Snippet, \"pub(crate)\")\n-        .snippet(\"pub(crate) $0\")\n-        .add_to(acc);\n+    )\n+    .lookup_by(\"tfn\")\n+    .add_to(acc);\n+\n+    snippet(\"pub(crate)\", \"pub(crate) $0\").add_to(acc);\n }\n \n #[cfg(test)]"}]}