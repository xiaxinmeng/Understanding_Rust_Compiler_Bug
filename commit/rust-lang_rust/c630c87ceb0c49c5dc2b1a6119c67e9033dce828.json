{"sha": "c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "node_id": "C_kwDOAAsO6NoAKGM2MzBjODdjZWIwYzQ5YzVkYzJiMWE2MTE5YzY3ZTkwMzNkY2U4Mjg", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-08-29T23:46:56Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-09-07T02:43:15Z"}, "message": "Support doc-comments in `define_dep_nodes`", "tree": {"sha": "36bd534906df11e7d7dbebbcc3423f5d3f2dc753", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36bd534906df11e7d7dbebbcc3423f5d3f2dc753"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "html_url": "https://github.com/rust-lang/rust/commit/c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05886e28a4c3fbb7bc22d56bf5a52ba7cfa491d9", "url": "https://api.github.com/repos/rust-lang/rust/commits/05886e28a4c3fbb7bc22d56bf5a52ba7cfa491d9", "html_url": "https://github.com/rust-lang/rust/commit/05886e28a4c3fbb7bc22d56bf5a52ba7cfa491d9"}], "stats": {"total": 20, "additions": 12, "deletions": 8}, "files": [{"sha": "046a144913e00503196ced864e0d61b7407841b3", "filename": "compiler/rustc_macros/src/query.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fquery.rs?ref=c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "patch": "@@ -344,7 +344,6 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n                 #name,\n             });\n         }\n-        all_names.extend(quote! { #name, });\n \n         let mut attributes = Vec::new();\n \n@@ -394,13 +393,18 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n         // be very useful.\n         let span = name.span();\n         let attribute_stream = quote_spanned! {span=> #(#attributes),*};\n-        let doc_comments = query.doc_comments.iter();\n+        let doc_comments = &query.doc_comments;\n         // Add the query to the group\n         query_stream.extend(quote! {\n             #(#doc_comments)*\n             [#attribute_stream] fn #name(#arg) #result,\n         });\n \n+        all_names.extend(quote! {\n+            #(#doc_comments)*\n+            #name,\n+        });\n+\n         add_query_description_impl(&query, &mut query_description_stream);\n     }\n "}, {"sha": "21d174af4444e1ebd5d03e483917a7aed76f6bcf", "filename": "compiler/rustc_middle/src/dep_graph/dep_node.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs?ref=c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "patch": "@@ -144,7 +144,7 @@ impl DepKind {\n \n macro_rules! define_dep_nodes {\n     (\n-        $( $variant:ident, )*\n+        $( $( #[$attr:meta] )* $variant:ident, )+\n     ) => (\n         #[macro_export]\n         macro_rules! make_dep_kind_array {\n@@ -155,7 +155,7 @@ macro_rules! define_dep_nodes {\n         #[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, Encodable, Decodable)]\n         #[allow(non_camel_case_types)]\n         pub enum DepKind {\n-            $($variant),*\n+            $( $( #[$attr] )* $variant),*\n         }\n \n         fn dep_kind_from_label_string(label: &str) -> Result<DepKind, ()> {\n@@ -177,9 +177,9 @@ macro_rules! define_dep_nodes {\n }\n \n rustc_query_names!(define_dep_nodes![\n-    // We use this for most things when incr. comp. is turned off.\n+    /// We use this for most things when incr. comp. is turned off.\n     Null,\n-    // We use this to create a forever-red node.\n+    /// We use this to create a forever-red node.\n     Red,\n     TraitSelect,\n     CompileCodegenUnit,"}, {"sha": "a9bb4756dbccce458ec54d135f188b6d4fd01258", "filename": "compiler/rustc_query_impl/src/profiling_support.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c630c87ceb0c49c5dc2b1a6119c67e9033dce828/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs?ref=c630c87ceb0c49c5dc2b1a6119c67e9033dce828", "patch": "@@ -307,7 +307,7 @@ pub fn alloc_self_profile_query_strings(tcx: TyCtxt<'_>) {\n \n     macro_rules! alloc_once {\n         (\n-            $($name:ident,)*\n+            $( $( #[$attr:meta] )* $name:ident, )+\n         ) => {\n             $({\n                 alloc_self_profile_query_strings_for_query_cache(\n@@ -316,7 +316,7 @@ pub fn alloc_self_profile_query_strings(tcx: TyCtxt<'_>) {\n                     &tcx.query_caches.$name,\n                     &mut string_cache,\n                 );\n-            })*\n+            })+\n         }\n     }\n "}]}