{"sha": "9ab2227db11b27e43fbac1ebd81db61870cd439c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhYjIyMjdkYjExYjI3ZTQzZmJhYzFlYmQ4MWRiNjE4NzBjZDQzOWM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-12-18T22:08:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-12-18T22:08:30Z"}, "message": "Rollup merge of #46700 - GuillaumeGomez:more-relevant-doc-search, r=QuietMisdreavus\n\nmake doc search more relevant\n\nFixes #46595.\n\nr? @QuietMisdreavus\n\nIf possible, I'd appreciate a strong check on this PR. :3", "tree": {"sha": "f6d2d00d4d39187591649ccfc4b02bd4940aa02e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6d2d00d4d39187591649ccfc4b02bd4940aa02e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ab2227db11b27e43fbac1ebd81db61870cd439c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ab2227db11b27e43fbac1ebd81db61870cd439c", "html_url": "https://github.com/rust-lang/rust/commit/9ab2227db11b27e43fbac1ebd81db61870cd439c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ab2227db11b27e43fbac1ebd81db61870cd439c/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b058dc0107b734b0a1a664ca0209366bb59eb3e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/b058dc0107b734b0a1a664ca0209366bb59eb3e9", "html_url": "https://github.com/rust-lang/rust/commit/b058dc0107b734b0a1a664ca0209366bb59eb3e9"}, {"sha": "97c18f420e33b6468949cf42662b3fdac809f14e", "url": "https://api.github.com/repos/rust-lang/rust/commits/97c18f420e33b6468949cf42662b3fdac809f14e", "html_url": "https://github.com/rust-lang/rust/commit/97c18f420e33b6468949cf42662b3fdac809f14e"}], "stats": {"total": 23, "additions": 11, "deletions": 12}, "files": [{"sha": "1b9035367f7e246e894ec1d734a4759269701898", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 11, "deletions": 12, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9ab2227db11b27e43fbac1ebd81db61870cd439c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/9ab2227db11b27e43fbac1ebd81db61870cd439c/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=9ab2227db11b27e43fbac1ebd81db61870cd439c", "patch": "@@ -681,6 +681,9 @@\n             }\n \n             function checkPath(startsWith, lastElem, ty) {\n+                if (startsWith.length === 0) {\n+                    return 0;\n+                }\n                 var ret_lev = MAX_LEV_DISTANCE + 1;\n                 var path = ty.path.split(\"::\");\n \n@@ -706,18 +709,7 @@\n                         lev_total += lev;\n                     }\n                     if (aborted === false) {\n-                        var extra = MAX_LEV_DISTANCE + 1;\n-                        if (i + startsWith.length < path.length) {\n-                            extra = levenshtein(path[i + startsWith.length], lastElem);\n-                        }\n-                        if (extra > MAX_LEV_DISTANCE) {\n-                            extra = levenshtein(ty.name, lastElem);\n-                        }\n-                        if (extra < MAX_LEV_DISTANCE + 1) {\n-                            lev_total += extra;\n-                            ret_lev = Math.min(ret_lev,\n-                                               Math.round(lev_total / (startsWith.length + 1)));\n-                        }\n+                        ret_lev = Math.min(ret_lev, Math.round(lev_total / startsWith.length));\n                     }\n                 }\n                 return ret_lev;\n@@ -934,6 +926,13 @@\n                     }\n \n                     lev += lev_add;\n+                    if (lev > 0 && val.length > 3 && searchWords[j].startsWith(val)) {\n+                        if (val.length < 6) {\n+                            lev -= 1;\n+                        } else {\n+                            lev = 0;\n+                        }\n+                    }\n                     if (in_args <= MAX_LEV_DISTANCE) {\n                         if (results_in_args[fullId] === undefined) {\n                             results_in_args[fullId] = {"}]}