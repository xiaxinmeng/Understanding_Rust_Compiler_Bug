{"sha": "52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUyNDA1ZjdjMGNjM2U4Y2M1MjI5M2VhMTliNzhkYTg4ZWI3OWFmMmQ=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-03T18:32:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-03T18:32:26Z"}, "message": "Rollup merge of #77950 - arlosi:sha256, r=eddyb\n\nAdd support for SHA256 source file hashing\n\nAdds support for `-Z src-hash-algorithm sha256`, which became available in LLVM 11.\n\nUsing an older version of LLVM will cause an error `invalid checksum kind` if the hash algorithm is set to sha256.\n\nr? `@eddyb`\ncc #70401 `@est31`", "tree": {"sha": "9278e073fba56162eb4f1cfe06cf1763ddcc2e83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9278e073fba56162eb4f1cfe06cf1763ddcc2e83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfoaI7CRBK7hj4Ov3rIwAAdHIIAJMEoFyJsTxlApM19Va26QHw\ns86lp0xNLUg62o67BtVsCOES/KAQ5FJ9MgWvQBnwCU6wBC5S4ZNlGOXcK5mXcf+T\nd/0EVMNhQYWdgCbPJYgx5iysoE23+6MTpf9Nrlpep2ur9wB0I6u4HGcUWaFoFVb3\nqduGdyG+OtMaQPs9Go8wn3GdSFxcOiGKhGoxMgBRWL9hfzG3ETbfb0GjSTeUlE/R\ntb9Baad16k1IBjVq+aSudox1nZrP6h5uFkFzTlCXbiHIOz3PKBSid6b4HWgZTjJ+\nKR2sZDrZlmsSZIn7QZgafAFLKPoCX0hJ1deqWXQqXAy6M61scPYWO50CjG6UAm4=\n=I20s\n-----END PGP SIGNATURE-----\n", "payload": "tree 9278e073fba56162eb4f1cfe06cf1763ddcc2e83\nparent 0cd1516696550e108863bf4b4fb81ce5c4f58968\nparent 3296d5ca7b41154359eaec76d9f77310816c9913\nauthor Mara Bos <m-ou.se@m-ou.se> 1604428346 +0100\ncommitter GitHub <noreply@github.com> 1604428346 +0100\n\nRollup merge of #77950 - arlosi:sha256, r=eddyb\n\nAdd support for SHA256 source file hashing\n\nAdds support for `-Z src-hash-algorithm sha256`, which became available in LLVM 11.\n\nUsing an older version of LLVM will cause an error `invalid checksum kind` if the hash algorithm is set to sha256.\n\nr? `@eddyb`\ncc #70401 `@est31`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "html_url": "https://github.com/rust-lang/rust/commit/52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0cd1516696550e108863bf4b4fb81ce5c4f58968", "url": "https://api.github.com/repos/rust-lang/rust/commits/0cd1516696550e108863bf4b4fb81ce5c4f58968", "html_url": "https://github.com/rust-lang/rust/commit/0cd1516696550e108863bf4b4fb81ce5c4f58968"}, {"sha": "3296d5ca7b41154359eaec76d9f77310816c9913", "url": "https://api.github.com/repos/rust-lang/rust/commits/3296d5ca7b41154359eaec76d9f77310816c9913", "html_url": "https://github.com/rust-lang/rust/commit/3296d5ca7b41154359eaec76d9f77310816c9913"}], "stats": {"total": 69, "additions": 59, "deletions": 10}, "files": [{"sha": "3d40ded19dd5ae37853323577f0b7ba5c762b2da", "filename": "Cargo.lock", "status": "modified", "additions": 30, "deletions": 5, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -1928,6 +1928,17 @@ dependencies = [\n  \"opaque-debug 0.2.3\",\n ]\n \n+[[package]]\n+name = \"md-5\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"7b5a279bb9607f9f53c22d496eade00d138d1bdcccd07d74650387cf94942a15\"\n+dependencies = [\n+ \"block-buffer 0.9.0\",\n+ \"digest 0.9.0\",\n+ \"opaque-debug 0.3.0\",\n+]\n+\n [[package]]\n name = \"mdbook\"\n version = \"0.4.3\"\n@@ -2467,7 +2478,7 @@ checksum = \"54be6e404f5317079812fc8f9f5279de376d8856929e21c184ecf6bbd692a11d\"\n dependencies = [\n  \"maplit\",\n  \"pest\",\n- \"sha-1\",\n+ \"sha-1 0.8.2\",\n ]\n \n [[package]]\n@@ -3281,14 +3292,14 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"1c267f15c3cfc82a8a441d2bf86bcccf299d1eb625822468e3d8ee6f7c5a1c89\"\n dependencies = [\n  \"cfg-if 0.1.10\",\n- \"md-5\",\n+ \"md-5 0.8.0\",\n  \"rustc-ap-rustc_arena\",\n  \"rustc-ap-rustc_data_structures\",\n  \"rustc-ap-rustc_index\",\n  \"rustc-ap-rustc_macros\",\n  \"rustc-ap-rustc_serialize\",\n  \"scoped-tls\",\n- \"sha-1\",\n+ \"sha-1 0.8.2\",\n  \"tracing\",\n  \"unicode-width\",\n ]\n@@ -4138,14 +4149,15 @@ name = \"rustc_span\"\n version = \"0.0.0\"\n dependencies = [\n  \"cfg-if 0.1.10\",\n- \"md-5\",\n+ \"md-5 0.9.1\",\n  \"rustc_arena\",\n  \"rustc_data_structures\",\n  \"rustc_index\",\n  \"rustc_macros\",\n  \"rustc_serialize\",\n  \"scoped-tls\",\n- \"sha-1\",\n+ \"sha-1 0.9.1\",\n+ \"sha2\",\n  \"tracing\",\n  \"unicode-width\",\n ]\n@@ -4510,6 +4522,19 @@ dependencies = [\n  \"opaque-debug 0.2.3\",\n ]\n \n+[[package]]\n+name = \"sha-1\"\n+version = \"0.9.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"170a36ea86c864a3f16dd2687712dd6646f7019f301e57537c7f4dc9f5916770\"\n+dependencies = [\n+ \"block-buffer 0.9.0\",\n+ \"cfg-if 0.1.10\",\n+ \"cpuid-bool\",\n+ \"digest 0.9.0\",\n+ \"opaque-debug 0.3.0\",\n+]\n+\n [[package]]\n name = \"sha2\"\n version = \"0.9.1\""}, {"sha": "ef1ae807453f2a6b1315ecb1e37c390cbeab7ec9", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -801,6 +801,7 @@ fn file_metadata_raw(\n                     let kind = match hash.kind {\n                         rustc_span::SourceFileHashAlgorithm::Md5 => llvm::ChecksumKind::MD5,\n                         rustc_span::SourceFileHashAlgorithm::Sha1 => llvm::ChecksumKind::SHA1,\n+                        rustc_span::SourceFileHashAlgorithm::Sha256 => llvm::ChecksumKind::SHA256,\n                     };\n                     (kind, hex_encode(hash.hash_bytes()))\n                 }"}, {"sha": "8b15c8b0eb6075d02623ee5574d028d694d489cc", "filename": "compiler/rustc_codegen_llvm/src/llvm/ffi.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -558,6 +558,7 @@ pub enum ChecksumKind {\n     None,\n     MD5,\n     SHA1,\n+    SHA256,\n }\n \n extern \"C\" {"}, {"sha": "938eb19faef6b7f6617b0359e46fb2504e228b5e", "filename": "compiler/rustc_llvm/llvm-wrapper/RustWrapper.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FRustWrapper.cpp?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -648,6 +648,7 @@ enum class LLVMRustChecksumKind {\n   None,\n   MD5,\n   SHA1,\n+  SHA256,\n };\n \n static Optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n@@ -658,6 +659,10 @@ static Optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n     return DIFile::ChecksumKind::CSK_MD5;\n   case LLVMRustChecksumKind::SHA1:\n     return DIFile::ChecksumKind::CSK_SHA1;\n+#if (LLVM_VERSION_MAJOR >= 11)\n+  case LLVMRustChecksumKind::SHA256:\n+    return DIFile::ChecksumKind::CSK_SHA256;\n+#endif\n   default:\n     report_fatal_error(\"bad ChecksumKind.\");\n   }"}, {"sha": "4c00361dd31df3548e27371645d15aac6b16b361", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -1076,7 +1076,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n     span_free_formats: bool = (false, parse_bool, [UNTRACKED],\n         \"exclude spans when debug-printing compiler state (default: no)\"),\n     src_hash_algorithm: Option<SourceFileHashAlgorithm> = (None, parse_src_file_hash, [TRACKED],\n-        \"hash algorithm of source files in debug info (`md5`, or `sha1`)\"),\n+        \"hash algorithm of source files in debug info (`md5`, `sha1`, or `sha256`)\"),\n     strip: Strip = (Strip::None, parse_strip, [UNTRACKED],\n         \"tell the linker which information to strip (`none` (default), `debuginfo` or `symbols`)\"),\n     symbol_mangling_version: SymbolManglingVersion = (SymbolManglingVersion::Legacy,"}, {"sha": "08645990c4870dec32420bc50a17ce56905104d8", "filename": "compiler/rustc_span/Cargo.toml", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_span%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_span%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2FCargo.toml?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -17,5 +17,6 @@ scoped-tls = \"1.0\"\n unicode-width = \"0.1.4\"\n cfg-if = \"0.1.2\"\n tracing = \"0.1\"\n-sha-1 = \"0.8\"\n-md-5 = \"0.8\"\n+sha-1 = \"0.9\"\n+sha2 = \"0.9\"\n+md-5 = \"0.9\""}, {"sha": "97b5c11b0fefbb26afea2d6a1fdc1196fe297267", "filename": "compiler/rustc_span/src/lib.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_span%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/compiler%2Frustc_span%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Flib.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -59,6 +59,7 @@ use std::str::FromStr;\n use md5::Md5;\n use sha1::Digest;\n use sha1::Sha1;\n+use sha2::Sha256;\n \n use tracing::debug;\n \n@@ -1034,6 +1035,7 @@ pub struct OffsetOverflowError;\n pub enum SourceFileHashAlgorithm {\n     Md5,\n     Sha1,\n+    Sha256,\n }\n \n impl FromStr for SourceFileHashAlgorithm {\n@@ -1043,6 +1045,7 @@ impl FromStr for SourceFileHashAlgorithm {\n         match s {\n             \"md5\" => Ok(SourceFileHashAlgorithm::Md5),\n             \"sha1\" => Ok(SourceFileHashAlgorithm::Sha1),\n+            \"sha256\" => Ok(SourceFileHashAlgorithm::Sha256),\n             _ => Err(()),\n         }\n     }\n@@ -1055,7 +1058,7 @@ rustc_data_structures::impl_stable_hash_via_hash!(SourceFileHashAlgorithm);\n #[derive(HashStable_Generic, Encodable, Decodable)]\n pub struct SourceFileHash {\n     pub kind: SourceFileHashAlgorithm,\n-    value: [u8; 20],\n+    value: [u8; 32],\n }\n \n impl SourceFileHash {\n@@ -1071,6 +1074,9 @@ impl SourceFileHash {\n             SourceFileHashAlgorithm::Sha1 => {\n                 value.copy_from_slice(&Sha1::digest(data));\n             }\n+            SourceFileHashAlgorithm::Sha256 => {\n+                value.copy_from_slice(&Sha256::digest(data));\n+            }\n         }\n         hash\n     }\n@@ -1090,6 +1096,7 @@ impl SourceFileHash {\n         match self.kind {\n             SourceFileHashAlgorithm::Md5 => 16,\n             SourceFileHashAlgorithm::Sha1 => 20,\n+            SourceFileHashAlgorithm::Sha256 => 32,\n         }\n     }\n }"}, {"sha": "ff776741b2122a32d016ba0d93569f488330766d", "filename": "src/doc/unstable-book/src/compiler-flags/src-hash-algorithm.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -6,6 +6,6 @@ The tracking issue for this feature is: [#70401](https://github.com/rust-lang/ru\n \n The `-Z src-hash-algorithm` compiler flag controls which algorithm is used when hashing each source file. The hash is stored in the debug info and can be used by a debugger to verify the source code matches the executable.\n \n-Supported hash algorithms are: `md5`, and `sha1`. Note that not all hash algorithms are supported by all debug info formats.\n+Supported hash algorithms are: `md5`, `sha1`, and `sha256`. Note that not all hash algorithms are supported by all debug info formats.\n \n By default, the compiler chooses the hash algorithm based on the target specification."}, {"sha": "eaa9eafa1e87226c982959e649857ecc9a2a0c07", "filename": "src/test/codegen/src-hash-algorithm/src-hash-algorithm-sha256.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha256.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -0,0 +1,7 @@\n+// compile-flags: -g -Z src-hash-algorithm=sha256\n+// min-llvm-version: 11.0\n+\n+#![crate_type = \"lib\"]\n+\n+pub fn test() {}\n+// CHECK: checksumkind: CSK_SHA256"}, {"sha": "057b0884e287adb6bfc64360acc0a51314209dc8", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/52405f7c0cc3e8cc52293ea19b78da88eb79af2d/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=52405f7c0cc3e8cc52293ea19b78da88eb79af2d", "patch": "@@ -80,6 +80,7 @@ const PERMITTED_DEPENDENCIES: &[&str] = &[\n     \"cloudabi\",\n     \"cmake\",\n     \"compiler_builtins\",\n+    \"cpuid-bool\",\n     \"crc32fast\",\n     \"crossbeam-deque\",\n     \"crossbeam-epoch\",\n@@ -160,6 +161,7 @@ const PERMITTED_DEPENDENCIES: &[&str] = &[\n     \"serde\",\n     \"serde_derive\",\n     \"sha-1\",\n+    \"sha2\",\n     \"smallvec\",\n     \"snap\",\n     \"stable_deref_trait\","}]}