{"sha": "b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "node_id": "C_kwDOAAsO6NoAKGIwYTFhNDQ2OWFlM2JjYWIwMWM5OTkyMjhlMGMxZTNlOTUwNmI0M2M", "commit": {"author": {"name": "avitex", "email": "theavitex@gmail.com", "date": "2021-12-28T10:37:08Z"}, "committer": {"name": "avitex", "email": "theavitex@gmail.com", "date": "2021-12-28T10:37:08Z"}, "message": "Fix rustdoc::private_doc_tests lint for public re-exported items\n\nThis involves changing the lint to check the access level is exported,\nrather than public. The exported access level accounts for public items\nand items accessible to other crates with the help of `pub use`\nre-exports. The pattern of re-exporting public items from a private\nmodule is usage seen in a number of popular crates.", "tree": {"sha": "142d45b4188e980554e6cae4c3f8dc9317a7735e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/142d45b4188e980554e6cae4c3f8dc9317a7735e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEuK4cu/V7CPyRQls8OMdsvzdJ1iwFAmHK60EACgkQOMdsvzdJ\n1iy6oQ//b0PswefMyLx1InF8ZbD9vDM0dg8dZsRwAQaNM8XBv5+NJC3ArSRbXmMr\nldEIPUEjVE+d/4Y4y2bhWL+U1/rz8qo5zAhOnWdJO/0CwEOBsdu9gcv8ylvjd7I+\n1LUkEFVWmSZevAlNGQgM/5/gBW+hkHmX0PKeB8zbibGcnUzphh2tcKA9l7ESmfAP\n1pzAXQ6dFNRk2JHkgMfLjEvVRRj0T5WTpRN5YCdT0/ArthXvJOzwpIsbHAEb8kl4\nXDCEtYq8hC2y3HXWk3siSt76yPkI40OJVwhcgVMdI4wOH/+HlROTypjdM1FLDDpg\nE7Oiak4J1uT39aMyzthoHooLtzCd+HmYRpg4d++pn03Xv9ujg5PApVhswchLF2QV\nSDOmuytQuyxSTdCj8eqVvjY4rct0VzGQ1ACu7X6aibSDJPDkFl31z/iFWwJXgx84\nRetIQ9ogjcyqobIjtdZep2fU4NPvhTR8RxGLs3fEw1FeSDRJAopKhefxLvJgT6Nu\nfY4rg7buradgpLRJajSTl137aOvvrKcxsf6lGk9c/i+vpdOTa0hhMOPQ9BKMqko4\nqqEWHBTTtLW9bto58Uk2AFlI25+crd1e8WW4+RpN86e8SH9g7nKAV09G3GsAqdAN\n3uvxqyDf98aYF1nwUDQezBPOyw4WVdrrqLu7vnxQuLkV7+LXYW0=\n=ta8a\n-----END PGP SIGNATURE-----", "payload": "tree 142d45b4188e980554e6cae4c3f8dc9317a7735e\nparent cc65bf3ded93352fd4693a9c58b84a60721637a6\nauthor avitex <theavitex@gmail.com> 1640687828 +1100\ncommitter avitex <theavitex@gmail.com> 1640687828 +1100\n\nFix rustdoc::private_doc_tests lint for public re-exported items\n\nThis involves changing the lint to check the access level is exported,\nrather than public. The exported access level accounts for public items\nand items accessible to other crates with the help of `pub use`\nre-exports. The pattern of re-exporting public items from a private\nmodule is usage seen in a number of popular crates.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "html_url": "https://github.com/rust-lang/rust/commit/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c/comments", "author": {"login": "avitex", "id": 5110816, "node_id": "MDQ6VXNlcjUxMTA4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5110816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avitex", "html_url": "https://github.com/avitex", "followers_url": "https://api.github.com/users/avitex/followers", "following_url": "https://api.github.com/users/avitex/following{/other_user}", "gists_url": "https://api.github.com/users/avitex/gists{/gist_id}", "starred_url": "https://api.github.com/users/avitex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avitex/subscriptions", "organizations_url": "https://api.github.com/users/avitex/orgs", "repos_url": "https://api.github.com/users/avitex/repos", "events_url": "https://api.github.com/users/avitex/events{/privacy}", "received_events_url": "https://api.github.com/users/avitex/received_events", "type": "User", "site_admin": false}, "committer": {"login": "avitex", "id": 5110816, "node_id": "MDQ6VXNlcjUxMTA4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5110816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avitex", "html_url": "https://github.com/avitex", "followers_url": "https://api.github.com/users/avitex/followers", "following_url": "https://api.github.com/users/avitex/following{/other_user}", "gists_url": "https://api.github.com/users/avitex/gists{/gist_id}", "starred_url": "https://api.github.com/users/avitex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avitex/subscriptions", "organizations_url": "https://api.github.com/users/avitex/orgs", "repos_url": "https://api.github.com/users/avitex/repos", "events_url": "https://api.github.com/users/avitex/events{/privacy}", "received_events_url": "https://api.github.com/users/avitex/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc65bf3ded93352fd4693a9c58b84a60721637a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc65bf3ded93352fd4693a9c58b84a60721637a6", "html_url": "https://github.com/rust-lang/rust/commit/cc65bf3ded93352fd4693a9c58b84a60721637a6"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "e8f8ff988c1f0233b7db810c0e1f045491880092", "filename": "src/librustdoc/passes/check_doc_test_visibility.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs?ref=b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "patch": "@@ -131,7 +131,7 @@ crate fn look_for_tests<'tcx>(cx: &DocContext<'tcx>, dox: &str, item: &Item) {\n             );\n         }\n     } else if tests.found_tests > 0\n-        && !cx.cache.access_levels.is_public(item.def_id.expect_def_id())\n+        && !cx.cache.access_levels.is_exported(item.def_id.expect_def_id())\n     {\n         cx.tcx.struct_span_lint_hir(\n             crate::lint::PRIVATE_DOC_TESTS,"}, {"sha": "0398975f1374295abb11f4402fb43f30b108a620", "filename": "src/test/rustdoc-ui/public-reexported-item-doc-test.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c/src%2Ftest%2Frustdoc-ui%2Fpublic-reexported-item-doc-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0a1a4469ae3bcab01c999228e0c1e3e9506b43c/src%2Ftest%2Frustdoc-ui%2Fpublic-reexported-item-doc-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fpublic-reexported-item-doc-test.rs?ref=b0a1a4469ae3bcab01c999228e0c1e3e9506b43c", "patch": "@@ -0,0 +1,14 @@\n+// check-pass\n+\n+#![deny(rustdoc::private_doc_tests)]\n+\n+mod foo {\n+    /// re-exported doc test\n+    ///\n+    /// ```\n+    /// assert!(true);\n+    /// ```\n+    pub fn bar() {}\n+}\n+\n+pub use foo::bar;"}]}