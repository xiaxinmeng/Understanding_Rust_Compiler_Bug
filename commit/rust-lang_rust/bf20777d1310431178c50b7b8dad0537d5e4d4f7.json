{"sha": "bf20777d1310431178c50b7b8dad0537d5e4d4f7", "node_id": "C_kwDOAAsO6NoAKGJmMjA3NzdkMTMxMDQzMTE3OGM1MGI3YjhkYWQwNTM3ZDVlNGQ0Zjc", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-08-11T00:11:13Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-08-11T02:23:06Z"}, "message": "Add a test for `-Zhir-stats` output.\n\nThis will be very useful in subsequent commits where I will improve the\noutput.", "tree": {"sha": "713ca9312c9358a01c820fcd37c7e48c12d6acce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/713ca9312c9358a01c820fcd37c7e48c12d6acce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf20777d1310431178c50b7b8dad0537d5e4d4f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf20777d1310431178c50b7b8dad0537d5e4d4f7", "html_url": "https://github.com/rust-lang/rust/commit/bf20777d1310431178c50b7b8dad0537d5e4d4f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf20777d1310431178c50b7b8dad0537d5e4d4f7/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f03ce30962cf1b2a5158667eabae8bf6e8d1cb03", "url": "https://api.github.com/repos/rust-lang/rust/commits/f03ce30962cf1b2a5158667eabae8bf6e8d1cb03", "html_url": "https://github.com/rust-lang/rust/commit/f03ce30962cf1b2a5158667eabae8bf6e8d1cb03"}], "stats": {"total": 124, "additions": 124, "deletions": 0}, "files": [{"sha": "3c59ee22f24c5227bdd9757408e1861e57fef7e3", "filename": "src/test/ui/stats/hir-stats.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/bf20777d1310431178c50b7b8dad0537d5e4d4f7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf20777d1310431178c50b7b8dad0537d5e4d4f7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstats%2Fhir-stats.rs?ref=bf20777d1310431178c50b7b8dad0537d5e4d4f7", "patch": "@@ -0,0 +1,41 @@\n+// check-pass\n+// compile-flags: -Zhir-stats\n+// only-x86_64\n+\n+// The aim here is to include at least one of every different type of AST/HIR\n+// node reported by `-Zhir-stats`.\n+\n+#![allow(dead_code)]\n+\n+use std::arch::asm;\n+use std::fmt::Debug;\n+use std::ffi::c_void;\n+\n+extern \"C\" { fn f(p: *mut c_void); }\n+\n+/// An enum.\n+enum E<'a, T: Copy> { A { t: T }, B(&'a u32) }\n+\n+trait Go {\n+    type G: Debug;\n+    fn go(self) -> u32;\n+}\n+\n+impl<'a, T: Copy> Go for E<'a, T> {\n+    type G = bool;\n+    fn go(self) -> u32 {\n+        99\n+    }\n+}\n+\n+fn f2<T>(t: T) where T: Debug {}\n+\n+fn main() {\n+    let x = E::A { t: 3 };\n+    match x {\n+        E::A { .. } => {}\n+        _ => {}\n+    }\n+\n+    unsafe { asm!(\"mov rdi, 1\"); }\n+}"}, {"sha": "a0c1c80022f2b66c40de0a9d96aa0b634d846efd", "filename": "src/test/ui/stats/hir-stats.stderr", "status": "added", "additions": 83, "deletions": 0, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/bf20777d1310431178c50b7b8dad0537d5e4d4f7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bf20777d1310431178c50b7b8dad0537d5e4d4f7/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr?ref=bf20777d1310431178c50b7b8dad0537d5e4d4f7", "patch": "@@ -0,0 +1,83 @@\n+\n+PRE EXPANSION AST STATS\n+\n+Name                Accumulated Size         Count     Item Size\n+----------------------------------------------------------------\n+Lifetime                          32             2            16\n+MacCall                           64             1            64\n+Local                             72             1            72\n+Arm                               96             2            48\n+FieldDef                         160             2            80\n+ForeignItem                      160             1           160\n+Stmt                             160             5            32\n+FnDecl                           200             5            40\n+Variant                          240             2           120\n+Block                            288             6            48\n+Attribute                        304             2           152\n+ImplItem                         320             2           160\n+TraitItem                        320             2           160\n+GenericBound                     352             4            88\n+PathSegment                      720            30            24\n+Expr                             832             8           104\n+Pat                              840             7           120\n+Ty                             1_344            14            96\n+Item                           1_800             9           200\n+----------------------------------------------------------------\n+Total                          8_304\n+\n+\n+POST EXPANSION AST STATS\n+\n+Name                Accumulated Size         Count     Item Size\n+----------------------------------------------------------------\n+Lifetime                          32             2            16\n+Local                             72             1            72\n+Arm                               96             2            48\n+FieldDef                         160             2            80\n+ForeignItem                      160             1           160\n+Stmt                             160             5            32\n+FnDecl                           200             5            40\n+Variant                          240             2           120\n+Block                            288             6            48\n+ImplItem                         320             2           160\n+TraitItem                        320             2           160\n+GenericBound                     352             4            88\n+Attribute                        608             4           152\n+PathSegment                      792            33            24\n+Pat                              840             7           120\n+Expr                             936             9           104\n+Ty                             1_344            14            96\n+Item                           2_200            11           200\n+----------------------------------------------------------------\n+Total                          9_120\n+\n+\n+HIR STATS\n+\n+Name                Accumulated Size         Count     Item Size\n+----------------------------------------------------------------\n+Param                             64             2            32\n+Local                             64             1            64\n+ForeignItem                       72             1            72\n+FieldDef                          96             2            48\n+Arm                               96             2            48\n+Stmt                              96             3            32\n+FnDecl                           120             3            40\n+Lifetime                         128             4            32\n+Variant                          160             2            80\n+ImplItem                         176             2            88\n+GenericBound                     192             4            48\n+TraitItem                        192             2            96\n+WherePredicate                   216             3            72\n+Block                            288             6            48\n+QPath                            408            17            24\n+Pat                              440             5            88\n+Attribute                        608             4           152\n+Expr                             672            12            56\n+Item                             960            12            80\n+Ty                             1_152            16            72\n+Path                           1_296            27            48\n+PathSegment                    2_240            40            56\n+----------------------------------------------------------------\n+Total                          9_736\n+"}]}