{"sha": "e3be8e689da66e772a1fd5cbf749abb5280f89d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzYmU4ZTY4OWRhNjZlNzcyYTFmZDVjYmY3NDlhYmI1MjgwZjg5ZDI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-24T08:38:21Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-24T08:38:36Z"}, "message": "rustdoc: Some refactoring in attr_pass", "tree": {"sha": "fd665e958ee3e1325f8d3f67bd04003ed5fd355b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fd665e958ee3e1325f8d3f67bd04003ed5fd355b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3be8e689da66e772a1fd5cbf749abb5280f89d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3be8e689da66e772a1fd5cbf749abb5280f89d2", "html_url": "https://github.com/rust-lang/rust/commit/e3be8e689da66e772a1fd5cbf749abb5280f89d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3be8e689da66e772a1fd5cbf749abb5280f89d2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fbd704e77d35a0e1ccf2279b28f94aeee1b56213", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbd704e77d35a0e1ccf2279b28f94aeee1b56213", "html_url": "https://github.com/rust-lang/rust/commit/fbd704e77d35a0e1ccf2279b28f94aeee1b56213"}], "stats": {"total": 33, "additions": 15, "deletions": 18}, "files": [{"sha": "bc7eb8255065998ebe24e6105b1483e48f89c1c7", "filename": "src/rustdoc/attr_pass.rs", "status": "modified", "additions": 15, "deletions": 18, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/e3be8e689da66e772a1fd5cbf749abb5280f89d2/src%2Frustdoc%2Fattr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3be8e689da66e772a1fd5cbf749abb5280f89d2/src%2Frustdoc%2Fattr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_pass.rs?ref=e3be8e689da66e772a1fd5cbf749abb5280f89d2", "patch": "@@ -60,6 +60,18 @@ fn should_replace_top_module_name_with_crate_name() {\n     assert doc.topmod.name == \"bond\";\n }\n \n+fn parse_item_attrs<T>(\n+    srv: astsrv::srv,\n+    id: doc::ast_id,\n+    parse_attrs: fn~([ast::attribute]) -> T) -> T {\n+    astsrv::exec(srv) {|ctxt|\n+        let attrs = alt ctxt.map.get(id) {\n+          ast_map::node_item(item) { item.attrs }\n+        };\n+        parse_attrs(attrs)\n+    }\n+}\n+\n fn fold_mod(fold: fold::fold<astsrv::srv>, doc: doc::moddoc) -> doc::moddoc {\n     let srv = fold.ctxt;\n     let attrs = if doc.id == ast::crate_node_id {\n@@ -68,12 +80,7 @@ fn fold_mod(fold: fold::fold<astsrv::srv>, doc: doc::moddoc) -> doc::moddoc {\n             attr_parser::parse_mod(ctxt.ast.node.attrs)\n         }\n     } else {\n-        astsrv::exec(srv) {|ctxt|\n-            let attrs = alt ctxt.map.get(doc.id) {\n-              ast_map::node_item(item) { item.attrs }\n-            };\n-            attr_parser::parse_mod(attrs)\n-        }\n+        parse_item_attrs(srv, doc.id, attr_parser::parse_mod)\n     };\n     let doc = fold::default_seq_fold_mod(fold, doc);\n     ret merge_mod_attrs(doc, attrs);\n@@ -117,12 +124,7 @@ fn fold_fn(\n \n     let srv = fold.ctxt;\n \n-    let attrs = astsrv::exec(srv) {|ctxt|\n-        let attrs = alt ctxt.map.get(doc.id) {\n-          ast_map::node_item(item) { item.attrs }\n-        };\n-        attr_parser::parse_fn(attrs)\n-    };\n+    let attrs = parse_item_attrs(srv, doc.id, attr_parser::parse_fn);\n     ret merge_fn_attrs(doc, attrs);\n \n     fn merge_fn_attrs(\n@@ -216,12 +218,7 @@ fn fold_const(\n     doc: doc::constdoc\n ) -> doc::constdoc {\n     let srv = fold.ctxt;\n-    let attrs = astsrv::exec(srv) {|ctxt|\n-        let attrs = alt ctxt.map.get(doc.id) {\n-          ast_map::node_item(item) { item.attrs }\n-        };\n-        attr_parser::parse_mod(attrs)\n-    };\n+    let attrs = parse_item_attrs(srv, doc.id, attr_parser::parse_mod);\n \n     ~{\n         brief: attrs.brief,"}]}