{"sha": "1d0fe1b6bbf373190465f115777a2d98bb2741bd", "node_id": "C_kwDOAAsO6NoAKDFkMGZlMWI2YmJmMzczMTkwNDY1ZjExNTc3N2EyZDk4YmIyNzQxYmQ", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-04-25T14:22:55Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-04-25T14:22:55Z"}, "message": "Implement the output dropping for windows, too", "tree": {"sha": "3c3d58d097ed90b56b8532af7ff3eba2afa36246", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c3d58d097ed90b56b8532af7ff3eba2afa36246"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d0fe1b6bbf373190465f115777a2d98bb2741bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d0fe1b6bbf373190465f115777a2d98bb2741bd", "html_url": "https://github.com/rust-lang/rust/commit/1d0fe1b6bbf373190465f115777a2d98bb2741bd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d0fe1b6bbf373190465f115777a2d98bb2741bd/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d4855c7620696fa4e0e1d8171385b69912e02a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d4855c7620696fa4e0e1d8171385b69912e02a8", "html_url": "https://github.com/rust-lang/rust/commit/4d4855c7620696fa4e0e1d8171385b69912e02a8"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "6cce1a5db2524d4b9a32cef282e2a93debbd280b", "filename": "src/machine.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1d0fe1b6bbf373190465f115777a2d98bb2741bd/src%2Fmachine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d0fe1b6bbf373190465f115777a2d98bb2741bd/src%2Fmachine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmachine.rs?ref=1d0fe1b6bbf373190465f115777a2d98bb2741bd", "patch": "@@ -291,6 +291,9 @@ pub struct Evaluator<'mir, 'tcx> {\n \n     /// Failure rate of compare_exchange_weak, between 0.0 and 1.0\n     pub(crate) cmpxchg_weak_failure_rate: f64,\n+\n+    /// Corresponds to -Zmiri-drop-stdout-stderr and doesn't write the output but acts as if it succeeded.\n+    pub(crate) drop_stdout_stderr: bool,\n }\n \n impl<'mir, 'tcx> Evaluator<'mir, 'tcx> {\n@@ -344,6 +347,7 @@ impl<'mir, 'tcx> Evaluator<'mir, 'tcx> {\n             tracked_alloc_ids: config.tracked_alloc_ids.clone(),\n             check_alignment: config.check_alignment,\n             cmpxchg_weak_failure_rate: config.cmpxchg_weak_failure_rate,\n+            drop_stdout_stderr: config.drop_stdout_stderr,\n         }\n     }\n "}, {"sha": "05230531d917c719e930eba1a056eecd8d64c965", "filename": "src/shims/windows/dlsym.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1d0fe1b6bbf373190465f115777a2d98bb2741bd/src%2Fshims%2Fwindows%2Fdlsym.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d0fe1b6bbf373190465f115777a2d98bb2741bd/src%2Fshims%2Fwindows%2Fdlsym.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fwindows%2Fdlsym.rs?ref=1d0fe1b6bbf373190465f115777a2d98bb2741bd", "patch": "@@ -75,7 +75,9 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                     use std::io::{self, Write};\n \n                     let buf_cont = this.read_bytes_ptr(buf, Size::from_bytes(u64::from(n)))?;\n-                    let res = if handle == -11 {\n+                    let res = if this.machine.drop_stdout_stderr {\n+                        Ok(buf_cont.len())\n+                    } else if handle == -11 {\n                         io::stdout().write(buf_cont)\n                     } else {\n                         io::stderr().write(buf_cont)"}]}