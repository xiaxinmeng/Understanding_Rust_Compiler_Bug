{"sha": "fb7d25e97863e1a305bfeed6f418c5accc152123", "node_id": "C_kwDOAAsO6NoAKGZiN2QyNWU5Nzg2M2UxYTMwNWJmZWVkNmY0MThjNWFjY2MxNTIxMjM", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-11-05T22:41:07Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-11-23T19:33:06Z"}, "message": "Separate lifetime ident from resolution in HIR.", "tree": {"sha": "c16b4d87a42297c2a05095e12a75641c0e6e645d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c16b4d87a42297c2a05095e12a75641c0e6e645d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb7d25e97863e1a305bfeed6f418c5accc152123", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb7d25e97863e1a305bfeed6f418c5accc152123", "html_url": "https://github.com/rust-lang/rust/commit/fb7d25e97863e1a305bfeed6f418c5accc152123", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb7d25e97863e1a305bfeed6f418c5accc152123/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d121aa3b5584eb919a4aaf64dbae0ea1e8e30231", "url": "https://api.github.com/repos/rust-lang/rust/commits/d121aa3b5584eb919a4aaf64dbae0ea1e8e30231", "html_url": "https://github.com/rust-lang/rust/commit/d121aa3b5584eb919a4aaf64dbae0ea1e8e30231"}], "stats": {"total": 454, "additions": 179, "deletions": 275}, "files": [{"sha": "9def8536c824664fa4d3f00857848bfb74e7c002", "filename": "compiler/rustc_ast_lowering/src/index.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Findex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Findex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Findex.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -303,7 +303,7 @@ impl<'a, 'hir> Visitor<'hir> for NodeCollector<'a, 'hir> {\n     }\n \n     fn visit_lifetime(&mut self, lifetime: &'hir Lifetime) {\n-        self.insert(lifetime.span, lifetime.hir_id, Node::Lifetime(lifetime));\n+        self.insert(lifetime.ident.span, lifetime.hir_id, Node::Lifetime(lifetime));\n     }\n \n     fn visit_variant(&mut self, v: &'hir Variant<'hir>) {"}, {"sha": "8a7c3d357a0c2aacc8318db0bb5e1ac3eee5abf4", "filename": "compiler/rustc_ast_lowering/src/item.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fitem.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -1479,10 +1479,9 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 }))\n             }\n             GenericParamKind::Lifetime => {\n-                let ident_span = self.lower_span(ident.span);\n                 let ident = self.lower_ident(ident);\n                 let lt_id = self.next_node_id();\n-                let lifetime = self.new_named_lifetime(id, lt_id, ident_span, ident);\n+                let lifetime = self.new_named_lifetime(id, lt_id, ident);\n                 Some(hir::WherePredicate::RegionPredicate(hir::WhereRegionPredicate {\n                     lifetime,\n                     span,"}, {"sha": "322055ca2c33b7a0339d3133ae89055247930dbc", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 17, "deletions": 36, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -1255,7 +1255,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n                     } else {\n                         self.next_node_id()\n                     };\n-                    let span = self.tcx.sess.source_map().start_point(t.span);\n+                    let span = self.tcx.sess.source_map().start_point(t.span).shrink_to_hi();\n                     Lifetime { ident: Ident::new(kw::UnderscoreLifetime, span), id }\n                 });\n                 let lifetime = self.lower_lifetime(&region);\n@@ -1546,15 +1546,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         let lifetimes =\n             self.arena.alloc_from_iter(collected_lifetimes.into_iter().map(|(_, lifetime)| {\n                 let id = self.next_node_id();\n-                let span = lifetime.ident.span;\n-\n-                let ident = if lifetime.ident.name == kw::UnderscoreLifetime {\n-                    Ident::with_dummy_span(kw::UnderscoreLifetime)\n-                } else {\n-                    lifetime.ident\n-                };\n-\n-                let l = self.new_named_lifetime(lifetime.id, id, span, ident);\n+                let l = self.new_named_lifetime(lifetime.id, id, lifetime.ident);\n                 hir::GenericArg::Lifetime(l)\n             }));\n         debug!(?lifetimes);\n@@ -2014,18 +2006,10 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         let generic_args = self.arena.alloc_from_iter(collected_lifetimes.into_iter().map(\n             |(_, lifetime, res)| {\n                 let id = self.next_node_id();\n-                let span = lifetime.ident.span;\n-\n-                let ident = if lifetime.ident.name == kw::UnderscoreLifetime {\n-                    Ident::with_dummy_span(kw::UnderscoreLifetime)\n-                } else {\n-                    lifetime.ident\n-                };\n-\n                 let res = res.unwrap_or(\n                     self.resolver.get_lifetime_res(lifetime.id).unwrap_or(LifetimeRes::Error),\n                 );\n-                hir::GenericArg::Lifetime(self.new_named_lifetime_with_res(id, span, ident, res))\n+                hir::GenericArg::Lifetime(self.new_named_lifetime_with_res(id, lifetime.ident, res))\n             },\n         ));\n \n@@ -2095,43 +2079,41 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     }\n \n     fn lower_lifetime(&mut self, l: &Lifetime) -> &'hir hir::Lifetime {\n-        let span = self.lower_span(l.ident.span);\n         let ident = self.lower_ident(l.ident);\n-        self.new_named_lifetime(l.id, l.id, span, ident)\n+        self.new_named_lifetime(l.id, l.id, ident)\n     }\n \n     #[instrument(level = \"debug\", skip(self))]\n     fn new_named_lifetime_with_res(\n         &mut self,\n         id: NodeId,\n-        span: Span,\n         ident: Ident,\n         res: LifetimeRes,\n     ) -> &'hir hir::Lifetime {\n-        let name = match res {\n+        let res = match res {\n             LifetimeRes::Param { param, .. } => {\n-                let p_name = ParamName::Plain(ident);\n                 let param = self.get_remapped_def_id(param);\n-\n-                hir::LifetimeName::Param(param, p_name)\n+                hir::LifetimeName::Param(param)\n             }\n             LifetimeRes::Fresh { param, .. } => {\n                 debug_assert_eq!(ident.name, kw::UnderscoreLifetime);\n                 let param = self.local_def_id(param);\n-\n-                hir::LifetimeName::Param(param, ParamName::Fresh)\n+                hir::LifetimeName::Param(param)\n             }\n             LifetimeRes::Infer => hir::LifetimeName::Infer,\n             LifetimeRes::Static => hir::LifetimeName::Static,\n             LifetimeRes::Error => hir::LifetimeName::Error,\n-            res => panic!(\"Unexpected lifetime resolution {:?} for {:?} at {:?}\", res, ident, span),\n+            res => panic!(\n+                \"Unexpected lifetime resolution {:?} for {:?} at {:?}\",\n+                res, ident, ident.span\n+            ),\n         };\n \n-        debug!(?name);\n+        debug!(?res);\n         self.arena.alloc(hir::Lifetime {\n             hir_id: self.lower_node_id(id),\n-            span: self.lower_span(span),\n-            name,\n+            ident: self.lower_ident(ident),\n+            res,\n         })\n     }\n \n@@ -2140,11 +2122,10 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         &mut self,\n         id: NodeId,\n         new_id: NodeId,\n-        span: Span,\n         ident: Ident,\n     ) -> &'hir hir::Lifetime {\n         let res = self.resolver.get_lifetime_res(id).unwrap_or(LifetimeRes::Error);\n-        self.new_named_lifetime_with_res(new_id, span, ident, res)\n+        self.new_named_lifetime_with_res(new_id, ident, res)\n     }\n \n     fn lower_generic_params_mut<'s>(\n@@ -2556,8 +2537,8 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     fn elided_dyn_bound(&mut self, span: Span) -> &'hir hir::Lifetime {\n         let r = hir::Lifetime {\n             hir_id: self.next_id(),\n-            span: self.lower_span(span),\n-            name: hir::LifetimeName::ImplicitObjectLifetimeDefault,\n+            ident: Ident::new(kw::Empty, self.lower_span(span)),\n+            res: hir::LifetimeName::ImplicitObjectLifetimeDefault,\n         };\n         debug!(\"elided_dyn_bound: r={:?}\", r);\n         self.arena.alloc(r)"}, {"sha": "0790a2ede397f5fadc49bf104086e62e78b35dda", "filename": "compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -2509,7 +2509,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                             if let hir::TyKind::Rptr(lifetime, _) = &fn_decl.inputs[index].kind {\n                                 // With access to the lifetime, we can get\n                                 // the span of it.\n-                                arguments.push((*argument, lifetime.span));\n+                                arguments.push((*argument, lifetime.ident.span));\n                             } else {\n                                 bug!(\"ty type is a ref but hir type is not\");\n                             }\n@@ -2528,7 +2528,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                 let mut return_span = fn_decl.output.span();\n                 if let hir::FnRetTy::Return(ty) = &fn_decl.output {\n                     if let hir::TyKind::Rptr(lifetime, _) = ty.kind {\n-                        return_span = lifetime.span;\n+                        return_span = lifetime.ident.span;\n                     }\n                 }\n "}, {"sha": "5d212b6c977ccd62df778279d2ce2a19d3f2b7a6", "filename": "compiler/rustc_borrowck/src/diagnostics/mutability_errors.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fmutability_errors.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -1211,7 +1211,7 @@ fn get_mut_span_in_struct_field<'tcx>(\n         && let hir::Node::Field(field) = node\n         && let hir::TyKind::Rptr(lt, hir::MutTy { mutbl: hir::Mutability::Not, ty }) = field.ty.kind\n     {\n-        return Some(lt.span.between(ty.span));\n+        return Some(lt.ident.span.between(ty.span));\n     }\n \n     None"}, {"sha": "d8d31fae35e86db982cd747d18ed03630036ce33", "filename": "compiler/rustc_borrowck/src/diagnostics/region_name.rs", "status": "modified", "additions": 4, "deletions": 24, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fregion_name.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -576,30 +576,10 @@ impl<'tcx> MirBorrowckCtxt<'_, 'tcx> {\n         let args = last_segment.args.as_ref()?;\n         let lifetime =\n             self.try_match_adt_and_generic_args(substs, needle_fr, args, search_stack)?;\n-        match lifetime.name {\n-            hir::LifetimeName::Param(_, hir::ParamName::Plain(_) | hir::ParamName::Error)\n-            | hir::LifetimeName::Error\n-            | hir::LifetimeName::Static => {\n-                let lifetime_span = lifetime.span;\n-                Some(RegionNameHighlight::MatchedAdtAndSegment(lifetime_span))\n-            }\n-\n-            hir::LifetimeName::Param(_, hir::ParamName::Fresh)\n-            | hir::LifetimeName::ImplicitObjectLifetimeDefault\n-            | hir::LifetimeName::Infer => {\n-                // In this case, the user left off the lifetime; so\n-                // they wrote something like:\n-                //\n-                // ```\n-                // x: Foo<T>\n-                // ```\n-                //\n-                // where the fully elaborated form is `Foo<'_, '1,\n-                // T>`. We don't consider this a match; instead we let\n-                // the \"fully elaborated\" type fallback above handle\n-                // it.\n-                None\n-            }\n+        if lifetime.is_anonymous() {\n+            None\n+        } else {\n+            Some(RegionNameHighlight::MatchedAdtAndSegment(lifetime.ident.span))\n         }\n     }\n "}, {"sha": "6cba23c35cbee5644cd9f8d9b1594b4bb6402e19", "filename": "compiler/rustc_hir/src/hir.rs", "status": "modified", "additions": 28, "deletions": 46, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Fhir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fhir.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -29,15 +29,15 @@ use std::fmt;\n #[derive(Debug, Copy, Clone, Encodable, HashStable_Generic)]\n pub struct Lifetime {\n     pub hir_id: HirId,\n-    pub span: Span,\n+    pub ident: Ident,\n \n     /// Either \"`'a`\", referring to a named lifetime definition,\n     /// or \"``\" (i.e., `kw::Empty`), for elision placeholders.\n     ///\n     /// HIR lowering inserts these placeholders in type paths that\n     /// refer to type definitions needing lifetime parameters,\n     /// `&T` and `&mut T`, and trait objects without `... + 'a`.\n-    pub name: LifetimeName,\n+    pub res: LifetimeName,\n }\n \n #[derive(Debug, Clone, PartialEq, Eq, Encodable, Hash, Copy)]\n@@ -88,7 +88,7 @@ impl ParamName {\n #[derive(HashStable_Generic)]\n pub enum LifetimeName {\n     /// User-given names or fresh (synthetic) names.\n-    Param(LocalDefId, ParamName),\n+    Param(LocalDefId),\n \n     /// Implicit lifetime in a context like `dyn Foo`. This is\n     /// distinguished from implicit lifetimes elsewhere because the\n@@ -116,25 +116,6 @@ pub enum LifetimeName {\n }\n \n impl LifetimeName {\n-    pub fn ident(&self) -> Ident {\n-        match *self {\n-            LifetimeName::ImplicitObjectLifetimeDefault | LifetimeName::Error => Ident::empty(),\n-            LifetimeName::Infer => Ident::with_dummy_span(kw::UnderscoreLifetime),\n-            LifetimeName::Static => Ident::with_dummy_span(kw::StaticLifetime),\n-            LifetimeName::Param(_, param_name) => param_name.ident(),\n-        }\n-    }\n-\n-    pub fn is_anonymous(&self) -> bool {\n-        match *self {\n-            LifetimeName::ImplicitObjectLifetimeDefault\n-            | LifetimeName::Infer\n-            | LifetimeName::Param(_, ParamName::Fresh)\n-            | LifetimeName::Error => true,\n-            LifetimeName::Static | LifetimeName::Param(..) => false,\n-        }\n-    }\n-\n     pub fn is_elided(&self) -> bool {\n         match self {\n             LifetimeName::ImplicitObjectLifetimeDefault | LifetimeName::Infer => true,\n@@ -146,34 +127,25 @@ impl LifetimeName {\n             LifetimeName::Error | LifetimeName::Param(..) | LifetimeName::Static => false,\n         }\n     }\n-\n-    fn is_static(&self) -> bool {\n-        self == &LifetimeName::Static\n-    }\n-\n-    pub fn normalize_to_macros_2_0(&self) -> LifetimeName {\n-        match *self {\n-            LifetimeName::Param(def_id, param_name) => {\n-                LifetimeName::Param(def_id, param_name.normalize_to_macros_2_0())\n-            }\n-            lifetime_name => lifetime_name,\n-        }\n-    }\n }\n \n impl fmt::Display for Lifetime {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        self.name.ident().fmt(f)\n+        self.ident.fmt(f)\n     }\n }\n \n impl Lifetime {\n     pub fn is_elided(&self) -> bool {\n-        self.name.is_elided()\n+        self.res.is_elided()\n+    }\n+\n+    pub fn is_anonymous(&self) -> bool {\n+        self.ident.name == kw::Empty || self.ident.name == kw::UnderscoreLifetime\n     }\n \n     pub fn is_static(&self) -> bool {\n-        self.name.is_static()\n+        self.res == LifetimeName::Static\n     }\n }\n \n@@ -267,7 +239,7 @@ pub enum GenericArg<'hir> {\n impl GenericArg<'_> {\n     pub fn span(&self) -> Span {\n         match self {\n-            GenericArg::Lifetime(l) => l.span,\n+            GenericArg::Lifetime(l) => l.ident.span,\n             GenericArg::Type(t) => t.span,\n             GenericArg::Const(c) => c.span,\n             GenericArg::Infer(i) => i.span,\n@@ -284,7 +256,7 @@ impl GenericArg<'_> {\n     }\n \n     pub fn is_synthetic(&self) -> bool {\n-        matches!(self, GenericArg::Lifetime(lifetime) if lifetime.name.ident() == Ident::empty())\n+        matches!(self, GenericArg::Lifetime(lifetime) if lifetime.ident == Ident::empty())\n     }\n \n     pub fn descr(&self) -> &'static str {\n@@ -446,7 +418,7 @@ impl GenericBound<'_> {\n         match self {\n             GenericBound::Trait(t, ..) => t.span,\n             GenericBound::LangItemTrait(_, span, ..) => *span,\n-            GenericBound::Outlives(l) => l.span,\n+            GenericBound::Outlives(l) => l.ident.span,\n         }\n     }\n }\n@@ -559,6 +531,19 @@ impl<'hir> Generics<'hir> {\n         }\n     }\n \n+    /// If there are generic parameters, return where to introduce a new one.\n+    pub fn span_for_lifetime_suggestion(&self) -> Option<Span> {\n+        if let Some(first) = self.params.first()\n+            && self.span.contains(first.span)\n+        {\n+            // `fn foo<A>(t: impl Trait)`\n+            //         ^ suggest `'a, ` here\n+            Some(first.span.shrink_to_lo())\n+        } else {\n+            None\n+        }\n+    }\n+\n     /// If there are generic parameters, return where to introduce a new one.\n     pub fn span_for_param_suggestion(&self) -> Option<Span> {\n         if self.params.iter().any(|p| self.span.contains(p.span)) {\n@@ -765,10 +750,7 @@ pub struct WhereRegionPredicate<'hir> {\n impl<'hir> WhereRegionPredicate<'hir> {\n     /// Returns `true` if `param_def_id` matches the `lifetime` of this predicate.\n     pub fn is_param_bound(&self, param_def_id: LocalDefId) -> bool {\n-        match self.lifetime.name {\n-            LifetimeName::Param(id, _) => id == param_def_id,\n-            _ => false,\n-        }\n+        self.lifetime.res == LifetimeName::Param(param_def_id)\n     }\n }\n \n@@ -3453,7 +3435,7 @@ impl<'hir> Node<'hir> {\n             | Node::Variant(Variant { ident, .. })\n             | Node::Item(Item { ident, .. })\n             | Node::PathSegment(PathSegment { ident, .. }) => Some(*ident),\n-            Node::Lifetime(lt) => Some(lt.name.ident()),\n+            Node::Lifetime(lt) => Some(lt.ident),\n             Node::GenericParam(p) => Some(p.name.ident()),\n             Node::TypeBinding(b) => Some(b.ident),\n             Node::Param(..)"}, {"sha": "957f8c1058e9869a63561a8c0b776f50ac42facb", "filename": "compiler/rustc_hir/src/intravisit.rs", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Fintravisit.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -1109,17 +1109,7 @@ pub fn walk_generic_arg<'v, V: Visitor<'v>>(visitor: &mut V, generic_arg: &'v Ge\n \n pub fn walk_lifetime<'v, V: Visitor<'v>>(visitor: &mut V, lifetime: &'v Lifetime) {\n     visitor.visit_id(lifetime.hir_id);\n-    match lifetime.name {\n-        LifetimeName::Param(_, ParamName::Plain(ident)) => {\n-            visitor.visit_ident(ident);\n-        }\n-        LifetimeName::Param(_, ParamName::Fresh)\n-        | LifetimeName::Param(_, ParamName::Error)\n-        | LifetimeName::Static\n-        | LifetimeName::Error\n-        | LifetimeName::ImplicitObjectLifetimeDefault\n-        | LifetimeName::Infer => {}\n-    }\n+    visitor.visit_ident(lifetime.ident);\n }\n \n pub fn walk_qpath<'v, V: Visitor<'v>>(visitor: &mut V, qpath: &'v QPath<'v>, id: HirId) {"}, {"sha": "98d967cc0b86e1446b3b1b469b580273c565a78f", "filename": "compiler/rustc_hir/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir%2Fsrc%2Flib.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -5,6 +5,7 @@\n #![feature(associated_type_defaults)]\n #![feature(closure_track_caller)]\n #![feature(const_btree_len)]\n+#![feature(let_chains)]\n #![feature(min_specialization)]\n #![feature(never_type)]\n #![feature(rustc_attrs)]"}, {"sha": "1bd71e309d472b1e7327d8edbe351fb26b9ccfcb", "filename": "compiler/rustc_hir_analysis/src/astconv/mod.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fmod.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -241,14 +241,14 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             }\n \n             None => {\n-                self.re_infer(def, lifetime.span).unwrap_or_else(|| {\n+                self.re_infer(def, lifetime.ident.span).unwrap_or_else(|| {\n                     debug!(?lifetime, \"unelided lifetime in signature\");\n \n                     // This indicates an illegal lifetime\n                     // elision. `resolve_lifetime` should have\n                     // reported an error in this case -- but if\n                     // not, let's error out.\n-                    tcx.sess.delay_span_bug(lifetime.span, \"unelided lifetime in signature\");\n+                    tcx.sess.delay_span_bug(lifetime.ident.span, \"unelided lifetime in signature\");\n \n                     // Supply some dummy value. We don't have an\n                     // `re_error`, annoyingly, so use `'static`.\n@@ -961,9 +961,10 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n                 }\n                 hir::GenericBound::Outlives(lifetime) => {\n                     let region = self.ast_region_to_region(lifetime, None);\n-                    bounds\n-                        .region_bounds\n-                        .push((ty::Binder::bind_with_vars(region, bound_vars), lifetime.span));\n+                    bounds.region_bounds.push((\n+                        ty::Binder::bind_with_vars(region, bound_vars),\n+                        lifetime.ident.span,\n+                    ));\n                 }\n             }\n         }"}, {"sha": "639f81f20bfb9d2389ee19f73ae3cf2043e5087b", "filename": "compiler/rustc_hir_analysis/src/collect/generics_of.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fgenerics_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fgenerics_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fgenerics_of.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -398,7 +398,7 @@ fn has_late_bound_regions<'tcx>(tcx: TyCtxt<'tcx>, node: Node<'tcx>) -> Option<S\n                 Some(rl::Region::Static | rl::Region::EarlyBound(..)) => {}\n                 Some(rl::Region::LateBound(debruijn, _, _)) if debruijn < self.outer_index => {}\n                 Some(rl::Region::LateBound(..) | rl::Region::Free(..)) | None => {\n-                    self.has_late_bound_regions = Some(lt.span);\n+                    self.has_late_bound_regions = Some(lt.ident.span);\n                 }\n             }\n         }"}, {"sha": "892bd237e26f2cf0c0312571571efa1a7077266f", "filename": "compiler/rustc_hir_analysis/src/collect/lifetimes.rs", "status": "modified", "additions": 51, "deletions": 48, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Flifetimes.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -19,7 +19,7 @@ use rustc_middle::hir::nested_filter;\n use rustc_middle::middle::resolve_lifetime::*;\n use rustc_middle::ty::{self, DefIdTree, TyCtxt, TypeSuperVisitable, TypeVisitor};\n use rustc_span::def_id::DefId;\n-use rustc_span::symbol::{sym, Ident};\n+use rustc_span::symbol::{kw, sym, Ident};\n use rustc_span::Span;\n use std::fmt;\n \n@@ -595,7 +595,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                         this.visit_poly_trait_ref(bound);\n                     }\n                 });\n-                match lifetime.name {\n+                match lifetime.res {\n                     LifetimeName::ImplicitObjectLifetimeDefault => {\n                         // If the user does not write *anything*, we\n                         // use the object lifetime defaulting\n@@ -686,7 +686,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     if !parent_id.is_owner() {\n                         struct_span_err!(\n                             self.tcx.sess,\n-                            lifetime.span,\n+                            lifetime.ident.span,\n                             E0657,\n                             \"`impl Trait` can only capture lifetimes bound at the fn or impl level\"\n                         )\n@@ -698,7 +698,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     }) = self.tcx.hir().get(parent_id)\n                     {\n                         let mut err = self.tcx.sess.struct_span_err(\n-                            lifetime.span,\n+                            lifetime.ident.span,\n                             \"higher kinded lifetime bounds on nested opaque types are not supported yet\",\n                         );\n                         err.span_note(self.tcx.def_span(def_id), \"lifetime declared here\");\n@@ -802,9 +802,9 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n \n     #[instrument(level = \"debug\", skip(self))]\n     fn visit_lifetime(&mut self, lifetime_ref: &'tcx hir::Lifetime) {\n-        match lifetime_ref.name {\n+        match lifetime_ref.res {\n             hir::LifetimeName::Static => self.insert_lifetime(lifetime_ref, Region::Static),\n-            hir::LifetimeName::Param(param_def_id, _) => {\n+            hir::LifetimeName::Param(param_def_id) => {\n                 self.resolve_lifetime_ref(param_def_id, lifetime_ref)\n             }\n             // If we've already reported an error, just ignore `lifetime_ref`.\n@@ -912,27 +912,27 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                         this.visit_lifetime(lifetime);\n                         walk_list!(this, visit_param_bound, bounds);\n \n-                        if lifetime.name != hir::LifetimeName::Static {\n+                        if lifetime.res != hir::LifetimeName::Static {\n                             for bound in bounds {\n                                 let hir::GenericBound::Outlives(ref lt) = bound else {\n                                     continue;\n                                 };\n-                                if lt.name != hir::LifetimeName::Static {\n+                                if lt.res != hir::LifetimeName::Static {\n                                     continue;\n                                 }\n                                 this.insert_lifetime(lt, Region::Static);\n                                 this.tcx\n                                     .sess\n                                     .struct_span_warn(\n-                                        lifetime.span,\n+                                        lifetime.ident.span,\n                                         &format!(\n                                             \"unnecessary lifetime parameter `{}`\",\n-                                            lifetime.name.ident(),\n+                                            lifetime.ident,\n                                         ),\n                                     )\n                                     .help(&format!(\n                                         \"you can use the `'static` lifetime directly, in place of `{}`\",\n-                                        lifetime.name.ident(),\n+                                        lifetime.ident,\n                                     ))\n                                     .emit();\n                             }\n@@ -1043,15 +1043,15 @@ fn object_lifetime_default<'tcx>(tcx: TyCtxt<'tcx>, param_def_id: DefId) -> Obje\n \n                 for bound in bound.bounds {\n                     if let hir::GenericBound::Outlives(ref lifetime) = *bound {\n-                        set.insert(lifetime.name.normalize_to_macros_2_0());\n+                        set.insert(lifetime.res);\n                     }\n                 }\n             }\n \n             match set {\n                 Set1::Empty => ObjectLifetimeDefault::Empty,\n                 Set1::One(hir::LifetimeName::Static) => ObjectLifetimeDefault::Static,\n-                Set1::One(hir::LifetimeName::Param(param_def_id, _)) => {\n+                Set1::One(hir::LifetimeName::Param(param_def_id)) => {\n                     ObjectLifetimeDefault::Param(param_def_id.to_def_id())\n                 }\n                 _ => ObjectLifetimeDefault::Ambiguous,\n@@ -1195,42 +1195,48 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n                     // Fresh lifetimes in APIT used to be allowed in async fns and forbidden in\n                     // regular fns.\n                     if let Some(hir::PredicateOrigin::ImplTrait) = where_bound_origin\n-                        && let hir::LifetimeName::Param(_, hir::ParamName::Fresh) = lifetime_ref.name\n+                        && let hir::LifetimeName::Param(_) = lifetime_ref.res\n+                        && lifetime_ref.is_anonymous()\n                         && let hir::IsAsync::NotAsync = self.tcx.asyncness(lifetime_ref.hir_id.owner.def_id)\n                         && !self.tcx.features().anonymous_lifetime_in_impl_trait\n                     {\n                         let mut diag =  rustc_session::parse::feature_err(\n                             &self.tcx.sess.parse_sess,\n                             sym::anonymous_lifetime_in_impl_trait,\n-                            lifetime_ref.span,\n+                            lifetime_ref.ident.span,\n                             \"anonymous lifetimes in `impl Trait` are unstable\",\n                         );\n \n-                        match self.tcx.hir().get_generics(lifetime_ref.hir_id.owner.def_id) {\n-                            Some(generics) => {\n-\n-                                let new_param_sugg_tuple;\n-\n-                                new_param_sugg_tuple = match generics.span_for_param_suggestion() {\n-                                    Some(_) => {\n-                                        Some((self.tcx.sess.source_map().span_through_char(generics.span, '<').shrink_to_hi(), \"'a, \".to_owned()))\n-                                    },\n-                                    None => Some((generics.span, \"<'a>\".to_owned()))\n-                                };\n-\n-                                let mut multi_sugg_vec = vec![(lifetime_ref.span.shrink_to_hi(), \"'a \".to_owned())];\n-\n-                                if let Some(new_tuple) =  new_param_sugg_tuple{\n-                                    multi_sugg_vec.push(new_tuple);\n-                                }\n-\n-                                diag.span_label(lifetime_ref.span, \"expected named lifetime parameter\");\n-                                diag.multipart_suggestion(\"consider introducing a named lifetime parameter\",\n-                                multi_sugg_vec,\n-                                rustc_errors::Applicability::MaybeIncorrect);\n-\n-                            },\n-                            None => { }\n+                        if let Some(generics) =\n+                            self.tcx.hir().get_generics(lifetime_ref.hir_id.owner.def_id)\n+                        {\n+                            let new_param_sugg = if let Some(span) =\n+                                generics.span_for_lifetime_suggestion()\n+                            {\n+                                (span, \"'a, \".to_owned())\n+                            } else {\n+                                (generics.span, \"<'a>\".to_owned())\n+                            };\n+\n+                            let lifetime_sugg = match lifetime_ref.ident.name {\n+                                kw::Empty => \"'a, \".to_owned(),\n+                                kw::UnderscoreLifetime => \"'a \".to_owned(),\n+                                _ => \"'a \".to_owned(),\n+                            };\n+                            let suggestions = vec![\n+                                (lifetime_ref.ident.span.shrink_to_hi(), lifetime_sugg),\n+                                new_param_sugg,\n+                            ];\n+\n+                            diag.span_label(\n+                                lifetime_ref.ident.span,\n+                                \"expected named lifetime parameter\",\n+                            );\n+                            diag.multipart_suggestion(\n+                                \"consider introducing a named lifetime parameter\",\n+                                suggestions,\n+                                rustc_errors::Applicability::MaybeIncorrect,\n+                            );\n                         }\n \n                         diag.emit();\n@@ -1287,7 +1293,7 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n                     where_bound_origin: Some(hir::PredicateOrigin::ImplTrait), ..\n                 } => {\n                     let mut err = self.tcx.sess.struct_span_err(\n-                        lifetime_ref.span,\n+                        lifetime_ref.ident.span,\n                         \"`impl Trait` can only mention lifetimes bound at the fn or impl level\",\n                     );\n                     err.span_note(self.tcx.def_span(region_def_id), \"lifetime declared here\");\n@@ -1307,7 +1313,7 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n         }\n \n         self.tcx.sess.delay_span_bug(\n-            lifetime_ref.span,\n+            lifetime_ref.ident.span,\n             &format!(\"Could not resolve {:?} in scope {:#?}\", lifetime_ref, self.scope,),\n         );\n     }\n@@ -1625,10 +1631,7 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n \n     #[instrument(level = \"debug\", skip(self))]\n     fn insert_lifetime(&mut self, lifetime_ref: &'tcx hir::Lifetime, def: Region) {\n-        debug!(\n-            node = ?self.tcx.hir().node_to_string(lifetime_ref.hir_id),\n-            span = ?self.tcx.sess.source_map().span_to_diagnostic_string(lifetime_ref.span)\n-        );\n+        debug!(span = ?lifetime_ref.ident.span);\n         self.map.defs.insert(lifetime_ref.hir_id, def);\n     }\n \n@@ -1839,7 +1842,7 @@ fn is_late_bound_map(tcx: TyCtxt<'_>, def_id: LocalDefId) -> Option<&FxIndexSet<\n         }\n \n         fn visit_lifetime(&mut self, lifetime_ref: &'v hir::Lifetime) {\n-            if let hir::LifetimeName::Param(def_id, _) = lifetime_ref.name {\n+            if let hir::LifetimeName::Param(def_id) = lifetime_ref.res {\n                 self.regions.insert(def_id);\n             }\n         }\n@@ -1852,7 +1855,7 @@ fn is_late_bound_map(tcx: TyCtxt<'_>, def_id: LocalDefId) -> Option<&FxIndexSet<\n \n     impl<'v> Visitor<'v> for AllCollector {\n         fn visit_lifetime(&mut self, lifetime_ref: &'v hir::Lifetime) {\n-            if let hir::LifetimeName::Param(def_id, _) = lifetime_ref.name {\n+            if let hir::LifetimeName::Param(def_id) = lifetime_ref.res {\n                 self.regions.insert(def_id);\n             }\n         }"}, {"sha": "c6fdf71f4add4ab61ffff01aa00e62b014590d78", "filename": "compiler/rustc_hir_analysis/src/collect/predicates_of.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fpredicates_of.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fpredicates_of.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect%2Fpredicates_of.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -229,7 +229,7 @@ fn gather_explicit_predicates_of(tcx: TyCtxt<'_>, def_id: DefId) -> ty::GenericP\n                 predicates.extend(region_pred.bounds.iter().map(|bound| {\n                     let (r2, span) = match bound {\n                         hir::GenericBound::Outlives(lt) => {\n-                            (<dyn AstConv<'_>>::ast_region_to_region(&icx, lt, None), lt.span)\n+                            (<dyn AstConv<'_>>::ast_region_to_region(&icx, lt, None), lt.ident.span)\n                         }\n                         _ => bug!(),\n                     };"}, {"sha": "d923dc20b36c513977c7ff526cadc3855eb0ca86", "filename": "compiler/rustc_hir_pretty/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_pretty%2Fsrc%2Flib.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -2159,7 +2159,7 @@ impl<'a> State<'a> {\n     }\n \n     pub fn print_lifetime(&mut self, lifetime: &hir::Lifetime) {\n-        self.print_ident(lifetime.name.ident())\n+        self.print_ident(lifetime.ident)\n     }\n \n     pub fn print_where_clause(&mut self, generics: &hir::Generics<'_>) {"}, {"sha": "74c4c65cc1729a981db0c42c44e4c57d355cf6cd", "filename": "compiler/rustc_infer/src/errors/mod.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_infer%2Fsrc%2Ferrors%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_infer%2Fsrc%2Ferrors%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Ferrors%2Fmod.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -375,7 +375,7 @@ impl AddToDiagnostic for AddLifetimeParamsSuggestion<'_> {\n                 return false;\n             };\n \n-            if !lifetime_sub.name.is_anonymous() || !lifetime_sup.name.is_anonymous() {\n+            if !lifetime_sub.is_anonymous() || !lifetime_sup.is_anonymous() {\n                 return false;\n             };\n \n@@ -407,20 +407,20 @@ impl AddToDiagnostic for AddLifetimeParamsSuggestion<'_> {\n             let suggestion_param_name =\n                 suggestion_param_name.map(|n| n.to_string()).unwrap_or_else(|| \"'a\".to_owned());\n \n-            debug!(?lifetime_sup.span);\n-            debug!(?lifetime_sub.span);\n-            let make_suggestion = |span: rustc_span::Span| {\n-                if span.is_empty() {\n-                    (span, format!(\"{}, \", suggestion_param_name))\n-                } else if let Ok(\"&\") = self.tcx.sess.source_map().span_to_snippet(span).as_deref()\n-                {\n-                    (span.shrink_to_hi(), format!(\"{} \", suggestion_param_name))\n+            debug!(?lifetime_sup.ident.span);\n+            debug!(?lifetime_sub.ident.span);\n+            let make_suggestion = |ident: Ident| {\n+                let sugg = if ident.name == kw::Empty {\n+                    format!(\"{}, \", suggestion_param_name)\n+                } else if ident.name == kw::UnderscoreLifetime && ident.span.is_empty() {\n+                    format!(\"{} \", suggestion_param_name)\n                 } else {\n-                    (span, suggestion_param_name.clone())\n-                }\n+                    suggestion_param_name.clone()\n+                };\n+                (ident.span, sugg)\n             };\n             let mut suggestions =\n-                vec![make_suggestion(lifetime_sub.span), make_suggestion(lifetime_sup.span)];\n+                vec![make_suggestion(lifetime_sub.ident), make_suggestion(lifetime_sup.ident)];\n \n             if introduce_new {\n                 let new_param_suggestion = if let Some(first) ="}, {"sha": "09f9aa3c84220981537e7c5734dd90c0a4dbb5a8", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/static_impl_trait.rs", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -314,10 +314,10 @@ pub fn suggest_new_region_bound(\n                     .iter()\n                     .filter_map(|arg| match arg {\n                         GenericBound::Outlives(Lifetime {\n-                            name: LifetimeName::Static,\n-                            span,\n+                            res: LifetimeName::Static,\n+                            ident,\n                             ..\n-                        }) => Some(*span),\n+                        }) => Some(ident.span),\n                         _ => None,\n                     })\n                     .next()\n@@ -342,10 +342,10 @@ pub fn suggest_new_region_bound(\n                     .bounds\n                     .iter()\n                     .filter_map(|arg| match arg {\n-                        GenericBound::Outlives(Lifetime { name, span, .. })\n-                            if name.ident().to_string() == lifetime_name =>\n+                        GenericBound::Outlives(Lifetime { ident, .. })\n+                            if ident.name.to_string() == lifetime_name =>\n                         {\n-                            Some(*span)\n+                            Some(ident.span)\n                         }\n                         _ => None,\n                     })\n@@ -361,8 +361,8 @@ pub fn suggest_new_region_bound(\n                     );\n                 }\n             }\n-            TyKind::TraitObject(_, lt, _) => match lt.name {\n-                LifetimeName::ImplicitObjectLifetimeDefault => {\n+            TyKind::TraitObject(_, lt, _) => {\n+                if let LifetimeName::ImplicitObjectLifetimeDefault = lt.res {\n                     err.span_suggestion_verbose(\n                         fn_return.span.shrink_to_hi(),\n                         &format!(\n@@ -374,15 +374,14 @@ pub fn suggest_new_region_bound(\n                         &plus_lt,\n                         Applicability::MaybeIncorrect,\n                     );\n-                }\n-                name if name.ident().to_string() != lifetime_name => {\n+                } else if lt.ident.name.to_string() != lifetime_name {\n                     // With this check we avoid suggesting redundant bounds. This\n                     // would happen if there are nested impl/dyn traits and only\n                     // one of them has the bound we'd suggest already there, like\n                     // in `impl Foo<X = dyn Bar> + '_`.\n                     if let Some(explicit_static) = &explicit_static {\n                         err.span_suggestion_verbose(\n-                            lt.span,\n+                            lt.ident.span,\n                             &format!(\"{} the trait object's {}\", consider, explicit_static),\n                             &lifetime_name,\n                             Applicability::MaybeIncorrect,\n@@ -397,8 +396,7 @@ pub fn suggest_new_region_bound(\n                         );\n                     }\n                 }\n-                _ => {}\n-            },\n+            }\n             _ => {}\n         }\n     }\n@@ -561,7 +559,7 @@ impl<'a, 'tcx> Visitor<'tcx> for HirTraitObjectVisitor<'a> {\n     fn visit_ty(&mut self, t: &'tcx hir::Ty<'tcx>) {\n         if let TyKind::TraitObject(\n             poly_trait_refs,\n-            Lifetime { name: LifetimeName::ImplicitObjectLifetimeDefault, .. },\n+            Lifetime { res: LifetimeName::ImplicitObjectLifetimeDefault, .. },\n             _,\n         ) = t.kind\n         {"}, {"sha": "293f1c5c471a2c9cd6e3920eefb2b2f1407f3246", "filename": "compiler/rustc_lint/src/internal.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_lint%2Fsrc%2Finternal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Finternal.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -272,11 +272,7 @@ fn gen_args(segment: &PathSegment<'_>) -> String {\n             .args\n             .iter()\n             .filter_map(|arg| {\n-                if let GenericArg::Lifetime(lt) = arg {\n-                    Some(lt.name.ident().to_string())\n-                } else {\n-                    None\n-                }\n+                if let GenericArg::Lifetime(lt) = arg { Some(lt.ident.to_string()) } else { None }\n             })\n             .collect::<Vec<_>>();\n "}, {"sha": "ac0cfa64d420078a09bf06cf36cfb74c65497b1b", "filename": "compiler/rustc_lint/src/pass_by_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -78,7 +78,7 @@ fn gen_args(cx: &LateContext<'_>, segment: &PathSegment<'_>) -> String {\n             .args\n             .iter()\n             .map(|arg| match arg {\n-                GenericArg::Lifetime(lt) => lt.name.ident().to_string(),\n+                GenericArg::Lifetime(lt) => lt.ident.to_string(),\n                 GenericArg::Type(ty) => {\n                     cx.tcx.sess.source_map().span_to_snippet(ty.span).unwrap_or_else(|_| \"_\".into())\n                 }"}, {"sha": "4617c17b1537ea67ee32d99430b1f3f5335e7db3", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -1058,7 +1058,7 @@ impl<'hir> Map<'hir> {\n             Node::Arm(arm) => arm.span,\n             Node::Block(block) => block.span,\n             Node::Ctor(..) => self.span_with_body(self.get_parent_node(hir_id)),\n-            Node::Lifetime(lifetime) => lifetime.span,\n+            Node::Lifetime(lifetime) => lifetime.ident.span,\n             Node::GenericParam(param) => param.span,\n             Node::Infer(i) => i.span,\n             Node::Local(local) => local.span,"}, {"sha": "b087ff4bf53c4d23aaa5b11d76980bd9ebdd368f", "filename": "compiler/rustc_middle/src/ty/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_middle%2Fsrc%2Fty%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_middle%2Fsrc%2Fty%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fdiagnostics.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -397,7 +397,7 @@ impl<'v> hir::intravisit::Visitor<'v> for TraitObjectVisitor<'v> {\n             hir::TyKind::TraitObject(\n                 _,\n                 hir::Lifetime {\n-                    name:\n+                    res:\n                         hir::LifetimeName::ImplicitObjectLifetimeDefault | hir::LifetimeName::Static,\n                     ..\n                 },\n@@ -421,10 +421,9 @@ pub struct StaticLifetimeVisitor<'tcx>(pub Vec<Span>, pub crate::hir::map::Map<'\n \n impl<'v> hir::intravisit::Visitor<'v> for StaticLifetimeVisitor<'v> {\n     fn visit_lifetime(&mut self, lt: &'v hir::Lifetime) {\n-        if let hir::LifetimeName::ImplicitObjectLifetimeDefault | hir::LifetimeName::Static =\n-            lt.name\n+        if let hir::LifetimeName::ImplicitObjectLifetimeDefault | hir::LifetimeName::Static = lt.res\n         {\n-            self.0.push(lt.span);\n+            self.0.push(lt.ident.span);\n         }\n     }\n }"}, {"sha": "d90ef61602f2ad699208145b425b32688dbf6a66", "filename": "compiler/rustc_save_analysis/src/sig.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_save_analysis%2Fsrc%2Fsig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/compiler%2Frustc_save_analysis%2Fsrc%2Fsig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_save_analysis%2Fsrc%2Fsig.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -167,7 +167,7 @@ impl<'hir> Sig for hir::Ty<'hir> {\n             }\n             hir::TyKind::Rptr(ref lifetime, ref mt) => {\n                 let mut prefix = \"&\".to_owned();\n-                prefix.push_str(&lifetime.name.ident().to_string());\n+                prefix.push_str(&lifetime.ident.to_string());\n                 prefix.push(' ');\n                 if let hir::Mutability::Mut = mt.mutbl {\n                     prefix.push_str(\"mut \");"}, {"sha": "25ee4463f0daa7348331433c5bca0d55c6d45526", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -208,7 +208,7 @@ fn clean_lifetime<'tcx>(lifetime: &hir::Lifetime, cx: &mut DocContext<'tcx>) ->\n             return lt;\n         }\n     }\n-    Lifetime(lifetime.name.ident().name)\n+    Lifetime(lifetime.ident.name)\n }\n \n pub(crate) fn clean_const<'tcx>(constant: &hir::ConstArg, cx: &mut DocContext<'tcx>) -> Constant {\n@@ -1524,16 +1524,7 @@ pub(crate) fn clean_ty<'tcx>(ty: &hir::Ty<'tcx>, cx: &mut DocContext<'tcx>) -> T\n         TyKind::Never => Primitive(PrimitiveType::Never),\n         TyKind::Ptr(ref m) => RawPointer(m.mutbl, Box::new(clean_ty(m.ty, cx))),\n         TyKind::Rptr(ref l, ref m) => {\n-            // There are two times a `Fresh` lifetime can be created:\n-            // 1. For `&'_ x`, written by the user. This corresponds to `lower_lifetime` in `rustc_ast_lowering`.\n-            // 2. For `&x` as a parameter to an `async fn`. This corresponds to `elided_ref_lifetime in `rustc_ast_lowering`.\n-            //    See #59286 for more information.\n-            // Ideally we would only hide the `'_` for case 2., but I don't know a way to distinguish it.\n-            // Turning `fn f(&'_ self)` into `fn f(&self)` isn't the worst thing in the world, though;\n-            // there's no case where it could cause the function to fail to compile.\n-            let elided =\n-                l.is_elided() || matches!(l.name, LifetimeName::Param(_, ParamName::Fresh));\n-            let lifetime = if elided { None } else { Some(clean_lifetime(*l, cx)) };\n+            let lifetime = if l.is_anonymous() { None } else { Some(clean_lifetime(*l, cx)) };\n             BorrowedRef { lifetime, mutability: m.mutbl, type_: Box::new(clean_ty(m.ty, cx)) }\n         }\n         TyKind::Slice(ty) => Slice(Box::new(clean_ty(ty, cx))),"}, {"sha": "2a0e9497a21faf91093b0a016a7d327c206ad1ab", "filename": "src/test/ui/stats/hir-stats.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstats%2Fhir-stats.stderr?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -119,7 +119,7 @@ hir-stats HIR STATS\n hir-stats Name                Accumulated Size         Count     Item Size\n hir-stats ----------------------------------------------------------------\n hir-stats ForeignItemRef            24 ( 0.3%)             1            24\n-hir-stats Lifetime                  32 ( 0.3%)             1            32\n+hir-stats Lifetime                  24 ( 0.3%)             1            24\n hir-stats Mod                       32 ( 0.3%)             1            32\n hir-stats ExprField                 40 ( 0.4%)             1            40\n hir-stats TraitItemRef              56 ( 0.6%)             2            28\n@@ -152,7 +152,7 @@ hir-stats - Struct                    72 ( 0.8%)             1\n hir-stats - Binding                  216 ( 2.4%)             3\n hir-stats GenericParam             400 ( 4.4%)             5            80\n hir-stats Generics                 560 ( 6.1%)            10            56\n-hir-stats Ty                       720 ( 7.8%)            15            48\n+hir-stats Ty                       720 ( 7.9%)            15            48\n hir-stats - Ptr                       48 ( 0.5%)             1\n hir-stats - Rptr                      48 ( 0.5%)             1\n hir-stats - Path                     624 ( 6.8%)            13\n@@ -171,8 +171,8 @@ hir-stats - ForeignMod                80 ( 0.9%)             1\n hir-stats - Impl                      80 ( 0.9%)             1\n hir-stats - Fn                       160 ( 1.7%)             2\n hir-stats - Use                      400 ( 4.4%)             5\n-hir-stats Path                   1_280 (13.9%)            32            40\n+hir-stats Path                   1_280 (14.0%)            32            40\n hir-stats PathSegment            1_920 (20.9%)            40            48\n hir-stats ----------------------------------------------------------------\n-hir-stats Total                  9_176\n+hir-stats Total                  9_168\n hir-stats"}, {"sha": "5df8b486f33277f19f7e9267c8eb63a319c262e9", "filename": "src/tools/clippy/clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 10, "deletions": 16, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -10,7 +10,7 @@ use rustc_hir::lang_items;\n use rustc_hir::FnRetTy::Return;\n use rustc_hir::{\n     BareFnTy, BodyId, FnDecl, GenericArg, GenericBound, GenericParam, GenericParamKind, Generics, Impl, ImplItem,\n-    ImplItemKind, Item, ItemKind, Lifetime, LifetimeName, ParamName, PolyTraitRef, PredicateOrigin, TraitFn, TraitItem,\n+    ImplItemKind, Item, ItemKind, Lifetime, LifetimeName, PolyTraitRef, PredicateOrigin, TraitFn, TraitItem,\n     TraitItemKind, Ty, TyKind, WherePredicate,\n };\n use rustc_lint::{LateContext, LateLintPass};\n@@ -180,7 +180,7 @@ fn check_fn_inner<'tcx>(\n                             _ => None,\n                         });\n                         for bound in lifetimes {\n-                            if bound.name != LifetimeName::Static && !bound.is_elided() {\n+                            if !bound.is_static() && !bound.is_elided() {\n                                 return;\n                             }\n                         }\n@@ -414,17 +414,13 @@ impl<'a, 'tcx> RefVisitor<'a, 'tcx> {\n \n     fn record(&mut self, lifetime: &Option<Lifetime>) {\n         if let Some(ref lt) = *lifetime {\n-            if lt.name == LifetimeName::Static {\n+            if lt.is_static() {\n                 self.lts.push(RefLt::Static);\n-            } else if let LifetimeName::Param(_, ParamName::Fresh) = lt.name {\n+            } else if lt.is_anonymous() {\n                 // Fresh lifetimes generated should be ignored.\n                 self.lts.push(RefLt::Unnamed);\n-            } else if lt.is_elided() {\n-                self.lts.push(RefLt::Unnamed);\n-            } else if let LifetimeName::Param(def_id, _) = lt.name {\n+            } else if let LifetimeName::Param(def_id) = lt.res {\n                 self.lts.push(RefLt::Named(def_id));\n-            } else {\n-                self.lts.push(RefLt::Unnamed);\n             }\n         } else {\n             self.lts.push(RefLt::Unnamed);\n@@ -472,7 +468,7 @@ impl<'a, 'tcx> Visitor<'tcx> for RefVisitor<'a, 'tcx> {\n                 walk_item(self, item);\n                 self.lts.truncate(len);\n                 self.lts.extend(bounds.iter().filter_map(|bound| match bound {\n-                    GenericArg::Lifetime(l) => Some(if let LifetimeName::Param(def_id, _) = l.name {\n+                    GenericArg::Lifetime(l) => Some(if let LifetimeName::Param(def_id) = l.res {\n                         RefLt::Named(def_id)\n                     } else {\n                         RefLt::Unnamed\n@@ -498,10 +494,8 @@ impl<'a, 'tcx> Visitor<'tcx> for RefVisitor<'a, 'tcx> {\n     }\n \n     fn visit_generic_arg(&mut self, generic_arg: &'tcx GenericArg<'tcx>) {\n-        if let GenericArg::Lifetime(l) = generic_arg\n-            && let LifetimeName::Param(def_id, _) = l.name\n-        {\n-            self.lifetime_generic_arg_spans.entry(def_id).or_insert(l.span);\n+        if let GenericArg::Lifetime(l) = generic_arg && let LifetimeName::Param(def_id) = l.res {\n+            self.lifetime_generic_arg_spans.entry(def_id).or_insert(l.ident.span);\n         }\n         // Replace with `walk_generic_arg` if/when https://github.com/rust-lang/rust/pull/103692 lands.\n         // walk_generic_arg(self, generic_arg);\n@@ -577,7 +571,7 @@ where\n \n     // for lifetimes as parameters of generics\n     fn visit_lifetime(&mut self, lifetime: &'tcx Lifetime) {\n-        self.map.remove(&lifetime.name.ident().name);\n+        self.map.remove(&lifetime.ident.name);\n     }\n \n     fn visit_generic_param(&mut self, param: &'tcx GenericParam<'_>) {\n@@ -653,7 +647,7 @@ struct BodyLifetimeChecker {\n impl<'tcx> Visitor<'tcx> for BodyLifetimeChecker {\n     // for lifetimes as parameters of generics\n     fn visit_lifetime(&mut self, lifetime: &'tcx Lifetime) {\n-        if lifetime.name.ident().name != kw::UnderscoreLifetime && lifetime.name.ident().name != kw::StaticLifetime {\n+        if lifetime.ident.name != kw::UnderscoreLifetime && lifetime.ident.name != kw::StaticLifetime {\n             self.lifetimes_used_in_body = true;\n         }\n     }"}, {"sha": "553980ebf79702bbad11bfacf3c73af5724a5e23", "filename": "src/tools/clippy/clippy_lints/src/manual_async_fn.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_async_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_async_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmanual_async_fn.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -118,7 +118,7 @@ fn future_trait_ref<'tcx>(\n                 .iter()\n                 .filter_map(|bound| {\n                     if let GenericArg::Lifetime(lt) = bound {\n-                        Some(lt.name)\n+                        Some(lt.res)\n                     } else {\n                         None\n                     }\n@@ -153,7 +153,7 @@ fn captures_all_lifetimes(inputs: &[Ty<'_>], output_lifetimes: &[LifetimeName])\n         .iter()\n         .filter_map(|ty| {\n             if let TyKind::Rptr(lt, _) = ty.kind {\n-                Some(lt.name)\n+                Some(lt.res)\n             } else {\n                 None\n             }"}, {"sha": "ab960edb75765e9be802110e73665f88c3c1d021", "filename": "src/tools/clippy/clippy_lints/src/ptr.rs", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fptr.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -12,8 +12,8 @@ use rustc_hir::hir_id::HirIdMap;\n use rustc_hir::intravisit::{walk_expr, Visitor};\n use rustc_hir::{\n     self as hir, AnonConst, BinOpKind, BindingAnnotation, Body, Expr, ExprKind, FnRetTy, FnSig, GenericArg,\n-    ImplItemKind, ItemKind, Lifetime, LifetimeName, Mutability, Node, Param, ParamName, PatKind, QPath, TraitFn,\n-    TraitItem, TraitItemKind, TyKind, Unsafety,\n+    ImplItemKind, ItemKind, Lifetime, Mutability, Node, Param, PatKind, QPath, TraitFn, TraitItem, TraitItemKind,\n+    TyKind, Unsafety,\n };\n use rustc_infer::infer::TyCtxtInferExt;\n use rustc_infer::traits::{Obligation, ObligationCause};\n@@ -343,21 +343,16 @@ impl PtrArg<'_> {\n }\n \n struct RefPrefix {\n-    lt: LifetimeName,\n+    lt: Lifetime,\n     mutability: Mutability,\n }\n impl fmt::Display for RefPrefix {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n         use fmt::Write;\n         f.write_char('&')?;\n-        match self.lt {\n-            LifetimeName::Param(_, ParamName::Plain(name)) => {\n-                name.fmt(f)?;\n-                f.write_char(' ')?;\n-            },\n-            LifetimeName::Infer => f.write_str(\"'_ \")?,\n-            LifetimeName::Static => f.write_str(\"'static \")?,\n-            _ => (),\n+        if !self.lt.is_anonymous() {\n+            self.lt.ident.fmt(f)?;\n+            f.write_char(' ')?;\n         }\n         f.write_str(self.mutability.prefix_str())\n     }\n@@ -495,7 +490,7 @@ fn check_fn_args<'cx, 'tcx: 'cx>(\n                         ty_name: name.ident.name,\n                         method_renames,\n                         ref_prefix: RefPrefix {\n-                            lt: lt.name,\n+                            lt: lt.clone(),\n                             mutability,\n                         },\n                         deref_ty,"}, {"sha": "65dfe7637ea99e0c5b05b5dbaeadcba6cad73c76", "filename": "src/tools/clippy/clippy_lints/src/types/borrowed_box.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes%2Fborrowed_box.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes%2Fborrowed_box.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes%2Fborrowed_box.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -31,10 +31,10 @@ pub(super) fn check(cx: &LateContext<'_>, hir_ty: &hir::Ty<'_>, lt: &Lifetime, m\n                         return false;\n                     }\n \n-                    let ltopt = if lt.name.is_anonymous() {\n+                    let ltopt = if lt.is_anonymous() {\n                         String::new()\n                     } else {\n-                        format!(\"{} \", lt.name.ident().as_str())\n+                        format!(\"{} \", lt.ident.as_str())\n                     };\n \n                     if mut_ty.mutbl == Mutability::Mut {"}, {"sha": "48982517751ecba5b2447224ad1ac4efb40749d8", "filename": "src/tools/clippy/clippy_utils/src/hir_utils.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fhir_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7d25e97863e1a305bfeed6f418c5accc152123/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fhir_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_utils%2Fsrc%2Fhir_utils.rs?ref=fb7d25e97863e1a305bfeed6f418c5accc152123", "patch": "@@ -7,7 +7,7 @@ use rustc_hir::def::Res;\n use rustc_hir::HirIdMap;\n use rustc_hir::{\n     ArrayLen, BinOpKind, BindingAnnotation, Block, BodyId, Closure, Expr, ExprField, ExprKind, FnRetTy, GenericArg,\n-    GenericArgs, Guard, HirId, InlineAsmOperand, Let, Lifetime, LifetimeName, ParamName, Pat, PatField, PatKind, Path,\n+    GenericArgs, Guard, HirId, InlineAsmOperand, Let, Lifetime, LifetimeName, Pat, PatField, PatKind, Path,\n     PathSegment, PrimTy, QPath, Stmt, StmtKind, Ty, TyKind, TypeBinding,\n };\n use rustc_lexer::{tokenize, TokenKind};\n@@ -337,7 +337,7 @@ impl HirEqInterExpr<'_, '_, '_> {\n     }\n \n     fn eq_lifetime(left: &Lifetime, right: &Lifetime) -> bool {\n-        left.name == right.name\n+        left.res == right.res\n     }\n \n     fn eq_pat_field(&mut self, left: &PatField<'_>, right: &PatField<'_>) -> bool {\n@@ -925,16 +925,10 @@ impl<'a, 'tcx> SpanlessHash<'a, 'tcx> {\n     }\n \n     pub fn hash_lifetime(&mut self, lifetime: &Lifetime) {\n-        std::mem::discriminant(&lifetime.name).hash(&mut self.s);\n-        if let LifetimeName::Param(param_id, ref name) = lifetime.name {\n-            std::mem::discriminant(name).hash(&mut self.s);\n+        lifetime.ident.name.hash(&mut self.s);\n+        std::mem::discriminant(&lifetime.res).hash(&mut self.s);\n+        if let LifetimeName::Param(param_id) = lifetime.res {\n             param_id.hash(&mut self.s);\n-            match name {\n-                ParamName::Plain(ref ident) => {\n-                    ident.name.hash(&mut self.s);\n-                },\n-                ParamName::Fresh | ParamName::Error => {},\n-            }\n         }\n     }\n "}]}