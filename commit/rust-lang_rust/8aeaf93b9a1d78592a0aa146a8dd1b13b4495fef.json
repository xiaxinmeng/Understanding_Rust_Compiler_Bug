{"sha": "8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhZWFmOTNiOWExZDc4NTkyYTBhYTE0NmE4ZGQxYjEzYjQ0OTVmZWY=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-12-24T21:10:44Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-12-26T15:23:40Z"}, "message": "Make enum variant fields public", "tree": {"sha": "dd28340ad3ce1884a09ac494c2393695a0b6491e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd28340ad3ce1884a09ac494c2393695a0b6491e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef", "html_url": "https://github.com/rust-lang/rust/commit/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e9c4be48a2efdc1e209dbb531cabb9e81840516", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e9c4be48a2efdc1e209dbb531cabb9e81840516", "html_url": "https://github.com/rust-lang/rust/commit/9e9c4be48a2efdc1e209dbb531cabb9e81840516"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "158d4393dba703da420cacb1bcc3790f20c4e974", "filename": "crates/ra_hir_def/src/visibility.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef/crates%2Fra_hir_def%2Fsrc%2Fvisibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef/crates%2Fra_hir_def%2Fsrc%2Fvisibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fvisibility.rs?ref=8aeaf93b9a1d78592a0aa146a8dd1b13b4495fef", "patch": "@@ -38,12 +38,19 @@ impl Visibility {\n             }\n             VisibilityDefId::StructFieldId(it) => {\n                 let src = it.parent.child_source(db);\n-                // TODO: enum variant fields should be public by default\n+                let is_enum = match it.parent {\n+                    crate::VariantId::EnumVariantId(_) => true,\n+                    _ => false,\n+                };\n                 let vis_node = src.map(|m| match &m[it.local_id] {\n                     Either::Left(tuple) => tuple.visibility(),\n                     Either::Right(record) => record.visibility(),\n                 });\n-                Visibility::from_ast(db, vis_node)\n+                if vis_node.value.is_none() && is_enum {\n+                    Visibility::Public\n+                } else {\n+                    Visibility::from_ast(db, vis_node)\n+                }\n             }\n             VisibilityDefId::AdtId(it) => match it {\n                 AdtId::StructId(it) => visibility_from_loc(it.lookup(db), db),"}]}