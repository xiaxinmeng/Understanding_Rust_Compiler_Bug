{"sha": "325808a33d5bde39c88f4ed3b70e0706b38a3cef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyNTgwOGEzM2Q1YmRlMzljODhmNGVkM2I3MGUwNzA2YjM4YTNjZWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-08T20:51:14Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-09-08T20:51:14Z"}, "message": "auto merge of #16952 : alexcrichton/rust/windows-large-console-write, r=brson\n\nI've found that 64k is still too much and continue to see the errors as reported\r\nin #14940. I've locally found that 32k fails, and 24k succeeds, so I've trimmed\r\nthe size down to 10000 which the included links in the added comment end up\r\nrecommending.\r\n\r\nIt sounds like the limit can still be hit with many threads in play, but I have\r\nyet to reproduce this, so I figure we can wait until that's hit (if it's\r\npossible) and then take action.", "tree": {"sha": "4445a2256791866690300a6ed9180f85627218ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4445a2256791866690300a6ed9180f85627218ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/325808a33d5bde39c88f4ed3b70e0706b38a3cef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/325808a33d5bde39c88f4ed3b70e0706b38a3cef", "html_url": "https://github.com/rust-lang/rust/commit/325808a33d5bde39c88f4ed3b70e0706b38a3cef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/325808a33d5bde39c88f4ed3b70e0706b38a3cef/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c73e5fc5f212d30bb46b96cb45b51251217a199", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c73e5fc5f212d30bb46b96cb45b51251217a199", "html_url": "https://github.com/rust-lang/rust/commit/0c73e5fc5f212d30bb46b96cb45b51251217a199"}, {"sha": "198030fadfbc3849f004deb8bb9108d0a0fad19a", "url": "https://api.github.com/repos/rust-lang/rust/commits/198030fadfbc3849f004deb8bb9108d0a0fad19a", "html_url": "https://github.com/rust-lang/rust/commit/198030fadfbc3849f004deb8bb9108d0a0fad19a"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "03e48ab79b144071f2fee6e09a4cd508572f8d4d", "filename": "src/libstd/io/stdio.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/325808a33d5bde39c88f4ed3b70e0706b38a3cef/src%2Flibstd%2Fio%2Fstdio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/325808a33d5bde39c88f4ed3b70e0706b38a3cef/src%2Flibstd%2Fio%2Fstdio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fstdio.rs?ref=325808a33d5bde39c88f4ed3b70e0706b38a3cef", "patch": "@@ -362,7 +362,14 @@ impl Writer for StdWriter {\n         // sizes. For an example, see #14940. For this reason, chunk the output\n         // buffer on windows, but on unix we can just write the whole buffer all\n         // at once.\n-        let max_size = if cfg!(windows) {64 * 1024} else {uint::MAX};\n+        //\n+        // For some other references, it appears that this problem has been\n+        // encountered by others [1] [2]. We choose the number 8KB just because\n+        // libuv does the same.\n+        //\n+        // [1]: https://tahoe-lafs.org/trac/tahoe-lafs/ticket/1232\n+        // [2]: http://www.mail-archive.com/log4net-dev@logging.apache.org/msg00661.html\n+        let max_size = if cfg!(windows) {8192} else {uint::MAX};\n         for chunk in buf.chunks(max_size) {\n             try!(match self.inner {\n                 TTY(ref mut tty) => tty.write(chunk),"}]}