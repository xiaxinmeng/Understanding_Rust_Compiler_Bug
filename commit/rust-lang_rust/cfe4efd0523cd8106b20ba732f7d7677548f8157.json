{"sha": "cfe4efd0523cd8106b20ba732f7d7677548f8157", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmZTRlZmQwNTIzY2Q4MTA2YjIwYmE3MzJmN2Q3Njc3NTQ4ZjgxNTc=", "commit": {"author": {"name": "Ulrik Sverdrup", "email": "bluss@users.noreply.github.com", "date": "2016-03-04T21:52:34Z"}, "committer": {"name": "Ulrik Sverdrup", "email": "bluss@users.noreply.github.com", "date": "2016-03-04T21:52:34Z"}, "message": "Do not trigger unused_variables lint for variable modified through AddAssign\n\nVisit an overloaded += like a method call and not like an assignment.", "tree": {"sha": "3d526efa497ab2f45b7403c2369a0dbcdd84a2e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d526efa497ab2f45b7403c2369a0dbcdd84a2e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cfe4efd0523cd8106b20ba732f7d7677548f8157", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cfe4efd0523cd8106b20ba732f7d7677548f8157", "html_url": "https://github.com/rust-lang/rust/commit/cfe4efd0523cd8106b20ba732f7d7677548f8157", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cfe4efd0523cd8106b20ba732f7d7677548f8157/comments", "author": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5b6599ab64b2e44d2fe13eea884e2369ffdaa47", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5b6599ab64b2e44d2fe13eea884e2369ffdaa47", "html_url": "https://github.com/rust-lang/rust/commit/d5b6599ab64b2e44d2fe13eea884e2369ffdaa47"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "0412b26903137eaf0f5a297332979bbd7ef5b916", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/cfe4efd0523cd8106b20ba732f7d7677548f8157/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfe4efd0523cd8106b20ba732f7d7677548f8157/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=cfe4efd0523cd8106b20ba732f7d7677548f8157", "patch": "@@ -1086,11 +1086,17 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n           }\n \n           hir::ExprAssignOp(_, ref l, ref r) => {\n-            // see comment on lvalues in\n-            // propagate_through_lvalue_components()\n-            let succ = self.write_lvalue(&l, succ, ACC_WRITE|ACC_READ);\n-            let succ = self.propagate_through_expr(&r, succ);\n-            self.propagate_through_lvalue_components(&l, succ)\n+            // an overloaded assign op is like a method call\n+            if self.ir.tcx.is_method_call(expr.id) {\n+                let succ = self.propagate_through_expr(&l, succ);\n+                self.propagate_through_expr(&r, succ)\n+            } else {\n+                // see comment on lvalues in\n+                // propagate_through_lvalue_components()\n+                let succ = self.write_lvalue(&l, succ, ACC_WRITE|ACC_READ);\n+                let succ = self.propagate_through_expr(&r, succ);\n+                self.propagate_through_lvalue_components(&l, succ)\n+            }\n           }\n \n           // Uninteresting cases: just propagate in rev exec order"}, {"sha": "3aab953eb7940bc6d2a33c3e73ce5b78d30d53aa", "filename": "src/test/compile-fail/liveness-unused.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cfe4efd0523cd8106b20ba732f7d7677548f8157/src%2Ftest%2Fcompile-fail%2Fliveness-unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfe4efd0523cd8106b20ba732f7d7677548f8157/src%2Ftest%2Fcompile-fail%2Fliveness-unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fliveness-unused.rs?ref=cfe4efd0523cd8106b20ba732f7d7677548f8157", "patch": "@@ -127,5 +127,24 @@ fn f6() {\n     }) += 1;\n }\n \n+\n+struct MutRef<'a>(&'a mut i32);\n+\n+impl<'a> AddAssign<i32> for MutRef<'a> {\n+    fn add_assign(&mut self, rhs: i32) {\n+        *self.0 += rhs;\n+    }\n+}\n+\n+fn f7() {\n+    let mut a = 1;\n+    {\n+        // `b` does not trigger unused_variables\n+        let mut b = MutRef(&mut a);\n+        b += 1;\n+    }\n+    drop(a);\n+}\n+\n fn main() {\n }"}]}