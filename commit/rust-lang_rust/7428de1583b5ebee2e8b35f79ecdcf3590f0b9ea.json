{"sha": "7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0MjhkZTE1ODNiNWViZWUyZThiMzVmNzllY2RjZjM1OTBmMGI5ZWE=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-24T20:39:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-24T20:39:47Z"}, "message": "Rollup merge of #77930 - estebank:ice-77919, r=eddyb\n\nDo not ICE with TraitPredicates containing [type error]\n\nFix #77919.", "tree": {"sha": "4ab1c0c552a31c0db4fd6b5577e0279689788862", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ab1c0c552a31c0db4fd6b5577e0279689788862"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJflJEUCRBK7hj4Ov3rIwAAdHIIAC8OYfqslEqVIsiXC1lw7Hke\ndkyEX/6YG0N4Qbv5/fOD6ncb1/15F3CeDwEoGO5QJ6NZwmeXRSJJeHJuZV+ELdqr\nfiKwR+Y5SoDkwofFjm84kLuTLfGhHi101pSxw5EAZ2kQGgyhNwEg1k5pQrApjERm\nhiA2d4GnfZYKWEmdQhwT26mKAbnVcMQaZxkNbYVoyL26ma4dLlxdz52wHXnDlLAA\n4f4FtrnvXYE5RXq9jhkRFDSACU8Q7xoLna869IiYVCxZPtOcJPHV1RBROHXg1+LD\nOlPsjkRfiujuu5SiJjAy8TnEdAG32H7JbXyx5uzuFPf4k0IF3mSRgRz3oMZIMTY=\n=neoR\n-----END PGP SIGNATURE-----\n", "payload": "tree 4ab1c0c552a31c0db4fd6b5577e0279689788862\nparent 4d72939af14b20a79232dbe4533875b15d264003\nparent f71e9ed7f1b88f303519dcd7c2cc69117ff95094\nauthor Jonas Schievink <jonasschievink@gmail.com> 1603571987 +0200\ncommitter GitHub <noreply@github.com> 1603571987 +0200\n\nRollup merge of #77930 - estebank:ice-77919, r=eddyb\n\nDo not ICE with TraitPredicates containing [type error]\n\nFix #77919.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "html_url": "https://github.com/rust-lang/rust/commit/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d72939af14b20a79232dbe4533875b15d264003", "url": "https://api.github.com/repos/rust-lang/rust/commits/4d72939af14b20a79232dbe4533875b15d264003", "html_url": "https://github.com/rust-lang/rust/commit/4d72939af14b20a79232dbe4533875b15d264003"}, {"sha": "f71e9ed7f1b88f303519dcd7c2cc69117ff95094", "url": "https://api.github.com/repos/rust-lang/rust/commits/f71e9ed7f1b88f303519dcd7c2cc69117ff95094", "html_url": "https://github.com/rust-lang/rust/commit/f71e9ed7f1b88f303519dcd7c2cc69117ff95094"}], "stats": {"total": 64, "additions": 63, "deletions": 1}, "files": [{"sha": "3cb6ec8626186f511710f5d26f7b9615d256090b", "filename": "compiler/rustc_trait_selection/src/traits/codegen.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcodegen.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcodegen.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fcodegen.rs?ref=7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "patch": "@@ -121,7 +121,10 @@ where\n     // contains unbound type parameters. It could be a slight\n     // optimization to stop iterating early.\n     if let Err(errors) = fulfill_cx.select_all_or_error(infcx) {\n-        bug!(\"Encountered errors `{:?}` resolving bounds after type-checking\", errors);\n+        infcx.tcx.sess.delay_span_bug(\n+            rustc_span::DUMMY_SP,\n+            &format!(\"Encountered errors `{:?}` resolving bounds after type-checking\", errors),\n+        );\n     }\n \n     let result = infcx.resolve_vars_if_possible(result);"}, {"sha": "9b04d5ee0008db4df88f4c272ed6dbf995760e3c", "filename": "src/test/ui/issues/issue-77919.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/src%2Ftest%2Fui%2Fissues%2Fissue-77919.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/src%2Ftest%2Fui%2Fissues%2Fissue-77919.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-77919.rs?ref=7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "patch": "@@ -0,0 +1,13 @@\n+fn main() {\n+    [1; <Multiply<Five, Five>>::VAL]; //~ ERROR evaluation of constant value failed\n+}\n+trait TypeVal<T> {\n+    const VAL: T; //~ ERROR any use of this value will cause an error\n+}\n+struct Five;\n+struct Multiply<N, M> {\n+    _n: PhantomData, //~ ERROR cannot find type `PhantomData` in this scope\n+}\n+impl<N, M> TypeVal<usize> for Multiply<N, M> where N: TypeVal<VAL> {}\n+//~^ ERROR cannot find type `VAL` in this scope\n+//~| ERROR not all trait items implemented, missing: `VAL`"}, {"sha": "129af00644fff589a9e76f74477a5571a29eda65", "filename": "src/test/ui/issues/issue-77919.stderr", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-77919.stderr?ref=7428de1583b5ebee2e8b35f79ecdcf3590f0b9ea", "patch": "@@ -0,0 +1,46 @@\n+error[E0412]: cannot find type `PhantomData` in this scope\n+  --> $DIR/issue-77919.rs:9:9\n+   |\n+LL |     _n: PhantomData,\n+   |         ^^^^^^^^^^^ not found in this scope\n+   |\n+help: consider importing this struct\n+   |\n+LL | use std::marker::PhantomData;\n+   |\n+\n+error[E0412]: cannot find type `VAL` in this scope\n+  --> $DIR/issue-77919.rs:11:63\n+   |\n+LL | impl<N, M> TypeVal<usize> for Multiply<N, M> where N: TypeVal<VAL> {}\n+   |          -                                                    ^^^ not found in this scope\n+   |          |\n+   |          help: you might be missing a type parameter: `, VAL`\n+\n+error[E0046]: not all trait items implemented, missing: `VAL`\n+  --> $DIR/issue-77919.rs:11:1\n+   |\n+LL |     const VAL: T;\n+   |     ------------- `VAL` from trait\n+...\n+LL | impl<N, M> TypeVal<usize> for Multiply<N, M> where N: TypeVal<VAL> {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `VAL` in implementation\n+\n+error: any use of this value will cause an error\n+  --> $DIR/issue-77919.rs:5:5\n+   |\n+LL |     const VAL: T;\n+   |     ^^^^^^^^^^^^^ no MIR body is available for DefId(0:7 ~ issue_77919[317d]::TypeVal::VAL)\n+   |\n+   = note: `#[deny(const_err)]` on by default\n+\n+error[E0080]: evaluation of constant value failed\n+  --> $DIR/issue-77919.rs:2:9\n+   |\n+LL |     [1; <Multiply<Five, Five>>::VAL];\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^ referenced constant has errors\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0046, E0080, E0412.\n+For more information about an error, try `rustc --explain E0046`."}]}