{"sha": "ef17859e35f6a424e8d00f9de96c7da1c1edda56", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmMTc4NTllMzVmNmE0MjRlOGQwMGY5ZGU5NmM3ZGExYzFlZGRhNTY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-03-05T20:44:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-05T20:44:41Z"}, "message": "Rollup merge of #82782 - pnkfelix:include-crate-being-compiled-in-bootstrap-verbose-output, r=Mark-Simulacrum\n\nMake rustc shim's verbose output include crate_name being compiled.\n\nThis change is mainly motivated by an issue with the environment printing I added in PR 82403: multiple rustc invocations progress in parallel, and the environment output, spanning multiple lines, gets interleaved in ways make it difficult to extra the enviroment settings.\n\n(This aforementioned difficulty is more of a hiccup than an outright show-stopper, because the environment variables tend to be the same for all of the rustc invocations, so it doesn't matter too much if one mixes up which lines one is looking at. But still: Better to fix it.)", "tree": {"sha": "64dbf5cf4d1b3e55ca7786411e78bf79a0cd61af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64dbf5cf4d1b3e55ca7786411e78bf79a0cd61af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef17859e35f6a424e8d00f9de96c7da1c1edda56", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgQpg6CRBK7hj4Ov3rIwAAdHIIAIRzYTSWsV18g2v9GbDCdgcq\nzjtvYCYRCYxreO06KN6bE+d6vA5ZegfiBjzd13adX2idBZwK94+b1rXPG2HZruas\n+B/N/9nyZVbP9pSbrI/Sm57X17jEOi4tYeAxbr09QpQ8JoSo5GhxQXj9/BEicujW\nwsM/sVgycZ76buZjwt+k8y9elssgEjarFdqTGov51Bj/Tzb63p4DRf45PrpzacPR\nF+6f5E/83sVxMEATvFLkbaqgMG0AuSpOoBP85CAbuKhOWRcBfOge81TmM/4d2n1R\nW3fGuqrv9F8mY2N06feFvzXmrXZuZgl1GeJpQPh6uTYCsxFmMHrxbj6D6U2wLy8=\n=vVAE\n-----END PGP SIGNATURE-----\n", "payload": "tree 64dbf5cf4d1b3e55ca7786411e78bf79a0cd61af\nparent 15c148b4f2b86f22c053bf08d3a2b76f76359a35\nparent 444a7567693506347a3ce9e79f6823abf7141b17\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1614977081 +0100\ncommitter GitHub <noreply@github.com> 1614977081 +0100\n\nRollup merge of #82782 - pnkfelix:include-crate-being-compiled-in-bootstrap-verbose-output, r=Mark-Simulacrum\n\nMake rustc shim's verbose output include crate_name being compiled.\n\nThis change is mainly motivated by an issue with the environment printing I added in PR 82403: multiple rustc invocations progress in parallel, and the environment output, spanning multiple lines, gets interleaved in ways make it difficult to extra the enviroment settings.\n\n(This aforementioned difficulty is more of a hiccup than an outright show-stopper, because the environment variables tend to be the same for all of the rustc invocations, so it doesn't matter too much if one mixes up which lines one is looking at. But still: Better to fix it.)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef17859e35f6a424e8d00f9de96c7da1c1edda56", "html_url": "https://github.com/rust-lang/rust/commit/ef17859e35f6a424e8d00f9de96c7da1c1edda56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef17859e35f6a424e8d00f9de96c7da1c1edda56/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "15c148b4f2b86f22c053bf08d3a2b76f76359a35", "url": "https://api.github.com/repos/rust-lang/rust/commits/15c148b4f2b86f22c053bf08d3a2b76f76359a35", "html_url": "https://github.com/rust-lang/rust/commit/15c148b4f2b86f22c053bf08d3a2b76f76359a35"}, {"sha": "444a7567693506347a3ce9e79f6823abf7141b17", "url": "https://api.github.com/repos/rust-lang/rust/commits/444a7567693506347a3ce9e79f6823abf7141b17", "html_url": "https://github.com/rust-lang/rust/commit/444a7567693506347a3ce9e79f6823abf7141b17"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "0ab5e9c63c94f710b64d4c4001d3bc3b92293d96", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/ef17859e35f6a424e8d00f9de96c7da1c1edda56/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef17859e35f6a424e8d00f9de96c7da1c1edda56/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=ef17859e35f6a424e8d00f9de96c7da1c1edda56", "patch": "@@ -138,21 +138,28 @@ fn main() {\n         cmd.arg(\"-Z\").arg(\"force-unstable-if-unmarked\");\n     }\n \n+    let is_test = args.iter().any(|a| a == \"--test\");\n     if verbose > 1 {\n         let rust_env_vars =\n             env::vars().filter(|(k, _)| k.starts_with(\"RUST\") || k.starts_with(\"CARGO\"));\n+        let prefix = if is_test { \"[RUSTC-SHIM] rustc --test\" } else { \"[RUSTC-SHIM] rustc\" };\n+        let prefix = match crate_name {\n+            Some(crate_name) => format!(\"{} {}\", prefix, crate_name),\n+            None => prefix.to_string(),\n+        };\n         for (i, (k, v)) in rust_env_vars.enumerate() {\n-            eprintln!(\"rustc env[{}]: {:?}={:?}\", i, k, v);\n+            eprintln!(\"{} env[{}]: {:?}={:?}\", prefix, i, k, v);\n         }\n-        eprintln!(\"rustc working directory: {}\", env::current_dir().unwrap().display());\n+        eprintln!(\"{} working directory: {}\", prefix, env::current_dir().unwrap().display());\n         eprintln!(\n-            \"rustc command: {:?}={:?} {:?}\",\n+            \"{} command: {:?}={:?} {:?}\",\n+            prefix,\n             bootstrap::util::dylib_path_var(),\n             env::join_paths(&dylib_path).unwrap(),\n             cmd,\n         );\n-        eprintln!(\"sysroot: {:?}\", sysroot);\n-        eprintln!(\"libdir: {:?}\", libdir);\n+        eprintln!(\"{} sysroot: {:?}\", prefix, sysroot);\n+        eprintln!(\"{} libdir: {:?}\", prefix, libdir);\n     }\n \n     let start = Instant::now();\n@@ -166,7 +173,6 @@ fn main() {\n     {\n         if let Some(crate_name) = crate_name {\n             let dur = start.elapsed();\n-            let is_test = args.iter().any(|a| a == \"--test\");\n             // If the user requested resource usage data, then\n             // include that in addition to the timing output.\n             let rusage_data ="}]}