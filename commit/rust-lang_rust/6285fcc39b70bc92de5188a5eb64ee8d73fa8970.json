{"sha": "6285fcc39b70bc92de5188a5eb64ee8d73fa8970", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyODVmY2MzOWI3MGJjOTJkZTUxODhhNWViNjRlZThkNzNmYTg5NzA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-24T14:23:54Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-02-24T14:39:08Z"}, "message": "complete fields in struct literals", "tree": {"sha": "00eb88738994ca74d81ab105162b2fcae64987ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00eb88738994ca74d81ab105162b2fcae64987ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6285fcc39b70bc92de5188a5eb64ee8d73fa8970", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6285fcc39b70bc92de5188a5eb64ee8d73fa8970", "html_url": "https://github.com/rust-lang/rust/commit/6285fcc39b70bc92de5188a5eb64ee8d73fa8970", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6285fcc39b70bc92de5188a5eb64ee8d73fa8970/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "65a2be49539375502ca95c8da455f50f580df2e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/65a2be49539375502ca95c8da455f50f580df2e3", "html_url": "https://github.com/rust-lang/rust/commit/65a2be49539375502ca95c8da455f50f580df2e3"}], "stats": {"total": 23, "additions": 16, "deletions": 7}, "files": [{"sha": "f8dd2baadf1fa0146cfb60e4516c9c702fab9591", "filename": "crates/ra_ide_api/src/completion/complete_struct_literal.rs", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6285fcc39b70bc92de5188a5eb64ee8d73fa8970/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_struct_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6285fcc39b70bc92de5188a5eb64ee8d73fa8970/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_struct_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fcomplete_struct_literal.rs?ref=6285fcc39b70bc92de5188a5eb64ee8d73fa8970", "patch": "@@ -3,7 +3,7 @@ use hir::{Ty, AdtDef, Docs};\n use crate::completion::{CompletionContext, Completions, CompletionItem, CompletionItemKind};\n use crate::completion::completion_item::CompletionKind;\n \n-/// Complete dot accesses, i.e. fields or methods (currently only fields).\n+/// Complete fields in fields literals.\n pub(super) fn complete_struct_literal(acc: &mut Completions, ctx: &CompletionContext) {\n     let (function, struct_lit) = match (&ctx.function, ctx.struct_lit_syntax) {\n         (Some(function), Some(struct_lit)) => (function, struct_lit),\n@@ -42,23 +42,32 @@ pub(super) fn complete_struct_literal(acc: &mut Completions, ctx: &CompletionCon\n \n #[cfg(test)]\n mod tests {\n-    use crate::completion::*;\n-    use crate::completion::completion_item::check_completion;\n+    use insta::assert_debug_snapshot_matches;\n+    use crate::completion::{CompletionItem, CompletionKind};\n \n-    fn check_ref_completion(name: &str, code: &str) {\n-        check_completion(name, code, CompletionKind::Reference);\n+    fn complete(code: &str) -> Vec<CompletionItem> {\n+        crate::completion::completion_item::do_completion(code, CompletionKind::Reference)\n     }\n \n     #[test]\n     fn test_struct_literal_field() {\n-        check_ref_completion(\n-            \"test_struct_literal_field\",\n+        let completions = complete(\n             r\"\n             struct A { the_field: u32 }\n             fn foo() {\n                A { the<|> }\n             }\n             \",\n         );\n+        assert_debug_snapshot_matches!(completions, @r###\"[\n+    CompletionItem {\n+        label: \"the_field\",\n+        source_range: [83; 86),\n+        delete: [83; 86),\n+        insert: \"the_field\",\n+        kind: Field,\n+        detail: \"u32\"\n+    }\n+]\"###);\n     }\n }"}]}