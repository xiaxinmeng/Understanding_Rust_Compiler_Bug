{"sha": "d24b2290723406f16373a3d7db99da7c7e9e5982", "node_id": "C_kwDOAAsO6NoAKGQyNGIyMjkwNzIzNDA2ZjE2MzczYTNkN2RiOTlkYTdjN2U5ZTU5ODI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-04T06:28:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-04T06:28:55Z"}, "message": "Rollup merge of #106327 - gimbles:dbg, r=jyn514\n\nAdd tidy check for dbg\n\nFixes #106169", "tree": {"sha": "bdc4ebdfe027f00e485c7bb069a1947b2a0a6411", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bdc4ebdfe027f00e485c7bb069a1947b2a0a6411"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d24b2290723406f16373a3d7db99da7c7e9e5982", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjtRynCRBK7hj4Ov3rIwAA4gMIAGKRpv3WISJfGSAkBg9ZpUZe\nsRp9dLL3BquWNyybdZd4wry398U8isCI8Rjki8/LRC1FFeVxcpSsdMn7IKMqKzEf\nTlyYApWAhMut/nEa9BUAKJf14YJ8uBBqQcH3VMVUbjBT9Kfo/8kOYyg1KN9u5sRP\nHYpXCmF0d8oNqeGzo4A7PgIdGyGUx9lOgBWv9mU/TyPf16pwk+euoy2BK5NJpcRE\n0hXQuqYLwmlExeJh4Q4St5hbEAQfA4UNQHIOqB4JlZBtIqTfIuafp6if6vYSgPTA\nI+ZL67v+BjYxGZ5rT84ChsJBRa9ykiH6aYP9eKpnu1ZOFpLbJKUQKQFz9nyxP9o=\n=vqIo\n-----END PGP SIGNATURE-----\n", "payload": "tree bdc4ebdfe027f00e485c7bb069a1947b2a0a6411\nparent 336124797f5f2057d2226b7d3c354e46f284ac33\nparent cc2881391a1f1e01faa2f7ff21a172a15fbbaacd\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1672813735 +0100\ncommitter GitHub <noreply@github.com> 1672813735 +0100\n\nRollup merge of #106327 - gimbles:dbg, r=jyn514\n\nAdd tidy check for dbg\n\nFixes #106169\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d24b2290723406f16373a3d7db99da7c7e9e5982", "html_url": "https://github.com/rust-lang/rust/commit/d24b2290723406f16373a3d7db99da7c7e9e5982", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d24b2290723406f16373a3d7db99da7c7e9e5982/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "336124797f5f2057d2226b7d3c354e46f284ac33", "url": "https://api.github.com/repos/rust-lang/rust/commits/336124797f5f2057d2226b7d3c354e46f284ac33", "html_url": "https://github.com/rust-lang/rust/commit/336124797f5f2057d2226b7d3c354e46f284ac33"}, {"sha": "cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd", "html_url": "https://github.com/rust-lang/rust/commit/cc2881391a1f1e01faa2f7ff21a172a15fbbaacd"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "fcc5cfafd808d0cc2066366fe12d0c9cb55dbb7c", "filename": "library/std/src/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d24b2290723406f16373a3d7db99da7c7e9e5982/library%2Fstd%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d24b2290723406f16373a3d7db99da7c7e9e5982/library%2Fstd%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fmacros.rs?ref=d24b2290723406f16373a3d7db99da7c7e9e5982", "patch": "@@ -3,6 +3,7 @@\n //! This module contains a set of macros which are exported from the standard\n //! library. Each macro is available for use when linking against the standard\n //! library.\n+// ignore-tidy-dbg\n \n #[doc = include_str!(\"../../core/src/macros/panic.md\")]\n #[macro_export]"}, {"sha": "f409a86db26c0e1269bed716ff1ff03ac986f24c", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/d24b2290723406f16373a3d7db99da7c7e9e5982/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d24b2290723406f16373a3d7db99da7c7e9e5982/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=d24b2290723406f16373a3d7db99da7c7e9e5982", "patch": "@@ -15,6 +15,7 @@\n //!\n //! A number of these checks can be opted-out of with various directives of the form:\n //! `// ignore-tidy-CHECK-NAME`.\n+// ignore-tidy-dbg\n \n use crate::walk::{filter_dirs, walk};\n use regex::{Regex, RegexSet};\n@@ -278,6 +279,7 @@ pub fn check(path: &Path, bad: &mut bool) {\n         let mut skip_leading_newlines =\n             contains_ignore_directive(can_contain, &contents, \"leading-newlines\");\n         let mut skip_copyright = contains_ignore_directive(can_contain, &contents, \"copyright\");\n+        let mut skip_dbg = contains_ignore_directive(can_contain, &contents, \"dbg\");\n         let mut leading_new_lines = false;\n         let mut trailing_new_lines = 0;\n         let mut lines = 0;\n@@ -306,6 +308,21 @@ pub fn check(path: &Path, bad: &mut bool) {\n             let mut err = |msg: &str| {\n                 tidy_error!(bad, \"{}:{}: {}\", file.display(), i + 1, msg);\n             };\n+\n+            if trimmed.contains(\"dbg!\")\n+                && !trimmed.starts_with(\"//\")\n+                && !file\n+                    .ancestors()\n+                    .any(|a| a.ends_with(\"src/test\") || a.ends_with(\"library/alloc/tests\"))\n+                && filename != \"tests.rs\"\n+            {\n+                suppressible_tidy_err!(\n+                    err,\n+                    skip_dbg,\n+                    \"`dbg!` macro is intended as a debugging tool. It should not be in version control.\"\n+                )\n+            }\n+\n             if !under_rustfmt\n                 && line.chars().count() > max_columns\n                 && !long_line_is_ok(&extension, is_error_code, max_columns, line)"}]}