{"sha": "92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyMjcwYmExOTFlNTNmYTNkOWE1ZGJkYzhjYzM2YjVmODc0OWNiZDc=", "commit": {"author": {"name": "Seiichi Uchida", "email": "topecongiro@localhost.localdomain", "date": "2017-05-25T14:01:41Z"}, "committer": {"name": "Seiichi Uchida", "email": "topecongiro@localhost.localdomain", "date": "2017-05-25T14:01:41Z"}, "message": "Add offset when rewriting index", "tree": {"sha": "bf46ed3ed58bcaf08e8943888e6ece7b0358794c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf46ed3ed58bcaf08e8943888e6ece7b0358794c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "html_url": "https://github.com/rust-lang/rust/commit/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/comments", "author": null, "committer": null, "parents": [{"sha": "189b6bd7bbb01adea2163ca7b60ce2294dd10181", "url": "https://api.github.com/repos/rust-lang/rust/commits/189b6bd7bbb01adea2163ca7b60ce2294dd10181", "html_url": "https://github.com/rust-lang/rust/commit/189b6bd7bbb01adea2163ca7b60ce2294dd10181"}], "stats": {"total": 31, "additions": 18, "deletions": 13}, "files": [{"sha": "4102f4f7ad31e49387b5f7b5ad5215274e1a6b47", "filename": "src/expr.rs", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "patch": "@@ -1893,13 +1893,11 @@ fn rewrite_index(expr: &ast::Expr,\n         (\"[\", \"]\")\n     };\n \n-    let budget = shape\n-        .width\n-        .checked_sub(expr_str.len() + lbr.len() + rbr.len())\n-        .unwrap_or(0);\n-    let index_str = index.rewrite(context, Shape::legacy(budget, shape.indent));\n-    if let Some(index_str) = index_str {\n-        return Some(format!(\"{}{}{}{}\", expr_str, lbr, index_str, rbr));\n+    let offset = expr_str.len() + lbr.len();\n+    if let Some(index_shape) = shape.visual_indent(offset).sub_width(offset + rbr.len()) {\n+        if let Some(index_str) = index.rewrite(context, index_shape) {\n+            return Some(format!(\"{}{}{}{}\", expr_str, lbr, index_str, rbr));\n+        }\n     }\n \n     let indent = shape.indent.block_indent(&context.config);"}, {"sha": "52d271a44692b527657e6f613e2d3fdf291d805d", "filename": "tests/target/chains-visual.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fchains-visual.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fchains-visual.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains-visual.rs?ref=92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "patch": "@@ -83,9 +83,9 @@ fn floaters() {\n             PushParam => {\n                 // params are 1-indexed\n                 stack.push(mparams[match cur.to_digit(10) {\n-                               Some(d) => d as usize - 1,\n-                               None => return Err(\"bad param number\".to_owned()),\n-                           }]\n+                                       Some(d) => d as usize - 1,\n+                                       None => return Err(\"bad param number\".to_owned()),\n+                                   }]\n                            .clone());\n             }\n         }"}, {"sha": "fb6ee2f885f4ac15fb90c03d7f8d7354b3609bde", "filename": "tests/target/chains.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fchains.rs?ref=92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "patch": "@@ -82,9 +82,9 @@ fn floaters() {\n             PushParam => {\n                 // params are 1-indexed\n                 stack.push(mparams[match cur.to_digit(10) {\n-                    Some(d) => d as usize - 1,\n-                    None => return Err(\"bad param number\".to_owned()),\n-                }].clone());\n+                                       Some(d) => d as usize - 1,\n+                                       None => return Err(\"bad param number\".to_owned()),\n+                                   }].clone());\n             }\n         }\n     }"}, {"sha": "427a8076ad5ec7aaadc934265b6286175ae0d127", "filename": "tests/target/issue-1247.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fissue-1247.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7/tests%2Ftarget%2Fissue-1247.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-1247.rs?ref=92270ba191e53fa3d9a5dbdc8cc36b5f8749cbd7", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-max_width: 80\n+\n+fn foo() {\n+    polyfill::slice::fill(&mut self.pending[padding_pos..\n+                                            (self.algorithm.block_len - 8)],\n+                          0);\n+}"}]}