{"sha": "dfec47fe9192c66ef6c536cc91745e806b84419a", "node_id": "C_kwDOAAsO6NoAKGRmZWM0N2ZlOTE5MmM2NmVmNmM1MzZjYzkxNzQ1ZTgwNmI4NDQxOWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-14T09:21:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-14T09:21:03Z"}, "message": "Rollup merge of #91820 - rukai:help_with_personality_issues, r=davidtwco\n\nSuggest to specify a target triple when lang item is missing\n\nIt is very common for newbies to embedded to hit this confusing error when forgetting to specify the target.\nSource: me googling this error many times.\n\n## Possible changes\n* We could possibly restrict the note+help to only be included on eh_personality lang item if that helped reduce false positives, but its also possible doing so would just increase false negatives\n* Open to any suggestions on rewriting the messages\n* We could possibly remove the `.cargo/config` alternative to avoid the message getting too noisy but I think its valuable to have as its the correct approach for most embedded projects so that `cargo build` just works.\n\nr? rust-lang/diagnostics", "tree": {"sha": "571d6a02b76bfaa759a4844b9436472a904ea2ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/571d6a02b76bfaa759a4844b9436472a904ea2ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dfec47fe9192c66ef6c536cc91745e806b84419a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhuGH/CRBK7hj4Ov3rIwAAVF4IAKaiVeVSukoq5g6olm1flTv3\na1DdTFjoZNwFojj16xf4ZocJ7lEA7yWqM6ptSkFNG39JXl4wWG1BMQpIILsjttow\nD+5PD2HJjMOlhT8lkaZnUHxN1QvHUpL6RniK3l1UuO8keDc0hMg10PcekSsVvM1E\nqHanEDrxeq/+twQA9Q/g+a5PHve56pIyrzclg6JiSCwzOww+zF7GUtCPd9tA5kCC\nsHNuQI2KwqnaEqCLTqhCi+p2OVtwFEVAhEB5Gh3cmLcjUDHPsEWmx982YPVTUaSv\ntwZP2EAAmhTve1OLx15F+ySQxVOAT0JtbTv6jtmiyAEqtm0jxOdA58/i06mstTg=\n=Vgru\n-----END PGP SIGNATURE-----\n", "payload": "tree 571d6a02b76bfaa759a4844b9436472a904ea2ac\nparent 7ec00cd135a235d9c615bd862cd78b3c64c8ceda\nparent fae40c507068b2d7aa5dc7bda729762e536aa8c2\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1639473663 +0100\ncommitter GitHub <noreply@github.com> 1639473663 +0100\n\nRollup merge of #91820 - rukai:help_with_personality_issues, r=davidtwco\n\nSuggest to specify a target triple when lang item is missing\n\nIt is very common for newbies to embedded to hit this confusing error when forgetting to specify the target.\nSource: me googling this error many times.\n\n## Possible changes\n* We could possibly restrict the note+help to only be included on eh_personality lang item if that helped reduce false positives, but its also possible doing so would just increase false negatives\n* Open to any suggestions on rewriting the messages\n* We could possibly remove the `.cargo/config` alternative to avoid the message getting too noisy but I think its valuable to have as its the correct approach for most embedded projects so that `cargo build` just works.\n\nr? rust-lang/diagnostics\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dfec47fe9192c66ef6c536cc91745e806b84419a", "html_url": "https://github.com/rust-lang/rust/commit/dfec47fe9192c66ef6c536cc91745e806b84419a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dfec47fe9192c66ef6c536cc91745e806b84419a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ec00cd135a235d9c615bd862cd78b3c64c8ceda", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ec00cd135a235d9c615bd862cd78b3c64c8ceda", "html_url": "https://github.com/rust-lang/rust/commit/7ec00cd135a235d9c615bd862cd78b3c64c8ceda"}, {"sha": "fae40c507068b2d7aa5dc7bda729762e536aa8c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/fae40c507068b2d7aa5dc7bda729762e536aa8c2", "html_url": "https://github.com/rust-lang/rust/commit/fae40c507068b2d7aa5dc7bda729762e536aa8c2"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "61c82f031dd5b055ae639ca5570afdaa0da79e71", "filename": "compiler/rustc_passes/src/weak_lang_items.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/dfec47fe9192c66ef6c536cc91745e806b84419a/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dfec47fe9192c66ef6c536cc91745e806b84419a/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fweak_lang_items.rs?ref=dfec47fe9192c66ef6c536cc91745e806b84419a", "patch": "@@ -67,10 +67,16 @@ fn verify<'tcx>(tcx: TyCtxt<'tcx>, items: &lang_items::LanguageItems) {\n             } else if item == LangItem::Oom {\n                 if !tcx.features().default_alloc_error_handler {\n                     tcx.sess.err(\"`#[alloc_error_handler]` function required, but not found\");\n-                    tcx.sess.note_without_error(\"Use `#![feature(default_alloc_error_handler)]` for a default error handler\");\n+                    tcx.sess.note_without_error(\"use `#![feature(default_alloc_error_handler)]` for a default error handler\");\n                 }\n             } else {\n-                tcx.sess.err(&format!(\"language item required, but not found: `{}`\", name));\n+                tcx\n+                    .sess\n+                    .diagnostic()\n+                    .struct_err(&format!(\"language item required, but not found: `{}`\", name))\n+                    .note(&format!(\"this can occur when a binary crate with `#![no_std]` is compiled for a target where `{}` is defined in the standard library\", name))\n+                    .help(&format!(\"you may be able to compile for a target that doesn't need `{}`, specify a target with `--target` or in `.cargo/config`\", name))\n+                    .emit();\n             }\n         }\n     }"}, {"sha": "39a66c08de0981ba517eef27a72e0f4cc1514d3b", "filename": "src/test/ui/extern-flag/empty-extern-arg.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fextern-flag%2Fempty-extern-arg.stderr?ref=dfec47fe9192c66ef6c536cc91745e806b84419a", "patch": "@@ -1,6 +1,9 @@\n error: extern location for std does not exist: \n \n error: language item required, but not found: `eh_personality`\n+   |\n+   = note: this can occur when a binary crate with `#![no_std]` is compiled for a target where `eh_personality` is defined in the standard library\n+   = help: you may be able to compile for a target that doesn't need `eh_personality`, specify a target with `--target` or in `.cargo/config`\n \n error: `#[panic_handler]` function required, but not found\n "}, {"sha": "995fa7cf85e965761f4748d51f19f235c6ad92dd", "filename": "src/test/ui/missing/missing-alloc_error_handler.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fmissing%2Fmissing-alloc_error_handler.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fmissing%2Fmissing-alloc_error_handler.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmissing%2Fmissing-alloc_error_handler.stderr?ref=dfec47fe9192c66ef6c536cc91745e806b84419a", "patch": "@@ -1,6 +1,6 @@\n error: `#[alloc_error_handler]` function required, but not found\n \n-note: Use `#![feature(default_alloc_error_handler)]` for a default error handler\n+note: use `#![feature(default_alloc_error_handler)]` for a default error handler\n \n error: aborting due to previous error\n "}, {"sha": "cc25f08e33a80daee3add086ccdf6562078abb58", "filename": "src/test/ui/panic-handler/weak-lang-item.stderr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dfec47fe9192c66ef6c536cc91745e806b84419a/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanic-handler%2Fweak-lang-item.stderr?ref=dfec47fe9192c66ef6c536cc91745e806b84419a", "patch": "@@ -11,6 +11,9 @@ LL | extern crate core as other_core;\n    |\n \n error: language item required, but not found: `eh_personality`\n+   |\n+   = note: this can occur when a binary crate with `#![no_std]` is compiled for a target where `eh_personality` is defined in the standard library\n+   = help: you may be able to compile for a target that doesn't need `eh_personality`, specify a target with `--target` or in `.cargo/config`\n \n error: `#[panic_handler]` function required, but not found\n "}]}