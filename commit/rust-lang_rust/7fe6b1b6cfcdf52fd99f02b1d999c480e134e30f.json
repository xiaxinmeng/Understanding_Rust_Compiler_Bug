{"sha": "7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmZTZiMWI2Y2ZjZGY1MmZkOTlmMDJiMWQ5OTljNDgwZTEzNGUzMGY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-02-09T22:13:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-02-09T22:13:59Z"}, "message": "auto merge of #4853 : Thiez/rust/incoming, r=catamorphism\n\nA simple fix for issue 2174.", "tree": {"sha": "3ba42db1623a0a7b8035992ab8a5539e3052370d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ba42db1623a0a7b8035992ab8a5539e3052370d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f", "html_url": "https://github.com/rust-lang/rust/commit/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "19dfec2aaf746535de1521f68421f9980dbf25de", "url": "https://api.github.com/repos/rust-lang/rust/commits/19dfec2aaf746535de1521f68421f9980dbf25de", "html_url": "https://github.com/rust-lang/rust/commit/19dfec2aaf746535de1521f68421f9980dbf25de"}, {"sha": "8d0c1cb406156379570b6a3c9911db758995fa4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d0c1cb406156379570b6a3c9911db758995fa4e", "html_url": "https://github.com/rust-lang/rust/commit/8d0c1cb406156379570b6a3c9911db758995fa4e"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "51ef085839d6a2f6b54685999617f525665aa926", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=7fe6b1b6cfcdf52fd99f02b1d999c480e134e30f", "patch": "@@ -250,7 +250,7 @@ fn highlight_lines(cm: @codemap::CodeMap,\n         io::stderr().write_str(out);\n     }\n \n-\n+    // FIXME (#3260)\n     // If there's one line at fault we can easily point to the problem\n     if vec::len(lines.lines) == 1u {\n         let lo = cm.lookup_char_pos(sp.lo);\n@@ -263,14 +263,26 @@ fn highlight_lines(cm: @codemap::CodeMap,\n         // indent past |name:## | and the 0-offset column location\n         let mut left = str::len(fm.name) + digits + lo.col.to_uint() + 3u;\n         let mut s = ~\"\";\n-        while left > 0u { str::push_char(&mut s, ' '); left -= 1u; }\n-\n+        // Skip is the number of characters we need to skip because they are\n+        // part of the 'filename:line ' part of the previous line.\n+        let skip = str::len(fm.name) + digits + 3u;\n+        for skip.times() {\n+            s += ~\" \";\n+        }\n+        let orig = fm.get_line(lines.lines[0] as int);\n+        for uint::range(0u,left-skip) |pos| {\n+            let curChar = (orig[pos] as char);\n+            s += match curChar { // Whenever a tab occurs on the previous\n+                '\\t' => \"\\t\",    // line, we insert one on the error-point-\n+                _ => \" \"         // -squigly-line as well (instead of a\n+            };                   // space). This way the squigly-line will\n+        }                        // usually appear in the correct position.\n         s += ~\"^\";\n         let hi = cm.lookup_char_pos(sp.hi);\n         if hi.col != lo.col {\n             // the ^ already takes up one space\n-            let mut width = hi.col.to_uint() - lo.col.to_uint() - 1u;\n-            while width > 0u { str::push_char(&mut s, '~'); width -= 1u; }\n+            let num_squiglies = hi.col.to_uint()-lo.col.to_uint()-1u;\n+            for num_squiglies.times() { s += ~\"~\"; }\n         }\n         io::stderr().write_str(s + ~\"\\n\");\n     }"}]}