{"sha": "fa1d63acd3c144ffe53766686090c3fb3a551c8d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZhMWQ2M2FjZDNjMTQ0ZmZlNTM3NjY2ODYwOTBjM2ZiM2E1NTFjOGQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-01-17T06:31:31Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2015-01-18T00:37:34Z"}, "message": "mk: Revert hack to pull the bootstrap key from the snapshot bins", "tree": {"sha": "7bb4ba1390d12a91ef3f928e50611edfa534e7a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7bb4ba1390d12a91ef3f928e50611edfa534e7a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fa1d63acd3c144ffe53766686090c3fb3a551c8d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fa1d63acd3c144ffe53766686090c3fb3a551c8d", "html_url": "https://github.com/rust-lang/rust/commit/fa1d63acd3c144ffe53766686090c3fb3a551c8d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fa1d63acd3c144ffe53766686090c3fb3a551c8d/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89b80faa8ef2b52f5adc423cfcfed69b313ea1b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/89b80faa8ef2b52f5adc423cfcfed69b313ea1b7", "html_url": "https://github.com/rust-lang/rust/commit/89b80faa8ef2b52f5adc423cfcfed69b313ea1b7"}], "stats": {"total": 7, "additions": 1, "deletions": 6}, "files": [{"sha": "46cbe34904dbcb5698c457130dabbb18ad4e69b0", "filename": "mk/main.mk", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fa1d63acd3c144ffe53766686090c3fb3a551c8d/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/fa1d63acd3c144ffe53766686090c3fb3a551c8d/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=fa1d63acd3c144ffe53766686090c3fb3a551c8d", "patch": "@@ -333,6 +333,7 @@ export CFG_DISABLE_UNSTABLE_FEATURES\n endif\n # Subvert unstable feature lints to do the self-build\n export CFG_BOOTSTRAP_KEY\n+export RUSTC_BOOTSTRAP_KEY:=$(CFG_BOOTSTRAP_KEY)\n \n ######################################################################\n # Per-stage targets and runner\n@@ -403,13 +404,8 @@ CSREQ$(1)_T_$(2)_H_$(3) = \\\n ifeq ($(1),0)\n # Don't run the stage0 compiler under valgrind - that ship has sailed\n CFG_VALGRIND_COMPILE$(1) =\n-# FIXME(21230) HACK Extract the key from the snapshot\n-CFG_BOOSTRAP_KEY_ENV$(1) = RUSTC_BOOTSTRAP_KEY=$$$$((grep -a 'save analysis[0-9]' \\\n-\t$$(HBIN$(1)_H_$(3))/rustc$$(X_$(3)) || echo N) |\\\n-\tsed 's/.*save analysis\\([0-9]*\\).*/\\1/')\n else\n CFG_VALGRIND_COMPILE$(1) = $$(CFG_VALGRIND_COMPILE)\n-CFG_BOOSTRAP_KEY_ENV$(1) = RUSTC_BOOTSTRAP_KEY=$$(CFG_BOOTSTRAP_KEY)\n endif\n \n # Add RUSTFLAGS_STAGEN values to the build command\n@@ -482,7 +478,6 @@ STAGE$(1)_T_$(2)_H_$(3) := \\\n \t$$(Q)$$(RPATH_VAR$(1)_T_$(2)_H_$(3)) \\\n \t\t$$(call CFG_RUN_TARG_$(3),$(1), \\\n \t\t$$(CFG_VALGRIND_COMPILE$(1)) \\\n-\t\t$$(CFG_BOOSTRAP_KEY_ENV$(1)) \\\n \t\t$$(HBIN$(1)_H_$(3))/rustc$$(X_$(3)) \\\n \t\t--cfg $$(CFGFLAG$(1)_T_$(2)_H_$(3)) \\\n \t\t$$(CFG_RUSTC_FLAGS) $$(EXTRAFLAGS_STAGE$(1)) --target=$(2)) \\"}]}