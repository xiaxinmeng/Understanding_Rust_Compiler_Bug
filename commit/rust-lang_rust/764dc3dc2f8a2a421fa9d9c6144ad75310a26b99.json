{"sha": "764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2NGRjM2RjMmY4YTJhNDIxZmE5ZDljNjE0NGFkNzUzMTBhMjZiOTk=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-08-04T09:27:35Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-08-16T14:42:20Z"}, "message": "lang_items: add support for lang items on variants\n\nThis commit adds support for lang items (`#[lang = \"...\"]` attributes)\non enum variants.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "33c52d52a4c60664b27f429b7baff690d8fa3e79", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33c52d52a4c60664b27f429b7baff690d8fa3e79"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl85RcwACgkQJZLnbIc4\nH9ljgQ/+PLNwv1LKlK0y0K+Ayg7NMKljJBscYnwA9o6gkqbqY1iYxiktJnPfyn1h\nWmyFOErvo5KaOvi+G6ElDklAonbTtc91z7TlZIGVF/hoWga7lYok+DyG3CXakZP6\nNzisGypRn5mKu/5MQ++xXvJLnrhoCzag1sY6GCO7ISb7O7nXs/bQrr9VSEUJ8sHV\nf3Tr+0dsSlo1f6o/i2WntS+UdxVzE7cv4/O0IOgBcWbrkJaWOfIfjsKl7P6vrezP\nV/J15XDt0okMLwUYFrMbfyTR10d3PBveelNGfIU3uZOHRsvxDnsH0QnimofTBuOp\nD3xoruSWuWQyvOZgJ2axcqKgiCwi0jv3X0GbNOhfoPxn+I5sWguu7NDRxg5xWSpC\n47kSujIN1rAtoKfpRb9ybNpgLCyk5jWmx3AgTEQIcqGdB/tZzQMqYwD6CZ7gsJEd\nHoXXCQFqvt+Nek1+U55gmhF897cZbgMwTAzgl3MFyxE30b90Vv92PHBpqK+kFXHk\nllzlYNgka9LMolnJw8ucDeQvkz/WUNqf4mlhOgej0wydswj+HEhnGRa1fv8oHbOi\n7IRt1l8e/EoQhLIxESt1OuPG6hvOWd6Fc4T1mKgIUOmUx91XF5yCyR5R20rCfkKC\nD/ySanyzHVItTPIPWt/+oiEDbKmEPVKFtN+A9GU6nAvO1cuM4nY=\n=fVo6\n-----END PGP SIGNATURE-----", "payload": "tree 33c52d52a4c60664b27f429b7baff690d8fa3e79\nparent 97ba0c7171c4d2d9b899a2bd8e40a8974c47b86d\nauthor David Wood <david@davidtw.co> 1596533255 +0100\ncommitter David Wood <david@davidtw.co> 1597588940 +0100\n\nlang_items: add support for lang items on variants\n\nThis commit adds support for lang items (`#[lang = \"...\"]` attributes)\non enum variants.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "html_url": "https://github.com/rust-lang/rust/commit/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97ba0c7171c4d2d9b899a2bd8e40a8974c47b86d", "url": "https://api.github.com/repos/rust-lang/rust/commits/97ba0c7171c4d2d9b899a2bd8e40a8974c47b86d", "html_url": "https://github.com/rust-lang/rust/commit/97ba0c7171c4d2d9b899a2bd8e40a8974c47b86d"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "1efc8bc3124b6ca6919e2073e5dd1ba590e2ee9b", "filename": "src/librustc_hir/target.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99/src%2Flibrustc_hir%2Ftarget.rs", "raw_url": "https://github.com/rust-lang/rust/raw/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99/src%2Flibrustc_hir%2Ftarget.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_hir%2Ftarget.rs?ref=764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "patch": "@@ -29,6 +29,7 @@ pub enum Target {\n     TyAlias,\n     OpaqueTy,\n     Enum,\n+    Variant,\n     Struct,\n     Union,\n     Trait,\n@@ -62,6 +63,7 @@ impl Display for Target {\n                 Target::TyAlias => \"type alias\",\n                 Target::OpaqueTy => \"opaque type\",\n                 Target::Enum => \"enum\",\n+                Target::Variant => \"enum variant\",\n                 Target::Struct => \"struct\",\n                 Target::Union => \"union\",\n                 Target::Trait => \"trait\","}, {"sha": "9ec47d2d9ab5c8f324802a3b956f5ca580f91f82", "filename": "src/librustc_passes/lang_items.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99/src%2Flibrustc_passes%2Flang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/764dc3dc2f8a2a421fa9d9c6144ad75310a26b99/src%2Flibrustc_passes%2Flang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Flang_items.rs?ref=764dc3dc2f8a2a421fa9d9c6144ad75310a26b99", "patch": "@@ -30,7 +30,13 @@ struct LanguageItemCollector<'tcx> {\n \n impl ItemLikeVisitor<'v> for LanguageItemCollector<'tcx> {\n     fn visit_item(&mut self, item: &hir::Item<'_>) {\n-        self.check_for_lang(Target::from_item(item), item.hir_id, item.attrs)\n+        self.check_for_lang(Target::from_item(item), item.hir_id, item.attrs);\n+\n+        if let hir::ItemKind::Enum(def, ..) = &item.kind {\n+            for variant in def.variants {\n+                self.check_for_lang(Target::Variant, variant.id, variant.attrs);\n+            }\n+        }\n     }\n \n     fn visit_trait_item(&mut self, trait_item: &hir::TraitItem<'_>) {"}]}