{"sha": "2e7ca7329966b9a86b4d35689cb719883dcda4e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlN2NhNzMyOTk2NmI5YTg2YjRkMzU2ODljYjcxOTg4M2RjZGE0ZTg=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-09-12T12:30:27Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-09-12T17:02:15Z"}, "message": "Don't emit an error on private doc tests when they're ignored", "tree": {"sha": "266c8a1546852845c9f3595a59528a6339f1826d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/266c8a1546852845c9f3595a59528a6339f1826d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e7ca7329966b9a86b4d35689cb719883dcda4e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7ca7329966b9a86b4d35689cb719883dcda4e8", "html_url": "https://github.com/rust-lang/rust/commit/2e7ca7329966b9a86b4d35689cb719883dcda4e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e7ca7329966b9a86b4d35689cb719883dcda4e8/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e2e7dec73a210dd7699496daf81a9442b69371b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e2e7dec73a210dd7699496daf81a9442b69371b", "html_url": "https://github.com/rust-lang/rust/commit/2e2e7dec73a210dd7699496daf81a9442b69371b"}], "stats": {"total": 16, "additions": 6, "deletions": 10}, "files": [{"sha": "78af9f9b8561a646ef1af4a7d2cbcf3b4e8a17bd", "filename": "src/librustdoc/passes/doc_test_lints.rs", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2e7ca7329966b9a86b4d35689cb719883dcda4e8/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7ca7329966b9a86b4d35689cb719883dcda4e8/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fdoc_test_lints.rs?ref=2e7ca7329966b9a86b4d35689cb719883dcda4e8", "patch": "@@ -8,7 +8,7 @@ use crate::clean;\n use crate::clean::*;\n use crate::core::DocContext;\n use crate::fold::DocFolder;\n-use crate::html::markdown::{find_testable_code, ErrorCodes, LangString};\n+use crate::html::markdown::{find_testable_code, ErrorCodes, Ignore, LangString};\n use rustc_session::lint;\n \n pub const CHECK_PRIVATE_ITEMS_DOC_TESTS: Pass = Pass {\n@@ -48,15 +48,11 @@ pub(crate) struct Tests {\n     pub(crate) found_tests: usize,\n }\n \n-impl Tests {\n-    pub(crate) fn new() -> Tests {\n-        Tests { found_tests: 0 }\n-    }\n-}\n-\n impl crate::doctest::Tester for Tests {\n-    fn add_test(&mut self, _: String, _: LangString, _: usize) {\n-        self.found_tests += 1;\n+    fn add_test(&mut self, _: String, config: LangString, _: usize) {\n+        if config.rust && config.ignore == Ignore::None {\n+            self.found_tests += 1;\n+        }\n     }\n }\n \n@@ -85,7 +81,7 @@ pub fn look_for_tests<'tcx>(cx: &DocContext<'tcx>, dox: &str, item: &Item) {\n         }\n     };\n \n-    let mut tests = Tests::new();\n+    let mut tests = Tests { found_tests: 0 };\n \n     find_testable_code(&dox, &mut tests, ErrorCodes::No, false, None);\n "}]}