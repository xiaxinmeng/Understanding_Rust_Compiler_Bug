{"sha": "ecaa1cbc9c8bcb9a96312f1c017d347c89263094", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVjYWExY2JjOWM4YmNiOWE5NjMxMmYxYzAxN2QzNDdjODkyNjMwOTQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2015-12-23T00:44:48Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-01-16T10:22:32Z"}, "message": "enable coinductive reasoning for structural traits, this is\npotentially just a stopgap measure", "tree": {"sha": "332d5a6d532cc136b859218662fb3f4a5a47ab26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/332d5a6d532cc136b859218662fb3f4a5a47ab26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ecaa1cbc9c8bcb9a96312f1c017d347c89263094", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ecaa1cbc9c8bcb9a96312f1c017d347c89263094", "html_url": "https://github.com/rust-lang/rust/commit/ecaa1cbc9c8bcb9a96312f1c017d347c89263094", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ecaa1cbc9c8bcb9a96312f1c017d347c89263094/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43756934d255603a0fb7a871f2a145380e488b71", "url": "https://api.github.com/repos/rust-lang/rust/commits/43756934d255603a0fb7a871f2a145380e488b71", "html_url": "https://github.com/rust-lang/rust/commit/43756934d255603a0fb7a871f2a145380e488b71"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "ca2a9f9ca0bf68f5c6b23d29d8b14bc8ae7a6612", "filename": "src/librustc/middle/traits/fulfill.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ecaa1cbc9c8bcb9a96312f1c017d347c89263094/src%2Flibrustc%2Fmiddle%2Ftraits%2Ffulfill.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ecaa1cbc9c8bcb9a96312f1c017d347c89263094/src%2Flibrustc%2Fmiddle%2Ftraits%2Ffulfill.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftraits%2Ffulfill.rs?ref=ecaa1cbc9c8bcb9a96312f1c017d347c89263094", "patch": "@@ -368,6 +368,19 @@ fn process_predicate1<'a,'tcx>(selcx: &mut SelectionContext<'a,'tcx>,\n     let obligation = &pending_obligation.obligation;\n     match obligation.predicate {\n         ty::Predicate::Trait(ref data) => {\n+            // For defaulted traits, we use a co-inductive strategy to\n+            // solve, so that recursion is ok.\n+            if selcx.tcx().trait_has_default_impl(data.def_id()) {\n+                debug!(\"process_predicate: trait has default impl\");\n+                for bt_obligation in backtrace {\n+                    debug!(\"process_predicate: bt_obligation = {:?}\", bt_obligation.obligation);\n+                    if bt_obligation.obligation.predicate == obligation.predicate {\n+                        debug!(\"process_predicate: found a match!\");\n+                        return Ok(Some(vec![]));\n+                    }\n+                }\n+            }\n+\n             let trait_obligation = obligation.with(data.clone());\n             match selcx.select(&trait_obligation) {\n                 Ok(Some(vtable)) => {"}]}