{"sha": "c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZTNmODhjOTM4ODNlY2JiMjdkY2RmYjdkOGVjNmUyNjNiMTI2YjA=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-05-31T03:39:20Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-05-31T04:00:04Z"}, "message": "rustc: Pushdown type params for tag patterns. Closes #363", "tree": {"sha": "f05274285e969b6266065d825cb677f2f81f2e80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f05274285e969b6266065d825cb677f2f81f2e80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "html_url": "https://github.com/rust-lang/rust/commit/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "973b93ee2a58f80b9f1f0e1fd707348c75c0137f", "url": "https://api.github.com/repos/rust-lang/rust/commits/973b93ee2a58f80b9f1f0e1fd707348c75c0137f", "html_url": "https://github.com/rust-lang/rust/commit/973b93ee2a58f80b9f1f0e1fd707348c75c0137f"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "552d0bdddc5432575fe3cf6565b5cde9730164de", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "patch": "@@ -1171,10 +1171,20 @@ mod pushdown {\n                 let ty_param_substs_and_ty res_t = demand::full(scx, pat.span,\n                       expected, tt, tps, NO_AUTODEREF);\n \n-                // TODO: push down type from \"expected\".\n-                write::ty_fixup(scx, ann.id,\n-                    ty::ann_to_ty_param_substs_opt_and_ty\n-                        (scx.fcx.ccx.tcx.node_types, ann));\n+                auto ty_params_subst = ty::ann_to_ty_param_substs_opt_and_ty\n+                    (scx.fcx.ccx.tcx.node_types, ann);\n+\n+                auto ty_params_opt;\n+                alt (ty_params_subst._0) {\n+                    case (none[vec[ty::t]]) {\n+                        ty_params_opt = none[vec[ty::t]];\n+                    }\n+                    case (some[vec[ty::t]](?tps)) {\n+                        ty_params_opt = some[vec[ty::t]](tag_tps);\n+                    }\n+                }\n+\n+                write::ty_fixup(scx, ann.id, tup(ty_params_opt, tt));\n             }\n         }\n     }"}, {"sha": "1836b2b75fec242d44e6f23b61214d2c0a52198c", "filename": "src/test/run-pass/alt-pattern-no-type-params.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0/src%2Ftest%2Frun-pass%2Falt-pattern-no-type-params.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0/src%2Ftest%2Frun-pass%2Falt-pattern-no-type-params.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Falt-pattern-no-type-params.rs?ref=c7e3f88c93883ecbb27dcdfb7d8ec6e263b126b0", "patch": "@@ -0,0 +1,15 @@\n+// xfail-stage0\n+\n+tag maybe[T] {\n+  nothing;\n+  just(T);\n+}\n+\n+fn foo(maybe[int] x) {\n+  alt (x) {\n+    case (nothing) {log_err \"A\";}\n+    case (just(?a)) {log_err \"B\";}\n+  }\n+}\n+\n+fn main() {}"}]}