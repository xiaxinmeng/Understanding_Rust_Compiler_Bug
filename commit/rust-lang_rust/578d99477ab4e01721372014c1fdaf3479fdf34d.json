{"sha": "578d99477ab4e01721372014c1fdaf3479fdf34d", "node_id": "C_kwDOAAsO6NoAKDU3OGQ5OTQ3N2FiNGUwMTcyMTM3MjAxNGMxZmRhZjM0NzlmZGYzNGQ", "commit": {"author": {"name": "Luna Razzaghipour", "email": "lunarazzaghipour@gmail.com", "date": "2023-05-24T14:16:52Z"}, "committer": {"name": "Luna Razzaghipour", "email": "lunarazzaghipour@gmail.com", "date": "2023-05-24T14:16:52Z"}, "message": "Move on-type formatting request handler onto the main thread", "tree": {"sha": "873e4ca85cc9ffab7b2e5bed0292e0975792593a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/873e4ca85cc9ffab7b2e5bed0292e0975792593a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/578d99477ab4e01721372014c1fdaf3479fdf34d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN SSH SIGNATURE-----\nU1NIU0lHAAAAAQAAAGgAAAATZWNkc2Etc2hhMi1uaXN0cDI1NgAAAAhuaXN0cDI1NgAAAE\nEEtPEPU+w9oQ90uLBc4R0g0O7C/w+fcT4a+R4nvkvJXioSPGOafBHNQJufyTj3tLLeNtO4\n1H9ztJfn/DlLu2mXigAAAANnaXQAAAAAAAAABnNoYTUxMgAAAGMAAAATZWNkc2Etc2hhMi\n1uaXN0cDI1NgAAAEgAAAAgEOp+K53GgYnlfcTPGnesB0lSGvGXWLVwPzQ/bncyKwMAAAAg\nLJMfqAdHaRxhRRZU/JR86Egvbmm+HY9X+8G4Z1Wtjgo=\n-----END SSH SIGNATURE-----", "payload": "tree 873e4ca85cc9ffab7b2e5bed0292e0975792593a\nparent a41624829684b6c5221b0d68a9dc99e8bd8ab241\nauthor Luna Razzaghipour <lunarazzaghipour@gmail.com> 1684937812 +1000\ncommitter Luna Razzaghipour <lunarazzaghipour@gmail.com> 1684937812 +1000\n\nMove on-type formatting request handler onto the main thread\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/578d99477ab4e01721372014c1fdaf3479fdf34d", "html_url": "https://github.com/rust-lang/rust/commit/578d99477ab4e01721372014c1fdaf3479fdf34d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/578d99477ab4e01721372014c1fdaf3479fdf34d/comments", "author": {"login": "lunacookies", "id": 31783266, "node_id": "MDQ6VXNlcjMxNzgzMjY2", "avatar_url": "https://avatars.githubusercontent.com/u/31783266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunacookies", "html_url": "https://github.com/lunacookies", "followers_url": "https://api.github.com/users/lunacookies/followers", "following_url": "https://api.github.com/users/lunacookies/following{/other_user}", "gists_url": "https://api.github.com/users/lunacookies/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunacookies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunacookies/subscriptions", "organizations_url": "https://api.github.com/users/lunacookies/orgs", "repos_url": "https://api.github.com/users/lunacookies/repos", "events_url": "https://api.github.com/users/lunacookies/events{/privacy}", "received_events_url": "https://api.github.com/users/lunacookies/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lunacookies", "id": 31783266, "node_id": "MDQ6VXNlcjMxNzgzMjY2", "avatar_url": "https://avatars.githubusercontent.com/u/31783266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunacookies", "html_url": "https://github.com/lunacookies", "followers_url": "https://api.github.com/users/lunacookies/followers", "following_url": "https://api.github.com/users/lunacookies/following{/other_user}", "gists_url": "https://api.github.com/users/lunacookies/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunacookies/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunacookies/subscriptions", "organizations_url": "https://api.github.com/users/lunacookies/orgs", "repos_url": "https://api.github.com/users/lunacookies/repos", "events_url": "https://api.github.com/users/lunacookies/events{/privacy}", "received_events_url": "https://api.github.com/users/lunacookies/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a41624829684b6c5221b0d68a9dc99e8bd8ab241", "url": "https://api.github.com/repos/rust-lang/rust/commits/a41624829684b6c5221b0d68a9dc99e8bd8ab241", "html_url": "https://github.com/rust-lang/rust/commit/a41624829684b6c5221b0d68a9dc99e8bd8ab241"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "7464c47a9f339f8bd0d065b84e0268a1fc19d7f5", "filename": "crates/rust-analyzer/src/main_loop.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/578d99477ab4e01721372014c1fdaf3479fdf34d/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/578d99477ab4e01721372014c1fdaf3479fdf34d/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fmain_loop.rs?ref=578d99477ab4e01721372014c1fdaf3479fdf34d", "patch": "@@ -652,14 +652,20 @@ impl GlobalState {\n         use crate::handlers::request as handlers;\n \n         dispatcher\n+            // Request handlers that must run on the main thread\n+            // because they mutate GlobalState:\n             .on_sync_mut::<lsp_ext::ReloadWorkspace>(handlers::handle_workspace_reload)\n             .on_sync_mut::<lsp_ext::RebuildProcMacros>(handlers::handle_proc_macros_rebuild)\n             .on_sync_mut::<lsp_ext::MemoryUsage>(handlers::handle_memory_usage)\n             .on_sync_mut::<lsp_ext::ShuffleCrateGraph>(handlers::handle_shuffle_crate_graph)\n+            // Request handlers which are related to the user typing\n+            // are run on the main thread to reduce latency:\n             .on_sync::<lsp_ext::JoinLines>(handlers::handle_join_lines)\n             .on_sync::<lsp_ext::OnEnter>(handlers::handle_on_enter)\n             .on_sync::<lsp_types::request::SelectionRangeRequest>(handlers::handle_selection_range)\n             .on_sync::<lsp_ext::MatchingBrace>(handlers::handle_matching_brace)\n+            .on_sync::<lsp_ext::OnTypeFormatting>(handlers::handle_on_type_formatting)\n+            // All other request handlers:\n             .on::<lsp_ext::FetchDependencyList>(handlers::fetch_dependency_list)\n             .on::<lsp_ext::AnalyzerStatus>(handlers::handle_analyzer_status)\n             .on::<lsp_ext::SyntaxTree>(handlers::handle_syntax_tree)\n@@ -680,7 +686,6 @@ impl GlobalState {\n             .on::<lsp_ext::OpenCargoToml>(handlers::handle_open_cargo_toml)\n             .on::<lsp_ext::MoveItem>(handlers::handle_move_item)\n             .on::<lsp_ext::WorkspaceSymbol>(handlers::handle_workspace_symbol)\n-            .on::<lsp_ext::OnTypeFormatting>(handlers::handle_on_type_formatting)\n             .on::<lsp_types::request::DocumentSymbolRequest>(handlers::handle_document_symbol)\n             .on::<lsp_types::request::GotoDefinition>(handlers::handle_goto_definition)\n             .on::<lsp_types::request::GotoDeclaration>(handlers::handle_goto_declaration)"}]}