{"sha": "82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyYTFiOTFmMjA1YWM5YzNkMzk3YjJiZWEwMzM2MzlmNWRmOWU2YjY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-10T11:38:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-10T11:38:56Z"}, "message": "Merge #7625\n\n7625: Add **Copy Run Command Line** command for vscode r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "4683820d7a28c6bc991992a8c1978c3bf87b1b61", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4683820d7a28c6bc991992a8c1978c3bf87b1b61"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgI8XQCRBK7hj4Ov3rIwAAdHIIAG6go9I+QlfI2YbIlZ632xZl\nsDuUVKBxO8cC6IFBzlSImPj85qBXyuWYDKXFxZfXvxhk45ojblreaUYTgbyz/zEM\nlKzMs+ezWrhnNUyqS2s0APtv0bN7K2AmcLEaUZfV7S9XeQGH9ay2755TNMwk4Go2\nuWPyj0e7QF1aJ7KR5oMwymitekP4LWuT74s4XKuWNiFV1VaKRI+SbEWi3e/NqYfs\n53QvCBkNp/Bbj+GFQTYo9Ml5VZqy+L+GKGpueYQYiLcxSFt3rePCyADk1tmuJpaF\nepjNZEBElRI/p+zNqnRIsdj6mF8sTszMc4t1TXx8JCMaIoAqWHS/bTxKx5WtCxI=\n=b/8w\n-----END PGP SIGNATURE-----\n", "payload": "tree 4683820d7a28c6bc991992a8c1978c3bf87b1b61\nparent 5e39d7a68032ba40d3ed76d41d0f01ad628f5c95\nparent 97166e2ad9307b3f4cca33d2c82149be9eb5a633\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1612957136 +0000\ncommitter GitHub <noreply@github.com> 1612957136 +0000\n\nMerge #7625\n\n7625: Add **Copy Run Command Line** command for vscode r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "html_url": "https://github.com/rust-lang/rust/commit/82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e39d7a68032ba40d3ed76d41d0f01ad628f5c95", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e39d7a68032ba40d3ed76d41d0f01ad628f5c95", "html_url": "https://github.com/rust-lang/rust/commit/5e39d7a68032ba40d3ed76d41d0f01ad628f5c95"}, {"sha": "97166e2ad9307b3f4cca33d2c82149be9eb5a633", "url": "https://api.github.com/repos/rust-lang/rust/commits/97166e2ad9307b3f4cca33d2c82149be9eb5a633", "html_url": "https://github.com/rust-lang/rust/commit/97166e2ad9307b3f4cca33d2c82149be9eb5a633"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "55825456ec55fb15642d7ab201073a4cf2380277", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "patch": "@@ -133,6 +133,11 @@\n                 \"title\": \"Run\",\n                 \"category\": \"Rust Analyzer\"\n             },\n+            {\n+                \"command\": \"rust-analyzer.copyRunCommandLine\",\n+                \"title\": \"Copy Run Command Line\",\n+                \"category\": \"Rust Analyzer\"\n+            },\n             {\n                 \"command\": \"rust-analyzer.debug\",\n                 \"title\": \"Debug\","}, {"sha": "283b9a160c2f45cca09ee8df548780bafc737bd8", "filename": "editors/code/src/commands.ts", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Fcommands.ts", "raw_url": "https://github.com/rust-lang/rust/raw/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Fcommands.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fcommands.ts?ref=82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "patch": "@@ -5,7 +5,7 @@ import * as ra from './lsp_ext';\n import { Ctx, Cmd } from './ctx';\n import { applySnippetWorkspaceEdit, applySnippetTextEdits } from './snippets';\n import { spawnSync } from 'child_process';\n-import { RunnableQuickPick, selectRunnable, createTask } from './run';\n+import { RunnableQuickPick, selectRunnable, createTask, createArgs } from './run';\n import { AstInspector } from './ast_inspector';\n import { isRustDocument, sleep, isRustEditor } from './util';\n import { startDebugSession, makeDebugConfig } from './debug';\n@@ -572,6 +572,18 @@ export function runSingle(ctx: Ctx): Cmd {\n     };\n }\n \n+export function copyRunCommandLine(ctx: Ctx) {\n+    let prevRunnable: RunnableQuickPick | undefined;\n+    return async () => {\n+        const item = await selectRunnable(ctx, prevRunnable);\n+        if (!item) return;\n+        const args = createArgs(item.runnable);\n+        const commandLine = [\"cargo\", ...args].join(\" \");\n+        await vscode.env.clipboard.writeText(commandLine);\n+        await vscode.window.showInformationMessage(\"Cargo invocation copied to the clipboard.\");\n+    };\n+}\n+\n export function debug(ctx: Ctx): Cmd {\n     let prevDebuggee: RunnableQuickPick | undefined;\n "}, {"sha": "d18d6c8a9f8f95cf423e6442fb29c555db86cde4", "filename": "editors/code/src/main.ts", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Fmain.ts", "raw_url": "https://github.com/rust-lang/rust/raw/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Fmain.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fmain.ts?ref=82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "patch": "@@ -108,6 +108,7 @@ async function tryActivate(context: vscode.ExtensionContext) {\n     ctx.registerCommand('viewHir', commands.viewHir);\n     ctx.registerCommand('expandMacro', commands.expandMacro);\n     ctx.registerCommand('run', commands.run);\n+    ctx.registerCommand('copyRunCommandLine', commands.copyRunCommandLine);\n     ctx.registerCommand('debug', commands.debug);\n     ctx.registerCommand('newDebugConfig', commands.newDebugConfig);\n     ctx.registerCommand('openDocs', commands.openDocs);"}, {"sha": "138e3f6863a3a2801b616ed5c1e84f5c20bfc627", "filename": "editors/code/src/run.ts", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Frun.ts", "raw_url": "https://github.com/rust-lang/rust/raw/82a1b91f205ac9c3d397b2bea033639f5df9e6b6/editors%2Fcode%2Fsrc%2Frun.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Frun.ts?ref=82a1b91f205ac9c3d397b2bea033639f5df9e6b6", "patch": "@@ -128,13 +128,7 @@ export async function createTask(runnable: ra.Runnable, config: Config): Promise\n         throw `Unexpected runnable kind: ${runnable.kind}`;\n     }\n \n-    const args = [...runnable.args.cargoArgs]; // should be a copy!\n-    if (runnable.args.cargoExtraArgs) {\n-        args.push(...runnable.args.cargoExtraArgs); // Append user-specified cargo options.\n-    }\n-    if (runnable.args.executableArgs.length > 0) {\n-        args.push('--', ...runnable.args.executableArgs);\n-    }\n+    const args = createArgs(runnable);\n \n     const definition: tasks.CargoTaskDefinition = {\n         type: tasks.TASK_TYPE,\n@@ -152,3 +146,14 @@ export async function createTask(runnable: ra.Runnable, config: Config): Promise\n \n     return cargoTask;\n }\n+\n+export function createArgs(runnable: ra.Runnable): string[] {\n+    const args = [...runnable.args.cargoArgs]; // should be a copy!\n+    if (runnable.args.cargoExtraArgs) {\n+        args.push(...runnable.args.cargoExtraArgs); // Append user-specified cargo options.\n+    }\n+    if (runnable.args.executableArgs.length > 0) {\n+        args.push('--', ...runnable.args.executableArgs);\n+    }\n+    return args;\n+}"}]}