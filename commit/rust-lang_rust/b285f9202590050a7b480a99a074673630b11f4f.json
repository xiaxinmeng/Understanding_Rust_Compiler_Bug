{"sha": "b285f9202590050a7b480a99a074673630b11f4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyODVmOTIwMjU5MDA1MGE3YjQ4MGE5OWEwNzQ2NzM2MzBiMTFmNGY=", "commit": {"author": {"name": "Seo Sanghyeon", "email": "sanxiyn@gmail.com", "date": "2015-10-24T09:42:23Z"}, "committer": {"name": "Seo Sanghyeon", "email": "sanxiyn@gmail.com", "date": "2015-10-24T09:42:23Z"}, "message": "rustllvm: Update to LLVM trunk", "tree": {"sha": "a7f6f8696fc7dbc51a42b612385e29354ce94c83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a7f6f8696fc7dbc51a42b612385e29354ce94c83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b285f9202590050a7b480a99a074673630b11f4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b285f9202590050a7b480a99a074673630b11f4f", "html_url": "https://github.com/rust-lang/rust/commit/b285f9202590050a7b480a99a074673630b11f4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b285f9202590050a7b480a99a074673630b11f4f/comments", "author": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e86485f7b9cc7f4dd702b4cd1c767e12d6d91eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e86485f7b9cc7f4dd702b4cd1c767e12d6d91eb", "html_url": "https://github.com/rust-lang/rust/commit/2e86485f7b9cc7f4dd702b4cd1c767e12d6d91eb"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "2cf6277e0572275481ec6aa02a7c93a52c0a1ee6", "filename": "src/rustllvm/ArchiveWrapper.cpp", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FArchiveWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FArchiveWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FArchiveWrapper.cpp?ref=b285f9202590050a7b480a99a074673630b11f4f", "patch": "@@ -163,12 +163,20 @@ LLVMRustWriteArchive(char *Dst,\n     auto Member = NewMembers[i];\n     assert(Member->name);\n     if (Member->filename) {\n+#if LLVM_VERSION_MINOR >= 8\n+      Members.push_back(NewArchiveIterator(Member->filename));\n+#else\n       Members.push_back(NewArchiveIterator(Member->filename, Member->name));\n+#endif\n     } else {\n       Members.push_back(NewArchiveIterator(Member->child, Member->name));\n     }\n   }\n+#if LLVM_VERSION_MINOR >= 8\n+  auto pair = writeArchive(Dst, Members, WriteSymbtab, Kind, true, false);\n+#else\n   auto pair = writeArchive(Dst, Members, WriteSymbtab, Kind, true);\n+#endif\n   if (!pair.second)\n     return 0;\n   LLVMRustSetLastError(pair.second.message().c_str());"}, {"sha": "b27a622136f749f90ea50a70e3c459afe7517cf1", "filename": "src/rustllvm/PassWrapper.cpp", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FPassWrapper.cpp?ref=b285f9202590050a7b480a99a074673630b11f4f", "patch": "@@ -49,7 +49,9 @@ LLVMInitializePasses() {\n   initializeVectorization(Registry);\n   initializeIPO(Registry);\n   initializeAnalysis(Registry);\n+#if LLVM_VERSION_MINOR <= 7\n   initializeIPA(Registry);\n+#endif\n   initializeTransformUtils(Registry);\n   initializeInstCombine(Registry);\n   initializeInstrumentation(Registry);"}, {"sha": "5a9c096e5f54339499bbe8a5a14af16c7a8efd6a", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b285f9202590050a7b480a99a074673630b11f4f/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=b285f9202590050a7b480a99a074673630b11f4f", "patch": "@@ -320,7 +320,9 @@ extern \"C\" LLVMMetadataRef LLVMDIBuilderCreateSubroutineType(\n     LLVMMetadataRef File,\n     LLVMMetadataRef ParameterTypes) {\n     return wrap(Builder->createSubroutineType(\n+#if LLVM_VERSION_MINOR <= 7\n         unwrapDI<DIFile>(File),\n+#endif\n #if LLVM_VERSION_MINOR >= 7\n         DITypeRefArray(unwrap<MDTuple>(ParameterTypes))));\n #elif LLVM_VERSION_MINOR >= 6\n@@ -502,11 +504,27 @@ extern \"C\" LLVMMetadataRef LLVMDIBuilderCreateVariable(\n         ));\n     }\n #endif\n+#if LLVM_VERSION_MINOR >= 8\n+    if (Tag == 0x100) { // DW_TAG_auto_variable\n+        return wrap(Builder->createAutoVariable(\n+            unwrapDI<DIDescriptor>(Scope), Name,\n+            unwrapDI<DIFile>(File),\n+            LineNo,\n+            unwrapDI<DIType>(Ty), AlwaysPreserve, Flags));\n+    } else {\n+        return wrap(Builder->createParameterVariable(\n+            unwrapDI<DIDescriptor>(Scope), Name, ArgNo,\n+            unwrapDI<DIFile>(File),\n+            LineNo,\n+            unwrapDI<DIType>(Ty), AlwaysPreserve, Flags));\n+    }\n+#else\n     return wrap(Builder->createLocalVariable(Tag,\n         unwrapDI<DIDescriptor>(Scope), Name,\n         unwrapDI<DIFile>(File),\n         LineNo,\n         unwrapDI<DIType>(Ty), AlwaysPreserve, Flags, ArgNo));\n+#endif\n }\n \n extern \"C\" LLVMMetadataRef LLVMDIBuilderCreateArrayType("}]}