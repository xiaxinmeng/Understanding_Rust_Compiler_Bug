{"sha": "b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxMGM1MzAzMWFiODdmYzM2ZmQwNjY2NDY3ZjVkZDM3YjdmMmNhZDE=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-11-17T15:01:30Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-11-18T09:38:07Z"}, "message": "fix benchmarks and add benchmarks for repeat expressions", "tree": {"sha": "6401d16179206cc1d71a391bc3a146a585709eda", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6401d16179206cc1d71a391bc3a146a585709eda"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJYLsv/AAoJEFbW7qD8Z6xG/8oP/A5PtIOhhtzwtkXKAsExgdH8\nF8S8lwGGt/+Nwaz1MRNJ5dM2uZkwNdG8DusfjV42NdPY84MDsN8JF227Vivk6RBM\nuugAV4E3quyL/TGBBYIVTsIz1uFM17MlW1pqxMlVpJ6/opfN5QfdNTAacROBIBbZ\ngn+DhVIL0ENSyhZxCucDWmWu9l126kuhL6pIffd65pmlhwfcNTDMnscyhUW41/VJ\nZGRlBt+1hUfPHof9AfKO5x8OqRHnwLxwgEzq8gC2dFps9OhJsRQj/2thEOhnQymw\nXBIRbBzzQsiB8SDnl8TmJ9B5UkZw08GDpsjYB+ceozhLJ493GPpd4SypCcjwdoM/\nk6TXIZZgNiDA/qIHDrzB7ZblUOy29EqcwU+UgIfLW2RURwxLaVeBk099syDwo2Nu\nYKXjP6h2Lt5ZmP3N3xk65m/HvNW4f/MsJ7qar5LYvpbnHYosz4oEmiajS3bkzdsv\nIj1e01ydBI2zbOLSae9TRtboDGeet52IHPw5K5TRicFpxQuwBpLIiArP4G44ZJbE\nnh8R0f3aBkQsm7Ywm0Rt8Z1xHpNATO2pUrx3qsvC1iZIJHEaYZf0+OVZfdtWY/gq\n8LeCYpCH36XVK9jNlj1NnJkjFUHdZ+wqKlBfcltd9eYa/6vlLTwWs/m38N7CYqT/\n0ErEWAzp1AJhBOzTYEZ5\n=9vZI\n-----END PGP SIGNATURE-----", "payload": "tree 6401d16179206cc1d71a391bc3a146a585709eda\nparent fd6a90860c97442df45101ee15ca4637b5ab963f\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1479394890 +0100\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1479461887 +0100\n\nfix benchmarks and add benchmarks for repeat expressions"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "html_url": "https://github.com/rust-lang/rust/commit/b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fd6a90860c97442df45101ee15ca4637b5ab963f", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd6a90860c97442df45101ee15ca4637b5ab963f", "html_url": "https://github.com/rust-lang/rust/commit/fd6a90860c97442df45101ee15ca4637b5ab963f"}], "stats": {"total": 41, "additions": 35, "deletions": 6}, "files": [{"sha": "3725df24cdca7e8d8a8047a241b46342c4823469", "filename": "benches/helpers/miri_helper.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Fmiri_helper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Fmiri_helper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fhelpers%2Fmiri_helper.rs?ref=b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "patch": "@@ -33,7 +33,7 @@ pub fn run(filename: &str, bencher: &mut Bencher) {\n         find_sysroot()\n     ];\n     let compiler_calls = &mut MiriCompilerCalls(Rc::new(RefCell::new(bencher)));\n-    rustc_driver::run_compiler(args, compiler_calls);\n+    rustc_driver::run_compiler(args, compiler_calls, None, None);\n }\n \n impl<'a> CompilerCalls<'a> for MiriCompilerCalls<'a> {\n@@ -51,13 +51,15 @@ impl<'a> CompilerCalls<'a> for MiriCompilerCalls<'a> {\n             state.session.abort_if_errors();\n \n             let tcx = state.tcx.unwrap();\n-            let mir_map = state.mir_map.unwrap();\n-            let (node_id, _) = state.session.entry_fn.borrow()\n+            let (entry_node_id, _) = state.session.entry_fn.borrow()\n                 .expect(\"no main or start function found\");\n+            let entry_def_id = tcx.map.local_def_id(entry_node_id);\n \n-            let mut mir_map = MirMap { map: mir_map.map.clone() };\n-            run_mir_passes(tcx, &mut mir_map);\n-            bencher.borrow_mut().iter(|| { eval_main(tcx, &mir_map, node_id); });\n+            run_mir_passes(tcx);\n+            let memory_size = 100*1024*1024; // 100MB\n+            let step_limit = 1000_000;\n+            let stack_limit = 100;\n+            bencher.borrow_mut().iter(|| { eval_main(tcx, entry_def_id, memory_size, step_limit, stack_limit); });\n \n             state.session.abort_if_errors();\n         });"}, {"sha": "0e8c5980b82bdec0f7072a775997b0837f2d8b14", "filename": "benches/helpers/repeat.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Frepeat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Frepeat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fhelpers%2Frepeat.rs?ref=b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    let data: [u8; 1024] = [42; 1024];\n+    assert_eq!(data.len(), 1024);\n+}"}, {"sha": "6ef6f724efceee8a04d50541dbee22f63c09e45c", "filename": "benches/helpers/repeat_manual.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Frepeat_manual.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Fhelpers%2Frepeat_manual.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fhelpers%2Frepeat_manual.rs?ref=b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "patch": "@@ -0,0 +1,7 @@\n+fn main() {\n+    let mut data: [u8; 1024] = unsafe { std::mem::uninitialized() };\n+    for i in 0..data.len() {\n+        unsafe { std::ptr::write(&mut data[i], 0); }\n+    }\n+    assert_eq!(data.len(), 1024);\n+}"}, {"sha": "f5920e83d9b07b1d2462072c02f67339ecb37375", "filename": "benches/repeat.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Frepeat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b10c53031ab87fc36fd0666467f5dd37b7f2cad1/benches%2Frepeat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Frepeat.rs?ref=b10c53031ab87fc36fd0666467f5dd37b7f2cad1", "patch": "@@ -0,0 +1,16 @@\n+#![feature(test, rustc_private)]\n+\n+extern crate test;\n+use test::Bencher;\n+mod helpers;\n+use helpers::*;\n+\n+#[bench]\n+fn repeat(bencher: &mut Bencher) {\n+    miri_helper::run(\"repeat\", bencher);\n+}\n+\n+#[bench]\n+fn repeat_manual(bencher: &mut Bencher) {\n+    miri_helper::run(\"repeat_manual\", bencher);\n+}"}]}