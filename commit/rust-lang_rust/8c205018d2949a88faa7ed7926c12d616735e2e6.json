{"sha": "8c205018d2949a88faa7ed7926c12d616735e2e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjMjA1MDE4ZDI5NDlhODhmYWE3ZWQ3OTI2YzEyZDYxNjczNWUyZTY=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-10-11T12:33:42Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-10-24T09:47:00Z"}, "message": "Update clippy_dev", "tree": {"sha": "3bb06a2f4b0484fbb6bfa26fc0379a2f20655d2e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bb06a2f4b0484fbb6bfa26fc0379a2f20655d2e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c205018d2949a88faa7ed7926c12d616735e2e6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl2xcxQACgkQaTCGhp1Q\nZjd2og//WREBQyzofNTjNd2lDPg0rCnJ7XK0ZvRceRLKk71CUVvql7+6Dv7fgqBi\ntAg8bLYiH5RsImJAuvYITvYZz5YYwLfCBSibszwblJn05LkWdXL1zomKEERCra9b\nFXOCQjIgmvsQJrKUBD2RgYlbc3Ng25Iut+GXAzQjx+A0wLSg4ggyuM/jljtRhBZ3\nDAk+BBSBUurcewx6WArEUtpj4siZIgKd7GOOJgAgmxoqGDbuzvUOLD+38Uu5WrqL\nUCdyyF+5z0MiL8djn2T9ZJx+jlw9kWx7laC0NoWhey8U+0Kh9iPd5LiAeyzPFFNz\nACh4pehUO/HA9BhOwBdlE3gwwDSVMve0z4tBpTdoFXLk8tY0swsGHPCPUV+tH8wS\noSsEyZq9PY0w24ztFvYfwTxWhvY8Z2WbOO2nlR+eTRr1dFBOw6rJLyHgZSz6n0Ix\nSzvO5Lx0MWzuWyIHlgc8/Iq0LK6m6TYGy8BBs0I6IHRyKbSj6C4BVjCuR1/+3zoj\nCcUTtWa9rpU5LJUm7Wd0qZtqcc48C8/DOBYg24r8e74bBiACL+PqBh/eVtUSQH7C\nqPLnAzqqup3JhzTfu8DYpmN6zTjaZjZaUMPtI0QOHBkEpDSvJyIUrxGDwrr35gDw\nTpC/SdnPW4roTOD8T8shgnOKqxHevbJRvi4L6eCpjsLIUg5TcuI=\n=pY8V\n-----END PGP SIGNATURE-----", "payload": "tree 3bb06a2f4b0484fbb6bfa26fc0379a2f20655d2e\nparent 7e77f3c29f9221ccd785aa99ffd8b6180d4c063d\nauthor Mark Rousskov <mark.simulacrum@gmail.com> 1570797222 -0400\ncommitter flip1995 <hello@philkrones.com> 1571910420 +0200\n\nUpdate clippy_dev\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c205018d2949a88faa7ed7926c12d616735e2e6", "html_url": "https://github.com/rust-lang/rust/commit/8c205018d2949a88faa7ed7926c12d616735e2e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c205018d2949a88faa7ed7926c12d616735e2e6/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e77f3c29f9221ccd785aa99ffd8b6180d4c063d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e77f3c29f9221ccd785aa99ffd8b6180d4c063d", "html_url": "https://github.com/rust-lang/rust/commit/7e77f3c29f9221ccd785aa99ffd8b6180d4c063d"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "7423b34f2039bb3fbfa9c1da3aa93005e011bbdf", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/8c205018d2949a88faa7ed7926c12d616735e2e6/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c205018d2949a88faa7ed7926c12d616735e2e6/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=8c205018d2949a88faa7ed7926c12d616735e2e6", "patch": "@@ -82,7 +82,7 @@ pub fn gen_lint_group_list(lints: Vec<Lint>) -> Vec<String> {\n             if l.is_internal() || l.deprecation.is_some() {\n                 None\n             } else {\n-                Some(format!(\"        {}::{},\", l.module, l.name.to_uppercase()))\n+                Some(format!(\"        LintId::of(&{}::{}),\", l.module, l.name.to_uppercase()))\n             }\n         })\n         .sorted()\n@@ -143,6 +143,20 @@ pub fn gen_deprecated(lints: &[Lint]) -> Vec<String> {\n         .collect::<Vec<String>>()\n }\n \n+pub fn gen_register_lint_list(lints: &[Lint]) -> Vec<String> {\n+    let pre = \"    store.register_lints(&[\".to_string();\n+    let post = \"    ]);\".to_string();\n+    let mut inner = lints\n+        .iter()\n+        .filter(|l| !(l.is_internal() || l.deprecation.is_some()))\n+        .map(|l| format!(\"        &{}::{},\", l.module, l.name.to_uppercase()))\n+        .sorted()\n+        .collect::<Vec<String>>();\n+    inner.insert(0, pre);\n+    inner.push(post);\n+    inner\n+}\n+\n /// Gathers all files in `src/clippy_lints` and gathers all lints inside\n pub fn gather_all() -> impl Iterator<Item = Lint> {\n     lint_files().flat_map(|f| gather_from_file(&f))\n@@ -487,8 +501,8 @@ fn test_gen_lint_group_list() {\n         Lint::new(\"incorrect_internal\", \"internal_style\", \"abc\", None, \"module_name\"),\n     ];\n     let expected = vec![\n-        \"        module_name::ABC,\".to_string(),\n-        \"        module_name::SHOULD_ASSERT_EQ,\".to_string(),\n+        \"        LintId::of(&module_name::ABC),\".to_string(),\n+        \"        LintId::of(&module_name::SHOULD_ASSERT_EQ),\".to_string(),\n     ];\n     assert_eq!(expected, gen_lint_group_list(lints));\n }"}, {"sha": "f088504f5cd9a37b6d168a82af7250b9847ad3d0", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/8c205018d2949a88faa7ed7926c12d616735e2e6/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c205018d2949a88faa7ed7926c12d616735e2e6/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=8c205018d2949a88faa7ed7926c12d616735e2e6", "patch": "@@ -67,7 +67,7 @@ fn main() {\n     match matches.subcommand() {\n         (\"fmt\", Some(matches)) => {\n             fmt::run(matches.is_present(\"check\"), matches.is_present(\"verbose\"));\n-        },\n+        }\n         (\"update_lints\", Some(matches)) => {\n             if matches.is_present(\"print-only\") {\n                 print_lints();\n@@ -76,8 +76,8 @@ fn main() {\n             } else {\n                 update_lints(&UpdateMode::Change);\n             }\n-        },\n-        _ => {},\n+        }\n+        _ => {}\n     }\n }\n \n@@ -170,6 +170,16 @@ fn update_lints(update_mode: &UpdateMode) {\n     )\n     .changed;\n \n+    file_change |= replace_region_in_file(\n+        \"../clippy_lints/src/lib.rs\",\n+        \"begin register lints\",\n+        \"end register lints\",\n+        false,\n+        update_mode == &UpdateMode::Change,\n+        || gen_register_lint_list(&lint_list),\n+    )\n+    .changed;\n+\n     file_change |= replace_region_in_file(\n         \"../clippy_lints/src/lib.rs\",\n         \"begin lints modules\",\n@@ -183,7 +193,7 @@ fn update_lints(update_mode: &UpdateMode) {\n     // Generate lists of lints in the clippy::all lint group\n     file_change |= replace_region_in_file(\n         \"../clippy_lints/src/lib.rs\",\n-        r#\"reg.register_lint_group\\(\"clippy::all\"\"#,\n+        r#\"store.register_group\\(true, \"clippy::all\"\"#,\n         r#\"\\]\\);\"#,\n         false,\n         update_mode == &UpdateMode::Change,\n@@ -206,7 +216,7 @@ fn update_lints(update_mode: &UpdateMode) {\n     for (lint_group, lints) in Lint::by_lint_group(&usable_lints) {\n         file_change |= replace_region_in_file(\n             \"../clippy_lints/src/lib.rs\",\n-            &format!(\"reg.register_lint_group\\\\(\\\"clippy::{}\\\"\", lint_group),\n+            &format!(\"store.register_group\\\\(true, \\\"clippy::{}\\\"\", lint_group),\n             r#\"\\]\\);\"#,\n             false,\n             update_mode == &UpdateMode::Change,"}]}