{"sha": "dcd02ab683f502ded270ee59d8b8ac2dc33908a4", "node_id": "C_kwDOAAsO6NoAKGRjZDAyYWI2ODNmNTAyZGVkMjcwZWU1OWQ4YjhhYzJkYzMzOTA4YTQ", "commit": {"author": {"name": "Krasimir Georgiev", "email": "krasimir@google.com", "date": "2022-07-20T12:56:42Z"}, "committer": {"name": "Krasimir Georgiev", "email": "krasimir@google.com", "date": "2022-07-20T12:56:42Z"}, "message": "adapt assembly/static-relocation-model test for LLVM change\n\nAfter\nhttps://github.com/llvm/llvm-project/commit/f0dd12ec5c0169ba5b4363b62d59511181cf954a,\nLLVM emits `movzbl` instead. Adapted this test case accordingly.\n\nDiscovered in our experimental rust + llvm at head ci:\nhttps://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/12104#0182195b-8791-4f88-853c-bb23a1e4b54c", "tree": {"sha": "c3af78b765156bf76cdaee96dddc19886e10e8c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c3af78b765156bf76cdaee96dddc19886e10e8c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dcd02ab683f502ded270ee59d8b8ac2dc33908a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dcd02ab683f502ded270ee59d8b8ac2dc33908a4", "html_url": "https://github.com/rust-lang/rust/commit/dcd02ab683f502ded270ee59d8b8ac2dc33908a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dcd02ab683f502ded270ee59d8b8ac2dc33908a4/comments", "author": {"login": "krasimirgg", "id": 29306214, "node_id": "MDQ6VXNlcjI5MzA2MjE0", "avatar_url": "https://avatars.githubusercontent.com/u/29306214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krasimirgg", "html_url": "https://github.com/krasimirgg", "followers_url": "https://api.github.com/users/krasimirgg/followers", "following_url": "https://api.github.com/users/krasimirgg/following{/other_user}", "gists_url": "https://api.github.com/users/krasimirgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/krasimirgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krasimirgg/subscriptions", "organizations_url": "https://api.github.com/users/krasimirgg/orgs", "repos_url": "https://api.github.com/users/krasimirgg/repos", "events_url": "https://api.github.com/users/krasimirgg/events{/privacy}", "received_events_url": "https://api.github.com/users/krasimirgg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "krasimirgg", "id": 29306214, "node_id": "MDQ6VXNlcjI5MzA2MjE0", "avatar_url": "https://avatars.githubusercontent.com/u/29306214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krasimirgg", "html_url": "https://github.com/krasimirgg", "followers_url": "https://api.github.com/users/krasimirgg/followers", "following_url": "https://api.github.com/users/krasimirgg/following{/other_user}", "gists_url": "https://api.github.com/users/krasimirgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/krasimirgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krasimirgg/subscriptions", "organizations_url": "https://api.github.com/users/krasimirgg/orgs", "repos_url": "https://api.github.com/users/krasimirgg/repos", "events_url": "https://api.github.com/users/krasimirgg/events{/privacy}", "received_events_url": "https://api.github.com/users/krasimirgg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b", "html_url": "https://github.com/rust-lang/rust/commit/748cb1f01d623f2afd0d8b84fda7e2c8f7a11c7b"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "faa2e3952096dbe5571619770419b9fb385567b5", "filename": "src/test/assembly/static-relocation-model.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/dcd02ab683f502ded270ee59d8b8ac2dc33908a4/src%2Ftest%2Fassembly%2Fstatic-relocation-model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dcd02ab683f502ded270ee59d8b8ac2dc33908a4/src%2Ftest%2Fassembly%2Fstatic-relocation-model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fassembly%2Fstatic-relocation-model.rs?ref=dcd02ab683f502ded270ee59d8b8ac2dc33908a4", "patch": "@@ -36,7 +36,8 @@ extern \"C\" {\n }\n \n // CHECK-LABEL: banana:\n-// x64: movb   chaenomeles{{(\\(%[a-z0-9]+\\))?}}, %{{[a-z0-9]+}}\n+// On the next line LLVM 14 produces a `movb`, whereas LLVM 15+ produces a `movzbl`.\n+// x64: {{movb|movzbl}}   chaenomeles{{(\\(%[a-z0-9]+\\))?}}, %{{[a-z0-9]+}}\n // A64:      adrp    [[REG:[a-z0-9]+]], chaenomeles\n // A64-NEXT: ldrb    {{[a-z0-9]+}}, {{\\[}}[[REG]], :lo12:chaenomeles]\n #[no_mangle]\n@@ -47,7 +48,7 @@ pub fn banana() -> u8 {\n }\n \n // CHECK-LABEL: peach:\n-// x64: movb    banana{{(\\(%[a-z0-9]+\\))?}}, %{{[a-z0-9]+}}\n+// x64: {{movb|movzbl}}    banana{{(\\(%[a-z0-9]+\\))?}}, %{{[a-z0-9]+}}\n // A64:      adrp    [[REG2:[a-z0-9]+]], banana\n // A64-NEXT: ldrb    {{[a-z0-9]+}}, {{\\[}}[[REG2]], :lo12:banana]\n #[no_mangle]\n@@ -59,7 +60,7 @@ pub fn peach() -> u8 {\n \n // CHECK-LABEL: mango:\n // x64:      movq    EXOCHORDA{{(\\(%[a-z0-9]+\\))?}}, %[[REG:[a-z0-9]+]]\n-// x64-NEXT: movb    (%[[REG]]), %{{[a-z0-9]+}}\n+// x64-NEXT: {{movb|movzbl}}   (%[[REG]]), %{{[a-z0-9]+}}\n // A64:      adrp    [[REG2:[a-z0-9]+]], EXOCHORDA\n // A64-NEXT: ldr     {{[a-z0-9]+}}, {{\\[}}[[REG2]], :lo12:EXOCHORDA]\n #[no_mangle]"}]}