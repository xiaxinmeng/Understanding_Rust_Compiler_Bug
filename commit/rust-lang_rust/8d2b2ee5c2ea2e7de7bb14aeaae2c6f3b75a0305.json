{"sha": "8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkMmIyZWU1YzJlYTJlN2RlN2JiMTRhZWFhZTJjNmYzYjc1YTAzMDU=", "commit": {"author": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-10-16T11:56:02Z"}, "committer": {"name": "Hideki Sekine", "email": "sekineh@me.com", "date": "2018-10-16T11:56:02Z"}, "message": "[ci] run-make/thumb-none-qemu: add example crate.", "tree": {"sha": "7d1f6caeaad0208a9897e24024dac28de299a7b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d1f6caeaad0208a9897e24024dac28de299a7b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "html_url": "https://github.com/rust-lang/rust/commit/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/comments", "author": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sekineh", "id": 3956266, "node_id": "MDQ6VXNlcjM5NTYyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/3956266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sekineh", "html_url": "https://github.com/sekineh", "followers_url": "https://api.github.com/users/sekineh/followers", "following_url": "https://api.github.com/users/sekineh/following{/other_user}", "gists_url": "https://api.github.com/users/sekineh/gists{/gist_id}", "starred_url": "https://api.github.com/users/sekineh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sekineh/subscriptions", "organizations_url": "https://api.github.com/users/sekineh/orgs", "repos_url": "https://api.github.com/users/sekineh/repos", "events_url": "https://api.github.com/users/sekineh/events{/privacy}", "received_events_url": "https://api.github.com/users/sekineh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a4faa5ef7319ea6b457fee233a0699569c393f7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a4faa5ef7319ea6b457fee233a0699569c393f7a", "html_url": "https://github.com/rust-lang/rust/commit/a4faa5ef7319ea6b457fee233a0699569c393f7a"}], "stats": {"total": 87, "additions": 79, "deletions": 8}, "files": [{"sha": "75c17372bc238171f65b218ad72c5da941812e69", "filename": "src/test/run-make/thumb-none-qemu/Makefile", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2FMakefile?ref=8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "patch": "@@ -8,11 +8,21 @@ ifneq (,$(filter $(TARGET),thumbv6m-none-eabi thumbv7m-none-eabi))\n \n # For cargo setting\n export RUSTC := $(RUSTC_ORIGINAL)\n-LD_LIBRARY_PATH := $(HOST_RPATH_DIR)\n+export LD_LIBRARY_PATH := $(HOST_RPATH_DIR)\n # We need to be outside of 'src' dir in order to run cargo\n export WORK_DIR := $(TMPDIR)\n export HERE := $(shell pwd)\n \n+## clean up unused env variables which might cause harm.\n+# unexport RUSTC_LINKER\n+# unexport RUSTC_BOOTSTRAP\n+# unexport RUST_BUILD_STAGE\n+# unexport RUST_TEST_THREADS\n+# unexport RUST_TEST_TMPDIR\n+# unexport AR\n+# unexport CC\n+# unexport CXX\n+\n all:\n \tbash script.sh\n else"}, {"sha": "499553304c681ae6eb9d3f1a35952807cfbcb8a6", "filename": "src/test/run-make/thumb-none-qemu/example/Cargo.toml", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2FCargo.toml?ref=8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "patch": "@@ -0,0 +1,11 @@\n+[package]\n+name = \"example\"\n+version = \"0.1.0\"\n+authors = [\"Hideki Sekine <sekineh@me.com>\"]\n+# edition = \"2018\"\n+\n+[dependencies]\n+cortex-m = \"0.5.4\"\n+cortex-m-rt = \"=0.5.4\"\n+panic-halt = \"0.2.0\"\n+cortex-m-semihosting = \"0.3.1\""}, {"sha": "dc7ad967a42a87978379cbaaea7f671264044f64", "filename": "src/test/run-make/thumb-none-qemu/example/memory.x", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fmemory.x", "raw_url": "https://github.com/rust-lang/rust/raw/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fmemory.x", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fmemory.x?ref=8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "patch": "@@ -0,0 +1,23 @@\n+/* Device specific memory layout */\n+\n+/* This file is used to build the cortex-m-rt examples,\n+   but not other applications using cortex-m-rt. */\n+\n+MEMORY\n+{\n+  /* FLASH and RAM are mandatory memory regions */\n+  /* Update examples/data_overflow.rs if you change these sizes. */\n+  FLASH : ORIGIN = 0x00000000, LENGTH = 256K\n+  RAM : ORIGIN = 0x20000000, LENGTH = 64K\n+\n+  /* More memory regions can declared: for example this is a second RAM region */\n+  /* CCRAM : ORIGIN = 0x10000000, LENGTH = 8K */\n+}\n+\n+/* The location of the stack can be overridden using the `_stack_start` symbol.\n+   By default it will be placed at the end of the RAM region */\n+/* _stack_start = ORIGIN(CCRAM) + LENGTH(CCRAM); */\n+\n+/* The location of the .text section can be overridden using the `_stext` symbol.\n+   By default it will place after .vector_table */\n+/* _stext = ORIGIN(FLASH) + 0x40c; */\n\\ No newline at end of file"}, {"sha": "e94aa74de5883ccb34e342850f3f9f6f7d0f33a7", "filename": "src/test/run-make/thumb-none-qemu/example/src/main.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fexample%2Fsrc%2Fmain.rs?ref=8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "patch": "@@ -0,0 +1,30 @@\n+// #![feature(stdsimd)]\n+#![no_main]\n+#![no_std]\n+\n+extern crate cortex_m;\n+\n+extern crate cortex_m_rt as rt;\n+extern crate cortex_m_semihosting as semihosting;\n+extern crate panic_halt;\n+\n+use core::fmt::Write;\n+use cortex_m::asm;\n+use rt::entry;\n+\n+entry!(main);\n+\n+fn main() -> ! {\n+    let x = 42;\n+\n+    loop {\n+        asm::nop();\n+\n+        // write something through semihosting interface\n+        let mut hstdout = semihosting::hio::hstdout().unwrap();\n+        write!(hstdout, \"x = {}\\n\", x);\n+\n+        // exit from qemu\n+        semihosting::debug::exit(semihosting::debug::EXIT_SUCCESS);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "5c46c4bd26dc0fca464ff52dd5a37b7f8d181e18", "filename": "src/test/run-make/thumb-none-qemu/script.sh", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fscript.sh", "raw_url": "https://github.com/rust-lang/rust/raw/8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fscript.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fthumb-none-qemu%2Fscript.sh?ref=8d2b2ee5c2ea2e7de7bb14aeaae2c6f3b75a0305", "patch": "@@ -1,16 +1,13 @@\n set -exuo pipefail\n \n-CRATE=cortex-m-rt\n-CRATE_URL=https://github.com/rust-embedded/cortex-m-rt\n-CRATE_SHA1=62972c8a89ff54b76f9ef0d600c1fcf7a233aabd\n+CRATE=example\n \n env | sort\n mkdir -p $WORK_DIR\n pushd $WORK_DIR\n     rm -rf $CRATE || echo OK\n-    bash -x $HERE/../git_clone_sha1.sh $CRATE $CRATE_URL $CRATE_SHA1\n+    cp -a $HERE/example .\n     pushd $CRATE\n-        $CARGO run --target $TARGET --example qemu           | grep \"x = 42\"\n-        $CARGO run --target $TARGET --example qemu --release | grep \"x = 42\"\n+        $CARGO run --target $TARGET\n     popd\n-popd\n\\ No newline at end of file\n+popd"}]}