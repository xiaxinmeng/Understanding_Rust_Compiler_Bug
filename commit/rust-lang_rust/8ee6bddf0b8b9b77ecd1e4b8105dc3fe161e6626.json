{"sha": "8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlZTZiZGRmMGI4YjliNzdlY2QxZTRiODEwNWRjM2ZlMTYxZTY2MjY=", "commit": {"author": {"name": "Ian Douglas Scott", "email": "ian@iandouglasscott.com", "date": "2017-06-30T00:22:36Z"}, "committer": {"name": "Ian Douglas Scott", "email": "ian@iandouglasscott.com", "date": "2017-06-30T00:43:44Z"}, "message": "redox: symlink and readlink", "tree": {"sha": "5f85c3975ea47839d749a0bc2f2a404ed02b50da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f85c3975ea47839d749a0bc2f2a404ed02b50da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEECYv1aaNg4jTOK4YaSSThDhmbWVkFAllVnsAACgkQSSThDhmb\nWVmnlwgAmejBgCrlUezvv6a75ajAZyabO9xYpkc5FWI156T2d93IMsombO8qZyIf\n+YoeK0wf78PtulYyN2bqgOPZfhHQmotaIdQtsCFPs3Ymd37g8nsAmFnGB8v3BZE2\nrl/iicP4mKHz4SKLgMNqZ0oL4S4bHQWMf69JtraMWo/LxqGsgA6ToNFIMrdWPlew\nmBtdleHg16UH4e+l2A2aqIOxzmyomp6MzBhjnthFeQ8gtJ6LtwiWJZFYxHyePLHR\nrmz3jjYOaxOZr74bLXrPs+UAhmy9O2c4GFnMEMCaDCGS9+0a726S+s04wtZ+gdPi\nMLjGqp/iLbZD1aXEegtR2PRqllYGkQ==\n=osVJ\n-----END PGP SIGNATURE-----", "payload": "tree 5f85c3975ea47839d749a0bc2f2a404ed02b50da\nparent 3bfc18a9619a5151ff4f11618db9cd882996ba6f\nauthor Ian Douglas Scott <ian@iandouglasscott.com> 1498782156 -0700\ncommitter Ian Douglas Scott <ian@iandouglasscott.com> 1498783424 -0700\n\nredox: symlink and readlink\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "html_url": "https://github.com/rust-lang/rust/commit/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626/comments", "author": {"login": "ids1024", "id": 2263150, "node_id": "MDQ6VXNlcjIyNjMxNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/2263150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ids1024", "html_url": "https://github.com/ids1024", "followers_url": "https://api.github.com/users/ids1024/followers", "following_url": "https://api.github.com/users/ids1024/following{/other_user}", "gists_url": "https://api.github.com/users/ids1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/ids1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ids1024/subscriptions", "organizations_url": "https://api.github.com/users/ids1024/orgs", "repos_url": "https://api.github.com/users/ids1024/repos", "events_url": "https://api.github.com/users/ids1024/events{/privacy}", "received_events_url": "https://api.github.com/users/ids1024/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ids1024", "id": 2263150, "node_id": "MDQ6VXNlcjIyNjMxNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/2263150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ids1024", "html_url": "https://github.com/ids1024", "followers_url": "https://api.github.com/users/ids1024/followers", "following_url": "https://api.github.com/users/ids1024/following{/other_user}", "gists_url": "https://api.github.com/users/ids1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/ids1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ids1024/subscriptions", "organizations_url": "https://api.github.com/users/ids1024/orgs", "repos_url": "https://api.github.com/users/ids1024/repos", "events_url": "https://api.github.com/users/ids1024/events{/privacy}", "received_events_url": "https://api.github.com/users/ids1024/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bfc18a9619a5151ff4f11618db9cd882996ba6f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bfc18a9619a5151ff4f11618db9cd882996ba6f", "html_url": "https://github.com/rust-lang/rust/commit/3bfc18a9619a5151ff4f11618db9cd882996ba6f"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "9a16fc1bf66a970c4b24695068272e4f930b02c9", "filename": "src/libstd/sys/redox/fs.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Ffs.rs?ref=8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "patch": "@@ -420,12 +420,18 @@ fn remove_dir_all_recursive(path: &Path) -> io::Result<()> {\n }\n \n pub fn readlink(p: &Path) -> io::Result<PathBuf> {\n-    canonicalize(p)\n+    let fd = cvt(syscall::open(p.to_str().unwrap(), syscall::O_SYMLINK | syscall::O_RDONLY))?;\n+    let mut buf: [u8; 4096] = [0; 4096];\n+    let count = cvt(syscall::read(fd, &mut buf))?;\n+    cvt(syscall::close(fd))?;\n+    Ok(PathBuf::from(unsafe { String::from_utf8_unchecked(Vec::from(&buf[..count])) }))\n }\n \n-pub fn symlink(_src: &Path, _dst: &Path) -> io::Result<()> {\n-    ::sys_common::util::dumb_print(format_args!(\"Symlink\\n\"));\n-    unimplemented!();\n+pub fn symlink(src: &Path, dst: &Path) -> io::Result<()> {\n+    let fd = cvt(syscall::open(dst.to_str().unwrap(), syscall::O_SYMLINK | syscall::O_CREAT | syscall::O_WRONLY | 0o777))?;\n+    cvt(syscall::write(fd, src.to_str().unwrap().as_bytes()))?;\n+    cvt(syscall::close(fd))?;\n+    Ok(())\n }\n \n pub fn link(_src: &Path, _dst: &Path) -> io::Result<()> {"}, {"sha": "bd603cfe6ef9df25bcfe8380b374a9b0bd1c34b4", "filename": "src/libstd/sys/redox/syscall/flag.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626/src%2Flibstd%2Fsys%2Fredox%2Fsyscall%2Fflag.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626/src%2Flibstd%2Fsys%2Fredox%2Fsyscall%2Fflag.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fsyscall%2Fflag.rs?ref=8ee6bddf0b8b9b77ecd1e4b8105dc3fe161e6626", "patch": "@@ -33,6 +33,7 @@ pub const MAP_WRITE_COMBINE: usize = 2;\n pub const MODE_TYPE: u16 = 0xF000;\n pub const MODE_DIR: u16 = 0x4000;\n pub const MODE_FILE: u16 = 0x8000;\n+pub const MODE_SYMLINK: u16 = 0xA000;\n \n pub const MODE_PERM: u16 = 0x0FFF;\n pub const MODE_SETUID: u16 = 0o4000;\n@@ -53,6 +54,7 @@ pub const O_TRUNC: usize =      0x0400_0000;\n pub const O_EXCL: usize =       0x0800_0000;\n pub const O_DIRECTORY: usize =  0x1000_0000;\n pub const O_STAT: usize =       0x2000_0000;\n+pub const O_SYMLINK: usize =    0x4000_0000;\n pub const O_ACCMODE: usize =    O_RDONLY | O_WRONLY | O_RDWR;\n \n pub const SEEK_SET: usize = 0;"}]}