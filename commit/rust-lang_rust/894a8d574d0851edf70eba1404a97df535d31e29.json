{"sha": "894a8d574d0851edf70eba1404a97df535d31e29", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5NGE4ZDU3NGQwODUxZWRmNzBlYmExNDA0YTk3ZGY1MzVkMzFlMjk=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-10-13T18:24:50Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-10-13T18:35:19Z"}, "message": "resolve: Scale back hard-coded extern prelude additions", "tree": {"sha": "d6589f89e279a1e179b5c67323f2afcc64960f30", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6589f89e279a1e179b5c67323f2afcc64960f30"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/894a8d574d0851edf70eba1404a97df535d31e29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/894a8d574d0851edf70eba1404a97df535d31e29", "html_url": "https://github.com/rust-lang/rust/commit/894a8d574d0851edf70eba1404a97df535d31e29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/894a8d574d0851edf70eba1404a97df535d31e29/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "522948827b8e691f8f1efce2a87ab813045af60b", "url": "https://api.github.com/repos/rust-lang/rust/commits/522948827b8e691f8f1efce2a87ab813045af60b", "html_url": "https://github.com/rust-lang/rust/commit/522948827b8e691f8f1efce2a87ab813045af60b"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "86fe584dc3a40fe937c4199474e1958402d8602c", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/894a8d574d0851edf70eba1404a97df535d31e29/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/894a8d574d0851edf70eba1404a97df535d31e29/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=894a8d574d0851edf70eba1404a97df535d31e29", "patch": "@@ -1680,13 +1680,15 @@ impl<'a, 'crateloader: 'a> Resolver<'a, 'crateloader> {\n         let mut extern_prelude: FxHashSet<Name> =\n             session.opts.externs.iter().map(|kv| Symbol::intern(kv.0)).collect();\n \n-        // HACK(eddyb) this ignore the `no_{core,std}` attributes.\n-        // FIXME(eddyb) warn (elsewhere) if core/std is used with `no_{core,std}`.\n-        // if !attr::contains_name(&krate.attrs, \"no_core\") {\n-        // if !attr::contains_name(&krate.attrs, \"no_std\") {\n-        extern_prelude.insert(Symbol::intern(\"core\"));\n-        extern_prelude.insert(Symbol::intern(\"std\"));\n-        extern_prelude.insert(Symbol::intern(\"meta\"));\n+        if !attr::contains_name(&krate.attrs, \"no_core\") {\n+            extern_prelude.insert(Symbol::intern(\"core\"));\n+            if !attr::contains_name(&krate.attrs, \"no_std\") {\n+                extern_prelude.insert(Symbol::intern(\"std\"));\n+                if session.rust_2018() {\n+                    extern_prelude.insert(Symbol::intern(\"meta\"));\n+                }\n+            }\n+        }\n \n         let mut invocations = FxHashMap();\n         invocations.insert(Mark::root(),"}, {"sha": "268a16e5d2a0f0163e01cf80efb8407443c0df21", "filename": "src/test/ui/rust-2018/issue-54006.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/894a8d574d0851edf70eba1404a97df535d31e29/src%2Ftest%2Fui%2Frust-2018%2Fissue-54006.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/894a8d574d0851edf70eba1404a97df535d31e29/src%2Ftest%2Fui%2Frust-2018%2Fissue-54006.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fissue-54006.stderr?ref=894a8d574d0851edf70eba1404a97df535d31e29", "patch": "@@ -2,7 +2,7 @@ error[E0432]: unresolved import `alloc`\n   --> $DIR/issue-54006.rs:16:5\n    |\n LL | use alloc::vec;\n-   |     ^^^^^ Did you mean `std::alloc`?\n+   |     ^^^^^ Did you mean `core::alloc`?\n \n error: cannot determine resolution for the macro `vec`\n   --> $DIR/issue-54006.rs:20:18"}]}