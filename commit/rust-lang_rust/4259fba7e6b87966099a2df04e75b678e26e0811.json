{"sha": "4259fba7e6b87966099a2df04e75b678e26e0811", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyNTlmYmE3ZTZiODc5NjYwOTlhMmRmMDRlNzViNjc4ZTI2ZTA4MTE=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-05-19T11:31:41Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-05-28T05:22:16Z"}, "message": "Fix macro call site spans", "tree": {"sha": "905a7403fca33f253be55d9004475457aed3fdc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/905a7403fca33f253be55d9004475457aed3fdc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4259fba7e6b87966099a2df04e75b678e26e0811", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4259fba7e6b87966099a2df04e75b678e26e0811", "html_url": "https://github.com/rust-lang/rust/commit/4259fba7e6b87966099a2df04e75b678e26e0811", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4259fba7e6b87966099a2df04e75b678e26e0811/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b012ed142f03c9082773f5091c58c82d47cae79", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b012ed142f03c9082773f5091c58c82d47cae79", "html_url": "https://github.com/rust-lang/rust/commit/8b012ed142f03c9082773f5091c58c82d47cae79"}], "stats": {"total": 24, "additions": 1, "deletions": 23}, "files": [{"sha": "57c7a3ddc2fc2e8d080237cd458df8b0687dce49", "filename": "src/libsyntax/ext/base.rs", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/4259fba7e6b87966099a2df04e75b678e26e0811/src%2Flibsyntax%2Fext%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4259fba7e6b87966099a2df04e75b678e26e0811/src%2Flibsyntax%2Fext%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fbase.rs?ref=4259fba7e6b87966099a2df04e75b678e26e0811", "patch": "@@ -602,22 +602,6 @@ impl<'a> ExtCtxt<'a> {\n     }\n     pub fn backtrace(&self) -> ExpnId { self.backtrace }\n \n-    /// Original span that caused the current exapnsion to happen.\n-    pub fn original_span(&self) -> Span {\n-        let mut expn_id = self.backtrace;\n-        let mut call_site = None;\n-        loop {\n-            match self.codemap().with_expn_info(expn_id, |ei| ei.map(|ei| ei.call_site)) {\n-                None => break,\n-                Some(cs) => {\n-                    call_site = Some(cs);\n-                    expn_id = cs.expn_id;\n-                }\n-            }\n-        }\n-        call_site.expect(\"missing expansion backtrace\")\n-    }\n-\n     /// Returns span for the macro which originally caused the current expansion to happen.\n     ///\n     /// Stops backtracing at include! boundary."}, {"sha": "3fd8f2d1e1cc3a2d9e875fd43fb0d06c5cc6fa67", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4259fba7e6b87966099a2df04e75b678e26e0811/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4259fba7e6b87966099a2df04e75b678e26e0811/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=4259fba7e6b87966099a2df04e75b678e26e0811", "patch": "@@ -237,14 +237,8 @@ fn expand_mac_invoc<T>(mac: ast::Mac, ident: Option<Ident>, attrs: Vec<ast::Attr\n                     },\n                 });\n \n-                // The span that we pass to the expanders we want to\n-                // be the root of the call stack. That's the most\n-                // relevant span and it's the actual invocation of\n-                // the macro.\n-                let mac_span = fld.cx.original_span();\n-\n                 let marked_tts = mark_tts(&tts[..], mark);\n-                Some(expandfun.expand(fld.cx, mac_span, &marked_tts))\n+                Some(expandfun.expand(fld.cx, call_site, &marked_tts))\n             }\n \n             IdentTT(ref expander, tt_span, allow_internal_unstable) => {"}]}