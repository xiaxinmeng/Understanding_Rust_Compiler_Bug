{"sha": "d36c785344bdbfffa3c0424c0459abe921c63270", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzNmM3ODUzNDRiZGJmZmZhM2MwNDI0YzA0NTlhYmU5MjFjNjMyNzA=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-08-27T07:43:03Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-08-27T07:43:03Z"}, "message": "Allow block_in_if_{stmt,expr} in external macro", "tree": {"sha": "8555d02430c57a52387a2479bc1382ddb2a6cb88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8555d02430c57a52387a2479bc1382ddb2a6cb88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d36c785344bdbfffa3c0424c0459abe921c63270", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl1k3wcACgkQaTCGhp1Q\nZjfcrA//Tqvu4ddJNUgxQz/HAU9Hj0AtUtzv7BQMPkpasdsEiKqKKkJzB3LjWlBS\n1pUMEMSE0xNYZ/oUwKkVJmIAMfe2w7qMJ4omAQbHDBraawDDlkEx84ziujWstaqK\nzkdO9q+A1ZIW9wHbDVIPSQu+8q+/dT/in5Ft/1eZW1BRuZvxeE2RZXkrZFnBVrgc\ngLV1zXeZG3usWfgMEx4YhiMOBE6de7z5dCNJtROa1DfK7RDEQ5KPHABwPFQDiEIp\n/e9PVRXM3qht+4GydlpVhEHVBAtiVTCvq53qycL3uXNAO01N8iQCNi3jFB9FsWX4\nbjl09nQdaYcv58/eGt/iooXqHSQZLvjmigeXpDl7FKdVSQnF1JaEEA8GFa/IwKcr\nNKeukjC4Qq1Gf15T3vk1bigZIjWaoXfaURyKY18WI+fdDMyl+gmdI5U6oVpfx9Jr\nJyGi0m6jarK8U/sElqqtQ5y9hq70CfmZ2TVY0zjWtI2XwnAdGJxHoqJxAGG7nPRK\noX4DIg7hnJ0OT6eSeO04/oNY6KBi1GrRxSBGOUxScJYBvs+vVHQiSO1fHzokdTWE\nUFjJsPbwfPiuBViSPnVVix3SwQhFmli+mounMBf3TZySggw7Zdgg5xY6L4+BqMt2\n7InvyNJRfSHL++y9tuUD/q42vtgCyaYj5al2A84Ho2pO4yPs6C4=\n=B9yc\n-----END PGP SIGNATURE-----", "payload": "tree 8555d02430c57a52387a2479bc1382ddb2a6cb88\nparent 949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133\nauthor flip1995 <hello@philkrones.com> 1566891783 +0200\ncommitter flip1995 <hello@philkrones.com> 1566891783 +0200\n\nAllow block_in_if_{stmt,expr} in external macro\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d36c785344bdbfffa3c0424c0459abe921c63270", "html_url": "https://github.com/rust-lang/rust/commit/d36c785344bdbfffa3c0424c0459abe921c63270", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d36c785344bdbfffa3c0424c0459abe921c63270/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "url": "https://api.github.com/repos/rust-lang/rust/commits/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133", "html_url": "https://github.com/rust-lang/rust/commit/949b347f654f40ed7e4ab9dedb9e2c9b0a8c2133"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "f9660ce5efed7954260f531a1767a7b9ec6a6a88", "filename": "clippy_lints/src/block_in_if_condition.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d36c785344bdbfffa3c0424c0459abe921c63270/clippy_lints%2Fsrc%2Fblock_in_if_condition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d36c785344bdbfffa3c0424c0459abe921c63270/clippy_lints%2Fsrc%2Fblock_in_if_condition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fblock_in_if_condition.rs?ref=d36c785344bdbfffa3c0424c0459abe921c63270", "patch": "@@ -2,7 +2,7 @@ use crate::utils::*;\n use matches::matches;\n use rustc::hir::intravisit::{walk_expr, NestedVisitorMap, Visitor};\n use rustc::hir::*;\n-use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n+use rustc::lint::{in_external_macro, LateContext, LateLintPass, LintArray, LintContext, LintPass};\n use rustc::{declare_lint_pass, declare_tool_lint};\n \n declare_clippy_lint! {\n@@ -72,6 +72,9 @@ const COMPLEX_BLOCK_MESSAGE: &str = \"in an 'if' condition, avoid complex blocks\n \n impl<'a, 'tcx> LateLintPass<'a, 'tcx> for BlockInIfCondition {\n     fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr) {\n+        if in_external_macro(cx.sess(), expr.span) {\n+            return;\n+        }\n         if let Some((check, then, _)) = higher::if_block(&expr) {\n             if let ExprKind::Block(block, _) = &check.node {\n                 if block.rules == DefaultBlock {"}]}