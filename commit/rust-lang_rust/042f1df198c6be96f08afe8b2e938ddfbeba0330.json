{"sha": "042f1df198c6be96f08afe8b2e938ddfbeba0330", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0MmYxZGYxOThjNmJlOTZmMDhhZmU4YjJlOTM4ZGRmYmViYTAzMzA=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-06-15T23:16:43Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-06-15T23:18:14Z"}, "message": "process cross-crate glob re-exports", "tree": {"sha": "05fc59574f69313c9c4e99fb39931686d08394a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05fc59574f69313c9c4e99fb39931686d08394a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/042f1df198c6be96f08afe8b2e938ddfbeba0330", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/042f1df198c6be96f08afe8b2e938ddfbeba0330", "html_url": "https://github.com/rust-lang/rust/commit/042f1df198c6be96f08afe8b2e938ddfbeba0330", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/042f1df198c6be96f08afe8b2e938ddfbeba0330/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "24edc416ab3944b680fc73057879da7fa1d50c22", "url": "https://api.github.com/repos/rust-lang/rust/commits/24edc416ab3944b680fc73057879da7fa1d50c22", "html_url": "https://github.com/rust-lang/rust/commit/24edc416ab3944b680fc73057879da7fa1d50c22"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "80eb2d1e214fbd9146574d9ec49240a4ae8c295b", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=042f1df198c6be96f08afe8b2e938ddfbeba0330", "patch": "@@ -116,6 +116,23 @@ pub fn try_inline(cx: &DocContext, def: Def, name: ast::Name, visited: &mut FxHa\n     Some(ret)\n }\n \n+pub fn try_inline_glob(cx: &DocContext, def: Def, visited: &mut FxHashSet<DefId>)\n+    -> Option<Vec<clean::Item>>\n+{\n+    if def == Def::Err { return None }\n+    let did = def.def_id();\n+    if did.is_local() { return None }\n+\n+    match def {\n+        Def::Mod(did) => {\n+            let m = build_module(cx, did, visited);\n+            Some(m.items)\n+        }\n+        // glob imports on things like enums aren't inlined even for local exports, so just bail\n+        _ => None,\n+    }\n+}\n+\n pub fn load_attrs(cx: &DocContext, did: DefId) -> clean::Attributes {\n     cx.tcx.get_attrs(did).clean(cx)\n }"}, {"sha": "15c2e7b72f65c58d196cd37f8bdd0c82857c0adf", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=042f1df198c6be96f08afe8b2e938ddfbeba0330", "patch": "@@ -3862,6 +3862,13 @@ impl Clean<Vec<Item>> for doctree::Import {\n         });\n         let path = self.path.clean(cx);\n         let inner = if self.glob {\n+            if !denied {\n+                let mut visited = FxHashSet();\n+                if let Some(items) = inline::try_inline_glob(cx, path.def, &mut visited) {\n+                    return items;\n+                }\n+            }\n+\n             Import::Glob(resolve_use_source(cx, path))\n         } else {\n             let name = self.name;"}, {"sha": "5067ce9e9a341f350fab84c5967d90b5239af0ea", "filename": "src/test/rustdoc/inline_cross/auxiliary/cross-glob.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs?ref=042f1df198c6be96f08afe8b2e938ddfbeba0330", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"inner\"]\n+\n+pub struct SomeStruct;\n+\n+pub fn some_fn() {}"}, {"sha": "21cf158c13b0353de107b3698fb62e43029a48d3", "filename": "src/test/rustdoc/inline_cross/cross-glob.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/042f1df198c6be96f08afe8b2e938ddfbeba0330/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs?ref=042f1df198c6be96f08afe8b2e938ddfbeba0330", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:cross-glob.rs\n+// build-aux-docs\n+// ignore-cross-compile\n+\n+extern crate inner;\n+\n+// @has cross_glob/struct.SomeStruct.html\n+// @has cross_glob/fn.some_fn.html\n+// @!has cross_glob/index.html '//code' 'pub use inner::*;'\n+#[doc(inline)]\n+pub use inner::*;"}]}