{"sha": "7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a", "node_id": "C_kwDOAAsO6NoAKDdmMTU1MzdmYTllOGZjZGE1ZDNkZmMxZjljYzBmNzc3ZmMxMWU2MmE", "commit": {"author": {"name": "Andrew Leverette", "email": "andrewleverette@gmail.com", "date": "2021-11-23T20:41:31Z"}, "committer": {"name": "Andrew Leverette", "email": "andrewleverette@gmail.com", "date": "2021-11-23T20:41:31Z"}, "message": "Add optimization for not allocating in case of no module path for struct literal", "tree": {"sha": "cefcf2af2d78d267a5a27fa3bbbbddd9e7eac178", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cefcf2af2d78d267a5a27fa3bbbbddd9e7eac178"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a", "html_url": "https://github.com/rust-lang/rust/commit/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a/comments", "author": {"login": "andrewleverette", "id": 18223816, "node_id": "MDQ6VXNlcjE4MjIzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/18223816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewleverette", "html_url": "https://github.com/andrewleverette", "followers_url": "https://api.github.com/users/andrewleverette/followers", "following_url": "https://api.github.com/users/andrewleverette/following{/other_user}", "gists_url": "https://api.github.com/users/andrewleverette/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewleverette/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewleverette/subscriptions", "organizations_url": "https://api.github.com/users/andrewleverette/orgs", "repos_url": "https://api.github.com/users/andrewleverette/repos", "events_url": "https://api.github.com/users/andrewleverette/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewleverette/received_events", "type": "User", "site_admin": false}, "committer": {"login": "andrewleverette", "id": 18223816, "node_id": "MDQ6VXNlcjE4MjIzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/18223816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewleverette", "html_url": "https://github.com/andrewleverette", "followers_url": "https://api.github.com/users/andrewleverette/followers", "following_url": "https://api.github.com/users/andrewleverette/following{/other_user}", "gists_url": "https://api.github.com/users/andrewleverette/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewleverette/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewleverette/subscriptions", "organizations_url": "https://api.github.com/users/andrewleverette/orgs", "repos_url": "https://api.github.com/users/andrewleverette/repos", "events_url": "https://api.github.com/users/andrewleverette/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewleverette/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce7a141110e9c3daf984596d7fcbcb489e5677c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce7a141110e9c3daf984596d7fcbcb489e5677c4", "html_url": "https://github.com/rust-lang/rust/commit/ce7a141110e9c3daf984596d7fcbcb489e5677c4"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "bfbcc263b1deb5d53627504d4bf2fd608d0460c9", "filename": "crates/ide_completion/src/render/struct_literal.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a/crates%2Fide_completion%2Fsrc%2Frender%2Fstruct_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a/crates%2Fide_completion%2Fsrc%2Frender%2Fstruct_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender%2Fstruct_literal.rs?ref=7f15537fa9e8fcda5d3dfc1f9cc0f777fc11e62a", "patch": "@@ -56,14 +56,21 @@ fn render_literal(\n     kind: StructKind,\n     fields: &[hir::Field],\n ) -> Option<String> {\n-    let qualified_name = if let Some(path) = path { path.to_string() } else { name.to_string() };\n+    let path_string;\n+\n+    let qualified_name = if let Some(path) = path {\n+        path_string = path.to_string();\n+        &path_string\n+    } else {\n+        name\n+    };\n \n     let mut literal = match kind {\n         StructKind::Tuple if ctx.snippet_cap().is_some() => {\n-            render_tuple_as_literal(fields, &qualified_name)\n+            render_tuple_as_literal(fields, qualified_name)\n         }\n         StructKind::Record => {\n-            render_record_as_literal(ctx.db(), ctx.snippet_cap(), fields, &qualified_name)\n+            render_record_as_literal(ctx.db(), ctx.snippet_cap(), fields, qualified_name)\n         }\n         _ => return None,\n     };"}]}