{"sha": "fd38acb86fa991f1272013d565992f2f68d76a5f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkMzhhY2I4NmZhOTkxZjEyNzIwMTNkNTY1OTkyZjJmNjhkNzZhNWY=", "commit": {"author": {"name": "Kamal Marhubi", "email": "kamal@marhubi.com", "date": "2016-05-02T03:01:46Z"}, "committer": {"name": "Kamal Marhubi", "email": "kamal@marhubi.com", "date": "2016-05-02T03:06:58Z"}, "message": "deps: Update syntex_syntax to 0.31.0\n\nMost of the churn on this bump comes from the `Visibility` enum changing\nfrom\n\n    pub enum Visibility {\n        Public,\n        Inherited,\n    }\n\nto\n\n    pub enum Visibility {\n        Public,\n        Crate,\n        Restricted { path: P<Path>, id: NodeId },\n        Inherited,\n    }\n\nwhich require taking `Visibility` by reference in most places. The new\nvariants are not handled at this point.\n\nRefs #970", "tree": {"sha": "051832778b18b35cfba0b1c0a9021ad12463062a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/051832778b18b35cfba0b1c0a9021ad12463062a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd38acb86fa991f1272013d565992f2f68d76a5f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd38acb86fa991f1272013d565992f2f68d76a5f", "html_url": "https://github.com/rust-lang/rust/commit/fd38acb86fa991f1272013d565992f2f68d76a5f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd38acb86fa991f1272013d565992f2f68d76a5f/comments", "author": {"login": "kamalmarhubi", "id": 50936, "node_id": "MDQ6VXNlcjUwOTM2", "avatar_url": "https://avatars.githubusercontent.com/u/50936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamalmarhubi", "html_url": "https://github.com/kamalmarhubi", "followers_url": "https://api.github.com/users/kamalmarhubi/followers", "following_url": "https://api.github.com/users/kamalmarhubi/following{/other_user}", "gists_url": "https://api.github.com/users/kamalmarhubi/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamalmarhubi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamalmarhubi/subscriptions", "organizations_url": "https://api.github.com/users/kamalmarhubi/orgs", "repos_url": "https://api.github.com/users/kamalmarhubi/repos", "events_url": "https://api.github.com/users/kamalmarhubi/events{/privacy}", "received_events_url": "https://api.github.com/users/kamalmarhubi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kamalmarhubi", "id": 50936, "node_id": "MDQ6VXNlcjUwOTM2", "avatar_url": "https://avatars.githubusercontent.com/u/50936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamalmarhubi", "html_url": "https://github.com/kamalmarhubi", "followers_url": "https://api.github.com/users/kamalmarhubi/followers", "following_url": "https://api.github.com/users/kamalmarhubi/following{/other_user}", "gists_url": "https://api.github.com/users/kamalmarhubi/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamalmarhubi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamalmarhubi/subscriptions", "organizations_url": "https://api.github.com/users/kamalmarhubi/orgs", "repos_url": "https://api.github.com/users/kamalmarhubi/repos", "events_url": "https://api.github.com/users/kamalmarhubi/events{/privacy}", "received_events_url": "https://api.github.com/users/kamalmarhubi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5092eec081cf83ec653efbdeff587f60e4d0ac73", "url": "https://api.github.com/repos/rust-lang/rust/commits/5092eec081cf83ec653efbdeff587f60e4d0ac73", "html_url": "https://github.com/rust-lang/rust/commit/5092eec081cf83ec653efbdeff587f60e4d0ac73"}], "stats": {"total": 106, "additions": 51, "deletions": 55}, "files": [{"sha": "a31897dd45551c742e21ef2e428221881aad99a5", "filename": "Cargo.lock", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fd38acb86fa991f1272013d565992f2f68d76a5f/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/fd38acb86fa991f1272013d565992f2f68d76a5f/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=fd38acb86fa991f1272013d565992f2f68d76a5f", "patch": "@@ -9,7 +9,7 @@ dependencies = [\n  \"regex 0.1.63 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-serialize 0.3.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"strings 0.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syntex_syntax 0.30.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syntex_syntax 0.31.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.4.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.1.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-segmentation 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -111,7 +111,7 @@ dependencies = [\n \n [[package]]\n name = \"syntex_syntax\"\n-version = \"0.30.0\"\n+version = \"0.31.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 0.5.0 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "bf719ce90ef75023ce721bae7c0444f30f5a44d9", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fd38acb86fa991f1272013d565992f2f68d76a5f/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/fd38acb86fa991f1272013d565992f2f68d76a5f/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=fd38acb86fa991f1272013d565992f2f68d76a5f", "patch": "@@ -21,7 +21,7 @@ regex = \"0.1\"\n term = \"0.4\"\n strings = \"0.0.1\"\n diff = \"0.1\"\n-syntex_syntax = \"0.30\"\n+syntex_syntax = \"0.31\"\n log = \"0.3\"\n env_logger = \"0.3\"\n getopts = \"0.2\""}, {"sha": "486325faf5d381d1e6d469f9d8ed583d9cad2628", "filename": "src/items.rs", "status": "modified", "additions": 29, "deletions": 36, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=fd38acb86fa991f1272013d565992f2f68d76a5f", "patch": "@@ -126,7 +126,7 @@ impl<'a> FmtVisitor<'a> {\n                                               // These are not actually rust functions,\n                                               // but we format them as such.\n                                               abi::Abi::Rust,\n-                                              item.vis,\n+                                              &item.vis,\n                                               span,\n                                               false,\n                                               false);\n@@ -148,7 +148,7 @@ impl<'a> FmtVisitor<'a> {\n                     \"\"\n                 };\n                 let prefix = format!(\"{}static {}{}: \",\n-                                     format_visibility(item.vis),\n+                                     format_visibility(&item.vis),\n                                      mut_str,\n                                      item.ident);\n                 let offset = self.block_indent + prefix.len();\n@@ -179,7 +179,7 @@ impl<'a> FmtVisitor<'a> {\n                       unsafety: ast::Unsafety,\n                       constness: ast::Constness,\n                       abi: abi::Abi,\n-                      vis: ast::Visibility,\n+                      vis: &ast::Visibility,\n                       span: Span,\n                       block: &ast::Block)\n                       -> Option<String> {\n@@ -244,7 +244,7 @@ impl<'a> FmtVisitor<'a> {\n                                                        sig.unsafety,\n                                                        sig.constness,\n                                                        sig.abi,\n-                                                       ast::Visibility::Inherited,\n+                                                       &ast::Visibility::Inherited,\n                                                        span,\n                                                        false,\n                                                        false));\n@@ -303,7 +303,7 @@ impl<'a> FmtVisitor<'a> {\n \n     pub fn visit_enum(&mut self,\n                       ident: ast::Ident,\n-                      vis: ast::Visibility,\n+                      vis: &ast::Visibility,\n                       enum_def: &ast::EnumDef,\n                       generics: &ast::Generics,\n                       span: Span) {\n@@ -414,7 +414,7 @@ impl<'a> FmtVisitor<'a> {\n                 format_struct(&context,\n                               \"\",\n                               field.node.name,\n-                              ast::Visibility::Inherited,\n+                              &ast::Visibility::Inherited,\n                               &field.node.data,\n                               None,\n                               field.span,\n@@ -451,7 +451,7 @@ pub fn format_impl(context: &RewriteContext, item: &ast::Item, offset: Indent) -\n                                ref self_ty,\n                                ref items) = item.node {\n         let mut result = String::new();\n-        result.push_str(format_visibility(item.vis));\n+        result.push_str(format_visibility(&item.vis));\n         result.push_str(format_unsafety(unsafety));\n         result.push_str(\"impl\");\n \n@@ -583,7 +583,7 @@ fn is_impl_single_line(context: &RewriteContext,\n pub fn format_struct(context: &RewriteContext,\n                      item_name: &str,\n                      ident: ast::Ident,\n-                     vis: ast::Visibility,\n+                     vis: &ast::Visibility,\n                      struct_def: &ast::VariantData,\n                      generics: Option<&ast::Generics>,\n                      span: Span,\n@@ -619,7 +619,7 @@ pub fn format_trait(context: &RewriteContext, item: &ast::Item, offset: Indent)\n            item.node {\n         let mut result = String::new();\n         let header = format!(\"{}{}trait {}\",\n-                             format_visibility(item.vis),\n+                             format_visibility(&item.vis),\n                              format_unsafety(unsafety),\n                              item.ident);\n \n@@ -741,7 +741,7 @@ pub fn format_trait(context: &RewriteContext, item: &ast::Item, offset: Indent)\n     }\n }\n \n-fn format_unit_struct(item_name: &str, ident: ast::Ident, vis: ast::Visibility) -> Option<String> {\n+fn format_unit_struct(item_name: &str, ident: ast::Ident, vis: &ast::Visibility) -> Option<String> {\n     let mut result = String::with_capacity(1024);\n \n     let header_str = format_header(item_name, ident, vis);\n@@ -754,7 +754,7 @@ fn format_unit_struct(item_name: &str, ident: ast::Ident, vis: ast::Visibility)\n fn format_struct_struct(context: &RewriteContext,\n                         item_name: &str,\n                         ident: ast::Ident,\n-                        vis: ast::Visibility,\n+                        vis: &ast::Visibility,\n                         fields: &[ast::StructField],\n                         generics: Option<&ast::Generics>,\n                         span: Span,\n@@ -804,13 +804,13 @@ fn format_struct_struct(context: &RewriteContext,\n                              \"}\",\n                              |field| {\n         // Include attributes and doc comments, if present\n-        if !field.node.attrs.is_empty() {\n-            field.node.attrs[0].span.lo\n+        if !field.attrs.is_empty() {\n+            field.attrs[0].span.lo\n         } else {\n             field.span.lo\n         }\n     },\n-                             |field| field.node.ty.span.hi,\n+                             |field| field.ty.span.hi,\n                              |field| field.rewrite(context, item_budget, item_indent),\n                              context.codemap.span_after(span, \"{\"),\n                              span.hi);\n@@ -835,7 +835,7 @@ fn format_struct_struct(context: &RewriteContext,\n fn format_tuple_struct(context: &RewriteContext,\n                        item_name: &str,\n                        ident: ast::Ident,\n-                       vis: ast::Visibility,\n+                       vis: &ast::Visibility,\n                        fields: &[ast::StructField],\n                        generics: Option<&ast::Generics>,\n                        span: Span,\n@@ -890,13 +890,13 @@ fn format_tuple_struct(context: &RewriteContext,\n                              \")\",\n                              |field| {\n         // Include attributes and doc comments, if present\n-        if !field.node.attrs.is_empty() {\n-            field.node.attrs[0].span.lo\n+        if !field.attrs.is_empty() {\n+            field.attrs[0].span.lo\n         } else {\n             field.span.lo\n         }\n     },\n-                             |field| field.node.ty.span.hi,\n+                             |field| field.ty.span.hi,\n                              |field| field.rewrite(context, item_budget, item_indent),\n                              context.codemap.span_after(span, \"(\"),\n                              span.hi);\n@@ -924,12 +924,12 @@ pub fn rewrite_type_alias(context: &RewriteContext,\n                           ident: ast::Ident,\n                           ty: &ast::Ty,\n                           generics: &ast::Generics,\n-                          vis: ast::Visibility,\n+                          vis: &ast::Visibility,\n                           span: Span)\n                           -> Option<String> {\n     let mut result = String::new();\n \n-    result.push_str(&format_visibility(vis));\n+    result.push_str(&format_visibility(&vis));\n     result.push_str(\"type \");\n     result.push_str(&ident.to_string());\n \n@@ -991,21 +991,14 @@ pub fn rewrite_type_alias(context: &RewriteContext,\n \n impl Rewrite for ast::StructField {\n     fn rewrite(&self, context: &RewriteContext, width: usize, offset: Indent) -> Option<String> {\n-        if contains_skip(&self.node.attrs) {\n-            let span = context.snippet(mk_sp(self.node.attrs[0].span.lo, self.span.hi));\n+        if contains_skip(&self.attrs) {\n+            let span = context.snippet(mk_sp(self.attrs[0].span.lo, self.span.hi));\n             return wrap_str(span, context.config.max_width, width, offset);\n         }\n \n-        let name = match self.node.kind {\n-            ast::StructFieldKind::NamedField(ident, _) => Some(ident.to_string()),\n-            ast::StructFieldKind::UnnamedField(_) => None,\n-        };\n-        let vis = match self.node.kind {\n-            ast::StructFieldKind::NamedField(_, vis) |\n-            ast::StructFieldKind::UnnamedField(vis) => format_visibility(vis),\n-        };\n-        let mut attr_str = try_opt!(self.node\n-            .attrs\n+        let name = self.ident;\n+        let vis = format_visibility(&self.vis);\n+        let mut attr_str = try_opt!(self.attrs\n             .rewrite(context, context.config.max_width - offset.width(), offset));\n         if !attr_str.is_empty() {\n             attr_str.push('\\n');\n@@ -1019,13 +1012,13 @@ impl Rewrite for ast::StructField {\n \n         let last_line_width = last_line_width(&result);\n         let budget = try_opt!(width.checked_sub(last_line_width));\n-        let rewrite = try_opt!(self.node.ty.rewrite(context, budget, offset + last_line_width));\n+        let rewrite = try_opt!(self.ty.rewrite(context, budget, offset + last_line_width));\n         Some(result + &rewrite)\n     }\n }\n \n pub fn rewrite_static(prefix: &str,\n-                      vis: ast::Visibility,\n+                      vis: &ast::Visibility,\n                       ident: ast::Ident,\n                       ty: &ast::Ty,\n                       mutability: ast::Mutability,\n@@ -1239,7 +1232,7 @@ fn rewrite_fn_base(context: &RewriteContext,\n                    unsafety: ast::Unsafety,\n                    constness: ast::Constness,\n                    abi: abi::Abi,\n-                   vis: ast::Visibility,\n+                   vis: &ast::Visibility,\n                    span: Span,\n                    newline_brace: bool,\n                    has_body: bool)\n@@ -1808,7 +1801,7 @@ fn rewrite_where_clause(context: &RewriteContext,\n     }\n }\n \n-fn format_header(item_name: &str, ident: ast::Ident, vis: ast::Visibility) -> String {\n+fn format_header(item_name: &str, ident: ast::Ident, vis: &ast::Visibility) -> String {\n     format!(\"{}{}{}\", format_visibility(vis), item_name, ident)\n }\n "}, {"sha": "e1f33832a3bb84664cc3680cba03687cf2e88832", "filename": "src/utils.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=fd38acb86fa991f1272013d565992f2f68d76a5f", "patch": "@@ -67,10 +67,13 @@ pub fn extra_offset(text: &str, offset: Indent) -> usize {\n }\n \n #[inline]\n-pub fn format_visibility(vis: Visibility) -> &'static str {\n-    match vis {\n+pub fn format_visibility(vis: &Visibility) -> &'static str {\n+    match *vis {\n         Visibility::Public => \"pub \",\n         Visibility::Inherited => \"\",\n+        // TODO(#970): Handle new visibility types.\n+        Visibility::Crate => unimplemented!(),\n+        Visibility::Restricted { .. } => unimplemented!(),\n     }\n }\n "}, {"sha": "1ae3578376b685d5a5277896296fe391d65278cb", "filename": "src/visitor.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd38acb86fa991f1272013d565992f2f68d76a5f/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=fd38acb86fa991f1272013d565992f2f68d76a5f", "patch": "@@ -152,7 +152,7 @@ impl<'a> FmtVisitor<'a> {\n                                 sig.unsafety,\n                                 sig.constness,\n                                 sig.abi,\n-                                vis.unwrap_or(ast::Visibility::Inherited),\n+                                vis.unwrap_or(&ast::Visibility::Inherited),\n                                 codemap::mk_sp(s.lo, b.span.lo),\n                                 &b)\n             }\n@@ -198,7 +198,7 @@ impl<'a> FmtVisitor<'a> {\n \n         match item.node {\n             ast::ItemKind::Use(ref vp) => {\n-                self.format_import(item.vis, vp, item.span);\n+                self.format_import(&item.vis, vp, item.span);\n             }\n             ast::ItemKind::Impl(..) => {\n                 self.format_missing_with_indent(item.span.lo);\n@@ -229,7 +229,7 @@ impl<'a> FmtVisitor<'a> {\n                     ::items::format_struct(&context,\n                                            \"struct \",\n                                            item.ident,\n-                                           item.vis,\n+                                           &item.vis,\n                                            def,\n                                            Some(generics),\n                                            item.span,\n@@ -245,12 +245,12 @@ impl<'a> FmtVisitor<'a> {\n             }\n             ast::ItemKind::Enum(ref def, ref generics) => {\n                 self.format_missing_with_indent(item.span.lo);\n-                self.visit_enum(item.ident, item.vis, def, generics, item.span);\n+                self.visit_enum(item.ident, &item.vis, def, generics, item.span);\n                 self.last_pos = item.span.hi;\n             }\n             ast::ItemKind::Mod(ref module) => {\n                 self.format_missing_with_indent(item.span.lo);\n-                self.format_mod(module, item.vis, item.span, item.ident);\n+                self.format_mod(module, &item.vis, item.span, item.ident);\n             }\n             ast::ItemKind::Mac(ref mac) => {\n                 self.format_missing_with_indent(item.span.lo);\n@@ -262,7 +262,7 @@ impl<'a> FmtVisitor<'a> {\n             }\n             ast::ItemKind::Static(ref ty, mutability, ref expr) => {\n                 let rewrite = rewrite_static(\"static\",\n-                                             item.vis,\n+                                             &item.vis,\n                                              item.ident,\n                                              ty,\n                                              mutability,\n@@ -272,7 +272,7 @@ impl<'a> FmtVisitor<'a> {\n             }\n             ast::ItemKind::Const(ref ty, ref expr) => {\n                 let rewrite = rewrite_static(\"const\",\n-                                             item.vis,\n+                                             &item.vis,\n                                              item.ident,\n                                              ty,\n                                              ast::Mutability::Immutable,\n@@ -289,7 +289,7 @@ impl<'a> FmtVisitor<'a> {\n                                                     unsafety,\n                                                     constness,\n                                                     abi,\n-                                                    item.vis),\n+                                                    &item.vis),\n                               decl,\n                               body,\n                               item.span,\n@@ -301,7 +301,7 @@ impl<'a> FmtVisitor<'a> {\n                                                  item.ident,\n                                                  ty,\n                                                  generics,\n-                                                 item.vis,\n+                                                 &item.vis,\n                                                  item.span);\n                 self.push_rewrite(item.span, rewrite);\n             }\n@@ -316,7 +316,7 @@ impl<'a> FmtVisitor<'a> {\n         match ti.node {\n             ast::TraitItemKind::Const(ref ty, ref expr_opt) => {\n                 let rewrite = rewrite_static(\"const\",\n-                                             ast::Visibility::Inherited,\n+                                             &ast::Visibility::Inherited,\n                                              ti.ident,\n                                              ty,\n                                              ast::Mutability::Immutable,\n@@ -354,15 +354,15 @@ impl<'a> FmtVisitor<'a> {\n \n         match ii.node {\n             ast::ImplItemKind::Method(ref sig, ref body) => {\n-                self.visit_fn(visit::FnKind::Method(ii.ident, sig, Some(ii.vis)),\n+                self.visit_fn(visit::FnKind::Method(ii.ident, sig, Some(&ii.vis)),\n                               &sig.decl,\n                               body,\n                               ii.span,\n                               ii.id);\n             }\n             ast::ImplItemKind::Const(ref ty, ref expr) => {\n                 let rewrite = rewrite_static(\"const\",\n-                                             ii.vis,\n+                                             &ii.vis,\n                                              ii.ident,\n                                              ty,\n                                              ast::Mutability::Immutable,\n@@ -462,7 +462,7 @@ impl<'a> FmtVisitor<'a> {\n         }\n     }\n \n-    fn format_mod(&mut self, m: &ast::Mod, vis: ast::Visibility, s: Span, ident: ast::Ident) {\n+    fn format_mod(&mut self, m: &ast::Mod, vis: &ast::Visibility, s: Span, ident: ast::Ident) {\n         // Decide whether this is an inline mod or an external mod.\n         let local_file_name = self.codemap.span_to_filename(s);\n         let is_internal = local_file_name == self.codemap.span_to_filename(m.inner);\n@@ -501,7 +501,7 @@ impl<'a> FmtVisitor<'a> {\n         self.format_missing(filemap.end_pos);\n     }\n \n-    fn format_import(&mut self, vis: ast::Visibility, vp: &ast::ViewPath, span: Span) {\n+    fn format_import(&mut self, vis: &ast::Visibility, vp: &ast::ViewPath, span: Span) {\n         let vis = utils::format_visibility(vis);\n         let mut offset = self.block_indent;\n         offset.alignment += vis.len() + \"use \".len();"}]}