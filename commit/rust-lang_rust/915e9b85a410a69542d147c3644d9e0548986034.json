{"sha": "915e9b85a410a69542d147c3644d9e0548986034", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxNWU5Yjg1YTQxMGE2OTU0MmQxNDdjMzY0NGQ5ZTA1NDg5ODYwMzQ=", "commit": {"author": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2021-01-29T13:03:26Z"}, "committer": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2021-02-06T16:39:17Z"}, "message": "Fix cargo_common_metadata warning on `publish = false`.", "tree": {"sha": "1666b8ee4bb9ac2eb97843b8a09c5fd877d00f1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1666b8ee4bb9ac2eb97843b8a09c5fd877d00f1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/915e9b85a410a69542d147c3644d9e0548986034", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE3qx/rJh59vdc2+v9Q9YqPqOI5G8FAmAexjUACgkQQ9YqPqOI\n5G8rfA//bnfWxxd7nroyhAEgt0LEtafSxwWeQEYiTGZ5wq1QQQ8KsMdHy64vT3Ia\n7fVddX8SXzsDzU18lnTANRUP/R4bkN5gtAYmCouO0eNA2D2Cc+Cw42k+oJcScRHY\nX4rx4w847Nx+cC6QqScc4YoUuTV6/Y2dVMhXWy9yU7wINAc9f8inQ41bVwG2vNI4\nUmJJO5RT7c6sWQfoh505mDc7BRz/Bgz9vOZk/sGSupsZ8O92hyxjE83XNDH1+YVY\ndewFk1kGU+7N30Y3UnKKXmDtP6U2jScHD3Dsk8k1bkCa9PvD9itCpPI77Rjo1WcL\ndse963G8eQw//HvkQqGWn77wg/n8ExcgYyZCFccvgVMDWIocOqKDzSGGaoaDdAeF\nry/XnbULJrj7iiy2Nh3hItkj3Eb9iSlNfA5Gr6AgA6NUx5969G80AdND6QpuRYHm\nyszTd1Ge/qvpVzi9icpUlEpnLQXvkMoh3cLUdbR+1p8f0U2eAFLplxQu+mnVaR0T\nGOqiFJ/kjR3FIhDDxin+DDgXo1Z0ChFUK7+aAdlZUKlRv0wjf5cq8CC3n4C51TVw\nI3KYCiLit/NKSMhUVJ9Qnh8vZjJzoGISydKjurq2ph4w7Pu/blaqOKlz/Cp9B2FE\nErhPQnvcy7KL7WvAgEKkMydX602iu2Si3Vx1qn4RNWe13msc/ZA=\n=Mo+U\n-----END PGP SIGNATURE-----", "payload": "tree 1666b8ee4bb9ac2eb97843b8a09c5fd877d00f1e\nparent dfb34c085ff5421ececed8e42b8a8a6fea18c0b7\nauthor daxpedda <daxpedda@gmail.com> 1611925406 +0100\ncommitter daxpedda <daxpedda@gmail.com> 1612629557 +0100\n\nFix cargo_common_metadata warning on `publish = false`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/915e9b85a410a69542d147c3644d9e0548986034", "html_url": "https://github.com/rust-lang/rust/commit/915e9b85a410a69542d147c3644d9e0548986034", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/915e9b85a410a69542d147c3644d9e0548986034/comments", "author": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dfb34c085ff5421ececed8e42b8a8a6fea18c0b7", "url": "https://api.github.com/repos/rust-lang/rust/commits/dfb34c085ff5421ececed8e42b8a8a6fea18c0b7", "html_url": "https://github.com/rust-lang/rust/commit/dfb34c085ff5421ececed8e42b8a8a6fea18c0b7"}], "stats": {"total": 104, "additions": 76, "deletions": 28}, "files": [{"sha": "84c6eff79a1af5d8cc77636c08752f26b41a8fb3", "filename": "clippy_lints/src/cargo_common_metadata.rs", "status": "modified", "additions": 28, "deletions": 26, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcargo_common_metadata.rs?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -80,32 +80,34 @@ impl LateLintPass<'_> for CargoCommonMetadata {\n         let metadata = unwrap_cargo_metadata!(cx, CARGO_COMMON_METADATA, false);\n \n         for package in metadata.packages {\n-            if is_empty_vec(&package.authors) {\n-                missing_warning(cx, &package, \"package.authors\");\n-            }\n-\n-            if is_empty_str(&package.description) {\n-                missing_warning(cx, &package, \"package.description\");\n-            }\n-\n-            if is_empty_str(&package.license) && is_empty_path(&package.license_file) {\n-                missing_warning(cx, &package, \"either package.license or package.license_file\");\n-            }\n-\n-            if is_empty_str(&package.repository) {\n-                missing_warning(cx, &package, \"package.repository\");\n-            }\n-\n-            if is_empty_path(&package.readme) {\n-                missing_warning(cx, &package, \"package.readme\");\n-            }\n-\n-            if is_empty_vec(&package.keywords) {\n-                missing_warning(cx, &package, \"package.keywords\");\n-            }\n-\n-            if is_empty_vec(&package.categories) {\n-                missing_warning(cx, &package, \"package.categories\");\n+            if package.publish.as_ref().filter(|publish| publish.is_empty()).is_none() {\n+                if is_empty_vec(&package.authors) {\n+                    missing_warning(cx, &package, \"package.authors\");\n+                }\n+\n+                if is_empty_str(&package.description) {\n+                    missing_warning(cx, &package, \"package.description\");\n+                }\n+\n+                if is_empty_str(&package.license) && is_empty_path(&package.license_file) {\n+                    missing_warning(cx, &package, \"either package.license or package.license_file\");\n+                }\n+\n+                if is_empty_str(&package.repository) {\n+                    missing_warning(cx, &package, \"package.repository\");\n+                }\n+\n+                if is_empty_path(&package.readme) {\n+                    missing_warning(cx, &package, \"package.readme\");\n+                }\n+\n+                if is_empty_vec(&package.keywords) {\n+                    missing_warning(cx, &package, \"package.keywords\");\n+                }\n+\n+                if is_empty_vec(&package.categories) {\n+                    missing_warning(cx, &package, \"package.categories\");\n+                }\n             }\n         }\n     }"}, {"sha": "1645c975be17dc58255aac8b2bfde7e88bc8df25", "filename": "tests/ui-cargo/cargo_common_metadata/fail/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail%2FCargo.toml?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -1,6 +1,5 @@\n [package]\n name = \"cargo_common_metadata\"\n version = \"0.1.0\"\n-publish = false\n \n [workspace]"}, {"sha": "7595696353cd44f2d710ce5dbb454f60460d7024", "filename": "tests/ui-cargo/cargo_common_metadata/fail_publish/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2FCargo.toml?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"cargo_common_metadata\"\n+version = \"0.1.0\"\n+publish = [\"some-registry-name\"]\n+\n+[workspace]"}, {"sha": "27841e18aa9ef830cb1daf4080d0acd19a3b3c97", "filename": "tests/ui-cargo/cargo_common_metadata/fail_publish/src/main.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.rs?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,4 @@\n+// compile-flags: --crate-name=cargo_common_metadata\n+#![warn(clippy::cargo_common_metadata)]\n+\n+fn main() {}"}, {"sha": "c8ae6c820df9de4de3f3561451d27e97c9416563", "filename": "tests/ui-cargo/cargo_common_metadata/fail_publish/src/main.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Ffail_publish%2Fsrc%2Fmain.stderr?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,18 @@\n+error: package `cargo_common_metadata` is missing `package.authors` metadata\n+   |\n+   = note: `-D clippy::cargo-common-metadata` implied by `-D warnings`\n+\n+error: package `cargo_common_metadata` is missing `package.description` metadata\n+\n+error: package `cargo_common_metadata` is missing `either package.license or package.license_file` metadata\n+\n+error: package `cargo_common_metadata` is missing `package.repository` metadata\n+\n+error: package `cargo_common_metadata` is missing `package.readme` metadata\n+\n+error: package `cargo_common_metadata` is missing `package.keywords` metadata\n+\n+error: package `cargo_common_metadata` is missing `package.categories` metadata\n+\n+error: aborting due to 7 previous errors\n+"}, {"sha": "86abfd54d4d0077672367acc2198b467bac52b10", "filename": "tests/ui-cargo/cargo_common_metadata/pass/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass%2FCargo.toml?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -1,7 +1,6 @@\n [package]\n name = \"cargo_common_metadata\"\n version = \"0.1.0\"\n-publish = false\n authors = [\"Random person from the Internet <someone@someplace.org>\"]\n description = \"A test package for the cargo_common_metadata lint\"\n repository = \"https://github.com/someone/cargo_common_metadata\""}, {"sha": "ae0a603299629613cd51e8bf506f209cd5a10e1b", "filename": "tests/ui-cargo/cargo_common_metadata/pass_publish_empty/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2FCargo.toml?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"cargo_common_metadata\"\n+version = \"0.1.0\"\n+publish = false\n+\n+[workspace]"}, {"sha": "27841e18aa9ef830cb1daf4080d0acd19a3b3c97", "filename": "tests/ui-cargo/cargo_common_metadata/pass_publish_empty/src/main.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_empty%2Fsrc%2Fmain.rs?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,4 @@\n+// compile-flags: --crate-name=cargo_common_metadata\n+#![warn(clippy::cargo_common_metadata)]\n+\n+fn main() {}"}, {"sha": "0a879c99b5bd8a0cb50819c6412b3c0e37173448", "filename": "tests/ui-cargo/cargo_common_metadata/pass_publish_false/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2FCargo.toml?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"cargo_common_metadata\"\n+version = \"0.1.0\"\n+publish = []\n+\n+[workspace]"}, {"sha": "27841e18aa9ef830cb1daf4080d0acd19a3b3c97", "filename": "tests/ui-cargo/cargo_common_metadata/pass_publish_false/src/main.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/915e9b85a410a69542d147c3644d9e0548986034/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-cargo%2Fcargo_common_metadata%2Fpass_publish_false%2Fsrc%2Fmain.rs?ref=915e9b85a410a69542d147c3644d9e0548986034", "patch": "@@ -0,0 +1,4 @@\n+// compile-flags: --crate-name=cargo_common_metadata\n+#![warn(clippy::cargo_common_metadata)]\n+\n+fn main() {}"}]}