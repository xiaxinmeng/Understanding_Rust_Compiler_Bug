{"sha": "7082bf4478d3c4dab5a46bf2df18b57a496023f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwODJiZjQ0NzhkM2M0ZGFiNWE0NmJmMmRmMThiNTdhNDk2MDIzZjQ=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-05-13T09:31:27Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-05-13T09:35:25Z"}, "message": "Ensure visit_ty is called on type parameters during walk", "tree": {"sha": "951267554233423ee965f691d3c2a71bdef8a21c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/951267554233423ee965f691d3c2a71bdef8a21c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7082bf4478d3c4dab5a46bf2df18b57a496023f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7082bf4478d3c4dab5a46bf2df18b57a496023f4", "html_url": "https://github.com/rust-lang/rust/commit/7082bf4478d3c4dab5a46bf2df18b57a496023f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7082bf4478d3c4dab5a46bf2df18b57a496023f4/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39a000714a14fb907b7a34573684191804d28277", "url": "https://api.github.com/repos/rust-lang/rust/commits/39a000714a14fb907b7a34573684191804d28277", "html_url": "https://github.com/rust-lang/rust/commit/39a000714a14fb907b7a34573684191804d28277"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "8a3c72f43e431fb4ac5fa9b02bbb3a339f07e9e3", "filename": "src/comp/middle/walk.rs", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/7082bf4478d3c4dab5a46bf2df18b57a496023f4/src%2Fcomp%2Fmiddle%2Fwalk.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7082bf4478d3c4dab5a46bf2df18b57a496023f4/src%2Fcomp%2Fmiddle%2Fwalk.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fwalk.rs?ref=7082bf4478d3c4dab5a46bf2df18b57a496023f4", "patch": "@@ -170,13 +170,31 @@ fn walk_ty(&ast_visitor v, @ast::ty t) {\n                 walk_ty(v, m.output);\n             }\n         }\n-        case (ast::ty_path(_, _)) {}\n+        case (ast::ty_path(?p, _)) {\n+            for (@ast::ty tp in p.node.types) {\n+                walk_ty(v, tp);\n+            }\n+        }\n         case (ast::ty_type) {}\n         case (ast::ty_constr(?t, _)) { walk_ty(v, t); }\n     }\n     v.visit_ty_post(t);\n }\n \n+fn walk_pat(&ast_visitor v, &@ast::pat p) {\n+    alt (p.node) {\n+        case (ast::pat_tag(?path, ?children, _)) {\n+            for (@ast::ty tp in path.node.types) {\n+                walk_ty(v, tp);\n+            }\n+            for (@ast::pat child in children) {\n+                walk_pat(v, child);\n+            }\n+        }\n+        case (_) {}\n+    }\n+}\n+\n fn walk_native_mod(&ast_visitor v, &ast::native_mod nm) {\n     if (!v.keep_going()) { ret; }\n     for (@ast::view_item vi in nm.view_items) {\n@@ -349,6 +367,7 @@ fn walk_expr(&ast_visitor v, @ast::expr e) {\n         case (ast::expr_alt(?x, ?arms, _)) {\n             walk_expr(v, x);\n             for (ast::arm a in arms) {\n+                walk_pat(v, a.pat);\n                 v.visit_arm_pre(a);\n                 walk_block(v, a.block);\n                 v.visit_arm_post(a);\n@@ -380,7 +399,11 @@ fn walk_expr(&ast_visitor v, @ast::expr e) {\n             walk_expr(v, a);\n             walk_expr(v, b);\n         }\n-        case (ast::expr_path(_, _)) { }\n+        case (ast::expr_path(?p, _)) {\n+            for (@ast::ty tp in p.node.types) {\n+                walk_ty(v, tp);\n+            }\n+        }\n         case (ast::expr_ext(_, ?args, ?body, ?expansion, _)) {\n             // Only walk expansion, not args/body.\n             walk_expr(v, expansion);"}]}