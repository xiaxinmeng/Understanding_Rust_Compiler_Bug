{"sha": "93321671caf0bf04613db660bfa6228579fb2bbe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzMzIxNjcxY2FmMGJmMDQ2MTNkYjY2MGJmYTYyMjg1NzlmYjJiYmU=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-09-19T23:39:39Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2018-09-19T23:39:39Z"}, "message": "add -Zui-testing to rustdoc", "tree": {"sha": "6e583191d420e39f5d1dd5dd34ef007b7dd610a7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e583191d420e39f5d1dd5dd34ef007b7dd610a7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93321671caf0bf04613db660bfa6228579fb2bbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93321671caf0bf04613db660bfa6228579fb2bbe", "html_url": "https://github.com/rust-lang/rust/commit/93321671caf0bf04613db660bfa6228579fb2bbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93321671caf0bf04613db660bfa6228579fb2bbe/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "20dc0c50704ba1fc8c56a88ae2bf05ddb3e419bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/20dc0c50704ba1fc8c56a88ae2bf05ddb3e419bc", "html_url": "https://github.com/rust-lang/rust/commit/20dc0c50704ba1fc8c56a88ae2bf05ddb3e419bc"}], "stats": {"total": 85, "additions": 48, "deletions": 37}, "files": [{"sha": "004db37bbfe4895282d9f0433faf437a18c5ecd9", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -263,6 +263,7 @@ impl DocAccessLevels for AccessLevels<DefId> {\n pub fn new_handler(error_format: ErrorOutputType,\n                    source_map: Option<Lrc<source_map::SourceMap>>,\n                    treat_err_as_bug: bool,\n+                   ui_testing: bool,\n ) -> errors::Handler {\n     // rustdoc doesn't override (or allow to override) anything from this that is relevant here, so\n     // stick to the defaults\n@@ -274,7 +275,7 @@ pub fn new_handler(error_format: ErrorOutputType,\n                 source_map.map(|cm| cm as _),\n                 false,\n                 sessopts.debugging_opts.teach,\n-            ).ui_testing(sessopts.debugging_opts.ui_testing)\n+            ).ui_testing(ui_testing)\n         ),\n         ErrorOutputType::Json(pretty) => {\n             let source_map = source_map.unwrap_or_else(\n@@ -284,7 +285,7 @@ pub fn new_handler(error_format: ErrorOutputType,\n                     None,\n                     source_map,\n                     pretty,\n-                ).ui_testing(sessopts.debugging_opts.ui_testing)\n+                ).ui_testing(ui_testing)\n             )\n         },\n         ErrorOutputType::Short(color_config) => Box::new(\n@@ -326,6 +327,7 @@ pub fn run_core(search_paths: SearchPaths,\n                 mut manual_passes: Vec<String>,\n                 mut default_passes: passes::DefaultPassOption,\n                 treat_err_as_bug: bool,\n+                ui_testing: bool,\n ) -> (clean::Crate, RenderInfo, Vec<String>) {\n     // Parse, resolve, and typecheck the given crate.\n \n@@ -380,6 +382,8 @@ pub fn run_core(search_paths: SearchPaths,\n         actually_rustdoc: true,\n         debugging_opts: config::DebuggingOptions {\n             force_unstable_if_unmarked,\n+            treat_err_as_bug,\n+            ui_testing,\n             ..config::basic_debugging_options()\n         },\n         error_format,\n@@ -391,7 +395,8 @@ pub fn run_core(search_paths: SearchPaths,\n         let source_map = Lrc::new(source_map::SourceMap::new(sessopts.file_path_mapping()));\n         let diagnostic_handler = new_handler(error_format,\n                                              Some(source_map.clone()),\n-                                             treat_err_as_bug);\n+                                             treat_err_as_bug,\n+                                             ui_testing);\n \n         let mut sess = session::build_session_(\n             sessopts, cpath, diagnostic_handler, source_map,"}, {"sha": "bbb1b69c3fd474821fda7e1a996c3583d036f707", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -407,8 +407,11 @@ fn main_args(args: &[String]) -> isize {\n     let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n         *x == \"treat-err-as-bug\"\n     });\n+    let ui_testing = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"ui-testing\"\n+    });\n \n-    let diag = core::new_handler(error_format, None, treat_err_as_bug);\n+    let diag = core::new_handler(error_format, None, treat_err_as_bug, ui_testing);\n \n     // check for deprecated options\n     check_deprecated_options(&matches, &diag);\n@@ -563,7 +566,7 @@ fn main_args(args: &[String]) -> isize {\n     let res = acquire_input(PathBuf::from(input), externs, edition, cg, &matches, error_format,\n                             move |out| {\n         let Output { krate, passes, renderinfo } = out;\n-        let diag = core::new_handler(error_format, None, treat_err_as_bug);\n+        let diag = core::new_handler(error_format, None, treat_err_as_bug, ui_testing);\n         info!(\"going to format\");\n         match output_format.as_ref().map(|s| &**s) {\n             Some(\"html\") | None => {\n@@ -700,6 +703,9 @@ where R: 'static + Send,\n     let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n         *x == \"treat-err-as-bug\"\n     });\n+    let ui_testing = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"ui-testing\"\n+    });\n \n     let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n \n@@ -713,7 +719,7 @@ where R: 'static + Send,\n                            display_warnings, crate_name.clone(),\n                            force_unstable_if_unmarked, edition, cg, error_format,\n                            lint_opts, lint_cap, describe_lints, manual_passes, default_passes,\n-                           treat_err_as_bug);\n+                           treat_err_as_bug, ui_testing);\n \n         info!(\"finished with rustc\");\n "}, {"sha": "b82cbc1ab36fdb6893a7e32661fa4b4aff8360a5", "filename": "src/test/rustdoc-ui/deny-intra-link-resolution-failure.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -1,13 +1,13 @@\n error: `[v2]` cannot be resolved, ignoring it...\n   --> $DIR/deny-intra-link-resolution-failure.rs:13:6\n    |\n-13 | /// [v2] //~ ERROR\n+LL | /// [v2] //~ ERROR\n    |      ^^ cannot be resolved, ignoring\n    |\n note: lint level defined here\n   --> $DIR/deny-intra-link-resolution-failure.rs:11:9\n    |\n-11 | #![deny(intra_doc_link_resolution_failure)]\n+LL | #![deny(intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n "}, {"sha": "5bd62d60b48f3966c2d154fd5bd3600deb0839c4", "filename": "src/test/rustdoc-ui/deprecated-attrs.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -1,9 +1,9 @@\n warning: the `#![doc(no_default_passes)]` attribute is considered deprecated\n-  |\n-  = warning: please see https://github.com/rust-lang/rust/issues/44136\n-  = help: you may want to use `#![doc(document_private_items)]`\n+   |\n+   = warning: please see https://github.com/rust-lang/rust/issues/44136\n+   = help: you may want to use `#![doc(document_private_items)]`\n \n warning: the `#![doc(passes = \"...\")]` attribute is considered deprecated\n-  |\n-  = warning: please see https://github.com/rust-lang/rust/issues/44136\n+   |\n+   = warning: please see https://github.com/rust-lang/rust/issues/44136\n "}, {"sha": "498d02a7d1caf00b7ca71f591cf9a597436c39e8", "filename": "src/test/rustdoc-ui/intra-doc-alias-ice.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -1,13 +1,13 @@\n error: `[TypeAlias::hoge]` cannot be resolved, ignoring it...\n   --> $DIR/intra-doc-alias-ice.rs:15:30\n    |\n-15 | /// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n+LL | /// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n    |                              ^^^^^^^^^^^^^^^ cannot be resolved, ignoring\n    |\n note: lint level defined here\n   --> $DIR/intra-doc-alias-ice.rs:11:9\n    |\n-11 | #![deny(intra_doc_link_resolution_failure)]\n+LL | #![deny(intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n "}, {"sha": "c05f99fadc9e4bce2ab0255978b46cb1a2d3d487", "filename": "src/test/rustdoc-ui/intra-links-warning.stderr", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/93321671caf0bf04613db660bfa6228579fb2bbe/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr?ref=93321671caf0bf04613db660bfa6228579fb2bbe", "patch": "@@ -1,7 +1,7 @@\n warning: `[Foo::baz]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:13:23\n    |\n-13 |        //! Test with [Foo::baz], [Bar::foo], ...\n+LL |        //! Test with [Foo::baz], [Bar::foo], ...\n    |                       ^^^^^^^^ cannot be resolved, ignoring\n    |\n    = note: #[warn(intra_doc_link_resolution_failure)] on by default\n@@ -10,67 +10,67 @@ warning: `[Foo::baz]` cannot be resolved, ignoring it...\n warning: `[Bar::foo]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:13:35\n    |\n-13 |        //! Test with [Foo::baz], [Bar::foo], ...\n+LL |        //! Test with [Foo::baz], [Bar::foo], ...\n    |                                   ^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Uniooon::X]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:14:13\n    |\n-14 |      //! , [Uniooon::X] and [Qux::Z].\n+LL |      //! , [Uniooon::X] and [Qux::Z].\n    |             ^^^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux::Z]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:14:30\n    |\n-14 |      //! , [Uniooon::X] and [Qux::Z].\n+LL |      //! , [Uniooon::X] and [Qux::Z].\n    |                              ^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Uniooon::X]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:16:14\n    |\n-16 |       //! , [Uniooon::X] and [Qux::Z].\n+LL |       //! , [Uniooon::X] and [Qux::Z].\n    |              ^^^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux::Z]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:16:31\n    |\n-16 |       //! , [Uniooon::X] and [Qux::Z].\n+LL |       //! , [Uniooon::X] and [Qux::Z].\n    |                               ^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux:Y]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:18:13\n    |\n-18 |        /// [Qux:Y]\n+LL |        /// [Qux:Y]\n    |             ^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[BarA]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:24:10\n    |\n-24 | /// bar [BarA] bar\n+LL | /// bar [BarA] bar\n    |          ^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[BarB]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:28:1\n    |\n-28 | / /**\n-29 | |  * Foo\n-30 | |  * bar [BarB] bar\n-31 | |  * baz\n-32 | |  */\n+LL | / /**\n+LL | |  * Foo\n+LL | |  * bar [BarB] bar\n+LL | |  * baz\n+LL | |  */\n    | |___^\n    |\n    = note: the link appears in this line:\n@@ -82,13 +82,13 @@ warning: `[BarB]` cannot be resolved, ignoring it...\n warning: `[BarC]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:35:1\n    |\n-35 | / /** Foo\n-36 | |\n-37 | | bar [BarC] bar\n-38 | | baz\n+LL | / /** Foo\n+LL | |\n+LL | | bar [BarC] bar\n+LL | | baz\n ...  |\n-44 | |\n-45 | | */\n+LL | |\n+LL | | */\n    | |__^\n    |\n    = note: the link appears in this line:\n@@ -100,7 +100,7 @@ warning: `[BarC]` cannot be resolved, ignoring it...\n warning: `[BarD]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:48:1\n    |\n-48 | #[doc = \"Foo/nbar [BarD] bar/nbaz\"]\n+LL | #[doc = \"Foo/nbar [BarD] bar/nbaz\"]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: the link appears in this line:\n@@ -112,10 +112,10 @@ warning: `[BarD]` cannot be resolved, ignoring it...\n warning: `[BarF]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:53:9\n    |\n-53 |         #[doc = $f]\n+LL |         #[doc = $f]\n    |         ^^^^^^^^^^^\n ...\n-57 | f!(\"Foo/nbar [BarF] bar/nbaz\");\n+LL | f!(\"Foo/nbar [BarF] bar/nbaz\");\n    | ------------------------------- in this macro invocation\n    |\n    = note: the link appears in this line:"}]}