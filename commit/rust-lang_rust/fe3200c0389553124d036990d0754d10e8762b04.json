{"sha": "fe3200c0389553124d036990d0754d10e8762b04", "node_id": "C_kwDOAAsO6NoAKGZlMzIwMGMwMzg5NTUzMTI0ZDAzNjk5MGQwNzU0ZDEwZTg3NjJiMDQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-13T12:04:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-10-13T12:04:23Z"}, "message": "Auto merge of #9584 - royrustdev:implicit_saturating_sub, r=llogiq\n\nadd tests in `implicit_saturating_sub` lint\n\nThis adds more tests to the `implicit_saturating_sub` lint to rule out certain false positives that have appeared in the past.\n\nNow with those false positives out of the equation, we can move the lint to `style`.\n\n---\n\nchangelog: promote [`implicit-saturating-sub`] to the `style` category", "tree": {"sha": "11ff11649f839cb58cefcb382d6aa467468a7bd3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11ff11649f839cb58cefcb382d6aa467468a7bd3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe3200c0389553124d036990d0754d10e8762b04", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe3200c0389553124d036990d0754d10e8762b04", "html_url": "https://github.com/rust-lang/rust/commit/fe3200c0389553124d036990d0754d10e8762b04", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe3200c0389553124d036990d0754d10e8762b04/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "58ef56e39b434f5ce92154065b1d796e60355753", "url": "https://api.github.com/repos/rust-lang/rust/commits/58ef56e39b434f5ce92154065b1d796e60355753", "html_url": "https://github.com/rust-lang/rust/commit/58ef56e39b434f5ce92154065b1d796e60355753"}, {"sha": "ac6d2ba11e5c23cce18d2ee324034a6e7e7fab84", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac6d2ba11e5c23cce18d2ee324034a6e7e7fab84", "html_url": "https://github.com/rust-lang/rust/commit/ac6d2ba11e5c23cce18d2ee324034a6e7e7fab84"}], "stats": {"total": 151, "additions": 126, "deletions": 25}, "files": [{"sha": "29d59c26d92c4a2f697399ff93df5c753bc89152", "filename": "clippy_lints/src/implicit_saturating_sub.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fimplicit_saturating_sub.rs?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -35,7 +35,7 @@ declare_clippy_lint! {\n     /// ```\n     #[clippy::version = \"1.44.0\"]\n     pub IMPLICIT_SATURATING_SUB,\n-    pedantic,\n+    style,\n     \"Perform saturating subtraction instead of implicitly checking lower bound of data type\"\n }\n "}, {"sha": "b5f0e5fd7d64125ed86ba6c9158b95830c8970ad", "filename": "clippy_lints/src/lib.register_all.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_all.rs?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -89,6 +89,7 @@ store.register_group(true, \"clippy::all\", Some(\"clippy_all\"), vec![\n     LintId::of(functions::TOO_MANY_ARGUMENTS),\n     LintId::of(if_let_mutex::IF_LET_MUTEX),\n     LintId::of(implicit_saturating_add::IMPLICIT_SATURATING_ADD),\n+    LintId::of(implicit_saturating_sub::IMPLICIT_SATURATING_SUB),\n     LintId::of(indexing_slicing::OUT_OF_BOUNDS_INDEXING),\n     LintId::of(infinite_iter::INFINITE_ITER),\n     LintId::of(inherent_to_string::INHERENT_TO_STRING),"}, {"sha": "2ead71a68fabef1db92ae612930e4ebdeca313fb", "filename": "clippy_lints/src/lib.register_pedantic.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_pedantic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_pedantic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_pedantic.rs?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -33,7 +33,6 @@ store.register_group(true, \"clippy::pedantic\", Some(\"clippy_pedantic\"), vec![\n     LintId::of(functions::TOO_MANY_LINES),\n     LintId::of(if_not_else::IF_NOT_ELSE),\n     LintId::of(implicit_hasher::IMPLICIT_HASHER),\n-    LintId::of(implicit_saturating_sub::IMPLICIT_SATURATING_SUB),\n     LintId::of(inconsistent_struct_constructor::INCONSISTENT_STRUCT_CONSTRUCTOR),\n     LintId::of(infinite_iter::MAYBE_INFINITE_ITER),\n     LintId::of(invalid_upcast_comparisons::INVALID_UPCAST_COMPARISONS),"}, {"sha": "6894d69e928a716b5a07e086d74c3e8938c527ac", "filename": "clippy_lints/src/lib.register_style.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_style.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/clippy_lints%2Fsrc%2Flib.register_style.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_style.rs?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -32,6 +32,7 @@ store.register_group(true, \"clippy::style\", Some(\"clippy_style\"), vec![\n     LintId::of(functions::MUST_USE_UNIT),\n     LintId::of(functions::RESULT_UNIT_ERR),\n     LintId::of(implicit_saturating_add::IMPLICIT_SATURATING_ADD),\n+    LintId::of(implicit_saturating_sub::IMPLICIT_SATURATING_SUB),\n     LintId::of(inherent_to_string::INHERENT_TO_STRING),\n     LintId::of(init_numbered_fields::INIT_NUMBERED_FIELDS),\n     LintId::of(len_zero::COMPARISON_TO_EMPTY),"}, {"sha": "93df81b1a7ff0355fa99bb2cf9bdef5d6a11c83d", "filename": "tests/ui/implicit_saturating_sub.fixed", "status": "modified", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fimplicit_saturating_sub.fixed?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -2,6 +2,21 @@\n #![allow(unused_assignments, unused_mut, clippy::assign_op_pattern)]\n #![warn(clippy::implicit_saturating_sub)]\n \n+use std::cmp::PartialEq;\n+use std::ops::SubAssign;\n+// Mock type\n+struct Mock;\n+\n+impl PartialEq<u32> for Mock {\n+    fn eq(&self, _: &u32) -> bool {\n+        true\n+    }\n+}\n+\n+impl SubAssign<u32> for Mock {\n+    fn sub_assign(&mut self, _: u32) {}\n+}\n+\n fn main() {\n     // Tests for unsigned integers\n \n@@ -165,4 +180,39 @@ fn main() {\n     } else {\n         println!(\"side effect\");\n     }\n+\n+    // Extended tests\n+    let mut m = Mock;\n+    let mut u_32 = 3000;\n+    let a = 200;\n+    let mut _b = 8;\n+\n+    if m != 0 {\n+        m -= 1;\n+    }\n+\n+    if a > 0 {\n+        _b -= 1;\n+    }\n+\n+    if 0 > a {\n+        _b -= 1;\n+    }\n+\n+    if u_32 > 0 {\n+        u_32 -= 1;\n+    } else {\n+        println!(\"don't lint this\");\n+    }\n+\n+    if u_32 > 0 {\n+        println!(\"don't lint this\");\n+        u_32 -= 1;\n+    }\n+\n+    if u_32 > 42 {\n+        println!(\"brace yourself!\");\n+    } else if u_32 > 0 {\n+        u_32 -= 1;\n+    }\n }"}, {"sha": "8340bc8264d5884814037184d1b1cd41cf1cc12a", "filename": "tests/ui/implicit_saturating_sub.rs", "status": "modified", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fimplicit_saturating_sub.rs?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -2,6 +2,21 @@\n #![allow(unused_assignments, unused_mut, clippy::assign_op_pattern)]\n #![warn(clippy::implicit_saturating_sub)]\n \n+use std::cmp::PartialEq;\n+use std::ops::SubAssign;\n+// Mock type\n+struct Mock;\n+\n+impl PartialEq<u32> for Mock {\n+    fn eq(&self, _: &u32) -> bool {\n+        true\n+    }\n+}\n+\n+impl SubAssign<u32> for Mock {\n+    fn sub_assign(&mut self, _: u32) {}\n+}\n+\n fn main() {\n     // Tests for unsigned integers\n \n@@ -211,4 +226,39 @@ fn main() {\n     } else {\n         println!(\"side effect\");\n     }\n+\n+    // Extended tests\n+    let mut m = Mock;\n+    let mut u_32 = 3000;\n+    let a = 200;\n+    let mut _b = 8;\n+\n+    if m != 0 {\n+        m -= 1;\n+    }\n+\n+    if a > 0 {\n+        _b -= 1;\n+    }\n+\n+    if 0 > a {\n+        _b -= 1;\n+    }\n+\n+    if u_32 > 0 {\n+        u_32 -= 1;\n+    } else {\n+        println!(\"don't lint this\");\n+    }\n+\n+    if u_32 > 0 {\n+        println!(\"don't lint this\");\n+        u_32 -= 1;\n+    }\n+\n+    if u_32 > 42 {\n+        println!(\"brace yourself!\");\n+    } else if u_32 > 0 {\n+        u_32 -= 1;\n+    }\n }"}, {"sha": "5e589d931e431a145b5fd48fdcd87fbee6c4c83c", "filename": "tests/ui/implicit_saturating_sub.stderr", "status": "modified", "additions": 23, "deletions": 23, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fe3200c0389553124d036990d0754d10e8762b04/tests%2Fui%2Fimplicit_saturating_sub.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fimplicit_saturating_sub.stderr?ref=fe3200c0389553124d036990d0754d10e8762b04", "patch": "@@ -1,5 +1,5 @@\n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:13:5\n+  --> $DIR/implicit_saturating_sub.rs:28:5\n    |\n LL | /     if u_8 > 0 {\n LL | |         u_8 = u_8 - 1;\n@@ -9,175 +9,175 @@ LL | |     }\n    = note: `-D clippy::implicit-saturating-sub` implied by `-D warnings`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:20:13\n+  --> $DIR/implicit_saturating_sub.rs:35:13\n    |\n LL | /             if u_8 > 0 {\n LL | |                 u_8 -= 1;\n LL | |             }\n    | |_____________^ help: try: `u_8 = u_8.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:34:5\n+  --> $DIR/implicit_saturating_sub.rs:49:5\n    |\n LL | /     if u_16 > 0 {\n LL | |         u_16 -= 1;\n LL | |     }\n    | |_____^ help: try: `u_16 = u_16.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:44:5\n+  --> $DIR/implicit_saturating_sub.rs:59:5\n    |\n LL | /     if u_32 != 0 {\n LL | |         u_32 -= 1;\n LL | |     }\n    | |_____^ help: try: `u_32 = u_32.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:65:5\n+  --> $DIR/implicit_saturating_sub.rs:80:5\n    |\n LL | /     if u_64 > 0 {\n LL | |         u_64 -= 1;\n LL | |     }\n    | |_____^ help: try: `u_64 = u_64.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:70:5\n+  --> $DIR/implicit_saturating_sub.rs:85:5\n    |\n LL | /     if 0 < u_64 {\n LL | |         u_64 -= 1;\n LL | |     }\n    | |_____^ help: try: `u_64 = u_64.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:75:5\n+  --> $DIR/implicit_saturating_sub.rs:90:5\n    |\n LL | /     if 0 != u_64 {\n LL | |         u_64 -= 1;\n LL | |     }\n    | |_____^ help: try: `u_64 = u_64.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:96:5\n+  --> $DIR/implicit_saturating_sub.rs:111:5\n    |\n LL | /     if u_usize > 0 {\n LL | |         u_usize -= 1;\n LL | |     }\n    | |_____^ help: try: `u_usize = u_usize.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:108:5\n+  --> $DIR/implicit_saturating_sub.rs:123:5\n    |\n LL | /     if i_8 > i8::MIN {\n LL | |         i_8 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_8 = i_8.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:113:5\n+  --> $DIR/implicit_saturating_sub.rs:128:5\n    |\n LL | /     if i_8 > i8::MIN {\n LL | |         i_8 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_8 = i_8.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:118:5\n+  --> $DIR/implicit_saturating_sub.rs:133:5\n    |\n LL | /     if i_8 != i8::MIN {\n LL | |         i_8 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_8 = i_8.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:123:5\n+  --> $DIR/implicit_saturating_sub.rs:138:5\n    |\n LL | /     if i_8 != i8::MIN {\n LL | |         i_8 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_8 = i_8.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:133:5\n+  --> $DIR/implicit_saturating_sub.rs:148:5\n    |\n LL | /     if i_16 > i16::MIN {\n LL | |         i_16 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_16 = i_16.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:138:5\n+  --> $DIR/implicit_saturating_sub.rs:153:5\n    |\n LL | /     if i_16 > i16::MIN {\n LL | |         i_16 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_16 = i_16.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:143:5\n+  --> $DIR/implicit_saturating_sub.rs:158:5\n    |\n LL | /     if i_16 != i16::MIN {\n LL | |         i_16 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_16 = i_16.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:148:5\n+  --> $DIR/implicit_saturating_sub.rs:163:5\n    |\n LL | /     if i_16 != i16::MIN {\n LL | |         i_16 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_16 = i_16.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:158:5\n+  --> $DIR/implicit_saturating_sub.rs:173:5\n    |\n LL | /     if i_32 > i32::MIN {\n LL | |         i_32 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_32 = i_32.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:163:5\n+  --> $DIR/implicit_saturating_sub.rs:178:5\n    |\n LL | /     if i_32 > i32::MIN {\n LL | |         i_32 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_32 = i_32.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:168:5\n+  --> $DIR/implicit_saturating_sub.rs:183:5\n    |\n LL | /     if i_32 != i32::MIN {\n LL | |         i_32 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_32 = i_32.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:173:5\n+  --> $DIR/implicit_saturating_sub.rs:188:5\n    |\n LL | /     if i_32 != i32::MIN {\n LL | |         i_32 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_32 = i_32.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:183:5\n+  --> $DIR/implicit_saturating_sub.rs:198:5\n    |\n LL | /     if i64::MIN < i_64 {\n LL | |         i_64 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_64 = i_64.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:188:5\n+  --> $DIR/implicit_saturating_sub.rs:203:5\n    |\n LL | /     if i64::MIN != i_64 {\n LL | |         i_64 -= 1;\n LL | |     }\n    | |_____^ help: try: `i_64 = i_64.saturating_sub(1);`\n \n error: implicitly performing saturating subtraction\n-  --> $DIR/implicit_saturating_sub.rs:193:5\n+  --> $DIR/implicit_saturating_sub.rs:208:5\n    |\n LL | /     if i64::MIN < i_64 {\n LL | |         i_64 -= 1;"}]}