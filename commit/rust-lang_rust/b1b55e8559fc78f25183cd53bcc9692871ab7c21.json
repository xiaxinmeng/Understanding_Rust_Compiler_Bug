{"sha": "b1b55e8559fc78f25183cd53bcc9692871ab7c21", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxYjU1ZTg1NTlmYzc4ZjI1MTgzY2Q1M2JjYzk2OTI4NzFhYjdjMjE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-26T09:56:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-26T09:56:07Z"}, "message": "Auto merge of #3701 - mikerite:fix-3118, r=phansch\n\nFix dogfood tests on Appveyor\n\nThis introduces a work-around for a bug in rustup.rs when excuting\ncargo from a custom toolchain. Instead of trusting rustup to\ninvoke cargo from one of the release channels we just invoke\nnightly cargo directly.", "tree": {"sha": "5f85b94c35621d8dc1bf54b4fe643a637ec73c96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f85b94c35621d8dc1bf54b4fe643a637ec73c96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1b55e8559fc78f25183cd53bcc9692871ab7c21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1b55e8559fc78f25183cd53bcc9692871ab7c21", "html_url": "https://github.com/rust-lang/rust/commit/b1b55e8559fc78f25183cd53bcc9692871ab7c21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1b55e8559fc78f25183cd53bcc9692871ab7c21/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6b34861c44446cd7d78435c4127b19b0a7b9879", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6b34861c44446cd7d78435c4127b19b0a7b9879", "html_url": "https://github.com/rust-lang/rust/commit/a6b34861c44446cd7d78435c4127b19b0a7b9879"}, {"sha": "94a6eb0695679c46387075c70efaaffb5b73cee0", "url": "https://api.github.com/repos/rust-lang/rust/commits/94a6eb0695679c46387075c70efaaffb5b73cee0", "html_url": "https://github.com/rust-lang/rust/commit/94a6eb0695679c46387075c70efaaffb5b73cee0"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "20466fc567d7fd4e26ea7cafe1de31c2b5b7883b", "filename": "src/main.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b1b55e8559fc78f25183cd53bcc9692871ab7c21/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1b55e8559fc78f25183cd53bcc9692871ab7c21/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=b1b55e8559fc78f25183cd53bcc9692871ab7c21", "patch": "@@ -97,6 +97,12 @@ where\n         })\n         .map(|p| (\"CARGO_TARGET_DIR\", p));\n \n+    // Run the dogfood tests directly on nightly cargo. This is required due\n+    // to a bug in rustup.rs when running cargo on custom toolchains. See issue #3118.\n+    if std::env::var_os(\"CLIPPY_DOGFOOD\").is_some() && cfg!(windows) {\n+        args.insert(0, \"+nightly\".to_string());\n+    }\n+\n     let exit_status = std::process::Command::new(\"cargo\")\n         .args(&args)\n         .env(\"RUSTC_WRAPPER\", path)"}, {"sha": "27a3d84da4127a972ce3c912550354b97234ad4d", "filename": "tests/dogfood.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b1b55e8559fc78f25183cd53bcc9692871ab7c21/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1b55e8559fc78f25183cd53bcc9692871ab7c21/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=b1b55e8559fc78f25183cd53bcc9692871ab7c21", "patch": "@@ -1,6 +1,6 @@\n #[test]\n fn dogfood() {\n-    if option_env!(\"RUSTC_TEST_SUITE\").is_some() || cfg!(windows) {\n+    if option_env!(\"RUSTC_TEST_SUITE\").is_some() {\n         return;\n     }\n     let root_dir = std::path::PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n@@ -30,7 +30,7 @@ fn dogfood() {\n \n #[test]\n fn dogfood_tests() {\n-    if option_env!(\"RUSTC_TEST_SUITE\").is_some() || cfg!(windows) {\n+    if option_env!(\"RUSTC_TEST_SUITE\").is_some() {\n         return;\n     }\n     let root_dir = std::path::PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));"}]}