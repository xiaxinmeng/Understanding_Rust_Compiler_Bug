{"sha": "bf6c007760169e9c382d3700fd1cdd20037e4343", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmNmMwMDc3NjAxNjllOWMzODJkMzcwMGZkMWNkZDIwMDM3ZTQzNDM=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2014-12-05T23:56:25Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2015-01-05T05:14:17Z"}, "message": "Change `&` pat to only work with &T, and `&mut` with &mut T.\n\nThis implements RFC 179 by making the pattern `&<pat>` require matching\nagainst a variable of type `&T`, and introducing the pattern `&mut\n<pat>` which only works with variables of type `&mut T`.\n\nThe pattern `&mut x` currently parses as `&(mut x)` i.e. a pattern match\nthrough a `&T` or a `&mut T` that binds the variable `x` to have type\n`T` and to be mutable. This should be rewritten as follows, for example,\n\n    for &mut x in slice.iter() {\n\nbecomes\n\n    for &x in slice.iter() {\n        let mut x = x;\n\nDue to this, this is a\n\n[breaking-change]\n\nCloses #20496.", "tree": {"sha": "248a48e3811afdf8908c5ebf260d67eade27aa92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/248a48e3811afdf8908c5ebf260d67eade27aa92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf6c007760169e9c382d3700fd1cdd20037e4343", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf6c007760169e9c382d3700fd1cdd20037e4343", "html_url": "https://github.com/rust-lang/rust/commit/bf6c007760169e9c382d3700fd1cdd20037e4343", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf6c007760169e9c382d3700fd1cdd20037e4343/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5773bdefff2e47cc007f5cc2af3f80b30303d45a", "url": "https://api.github.com/repos/rust-lang/rust/commits/5773bdefff2e47cc007f5cc2af3f80b30303d45a", "html_url": "https://github.com/rust-lang/rust/commit/5773bdefff2e47cc007f5cc2af3f80b30303d45a"}], "stats": {"total": 116, "additions": 91, "deletions": 25}, "files": [{"sha": "0d3f9430bd67729eea66d13e657b305b604f4297", "filename": "src/doc/reference.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Fdoc%2Freference.md", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Fdoc%2Freference.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Freference.md?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -3484,8 +3484,9 @@ fn main() {\n \n ```\n \n-Patterns can also dereference pointers by using the `&`, `box` symbols,\n-as appropriate. For example, these two matches on `x: &int` are equivalent:\n+Patterns can also dereference pointers by using the `&`, `&mut` and `box`\n+symbols, as appropriate. For example, these two matches on `x: &int` are\n+equivalent:\n \n ```\n # let x = &3i;"}, {"sha": "b497e9733bc9e41f9a855eff953534aa4c2e7dab", "filename": "src/libcore/str/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibcore%2Fstr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibcore%2Fstr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fstr%2Fmod.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -230,7 +230,7 @@ impl<F> CharEq for F where F: FnMut(char) -> bool {\n impl<'a> CharEq for &'a [char] {\n     #[inline]\n     fn matches(&mut self, c: char) -> bool {\n-        self.iter().any(|&mut m| m.matches(c))\n+        self.iter().any(|&m| { let mut m = m; m.matches(c) })\n     }\n \n     #[inline]"}, {"sha": "3c672d0fdb6fa01057a9d69af99c66ed51c8be7b", "filename": "src/librustc/middle/cfg/construct.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcfg%2Fconstruct.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -119,7 +119,7 @@ impl<'a, 'tcx> CFGBuilder<'a, 'tcx> {\n             }\n \n             ast::PatBox(ref subpat) |\n-            ast::PatRegion(ref subpat) |\n+            ast::PatRegion(ref subpat, _) |\n             ast::PatIdent(_, _, Some(ref subpat)) => {\n                 let subpat_exit = self.pat(&**subpat, pred);\n                 self.add_node(pat.id, &[subpat_exit])"}, {"sha": "f2b9ecb5ec4322aa8af50c7a0d780aad0bee7682", "filename": "src/librustc/middle/check_match.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -473,7 +473,7 @@ fn construct_witness(cx: &MatchCheckCtxt, ctor: &Constructor,\n             }\n         }\n \n-        ty::ty_rptr(_, ty::mt { ty, .. }) => {\n+        ty::ty_rptr(_, ty::mt { ty, mutbl }) => {\n             match ty.sty {\n                ty::ty_vec(_, Some(n)) => match ctor {\n                     &Single => {\n@@ -493,7 +493,7 @@ fn construct_witness(cx: &MatchCheckCtxt, ctor: &Constructor,\n \n                 _ => {\n                     assert_eq!(pats_len, 1);\n-                    ast::PatRegion(pats.nth(0).unwrap())\n+                    ast::PatRegion(pats.nth(0).unwrap(), mutbl)\n                 }\n             }\n         }\n@@ -860,7 +860,7 @@ pub fn specialize<'a>(cx: &MatchCheckCtxt, r: &[&'a Pat],\n         ast::PatTup(ref args) =>\n             Some(args.iter().map(|p| &**p).collect()),\n \n-        ast::PatBox(ref inner) | ast::PatRegion(ref inner) =>\n+        ast::PatBox(ref inner) | ast::PatRegion(ref inner, _) =>\n             Some(vec![&**inner]),\n \n         ast::PatLit(ref expr) => {"}, {"sha": "f600086fc5e62328d38a4fff431ebe284a5f549a", "filename": "src/librustc/middle/mem_categorization.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -1262,8 +1262,10 @@ impl<'t,'tcx,TYPER:Typer<'tcx>> MemCategorizationContext<'t,TYPER> {\n             }\n           }\n \n-          ast::PatBox(ref subpat) | ast::PatRegion(ref subpat) => {\n-            // @p1, ~p1, ref p1\n+          ast::PatBox(ref subpat) | ast::PatRegion(ref subpat, _) => {\n+            // box p1, &p1, &mut p1.  we can ignore the mutability of\n+            // PatRegion since that information is already contained\n+            // in the type.\n             let subcmt = try!(self.cat_deref(pat, cmt, 0, false));\n               try!(self.cat_pattern_(subcmt, &**subpat, op));\n           }"}, {"sha": "fed0931cab71d52f071ed5429356ce99ed19fbd9", "filename": "src/librustc_trans/trans/_match.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2F_match.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -683,7 +683,7 @@ fn any_uniq_pat(m: &[Match], col: uint) -> bool {\n }\n \n fn any_region_pat(m: &[Match], col: uint) -> bool {\n-    any_pat!(m, col, ast::PatRegion(_))\n+    any_pat!(m, col, ast::PatRegion(..))\n }\n \n fn any_irrefutable_adt_pat(tcx: &ty::ctxt, m: &[Match], col: uint) -> bool {\n@@ -1725,7 +1725,7 @@ fn bind_irrefutable_pat<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n             let llbox = Load(bcx, val);\n             bcx = bind_irrefutable_pat(bcx, &**inner, llbox, cleanup_scope);\n         }\n-        ast::PatRegion(ref inner) => {\n+        ast::PatRegion(ref inner, _) => {\n             let loaded_val = Load(bcx, val);\n             bcx = bind_irrefutable_pat(bcx, &**inner, loaded_val, cleanup_scope);\n         }"}, {"sha": "0789be956429ccce0d8a31c0547b7ec32ab81eb7", "filename": "src/librustc_trans/trans/debuginfo.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -3472,7 +3472,7 @@ fn create_scope_map(cx: &CrateContext,\n                 }\n             }\n \n-            ast::PatBox(ref sub_pat) | ast::PatRegion(ref sub_pat) => {\n+            ast::PatBox(ref sub_pat) | ast::PatRegion(ref sub_pat, _) => {\n                 scope_map.insert(pat.id, scope_stack.last().unwrap().scope_metadata);\n                 walk_pattern(cx, &**sub_pat, scope_stack, scope_map);\n             }"}, {"sha": "1efff9d41f1ba9a36ebefad7d7046d4c901e01ed", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -146,12 +146,16 @@ pub fn check_pat<'a, 'tcx>(pcx: &pat_ctxt<'a, 'tcx>,\n                 check_pat(pcx, &**inner, tcx.types.err);\n             }\n         }\n-        ast::PatRegion(ref inner) => {\n+        ast::PatRegion(ref inner, mutbl) => {\n             let inner_ty = fcx.infcx().next_ty_var();\n \n-            let mutbl =\n+            // SNAP c894171 remove this `if`-`else` entirely after next snapshot\n+            let mutbl = if mutbl == ast::MutImmutable {\n                 ty::deref(fcx.infcx().shallow_resolve(expected), true)\n-                .map_or(ast::MutImmutable, |mt| mt.mutbl);\n+                    .map_or(ast::MutImmutable, |mt| mt.mutbl)\n+            } else {\n+                mutbl\n+            };\n \n             let mt = ty::mt { ty: inner_ty, mutbl: mutbl };\n             let region = fcx.infcx().next_region_var(infer::PatternRegion(pat.span));"}, {"sha": "6a4337a664b785e6f1288822f06e6a7a621a508e", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -2235,7 +2235,7 @@ fn name_from_pat(p: &ast::Pat) -> String {\n         PatTup(ref elts) => format!(\"({})\", elts.iter().map(|p| name_from_pat(&**p))\n                                             .collect::<Vec<String>>().connect(\", \")),\n         PatBox(ref p) => name_from_pat(&**p),\n-        PatRegion(ref p) => name_from_pat(&**p),\n+        PatRegion(ref p, _) => name_from_pat(&**p),\n         PatLit(..) => {\n             warn!(\"tried to get argument name from PatLit, \\\n                   which is silly in function arguments\");"}, {"sha": "d61b7a17a930d86db48711b539854b1f6eac37f7", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -556,7 +556,7 @@ pub enum Pat_ {\n     PatStruct(Path, Vec<Spanned<FieldPat>>, bool),\n     PatTup(Vec<P<Pat>>),\n     PatBox(P<Pat>),\n-    PatRegion(P<Pat>), // reference pattern\n+    PatRegion(P<Pat>, Mutability), // reference pattern\n     PatLit(P<Expr>),\n     PatRange(P<Expr>, P<Expr>),\n     /// [a, b, ..i, y, z] is represented as:"}, {"sha": "5e03afec16cf8709e1e5a92a047e87d39ef9a6b5", "filename": "src/libsyntax/ast_util.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fast_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fast_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast_util.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -633,7 +633,7 @@ pub fn walk_pat<F>(pat: &Pat, mut it: F) -> bool where F: FnMut(&Pat) -> bool {\n             PatEnum(_, Some(ref s)) | PatTup(ref s) => {\n                 s.iter().all(|p| walk_pat_(&**p, it))\n             }\n-            PatBox(ref s) | PatRegion(ref s) => {\n+            PatBox(ref s) | PatRegion(ref s, _) => {\n                 walk_pat_(&**s, it)\n             }\n             PatVec(ref before, ref slice, ref after) => {"}, {"sha": "d522c346fa0ee523053dacd09182e1c7d24b6d3b", "filename": "src/libsyntax/ext/deriving/generic/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fderiving%2Fgeneric%2Fmod.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -940,7 +940,7 @@ impl<'a> MethodDef<'a> {\n                                                                          &**variant,\n                                                                          self_arg_name,\n                                                                          ast::MutImmutable);\n-                    (cx.pat(sp, ast::PatRegion(p)), idents)\n+                    (cx.pat(sp, ast::PatRegion(p, ast::MutImmutable)), idents)\n                 };\n \n                 // A single arm has form (&VariantK, &VariantK, ...) => BodyK"}, {"sha": "03a4f9046b5492af99aaba821e9cc52464db813b", "filename": "src/libsyntax/fold.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffold.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -1267,7 +1267,7 @@ pub fn noop_fold_pat<T: Folder>(p: P<Pat>, folder: &mut T) -> P<Pat> {\n             }\n             PatTup(elts) => PatTup(elts.move_map(|x| folder.fold_pat(x))),\n             PatBox(inner) => PatBox(folder.fold_pat(inner)),\n-            PatRegion(inner) => PatRegion(folder.fold_pat(inner)),\n+            PatRegion(inner, mutbl) => PatRegion(folder.fold_pat(inner), mutbl),\n             PatRange(e1, e2) => {\n                 PatRange(folder.fold_expr(e1), folder.fold_expr(e2))\n             },"}, {"sha": "d9183ef0c49f569ed3cd9ddaddc7226df9f017c4", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -3357,11 +3357,16 @@ impl<'a> Parser<'a> {\n             })\n           }\n           token::BinOp(token::And) | token::AndAnd => {\n-            // parse &pat\n+            // parse &pat and &mut pat\n             let lo = self.span.lo;\n             self.expect_and();\n+            let mutability = if self.eat_keyword(keywords::Mut) {\n+                ast::MutMutable\n+            } else {\n+                ast::MutImmutable\n+            };\n             let sub = self.parse_pat();\n-            pat = PatRegion(sub);\n+            pat = PatRegion(sub, mutability);\n             hi = self.last_span.hi;\n             return P(ast::Pat {\n                 id: ast::DUMMY_NODE_ID,"}, {"sha": "9b2ee9de3584e9515b7352653b4a6a2b5534dc85", "filename": "src/libsyntax/print/pprust.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fprint%2Fpprust.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -2092,8 +2092,11 @@ impl<'a> State<'a> {\n                 try!(word(&mut self.s, \"box \"));\n                 try!(self.print_pat(&**inner));\n             }\n-            ast::PatRegion(ref inner) => {\n+            ast::PatRegion(ref inner, mutbl) => {\n                 try!(word(&mut self.s, \"&\"));\n+                if mutbl == ast::MutMutable {\n+                    try!(word(&mut self.s, \"mut \"));\n+                }\n                 try!(self.print_pat(&**inner));\n             }\n             ast::PatLit(ref e) => try!(self.print_expr(&**e)),"}, {"sha": "99701ec9710037e18b98cbde7a9b5da0d72dcacf", "filename": "src/libsyntax/visit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fvisit.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -519,7 +519,7 @@ pub fn walk_pat<'v, V: Visitor<'v>>(visitor: &mut V, pattern: &'v Pat) {\n             }\n         }\n         PatBox(ref subpattern) |\n-        PatRegion(ref subpattern) => {\n+        PatRegion(ref subpattern, _) => {\n             visitor.visit_pat(&**subpattern)\n         }\n         PatIdent(_, ref pth1, ref optional_subpattern) => {"}, {"sha": "c42cf4d055166972ece3231ea1e359bda483ad87", "filename": "src/libtest/stats.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibtest%2Fstats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Flibtest%2Fstats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Fstats.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -169,7 +169,8 @@ impl<T: FloatMath + FromPrimitive> Stats<T> for [T] {\n     fn sum(&self) -> T {\n         let mut partials = vec![];\n \n-        for &mut x in self.iter() {\n+        for &x in self.iter() {\n+            let mut x = x;\n             let mut j = 0;\n             // This inner loop applies `hi`/`lo` summation to each\n             // partial so that the list of partial sums remains exact."}, {"sha": "05c6c4a96557cc122d460feb2870da794b558a0f", "filename": "src/test/compile-fail/mut-pattern-internal-mutability.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Ftest%2Fcompile-fail%2Fmut-pattern-internal-mutability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Ftest%2Fcompile-fail%2Fmut-pattern-internal-mutability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmut-pattern-internal-mutability.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let foo = &mut 1i;\n+\n+    let &mut x = foo;\n+    x += 1; //~ ERROR re-assignment of immutable variable\n+\n+    // explicitly mut-ify internals\n+    let &mut mut x = foo;\n+    x += 1;\n+\n+    // check borrowing is detected successfully\n+    let &mut ref x = foo;\n+    *foo += 1; //~ ERROR cannot assign to `*foo` because it is borrowed\n+}"}, {"sha": "74e6141a2b3ff20cc0c1852062ac1b0effc8a8df", "filename": "src/test/compile-fail/mut-pattern-mismatched.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Ftest%2Fcompile-fail%2Fmut-pattern-mismatched.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bf6c007760169e9c382d3700fd1cdd20037e4343/src%2Ftest%2Fcompile-fail%2Fmut-pattern-mismatched.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmut-pattern-mismatched.rs?ref=bf6c007760169e9c382d3700fd1cdd20037e4343", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let foo = &mut 1i;\n+\n+    // (separate lines to ensure the spans are accurate)\n+\n+    // SNAP c894171 uncomment this after the next snapshot\n+    // NOTE(stage0) just in case tidy doesn't check SNAP's in tests\n+    // let &_ // ~ ERROR expected `&mut int`, found `&_`\n+    //    = foo;\n+    let &mut _ = foo;\n+\n+    let bar = &1i;\n+    let &_ = bar;\n+    let &mut _ //~ ERROR expected `&int`, found `&mut _`\n+         = bar;\n+}"}]}