{"sha": "aa685e2024874860c71887c4e18d916f1d989af8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhNjg1ZTIwMjQ4NzQ4NjBjNzE4ODdjNGUxOGQ5MTZmMWQ5ODlhZjg=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-15T12:39:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-15T12:39:54Z"}, "message": "Rollup merge of #79026 - mbrubeck:btree_retain, r=m-ou-se\n\nImplement BTreeMap::retain and BTreeSet::retain\n\nAdds new methods `BTreeMap::retain` and `BTreeSet::retain`.  These are implemented on top of `drain_filter` (#70530).\n\nThe API of these methods is identical to `HashMap::retain` and `HashSet::retain`, which were implemented in #39560 and stabilized in #36648.  The docs and tests are also copied from HashMap/HashSet.\n\nThe new methods are unstable, behind the `btree_retain` feature gate, with tracking issue #79025.  See also rust-lang/rfcs#1338.", "tree": {"sha": "5c25105cf1940785291890326be6a4b387e2a6cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c25105cf1940785291890326be6a4b387e2a6cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa685e2024874860c71887c4e18d916f1d989af8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfsSGaCRBK7hj4Ov3rIwAAdHIIAAkhDK8mYOQuaFF1fciNdvc/\nXJKsh/fo8HSo8WWPptzf9uHBvVVaLnqNuMPN7i83IJc202IMdlYuT93p6qyY3C1U\nV1FzAYlP/MHKck1kTCS611jDy7ibEcJV4CBQHyvkbeQwPKgXoFy4vB9RfGprQ9YZ\noXkyp9tKtsid/2yokHyM9y1JpDu0GflFCQgkMgg/q22OzCZigr745CTgpWH6bh3S\nYht8+C9fYzNe7UZhUm3BiuypFg9DDn9RbIds7Su6Ugz8KaWNoXSBoRbE139vLeb+\ni1woDroh3QcAHkGUK70J/LHXOZhczUF8Kh4hwUdGKBENgbUqZQd5MdCp12zia7g=\n=OGtl\n-----END PGP SIGNATURE-----\n", "payload": "tree 5c25105cf1940785291890326be6a4b387e2a6cd\nparent 00396cb23a630be87f3914f5eaf0f49d086e92d8\nparent bf6902ca61ae6e91a3ab95bed88426926f245d02\nauthor Jonas Schievink <jonasschievink@gmail.com> 1605443994 +0100\ncommitter GitHub <noreply@github.com> 1605443994 +0100\n\nRollup merge of #79026 - mbrubeck:btree_retain, r=m-ou-se\n\nImplement BTreeMap::retain and BTreeSet::retain\n\nAdds new methods `BTreeMap::retain` and `BTreeSet::retain`.  These are implemented on top of `drain_filter` (#70530).\n\nThe API of these methods is identical to `HashMap::retain` and `HashSet::retain`, which were implemented in #39560 and stabilized in #36648.  The docs and tests are also copied from HashMap/HashSet.\n\nThe new methods are unstable, behind the `btree_retain` feature gate, with tracking issue #79025.  See also rust-lang/rfcs#1338.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa685e2024874860c71887c4e18d916f1d989af8", "html_url": "https://github.com/rust-lang/rust/commit/aa685e2024874860c71887c4e18d916f1d989af8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa685e2024874860c71887c4e18d916f1d989af8/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00396cb23a630be87f3914f5eaf0f49d086e92d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/00396cb23a630be87f3914f5eaf0f49d086e92d8", "html_url": "https://github.com/rust-lang/rust/commit/00396cb23a630be87f3914f5eaf0f49d086e92d8"}, {"sha": "bf6902ca61ae6e91a3ab95bed88426926f245d02", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf6902ca61ae6e91a3ab95bed88426926f245d02", "html_url": "https://github.com/rust-lang/rust/commit/bf6902ca61ae6e91a3ab95bed88426926f245d02"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "7151d3763f01fcb3c0dd7f8572fcf24aa2e49881", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=aa685e2024874860c71887c4e18d916f1d989af8", "patch": "@@ -863,6 +863,30 @@ impl<K: Ord, V> BTreeMap<K, V> {\n         }\n     }\n \n+    /// Retains only the elements specified by the predicate.\n+    ///\n+    /// In other words, remove all pairs `(k, v)` such that `f(&k, &mut v)` returns `false`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(btree_retain)]\n+    /// use std::collections::BTreeMap;\n+    ///\n+    /// let mut map: BTreeMap<i32, i32> = (0..8).map(|x| (x, x*10)).collect();\n+    /// // Keep only the elements with even-numbered keys.\n+    /// map.retain(|&k, _| k % 2 == 0);\n+    /// assert!(map.into_iter().eq(vec![(0, 0), (2, 20), (4, 40), (6, 60)]));\n+    /// ```\n+    #[inline]\n+    #[unstable(feature = \"btree_retain\", issue = \"79025\")]\n+    pub fn retain<F>(&mut self, mut f: F)\n+    where\n+        F: FnMut(&K, &mut V) -> bool,\n+    {\n+        self.drain_filter(|k, v| !f(k, v));\n+    }\n+\n     /// Moves all elements from `other` into `Self`, leaving `other` empty.\n     ///\n     /// # Examples"}, {"sha": "11dbb584abdac6de774d6c6b5b99b2bc7bf6bd3e", "filename": "library/alloc/src/collections/btree/map/tests.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap%2Ftests.rs?ref=aa685e2024874860c71887c4e18d916f1d989af8", "patch": "@@ -808,6 +808,17 @@ fn test_range_mut() {\n     map.check();\n }\n \n+#[test]\n+fn test_retain() {\n+    let mut map: BTreeMap<i32, i32> = (0..100).map(|x| (x, x * 10)).collect();\n+\n+    map.retain(|&k, _| k % 2 == 0);\n+    assert_eq!(map.len(), 50);\n+    assert_eq!(map[&2], 20);\n+    assert_eq!(map[&4], 40);\n+    assert_eq!(map[&6], 60);\n+}\n+\n mod test_drain_filter {\n     use super::*;\n "}, {"sha": "1a807100653bc1a9270d679dd7107d9d824616de", "filename": "library/alloc/src/collections/btree/set.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs?ref=aa685e2024874860c71887c4e18d916f1d989af8", "patch": "@@ -798,6 +798,30 @@ impl<T: Ord> BTreeSet<T> {\n         Recover::take(&mut self.map, value)\n     }\n \n+    /// Retains only the elements specified by the predicate.\n+    ///\n+    /// In other words, remove all elements `e` such that `f(&e)` returns `false`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(btree_retain)]\n+    /// use std::collections::BTreeSet;\n+    ///\n+    /// let xs = [1, 2, 3, 4, 5, 6];\n+    /// let mut set: BTreeSet<i32> = xs.iter().cloned().collect();\n+    /// // Keep only the even numbers.\n+    /// set.retain(|&k| k % 2 == 0);\n+    /// assert!(set.iter().eq([2, 4, 6].iter()));\n+    /// ```\n+    #[unstable(feature = \"btree_retain\", issue = \"79025\")]\n+    pub fn retain<F>(&mut self, mut f: F)\n+    where\n+        F: FnMut(&T) -> bool,\n+    {\n+        self.drain_filter(|v| !f(v));\n+    }\n+\n     /// Moves all elements from `other` into `Self`, leaving `other` empty.\n     ///\n     /// # Examples"}, {"sha": "ef40a048a382ecccf8911610c8e9e64e13dc9f18", "filename": "library/alloc/src/collections/btree/set/tests.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa685e2024874860c71887c4e18d916f1d989af8/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset%2Ftests.rs?ref=aa685e2024874860c71887c4e18d916f1d989af8", "patch": "@@ -324,6 +324,17 @@ fn test_is_subset() {\n     assert_eq!(is_subset(&[99, 100], &large), false);\n }\n \n+#[test]\n+fn test_retain() {\n+    let xs = [1, 2, 3, 4, 5, 6];\n+    let mut set: BTreeSet<i32> = xs.iter().cloned().collect();\n+    set.retain(|&k| k % 2 == 0);\n+    assert_eq!(set.len(), 3);\n+    assert!(set.contains(&2));\n+    assert!(set.contains(&4));\n+    assert!(set.contains(&6));\n+}\n+\n #[test]\n fn test_drain_filter() {\n     let mut x: BTreeSet<_> = [1].iter().copied().collect();"}]}