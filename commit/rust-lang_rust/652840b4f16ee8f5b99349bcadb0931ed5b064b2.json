{"sha": "652840b4f16ee8f5b99349bcadb0931ed5b064b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1Mjg0MGI0ZjE2ZWU4ZjViOTkzNDliY2FkYjA5MzFlZDViMDY0YjI=", "commit": {"author": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2019-08-23T08:46:23Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2019-09-03T16:07:28Z"}, "message": "Re-add false positive check", "tree": {"sha": "3142c21f644e9b8c6c566348a13416083d63d789", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3142c21f644e9b8c6c566348a13416083d63d789"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/652840b4f16ee8f5b99349bcadb0931ed5b064b2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl1uj8AACgkQaTCGhp1Q\nZjenmw//S/g32r3/428hQawK38SLch5p7qDCuKaNoVzBf0sJiXPj+gxws0qQH045\nJ1saIRqoIuL/m3eRV/sa3G26RuLcPQtCUmtLcP3+tgNDAAGkge+8CtO4L+bXbFDx\nKkBOjlTxL3xzTbjMVw0JtW1QFrGue66sg0tuvjSTB18iwqEGF+z5KsfY+SOAe65g\n6HoO/H4mVcgakcWSKqh6za2iJH0FM0ITzJ5yhUWa6Jygrm5negRg6zm4iQB/UqmV\nnBNy0u2TMlDkFRuSznqeoLf9nDMpkQiYL0CXbII3TaQlfn5RXuaYGnKzUqLEP29s\nyLT3VsC22YOl9J7Lk8NhEQ9qo93zyFHZj91L8enKYAaoRAfko4Vi7u3zmrBcTPnz\nF0o9O77HwdWL/lwnAF2cn1unYwU8WZM1bNZrFV5VU+EXnganyLM0Zazu+T/D+4Cz\njDxigYmlnNw03oqmg0kE7hl48ErfrNszBt0rOsY1xcytFswe2Ic/GO3BqqXEskGN\nv1O394rTbq8fZJVeH2w8aprQsLENpbUYLE79JQhlaBdEwCgPob3FItkmzCL/9+OX\nFgjrE57TVzNMN9ZIwbULj3E/2UA7agJ55G2FlOnXpML/gHCydC8bQ/yGrfdzv3C6\niYVIx63U9Sd0fdxb+SxMh4FQfHF4eqPtbi8qvtNmu66vOo46TDY=\n=In69\n-----END PGP SIGNATURE-----", "payload": "tree 3142c21f644e9b8c6c566348a13416083d63d789\nparent 413eb5b946955cd33ffd6fb58d7c59de978f92d6\nauthor Lzu Tao <taolzu@gmail.com> 1566549983 +0700\ncommitter flip1995 <hello@philkrones.com> 1567526848 +0200\n\nRe-add false positive check\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/652840b4f16ee8f5b99349bcadb0931ed5b064b2", "html_url": "https://github.com/rust-lang/rust/commit/652840b4f16ee8f5b99349bcadb0931ed5b064b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/652840b4f16ee8f5b99349bcadb0931ed5b064b2/comments", "author": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "413eb5b946955cd33ffd6fb58d7c59de978f92d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/413eb5b946955cd33ffd6fb58d7c59de978f92d6", "html_url": "https://github.com/rust-lang/rust/commit/413eb5b946955cd33ffd6fb58d7c59de978f92d6"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "a20217991ab96c8891fd6bcc813f1426029569c3", "filename": "clippy_lints/src/format.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/652840b4f16ee8f5b99349bcadb0931ed5b064b2/clippy_lints%2Fsrc%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/652840b4f16ee8f5b99349bcadb0931ed5b064b2/clippy_lints%2Fsrc%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformat.rs?ref=652840b4f16ee8f5b99349bcadb0931ed5b064b2", "patch": "@@ -90,6 +90,10 @@ fn on_argumentv1_new<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr, arm\n         if let PatKind::Tuple(ref pats, None) = arms[0].pats[0].node;\n         if pats.len() == 1;\n         then {\n+            let ty = walk_ptrs_ty(cx.tables.pat_ty(&pats[0]));\n+            if ty.sty != rustc::ty::Str && !match_type(cx, ty, &paths::STRING) {\n+                return None;\n+            }\n             if let ExprKind::Lit(ref lit) = format_args.node {\n                 if let LitKind::Str(ref s, _) = lit.node {\n                     return Some(format!(\"{:?}.to_string()\", s.as_str()));\n@@ -100,6 +104,8 @@ fn on_argumentv1_new<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr, arm\n                     if path.ident.name == sym!(to_string) {\n                         return Some(format!(\"{}\", snip));\n                     }\n+                } else if let ExprKind::Binary(..) = format_args.node {\n+                    return Some(format!(\"{}\", snip));\n                 }\n                 return Some(format!(\"{}.to_string()\", snip));\n             }"}, {"sha": "6e100230a3ad338626ef7d2ab2b35e0a881a520f", "filename": "tests/ui/format.fixed", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fformat.fixed?ref=652840b4f16ee8f5b99349bcadb0931ed5b064b2", "patch": "@@ -60,4 +60,8 @@ fn main() {\n     42.to_string();\n     let x = std::path::PathBuf::from(\"/bar/foo/qux\");\n     x.display().to_string();\n+\n+    // False positive\n+    let a = \"foo\".to_string();\n+    let _ = Some(a + \"bar\");\n }"}, {"sha": "1fae6603ac099debbc7b1509f635da5fa7997f5a", "filename": "tests/ui/format.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fformat.rs?ref=652840b4f16ee8f5b99349bcadb0931ed5b064b2", "patch": "@@ -63,4 +63,8 @@ fn main() {\n     format!(\"{}\", 42.to_string());\n     let x = std::path::PathBuf::from(\"/bar/foo/qux\");\n     format!(\"{}\", x.display().to_string());\n+\n+    // False positive\n+    let a = \"foo\".to_string();\n+    let _ = Some(format!(\"{}\", a + \"bar\"));\n }"}, {"sha": "9736f34b03b4a86d6c78c58a05dc9559a902e0b4", "filename": "tests/ui/format.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/652840b4f16ee8f5b99349bcadb0931ed5b064b2/tests%2Fui%2Fformat.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fformat.stderr?ref=652840b4f16ee8f5b99349bcadb0931ed5b064b2", "patch": "@@ -75,5 +75,11 @@ error: useless use of `format!`\n LL |     format!(\"{}\", x.display().to_string());\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider using .to_string(): `x.display().to_string();`\n \n-error: aborting due to 12 previous errors\n+error: useless use of `format!`\n+  --> $DIR/format.rs:69:18\n+   |\n+LL |     let _ = Some(format!(\"{}\", a + \"bar\"));\n+   |                  ^^^^^^^^^^^^^^^^^^^^^^^^ help: consider using .to_string(): `a + \"bar\"`\n+\n+error: aborting due to 13 previous errors\n "}]}