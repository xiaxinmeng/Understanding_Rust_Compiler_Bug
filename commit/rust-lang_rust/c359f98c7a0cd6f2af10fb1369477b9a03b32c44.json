{"sha": "c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzNTlmOThjN2EwY2Q2ZjJhZjEwZmIxMzY5NDc3YjlhMDNiMzJjNDQ=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2018-11-13T18:43:50Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2018-12-05T15:10:31Z"}, "message": "emit error when doc generation fails\n\nFixes #41813.", "tree": {"sha": "ff8219e869901a6d264610e518510952750691c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ff8219e869901a6d264610e518510952750691c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAlwH6nIWHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdEIhCACckAobR1ePBYTEva8hpgIBb9kz\n7ovWqKNl4kfA2fefRRFwgg1v+ZZs8pr0ykKFNLLETN7WPlwoJNpl51G1azxWn6Sa\nkFxVUaQd2HQwOhhbzg5XzZjHg+fnokanjQterkzqaZGvWK9iCSQbKC3jXa5mvzIL\nhDLjx0dxMfEV0dPms6XYSOfZex/hrPm1QkrI24V7Gwzg7wtzUHcX/a9sJkHZzm16\nHSUSUyGvabKBhykycCHSxbFoMlkEJBqOegtwiuctNooOUFwjA3d81BGqeeVsGtWO\nIWjoFaJgDhRbunI/G2iLHJR1HeFaPBwoaRV/n1ccah+dSER3PIdsbEb2NLpO\n=wazo\n-----END PGP SIGNATURE-----", "payload": "tree ff8219e869901a6d264610e518510952750691c6\nparent 5c9f7dcd8307f92931bc7e5534b467063b4ecc76\nauthor Andy Russell <arussell123@gmail.com> 1542134630 -0500\ncommitter Andy Russell <arussell123@gmail.com> 1544022631 -0500\n\nemit error when doc generation fails\n\nFixes #41813.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "html_url": "https://github.com/rust-lang/rust/commit/c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c9f7dcd8307f92931bc7e5534b467063b4ecc76", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c9f7dcd8307f92931bc7e5534b467063b4ecc76", "html_url": "https://github.com/rust-lang/rust/commit/5c9f7dcd8307f92931bc7e5534b467063b4ecc76"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "6a20980575a24222f3fa53de586021e5dc5ce8e4", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "patch": "@@ -202,8 +202,8 @@ impl Impl {\n \n #[derive(Debug)]\n pub struct Error {\n-    file: PathBuf,\n-    error: io::Error,\n+    pub file: PathBuf,\n+    pub error: io::Error,\n }\n \n impl error::Error for Error {"}, {"sha": "b21f005c06bff5cc205368cc0ea938d4851e011f", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "patch": "@@ -387,9 +387,21 @@ fn main_args(args: &[String]) -> isize {\n         info!(\"going to format\");\n         let (error_format, treat_err_as_bug, ui_testing) = diag_opts;\n         let diag = core::new_handler(error_format, None, treat_err_as_bug, ui_testing);\n-        html::render::run(krate, renderopts, passes.into_iter().collect(), renderinfo, &diag)\n-            .expect(\"failed to generate documentation\");\n-        0\n+        match html::render::run(\n+            krate,\n+            renderopts,\n+            passes.into_iter().collect(),\n+            renderinfo,\n+            &diag,\n+        ) {\n+            Ok(_) => rustc_driver::EXIT_SUCCESS,\n+            Err(e) => {\n+                diag.struct_err(&format!(\"couldn't generate documentation: {}\", e.error))\n+                    .note(&format!(\"failed to create or modify \\\"{}\\\"\", e.file.display()))\n+                    .emit();\n+                rustc_driver::EXIT_FAILURE\n+            }\n+        }\n     })\n }\n "}, {"sha": "2055c9cbf2da055c18db2ab27ce60dc44872febb", "filename": "src/test/run-make-fulldeps/rustdoc-io-error/Makefile", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2FMakefile?ref=c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "patch": "@@ -0,0 +1,25 @@\n+-include ../tools.mk\n+\n+# This test verifies that rustdoc doesn't ICE when it encounters an IO error\n+# while generating files. Ideally this would be a rustdoc-ui test, so we could\n+# verify the error message as well.\n+\n+OUTPUT_DIR := \"$(TMPDIR)/rustdoc-io-error\"\n+\n+# Ignore Windows: the test uses `chmod`.\n+ifndef IS_WINDOWS\n+\n+# This test operates by creating a temporary directory and modifying its\n+# permissions so that it is not writable. We have to take special care to set\n+# the permissions back to normal so that it's able to be deleted later.\n+all:\n+\tmkdir -p $(OUTPUT_DIR)\n+\tchmod u-w $(OUTPUT_DIR)\n+\t-$(shell $(RUSTDOC) -o $(OUTPUT_DIR) foo.rs)\n+\tchmod u+w $(OUTPUT_DIR)\n+\texit $($(.SHELLSTATUS) -eq 1)\n+\n+else\n+all:\n+\n+endif"}, {"sha": "4a835673a596bcd05404f43d34082bf2785f2a9d", "filename": "src/test/run-make-fulldeps/rustdoc-io-error/foo.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c359f98c7a0cd6f2af10fb1369477b9a03b32c44/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-io-error%2Ffoo.rs?ref=c359f98c7a0cd6f2af10fb1369477b9a03b32c44", "patch": "@@ -0,0 +1 @@\n+pub struct Foo;"}]}