{"sha": "e152a1620b9fb91a70c629059df482872c687522", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxNTJhMTYyMGI5ZmI5MWE3MGM2MjkwNTlkZjQ4Mjg3MmM2ODc1MjI=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2017-06-18T14:00:10Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2017-08-11T08:38:29Z"}, "message": "Build support for no llvm", "tree": {"sha": "ea3cc059cf22d3f55a3d123d9f8c41344dd92745", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea3cc059cf22d3f55a3d123d9f8c41344dd92745"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e152a1620b9fb91a70c629059df482872c687522", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQIcBAABCgAGBQJZjW0FAAoJEEpHzFJ6U7W8q3oP/0KzkWLs8mW7DD6lOXxZC+DJ\nM8o8lsxIk0fDCEoCuoABVun/gBUgmQ6pmgBbpSiYcutNufN2yF6poWRqARxV1dgq\n9DM8ur57PRvpQ/lj6Qb2SVXGizeDQVib0+tVFG0sEg5mq5rFXv92vhZYZq1xixmn\nGh4aftHHaHAIl4+sD/i9qDkR2pVzUPL439BrKuqKdcJl05oFT6eTCXHDiKcmRCv6\nmIKS7+ISNc95WRmw9zEd8Tx3SGJ0Ic7MZUjU/Z7Py4gSZq1/CQ3k4Uwr2AoPFhDy\nL83uspb+eYOFgw3Ytuk5C+o4iWlCV5Q5mWVW6RgDfF8lsCH2q1UHTr/NvCotVLl/\ngQAkjZT2KG/qcw86CSiVJ0xAGy9eTp+FQA9sAzWXrpxo21WL03eFWDfL6DT/rde1\n+f/v1dFHYStXtZPEpsCfF4i9y3CRQbWpbvz1eoSVLnW6lzaoozgqp72H3ZyptKeZ\n8VRaeVekonJTuXFiaW1oLq/nOCxnTXuQyKn6SjKb4hn8+Qg/txxxxTPvCJoyU2Ic\ndXrMaqwvUqkoPBBbUZZTpMU1kB/TkXh5xwrYeVw/vKBRsTf2XdjVecKKf4w4vL1Y\nVo5YVGr2TH1sZj0ul1uw7EIrdHRDFe6Y2RNIOg3GjY3n1kF0W3OZodh7UNrCgY+D\n0/ebyosAr5si8uF6ozyd\n=HMDl\n-----END PGP SIGNATURE-----", "payload": "tree ea3cc059cf22d3f55a3d123d9f8c41344dd92745\nparent 73c3f55a3e6c370527dd620d116f27accd22d934\nauthor bjorn3 <bjorn3@users.noreply.github.com> 1497794410 +0200\ncommitter bjorn3 <bjorn3@users.noreply.github.com> 1502440709 +0200\n\nBuild support for no llvm\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e152a1620b9fb91a70c629059df482872c687522", "html_url": "https://github.com/rust-lang/rust/commit/e152a1620b9fb91a70c629059df482872c687522", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e152a1620b9fb91a70c629059df482872c687522/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "73c3f55a3e6c370527dd620d116f27accd22d934", "url": "https://api.github.com/repos/rust-lang/rust/commits/73c3f55a3e6c370527dd620d116f27accd22d934", "html_url": "https://github.com/rust-lang/rust/commit/73c3f55a3e6c370527dd620d116f27accd22d934"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "ec57bb069e0a4812719f88be8640239e3cf857e6", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=e152a1620b9fb91a70c629059df482872c687522", "patch": "@@ -53,6 +53,7 @@ pub struct Config {\n     pub profiler: bool,\n \n     // llvm codegen options\n+    pub llvm_enabled: bool,\n     pub llvm_assertions: bool,\n     pub llvm_optimize: bool,\n     pub llvm_release_debuginfo: bool,\n@@ -192,6 +193,7 @@ struct Install {\n #[derive(Deserialize, Default)]\n #[serde(deny_unknown_fields, rename_all = \"kebab-case\")]\n struct Llvm {\n+    enabled: Option<bool>,\n     ccache: Option<StringOrBool>,\n     ninja: Option<bool>,\n     assertions: Option<bool>,\n@@ -265,6 +267,7 @@ struct TomlTarget {\n impl Config {\n     pub fn parse(build: &str, file: Option<PathBuf>) -> Config {\n         let mut config = Config::default();\n+        config.llvm_enabled = true;\n         config.llvm_optimize = true;\n         config.use_jemalloc = true;\n         config.backtrace = true;\n@@ -345,6 +348,7 @@ impl Config {\n                 Some(StringOrBool::Bool(false)) | None => {}\n             }\n             set(&mut config.ninja, llvm.ninja);\n+            set(&mut config.llvm_enabled, llvm.enabled);\n             set(&mut config.llvm_assertions, llvm.assertions);\n             set(&mut config.llvm_optimize, llvm.optimize);\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);"}, {"sha": "19678dc77937568216a7fafa88302834669bca10", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=e152a1620b9fb91a70c629059df482872c687522", "patch": "@@ -14,6 +14,10 @@\n # =============================================================================\n [llvm]\n \n+# Indicates whether rustc will support compilation with LLVM\n+# note: rustc does not compile without LLVM at the moment\n+#enabled = true\n+\n # Indicates whether the LLVM build is a Release or Debug build\n #optimize = true\n "}, {"sha": "a8485d1d152d18703837f735a7e778e8c62dd2f8", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=e152a1620b9fb91a70c629059df482872c687522", "patch": "@@ -429,6 +429,9 @@ impl Build {\n         if self.config.use_jemalloc {\n             features.push_str(\" jemalloc\");\n         }\n+        if self.config.llvm_enabled {\n+            features.push_str(\" llvm\");\n+        }\n         features\n     }\n "}, {"sha": "59efbd5c4d20d8d9ce7f96d355cf746e20e13fec", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e152a1620b9fb91a70c629059df482872c687522/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=e152a1620b9fb91a70c629059df482872c687522", "patch": "@@ -56,6 +56,12 @@ impl Step for Llvm {\n     fn run(self, builder: &Builder) {\n         let build = builder.build;\n         let target = self.target;\n+\n+        // If we're not compiling for LLVM bail out here.\n+        if !build.config.llvm_enabled {\n+            return;\n+        }\n+\n         // If we're using a custom LLVM bail out here, but we can only use a\n         // custom LLVM for the build triple.\n         if let Some(config) = build.config.target_config.get(&target) {"}]}