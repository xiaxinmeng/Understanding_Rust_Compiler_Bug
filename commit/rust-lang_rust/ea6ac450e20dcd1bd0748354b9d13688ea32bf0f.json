{"sha": "ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "node_id": "C_kwDOAAsO6NoAKGVhNmFjNDUwZTIwZGNkMWJkMDc0ODM1NGI5ZDEzNjg4ZWEzMmJmMGY", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2023-05-18T12:07:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-18T12:07:09Z"}, "message": "Rollup merge of #111686 - cjgillot:no-foreign-item, r=compiler-errors\n\nRetire is_foreign_item query.\n\nThis can be written in terms of `DefKind`. This does not deserve the cost of a query.", "tree": {"sha": "c88008e648db235d4174157ebbad2b0c59a49fb3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c88008e648db235d4174157ebbad2b0c59a49fb3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkZhTtCRBK7hj4Ov3rIwAAUu4IAAXPDLtXQ7exQIcij9EoqjjE\nt+zs1xSC9oMC48SYJ4gcXlXvQBbTK9TJ+Q6c0nuSE68RlXiMVOKHc0KabcJXtDsI\nk2QzGm6WsUeCPbHeIF4G5J8rB6VJxH94k5SR8p/N/iIsZAp/uXip0P+LovuIWpef\nJLWqdJFVMXM8H3OZYwzoHm0EZFOdPKhx50mB2pqcsy7X79DNM+qFG1kA3NzynXUU\n45qxn9XWtFhQ0yIDXxjj87948i6bT1HlbiIhHgkllYWZ/d5VSYu5uuzvGabJNUO2\ntPVnrb90/zji37MOxUpQoYpbcKegWSxMNE86AEBe/Rxm5qTj7uQK1aSDmhuQjcw=\n=E4T4\n-----END PGP SIGNATURE-----\n", "payload": "tree c88008e648db235d4174157ebbad2b0c59a49fb3\nparent f5a0c6356b8fd3fed49c744ef6de66bbe03ca56b\nparent 37209dcddd7ded55e9a725bfab248eddb6def38b\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1684411629 +0530\ncommitter GitHub <noreply@github.com> 1684411629 +0530\n\nRollup merge of #111686 - cjgillot:no-foreign-item, r=compiler-errors\n\nRetire is_foreign_item query.\n\nThis can be written in terms of `DefKind`. This does not deserve the cost of a query.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "html_url": "https://github.com/rust-lang/rust/commit/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5a0c6356b8fd3fed49c744ef6de66bbe03ca56b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5a0c6356b8fd3fed49c744ef6de66bbe03ca56b", "html_url": "https://github.com/rust-lang/rust/commit/f5a0c6356b8fd3fed49c744ef6de66bbe03ca56b"}, {"sha": "37209dcddd7ded55e9a725bfab248eddb6def38b", "url": "https://api.github.com/repos/rust-lang/rust/commits/37209dcddd7ded55e9a725bfab248eddb6def38b", "html_url": "https://github.com/rust-lang/rust/commit/37209dcddd7ded55e9a725bfab248eddb6def38b"}], "stats": {"total": 27, "additions": 7, "deletions": 20}, "files": [{"sha": "22502bd4fdb98b28f68f81ff8d3b0052d71dedbc", "filename": "compiler/rustc_hir_analysis/src/collect.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcollect.rs?ref=ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "patch": "@@ -73,7 +73,6 @@ pub fn provide(providers: &mut Providers) {\n         fn_sig,\n         impl_trait_ref,\n         impl_polarity,\n-        is_foreign_item,\n         generator_kind,\n         collect_mod_item_types,\n         is_type_alias_impl_trait,\n@@ -1466,10 +1465,6 @@ fn compute_sig_of_foreign_fn_decl<'tcx>(\n     fty\n }\n \n-fn is_foreign_item(tcx: TyCtxt<'_>, def_id: LocalDefId) -> bool {\n-    matches!(tcx.hir().get_by_def_id(def_id), Node::ForeignItem(..))\n-}\n-\n fn generator_kind(tcx: TyCtxt<'_>, def_id: LocalDefId) -> Option<hir::GeneratorKind> {\n     match tcx.hir().get_by_def_id(def_id) {\n         Node::Expr(&rustc_hir::Expr {"}, {"sha": "deafad394b8219528034e37170a7cab8c7b3a695", "filename": "compiler/rustc_metadata/src/rmeta/decoder.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs?ref=ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "patch": "@@ -1251,14 +1251,6 @@ impl<'a, 'tcx> CrateMetadataRef<'a> {\n         }\n     }\n \n-    fn is_foreign_item(self, id: DefIndex) -> bool {\n-        if let Some(parent) = self.def_key(id).parent {\n-            matches!(self.def_kind(parent), DefKind::ForeignMod)\n-        } else {\n-            false\n-        }\n-    }\n-\n     #[inline]\n     fn def_key(self, index: DefIndex) -> DefKey {\n         *self"}, {"sha": "ca8b6aec05fb520a6c88b78e89223da32dc788c5", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "patch": "@@ -280,7 +280,6 @@ provide! { tcx, def_id, other, cdata,\n     }\n     associated_item => { cdata.get_associated_item(def_id.index, tcx.sess) }\n     inherent_impls => { cdata.get_inherent_implementations_for_type(tcx, def_id.index) }\n-    is_foreign_item => { cdata.is_foreign_item(def_id.index) }\n     item_attrs => { tcx.arena.alloc_from_iter(cdata.get_item_attrs(def_id.index, tcx.sess)) }\n     is_mir_available => { cdata.is_item_mir_available(def_id.index) }\n     is_ctfe_mir_available => { cdata.is_ctfe_mir_available(def_id.index) }"}, {"sha": "ac0b2844177f373da1ff41ae35a2e3c05d373423", "filename": "compiler/rustc_middle/src/hir/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs?ref=ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "patch": "@@ -10,6 +10,7 @@ use crate::query::Providers;\n use crate::ty::{EarlyBinder, ImplSubject, TyCtxt};\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_data_structures::sync::{par_for_each_in, DynSend, DynSync};\n+use rustc_hir::def::DefKind;\n use rustc_hir::def_id::{DefId, LocalDefId};\n use rustc_hir::*;\n use rustc_query_system::ich::StableHashingContext;\n@@ -110,6 +111,12 @@ impl<'tcx> TyCtxt<'tcx> {\n             None => self.type_of(def_id).map_bound(ImplSubject::Inherent),\n         }\n     }\n+\n+    /// Returns `true` if this is a foreign item (i.e., linked via `extern { ... }`).\n+    pub fn is_foreign_item(self, def_id: impl Into<DefId>) -> bool {\n+        self.opt_parent(def_id.into())\n+            .map_or(false, |parent| matches!(self.def_kind(parent), DefKind::ForeignMod))\n+    }\n }\n \n pub fn provide(providers: &mut Providers) {"}, {"sha": "12c94dc46760db10d2e7e4643593df3a5a757101", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6ac450e20dcd1bd0748354b9d13688ea32bf0f/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=ea6ac450e20dcd1bd0748354b9d13688ea32bf0f", "patch": "@@ -726,12 +726,6 @@ rustc_queries! {\n         desc { |tcx| \"checking if item is promotable: `{}`\", tcx.def_path_str(key) }\n     }\n \n-    /// Returns `true` if this is a foreign item (i.e., linked via `extern { ... }`).\n-    query is_foreign_item(key: DefId) -> bool {\n-        desc { |tcx| \"checking if `{}` is a foreign item\", tcx.def_path_str(key) }\n-        separate_provide_extern\n-    }\n-\n     /// Returns `Some(generator_kind)` if the node pointed to by `def_id` is a generator.\n     query generator_kind(def_id: DefId) -> Option<hir::GeneratorKind> {\n         desc { |tcx| \"looking up generator kind of `{}`\", tcx.def_path_str(def_id) }"}]}