{"sha": "01dc27a219435714ec38d0a2ddd1594d96e4da72", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxZGMyN2EyMTk0MzU3MTRlYzM4ZDBhMmRkZDE1OTRkOTZlNGRhNzI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-06-16T20:24:31Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-06-17T01:16:14Z"}, "message": "std: Don't fail the task when a Future is dropped\n\nIt's a benign failure that no one needs to know about.\n\nCloses #14892", "tree": {"sha": "eaacc99d8009dfb522a028b53a52c2478307df5e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eaacc99d8009dfb522a028b53a52c2478307df5e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01dc27a219435714ec38d0a2ddd1594d96e4da72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01dc27a219435714ec38d0a2ddd1594d96e4da72", "html_url": "https://github.com/rust-lang/rust/commit/01dc27a219435714ec38d0a2ddd1594d96e4da72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01dc27a219435714ec38d0a2ddd1594d96e4da72/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0439162d597d4abfebf93096e71ff45242efe6f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0439162d597d4abfebf93096e71ff45242efe6f0", "html_url": "https://github.com/rust-lang/rust/commit/0439162d597d4abfebf93096e71ff45242efe6f0"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "ccc67e3f8b01cb8671c1d7dbfb3aadbf7c134728", "filename": "src/libstd/sync/future.rs", "status": "modified", "additions": 27, "deletions": 1, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/01dc27a219435714ec38d0a2ddd1594d96e4da72/src%2Flibstd%2Fsync%2Ffuture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01dc27a219435714ec38d0a2ddd1594d96e4da72/src%2Flibstd%2Fsync%2Ffuture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsync%2Ffuture.rs?ref=01dc27a219435714ec38d0a2ddd1594d96e4da72", "patch": "@@ -132,7 +132,8 @@ impl<A:Send> Future<A> {\n         let (tx, rx) = channel();\n \n         spawn(proc() {\n-            tx.send(blk());\n+            // Don't fail if the other end has hung up\n+            let _ = tx.send_opt(blk());\n         });\n \n         Future::from_receiver(rx)\n@@ -144,6 +145,7 @@ mod test {\n     use prelude::*;\n     use sync::Future;\n     use task;\n+    use comm::{channel, Sender};\n \n     #[test]\n     fn test_from_value() {\n@@ -206,4 +208,28 @@ mod test {\n             assert_eq!(actual, expected);\n         });\n     }\n+\n+    #[test]\n+    fn test_dropped_future_doesnt_fail() {\n+        struct Bomb(Sender<bool>);\n+\n+        local_data_key!(LOCAL: Bomb)\n+\n+        impl Drop for Bomb {\n+            fn drop(&mut self) {\n+                let Bomb(ref tx) = *self;\n+                tx.send(task::failing());\n+            }\n+        }\n+\n+        // Spawn a future, but drop it immediately. When we receive the result\n+        // later on, we should never view the task as having failed.\n+        let (tx, rx) = channel();\n+        drop(Future::spawn(proc() {\n+            LOCAL.replace(Some(Bomb(tx)));\n+        }));\n+\n+        // Make sure the future didn't fail the task.\n+        assert!(!rx.recv());\n+    }\n }"}]}