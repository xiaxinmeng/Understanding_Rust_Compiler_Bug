{"sha": "545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0NWVmOWQ4M2FiMzgzYmRjOTkzNzZhMmZlNDE2NGU0NmY0YTNmNmU=", "commit": {"author": {"name": "Tim Diekmann", "email": "tim.diekmann@3dvision.de", "date": "2020-03-07T01:40:54Z"}, "committer": {"name": "Tim Diekmann", "email": "tim.diekmann@3dvision.de", "date": "2020-03-07T01:40:54Z"}, "message": "Add `Layout::dangling()` to return a well-aligned `NonNull<u8>`", "tree": {"sha": "b6ac4c86c0c531b21778c34469dfc0cad9eb6539", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b6ac4c86c0c531b21778c34469dfc0cad9eb6539"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "html_url": "https://github.com/rust-lang/rust/commit/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/comments", "author": {"login": "TimDiekmann", "id": 21277928, "node_id": "MDQ6VXNlcjIxMjc3OTI4", "avatar_url": "https://avatars.githubusercontent.com/u/21277928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimDiekmann", "html_url": "https://github.com/TimDiekmann", "followers_url": "https://api.github.com/users/TimDiekmann/followers", "following_url": "https://api.github.com/users/TimDiekmann/following{/other_user}", "gists_url": "https://api.github.com/users/TimDiekmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimDiekmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimDiekmann/subscriptions", "organizations_url": "https://api.github.com/users/TimDiekmann/orgs", "repos_url": "https://api.github.com/users/TimDiekmann/repos", "events_url": "https://api.github.com/users/TimDiekmann/events{/privacy}", "received_events_url": "https://api.github.com/users/TimDiekmann/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TimDiekmann", "id": 21277928, "node_id": "MDQ6VXNlcjIxMjc3OTI4", "avatar_url": "https://avatars.githubusercontent.com/u/21277928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimDiekmann", "html_url": "https://github.com/TimDiekmann", "followers_url": "https://api.github.com/users/TimDiekmann/followers", "following_url": "https://api.github.com/users/TimDiekmann/following{/other_user}", "gists_url": "https://api.github.com/users/TimDiekmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimDiekmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimDiekmann/subscriptions", "organizations_url": "https://api.github.com/users/TimDiekmann/orgs", "repos_url": "https://api.github.com/users/TimDiekmann/repos", "events_url": "https://api.github.com/users/TimDiekmann/events{/privacy}", "received_events_url": "https://api.github.com/users/TimDiekmann/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2890b37b861247de3b8c6ba2ecbcd00048c728a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2890b37b861247de3b8c6ba2ecbcd00048c728a1", "html_url": "https://github.com/rust-lang/rust/commit/2890b37b861247de3b8c6ba2ecbcd00048c728a1"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "4f401c75104de4997645c32a0187e92014158e98", "filename": "src/libcore/alloc.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Falloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Falloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Falloc.rs?ref=545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "patch": "@@ -140,6 +140,18 @@ impl Layout {\n         unsafe { Layout::from_size_align_unchecked(size, align) }\n     }\n \n+    /// Creates a `NonNull` that is dangling, but well-aligned for this Layout.\n+    ///\n+    /// Note that the pointer value may potentially represent a valid pointer to\n+    /// a `T`, which means this must not be used as a \"not yet initialized\"\n+    /// sentinel value. Types that lazily allocate must track initialization by\n+    /// some other means.\n+    #[unstable(feature = \"alloc_layout_extra\", issue = \"55724\")]\n+    pub const fn dangling(&self) -> NonNull<u8> {\n+        // align is non-zero and a power of two\n+        unsafe { NonNull::new_unchecked(self.align() as *mut u8) }\n+    }\n+\n     /// Creates a layout describing the record that can hold a value\n     /// of the same layout as `self`, but that also is aligned to\n     /// alignment `align` (measured in bytes)."}, {"sha": "c8592e40a69a0168016db92542748a8efded529b", "filename": "src/libcore/tests/alloc.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Ftests%2Falloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Ftests%2Falloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Falloc.rs?ref=545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "patch": "@@ -1,10 +1,13 @@\n use core::alloc::Layout;\n+use core::ptr::NonNull;\n \n #[test]\n fn const_unchecked_layout() {\n     const SIZE: usize = 0x2000;\n     const ALIGN: usize = 0x1000;\n     const LAYOUT: Layout = unsafe { Layout::from_size_align_unchecked(SIZE, ALIGN) };\n+    const DANGLING: NonNull<u8> = LAYOUT.dangling();\n     assert_eq!(LAYOUT.size(), SIZE);\n     assert_eq!(LAYOUT.align(), ALIGN);\n+    assert_eq!(Some(DANGLING), NonNull::new(ALIGN as *mut u8));\n }"}, {"sha": "71a061af28920f3de14793e55921cd9b84d3ab30", "filename": "src/libcore/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/545ef9d83ab383bdc99376a2fe4164e46f4a3f6e/src%2Flibcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Flib.rs?ref=545ef9d83ab383bdc99376a2fe4164e46f4a3f6e", "patch": "@@ -1,3 +1,4 @@\n+#![feature(alloc_layout_extra)]\n #![feature(bool_to_option)]\n #![feature(bound_cloned)]\n #![feature(box_syntax)]"}]}