{"sha": "c4b34eebefc79d01d75efea0f5159b22a35891cf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0YjM0ZWViZWZjNzlkMDFkNzVlZmVhMGY1MTU5YjIyYTM1ODkxY2Y=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-12-21T01:47:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-21T01:47:49Z"}, "message": "Rollup merge of #80240 - yshui:master, r=Mark-Simulacrum\n\nmake sure installer only creates directories in DESTDIR\n\nFixes #80238\n\nSigned-off-by: Yuxuan Shui <yshuiv7@gmail.com>", "tree": {"sha": "9643d1116c6f22baa376fe944b3c91e8946631df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9643d1116c6f22baa376fe944b3c91e8946631df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4b34eebefc79d01d75efea0f5159b22a35891cf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf3/7FCRBK7hj4Ov3rIwAAdHIIAG80AWpiId4Asl63umc83TSY\nNIafEdBL6Ac6HxqxXixsEPugYFNotJy/0obQjDAX1hC0ErdsfY4q+YHeNqRmVEnJ\nFUMfbye6QL9CcmqogneXJIhJTXcNJe7FkbxL0K+iJVPkWrxMfsoQvDf9nUGBjavP\n/m5N2NrptYgqUy3QGN0uT8osU7Rt48t2BcWv9SS3Cy3lWuTFN4OtSwj7lxoz/eCC\nUTaJ3zum3mrhI/8k4BQ8Y2uPH/ucDTuDdnH4hHwOSCZfHpSXKnRD0CASgEZwUSFe\nkrRohlLsEgmyMUq9mdMjbyLjksQLqavG1QH2wRoDfwuy92vihwRuxLjcg4D7JIA=\n=Da19\n-----END PGP SIGNATURE-----\n", "payload": "tree 9643d1116c6f22baa376fe944b3c91e8946631df\nparent ce93f5a8bb46208e41e0855c96e12a5ff8dd0f4e\nparent fbc9d50d752ab298aea2844d236095b198e96fe6\nauthor Dylan DPC <dylan.dpc@gmail.com> 1608515269 +0100\ncommitter GitHub <noreply@github.com> 1608515269 +0100\n\nRollup merge of #80240 - yshui:master, r=Mark-Simulacrum\n\nmake sure installer only creates directories in DESTDIR\n\nFixes #80238\n\nSigned-off-by: Yuxuan Shui <yshuiv7@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4b34eebefc79d01d75efea0f5159b22a35891cf", "html_url": "https://github.com/rust-lang/rust/commit/c4b34eebefc79d01d75efea0f5159b22a35891cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4b34eebefc79d01d75efea0f5159b22a35891cf/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce93f5a8bb46208e41e0855c96e12a5ff8dd0f4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce93f5a8bb46208e41e0855c96e12a5ff8dd0f4e", "html_url": "https://github.com/rust-lang/rust/commit/ce93f5a8bb46208e41e0855c96e12a5ff8dd0f4e"}, {"sha": "fbc9d50d752ab298aea2844d236095b198e96fe6", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbc9d50d752ab298aea2844d236095b198e96fe6", "html_url": "https://github.com/rust-lang/rust/commit/fbc9d50d752ab298aea2844d236095b198e96fe6"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8f2b128b3688e745ceddbd54785797a19bf669fd", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c4b34eebefc79d01d75efea0f5159b22a35891cf/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4b34eebefc79d01d75efea0f5159b22a35891cf/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=c4b34eebefc79d01d75efea0f5159b22a35891cf", "patch": "@@ -73,12 +73,7 @@ fn install_sh(\n     let docdir_default = datadir_default.join(\"doc/rust\");\n     let libdir_default = PathBuf::from(\"lib\");\n     let mandir_default = datadir_default.join(\"man\");\n-    let prefix = builder.config.prefix.as_ref().map_or(prefix_default, |p| {\n-        fs::create_dir_all(p)\n-            .unwrap_or_else(|err| panic!(\"could not create {}: {}\", p.display(), err));\n-        fs::canonicalize(p)\n-            .unwrap_or_else(|err| panic!(\"could not canonicalize {}: {}\", p.display(), err))\n-    });\n+    let prefix = builder.config.prefix.as_ref().unwrap_or(&prefix_default);\n     let sysconfdir = builder.config.sysconfdir.as_ref().unwrap_or(&sysconfdir_default);\n     let datadir = builder.config.datadir.as_ref().unwrap_or(&datadir_default);\n     let docdir = builder.config.docdir.as_ref().unwrap_or(&docdir_default);\n@@ -103,6 +98,13 @@ fn install_sh(\n     let libdir = add_destdir(&libdir, &destdir);\n     let mandir = add_destdir(&mandir, &destdir);\n \n+    let prefix = {\n+        fs::create_dir_all(&prefix)\n+            .unwrap_or_else(|err| panic!(\"could not create {}: {}\", prefix.display(), err));\n+        fs::canonicalize(&prefix)\n+            .unwrap_or_else(|err| panic!(\"could not canonicalize {}: {}\", prefix.display(), err))\n+    };\n+\n     let empty_dir = builder.out.join(\"tmp/empty_dir\");\n \n     t!(fs::create_dir_all(&empty_dir));"}]}