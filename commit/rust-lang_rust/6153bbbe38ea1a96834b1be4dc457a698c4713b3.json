{"sha": "6153bbbe38ea1a96834b1be4dc457a698c4713b3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxNTNiYmJlMzhlYTFhOTY4MzRiMWJlNGRjNDU3YTY5OGM0NzEzYjM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-08-08T00:31:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-08T00:31:55Z"}, "message": "Auto merge of #35402 - KiChjang:e0206-new-msg, r=GuillaumeGomez\n\nUpdate E0206 message to new format\n\nPart of #35233.\nFixes #35301.\n\nr? @GuillaumeGomez", "tree": {"sha": "80d2faa04310b1741db6c41b7871082125b19028", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/80d2faa04310b1741db6c41b7871082125b19028"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6153bbbe38ea1a96834b1be4dc457a698c4713b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6153bbbe38ea1a96834b1be4dc457a698c4713b3", "html_url": "https://github.com/rust-lang/rust/commit/6153bbbe38ea1a96834b1be4dc457a698c4713b3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6153bbbe38ea1a96834b1be4dc457a698c4713b3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1744c46e47434d8c0b63a839678ce45f1988bb74", "url": "https://api.github.com/repos/rust-lang/rust/commits/1744c46e47434d8c0b63a839678ce45f1988bb74", "html_url": "https://github.com/rust-lang/rust/commit/1744c46e47434d8c0b63a839678ce45f1988bb74"}, {"sha": "53baa09bfe1bb8211060dae3eb8bbfe0c637cfb7", "url": "https://api.github.com/repos/rust-lang/rust/commits/53baa09bfe1bb8211060dae3eb8bbfe0c637cfb7", "html_url": "https://github.com/rust-lang/rust/commit/53baa09bfe1bb8211060dae3eb8bbfe0c637cfb7"}], "stats": {"total": 54, "additions": 39, "deletions": 15}, "files": [{"sha": "cdf2ca14d4c78366a4a8284d9ac63eace14c2b01", "filename": "src/librustc_typeck/coherence/mod.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Flibrustc_typeck%2Fcoherence%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Flibrustc_typeck%2Fcoherence%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcoherence%2Fmod.rs?ref=6153bbbe38ea1a96834b1be4dc457a698c4713b3", "patch": "@@ -330,10 +330,17 @@ impl<'a, 'gcx, 'tcx> CoherenceChecker<'a, 'gcx, 'tcx> {\n                            .emit()\n                 }\n                 Err(CopyImplementationError::NotAnAdt) => {\n-                       span_err!(tcx.sess, span, E0206,\n-                                 \"the trait `Copy` may not be implemented \\\n-                                  for this type; type is not a structure or \\\n-                                  enumeration\")\n+                    let item = tcx.map.expect_item(impl_node_id);\n+                    let span = if let ItemImpl(_, _, _, _, ref ty, _) = item.node {\n+                        ty.span\n+                    } else {\n+                        span\n+                    };\n+\n+                    struct_span_err!(tcx.sess, span, E0206,\n+                                     \"the trait `Copy` may not be implemented for this type\")\n+                        .span_label(span, &format!(\"type is not a structure or enumeration\"))\n+                        .emit();\n                 }\n                 Err(CopyImplementationError::HasDestructor) => {\n                     span_err!(tcx.sess, span, E0184,"}, {"sha": "888e42ed3a18cea72870207b7b9cbc459fea7417", "filename": "src/test/compile-fail/E0206.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Ftest%2Fcompile-fail%2FE0206.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Ftest%2Fcompile-fail%2FE0206.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0206.rs?ref=6153bbbe38ea1a96834b1be4dc457a698c4713b3", "patch": "@@ -10,13 +10,19 @@\n \n type Foo = i32;\n \n-impl Copy for Foo { } //~ ERROR E0206\n-                      //~^ ERROR E0117\n+impl Copy for Foo { }\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n+//~| ERROR only traits defined in the current crate can be implemented for arbitrary types\n+//~| NOTE impl doesn't use types inside crate\n+//~| NOTE the impl does not reference any types defined in this crate\n \n #[derive(Copy, Clone)]\n struct Bar;\n \n-impl Copy for &'static Bar { } //~ ERROR E0206\n+impl Copy for &'static Bar { }\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n \n fn main() {\n }"}, {"sha": "f686a146042cee4351a2c1874605d7a3ab7e000a", "filename": "src/test/compile-fail/coherence-impls-copy.rs", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Ftest%2Fcompile-fail%2Fcoherence-impls-copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6153bbbe38ea1a96834b1be4dc457a698c4713b3/src%2Ftest%2Fcompile-fail%2Fcoherence-impls-copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcoherence-impls-copy.rs?ref=6153bbbe38ea1a96834b1be4dc457a698c4713b3", "patch": "@@ -27,23 +27,34 @@ impl Clone for TestE { fn clone(&self) -> Self { *self } }\n impl Copy for MyType {}\n \n impl Copy for &'static mut MyType {}\n-//~^ ERROR E0206\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n impl Clone for MyType { fn clone(&self) -> Self { *self } }\n \n impl Copy for (MyType, MyType) {}\n-//~^ ERROR E0206\n-//~| ERROR E0117\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n+//~| ERROR only traits defined in the current crate can be implemented for arbitrary types\n+//~| NOTE impl doesn't use types inside crate\n+//~| NOTE the impl does not reference any types defined in this crate\n \n impl Copy for &'static NotSync {}\n-//~^ ERROR E0206\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n \n impl Copy for [MyType] {}\n-//~^ ERROR E0206\n-//~| ERROR E0117\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n+//~| ERROR only traits defined in the current crate can be implemented for arbitrary types\n+//~| NOTE impl doesn't use types inside crate\n+//~| NOTE the impl does not reference any types defined in this crate\n \n impl Copy for &'static [NotSync] {}\n-//~^ ERROR E0206\n-//~| ERROR E0117\n+//~^ ERROR the trait `Copy` may not be implemented for this type\n+//~| NOTE type is not a structure or enumeration\n+//~| ERROR only traits defined in the current crate can be implemented for arbitrary types\n+//~| NOTE impl doesn't use types inside crate\n+//~| NOTE the impl does not reference any types defined in this crate\n \n fn main() {\n }"}]}