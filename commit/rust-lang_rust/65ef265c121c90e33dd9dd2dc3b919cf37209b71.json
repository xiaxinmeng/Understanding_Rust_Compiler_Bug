{"sha": "65ef265c121c90e33dd9dd2dc3b919cf37209b71", "node_id": "C_kwDOAAsO6NoAKDY1ZWYyNjVjMTIxYzkwZTMzZGQ5ZGQyZGMzYjkxOWNmMzcyMDliNzE", "commit": {"author": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-10-01T19:22:18Z"}, "committer": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-10-01T19:22:18Z"}, "message": "Call `libc::sigaction()` only on Android", "tree": {"sha": "cc11115b5470763bccb293ca8c02417b5f4aaef5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc11115b5470763bccb293ca8c02417b5f4aaef5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/65ef265c121c90e33dd9dd2dc3b919cf37209b71", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/65ef265c121c90e33dd9dd2dc3b919cf37209b71", "html_url": "https://github.com/rust-lang/rust/commit/65ef265c121c90e33dd9dd2dc3b919cf37209b71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/65ef265c121c90e33dd9dd2dc3b919cf37209b71/comments", "author": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3e5ae91d07f7d4256acac7abac6a204b6abc491", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3e5ae91d07f7d4256acac7abac6a204b6abc491", "html_url": "https://github.com/rust-lang/rust/commit/e3e5ae91d07f7d4256acac7abac6a204b6abc491"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "5837c1553ec21d8c32719eead97f53337c0406ba", "filename": "library/std/src/sys/unix/process/process_unix.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/65ef265c121c90e33dd9dd2dc3b919cf37209b71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65ef265c121c90e33dd9dd2dc3b919cf37209b71/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs?ref=65ef265c121c90e33dd9dd2dc3b919cf37209b71", "patch": "@@ -333,9 +333,20 @@ impl Command {\n             let mut set = MaybeUninit::<libc::sigset_t>::uninit();\n             cvt(sigemptyset(set.as_mut_ptr()))?;\n             cvt(libc::pthread_sigmask(libc::SIG_SETMASK, set.as_ptr(), ptr::null_mut()))?;\n-            let mut action: libc::sigaction = mem::zeroed();\n-            action.sa_sigaction = libc::SIG_DFL;\n-            cvt(libc::sigaction(libc::SIGPIPE, &action, ptr::null_mut()))?;\n+\n+            #[cfg(target_os = \"android\")] // see issue #88585\n+            {\n+                let mut action: libc::sigaction = mem::zeroed();\n+                action.sa_sigaction = libc::SIG_DFL;\n+                cvt(libc::sigaction(libc::SIGPIPE, &action, ptr::null_mut()))?;\n+            }\n+            #[cfg(not(target_os = \"android\"))]\n+            {\n+                let ret = sys::signal(libc::SIGPIPE, libc::SIG_DFL);\n+                if ret == libc::SIG_ERR {\n+                    return Err(io::Error::last_os_error());\n+                }\n+            }\n         }\n \n         for callback in self.get_closures().iter_mut() {"}]}