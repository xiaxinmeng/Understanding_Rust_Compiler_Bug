{"sha": "cce93436d3628f5fa8288c7e84f4b695542c6ae3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjZTkzNDM2ZDM2MjhmNWZhODI4OGM3ZTg0ZjRiNjk1NTQyYzZhZTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-07T05:32:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-07T05:32:49Z"}, "message": "Auto merge of #44515 - tamird:clean-shims, r=alexcrichton\n\n{compiler-builtins,libc} shim cleanup\n\n~~Depends on https://github.com/rust-lang/libc/pull/764; opening early for feedback.~~ r? @alexcrichton", "tree": {"sha": "64415f221d2323ca33e412c1e5cc3204776abd4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64415f221d2323ca33e412c1e5cc3204776abd4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cce93436d3628f5fa8288c7e84f4b695542c6ae3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cce93436d3628f5fa8288c7e84f4b695542c6ae3", "html_url": "https://github.com/rust-lang/rust/commit/cce93436d3628f5fa8288c7e84f4b695542c6ae3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cce93436d3628f5fa8288c7e84f4b695542c6ae3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11f6d535532d1a8cc721117e2644da0b47271e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/e11f6d535532d1a8cc721117e2644da0b47271e5", "html_url": "https://github.com/rust-lang/rust/commit/e11f6d535532d1a8cc721117e2644da0b47271e5"}, {"sha": "7d6c3dafbd4b2afc03377572964ee60678096fac", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d6c3dafbd4b2afc03377572964ee60678096fac", "html_url": "https://github.com/rust-lang/rust/commit/7d6c3dafbd4b2afc03377572964ee60678096fac"}], "stats": {"total": 32, "additions": 22, "deletions": 10}, "files": [{"sha": "886e239246d2558f4dfffdc3f8378740029a58a0", "filename": "src/rustc/compiler_builtins_shim/Cargo.toml", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cce93436d3628f5fa8288c7e84f4b695542c6ae3/src%2Frustc%2Fcompiler_builtins_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cce93436d3628f5fa8288c7e84f4b695542c6ae3/src%2Frustc%2Fcompiler_builtins_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fcompiler_builtins_shim%2FCargo.toml?ref=cce93436d3628f5fa8288c7e84f4b695542c6ae3", "patch": "@@ -1,5 +1,3 @@\n-# See libc_shim/Cargo.toml for why this exists\n-\n [package]\n name = \"compiler_builtins\"\n authors = [\"The Rust Project Developers\"]\n@@ -12,6 +10,23 @@ test = false\n doctest = false\n \n [dependencies]\n+# Specify the path to libcore; at the time of writing, removing this shim in\n+# favor of using compiler-builtins from git results in a compilation failure:\n+#\n+# Building stage0 std artifacts (x86_64-apple-darwin -> x86_64-apple-darwin)\n+#    Compiling compiler_builtins v0.1.0 (https://github.com/rust-lang-nursery/compiler-builtins.git#23f14d3f)\n+# error[E0463]: can't find crate for `core`\n+#\n+# error: aborting due to previous error\n+#\n+# error: Could not compile `compiler_builtins`.\n+#\n+# Caused by:\n+#   process didn't exit successfully: `/Users/tamird/src/rust/build/bootstrap/debug/rustc --crate-name compiler_builtins /Users/tamird/.cargo/git/checkouts/compiler-builtins-ec094dc45a0179c8/23f14d3/src/lib.rs --error-format json --crate-type lib --emit=dep-info,link -C opt-level=2 --cfg feature=\"c\" --cfg feature=\"compiler-builtins\" --cfg feature=\"default\" --cfg feature=\"gcc\" -C metadata=876d429e8d7eae1f -C extra-filename=-876d429e8d7eae1f --out-dir /Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps --target x86_64-apple-darwin -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/release/deps --cap-lints allow -L native=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/build/compiler_builtins-f18fab55928102ad/out -l static=compiler-rt` (exit code: 101)\n+# thread 'main' panicked at 'command did not execute successfully: \"/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0/bin/cargo\" \"build\" \"-j\" \"4\" \"--target\" \"x86_64-apple-darwin\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/Users/tamird/src/rust/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\n+# expected success, got: exit code: 101', src/bootstrap/compile.rs:883:8\n+#\n+# See https://github.com/rust-lang/rfcs/pull/1133.\n core = { path = \"../../libcore\" }\n \n [build-dependencies]"}, {"sha": "b37543e5f679db8ffc0733faae909268e8e90f6c", "filename": "src/rustc/compiler_builtins_shim/build.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/cce93436d3628f5fa8288c7e84f4b695542c6ae3/src%2Frustc%2Fcompiler_builtins_shim%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cce93436d3628f5fa8288c7e84f4b695542c6ae3/src%2Frustc%2Fcompiler_builtins_shim%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fcompiler_builtins_shim%2Fbuild.rs?ref=cce93436d3628f5fa8288c7e84f4b695542c6ae3", "patch": "@@ -8,11 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![deny(warnings)]\n-\n-// See comments in Cargo.toml for why this exists\n-\n-fn main() {\n-    println!(\"cargo:rustc-cfg=stdbuild\");\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-}\n+// This file is left intentionally empty (and not removed) to avoid an issue\n+// where this crate is always considered dirty due to compiler-builtins'\n+// `cargo:rerun-if-changed=build.rs` directive; since the path is relative, it\n+// refers to this file when this shim crate is being built, and the absence of\n+// this file is considered by cargo to be equivalent to it having changed."}]}