{"sha": "ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlODk4MTgzYjgzZWIyY2Y4NmM4YzZjZWVlYWMxNmVmNjhmZGM4MDI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-11T07:03:03Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-11T07:03:03Z"}, "message": "Simplify tests", "tree": {"sha": "2fa5c6fb6ac70f6b24d2463c2f985005ca17260f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fa5c6fb6ac70f6b24d2463c2f985005ca17260f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "html_url": "https://github.com/rust-lang/rust/commit/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b18d2882f4f05078abfcf0595d08c226860de6c3", "url": "https://api.github.com/repos/rust-lang/rust/commits/b18d2882f4f05078abfcf0595d08c226860de6c3", "html_url": "https://github.com/rust-lang/rust/commit/b18d2882f4f05078abfcf0595d08c226860de6c3"}], "stats": {"total": 89, "additions": 36, "deletions": 53}, "files": [{"sha": "5a76ea82b3dacdf6c55635d22bffe61cf349f26f", "filename": "crates/libsyntax2/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802/crates%2Flibsyntax2%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802/crates%2Flibsyntax2%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibsyntax2%2FCargo.toml?ref=ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "patch": "@@ -12,4 +12,4 @@ drop_bomb = \"0.1.4\"\n parking_lot = \"0.6.0\"\n \n [dev-dependencies]\n-testutils = { path = \"./tests/testutils\" }\n+difference = \"2.0.0\""}, {"sha": "46ac9fedd49885cac1dac464c3ba355a15db0185", "filename": "crates/libsyntax2/tests/lexer.rs", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibsyntax2%2Ftests%2Flexer.rs?ref=b18d2882f4f05078abfcf0595d08c226860de6c3", "patch": "@@ -1,28 +0,0 @@\n-extern crate libsyntax2;\n-extern crate testutils;\n-\n-use std::fmt::Write;\n-\n-use libsyntax2::{tokenize, Token};\n-use testutils::dir_tests;\n-\n-#[test]\n-fn lexer_tests() {\n-    dir_tests(&[\"lexer\"], |text| {\n-        let tokens = tokenize(text);\n-        dump_tokens(&tokens, text)\n-    })\n-}\n-\n-fn dump_tokens(tokens: &[Token], text: &str) -> String {\n-    let mut acc = String::new();\n-    let mut offset = 0;\n-    for token in tokens {\n-        let len: u32 = token.len.into();\n-        let len = len as usize;\n-        let token_text = &text[offset..offset + len];\n-        offset += len;\n-        write!(acc, \"{:?} {} {:?}\\n\", token.kind, token.len, token_text).unwrap()\n-    }\n-    acc\n-}"}, {"sha": "af2ae11bb3769cf0dc6f08505481d5e343b6eece", "filename": "crates/libsyntax2/tests/parser.rs", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibsyntax2%2Ftests%2Fparser.rs?ref=b18d2882f4f05078abfcf0595d08c226860de6c3", "patch": "@@ -1,14 +0,0 @@\n-extern crate libsyntax2;\n-extern crate testutils;\n-\n-use libsyntax2::parse;\n-use libsyntax2::utils::dump_tree;\n-use testutils::dir_tests;\n-\n-#[test]\n-fn parser_tests() {\n-    dir_tests(&[\"parser/inline\", \"parser/ok\", \"parser/err\"], |text| {\n-        let file = parse(text);\n-        dump_tree(&file)\n-    })\n-}"}, {"sha": "18e5bc4d46f9456bd80cc91072ecbdfa3bd452ee", "filename": "crates/libsyntax2/tests/test/main.rs", "status": "renamed", "additions": 35, "deletions": 3, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802/crates%2Flibsyntax2%2Ftests%2Ftest%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce898183b83eb2cf86c8c6ceeeac16ef68fdc802/crates%2Flibsyntax2%2Ftests%2Ftest%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibsyntax2%2Ftests%2Ftest%2Fmain.rs?ref=ce898183b83eb2cf86c8c6ceeeac16ef68fdc802", "patch": "@@ -1,12 +1,31 @@\n+extern crate libsyntax2;\n extern crate difference;\n \n use std::{\n     fs,\n     path::{Path, PathBuf},\n+    fmt::Write,\n };\n \n use difference::Changeset;\n \n+#[test]\n+fn lexer_tests() {\n+    dir_tests(&[\"lexer\"], |text| {\n+        let tokens = libsyntax2::tokenize(text);\n+        dump_tokens(&tokens, text)\n+    })\n+}\n+\n+#[test]\n+fn parser_tests() {\n+    dir_tests(&[\"parser/inline\", \"parser/ok\", \"parser/err\"], |text| {\n+        let file = libsyntax2::parse(text);\n+        libsyntax2::utils::dump_tree(&file)\n+    })\n+}\n+\n+\n /// Read file and normalize newlines.\n ///\n /// `rustc` seems to always normalize `\\r\\n` newlines to `\\n`:\n@@ -23,8 +42,8 @@ fn read_text(path: &Path) -> String {\n }\n \n pub fn dir_tests<F>(paths: &[&str], f: F)\n-where\n-    F: Fn(&str) -> String,\n+    where\n+        F: Fn(&str) -> String,\n {\n     for path in collect_tests(paths) {\n         let input_code = read_text(&path);\n@@ -107,5 +126,18 @@ fn project_dir() -> PathBuf {\n }\n \n fn test_data_dir() -> PathBuf {\n-    project_dir().join(\"tests/data\")\n+    project_dir().join(\"crates/libsyntax2/tests/data\")\n+}\n+\n+fn dump_tokens(tokens: &[libsyntax2::Token], text: &str) -> String {\n+    let mut acc = String::new();\n+    let mut offset = 0;\n+    for token in tokens {\n+        let len: u32 = token.len.into();\n+        let len = len as usize;\n+        let token_text = &text[offset..offset + len];\n+        offset += len;\n+        write!(acc, \"{:?} {} {:?}\\n\", token.kind, token.len, token_text).unwrap()\n+    }\n+    acc\n }", "previous_filename": "crates/libsyntax2/tests/testutils/src/lib.rs"}, {"sha": "53b20f17bca92d99e7f4f05f369a6c5b137540d7", "filename": "crates/libsyntax2/tests/testutils/Cargo.toml", "status": "removed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Ftestutils%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b18d2882f4f05078abfcf0595d08c226860de6c3/crates%2Flibsyntax2%2Ftests%2Ftestutils%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibsyntax2%2Ftests%2Ftestutils%2FCargo.toml?ref=b18d2882f4f05078abfcf0595d08c226860de6c3", "patch": "@@ -1,7 +0,0 @@\n-[package]\n-name = \"testutils\"\n-version = \"0.1.0\"\n-authors = [\"Aleksey Kladov <aleksey.kladov@gmail.com>\"]\n-\n-[dependencies]\n-difference = \"2.0.0\""}]}