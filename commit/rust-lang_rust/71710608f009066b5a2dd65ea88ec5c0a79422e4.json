{"sha": "71710608f009066b5a2dd65ea88ec5c0a79422e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxNzEwNjA4ZjAwOTA2NmI1YTJkZDY1ZWE4OGVjNWMwYTc5NDIyZTQ=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-11-28T20:32:43Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-11-28T20:32:43Z"}, "message": "rustc: hide HirId's fmt::Debug output from -Z span_free_formats.", "tree": {"sha": "c82bf4e576411e68785f4ea18bd82c98c846989d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c82bf4e576411e68785f4ea18bd82c98c846989d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/71710608f009066b5a2dd65ea88ec5c0a79422e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/71710608f009066b5a2dd65ea88ec5c0a79422e4", "html_url": "https://github.com/rust-lang/rust/commit/71710608f009066b5a2dd65ea88ec5c0a79422e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/71710608f009066b5a2dd65ea88ec5c0a79422e4/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f453d1127d9095cf3c3356655d9e8502ceeb8373", "url": "https://api.github.com/repos/rust-lang/rust/commits/f453d1127d9095cf3c3356655d9e8502ceeb8373", "html_url": "https://github.com/rust-lang/rust/commit/f453d1127d9095cf3c3356655d9e8502ceeb8373"}], "stats": {"total": 30, "additions": 17, "deletions": 13}, "files": [{"sha": "bcb245d862b6b81d8625293fe0b51d4328f90c2d", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -2302,10 +2302,14 @@ impl<'tcx> Debug for Rvalue<'tcx> {\n                         }\n                     }\n \n-                    AggregateKind::Closure(def_id, _) => ty::tls::with(|tcx| {\n+                    AggregateKind::Closure(def_id, substs) => ty::tls::with(|tcx| {\n                         if let Some(hir_id) = tcx.hir().as_local_hir_id(def_id) {\n                             let name = if tcx.sess.opts.debugging_opts.span_free_formats {\n-                                format!(\"[closure@{:?}]\", hir_id)\n+                                let substs = tcx.lift(&substs).unwrap();\n+                                format!(\n+                                    \"[closure@{}]\",\n+                                    tcx.def_path_str_with_substs(def_id, substs),\n+                                )\n                             } else {\n                                 format!(\"[closure@{:?}]\", tcx.hir().span(hir_id))\n                             };"}, {"sha": "8d2f5600bac2924b2b1b5cf7be29adeb8e711682", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -682,7 +682,7 @@ pub trait PrettyPrinter<'tcx>:\n                 // FIXME(eddyb) should use `def_span`.\n                 if let Some(hir_id) = self.tcx().hir().as_local_hir_id(did) {\n                     if self.tcx().sess.opts.debugging_opts.span_free_formats {\n-                        p!(write(\"@{:?}\", hir_id));\n+                        p!(write(\"@\"), print_def_path(did, substs));\n                     } else {\n                         p!(write(\"@{:?}\", self.tcx().hir().span(hir_id)));\n                     }"}, {"sha": "768f4953228095acd9a5c786afb44c0dda82e079", "filename": "src/test/mir-opt/inline-closure-borrows-arg.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -21,8 +21,8 @@ fn foo<T: Copy>(_t: T, q: &i32) -> i32 {\n //     debug _t => _1;\n //     debug q => _2;\n //     let mut _0: i32;\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 31 }];\n-//     let mut _4: &[closure@HirId { owner: DefIndex(4), local_id: 31 }];\n+//     let _3: [closure@foo<T>::{{closure}}#0];\n+//     let mut _4: &[closure@foo<T>::{{closure}}#0];\n //     let mut _5: (&i32, &i32);\n //     let mut _6: &i32;\n //     let mut _7: &i32;\n@@ -40,7 +40,7 @@ fn foo<T: Copy>(_t: T, q: &i32) -> i32 {\n //     }\n //     bb0: {\n //         ...\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 31 }];\n+//         _3 = [closure@foo::<T>::{{closure}}#0];\n //         ...\n //         _4 = &_3;\n //         ..."}, {"sha": "e000a418d90c79ae05e2d392169fb15c5f340884", "filename": "src/test/mir-opt/inline-closure-captures.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -17,10 +17,10 @@ fn foo<T: Copy>(t: T, q: i32) -> (i32, T) {\n //     debug t => _1;\n //     debug q => _2;\n //     let mut _0: (i32, T);\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T];\n+//     let _3: [closure@foo<T>::{{closure}}#0 q:&i32, t:&T];\n //     let mut _4: &i32;\n //     let mut _5: &T;\n-//     let mut _6: &[closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T];\n+//     let mut _6: &[closure@foo<T>::{{closure}}#0 q:&i32, t:&T];\n //     let mut _7: (i32,);\n //     let mut _8: i32;\n //     let mut _11: i32;\n@@ -39,7 +39,7 @@ fn foo<T: Copy>(t: T, q: i32) -> (i32, T) {\n //         _4 = &_2;\n //         ...\n //         _5 = &_1;\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 15 }] { q: move _4, t: move _5 };\n+//         _3 = [closure@foo::<T>::{{closure}}#0] { q: move _4, t: move _5 };\n //         ...\n //         _6 = &_3;\n //         ..."}, {"sha": "bd36e77818edce1d72489068724e1f16f2e3305c", "filename": "src/test/mir-opt/inline-closure.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Finline-closure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -17,8 +17,8 @@ fn foo<T: Copy>(_t: T, q: i32) -> i32 {\n //     debug _t => _1;\n //     debug q => _2;\n //     let mut _0: i32;\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 15 }];\n-//     let mut _4: &[closure@HirId { owner: DefIndex(4), local_id: 15 }];\n+//     let _3: [closure@foo<T>::{{closure}}#0];\n+//     let mut _4: &[closure@foo<T>::{{closure}}#0];\n //     let mut _5: (i32, i32);\n //     let mut _6: i32;\n //     let mut _7: i32;\n@@ -33,7 +33,7 @@ fn foo<T: Copy>(_t: T, q: i32) -> i32 {\n //     }\n //     bb0: {\n //         ...\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 15 }];\n+//         _3 = [closure@foo::<T>::{{closure}}#0];\n //         ...\n //         _4 = &_3;\n //         ..."}, {"sha": "32995448a21e95209683188b5a8330b006605776", "filename": "src/test/mir-opt/retag.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Fretag.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71710608f009066b5a2dd65ea88ec5c0a79422e4/src%2Ftest%2Fmir-opt%2Fretag.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fretag.rs?ref=71710608f009066b5a2dd65ea88ec5c0a79422e4", "patch": "@@ -100,7 +100,7 @@ fn main() {\n // }\n // END rustc.main.EraseRegions.after.mir\n // START rustc.main-{{closure}}.EraseRegions.after.mir\n-// fn main::{{closure}}#0(_1: &[closure@HirId { owner: DefIndex(13), local_id: 72 }], _2: &i32) -> &i32 {\n+// fn main::{{closure}}#0(_1: &[closure@main::{{closure}}#0], _2: &i32) -> &i32 {\n //     ...\n //     bb0: {\n //         Retag([fn entry] _1);"}]}