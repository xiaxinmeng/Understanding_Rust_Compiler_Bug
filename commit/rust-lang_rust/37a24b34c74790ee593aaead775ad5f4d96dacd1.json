{"sha": "37a24b34c74790ee593aaead775ad5f4d96dacd1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3YTI0YjM0Yzc0NzkwZWU1OTNhYWVhZDc3NWFkNWY0ZDk2ZGFjZDE=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2020-06-04T19:16:30Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2020-06-04T19:24:43Z"}, "message": "Count the beta prerelease number just from master\n\nWe were computing a merge-base between the remote beta and master\nbranches, but this was giving incorrect answers for the first beta if\nthe remote hadn't been pushed yet. For instance, `1.45.0-beta.3359`\ncorresponds to the number of merges since the 1.44 beta, but we really\nwant just `.1` for the sole 1.45 beta promotion merge.\n\nWe don't really need to query the remote beta at all -- `master..HEAD`\nsuffices if we assume that we're on the intended beta branch already.", "tree": {"sha": "bdb6288290c5537b05225aceb95492696ec16625", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bdb6288290c5537b05225aceb95492696ec16625"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37a24b34c74790ee593aaead775ad5f4d96dacd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37a24b34c74790ee593aaead775ad5f4d96dacd1", "html_url": "https://github.com/rust-lang/rust/commit/37a24b34c74790ee593aaead775ad5f4d96dacd1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37a24b34c74790ee593aaead775ad5f4d96dacd1/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d5d0f898c2f3998e50c2180c6202f193c3acdbc", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d5d0f898c2f3998e50c2180c6202f193c3acdbc", "html_url": "https://github.com/rust-lang/rust/commit/3d5d0f898c2f3998e50c2180c6202f193c3acdbc"}], "stats": {"total": 22, "additions": 4, "deletions": 18}, "files": [{"sha": "8d8a036caef88c8c4586a8a0f0e9f7456b1646a5", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 4, "deletions": 18, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/37a24b34c74790ee593aaead775ad5f4d96dacd1/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37a24b34c74790ee593aaead775ad5f4d96dacd1/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=37a24b34c74790ee593aaead775ad5f4d96dacd1", "patch": "@@ -963,29 +963,15 @@ impl Build {\n             return s;\n         }\n \n-        let beta = output(\n-            Command::new(\"git\").arg(\"ls-remote\").arg(\"origin\").arg(\"beta\").current_dir(&self.src),\n-        );\n-        let beta = beta.trim().split_whitespace().next().unwrap();\n-        let master = output(\n-            Command::new(\"git\").arg(\"ls-remote\").arg(\"origin\").arg(\"master\").current_dir(&self.src),\n-        );\n-        let master = master.trim().split_whitespace().next().unwrap();\n-\n-        // Figure out where the current beta branch started.\n-        let base = output(\n-            Command::new(\"git\").arg(\"merge-base\").arg(beta).arg(master).current_dir(&self.src),\n-        );\n-        let base = base.trim();\n-\n-        // Next figure out how many merge commits happened since we branched off\n-        // beta. That's our beta number!\n+        // Figure out how many merge commits happened since we branched off master.\n+        // That's our beta number!\n+        // (Note that we use a `..` range, not the `...` symmetric difference.)\n         let count = output(\n             Command::new(\"git\")\n                 .arg(\"rev-list\")\n                 .arg(\"--count\")\n                 .arg(\"--merges\")\n-                .arg(format!(\"{}...HEAD\", base))\n+                .arg(\"refs/remotes/origin/master..HEAD\")\n                 .current_dir(&self.src),\n         );\n         let n = count.trim().parse().unwrap();"}]}