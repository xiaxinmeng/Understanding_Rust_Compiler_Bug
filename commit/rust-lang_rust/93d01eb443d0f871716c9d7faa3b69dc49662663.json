{"sha": "93d01eb443d0f871716c9d7faa3b69dc49662663", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzZDAxZWI0NDNkMGY4NzE3MTZjOWQ3ZmFhM2I2OWRjNDk2NjI2NjM=", "commit": {"author": {"name": "Nick Fitzgerald", "email": "fitzgen@gmail.com", "date": "2015-06-08T00:56:18Z"}, "committer": {"name": "Nick Fitzgerald", "email": "fitzgen@gmail.com", "date": "2015-06-08T01:01:33Z"}, "message": "Make the maximum edit distance of typo suggestions a function of the typo'd name's length.", "tree": {"sha": "aec856f46642ee7e3e3f1fff93c02c24eb36da8c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aec856f46642ee7e3e3f1fff93c02c24eb36da8c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93d01eb443d0f871716c9d7faa3b69dc49662663", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93d01eb443d0f871716c9d7faa3b69dc49662663", "html_url": "https://github.com/rust-lang/rust/commit/93d01eb443d0f871716c9d7faa3b69dc49662663", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93d01eb443d0f871716c9d7faa3b69dc49662663/comments", "author": {"login": "fitzgen", "id": 74571, "node_id": "MDQ6VXNlcjc0NTcx", "avatar_url": "https://avatars.githubusercontent.com/u/74571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fitzgen", "html_url": "https://github.com/fitzgen", "followers_url": "https://api.github.com/users/fitzgen/followers", "following_url": "https://api.github.com/users/fitzgen/following{/other_user}", "gists_url": "https://api.github.com/users/fitzgen/gists{/gist_id}", "starred_url": "https://api.github.com/users/fitzgen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fitzgen/subscriptions", "organizations_url": "https://api.github.com/users/fitzgen/orgs", "repos_url": "https://api.github.com/users/fitzgen/repos", "events_url": "https://api.github.com/users/fitzgen/events{/privacy}", "received_events_url": "https://api.github.com/users/fitzgen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fitzgen", "id": 74571, "node_id": "MDQ6VXNlcjc0NTcx", "avatar_url": "https://avatars.githubusercontent.com/u/74571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fitzgen", "html_url": "https://github.com/fitzgen", "followers_url": "https://api.github.com/users/fitzgen/followers", "following_url": "https://api.github.com/users/fitzgen/following{/other_user}", "gists_url": "https://api.github.com/users/fitzgen/gists{/gist_id}", "starred_url": "https://api.github.com/users/fitzgen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fitzgen/subscriptions", "organizations_url": "https://api.github.com/users/fitzgen/orgs", "repos_url": "https://api.github.com/users/fitzgen/repos", "events_url": "https://api.github.com/users/fitzgen/events{/privacy}", "received_events_url": "https://api.github.com/users/fitzgen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae74652b4a0e0e56a91d9a9dd71ab01e51131dc5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae74652b4a0e0e56a91d9a9dd71ab01e51131dc5", "html_url": "https://github.com/rust-lang/rust/commit/ae74652b4a0e0e56a91d9a9dd71ab01e51131dc5"}], "stats": {"total": 49, "additions": 35, "deletions": 14}, "files": [{"sha": "ba8680a35cb4be3d862d7bce5b495cedc3e6ac3e", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=93d01eb443d0f871716c9d7faa3b69dc49662663", "patch": "@@ -3206,14 +3206,11 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n         NoSuggestion\n     }\n \n-    fn find_best_match_for_name(&mut self, name: &str, max_distance: usize)\n-                                -> Option<String> {\n-        let this = &mut *self;\n-\n+    fn find_best_match_for_name(&mut self, name: &str) -> Option<String> {\n         let mut maybes: Vec<token::InternedString> = Vec::new();\n         let mut values: Vec<usize> = Vec::new();\n \n-        for rib in this.value_ribs.iter().rev() {\n+        for rib in self.value_ribs.iter().rev() {\n             for (&k, _) in &rib.bindings {\n                 maybes.push(token::get_name(k));\n                 values.push(usize::MAX);\n@@ -3229,9 +3226,12 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             }\n         }\n \n+        // As a loose rule to avoid obviously incorrect suggestions, clamp the\n+        // maximum edit distance we will accept for a suggestion to one third of\n+        // the typo'd name's length.\n+        let max_distance = std::cmp::max(name.len(), 3) / 3;\n+\n         if !values.is_empty() &&\n-            values[smallest] != usize::MAX &&\n-            values[smallest] < name.len() + 2 &&\n             values[smallest] <= max_distance &&\n             name != &maybes[smallest][..] {\n \n@@ -3357,7 +3357,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                                     NoSuggestion => {\n                                         // limit search to 5 to reduce the number\n                                         // of stupid suggestions\n-                                        self.find_best_match_for_name(&path_name, 5)\n+                                        self.find_best_match_for_name(&path_name)\n                                                             .map_or(\"\".to_string(),\n                                                                     |x| format!(\"`{}`\", x))\n                                     }"}, {"sha": "c35c9255ed28e8353928d9d1a92e348578166ec3", "filename": "src/test/compile-fail/bad-expr-path.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Fbad-expr-path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Fbad-expr-path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-expr-path.rs?ref=93d01eb443d0f871716c9d7faa3b69dc49662663", "patch": "@@ -8,8 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// error-pattern: unresolved name `m1::a`. Did you mean `args`?\n+// error-pattern: unresolved name `m1::arguments`. Did you mean `arguments`?\n \n mod m1 {}\n \n-fn main(args: Vec<String>) { log(debug, m1::a); }\n+fn main(arguments: Vec<String>) { log(debug, m1::arguments); }"}, {"sha": "af34887dec954fda455c740c5d55984cad3a586e", "filename": "src/test/compile-fail/bad-expr-path2.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Fbad-expr-path2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Fbad-expr-path2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-expr-path2.rs?ref=93d01eb443d0f871716c9d7faa3b69dc49662663", "patch": "@@ -8,12 +8,12 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// error-pattern: unresolved name `m1::a`. Did you mean `args`?\n+// error-pattern: unresolved name `m1::arguments`. Did you mean `arguments`?\n \n mod m1 {\n-    pub mod a {}\n+    pub mod arguments {}\n }\n \n-fn main(args: Vec<String>) {\n-    log(debug, m1::a);\n+fn main(arguments: Vec<String>) {\n+    log(debug, m1::arguments);\n }"}, {"sha": "d5cf6a294ee4d00e2618f7f90ced5d42d615d60a", "filename": "src/test/compile-fail/typo-suggestion.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Ftypo-suggestion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93d01eb443d0f871716c9d7faa3b69dc49662663/src%2Ftest%2Fcompile-fail%2Ftypo-suggestion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftypo-suggestion.rs?ref=93d01eb443d0f871716c9d7faa3b69dc49662663", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let foo = 1;\n+\n+    // `foo` shouldn't be suggested, it is too dissimilar from `bar`.\n+    println!(\"Hello {}\", bar);\n+    //~^ ERROR: unresolved name `bar`\n+\n+    // But this is close enough.\n+    println!(\"Hello {}\", fob);\n+    //~^ ERROR: unresolved name `fob`. Did you mean `foo`?\n+}"}]}