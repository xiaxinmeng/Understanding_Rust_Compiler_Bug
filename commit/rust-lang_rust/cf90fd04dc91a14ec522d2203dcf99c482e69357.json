{"sha": "cf90fd04dc91a14ec522d2203dcf99c482e69357", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmOTBmZDA0ZGM5MWExNGVjNTIyZDIyMDNkY2Y5OWM0ODJlNjkzNTc=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-24T08:44:44Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-08-24T11:24:40Z"}, "message": "Rollup merge of #53617 - joshtriplett:tidy-no-license-header, r=Mark-Simulacrum\n\ntidy: Stop requiring a license header\n\nPreviously approved in rust-lang/rust#43498 ; update tidy to match.", "tree": {"sha": "146ffae6a3e8c51bcb41ab1e69de2cd7c450ee38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/146ffae6a3e8c51bcb41ab1e69de2cd7c450ee38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf90fd04dc91a14ec522d2203dcf99c482e69357", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlt/6vgACgkQ/vbIBR0O\nATyuxw/6A4Haz6oHbPcRsl6ZOY2jpKZXhqS+/f7RE+D141ARgW0Sl9Nlbkk3jeHy\nbFOeNlAwQ7uMT9AqS9qzAwY6T2Ehlk5E+opOAbgYwKPNEcP0+CEFJJ4l3MpgNgHp\nrg739Pwd0dqehmiM1JU5LZ7yTQRcduJcEfBKD4MlpU6HLQTQMX4pfefXY3nGKMcU\nbny0Hnfe81MMrQYQv7PWAs2mSQXzCUzjZJ/0p/x/17T1yCpxQ3gq80DYSeFDdHQC\nWm+t7+O76rY9TPPvj+8Im/J1slg+vJWDXOGpardOaeTYHOrnTA5BZMiZ5yLqwqWt\nMPd76T5uNYhpTOJhIbt67cTNNykEjIyGMS3gpCTOoBGdDhFmM6wHqRs9x3EDv3XX\n31AUbeC1Bhwy8P6R27yzYzjHPs84bEj6eDZ5fxvzLXJZ++WWILbfFEUePti5c/dW\noZS/UZto2l1ahPvLocKxtEl0fFgRE4s0xXyqH6CGS35tEKWjIHP4+/ryp/K+HK/4\nTrJcZXR0vWxpqdm1FZ0dWM2I77qZHtsOVI6jsvDz1mASCQx0BS+FXBya3+kM2R2I\nSgXin6BVdn2oSsC7hLb1ICQNgA8jYbGeh5rvI+mO1N28KD7ssuj1IVlBF1p22Xmj\nRBVYU8bCz2au3DJzL8Q6t1WUNCsnEICDxf4nzZ80fmql++w06CM=\n=MGcn\n-----END PGP SIGNATURE-----", "payload": "tree 146ffae6a3e8c51bcb41ab1e69de2cd7c450ee38\nparent ff4500c389a31d2a93bfdf7e8dea1346e9ad105b\nparent a15b61780b24a2311a3e42a3437b3418921a3ed3\nauthor kennytm <kennytm@gmail.com> 1535100284 +0800\ncommitter kennytm <kennytm@gmail.com> 1535109880 +0800\n\nRollup merge of #53617 - joshtriplett:tidy-no-license-header, r=Mark-Simulacrum\n\ntidy: Stop requiring a license header\n\nPreviously approved in rust-lang/rust#43498 ; update tidy to match.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf90fd04dc91a14ec522d2203dcf99c482e69357", "html_url": "https://github.com/rust-lang/rust/commit/cf90fd04dc91a14ec522d2203dcf99c482e69357", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf90fd04dc91a14ec522d2203dcf99c482e69357/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff4500c389a31d2a93bfdf7e8dea1346e9ad105b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff4500c389a31d2a93bfdf7e8dea1346e9ad105b", "html_url": "https://github.com/rust-lang/rust/commit/ff4500c389a31d2a93bfdf7e8dea1346e9ad105b"}, {"sha": "a15b61780b24a2311a3e42a3437b3418921a3ed3", "url": "https://api.github.com/repos/rust-lang/rust/commits/a15b61780b24a2311a3e42a3437b3418921a3ed3", "html_url": "https://github.com/rust-lang/rust/commit/a15b61780b24a2311a3e42a3437b3418921a3ed3"}], "stats": {"total": 53, "additions": 0, "deletions": 53}, "files": [{"sha": "6b431ccda0883e9abc8d3a50bd12d86fc8857f4f", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 0, "deletions": 53, "changes": 53, "blob_url": "https://github.com/rust-lang/rust/blob/cf90fd04dc91a14ec522d2203dcf99c482e69357/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf90fd04dc91a14ec522d2203dcf99c482e69357/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=cf90fd04dc91a14ec522d2203dcf99c482e69357", "patch": "@@ -17,7 +17,6 @@\n //! * No trailing whitespace\n //! * No CR characters\n //! * No `TODO` or `XXX` directives\n-//! * A valid license header is at the top\n //! * No unexplained ` ```ignore ` or ` ```rust,ignore ` doc tests\n //!\n //! A number of these checks can be opted-out of with various directives like\n@@ -28,16 +27,6 @@ use std::io::prelude::*;\n use std::path::Path;\n \n const COLS: usize = 100;\n-const LICENSE: &'static str = \"\\\n-Copyright <year> The Rust Project Developers. See the COPYRIGHT\n-file at the top-level directory of this distribution and at\n-http://rust-lang.org/COPYRIGHT.\n-\n-Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-<LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-option. This file may not be copied, modified, or distributed\n-except according to those terms.\";\n \n const UNEXPLAINED_IGNORE_DOCTEST_INFO: &str = r#\"unexplained \"```ignore\" doctest; try one:\n \n@@ -168,52 +157,10 @@ pub fn check(path: &Path, bad: &mut bool) {\n                 trailing_new_lines = 0;\n             }\n         }\n-        if !licenseck(file, &contents) {\n-            tidy_error!(bad, \"{}: incorrect license\", file.display());\n-        }\n         match trailing_new_lines {\n             0 => tidy_error!(bad, \"{}: missing trailing newline\", file.display()),\n             1 | 2 => {}\n             n => tidy_error!(bad, \"{}: too many trailing newlines ({})\", file.display(), n),\n         };\n     })\n }\n-\n-fn licenseck(file: &Path, contents: &str) -> bool {\n-    if contents.contains(\"ignore-license\") {\n-        return true\n-    }\n-    let exceptions = [\n-        \"libstd/sync/mpsc/mpsc_queue.rs\",\n-        \"libstd/sync/mpsc/spsc_queue.rs\",\n-    ];\n-    if exceptions.iter().any(|f| file.ends_with(f)) {\n-        return true\n-    }\n-\n-    // Skip the BOM if it's there\n-    let bom = \"\\u{feff}\";\n-    let contents = if contents.starts_with(bom) {&contents[3..]} else {contents};\n-\n-    // See if the license shows up in the first 100 lines\n-    let lines = contents.lines().take(100).collect::<Vec<_>>();\n-    lines.windows(LICENSE.lines().count()).any(|window| {\n-        let offset = if window.iter().all(|w| w.starts_with(\"//\")) {\n-            2\n-        } else if window.iter().all(|w| w.starts_with('#')) {\n-            1\n-        } else if window.iter().all(|w| w.starts_with(\" *\")) {\n-            2\n-        } else {\n-            return false\n-        };\n-        window.iter().map(|a| a[offset..].trim())\n-              .zip(LICENSE.lines()).all(|(a, b)| {\n-            a == b || match b.find(\"<year>\") {\n-                Some(i) => a.starts_with(&b[..i]) && a.ends_with(&b[i+6..]),\n-                None => false,\n-            }\n-        })\n-    })\n-\n-}"}]}