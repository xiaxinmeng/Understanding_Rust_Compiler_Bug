{"sha": "6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiOGQyNWVjZGE0Y2JjNzI2NmJkMTQ5OTQ2NmRmYzU3MzdjOWZiZGY=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-10-09T10:45:29Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-10-09T10:45:29Z"}, "message": "Merge commit '2f6439ae6a6803d030cceb3ee14c9150e91b328b' into clippyup", "tree": {"sha": "0f353c1f10fb8561c21df5aacc8cf4ee49ba5fa8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f353c1f10fb8561c21df5aacc8cf4ee49ba5fa8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqv54U47RUUXZfOLnLO/Nsn7QvnkFAl+AP08ACgkQLO/Nsn7Q\nvnkHYhAAgSsa0FJXmg2XuUjMbw+SmFn2w7Ub4C/7XLwCtARnE6vY9qbYiSCMAGmN\nibvrKEaunNpIj4Spfn1ArhFEk/spaImSUk51XlBY8B4fEF77WcrIhs5byMu00kv8\nHVhH1AfzVp2lVvUDjlmFzVpsMlqdH50/GM7akjYrdqgZqI0XyLR/UgICeYN0+QHM\nZN2+u/uGNd2yMiBbElwGAcOYehGFBYfFi9ffdlsTnLk8J7TD2UbZk3tN98fWhy4W\nqQ4OZWm34BaMIEFj/PnkLHSiF6P3oglGX5G07MJcNcRxRzgRKdNTkAgYno9/29B6\ndmBh+2l10xfsKOyPJddv1eIekIJIOtbxBk16RYpuwcZY43uiDu572pQ2zw+HAgRj\nW/qmaKUv0PWSgKRubqlYlVuNxqfPgk+PsqK3NaeP13U3I1QVPXN/LgxHEQbK94UD\nQ3g8hmM6Q+aQLNlgjkaUXIGVs3eAyr38O+oer4alJkic0KUl+KGdvvfnt83uUP3U\nQcGMghFIAp0erOQRm5cWVi7FJ3aUGt0g7qPuMWM5zPVmM71pcvMP2dQjZ70xiATT\nQxyZgrrWcrui/U2RTBJn3qwSvZTvpHoJZviLEYa4aAzfbtv3U9jo/fqkoV7hsrx+\nSv7gbrKPgZlEQYQBkQ/jgB4yx/Xvar1NL8Lf6yZUdmnaVrw773o=\n=fQki\n-----END PGP SIGNATURE-----", "payload": "tree 0f353c1f10fb8561c21df5aacc8cf4ee49ba5fa8\nparent 9a74fb726ec40be398c55bce66c6d0b1a91d106c\nparent 2f6439ae6a6803d030cceb3ee14c9150e91b328b\nauthor flip1995 <hello@philkrones.com> 1602240329 +0200\ncommitter flip1995 <hello@philkrones.com> 1602240329 +0200\n\nMerge commit '2f6439ae6a6803d030cceb3ee14c9150e91b328b' into clippyup\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "html_url": "https://github.com/rust-lang/rust/commit/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9a74fb726ec40be398c55bce66c6d0b1a91d106c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9a74fb726ec40be398c55bce66c6d0b1a91d106c", "html_url": "https://github.com/rust-lang/rust/commit/9a74fb726ec40be398c55bce66c6d0b1a91d106c"}, {"sha": "2f6439ae6a6803d030cceb3ee14c9150e91b328b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f6439ae6a6803d030cceb3ee14c9150e91b328b", "html_url": "https://github.com/rust-lang/rust/commit/2f6439ae6a6803d030cceb3ee14c9150e91b328b"}], "stats": {"total": 2118, "additions": 1502, "deletions": 616}, "files": [{"sha": "0bd13320dc952179435b89b971a0c24fae987940", "filename": "src/tools/clippy/CHANGELOG.md", "status": "modified", "additions": 125, "deletions": 4, "changes": 129, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2FCHANGELOG.md?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -6,11 +6,129 @@ document.\n \n ## Unreleased / In Rust Nightly\n \n-[09bd400...master](https://github.com/rust-lang/rust-clippy/compare/09bd400...master)\n+[e636b88...master](https://github.com/rust-lang/rust-clippy/compare/e636b88...master)\n+\n+## Rust 1.48\n+\n+Current beta, release 2020-11-19\n+\n+[09bd400...e636b88](https://github.com/rust-lang/rust-clippy/compare/09bd400...e636b88)\n+\n+### New lints\n+\n+* [`self_assignment`] [#5894](https://github.com/rust-lang/rust-clippy/pull/5894)\n+* [`unnecessary_lazy_evaluations`] [#5720](https://github.com/rust-lang/rust-clippy/pull/5720)\n+* [`manual_strip`] [#6038](https://github.com/rust-lang/rust-clippy/pull/6038)\n+* [`map_err_ignore`] [#5998](https://github.com/rust-lang/rust-clippy/pull/5998)\n+* [`rc_buffer`] [#6044](https://github.com/rust-lang/rust-clippy/pull/6044)\n+* [`to_string_in_display`] [#5831](https://github.com/rust-lang/rust-clippy/pull/5831)\n+* [`single_char_push_str`] [#5881](https://github.com/rust-lang/rust-clippy/pull/5881)\n+\n+### Moves and Deprecations\n+\n+* Downgrade [`verbose_bit_mask`] to pedantic\n+  [#6036](https://github.com/rust-lang/rust-clippy/pull/6036)\n+\n+### Enhancements\n+\n+* Extend [`precedence`] to handle chains of methods combined with unary negation\n+  [#5928](https://github.com/rust-lang/rust-clippy/pull/5928)\n+* [`useless_vec`]: add a configuration value for the maximum allowed size on the stack\n+  [#5907](https://github.com/rust-lang/rust-clippy/pull/5907)\n+* [`suspicious_arithmetic_impl`]: extend to implementations of `BitAnd`, `BitOr`, `BitXor`, `Rem`, `Shl`, and `Shr`\n+  [#5884](https://github.com/rust-lang/rust-clippy/pull/5884)\n+* [`invalid_atomic_ordering`]: detect misuse of `compare_exchange`, `compare_exchange_weak`, and `fetch_update`\n+  [#6025](https://github.com/rust-lang/rust-clippy/pull/6025)\n+* Avoid [`redundant_pattern_matching`] triggering in macros\n+  [#6069](https://github.com/rust-lang/rust-clippy/pull/6069)\n+* [`option_if_let_else`]: distinguish pure from impure `else` expressions\n+  [#5937](https://github.com/rust-lang/rust-clippy/pull/5937)\n+* [`needless_doctest_main`]: parse doctests instead of using textual search\n+  [#5912](https://github.com/rust-lang/rust-clippy/pull/5912)\n+* [`wildcard_imports`]: allow `prelude` to appear in any segment of an import\n+  [#5929](https://github.com/rust-lang/rust-clippy/pull/5929)\n+* Re-enable [`len_zero`] for ranges now that `range_is_empty` is stable\n+  [#5961](https://github.com/rust-lang/rust-clippy/pull/5961)\n+* [`option_as_ref_deref`]: catch fully-qualified calls to `Deref::deref` and `DerefMut::deref_mut`\n+  [#5933](https://github.com/rust-lang/rust-clippy/pull/5933)\n+\n+### False Positive Fixes\n+\n+* [`useless_attribute`]: permit allowing [`wildcard_imports`] and [`enum_glob_use`]\n+  [#5994](https://github.com/rust-lang/rust-clippy/pull/5994)\n+* [`transmute_ptr_to_ptr`]: avoid suggesting dereferencing raw pointers in const contexts \n+  [#5999](https://github.com/rust-lang/rust-clippy/pull/5999)\n+* [`redundant_closure_call`]: take into account usages of the closure in nested functions and closures\n+  [#5920](https://github.com/rust-lang/rust-clippy/pull/5920)\n+* Fix false positive in [`borrow_interior_mutable_const`] when referencing a field behind a pointer\n+  [#5949](https://github.com/rust-lang/rust-clippy/pull/5949)\n+* [`doc_markdown`]: allow using \"GraphQL\" without backticks\n+  [#5996](https://github.com/rust-lang/rust-clippy/pull/5996)\n+* [`to_string_in_display`]: avoid linting when calling `to_string()` on anything that is not `self` \n+  [#5971](https://github.com/rust-lang/rust-clippy/pull/5971)\n+* [`indexing_slicing`] and [`out_of_bounds_indexing`] treat references to arrays as arrays\n+  [#6034](https://github.com/rust-lang/rust-clippy/pull/6034)\n+* [`should_implement_trait`]: ignore methods with lifetime parameters\n+  [#5725](https://github.com/rust-lang/rust-clippy/pull/5725)\n+* [`needless_return`]: avoid linting if a temporary borrows a local variable\n+  [#5903](https://github.com/rust-lang/rust-clippy/pull/5903)\n+* Restrict [`unnecessary_sort_by`] to non-reference, Copy types\n+  [#6006](https://github.com/rust-lang/rust-clippy/pull/6006)\n+* Avoid suggesting `from_bits`/`to_bits` in const contexts in [`transmute_int_to_float`]\n+  [#5919](https://github.com/rust-lang/rust-clippy/pull/5919)\n+* [`declare_interior_mutable_const`] and [`borrow_interior_mutable_const`]: improve detection of interior mutable types\n+  [#6046](https://github.com/rust-lang/rust-clippy/pull/6046)\n+\n+### Suggestion Fixes/Improvements\n+\n+* [`let_and_return`]: add a cast to the suggestion when the return expression has adjustments\n+  [#5946](https://github.com/rust-lang/rust-clippy/pull/5946)\n+* [`useless_conversion`]: show the type in the error message\n+  [#6035](https://github.com/rust-lang/rust-clippy/pull/6035)\n+* [`unnecessary_mut_passed`]: discriminate between functions and methods in the error message \n+  [#5892](https://github.com/rust-lang/rust-clippy/pull/5892)\n+* [`float_cmp`] and [`float_cmp_const`]: change wording to make margin of error less ambiguous\n+  [#6043](https://github.com/rust-lang/rust-clippy/pull/6043)\n+* [`default_trait_access`]: do not use unnecessary type parameters in the suggestion\n+  [#5993](https://github.com/rust-lang/rust-clippy/pull/5993)\n+* [`collapsible_if`]: don't use expanded code in the suggestion \n+  [#5992](https://github.com/rust-lang/rust-clippy/pull/5992)\n+* Do not suggest empty format strings in [`print_with_newline`] and [`write_with_newline`]\n+  [#6042](https://github.com/rust-lang/rust-clippy/pull/6042)\n+* [`unit_arg`]: improve the readability of the suggestion\n+  [#5931](https://github.com/rust-lang/rust-clippy/pull/5931)\n+* [`stable_sort_primitive`]: print the type that is being sorted in the lint message \n+  [#5935](https://github.com/rust-lang/rust-clippy/pull/5935)\n+* Show line count and max lines in [`too_many_lines`] lint message\n+  [#6009](https://github.com/rust-lang/rust-clippy/pull/6009)\n+* Keep parentheses in the suggestion of [`useless_conversion`] where applicable\n+  [#5900](https://github.com/rust-lang/rust-clippy/pull/5900)\n+* [`option_map_unit_fn`] and [`result_map_unit_fn`]: print the unit type `()` explicitly\n+  [#6024](https://github.com/rust-lang/rust-clippy/pull/6024)\n+* [`redundant_allocation`]: suggest replacing `Rc<Box<T>>` with `Rc<T>` \n+  [#5899](https://github.com/rust-lang/rust-clippy/pull/5899)\n+* Make lint messages adhere to rustc dev guide conventions\n+  [#5893](https://github.com/rust-lang/rust-clippy/pull/5893)\n+\n+### ICE Fixes\n+\n+* Fix ICE in [`repeat_once`]\n+  [#5948](https://github.com/rust-lang/rust-clippy/pull/5948)\n+\n+### Documentation Improvements\n+\n+* [`mutable_key_type`]: explain potential for false positives when the interior mutable type is not accessed in the `Hash` implementation\n+  [#6019](https://github.com/rust-lang/rust-clippy/pull/6019)\n+* [`unnecessary_mut_passed`]: fix typo\n+  [#5913](https://github.com/rust-lang/rust-clippy/pull/5913)\n+* Add example of false positive to [`ptr_arg`] docs.\n+  [#5885](https://github.com/rust-lang/rust-clippy/pull/5885)\n+* [`box_vec`], [`vec_box`] and [`borrowed_box`]: add link to the documentation of `Box`\n+  [#6023](https://github.com/rust-lang/rust-clippy/pull/6023)\n \n ## Rust 1.47\n \n-Current beta, release 2020-10-08\n+Current stable, released 2020-10-08\n \n [c2c07fa...09bd400](https://github.com/rust-lang/rust-clippy/compare/c2c07fa...09bd400)\n \n@@ -112,7 +230,7 @@ Current beta, release 2020-10-08\n \n ## Rust 1.46\n \n-Current stable, released 2020-08-27\n+Released 2020-08-27\n \n [7ea7cd1...c2c07fa](https://github.com/rust-lang/rust-clippy/compare/7ea7cd1...c2c07fa)\n \n@@ -1559,6 +1677,7 @@ Released 2018-09-13\n [`deref_addrof`]: https://rust-lang.github.io/rust-clippy/master/index.html#deref_addrof\n [`derive_hash_xor_eq`]: https://rust-lang.github.io/rust-clippy/master/index.html#derive_hash_xor_eq\n [`derive_ord_xor_partial_ord`]: https://rust-lang.github.io/rust-clippy/master/index.html#derive_ord_xor_partial_ord\n+[`disallowed_method`]: https://rust-lang.github.io/rust-clippy/master/index.html#disallowed_method\n [`diverging_sub_expression`]: https://rust-lang.github.io/rust-clippy/master/index.html#diverging_sub_expression\n [`doc_markdown`]: https://rust-lang.github.io/rust-clippy/master/index.html#doc_markdown\n [`double_comparisons`]: https://rust-lang.github.io/rust-clippy/master/index.html#double_comparisons\n@@ -1634,6 +1753,8 @@ Released 2018-09-13\n [`inherent_to_string`]: https://rust-lang.github.io/rust-clippy/master/index.html#inherent_to_string\n [`inherent_to_string_shadow_display`]: https://rust-lang.github.io/rust-clippy/master/index.html#inherent_to_string_shadow_display\n [`inline_always`]: https://rust-lang.github.io/rust-clippy/master/index.html#inline_always\n+[`inline_asm_x86_att_syntax`]: https://rust-lang.github.io/rust-clippy/master/index.html#inline_asm_x86_att_syntax\n+[`inline_asm_x86_intel_syntax`]: https://rust-lang.github.io/rust-clippy/master/index.html#inline_asm_x86_intel_syntax\n [`inline_fn_without_body`]: https://rust-lang.github.io/rust-clippy/master/index.html#inline_fn_without_body\n [`int_plus_one`]: https://rust-lang.github.io/rust-clippy/master/index.html#int_plus_one\n [`integer_arithmetic`]: https://rust-lang.github.io/rust-clippy/master/index.html#integer_arithmetic\n@@ -1644,6 +1765,7 @@ Released 2018-09-13\n [`invalid_ref`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_ref\n [`invalid_regex`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_regex\n [`invalid_upcast_comparisons`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_upcast_comparisons\n+[`invisible_characters`]: https://rust-lang.github.io/rust-clippy/master/index.html#invisible_characters\n [`items_after_statements`]: https://rust-lang.github.io/rust-clippy/master/index.html#items_after_statements\n [`iter_cloned_collect`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_cloned_collect\n [`iter_next_loop`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_next_loop\n@@ -1919,6 +2041,5 @@ Released 2018-09-13\n [`zero_divided_by_zero`]: https://rust-lang.github.io/rust-clippy/master/index.html#zero_divided_by_zero\n [`zero_prefixed_literal`]: https://rust-lang.github.io/rust-clippy/master/index.html#zero_prefixed_literal\n [`zero_ptr`]: https://rust-lang.github.io/rust-clippy/master/index.html#zero_ptr\n-[`zero_width_space`]: https://rust-lang.github.io/rust-clippy/master/index.html#zero_width_space\n [`zst_offset`]: https://rust-lang.github.io/rust-clippy/master/index.html#zst_offset\n <!-- end autogenerated links to lint list -->"}, {"sha": "62a8be0abf22c5a08743aa5e4092eaf612927bf6", "filename": "src/tools/clippy/README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2FREADME.md?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -5,7 +5,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are over 350 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are over 400 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "b8a4a20114bb8b7f58f4c814afa434f49b9978be", "filename": "src/tools/clippy/clippy_dev/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_dev%2FCargo.toml?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -8,8 +8,8 @@ edition = \"2018\"\n bytecount = \"0.6\"\n clap = \"2.33\"\n itertools = \"0.9\"\n+opener = \"0.4\"\n regex = \"1\"\n-lazy_static = \"1.0\"\n shell-escape = \"0.1\"\n walkdir = \"2\"\n "}, {"sha": "43cb2954b74b34f9705631b3d803b2e5bbb1023e", "filename": "src/tools/clippy/clippy_dev/src/lib.rs", "status": "modified", "additions": 24, "deletions": 19, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Flib.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,42 +1,47 @@\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]\n+#![feature(once_cell)]\n \n use itertools::Itertools;\n-use lazy_static::lazy_static;\n use regex::Regex;\n use std::collections::HashMap;\n use std::ffi::OsStr;\n use std::fs;\n+use std::lazy::SyncLazy;\n use std::path::{Path, PathBuf};\n use walkdir::WalkDir;\n \n pub mod fmt;\n pub mod new_lint;\n pub mod ra_setup;\n+pub mod serve;\n pub mod stderr_length_check;\n pub mod update_lints;\n \n-lazy_static! {\n-    static ref DEC_CLIPPY_LINT_RE: Regex = Regex::new(\n+static DEC_CLIPPY_LINT_RE: SyncLazy<Regex> = SyncLazy::new(|| {\n+    Regex::new(\n         r#\"(?x)\n-        declare_clippy_lint!\\s*[\\{(]\n-        (?:\\s+///.*)*\n-        \\s+pub\\s+(?P<name>[A-Z_][A-Z_0-9]*)\\s*,\\s*\n-        (?P<cat>[a-z_]+)\\s*,\\s*\n-        \"(?P<desc>(?:[^\"\\\\]+|\\\\(?s).(?-s))*)\"\\s*[})]\n-    \"#\n+    declare_clippy_lint!\\s*[\\{(]\n+    (?:\\s+///.*)*\n+    \\s+pub\\s+(?P<name>[A-Z_][A-Z_0-9]*)\\s*,\\s*\n+    (?P<cat>[a-z_]+)\\s*,\\s*\n+    \"(?P<desc>(?:[^\"\\\\]+|\\\\(?s).(?-s))*)\"\\s*[})]\n+\"#,\n     )\n-    .unwrap();\n-    static ref DEC_DEPRECATED_LINT_RE: Regex = Regex::new(\n+    .unwrap()\n+});\n+\n+static DEC_DEPRECATED_LINT_RE: SyncLazy<Regex> = SyncLazy::new(|| {\n+    Regex::new(\n         r#\"(?x)\n-        declare_deprecated_lint!\\s*[{(]\\s*\n-        (?:\\s+///.*)*\n-        \\s+pub\\s+(?P<name>[A-Z_][A-Z_0-9]*)\\s*,\\s*\n-        \"(?P<desc>(?:[^\"\\\\]+|\\\\(?s).(?-s))*)\"\\s*[})]\n-    \"#\n+    declare_deprecated_lint!\\s*[{(]\\s*\n+    (?:\\s+///.*)*\n+    \\s+pub\\s+(?P<name>[A-Z_][A-Z_0-9]*)\\s*,\\s*\n+    \"(?P<desc>(?:[^\"\\\\]+|\\\\(?s).(?-s))*)\"\\s*[})]\n+\"#,\n     )\n-    .unwrap();\n-    static ref NL_ESCAPE_RE: Regex = Regex::new(r#\"\\\\\\n\\s*\"#).unwrap();\n-}\n+    .unwrap()\n+});\n+static NL_ESCAPE_RE: SyncLazy<Regex> = SyncLazy::new(|| Regex::new(r#\"\\\\\\n\\s*\"#).unwrap());\n \n pub static DOCS_LINK: &str = \"https://rust-lang.github.io/rust-clippy/master/index.html\";\n "}, {"sha": "7a8cbd5251da9012f2dc4d2c82f5182ca06882cb", "filename": "src/tools/clippy/clippy_dev/src/main.rs", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fmain.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,7 +1,7 @@\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]\n \n use clap::{App, Arg, SubCommand};\n-use clippy_dev::{fmt, new_lint, ra_setup, stderr_length_check, update_lints};\n+use clippy_dev::{fmt, new_lint, ra_setup, serve, stderr_length_check, update_lints};\n \n fn main() {\n     let matches = App::new(\"Clippy developer tooling\")\n@@ -100,6 +100,19 @@ fn main() {\n                         .required(true),\n                 ),\n         )\n+        .subcommand(\n+            SubCommand::with_name(\"serve\")\n+                .about(\"Launch a local 'ALL the Clippy Lints' website in a browser\")\n+                .arg(\n+                    Arg::with_name(\"port\")\n+                        .long(\"port\")\n+                        .short(\"p\")\n+                        .help(\"Local port for the http server\")\n+                        .default_value(\"8000\")\n+                        .validator_os(serve::validate_port),\n+                )\n+                .arg(Arg::with_name(\"lint\").help(\"Which lint's page to load initially (optional)\")),\n+        )\n         .get_matches();\n \n     match matches.subcommand() {\n@@ -129,6 +142,11 @@ fn main() {\n             stderr_length_check::check();\n         },\n         (\"ra-setup\", Some(matches)) => ra_setup::run(matches.value_of(\"rustc-repo-path\")),\n+        (\"serve\", Some(matches)) => {\n+            let port = matches.value_of(\"port\").unwrap().parse().unwrap();\n+            let lint = matches.value_of(\"lint\");\n+            serve::run(port, lint);\n+        },\n         _ => {},\n     }\n }"}, {"sha": "a46c0e4d3f0a1525eb39ee56bee441eec6e710fd", "filename": "src/tools/clippy/clippy_dev/src/serve.rs", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fserve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fserve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_dev%2Fsrc%2Fserve.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,64 @@\n+use std::ffi::{OsStr, OsString};\n+use std::path::Path;\n+use std::process::Command;\n+use std::thread;\n+use std::time::{Duration, SystemTime};\n+\n+pub fn run(port: u16, lint: Option<&str>) -> ! {\n+    let mut url = Some(match lint {\n+        None => format!(\"http://localhost:{}\", port),\n+        Some(lint) => format!(\"http://localhost:{}/#{}\", port, lint),\n+    });\n+\n+    loop {\n+        if mtime(\"util/gh-pages/lints.json\") < mtime(\"clippy_lints/src\") {\n+            Command::new(\"python3\")\n+                .arg(\"util/export.py\")\n+                .spawn()\n+                .unwrap()\n+                .wait()\n+                .unwrap();\n+        }\n+        if let Some(url) = url.take() {\n+            thread::spawn(move || {\n+                Command::new(\"python3\")\n+                    .arg(\"-m\")\n+                    .arg(\"http.server\")\n+                    .arg(port.to_string())\n+                    .current_dir(\"util/gh-pages\")\n+                    .spawn()\n+                    .unwrap();\n+                // Give some time for python to start\n+                thread::sleep(Duration::from_millis(500));\n+                // Launch browser after first export.py has completed and http.server is up\n+                let _ = opener::open(url);\n+            });\n+        }\n+        thread::sleep(Duration::from_millis(1000));\n+    }\n+}\n+\n+fn mtime(path: impl AsRef<Path>) -> SystemTime {\n+    let path = path.as_ref();\n+    if path.is_dir() {\n+        path.read_dir()\n+            .into_iter()\n+            .flatten()\n+            .flatten()\n+            .map(|entry| mtime(&entry.path()))\n+            .max()\n+            .unwrap_or(SystemTime::UNIX_EPOCH)\n+    } else {\n+        path.metadata()\n+            .and_then(|metadata| metadata.modified())\n+            .unwrap_or(SystemTime::UNIX_EPOCH)\n+    }\n+}\n+\n+#[allow(clippy::missing_errors_doc)]\n+pub fn validate_port(arg: &OsStr) -> Result<(), OsString> {\n+    match arg.to_string_lossy().parse::<u16>() {\n+        Ok(_port) => Ok(()),\n+        Err(err) => Err(OsString::from(err.to_string())),\n+    }\n+}"}, {"sha": "fcf817b82c89ef95f9785d75ba9e8015d467e67a", "filename": "src/tools/clippy/clippy_lints/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2FCargo.toml?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -20,7 +20,6 @@ edition = \"2018\"\n cargo_metadata = \"0.11.1\"\n if_chain = \"1.0.0\"\n itertools = \"0.9\"\n-lazy_static = \"1.0.2\"\n pulldown-cmark = { version = \"0.8\", default-features = false }\n quine-mc_cluskey = \"0.2.2\"\n regex-syntax = \"0.6\""}, {"sha": "ef1f1a14afcace4c1c21eb7e1e3e373b02194522", "filename": "src/tools/clippy/clippy_lints/src/asm_syntax.rs", "status": "added", "additions": 125, "deletions": 0, "changes": 125, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fasm_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fasm_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fasm_syntax.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,125 @@\n+use std::fmt;\n+\n+use crate::utils::span_lint_and_help;\n+use rustc_ast::ast::{Expr, ExprKind, InlineAsmOptions};\n+use rustc_lint::{EarlyContext, EarlyLintPass, Lint};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+\n+#[derive(Clone, Copy, PartialEq, Eq)]\n+enum AsmStyle {\n+    Intel,\n+    Att,\n+}\n+\n+impl fmt::Display for AsmStyle {\n+    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n+        match self {\n+            AsmStyle::Intel => f.write_str(\"Intel\"),\n+            AsmStyle::Att => f.write_str(\"AT&T\"),\n+        }\n+    }\n+}\n+\n+impl std::ops::Not for AsmStyle {\n+    type Output = AsmStyle;\n+\n+    fn not(self) -> AsmStyle {\n+        match self {\n+            AsmStyle::Intel => AsmStyle::Att,\n+            AsmStyle::Att => AsmStyle::Intel,\n+        }\n+    }\n+}\n+\n+fn check_expr_asm_syntax(lint: &'static Lint, cx: &EarlyContext<'_>, expr: &Expr, check_for: AsmStyle) {\n+    if let ExprKind::InlineAsm(ref inline_asm) = expr.kind {\n+        let style = if inline_asm.options.contains(InlineAsmOptions::ATT_SYNTAX) {\n+            AsmStyle::Att\n+        } else {\n+            AsmStyle::Intel\n+        };\n+\n+        if style == check_for {\n+            span_lint_and_help(\n+                cx,\n+                lint,\n+                expr.span,\n+                &format!(\"{} x86 assembly syntax used\", style),\n+                None,\n+                &format!(\"use {} x86 assembly syntax\", !style),\n+            );\n+        }\n+    }\n+}\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checks for usage of Intel x86 assembly syntax.\n+    ///\n+    /// **Why is this bad?** The lint has been enabled to indicate a preference\n+    /// for AT&T x86 assembly syntax.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    ///\n+    /// ```rust,no_run\n+    /// # #![feature(asm)]\n+    /// # unsafe { let ptr = \"\".as_ptr();\n+    /// asm!(\"lea {}, [{}]\", lateout(reg) _, in(reg) ptr);\n+    /// # }\n+    /// ```\n+    /// Use instead:\n+    /// ```rust,no_run\n+    /// # #![feature(asm)]\n+    /// # unsafe { let ptr = \"\".as_ptr();\n+    /// asm!(\"lea ({}), {}\", in(reg) ptr, lateout(reg) _, options(att_syntax));\n+    /// # }\n+    /// ```\n+    pub INLINE_ASM_X86_INTEL_SYNTAX,\n+    restriction,\n+    \"prefer AT&T x86 assembly syntax\"\n+}\n+\n+declare_lint_pass!(InlineAsmX86IntelSyntax => [INLINE_ASM_X86_INTEL_SYNTAX]);\n+\n+impl EarlyLintPass for InlineAsmX86IntelSyntax {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n+        check_expr_asm_syntax(Self::get_lints()[0], cx, expr, AsmStyle::Intel);\n+    }\n+}\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checks for usage of AT&T x86 assembly syntax.\n+    ///\n+    /// **Why is this bad?** The lint has been enabled to indicate a preference\n+    /// for Intel x86 assembly syntax.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    ///\n+    /// ```rust,no_run\n+    /// # #![feature(asm)]\n+    /// # unsafe { let ptr = \"\".as_ptr();\n+    /// asm!(\"lea ({}), {}\", in(reg) ptr, lateout(reg) _, options(att_syntax));\n+    /// # }\n+    /// ```\n+    /// Use instead:\n+    /// ```rust,no_run\n+    /// # #![feature(asm)]\n+    /// # unsafe { let ptr = \"\".as_ptr();\n+    /// asm!(\"lea {}, [{}]\", lateout(reg) _, in(reg) ptr);\n+    /// # }\n+    /// ```\n+    pub INLINE_ASM_X86_ATT_SYNTAX,\n+    restriction,\n+    \"prefer Intel x86 assembly syntax\"\n+}\n+\n+declare_lint_pass!(InlineAsmX86AttSyntax => [INLINE_ASM_X86_ATT_SYNTAX]);\n+\n+impl EarlyLintPass for InlineAsmX86AttSyntax {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n+        check_expr_asm_syntax(Self::get_lints()[0], cx, expr, AsmStyle::Att);\n+    }\n+}"}, {"sha": "f6eadbdef0bb0eeb69133d16491a3f413733e21e", "filename": "src/tools/clippy/clippy_lints/src/attrs.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fattrs.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -137,17 +137,17 @@ declare_clippy_lint! {\n     /// **Example:**\n     /// ```rust\n     /// // Good (as inner attribute)\n-    /// #![inline(always)]\n+    /// #![allow(dead_code)]\n     ///\n     /// fn this_is_fine() { }\n     ///\n     /// // Bad\n-    /// #[inline(always)]\n+    /// #[allow(dead_code)]\n     ///\n     /// fn not_quite_good_code() { }\n     ///\n     /// // Good (as outer attribute)\n-    /// #[inline(always)]\n+    /// #[allow(dead_code)]\n     /// fn this_is_fine_too() { }\n     /// ```\n     pub EMPTY_LINE_AFTER_OUTER_ATTR,"}, {"sha": "581c3242e3745c81ee8202db7a28bf7601d5f9ac", "filename": "src/tools/clippy/clippy_lints/src/disallowed_method.rs", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fdisallowed_method.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,73 @@\n+use crate::utils::span_lint;\n+\n+use rustc_data_structures::fx::FxHashSet;\n+use rustc_hir::{Expr, ExprKind};\n+use rustc_lint::{LateContext, LateLintPass};\n+use rustc_session::{declare_tool_lint, impl_lint_pass};\n+use rustc_span::Symbol;\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Lints for specific trait methods defined in clippy.toml\n+    ///\n+    /// **Why is this bad?** Some methods are undesirable in certain contexts,\n+    /// and it would be beneficial to lint for them as needed.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    ///\n+    /// ```rust,ignore\n+    /// // example code where clippy issues a warning\n+    /// foo.bad_method(); // Foo::bad_method is disallowed in the configuration\n+    /// ```\n+    /// Use instead:\n+    /// ```rust,ignore\n+    /// // example code which does not raise clippy warning\n+    /// goodStruct.bad_method(); // GoodStruct::bad_method is not disallowed\n+    /// ```\n+    pub DISALLOWED_METHOD,\n+    nursery,\n+    \"use of a disallowed method call\"\n+}\n+\n+#[derive(Clone, Debug)]\n+pub struct DisallowedMethod {\n+    disallowed: FxHashSet<Vec<Symbol>>,\n+}\n+\n+impl DisallowedMethod {\n+    pub fn new(disallowed: &FxHashSet<String>) -> Self {\n+        Self {\n+            disallowed: disallowed\n+                .iter()\n+                .map(|s| s.split(\"::\").map(|seg| Symbol::intern(seg)).collect::<Vec<_>>())\n+                .collect(),\n+        }\n+    }\n+}\n+\n+impl_lint_pass!(DisallowedMethod => [DISALLOWED_METHOD]);\n+\n+impl<'tcx> LateLintPass<'tcx> for DisallowedMethod {\n+    fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n+        if let ExprKind::MethodCall(_path, _, _args, _) = &expr.kind {\n+            let def_id = cx.typeck_results().type_dependent_def_id(expr.hir_id).unwrap();\n+\n+            let method_call = cx.get_def_path(def_id);\n+            if self.disallowed.contains(&method_call) {\n+                let method = method_call\n+                    .iter()\n+                    .map(|s| s.to_ident_string())\n+                    .collect::<Vec<_>>()\n+                    .join(\"::\");\n+\n+                span_lint(\n+                    cx,\n+                    DISALLOWED_METHOD,\n+                    expr.span,\n+                    &format!(\"use of a disallowed method `{}`\", method),\n+                );\n+            }\n+        }\n+    }\n+}"}, {"sha": "8b0229125738a80f16c6cef615a80d18b16c114e", "filename": "src/tools/clippy/clippy_lints/src/escape.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fescape.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -6,6 +6,7 @@ use rustc_middle::ty::{self, Ty};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n use rustc_span::source_map::Span;\n use rustc_target::abi::LayoutOf;\n+use rustc_target::spec::abi::Abi;\n use rustc_typeck::expr_use_visitor::{ConsumeMode, Delegate, ExprUseVisitor, PlaceBase, PlaceWithHirId};\n \n use crate::utils::span_lint;\n@@ -60,12 +61,18 @@ impl<'tcx> LateLintPass<'tcx> for BoxedLocal {\n     fn check_fn(\n         &mut self,\n         cx: &LateContext<'tcx>,\n-        _: intravisit::FnKind<'tcx>,\n+        fn_kind: intravisit::FnKind<'tcx>,\n         _: &'tcx FnDecl<'_>,\n         body: &'tcx Body<'_>,\n         _: Span,\n         hir_id: HirId,\n     ) {\n+        if let Some(header) = fn_kind.header() {\n+            if header.abi != Abi::Rust {\n+                return;\n+            }\n+        }\n+\n         // If the method is an impl for a trait, don't warn.\n         let parent_id = cx.tcx.hir().get_parent_item(hir_id);\n         let parent_node = cx.tcx.hir().find(parent_id);"}, {"sha": "93b5d9e178c2342fc4f02bedee3ce1c10b805102", "filename": "src/tools/clippy/clippy_lints/src/lib.rs", "status": "modified", "additions": 22, "deletions": 9, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flib.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -7,6 +7,7 @@\n #![feature(crate_visibility_modifier)]\n #![feature(drain_filter)]\n #![feature(in_band_lifetimes)]\n+#![feature(once_cell)]\n #![feature(or_patterns)]\n #![feature(rustc_private)]\n #![feature(stmt_expr_attributes)]\n@@ -153,6 +154,7 @@ mod utils;\n mod approx_const;\n mod arithmetic;\n mod as_conversions;\n+mod asm_syntax;\n mod assertions_on_constants;\n mod assign_ops;\n mod async_yields_async;\n@@ -176,6 +178,7 @@ mod dbg_macro;\n mod default_trait_access;\n mod dereference;\n mod derive;\n+mod disallowed_method;\n mod doc;\n mod double_comparison;\n mod double_parens;\n@@ -489,6 +492,8 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &arithmetic::FLOAT_ARITHMETIC,\n         &arithmetic::INTEGER_ARITHMETIC,\n         &as_conversions::AS_CONVERSIONS,\n+        &asm_syntax::INLINE_ASM_X86_ATT_SYNTAX,\n+        &asm_syntax::INLINE_ASM_X86_INTEL_SYNTAX,\n         &assertions_on_constants::ASSERTIONS_ON_CONSTANTS,\n         &assign_ops::ASSIGN_OP_PATTERN,\n         &assign_ops::MISREFACTORED_ASSIGN_OP,\n@@ -529,6 +534,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &derive::DERIVE_ORD_XOR_PARTIAL_ORD,\n         &derive::EXPL_IMPL_CLONE_ON_COPY,\n         &derive::UNSAFE_DERIVE_DESERIALIZE,\n+        &disallowed_method::DISALLOWED_METHOD,\n         &doc::DOC_MARKDOWN,\n         &doc::MISSING_ERRORS_DOC,\n         &doc::MISSING_SAFETY_DOC,\n@@ -851,9 +857,9 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &types::UNIT_CMP,\n         &types::UNNECESSARY_CAST,\n         &types::VEC_BOX,\n+        &unicode::INVISIBLE_CHARACTERS,\n         &unicode::NON_ASCII_LITERAL,\n         &unicode::UNICODE_NOT_NFC,\n-        &unicode::ZERO_WIDTH_SPACE,\n         &unit_return_expecting_ord::UNIT_RETURN_EXPECTING_ORD,\n         &unnamed_address::FN_ADDRESS_COMPARISONS,\n         &unnamed_address::VTABLE_ADDRESS_COMPARISONS,\n@@ -1120,11 +1126,18 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| box async_yields_async::AsyncYieldsAsync);\n     store.register_late_pass(|| box manual_strip::ManualStrip);\n     store.register_late_pass(|| box utils::internal_lints::MatchTypeOnDiagItem);\n+    let disallowed_methods = conf.disallowed_methods.iter().cloned().collect::<FxHashSet<_>>();\n+    store.register_late_pass(move || box disallowed_method::DisallowedMethod::new(&disallowed_methods));\n+    store.register_early_pass(|| box asm_syntax::InlineAsmX86AttSyntax);\n+    store.register_early_pass(|| box asm_syntax::InlineAsmX86IntelSyntax);\n+\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),\n         LintId::of(&arithmetic::INTEGER_ARITHMETIC),\n         LintId::of(&as_conversions::AS_CONVERSIONS),\n+        LintId::of(&asm_syntax::INLINE_ASM_X86_ATT_SYNTAX),\n+        LintId::of(&asm_syntax::INLINE_ASM_X86_INTEL_SYNTAX),\n         LintId::of(&create_dir::CREATE_DIR),\n         LintId::of(&dbg_macro::DBG_MACRO),\n         LintId::of(&else_if_without_else::ELSE_IF_WITHOUT_ELSE),\n@@ -1159,6 +1172,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&shadow::SHADOW_REUSE),\n         LintId::of(&shadow::SHADOW_SAME),\n         LintId::of(&strings::STRING_ADD),\n+        LintId::of(&types::RC_BUFFER),\n         LintId::of(&unwrap_in_result::UNWRAP_IN_RESULT),\n         LintId::of(&verbose_file_reads::VERBOSE_FILE_READS),\n         LintId::of(&write::PRINT_STDOUT),\n@@ -1463,7 +1477,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&single_component_path_imports::SINGLE_COMPONENT_PATH_IMPORTS),\n         LintId::of(&slow_vector_initialization::SLOW_VECTOR_INITIALIZATION),\n         LintId::of(&stable_sort_primitive::STABLE_SORT_PRIMITIVE),\n-        LintId::of(&strings::STRING_LIT_AS_BYTES),\n         LintId::of(&suspicious_trait_impl::SUSPICIOUS_ARITHMETIC_IMPL),\n         LintId::of(&suspicious_trait_impl::SUSPICIOUS_OP_ASSIGN_IMPL),\n         LintId::of(&swap::ALMOST_SWAPPED),\n@@ -1492,14 +1505,13 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&types::CHAR_LIT_AS_U8),\n         LintId::of(&types::FN_TO_NUMERIC_CAST),\n         LintId::of(&types::FN_TO_NUMERIC_CAST_WITH_TRUNCATION),\n-        LintId::of(&types::RC_BUFFER),\n         LintId::of(&types::REDUNDANT_ALLOCATION),\n         LintId::of(&types::TYPE_COMPLEXITY),\n         LintId::of(&types::UNIT_ARG),\n         LintId::of(&types::UNIT_CMP),\n         LintId::of(&types::UNNECESSARY_CAST),\n         LintId::of(&types::VEC_BOX),\n-        LintId::of(&unicode::ZERO_WIDTH_SPACE),\n+        LintId::of(&unicode::INVISIBLE_CHARACTERS),\n         LintId::of(&unit_return_expecting_ord::UNIT_RETURN_EXPECTING_ORD),\n         LintId::of(&unnamed_address::FN_ADDRESS_COMPARISONS),\n         LintId::of(&unnamed_address::VTABLE_ADDRESS_COMPARISONS),\n@@ -1592,6 +1604,8 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&mut_reference::UNNECESSARY_MUT_PASSED),\n         LintId::of(&neg_multiply::NEG_MULTIPLY),\n         LintId::of(&new_without_default::NEW_WITHOUT_DEFAULT),\n+        LintId::of(&non_copy_const::BORROW_INTERIOR_MUTABLE_CONST),\n+        LintId::of(&non_copy_const::DECLARE_INTERIOR_MUTABLE_CONST),\n         LintId::of(&non_expressive_names::JUST_UNDERSCORES_AND_DIGITS),\n         LintId::of(&non_expressive_names::MANY_SINGLE_CHAR_NAMES),\n         LintId::of(&panic_unimplemented::PANIC_PARAMS),\n@@ -1604,7 +1618,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&returns::LET_AND_RETURN),\n         LintId::of(&returns::NEEDLESS_RETURN),\n         LintId::of(&single_component_path_imports::SINGLE_COMPONENT_PATH_IMPORTS),\n-        LintId::of(&strings::STRING_LIT_AS_BYTES),\n         LintId::of(&tabs_in_doc_comments::TABS_IN_DOC_COMMENTS),\n         LintId::of(&to_digit_is_some::TO_DIGIT_IS_SOME),\n         LintId::of(&try_err::TRY_ERR),\n@@ -1747,8 +1760,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&misc::FLOAT_CMP),\n         LintId::of(&misc::MODULO_ONE),\n         LintId::of(&mut_key::MUTABLE_KEY_TYPE),\n-        LintId::of(&non_copy_const::BORROW_INTERIOR_MUTABLE_CONST),\n-        LintId::of(&non_copy_const::DECLARE_INTERIOR_MUTABLE_CONST),\n         LintId::of(&open_options::NONSENSICAL_OPEN_OPTIONS),\n         LintId::of(&option_env_unwrap::OPTION_ENV_UNWRAP),\n         LintId::of(&ptr::MUT_FROM_REF),\n@@ -1766,7 +1777,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&types::ABSURD_EXTREME_COMPARISONS),\n         LintId::of(&types::CAST_REF_TO_MUT),\n         LintId::of(&types::UNIT_CMP),\n-        LintId::of(&unicode::ZERO_WIDTH_SPACE),\n+        LintId::of(&unicode::INVISIBLE_CHARACTERS),\n         LintId::of(&unit_return_expecting_ord::UNIT_RETURN_EXPECTING_ORD),\n         LintId::of(&unnamed_address::FN_ADDRESS_COMPARISONS),\n         LintId::of(&unnamed_address::VTABLE_ADDRESS_COMPARISONS),\n@@ -1793,7 +1804,6 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&slow_vector_initialization::SLOW_VECTOR_INITIALIZATION),\n         LintId::of(&stable_sort_primitive::STABLE_SORT_PRIMITIVE),\n         LintId::of(&types::BOX_VEC),\n-        LintId::of(&types::RC_BUFFER),\n         LintId::of(&types::REDUNDANT_ALLOCATION),\n         LintId::of(&vec::USELESS_VEC),\n     ]);\n@@ -1807,6 +1817,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_group(true, \"clippy::nursery\", Some(\"clippy_nursery\"), vec![\n         LintId::of(&attrs::EMPTY_LINE_AFTER_OUTER_ATTR),\n         LintId::of(&cognitive_complexity::COGNITIVE_COMPLEXITY),\n+        LintId::of(&disallowed_method::DISALLOWED_METHOD),\n         LintId::of(&fallible_impl_from::FALLIBLE_IMPL_FROM),\n         LintId::of(&floating_point_arithmetic::IMPRECISE_FLOPS),\n         LintId::of(&floating_point_arithmetic::SUBOPTIMAL_FLOPS),\n@@ -1818,6 +1829,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&needless_borrow::NEEDLESS_BORROW),\n         LintId::of(&path_buf_push_overwrite::PATH_BUF_PUSH_OVERWRITE),\n         LintId::of(&redundant_pub_crate::REDUNDANT_PUB_CRATE),\n+        LintId::of(&strings::STRING_LIT_AS_BYTES),\n         LintId::of(&transmute::USELESS_TRANSMUTE),\n         LintId::of(&use_self::USE_SELF),\n     ]);\n@@ -1896,6 +1908,7 @@ pub fn register_renamed(ls: &mut rustc_lint::LintStore) {\n     ls.register_renamed(\"clippy::for_loop_over_option\", \"clippy::for_loops_over_fallibles\");\n     ls.register_renamed(\"clippy::for_loop_over_result\", \"clippy::for_loops_over_fallibles\");\n     ls.register_renamed(\"clippy::identity_conversion\", \"clippy::useless_conversion\");\n+    ls.register_renamed(\"clippy::zero_width_space\", \"clippy::invisible_characters\");\n }\n \n // only exists to let the dogfood integration test works."}, {"sha": "d7043e7bd8f713ce010fc84c48ef2f70fb48ace2", "filename": "src/tools/clippy/clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 77, "deletions": 92, "changes": 169, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Flifetimes.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,21 +1,22 @@\n+use crate::utils::paths;\n+use crate::utils::{get_trait_def_id, in_macro, span_lint, trait_ref_of_method};\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n-use rustc_hir::def::{DefKind, Res};\n use rustc_hir::intravisit::{\n-    walk_fn_decl, walk_generic_param, walk_generics, walk_param_bound, walk_ty, NestedVisitorMap, Visitor,\n+    walk_fn_decl, walk_generic_param, walk_generics, walk_item, walk_param_bound, walk_poly_trait_ref, walk_ty,\n+    NestedVisitorMap, Visitor,\n };\n use rustc_hir::FnRetTy::Return;\n use rustc_hir::{\n-    BodyId, FnDecl, GenericArg, GenericBound, GenericParam, GenericParamKind, Generics, ImplItem, ImplItemKind, Item,\n-    ItemKind, Lifetime, LifetimeName, ParamName, QPath, TraitBoundModifier, TraitFn, TraitItem, TraitItemKind, Ty,\n-    TyKind, WhereClause, WherePredicate,\n+    BareFnTy, BodyId, FnDecl, GenericArg, GenericBound, GenericParam, GenericParamKind, Generics, ImplItem,\n+    ImplItemKind, Item, ItemKind, Lifetime, LifetimeName, ParamName, PolyTraitRef, TraitBoundModifier, TraitFn,\n+    TraitItem, TraitItemKind, Ty, TyKind, WhereClause, WherePredicate,\n };\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_middle::hir::map::Map;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::source_map::Span;\n use rustc_span::symbol::{kw, Symbol};\n-\n-use crate::utils::{in_macro, last_path_segment, span_lint, trait_ref_of_method};\n+use std::iter::FromIterator;\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for lifetime annotations which can be removed by\n@@ -25,8 +26,11 @@ declare_clippy_lint! {\n     /// complicated, while there is nothing out of the ordinary going on. Removing\n     /// them leads to more readable code.\n     ///\n-    /// **Known problems:** Potential false negatives: we bail out if the function\n-    /// has a `where` clause where lifetimes are mentioned.\n+    /// **Known problems:**\n+    /// - We bail out if the function has a `where` clause where lifetimes\n+    /// are mentioned due to potenial false positives.\n+    /// - Lifetime bounds such as `impl Foo + 'a` and `T: 'a` must be elided with the\n+    /// placeholder notation `'_` because the fully elided notation leaves the type bound to `'static`.\n     ///\n     /// **Example:**\n     /// ```rust\n@@ -108,7 +112,7 @@ impl<'tcx> LateLintPass<'tcx> for Lifetimes {\n }\n \n /// The lifetime of a &-reference.\n-#[derive(PartialEq, Eq, Hash, Debug)]\n+#[derive(PartialEq, Eq, Hash, Debug, Clone)]\n enum RefLt {\n     Unnamed,\n     Static,\n@@ -127,7 +131,6 @@ fn check_fn_inner<'tcx>(\n         return;\n     }\n \n-    let mut bounds_lts = Vec::new();\n     let types = generics\n         .params\n         .iter()\n@@ -156,13 +159,12 @@ fn check_fn_inner<'tcx>(\n                         if bound.name != LifetimeName::Static && !bound.is_elided() {\n                             return;\n                         }\n-                        bounds_lts.push(bound);\n                     }\n                 }\n             }\n         }\n     }\n-    if could_use_elision(cx, decl, body, &generics.params, bounds_lts) {\n+    if could_use_elision(cx, decl, body, &generics.params) {\n         span_lint(\n             cx,\n             NEEDLESS_LIFETIMES,\n@@ -181,7 +183,6 @@ fn could_use_elision<'tcx>(\n     func: &'tcx FnDecl<'_>,\n     body: Option<BodyId>,\n     named_generics: &'tcx [GenericParam<'_>],\n-    bounds_lts: Vec<&'tcx Lifetime>,\n ) -> bool {\n     // There are two scenarios where elision works:\n     // * no output references, all input references have different LT\n@@ -204,15 +205,31 @@ fn could_use_elision<'tcx>(\n     if let Return(ref ty) = func.output {\n         output_visitor.visit_ty(ty);\n     }\n+    for lt in named_generics {\n+        input_visitor.visit_generic_param(lt)\n+    }\n+\n+    if input_visitor.abort() || output_visitor.abort() {\n+        return false;\n+    }\n \n-    let input_lts = match input_visitor.into_vec() {\n-        Some(lts) => lts_from_bounds(lts, bounds_lts.into_iter()),\n-        None => return false,\n-    };\n-    let output_lts = match output_visitor.into_vec() {\n-        Some(val) => val,\n-        None => return false,\n-    };\n+    if allowed_lts\n+        .intersection(&FxHashSet::from_iter(\n+            input_visitor\n+                .nested_elision_site_lts\n+                .iter()\n+                .chain(output_visitor.nested_elision_site_lts.iter())\n+                .cloned()\n+                .filter(|v| matches!(v, RefLt::Named(_))),\n+        ))\n+        .next()\n+        .is_some()\n+    {\n+        return false;\n+    }\n+\n+    let input_lts = input_visitor.lts;\n+    let output_lts = output_visitor.lts;\n \n     if let Some(body_id) = body {\n         let mut checker = BodyLifetimeChecker {\n@@ -277,35 +294,29 @@ fn allowed_lts_from(named_generics: &[GenericParam<'_>]) -> FxHashSet<RefLt> {\n     allowed_lts\n }\n \n-fn lts_from_bounds<'a, T: Iterator<Item = &'a Lifetime>>(mut vec: Vec<RefLt>, bounds_lts: T) -> Vec<RefLt> {\n-    for lt in bounds_lts {\n-        if lt.name != LifetimeName::Static {\n-            vec.push(RefLt::Named(lt.name.ident().name));\n-        }\n-    }\n-\n-    vec\n-}\n-\n /// Number of unique lifetimes in the given vector.\n #[must_use]\n fn unique_lifetimes(lts: &[RefLt]) -> usize {\n     lts.iter().collect::<FxHashSet<_>>().len()\n }\n \n+const CLOSURE_TRAIT_BOUNDS: [&[&str]; 3] = [&paths::FN, &paths::FN_MUT, &paths::FN_ONCE];\n+\n /// A visitor usable for `rustc_front::visit::walk_ty()`.\n struct RefVisitor<'a, 'tcx> {\n     cx: &'a LateContext<'tcx>,\n     lts: Vec<RefLt>,\n-    abort: bool,\n+    nested_elision_site_lts: Vec<RefLt>,\n+    unelided_trait_object_lifetime: bool,\n }\n \n impl<'a, 'tcx> RefVisitor<'a, 'tcx> {\n     fn new(cx: &'a LateContext<'tcx>) -> Self {\n         Self {\n             cx,\n             lts: Vec::new(),\n-            abort: false,\n+            nested_elision_site_lts: Vec::new(),\n+            unelided_trait_object_lifetime: false,\n         }\n     }\n \n@@ -325,40 +336,16 @@ impl<'a, 'tcx> RefVisitor<'a, 'tcx> {\n         }\n     }\n \n-    fn into_vec(self) -> Option<Vec<RefLt>> {\n-        if self.abort {\n-            None\n-        } else {\n-            Some(self.lts)\n-        }\n+    fn all_lts(&self) -> Vec<RefLt> {\n+        self.lts\n+            .iter()\n+            .chain(self.nested_elision_site_lts.iter())\n+            .cloned()\n+            .collect::<Vec<_>>()\n     }\n \n-    fn collect_anonymous_lifetimes(&mut self, qpath: &QPath<'_>, ty: &Ty<'_>) {\n-        if let Some(ref last_path_segment) = last_path_segment(qpath).args {\n-            if !last_path_segment.parenthesized\n-                && !last_path_segment\n-                    .args\n-                    .iter()\n-                    .any(|arg| matches!(arg, GenericArg::Lifetime(_)))\n-            {\n-                let hir_id = ty.hir_id;\n-                match self.cx.qpath_res(qpath, hir_id) {\n-                    Res::Def(DefKind::TyAlias | DefKind::Struct, def_id) => {\n-                        let generics = self.cx.tcx.generics_of(def_id);\n-                        for _ in generics.params.as_slice() {\n-                            self.record(&None);\n-                        }\n-                    },\n-                    Res::Def(DefKind::Trait, def_id) => {\n-                        let trait_def = self.cx.tcx.trait_def(def_id);\n-                        for _ in &self.cx.tcx.generics_of(trait_def.def_id).params {\n-                            self.record(&None);\n-                        }\n-                    },\n-                    _ => (),\n-                }\n-            }\n-        }\n+    fn abort(&self) -> bool {\n+        self.unelided_trait_object_lifetime\n     }\n }\n \n@@ -370,30 +357,37 @@ impl<'a, 'tcx> Visitor<'tcx> for RefVisitor<'a, 'tcx> {\n         self.record(&Some(*lifetime));\n     }\n \n+    fn visit_poly_trait_ref(&mut self, poly_tref: &'tcx PolyTraitRef<'tcx>, tbm: TraitBoundModifier) {\n+        let trait_ref = &poly_tref.trait_ref;\n+        if CLOSURE_TRAIT_BOUNDS\n+            .iter()\n+            .any(|trait_path| trait_ref.trait_def_id() == get_trait_def_id(self.cx, trait_path))\n+        {\n+            let mut sub_visitor = RefVisitor::new(self.cx);\n+            sub_visitor.visit_trait_ref(trait_ref);\n+            self.nested_elision_site_lts.append(&mut sub_visitor.all_lts());\n+        } else {\n+            walk_poly_trait_ref(self, poly_tref, tbm);\n+        }\n+    }\n+\n     fn visit_ty(&mut self, ty: &'tcx Ty<'_>) {\n         match ty.kind {\n-            TyKind::Rptr(ref lt, _) if lt.is_elided() => {\n-                self.record(&None);\n-            },\n-            TyKind::Path(ref path) => {\n-                self.collect_anonymous_lifetimes(path, ty);\n-            },\n             TyKind::OpaqueDef(item, _) => {\n                 let map = self.cx.tcx.hir();\n-                if let ItemKind::OpaqueTy(ref exist_ty) = map.expect_item(item.id).kind {\n-                    for bound in exist_ty.bounds {\n-                        if let GenericBound::Outlives(_) = *bound {\n-                            self.record(&None);\n-                        }\n-                    }\n-                } else {\n-                    unreachable!()\n-                }\n+                let item = map.expect_item(item.id);\n+                walk_item(self, item);\n                 walk_ty(self, ty);\n             },\n+            TyKind::BareFn(&BareFnTy { decl, .. }) => {\n+                let mut sub_visitor = RefVisitor::new(self.cx);\n+                sub_visitor.visit_fn_decl(decl);\n+                self.nested_elision_site_lts.append(&mut sub_visitor.all_lts());\n+                return;\n+            },\n             TyKind::TraitObject(bounds, ref lt) => {\n                 if !lt.is_elided() {\n-                    self.abort = true;\n+                    self.unelided_trait_object_lifetime = true;\n                 }\n                 for bound in bounds {\n                     self.visit_poly_trait_ref(bound, TraitBoundModifier::None);\n@@ -430,16 +424,7 @@ fn has_where_lifetimes<'tcx>(cx: &LateContext<'tcx>, where_clause: &'tcx WhereCl\n                     walk_param_bound(&mut visitor, bound);\n                 }\n                 // and check that all lifetimes are allowed\n-                match visitor.into_vec() {\n-                    None => return false,\n-                    Some(lts) => {\n-                        for lt in lts {\n-                            if !allowed_lts.contains(&lt) {\n-                                return true;\n-                            }\n-                        }\n-                    },\n-                }\n+                return visitor.all_lts().iter().any(|it| !allowed_lts.contains(it));\n             },\n             WherePredicate::EqPredicate(ref pred) => {\n                 let mut visitor = RefVisitor::new(cx);"}, {"sha": "c54103b25c20e772f401a1cdcb6bc587d6d61fbe", "filename": "src/tools/clippy/clippy_lints/src/literal_representation.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fliteral_representation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fliteral_representation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fliteral_representation.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -264,13 +264,10 @@ impl LiteralDigitGrouping {\n \n         let (part, mistyped_suffixes, missing_char) = if let Some((_, exponent)) = &mut num_lit.exponent {\n             (exponent, &[\"32\", \"64\"][..], 'f')\n+        } else if num_lit.fraction.is_some() {\n+            (&mut num_lit.integer, &[\"32\", \"64\"][..], 'f')\n         } else {\n-            num_lit\n-                .fraction\n-                .as_mut()\n-                .map_or((&mut num_lit.integer, &[\"8\", \"16\", \"32\", \"64\"][..], 'i'), |fraction| {\n-                    (fraction, &[\"32\", \"64\"][..], 'f')\n-                })\n+            (&mut num_lit.integer, &[\"8\", \"16\", \"32\", \"64\"][..], 'i')\n         };\n \n         let mut split = part.rsplit('_');"}, {"sha": "61b63597b163344773b36195162c493abeae7ddb", "filename": "src/tools/clippy/clippy_lints/src/loops.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Floops.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -3,7 +3,7 @@ use crate::utils::paths;\n use crate::utils::sugg::Sugg;\n use crate::utils::usage::{is_unused, mutated_variables};\n use crate::utils::{\n-    get_enclosing_block, get_parent_expr, get_trait_def_id, has_iter_method, higher, implements_trait,\n+    contains_name, get_enclosing_block, get_parent_expr, get_trait_def_id, has_iter_method, higher, implements_trait,\n     is_integer_const, is_no_std_crate, is_refutable, is_type_diagnostic_item, last_path_segment, match_trait_method,\n     match_type, match_var, multispan_sugg, qpath_res, snippet, snippet_opt, snippet_with_applicability,\n     snippet_with_macro_callsite, span_lint, span_lint_and_help, span_lint_and_sugg, span_lint_and_then, sugg,\n@@ -1276,6 +1276,8 @@ fn check_for_loop_range<'tcx>(\n \n                 let skip = if starts_at_zero {\n                     String::new()\n+                } else if visitor.indexed_mut.contains(&indexed) && contains_name(indexed, start) {\n+                    return;\n                 } else {\n                     format!(\".skip({})\", snippet(cx, start.span, \"..\"))\n                 };\n@@ -1302,6 +1304,8 @@ fn check_for_loop_range<'tcx>(\n \n                     if is_len_call(end, indexed) || is_end_eq_array_len(cx, end, limits, indexed_ty) {\n                         String::new()\n+                    } else if visitor.indexed_mut.contains(&indexed) && contains_name(indexed, take_expr) {\n+                        return;\n                     } else {\n                         match limits {\n                             ast::RangeLimits::Closed => {\n@@ -2134,7 +2138,7 @@ enum VarState {\n     DontWarn,\n }\n \n-/// Scan a for loop for variables that are incremented exactly once.\n+/// Scan a for loop for variables that are incremented exactly once and not used after that.\n struct IncrementVisitor<'a, 'tcx> {\n     cx: &'a LateContext<'tcx>,          // context reference\n     states: FxHashMap<HirId, VarState>, // incremented variables\n@@ -2154,6 +2158,10 @@ impl<'a, 'tcx> Visitor<'tcx> for IncrementVisitor<'a, 'tcx> {\n         if let Some(def_id) = var_def_id(self.cx, expr) {\n             if let Some(parent) = get_parent_expr(self.cx, expr) {\n                 let state = self.states.entry(def_id).or_insert(VarState::Initial);\n+                if *state == VarState::IncrOnce {\n+                    *state = VarState::DontWarn;\n+                    return;\n+                }\n \n                 match parent.kind {\n                     ExprKind::AssignOp(op, ref lhs, ref rhs) => {"}, {"sha": "b4b4b3dc18d51a290feee50ee8a917b8849bb800", "filename": "src/tools/clippy/clippy_lints/src/macro_use.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmacro_use.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -18,9 +18,9 @@ declare_clippy_lint! {\n     /// **Known problems:** None.\n     ///\n     /// **Example:**\n-    /// ```rust\n+    /// ```rust,ignore\n     /// #[macro_use]\n-    /// use lazy_static;\n+    /// use some_macro;\n     /// ```\n     pub MACRO_USE_IMPORTS,\n     pedantic,"}, {"sha": "c0824bacbc73510403c0d3694a1ee9a258930828", "filename": "src/tools/clippy/clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -400,8 +400,8 @@ declare_clippy_lint! {\n declare_clippy_lint! {\n     /// **What it does:** Checks for usage of `_.map(_).flatten(_)`,\n     ///\n-    /// **Why is this bad?** Readability, this can be written more concisely as a\n-    /// single method call using `_.flat_map(_)`\n+    /// **Why is this bad?** Readability, this can be written more concisely as\n+    /// `_.flat_map(_)`\n     ///\n     /// **Known problems:**\n     ///\n@@ -424,8 +424,8 @@ declare_clippy_lint! {\n     /// **What it does:** Checks for usage of `_.filter(_).map(_)`,\n     /// `_.filter(_).flat_map(_)`, `_.filter_map(_).flat_map(_)` and similar.\n     ///\n-    /// **Why is this bad?** Readability, this can be written more concisely as a\n-    /// single method call.\n+    /// **Why is this bad?** Readability, this can be written more concisely as\n+    /// `_.filter_map(_)`.\n     ///\n     /// **Known problems:** Often requires a condition + Option/Iterator creation\n     /// inside the closure.\n@@ -452,8 +452,8 @@ declare_clippy_lint! {\n declare_clippy_lint! {\n     /// **What it does:** Checks for usage of `_.filter_map(_).next()`.\n     ///\n-    /// **Why is this bad?** Readability, this can be written more concisely as a\n-    /// single method call.\n+    /// **Why is this bad?** Readability, this can be written more concisely as\n+    /// `_.find_map(_)`.\n     ///\n     /// **Known problems:** None\n     ///\n@@ -496,8 +496,8 @@ declare_clippy_lint! {\n declare_clippy_lint! {\n     /// **What it does:** Checks for usage of `_.find(_).map(_)`.\n     ///\n-    /// **Why is this bad?** Readability, this can be written more concisely as a\n-    /// single method call.\n+    /// **Why is this bad?** Readability, this can be written more concisely as\n+    /// `_.find_map(_)`.\n     ///\n     /// **Known problems:** Often requires a condition + Option/Iterator creation\n     /// inside the closure.\n@@ -1276,8 +1276,8 @@ declare_clippy_lint! {\n declare_clippy_lint! {\n     /// **What it does:** Checks for usage of `_.as_ref().map(Deref::deref)` or it's aliases (such as String::as_str).\n     ///\n-    /// **Why is this bad?** Readability, this can be written more concisely as a\n-    /// single method call.\n+    /// **Why is this bad?** Readability, this can be written more concisely as\n+    /// `_.as_deref()`.\n     ///\n     /// **Known problems:** None.\n     ///\n@@ -1668,9 +1668,7 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n             if let ty::Opaque(def_id, _) = *ret_ty.kind() {\n                 // one of the associated types must be Self\n                 for &(predicate, _span) in cx.tcx.explicit_item_bounds(def_id) {\n-                    if let ty::PredicateAtom::Projection(projection_predicate) =\n-                        predicate.skip_binders()\n-                    {\n+                    if let ty::PredicateAtom::Projection(projection_predicate) = predicate.skip_binders() {\n                         // walk the associated type and check for Self\n                         if contains_ty(projection_predicate.ty, self_ty) {\n                             return;"}, {"sha": "25245b3dbf08e1274174b992f18abf2631e7d073", "filename": "src/tools/clippy/clippy_lints/src/missing_const_for_fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_const_for_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_const_for_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fmissing_const_for_fn.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,10 +1,10 @@\n+use crate::utils::qualify_min_const_fn::is_min_const_fn;\n use crate::utils::{fn_has_unsatisfiable_preds, has_drop, is_entrypoint_fn, span_lint, trait_ref_of_method};\n use rustc_hir as hir;\n use rustc_hir::intravisit::FnKind;\n use rustc_hir::{Body, Constness, FnDecl, GenericParamKind, HirId};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_middle::lint::in_external_macro;\n-use crate::utils::qualify_min_const_fn::is_min_const_fn;\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::Span;\n use rustc_typeck::hir_ty_to_ty;"}, {"sha": "7687962bdd9bf1bfffe8cd772fd164421ed7a204", "filename": "src/tools/clippy/clippy_lints/src/needless_arbitrary_self_type.rs", "status": "modified", "additions": 25, "deletions": 5, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_arbitrary_self_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_arbitrary_self_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fneedless_arbitrary_self_type.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::span_lint_and_sugg;\n+use crate::utils::{in_macro, span_lint_and_sugg};\n use if_chain::if_chain;\n use rustc_ast::ast::{BindingMode, Lifetime, Mutability, Param, PatKind, Path, TyKind};\n use rustc_errors::Applicability;\n@@ -69,11 +69,30 @@ fn check_param_inner(cx: &EarlyContext<'_>, path: &Path, span: Span, binding_mod\n         if let [segment] = &path.segments[..];\n         if segment.ident.name == kw::SelfUpper;\n         then {\n+            // In case we have a named lifetime, we check if the name comes from expansion.\n+            // If it does, at this point we know the rest of the parameter was written by the user,\n+            // so let them decide what the name of the lifetime should be.\n+            // See #6089 for more details.\n+            let mut applicability = Applicability::MachineApplicable;\n             let self_param = match (binding_mode, mutbl) {\n                 (Mode::Ref(None), Mutability::Mut) => \"&mut self\".to_string(),\n-                (Mode::Ref(Some(lifetime)), Mutability::Mut) => format!(\"&{} mut self\", &lifetime.ident.name),\n+                (Mode::Ref(Some(lifetime)), Mutability::Mut) => {\n+                    if in_macro(lifetime.ident.span) {\n+                        applicability = Applicability::HasPlaceholders;\n+                        \"&'_ mut self\".to_string()\n+                    } else {\n+                        format!(\"&{} mut self\", &lifetime.ident.name)\n+                    }\n+                },\n                 (Mode::Ref(None), Mutability::Not) => \"&self\".to_string(),\n-                (Mode::Ref(Some(lifetime)), Mutability::Not) => format!(\"&{} self\", &lifetime.ident.name),\n+                (Mode::Ref(Some(lifetime)), Mutability::Not) => {\n+                    if in_macro(lifetime.ident.span) {\n+                        applicability = Applicability::HasPlaceholders;\n+                        \"&'_ self\".to_string()\n+                    } else {\n+                        format!(\"&{} self\", &lifetime.ident.name)\n+                    }\n+                },\n                 (Mode::Value, Mutability::Mut) => \"mut self\".to_string(),\n                 (Mode::Value, Mutability::Not) => \"self\".to_string(),\n             };\n@@ -85,15 +104,16 @@ fn check_param_inner(cx: &EarlyContext<'_>, path: &Path, span: Span, binding_mod\n                 \"the type of the `self` parameter does not need to be arbitrary\",\n                 \"consider to change this parameter to\",\n                 self_param,\n-                Applicability::MachineApplicable,\n+                applicability,\n             )\n         }\n     }\n }\n \n impl EarlyLintPass for NeedlessArbitrarySelfType {\n     fn check_param(&mut self, cx: &EarlyContext<'_>, p: &Param) {\n-        if !p.is_self() {\n+        // Bail out if the parameter it's not a receiver or was not written by the user\n+        if !p.is_self() || in_macro(p.span) {\n             return;\n         }\n "}, {"sha": "7b662eae7753eef1571c09880064486ec15f2cd5", "filename": "src/tools/clippy/clippy_lints/src/non_copy_const.rs", "status": "modified", "additions": 24, "deletions": 4, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fnon_copy_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fnon_copy_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fnon_copy_const.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,6 +1,6 @@\n //! Checks for uses of const which the type is not `Freeze` (`Cell`-free).\n //!\n-//! This lint is **deny** by default.\n+//! This lint is **warn** by default.\n \n use std::ptr;\n \n@@ -17,6 +17,8 @@ use rustc_typeck::hir_ty_to_ty;\n use crate::utils::{in_constant, qpath_res, span_lint_and_then};\n use if_chain::if_chain;\n \n+// FIXME: this is a correctness problem but there's no suitable\n+// warn-by-default category.\n declare_clippy_lint! {\n     /// **What it does:** Checks for declaration of `const` items which is interior\n     /// mutable (e.g., contains a `Cell`, `Mutex`, `AtomicXxxx`, etc.).\n@@ -34,6 +36,15 @@ declare_clippy_lint! {\n     /// `std::sync::ONCE_INIT` constant). In this case the use of `const` is legit,\n     /// and this lint should be suppressed.\n     ///\n+    /// When an enum has variants with interior mutability, use of its non interior mutable\n+    /// variants can generate false positives. See issue\n+    /// [#3962](https://github.com/rust-lang/rust-clippy/issues/3962)\n+    ///\n+    /// Types that have underlying or potential interior mutability trigger the lint whether\n+    /// the interior mutable field is used or not. See issues\n+    /// [#5812](https://github.com/rust-lang/rust-clippy/issues/5812) and\n+    /// [#3825](https://github.com/rust-lang/rust-clippy/issues/3825)\n+    ///\n     /// **Example:**\n     /// ```rust\n     /// use std::sync::atomic::{AtomicUsize, Ordering::SeqCst};\n@@ -49,10 +60,12 @@ declare_clippy_lint! {\n     /// assert_eq!(STATIC_ATOM.load(SeqCst), 9); // use a `static` item to refer to the same instance\n     /// ```\n     pub DECLARE_INTERIOR_MUTABLE_CONST,\n-    correctness,\n+    style,\n     \"declaring `const` with interior mutability\"\n }\n \n+// FIXME: this is a correctness problem but there's no suitable\n+// warn-by-default category.\n declare_clippy_lint! {\n     /// **What it does:** Checks if `const` items which is interior mutable (e.g.,\n     /// contains a `Cell`, `Mutex`, `AtomicXxxx`, etc.) has been borrowed directly.\n@@ -64,7 +77,14 @@ declare_clippy_lint! {\n     ///\n     /// The `const` value should be stored inside a `static` item.\n     ///\n-    /// **Known problems:** None\n+    /// **Known problems:** When an enum has variants with interior mutability, use of its non\n+    /// interior mutable variants can generate false positives. See issue\n+    /// [#3962](https://github.com/rust-lang/rust-clippy/issues/3962)\n+    ///\n+    /// Types that have underlying or potential interior mutability trigger the lint whether\n+    /// the interior mutable field is used or not. See issues\n+    /// [#5812](https://github.com/rust-lang/rust-clippy/issues/5812) and\n+    /// [#3825](https://github.com/rust-lang/rust-clippy/issues/3825)\n     ///\n     /// **Example:**\n     /// ```rust\n@@ -81,7 +101,7 @@ declare_clippy_lint! {\n     /// assert_eq!(STATIC_ATOM.load(SeqCst), 9); // use a `static` item to refer to the same instance\n     /// ```\n     pub BORROW_INTERIOR_MUTABLE_CONST,\n-    correctness,\n+    style,\n     \"referencing `const` with interior mutability\"\n }\n "}, {"sha": "95594e38c9ec14a7ef7d13b15f3c78fa6ed1b8de", "filename": "src/tools/clippy/clippy_lints/src/regex.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fregex.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -143,7 +143,7 @@ fn check_set<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, utf8: bool) {\n \n fn check_regex<'tcx>(cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>, utf8: bool) {\n     let mut parser = regex_syntax::ParserBuilder::new()\n-        .unicode(utf8)\n+        .unicode(true)\n         .allow_invalid_utf8(!utf8)\n         .build();\n "}, {"sha": "3783bd78de25e324bf2c5a10b6ee3dfa5084780d", "filename": "src/tools/clippy/clippy_lints/src/strings.rs", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fstrings.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fstrings.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fstrings.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -69,7 +69,27 @@ declare_clippy_lint! {\n     /// **Why is this bad?** Byte string literals (e.g., `b\"foo\"`) can be used\n     /// instead. They are shorter but less discoverable than `as_bytes()`.\n     ///\n-    /// **Known Problems:** None.\n+    /// **Known Problems:**\n+    /// `\"str\".as_bytes()` and the suggested replacement of `b\"str\"` are not\n+    /// equivalent because they have different types. The former is `&[u8]`\n+    /// while the latter is `&[u8; 3]`. That means in general they will have a\n+    /// different set of methods and different trait implementations.\n+    ///\n+    /// ```compile_fail\n+    /// fn f(v: Vec<u8>) {}\n+    ///\n+    /// f(\"...\".as_bytes().to_owned()); // works\n+    /// f(b\"...\".to_owned()); // does not work, because arg is [u8; 3] not Vec<u8>\n+    ///\n+    /// fn g(r: impl std::io::Read) {}\n+    ///\n+    /// g(\"...\".as_bytes()); // works\n+    /// g(b\"...\"); // does not work\n+    /// ```\n+    ///\n+    /// The actual equivalent of `\"str\".as_bytes()` with the same type is not\n+    /// `b\"str\"` but `&b\"str\"[..]`, which is a great deal of punctuation and not\n+    /// more readable than a function call.\n     ///\n     /// **Example:**\n     /// ```rust\n@@ -80,7 +100,7 @@ declare_clippy_lint! {\n     /// let bs = b\"a byte string\";\n     /// ```\n     pub STRING_LIT_AS_BYTES,\n-    style,\n+    nursery,\n     \"calling `as_bytes` on a string literal instead of using a byte string literal\"\n }\n "}, {"sha": "5e83b6c81ec8fd14506e4f4191916e9c6545f66c", "filename": "src/tools/clippy/clippy_lints/src/types.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Ftypes.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -216,18 +216,19 @@ declare_clippy_lint! {\n }\n \n declare_clippy_lint! {\n-    /// **What it does:** Checks for Rc<T> and Arc<T> when T is a mutable buffer type such as String or Vec\n+    /// **What it does:** Checks for `Rc<T>` and `Arc<T>` when `T` is a mutable buffer type such as `String` or `Vec`.\n     ///\n-    /// **Why is this bad?** Expressions such as Rc<String> have no advantage over Rc<str>, since\n-    /// it is larger and involves an extra level of indirection, and doesn't implement Borrow<str>.\n+    /// **Why is this bad?** Expressions such as `Rc<String>` usually have no advantage over `Rc<str>`, since\n+    /// it is larger and involves an extra level of indirection, and doesn't implement `Borrow<str>`.\n     ///\n-    /// While mutating a buffer type would still be possible with Rc::get_mut(), it only\n-    /// works if there are no additional references yet, which defeats the purpose of\n+    /// While mutating a buffer type would still be possible with `Rc::get_mut()`, it only\n+    /// works if there are no additional references yet, which usually defeats the purpose of\n     /// enclosing it in a shared ownership type. Instead, additionally wrapping the inner\n-    /// type with an interior mutable container (such as RefCell or Mutex) would normally\n+    /// type with an interior mutable container (such as `RefCell` or `Mutex`) would normally\n     /// be used.\n     ///\n-    /// **Known problems:** None.\n+    /// **Known problems:** This pattern can be desirable to avoid the overhead of a `RefCell` or `Mutex` for\n+    /// cases where mutation only happens before there are any additional references.\n     ///\n     /// **Example:**\n     /// ```rust,ignore\n@@ -241,7 +242,7 @@ declare_clippy_lint! {\n     /// fn foo(interned: Rc<str>) { ... }\n     /// ```\n     pub RC_BUFFER,\n-    perf,\n+    restriction,\n     \"shared ownership of a buffer type\"\n }\n "}, {"sha": "93d59cc7fcd178bf42c1fae30b8626206e29fa82", "filename": "src/tools/clippy/clippy_lints/src/unicode.rs", "status": "modified", "additions": 13, "deletions": 10, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funicode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funicode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funicode.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -8,18 +8,18 @@ use rustc_span::source_map::Span;\n use unicode_normalization::UnicodeNormalization;\n \n declare_clippy_lint! {\n-    /// **What it does:** Checks for the Unicode zero-width space in the code.\n+    /// **What it does:** Checks for invisible Unicode characters in the code.\n     ///\n     /// **Why is this bad?** Having an invisible character in the code makes for all\n     /// sorts of April fools, but otherwise is very much frowned upon.\n     ///\n     /// **Known problems:** None.\n     ///\n-    /// **Example:** You don't see it, but there may be a zero-width space\n-    /// somewhere in this text.\n-    pub ZERO_WIDTH_SPACE,\n+    /// **Example:** You don't see it, but there may be a zero-width space or soft hyphen\n+    /// some\u00adwhere in this text.\n+    pub INVISIBLE_CHARACTERS,\n     correctness,\n-    \"using a zero-width space in a string literal, which is confusing\"\n+    \"using an invisible character in a string literal, which is confusing\"\n }\n \n declare_clippy_lint! {\n@@ -63,7 +63,7 @@ declare_clippy_lint! {\n     \"using a Unicode literal not in NFC normal form (see [Unicode tr15](http://www.unicode.org/reports/tr15/) for further information)\"\n }\n \n-declare_lint_pass!(Unicode => [ZERO_WIDTH_SPACE, NON_ASCII_LITERAL, UNICODE_NOT_NFC]);\n+declare_lint_pass!(Unicode => [INVISIBLE_CHARACTERS, NON_ASCII_LITERAL, UNICODE_NOT_NFC]);\n \n impl LateLintPass<'_> for Unicode {\n     fn check_expr(&mut self, cx: &LateContext<'_>, expr: &'_ Expr<'_>) {\n@@ -91,14 +91,17 @@ fn escape<T: Iterator<Item = char>>(s: T) -> String {\n \n fn check_str(cx: &LateContext<'_>, span: Span, id: HirId) {\n     let string = snippet(cx, span, \"\");\n-    if string.contains('\\u{200B}') {\n+    if string.chars().any(|c| ['\\u{200B}', '\\u{ad}', '\\u{2060}'].contains(&c)) {\n         span_lint_and_sugg(\n             cx,\n-            ZERO_WIDTH_SPACE,\n+            INVISIBLE_CHARACTERS,\n             span,\n-            \"zero-width space detected\",\n+            \"invisible character detected\",\n             \"consider replacing the string with\",\n-            string.replace(\"\\u{200B}\", \"\\\\u{200B}\"),\n+            string\n+                .replace(\"\\u{200B}\", \"\\\\u{200B}\")\n+                .replace(\"\\u{ad}\", \"\\\\u{AD}\")\n+                .replace(\"\\u{2060}\", \"\\\\u{2060}\"),\n             Applicability::MachineApplicable,\n         );\n     }"}, {"sha": "1307237dbc70a98ec5997f370212c5c2d80cebb7", "filename": "src/tools/clippy/clippy_lints/src/unnecessary_sort_by.rs", "status": "modified", "additions": 20, "deletions": 38, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_sort_by.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_sort_by.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Funnecessary_sort_by.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -170,22 +170,12 @@ fn mirrored_exprs(\n }\n \n fn detect_lint(cx: &LateContext<'_>, expr: &Expr<'_>) -> Option<LintTrigger> {\n-    // NOTE: Vectors of references are not supported. In order to avoid hitting https://github.com/rust-lang/rust/issues/34162,\n-    // (different unnamed lifetimes for closure arg and return type) we need to make sure the suggested\n-    // closure parameter is not a reference in case we suggest `Reverse`. Trying to destructure more\n-    // than one level of references would add some extra complexity as we would have to compensate\n-    // in the closure body.\n-\n     if_chain! {\n         if let ExprKind::MethodCall(name_ident, _, args, _) = &expr.kind;\n         if let name = name_ident.ident.name.to_ident_string();\n         if name == \"sort_by\" || name == \"sort_unstable_by\";\n         if let [vec, Expr { kind: ExprKind::Closure(_, _, closure_body_id, _, _), .. }] = args;\n-        let vec_ty = cx.typeck_results().expr_ty(vec);\n-        if utils::is_type_diagnostic_item(cx, vec_ty, sym!(vec_type));\n-        let ty = vec_ty.walk().nth(1).unwrap().expect_ty(); // T in Vec<T>\n-        if !matches!(&ty.kind(), ty::Ref(..));\n-        if utils::is_copy(cx, ty);\n+        if utils::is_type_diagnostic_item(cx, cx.typeck_results().expr_ty(vec), sym!(vec_type));\n         if let closure_body = cx.tcx.hir().body(*closure_body_id);\n         if let &[\n             Param { pat: Pat { kind: PatKind::Binding(_, _, left_ident, _), .. }, ..},\n@@ -210,40 +200,32 @@ fn detect_lint(cx: &LateContext<'_>, expr: &Expr<'_>) -> Option<LintTrigger> {\n             let vec_name = Sugg::hir(cx, &args[0], \"..\").to_string();\n             let unstable = name == \"sort_unstable_by\";\n \n-            if_chain! {\n-                if let ExprKind::Path(QPath::Resolved(_, Path {\n-                    segments: [PathSegment { ident: left_name, .. }], ..\n-                })) = &left_expr.kind;\n-                if left_name == left_ident;\n-                then {\n-                    return Some(LintTrigger::Sort(SortDetection { vec_name, unstable }))\n-                } else {\n-                    if !key_returns_borrow(cx, left_expr) {\n-                        return Some(LintTrigger::SortByKey(SortByKeyDetection {\n-                            vec_name,\n-                            unstable,\n-                            closure_arg,\n-                            closure_body,\n-                            reverse\n-                        }))\n-                    }\n+            if let ExprKind::Path(QPath::Resolved(_, Path {\n+                segments: [PathSegment { ident: left_name, .. }], ..\n+            })) = &left_expr.kind {\n+                if left_name == left_ident {\n+                    return Some(LintTrigger::Sort(SortDetection { vec_name, unstable }));\n                 }\n             }\n+\n+            if !expr_borrows(cx, left_expr) {\n+                return Some(LintTrigger::SortByKey(SortByKeyDetection {\n+                    vec_name,\n+                    unstable,\n+                    closure_arg,\n+                    closure_body,\n+                    reverse\n+                }));\n+            }\n         }\n     }\n \n     None\n }\n \n-fn key_returns_borrow(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n-    if let Some(def_id) = utils::fn_def_id(cx, expr) {\n-        let output = cx.tcx.fn_sig(def_id).output();\n-        let ty = output.skip_binder();\n-        return matches!(ty.kind(), ty::Ref(..))\n-            || ty.walk().any(|arg| matches!(arg.unpack(), GenericArgKind::Lifetime(_)));\n-    }\n-\n-    false\n+fn expr_borrows(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n+    let ty = cx.typeck_results().expr_ty(expr);\n+    matches!(ty.kind(), ty::Ref(..)) || ty.walk().any(|arg| matches!(arg.unpack(), GenericArgKind::Lifetime(_)))\n }\n \n impl LateLintPass<'_> for UnnecessarySortBy {\n@@ -256,7 +238,7 @@ impl LateLintPass<'_> for UnnecessarySortBy {\n                 \"use Vec::sort_by_key here instead\",\n                 \"try\",\n                 format!(\n-                    \"{}.sort{}_by_key(|&{}| {})\",\n+                    \"{}.sort{}_by_key(|{}| {})\",\n                     trigger.vec_name,\n                     if trigger.unstable { \"_unstable\" } else { \"\" },\n                     trigger.closure_arg,"}, {"sha": "dd2fd0bb445fec5345ff6ed7a898ac067d22f095", "filename": "src/tools/clippy/clippy_lints/src/utils/conf.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fconf.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -2,10 +2,10 @@\n \n #![deny(clippy::missing_docs_in_private_items)]\n \n-use lazy_static::lazy_static;\n use rustc_ast::ast::{LitKind, MetaItemKind, NestedMetaItem};\n use rustc_span::source_map;\n use source_map::Span;\n+use std::lazy::SyncLazy;\n use std::path::{Path, PathBuf};\n use std::sync::Mutex;\n use std::{env, fmt, fs, io};\n@@ -54,9 +54,8 @@ impl From<io::Error> for Error {\n     }\n }\n \n-lazy_static! {\n-    static ref ERRORS: Mutex<Vec<Error>> = Mutex::new(Vec::new());\n-}\n+/// Vec of errors that might be collected during config toml parsing\n+static ERRORS: SyncLazy<Mutex<Vec<Error>>> = SyncLazy::new(|| Mutex::new(Vec::new()));\n \n macro_rules! define_Conf {\n     ($(#[$doc:meta] ($config:ident, $config_str:literal: $Ty:ty, $default:expr),)+) => {\n@@ -82,6 +81,7 @@ macro_rules! define_Conf {\n                     use serde::Deserialize;\n                     pub fn deserialize<'de, D: serde::Deserializer<'de>>(deserializer: D) -> Result<$Ty, D::Error> {\n                         use super::super::{ERRORS, Error};\n+\n                         Ok(\n                             <$Ty>::deserialize(deserializer).unwrap_or_else(|e| {\n                                 ERRORS\n@@ -164,6 +164,8 @@ define_Conf! {\n     (max_fn_params_bools, \"max_fn_params_bools\": u64, 3),\n     /// Lint: WILDCARD_IMPORTS. Whether to allow certain wildcard imports (prelude, super in tests).\n     (warn_on_all_wildcard_imports, \"warn_on_all_wildcard_imports\": bool, false),\n+    /// Lint: DISALLOWED_METHOD. The list of blacklisted methods to lint about. NB: `bar` is not here since it has legitimate uses\n+    (disallowed_methods, \"disallowed_methods\": Vec<String>, Vec::<String>::new()),\n }\n \n impl Default for Conf {"}, {"sha": "790ac4f7dd8aa25f6fc0cef183ee27c302bc0bbf", "filename": "src/tools/clippy/clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -18,9 +18,9 @@ pub mod internal_lints;\n pub mod numeric_literal;\n pub mod paths;\n pub mod ptr;\n+pub mod qualify_min_const_fn;\n pub mod sugg;\n pub mod usage;\n-pub mod qualify_min_const_fn;\n \n pub use self::attrs::*;\n pub use self::diagnostics::*;\n@@ -47,7 +47,6 @@ use rustc_lint::{LateContext, Level, Lint, LintContext};\n use rustc_middle::hir::map::Map;\n use rustc_middle::ty::subst::{GenericArg, GenericArgKind};\n use rustc_middle::ty::{self, layout::IntegerExt, Ty, TyCtxt, TypeFoldable};\n-use rustc_mir::const_eval;\n use rustc_span::hygiene::{ExpnKind, MacroKind};\n use rustc_span::source_map::original_sp;\n use rustc_span::symbol::{self, kw, Symbol};\n@@ -884,19 +883,11 @@ pub fn is_copy<'tcx>(cx: &LateContext<'tcx>, ty: Ty<'tcx>) -> bool {\n \n /// Checks if an expression is constructing a tuple-like enum variant or struct\n pub fn is_ctor_or_promotable_const_function(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n-    fn has_no_arguments(cx: &LateContext<'_>, def_id: DefId) -> bool {\n-        cx.tcx.fn_sig(def_id).skip_binder().inputs().is_empty()\n-    }\n-\n     if let ExprKind::Call(ref fun, _) = expr.kind {\n         if let ExprKind::Path(ref qp) = fun.kind {\n             let res = cx.qpath_res(qp, fun.hir_id);\n             return match res {\n                 def::Res::Def(DefKind::Variant | DefKind::Ctor(..), ..) => true,\n-                // FIXME: check the constness of the arguments, see https://github.com/rust-lang/rust-clippy/pull/5682#issuecomment-638681210\n-                def::Res::Def(DefKind::Fn | DefKind::AssocFn, def_id) if has_no_arguments(cx, def_id) => {\n-                    const_eval::is_const_fn(cx.tcx, def_id)\n-                },\n                 def::Res::Def(_, def_id) => cx.tcx.is_promotable_const_fn(def_id),\n                 _ => false,\n             };\n@@ -1287,8 +1278,7 @@ pub fn is_must_use_ty<'tcx>(cx: &LateContext<'tcx>, ty: Ty<'tcx>) -> bool {\n         ty::Opaque(ref def_id, _) => {\n             for (predicate, _) in cx.tcx.explicit_item_bounds(*def_id) {\n                 if let ty::PredicateAtom::Trait(trait_predicate, _) = predicate.skip_binders() {\n-                    if must_use_attr(&cx.tcx.get_attrs(trait_predicate.trait_ref.def_id)).is_some()\n-                    {\n+                    if must_use_attr(&cx.tcx.get_attrs(trait_predicate.trait_ref.def_id)).is_some() {\n                         return true;\n                     }\n                 }"}, {"sha": "52d3c2c1daf0961dec0f4af9f5efb565a9d6b14b", "filename": "src/tools/clippy/clippy_lints/src/utils/numeric_literal.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fnumeric_literal.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -36,8 +36,9 @@ pub struct NumericLiteral<'a> {\n     pub integer: &'a str,\n     /// The fraction part of the number.\n     pub fraction: Option<&'a str>,\n-    /// The character used as exponent separator (b'e' or b'E') and the exponent part.\n-    pub exponent: Option<(char, &'a str)>,\n+    /// The exponent separator (b'e' or b'E') including preceding underscore if present\n+    /// and the exponent part.\n+    pub exponent: Option<(&'a str, &'a str)>,\n \n     /// The type suffix, including preceding underscore if present.\n     pub suffix: Option<&'a str>,\n@@ -100,7 +101,7 @@ impl<'a> NumericLiteral<'a> {\n         self.radix == Radix::Decimal\n     }\n \n-    pub fn split_digit_parts(digits: &str, float: bool) -> (&str, Option<&str>, Option<(char, &str)>) {\n+    pub fn split_digit_parts(digits: &str, float: bool) -> (&str, Option<&str>, Option<(&str, &str)>) {\n         let mut integer = digits;\n         let mut fraction = None;\n         let mut exponent = None;\n@@ -113,12 +114,14 @@ impl<'a> NumericLiteral<'a> {\n                         fraction = Some(&digits[i + 1..]);\n                     },\n                     'e' | 'E' => {\n-                        if integer.len() > i {\n-                            integer = &digits[..i];\n+                        let exp_start = if digits[..i].ends_with('_') { i - 1 } else { i };\n+\n+                        if integer.len() > exp_start {\n+                            integer = &digits[..exp_start];\n                         } else {\n-                            fraction = Some(&digits[integer.len() + 1..i]);\n+                            fraction = Some(&digits[integer.len() + 1..exp_start]);\n                         };\n-                        exponent = Some((c, &digits[i + 1..]));\n+                        exponent = Some((&digits[exp_start..=i], &digits[i + 1..]));\n                         break;\n                     },\n                     _ => {},\n@@ -153,7 +156,7 @@ impl<'a> NumericLiteral<'a> {\n         }\n \n         if let Some((separator, exponent)) = self.exponent {\n-            output.push(separator);\n+            output.push_str(separator);\n             Self::group_digits(&mut output, exponent, group_size, true, false);\n         }\n "}, {"sha": "277da9d3f3a275bb87e9796fa59ee62f39a8d69a", "filename": "src/tools/clippy/clippy_lints/src/utils/paths.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fpaths.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -41,6 +41,9 @@ pub const FILE_TYPE: [&str; 3] = [\"std\", \"fs\", \"FileType\"];\n pub const FMT_ARGUMENTS_NEW_V1: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1\"];\n pub const FMT_ARGUMENTS_NEW_V1_FORMATTED: [&str; 4] = [\"core\", \"fmt\", \"Arguments\", \"new_v1_formatted\"];\n pub const FMT_ARGUMENTV1_NEW: [&str; 4] = [\"core\", \"fmt\", \"ArgumentV1\", \"new\"];\n+pub const FN: [&str; 3] = [\"core\", \"ops\", \"Fn\"];\n+pub const FN_MUT: [&str; 3] = [\"core\", \"ops\", \"FnMut\"];\n+pub const FN_ONCE: [&str; 3] = [\"core\", \"ops\", \"FnOnce\"];\n pub const FROM_FROM: [&str; 4] = [\"core\", \"convert\", \"From\", \"from\"];\n pub const FROM_TRAIT: [&str; 3] = [\"core\", \"convert\", \"From\"];\n pub const FUTURE_FROM_GENERATOR: [&str; 3] = [\"core\", \"future\", \"from_generator\"];"}, {"sha": "1b4f20342729a39c77c75b742d1f3981de2059a0", "filename": "src/tools/clippy/clippy_lints/src/utils/qualify_min_const_fn.rs", "status": "modified", "additions": 75, "deletions": 118, "changes": 193, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Futils%2Fqualify_min_const_fn.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,9 +1,12 @@\n use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n-use rustc_middle::mir::*;\n+use rustc_middle::mir::{\n+    Body, CastKind, NullOp, Operand, Place, ProjectionElem, Rvalue, Statement, StatementKind, Terminator,\n+    TerminatorKind,\n+};\n use rustc_middle::ty::subst::GenericArgKind;\n use rustc_middle::ty::{self, adjustment::PointerCast, Ty, TyCtxt};\n-use rustc_span::symbol::{sym};\n+use rustc_span::symbol::sym;\n use rustc_span::Span;\n use rustc_target::spec::abi::Abi::RustIntrinsic;\n use std::borrow::Cow;\n@@ -24,15 +27,9 @@ pub fn is_min_const_fn(tcx: TyCtxt<'tcx>, body: &'a Body<'tcx>) -> McfResult {\n                 | ty::PredicateAtom::ConstEvaluatable(..)\n                 | ty::PredicateAtom::ConstEquate(..)\n                 | ty::PredicateAtom::TypeWellFormedFromEnv(..) => continue,\n-                ty::PredicateAtom::ObjectSafe(_) => {\n-                    panic!(\"object safe predicate on function: {:#?}\", predicate)\n-                }\n-                ty::PredicateAtom::ClosureKind(..) => {\n-                    panic!(\"closure kind predicate on function: {:#?}\", predicate)\n-                }\n-                ty::PredicateAtom::Subtype(_) => {\n-                    panic!(\"subtype predicate on function: {:#?}\", predicate)\n-                }\n+                ty::PredicateAtom::ObjectSafe(_) => panic!(\"object safe predicate on function: {:#?}\", predicate),\n+                ty::PredicateAtom::ClosureKind(..) => panic!(\"closure kind predicate on function: {:#?}\", predicate),\n+                ty::PredicateAtom::Subtype(_) => panic!(\"subtype predicate on function: {:#?}\", predicate),\n                 ty::PredicateAtom::Trait(pred, _) => {\n                     if Some(pred.def_id()) == tcx.lang_items().sized_trait() {\n                         continue;\n@@ -48,12 +45,12 @@ pub fn is_min_const_fn(tcx: TyCtxt<'tcx>, body: &'a Body<'tcx>) -> McfResult {\n                                  on const fn parameters are unstable\"\n                                     .into(),\n                             ));\n-                        }\n+                        },\n                         // other kinds of bounds are either tautologies\n                         // or cause errors in other passes\n                         _ => continue,\n                     }\n-                }\n+                },\n             }\n         }\n         match predicates.parent {\n@@ -93,24 +90,23 @@ fn check_ty(tcx: TyCtxt<'tcx>, ty: Ty<'tcx>, span: Span) -> McfResult {\n \n         match ty.kind() {\n             ty::Ref(_, _, hir::Mutability::Mut) => {\n-                    return Err((span, \"mutable references in const fn are unstable\".into()));\n-            }\n+                return Err((span, \"mutable references in const fn are unstable\".into()));\n+            },\n             ty::Opaque(..) => return Err((span, \"`impl Trait` in const fn is unstable\".into())),\n             ty::FnPtr(..) => {\n-                    return Err((span, \"function pointers in const fn are unstable\".into()));\n-            }\n+                return Err((span, \"function pointers in const fn are unstable\".into()));\n+            },\n             ty::Dynamic(preds, _) => {\n                 for pred in preds.iter() {\n                     match pred.skip_binder() {\n-                        ty::ExistentialPredicate::AutoTrait(_)\n-                        | ty::ExistentialPredicate::Projection(_) => {\n+                        ty::ExistentialPredicate::AutoTrait(_) | ty::ExistentialPredicate::Projection(_) => {\n                             return Err((\n                                 span,\n                                 \"trait bounds other than `Sized` \\\n                                  on const fn parameters are unstable\"\n                                     .into(),\n                             ));\n-                        }\n+                        },\n                         ty::ExistentialPredicate::Trait(trait_ref) => {\n                             if Some(trait_ref.def_id) != tcx.lang_items().sized_trait() {\n                                 return Err((\n@@ -120,55 +116,40 @@ fn check_ty(tcx: TyCtxt<'tcx>, ty: Ty<'tcx>, span: Span) -> McfResult {\n                                         .into(),\n                                 ));\n                             }\n-                        }\n+                        },\n                     }\n                 }\n-            }\n-            _ => {}\n+            },\n+            _ => {},\n         }\n     }\n     Ok(())\n }\n \n-fn check_rvalue(\n-    tcx: TyCtxt<'tcx>,\n-    body: &Body<'tcx>,\n-    def_id: DefId,\n-    rvalue: &Rvalue<'tcx>,\n-    span: Span,\n-) -> McfResult {\n+fn check_rvalue(tcx: TyCtxt<'tcx>, body: &Body<'tcx>, def_id: DefId, rvalue: &Rvalue<'tcx>, span: Span) -> McfResult {\n     match rvalue {\n-        Rvalue::ThreadLocalRef(_) => {\n-            Err((span, \"cannot access thread local storage in const fn\".into()))\n-        }\n-        Rvalue::Repeat(operand, _) | Rvalue::Use(operand) => {\n-            check_operand(tcx, operand, span, body)\n-        }\n-        Rvalue::Len(place)\n-        | Rvalue::Discriminant(place)\n-        | Rvalue::Ref(_, _, place)\n-        | Rvalue::AddressOf(_, place) => check_place(tcx, *place, span,  body),\n+        Rvalue::ThreadLocalRef(_) => Err((span, \"cannot access thread local storage in const fn\".into())),\n+        Rvalue::Repeat(operand, _) | Rvalue::Use(operand) => check_operand(tcx, operand, span, body),\n+        Rvalue::Len(place) | Rvalue::Discriminant(place) | Rvalue::Ref(_, _, place) | Rvalue::AddressOf(_, place) => {\n+            check_place(tcx, *place, span, body)\n+        },\n         Rvalue::Cast(CastKind::Misc, operand, cast_ty) => {\n             use rustc_middle::ty::cast::CastTy;\n             let cast_in = CastTy::from_ty(operand.ty(body, tcx)).expect(\"bad input type for cast\");\n             let cast_out = CastTy::from_ty(cast_ty).expect(\"bad output type for cast\");\n             match (cast_in, cast_out) {\n                 (CastTy::Ptr(_) | CastTy::FnPtr, CastTy::Int(_)) => {\n                     Err((span, \"casting pointers to ints is unstable in const fn\".into()))\n-                }\n+                },\n                 _ => check_operand(tcx, operand, span, body),\n             }\n-        }\n-        Rvalue::Cast(\n-            CastKind::Pointer(PointerCast::MutToConstPointer | PointerCast::ArrayToPointer),\n-            operand,\n-            _,\n-        ) => check_operand(tcx, operand, span, body),\n+        },\n+        Rvalue::Cast(CastKind::Pointer(PointerCast::MutToConstPointer | PointerCast::ArrayToPointer), operand, _) => {\n+            check_operand(tcx, operand, span, body)\n+        },\n         Rvalue::Cast(\n             CastKind::Pointer(\n-                PointerCast::UnsafeFnPointer\n-                | PointerCast::ClosureFnPointer(_)\n-                | PointerCast::ReifyFnPointer,\n+                PointerCast::UnsafeFnPointer | PointerCast::ClosureFnPointer(_) | PointerCast::ReifyFnPointer,\n             ),\n             _,\n             _,\n@@ -178,10 +159,7 @@ fn check_rvalue(\n                 deref_ty.ty\n             } else {\n                 // We cannot allow this for now.\n-                return Err((\n-                    span,\n-                    \"unsizing casts are only allowed for references right now\".into(),\n-                ));\n+                return Err((span, \"unsizing casts are only allowed for references right now\".into()));\n             };\n             let unsized_ty = tcx.struct_tail_erasing_lifetimes(pointee_ty, tcx.param_env(def_id));\n             if let ty::Slice(_) | ty::Str = unsized_ty.kind() {\n@@ -192,7 +170,7 @@ fn check_rvalue(\n                 // We just can't allow trait objects until we have figured out trait method calls.\n                 Err((span, \"unsizing casts are not allowed in const fn\".into()))\n             }\n-        }\n+        },\n         // binops are fine on integers\n         Rvalue::BinaryOp(_, lhs, rhs) | Rvalue::CheckedBinaryOp(_, lhs, rhs) => {\n             check_operand(tcx, lhs, span, body)?;\n@@ -201,53 +179,44 @@ fn check_rvalue(\n             if ty.is_integral() || ty.is_bool() || ty.is_char() {\n                 Ok(())\n             } else {\n-                Err((span, \"only int, `bool` and `char` operations are stable in const fn\".into()))\n+                Err((\n+                    span,\n+                    \"only int, `bool` and `char` operations are stable in const fn\".into(),\n+                ))\n             }\n-        }\n+        },\n         Rvalue::NullaryOp(NullOp::SizeOf, _) => Ok(()),\n-        Rvalue::NullaryOp(NullOp::Box, _) => {\n-            Err((span, \"heap allocations are not allowed in const fn\".into()))\n-        }\n+        Rvalue::NullaryOp(NullOp::Box, _) => Err((span, \"heap allocations are not allowed in const fn\".into())),\n         Rvalue::UnaryOp(_, operand) => {\n             let ty = operand.ty(body, tcx);\n             if ty.is_integral() || ty.is_bool() {\n                 check_operand(tcx, operand, span, body)\n             } else {\n                 Err((span, \"only int and `bool` operations are stable in const fn\".into()))\n             }\n-        }\n+        },\n         Rvalue::Aggregate(_, operands) => {\n             for operand in operands {\n                 check_operand(tcx, operand, span, body)?;\n             }\n             Ok(())\n-        }\n+        },\n     }\n }\n \n-fn check_statement(\n-    tcx: TyCtxt<'tcx>,\n-    body: &Body<'tcx>,\n-    def_id: DefId,\n-    statement: &Statement<'tcx>,\n-) -> McfResult {\n+fn check_statement(tcx: TyCtxt<'tcx>, body: &Body<'tcx>, def_id: DefId, statement: &Statement<'tcx>) -> McfResult {\n     let span = statement.source_info.span;\n     match &statement.kind {\n         StatementKind::Assign(box (place, rval)) => {\n-            check_place(tcx, *place, span,  body)?;\n+            check_place(tcx, *place, span, body)?;\n             check_rvalue(tcx, body, def_id, rval, span)\n-        }\n-\n-        StatementKind::FakeRead(_, place) => check_place(tcx, **place, span, body),\n+        },\n \n+        StatementKind::FakeRead(_, place) |\n         // just an assignment\n-        StatementKind::SetDiscriminant { place, .. } => {\n-            check_place(tcx, **place, span,  body)\n-        }\n+        StatementKind::SetDiscriminant { place, .. } => check_place(tcx, **place, span, body),\n \n-        StatementKind::LlvmInlineAsm { .. } => {\n-            Err((span, \"cannot use inline assembly in const fn\".into()))\n-        }\n+        StatementKind::LlvmInlineAsm { .. } => Err((span, \"cannot use inline assembly in const fn\".into())),\n \n         // These are all NOPs\n         StatementKind::StorageLive(_)\n@@ -259,12 +228,7 @@ fn check_statement(\n     }\n }\n \n-fn check_operand(\n-    tcx: TyCtxt<'tcx>,\n-    operand: &Operand<'tcx>,\n-    span: Span,\n-    body: &Body<'tcx>,\n-) -> McfResult {\n+fn check_operand(tcx: TyCtxt<'tcx>, operand: &Operand<'tcx>, span: Span, body: &Body<'tcx>) -> McfResult {\n     match operand {\n         Operand::Move(place) | Operand::Copy(place) => check_place(tcx, *place, span, body),\n         Operand::Constant(c) => match c.check_static_ptr(tcx) {\n@@ -274,41 +238,32 @@ fn check_operand(\n     }\n }\n \n-fn check_place(\n-    tcx: TyCtxt<'tcx>,\n-    place: Place<'tcx>,\n-    span: Span,\n-    body: &Body<'tcx>,\n-) -> McfResult {\n+fn check_place(tcx: TyCtxt<'tcx>, place: Place<'tcx>, span: Span, body: &Body<'tcx>) -> McfResult {\n     let mut cursor = place.projection.as_ref();\n-    while let &[ref proj_base @ .., elem] = cursor {\n+    while let [ref proj_base @ .., elem] = *cursor {\n         cursor = proj_base;\n         match elem {\n             ProjectionElem::Field(..) => {\n                 let base_ty = Place::ty_from(place.local, &proj_base, body, tcx).ty;\n                 if let Some(def) = base_ty.ty_adt_def() {\n                     // No union field accesses in `const fn`\n                     if def.is_union() {\n-                            return Err((span, \"accessing union fields is unstable\".into()));\n+                        return Err((span, \"accessing union fields is unstable\".into()));\n                     }\n                 }\n-            }\n+            },\n             ProjectionElem::ConstantIndex { .. }\n             | ProjectionElem::Downcast(..)\n             | ProjectionElem::Subslice { .. }\n             | ProjectionElem::Deref\n-            | ProjectionElem::Index(_) => {}\n+            | ProjectionElem::Index(_) => {},\n         }\n     }\n \n     Ok(())\n }\n \n-fn check_terminator(\n-    tcx: TyCtxt<'tcx>,\n-    body: &'a Body<'tcx>,\n-    terminator: &Terminator<'tcx>,\n-) -> McfResult {\n+fn check_terminator(tcx: TyCtxt<'tcx>, body: &'a Body<'tcx>, terminator: &Terminator<'tcx>) -> McfResult {\n     let span = terminator.source_info.span;\n     match &terminator.kind {\n         TerminatorKind::FalseEdge { .. }\n@@ -318,20 +273,23 @@ fn check_terminator(\n         | TerminatorKind::Resume\n         | TerminatorKind::Unreachable => Ok(()),\n \n-        TerminatorKind::Drop { place, .. } => check_place(tcx, *place, span,  body),\n+        TerminatorKind::Drop { place, .. } => check_place(tcx, *place, span, body),\n         TerminatorKind::DropAndReplace { place, value, .. } => {\n-            check_place(tcx, *place, span,  body)?;\n+            check_place(tcx, *place, span, body)?;\n             check_operand(tcx, value, span, body)\n-        }\n+        },\n \n-        TerminatorKind::SwitchInt { discr, switch_ty: _, values: _, targets: _ } => {\n-            check_operand(tcx, discr, span, body)\n-        }\n+        TerminatorKind::SwitchInt {\n+            discr,\n+            switch_ty: _,\n+            values: _,\n+            targets: _,\n+        } => check_operand(tcx, discr, span, body),\n \n         TerminatorKind::Abort => Err((span, \"abort is not stable in const fn\".into())),\n         TerminatorKind::GeneratorDrop | TerminatorKind::Yield { .. } => {\n             Err((span, \"const fn generators are unstable\".into()))\n-        }\n+        },\n \n         TerminatorKind::Call {\n             func,\n@@ -343,8 +301,7 @@ fn check_terminator(\n         } => {\n             let fn_ty = func.ty(body, tcx);\n             if let ty::FnDef(fn_def_id, _) = *fn_ty.kind() {\n-                if !rustc_mir::const_eval::is_min_const_fn(tcx, fn_def_id)\n-                {\n+                if !rustc_mir::const_eval::is_min_const_fn(tcx, fn_def_id) {\n                     return Err((\n                         span,\n                         format!(\n@@ -360,9 +317,7 @@ fn check_terminator(\n                 // within const fns. `transmute` is allowed in all other const contexts.\n                 // This won't really scale to more intrinsics or functions. Let's allow const\n                 // transmutes in const fn before we add more hacks to this.\n-                if tcx.fn_sig(fn_def_id).abi() == RustIntrinsic\n-                    && tcx.item_name(fn_def_id) == sym::transmute\n-                {\n+                if tcx.fn_sig(fn_def_id).abi() == RustIntrinsic && tcx.item_name(fn_def_id) == sym::transmute {\n                     return Err((\n                         span,\n                         \"can only call `transmute` from const items, not `const fn`\".into(),\n@@ -378,14 +333,16 @@ fn check_terminator(\n             } else {\n                 Err((span, \"can only call other const fns within const fn\".into()))\n             }\n-        }\n+        },\n \n-        TerminatorKind::Assert { cond, expected: _, msg: _, target: _, cleanup: _ } => {\n-            check_operand(tcx, cond, span, body)\n-        }\n+        TerminatorKind::Assert {\n+            cond,\n+            expected: _,\n+            msg: _,\n+            target: _,\n+            cleanup: _,\n+        } => check_operand(tcx, cond, span, body),\n \n-        TerminatorKind::InlineAsm { .. } => {\n-            Err((span, \"cannot use inline assembly in const fn\".into()))\n-        }\n+        TerminatorKind::InlineAsm { .. } => Err((span, \"cannot use inline assembly in const fn\".into())),\n     }\n }"}, {"sha": "d9d60fffcd7ae79238566aa251c46b8ade76eaf1", "filename": "src/tools/clippy/clippy_lints/src/write.rs", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_lints%2Fsrc%2Fwrite.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -235,8 +235,19 @@ impl EarlyLintPass for Write {\n     }\n \n     fn check_mac(&mut self, cx: &EarlyContext<'_>, mac: &MacCall) {\n+        fn is_build_script(cx: &EarlyContext<'_>) -> bool {\n+            // Cargo sets the crate name for build scripts to `build_script_build`\n+            cx.sess\n+                .opts\n+                .crate_name\n+                .as_ref()\n+                .map_or(false, |crate_name| crate_name == \"build_script_build\")\n+        }\n+\n         if mac.path == sym!(println) {\n-            span_lint(cx, PRINT_STDOUT, mac.span(), \"use of `println!`\");\n+            if !is_build_script(cx) {\n+                span_lint(cx, PRINT_STDOUT, mac.span(), \"use of `println!`\");\n+            }\n             if let (Some(fmt_str), _) = self.check_tts(cx, mac.args.inner_tokens(), false) {\n                 if fmt_str.symbol == Symbol::intern(\"\") {\n                     span_lint_and_sugg(\n@@ -251,7 +262,9 @@ impl EarlyLintPass for Write {\n                 }\n             }\n         } else if mac.path == sym!(print) {\n-            span_lint(cx, PRINT_STDOUT, mac.span(), \"use of `print!`\");\n+            if !is_build_script(cx) {\n+                span_lint(cx, PRINT_STDOUT, mac.span(), \"use of `print!`\");\n+            }\n             if let (Some(fmt_str), _) = self.check_tts(cx, mac.args.inner_tokens(), false) {\n                 if check_newlines(&fmt_str) {\n                     span_lint_and_then("}, {"sha": "3507168a3a96452abe013ab42094028e10d8db6a", "filename": "src/tools/clippy/clippy_workspace_tests/build.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_workspace_tests%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fclippy_workspace_tests%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fclippy_workspace_tests%2Fbuild.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,7 @@\n+#![deny(clippy::print_stdout)]\n+\n+fn main() {\n+    // Test for #6041\n+    println!(\"Hello\");\n+    print!(\"Hello\");\n+}"}, {"sha": "2869c3bf7d44bf501bc727bdeecd3802d9a799f6", "filename": "src/tools/clippy/doc/adding_lints.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fdoc%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fdoc%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fdoc%2Fadding_lints.md?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -189,7 +189,8 @@ declare_clippy_lint! {\n \n * The section of lines prefixed with `///` constitutes the lint documentation\n   section. This is the default documentation style and will be displayed\n-  [like this][example_lint_page].\n+  [like this][example_lint_page]. To render and open this documentation locally\n+  in a browser, run `cargo dev serve`.\n * `FOO_FUNCTIONS` is the name of our lint. Be sure to follow the\n   [lint naming guidelines][lint_naming] here when naming your lint.\n   In short, the name should state the thing that is being checked for and"}, {"sha": "38959e2331b40e866b0b1fd973b7ec164edf0f29", "filename": "src/tools/clippy/doc/basics.md", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fdoc%2Fbasics.md", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fdoc%2Fbasics.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fdoc%2Fbasics.md?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -13,6 +13,7 @@ Lints] or [Common Tools].\n   - [Setup](#setup)\n   - [Building and Testing](#building-and-testing)\n   - [`cargo dev`](#cargo-dev)\n+  - [PR](#pr)\n \n ## Get the Code\n \n@@ -110,3 +111,8 @@ cargo dev new_lint\n # (experimental) Setup Clippy to work with rust-analyzer\n cargo dev ra-setup\n ```\n+\n+## PR\n+\n+We follow a rustc no merge-commit policy.\n+See <https://rustc-dev-guide.rust-lang.org/contributing.html#opening-a-pr>."}, {"sha": "ce3d0efab3aa7d912569cf801988355ce79d35f5", "filename": "src/tools/clippy/src/lintlist/mod.rs", "status": "modified", "additions": 32, "deletions": 11, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fsrc%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Fsrc%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Fsrc%2Flintlist%2Fmod.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -110,7 +110,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n     },\n     Lint {\n         name: \"borrow_interior_mutable_const\",\n-        group: \"correctness\",\n+        group: \"style\",\n         desc: \"referencing `const` with interior mutability\",\n         deprecation: None,\n         module: \"non_copy_const\",\n@@ -334,7 +334,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n     },\n     Lint {\n         name: \"declare_interior_mutable_const\",\n-        group: \"correctness\",\n+        group: \"style\",\n         desc: \"declaring `const` with interior mutability\",\n         deprecation: None,\n         module: \"non_copy_const\",\n@@ -381,6 +381,13 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"derive\",\n     },\n+    Lint {\n+        name: \"disallowed_method\",\n+        group: \"nursery\",\n+        desc: \"use of a disallowed method call\",\n+        deprecation: None,\n+        module: \"disallowed_method\",\n+    },\n     Lint {\n         name: \"diverging_sub_expression\",\n         group: \"complexity\",\n@@ -885,6 +892,20 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"attrs\",\n     },\n+    Lint {\n+        name: \"inline_asm_x86_att_syntax\",\n+        group: \"restriction\",\n+        desc: \"prefer Intel x86 assembly syntax\",\n+        deprecation: None,\n+        module: \"asm_syntax\",\n+    },\n+    Lint {\n+        name: \"inline_asm_x86_intel_syntax\",\n+        group: \"restriction\",\n+        desc: \"prefer AT&T x86 assembly syntax\",\n+        deprecation: None,\n+        module: \"asm_syntax\",\n+    },\n     Lint {\n         name: \"inline_fn_without_body\",\n         group: \"correctness\",\n@@ -941,6 +962,13 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"types\",\n     },\n+    Lint {\n+        name: \"invisible_characters\",\n+        group: \"correctness\",\n+        desc: \"using an invisible character in a string literal, which is confusing\",\n+        deprecation: None,\n+        module: \"unicode\",\n+    },\n     Lint {\n         name: \"items_after_statements\",\n         group: \"pedantic\",\n@@ -1860,7 +1888,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n     },\n     Lint {\n         name: \"rc_buffer\",\n-        group: \"perf\",\n+        group: \"restriction\",\n         desc: \"shared ownership of a buffer type\",\n         deprecation: None,\n         module: \"types\",\n@@ -2133,7 +2161,7 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n     },\n     Lint {\n         name: \"string_lit_as_bytes\",\n-        group: \"style\",\n+        group: \"nursery\",\n         desc: \"calling `as_bytes` on a string literal instead of using a byte string literal\",\n         deprecation: None,\n         module: \"strings\",\n@@ -2782,13 +2810,6 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"misc\",\n     },\n-    Lint {\n-        name: \"zero_width_space\",\n-        group: \"correctness\",\n-        desc: \"using a zero-width space in a string literal, which is confusing\",\n-        deprecation: None,\n-        module: \"unicode\",\n-    },\n     Lint {\n         name: \"zst_offset\",\n         group: \"correctness\","}, {"sha": "a8f3e3145f64d723de26b9729b5375c21fd28a0b", "filename": "src/tools/clippy/tests/cargo/mod.rs", "status": "modified", "additions": 17, "deletions": 20, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fcargo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fcargo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fcargo%2Fmod.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,27 +1,24 @@\n-use lazy_static::lazy_static;\n use std::env;\n+use std::lazy::SyncLazy;\n use std::path::PathBuf;\n \n-lazy_static! {\n-    pub static ref CARGO_TARGET_DIR: PathBuf = {\n-        match env::var_os(\"CARGO_TARGET_DIR\") {\n-            Some(v) => v.into(),\n-            None => env::current_dir().unwrap().join(\"target\"),\n-        }\n-    };\n-    pub static ref TARGET_LIB: PathBuf = {\n-        if let Some(path) = option_env!(\"TARGET_LIBS\") {\n-            path.into()\n-        } else {\n-            let mut dir = CARGO_TARGET_DIR.clone();\n-            if let Some(target) = env::var_os(\"CARGO_BUILD_TARGET\") {\n-                dir.push(target);\n-            }\n-            dir.push(env!(\"PROFILE\"));\n-            dir\n+pub static CARGO_TARGET_DIR: SyncLazy<PathBuf> = SyncLazy::new(|| match env::var_os(\"CARGO_TARGET_DIR\") {\n+    Some(v) => v.into(),\n+    None => env::current_dir().unwrap().join(\"target\"),\n+});\n+\n+pub static TARGET_LIB: SyncLazy<PathBuf> = SyncLazy::new(|| {\n+    if let Some(path) = option_env!(\"TARGET_LIBS\") {\n+        path.into()\n+    } else {\n+        let mut dir = CARGO_TARGET_DIR.clone();\n+        if let Some(target) = env::var_os(\"CARGO_BUILD_TARGET\") {\n+            dir.push(target);\n         }\n-    };\n-}\n+        dir.push(env!(\"PROFILE\"));\n+        dir\n+    }\n+});\n \n #[must_use]\n pub fn is_rustc_test_suite() -> bool {"}, {"sha": "0e8f7683103d61296a99190414cc52ae4e3a5ec6", "filename": "src/tools/clippy/tests/compile-test.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fcompile-test.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,4 +1,5 @@\n #![feature(test)] // compiletest_rs requires this attribute\n+#![feature(once_cell)]\n \n use compiletest_rs as compiletest;\n use compiletest_rs::common::Mode as TestMode;\n@@ -71,7 +72,7 @@ fn default_config() -> compiletest::Config {\n     }\n \n     config.target_rustcflags = Some(format!(\n-        \"-L {0} -L {1} -Dwarnings -Zui-testing {2}\",\n+        \"--emit=metadata -L {0} -L {1} -Dwarnings -Zui-testing {2}\",\n         host_lib().join(\"deps\").display(),\n         cargo::TARGET_LIB.join(\"deps\").display(),\n         third_party_crates(),"}, {"sha": "48e0478f16992275309baa6505e88395c32b143c", "filename": "src/tools/clippy/tests/dogfood.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fdogfood.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,15 +1,14 @@\n // Dogfood cannot run on Windows\n #![cfg(not(windows))]\n+#![feature(once_cell)]\n \n-use lazy_static::lazy_static;\n+use std::lazy::SyncLazy;\n use std::path::PathBuf;\n use std::process::Command;\n \n mod cargo;\n \n-lazy_static! {\n-    static ref CLIPPY_PATH: PathBuf = cargo::TARGET_LIB.join(\"cargo-clippy\");\n-}\n+static CLIPPY_PATH: SyncLazy<PathBuf> = SyncLazy::new(|| cargo::TARGET_LIB.join(\"cargo-clippy\"));\n \n #[test]\n fn dogfood_clippy() {"}, {"sha": "a1f515e443dc57f5ec57d94eedadc227e1baf97b", "filename": "src/tools/clippy/tests/ui-toml/toml_disallowed_method/clippy.toml", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fclippy.toml", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fclippy.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fclippy.toml?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1 @@\n+disallowed-methods = [\"core::iter::traits::iterator::Iterator::sum\", \"regex::re_unicode::Regex::is_match\"]"}, {"sha": "3d3f0729abd85a82a9dcc5bf9541ba7a1fc29105", "filename": "src/tools/clippy/tests/ui-toml/toml_disallowed_method/conf_disallowed_method.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,13 @@\n+#![warn(clippy::disallowed_method)]\n+\n+extern crate regex;\n+use regex::Regex;\n+\n+fn main() {\n+    let a = vec![1, 2, 3, 4];\n+    let re = Regex::new(r\"ab.*c\").unwrap();\n+\n+    re.is_match(\"abc\");\n+\n+    a.iter().sum::<i32>();\n+}"}, {"sha": "ed91b5a6796d8a674ce82e8f54bb6e635a26ca79", "filename": "src/tools/clippy/tests/ui-toml/toml_disallowed_method/conf_disallowed_method.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_disallowed_method%2Fconf_disallowed_method.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,16 @@\n+error: use of a disallowed method `regex::re_unicode::Regex::is_match`\n+  --> $DIR/conf_disallowed_method.rs:10:5\n+   |\n+LL |     re.is_match(\"abc\");\n+   |     ^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::disallowed-method` implied by `-D warnings`\n+\n+error: use of a disallowed method `core::iter::traits::iterator::Iterator::sum`\n+  --> $DIR/conf_disallowed_method.rs:12:5\n+   |\n+LL |     a.iter().sum::<i32>();\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "103ec27e7d7559c1c9ac20a336c466fa7767f259", "filename": "src/tools/clippy/tests/ui-toml/toml_unknown_key/conf_unknown_key.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_unknown_key%2Fconf_unknown_key.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_unknown_key%2Fconf_unknown_key.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui-toml%2Ftoml_unknown_key%2Fconf_unknown_key.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,4 +1,4 @@\n-error: error reading Clippy's configuration file `$DIR/clippy.toml`: unknown field `foobar`, expected one of `blacklisted-names`, `cognitive-complexity-threshold`, `cyclomatic-complexity-threshold`, `doc-valid-idents`, `too-many-arguments-threshold`, `type-complexity-threshold`, `single-char-binding-names-threshold`, `too-large-for-stack`, `enum-variant-name-threshold`, `enum-variant-size-threshold`, `verbose-bit-mask-threshold`, `literal-representation-threshold`, `trivial-copy-size-limit`, `too-many-lines-threshold`, `array-size-threshold`, `vec-box-size-threshold`, `max-trait-bounds`, `max-struct-bools`, `max-fn-params-bools`, `warn-on-all-wildcard-imports`, `third-party` at line 5 column 1\n+error: error reading Clippy's configuration file `$DIR/clippy.toml`: unknown field `foobar`, expected one of `blacklisted-names`, `cognitive-complexity-threshold`, `cyclomatic-complexity-threshold`, `doc-valid-idents`, `too-many-arguments-threshold`, `type-complexity-threshold`, `single-char-binding-names-threshold`, `too-large-for-stack`, `enum-variant-name-threshold`, `enum-variant-size-threshold`, `verbose-bit-mask-threshold`, `literal-representation-threshold`, `trivial-copy-size-limit`, `too-many-lines-threshold`, `array-size-threshold`, `vec-box-size-threshold`, `max-trait-bounds`, `max-struct-bools`, `max-fn-params-bools`, `warn-on-all-wildcard-imports`, `disallowed-methods`, `third-party` at line 5 column 1\n \n error: aborting due to previous error\n "}, {"sha": "658cae397e1494b3f5ab0595a21d501229e5d9e7", "filename": "src/tools/clippy/tests/ui/asm_syntax.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,31 @@\n+#![feature(asm)]\n+// only-x86_64\n+\n+#[warn(clippy::inline_asm_x86_intel_syntax)]\n+mod warn_intel {\n+    pub(super) unsafe fn use_asm() {\n+        asm!(\"\");\n+        asm!(\"\", options());\n+        asm!(\"\", options(nostack));\n+        asm!(\"\", options(att_syntax));\n+        asm!(\"\", options(nostack, att_syntax));\n+    }\n+}\n+\n+#[warn(clippy::inline_asm_x86_att_syntax)]\n+mod warn_att {\n+    pub(super) unsafe fn use_asm() {\n+        asm!(\"\");\n+        asm!(\"\", options());\n+        asm!(\"\", options(nostack));\n+        asm!(\"\", options(att_syntax));\n+        asm!(\"\", options(nostack, att_syntax));\n+    }\n+}\n+\n+fn main() {\n+    unsafe {\n+        warn_att::use_asm();\n+        warn_intel::use_asm();\n+    }\n+}"}, {"sha": "27b51166eacb8321c52938fed00fddbbe14602a1", "filename": "src/tools/clippy/tests/ui/asm_syntax.stderr", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fasm_syntax.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,44 @@\n+error: Intel x86 assembly syntax used\n+  --> $DIR/asm_syntax.rs:7:9\n+   |\n+LL |         asm!(\"\");\n+   |         ^^^^^^^^^\n+   |\n+   = note: `-D clippy::inline-asm-x86-intel-syntax` implied by `-D warnings`\n+   = help: use AT&T x86 assembly syntax\n+\n+error: Intel x86 assembly syntax used\n+  --> $DIR/asm_syntax.rs:8:9\n+   |\n+LL |         asm!(\"\", options());\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use AT&T x86 assembly syntax\n+\n+error: Intel x86 assembly syntax used\n+  --> $DIR/asm_syntax.rs:9:9\n+   |\n+LL |         asm!(\"\", options(nostack));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use AT&T x86 assembly syntax\n+\n+error: AT&T x86 assembly syntax used\n+  --> $DIR/asm_syntax.rs:21:9\n+   |\n+LL |         asm!(\"\", options(att_syntax));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::inline-asm-x86-att-syntax` implied by `-D warnings`\n+   = help: use Intel x86 assembly syntax\n+\n+error: AT&T x86 assembly syntax used\n+  --> $DIR/asm_syntax.rs:22:9\n+   |\n+LL |         asm!(\"\", options(nostack, att_syntax));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use Intel x86 assembly syntax\n+\n+error: aborting due to 5 previous errors\n+"}, {"sha": "8df6e19421ec5707f9d09b186ccd380236e1a8b9", "filename": "src/tools/clippy/tests/ui/attrs.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,8 +1,5 @@\n #![warn(clippy::inline_always, clippy::deprecated_semver)]\n #![allow(clippy::assertions_on_constants)]\n-// Test that the whole restriction group is not enabled\n-#![warn(clippy::restriction)]\n-#![deny(clippy::restriction)]\n #![allow(clippy::missing_docs_in_private_items, clippy::panic, clippy::unreachable)]\n \n #[inline(always)]"}, {"sha": "df4e9e20b649c137467b2fcf2a5ced619d8e16cd", "filename": "src/tools/clippy/tests/ui/attrs.stderr", "status": "modified", "additions": 4, "deletions": 21, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fattrs.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,41 +1,24 @@\n error: you have declared `#[inline(always)]` on `test_attr_lint`. This is usually a bad idea\n-  --> $DIR/attrs.rs:8:1\n+  --> $DIR/attrs.rs:5:1\n    |\n LL | #[inline(always)]\n    | ^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::inline-always` implied by `-D warnings`\n \n error: the since field must contain a semver-compliant version\n-  --> $DIR/attrs.rs:28:14\n+  --> $DIR/attrs.rs:25:14\n    |\n LL | #[deprecated(since = \"forever\")]\n    |              ^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::deprecated-semver` implied by `-D warnings`\n \n error: the since field must contain a semver-compliant version\n-  --> $DIR/attrs.rs:31:14\n+  --> $DIR/attrs.rs:28:14\n    |\n LL | #[deprecated(since = \"1\")]\n    |              ^^^^^^^^^^^\n \n-error: restriction lints are not meant to be all enabled\n-  --> $DIR/attrs.rs:4:9\n-   |\n-LL | #![warn(clippy::restriction)]\n-   |         ^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: `-D clippy::blanket-clippy-restriction-lints` implied by `-D warnings`\n-   = help: try enabling only the lints you really need\n-\n-error: restriction lints are not meant to be all enabled\n-  --> $DIR/attrs.rs:5:9\n-   |\n-LL | #![deny(clippy::restriction)]\n-   |         ^^^^^^^^^^^^^^^^^^^\n-   |\n-   = help: try enabling only the lints you really need\n-\n-error: aborting due to 5 previous errors\n+error: aborting due to 3 previous errors\n "}, {"sha": "de670cdfc31f10b8de21317752752216674bf152", "filename": "src/tools/clippy/tests/ui/auxiliary/proc_macro_attr.rs", "status": "modified", "additions": 60, "deletions": 2, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_attr.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,7 +1,8 @@\n+// compile-flags: --emit=link\n // no-prefer-dynamic\n \n #![crate_type = \"proc-macro\"]\n-#![feature(repr128, proc_macro_hygiene, proc_macro_quote)]\n+#![feature(repr128, proc_macro_hygiene, proc_macro_quote, box_patterns)]\n #![allow(clippy::useless_conversion)]\n \n extern crate proc_macro;\n@@ -11,7 +12,11 @@ extern crate syn;\n use proc_macro::TokenStream;\n use quote::{quote, quote_spanned};\n use syn::parse_macro_input;\n-use syn::{parse_quote, ItemTrait, TraitItem};\n+use syn::spanned::Spanned;\n+use syn::token::Star;\n+use syn::{\n+    parse_quote, FnArg, ImplItem, ItemImpl, ItemTrait, Lifetime, Pat, PatIdent, PatType, Signature, TraitItem, Type,\n+};\n \n #[proc_macro_attribute]\n pub fn fake_async_trait(_args: TokenStream, input: TokenStream) -> TokenStream {\n@@ -35,3 +40,56 @@ pub fn fake_async_trait(_args: TokenStream, input: TokenStream) -> TokenStream {\n     }\n     TokenStream::from(quote!(#item))\n }\n+\n+#[proc_macro_attribute]\n+pub fn rename_my_lifetimes(_args: TokenStream, input: TokenStream) -> TokenStream {\n+    fn make_name(count: usize) -> String {\n+        format!(\"'life{}\", count)\n+    }\n+\n+    fn mut_receiver_of(sig: &mut Signature) -> Option<&mut FnArg> {\n+        let arg = sig.inputs.first_mut()?;\n+        if let FnArg::Typed(PatType { pat, .. }) = arg {\n+            if let Pat::Ident(PatIdent { ident, .. }) = &**pat {\n+                if ident == \"self\" {\n+                    return Some(arg);\n+                }\n+            }\n+        }\n+        None\n+    }\n+\n+    let mut elided = 0;\n+    let mut item = parse_macro_input!(input as ItemImpl);\n+\n+    // Look for methods having arbitrary self type taken by &mut ref\n+    for inner in &mut item.items {\n+        if let ImplItem::Method(method) = inner {\n+            if let Some(FnArg::Typed(pat_type)) = mut_receiver_of(&mut method.sig) {\n+                if let box Type::Reference(reference) = &mut pat_type.ty {\n+                    // Target only unnamed lifetimes\n+                    let name = match &reference.lifetime {\n+                        Some(lt) if lt.ident == \"_\" => make_name(elided),\n+                        None => make_name(elided),\n+                        _ => continue,\n+                    };\n+                    elided += 1;\n+\n+                    // HACK: Syn uses `Span` from the proc_macro2 crate, and does not seem to reexport it.\n+                    // In order to avoid adding the dependency, get a default span from a non-existent token.\n+                    // A default span is needed to mark the code as coming from expansion.\n+                    let span = Star::default().span();\n+\n+                    // Replace old lifetime with the named one\n+                    let lifetime = Lifetime::new(&name, span);\n+                    reference.lifetime = Some(parse_quote!(#lifetime));\n+\n+                    // Add lifetime to the generics of the method\n+                    method.sig.generics.params.push(parse_quote!(#lifetime));\n+                }\n+            }\n+        }\n+    }\n+\n+    TokenStream::from(quote!(#item))\n+}"}, {"sha": "3df8be6c23230eb6bc8d0d49cc877efbf97ad172", "filename": "src/tools/clippy/tests/ui/auxiliary/proc_macro_derive.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,3 +1,4 @@\n+// compile-flags: --emit=link\n // no-prefer-dynamic\n \n #![crate_type = \"proc-macro\"]"}, {"sha": "d055f17526b9b079db3a9b06271c3f04cfd665b6", "filename": "src/tools/clippy/tests/ui/blanket_clippy_restriction_lints.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,8 @@\n+#![warn(clippy::blanket_clippy_restriction_lints)]\n+\n+//! Test that the whole restriction group is not enabled\n+#![warn(clippy::restriction)]\n+#![deny(clippy::restriction)]\n+#![forbid(clippy::restriction)]\n+\n+fn main() {}"}, {"sha": "537557f8b0af017174192521b0a3f5794655aac6", "filename": "src/tools/clippy/tests/ui/blanket_clippy_restriction_lints.stderr", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fblanket_clippy_restriction_lints.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,27 @@\n+error: restriction lints are not meant to be all enabled\n+  --> $DIR/blanket_clippy_restriction_lints.rs:4:9\n+   |\n+LL | #![warn(clippy::restriction)]\n+   |         ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::blanket-clippy-restriction-lints` implied by `-D warnings`\n+   = help: try enabling only the lints you really need\n+\n+error: restriction lints are not meant to be all enabled\n+  --> $DIR/blanket_clippy_restriction_lints.rs:5:9\n+   |\n+LL | #![deny(clippy::restriction)]\n+   |         ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: try enabling only the lints you really need\n+\n+error: restriction lints are not meant to be all enabled\n+  --> $DIR/blanket_clippy_restriction_lints.rs:6:11\n+   |\n+LL | #![forbid(clippy::restriction)]\n+   |           ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: try enabling only the lints you really need\n+\n+error: aborting due to 3 previous errors\n+"}, {"sha": "948deba3ea6e3cb766a37360eba6816ed5ddfd0a", "filename": "src/tools/clippy/tests/ui/crashes/associated-constant-ice.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fassociated-constant-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fassociated-constant-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fassociated-constant-ice.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/1698\n \n pub trait Trait {"}, {"sha": "619d11cefc46d165531cd8f7292f3d59ec1eacc3", "filename": "src/tools/clippy/tests/ui/crashes/auxiliary/proc_macro_crash.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fauxiliary%2Fproc_macro_crash.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,3 +1,4 @@\n+// compile-flags: --emit=link\n // no-prefer-dynamic\n // ^ compiletest by default builds all aux files as dylibs, but we don't want that for proc-macro\n // crates. If we don't set this, compiletest will override the `crate_type` attribute below and"}, {"sha": "98588be9cf82939cf9e924ac63ad1e305dd0b90d", "filename": "src/tools/clippy/tests/ui/crashes/cc_seme.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fcc_seme.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fcc_seme.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fcc_seme.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #[allow(dead_code)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/478"}, {"sha": "dca32aa3b5615e25a2b5987fa56a02ef4bbc2e3d", "filename": "src/tools/clippy/tests/ui/crashes/enum-glob-import-crate.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fenum-glob-import-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fenum-glob-import-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fenum-glob-import-crate.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::all)]\n #![allow(unused_imports)]\n "}, {"sha": "b0a3d11bce4635a1d0745a07912566b986a62544", "filename": "src/tools/clippy/tests/ui/crashes/ice-1588.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1588.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1588.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1588.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(clippy::all)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/1588"}, {"sha": "81af88962a64d67b70e232c1010151c382f91944", "filename": "src/tools/clippy/tests/ui/crashes/ice-1782.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1782.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1782.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1782.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(dead_code, unused_variables)]\n \n /// Should not trigger an ICE in `SpanlessEq` / `consts::constant`"}, {"sha": "96a8fe6c24d5610f8a16df06f98df43020e8c4a2", "filename": "src/tools/clippy/tests/ui/crashes/ice-1969.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1969.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1969.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-1969.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(clippy::all)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/1969"}, {"sha": "45b3b1869dde614e98273f1ea6b890561eaa363f", "filename": "src/tools/clippy/tests/ui/crashes/ice-2499.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2499.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2499.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2499.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(dead_code, clippy::char_lit_as_u8, clippy::needless_bool)]\n \n /// Should not trigger an ICE in `SpanlessHash` / `consts::constant`"}, {"sha": "3f3986b6fc69294feb25ed0aed8076648b48d500", "filename": "src/tools/clippy/tests/ui/crashes/ice-2594.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2594.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2594.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2594.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(dead_code, unused_variables)]\n \n /// Should not trigger an ICE in `SpanlessHash` / `consts::constant`"}, {"sha": "56024abc8f58dff58cc2141a06522c6dc1a3a737", "filename": "src/tools/clippy/tests/ui/crashes/ice-2727.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2727.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2727.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2727.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/2727\n \n pub fn f(new: fn()) {"}, {"sha": "f1a229f3f4faf3a706ee0e721ad6c26b973b6135", "filename": "src/tools/clippy/tests/ui/crashes/ice-2760.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2760.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2760.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2760.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(\n     unused_variables,\n     clippy::blacklisted_name,"}, {"sha": "d44b0fae82001b3824b2a83c8d44e74eddacb0d8", "filename": "src/tools/clippy/tests/ui/crashes/ice-2774.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n use std::collections::HashSet;\n \n // See rust-lang/rust-clippy#2774."}, {"sha": "0c2d48f938fcbe516a7ab5c3b12893c36f78df02", "filename": "src/tools/clippy/tests/ui/crashes/ice-2774.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2774.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,10 @@\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/ice-2774.rs:15:1\n+   |\n+LL | pub fn add_barfoos_to_foos<'a>(bars: &HashSet<&'a Bar>) {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::needless-lifetimes` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "8326e3663b054a8319c5ce2df2fe2b544e29dd09", "filename": "src/tools/clippy/tests/ui/crashes/ice-2862.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2862.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2862.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2862.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/2862\n \n pub trait FooMap {"}, {"sha": "6b1ceb5056933df6ee6bc782f118fcad3c1a7e72", "filename": "src/tools/clippy/tests/ui/crashes/ice-2865.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2865.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2865.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-2865.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #[allow(dead_code)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/2865"}, {"sha": "fef4d7db84ddf0d23a5671dab0d0791b6bf90db5", "filename": "src/tools/clippy/tests/ui/crashes/ice-3151.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3151.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3151.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3151.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/2865\n \n #[derive(Clone)]"}, {"sha": "7d62e315da2fca1912c2c12a3651c4c8c59d1bac", "filename": "src/tools/clippy/tests/ui/crashes/ice-3462.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3462.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3462.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3462.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![warn(clippy::all)]\n #![allow(clippy::blacklisted_name)]\n #![allow(unused)]"}, {"sha": "1253ddcfaeb3bdb1c7f3daf2a4959064a81b2f89", "filename": "src/tools/clippy/tests/ui/crashes/ice-3741.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3741.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3741.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3741.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,4 @@\n // aux-build:proc_macro_crash.rs\n-// run-pass\n \n #![warn(clippy::suspicious_else_formatting)]\n "}, {"sha": "cdf018cbc88d8426193b2951d64734312df50dc2", "filename": "src/tools/clippy/tests/ui/crashes/ice-3747.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3747.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3747.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-3747.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/3747\n \n macro_rules! a {"}, {"sha": "2a4bc83f58a55508b19f0815ce3c3af4e5fadd86", "filename": "src/tools/clippy/tests/ui/crashes/ice-4727.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4727.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4727.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4727.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![warn(clippy::use_self)]\n \n #[path = \"auxiliary/ice-4727-aux.rs\"]"}, {"sha": "08b06961760ffea769f92b9f65a71b993a73699c", "filename": "src/tools/clippy/tests/ui/crashes/ice-4760.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4760.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4760.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-4760.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,4 +1,3 @@\n-// run-pass\n const COUNT: usize = 2;\n struct Thing;\n trait Dummy {}"}, {"sha": "0cbceedbd6bdb195dd421a919eef50131c20ccb6", "filename": "src/tools/clippy/tests/ui/crashes/ice-700.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-700.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-700.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice-700.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::all)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/700"}, {"sha": "30e4b11ec0bd450bcebc7c57465649e037f45e21", "filename": "src/tools/clippy/tests/ui/crashes/ice_exacte_size.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice_exacte_size.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice_exacte_size.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fice_exacte_size.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::all)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/1336"}, {"sha": "2f913292995eae24e5fe19af0f13aae65a5afb9e", "filename": "src/tools/clippy/tests/ui/crashes/if_same_then_else.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fif_same_then_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fif_same_then_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fif_same_then_else.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(clippy::comparison_chain)]\n #![deny(clippy::if_same_then_else)]\n "}, {"sha": "05696e3d7d56f65050b3ca486145e04ca7717f38", "filename": "src/tools/clippy/tests/ui/crashes/issue-825.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissue-825.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissue-825.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissue-825.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(warnings)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/825"}, {"sha": "bb238c81ebc05376a3a60ffe49442101d5202b00", "filename": "src/tools/clippy/tests/ui/crashes/issues_loop_mut_cond.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fissues_loop_mut_cond.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(dead_code)]\n \n /// Issue: https://github.com/rust-lang/rust-clippy/issues/2596"}, {"sha": "94c939665e6168a4e168e3f6cd3be91a3d0b7273", "filename": "src/tools/clippy/tests/ui/crashes/match_same_arms_const.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmatch_same_arms_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmatch_same_arms_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmatch_same_arms_const.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::match_same_arms)]\n \n /// Test for https://github.com/rust-lang/rust-clippy/issues/2427"}, {"sha": "a238e7896fc6b06357f24f358e03c01d28a4e648", "filename": "src/tools/clippy/tests/ui/crashes/mut_mut_macro.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmut_mut_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmut_mut_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fmut_mut_macro.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::mut_mut, clippy::zero_ptr, clippy::cmp_nan)]\n #![allow(dead_code)]\n "}, {"sha": "4f61c76828db8a00d57382a6f744ea49d856d781", "filename": "src/tools/clippy/tests/ui/crashes/needless_borrow_fp.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_borrow_fp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_borrow_fp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_borrow_fp.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #[deny(clippy::all)]\n #[derive(Debug)]\n pub enum Error {"}, {"sha": "676564b2445d506185bb5d9bafe68c15ab3538a9", "filename": "src/tools/clippy/tests/ui/crashes/needless_lifetimes_impl_trait.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![deny(clippy::needless_lifetimes)]\n #![allow(dead_code)]\n "}, {"sha": "d68bbe78802136ab5b103f95955729e34c0ffafb", "filename": "src/tools/clippy/tests/ui/crashes/needless_lifetimes_impl_trait.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fneedless_lifetimes_impl_trait.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,14 @@\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes_impl_trait.rs:15:5\n+   |\n+LL |     fn baz<'a>(&'a self) -> impl Foo + 'a {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/needless_lifetimes_impl_trait.rs:1:9\n+   |\n+LL | #![deny(clippy::needless_lifetimes)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}, {"sha": "c7468493380c8eb3f994279c32102242fd477fc3", "filename": "src/tools/clippy/tests/ui/crashes/procedural_macro.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fprocedural_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fprocedural_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fprocedural_macro.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #[macro_use]\n extern crate clippy_mini_macro_test;\n "}, {"sha": "a41bcb33b4460bf386f714057c377e50ea54ba14", "filename": "src/tools/clippy/tests/ui/crashes/regressions.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fregressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fregressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fregressions.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(clippy::blacklisted_name)]\n \n pub fn foo(bar: *const u8) {"}, {"sha": "8021ed4607dde798fea85e4031c9ae33a6710924", "filename": "src/tools/clippy/tests/ui/crashes/returns.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Freturns.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n /// Test for https://github.com/rust-lang/rust-clippy/issues/1346\n \n #[deny(warnings)]"}, {"sha": "1ba7ac082132ff46c8087f940666cda16f4705c5", "filename": "src/tools/clippy/tests/ui/crashes/single-match-else.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fsingle-match-else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fsingle-match-else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fsingle-match-else.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![warn(clippy::single_match_else)]\n \n //! Test for https://github.com/rust-lang/rust-clippy/issues/1588"}, {"sha": "60105a8213feb4f70e6395b983532972874087f0", "filename": "src/tools/clippy/tests/ui/crashes/trivial_bounds.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Ftrivial_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Ftrivial_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Ftrivial_bounds.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![feature(trivial_bounds)]\n #![allow(unused, trivial_bounds)]\n "}, {"sha": "6d2124c12fe98addb011233f1b737aa6077c341c", "filename": "src/tools/clippy/tests/ui/crashes/used_underscore_binding_macro.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fused_underscore_binding_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fused_underscore_binding_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fcrashes%2Fused_underscore_binding_macro.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,5 +1,3 @@\n-// run-pass\n-\n #![allow(clippy::useless_attribute)] //issue #2910\n \n #[macro_use]"}, {"sha": "07004489610d0a438fece6465493d77d90fe40d3", "filename": "src/tools/clippy/tests/ui/escape_analysis.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fescape_analysis.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fescape_analysis.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fescape_analysis.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -174,3 +174,11 @@ mod issue_3739 {\n         };\n     }\n }\n+\n+/// Issue #5542\n+///\n+/// This shouldn't warn for `boxed_local` as it is intended to called from non-Rust code.\n+pub extern \"C\" fn do_not_warn_me(_c_pointer: Box<String>) -> () {}\n+\n+#[rustfmt::skip] // Forces rustfmt to not add ABI\n+pub extern fn do_not_warn_me_no_abi(_c_pointer: Box<String>) -> () {}"}, {"sha": "81d8221bd13e01d01e15ed5b35bdbea61867c6c7", "filename": "src/tools/clippy/tests/ui/explicit_counter_loop.rs", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fexplicit_counter_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fexplicit_counter_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fexplicit_counter_loop.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -38,54 +38,54 @@ mod issue_1219 {\n         let text = \"banana\";\n         let mut count = 0;\n         for ch in text.chars() {\n+            println!(\"{}\", count);\n             if ch == 'a' {\n                 continue;\n             }\n             count += 1;\n-            println!(\"{}\", count);\n         }\n \n         // should not trigger the lint because the count is conditional\n         let text = \"banana\";\n         let mut count = 0;\n         for ch in text.chars() {\n+            println!(\"{}\", count);\n             if ch == 'a' {\n                 count += 1;\n             }\n-            println!(\"{}\", count);\n         }\n \n         // should trigger the lint because the count is not conditional\n         let text = \"banana\";\n         let mut count = 0;\n         for ch in text.chars() {\n+            println!(\"{}\", count);\n             count += 1;\n             if ch == 'a' {\n                 continue;\n             }\n-            println!(\"{}\", count);\n         }\n \n         // should trigger the lint because the count is not conditional\n         let text = \"banana\";\n         let mut count = 0;\n         for ch in text.chars() {\n+            println!(\"{}\", count);\n             count += 1;\n             for i in 0..2 {\n                 let _ = 123;\n             }\n-            println!(\"{}\", count);\n         }\n \n         // should not trigger the lint because the count is incremented multiple times\n         let text = \"banana\";\n         let mut count = 0;\n         for ch in text.chars() {\n+            println!(\"{}\", count);\n             count += 1;\n             for i in 0..2 {\n                 count += 1;\n             }\n-            println!(\"{}\", count);\n         }\n     }\n }\n@@ -96,30 +96,30 @@ mod issue_3308 {\n         let mut skips = 0;\n         let erasures = vec![];\n         for i in 0..10 {\n+            println!(\"{}\", skips);\n             while erasures.contains(&(i + skips)) {\n                 skips += 1;\n             }\n-            println!(\"{}\", skips);\n         }\n \n         // should not trigger the lint because the count is incremented multiple times\n         let mut skips = 0;\n         for i in 0..10 {\n+            println!(\"{}\", skips);\n             let mut j = 0;\n             while j < 5 {\n                 skips += 1;\n                 j += 1;\n             }\n-            println!(\"{}\", skips);\n         }\n \n         // should not trigger the lint because the count is incremented multiple times\n         let mut skips = 0;\n         for i in 0..10 {\n+            println!(\"{}\", skips);\n             for j in 0..5 {\n                 skips += 1;\n             }\n-            println!(\"{}\", skips);\n         }\n     }\n }\n@@ -145,3 +145,16 @@ mod issue_4732 {\n         let _closure = || println!(\"index: {}\", index);\n     }\n }\n+\n+mod issue_4677 {\n+    pub fn test() {\n+        let slice = &[1, 2, 3];\n+\n+        // should not trigger the lint because the count is used after incremented\n+        let mut count = 0;\n+        for _i in slice {\n+            count += 1;\n+            println!(\"{}\", count);\n+        }\n+    }\n+}"}, {"sha": "dd683e7f746a48ec16bc0acb3a0bc775f4a4ac22", "filename": "src/tools/clippy/tests/ui/inconsistent_digit_grouping.fixed", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.fixed?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -40,4 +40,8 @@ fn main() {\n     // Ignore literals in macros\n     let _ = mac1!();\n     let _ = mac2!();\n+\n+    // Issue #6096\n+    // Allow separating exponent with '_'\n+    let _ = 1.025_011_10_E0;\n }"}, {"sha": "d5d27c853c28d516667619eea792856394259ac3", "filename": "src/tools/clippy/tests/ui/inconsistent_digit_grouping.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Finconsistent_digit_grouping.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -40,4 +40,8 @@ fn main() {\n     // Ignore literals in macros\n     let _ = mac1!();\n     let _ = mac2!();\n+\n+    // Issue #6096\n+    // Allow separating exponent with '_'\n+    let _ = 1.025_011_10_E0;\n }"}, {"sha": "70cdb067d91380cb2b8866110d8c4160a683c1e4", "filename": "src/tools/clippy/tests/ui/mistyped_literal_suffix.fixed", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.fixed?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,6 +1,11 @@\n // run-rustfix\n \n-#![allow(dead_code, unused_variables, clippy::excessive_precision)]\n+#![allow(\n+    dead_code,\n+    unused_variables,\n+    clippy::excessive_precision,\n+    clippy::inconsistent_digit_grouping\n+)]\n \n fn main() {\n     let fail14 = 2_i32;\n@@ -12,13 +17,13 @@ fn main() {\n     let fail20 = 2_i8; //\n     let fail21 = 4_i16; //\n \n-    let fail24 = 12.34_f64;\n+    let ok24 = 12.34_64;\n     let fail25 = 1E2_f32;\n     let fail26 = 43E7_f64;\n     let fail27 = 243E17_f32;\n     #[allow(overflowing_literals)]\n     let fail28 = 241_251_235E723_f64;\n-    let fail29 = 42_279.911_f32;\n+    let ok29 = 42279.911_32;\n \n     let _ = 1.123_45E1_f32;\n }"}, {"sha": "729990af3998dbc9d36f0e40b3d8d93175da5009", "filename": "src/tools/clippy/tests/ui/mistyped_literal_suffix.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,6 +1,11 @@\n // run-rustfix\n \n-#![allow(dead_code, unused_variables, clippy::excessive_precision)]\n+#![allow(\n+    dead_code,\n+    unused_variables,\n+    clippy::excessive_precision,\n+    clippy::inconsistent_digit_grouping\n+)]\n \n fn main() {\n     let fail14 = 2_32;\n@@ -12,13 +17,13 @@ fn main() {\n     let fail20 = 2__8; //\n     let fail21 = 4___16; //\n \n-    let fail24 = 12.34_64;\n+    let ok24 = 12.34_64;\n     let fail25 = 1E2_32;\n     let fail26 = 43E7_64;\n     let fail27 = 243E17_32;\n     #[allow(overflowing_literals)]\n     let fail28 = 241251235E723_64;\n-    let fail29 = 42279.911_32;\n+    let ok29 = 42279.911_32;\n \n     let _ = 1.12345E1_32;\n }"}, {"sha": "b338b8aa6228d5757cc7c79212f6c48bd0b2f1b9", "filename": "src/tools/clippy/tests/ui/mistyped_literal_suffix.stderr", "status": "modified", "additions": 12, "deletions": 24, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fmistyped_literal_suffix.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,82 +1,70 @@\n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:6:18\n+  --> $DIR/mistyped_literal_suffix.rs:11:18\n    |\n LL |     let fail14 = 2_32;\n    |                  ^^^^ help: did you mean to write: `2_i32`\n    |\n    = note: `#[deny(clippy::mistyped_literal_suffixes)]` on by default\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:7:18\n+  --> $DIR/mistyped_literal_suffix.rs:12:18\n    |\n LL |     let fail15 = 4_64;\n    |                  ^^^^ help: did you mean to write: `4_i64`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:8:18\n+  --> $DIR/mistyped_literal_suffix.rs:13:18\n    |\n LL |     let fail16 = 7_8; //\n    |                  ^^^ help: did you mean to write: `7_i8`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:9:18\n+  --> $DIR/mistyped_literal_suffix.rs:14:18\n    |\n LL |     let fail17 = 23_16; //\n    |                  ^^^^^ help: did you mean to write: `23_i16`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:12:18\n+  --> $DIR/mistyped_literal_suffix.rs:17:18\n    |\n LL |     let fail20 = 2__8; //\n    |                  ^^^^ help: did you mean to write: `2_i8`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:13:18\n+  --> $DIR/mistyped_literal_suffix.rs:18:18\n    |\n LL |     let fail21 = 4___16; //\n    |                  ^^^^^^ help: did you mean to write: `4_i16`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:15:18\n-   |\n-LL |     let fail24 = 12.34_64;\n-   |                  ^^^^^^^^ help: did you mean to write: `12.34_f64`\n-\n-error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:16:18\n+  --> $DIR/mistyped_literal_suffix.rs:21:18\n    |\n LL |     let fail25 = 1E2_32;\n    |                  ^^^^^^ help: did you mean to write: `1E2_f32`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:17:18\n+  --> $DIR/mistyped_literal_suffix.rs:22:18\n    |\n LL |     let fail26 = 43E7_64;\n    |                  ^^^^^^^ help: did you mean to write: `43E7_f64`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:18:18\n+  --> $DIR/mistyped_literal_suffix.rs:23:18\n    |\n LL |     let fail27 = 243E17_32;\n    |                  ^^^^^^^^^ help: did you mean to write: `243E17_f32`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:20:18\n+  --> $DIR/mistyped_literal_suffix.rs:25:18\n    |\n LL |     let fail28 = 241251235E723_64;\n    |                  ^^^^^^^^^^^^^^^^ help: did you mean to write: `241_251_235E723_f64`\n \n error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:21:18\n-   |\n-LL |     let fail29 = 42279.911_32;\n-   |                  ^^^^^^^^^^^^ help: did you mean to write: `42_279.911_f32`\n-\n-error: mistyped literal suffix\n-  --> $DIR/mistyped_literal_suffix.rs:23:13\n+  --> $DIR/mistyped_literal_suffix.rs:28:13\n    |\n LL |     let _ = 1.12345E1_32;\n    |             ^^^^^^^^^^^^ help: did you mean to write: `1.123_45E1_f32`\n \n-error: aborting due to 13 previous errors\n+error: aborting due to 11 previous errors\n "}, {"sha": "a39d96109f17d8d03e38c4701cc4345d1e51ed30", "filename": "src/tools/clippy/tests/ui/needless_arbitrary_self_type_unfixable.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,45 @@\n+// aux-build:proc_macro_attr.rs\n+\n+#![warn(clippy::needless_arbitrary_self_type)]\n+\n+#[macro_use]\n+extern crate proc_macro_attr;\n+\n+mod issue_6089 {\n+    // Check that we don't lint if the `self` parameter comes from expansion\n+\n+    macro_rules! test_from_expansion {\n+        () => {\n+            trait T1 {\n+                fn test(self: &Self);\n+            }\n+\n+            struct S1 {}\n+\n+            impl T1 for S1 {\n+                fn test(self: &Self) {}\n+            }\n+        };\n+    }\n+\n+    test_from_expansion!();\n+\n+    // If only the lifetime name comes from expansion we will lint, but the suggestion will have\n+    // placeholders and will not be applied automatically, as we can't reliably know the original name.\n+    // This specific case happened with async_trait.\n+\n+    trait T2 {\n+        fn call_with_mut_self(&mut self);\n+    }\n+\n+    struct S2 {}\n+\n+    // The method's signature will be expanded to:\n+    //  fn call_with_mut_self<'life0>(self: &'life0 mut Self) {}\n+    #[rename_my_lifetimes]\n+    impl T2 for S2 {\n+        fn call_with_mut_self(self: &mut Self) {}\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "44a0e6ddeace63bcd54bc6f7284eff4a336ec4e9", "filename": "src/tools/clippy/tests/ui/needless_arbitrary_self_type_unfixable.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_arbitrary_self_type_unfixable.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,10 @@\n+error: the type of the `self` parameter does not need to be arbitrary\n+  --> $DIR/needless_arbitrary_self_type_unfixable.rs:41:31\n+   |\n+LL |         fn call_with_mut_self(self: &mut Self) {}\n+   |                               ^^^^^^^^^^^^^^^ help: consider to change this parameter to: `&'_ mut self`\n+   |\n+   = note: `-D clippy::needless-arbitrary-self-type` implied by `-D warnings`\n+\n+error: aborting due to previous error\n+"}, {"sha": "d482d466e44990df8f0fdcb19d4d4f6fbafc0bbf", "filename": "src/tools/clippy/tests/ui/needless_lifetimes.rs", "status": "modified", "additions": 98, "deletions": 0, "changes": 98, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -259,4 +259,102 @@ mod issue4291 {\n     }\n }\n \n+mod issue2944 {\n+    trait Foo {}\n+    struct Bar {}\n+    struct Baz<'a> {\n+        bar: &'a Bar,\n+    }\n+\n+    impl<'a> Foo for Baz<'a> {}\n+    impl Bar {\n+        fn baz<'a>(&'a self) -> impl Foo + 'a {\n+            Baz { bar: self }\n+        }\n+    }\n+}\n+\n+mod nested_elision_sites {\n+    // issue #issue2944\n+\n+    // closure trait bounds subject to nested elision\n+    // don't lint because they refer to outer lifetimes\n+    fn trait_fn<'a>(i: &'a i32) -> impl Fn() -> &'a i32 {\n+        move || i\n+    }\n+    fn trait_fn_mut<'a>(i: &'a i32) -> impl FnMut() -> &'a i32 {\n+        move || i\n+    }\n+    fn trait_fn_once<'a>(i: &'a i32) -> impl FnOnce() -> &'a i32 {\n+        move || i\n+    }\n+\n+    // don't lint\n+    fn impl_trait_in_input_position<'a>(f: impl Fn() -> &'a i32) -> &'a i32 {\n+        f()\n+    }\n+    fn impl_trait_in_output_position<'a>(i: &'a i32) -> impl Fn() -> &'a i32 {\n+        move || i\n+    }\n+    // lint\n+    fn impl_trait_elidable_nested_named_lifetimes<'a>(i: &'a i32, f: impl for<'b> Fn(&'b i32) -> &'b i32) -> &'a i32 {\n+        f(i)\n+    }\n+    fn impl_trait_elidable_nested_anonymous_lifetimes<'a>(i: &'a i32, f: impl Fn(&i32) -> &i32) -> &'a i32 {\n+        f(i)\n+    }\n+\n+    // don't lint\n+    fn generics_not_elidable<'a, T: Fn() -> &'a i32>(f: T) -> &'a i32 {\n+        f()\n+    }\n+    // lint\n+    fn generics_elidable<'a, T: Fn(&i32) -> &i32>(i: &'a i32, f: T) -> &'a i32 {\n+        f(i)\n+    }\n+\n+    // don't lint\n+    fn where_clause_not_elidable<'a, T>(f: T) -> &'a i32\n+    where\n+        T: Fn() -> &'a i32,\n+    {\n+        f()\n+    }\n+    // lint\n+    fn where_clause_elidadable<'a, T>(i: &'a i32, f: T) -> &'a i32\n+    where\n+        T: Fn(&i32) -> &i32,\n+    {\n+        f(i)\n+    }\n+\n+    // don't lint\n+    fn pointer_fn_in_input_position<'a>(f: fn(&'a i32) -> &'a i32, i: &'a i32) -> &'a i32 {\n+        f(i)\n+    }\n+    fn pointer_fn_in_output_position<'a>(_: &'a i32) -> fn(&'a i32) -> &'a i32 {\n+        |i| i\n+    }\n+    // lint\n+    fn pointer_fn_elidable<'a>(i: &'a i32, f: fn(&i32) -> &i32) -> &'a i32 {\n+        f(i)\n+    }\n+\n+    // don't lint\n+    fn nested_fn_pointer_1<'a>(_: &'a i32) -> fn(fn(&'a i32) -> &'a i32) -> i32 {\n+        |f| 42\n+    }\n+    fn nested_fn_pointer_2<'a>(_: &'a i32) -> impl Fn(fn(&'a i32)) {\n+        |f| ()\n+    }\n+\n+    // lint\n+    fn nested_fn_pointer_3<'a>(_: &'a i32) -> fn(fn(&i32) -> &i32) -> i32 {\n+        |f| 42\n+    }\n+    fn nested_fn_pointer_4<'a>(_: &'a i32) -> impl Fn(fn(&i32)) {\n+        |f| ()\n+    }\n+}\n+\n fn main() {}"}, {"sha": "c8a2e8b81c019a22908b931687725b5f8c3b15e1", "filename": "src/tools/clippy/tests/ui/needless_lifetimes.stderr", "status": "modified", "additions": 49, "deletions": 1, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_lifetimes.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -102,5 +102,53 @@ error: explicit lifetimes given in parameter types where they could be elided (o\n LL |         fn needless_lt<'a>(_x: &'a u8) {}\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 17 previous errors\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:271:9\n+   |\n+LL |         fn baz<'a>(&'a self) -> impl Foo + 'a {\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:300:5\n+   |\n+LL |     fn impl_trait_elidable_nested_named_lifetimes<'a>(i: &'a i32, f: impl for<'b> Fn(&'b i32) -> &'b i32) -> &'a i32 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:303:5\n+   |\n+LL |     fn impl_trait_elidable_nested_anonymous_lifetimes<'a>(i: &'a i32, f: impl Fn(&i32) -> &i32) -> &'a i32 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:312:5\n+   |\n+LL |     fn generics_elidable<'a, T: Fn(&i32) -> &i32>(i: &'a i32, f: T) -> &'a i32 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:324:5\n+   |\n+LL |     fn where_clause_elidadable<'a, T>(i: &'a i32, f: T) -> &'a i32\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:339:5\n+   |\n+LL |     fn pointer_fn_elidable<'a>(i: &'a i32, f: fn(&i32) -> &i32) -> &'a i32 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:352:5\n+   |\n+LL |     fn nested_fn_pointer_3<'a>(_: &'a i32) -> fn(fn(&i32) -> &i32) -> i32 {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: explicit lifetimes given in parameter types where they could be elided (or replaced with `'_` if needed by type declaration)\n+  --> $DIR/needless_lifetimes.rs:355:5\n+   |\n+LL |     fn nested_fn_pointer_4<'a>(_: &'a i32) -> impl Fn(fn(&i32)) {\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 25 previous errors\n "}, {"sha": "7633316e0f877b6a7e8a9776ab2cdd7429e6941d", "filename": "src/tools/clippy/tests/ui/needless_range_loop2.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_range_loop2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_range_loop2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fneedless_range_loop2.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -82,6 +82,20 @@ fn main() {\n     for i in 1..3 {\n         println!(\"{}\", arr[i]);\n     }\n+\n+    // Fix #5945\n+    let mut vec = vec![1, 2, 3, 4];\n+    for i in 0..vec.len() - 1 {\n+        vec[i] += 1;\n+    }\n+    let mut vec = vec![1, 2, 3, 4];\n+    for i in vec.len() - 3..vec.len() {\n+        vec[i] += 1;\n+    }\n+    let mut vec = vec![1, 2, 3, 4];\n+    for i in vec.len() - 3..vec.len() - 1 {\n+        vec[i] += 1;\n+    }\n }\n \n mod issue2277 {"}, {"sha": "2045ffdb5f09d38996c36d57ffc9c56967859d96", "filename": "src/tools/clippy/tests/ui/or_fun_call.fixed", "status": "modified", "additions": 6, "deletions": 19, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.fixed?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -58,6 +58,12 @@ fn or_fun_call() {\n     let without_default = Some(Foo);\n     without_default.unwrap_or_else(Foo::new);\n \n+    let mut map = HashMap::<u64, String>::new();\n+    map.entry(42).or_insert_with(String::new);\n+\n+    let mut btree = BTreeMap::<u64, String>::new();\n+    btree.entry(42).or_insert_with(String::new);\n+\n     let stringy = Some(String::from(\"\"));\n     let _ = stringy.unwrap_or_else(|| \"\".to_owned());\n \n@@ -110,23 +116,4 @@ fn f() -> Option<()> {\n     Some(())\n }\n \n-// Issue 5886 - const fn (with no arguments)\n-pub fn skip_const_fn_with_no_args() {\n-    const fn foo() -> Option<i32> {\n-        Some(42)\n-    }\n-    let _ = None.or(foo());\n-\n-    // See issue #5693.\n-    let mut map = std::collections::HashMap::new();\n-    map.insert(1, vec![1]);\n-    map.entry(1).or_insert(vec![]);\n-\n-    let mut map = HashMap::<u64, String>::new();\n-    map.entry(42).or_insert(String::new());\n-\n-    let mut btree = BTreeMap::<u64, String>::new();\n-    btree.entry(42).or_insert(String::new());\n-}\n-\n fn main() {}"}, {"sha": "522f31b72d01f4d94a590dd179a86c287d1c6db4", "filename": "src/tools/clippy/tests/ui/or_fun_call.rs", "status": "modified", "additions": 6, "deletions": 19, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -58,6 +58,12 @@ fn or_fun_call() {\n     let without_default = Some(Foo);\n     without_default.unwrap_or(Foo::new());\n \n+    let mut map = HashMap::<u64, String>::new();\n+    map.entry(42).or_insert(String::new());\n+\n+    let mut btree = BTreeMap::<u64, String>::new();\n+    btree.entry(42).or_insert(String::new());\n+\n     let stringy = Some(String::from(\"\"));\n     let _ = stringy.unwrap_or(\"\".to_owned());\n \n@@ -110,23 +116,4 @@ fn f() -> Option<()> {\n     Some(())\n }\n \n-// Issue 5886 - const fn (with no arguments)\n-pub fn skip_const_fn_with_no_args() {\n-    const fn foo() -> Option<i32> {\n-        Some(42)\n-    }\n-    let _ = None.or(foo());\n-\n-    // See issue #5693.\n-    let mut map = std::collections::HashMap::new();\n-    map.insert(1, vec![1]);\n-    map.entry(1).or_insert(vec![]);\n-\n-    let mut map = HashMap::<u64, String>::new();\n-    map.entry(42).or_insert(String::new());\n-\n-    let mut btree = BTreeMap::<u64, String>::new();\n-    btree.entry(42).or_insert(String::new());\n-}\n-\n fn main() {}"}, {"sha": "bc5978b538f16f69901c7d59576e840a95f95e23", "filename": "src/tools/clippy/tests/ui/or_fun_call.stderr", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2For_fun_call.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -60,23 +60,35 @@ error: use of `unwrap_or` followed by a function call\n LL |     without_default.unwrap_or(Foo::new());\n    |                     ^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(Foo::new)`\n \n+error: use of `or_insert` followed by a function call\n+  --> $DIR/or_fun_call.rs:62:19\n+   |\n+LL |     map.entry(42).or_insert(String::new());\n+   |                   ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(String::new)`\n+\n+error: use of `or_insert` followed by a function call\n+  --> $DIR/or_fun_call.rs:65:21\n+   |\n+LL |     btree.entry(42).or_insert(String::new());\n+   |                     ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_insert_with(String::new)`\n+\n error: use of `unwrap_or` followed by a function call\n-  --> $DIR/or_fun_call.rs:62:21\n+  --> $DIR/or_fun_call.rs:68:21\n    |\n LL |     let _ = stringy.unwrap_or(\"\".to_owned());\n    |                     ^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| \"\".to_owned())`\n \n error: use of `or` followed by a function call\n-  --> $DIR/or_fun_call.rs:87:35\n+  --> $DIR/or_fun_call.rs:93:35\n    |\n LL |     let _ = Some(\"a\".to_string()).or(Some(\"b\".to_string()));\n    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_else(|| Some(\"b\".to_string()))`\n \n error: use of `or` followed by a function call\n-  --> $DIR/or_fun_call.rs:91:10\n+  --> $DIR/or_fun_call.rs:97:10\n    |\n LL |         .or(Some(Bar(b, Duration::from_secs(2))));\n    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `or_else(|| Some(Bar(b, Duration::from_secs(2))))`\n \n-error: aborting due to 13 previous errors\n+error: aborting due to 15 previous errors\n "}, {"sha": "997ebef8a699226eb46fe04ba72c078534a17adf", "filename": "src/tools/clippy/tests/ui/print_stdout_build_script.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fprint_stdout_build_script.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fprint_stdout_build_script.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fprint_stdout_build_script.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -0,0 +1,12 @@\n+// compile-flags: --crate-name=build_script_build\n+\n+#![warn(clippy::print_stdout)]\n+\n+fn main() {\n+    // Fix #6041\n+    //\n+    // The `print_stdout` lint shouldn't emit in `build.rs`\n+    // as these methods are used for the build script.\n+    println!(\"Hello\");\n+    print!(\"Hello\");\n+}"}, {"sha": "f7f3b195ccc18f28143e4503dceab210a0d583e9", "filename": "src/tools/clippy/tests/ui/regex.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fregex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fregex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Fregex.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -71,6 +71,9 @@ fn trivial_regex() {\n     let non_trivial_ends_with = Regex::new(\"foo|bar\");\n     let non_trivial_binary = BRegex::new(\"foo|bar\");\n     let non_trivial_binary_builder = BRegexBuilder::new(\"foo|bar\");\n+\n+    // #6005: unicode classes in bytes::Regex\n+    let a_byte_of_unicode = BRegex::new(r\"\\p{C}\");\n }\n \n fn main() {"}, {"sha": "1f596c312fe395783208b6ab34ffd8fab27d8204", "filename": "src/tools/clippy/tests/ui/unicode.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,7 +1,11 @@\n-#[warn(clippy::zero_width_space)]\n+#[warn(clippy::invisible_characters)]\n fn zero() {\n     print!(\"Here >\u200b< is a ZWS, and \u200banother\");\n     print!(\"This\\u{200B}is\\u{200B}fine\");\n+    print!(\"Here >\u00ad< is a SHY, and \u00adanother\");\n+    print!(\"This\\u{ad}is\\u{ad}fine\");\n+    print!(\"Here >\u2060< is a WJ, and \u2060another\");\n+    print!(\"This\\u{2060}is\\u{2060}fine\");\n }\n \n #[warn(clippy::unicode_not_nfc)]"}, {"sha": "3fca463c620b522659335917cf78e0a2a5baeb24", "filename": "src/tools/clippy/tests/ui/unicode.stderr", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funicode.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -1,26 +1,38 @@\n-error: zero-width space detected\n+error: invisible character detected\n   --> $DIR/unicode.rs:3:12\n    |\n LL |     print!(\"Here >\u200b< is a ZWS, and \u200banother\");\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider replacing the string with: `\"Here >/u{200B}< is a ZWS, and /u{200B}another\"`\n    |\n-   = note: `-D clippy::zero-width-space` implied by `-D warnings`\n+   = note: `-D clippy::invisible-characters` implied by `-D warnings`\n+\n+error: invisible character detected\n+  --> $DIR/unicode.rs:5:12\n+   |\n+LL |     print!(\"Here >\u00ad< is a SHY, and \u00adanother\");\n+   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider replacing the string with: `\"Here >/u{AD}< is a SHY, and /u{AD}another\"`\n+\n+error: invisible character detected\n+  --> $DIR/unicode.rs:7:12\n+   |\n+LL |     print!(\"Here >\u2060< is a WJ, and \u2060another\");\n+   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider replacing the string with: `\"Here >/u{2060}< is a WJ, and /u{2060}another\"`\n \n error: non-NFC Unicode sequence detected\n-  --> $DIR/unicode.rs:9:12\n+  --> $DIR/unicode.rs:13:12\n    |\n LL |     print!(\"\u0300a\u0300h?\");\n    |            ^^^^^ help: consider replacing the string with: `\"\u0300\u00e0h?\"`\n    |\n    = note: `-D clippy::unicode-not-nfc` implied by `-D warnings`\n \n error: literal non-ASCII character detected\n-  --> $DIR/unicode.rs:15:12\n+  --> $DIR/unicode.rs:19:12\n    |\n LL |     print!(\"\u00dcben!\");\n    |            ^^^^^^^ help: consider replacing the string with: `\"/u{dc}ben!\"`\n    |\n    = note: `-D clippy::non-ascii-literal` implied by `-D warnings`\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 5 previous errors\n "}, {"sha": "b45b27d8f23b1a92bc006bc64104b97302beda7c", "filename": "src/tools/clippy/tests/ui/unnecessary_sort_by.fixed", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.fixed?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -13,23 +13,24 @@ fn unnecessary_sort_by() {\n     // Forward examples\n     vec.sort();\n     vec.sort_unstable();\n-    vec.sort_by_key(|&a| (a + 5).abs());\n-    vec.sort_unstable_by_key(|&a| id(-a));\n+    vec.sort_by_key(|a| (a + 5).abs());\n+    vec.sort_unstable_by_key(|a| id(-a));\n     // Reverse examples\n-    vec.sort_by_key(|&b| Reverse(b));\n-    vec.sort_by_key(|&b| Reverse((b + 5).abs()));\n-    vec.sort_unstable_by_key(|&b| Reverse(id(-b)));\n+    vec.sort_by(|a, b| b.cmp(a)); // not linted to avoid suggesting `Reverse(b)` which would borrow\n+    vec.sort_by_key(|b| Reverse((b + 5).abs()));\n+    vec.sort_unstable_by_key(|b| Reverse(id(-b)));\n     // Negative examples (shouldn't be changed)\n     let c = &7;\n     vec.sort_by(|a, b| (b - a).cmp(&(a - b)));\n     vec.sort_by(|_, b| b.cmp(&5));\n     vec.sort_by(|_, b| b.cmp(c));\n     vec.sort_unstable_by(|a, _| a.cmp(c));\n \n-    // Ignore vectors of references\n+    // Vectors of references are fine as long as the resulting key does not borrow\n     let mut vec: Vec<&&&isize> = vec![&&&3, &&&6, &&&1, &&&2, &&&5];\n-    vec.sort_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n-    vec.sort_unstable_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n+    vec.sort_by_key(|a| (***a).abs());\n+    vec.sort_unstable_by_key(|a| (***a).abs());\n+    // `Reverse(b)` would borrow in the following cases, don't lint\n     vec.sort_by(|a, b| b.cmp(a));\n     vec.sort_unstable_by(|a, b| b.cmp(a));\n }\n@@ -68,10 +69,9 @@ mod issue_5754 {\n     }\n }\n \n-// `Vec::sort_by_key` closure parameter is `F: FnMut(&T) -> K`\n-// The suggestion is destructuring T and we know T is not a reference, so test that non-Copy T are\n-// not linted.\n+// The closure parameter is not dereferenced anymore, so non-Copy types can be linted\n mod issue_6001 {\n+    use super::*;\n     struct Test(String);\n \n     impl Test {\n@@ -85,11 +85,11 @@ mod issue_6001 {\n         let mut args: Vec<Test> = vec![];\n \n         // Forward\n-        args.sort_by(|a, b| a.name().cmp(&b.name()));\n-        args.sort_unstable_by(|a, b| a.name().cmp(&b.name()));\n+        args.sort_by_key(|a| a.name());\n+        args.sort_unstable_by_key(|a| a.name());\n         // Reverse\n-        args.sort_by(|a, b| b.name().cmp(&a.name()));\n-        args.sort_unstable_by(|a, b| b.name().cmp(&a.name()));\n+        args.sort_by_key(|b| Reverse(b.name()));\n+        args.sort_unstable_by_key(|b| Reverse(b.name()));\n     }\n }\n "}, {"sha": "be2abe7f7014d785b59ccae8875d550829a3ca23", "filename": "src/tools/clippy/tests/ui/unnecessary_sort_by.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.rs?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -16,7 +16,7 @@ fn unnecessary_sort_by() {\n     vec.sort_by(|a, b| (a + 5).abs().cmp(&(b + 5).abs()));\n     vec.sort_unstable_by(|a, b| id(-a).cmp(&id(-b)));\n     // Reverse examples\n-    vec.sort_by(|a, b| b.cmp(a));\n+    vec.sort_by(|a, b| b.cmp(a)); // not linted to avoid suggesting `Reverse(b)` which would borrow\n     vec.sort_by(|a, b| (b + 5).abs().cmp(&(a + 5).abs()));\n     vec.sort_unstable_by(|a, b| id(-b).cmp(&id(-a)));\n     // Negative examples (shouldn't be changed)\n@@ -26,10 +26,11 @@ fn unnecessary_sort_by() {\n     vec.sort_by(|_, b| b.cmp(c));\n     vec.sort_unstable_by(|a, _| a.cmp(c));\n \n-    // Ignore vectors of references\n+    // Vectors of references are fine as long as the resulting key does not borrow\n     let mut vec: Vec<&&&isize> = vec![&&&3, &&&6, &&&1, &&&2, &&&5];\n     vec.sort_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n     vec.sort_unstable_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n+    // `Reverse(b)` would borrow in the following cases, don't lint\n     vec.sort_by(|a, b| b.cmp(a));\n     vec.sort_unstable_by(|a, b| b.cmp(a));\n }\n@@ -68,10 +69,9 @@ mod issue_5754 {\n     }\n }\n \n-// `Vec::sort_by_key` closure parameter is `F: FnMut(&T) -> K`\n-// The suggestion is destructuring T and we know T is not a reference, so test that non-Copy T are\n-// not linted.\n+// The closure parameter is not dereferenced anymore, so non-Copy types can be linted\n mod issue_6001 {\n+    use super::*;\n     struct Test(String);\n \n     impl Test {"}, {"sha": "50607933e18f7b5ed5dc012a362eb03f9d910240", "filename": "src/tools/clippy/tests/ui/unnecessary_sort_by.stderr", "status": "modified", "additions": 41, "deletions": 11, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy%2Ftests%2Fui%2Funnecessary_sort_by.stderr?ref=6b8d25ecda4cbc7266bd1499466dfc5737c9fbdf", "patch": "@@ -16,31 +16,61 @@ error: use Vec::sort_by_key here instead\n   --> $DIR/unnecessary_sort_by.rs:16:5\n    |\n LL |     vec.sort_by(|a, b| (a + 5).abs().cmp(&(b + 5).abs()));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|&a| (a + 5).abs())`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|a| (a + 5).abs())`\n \n error: use Vec::sort_by_key here instead\n   --> $DIR/unnecessary_sort_by.rs:17:5\n    |\n LL |     vec.sort_unstable_by(|a, b| id(-a).cmp(&id(-b)));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_unstable_by_key(|&a| id(-a))`\n-\n-error: use Vec::sort_by_key here instead\n-  --> $DIR/unnecessary_sort_by.rs:19:5\n-   |\n-LL |     vec.sort_by(|a, b| b.cmp(a));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|&b| Reverse(b))`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_unstable_by_key(|a| id(-a))`\n \n error: use Vec::sort_by_key here instead\n   --> $DIR/unnecessary_sort_by.rs:20:5\n    |\n LL |     vec.sort_by(|a, b| (b + 5).abs().cmp(&(a + 5).abs()));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|&b| Reverse((b + 5).abs()))`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|b| Reverse((b + 5).abs()))`\n \n error: use Vec::sort_by_key here instead\n   --> $DIR/unnecessary_sort_by.rs:21:5\n    |\n LL |     vec.sort_unstable_by(|a, b| id(-b).cmp(&id(-a)));\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_unstable_by_key(|&b| Reverse(id(-b)))`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_unstable_by_key(|b| Reverse(id(-b)))`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:31:5\n+   |\n+LL |     vec.sort_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_by_key(|a| (***a).abs())`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:32:5\n+   |\n+LL |     vec.sort_unstable_by(|a, b| (***a).abs().cmp(&(***b).abs()));\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `vec.sort_unstable_by_key(|a| (***a).abs())`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:88:9\n+   |\n+LL |         args.sort_by(|a, b| a.name().cmp(&b.name()));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `args.sort_by_key(|a| a.name())`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:89:9\n+   |\n+LL |         args.sort_unstable_by(|a, b| a.name().cmp(&b.name()));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `args.sort_unstable_by_key(|a| a.name())`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:91:9\n+   |\n+LL |         args.sort_by(|a, b| b.name().cmp(&a.name()));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `args.sort_by_key(|b| Reverse(b.name()))`\n+\n+error: use Vec::sort_by_key here instead\n+  --> $DIR/unnecessary_sort_by.rs:92:9\n+   |\n+LL |         args.sort_unstable_by(|a, b| b.name().cmp(&a.name()));\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `args.sort_unstable_by_key(|b| Reverse(b.name()))`\n \n-error: aborting due to 7 previous errors\n+error: aborting due to 12 previous errors\n "}]}