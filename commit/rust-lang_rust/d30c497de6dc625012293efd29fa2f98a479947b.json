{"sha": "d30c497de6dc625012293efd29fa2f98a479947b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzMGM0OTdkZTZkYzYyNTAxMjI5M2VmZDI5ZmEyZjk4YTQ3OTk0N2I=", "commit": {"author": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2021-01-23T03:55:41Z"}, "committer": {"name": "kadmin", "email": "julianknodt@gmail.com", "date": "2021-03-09T16:54:14Z"}, "message": "Build StKind::CopyOverlapping\n\nThis replaces where it was previously being constructed in intrinsics, with direct construction\nof the Statement.", "tree": {"sha": "648bdbb588d91b328eea12e10e27a129cb8f2160", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/648bdbb588d91b328eea12e10e27a129cb8f2160"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d30c497de6dc625012293efd29fa2f98a479947b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d30c497de6dc625012293efd29fa2f98a479947b", "html_url": "https://github.com/rust-lang/rust/commit/d30c497de6dc625012293efd29fa2f98a479947b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d30c497de6dc625012293efd29fa2f98a479947b/comments", "author": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JulianKnodt", "id": 7675847, "node_id": "MDQ6VXNlcjc2NzU4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/7675847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JulianKnodt", "html_url": "https://github.com/JulianKnodt", "followers_url": "https://api.github.com/users/JulianKnodt/followers", "following_url": "https://api.github.com/users/JulianKnodt/following{/other_user}", "gists_url": "https://api.github.com/users/JulianKnodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/JulianKnodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JulianKnodt/subscriptions", "organizations_url": "https://api.github.com/users/JulianKnodt/orgs", "repos_url": "https://api.github.com/users/JulianKnodt/repos", "events_url": "https://api.github.com/users/JulianKnodt/events{/privacy}", "received_events_url": "https://api.github.com/users/JulianKnodt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83e6251f21984764cac52d5d50408437dc000e57", "url": "https://api.github.com/repos/rust-lang/rust/commits/83e6251f21984764cac52d5d50408437dc000e57", "html_url": "https://github.com/rust-lang/rust/commit/83e6251f21984764cac52d5d50408437dc000e57"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "8b5ae9e0541ade6210bfd3436f2c9b9228085328", "filename": "src/base.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d30c497de6dc625012293efd29fa2f98a479947b/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d30c497de6dc625012293efd29fa2f98a479947b/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=d30c497de6dc625012293efd29fa2f98a479947b", "patch": "@@ -837,10 +837,21 @@ fn codegen_stmt<'tcx>(\n           dst,\n           count,\n         }) => {\n-            let dst = codegen_operand(fx, dst).load_scalar(fx);\n+            let dst = codegen_operand(fx, dst);\n+            let pointee = dst\n+              .layout()\n+              .pointee_info_at(fx, rustc_target::abi::Size::ZERO)\n+              .expect(\"Expected pointer\");\n+            let dst = dst.load_scalar(fx);\n             let src = codegen_operand(fx, src).load_scalar(fx);\n             let count = codegen_operand(fx, count).load_scalar(fx);\n-            fx.bcx.call_memcpy(fx.cx.module.target_config(), dst, src, count);\n+            let elem_size: u64 = pointee.size.bytes();\n+            let bytes = if elem_size != 1 {\n+               fx.bcx.ins().imul_imm(count, elem_size as i64)\n+            } else {\n+               count\n+            };\n+            fx.bcx.call_memcpy(fx.cx.module.target_config(), dst, src, bytes);\n         }\n     }\n }"}]}