{"sha": "229d7943d8471eb114f961ab419c318736772da4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyOWQ3OTQzZDg0NzFlYjExNGY5NjFhYjQxOWMzMTg3MzY3NzJkYTQ=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-08-18T18:44:24Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-08-18T18:44:24Z"}, "message": "switch to new codegen", "tree": {"sha": "183655c53e09b82d308b89fecccea7bbf725a344", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/183655c53e09b82d308b89fecccea7bbf725a344"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/229d7943d8471eb114f961ab419c318736772da4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/229d7943d8471eb114f961ab419c318736772da4", "html_url": "https://github.com/rust-lang/rust/commit/229d7943d8471eb114f961ab419c318736772da4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/229d7943d8471eb114f961ab419c318736772da4/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "839d9cce89adcae23dfd108acf231dca00724f08", "url": "https://api.github.com/repos/rust-lang/rust/commits/839d9cce89adcae23dfd108acf231dca00724f08", "html_url": "https://github.com/rust-lang/rust/commit/839d9cce89adcae23dfd108acf231dca00724f08"}], "stats": {"total": 46, "additions": 32, "deletions": 14}, "files": [{"sha": "4f8be32124f8861fd8394fadc9819880904d1024", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/229d7943d8471eb114f961ab419c318736772da4/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/229d7943d8471eb114f961ab419c318736772da4/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=229d7943d8471eb114f961ab419c318736772da4", "patch": "@@ -1364,6 +1364,7 @@ dependencies = [\n  \"clap 2.33.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"ron 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"teraron 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"walkdir 2.2.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -1614,6 +1615,16 @@ dependencies = [\n  \"serde 1.0.99 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"ron\"\n+version = \"0.5.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"base64 0.10.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"bitflags 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"serde 1.0.99 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"rowan\"\n version = \"0.6.2\"\n@@ -2321,6 +2332,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum relative-path 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0e7790c7f1cc73d831d28dc5a7deb316a006e7848e6a7f467cdb10a0a9e0fb1c\"\n \"checksum remove_dir_all 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4a83fa3702a688b9359eccba92d153ac33fd2e8462f9e0e3fdf155239ea7792e\"\n \"checksum ron 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"17f52a24414403f81528b67488cf8edc4eda977d3af1646bb6b106a600ead78f\"\n+\"checksum ron 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2ece421e0c4129b90e4a35b6f625e472e96c552136f5093a2f4fa2bbb75a62d5\"\n \"checksum rowan 0.6.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dc2b79612dedc9004083a61448eb669d336d56690aab29fbd7249e8c8ab41d8c\"\n \"checksum rustc-demangle 0.1.16 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4c691c0e608126e00913e33f0ccf3727d5fc84573623b8d65b2df340b5201783\"\n \"checksum rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7540fc8b0c49f096ee9c961cda096467dce8084bec6bdca2fc83895fd9b28cb8\""}, {"sha": "02bab8f52dd8752b728f42565aec45c0c7c38948", "filename": "crates/ra_tools/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2FCargo.toml?ref=229d7943d8471eb114f961ab419c318736772da4", "patch": "@@ -11,3 +11,4 @@ walkdir = \"2.1.3\"\n itertools = \"0.8.0\"\n clap = \"2.32.0\"\n quote = \"1.0.2\"\n+ron = \"0.5.1\""}, {"sha": "405fb623cc69c649a49df0e41ff9386660128b9e", "filename": "crates/ra_tools/src/codegen.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2Fsrc%2Fcodegen.rs", "raw_url": "https://github.com/rust-lang/rust/raw/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2Fsrc%2Fcodegen.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2Fsrc%2Fcodegen.rs?ref=229d7943d8471eb114f961ab419c318736772da4", "patch": "@@ -1,7 +1,21 @@\n-use std::path::Path;\n+use std::{fs, path::Path};\n \n-use crate::{Mode, Result};\n+use ron;\n \n-pub fn generate_ast(grammar_src: &Path, dst: &Path, mode: Mode) -> Result<()> {\n+use crate::{project_root, Mode, Result, AST, GRAMMAR};\n+\n+pub fn generate(mode: Mode) -> Result<()> {\n+    let grammar = project_root().join(GRAMMAR);\n+    // let syntax_kinds = project_root().join(SYNTAX_KINDS);\n+    let ast = project_root().join(AST);\n+    generate_ast(&grammar, &ast, mode)\n+}\n+\n+fn generate_ast(grammar_src: &Path, dst: &Path, mode: Mode) -> Result<()> {\n+    let src: ron::Value = {\n+        let text = fs::read_to_string(grammar_src)?;\n+        ron::de::from_str(&text)?\n+    };\n+    eprintln!(\"{:?}\", src);\n     Ok(())\n }"}, {"sha": "de8c472d1537bee2343d2d462d99d7f419c73e90", "filename": "crates/ra_tools/src/lib.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/229d7943d8471eb114f961ab419c318736772da4/crates%2Fra_tools%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2Fsrc%2Flib.rs?ref=229d7943d8471eb114f961ab419c318736772da4", "patch": "@@ -13,7 +13,7 @@ use itertools::Itertools;\n \n pub use teraron::{Mode, Overwrite, Verify};\n \n-pub use self::codegen::generate_ast;\n+pub use self::codegen::generate;\n \n pub type Result<T> = std::result::Result<T, Box<dyn Error>>;\n \n@@ -23,7 +23,7 @@ const OK_INLINE_TESTS_DIR: &str = \"crates/ra_syntax/test_data/parser/inline/ok\";\n const ERR_INLINE_TESTS_DIR: &str = \"crates/ra_syntax/test_data/parser/inline/err\";\n \n pub const SYNTAX_KINDS: &str = \"crates/ra_parser/src/syntax_kind/generated.rs.tera\";\n-pub const AST: &str = \"crates/ra_syntax/src/ast/generated.rs.tera\";\n+pub const AST: &str = \"crates/ra_syntax/src/ast/generated.rs\";\n const TOOLCHAIN: &str = \"stable\";\n \n #[derive(Debug)]\n@@ -70,15 +70,6 @@ pub fn collect_tests(s: &str) -> Vec<(usize, Test)> {\n     res\n }\n \n-pub fn generate(mode: Mode) -> Result<()> {\n-    let grammar = project_root().join(GRAMMAR);\n-    let syntax_kinds = project_root().join(SYNTAX_KINDS);\n-    let ast = project_root().join(AST);\n-    teraron::generate(&syntax_kinds, &grammar, mode)?;\n-    teraron::generate(&ast, &grammar, mode)?;\n-    Ok(())\n-}\n-\n pub fn project_root() -> PathBuf {\n     Path::new(&env!(\"CARGO_MANIFEST_DIR\")).ancestors().nth(2).unwrap().to_path_buf()\n }"}]}