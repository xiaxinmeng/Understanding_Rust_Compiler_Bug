{"sha": "9723c79af7baa9f778566058aa1d50a8e2711b96", "node_id": "C_kwDOAAsO6NoAKDk3MjNjNzlhZjdiYWE5Zjc3ODU2NjA1OGFhMWQ1MGE4ZTI3MTFiOTY", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-11-20T19:32:44Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-11-20T19:32:44Z"}, "message": "Fix running rustc tests", "tree": {"sha": "163609738142d8db542a360482e096f51c0fd745", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/163609738142d8db542a360482e096f51c0fd745"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9723c79af7baa9f778566058aa1d50a8e2711b96", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9723c79af7baa9f778566058aa1d50a8e2711b96", "html_url": "https://github.com/rust-lang/rust/commit/9723c79af7baa9f778566058aa1d50a8e2711b96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9723c79af7baa9f778566058aa1d50a8e2711b96/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be1006be507dc1f5f25e8260267ead842d53df40", "url": "https://api.github.com/repos/rust-lang/rust/commits/be1006be507dc1f5f25e8260267ead842d53df40", "html_url": "https://github.com/rust-lang/rust/commit/be1006be507dc1f5f25e8260267ead842d53df40"}], "stats": {"total": 20, "additions": 2, "deletions": 18}, "files": [{"sha": "5a73cb0e2c22d63b4cc87d4a6a01d5e12bcd1312", "filename": "scripts/setup_rust_fork.sh", "status": "modified", "additions": 2, "deletions": 18, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/9723c79af7baa9f778566058aa1d50a8e2711b96/scripts%2Fsetup_rust_fork.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9723c79af7baa9f778566058aa1d50a8e2711b96/scripts%2Fsetup_rust_fork.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Fsetup_rust_fork.sh?ref=9723c79af7baa9f778566058aa1d50a8e2711b96", "patch": "@@ -27,24 +27,6 @@ index d95b5b7f17f..00b6f0e3635 100644\n  [dev-dependencies]\n  rand = \"0.7\"\n  rand_xorshift = \"0.2\"\n-diff --git a/src/tools/compiletest/src/runtest.rs b/src/tools/compiletest/src/runtest.rs\n-index 8431aa7b818..a3ff7e68ce5 100644\n---- a/src/tools/compiletest/src/runtest.rs\n-+++ b/src/tools/compiletest/src/runtest.rs\n-@@ -3489,12 +3489,7 @@ fn normalize_output(&self, output: &str, custom_rules: &[(String, String)]) -> S\n-         let compiler_src_dir = base_dir.join(\"compiler\");\n-         normalize_path(&compiler_src_dir, \"$(echo '$COMPILER_DIR')\");\n-\n--        if let Some(virtual_rust_source_base_dir) =\n--            option_env!(\"CFG_VIRTUAL_RUST_SOURCE_BASE_DIR\").map(PathBuf::from)\n--        {\n--            normalize_path(&virtual_rust_source_base_dir.join(\"library\"), \"$(echo '$SRC_DIR')\");\n--            normalize_path(&virtual_rust_source_base_dir.join(\"compiler\"), \"$(echo '$COMPILER_DIR')\");\n--        }\n-+        normalize_path(&Path::new(\"$(cd ../build_sysroot/sysroot_src/library; pwd)\"), \"$(echo '$SRC_DIR')\");\n-\n-         // Paths into the build directory\n-         let test_build_dir = &self.config.build_base;\n EOF\n \n cat > config.toml <<EOF\n@@ -69,6 +51,8 @@ popd\n # FIXME remove once inline asm is fully supported\n export RUSTFLAGS=\"$RUSTFLAGS --cfg=rustix_use_libc\"\n \n+export CFG_VIRTUAL_RUST_SOURCE_BASE_DIR=\"$(cd build_sysroot/sysroot_src; pwd)\"\n+\n # Allow the testsuite to use llvm tools\n host_triple=$(rustc -vV | grep host | cut -d: -f2 | tr -d \" \")\n export LLVM_BIN_DIR=\"$(rustc --print sysroot)/lib/rustlib/$host_triple/bin\""}]}