{"sha": "2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5NjZmYmMxMGQwZmQ0ZmUxNWEyNTYwOGI5ZWNhM2U1MmJhMjQ5OTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-02-03T04:57:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-02-03T04:57:30Z"}, "message": "Auto merge of #58043 - jethrogb:jb/sgx-usercallnrs, r=joshtriplett\n\nFix `std::os::fortanix_sgx::usercalls::raw::UsercallNrs`\n\nIt was 0-indexed but should be 1-indexed. This PR just removes the duplicate code and re-exports the internal enum.\n\nFixes https://github.com/fortanix/rust-sgx/issues/88\n\nr? @joshtriplett", "tree": {"sha": "26cb31afc5d4d999df7d3881f4688d93017c0520", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26cb31afc5d4d999df7d3881f4688d93017c0520"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "html_url": "https://github.com/rust-lang/rust/commit/2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2966fbc10d0fd4fe15a25608b9eca3e52ba24995/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec7ecb3076260256ae7e43f6991ecc1566c73708", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec7ecb3076260256ae7e43f6991ecc1566c73708", "html_url": "https://github.com/rust-lang/rust/commit/ec7ecb3076260256ae7e43f6991ecc1566c73708"}, {"sha": "a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "url": "https://api.github.com/repos/rust-lang/rust/commits/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "html_url": "https://github.com/rust-lang/rust/commit/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2"}], "stats": {"total": 30, "additions": 10, "deletions": 20}, "files": [{"sha": "c6106b9f8278f099d52c41bcf1719cab1f00684f", "filename": "src/libstd/os/fortanix_sgx/mod.rs", "status": "modified", "additions": 1, "deletions": 16, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/2966fbc10d0fd4fe15a25608b9eca3e52ba24995/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2966fbc10d0fd4fe15a25608b9eca3e52ba24995/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs?ref=2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "patch": "@@ -21,26 +21,11 @@ pub mod usercalls {\n \n     /// Lowest-level interfaces to usercalls and usercall ABI type definitions.\n     pub mod raw {\n-        use sys::abi::usercalls::raw::invoke_with_usercalls;\n-        pub use sys::abi::usercalls::raw::do_usercall;\n+        pub use sys::abi::usercalls::raw::{do_usercall, Usercalls as UsercallNrs};\n         pub use sys::abi::usercalls::raw::{accept_stream, alloc, async_queues, bind_stream, close,\n                                            connect_stream, exit, flush, free, insecure_time,\n                                            launch_thread, read, read_alloc, send, wait, write};\n \n-        macro_rules! define_usercallnrs {\n-            ($(fn $f:ident($($n:ident: $t:ty),*) $(-> $r:ty)*; )*) => {\n-                /// Usercall numbers as per the ABI.\n-                #[repr(C)]\n-                #[unstable(feature = \"sgx_platform\", issue = \"56975\")]\n-                #[derive(Copy, Clone, Hash, PartialEq, Eq, Debug)]\n-                #[allow(missing_docs)]\n-                pub enum UsercallNrs {\n-                    $($f,)*\n-                }\n-            };\n-        }\n-        invoke_with_usercalls!(define_usercallnrs);\n-\n         // fortanix-sgx-abi re-exports\n         pub use sys::abi::usercalls::raw::{ByteBuffer, FifoDescriptor, Return, Usercall};\n         pub use sys::abi::usercalls::raw::Error;"}, {"sha": "27f780ca224dbe3cda3cdadc4712b01be902c488", "filename": "src/libstd/sys/sgx/abi/usercalls/raw.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2966fbc10d0fd4fe15a25608b9eca3e52ba24995/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2966fbc10d0fd4fe15a25608b9eca3e52ba24995/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs?ref=2966fbc10d0fd4fe15a25608b9eca3e52ba24995", "patch": "@@ -41,10 +41,15 @@ trait ReturnValue {\n macro_rules! define_usercalls {\n     // Using `$r:tt` because `$r:ty` doesn't match ! in `clobber_diverging`\n     ($(fn $f:ident($($n:ident: $t:ty),*) $(-> $r:tt)*; )*) => {\n-        #[repr(C)]\n-        #[allow(non_camel_case_types)]\n-        enum Usercalls {\n-            __enclave_usercalls_invalid,\n+        /// Usercall numbers as per the ABI.\n+        #[repr(u64)]\n+        #[unstable(feature = \"sgx_platform\", issue = \"56975\")]\n+        #[derive(Copy, Clone, Hash, PartialEq, Eq, Debug)]\n+        #[allow(missing_docs, non_camel_case_types)]\n+        #[non_exhaustive]\n+        pub enum Usercalls {\n+            #[doc(hidden)]\n+            __enclave_usercalls_invalid = 0,\n             $($f,)*\n         }\n "}]}