{"sha": "dd2eabc49d415dd30cea0953df5d7659d4d9440f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkMmVhYmM0OWQ0MTVkZDMwY2VhMDk1M2RmNWQ3NjU5ZDRkOTQ0MGY=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-05-14T21:08:31Z"}, "committer": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-05-15T01:33:13Z"}, "message": "Make MaybeStorageLive drop-aware", "tree": {"sha": "a5499d4d78215450575b2843b84186514adcb516", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a5499d4d78215450575b2843b84186514adcb516"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd2eabc49d415dd30cea0953df5d7659d4d9440f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd2eabc49d415dd30cea0953df5d7659d4d9440f", "html_url": "https://github.com/rust-lang/rust/commit/dd2eabc49d415dd30cea0953df5d7659d4d9440f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd2eabc49d415dd30cea0953df5d7659d4d9440f/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b789017403beb28c7f73cdd994e7fbd982a311f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/b789017403beb28c7f73cdd994e7fbd982a311f0", "html_url": "https://github.com/rust-lang/rust/commit/b789017403beb28c7f73cdd994e7fbd982a311f0"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "3bf11c57379c24fcc2dad7781c358c233cee79db", "filename": "src/librustc_mir/dataflow/impls/storage_liveness.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/dd2eabc49d415dd30cea0953df5d7659d4d9440f/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd2eabc49d415dd30cea0953df5d7659d4d9440f/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs?ref=dd2eabc49d415dd30cea0953df5d7659d4d9440f", "patch": "@@ -43,9 +43,14 @@ impl<'a, 'tcx> BitDenotation<'tcx> for MaybeStorageLive<'a, 'tcx> {\n     }\n \n     fn terminator_effect(&self,\n-                         _sets: &mut BlockSets<'_, Local>,\n-                         _loc: Location) {\n-        // Terminators have no effect\n+                         sets: &mut BlockSets<'_, Local>,\n+                         loc: Location) {\n+        match &self.mir[loc.block].terminator().kind {\n+            TerminatorKind::Drop { location, .. } => if let Some(l) = location.local() {\n+                sets.kill(l);\n+            }\n+            _ => (),\n+        }\n     }\n \n     fn propagate_call_return("}]}