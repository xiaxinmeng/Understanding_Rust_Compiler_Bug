{"sha": "85532e2df3f713f0fb9096328e86ec7e74934c12", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1NTMyZTJkZjNmNzEzZjBmYjkwOTYzMjhlODZlYzdlNzQ5MzRjMTI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-07-23T12:33:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-23T12:33:24Z"}, "message": "Merge #5480\n\n5480: Fix snippetTextEdits applying to other files r=matklad a=TimoFreiberg\n\nFixes #4551\r\n`vscode.window.visibleTextEditors` only contains editors whose contents are being displayed at the moment, so the previous logic only worked if the other file for which a snippetTextEdit is being received was visible in a separate split.\r\n\r\nI feel that this is a hacky approach, so feel free to reject it for something nicer :)\n\nCo-authored-by: Timo Freiberg <timo.freiberg@gmail.com>", "tree": {"sha": "243b2e6000eca4941ae9c1a869730ac31cd4591c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/243b2e6000eca4941ae9c1a869730ac31cd4591c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/85532e2df3f713f0fb9096328e86ec7e74934c12", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfGYOUCRBK7hj4Ov3rIwAAdHIIAGEQ9/9U6fjAA70qYJ1NmZ9o\n3iSXxcPbNvH+9HCcDkmFBIp1IyIZs6pF0fyBpr4+j+/0RQ/iQotqbqDRltgTe0M1\n6PXUnbAlRpNqbNeV8dXAkCkgd/Nx/kxWUanSbKqdtsZb5AyR+A4FZXjr/X2WNozS\nUAhlUDW824t5i5khDjceWoRfOOlwMdwok/aIwsLuWtJ8CPMjlZtSkTPwFUV8+ZfZ\nEfzdAZPnv/Df0QTPwZg2E7tnEhSUz+Ka2jBKHPKUJSiRIkVXX4ZKsnurpONOl6gI\nePx4blV8w2w5rxVD8p+BW9VDR6/sV01JplMGq8IBWrqoJGvF36X4EUXgvmBBRdA=\n=6Rzt\n-----END PGP SIGNATURE-----\n", "payload": "tree 243b2e6000eca4941ae9c1a869730ac31cd4591c\nparent 803f3613ba041a24b50c7e8249e9ee3195836ea8\nparent 1b5a74ef18389f7d1a90cb6945a17bc412f707b4\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1595507604 +0000\ncommitter GitHub <noreply@github.com> 1595507604 +0000\n\nMerge #5480\n\n5480: Fix snippetTextEdits applying to other files r=matklad a=TimoFreiberg\n\nFixes #4551\r\n`vscode.window.visibleTextEditors` only contains editors whose contents are being displayed at the moment, so the previous logic only worked if the other file for which a snippetTextEdit is being received was visible in a separate split.\r\n\r\nI feel that this is a hacky approach, so feel free to reject it for something nicer :)\n\nCo-authored-by: Timo Freiberg <timo.freiberg@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/85532e2df3f713f0fb9096328e86ec7e74934c12", "html_url": "https://github.com/rust-lang/rust/commit/85532e2df3f713f0fb9096328e86ec7e74934c12", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/85532e2df3f713f0fb9096328e86ec7e74934c12/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "803f3613ba041a24b50c7e8249e9ee3195836ea8", "url": "https://api.github.com/repos/rust-lang/rust/commits/803f3613ba041a24b50c7e8249e9ee3195836ea8", "html_url": "https://github.com/rust-lang/rust/commit/803f3613ba041a24b50c7e8249e9ee3195836ea8"}, {"sha": "1b5a74ef18389f7d1a90cb6945a17bc412f707b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b5a74ef18389f7d1a90cb6945a17bc412f707b4", "html_url": "https://github.com/rust-lang/rust/commit/1b5a74ef18389f7d1a90cb6945a17bc412f707b4"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "258b49982ef1804d1a78be651e50f493f3bdca31", "filename": "editors/code/src/snippets.ts", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/85532e2df3f713f0fb9096328e86ec7e74934c12/editors%2Fcode%2Fsrc%2Fsnippets.ts", "raw_url": "https://github.com/rust-lang/rust/raw/85532e2df3f713f0fb9096328e86ec7e74934c12/editors%2Fcode%2Fsrc%2Fsnippets.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fsnippets.ts?ref=85532e2df3f713f0fb9096328e86ec7e74934c12", "patch": "@@ -6,6 +6,10 @@ export async function applySnippetWorkspaceEdit(edit: vscode.WorkspaceEdit) {\n     assert(edit.entries().length === 1, `bad ws edit: ${JSON.stringify(edit)}`);\n     const [uri, edits] = edit.entries()[0];\n \n+    if (vscode.window.activeTextEditor?.document.uri !== uri) {\n+        // `vscode.window.visibleTextEditors` only contains editors whose contents are being displayed\n+        await vscode.window.showTextDocument(uri, {});\n+    }\n     const editor = vscode.window.visibleTextEditors.find((it) => it.document.uri.toString() === uri.toString());\n     if (!editor) return;\n     await applySnippetTextEdits(editor, edits);"}]}