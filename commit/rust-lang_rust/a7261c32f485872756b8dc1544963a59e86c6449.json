{"sha": "a7261c32f485872756b8dc1544963a59e86c6449", "node_id": "C_kwDOAAsO6NoAKGE3MjYxYzMyZjQ4NTg3Mjc1NmI4ZGMxNTQ0OTYzYTU5ZTg2YzY0NDk", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-11-17T20:28:54Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2021-11-18T00:23:15Z"}, "message": "Avoid suggesting literal formatting that turns into member access\n\nFixes #90974", "tree": {"sha": "4b16fd53c0d1026cdbe1f510ad951914d8835944", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b16fd53c0d1026cdbe1f510ad951914d8835944"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7261c32f485872756b8dc1544963a59e86c6449", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7261c32f485872756b8dc1544963a59e86c6449", "html_url": "https://github.com/rust-lang/rust/commit/a7261c32f485872756b8dc1544963a59e86c6449", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7261c32f485872756b8dc1544963a59e86c6449/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "891ca5f63c3b3cfe3939710a728671243e881ed6", "url": "https://api.github.com/repos/rust-lang/rust/commits/891ca5f63c3b3cfe3939710a728671243e881ed6", "html_url": "https://github.com/rust-lang/rust/commit/891ca5f63c3b3cfe3939710a728671243e881ed6"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "aceeb924ac4ad95785285ad88341929e28426a5f", "filename": "compiler/rustc_typeck/src/check/method/suggest.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a7261c32f485872756b8dc1544963a59e86c6449/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7261c32f485872756b8dc1544963a59e86c6449/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmethod%2Fsuggest.rs?ref=a7261c32f485872756b8dc1544963a59e86c6449", "patch": "@@ -317,14 +317,18 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                                     .span_to_snippet(lit.span)\n                                     .unwrap_or_else(|_| \"<numeric literal>\".to_owned());\n \n+                                // If this is a floating point literal that ends with '.',\n+                                // get rid of it to stop this from becoming a member access.\n+                                let snippet = snippet.strip_suffix('.').unwrap_or(&snippet);\n+\n                                 err.span_suggestion(\n                                     lit.span,\n                                     &format!(\n                                         \"you must specify a concrete type for this numeric value, \\\n                                          like `{}`\",\n                                         concrete_type\n                                     ),\n-                                    format!(\"{}_{}\", snippet, concrete_type),\n+                                    format!(\"{snippet}_{concrete_type}\"),\n                                     Applicability::MaybeIncorrect,\n                                 );\n                             }"}, {"sha": "83590dbf7ace7511523965bca7b011c64a6ca294", "filename": "src/test/ui/suggestions/issue-90974.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a7261c32f485872756b8dc1544963a59e86c6449/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7261c32f485872756b8dc1544963a59e86c6449/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.rs?ref=a7261c32f485872756b8dc1544963a59e86c6449", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    println!(\"{}\", (3.).recip()); //~ERROR\n+}"}, {"sha": "e1fb479a3a7a0a0e2ef26f48bf32a976d3f11b68", "filename": "src/test/ui/suggestions/issue-90974.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a7261c32f485872756b8dc1544963a59e86c6449/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a7261c32f485872756b8dc1544963a59e86c6449/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fissue-90974.stderr?ref=a7261c32f485872756b8dc1544963a59e86c6449", "patch": "@@ -0,0 +1,14 @@\n+error[E0689]: can't call method `recip` on ambiguous numeric type `{float}`\n+  --> $DIR/issue-90974.rs:2:25\n+   |\n+LL |     println!(\"{}\", (3.).recip());\n+   |                         ^^^^^\n+   |\n+help: you must specify a concrete type for this numeric value, like `f32`\n+   |\n+LL |     println!(\"{}\", (3_f32).recip());\n+   |                     ~~~~~\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0689`."}]}