{"sha": "e606a43320323e702ec8f606bbbb0a1c083eaa55", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU2MDZhNDMzMjAzMjNlNzAyZWM4ZjYwNmJiYmIwYTFjMDgzZWFhNTU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-02-19T15:30:49Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-02-20T00:12:21Z"}, "message": "Fix rustdoc test with new file path", "tree": {"sha": "1c4adb26e8085b3492d6eea2484c120d65bb7b72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c4adb26e8085b3492d6eea2484c120d65bb7b72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e606a43320323e702ec8f606bbbb0a1c083eaa55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e606a43320323e702ec8f606bbbb0a1c083eaa55", "html_url": "https://github.com/rust-lang/rust/commit/e606a43320323e702ec8f606bbbb0a1c083eaa55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e606a43320323e702ec8f606bbbb0a1c083eaa55/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "047a215b4d9cf762d3704ee02b76467897bbbe21", "url": "https://api.github.com/repos/rust-lang/rust/commits/047a215b4d9cf762d3704ee02b76467897bbbe21", "html_url": "https://github.com/rust-lang/rust/commit/047a215b4d9cf762d3704ee02b76467897bbbe21"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "636100ef503cf8f821d989a58fd2216d555b52e8", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e606a43320323e702ec8f606bbbb0a1c083eaa55/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e606a43320323e702ec8f606bbbb0a1c083eaa55/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=e606a43320323e702ec8f606bbbb0a1c083eaa55", "patch": "@@ -1986,12 +1986,22 @@ actual:\\n\\\n     fn check_rustdoc_test_option(&self, res: ProcRes) {\n         let mut other_files = Vec::new();\n         let mut files: HashMap<String, Vec<usize>> = HashMap::new();\n-        files.insert(self.testpaths.file.to_str().unwrap().to_owned(),\n+        let cwd = env::current_dir().unwrap();\n+        files.insert(self.testpaths.file.strip_prefix(&cwd)\n+                                        .unwrap_or(&self.testpaths.file)\n+                                        .to_str()\n+                                        .unwrap()\n+                                        .replace('\\\\', \"/\"),\n                      self.get_lines(&self.testpaths.file, Some(&mut other_files)));\n         for other_file in other_files {\n             let mut path = self.testpaths.file.clone();\n             path.set_file_name(&format!(\"{}.rs\", other_file));\n-            files.insert(path.to_str().unwrap().to_owned(), self.get_lines(&path, None));\n+            files.insert(path.strip_prefix(&cwd)\n+                             .unwrap_or(&path)\n+                             .to_str()\n+                             .unwrap()\n+                             .to_owned(),\n+                         self.get_lines(&path, None));\n         }\n \n         let mut tested = 0;\n@@ -2001,7 +2011,8 @@ actual:\\n\\\n                                let tmp: Vec<&str> = s.split(\" - \").collect();\n                                if tmp.len() == 2 {\n                                    let path = tmp[0].rsplit(\"test \").next().unwrap();\n-                                   if let Some(ref mut v) = files.get_mut(path) {\n+                                   if let Some(ref mut v) = files.get_mut(\n+                                                                &path.replace('\\\\', \"/\")) {\n                                        tested += 1;\n                                        let mut iter = tmp[1].split(\"(line \");\n                                        iter.next();"}]}