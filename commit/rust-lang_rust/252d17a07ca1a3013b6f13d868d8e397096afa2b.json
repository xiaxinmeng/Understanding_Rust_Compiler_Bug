{"sha": "252d17a07ca1a3013b6f13d868d8e397096afa2b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MmQxN2EwN2NhMWEzMDEzYjZmMTNkODY4ZDhlMzk3MDk2YWZhMmI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-10-07T22:40:46Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-10-09T02:12:30Z"}, "message": "Allow attributes on macros\n\nIt's unclear to me why these currently aren't allowed, and my best guess is that\na long time ago we didn't strip the ast of cfg nodes before syntax expansion.\nNow that this is done, I'm not certain that we should continue to prohibit this\nfunctionality.\n\nThis is a step in the right direction towards #5605, because now we can add an\nempty `std::macros` module to the documentation with a bunch of empty macros\nexplaining how they're supposed to be used.", "tree": {"sha": "856f5cd9fe3cb9659c3a95fc80e29b57e315f4ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/856f5cd9fe3cb9659c3a95fc80e29b57e315f4ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/252d17a07ca1a3013b6f13d868d8e397096afa2b", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/252d17a07ca1a3013b6f13d868d8e397096afa2b", "html_url": "https://github.com/rust-lang/rust/commit/252d17a07ca1a3013b6f13d868d8e397096afa2b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/252d17a07ca1a3013b6f13d868d8e397096afa2b/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8eb28bb7dcd77ac9e804ab2d75b387ca3f47f9d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/8eb28bb7dcd77ac9e804ab2d75b387ca3f47f9d4", "html_url": "https://github.com/rust-lang/rust/commit/8eb28bb7dcd77ac9e804ab2d75b387ca3f47f9d4"}], "stats": {"total": 46, "additions": 36, "deletions": 10}, "files": [{"sha": "e87a0474a55ab8c85537f385668239f115e89a22", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=252d17a07ca1a3013b6f13d868d8e397096afa2b", "patch": "@@ -4548,9 +4548,6 @@ impl Parser {\n                     || self.look_ahead(2, |t| *t == token::LPAREN)\n                     || self.look_ahead(2, |t| *t == token::LBRACE)) {\n             // MACRO INVOCATION ITEM\n-            if attrs.len() > 0 {\n-                self.fatal(\"attrs on macros are not yet supported\");\n-            }\n \n             // item macro.\n             let pth = self.parse_path(NoTypesAllowed).path;"}, {"sha": "1e49e4a35ccc3693fc922a31a4d4fccf1772a18c", "filename": "src/test/run-pass/macro-with-attrs1.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Ftest%2Frun-pass%2Fmacro-with-attrs1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Ftest%2Frun-pass%2Fmacro-with-attrs1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacro-with-attrs1.rs?ref=252d17a07ca1a3013b6f13d868d8e397096afa2b", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// xfail-fast windows doesn't like compile-flags\n+// compile-flags: --cfg foo\n+\n+#[feature(macro_rules)];\n+\n+#[cfg(foo)]\n+macro_rules! foo( () => (1) )\n+\n+#[cfg(not(foo))]\n+macro_rules! foo( () => (2) )\n+\n+fn main() {\n+    assert_eq!(foo!(), 1);\n+}"}, {"sha": "742769fa376836483f1a23f4bf737792cdee91a1", "filename": "src/test/run-pass/macro-with-attrs2.rs", "status": "renamed", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Ftest%2Frun-pass%2Fmacro-with-attrs2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/252d17a07ca1a3013b6f13d868d8e397096afa2b/src%2Ftest%2Frun-pass%2Fmacro-with-attrs2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacro-with-attrs2.rs?ref=252d17a07ca1a3013b6f13d868d8e397096afa2b", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -8,10 +8,15 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// error-pattern:attrs on macros are not yet supported\n+#[feature(macro_rules)];\n+\n+#[cfg(foo)]\n+macro_rules! foo( () => (1) )\n+\n+#[cfg(not(foo))]\n+macro_rules! foo( () => (2) )\n+\n+pub fn main() {\n+    assert_eq!(foo!(), 2);\n+}\n \n-// Don't know how to deal with a syntax extension appearing after an\n-// item attribute. Probably could use a better error message.\n-#[foo = \"bar\"]\n-fmt!(\"baz\")\n-fn main() { }", "previous_filename": "src/test/compile-fail/ext-after-attrib.rs"}]}