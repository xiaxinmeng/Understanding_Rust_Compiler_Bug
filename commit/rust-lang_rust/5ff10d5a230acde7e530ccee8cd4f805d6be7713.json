{"sha": "5ff10d5a230acde7e530ccee8cd4f805d6be7713", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmZjEwZDVhMjMwYWNkZTdlNTMwY2NlZThjZDRmODA1ZDZiZTc3MTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-11-23T09:51:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-11-23T09:51:49Z"}, "message": "auto merge of #19157 : aturon/rust/cow-doc, r=alexcrichton\n\nThis commit makes `Cow` more usable by allowing it to be applied to\r\nunsized types (as was intended) and providing some basic `ToOwned`\r\nimplementations on slice types. It also corrects the documentation for\r\n`Cow` to no longer mention `DerefMut`, and adds an example.\r\n\r\nCloses #19123", "tree": {"sha": "c340ba123852fdd6e3dff6124f1b0d0c6666fcee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c340ba123852fdd6e3dff6124f1b0d0c6666fcee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ff10d5a230acde7e530ccee8cd4f805d6be7713", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ff10d5a230acde7e530ccee8cd4f805d6be7713", "html_url": "https://github.com/rust-lang/rust/commit/5ff10d5a230acde7e530ccee8cd4f805d6be7713", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ff10d5a230acde7e530ccee8cd4f805d6be7713/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5212e3cd7958368a41e0a4559693fd2374625e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5212e3cd7958368a41e0a4559693fd2374625e1", "html_url": "https://github.com/rust-lang/rust/commit/f5212e3cd7958368a41e0a4559693fd2374625e1"}, {"sha": "bab9564280a02ca04aa95e71c1c7163a31bc7867", "url": "https://api.github.com/repos/rust-lang/rust/commits/bab9564280a02ca04aa95e71c1c7163a31bc7867", "html_url": "https://github.com/rust-lang/rust/commit/bab9564280a02ca04aa95e71c1c7163a31bc7867"}], "stats": {"total": 46, "additions": 36, "deletions": 10}, "files": [{"sha": "ab5ac5bf9e1461732fb4abe7cecdb7fdcf0abd1e", "filename": "src/libcollections/slice.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcollections%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcollections%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fslice.rs?ref=5ff10d5a230acde7e530ccee8cd4f805d6be7713", "patch": "@@ -89,7 +89,7 @@\n \n use self::Direction::*;\n use alloc::boxed::Box;\n-use core::borrow::{BorrowFrom, BorrowFromMut};\n+use core::borrow::{BorrowFrom, BorrowFromMut, ToOwned};\n use core::cmp;\n use core::kinds::Sized;\n use core::mem::size_of;\n@@ -658,6 +658,11 @@ impl<T> BorrowFromMut<Vec<T>> for [T] {\n     fn borrow_from_mut(owned: &mut Vec<T>) -> &mut [T] { owned[mut] }\n }\n \n+#[unstable = \"trait is unstable\"]\n+impl<T: Clone> ToOwned<Vec<T>> for [T] {\n+    fn to_owned(&self) -> Vec<T> { self.to_vec() }\n+}\n+\n /// Unsafe operations\n pub mod raw {\n     pub use core::slice::raw::{buf_as_slice, mut_buf_as_slice};"}, {"sha": "67c8902ffc9dfb203cc92f5b89f0c26887d42741", "filename": "src/libcollections/str.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcollections%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcollections%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fstr.rs?ref=5ff10d5a230acde7e530ccee8cd4f805d6be7713", "patch": "@@ -54,7 +54,7 @@\n pub use self::MaybeOwned::*;\n use self::RecompositionState::*;\n use self::DecompositionType::*;\n-use core::borrow::BorrowFrom;\n+use core::borrow::{BorrowFrom, ToOwned};\n use core::default::Default;\n use core::fmt;\n use core::cmp;\n@@ -67,7 +67,7 @@ use core::prelude::{range};\n \n use hash;\n use ring_buf::RingBuf;\n-use string::String;\n+use string::{String, ToString};\n use unicode;\n use vec::Vec;\n \n@@ -611,6 +611,11 @@ impl BorrowFrom<String> for str {\n     fn borrow_from(owned: &String) -> &str { owned[] }\n }\n \n+#[unstable = \"trait is unstable\"]\n+impl ToOwned<String> for str {\n+    fn to_owned(&self) -> String { self.to_string() }\n+}\n+\n /// Unsafe string operations.\n pub mod raw {\n     pub use core::str::raw::{from_utf8, c_str_to_static_slice, slice_bytes};"}, {"sha": "da0e23e1a5e233ab00530b261d0cc8cd3a408463", "filename": "src/libcore/borrow.rs", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcore%2Fborrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff10d5a230acde7e530ccee8cd4f805d6be7713/src%2Flibcore%2Fborrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fborrow.rs?ref=5ff10d5a230acde7e530ccee8cd4f805d6be7713", "patch": "@@ -37,10 +37,10 @@\n //! data lazily when mutation or ownership is required. The type is designed to\n //! work with general borrowed data via the `BorrowFrom` trait.\n //!\n-//! `Cow` implements both `Deref` and `DerefMut`, which means that you can call\n-//! methods directly on the data it encloses. The first time a mutable reference\n-//! is required, the data will be cloned (via `to_owned`) if it is not\n-//! already owned.\n+//! `Cow` implements both `Deref`, which means that you can call\n+//! non-mutating methods directly on the data it encloses. If mutation\n+//! is desired, `to_mut` will obtain a mutable references to an owned\n+//! value, cloning if necessary.\n \n #![unstable = \"recently added as part of collections reform\"]\n \n@@ -92,15 +92,31 @@ impl<T> ToOwned<T> for T where T: Clone {\n }\n \n /// A clone-on-write smart pointer.\n-pub enum Cow<'a, T, B: 'a> where B: ToOwned<T> {\n+///\n+/// # Example\n+///\n+/// ```rust\n+/// use std::borrow::Cow;\n+///\n+/// fn abs_all(input: &mut Cow<Vec<int>, [int]>) {\n+///     for i in range(0, input.len()) {\n+///         let v = input[i];\n+///         if v < 0 {\n+///             // clones into a vector the first time (if not already owned)\n+///             input.to_mut()[i] = -v;\n+///         }\n+///     }\n+/// }\n+/// ```\n+pub enum Cow<'a, T, Sized? B: 'a> where B: ToOwned<T> {\n     /// Borrowed data.\n     Borrowed(&'a B),\n \n     /// Owned data.\n     Owned(T)\n }\n \n-impl<'a, T, B> Cow<'a, T, B> where B: ToOwned<T> {\n+impl<'a, T, Sized? B> Cow<'a, T, B> where B: ToOwned<T> {\n     /// Acquire a mutable reference to the owned form of the data.\n     ///\n     /// Copies the data if it is not already owned.\n@@ -125,7 +141,7 @@ impl<'a, T, B> Cow<'a, T, B> where B: ToOwned<T> {\n     }\n }\n \n-impl<'a, T, B> Deref<B> for Cow<'a, T, B> where B: ToOwned<T>  {\n+impl<'a, T, Sized? B> Deref<B> for Cow<'a, T, B> where B: ToOwned<T>  {\n     fn deref(&self) -> &B {\n         match *self {\n             Borrowed(borrowed) => borrowed,"}]}