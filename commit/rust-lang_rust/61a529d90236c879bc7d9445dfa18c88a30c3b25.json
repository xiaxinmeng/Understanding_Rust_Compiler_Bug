{"sha": "61a529d90236c879bc7d9445dfa18c88a30c3b25", "node_id": "C_kwDOAAsO6NoAKDYxYTUyOWQ5MDIzNmM4NzliYzdkOTQ0NWRmYTE4Yzg4YTMwYzNiMjU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-20T05:09:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-20T05:09:00Z"}, "message": "Rollup merge of #100617 - chenyukang:fix-100605, r=compiler-errors\n\nSuggest the right help message for as_ref\n\nFixes #100605", "tree": {"sha": "b9b70f06cb48128eef709ae5090628abc4ce598d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9b70f06cb48128eef709ae5090628abc4ce598d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61a529d90236c879bc7d9445dfa18c88a30c3b25", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjAGxsCRBK7hj4Ov3rIwAAJ2cIADaZkbAGHDyK1rZfXNpnAR3g\n2akRzK4U3DEf0kwriZHIBQcWhnboipnV3+rIPqxl1NgwGzQln4jTztfFFxO1ztri\n262yk6psDR7zLY1/1zfSyGpCoqkP8/ISnMI4AaBJzgzj86hJoI81xTfZfyap7vNm\nIxy3qZbkbJqqUU10M/ZYTSojtvLvEsaJzJEK7QmayhEvSwvzQXbQ5aay5Lk7cXvD\n5ROpuBzAdgN7Jtto+Tixe/fgxIoxh5ccnaIHzvZT3k/IYsIG4uuHLBAzem5unawj\n+hEfBtJ0GpVvYiszi62FcxFCKDJPnRaEdZ1AlUPfLF0ZV8nVX8RFv09YjYekW84=\n=Wcjd\n-----END PGP SIGNATURE-----\n", "payload": "tree b9b70f06cb48128eef709ae5090628abc4ce598d\nparent c4b83ebe7c0e551c5e22abca259ef22d4cb0c509\nparent 3de74f7e2be7be983aaef0fe7be08e9030e4ecbb\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1660972140 +0200\ncommitter GitHub <noreply@github.com> 1660972140 +0200\n\nRollup merge of #100617 - chenyukang:fix-100605, r=compiler-errors\n\nSuggest the right help message for as_ref\n\nFixes #100605\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61a529d90236c879bc7d9445dfa18c88a30c3b25", "html_url": "https://github.com/rust-lang/rust/commit/61a529d90236c879bc7d9445dfa18c88a30c3b25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61a529d90236c879bc7d9445dfa18c88a30c3b25/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4b83ebe7c0e551c5e22abca259ef22d4cb0c509", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4b83ebe7c0e551c5e22abca259ef22d4cb0c509", "html_url": "https://github.com/rust-lang/rust/commit/c4b83ebe7c0e551c5e22abca259ef22d4cb0c509"}, {"sha": "3de74f7e2be7be983aaef0fe7be08e9030e4ecbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/3de74f7e2be7be983aaef0fe7be08e9030e4ecbb", "html_url": "https://github.com/rust-lang/rust/commit/3de74f7e2be7be983aaef0fe7be08e9030e4ecbb"}], "stats": {"total": 58, "additions": 57, "deletions": 1}, "files": [{"sha": "6993245c605ae950e9bc950b6ee62627269b7822", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61a529d90236c879bc7d9445dfa18c88a30c3b25/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a529d90236c879bc7d9445dfa18c88a30c3b25/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=61a529d90236c879bc7d9445dfa18c88a30c3b25", "patch": "@@ -2079,7 +2079,8 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                             diag.span_suggestion(\n                                 span,\n                                 *msg,\n-                                format!(\"{}.as_ref()\", snippet),\n+                                // HACK: fix issue# 100605, suggesting convert from &Option<T> to Option<&T>, remove the extra `&`\n+                                format!(\"{}.as_ref()\", snippet.trim_start_matches('&')),\n                                 Applicability::MachineApplicable,\n                             );\n                         }"}, {"sha": "917a45c15bbc81a1ee6d19122d9e0bbf57549add", "filename": "src/test/ui/issues/issue-100605.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/61a529d90236c879bc7d9445dfa18c88a30c3b25/src%2Ftest%2Fui%2Fissues%2Fissue-100605.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61a529d90236c879bc7d9445dfa18c88a30c3b25/src%2Ftest%2Fui%2Fissues%2Fissue-100605.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-100605.rs?ref=61a529d90236c879bc7d9445dfa18c88a30c3b25", "patch": "@@ -0,0 +1,9 @@\n+fn takes_option(_arg: Option<&String>) {}\n+\n+fn main() {\n+    takes_option(&None); //~ ERROR 4:18: 4:23: mismatched types [E0308]\n+\n+    let x = String::from(\"x\");\n+    let res = Some(x);\n+    takes_option(&res); //~ ERROR 8:18: 8:22: mismatched types [E0308]\n+}"}, {"sha": "886e3cd6bb794b0393e659de16a81dcf86440111", "filename": "src/test/ui/issues/issue-100605.stderr", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/61a529d90236c879bc7d9445dfa18c88a30c3b25/src%2Ftest%2Fui%2Fissues%2Fissue-100605.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/61a529d90236c879bc7d9445dfa18c88a30c3b25/src%2Ftest%2Fui%2Fissues%2Fissue-100605.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-100605.stderr?ref=61a529d90236c879bc7d9445dfa18c88a30c3b25", "patch": "@@ -0,0 +1,46 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-100605.rs:4:18\n+   |\n+LL |     takes_option(&None);\n+   |     ------------ ^^^^^ expected enum `Option`, found `&Option<_>`\n+   |     |\n+   |     arguments to this function are incorrect\n+   |\n+   = note:   expected enum `Option<&String>`\n+           found reference `&Option<_>`\n+note: function defined here\n+  --> $DIR/issue-100605.rs:1:4\n+   |\n+LL | fn takes_option(_arg: Option<&String>) {}\n+   |    ^^^^^^^^^^^^ ---------------------\n+help: you can convert from `&Option<T>` to `Option<&T>` using `.as_ref()`\n+   |\n+LL |     takes_option(None.as_ref());\n+   |                  ~~~~~~~~~~~~~\n+help: consider removing the borrow\n+   |\n+LL -     takes_option(&None);\n+LL +     takes_option(None);\n+   |\n+\n+error[E0308]: mismatched types\n+  --> $DIR/issue-100605.rs:8:18\n+   |\n+LL |     takes_option(&res);\n+   |     ------------ ^^^^\n+   |     |            |\n+   |     |            expected enum `Option`, found `&Option<String>`\n+   |     |            help: you can convert from `&Option<T>` to `Option<&T>` using `.as_ref()`: `res.as_ref()`\n+   |     arguments to this function are incorrect\n+   |\n+   = note:   expected enum `Option<&String>`\n+           found reference `&Option<String>`\n+note: function defined here\n+  --> $DIR/issue-100605.rs:1:4\n+   |\n+LL | fn takes_option(_arg: Option<&String>) {}\n+   |    ^^^^^^^^^^^^ ---------------------\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0308`."}]}