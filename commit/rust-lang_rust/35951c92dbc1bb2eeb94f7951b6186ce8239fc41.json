{"sha": "35951c92dbc1bb2eeb94f7951b6186ce8239fc41", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1OTUxYzkyZGJjMWJiMmVlYjk0Zjc5NTFiNjE4NmNlODIzOWZjNDE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-22T01:08:57Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-03-22T01:08:57Z"}, "message": "Support CFG_LLVM_ROOT since CMake-built LLVM has no llvm-config", "tree": {"sha": "cf6aeaed43fd05978e1e6612415746b885e4bf4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf6aeaed43fd05978e1e6612415746b885e4bf4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35951c92dbc1bb2eeb94f7951b6186ce8239fc41", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35951c92dbc1bb2eeb94f7951b6186ce8239fc41", "html_url": "https://github.com/rust-lang/rust/commit/35951c92dbc1bb2eeb94f7951b6186ce8239fc41", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35951c92dbc1bb2eeb94f7951b6186ce8239fc41/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6d3308eb60c0ec419a2487a574b4ec501d8784d", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6d3308eb60c0ec419a2487a574b4ec501d8784d", "html_url": "https://github.com/rust-lang/rust/commit/e6d3308eb60c0ec419a2487a574b4ec501d8784d"}], "stats": {"total": 32, "additions": 24, "deletions": 8}, "files": [{"sha": "b98ad815737e0b4574c3dcb07c136b14159cda08", "filename": "configure", "status": "modified", "additions": 24, "deletions": 8, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/35951c92dbc1bb2eeb94f7951b6186ce8239fc41/configure", "raw_url": "https://github.com/rust-lang/rust/raw/35951c92dbc1bb2eeb94f7951b6186ce8239fc41/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=35951c92dbc1bb2eeb94f7951b6186ce8239fc41", "patch": "@@ -103,11 +103,11 @@ putvar CFG_CPUTYPE\n msg \"looking for build programs\"\n probe_need CFG_GCC          gcc\n probe_need CFG_GIT          git\n-probe_need CFG_LLVM_CONFIG  llvm-config\n probe_need CFG_OCAMLC       ocamlc\n probe_need CFG_PERL         perl\n probe_need CFG_PYTHON       python\n \n+probe CFG_LLVM_CONFIG      llvm-config\n probe CFG_VALGRIND         valgrind\n probe CFG_OCAMLOPT         ocamlopt\n probe CFG_OCAMLC_OPT       ocamlc.opt\n@@ -116,7 +116,29 @@ probe CFG_FLEXLINK         flexlink\n probe CFG_MAKEINFO         makeinfo\n probe CFG_TEXI2PDF         texi2pdf\n \n-CFG_LLVM_VERSION=$(llvm-config --version)\n+if [ ! -z \"$CFG_LLVM_ROOT\" ]\n+then\n+    CFG_LLVM_INCDIR=\"$CFG_LLVM_ROOT/include\"\n+    CFG_LLVM_BINDIR=\"$CFG_LLVM_ROOT/bin\"\n+    CFG_LLVM_LIBDIR=\"$CFG_LLVM_ROOT/lib\"\n+    CFG_LLVM_CXXFLAGS=\"-I$CFG_LLVM_INCDIR\"\n+    CFG_LLVM_LDFLAGS=\"\"\n+    CFG_LLVM_LIBS=$(find \"$CFG_LLVM_LIBDIR\" -name '*.lib' -exec echo '\\\"{}\\\"' ';' | xargs echo)\n+    CFG_LLVM_VERSION=$(\"$CFG_LLVM_BINDIR/llc\" --version | grep version | cut -d ' ' -f 5-)\n+elif [ ! -z \"$CFG_LLVM_VERSION\" ]\n+then\n+    CFG_LLVM_VERSION=$(llvm-config --version)\n+    CFG_LLVM_INCDIR=$(llvm-config --includedir)\n+    CFG_LLVM_BINDIR=$(llvm-config --bindir)\n+    CFG_LLVM_LIBDIR=$(llvm-config --libdir)\n+    CFG_LLVM_CXXFLAGS=$(llvm-config --cxxflags)\n+    CFG_LLVM_LDFLAGS=$(llvm-config --ldflags)\n+    CFG_LLVM_LIBS=$(llvm-config --libs)\n+else\n+    err \"either the \\\"CFG_LLVM_ROOT\\\" environment variable must be set, or a \\\n+\\\"llvm-version\\\" script must be present\"\n+fi\n+\n case $CFG_LLVM_VERSION in\n     (3.0svn | 3.0)\n     msg \"found ok version of LLVM: $CFG_LLVM_VERSION\"\n@@ -125,12 +147,6 @@ case $CFG_LLVM_VERSION in\n     err \"bad LLVM version: $CFG_LLVM_VERSION, need >=3.0svn\"\n     ;;\n esac\n-CFG_LLVM_INCDIR=$(llvm-config --includedir)\n-CFG_LLVM_BINDIR=$(llvm-config --bindir)\n-CFG_LLVM_LIBDIR=$(llvm-config --libdir)\n-CFG_LLVM_CXXFLAGS=$(llvm-config --cxxflags)\n-CFG_LLVM_LDFLAGS=$(llvm-config --ldflags)\n-CFG_LLVM_LIBS=$(llvm-config --libs)\n \n putvar CFG_LLVM_INCDIR\n putvar CFG_LLVM_BINDIR"}]}