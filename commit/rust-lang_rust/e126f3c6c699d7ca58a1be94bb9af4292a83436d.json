{"sha": "e126f3c6c699d7ca58a1be94bb9af4292a83436d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUxMjZmM2M2YzY5OWQ3Y2E1OGExYmU5NGJiOWFmNDI5MmE4MzQzNmQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-11-04T23:55:08Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-11-05T17:50:47Z"}, "message": "Merge branch 'selfgate' of https://github.com/petrochenkov/rust into rollup", "tree": {"sha": "b984f31d18305076c65cf3201732cb4cc7752678", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b984f31d18305076c65cf3201732cb4cc7752678"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e126f3c6c699d7ca58a1be94bb9af4292a83436d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e126f3c6c699d7ca58a1be94bb9af4292a83436d", "html_url": "https://github.com/rust-lang/rust/commit/e126f3c6c699d7ca58a1be94bb9af4292a83436d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e126f3c6c699d7ca58a1be94bb9af4292a83436d/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0eff43ff7584d416e6de5d3ade2da1ab17730331", "url": "https://api.github.com/repos/rust-lang/rust/commits/0eff43ff7584d416e6de5d3ade2da1ab17730331", "html_url": "https://github.com/rust-lang/rust/commit/0eff43ff7584d416e6de5d3ade2da1ab17730331"}, {"sha": "50ecee241008a17a3d296f0a0d2a4ff9080a5c57", "url": "https://api.github.com/repos/rust-lang/rust/commits/50ecee241008a17a3d296f0a0d2a4ff9080a5c57", "html_url": "https://github.com/rust-lang/rust/commit/50ecee241008a17a3d296f0a0d2a4ff9080a5c57"}], "stats": {"total": 52, "additions": 52, "deletions": 0}, "files": [{"sha": "d8314bd6c2aedc29cdc7b050ea18ad8bc4a65309", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -3240,6 +3240,16 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             }\n             Def::Struct(..) | Def::Union(..) | Def::TyAlias(..) |\n             Def::AssociatedTy(..) | Def::SelfTy(..) => {\n+                match def {\n+                    Def::AssociatedTy(..) | Def::SelfTy(..)\n+                            if !self.tcx.sess.features.borrow().more_struct_aliases => {\n+                        emit_feature_err(&self.tcx.sess.parse_sess,\n+                                         \"more_struct_aliases\", path.span, GateIssue::Language,\n+                                         \"`Self` and associated types in struct \\\n+                                          expressions and patterns are unstable\");\n+                    }\n+                    _ => {}\n+                }\n                 match ty.sty {\n                     ty::TyAdt(adt, substs) if !adt.is_enum() => {\n                         Some((adt.struct_variant(), adt.did, substs))"}, {"sha": "f29f9ec4e4f255da98a82238376977d3b2698345", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -312,6 +312,9 @@ declare_features! (\n \n     // The #![windows_subsystem] attribute\n     (active, windows_subsystem, \"1.14.0\", Some(37499)),\n+\n+    // Allows using `Self` and associated types in struct expressions and patterns.\n+    (active, more_struct_aliases, \"1.14.0\", Some(37544)),\n );\n \n declare_features! ("}, {"sha": "ecaf269fcb1ae64f0d53bfcf5e95ac7ee247a9e7", "filename": "src/test/compile-fail/struct-path-associated-type.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-associated-type.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(more_struct_aliases)]\n+\n struct S;\n \n trait Tr {"}, {"sha": "a2050182a7e303f80ef4dbad84cbf4cea1a12581", "filename": "src/test/compile-fail/struct-path-self-feature-gate.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-feature-gate.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+struct S;\n+\n+trait Tr {\n+    type A;\n+}\n+\n+fn f<T: Tr<A = S>>() {\n+    let _ = T::A {};\n+    //~^ ERROR `Self` and associated types in struct expressions and patterns are unstable\n+}\n+\n+impl S {\n+    fn f() {\n+        let _ = Self {};\n+        //~^ ERROR `Self` and associated types in struct expressions and patterns are unstable\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "8352bd6751f50dcfd3854a4a5c21f41927e6aa6a", "filename": "src/test/compile-fail/struct-path-self-type-mismatch.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self-type-mismatch.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(more_struct_aliases)]\n+\n struct Foo<A> { inner: A }\n \n trait Bar { fn bar(); }"}, {"sha": "aeac199227b75f1f44a64b3bebf5249c9490cc35", "filename": "src/test/compile-fail/struct-path-self.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-path-self.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(more_struct_aliases)]\n+\n struct S;\n \n trait Tr {"}, {"sha": "292761dfd005f35d9c2697d59a6a2390d99e8db9", "filename": "src/test/run-pass/struct-path-associated-type.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstruct-path-associated-type.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(more_struct_aliases)]\n+\n struct S<T, U = u16> {\n     a: T,\n     b: U,"}, {"sha": "b569ab62c1bfa5469844846cb3acc54813c6b3e0", "filename": "src/test/run-pass/struct-path-self.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e126f3c6c699d7ca58a1be94bb9af4292a83436d/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fstruct-path-self.rs?ref=e126f3c6c699d7ca58a1be94bb9af4292a83436d", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+#![feature(more_struct_aliases)]\n+\n use std::ops::Add;\n \n struct S<T, U = u16> {"}]}