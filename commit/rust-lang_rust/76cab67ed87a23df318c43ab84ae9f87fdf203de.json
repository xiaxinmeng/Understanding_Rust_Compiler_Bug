{"sha": "76cab67ed87a23df318c43ab84ae9f87fdf203de", "node_id": "C_kwDOAAsO6NoAKDc2Y2FiNjdlZDg3YTIzZGYzMThjNDNhYjg0YWU5Zjg3ZmRmMjAzZGU", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2022-11-09T16:05:38Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2022-11-09T16:19:23Z"}, "message": "Add domain size check to fix ICE", "tree": {"sha": "3e20bbb46cbc05634fcc90ff7de0013ca7bf4df6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e20bbb46cbc05634fcc90ff7de0013ca7bf4df6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76cab67ed87a23df318c43ab84ae9f87fdf203de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76cab67ed87a23df318c43ab84ae9f87fdf203de", "html_url": "https://github.com/rust-lang/rust/commit/76cab67ed87a23df318c43ab84ae9f87fdf203de", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76cab67ed87a23df318c43ab84ae9f87fdf203de/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0aaad9e757207657064d70bf9e6c1e6eb327bf15", "url": "https://api.github.com/repos/rust-lang/rust/commits/0aaad9e757207657064d70bf9e6c1e6eb327bf15", "html_url": "https://github.com/rust-lang/rust/commit/0aaad9e757207657064d70bf9e6c1e6eb327bf15"}], "stats": {"total": 62, "additions": 61, "deletions": 1}, "files": [{"sha": "f4562cdfb88dcfdfa07c488896a761f3fef5872f", "filename": "compiler/rustc_middle/src/values.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/76cab67ed87a23df318c43ab84ae9f87fdf203de/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76cab67ed87a23df318c43ab84ae9f87fdf203de/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fvalues.rs?ref=76cab67ed87a23df318c43ab84ae9f87fdf203de", "patch": "@@ -185,7 +185,8 @@ fn find_item_ty_spans(\n                 });\n                 if check_params && let Some(args) = path.segments.last().unwrap().args {\n                     let params_in_repr = tcx.params_in_repr(def_id);\n-                    for (i, arg) in args.args.iter().enumerate() {\n+                    // the domain size check is needed because the HIR may not be well-formed at this point\n+                    for (i, arg) in args.args.iter().enumerate().take(params_in_repr.domain_size()) {\n                         if let hir::GenericArg::Type(ty) = arg && params_in_repr.contains(i as u32) {\n                             find_item_ty_spans(tcx, ty, needle, spans, seen_representable);\n                         }"}, {"sha": "8012cb652bd8857b6ad3e9b299319664c57060d6", "filename": "src/test/ui/parser/issue-103748-ICE-wrong-braces.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/76cab67ed87a23df318c43ab84ae9f87fdf203de/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76cab67ed87a23df318c43ab84ae9f87fdf203de/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.rs?ref=76cab67ed87a23df318c43ab84ae9f87fdf203de", "patch": "@@ -0,0 +1,8 @@\n+#![crate_type = \"lib\"]\n+\n+struct Apple((Apple, Option(Banana ? Citron)));\n+//~^ ERROR invalid `?` in type\n+//~| ERROR expected one of `)` or `,`, found `Citron`\n+//~| ERROR cannot find type `Citron` in this scope [E0412]\n+//~| ERROR parenthesized type parameters may only be used with a `Fn` trait [E0214]\n+//~| ERROR recursive type `Apple` has infinite size [E0072]"}, {"sha": "b0d8b03ae08c3cd714db27b63c55365039696feb", "filename": "src/test/ui/parser/issue-103748-ICE-wrong-braces.stderr", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/76cab67ed87a23df318c43ab84ae9f87fdf203de/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76cab67ed87a23df318c43ab84ae9f87fdf203de/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103748-ICE-wrong-braces.stderr?ref=76cab67ed87a23df318c43ab84ae9f87fdf203de", "patch": "@@ -0,0 +1,51 @@\n+error: invalid `?` in type\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:36\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                    ^ `?` is only allowed on expressions, not types\n+   |\n+help: if you meant to express that the type might not contain a value, use the `Option` wrapper type\n+   |\n+LL | struct Apple((Apple, Option(Option<Banana > Citron)));\n+   |                             +++++++       ~\n+\n+error: expected one of `)` or `,`, found `Citron`\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:38\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                     -^^^^^^ expected one of `)` or `,`\n+   |                                     |\n+   |                                     help: missing `,`\n+\n+error[E0412]: cannot find type `Citron` in this scope\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:38\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                                      ^^^^^^ not found in this scope\n+\n+error[E0214]: parenthesized type parameters may only be used with a `Fn` trait\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:22\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   |                      ^^^^^^^^^^^^^^^^^^^^^^^ only `Fn` traits may use parentheses\n+   |\n+help: use angle brackets instead\n+   |\n+LL | struct Apple((Apple, Option<Banana ? Citron>));\n+   |                            ~               ~\n+\n+error[E0072]: recursive type `Apple` has infinite size\n+  --> $DIR/issue-103748-ICE-wrong-braces.rs:3:1\n+   |\n+LL | struct Apple((Apple, Option(Banana ? Citron)));\n+   | ^^^^^^^^^^^^  ----- recursive without indirection\n+   |\n+help: insert some indirection (e.g., a `Box`, `Rc`, or `&`) to break the cycle\n+   |\n+LL | struct Apple((Box<Apple>, Option(Banana ? Citron)));\n+   |               ++++     +\n+\n+error: aborting due to 5 previous errors\n+\n+Some errors have detailed explanations: E0072, E0214, E0412.\n+For more information about an error, try `rustc --explain E0072`."}]}