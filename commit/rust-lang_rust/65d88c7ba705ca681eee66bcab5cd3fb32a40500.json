{"sha": "65d88c7ba705ca681eee66bcab5cd3fb32a40500", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1ZDg4YzdiYTcwNWNhNjgxZWVlNjZiY2FiNWNkM2ZiMzJhNDA1MDA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-20T18:55:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-20T18:55:48Z"}, "message": "Auto merge of #4011 - phansch:add_test_for_derive_expansion, r=flip1995\n\nAdd test for derives for used_underscore_binding lint\n\nThis closes #852 as I can't reproduce the original issue anymore.\n\nchangelog: none", "tree": {"sha": "e9bc9dff8b4eb7d235d0c0b317034628fe97f09a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9bc9dff8b4eb7d235d0c0b317034628fe97f09a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/65d88c7ba705ca681eee66bcab5cd3fb32a40500", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/65d88c7ba705ca681eee66bcab5cd3fb32a40500", "html_url": "https://github.com/rust-lang/rust/commit/65d88c7ba705ca681eee66bcab5cd3fb32a40500", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/65d88c7ba705ca681eee66bcab5cd3fb32a40500/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54e80c7b34d391ba37f814517ec23f1897cdae18", "url": "https://api.github.com/repos/rust-lang/rust/commits/54e80c7b34d391ba37f814517ec23f1897cdae18", "html_url": "https://github.com/rust-lang/rust/commit/54e80c7b34d391ba37f814517ec23f1897cdae18"}, {"sha": "60a1759b5f2af3b15ac32b5984001e3986c4b9b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/60a1759b5f2af3b15ac32b5984001e3986c4b9b1", "html_url": "https://github.com/rust-lang/rust/commit/60a1759b5f2af3b15ac32b5984001e3986c4b9b1"}], "stats": {"total": 27, "additions": 21, "deletions": 6}, "files": [{"sha": "08b993173029dd69da27acafc6ef2fcaff1faae4", "filename": "tests/ui/auxiliary/proc_macro_derive.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs?ref=65d88c7ba705ca681eee66bcab5cd3fb32a40500", "patch": "@@ -9,7 +9,12 @@ use proc_macro::{quote, TokenStream};\n \n #[proc_macro_derive(DeriveSomething)]\n pub fn derive(_: TokenStream) -> TokenStream {\n+    // Shound not trigger `used_underscore_binding`\n+    let _inside_derive = 1;\n+    assert_eq!(_inside_derive, _inside_derive);\n+\n     let output = quote! {\n+        // Should not trigger `useless_attribute`\n         #[allow(dead_code)]\n         extern crate clippy_lints;\n     };"}, {"sha": "87542252e1fb42aa0c84ad930828645ca89fc0b3", "filename": "tests/ui/used_underscore_binding.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fused_underscore_binding.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fused_underscore_binding.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fused_underscore_binding.rs?ref=65d88c7ba705ca681eee66bcab5cd3fb32a40500", "patch": "@@ -1,7 +1,17 @@\n+// aux-build:proc_macro_derive.rs\n+\n #![warn(clippy::all)]\n #![allow(clippy::blacklisted_name)]\n #![warn(clippy::used_underscore_binding)]\n \n+#[macro_use]\n+extern crate proc_macro_derive;\n+\n+// This should not trigger the lint. There's underscore binding inside the external derive that\n+// would trigger the `used_underscore_binding` lint.\n+#[derive(DeriveSomething)]\n+struct Baz;\n+\n macro_rules! test_macro {\n     () => {{\n         let _foo = 42;\n@@ -51,7 +61,7 @@ fn unused_underscore_complex(mut _foo: u32) -> u32 {\n     1\n }\n \n-///Test that we do not lint for multiple underscores\n+/// Test that we do not lint for multiple underscores\n fn multiple_underscores(__foo: u32) -> u32 {\n     __foo + 1\n }"}, {"sha": "8216a3c66e5bed10a2adc159aa264cb58d669ddb", "filename": "tests/ui/used_underscore_binding.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fused_underscore_binding.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/65d88c7ba705ca681eee66bcab5cd3fb32a40500/tests%2Fui%2Fused_underscore_binding.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fused_underscore_binding.stderr?ref=65d88c7ba705ca681eee66bcab5cd3fb32a40500", "patch": "@@ -1,31 +1,31 @@\n error: used binding `_foo` which is prefixed with an underscore. A leading underscore signals that a binding will not be used.\n-  --> $DIR/used_underscore_binding.rs:14:5\n+  --> $DIR/used_underscore_binding.rs:24:5\n    |\n LL |     _foo + 1\n    |     ^^^^\n    |\n    = note: `-D clippy::used-underscore-binding` implied by `-D warnings`\n \n error: used binding `_foo` which is prefixed with an underscore. A leading underscore signals that a binding will not be used.\n-  --> $DIR/used_underscore_binding.rs:19:20\n+  --> $DIR/used_underscore_binding.rs:29:20\n    |\n LL |     println!(\"{}\", _foo);\n    |                    ^^^^\n \n error: used binding `_foo` which is prefixed with an underscore. A leading underscore signals that a binding will not be used.\n-  --> $DIR/used_underscore_binding.rs:20:16\n+  --> $DIR/used_underscore_binding.rs:30:16\n    |\n LL |     assert_eq!(_foo, _foo);\n    |                ^^^^\n \n error: used binding `_foo` which is prefixed with an underscore. A leading underscore signals that a binding will not be used.\n-  --> $DIR/used_underscore_binding.rs:20:22\n+  --> $DIR/used_underscore_binding.rs:30:22\n    |\n LL |     assert_eq!(_foo, _foo);\n    |                      ^^^^\n \n error: used binding `_underscore_field` which is prefixed with an underscore. A leading underscore signals that a binding will not be used.\n-  --> $DIR/used_underscore_binding.rs:33:5\n+  --> $DIR/used_underscore_binding.rs:43:5\n    |\n LL |     s._underscore_field += 1;\n    |     ^^^^^^^^^^^^^^^^^^^"}]}