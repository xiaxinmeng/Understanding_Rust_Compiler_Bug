{"sha": "87a4a79554b03e2002691b8734d23fb7a556fab1", "node_id": "C_kwDOAAsO6NoAKDg3YTRhNzk1NTRiMDNlMjAwMjY5MWI4NzM0ZDIzZmI3YTU1NmZhYjE", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2021-09-28T16:24:13Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2021-09-28T16:24:13Z"}, "message": "Pick one possible lifetime in case there are multiple choices", "tree": {"sha": "6b07a93a447466b1d4c95e7fa3578680370814d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b07a93a447466b1d4c95e7fa3578680370814d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87a4a79554b03e2002691b8734d23fb7a556fab1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87a4a79554b03e2002691b8734d23fb7a556fab1", "html_url": "https://github.com/rust-lang/rust/commit/87a4a79554b03e2002691b8734d23fb7a556fab1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87a4a79554b03e2002691b8734d23fb7a556fab1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83f147b3baf21acfc367a6da1045d212cd3957e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/83f147b3baf21acfc367a6da1045d212cd3957e4", "html_url": "https://github.com/rust-lang/rust/commit/83f147b3baf21acfc367a6da1045d212cd3957e4"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "4eb7be542e7a1b924ee2c1ce07298037756d9a5f", "filename": "compiler/rustc_borrowck/src/region_infer/opaque_types.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/87a4a79554b03e2002691b8734d23fb7a556fab1/compiler%2Frustc_borrowck%2Fsrc%2Fregion_infer%2Fopaque_types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a4a79554b03e2002691b8734d23fb7a556fab1/compiler%2Frustc_borrowck%2Fsrc%2Fregion_infer%2Fopaque_types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fregion_infer%2Fopaque_types.rs?ref=87a4a79554b03e2002691b8734d23fb7a556fab1", "patch": "@@ -124,7 +124,22 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n             ty::ReVar(vid) => {\n                 // Find something that we can name\n                 let upper_bound = self.approx_universal_upper_bound(vid);\n-                self.definitions[upper_bound].external_name.unwrap_or(region)\n+                let upper_bound = &self.definitions[upper_bound];\n+                match upper_bound.external_name {\n+                    Some(reg) => reg,\n+                    None => {\n+                        // Nothing exact found, so we pick the first one that we find.\n+                        let scc = self.constraint_sccs.scc(vid);\n+                        for vid in self.rev_scc_graph.as_ref().unwrap().upper_bounds(scc) {\n+                            match self.definitions[vid].external_name {\n+                                None => {}\n+                                Some(&ty::ReStatic) => {}\n+                                Some(region) => return region,\n+                            }\n+                        }\n+                        region\n+                    }\n+                }\n             }\n             _ => region,\n         })"}, {"sha": "0fe9b06355f0b8446e60c1dd370a3c9562b86ecb", "filename": "src/test/ui/impl-trait/multiple-lifetimes/ordinary-bounds-unrelated.nll.stderr", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/87a4a79554b03e2002691b8734d23fb7a556fab1/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unrelated.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87a4a79554b03e2002691b8734d23fb7a556fab1/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unrelated.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unrelated.nll.stderr?ref=87a4a79554b03e2002691b8734d23fb7a556fab1", "patch": "@@ -4,7 +4,11 @@ error[E0700]: hidden type for `impl Trait` captures lifetime that does not appea\n LL | fn upper_bounds<'a, 'b, 'c, 'd, 'e>(a: Ordinary<'a>, b: Ordinary<'b>) -> impl Trait<'d, 'e>\n    |                                                                          ^^^^^^^^^^^^^^^^^^\n    |\n-   = note: hidden type `Ordinary<'_>` captures lifetime '_#9r\n+note: hidden type `Ordinary<'b>` captures the lifetime `'b` as defined on the function body at 16:21\n+  --> $DIR/ordinary-bounds-unrelated.rs:16:21\n+   |\n+LL | fn upper_bounds<'a, 'b, 'c, 'd, 'e>(a: Ordinary<'a>, b: Ordinary<'b>) -> impl Trait<'d, 'e>\n+   |                     ^^\n \n error: aborting due to previous error\n "}, {"sha": "6de77523db57710a77afa4ec3c461b57d8c34278", "filename": "src/test/ui/impl-trait/multiple-lifetimes/ordinary-bounds-unsuited.nll.stderr", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/87a4a79554b03e2002691b8734d23fb7a556fab1/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unsuited.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87a4a79554b03e2002691b8734d23fb7a556fab1/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unsuited.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fmultiple-lifetimes%2Fordinary-bounds-unsuited.nll.stderr?ref=87a4a79554b03e2002691b8734d23fb7a556fab1", "patch": "@@ -4,7 +4,11 @@ error[E0700]: hidden type for `impl Trait` captures lifetime that does not appea\n LL | fn upper_bounds<'a, 'b>(a: Ordinary<'a>, b: Ordinary<'b>) -> impl Trait<'a, 'b>\n    |                                                              ^^^^^^^^^^^^^^^^^^\n    |\n-   = note: hidden type `Ordinary<'_>` captures lifetime '_#6r\n+note: hidden type `Ordinary<'b>` captures the lifetime `'b` as defined on the function body at 18:21\n+  --> $DIR/ordinary-bounds-unsuited.rs:18:21\n+   |\n+LL | fn upper_bounds<'a, 'b>(a: Ordinary<'a>, b: Ordinary<'b>) -> impl Trait<'a, 'b>\n+   |                     ^^\n \n error: aborting due to previous error\n "}]}