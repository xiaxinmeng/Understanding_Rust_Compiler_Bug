{"sha": "d6281faf7ed10923594e59f6b275f655c4002685", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2MjgxZmFmN2VkMTA5MjM1OTRlNTlmNmIyNzVmNjU1YzQwMDI2ODU=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2016-12-03T20:39:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-12-03T20:39:53Z"}, "message": "Rollup merge of #38113 - nikomatsakis:incremental-dump-hash, r=michaelwoerister\n\nadd a `-Z incremental-dump-hash` flag\n\nThis causes us to dump a bunch of has information to stdout that can be\nuseful in tracking down incremental compilation invalidations,\nparticularly across crates.", "tree": {"sha": "f6d07a512601b2832826d864fae85a0436ce9b6c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6d07a512601b2832826d864fae85a0436ce9b6c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d6281faf7ed10923594e59f6b275f655c4002685", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d6281faf7ed10923594e59f6b275f655c4002685", "html_url": "https://github.com/rust-lang/rust/commit/d6281faf7ed10923594e59f6b275f655c4002685", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d6281faf7ed10923594e59f6b275f655c4002685/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3231641f44e31b6cb614cede133339ba903bdf78", "url": "https://api.github.com/repos/rust-lang/rust/commits/3231641f44e31b6cb614cede133339ba903bdf78", "html_url": "https://github.com/rust-lang/rust/commit/3231641f44e31b6cb614cede133339ba903bdf78"}, {"sha": "57ffda6158b6b6a119fa8f59b19f321cae9d0850", "url": "https://api.github.com/repos/rust-lang/rust/commits/57ffda6158b6b6a119fa8f59b19f321cae9d0850", "html_url": "https://github.com/rust-lang/rust/commit/57ffda6158b6b6a119fa8f59b19f321cae9d0850"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "79c0ad0d2420957145ddf4140173b90d473ea2b1", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=d6281faf7ed10923594e59f6b275f655c4002685", "patch": "@@ -886,6 +886,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n           \"enable incremental compilation (experimental)\"),\n     incremental_info: bool = (false, parse_bool, [UNTRACKED],\n         \"print high-level information about incremental reuse (or the lack thereof)\"),\n+    incremental_dump_hash: bool = (false, parse_bool, [UNTRACKED],\n+        \"dump hash information in textual format to stdout\"),\n     dump_dep_graph: bool = (false, parse_bool, [UNTRACKED],\n           \"dump the dependency graph to $RUST_DEP_GRAPH (default: /tmp/dep_graph.gv)\"),\n     query_dep_graph: bool = (false, parse_bool, [UNTRACKED],"}, {"sha": "8ff04a565e96b6f437b5ec40da954c5b15ac8007", "filename": "src/librustc_incremental/persist/load.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc_incremental%2Fpersist%2Fload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc_incremental%2Fpersist%2Fload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fload.rs?ref=d6281faf7ed10923594e59f6b275f655c4002685", "patch": "@@ -255,11 +255,24 @@ fn dirty_nodes<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                    current_hash);\n                 continue;\n             }\n+\n+            if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+                println!(\"node {:?} is dirty as hash is {:?} was {:?}\",\n+                         dep_node.map_def(|&def_id| Some(tcx.def_path(def_id))).unwrap(),\n+                         current_hash,\n+                         hash.hash);\n+            }\n+\n             debug!(\"initial_dirty_nodes: {:?} is dirty as hash is {:?}, was {:?}\",\n                    dep_node.map_def(|&def_id| Some(tcx.def_path(def_id))).unwrap(),\n                    current_hash,\n                    hash.hash);\n         } else {\n+            if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+                println!(\"node {:?} is dirty as it was removed\",\n+                         hash.dep_node);\n+            }\n+\n             debug!(\"initial_dirty_nodes: {:?} is dirty as it was removed\",\n                    hash.dep_node);\n         }"}, {"sha": "1ce4bf7f033417735a3fe09c160ee06a71177a8e", "filename": "src/librustc_incremental/persist/save.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d6281faf7ed10923594e59f6b275f655c4002685/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs?ref=d6281faf7ed10923594e59f6b275f655c4002685", "patch": "@@ -159,6 +159,12 @@ pub fn encode_dep_graph(preds: &Predecessors,\n         }\n     }\n \n+    if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+        for (dep_node, hash) in &preds.hashes {\n+            println!(\"HIR hash for {:?} is {}\", dep_node, hash);\n+        }\n+    }\n+\n     // Create the serialized dep-graph.\n     let graph = SerializedDepGraph {\n         edges: edges,\n@@ -248,6 +254,15 @@ pub fn encode_metadata_hashes(tcx: TyCtxt,\n         let hash = state.finish();\n \n         debug!(\"save: metadata hash for {:?} is {}\", def_id, hash);\n+\n+        if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+            println!(\"metadata hash for {:?} is {}\", def_id, hash);\n+            for dep_node in sources {\n+                println!(\"metadata hash for {:?} depends on {:?} with hash {}\",\n+                         def_id, dep_node, preds.hashes[dep_node]);\n+            }\n+        }\n+\n         serialized_hashes.hashes.push(SerializedMetadataHash {\n             def_index: def_id.index,\n             hash: hash,"}]}