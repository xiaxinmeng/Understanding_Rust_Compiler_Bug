{"sha": "7248b79082cbf699571bfae33f50b4669e28fa50", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyNDhiNzkwODJjYmY2OTk1NzFiZmFlMzNmNTBiNDY2OWUyOGZhNTA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-09-22T07:56:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-09-22T07:56:33Z"}, "message": "Rollup merge of #54371 - QuietMisdreavus:rustdoc-ui-testing, r=GuillaumeGomez\n\nadd -Zui-testing to rustdoc\n\nBefore we depend on the `rustdoc-ui` tests some more, let's make rustdoc act the same as the compiler when they're actually being executed.", "tree": {"sha": "6b99b73842f3ad9ca769b9f0ea2156f611742d29", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b99b73842f3ad9ca769b9f0ea2156f611742d29"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7248b79082cbf699571bfae33f50b4669e28fa50", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbpfWxCRBK7hj4Ov3rIwAAdHIIAAmEon1Vwv73QDs7AxWX+QZX\n4yTKo6MlutQ/oJBug32dl3Z3Tgd9J0BjshANz/KWUBEDsYgZmOCsS2p4Qp300nc7\nqG3jsd00jY+D0NJko0pujs6stFXsvmMD1nhi8eJ3Y/gJfmnBsMN0QKPjDi9MKE8i\nuZRfhrQL+4y3DpyfYXkHsrjAnBeNbA8UstUkZExu7ExzRKXNv49Ue0+Cgef65MKs\n/M4fiawbUJvY5WnoGMYF5fLgCEmvHQ272ITXRUylZfz4zmCWsJUsGfr9Xf6CrxPU\naT2CF6oA4+DZfSNsBko1s+9og4LsBPbD9xcU/yL0GRdmO8YF5gI2liXkIvNTud8=\n=TLaf\n-----END PGP SIGNATURE-----\n", "payload": "tree 6b99b73842f3ad9ca769b9f0ea2156f611742d29\nparent 167a045e2eb79b9a7579b88b82875b6d85f1979e\nparent 93321671caf0bf04613db660bfa6228579fb2bbe\nauthor Pietro Albini <pietro@pietroalbini.org> 1537602993 +0200\ncommitter GitHub <noreply@github.com> 1537602993 +0200\n\nRollup merge of #54371 - QuietMisdreavus:rustdoc-ui-testing, r=GuillaumeGomez\n\nadd -Zui-testing to rustdoc\n\nBefore we depend on the `rustdoc-ui` tests some more, let's make rustdoc act the same as the compiler when they're actually being executed.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7248b79082cbf699571bfae33f50b4669e28fa50", "html_url": "https://github.com/rust-lang/rust/commit/7248b79082cbf699571bfae33f50b4669e28fa50", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7248b79082cbf699571bfae33f50b4669e28fa50/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "167a045e2eb79b9a7579b88b82875b6d85f1979e", "url": "https://api.github.com/repos/rust-lang/rust/commits/167a045e2eb79b9a7579b88b82875b6d85f1979e", "html_url": "https://github.com/rust-lang/rust/commit/167a045e2eb79b9a7579b88b82875b6d85f1979e"}, {"sha": "93321671caf0bf04613db660bfa6228579fb2bbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/93321671caf0bf04613db660bfa6228579fb2bbe", "html_url": "https://github.com/rust-lang/rust/commit/93321671caf0bf04613db660bfa6228579fb2bbe"}], "stats": {"total": 85, "additions": 48, "deletions": 37}, "files": [{"sha": "98252b81fd57aa873f888eb1ddd798caef3be2c4", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -272,6 +272,7 @@ impl DocAccessLevels for AccessLevels<DefId> {\n pub fn new_handler(error_format: ErrorOutputType,\n                    source_map: Option<Lrc<source_map::SourceMap>>,\n                    treat_err_as_bug: bool,\n+                   ui_testing: bool,\n ) -> errors::Handler {\n     // rustdoc doesn't override (or allow to override) anything from this that is relevant here, so\n     // stick to the defaults\n@@ -283,7 +284,7 @@ pub fn new_handler(error_format: ErrorOutputType,\n                 source_map.map(|cm| cm as _),\n                 false,\n                 sessopts.debugging_opts.teach,\n-            ).ui_testing(sessopts.debugging_opts.ui_testing)\n+            ).ui_testing(ui_testing)\n         ),\n         ErrorOutputType::Json(pretty) => {\n             let source_map = source_map.unwrap_or_else(\n@@ -293,7 +294,7 @@ pub fn new_handler(error_format: ErrorOutputType,\n                     None,\n                     source_map,\n                     pretty,\n-                ).ui_testing(sessopts.debugging_opts.ui_testing)\n+                ).ui_testing(ui_testing)\n             )\n         },\n         ErrorOutputType::Short(color_config) => Box::new(\n@@ -335,6 +336,7 @@ pub fn run_core(search_paths: SearchPaths,\n                 mut manual_passes: Vec<String>,\n                 mut default_passes: passes::DefaultPassOption,\n                 treat_err_as_bug: bool,\n+                ui_testing: bool,\n ) -> (clean::Crate, RenderInfo, Vec<String>) {\n     // Parse, resolve, and typecheck the given crate.\n \n@@ -389,6 +391,8 @@ pub fn run_core(search_paths: SearchPaths,\n         actually_rustdoc: true,\n         debugging_opts: config::DebuggingOptions {\n             force_unstable_if_unmarked,\n+            treat_err_as_bug,\n+            ui_testing,\n             ..config::basic_debugging_options()\n         },\n         error_format,\n@@ -400,7 +404,8 @@ pub fn run_core(search_paths: SearchPaths,\n         let source_map = Lrc::new(source_map::SourceMap::new(sessopts.file_path_mapping()));\n         let diagnostic_handler = new_handler(error_format,\n                                              Some(source_map.clone()),\n-                                             treat_err_as_bug);\n+                                             treat_err_as_bug,\n+                                             ui_testing);\n \n         let mut sess = session::build_session_(\n             sessopts, cpath, diagnostic_handler, source_map,"}, {"sha": "2456a5ad14acc61e15c81d5b4cd961d9122bef72", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -409,8 +409,11 @@ fn main_args(args: &[String]) -> isize {\n     let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n         *x == \"treat-err-as-bug\"\n     });\n+    let ui_testing = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"ui-testing\"\n+    });\n \n-    let diag = core::new_handler(error_format, None, treat_err_as_bug);\n+    let diag = core::new_handler(error_format, None, treat_err_as_bug, ui_testing);\n \n     // check for deprecated options\n     check_deprecated_options(&matches, &diag);\n@@ -565,7 +568,7 @@ fn main_args(args: &[String]) -> isize {\n     let res = acquire_input(PathBuf::from(input), externs, edition, cg, &matches, error_format,\n                             move |out| {\n         let Output { krate, passes, renderinfo } = out;\n-        let diag = core::new_handler(error_format, None, treat_err_as_bug);\n+        let diag = core::new_handler(error_format, None, treat_err_as_bug, ui_testing);\n         info!(\"going to format\");\n         match output_format.as_ref().map(|s| &**s) {\n             Some(\"html\") | None => {\n@@ -702,6 +705,9 @@ where R: 'static + Send,\n     let treat_err_as_bug = matches.opt_strs(\"Z\").iter().any(|x| {\n         *x == \"treat-err-as-bug\"\n     });\n+    let ui_testing = matches.opt_strs(\"Z\").iter().any(|x| {\n+        *x == \"ui-testing\"\n+    });\n \n     let (lint_opts, describe_lints, lint_cap) = get_cmd_lint_options(matches, error_format);\n \n@@ -715,7 +721,7 @@ where R: 'static + Send,\n                            display_warnings, crate_name.clone(),\n                            force_unstable_if_unmarked, edition, cg, error_format,\n                            lint_opts, lint_cap, describe_lints, manual_passes, default_passes,\n-                           treat_err_as_bug);\n+                           treat_err_as_bug, ui_testing);\n \n         info!(\"finished with rustc\");\n "}, {"sha": "b82cbc1ab36fdb6893a7e32661fa4b4aff8360a5", "filename": "src/test/rustdoc-ui/deny-intra-link-resolution-failure.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-intra-link-resolution-failure.stderr?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -1,13 +1,13 @@\n error: `[v2]` cannot be resolved, ignoring it...\n   --> $DIR/deny-intra-link-resolution-failure.rs:13:6\n    |\n-13 | /// [v2] //~ ERROR\n+LL | /// [v2] //~ ERROR\n    |      ^^ cannot be resolved, ignoring\n    |\n note: lint level defined here\n   --> $DIR/deny-intra-link-resolution-failure.rs:11:9\n    |\n-11 | #![deny(intra_doc_link_resolution_failure)]\n+LL | #![deny(intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n "}, {"sha": "5bd62d60b48f3966c2d154fd5bd3600deb0839c4", "filename": "src/test/rustdoc-ui/deprecated-attrs.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeprecated-attrs.stderr?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -1,9 +1,9 @@\n warning: the `#![doc(no_default_passes)]` attribute is considered deprecated\n-  |\n-  = warning: please see https://github.com/rust-lang/rust/issues/44136\n-  = help: you may want to use `#![doc(document_private_items)]`\n+   |\n+   = warning: please see https://github.com/rust-lang/rust/issues/44136\n+   = help: you may want to use `#![doc(document_private_items)]`\n \n warning: the `#![doc(passes = \"...\")]` attribute is considered deprecated\n-  |\n-  = warning: please see https://github.com/rust-lang/rust/issues/44136\n+   |\n+   = warning: please see https://github.com/rust-lang/rust/issues/44136\n "}, {"sha": "498d02a7d1caf00b7ca71f591cf9a597436c39e8", "filename": "src/test/rustdoc-ui/intra-doc-alias-ice.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -1,13 +1,13 @@\n error: `[TypeAlias::hoge]` cannot be resolved, ignoring it...\n   --> $DIR/intra-doc-alias-ice.rs:15:30\n    |\n-15 | /// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n+LL | /// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n    |                              ^^^^^^^^^^^^^^^ cannot be resolved, ignoring\n    |\n note: lint level defined here\n   --> $DIR/intra-doc-alias-ice.rs:11:9\n    |\n-11 | #![deny(intra_doc_link_resolution_failure)]\n+LL | #![deny(intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n "}, {"sha": "c05f99fadc9e4bce2ab0255978b46cb1a2d3d487", "filename": "src/test/rustdoc-ui/intra-links-warning.stderr", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7248b79082cbf699571bfae33f50b4669e28fa50/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-links-warning.stderr?ref=7248b79082cbf699571bfae33f50b4669e28fa50", "patch": "@@ -1,7 +1,7 @@\n warning: `[Foo::baz]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:13:23\n    |\n-13 |        //! Test with [Foo::baz], [Bar::foo], ...\n+LL |        //! Test with [Foo::baz], [Bar::foo], ...\n    |                       ^^^^^^^^ cannot be resolved, ignoring\n    |\n    = note: #[warn(intra_doc_link_resolution_failure)] on by default\n@@ -10,67 +10,67 @@ warning: `[Foo::baz]` cannot be resolved, ignoring it...\n warning: `[Bar::foo]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:13:35\n    |\n-13 |        //! Test with [Foo::baz], [Bar::foo], ...\n+LL |        //! Test with [Foo::baz], [Bar::foo], ...\n    |                                   ^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Uniooon::X]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:14:13\n    |\n-14 |      //! , [Uniooon::X] and [Qux::Z].\n+LL |      //! , [Uniooon::X] and [Qux::Z].\n    |             ^^^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux::Z]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:14:30\n    |\n-14 |      //! , [Uniooon::X] and [Qux::Z].\n+LL |      //! , [Uniooon::X] and [Qux::Z].\n    |                              ^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Uniooon::X]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:16:14\n    |\n-16 |       //! , [Uniooon::X] and [Qux::Z].\n+LL |       //! , [Uniooon::X] and [Qux::Z].\n    |              ^^^^^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux::Z]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:16:31\n    |\n-16 |       //! , [Uniooon::X] and [Qux::Z].\n+LL |       //! , [Uniooon::X] and [Qux::Z].\n    |                               ^^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[Qux:Y]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:18:13\n    |\n-18 |        /// [Qux:Y]\n+LL |        /// [Qux:Y]\n    |             ^^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[BarA]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:24:10\n    |\n-24 | /// bar [BarA] bar\n+LL | /// bar [BarA] bar\n    |          ^^^^ cannot be resolved, ignoring\n    |\n    = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n \n warning: `[BarB]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:28:1\n    |\n-28 | / /**\n-29 | |  * Foo\n-30 | |  * bar [BarB] bar\n-31 | |  * baz\n-32 | |  */\n+LL | / /**\n+LL | |  * Foo\n+LL | |  * bar [BarB] bar\n+LL | |  * baz\n+LL | |  */\n    | |___^\n    |\n    = note: the link appears in this line:\n@@ -82,13 +82,13 @@ warning: `[BarB]` cannot be resolved, ignoring it...\n warning: `[BarC]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:35:1\n    |\n-35 | / /** Foo\n-36 | |\n-37 | | bar [BarC] bar\n-38 | | baz\n+LL | / /** Foo\n+LL | |\n+LL | | bar [BarC] bar\n+LL | | baz\n ...  |\n-44 | |\n-45 | | */\n+LL | |\n+LL | | */\n    | |__^\n    |\n    = note: the link appears in this line:\n@@ -100,7 +100,7 @@ warning: `[BarC]` cannot be resolved, ignoring it...\n warning: `[BarD]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:48:1\n    |\n-48 | #[doc = \"Foo/nbar [BarD] bar/nbaz\"]\n+LL | #[doc = \"Foo/nbar [BarD] bar/nbaz\"]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: the link appears in this line:\n@@ -112,10 +112,10 @@ warning: `[BarD]` cannot be resolved, ignoring it...\n warning: `[BarF]` cannot be resolved, ignoring it...\n   --> $DIR/intra-links-warning.rs:53:9\n    |\n-53 |         #[doc = $f]\n+LL |         #[doc = $f]\n    |         ^^^^^^^^^^^\n ...\n-57 | f!(\"Foo/nbar [BarF] bar/nbaz\");\n+LL | f!(\"Foo/nbar [BarF] bar/nbaz\");\n    | ------------------------------- in this macro invocation\n    |\n    = note: the link appears in this line:"}]}