{"sha": "4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f", "node_id": "C_kwDOAAsO6NoAKDRiNTNmNTYzYmQ1YjBmMGU5Y2FkMjZkYmYyNTE0ZjlhNzJjM2ZhMmY", "commit": {"author": {"name": "J\u00f6rn Horstmann", "email": "git@jhorstmann.net", "date": "2022-03-25T12:00:49Z"}, "committer": {"name": "J\u00f6rn Horstmann", "email": "git@jhorstmann.net", "date": "2022-03-25T12:28:19Z"}, "message": "Add a test verifying the number of drop calls", "tree": {"sha": "0cefb35170faca7906d0d015ee243b8a5e077f3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cefb35170faca7906d0d015ee243b8a5e077f3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f", "html_url": "https://github.com/rust-lang/rust/commit/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f/comments", "author": {"login": "jhorstmann", "id": 689138, "node_id": "MDQ6VXNlcjY4OTEzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/689138?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhorstmann", "html_url": "https://github.com/jhorstmann", "followers_url": "https://api.github.com/users/jhorstmann/followers", "following_url": "https://api.github.com/users/jhorstmann/following{/other_user}", "gists_url": "https://api.github.com/users/jhorstmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhorstmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhorstmann/subscriptions", "organizations_url": "https://api.github.com/users/jhorstmann/orgs", "repos_url": "https://api.github.com/users/jhorstmann/repos", "events_url": "https://api.github.com/users/jhorstmann/events{/privacy}", "received_events_url": "https://api.github.com/users/jhorstmann/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhorstmann", "id": 689138, "node_id": "MDQ6VXNlcjY4OTEzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/689138?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhorstmann", "html_url": "https://github.com/jhorstmann", "followers_url": "https://api.github.com/users/jhorstmann/followers", "following_url": "https://api.github.com/users/jhorstmann/following{/other_user}", "gists_url": "https://api.github.com/users/jhorstmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhorstmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhorstmann/subscriptions", "organizations_url": "https://api.github.com/users/jhorstmann/orgs", "repos_url": "https://api.github.com/users/jhorstmann/repos", "events_url": "https://api.github.com/users/jhorstmann/events{/privacy}", "received_events_url": "https://api.github.com/users/jhorstmann/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d14c0d2acb3ff1d0111920185109c9697a3cd460", "url": "https://api.github.com/repos/rust-lang/rust/commits/d14c0d2acb3ff1d0111920185109c9697a3cd460", "html_url": "https://github.com/rust-lang/rust/commit/d14c0d2acb3ff1d0111920185109c9697a3cd460"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "ab2414a6dc0b434928f177ec0cc33247ecffd1b6", "filename": "library/alloc/tests/vec.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f/library%2Falloc%2Ftests%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f/library%2Falloc%2Ftests%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fvec.rs?ref=4b53f563bd5b0f0e9cad26dbf2514f9a72c3fa2f", "patch": "@@ -1,3 +1,6 @@\n+use core::alloc::{Allocator, Layout};\n+use core::ptr::NonNull;\n+use std::alloc::System;\n use std::assert_matches::assert_matches;\n use std::borrow::Cow;\n use std::cell::Cell;\n@@ -991,6 +994,27 @@ fn test_into_iter_advance_by() {\n     assert_eq!(i.len(), 0);\n }\n \n+#[test]\n+fn test_into_iter_drop_allocator() {\n+    struct ReferenceCountedAllocator<'a>(DropCounter<'a>);\n+\n+    unsafe impl Allocator for ReferenceCountedAllocator<'_> {\n+        fn allocate(&self, layout: Layout) -> Result<NonNull<[u8]>, core::alloc::AllocError> {\n+            System.allocate(layout)\n+        }\n+\n+        unsafe fn deallocate(&self, ptr: NonNull<u8>, layout: Layout) {\n+            System.deallocate(ptr, layout)\n+        }\n+    }\n+\n+    let mut drop_count = 0;\n+    let allocator = ReferenceCountedAllocator(DropCounter { count: &mut drop_count });\n+    let _ = Vec::<u32, _>::new_in(allocator).into_iter();\n+\n+    assert_eq!(drop_count, 1);\n+}\n+\n #[test]\n fn test_from_iter_specialization() {\n     let src: Vec<usize> = vec![0usize; 1];"}]}