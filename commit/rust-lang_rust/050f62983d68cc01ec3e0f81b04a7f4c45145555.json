{"sha": "050f62983d68cc01ec3e0f81b04a7f4c45145555", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MGY2Mjk4M2Q2OGNjMDFlYzNlMGY4MWIwNGE3ZjRjNDUxNDU1NTU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-16T23:08:26Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-06-16T23:08:26Z"}, "message": "stdlib: Introduce an ivec module into the standard library; add a minimal test case", "tree": {"sha": "156908acdf5bb727b3e0e40bbd5c28a5f8345b41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/156908acdf5bb727b3e0e40bbd5c28a5f8345b41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/050f62983d68cc01ec3e0f81b04a7f4c45145555", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/050f62983d68cc01ec3e0f81b04a7f4c45145555", "html_url": "https://github.com/rust-lang/rust/commit/050f62983d68cc01ec3e0f81b04a7f4c45145555", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/050f62983d68cc01ec3e0f81b04a7f4c45145555/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94cd2985b267dd8462f2518c5d9109b4e0f71402", "url": "https://api.github.com/repos/rust-lang/rust/commits/94cd2985b267dd8462f2518c5d9109b4e0f71402", "html_url": "https://github.com/rust-lang/rust/commit/94cd2985b267dd8462f2518c5d9109b4e0f71402"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "7acbbed1219eebe5fb73d05bb1d7e23c61a7ec5c", "filename": "src/lib/ivec.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Flib%2Fivec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Flib%2Fivec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fivec.rs?ref=050f62983d68cc01ec3e0f81b04a7f4c45145555", "patch": "@@ -0,0 +1,25 @@\n+// Interior vector utility functions.\n+\n+import option::none;\n+import option::some;\n+\n+type operator2[T,U,V] = fn(&T, &U) -> V;\n+\n+native \"rust-intrinsic\" mod rusti {\n+    fn ivec_len[T](&T[] v) -> uint;\n+}\n+\n+native \"rust\" mod rustrt {\n+    fn ivec_reserve[T](&mutable T[] v, uint n);\n+    fn ivec_on_heap[T](&T[] v) -> bool;\n+}\n+\n+/// Reserves space for `n` elements in the given vector.\n+fn reserve[T](&mutable T[] v, uint n) {\n+    rustrt::ivec_reserve(v, n);\n+}\n+\n+fn on_heap[T](&T[] v) -> bool {\n+    ret rustrt::ivec_on_heap(v);\n+}\n+"}, {"sha": "0d07c6a39729877aa60ec39ba1e6ac8250307dc1", "filename": "src/lib/std.rc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Flib%2Fstd.rc", "raw_url": "https://github.com/rust-lang/rust/raw/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Flib%2Fstd.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Fstd.rc?ref=050f62983d68cc01ec3e0f81b04a7f4c45145555", "patch": "@@ -12,6 +12,7 @@ mod int;\n mod uint;\n mod u8;\n mod vec;\n+mod ivec;\n mod str;\n \n // General io and system-services modules."}, {"sha": "892cdc0cb0b463d497b4482480ab716134861054", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=050f62983d68cc01ec3e0f81b04a7f4c45145555", "patch": "@@ -606,6 +606,16 @@ ivec_reserve(rust_task *task, type_desc *ty, rust_ivec *v, size_t n_elems)\n     v->alloc = new_alloc;\n }\n \n+/**\n+ * Returns true if the given vector is on the heap and false if it's on the\n+ * stack.\n+ */\n+extern \"C\" bool\n+ivec_on_heap(rust_task *task, type_desc *ty, rust_ivec *v)\n+{\n+    return !v->fill && v->payload.ptr;\n+}\n+\n \n //\n // Local Variables:"}, {"sha": "13ab62fb29d8c6f0bc1e998b071687ae1022c86a", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=050f62983d68cc01ec3e0f81b04a7f4c45145555", "patch": "@@ -9,6 +9,7 @@ debug_trap\n debug_tydesc\n do_gc\n get_time\n+ivec_on_heap\n ivec_reserve\n last_os_error\n rand_free"}, {"sha": "93de7aed0e95bc519606e8b3cd986d92cf2313e1", "filename": "src/test/run-pass/lib-ivec.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Ftest%2Frun-pass%2Flib-ivec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/050f62983d68cc01ec3e0f81b04a7f4c45145555/src%2Ftest%2Frun-pass%2Flib-ivec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-ivec.rs?ref=050f62983d68cc01ec3e0f81b04a7f4c45145555", "patch": "@@ -0,0 +1,16 @@\n+// xfail-stage0\n+\n+use std;\n+import std::ivec;\n+\n+fn test_reserve_and_on_heap() {\n+    let int[] v = ~[ 1, 2 ];\n+    assert (!ivec::on_heap(v));\n+    ivec::reserve(v, 8u);\n+    assert (ivec::on_heap(v));\n+}\n+\n+fn main() {\n+    test_reserve_and_on_heap();\n+}\n+"}]}