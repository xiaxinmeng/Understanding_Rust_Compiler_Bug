{"sha": "f65a907ef9e21a350118d2efa323ebf49c3ec1cf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2NWE5MDdlZjllMjFhMzUwMTE4ZDJlZmEzMjNlYmY0OWMzZWMxY2Y=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-01-08T20:56:34Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2017-01-08T21:12:13Z"}, "message": "Use fold instead of collect/join and add comments", "tree": {"sha": "5b8d7b8048bb07aeacce50264b6035b4c4efa332", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b8d7b8048bb07aeacce50264b6035b4c4efa332"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f65a907ef9e21a350118d2efa323ebf49c3ec1cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f65a907ef9e21a350118d2efa323ebf49c3ec1cf", "html_url": "https://github.com/rust-lang/rust/commit/f65a907ef9e21a350118d2efa323ebf49c3ec1cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f65a907ef9e21a350118d2efa323ebf49c3ec1cf/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43b10fa8ed3dd96684ec89812dc7810431cd0d01", "url": "https://api.github.com/repos/rust-lang/rust/commits/43b10fa8ed3dd96684ec89812dc7810431cd0d01", "html_url": "https://github.com/rust-lang/rust/commit/43b10fa8ed3dd96684ec89812dc7810431cd0d01"}], "stats": {"total": 49, "additions": 39, "deletions": 10}, "files": [{"sha": "88373bf988da790369fa2af7b0fbfe48e12cfaf9", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 39, "deletions": 10, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/f65a907ef9e21a350118d2efa323ebf49c3ec1cf/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f65a907ef9e21a350118d2efa323ebf49c3ec1cf/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=f65a907ef9e21a350118d2efa323ebf49c3ec1cf", "patch": "@@ -924,19 +924,48 @@ impl EmitterWriter {\n                             }\n                         },\n                         None => {\n+                            // Diagnostic with lists need to render the list items at the\n+                            // appropriate depth and composed into the body of the message.\n                             let msg = if child.list.len() == 0 {\n+                                // Diagnostics without lists just need the original message\n                                 child.message.to_owned()\n                             } else {\n-                                format!(\"{}\\n{}\",\n-                                        &child.message,\n-                                        &child.list.iter().map(|item| {\n-                                            format!(\"{}         - {}\",\n-                                                    (0..max_line_num_len)\n-                                                          .map(|_| \" \")\n-                                                          .collect::<String>(),\n-                                                    item)\n-                                        }).collect::<Vec<String>>()\n-                                        .join(\"\\n\"))\n+                                // Diagnostic with a list of items needs to be rendered with the\n+                                // appropriate padding at the left to have a consistent margin with\n+                                // the `note: ` text.\n+\n+                                // Add as many ` ` chars at the beggining to align the `- item`\n+                                // text to the beggining of the `note: ` text. The extra 9 ` ` is\n+                                // the padding that's always needed to align to the `note: `.\n+                                let padding = (0..max_line_num_len + 9)\n+                                    .map(|_| \" \")\n+                                    .collect::<String>();\n+\n+                                // Concatenate the message and all the list items, properly aligned\n+                                child.list.iter().fold(child.message.to_owned(), |mut acc, x| {\n+                                    acc.push_str(\"\\n\");\n+                                    acc.push_str(&padding);\n+                                    acc.push_str(\"- \");\n+                                    acc.push_str(x);\n+                                    acc\n+                                })\n+                                // msg will now be:\n+                                //\n+                                //     child.message's content\n+                                //              - item 1\n+                                //              - item 2\n+                                //\n+                                // and the diagnostic will look like\n+                                //\n+                                //     error: message\n+                                //      --> file.rs:3:20\n+                                //       |\n+                                //     3 |     <Code>\n+                                //       |      ^^^^ highlight\n+                                //       |\n+                                //       = help: child.message's content\n+                                //               - item 1\n+                                //               - item 2\n                             };\n                             match self.emit_message_default(&child.span,\n                                                             &msg,"}]}