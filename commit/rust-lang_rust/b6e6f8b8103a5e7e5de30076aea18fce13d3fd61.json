{"sha": "b6e6f8b8103a5e7e5de30076aea18fce13d3fd61", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2ZTZmOGI4MTAzYTVlN2U1ZGUzMDA3NmFlYTE4ZmNlMTNkM2ZkNjE=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-09T10:13:18Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-09T10:13:18Z"}, "message": "Fix scope issue in resolution of alt-arm patterns\n\nCloses #885", "tree": {"sha": "0ed71119d8b612c72d88a6de9ca2d1767e0202ec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ed71119d8b612c72d88a6de9ca2d1767e0202ec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61", "html_url": "https://github.com/rust-lang/rust/commit/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87c6416d0caff986965a40b038c919d12014ee30", "url": "https://api.github.com/repos/rust-lang/rust/commits/87c6416d0caff986965a40b038c919d12014ee30", "html_url": "https://github.com/rust-lang/rust/commit/87c6416d0caff986965a40b038c919d12014ee30"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "ae52009bb66f0343059a635493e2a8385a9d9649", "filename": "src/comp/middle/resolve.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61/src%2Fcomp%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6e6f8b8103a5e7e5de30076aea18fce13d3fd61/src%2Fcomp%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fresolve.rs?ref=b6e6f8b8103a5e7e5de30076aea18fce13d3fd61", "patch": "@@ -275,7 +275,7 @@ fn resolve_names(e: &@env, c: &@ast::crate) {\n           visit_item: visit_item_with_scope,\n           visit_block: visit_block_with_scope,\n           visit_decl: visit_decl_with_scope,\n-          visit_arm: walk_arm,\n+          visit_arm: visit_arm_with_scope,\n           visit_pat: bind walk_pat(e, _, _, _),\n           visit_expr: bind walk_expr(e, _, _, _),\n           visit_ty: bind walk_ty(e, _, _, _),\n@@ -310,9 +310,6 @@ fn resolve_names(e: &@env, c: &@ast::crate) {\n                    sc: &scopes, _v: &vt<scopes>) {\n         maybe_insert(e, id, lookup_path_strict(*e, sc, sp, p.node, ns_value));\n     }\n-    fn walk_arm(a: &ast::arm, sc: &scopes, v: &vt<scopes>) {\n-        visit_arm_with_scope(a, sc, v);\n-    }\n     fn walk_pat(e: &@env, pat: &@ast::pat, sc: &scopes, v: &vt<scopes>) {\n         visit::visit_pat(pat, sc, v);\n         alt pat.node {\n@@ -398,7 +395,10 @@ fn visit_decl_with_scope(d: &@decl, sc: &scopes, v: &vt<scopes>) {\n }\n \n fn visit_arm_with_scope(a: &ast::arm, sc: &scopes, v: &vt<scopes>) {\n-    visit::visit_arm(a, cons(scope_arm(a), @sc), v);\n+    for p: @pat in a.pats { v.visit_pat(p, sc, v); }\n+    let sc_inner = cons(scope_arm(a), @sc);\n+    visit::visit_expr_opt(a.guard, sc_inner, v);\n+    v.visit_block(a.body, sc_inner, v);\n }\n \n fn visit_expr_with_scope(x: &@ast::expr, sc: &scopes, v: &vt<scopes>) {"}]}