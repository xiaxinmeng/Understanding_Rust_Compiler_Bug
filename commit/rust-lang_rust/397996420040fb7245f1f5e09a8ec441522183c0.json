{"sha": "397996420040fb7245f1f5e09a8ec441522183c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5Nzk5NjQyMDA0MGZiNzI0NWYxZjVlMDlhOGVjNDQxNTIyMTgzYzA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-17T12:27:56Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-03-24T05:28:56Z"}, "message": "defatalize expand_test_or_bench", "tree": {"sha": "38f8f3ac384706e13c5a6ad0b371a3971f8054d0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/38f8f3ac384706e13c5a6ad0b371a3971f8054d0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/397996420040fb7245f1f5e09a8ec441522183c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/397996420040fb7245f1f5e09a8ec441522183c0", "html_url": "https://github.com/rust-lang/rust/commit/397996420040fb7245f1f5e09a8ec441522183c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/397996420040fb7245f1f5e09a8ec441522183c0/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0e0f9311dacad865c43953a1015ac00a010e19df", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e0f9311dacad865c43953a1015ac00a010e19df", "html_url": "https://github.com/rust-lang/rust/commit/0e0f9311dacad865c43953a1015ac00a010e19df"}], "stats": {"total": 36, "additions": 26, "deletions": 10}, "files": [{"sha": "bdc4ae2fe274b9598ef2cca04a10e1b578714b11", "filename": "src/librustc_builtin_macros/test.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/397996420040fb7245f1f5e09a8ec441522183c0/src%2Flibrustc_builtin_macros%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/397996420040fb7245f1f5e09a8ec441522183c0/src%2Flibrustc_builtin_macros%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_builtin_macros%2Ftest.rs?ref=397996420040fb7245f1f5e09a8ec441522183c0", "patch": "@@ -74,16 +74,16 @@ pub fn expand_test_or_bench(\n         return vec![];\n     }\n \n-    let item = if let Annotatable::Item(i) = item {\n-        i\n-    } else {\n-        cx.parse_sess\n-            .span_diagnostic\n-            .span_fatal(\n-                item.span(),\n+    let item = match item {\n+        Annotatable::Item(i) => i,\n+        other => {\n+            cx.struct_span_err(\n+                other.span(),\n                 \"`#[test]` attribute is only allowed on non associated functions\",\n             )\n-            .raise();\n+            .emit();\n+            return vec![other];\n+        }\n     };\n \n     if let ast::ItemKind::MacCall(_) = item.kind {"}, {"sha": "31e567c396067495eb1e8c9b55d7cda283faa659", "filename": "src/test/ui/test-attrs/test-attr-non-associated-functions.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/397996420040fb7245f1f5e09a8ec441522183c0/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/397996420040fb7245f1f5e09a8ec441522183c0/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.rs?ref=397996420040fb7245f1f5e09a8ec441522183c0", "patch": "@@ -6,7 +6,13 @@ struct A {}\n \n impl A {\n     #[test]\n-    fn new() -> A { //~ ERROR `#[test]` attribute is only allowed on non associated functions\n+    fn new() -> A {\n+        //~^ ERROR `#[test]` attribute is only allowed on non associated functions\n+        A {}\n+    }\n+    #[test]\n+    fn recovery_witness() -> A {\n+        //~^ ERROR `#[test]` attribute is only allowed on non associated functions\n         A {}\n     }\n }"}, {"sha": "a81b8f3980c374c7bc7c1112fc2a260d5a03f813", "filename": "src/test/ui/test-attrs/test-attr-non-associated-functions.stderr", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/397996420040fb7245f1f5e09a8ec441522183c0/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/397996420040fb7245f1f5e09a8ec441522183c0/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftest-attrs%2Ftest-attr-non-associated-functions.stderr?ref=397996420040fb7245f1f5e09a8ec441522183c0", "patch": "@@ -2,9 +2,19 @@ error: `#[test]` attribute is only allowed on non associated functions\n   --> $DIR/test-attr-non-associated-functions.rs:9:5\n    |\n LL | /     fn new() -> A {\n+LL | |\n LL | |         A {}\n LL | |     }\n    | |_____^\n \n-error: aborting due to previous error\n+error: `#[test]` attribute is only allowed on non associated functions\n+  --> $DIR/test-attr-non-associated-functions.rs:14:5\n+   |\n+LL | /     fn recovery_witness() -> A {\n+LL | |\n+LL | |         A {}\n+LL | |     }\n+   | |_____^\n+\n+error: aborting due to 2 previous errors\n "}]}