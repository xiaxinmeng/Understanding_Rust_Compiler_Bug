{"sha": "9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNTQ4YmYyNmQ5ZjM1YTkyZTk4YmI2YTE0NjUxMzVlNGNkYTc2ZDU=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-24T12:48:02Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-05-24T16:01:27Z"}, "message": "get `rustc_hash` from external crate", "tree": {"sha": "00bbdb4947da84e870ac4ff7ef8235d70ed6208f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00bbdb4947da84e870ac4ff7ef8235d70ed6208f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "html_url": "https://github.com/rust-lang/rust/commit/9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f425a920169147cdb55ed84d258a7c0944220c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f425a920169147cdb55ed84d258a7c0944220c2", "html_url": "https://github.com/rust-lang/rust/commit/6f425a920169147cdb55ed84d258a7c0944220c2"}], "stats": {"total": 119, "additions": 34, "deletions": 85}, "files": [{"sha": "40ec413c90a234b695d8aea88f2c8ee89fbedc4d", "filename": "src/Cargo.lock", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "patch": "@@ -261,6 +261,23 @@ name = \"cfg-if\"\n version = \"0.1.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"chalk-engine\"\n+version = \"0.6.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"chalk-macros 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rustc-hash 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"chalk-macros\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"chrono\"\n version = \"0.4.1\"\n@@ -1739,6 +1756,7 @@ dependencies = [\n  \"backtrace 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"bitflags 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"byteorder 1.2.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"chalk-engine 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"flate2 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"fmt_macros 0.0.0\",\n  \"graphviz 0.0.0\",\n@@ -1840,6 +1858,11 @@ name = \"rustc-demangle\"\n version = \"0.1.7\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"rustc-hash\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"rustc-main\"\n version = \"0.0.0\"\n@@ -1982,6 +2005,7 @@ dependencies = [\n  \"log 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot 0.5.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot_core 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rustc-hash 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-rayon 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_cratesio_shim 0.0.0\",\n  \"serialize 0.0.0\",\n@@ -2216,6 +2240,7 @@ name = \"rustc_traits\"\n version = \"0.0.0\"\n dependencies = [\n  \"bitflags 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"chalk-engine 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"graphviz 0.0.0\",\n  \"log 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n@@ -2998,6 +3023,8 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum cargo_metadata 0.5.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6ebd6272a2ca4fd39dbabbd6611eb03df45c2259b3b80b39a9ff8fbdcf42a4b3\"\n \"checksum cc 1.0.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0ebb87d1116151416c0cf66a0e3fb6430cccd120fd6300794b4dfaa050ac40ba\"\n \"checksum cfg-if 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d4c819a1287eb618df47cc647173c5c4c66ba19d888a6e50d605672aed3140de\"\n+\"checksum chalk-engine 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a146c19172c7eea48ea55a7123ac95da786639bc665097f1e14034ee5f1d8699\"\n+\"checksum chalk-macros 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"295635afd6853aa9f20baeb7f0204862440c0fe994c5a253d5f479dac41d047e\"\n \"checksum chrono 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ba5f60682a4c264e7f8d77b82e7788938a76befdf949d4a98026d19099c9d873\"\n \"checksum clap 2.31.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f0f16b89cbb9ee36d87483dc939fe9f1e13c05898d56d7b230a0d4dff033a536\"\n \"checksum clippy_lints 0.0.200 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d2432663f6bdb90255dcf9df5ca504f99b575bb471281591138f62f9d31f863b\"\n@@ -3142,6 +3169,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum rustc-ap-syntax 128.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dcf9ca2901388714e9ccc7de7281ef06cec55d9f245252ba1d635bc86c730d9a\"\n \"checksum rustc-ap-syntax_pos 128.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e5217444369a36e98e11f4ac976f03878704893832e2e0b57d49f2f31438139f\"\n \"checksum rustc-demangle 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"11fb43a206a04116ffd7cfcf9bcb941f8eb6cc7ff667272246b0a1c74259a3cb\"\n+\"checksum rustc-hash 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e06ddba37baa245040f932b15403071a46681d7e0e4158e230741943c4718b84\"\n \"checksum rustc-rayon 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b1aa5cd8c3a706edb19b6ec6aa7b056bdc635b6e99c5cf7014f9af9d92f15e99\"\n \"checksum rustc-rayon-core 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d69983f8613a9c3ba1a3bbf5e8bdf2fd5c42317b1d8dd8623ca8030173bf8a6b\"\n \"checksum rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dcf128d1287d2ea9d80910b5f1120d0b8eede3fbf1abe91c40d39ea7d51e6fda\""}, {"sha": "c2b1130b75a7ab9f377eb3afd9032ad2bf692849", "filename": "src/librustc_data_structures/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2FCargo.toml?ref=9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "patch": "@@ -17,6 +17,7 @@ cfg-if = \"0.1.2\"\n stable_deref_trait = \"1.0.0\"\n parking_lot_core = \"0.2.8\"\n rustc-rayon = \"0.1.0\"\n+rustc-hash = \"1.0.0\"\n \n [dependencies.parking_lot]\n version = \"0.5\""}, {"sha": "3bf3170d1df1a648621aafddfb092d8e6f70f87e", "filename": "src/librustc_data_structures/fx.rs", "status": "modified", "additions": 4, "deletions": 85, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2Ffx.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2Ffx.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Ffx.rs?ref=9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "patch": "@@ -10,11 +10,11 @@\n \n use std::collections::{HashMap, HashSet};\n use std::default::Default;\n-use std::hash::{Hasher, Hash, BuildHasherDefault};\n-use std::ops::BitXor;\n+use std::hash::Hash;\n \n-pub type FxHashMap<K, V> = HashMap<K, V, BuildHasherDefault<FxHasher>>;\n-pub type FxHashSet<V> = HashSet<V, BuildHasherDefault<FxHasher>>;\n+pub use rustc_hash::FxHashMap;\n+pub use rustc_hash::FxHashSet;\n+pub use rustc_hash::FxHasher;\n \n #[allow(non_snake_case)]\n pub fn FxHashMap<K: Hash + Eq, V>() -> FxHashMap<K, V> {\n@@ -26,84 +26,3 @@ pub fn FxHashSet<V: Hash + Eq>() -> FxHashSet<V> {\n     HashSet::default()\n }\n \n-/// A speedy hash algorithm for use within rustc. The hashmap in liballoc\n-/// by default uses SipHash which isn't quite as speedy as we want. In the\n-/// compiler we're not really worried about DOS attempts, so we use a fast\n-/// non-cryptographic hash.\n-///\n-/// This is the same as the algorithm used by Firefox -- which is a homespun\n-/// one not based on any widely-known algorithm -- though modified to produce\n-/// 64-bit hash values instead of 32-bit hash values. It consistently\n-/// out-performs an FNV-based hash within rustc itself -- the collision rate is\n-/// similar or slightly worse than FNV, but the speed of the hash function\n-/// itself is much higher because it works on up to 8 bytes at a time.\n-pub struct FxHasher {\n-    hash: usize\n-}\n-\n-#[cfg(target_pointer_width = \"32\")]\n-const K: usize = 0x9e3779b9;\n-#[cfg(target_pointer_width = \"64\")]\n-const K: usize = 0x517cc1b727220a95;\n-\n-impl Default for FxHasher {\n-    #[inline]\n-    fn default() -> FxHasher {\n-        FxHasher { hash: 0 }\n-    }\n-}\n-\n-impl FxHasher {\n-    #[inline]\n-    fn add_to_hash(&mut self, i: usize) {\n-        self.hash = self.hash.rotate_left(5).bitxor(i).wrapping_mul(K);\n-    }\n-}\n-\n-impl Hasher for FxHasher {\n-    #[inline]\n-    fn write(&mut self, bytes: &[u8]) {\n-        for byte in bytes {\n-            let i = *byte;\n-            self.add_to_hash(i as usize);\n-        }\n-    }\n-\n-    #[inline]\n-    fn write_u8(&mut self, i: u8) {\n-        self.add_to_hash(i as usize);\n-    }\n-\n-    #[inline]\n-    fn write_u16(&mut self, i: u16) {\n-        self.add_to_hash(i as usize);\n-    }\n-\n-    #[inline]\n-    fn write_u32(&mut self, i: u32) {\n-        self.add_to_hash(i as usize);\n-    }\n-\n-    #[cfg(target_pointer_width = \"32\")]\n-    #[inline]\n-    fn write_u64(&mut self, i: u64) {\n-        self.add_to_hash(i as usize);\n-        self.add_to_hash((i >> 32) as usize);\n-    }\n-\n-    #[cfg(target_pointer_width = \"64\")]\n-    #[inline]\n-    fn write_u64(&mut self, i: u64) {\n-        self.add_to_hash(i as usize);\n-    }\n-\n-    #[inline]\n-    fn write_usize(&mut self, i: usize) {\n-        self.add_to_hash(i);\n-    }\n-\n-    #[inline]\n-    fn finish(&self) -> u64 {\n-        self.hash as u64\n-    }\n-}"}, {"sha": "e2a80acbd1285509e479fc01346986b4f91776cc", "filename": "src/librustc_data_structures/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c548bf26d9f35a92e98bb6a1465135e4cda76d5/src%2Flibrustc_data_structures%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Flib.rs?ref=9c548bf26d9f35a92e98bb6a1465135e4cda76d5", "patch": "@@ -44,6 +44,7 @@ extern crate parking_lot;\n extern crate cfg_if;\n extern crate stable_deref_trait;\n extern crate rustc_rayon as rayon;\n+extern crate rustc_hash;\n \n // See librustc_cratesio_shim/Cargo.toml for a comment explaining this.\n #[allow(unused_extern_crates)]"}]}