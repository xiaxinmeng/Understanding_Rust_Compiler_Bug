{"sha": "00ef5c1b9877c309fc4814fa2f0c8022266feee6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwZWY1YzFiOTg3N2MzMDlmYzQ4MTRmYTJmMGM4MDIyMjY2ZmVlZTY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-11-18T13:11:21Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-11-18T13:15:00Z"}, "message": "Fix selected crate search filter", "tree": {"sha": "ba3600d95f2845ef775bb260657007a8190a4fac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba3600d95f2845ef775bb260657007a8190a4fac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00ef5c1b9877c309fc4814fa2f0c8022266feee6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00ef5c1b9877c309fc4814fa2f0c8022266feee6", "html_url": "https://github.com/rust-lang/rust/commit/00ef5c1b9877c309fc4814fa2f0c8022266feee6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00ef5c1b9877c309fc4814fa2f0c8022266feee6/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b0214d9c560c49e2836c8491aa21d3dbf9f5554", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b0214d9c560c49e2836c8491aa21d3dbf9f5554", "html_url": "https://github.com/rust-lang/rust/commit/9b0214d9c560c49e2836c8491aa21d3dbf9f5554"}], "stats": {"total": 29, "additions": 13, "deletions": 16}, "files": [{"sha": "f35d1c5c3e10eaa39b7a9eec2d8632e56c6390e0", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/00ef5c1b9877c309fc4814fa2f0c8022266feee6/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00ef5c1b9877c309fc4814fa2f0c8022266feee6/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=00ef5c1b9877c309fc4814fa2f0c8022266feee6", "patch": "@@ -883,7 +883,9 @@ themePicker.onblur = handleThemeButtonsBlur;\n         v.push_str(&minify_replacer(\n             &format!(\"{}\\n{}\", variables.join(\"\"), all_indexes.join(\"\\n\")),\n             options.enable_minification));\n-        v.push_str(\"initSearch(searchIndex);addSearchOptions(searchIndex);\");\n+        // \"addSearchOptions\" has to be called first so the crate filtering can be set before the\n+        // search might start (if it's set into the URL for example).\n+        v.push_str(\"addSearchOptions(searchIndex);initSearch(searchIndex);\");\n         cx.shared.fs.write(&dst, &v)?;\n     }\n     if options.enable_index_page {"}, {"sha": "38fe545bec62876b76cdee3b0fbc55e48a66172e", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 10, "deletions": 15, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/00ef5c1b9877c309fc4814fa2f0c8022266feee6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/00ef5c1b9877c309fc4814fa2f0c8022266feee6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=00ef5c1b9877c309fc4814fa2f0c8022266feee6", "patch": "@@ -512,21 +512,6 @@ function getSearchElement() {\n         var OUTPUT_DATA = 1;\n         var params = getQueryStringParams();\n \n-        // Set the crate filter from saved storage, if the current page has the saved crate filter.\n-        //\n-        // If not, ignore the crate filter -- we want to support filtering for crates on sites like\n-        // doc.rust-lang.org where the crates may differ from page to page while on the same domain.\n-        var savedCrate = getCurrentValue(\"rustdoc-saved-filter-crate\");\n-        if (savedCrate !== null) {\n-            onEachLazy(document.getElementById(\"crate-search\").getElementsByTagName(\"option\"),\n-                       function(e) {\n-                if (e.value === savedCrate) {\n-                    document.getElementById(\"crate-search\").value = e.value;\n-                    return true;\n-                }\n-            });\n-        }\n-\n         // Populate search bar with query string search term when provided,\n         // but only if the input bar is empty. This avoid the obnoxious issue\n         // where you start trying to do a search, and the index loads, and\n@@ -2620,11 +2605,21 @@ function getSearchElement() {\n             }\n             return 0;\n         });\n+        var savedCrate = getCurrentValue(\"rustdoc-saved-filter-crate\");\n         for (var i = 0; i < crates_text.length; ++i) {\n             var option = document.createElement(\"option\");\n             option.value = crates_text[i];\n             option.innerText = crates_text[i];\n             elem.appendChild(option);\n+            // Set the crate filter from saved storage, if the current page has the saved crate\n+            // filter.\n+            //\n+            // If not, ignore the crate filter -- we want to support filtering for crates on sites\n+            // like doc.rust-lang.org where the crates may differ from page to page while on the\n+            // same domain.\n+            if (crates_text[i] === savedCrate) {\n+                elem.value = savedCrate;\n+            }\n         }\n     }\n "}]}