{"sha": "9fe86e566d77a506f015403d2c057845f9b923ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmZTg2ZTU2NmQ3N2E1MDZmMDE1NDAzZDJjMDU3ODQ1ZjliOTIzZWQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-18T16:59:47Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-18T16:59:47Z"}, "message": "Rollup merge of #51628 - euclio:line-writer, r=frewsxcv\n\nuse checked write in `LineWriter` example\n\nThe example was wrong because it didn't check the return value of\n`write()`, and it didn't flush the buffer before comparing the contents\nof the file.\n\nFixes #51621.", "tree": {"sha": "1c1e8448b8c493439b2c14c31ec52a2aec73f4eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c1e8448b8c493439b2c14c31ec52a2aec73f4eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fe86e566d77a506f015403d2c057845f9b923ed", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAltPcgUACgkQ/vbIBR0O\nATwbrQ//fG2NP3oXc3yfPXZexjmxg6SSvxQ90YUQxeAdhRVGhmfYPyce+D/aldDQ\nMes2ty1Iil5B2h28ZibNSNnQFOK52IyTRvAVPtaFZIbFPiKuWR6fnDNlJEIvs248\nWK1ONDk+mVnyHKNYQLIOq1qRJilYTDB2yDmz6wqkIjYJLZkMDZbatbjGdUNbr++8\nCEFyt1VL+tgPN9nzu9GgGSPD5lV+npTycsrFhPBTIHlpmOVmlLeP3+yewRquVKJk\ndRJY7FUkgjRmsRfOgQDJxdkKph4pvKZeoy3P9MFQX2Y/rDZQyjejAdfrO6cXNpjg\nlT0qx5ZRcjOhT5G1QxvPguFJAxp6b0dU7CU2sWUGnvXLzmB6al8Zh44oUi8iNyQJ\nOHuV/th2G7gi16476UoBKT6MC03WuoNHp1f9WJRRFUYYJJXiCau/N4ok7ljS5uHt\nSZOLtc0CZfuc1CKuiduyORKl9D0DbTX1ec4CfInPXEjPQxy5I8Yhrsi0c33jZ4oB\nY0RMMud96ubK1JbF7X5xyXkaylnt7dmTkrudncYw2722NnbZygXV4Sz2kUxvYTRk\nMr0iUkf9QNWZsb67X2+6N86ZOAjnZAdw0xmb/sKbec5mvcHUKJ9W8fMNLvVT3Ky1\nptGwZE3SjIm6DBMiGS05fxS79mdegI1rEPcOoHNSSkTRK84g35w=\n=znK3\n-----END PGP SIGNATURE-----", "payload": "tree 1c1e8448b8c493439b2c14c31ec52a2aec73f4eb\nparent 1e5a8c65c15d8622c93d8f978608243249f0bbbe\nparent c12a75742485dcc3db7b0f374e78f090c323830d\nauthor kennytm <kennytm@gmail.com> 1531933187 +0800\ncommitter kennytm <kennytm@gmail.com> 1531933187 +0800\n\nRollup merge of #51628 - euclio:line-writer, r=frewsxcv\n\nuse checked write in `LineWriter` example\n\nThe example was wrong because it didn't check the return value of\n`write()`, and it didn't flush the buffer before comparing the contents\nof the file.\n\nFixes #51621.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fe86e566d77a506f015403d2c057845f9b923ed", "html_url": "https://github.com/rust-lang/rust/commit/9fe86e566d77a506f015403d2c057845f9b923ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fe86e566d77a506f015403d2c057845f9b923ed/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e5a8c65c15d8622c93d8f978608243249f0bbbe", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e5a8c65c15d8622c93d8f978608243249f0bbbe", "html_url": "https://github.com/rust-lang/rust/commit/1e5a8c65c15d8622c93d8f978608243249f0bbbe"}, {"sha": "c12a75742485dcc3db7b0f374e78f090c323830d", "url": "https://api.github.com/repos/rust-lang/rust/commits/c12a75742485dcc3db7b0f374e78f090c323830d", "html_url": "https://github.com/rust-lang/rust/commit/c12a75742485dcc3db7b0f374e78f090c323830d"}], "stats": {"total": 33, "additions": 23, "deletions": 10}, "files": [{"sha": "189569683a9cf78fad5f243f5e33afc1057e48e3", "filename": "src/libstd/io/buffered.rs", "status": "modified", "additions": 23, "deletions": 10, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/9fe86e566d77a506f015403d2c057845f9b923ed/src%2Flibstd%2Fio%2Fbuffered.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fe86e566d77a506f015403d2c057845f9b923ed/src%2Flibstd%2Fio%2Fbuffered.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fbuffered.rs?ref=9fe86e566d77a506f015403d2c057845f9b923ed", "patch": "@@ -738,7 +738,7 @@ impl<W> fmt::Display for IntoInnerError<W> {\n /// reducing the number of actual writes to the file.\n ///\n /// ```no_run\n-/// use std::fs::File;\n+/// use std::fs::{self, File};\n /// use std::io::prelude::*;\n /// use std::io::LineWriter;\n ///\n@@ -752,17 +752,30 @@ impl<W> fmt::Display for IntoInnerError<W> {\n ///     let file = File::create(\"poem.txt\")?;\n ///     let mut file = LineWriter::new(file);\n ///\n-///     for &byte in road_not_taken.iter() {\n-///        file.write(&[byte]).unwrap();\n-///     }\n+///     file.write_all(b\"I shall be telling this with a sigh\")?;\n+///\n+///     // No bytes are written until a newline is encountered (or\n+///     // the internal buffer is filled).\n+///     assert_eq!(fs::read_to_string(\"poem.txt\")?, \"\");\n+///     file.write_all(b\"\\n\")?;\n+///     assert_eq!(\n+///         fs::read_to_string(\"poem.txt\")?,\n+///         \"I shall be telling this with a sigh\\n\",\n+///     );\n ///\n-///     // let's check we did the right thing.\n-///     let mut file = File::open(\"poem.txt\")?;\n-///     let mut contents = String::new();\n+///     // Write the rest of the poem.\n+///     file.write_all(b\"Somewhere ages and ages hence:\n+/// Two roads diverged in a wood, and I -\n+/// I took the one less traveled by,\n+/// And that has made all the difference.\")?;\n ///\n-///     file.read_to_string(&mut contents)?;\n+///     // The last line of the poem doesn't end in a newline, so\n+///     // we have to flush or drop the `LineWriter` to finish\n+///     // writing.\n+///     file.flush()?;\n ///\n-///     assert_eq!(contents.as_bytes(), &road_not_taken[..]);\n+///     // Confirm the whole poem was written.\n+///     assert_eq!(fs::read(\"poem.txt\")?, &road_not_taken[..]);\n ///     Ok(())\n /// }\n /// ```\n@@ -862,7 +875,7 @@ impl<W: Write> LineWriter<W> {\n     ///\n     /// The internal buffer is written out before returning the writer.\n     ///\n-    // # Errors\n+    /// # Errors\n     ///\n     /// An `Err` will be returned if an error occurs while flushing the buffer.\n     ///"}]}