{"sha": "dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiZTg4MGU4ZWNkMDg4ZGVkM2FjNjNmYWMxZDYwZjgxM2YxMWFkNGU=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-02T03:09:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-02T03:09:01Z"}, "message": "Rollup merge of #66850 - eddyb:span-free-formats, r=oli-obk\n\nrustc: hide HirId's fmt::Debug output from -Z span_free_formats.\n\nThis replaces the only occurrences of `HirId {...}` from tests with paths, i.e.:\n```rust\n[closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T]\n```\nbecomes, after this PR:\n```rust\n[closure@foo<T>::{{closure}}#0 q:&i32, t:&T]\n```\n\nr? @oli-obk cc @michaelwoerister", "tree": {"sha": "914fed746b44b8f70282a6073f899db9d0bc1e46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/914fed746b44b8f70282a6073f899db9d0bc1e46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd5IBNCRBK7hj4Ov3rIwAAdHIIADLYRU245/rtiK65jsvQYFZ2\n9S9R4O4EZTZwHF2xPdrC/T610L4XZHWKi2PfzEMgIHj6qG5iGgg4jL1h4ZRr9qsY\nwLubquO7kEZ65rc+mGk8/iJ1CLwrAlaDNfldwh2NOHN3SYJGxS/w4Dqjalra+daE\n6V087UkpyS3qWucYNV+FS1h4IgSa4hZNExCPF9riXqyODAgjumBNNNcmnNPwFnBt\nwoHuk7n6C2BFD0g7A44yKyvcKrPlUN59ne02R8GSSH/rg+0Y28CN5SPyJNAAiEUd\nzZKQHlUFrb1S5uKJ0VEsqpMRHqgc6AGwFaFR97MQaHV361KWMyqvQD2LiF+YQtA=\n=jUvI\n-----END PGP SIGNATURE-----\n", "payload": "tree 914fed746b44b8f70282a6073f899db9d0bc1e46\nparent fd09fad064504e18cd7fd15ccd7c957787482b81\nparent 71710608f009066b5a2dd65ea88ec5c0a79422e4\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1575256141 +0100\ncommitter GitHub <noreply@github.com> 1575256141 +0100\n\nRollup merge of #66850 - eddyb:span-free-formats, r=oli-obk\n\nrustc: hide HirId's fmt::Debug output from -Z span_free_formats.\n\nThis replaces the only occurrences of `HirId {...}` from tests with paths, i.e.:\n```rust\n[closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T]\n```\nbecomes, after this PR:\n```rust\n[closure@foo<T>::{{closure}}#0 q:&i32, t:&T]\n```\n\nr? @oli-obk cc @michaelwoerister\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "html_url": "https://github.com/rust-lang/rust/commit/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fd09fad064504e18cd7fd15ccd7c957787482b81", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd09fad064504e18cd7fd15ccd7c957787482b81", "html_url": "https://github.com/rust-lang/rust/commit/fd09fad064504e18cd7fd15ccd7c957787482b81"}, {"sha": "71710608f009066b5a2dd65ea88ec5c0a79422e4", "url": "https://api.github.com/repos/rust-lang/rust/commits/71710608f009066b5a2dd65ea88ec5c0a79422e4", "html_url": "https://github.com/rust-lang/rust/commit/71710608f009066b5a2dd65ea88ec5c0a79422e4"}], "stats": {"total": 30, "additions": 17, "deletions": 13}, "files": [{"sha": "300b0363e2d3b20ee2f03d032643e5358716c826", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -2313,10 +2313,14 @@ impl<'tcx> Debug for Rvalue<'tcx> {\n                         }\n                     }\n \n-                    AggregateKind::Closure(def_id, _) => ty::tls::with(|tcx| {\n+                    AggregateKind::Closure(def_id, substs) => ty::tls::with(|tcx| {\n                         if let Some(hir_id) = tcx.hir().as_local_hir_id(def_id) {\n                             let name = if tcx.sess.opts.debugging_opts.span_free_formats {\n-                                format!(\"[closure@{:?}]\", hir_id)\n+                                let substs = tcx.lift(&substs).unwrap();\n+                                format!(\n+                                    \"[closure@{}]\",\n+                                    tcx.def_path_str_with_substs(def_id, substs),\n+                                )\n                             } else {\n                                 format!(\"[closure@{:?}]\", tcx.hir().span(hir_id))\n                             };"}, {"sha": "fff2f06e87b8edc3cb81c65244695cd4b7f0155a", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -682,7 +682,7 @@ pub trait PrettyPrinter<'tcx>:\n                 // FIXME(eddyb) should use `def_span`.\n                 if let Some(hir_id) = self.tcx().hir().as_local_hir_id(did) {\n                     if self.tcx().sess.opts.debugging_opts.span_free_formats {\n-                        p!(write(\"@{:?}\", hir_id));\n+                        p!(write(\"@\"), print_def_path(did, substs));\n                     } else {\n                         p!(write(\"@{:?}\", self.tcx().hir().span(hir_id)));\n                     }"}, {"sha": "768f4953228095acd9a5c786afb44c0dda82e079", "filename": "src/test/mir-opt/inline-closure-borrows-arg.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure-borrows-arg.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -21,8 +21,8 @@ fn foo<T: Copy>(_t: T, q: &i32) -> i32 {\n //     debug _t => _1;\n //     debug q => _2;\n //     let mut _0: i32;\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 31 }];\n-//     let mut _4: &[closure@HirId { owner: DefIndex(4), local_id: 31 }];\n+//     let _3: [closure@foo<T>::{{closure}}#0];\n+//     let mut _4: &[closure@foo<T>::{{closure}}#0];\n //     let mut _5: (&i32, &i32);\n //     let mut _6: &i32;\n //     let mut _7: &i32;\n@@ -40,7 +40,7 @@ fn foo<T: Copy>(_t: T, q: &i32) -> i32 {\n //     }\n //     bb0: {\n //         ...\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 31 }];\n+//         _3 = [closure@foo::<T>::{{closure}}#0];\n //         ...\n //         _4 = &_3;\n //         ..."}, {"sha": "e000a418d90c79ae05e2d392169fb15c5f340884", "filename": "src/test/mir-opt/inline-closure-captures.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure-captures.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -17,10 +17,10 @@ fn foo<T: Copy>(t: T, q: i32) -> (i32, T) {\n //     debug t => _1;\n //     debug q => _2;\n //     let mut _0: (i32, T);\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T];\n+//     let _3: [closure@foo<T>::{{closure}}#0 q:&i32, t:&T];\n //     let mut _4: &i32;\n //     let mut _5: &T;\n-//     let mut _6: &[closure@HirId { owner: DefIndex(4), local_id: 15 } q:&i32, t:&T];\n+//     let mut _6: &[closure@foo<T>::{{closure}}#0 q:&i32, t:&T];\n //     let mut _7: (i32,);\n //     let mut _8: i32;\n //     let mut _11: i32;\n@@ -39,7 +39,7 @@ fn foo<T: Copy>(t: T, q: i32) -> (i32, T) {\n //         _4 = &_2;\n //         ...\n //         _5 = &_1;\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 15 }] { q: move _4, t: move _5 };\n+//         _3 = [closure@foo::<T>::{{closure}}#0] { q: move _4, t: move _5 };\n //         ...\n //         _6 = &_3;\n //         ..."}, {"sha": "bd36e77818edce1d72489068724e1f16f2e3305c", "filename": "src/test/mir-opt/inline-closure.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Finline-closure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Finline-closure.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -17,8 +17,8 @@ fn foo<T: Copy>(_t: T, q: i32) -> i32 {\n //     debug _t => _1;\n //     debug q => _2;\n //     let mut _0: i32;\n-//     let _3: [closure@HirId { owner: DefIndex(4), local_id: 15 }];\n-//     let mut _4: &[closure@HirId { owner: DefIndex(4), local_id: 15 }];\n+//     let _3: [closure@foo<T>::{{closure}}#0];\n+//     let mut _4: &[closure@foo<T>::{{closure}}#0];\n //     let mut _5: (i32, i32);\n //     let mut _6: i32;\n //     let mut _7: i32;\n@@ -33,7 +33,7 @@ fn foo<T: Copy>(_t: T, q: i32) -> i32 {\n //     }\n //     bb0: {\n //         ...\n-//         _3 = [closure@HirId { owner: DefIndex(4), local_id: 15 }];\n+//         _3 = [closure@foo::<T>::{{closure}}#0];\n //         ...\n //         _4 = &_3;\n //         ..."}, {"sha": "32995448a21e95209683188b5a8330b006605776", "filename": "src/test/mir-opt/retag.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Fretag.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbe880e8ecd088ded3ac63fac1d60f813f11ad4e/src%2Ftest%2Fmir-opt%2Fretag.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fretag.rs?ref=dbe880e8ecd088ded3ac63fac1d60f813f11ad4e", "patch": "@@ -100,7 +100,7 @@ fn main() {\n // }\n // END rustc.main.EraseRegions.after.mir\n // START rustc.main-{{closure}}.EraseRegions.after.mir\n-// fn main::{{closure}}#0(_1: &[closure@HirId { owner: DefIndex(13), local_id: 72 }], _2: &i32) -> &i32 {\n+// fn main::{{closure}}#0(_1: &[closure@main::{{closure}}#0], _2: &i32) -> &i32 {\n //     ...\n //     bb0: {\n //         Retag([fn entry] _1);"}]}