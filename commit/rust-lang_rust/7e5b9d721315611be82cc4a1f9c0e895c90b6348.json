{"sha": "7e5b9d721315611be82cc4a1f9c0e895c90b6348", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlNWI5ZDcyMTMxNTYxMWJlODJjYzRhMWY5YzBlODk1YzkwYjYzNDg=", "commit": {"author": {"name": "arthurprs", "email": "arthurprs@gmail.com", "date": "2016-01-14T20:05:00Z"}, "committer": {"name": "arthurprs", "email": "arthurprs@gmail.com", "date": "2016-01-22T17:08:27Z"}, "message": "Avoid bounds check for slice binary search", "tree": {"sha": "93229f75da05c2ac4cc12fd65d54ef669f550159", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/93229f75da05c2ac4cc12fd65d54ef669f550159"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7e5b9d721315611be82cc4a1f9c0e895c90b6348", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7e5b9d721315611be82cc4a1f9c0e895c90b6348", "html_url": "https://github.com/rust-lang/rust/commit/7e5b9d721315611be82cc4a1f9c0e895c90b6348", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7e5b9d721315611be82cc4a1f9c0e895c90b6348/comments", "author": {"login": "arthurprs", "id": 715958, "node_id": "MDQ6VXNlcjcxNTk1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/715958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthurprs", "html_url": "https://github.com/arthurprs", "followers_url": "https://api.github.com/users/arthurprs/followers", "following_url": "https://api.github.com/users/arthurprs/following{/other_user}", "gists_url": "https://api.github.com/users/arthurprs/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthurprs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthurprs/subscriptions", "organizations_url": "https://api.github.com/users/arthurprs/orgs", "repos_url": "https://api.github.com/users/arthurprs/repos", "events_url": "https://api.github.com/users/arthurprs/events{/privacy}", "received_events_url": "https://api.github.com/users/arthurprs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arthurprs", "id": 715958, "node_id": "MDQ6VXNlcjcxNTk1OA==", "avatar_url": "https://avatars.githubusercontent.com/u/715958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthurprs", "html_url": "https://github.com/arthurprs", "followers_url": "https://api.github.com/users/arthurprs/followers", "following_url": "https://api.github.com/users/arthurprs/following{/other_user}", "gists_url": "https://api.github.com/users/arthurprs/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthurprs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthurprs/subscriptions", "organizations_url": "https://api.github.com/users/arthurprs/orgs", "repos_url": "https://api.github.com/users/arthurprs/repos", "events_url": "https://api.github.com/users/arthurprs/events{/privacy}", "received_events_url": "https://api.github.com/users/arthurprs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5bab5dd00572dd8eff966e90e4f0371fd528f6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e5bab5dd00572dd8eff966e90e4f0371fd528f6b", "html_url": "https://github.com/rust-lang/rust/commit/e5bab5dd00572dd8eff966e90e4f0371fd528f6b"}], "stats": {"total": 29, "additions": 13, "deletions": 16}, "files": [{"sha": "6e883f548368c5518385582b307560b56bdfc31d", "filename": "src/libcore/slice.rs", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/7e5b9d721315611be82cc4a1f9c0e895c90b6348/src%2Flibcore%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e5b9d721315611be82cc4a1f9c0e895c90b6348/src%2Flibcore%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fslice.rs?ref=7e5b9d721315611be82cc4a1f9c0e895c90b6348", "patch": "@@ -295,22 +295,23 @@ impl<T> SliceExt for [T] {\n     fn binary_search_by<F>(&self, mut f: F) -> Result<usize, usize> where\n         F: FnMut(&T) -> Ordering\n     {\n-        let mut base : usize = 0;\n-        let mut lim : usize = self.len();\n+        let mut base = 0usize;\n+        let mut s = self;\n \n-        while lim != 0 {\n-            let ix = base + (lim >> 1);\n-            match f(&self[ix]) {\n-                Equal => return Ok(ix),\n+        loop {\n+            let (head, tail) = s.split_at(s.len() >> 1);\n+            if tail.is_empty() {\n+                return Err(base)\n+            }\n+            match f(&tail[0]) {\n                 Less => {\n-                    base = ix + 1;\n-                    lim -= 1;\n+                    base += head.len() + 1;\n+                    s = &tail[1..];\n                 }\n-                Greater => ()\n+                Greater => s = head,\n+                Equal => return Ok(base + head.len()),\n             }\n-            lim >>= 1;\n         }\n-        Err(base)\n     }\n \n     #[inline]"}, {"sha": "f82ab44adad00b8d762635d75e0fc1d16c9677f5", "filename": "src/libcoretest/slice.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7e5b9d721315611be82cc4a1f9c0e895c90b6348/src%2Flibcoretest%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7e5b9d721315611be82cc4a1f9c0e895c90b6348/src%2Flibcoretest%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcoretest%2Fslice.rs?ref=7e5b9d721315611be82cc4a1f9c0e895c90b6348", "patch": "@@ -11,24 +11,20 @@\n use core::result::Result::{Ok, Err};\n \n #[test]\n-fn binary_search_not_found() {\n+fn test_binary_search() {\n     let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&6)) == Ok(3));\n-    let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&5)) == Err(3));\n     let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&6)) == Ok(3));\n-    let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&5)) == Err(3));\n     let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&8)) == Ok(4));\n-    let b = [1, 2, 4, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&7)) == Err(4));\n     let b = [1, 2, 4, 6, 7, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&8)) == Ok(5));\n     let b = [1, 2, 4, 5, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&7)) == Err(5));\n-    let b = [1, 2, 4, 5, 6, 8, 9];\n     assert!(b.binary_search_by(|v| v.cmp(&0)) == Err(0));\n     let b = [1, 2, 4, 5, 6, 8];\n     assert!(b.binary_search_by(|v| v.cmp(&9)) == Err(6));"}]}