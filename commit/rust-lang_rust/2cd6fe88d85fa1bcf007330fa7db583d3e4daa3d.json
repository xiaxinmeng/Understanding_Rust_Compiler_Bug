{"sha": "2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d", "node_id": "C_kwDOAAsO6NoAKDJjZDZmZTg4ZDg1ZmExYmNmMDA3MzMwZmE3ZGI1ODNkM2U0ZGFhM2Q", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-23T19:08:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-23T19:08:06Z"}, "message": "Auto merge of #1921 - RalfJung:overflow-checks-off, r=RalfJung\n\ntest for overflow-checks=off\n\nStrangely, if we call the functions in `std::ops`, we still get the panics. I assume that is because we build the stdlib with `-Cdebug-assertions=on`; probably the magic attribute that makes stdlib functions inherit overflow checks from the calling crate only works one way (namely to enable them when the calling crate asks for them, but not to disable them when the calling crate does not want them).", "tree": {"sha": "9f6042b004e164d87537d97cd1da1faf1eba5600", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f6042b004e164d87537d97cd1da1faf1eba5600"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d", "html_url": "https://github.com/rust-lang/rust/commit/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "763a4455ac9f411a336705b1a507a79ccf458913", "url": "https://api.github.com/repos/rust-lang/rust/commits/763a4455ac9f411a336705b1a507a79ccf458913", "html_url": "https://github.com/rust-lang/rust/commit/763a4455ac9f411a336705b1a507a79ccf458913"}, {"sha": "7dd1f0571cde175af95b62ad805ba7381680a048", "url": "https://api.github.com/repos/rust-lang/rust/commits/7dd1f0571cde175af95b62ad805ba7381680a048", "html_url": "https://github.com/rust-lang/rust/commit/7dd1f0571cde175af95b62ad805ba7381680a048"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "d6c6971e49521ae596d836e3fc6524812e855c8d", "filename": "tests/run-pass/overflow_checks_off.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d/tests%2Frun-pass%2Foverflow_checks_off.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d/tests%2Frun-pass%2Foverflow_checks_off.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Foverflow_checks_off.rs?ref=2cd6fe88d85fa1bcf007330fa7db583d3e4daa3d", "patch": "@@ -0,0 +1,18 @@\n+// compile-flags: -C overflow-checks=off\n+\n+// Check that we correctly implement the intended behavior of these operators\n+// when they are not being overflow-checked.\n+\n+// FIXME: if we call the functions in `std::ops`, we still get the panics.\n+// Miri does not implement the codegen-time hack that backs `#[rustc_inherit_overflow_checks]`.\n+// use std::ops::*;\n+\n+fn main() {\n+    assert_eq!(-{-0x80i8}, -0x80);\n+\n+    assert_eq!(0xffu8 + 1, 0_u8);\n+    assert_eq!(0u8 - 1, 0xff_u8);\n+    assert_eq!(0xffu8 * 2, 0xfe_u8);\n+    assert_eq!(1u8 << 9, 2_u8);\n+    assert_eq!(2u8 >> 9, 1_u8);\n+}"}]}