{"sha": "78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "node_id": "C_kwDOAAsO6NoAKDc4ZTVkMDVlYTAyNTY1ZWUyZWNjOGMzOTQxMzdiMGJhM2U4NjM3MmU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-31T05:57:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-31T05:57:59Z"}, "message": "Rollup merge of #101049 - JeanCASPAR:remove-span_fatal-from-ast_lowering, r=davidtwco\n\nRemove span fatal from ast lowering\n\nNow the crate `rustc_ast_lowering` is fully migrated to `SessionDiagnostic`.\n\nr? ``@davidtwco``", "tree": {"sha": "76a5b743592d88511c420c34fcdc9f11ca91d789", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76a5b743592d88511c420c34fcdc9f11ca91d789"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjDvhnCRBK7hj4Ov3rIwAAZGQIAKNBfJCq65auTjdsRV7HgduU\nvL0vf2HXnuY2Q3N/WytfFKrYNMdeRi28UmsAnlVpOPJcD/qEwBz4JSsO63Yk3XT/\nW1NzS03rnOBUgdmDisafJo17c20tVZrkTJCZc/J+EcQkYCJbFrNJmo79JMna8nUQ\nvKuZqq1QGYw9fRvlDTu/NKXPdyojs/hnXmyR33AcLhSaaKbRBChCd9s612DHDYqF\nH84hejwj5/bwuJ1+8aGPCsGlfJsRDL2i7KJ9FafcoPL7IgUlQ4tzcEKpFs8p/ajg\nFYmyQVJzhhYpDoy5RvGZ8c21wbv5Fkb5UWfGjD1S6OYULQa1sveMsGqOCeJbGus=\n=OXAu\n-----END PGP SIGNATURE-----\n", "payload": "tree 76a5b743592d88511c420c34fcdc9f11ca91d789\nparent 0fee731a9555beb903f45b531f4f0702a88e1b44\nparent 79d4f09942a2fc6f96f56f7ae85196c4aa7df56c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1661925479 +0200\ncommitter GitHub <noreply@github.com> 1661925479 +0200\n\nRollup merge of #101049 - JeanCASPAR:remove-span_fatal-from-ast_lowering, r=davidtwco\n\nRemove span fatal from ast lowering\n\nNow the crate `rustc_ast_lowering` is fully migrated to `SessionDiagnostic`.\n\nr? ``@davidtwco``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "html_url": "https://github.com/rust-lang/rust/commit/78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fee731a9555beb903f45b531f4f0702a88e1b44", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fee731a9555beb903f45b531f4f0702a88e1b44", "html_url": "https://github.com/rust-lang/rust/commit/0fee731a9555beb903f45b531f4f0702a88e1b44"}, {"sha": "79d4f09942a2fc6f96f56f7ae85196c4aa7df56c", "url": "https://api.github.com/repos/rust-lang/rust/commits/79d4f09942a2fc6f96f56f7ae85196c4aa7df56c", "html_url": "https://github.com/rust-lang/rust/commit/79d4f09942a2fc6f96f56f7ae85196c4aa7df56c"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "4adeaef9bbfa832d708a5275c5209229c105c37f", "filename": "compiler/rustc_ast_lowering/src/errors.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Ferrors.rs?ref=78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "patch": "@@ -327,3 +327,10 @@ pub struct ArbitraryExpressionInPattern {\n     #[primary_span]\n     pub span: Span,\n }\n+\n+#[derive(SessionDiagnostic, Clone, Copy)]\n+#[diag(ast_lowering::inclusive_range_with_no_end)]\n+pub struct InclusiveRangeWithNoEnd {\n+    #[primary_span]\n+    pub span: Span,\n+}"}, {"sha": "176047616881f4a62da9610497adfe3f2b13832b", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "patch": "@@ -1,8 +1,8 @@\n use super::errors::{\n     AsyncGeneratorsNotSupported, AsyncNonMoveClosureNotSupported, AwaitOnlyInAsyncFnAndBlocks,\n     BaseExpressionDoubleDot, ClosureCannotBeStatic, FunctionalRecordUpdateDestructuringAssignemnt,\n-    GeneratorTooManyParameters, NotSupportedForLifetimeBinderAsyncClosure, RustcBoxAttributeError,\n-    UnderscoreExprLhsAssign,\n+    GeneratorTooManyParameters, InclusiveRangeWithNoEnd, NotSupportedForLifetimeBinderAsyncClosure,\n+    RustcBoxAttributeError, UnderscoreExprLhsAssign,\n };\n use super::ResolverAstLoweringExt;\n use super::{ImplTraitContext, LoweringContext, ParamMode, ParenthesizedGenericArgs};\n@@ -1264,7 +1264,13 @@ impl<'hir> LoweringContext<'_, 'hir> {\n             (Some(..), Some(..), HalfOpen) => hir::LangItem::Range,\n             (None, Some(..), Closed) => hir::LangItem::RangeToInclusive,\n             (Some(..), Some(..), Closed) => unreachable!(),\n-            (_, None, Closed) => self.diagnostic().span_fatal(span, \"inclusive range with no end\"),\n+            (start, None, Closed) => {\n+                self.tcx.sess.emit_err(InclusiveRangeWithNoEnd { span });\n+                match start {\n+                    Some(..) => hir::LangItem::RangeFrom,\n+                    None => hir::LangItem::RangeFull,\n+                }\n+            }\n         };\n \n         let fields = self.arena.alloc_from_iter("}, {"sha": "30a87740c7f9b16c56f2d0261b61cdf761448d14", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "patch": "@@ -36,6 +36,8 @@\n #![feature(never_type)]\n #![recursion_limit = \"256\"]\n #![allow(rustc::potential_query_instability)]\n+#![deny(rustc::untranslatable_diagnostic)]\n+#![deny(rustc::diagnostic_outside_of_impl)]\n \n #[macro_use]\n extern crate tracing;"}, {"sha": "f2790531aba44de40e247d6d7a8b4d956fd08684", "filename": "compiler/rustc_error_messages/locales/en-US/ast_lowering.ftl", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fast_lowering.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/78e5d05ea02565ee2ecc8c394137b0ba3e86372e/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fast_lowering.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fast_lowering.ftl?ref=78e5d05ea02565ee2ecc8c394137b0ba3e86372e", "patch": "@@ -129,3 +129,5 @@ ast_lowering_not_supported_for_lifetime_binder_async_closure =\n \n ast_lowering_arbitrary_expression_in_pattern =\n     arbitrary expressions aren't allowed in patterns\n+\n+ast_lowering_inclusive_range_with_no_end = inclusive range with no end"}]}