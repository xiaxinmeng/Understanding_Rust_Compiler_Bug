{"sha": "e7f00b64933b85289921f641b2658f41eeb338ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ZjAwYjY0OTMzYjg1Mjg5OTIxZjY0MWIyNjU4ZjQxZWViMzM4ZWM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-03T23:45:59Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-02-04T07:48:12Z"}, "message": "rt: Do all task creation through a scheduler", "tree": {"sha": "fdd69132ccbbf691c5658639373636d27443dd09", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fdd69132ccbbf691c5658639373636d27443dd09"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7f00b64933b85289921f641b2658f41eeb338ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7f00b64933b85289921f641b2658f41eeb338ec", "html_url": "https://github.com/rust-lang/rust/commit/e7f00b64933b85289921f641b2658f41eeb338ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7f00b64933b85289921f641b2658f41eeb338ec/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf250bec7c59b52bbeb6bcb67d4b09133fd2f483", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf250bec7c59b52bbeb6bcb67d4b09133fd2f483", "html_url": "https://github.com/rust-lang/rust/commit/bf250bec7c59b52bbeb6bcb67d4b09133fd2f483"}], "stats": {"total": 25, "additions": 10, "deletions": 15}, "files": [{"sha": "b5af3942a20c449beade7a3d106b99cf87ec1705", "filename": "src/rt/rust.cpp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust.cpp?ref=e7f00b64933b85289921f641b2658f41eeb338ec", "patch": "@@ -1,5 +1,6 @@\n #include \"rust_internal.h\"\n #include \"rust_util.h\"\n+#include \"rust_scheduler.h\"\n #include <cstdio>\n \n struct\n@@ -87,7 +88,8 @@ rust_start(uintptr_t main_fn, int argc, char **argv, void* crate_map) {\n \n     rust_srv *srv = new rust_srv(env);\n     rust_kernel *kernel = new rust_kernel(srv, env->num_sched_threads);\n-    rust_task_id root_id = kernel->create_task(NULL, \"main\", MAIN_STACK_SIZE);\n+    rust_scheduler *sched = kernel->get_default_scheduler();\n+    rust_task_id root_id = sched->create_task(NULL, \"main\", MAIN_STACK_SIZE);\n     rust_task *root_task = kernel->get_task_by_id(root_id);\n     I(kernel, root_task != NULL);\n     rust_task_thread *thread = root_task->thread;"}, {"sha": "59175402246031dba7a0229ff7bb6721d37dee82", "filename": "src/rt/rust_kernel.cpp", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust_kernel.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust_kernel.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_kernel.cpp?ref=e7f00b64933b85289921f641b2658f41eeb338ec", "patch": "@@ -65,6 +65,11 @@ int rust_kernel::start_schedulers()\n     return rval;\n }\n \n+rust_scheduler *\n+rust_kernel::get_default_scheduler() {\n+    return sched;\n+}\n+\n void\n rust_kernel::fail() {\n     // FIXME: On windows we're getting \"Application has requested the\n@@ -77,17 +82,6 @@ rust_kernel::fail() {\n     sched->kill_all_tasks();\n }\n \n-rust_task_id\n-rust_kernel::create_task(rust_task *spawner, const char *name,\n-                         size_t init_stack_sz) {\n-    return sched->create_task(spawner, name, init_stack_sz);\n-}\n-\n-rust_task_id\n-rust_kernel::create_task(rust_task *spawner, const char *name) {\n-    return create_task(spawner, name, env->min_stack_size);\n-}\n-\n void\n rust_kernel::register_task(rust_task *task) {\n     scoped_lock with(_kernel_lock);"}, {"sha": "17eaccdf879aec8a31be4e1769dfe6a49f0a6d9e", "filename": "src/rt/rust_kernel.h", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust_kernel.h", "raw_url": "https://github.com/rust-lang/rust/raw/e7f00b64933b85289921f641b2658f41eeb338ec/src%2Frt%2Frust_kernel.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_kernel.h?ref=e7f00b64933b85289921f641b2658f41eeb338ec", "patch": "@@ -47,17 +47,16 @@ class rust_kernel {\n     void fail();\n \n     int start_schedulers();\n+    rust_scheduler* get_default_scheduler();\n \n #ifdef __WIN32__\n     void win32_require(LPCTSTR fn, BOOL ok);\n #endif\n \n-    rust_task_id create_task(rust_task *spawner, const char *name,\n-\t\t\t     size_t init_stack_size);\n-    rust_task_id create_task(rust_task * spawner, const char *name);\n     void register_task(rust_task *task);\n     rust_task *get_task_by_id(rust_task_id id);\n     void release_task_id(rust_task_id tid);\n+\n     void set_exit_status(int code);\n };\n "}]}