{"sha": "591cc9aede4aec9b8816b8489eb98c2f2a3bfe90", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5MWNjOWFlZGU0YWVjOWI4ODE2Yjg0ODllYjk4YzJmMmEzYmZlOTA=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-10-07T20:58:28Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-10-18T02:06:55Z"}, "message": "Prepare simplify MutVisitor to have projections interned", "tree": {"sha": "0019ebc7cdae540a9e12884f872cc20e8659f02a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0019ebc7cdae540a9e12884f872cc20e8659f02a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAl2pHj8ACgkQiMlBzaHU\nZDIoqA//XQPoUQEwMtmOgJzlNbM/AViupW+42v82MX9xrnDfbVnZUuCxZFihtl4J\npYyxzuc95xO/ZXWE9fq+OtSSVV2wXRwcqtH5gl6PNRzXfYtBN5zi/7xV+cuBZA9I\nmRjF0i1XjBkTtbrIUNlRM/V9h44pZ5iUgWtNLQu8ZtOvFGLz/2l/syECvAAz7RIl\nkcdrKivMELoTQ+BXhyIYtNA1bsfaaHEZtYHQZrJ0ELIRjJKkf7zWEqpvmj3wWvUa\nteA92tQAdZ4kBaVLeEIURmCGxybT35SSSbEsdD/wjPYvWpx89HJVaDHFEgSmr56X\noLfchMCJ/I7tHu/G5WzKDOUzDqaV88zRe1CeE8hzyUwvU61AbaMyUr7hhmYXCpm1\n9MDC6F4nknqiDGAAqBrTckkTvwO8uoRCGp4zDoAP/VZhnzHwbf2Toqh+fTaLsEwp\n+/QlYuQEEDdi+bKRnLPYjjRvlZcWryDmWn8w4L3pgzzaBnIctmjTWWsbmDdz7cft\nL1rHP4pyZerU/EYIymPKgctOJjxmvylomPcjQxkL01esbugSTejJeMohdtKtcRQF\nGSFtx477/O50wFQWY0IUKHw8dfiTqX3nbPy/mIv1QSWglJtkdyFGXOGPtam/5QVz\nEywmgJpxPvB29sNheeUkdzeN6ogHFeZLkir+lvZJRg+94e71y+4=\n=tBe+\n-----END PGP SIGNATURE-----", "payload": "tree 0019ebc7cdae540a9e12884f872cc20e8659f02a\nparent e069e9ccacbe92de1c893be5ad77fd5d6173f937\nauthor Santiago Pastorino <spastorino@gmail.com> 1570481908 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1571364415 -0400\n\nPrepare simplify MutVisitor to have projections interned\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90", "html_url": "https://github.com/rust-lang/rust/commit/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e069e9ccacbe92de1c893be5ad77fd5d6173f937", "url": "https://api.github.com/repos/rust-lang/rust/commits/e069e9ccacbe92de1c893be5ad77fd5d6173f937", "html_url": "https://github.com/rust-lang/rust/commit/e069e9ccacbe92de1c893be5ad77fd5d6173f937"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "57bc1c8fab969a2988e435ae1612b76b8b8ed4de", "filename": "src/librustc_mir/transform/simplify.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/591cc9aede4aec9b8816b8489eb98c2f2a3bfe90/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs?ref=591cc9aede4aec9b8816b8489eb98c2f2a3bfe90", "patch": "@@ -366,7 +366,27 @@ impl<'tcx> MutVisitor<'tcx> for LocalUpdater {\n         });\n         self.super_basic_block_data(block, data);\n     }\n+\n     fn visit_local(&mut self, l: &mut Local, _: PlaceContext, _: Location) {\n         *l = self.map[*l].unwrap();\n     }\n+\n+    fn visit_place(\n+        &mut self,\n+        place: &mut Place<'tcx>,\n+        context: PlaceContext,\n+        location: Location,\n+    ) {\n+        self.visit_place_base(&mut place.base, context, location);\n+\n+        let new_projection: Vec<_> = place.projection.iter().map(|elem|\n+            if let PlaceElem::Index(local) = elem {\n+                PlaceElem::Index(self.map[*local].unwrap())\n+            } else {\n+                elem.clone()\n+            }\n+        ).collect();\n+\n+        place.projection = new_projection.into_boxed_slice();\n+    }\n }"}]}