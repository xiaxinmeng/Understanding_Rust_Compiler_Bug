{"sha": "c86a9c077c3b3a8c04166934ec1465920419a2cd", "node_id": "C_kwDOAAsO6NoAKGM4NmE5YzA3N2MzYjNhOGMwNDE2NjkzNGVjMTQ2NTkyMDQxOWEyY2Q", "commit": {"author": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-09-01T03:29:57Z"}, "committer": {"name": "Nicholas Nethercote", "email": "n.nethercote@gmail.com", "date": "2022-09-08T05:25:50Z"}, "message": "Introduce `DotDotPos`.\n\nThis shrinks `hir::Pat` from 88 to 72 bytes.", "tree": {"sha": "33588af54da62f7757fba20a25157e4e7560023e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/33588af54da62f7757fba20a25157e4e7560023e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c86a9c077c3b3a8c04166934ec1465920419a2cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c86a9c077c3b3a8c04166934ec1465920419a2cd", "html_url": "https://github.com/rust-lang/rust/commit/c86a9c077c3b3a8c04166934ec1465920419a2cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c86a9c077c3b3a8c04166934ec1465920419a2cd/comments", "author": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "977b6e29a345ee43acabd2e1a7eb8e454626e2f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/977b6e29a345ee43acabd2e1a7eb8e454626e2f3", "html_url": "https://github.com/rust-lang/rust/commit/977b6e29a345ee43acabd2e1a7eb8e454626e2f3"}], "stats": {"total": 22, "additions": 15, "deletions": 7}, "files": [{"sha": "bce49165e5b18060f96430be8356f5fb979d14ac", "filename": "clippy_lints/src/equatable_if_let.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fequatable_if_let.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fequatable_if_let.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fequatable_if_let.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -51,7 +51,9 @@ fn unary_pattern(pat: &Pat<'_>) -> bool {\n             false\n         },\n         PatKind::Struct(_, a, etc) => !etc && a.iter().all(|x| unary_pattern(x.pat)),\n-        PatKind::Tuple(a, etc) | PatKind::TupleStruct(_, a, etc) => !etc.is_some() && array_rec(a),\n+        PatKind::Tuple(a, etc) | PatKind::TupleStruct(_, a, etc) => {\n+            !etc.as_opt_usize().is_some() && array_rec(a)\n+        }\n         PatKind::Ref(x, _) | PatKind::Box(x) => unary_pattern(x),\n         PatKind::Path(_) | PatKind::Lit(_) => true,\n     }"}, {"sha": "93874b103b461d92bb06f73842e441b5e26d41b3", "filename": "clippy_lints/src/matches/match_same_arms.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fmatches%2Fmatch_same_arms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fmatches%2Fmatch_same_arms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fmatch_same_arms.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -248,7 +248,7 @@ impl<'a> NormalizedPat<'a> {\n                 } else {\n                     (None, adt.non_enum_variant())\n                 };\n-                let (front, back) = match wild_idx {\n+                let (front, back) = match wild_idx.as_opt_usize() {\n                     Some(i) => pats.split_at(i),\n                     None => (pats, [].as_slice()),\n                 };\n@@ -268,7 +268,7 @@ impl<'a> NormalizedPat<'a> {\n                     ty::Tuple(subs) => subs.len(),\n                     _ => return Self::Wild,\n                 };\n-                let (front, back) = match wild_idx {\n+                let (front, back) = match wild_idx.as_opt_usize() {\n                     Some(i) => pats.split_at(i),\n                     None => (pats, [].as_slice()),\n                 };"}, {"sha": "1bf1c4d1078952cab5deb3f2c756cfb78d1842b4", "filename": "clippy_lints/src/matches/single_match.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fmatches%2Fsingle_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fmatches%2Fsingle_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatches%2Fsingle_match.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -200,6 +200,8 @@ fn form_exhaustive_matches<'a>(cx: &LateContext<'a>, ty: Ty<'a>, left: &Pat<'_>,\n             // We don't actually know the position and the presence of the `..` (dotdot) operator\n             // in the arms, so we need to evaluate the correct offsets here in order to iterate in\n             // both arms at the same time.\n+            let left_pos = left_pos.as_opt_usize();\n+            let right_pos = right_pos.as_opt_usize();\n             let len = max(\n                 left_in.len() + {\n                     if left_pos.is_some() { 1 } else { 0 }"}, {"sha": "569870ab2b7f41ae3d4b4b2fd53083ba3b71d9ed", "filename": "clippy_lints/src/question_mark.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fquestion_mark.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Fquestion_mark.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fquestion_mark.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -122,7 +122,8 @@ fn check_if_let_some_or_err_and_early_return<'tcx>(cx: &LateContext<'tcx>, expr:\n     if_chain! {\n         if let Some(higher::IfLet { let_pat, let_expr, if_then, if_else }) = higher::IfLet::hir(cx, expr);\n         if !is_else_clause(cx.tcx, expr);\n-        if let PatKind::TupleStruct(ref path1, [field], None) = let_pat.kind;\n+        if let PatKind::TupleStruct(ref path1, [field], ddpos) = let_pat.kind;\n+        if ddpos.as_opt_usize().is_none();\n         if let PatKind::Binding(BindingAnnotation(by_ref, _), bind_id, ident, None) = field.kind;\n         let caller_ty = cx.typeck_results().expr_ty(let_expr);\n         let if_block = IfBlockType::IfLet(path1, caller_ty, ident.name, let_expr, if_then, if_else);"}, {"sha": "ce9ebad8c89a85e98687ef486fc410dca262993f", "filename": "clippy_lints/src/unit_types/let_unit_value.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funit_types%2Flet_unit_value.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -19,10 +19,12 @@ pub(super) fn check<'tcx>(cx: &LateContext<'tcx>, local: &'tcx Local<'_>) {\n         && cx.typeck_results().pat_ty(local.pat).is_unit()\n     {\n         if (local.ty.map_or(false, |ty| !matches!(ty.kind, TyKind::Infer))\n-            || matches!(local.pat.kind, PatKind::Tuple([], None)))\n+            || matches!(local.pat.kind, PatKind::Tuple([], ddpos) if ddpos.as_opt_usize().is_none()))\n             && expr_needs_inferred_result(cx, init)\n         {\n-            if !matches!(local.pat.kind, PatKind::Wild | PatKind::Tuple([], None)) {\n+            if !matches!(local.pat.kind, PatKind::Wild)\n+               && !matches!(local.pat.kind, PatKind::Tuple([], ddpos) if ddpos.as_opt_usize().is_none())\n+            {\n                 span_lint_and_then(\n                     cx,\n                     LET_UNIT_VALUE,"}, {"sha": "3cf043f22df5dc60e92265bb06133cc341a3b9d9", "filename": "clippy_utils/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_utils%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c86a9c077c3b3a8c04166934ec1465920419a2cd/clippy_utils%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Flib.rs?ref=c86a9c077c3b3a8c04166934ec1465920419a2cd", "patch": "@@ -1552,7 +1552,8 @@ pub fn iter_input_pats<'tcx>(decl: &FnDecl<'_>, body: &'tcx Body<'_>) -> impl It\n pub fn is_try<'tcx>(cx: &LateContext<'_>, expr: &'tcx Expr<'tcx>) -> Option<&'tcx Expr<'tcx>> {\n     fn is_ok(cx: &LateContext<'_>, arm: &Arm<'_>) -> bool {\n         if_chain! {\n-            if let PatKind::TupleStruct(ref path, pat, None) = arm.pat.kind;\n+            if let PatKind::TupleStruct(ref path, pat, ddpos) = arm.pat.kind;\n+            if ddpos.as_opt_usize().is_none();\n             if is_lang_ctor(cx, path, ResultOk);\n             if let PatKind::Binding(_, hir_id, _, None) = pat[0].kind;\n             if path_to_local_id(arm.body, hir_id);"}]}