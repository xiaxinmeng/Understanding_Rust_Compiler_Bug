{"sha": "1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "node_id": "C_kwDOAAsO6NoAKDFmNTM2MWI0MGM0Y2NmYTJmODA2Y2M5ZjI5M2Q4Mzk5YTU2NTFiOWE", "commit": {"author": {"name": "Victor Gil", "email": "victor.gil@tenthdimensions.com", "date": "2023-06-04T13:49:04Z"}, "committer": {"name": "Victor Gil", "email": "victor.gil@tenthdimensions.com", "date": "2023-06-04T13:49:04Z"}, "message": "Added custom risc32-imac for esp-espidf target", "tree": {"sha": "59df5f4b84c5394d6940a8af1b971785c82359c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59df5f4b84c5394d6940a8af1b971785c82359c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "html_url": "https://github.com/rust-lang/rust/commit/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/comments", "author": {"login": "Nassiel", "id": 1392769, "node_id": "MDQ6VXNlcjEzOTI3Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/1392769?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nassiel", "html_url": "https://github.com/Nassiel", "followers_url": "https://api.github.com/users/Nassiel/followers", "following_url": "https://api.github.com/users/Nassiel/following{/other_user}", "gists_url": "https://api.github.com/users/Nassiel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nassiel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nassiel/subscriptions", "organizations_url": "https://api.github.com/users/Nassiel/orgs", "repos_url": "https://api.github.com/users/Nassiel/repos", "events_url": "https://api.github.com/users/Nassiel/events{/privacy}", "received_events_url": "https://api.github.com/users/Nassiel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Nassiel", "id": 1392769, "node_id": "MDQ6VXNlcjEzOTI3Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/1392769?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nassiel", "html_url": "https://github.com/Nassiel", "followers_url": "https://api.github.com/users/Nassiel/followers", "following_url": "https://api.github.com/users/Nassiel/following{/other_user}", "gists_url": "https://api.github.com/users/Nassiel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nassiel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nassiel/subscriptions", "organizations_url": "https://api.github.com/users/Nassiel/orgs", "repos_url": "https://api.github.com/users/Nassiel/repos", "events_url": "https://api.github.com/users/Nassiel/events{/privacy}", "received_events_url": "https://api.github.com/users/Nassiel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9eee230cd0a56bfba3ce65121798d9f9f4341cdd", "url": "https://api.github.com/repos/rust-lang/rust/commits/9eee230cd0a56bfba3ce65121798d9f9f4341cdd", "html_url": "https://github.com/rust-lang/rust/commit/9eee230cd0a56bfba3ce65121798d9f9f4341cdd"}], "stats": {"total": 42, "additions": 38, "deletions": 4}, "files": [{"sha": "99e4ba24afb1c166c75bacf113fc40fb46f3fcc3", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "patch": "@@ -1284,6 +1284,7 @@ supported_targets! {\n     (\"riscv32im-unknown-none-elf\", riscv32im_unknown_none_elf),\n     (\"riscv32imc-unknown-none-elf\", riscv32imc_unknown_none_elf),\n     (\"riscv32imc-esp-espidf\", riscv32imc_esp_espidf),\n+    (\"riscv32imac-esp-espidf\", riscv32imac_esp_espidf),\n     (\"riscv32imac-unknown-none-elf\", riscv32imac_unknown_none_elf),\n     (\"riscv32imac-unknown-xous-elf\", riscv32imac_unknown_xous_elf),\n     (\"riscv32gc-unknown-linux-gnu\", riscv32gc_unknown_linux_gnu),"}, {"sha": "0795065409ad9d135d4b4a22d8a3bc0c5bf43eb5", "filename": "compiler/rustc_target/src/spec/riscv32imac_esp_espidf.rs", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_esp_espidf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_esp_espidf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_esp_espidf.rs?ref=1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "patch": "@@ -0,0 +1,31 @@\n+use crate::spec::{cvs, PanicStrategy, RelocModel, Target, TargetOptions};\n+\n+pub fn target() -> Target {\n+    Target {\n+        data_layout: \"e-m:e-p:32:32-i64:64-n32-S128\".into(),\n+        llvm_target: \"riscv32\".into(),\n+        pointer_width: 32,\n+        arch: \"riscv32\".into(),\n+\n+        options: TargetOptions {\n+            families: cvs![\"unix\"],\n+            os: \"espidf\".into(),\n+            env: \"newlib\".into(),\n+            vendor: \"espressif\".into(),\n+            linker: Some(\"riscv32-esp-elf-gcc\".into()),\n+            cpu: \"generic-rv32\".into(),\n+\n+            // As RiscV32IMAC architecture does natively support atomics,\n+            // automatically enable the support for the Rust STD library.\n+            max_atomic_width: Some(64),\n+            atomic_cas: true,\n+\n+            features: \"+m,+a,+c\".into(),\n+            panic_strategy: PanicStrategy::Abort,\n+            relocation_model: RelocModel::Static,\n+            emit_debug_gdb_scripts: false,\n+            eh_frame_header: false,\n+            ..Default::default()\n+        },\n+    }\n+}"}, {"sha": "d0d300010cbdcf98c81b67ed8689ed77b21b3e3c", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "patch": "@@ -298,6 +298,7 @@ target | std | host | notes\n `riscv32im-unknown-none-elf` | * |  | Bare RISC-V (RV32IM ISA)\n [`riscv32imac-unknown-xous-elf`](platform-support/riscv32imac-unknown-xous-elf.md) | ? |  | RISC-V Xous (RV32IMAC ISA)\n [`riscv32imc-esp-espidf`](platform-support/esp-idf.md) | \u2713 |  | RISC-V ESP-IDF\n+[`riscv32imac-esp-espidf`](platform-support/esp-idf.md) | \u2713 |  | RISC-V ESP-IDF\n `riscv64gc-unknown-freebsd` |   |   | RISC-V FreeBSD\n `riscv64gc-unknown-fuchsia` |   |   | RISC-V Fuchsia\n `riscv64gc-unknown-linux-musl` |   |   | RISC-V Linux (kernel 4.20, musl 1.2.0)"}, {"sha": "4bbe35709b087ef3dea342d6b97f0083b0f1670c", "filename": "src/doc/rustc/src/platform-support/esp-idf.md", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Fesp-idf.md", "raw_url": "https://github.com/rust-lang/rust/raw/1f5361b40c4ccfa2f806cc9f293d8399a5651b9a/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Fesp-idf.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Fesp-idf.md?ref=1f5361b40c4ccfa2f806cc9f293d8399a5651b9a", "patch": "@@ -13,11 +13,12 @@ Targets for the [ESP-IDF](https://github.com/espressif/esp-idf) development fram\n \n The target names follow this format: `$ARCH-esp-espidf`, where `$ARCH` specifies the target processor architecture. The following targets are currently defined:\n \n-|          Target name           | Target CPU(s)         |\n-|--------------------------------|-----------------------|\n-| `riscv32imc-esp-espidf`        |  [ESP32-C3](https://www.espressif.com/en/products/socs/esp32-c3)             |\n+|          Target name           | Target CPU(s)         | Minimum ESP-IDF version |\n+|--------------------------------|-----------------------|-------------------------|\n+| `riscv32imc-esp-espidf`        |  [ESP32-C3](https://www.espressif.com/en/products/socs/esp32-c3)             | `v4.3`                |\n+| `riscv32imac-esp-espidf`       |  [ESP32-C6](https://www.espressif.com/en/products/socs/esp32-c6)             | `v5.1`                |\n \n-The minimum supported ESP-IDF version is `v4.3`, though it is recommended to use the latest stable release if possible.\n+It is recommended to use the latest ESP-IDF stable release if possible.\n \n ## Building the target\n "}]}