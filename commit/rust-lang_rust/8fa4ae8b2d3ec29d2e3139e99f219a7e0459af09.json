{"sha": "8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09", "node_id": "C_kwDOAAsO6NoAKDhmYTRhZThiMmQzZWMyOWQyZTMxMzllOTlmMjE5YTdlMDQ1OWFmMDk", "commit": {"author": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2022-03-22T22:03:59Z"}, "committer": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2022-03-22T22:31:30Z"}, "message": "Test SVE2 includes NEON and not vice versa\n\nRequired by https://github.com/rust-lang/rust/issues/95122", "tree": {"sha": "479cd9baccab01742f253950811e53b2c7a7401d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/479cd9baccab01742f253950811e53b2c7a7401d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09", "html_url": "https://github.com/rust-lang/rust/commit/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d6415c29102043a53b1f2e02d36767d6c450480", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d6415c29102043a53b1f2e02d36767d6c450480", "html_url": "https://github.com/rust-lang/rust/commit/7d6415c29102043a53b1f2e02d36767d6c450480"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "5fbd5e8a28d94efc9c2c60aba55b5e0be657769c", "filename": "src/test/ui/target-feature/feature-hierarchy.rs", "status": "added", "additions": 58, "deletions": 0, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09/src%2Ftest%2Fui%2Ftarget-feature%2Ffeature-hierarchy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09/src%2Ftest%2Fui%2Ftarget-feature%2Ffeature-hierarchy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftarget-feature%2Ffeature-hierarchy.rs?ref=8fa4ae8b2d3ec29d2e3139e99f219a7e0459af09", "patch": "@@ -0,0 +1,58 @@\n+// revisions: aarch64-neon aarch64-sve2\n+// [aarch64-neon] compile-flags: -Ctarget-feature=+neon --target=aarch64-unknown-linux-gnu\n+// [aarch64-neon] needs-llvm-components: aarch64\n+// [aarch64-sve2] compile-flags: -Ctarget-feature=-neon,+sve2 --target=aarch64-unknown-linux-gnu\n+// [aarch64-sve2] needs-llvm-components: aarch64\n+// build-pass\n+#![no_core]\n+#![crate_type = \"rlib\"]\n+#![feature(intrinsics, rustc_attrs, no_core, lang_items, staged_api)]\n+#![stable(feature = \"test\", since = \"1.0.0\")]\n+\n+// Tests vetting \"feature hierarchies\" in the cases where we impose them.\n+\n+// Supporting minimal rust core code\n+#[lang = \"sized\"]\n+trait Sized {}\n+#[lang = \"copy\"]\n+trait Copy {}\n+impl Copy for bool {}\n+\n+extern \"rust-intrinsic\" {\n+    #[rustc_const_stable(feature = \"test\", since = \"1.0.0\")]\n+    fn unreachable() -> !;\n+}\n+\n+#[rustc_builtin_macro]\n+macro_rules! cfg {\n+    ($($cfg:tt)*) => {};\n+}\n+\n+// Test code\n+const fn do_or_die(cond: bool) {\n+    if cond {\n+    } else {\n+        unsafe { unreachable() }\n+    }\n+}\n+\n+macro_rules! assert {\n+    ($x:expr $(,)?) => {\n+        const _: () = do_or_die($x);\n+    };\n+}\n+\n+\n+#[cfg(aarch64_neon)]\n+fn check_neon_not_sve2() {\n+    // This checks that a normal aarch64 target doesn't suddenly jump up the feature hierarchy.\n+    assert!(cfg!(target_feature = \"neon\"));\n+    assert!(cfg!(not(target_feature = \"sve2\")));\n+}\n+\n+#[cfg(aarch64_sve2)]\n+fn check_sve2_includes_neon() {\n+    // This checks that aarch64's sve2 includes neon\n+    assert!(cfg!(target_feature = \"neon\"));\n+    assert!(cfg!(target_feature = \"sve2\"));\n+}"}]}