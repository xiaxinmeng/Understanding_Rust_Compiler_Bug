{"sha": "847f4613e0a60ce657924439f9339706911bbfab", "node_id": "C_kwDOAAsO6NoAKDg0N2Y0NjEzZTBhNjBjZTY1NzkyNDQzOWY5MzM5NzA2OTExYmJmYWI", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-08-01T00:46:49Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-08-01T02:53:16Z"}, "message": "Never inline Windows dtor access", "tree": {"sha": "83b18d9086227e09181d0215f118422a5602adb6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83b18d9086227e09181d0215f118422a5602adb6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/847f4613e0a60ce657924439f9339706911bbfab", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmLnQB0ACgkQcTRy8vRW\nJ957/Q/9FFHylQ755oyBW5AE/VxMiX3DJzVEdlpbjnXF8Vltzomc5dh8XlO/Eo7I\nvFCEdQbdcFj4PbDtEgGq9yAHWTZYmnZesHDuZ0W/OG2rnxLgI/z0aQsZYtlnzvxq\nIlIxRkfkD4N5zozKQ2dDu4A5inmkjvLbXJ2jvQ3Vl+KKTgkDHS9lcl5HL6eg9SwA\nxtBKrDZKKADyXEq4qcAbz3owugCm5S176XhrXAN6368oLiq7WRfR3Jo5beeTStQH\nXi5zcRGqv0sfIP3ToBt5Ai4Bk0pirVtrh9+1uGE076dpYYx3snAGeF0ltLvDOCmp\nIhNXR/FmDEs02iDtsLYcUtIEMUzZCkyBkbIC//vJXmZ/GhnsdE5vRaOp04yCx8XP\nXtJTC88MwoifqLdSL7vGUzeqhoQZWFpeMFjPDB8hAnVWe1Xx58DmNC7PoFhlyS3x\navRtPIiWbA5Jmf2vwY2gGpqR5D9FYkcCXAbYQkXVSvPkLHALqDloCb+QFAJRXBIG\nZg+IWG8I39dmnKLEUFAFa4PkNcn86nVfITMluVpzEKQuJoyrBLdSqzRoJphRSACA\nkJ2vxTbO4kDQMMv6AgSvDMX7iqgxNutt4NkXuHy3kFDDwdXz0LMygV6MfHZtW5Lp\n1bKokoqLMPNUSa7+l3ilk5fIuHofoU7eerfoU/nhFmxrBqQzjIU=\n=NMC+\n-----END PGP SIGNATURE-----", "payload": "tree 83b18d9086227e09181d0215f118422a5602adb6\nparent f9cba63746d0fff816250b2ba7b706b5d4dcf000\nauthor Chris Denton <christophersdenton@gmail.com> 1659314809 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1659322396 +0100\n\nNever inline Windows dtor access\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/847f4613e0a60ce657924439f9339706911bbfab", "html_url": "https://github.com/rust-lang/rust/commit/847f4613e0a60ce657924439f9339706911bbfab", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/847f4613e0a60ce657924439f9339706911bbfab/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9cba63746d0fff816250b2ba7b706b5d4dcf000", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9cba63746d0fff816250b2ba7b706b5d4dcf000", "html_url": "https://github.com/rust-lang/rust/commit/f9cba63746d0fff816250b2ba7b706b5d4dcf000"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "9707a95dff21b4f68b1bbbfe6137b7f3a68c6990", "filename": "library/std/src/sys/windows/thread_local_dtor.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/847f4613e0a60ce657924439f9339706911bbfab/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_dtor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/847f4613e0a60ce657924439f9339706911bbfab/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_dtor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fthread_local_dtor.rs?ref=847f4613e0a60ce657924439f9339706911bbfab", "patch": "@@ -8,10 +8,14 @@\n #[thread_local]\n static mut DESTRUCTORS: Vec<(*mut u8, unsafe extern \"C\" fn(*mut u8))> = Vec::new();\n \n+// Ensure this can never be inlined because otherwise this may break in dylibs.\n+// See #44391.\n+#[inline(never)]\n pub unsafe fn register_dtor(t: *mut u8, dtor: unsafe extern \"C\" fn(*mut u8)) {\n     DESTRUCTORS.push((t, dtor));\n }\n \n+#[inline(never)] // See comment above\n /// Runs destructors. This should not be called until thread exit.\n pub unsafe fn run_keyless_dtors() {\n     // Drop all the destructors."}]}