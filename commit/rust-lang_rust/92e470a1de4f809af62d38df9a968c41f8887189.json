{"sha": "92e470a1de4f809af62d38df9a968c41f8887189", "node_id": "C_kwDOAAsO6NoAKDkyZTQ3MGExZGU0ZjgwOWFmNjJkMzhkZjlhOTY4YzQxZjg4ODcxODk", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-06-28T10:49:55Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-07-15T15:56:17Z"}, "message": "Move constructor into the branch that actually uses it", "tree": {"sha": "96f6b3238626e3a2467163acb84af567440a1213", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/96f6b3238626e3a2467163acb84af567440a1213"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92e470a1de4f809af62d38df9a968c41f8887189", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92e470a1de4f809af62d38df9a968c41f8887189", "html_url": "https://github.com/rust-lang/rust/commit/92e470a1de4f809af62d38df9a968c41f8887189", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92e470a1de4f809af62d38df9a968c41f8887189/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea68ce7fac0a5888e54e5725066b04fcd4290efa", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea68ce7fac0a5888e54e5725066b04fcd4290efa", "html_url": "https://github.com/rust-lang/rust/commit/ea68ce7fac0a5888e54e5725066b04fcd4290efa"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "a17d8f336303b7615c46bed0850f9b66132507a9", "filename": "compiler/rustc_mir_build/src/thir/pattern/usefulness.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92e470a1de4f809af62d38df9a968c41f8887189/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fusefulness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92e470a1de4f809af62d38df9a968c41f8887189/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fusefulness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fpattern%2Fusefulness.rs?ref=92e470a1de4f809af62d38df9a968c41f8887189", "patch": "@@ -806,11 +806,6 @@ fn is_useful<'p, 'tcx>(\n \n     debug_assert!(rows.iter().all(|r| r.len() == v.len()));\n \n-    let ty = v.head().ty();\n-    let is_non_exhaustive = cx.is_foreign_non_exhaustive_enum(ty);\n-    debug!(\"v.head: {:?}, v.span: {:?}\", v.head(), v.head().span());\n-    let pcx = PatCtxt { cx, ty, span: v.head().span(), is_top_level, is_non_exhaustive };\n-\n     // If the first pattern is an or-pattern, expand it.\n     let mut ret = Usefulness::new_not_useful(witness_preference);\n     if v.head().is_or_pat() {\n@@ -832,6 +827,11 @@ fn is_useful<'p, 'tcx>(\n             }\n         }\n     } else {\n+        let ty = v.head().ty();\n+        let is_non_exhaustive = cx.is_foreign_non_exhaustive_enum(ty);\n+        debug!(\"v.head: {:?}, v.span: {:?}\", v.head(), v.head().span());\n+        let pcx = PatCtxt { cx, ty, span: v.head().span(), is_top_level, is_non_exhaustive };\n+\n         let v_ctor = v.head().ctor();\n         debug!(?v_ctor);\n         if let Constructor::IntRange(ctor_range) = &v_ctor {"}]}