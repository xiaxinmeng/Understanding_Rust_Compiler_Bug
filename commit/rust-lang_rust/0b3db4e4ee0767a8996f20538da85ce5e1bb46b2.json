{"sha": "0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "node_id": "C_kwDOAAsO6NoAKDBiM2RiNGU0ZWUwNzY3YTg5OTZmMjA1MzhkYTg1Y2U1ZTFiYjQ2YjI", "commit": {"author": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2022-04-12T00:43:42Z"}, "committer": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2022-04-15T01:19:48Z"}, "message": "Use native duplicate attribute check", "tree": {"sha": "2646be1ea3904ec9b01e69186d218a0102f31a55", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2646be1ea3904ec9b01e69186d218a0102f31a55"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTgxeqBxcDGar1sVhy4DhnkZitapAUCYljINAAKCRC4DhnkZita\npC6OAP9CQh2/cXEuzy2qjsVOjGB+I2RV9Utp3Tf3eud3qhyWXwD+O5I07rBmjz9b\nw4slUK4DyyihqANxiWkN25pIQZCOCwI=\n=HAfi\n-----END PGP SIGNATURE-----", "payload": "tree 2646be1ea3904ec9b01e69186d218a0102f31a55\nparent bfdf234fae852113d73fbe894d2583857b10d8d2\nauthor Jacob Pratt <jacob@jhpratt.dev> 1649724222 -0400\ncommitter Jacob Pratt <jacob@jhpratt.dev> 1649985588 -0400\n\nUse native duplicate attribute check\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "html_url": "https://github.com/rust-lang/rust/commit/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/comments", "author": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfdf234fae852113d73fbe894d2583857b10d8d2", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfdf234fae852113d73fbe894d2583857b10d8d2", "html_url": "https://github.com/rust-lang/rust/commit/bfdf234fae852113d73fbe894d2583857b10d8d2"}], "stats": {"total": 63, "additions": 31, "deletions": 32}, "files": [{"sha": "5a79cf68f113e192d745abd3b630802bf11e9d90", "filename": "compiler/rustc_attr/src/builtin.rs", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -679,14 +679,6 @@ where\n             continue;\n         }\n \n-        if let Some((_, span)) = &depr {\n-            struct_span_err!(diagnostic, attr.span, E0550, \"multiple deprecated attributes\")\n-                .span_label(attr.span, \"repeated deprecation attribute\")\n-                .span_label(*span, \"first deprecation attribute\")\n-                .emit();\n-            break;\n-        }\n-\n         // FIXME(jhpratt) remove this eventually\n         if attr.has_name(sym::rustc_deprecated) {\n             diagnostic"}, {"sha": "2d94a028ebe3f1099afb79e52f2c29c3b779a5a5", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -304,8 +304,7 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n             List: r#\"/*opt*/ since = \"version\", /*opt*/ note = \"reason\"\"#,\n             NameValueStr: \"reason\"\n         ),\n-        // This has special duplicate handling in E0550 to handle duplicates with rustc_deprecated\n-        DuplicatesOk\n+        ErrorFollowing\n     ),\n \n     // Crate properties:\n@@ -463,10 +462,10 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n     // ==========================================================================\n \n     ungated!(feature, CrateLevel, template!(List: \"name1, name2, ...\"), DuplicatesOk),\n-    // DuplicatesOk since it has its own validation\n+    // FIXME(jhpratt) remove this eventually\n     ungated!(\n         rustc_deprecated, Normal,\n-        template!(List: r#\"since = \"version\", note = \"...\"\"#), DuplicatesOk // See E0550\n+        template!(List: r#\"since = \"version\", note = \"...\"\"#), ErrorFollowing\n     ),\n     // DuplicatesOk since it has its own validation\n     ungated!("}, {"sha": "9ea75b68f81ce0c5f209b905e2883e110c7cf40d", "filename": "src/test/ui/deprecation/deprecation-sanity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -24,7 +24,7 @@ mod bogus_attribute_types_1 {\n }\n \n #[deprecated(since = \"a\", note = \"b\")]\n-#[deprecated(since = \"a\", note = \"b\")] //~ ERROR multiple deprecated attributes\n+#[deprecated(since = \"a\", note = \"b\")] //~ ERROR multiple `deprecated` attributes\n fn multiple1() { }\n \n #[deprecated(since = \"a\", since = \"b\", note = \"c\")] //~ ERROR multiple 'since' items"}, {"sha": "973c672df91c3c2b933496205ed8b9f7797335fc", "filename": "src/test/ui/deprecation/deprecation-sanity.stderr", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -1,3 +1,15 @@\n+error: multiple `deprecated` attributes\n+  --> $DIR/deprecation-sanity.rs:27:1\n+   |\n+LL | #[deprecated(since = \"a\", note = \"b\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+note: attribute also specified here\n+  --> $DIR/deprecation-sanity.rs:26:1\n+   |\n+LL | #[deprecated(since = \"a\", note = \"b\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error[E0541]: unknown meta item 'reason'\n   --> $DIR/deprecation-sanity.rs:4:43\n    |\n@@ -40,14 +52,6 @@ error[E0565]: item in `deprecated` must be a key/value pair\n LL |     #[deprecated(\"test\")]\n    |                  ^^^^^^\n \n-error[E0550]: multiple deprecated attributes\n-  --> $DIR/deprecation-sanity.rs:27:1\n-   |\n-LL | #[deprecated(since = \"a\", note = \"b\")]\n-   | -------------------------------------- first deprecation attribute\n-LL | #[deprecated(since = \"a\", note = \"b\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ repeated deprecation attribute\n-\n error[E0538]: multiple 'since' items\n   --> $DIR/deprecation-sanity.rs:30:27\n    |\n@@ -64,5 +68,5 @@ LL | #[deprecated = \"hello\"]\n \n error: aborting due to 10 previous errors\n \n-Some errors have detailed explanations: E0538, E0541, E0550, E0551, E0565.\n+Some errors have detailed explanations: E0538, E0541, E0551, E0565.\n For more information about an error, try `rustc --explain E0538`."}, {"sha": "cc30e6ab9a9b31b73aca2905aa7037ec1d4bd48c", "filename": "src/test/ui/stability-attribute/stability-attribute-sanity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.rs?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -59,7 +59,7 @@ fn multiple3() { }\n \n #[stable(feature = \"a\", since = \"b\")] //~ ERROR invalid stability version found\n #[deprecated(since = \"b\", note = \"text\")]\n-#[deprecated(since = \"b\", note = \"text\")] //~ ERROR multiple deprecated attributes\n+#[deprecated(since = \"b\", note = \"text\")] //~ ERROR multiple `deprecated` attributes\n #[rustc_const_unstable(feature = \"c\", issue = \"none\")]\n #[rustc_const_unstable(feature = \"d\", issue = \"none\")] //~ ERROR multiple stability levels\n pub const fn multiple4() { }"}, {"sha": "fcb1eefddbcef733b7777a3273d27a903b1a8c50", "filename": "src/test/ui/stability-attribute/stability-attribute-sanity.stderr", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0b3db4e4ee0767a8996f20538da85ce5e1bb46b2/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr?ref=0b3db4e4ee0767a8996f20538da85ce5e1bb46b2", "patch": "@@ -1,3 +1,15 @@\n+error: multiple `deprecated` attributes\n+  --> $DIR/stability-attribute-sanity.rs:62:1\n+   |\n+LL | #[deprecated(since = \"b\", note = \"text\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+note: attribute also specified here\n+  --> $DIR/stability-attribute-sanity.rs:61:1\n+   |\n+LL | #[deprecated(since = \"b\", note = \"text\")]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n error[E0541]: unknown meta item 'reason'\n   --> $DIR/stability-attribute-sanity.rs:8:42\n    |\n@@ -82,14 +94,6 @@ error[E0544]: multiple stability levels\n LL | #[stable(feature = \"a\", since = \"b\")]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error[E0550]: multiple deprecated attributes\n-  --> $DIR/stability-attribute-sanity.rs:62:1\n-   |\n-LL | #[deprecated(since = \"b\", note = \"text\")]\n-   | ----------------------------------------- first deprecation attribute\n-LL | #[deprecated(since = \"b\", note = \"text\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ repeated deprecation attribute\n-\n error[E0544]: multiple stability levels\n   --> $DIR/stability-attribute-sanity.rs:64:1\n    |\n@@ -128,5 +132,5 @@ LL | #[stable(feature = \"a\", since = \"1.0.0\")]\n \n error: aborting due to 20 previous errors\n \n-Some errors have detailed explanations: E0539, E0541, E0542, E0543, E0544, E0546, E0547, E0549, E0550.\n+Some errors have detailed explanations: E0539, E0541, E0542, E0543, E0544, E0546, E0547, E0549.\n For more information about an error, try `rustc --explain E0539`."}]}