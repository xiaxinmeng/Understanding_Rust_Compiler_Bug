{"sha": "ded048398f36c6bc15c71b1be270cc91c418935e", "node_id": "C_kwDOAAsO6NoAKGRlZDA0ODM5OGYzNmM2YmMxNWM3MWIxYmUyNzBjYzkxYzQxODkzNWU", "commit": {"author": {"name": "SparrowLii", "email": "liyuan179@huawei.com", "date": "2023-04-06T11:36:21Z"}, "committer": {"name": "SparrowLii", "email": "liyuan179@huawei.com", "date": "2023-04-06T11:36:21Z"}, "message": "add `dont_check_failure_status` option in the compiler test", "tree": {"sha": "d60d04f4bf1cd74abcbd6256ba6a873b0f0e8ca5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d60d04f4bf1cd74abcbd6256ba6a873b0f0e8ca5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ded048398f36c6bc15c71b1be270cc91c418935e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ded048398f36c6bc15c71b1be270cc91c418935e", "html_url": "https://github.com/rust-lang/rust/commit/ded048398f36c6bc15c71b1be270cc91c418935e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ded048398f36c6bc15c71b1be270cc91c418935e/comments", "author": {"login": "SparrowLii", "id": 68270294, "node_id": "MDQ6VXNlcjY4MjcwMjk0", "avatar_url": "https://avatars.githubusercontent.com/u/68270294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SparrowLii", "html_url": "https://github.com/SparrowLii", "followers_url": "https://api.github.com/users/SparrowLii/followers", "following_url": "https://api.github.com/users/SparrowLii/following{/other_user}", "gists_url": "https://api.github.com/users/SparrowLii/gists{/gist_id}", "starred_url": "https://api.github.com/users/SparrowLii/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SparrowLii/subscriptions", "organizations_url": "https://api.github.com/users/SparrowLii/orgs", "repos_url": "https://api.github.com/users/SparrowLii/repos", "events_url": "https://api.github.com/users/SparrowLii/events{/privacy}", "received_events_url": "https://api.github.com/users/SparrowLii/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SparrowLii", "id": 68270294, "node_id": "MDQ6VXNlcjY4MjcwMjk0", "avatar_url": "https://avatars.githubusercontent.com/u/68270294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SparrowLii", "html_url": "https://github.com/SparrowLii", "followers_url": "https://api.github.com/users/SparrowLii/followers", "following_url": "https://api.github.com/users/SparrowLii/following{/other_user}", "gists_url": "https://api.github.com/users/SparrowLii/gists{/gist_id}", "starred_url": "https://api.github.com/users/SparrowLii/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SparrowLii/subscriptions", "organizations_url": "https://api.github.com/users/SparrowLii/orgs", "repos_url": "https://api.github.com/users/SparrowLii/repos", "events_url": "https://api.github.com/users/SparrowLii/events{/privacy}", "received_events_url": "https://api.github.com/users/SparrowLii/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1d3610ac1ddd1cd605479274047fd0a3f37d220", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1d3610ac1ddd1cd605479274047fd0a3f37d220", "html_url": "https://github.com/rust-lang/rust/commit/c1d3610ac1ddd1cd605479274047fd0a3f37d220"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "43151f0530806b867ec58f5f1327b731b78d2d4a", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ded048398f36c6bc15c71b1be270cc91c418935e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ded048398f36c6bc15c71b1be270cc91c418935e/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=ded048398f36c6bc15c71b1be270cc91c418935e", "patch": "@@ -150,6 +150,8 @@ pub struct TestProps {\n     pub normalize_stdout: Vec<(String, String)>,\n     pub normalize_stderr: Vec<(String, String)>,\n     pub failure_status: i32,\n+    // For UI tests, allows compiler to exit with arbitrary failure status\n+    pub dont_check_failure_status: bool,\n     // Whether or not `rustfix` should apply the `CodeSuggestion`s of this test and compile the\n     // resulting Rust code.\n     pub run_rustfix: bool,\n@@ -192,6 +194,7 @@ mod directives {\n     pub const CHECK_TEST_LINE_NUMBERS_MATCH: &'static str = \"check-test-line-numbers-match\";\n     pub const IGNORE_PASS: &'static str = \"ignore-pass\";\n     pub const FAILURE_STATUS: &'static str = \"failure-status\";\n+    pub const DONT_CHECK_FAILURE_STATUS: &'static str = \"dont-check-failure-status\";\n     pub const RUN_RUSTFIX: &'static str = \"run-rustfix\";\n     pub const RUSTFIX_ONLY_MACHINE_APPLICABLE: &'static str = \"rustfix-only-machine-applicable\";\n     pub const ASSEMBLY_OUTPUT: &'static str = \"assembly-output\";\n@@ -239,6 +242,7 @@ impl TestProps {\n             normalize_stdout: vec![],\n             normalize_stderr: vec![],\n             failure_status: -1,\n+            dont_check_failure_status: false,\n             run_rustfix: false,\n             rustfix_only_machine_applicable: false,\n             assembly_output: None,\n@@ -401,6 +405,12 @@ impl TestProps {\n                     self.failure_status = code;\n                 }\n \n+                config.set_name_directive(\n+                    ln,\n+                    DONT_CHECK_FAILURE_STATUS,\n+                    &mut self.dont_check_failure_status,\n+                );\n+\n                 config.set_name_directive(ln, RUN_RUSTFIX, &mut self.run_rustfix);\n                 config.set_name_directive(\n                     ln,"}, {"sha": "b71ae03eb55467311011e7ddf12120b6d22642bd", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ded048398f36c6bc15c71b1be270cc91c418935e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ded048398f36c6bc15c71b1be270cc91c418935e/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=ded048398f36c6bc15c71b1be270cc91c418935e", "patch": "@@ -309,7 +309,9 @@ impl<'test> TestCx<'test> {\n                 );\n             }\n \n-            self.check_correct_failure_status(proc_res);\n+            if !self.props.dont_check_failure_status {\n+                self.check_correct_failure_status(proc_res);\n+            }\n         }\n     }\n "}, {"sha": "2f1cffa2fa90721bac14994ce85eb554dcea02ea", "filename": "tests/ui/recursion/issue-95134.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ded048398f36c6bc15c71b1be270cc91c418935e/tests%2Fui%2Frecursion%2Fissue-95134.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ded048398f36c6bc15c71b1be270cc91c418935e/tests%2Fui%2Frecursion%2Fissue-95134.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frecursion%2Fissue-95134.rs?ref=ded048398f36c6bc15c71b1be270cc91c418935e", "patch": "@@ -1,7 +1,7 @@\n // build-fail\n // known-bug: #95134\n // compile-flags: -Copt-level=0\n-// failure-status: 101\n+// dont-check-failure-status\n // dont-check-compiler-stderr\n \n pub fn encode_num<Writer: ExampleWriter>(n: u32, mut writer: Writer) -> Result<(), Writer::Error> {"}]}