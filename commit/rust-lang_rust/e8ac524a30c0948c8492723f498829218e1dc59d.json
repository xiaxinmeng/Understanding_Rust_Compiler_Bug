{"sha": "e8ac524a30c0948c8492723f498829218e1dc59d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4YWM1MjRhMzBjMDk0OGM4NDkyNzIzZjQ5ODgyOTIxOGUxZGM1OWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-15T11:41:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-08-15T11:41:00Z"}, "message": "Auto merge of #1871 - hyd-dev:no-mangle-method, r=RalfJung\n\nUpdate tests for `#[no_mangle]` on associated functions\n\nhttps://github.com/rust-lang/rust/pull/86492 has landed:\n- The code in https://github.com/rust-lang/miri/issues/1837 starts to work (even without `AssocFn::foo();` at line 12) in Miri.\n- `pub` is not necessary for `#[no_mangle]` associated functions in `test-cargo-miri/exported-symbol-dep/src/lib.rs` anymore.\n\nCloses https://github.com/rust-lang/miri/issues/1837.", "tree": {"sha": "47d43f49bd222e1e67d3883b9d6ac00710f0069f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47d43f49bd222e1e67d3883b9d6ac00710f0069f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8ac524a30c0948c8492723f498829218e1dc59d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8ac524a30c0948c8492723f498829218e1dc59d", "html_url": "https://github.com/rust-lang/rust/commit/e8ac524a30c0948c8492723f498829218e1dc59d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8ac524a30c0948c8492723f498829218e1dc59d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13fae3d0740e2326e30edf38294f308198e6d79f", "url": "https://api.github.com/repos/rust-lang/rust/commits/13fae3d0740e2326e30edf38294f308198e6d79f", "html_url": "https://github.com/rust-lang/rust/commit/13fae3d0740e2326e30edf38294f308198e6d79f"}, {"sha": "838ed1d75412f8c4ccb3750da6e67687af427520", "url": "https://api.github.com/repos/rust-lang/rust/commits/838ed1d75412f8c4ccb3750da6e67687af427520", "html_url": "https://github.com/rust-lang/rust/commit/838ed1d75412f8c4ccb3750da6e67687af427520"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "5b8a314ae73245051cc58018ba9988075382ff18", "filename": "test-cargo-miri/exported-symbol-dep/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e8ac524a30c0948c8492723f498829218e1dc59d/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ac524a30c0948c8492723f498829218e1dc59d/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fexported-symbol-dep%2Fsrc%2Flib.rs?ref=e8ac524a30c0948c8492723f498829218e1dc59d", "patch": "@@ -3,11 +3,11 @@ fn exported_symbol() -> i32 {\n     123456\n }\n \n-pub struct AssocFn;\n+struct AssocFn;\n \n impl AssocFn {\n     #[no_mangle]\n-    pub fn assoc_fn_as_exported_symbol() -> i32 {\n+    fn assoc_fn_as_exported_symbol() -> i32 {\n         -123456\n     }\n }"}, {"sha": "ff56bb78a218746f3e67bd89b79a2e5a9da25f04", "filename": "tests/run-pass/function_calls/exported_symbol.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e8ac524a30c0948c8492723f498829218e1dc59d/tests%2Frun-pass%2Ffunction_calls%2Fexported_symbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ac524a30c0948c8492723f498829218e1dc59d/tests%2Frun-pass%2Ffunction_calls%2Fexported_symbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Ffunction_calls%2Fexported_symbol.rs?ref=e8ac524a30c0948c8492723f498829218e1dc59d", "patch": "@@ -15,6 +15,16 @@ fn baz() -> i32 {\n     -3\n }\n \n+struct AssocFn;\n+\n+impl AssocFn {\n+    #[no_mangle]\n+    fn qux() -> i32 {\n+        -4\n+    }\n+}\n+\n+\n fn main() {\n     // Repeat calls to make sure the `Instance` cache is not broken.\n     for _ in 0..3 {\n@@ -32,10 +42,12 @@ fn main() {\n         extern \"Rust\" {\n             fn bar() -> i32;\n             fn baz() -> i32;\n+            fn qux() -> i32;\n         }\n \n         assert_eq!(unsafe { bar() }, -2);\n         assert_eq!(unsafe { baz() }, -3);\n+        assert_eq!(unsafe { qux() }, -4);\n \n         #[allow(clashing_extern_declarations)]\n         {\n@@ -53,6 +65,7 @@ fn main() {\n             extern \"C\" {\n                 fn bar() -> i32;\n                 fn baz() -> i32;\n+                fn qux() -> i32;\n             }\n \n             unsafe {\n@@ -61,6 +74,7 @@ fn main() {\n                 };\n                 assert_eq!(transmute(bar)(), -2);\n                 assert_eq!(transmute(baz)(), -3);\n+                assert_eq!(transmute(qux)(), -4);\n             }\n         }\n     }"}]}