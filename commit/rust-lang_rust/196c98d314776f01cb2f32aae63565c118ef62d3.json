{"sha": "196c98d314776f01cb2f32aae63565c118ef62d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5NmM5OGQzMTQ3NzZmMDFjYjJmMzJhYWU2MzU2NWMxMThlZjYyZDM=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-05-03T15:53:06Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-05-04T01:26:28Z"}, "message": "remove use of `ast_ty_to_ty_cache` from librustdoc", "tree": {"sha": "fef9ecd47651c71bf475c6e1966766a4bd3cee4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fef9ecd47651c71bf475c6e1966766a4bd3cee4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/196c98d314776f01cb2f32aae63565c118ef62d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/196c98d314776f01cb2f32aae63565c118ef62d3", "html_url": "https://github.com/rust-lang/rust/commit/196c98d314776f01cb2f32aae63565c118ef62d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/196c98d314776f01cb2f32aae63565c118ef62d3/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5efc86a838b6dc5c41185957464b5a5b342aba19", "url": "https://api.github.com/repos/rust-lang/rust/commits/5efc86a838b6dc5c41185957464b5a5b342aba19", "html_url": "https://github.com/rust-lang/rust/commit/5efc86a838b6dc5c41185957464b5a5b342aba19"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "7b1a1ec7d26d3cc830cdf43dae2083f995ad175b", "filename": "src/Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/196c98d314776f01cb2f32aae63565c118ef62d3/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/196c98d314776f01cb2f32aae63565c118ef62d3/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=196c98d314776f01cb2f32aae63565c118ef62d3", "patch": "@@ -793,6 +793,7 @@ dependencies = [\n  \"rustc_metadata 0.0.0\",\n  \"rustc_resolve 0.0.0\",\n  \"rustc_trans 0.0.0\",\n+ \"rustc_typeck 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n  \"syntax_pos 0.0.0\","}, {"sha": "0e8a6606ae79f387aca5d2d7941e2225a98e75af", "filename": "src/librustdoc/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2FCargo.toml?ref=196c98d314776f01cb2f32aae63565c118ef62d3", "patch": "@@ -21,6 +21,7 @@ rustc_errors = { path = \"../librustc_errors\" }\n rustc_lint = { path = \"../librustc_lint\" }\n rustc_metadata = { path = \"../librustc_metadata\" }\n rustc_resolve = { path = \"../librustc_resolve\" }\n+rustc_typeck = { path = \"../librustc_typeck\" }\n rustc_trans = { path = \"../librustc_trans\" }\n serialize = { path = \"../libserialize\" }\n syntax = { path = \"../libsyntax\" }"}, {"sha": "24d056035ceec541da0eea065acee215154dbd58", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=196c98d314776f01cb2f32aae63565c118ef62d3", "patch": "@@ -36,6 +36,7 @@ use rustc::ty::subst::Substs;\n use rustc::ty::{self, AdtKind};\n use rustc::middle::stability;\n use rustc::util::nodemap::{FxHashMap, FxHashSet};\n+use rustc_typeck::hir_ty_to_ty;\n \n use rustc::hir;\n \n@@ -1779,10 +1780,9 @@ impl Clean<Type> for hir::Ty {\n             }\n             TyPath(hir::QPath::TypeRelative(ref qself, ref segment)) => {\n                 let mut def = Def::Err;\n-                if let Some(ty) = cx.tcx.ast_ty_to_ty_cache.borrow().get(&self.id) {\n-                    if let ty::TyProjection(proj) = ty.sty {\n-                        def = Def::Trait(proj.trait_ref.def_id);\n-                    }\n+                let ty = hir_ty_to_ty(cx.tcx, self);\n+                if let ty::TyProjection(proj) = ty.sty {\n+                    def = Def::Trait(proj.trait_ref.def_id);\n                 }\n                 let trait_path = hir::Path {\n                     span: self.span,"}, {"sha": "d4be1aba62d23587e2ebbd7e044be862d08c929e", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/196c98d314776f01cb2f32aae63565c118ef62d3/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=196c98d314776f01cb2f32aae63565c118ef62d3", "patch": "@@ -41,6 +41,7 @@ extern crate rustc_resolve;\n extern crate rustc_lint;\n extern crate rustc_back;\n extern crate rustc_metadata;\n+extern crate rustc_typeck;\n extern crate serialize;\n #[macro_use] extern crate syntax;\n extern crate syntax_pos;"}]}