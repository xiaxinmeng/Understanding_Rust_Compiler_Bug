{"sha": "837eec8dab32972a69f42891d55e71d49dcacea9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzN2VlYzhkYWIzMjk3MmE2OWY0Mjg5MWQ1NWU3MWQ0OWRjYWNlYTk=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-07-21T15:51:56Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-07-21T15:51:56Z"}, "message": "filter visiblities when resolving in extern crate", "tree": {"sha": "0fd49552f98c48f08635536a48a620d266600dda", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0fd49552f98c48f08635536a48a620d266600dda"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/837eec8dab32972a69f42891d55e71d49dcacea9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/837eec8dab32972a69f42891d55e71d49dcacea9", "html_url": "https://github.com/rust-lang/rust/commit/837eec8dab32972a69f42891d55e71d49dcacea9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/837eec8dab32972a69f42891d55e71d49dcacea9/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6a237e75c16246d24396d1ffa7929d95f41a327", "url": "https://api.github.com/repos/rust-lang/rust/commits/e6a237e75c16246d24396d1ffa7929d95f41a327", "html_url": "https://github.com/rust-lang/rust/commit/e6a237e75c16246d24396d1ffa7929d95f41a327"}], "stats": {"total": 53, "additions": 38, "deletions": 15}, "files": [{"sha": "1fd39d929417b3095beb043ff4cd7bbd0ffd36de", "filename": "crates/hir_def/src/nameres/collector.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Fcollector.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -747,7 +747,9 @@ impl DefCollector<'_> {\n \n             if let Some(krate) = res.krate {\n                 if krate != self.def_map.krate {\n-                    return PartialResolvedImport::Resolved(def);\n+                    return PartialResolvedImport::Resolved(\n+                        def.filter_visibility(|v| matches!(v, Visibility::Public)),\n+                    );\n                 }\n             }\n "}, {"sha": "ff34b4a9f27f15933e4e17339baaceab0b74b96f", "filename": "crates/hir_def/src/nameres/tests.rs", "status": "modified", "additions": 28, "deletions": 7, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -296,7 +296,7 @@ use bar::Bar;\n use other_crate::FromLib;\n \n //- /lib.rs crate:other_crate edition:2018\n-struct FromLib;\n+pub struct FromLib;\n \"#,\n         expect![[r#\"\n             crate\n@@ -371,7 +371,7 @@ mod sync;\n use alloc_crate::Arc;\n \n //- /lib.rs crate:alloc\n-struct Arc;\n+pub struct Arc;\n \"#,\n         expect![[r#\"\n             crate\n@@ -397,7 +397,7 @@ mod sync;\n use alloc_crate::Arc;\n \n //- /lib.rs crate:alloc\n-struct Arc;\n+pub struct Arc;\n \"#,\n         expect![[r#\"\n             crate\n@@ -476,13 +476,13 @@ fn no_std_prelude() {\n \n         //- /core.rs crate:core\n         pub mod prelude {\n-            pud mod rust_2018 {\n+            pub mod rust_2018 {\n                 pub struct Rust;\n             }\n         }\n         //- /std.rs crate:std deps:core\n         pub mod prelude {\n-            pud mod rust_2018 {\n+            pub mod rust_2018 {\n             }\n         }\n     \"#,\n@@ -505,7 +505,7 @@ fn edition_specific_preludes() {\n \n         //- /std.rs crate:std\n         pub mod prelude {\n-            pud mod rust_2018 {\n+            pub mod rust_2018 {\n                 pub struct Rust2018;\n             }\n         }\n@@ -522,7 +522,7 @@ fn edition_specific_preludes() {\n \n         //- /std.rs crate:std\n         pub mod prelude {\n-            pud mod rust_2021 {\n+            pub mod rust_2021 {\n                 pub struct Rust2021;\n             }\n         }\n@@ -839,3 +839,24 @@ use self::m::S::{self};\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn import_from_extern_crate_only_imports_public_items() {\n+    check(\n+        r#\"\n+//- /lib.rs crate:lib deps:settings,macros\n+use macros::settings;\n+use settings::Settings;\n+//- /settings.rs crate:settings\n+pub struct Settings;\n+//- /macros.rs crate:macros\n+mod settings {}\n+pub const settings: () = ();\n+        \"#,\n+        expect![[r#\"\n+            crate\n+            Settings: t v\n+            settings: v\n+        \"#]],\n+    )\n+}"}, {"sha": "730a4593d9301dbcb7f1e061dd3255f8aab59e97", "filename": "crates/hir_def/src/nameres/tests/macros.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmacros.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -607,8 +607,8 @@ macro_rules! not_current2 {\n     }\n }\n \n-struct Bar;\n-struct Baz;\n+pub struct Bar;\n+pub struct Baz;\n \"#,\n         expect![[r#\"\n             crate"}, {"sha": "ac5d749b092361d3ea614ed6410de50d04c4633c", "filename": "crates/hir_ty/src/tests/macros.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -27,7 +27,7 @@ fn test() {\n } //^ (i32, {unknown}, i32, {unknown})\n \n //- /foo.rs crate:foo\n-struct S;\n+pub struct S;\n \n #[cfg(not(test))]\n impl S {"}, {"sha": "90eee77422e77f95224c187beeef3a3d62c5323b", "filename": "crates/hir_ty/src/tests/method_resolution.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -256,8 +256,8 @@ fn test() {\n } //^ i128\n \n //- /lib.rs crate:other_crate\n-mod foo {\n-    struct S;\n+pub mod foo {\n+    pub struct S;\n     impl S {\n         fn thing() -> i128 { 0 }\n     }"}, {"sha": "d5d0173ec1130ee3b1aa70b60d923281ac9ec089", "filename": "crates/hir_ty/src/tests/traits.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/837eec8dab32972a69f42891d55e71d49dcacea9/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=837eec8dab32972a69f42891d55e71d49dcacea9", "patch": "@@ -209,8 +209,8 @@ pub mod prelude {\n \n //- /alloc.rs crate:alloc deps:core\n #![no_std]\n-mod collections {\n-    struct Vec<T> {}\n+pub mod collections {\n+    pub struct Vec<T> {}\n     impl<T> Vec<T> {\n         pub fn new() -> Self { Vec {} }\n         pub fn push(&mut self, t: T) { }"}]}