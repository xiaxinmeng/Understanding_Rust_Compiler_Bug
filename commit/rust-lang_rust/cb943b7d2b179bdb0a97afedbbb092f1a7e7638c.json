{"sha": "cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiOTQzYjdkMmIxNzliZGIwYTk3YWZlZGJiYjA5MmYxYTdlNzYzOGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-10-26T06:37:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-10-26T06:37:23Z"}, "message": "auto merge of #18212 : kmcallister/rust/unsafecell, r=thestinger\n\nFixes #18131.", "tree": {"sha": "dc759920bbb21de10483a54fddf1290c5e027283", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc759920bbb21de10483a54fddf1290c5e027283"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "html_url": "https://github.com/rust-lang/rust/commit/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f168c12c5629afd45c9b3ed250350bf830b99642", "url": "https://api.github.com/repos/rust-lang/rust/commits/f168c12c5629afd45c9b3ed250350bf830b99642", "html_url": "https://github.com/rust-lang/rust/commit/f168c12c5629afd45c9b3ed250350bf830b99642"}, {"sha": "7317ef5c362bde766440f62e6c2ac8a210e6c22d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7317ef5c362bde766440f62e6c2ac8a210e6c22d", "html_url": "https://github.com/rust-lang/rust/commit/7317ef5c362bde766440f62e6c2ac8a210e6c22d"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "8a4b9f6e51b60bef2cec0cf3714d826bbc540277", "filename": "src/libcore/cell.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c/src%2Flibcore%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c/src%2Flibcore%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcell.rs?ref=cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "patch": "@@ -191,6 +191,17 @@ impl<T:Copy> Cell<T> {\n             *self.value.get() = value;\n         }\n     }\n+\n+    /// Get a reference to the underlying `UnsafeCell`.\n+    ///\n+    /// This can be used to circumvent `Cell`'s safety checks.\n+    ///\n+    /// This function is `unsafe` because `UnsafeCell`'s field is public.\n+    #[inline]\n+    #[experimental]\n+    pub unsafe fn as_unsafe_cell<'a>(&'a self) -> &'a UnsafeCell<T> {\n+        &self.value\n+    }\n }\n \n #[unstable = \"waiting for `Clone` trait to become stable\"]\n@@ -306,6 +317,17 @@ impl<T> RefCell<T> {\n             None => fail!(\"RefCell<T> already borrowed\")\n         }\n     }\n+\n+    /// Get a reference to the underlying `UnsafeCell`.\n+    ///\n+    /// This can be used to circumvent `RefCell`'s safety checks.\n+    ///\n+    /// This function is `unsafe` because `UnsafeCell`'s field is public.\n+    #[inline]\n+    #[experimental]\n+    pub unsafe fn as_unsafe_cell<'a>(&'a self) -> &'a UnsafeCell<T> {\n+        &self.value\n+    }\n }\n \n #[unstable = \"waiting for `Clone` to become stable\"]"}, {"sha": "59365045f43807cfb027c02fe3df316e92cdf289", "filename": "src/libcoretest/cell.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c/src%2Flibcoretest%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb943b7d2b179bdb0a97afedbbb092f1a7e7638c/src%2Flibcoretest%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcoretest%2Fcell.rs?ref=cb943b7d2b179bdb0a97afedbbb092f1a7e7638c", "patch": "@@ -127,3 +127,22 @@ fn clone_ref_updates_flag() {\n     }\n     assert!(x.try_borrow_mut().is_some());\n }\n+\n+#[test]\n+fn as_unsafe_cell() {\n+    let c1: Cell<uint> = Cell::new(0u);\n+    c1.set(1u);\n+    assert_eq!(1u, unsafe { *c1.as_unsafe_cell().get() });\n+\n+    let c2: Cell<uint> = Cell::new(0u);\n+    unsafe { *c2.as_unsafe_cell().get() = 1u; }\n+    assert_eq!(1u, c2.get());\n+\n+    let r1: RefCell<uint> = RefCell::new(0u);\n+    *r1.borrow_mut() = 1u;\n+    assert_eq!(1u, unsafe { *r1.as_unsafe_cell().get() });\n+\n+    let r2: RefCell<uint> = RefCell::new(0u);\n+    unsafe { *r2.as_unsafe_cell().get() = 1u; }\n+    assert_eq!(1u, *r2.borrow());\n+}"}]}