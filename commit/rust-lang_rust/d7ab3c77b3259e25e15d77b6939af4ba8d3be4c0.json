{"sha": "d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3YWIzYzc3YjMyNTllMjVlMTVkNzdiNjkzOWFmNGJhOGQzYmU0YzA=", "commit": {"author": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-03-15T09:57:53Z"}, "committer": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-03-15T10:24:58Z"}, "message": "Add `rustc_interface::interface::Config::parse_sess_created`", "tree": {"sha": "7c18417d7bfbb0d9454cc6510f9155ef03a66b2b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c18417d7bfbb0d9454cc6510f9155ef03a66b2b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIsEABYIADMWIQRJ2jPMDdiQ+U4U42Z0+n/VuNoUuAUCYE81/xUceWQtaHVhbmdA\nb3V0bG9vay5jb20ACgkQdPp/1bjaFLgEAQEA4CacUM16+Npoh/f3XCsnpwuNtn1v\nO5UsXSUHXLNU4q8A/36N/KmELSRKqzH+Q94Bcrv/SzS3PnfLr9JM3g5ZI7EC\n=g1iW\n-----END PGP SIGNATURE-----", "payload": "tree 7c18417d7bfbb0d9454cc6510f9155ef03a66b2b\nparent 3963c3da02d17b9c52feaf0e05271db2ec51c29f\nauthor hyd-dev <yd-huang@outlook.com> 1615802273 +0800\ncommitter hyd-dev <yd-huang@outlook.com> 1615803898 +0800\n\nAdd `rustc_interface::interface::Config::parse_sess_created`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "html_url": "https://github.com/rust-lang/rust/commit/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/comments", "author": null, "committer": null, "parents": [{"sha": "3963c3da02d17b9c52feaf0e05271db2ec51c29f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3963c3da02d17b9c52feaf0e05271db2ec51c29f", "html_url": "https://github.com/rust-lang/rust/commit/3963c3da02d17b9c52feaf0e05271db2ec51c29f"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "25a78041c0007bf4269efdb4dc62267e4b698e50", "filename": "compiler/rustc_driver/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/compiler%2Frustc_driver%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_driver%2Fsrc%2Flib.rs?ref=d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "patch": "@@ -215,6 +215,7 @@ fn run_compiler(\n             diagnostic_output,\n             stderr: None,\n             lint_caps: Default::default(),\n+            parse_sess_created: None,\n             register_lints: None,\n             override_queries: None,\n             make_codegen_backend: make_codegen_backend.take().unwrap(),\n@@ -298,6 +299,7 @@ fn run_compiler(\n         diagnostic_output,\n         stderr: None,\n         lint_caps: Default::default(),\n+        parse_sess_created: None,\n         register_lints: None,\n         override_queries: None,\n         make_codegen_backend: make_codegen_backend.unwrap(),"}, {"sha": "14bffb54e7a8e959d19c59a25d31667e59142abc", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "patch": "@@ -142,6 +142,9 @@ pub struct Config {\n \n     pub lint_caps: FxHashMap<lint::LintId, lint::Level>,\n \n+    /// This is a callback from the driver that is called when [`ParseSess`] is created.\n+    pub parse_sess_created: Option<Box<dyn FnOnce(&mut ParseSess) + Send>>,\n+\n     /// This is a callback from the driver that is called when we're registering lints;\n     /// it is called during plugin registration when we have the LintStore in a non-shared state.\n     ///\n@@ -166,7 +169,7 @@ pub struct Config {\n \n pub fn create_compiler_and_run<R>(config: Config, f: impl FnOnce(&Compiler) -> R) -> R {\n     let registry = &config.registry;\n-    let (sess, codegen_backend) = util::create_session(\n+    let (mut sess, codegen_backend) = util::create_session(\n         config.opts,\n         config.crate_cfg,\n         config.diagnostic_output,\n@@ -177,6 +180,10 @@ pub fn create_compiler_and_run<R>(config: Config, f: impl FnOnce(&Compiler) -> R\n         registry.clone(),\n     );\n \n+    if let Some(parse_sess_created) = config.parse_sess_created {\n+        parse_sess_created(&mut Lrc::get_mut(&mut sess).unwrap().parse_sess);\n+    }\n+\n     let compiler = Compiler {\n         sess,\n         codegen_backend,"}, {"sha": "c5b5ab0f3d0ac4a72fd48a9b73fad87f7fc347a0", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "patch": "@@ -311,6 +311,7 @@ crate fn create_config(\n         diagnostic_output: DiagnosticOutput::Default,\n         stderr: None,\n         lint_caps,\n+        parse_sess_created: None,\n         register_lints: Some(box crate::lint::register_lints),\n         override_queries: Some(|_sess, providers, _external_providers| {\n             // Most lints will require typechecking, so just don't run them."}, {"sha": "80e2e23eadde9b64fa680609d300bfa5813034e7", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=d7ab3c77b3259e25e15d77b6939af4ba8d3be4c0", "patch": "@@ -95,6 +95,7 @@ crate fn run(options: Options) -> Result<(), ErrorReported> {\n         diagnostic_output: DiagnosticOutput::Default,\n         stderr: None,\n         lint_caps,\n+        parse_sess_created: None,\n         register_lints: Some(box crate::lint::register_lints),\n         override_queries: None,\n         make_codegen_backend: None,"}]}