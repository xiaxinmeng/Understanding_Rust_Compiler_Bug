{"sha": "11a52dc61afda5ea82cff3e783e24f2302bdce3f", "node_id": "C_kwDOAAsO6NoAKDExYTUyZGM2MWFmZGE1ZWE4MmNmZjNlNzgzZTI0ZjIzMDJiZGNlM2Y", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-09-13T21:22:38Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-09-13T23:03:11Z"}, "message": "rustdoc: clean up DOM by removing `.dockblock-short p`\n\nOn https://doc.rust-lang.org/nightly/std/ this reduces the number out of\n`document.querySelectorAll(\"*\").length` from 1278 to 1103.", "tree": {"sha": "1a32da099966f24768788a6715c6c9425d4e9ac1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a32da099966f24768788a6715c6c9425d4e9ac1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11a52dc61afda5ea82cff3e783e24f2302bdce3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11a52dc61afda5ea82cff3e783e24f2302bdce3f", "html_url": "https://github.com/rust-lang/rust/commit/11a52dc61afda5ea82cff3e783e24f2302bdce3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11a52dc61afda5ea82cff3e783e24f2302bdce3f/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ce51982b8550c782ded466c1abff0d2b2e21c4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ce51982b8550c782ded466c1abff0d2b2e21c4e", "html_url": "https://github.com/rust-lang/rust/commit/1ce51982b8550c782ded466c1abff0d2b2e21c4e"}], "stats": {"total": 64, "additions": 26, "deletions": 38}, "files": [{"sha": "43d07d4a53337ae6100fdfb9c7ac53b745bb810e", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=11a52dc61afda5ea82cff3e783e24f2302bdce3f", "patch": "@@ -1119,7 +1119,11 @@ impl MarkdownSummaryLine<'_> {\n \n         let mut s = String::new();\n \n-        html::push_html(&mut s, LinkReplacer::new(SummaryLine::new(p), links));\n+        let without_paragraphs = LinkReplacer::new(SummaryLine::new(p), links).filter(|event| {\n+            !matches!(event, Event::Start(Tag::Paragraph) | Event::End(Tag::Paragraph))\n+        });\n+\n+        html::push_html(&mut s, without_paragraphs);\n \n         s\n     }"}, {"sha": "14f27eb6fa8a49c1b009368da14cc5e84bc4d54f", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=11a52dc61afda5ea82cff3e783e24f2302bdce3f", "patch": "@@ -609,16 +609,12 @@ h2.location a {\n .docblock-short {\n \toverflow-wrap: break-word;\n \toverflow-wrap: anywhere;\n-}\n-.docblock-short p {\n-\tdisplay: inline;\n \toverflow: hidden;\n \ttext-overflow: ellipsis;\n-\tmargin: 0;\n }\n /* Wrap non-pre code blocks (`text`) but not (```text```). */\n .docblock > :not(pre) > code,\n-.docblock-short > :not(pre) > code {\n+.docblock-short > code {\n \twhite-space: pre-wrap;\n }\n "}, {"sha": "4b4cea2621fff7deeecd2087c70bec097ff0c281", "filename": "src/test/rustdoc-gui/label-next-to-symbol.goml", "status": "modified", "additions": 3, "deletions": 15, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml", "raw_url": "https://github.com/rust-lang/rust/raw/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml?ref=11a52dc61afda5ea82cff3e783e24f2302bdce3f", "patch": "@@ -31,15 +31,9 @@ compare-elements-position: (\n )\n \n // Ensure no wrap\n-compare-elements-position-near: (\n-    \"//*[@class='item-left module-item']//a[text()='replaced_function']\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n-    {\"y\": 2},\n-)\n-// compare parent elements\n compare-elements-position: (\n     \"//*[@class='item-left module-item']//a[text()='replaced_function']/..\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']/..\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )\n \n@@ -60,19 +54,13 @@ compare-elements-position: (\n )\n \n // Ensure wrap\n-compare-elements-position-near-false: (\n-    \"//*[@class='item-left module-item']//a[text()='replaced_function']\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n-    {\"y\": 12},\n-)\n-// compare parent elements\n compare-elements-position-false: (\n     \"//*[@class='item-left module-item']//a[text()='replaced_function']/..\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']/..\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )\n compare-elements-position-false: (\n     \".item-left .stab.deprecated\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )"}, {"sha": "1a8a689be1d1e2090f3b47c08e8a79dd593cc9fc", "filename": "src/test/rustdoc/short-docblock.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc%2Fshort-docblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc%2Fshort-docblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fshort-docblock.rs?ref=11a52dc61afda5ea82cff3e783e24f2302bdce3f", "patch": "@@ -1,24 +1,24 @@\n #![crate_name = \"foo\"]\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p' 'fooo'\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/h1' 'fooo'\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' 'fooo'\n+// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/h1' 'fooo'\n // @has foo/fn.foo.html '//h2[@id=\"fooo\"]/a[@href=\"#fooo\"]' 'fooo'\n \n /// # fooo\n ///\n /// foo\n pub fn foo() {}\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p' 'mooood'\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/h2' 'mooood'\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' 'mooood'\n+// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/h2' 'mooood'\n // @has foo/foo/index.html '//h3[@id=\"mooood\"]/a[@href=\"#mooood\"]' 'mooood'\n \n /// ## mooood\n ///\n /// foo mod\n pub mod foo {}\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/a[@href=\\\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/a[@href=\\\n //                      \"https://nougat.world\"]/code' 'nougat'\n \n /// [`nougat`](https://nougat.world)"}, {"sha": "195cdf009b9937f37d355f15702347a69942fe7b", "filename": "src/test/rustdoc/trait-impl.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11a52dc61afda5ea82cff3e783e24f2302bdce3f/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftrait-impl.rs?ref=11a52dc61afda5ea82cff3e783e24f2302bdce3f", "patch": "@@ -21,26 +21,26 @@ pub trait Trait {\n pub struct Struct;\n \n impl Trait for Struct {\n-    // @has trait_impl/struct.Struct.html '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p' 'Some long docs'\n-    // @!has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p' 'link will be added'\n-    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p/a' 'Read more'\n-    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p/a/@href' 'trait.Trait.html#tymethod.a'\n+    // @has trait_impl/struct.Struct.html '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]' 'Some long docs'\n+    // @!has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]' 'link will be added'\n+    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n+    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.a'\n     fn a() {}\n \n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p' 'These docs contain'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a' 'reference link'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a/@href' 'https://example.com'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a' 'Read more'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a/@href' 'trait.Trait.html#tymethod.b'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]' 'These docs contain'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a' 'reference link'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a/@href' 'https://example.com'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.b'\n     fn b() {}\n \n-    // @!has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/p' 'code block'\n+    // @!has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]' 'code block'\n     // @has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n     // @has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.c'\n     fn c() {}\n \n-    // @has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/p' 'Escaped formatting a*b*c* works'\n-    // @!has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/p/em' ''\n+    // @has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]' 'Escaped formatting a*b*c* works'\n+    // @!has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/em' ''\n     fn d() {}\n \n     // @has - '//*[@id=\"impl-Trait-for-Struct\"]/h3//a/@href' 'trait.Trait.html'"}]}