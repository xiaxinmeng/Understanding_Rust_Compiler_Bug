{"sha": "a3d06f824b4c2360a675b8a206cc43e200276609", "node_id": "C_kwDOAAsO6NoAKGEzZDA2ZjgyNGI0YzIzNjBhNjc1YjhhMjA2Y2M0M2UyMDAyNzY2MDk", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-01-17T17:10:01Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-01-17T17:10:01Z"}, "message": "status: output all crates a file belongs to", "tree": {"sha": "cd852f42261fd61d6a7ea83cc04f35c2bbe027c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd852f42261fd61d6a7ea83cc04f35c2bbe027c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3d06f824b4c2360a675b8a206cc43e200276609", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3d06f824b4c2360a675b8a206cc43e200276609", "html_url": "https://github.com/rust-lang/rust/commit/a3d06f824b4c2360a675b8a206cc43e200276609", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3d06f824b4c2360a675b8a206cc43e200276609/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1861654623f99e879ebace09e286dc96cb980776", "url": "https://api.github.com/repos/rust-lang/rust/commits/1861654623f99e879ebace09e286dc96cb980776", "html_url": "https://github.com/rust-lang/rust/commit/1861654623f99e879ebace09e286dc96cb980776"}], "stats": {"total": 34, "additions": 17, "deletions": 17}, "files": [{"sha": "ea2b7906e9eaa3fe22c8937ab0d063e0c6292f41", "filename": "crates/ide/src/status.rs", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/a3d06f824b4c2360a675b8a206cc43e200276609/crates%2Fide%2Fsrc%2Fstatus.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3d06f824b4c2360a675b8a206cc43e200276609/crates%2Fide%2Fsrc%2Fstatus.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fstatus.rs?ref=a3d06f824b4c2360a675b8a206cc43e200276609", "patch": "@@ -45,23 +45,23 @@ pub(crate) fn status(db: &RootDatabase, file_id: Option<FileId>) -> String {\n \n     if let Some(file_id) = file_id {\n         format_to!(buf, \"\\nFile info:\\n\");\n-        let krate = crate::parent_module::crate_for(db, file_id).pop();\n-        match krate {\n-            Some(krate) => {\n-                let crate_graph = db.crate_graph();\n-                let display_crate = |krate: CrateId| match &crate_graph[krate].display_name {\n-                    Some(it) => format!(\"{}({:?})\", it, krate),\n-                    None => format!(\"{:?}\", krate),\n-                };\n-                format_to!(buf, \"Crate: {}\\n\", display_crate(krate));\n-                let deps = crate_graph[krate]\n-                    .dependencies\n-                    .iter()\n-                    .map(|dep| format!(\"{}={:?}\", dep.name, dep.crate_id))\n-                    .format(\", \");\n-                format_to!(buf, \"Dependencies: {}\\n\", deps);\n-            }\n-            None => format_to!(buf, \"Does not belong to any crate\"),\n+        let crates = crate::parent_module::crate_for(db, file_id);\n+        if crates.is_empty() {\n+            format_to!(buf, \"Does not belong to any crate\");\n+        }\n+        let crate_graph = db.crate_graph();\n+        for krate in crates {\n+            let display_crate = |krate: CrateId| match &crate_graph[krate].display_name {\n+                Some(it) => format!(\"{}({:?})\", it, krate),\n+                None => format!(\"{:?}\", krate),\n+            };\n+            format_to!(buf, \"Crate: {}\\n\", display_crate(krate));\n+            let deps = crate_graph[krate]\n+                .dependencies\n+                .iter()\n+                .map(|dep| format!(\"{}={:?}\", dep.name, dep.crate_id))\n+                .format(\", \");\n+            format_to!(buf, \"Dependencies: {}\\n\", deps);\n         }\n     }\n "}]}