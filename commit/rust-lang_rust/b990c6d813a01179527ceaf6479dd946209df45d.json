{"sha": "b990c6d813a01179527ceaf6479dd946209df45d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5OTBjNmQ4MTNhMDExNzk1MjdjZWFmNjQ3OWRkOTQ2MjA5ZGY0NWQ=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-07-31T23:07:24Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-08-01T22:59:01Z"}, "message": "tidy: Unconfigure tests during normal build", "tree": {"sha": "02cd8305f1250aa52576512d2a2621a392824aee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/02cd8305f1250aa52576512d2a2621a392824aee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b990c6d813a01179527ceaf6479dd946209df45d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b990c6d813a01179527ceaf6479dd946209df45d", "html_url": "https://github.com/rust-lang/rust/commit/b990c6d813a01179527ceaf6479dd946209df45d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b990c6d813a01179527ceaf6479dd946209df45d/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "435236b8877cdb98c82eaebfb7887782277265c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/435236b8877cdb98c82eaebfb7887782277265c5", "html_url": "https://github.com/rust-lang/rust/commit/435236b8877cdb98c82eaebfb7887782277265c5"}], "stats": {"total": 104, "additions": 53, "deletions": 51}, "files": [{"sha": "88a469ef9550cb719cb70acdd277cefcc33eb10c", "filename": "src/tools/tidy/src/features.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs?ref=b990c6d813a01179527ceaf6479dd946209df45d", "patch": "@@ -16,6 +16,9 @@ use std::path::Path;\n \n use regex::Regex;\n \n+#[cfg(test)]\n+mod tests;\n+\n mod version;\n use version::Version;\n \n@@ -203,14 +206,6 @@ fn find_attr_val<'a>(line: &'a str, attr: &str) -> Option<&'a str> {\n         .map(|m| m.as_str())\n }\n \n-#[test]\n-fn test_find_attr_val() {\n-    let s = r#\"#[unstable(feature = \"checked_duration_since\", issue = \"58402\")]\"#;\n-    assert_eq!(find_attr_val(s, \"feature\"), Some(\"checked_duration_since\"));\n-    assert_eq!(find_attr_val(s, \"issue\"), Some(\"58402\"));\n-    assert_eq!(find_attr_val(s, \"since\"), None);\n-}\n-\n fn test_filen_gate(filen_underscore: &str, features: &mut Features) -> bool {\n     let prefix = \"feature_gate_\";\n     if filen_underscore.starts_with(prefix) {"}, {"sha": "fa7a931ec865cd19960ad3e92e83afb69aac5402", "filename": "src/tools/tidy/src/features/tests.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Ftests.rs?ref=b990c6d813a01179527ceaf6479dd946209df45d", "patch": "@@ -0,0 +1,9 @@\n+use super::*;\n+\n+#[test]\n+fn test_find_attr_val() {\n+    let s = r#\"#[unstable(feature = \"checked_duration_since\", issue = \"58402\")]\"#;\n+    assert_eq!(find_attr_val(s, \"feature\"), Some(\"checked_duration_since\"));\n+    assert_eq!(find_attr_val(s, \"issue\"), Some(\"58402\"));\n+    assert_eq!(find_attr_val(s, \"since\"), None);\n+}"}, {"sha": "cc3a65102448633b0607db5a3668691023609c2d", "filename": "src/tools/tidy/src/features/version.rs", "status": "modified", "additions": 3, "deletions": 42, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion.rs?ref=b990c6d813a01179527ceaf6479dd946209df45d", "patch": "@@ -2,6 +2,9 @@ use std::str::FromStr;\n use std::num::ParseIntError;\n use std::fmt;\n \n+#[cfg(test)]\n+mod tests;\n+\n #[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord)]\n pub struct Version {\n     parts: [u32; 3],\n@@ -46,45 +49,3 @@ impl FromStr for Version {\n         Ok(Self { parts })\n     }\n }\n-\n-#[cfg(test)]\n-mod test {\n-    use super::Version;\n-\n-    #[test]\n-    fn test_try_from_invalid_version() {\n-        assert!(\"\".parse::<Version>().is_err());\n-        assert!(\"hello\".parse::<Version>().is_err());\n-        assert!(\"1.32.hi\".parse::<Version>().is_err());\n-        assert!(\"1.32..1\".parse::<Version>().is_err());\n-        assert!(\"1.32\".parse::<Version>().is_err());\n-        assert!(\"1.32.0.1\".parse::<Version>().is_err());\n-    }\n-\n-    #[test]\n-    fn test_try_from_single() {\n-        assert_eq!(\"1.32.0\".parse(), Ok(Version { parts: [1, 32, 0] }));\n-        assert_eq!(\"1.0.0\".parse(), Ok(Version { parts: [1, 0, 0] }));\n-    }\n-\n-    #[test]\n-    fn test_compare() {\n-        let v_1_0_0 = \"1.0.0\".parse::<Version>().unwrap();\n-        let v_1_32_0 = \"1.32.0\".parse::<Version>().unwrap();\n-        let v_1_32_1 = \"1.32.1\".parse::<Version>().unwrap();\n-        assert!(v_1_0_0 < v_1_32_1);\n-        assert!(v_1_0_0 < v_1_32_0);\n-        assert!(v_1_32_0 < v_1_32_1);\n-    }\n-\n-    #[test]\n-    fn test_to_string() {\n-        let v_1_0_0 = \"1.0.0\".parse::<Version>().unwrap();\n-        let v_1_32_1 = \"1.32.1\".parse::<Version>().unwrap();\n-\n-        assert_eq!(v_1_0_0.to_string(), \"1.0.0\");\n-        assert_eq!(v_1_32_1.to_string(), \"1.32.1\");\n-        assert_eq!(format!(\"{:<8}\", v_1_32_1), \"1.32.1  \");\n-        assert_eq!(format!(\"{:>8}\", v_1_32_1), \"  1.32.1\");\n-    }\n-}"}, {"sha": "31224fdf1eacfb5ecba627c3e16c3e720163a9db", "filename": "src/tools/tidy/src/features/version/tests.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs?ref=b990c6d813a01179527ceaf6479dd946209df45d", "patch": "@@ -0,0 +1,38 @@\n+use super::*;\n+\n+#[test]\n+fn test_try_from_invalid_version() {\n+    assert!(\"\".parse::<Version>().is_err());\n+    assert!(\"hello\".parse::<Version>().is_err());\n+    assert!(\"1.32.hi\".parse::<Version>().is_err());\n+    assert!(\"1.32..1\".parse::<Version>().is_err());\n+    assert!(\"1.32\".parse::<Version>().is_err());\n+    assert!(\"1.32.0.1\".parse::<Version>().is_err());\n+}\n+\n+#[test]\n+fn test_try_from_single() {\n+    assert_eq!(\"1.32.0\".parse(), Ok(Version { parts: [1, 32, 0] }));\n+    assert_eq!(\"1.0.0\".parse(), Ok(Version { parts: [1, 0, 0] }));\n+}\n+\n+#[test]\n+fn test_compare() {\n+    let v_1_0_0 = \"1.0.0\".parse::<Version>().unwrap();\n+    let v_1_32_0 = \"1.32.0\".parse::<Version>().unwrap();\n+    let v_1_32_1 = \"1.32.1\".parse::<Version>().unwrap();\n+    assert!(v_1_0_0 < v_1_32_1);\n+    assert!(v_1_0_0 < v_1_32_0);\n+    assert!(v_1_32_0 < v_1_32_1);\n+}\n+\n+#[test]\n+fn test_to_string() {\n+    let v_1_0_0 = \"1.0.0\".parse::<Version>().unwrap();\n+    let v_1_32_1 = \"1.32.1\".parse::<Version>().unwrap();\n+\n+    assert_eq!(v_1_0_0.to_string(), \"1.0.0\");\n+    assert_eq!(v_1_32_1.to_string(), \"1.32.1\");\n+    assert_eq!(format!(\"{:<8}\", v_1_32_1), \"1.32.1  \");\n+    assert_eq!(format!(\"{:>8}\", v_1_32_1), \"  1.32.1\");\n+}"}, {"sha": "6a04068fbd8366d28522543e0316556eaa6ae0fb", "filename": "src/tools/tidy/src/unit_tests.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b990c6d813a01179527ceaf6479dd946209df45d/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Funit_tests.rs?ref=b990c6d813a01179527ceaf6479dd946209df45d", "patch": "@@ -41,7 +41,6 @@ pub fn check(root_path: &Path, bad: &mut bool) {\n         \"libterm/terminfo\",\n         \"libtest\",\n         \"tools/compiletest/src\",\n-        \"tools/tidy/src\",\n     ];\n \n     let mut skip = |path: &Path| {"}]}