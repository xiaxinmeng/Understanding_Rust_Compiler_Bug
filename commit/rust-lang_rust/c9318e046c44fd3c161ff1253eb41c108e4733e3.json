{"sha": "c9318e046c44fd3c161ff1253eb41c108e4733e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5MzE4ZTA0NmM0NGZkM2MxNjFmZjEyNTNlYjQxYzEwOGU0NzMzZTM=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-02-02T19:08:14Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-02-02T19:08:37Z"}, "message": "G: extern functions", "tree": {"sha": "210819a7f29195b3c50101f87adf67bffe78413b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/210819a7f29195b3c50101f87adf67bffe78413b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9318e046c44fd3c161ff1253eb41c108e4733e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9318e046c44fd3c161ff1253eb41c108e4733e3", "html_url": "https://github.com/rust-lang/rust/commit/c9318e046c44fd3c161ff1253eb41c108e4733e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9318e046c44fd3c161ff1253eb41c108e4733e3/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c6ccfe6474cf15e7c59c8b6c01d8a1b3604ba02", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c6ccfe6474cf15e7c59c8b6c01d8a1b3604ba02", "html_url": "https://github.com/rust-lang/rust/commit/3c6ccfe6474cf15e7c59c8b6c01d8a1b3604ba02"}], "stats": {"total": 156, "additions": 139, "deletions": 17}, "files": [{"sha": "44826c779c6295511fff37fd2a5eec95bd5fe675", "filename": "grammar.ron", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/grammar.ron", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/grammar.ron", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/grammar.ron?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -78,17 +78,20 @@ Grammar(\n     ],\n     nodes: [\n         \"FILE\",\n+\n         \"STRUCT_ITEM\",\n         \"ENUM_ITEM\",\n-        \"ENUM_VARIANT\",\n-        \"NAMED_FIELD\",\n-        \"POS_FIELD\",\n         \"FN_ITEM\",\n         \"EXTERN_CRATE_ITEM\",\n-        \"ATTR\",\n-        \"META_ITEM\",\n         \"MOD_ITEM\",\n         \"USE_ITEM\",\n+\n+        \"EXTERN_BLOCK\",\n+        \"ENUM_VARIANT\",\n+        \"NAMED_FIELD\",\n+        \"POS_FIELD\",\n+        \"ATTR\",\n+        \"META_ITEM\", // not an item actually\n         \"USE_TREE\",\n         \"PATH\",\n         \"PATH_SEGMENT\",\n@@ -98,5 +101,6 @@ Grammar(\n         \"TYPE_PARAM_LIST\",\n         \"LIFETIME_PARAM\",\n         \"TYPE_PARAM\",\n+        \"ABI\",\n     ]\n )"}, {"sha": "a6d8f375cd36bba6cae1839eb96269801dbf0644", "filename": "src/parser/event_parser/grammar/items/mod.rs", "status": "modified", "additions": 39, "deletions": 4, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fparser%2Fevent_parser%2Fgrammar%2Fitems%2Fmod.rs?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -19,18 +19,36 @@ fn item(p: &mut Parser) {\n     visibility(p);\n     let la = p.nth(1);\n     let item_kind = match p.current() {\n+        USE_KW => {\n+            use_item(p);\n+            USE_ITEM\n+        }\n         EXTERN_KW if la == CRATE_KW => {\n             extern_crate_item(p);\n             EXTERN_CRATE_ITEM\n         }\n+        EXTERN_KW => {\n+            abi(p);\n+            match p.current() {\n+                FN_KW => {\n+                    fn_item(p);\n+                    FN_ITEM\n+                }\n+                L_CURLY => {\n+                    extern_block(p);\n+                    EXTERN_BLOCK\n+                }\n+                _ => {\n+                    item.abandon(p);\n+                    p.error().message(\"expected `fn` or `{`\").emit();\n+                    return;\n+                }\n+            }\n+        }\n         MOD_KW => {\n             mod_item(p);\n             MOD_ITEM\n         }\n-        USE_KW => {\n-            use_item(p);\n-            USE_ITEM\n-        }\n         STRUCT_KW => {\n             structs::struct_item(p);\n             STRUCT_ITEM\n@@ -155,6 +173,12 @@ fn mod_item(p: &mut Parser) {\n     }\n }\n \n+fn extern_block(p: &mut Parser) {\n+    assert!(p.at(L_CURLY));\n+    p.bump();\n+    p.expect(R_CURLY);\n+}\n+\n pub(super) fn is_use_tree_start(kind: SyntaxKind) -> bool {\n     kind == STAR || kind == L_CURLY\n }\n@@ -225,6 +249,17 @@ fn use_item(p: &mut Parser) {\n     }\n }\n \n+fn abi(p: &mut Parser) {\n+    assert!(p.at(EXTERN_KW));\n+    let abi = p.start();\n+    p.bump();\n+    match p.current() {\n+        STRING | RAW_STRING => p.bump(),\n+        _ => (),\n+    }\n+    abi.complete(p, ABI);\n+}\n+\n fn fn_item(p: &mut Parser) {\n     assert!(p.at(FN_KW));\n     p.bump();"}, {"sha": "7577fa03713c498ea57e5dc9fe15b0b9f6f05482", "filename": "src/syntax_kinds.rs", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/src%2Fsyntax_kinds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/src%2Fsyntax_kinds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fsyntax_kinds.rs?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -82,15 +82,16 @@ pub enum SyntaxKind {\n     FILE,\n     STRUCT_ITEM,\n     ENUM_ITEM,\n+    FN_ITEM,\n+    EXTERN_CRATE_ITEM,\n+    MOD_ITEM,\n+    USE_ITEM,\n+    EXTERN_BLOCK,\n     ENUM_VARIANT,\n     NAMED_FIELD,\n     POS_FIELD,\n-    FN_ITEM,\n-    EXTERN_CRATE_ITEM,\n     ATTR,\n     META_ITEM,\n-    MOD_ITEM,\n-    USE_ITEM,\n     USE_TREE,\n     PATH,\n     PATH_SEGMENT,\n@@ -100,6 +101,7 @@ pub enum SyntaxKind {\n     TYPE_PARAM_LIST,\n     LIFETIME_PARAM,\n     TYPE_PARAM,\n+    ABI,\n \n     // Technical SyntaxKinds: they appear temporally during parsing,\n     // but never end up in the final tree\n@@ -189,15 +191,16 @@ impl SyntaxKind {\n             FILE => &SyntaxInfo { name: \"FILE\" },\n             STRUCT_ITEM => &SyntaxInfo { name: \"STRUCT_ITEM\" },\n             ENUM_ITEM => &SyntaxInfo { name: \"ENUM_ITEM\" },\n+            FN_ITEM => &SyntaxInfo { name: \"FN_ITEM\" },\n+            EXTERN_CRATE_ITEM => &SyntaxInfo { name: \"EXTERN_CRATE_ITEM\" },\n+            MOD_ITEM => &SyntaxInfo { name: \"MOD_ITEM\" },\n+            USE_ITEM => &SyntaxInfo { name: \"USE_ITEM\" },\n+            EXTERN_BLOCK => &SyntaxInfo { name: \"EXTERN_BLOCK\" },\n             ENUM_VARIANT => &SyntaxInfo { name: \"ENUM_VARIANT\" },\n             NAMED_FIELD => &SyntaxInfo { name: \"NAMED_FIELD\" },\n             POS_FIELD => &SyntaxInfo { name: \"POS_FIELD\" },\n-            FN_ITEM => &SyntaxInfo { name: \"FN_ITEM\" },\n-            EXTERN_CRATE_ITEM => &SyntaxInfo { name: \"EXTERN_CRATE_ITEM\" },\n             ATTR => &SyntaxInfo { name: \"ATTR\" },\n             META_ITEM => &SyntaxInfo { name: \"META_ITEM\" },\n-            MOD_ITEM => &SyntaxInfo { name: \"MOD_ITEM\" },\n-            USE_ITEM => &SyntaxInfo { name: \"USE_ITEM\" },\n             USE_TREE => &SyntaxInfo { name: \"USE_TREE\" },\n             PATH => &SyntaxInfo { name: \"PATH\" },\n             PATH_SEGMENT => &SyntaxInfo { name: \"PATH_SEGMENT\" },\n@@ -207,6 +210,7 @@ impl SyntaxKind {\n             TYPE_PARAM_LIST => &SyntaxInfo { name: \"TYPE_PARAM_LIST\" },\n             LIFETIME_PARAM => &SyntaxInfo { name: \"LIFETIME_PARAM\" },\n             TYPE_PARAM => &SyntaxInfo { name: \"TYPE_PARAM\" },\n+            ABI => &SyntaxInfo { name: \"ABI\" },\n \n             TOMBSTONE => &SyntaxInfo { name: \"TOMBSTONE\" },\n             EOF => &SyntaxInfo { name: \"EOF\" },"}, {"sha": "e929eef74141376db35856f23771584413595cff", "filename": "tests/data/parser/ok/0021_extern_fn.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.rs?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -0,0 +1,8 @@\n+extern fn foo() {\n+}\n+\n+extern \"C\" fn bar() {\n+}\n+\n+extern r\"D\" fn baz() {\n+}"}, {"sha": "43575bdf3497df9629a668b01c33f4f61aca638a", "filename": "tests/data/parser/ok/0021_extern_fn.txt", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.txt", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Fok%2F0021_extern_fn.txt?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -0,0 +1,47 @@\n+FILE@[0; 71)\n+  FN_ITEM@[0; 21)\n+    ABI@[0; 7)\n+      EXTERN_KW@[0; 6)\n+      WHITESPACE@[6; 7)\n+    FN_KW@[7; 9)\n+    WHITESPACE@[9; 10)\n+    IDENT@[10; 13) \"foo\"\n+    L_PAREN@[13; 14)\n+    R_PAREN@[14; 15)\n+    WHITESPACE@[15; 16)\n+    L_CURLY@[16; 17)\n+    WHITESPACE@[17; 18)\n+    R_CURLY@[18; 19)\n+    WHITESPACE@[19; 21)\n+  FN_ITEM@[21; 46)\n+    ABI@[21; 32)\n+      EXTERN_KW@[21; 27)\n+      WHITESPACE@[27; 28)\n+      STRING@[28; 31)\n+      WHITESPACE@[31; 32)\n+    FN_KW@[32; 34)\n+    WHITESPACE@[34; 35)\n+    IDENT@[35; 38) \"bar\"\n+    L_PAREN@[38; 39)\n+    R_PAREN@[39; 40)\n+    WHITESPACE@[40; 41)\n+    L_CURLY@[41; 42)\n+    WHITESPACE@[42; 43)\n+    R_CURLY@[43; 44)\n+    WHITESPACE@[44; 46)\n+  FN_ITEM@[46; 71)\n+    ABI@[46; 58)\n+      EXTERN_KW@[46; 52)\n+      WHITESPACE@[52; 53)\n+      RAW_STRING@[53; 57)\n+      WHITESPACE@[57; 58)\n+    FN_KW@[58; 60)\n+    WHITESPACE@[60; 61)\n+    IDENT@[61; 64) \"baz\"\n+    L_PAREN@[64; 65)\n+    R_PAREN@[65; 66)\n+    WHITESPACE@[66; 67)\n+    L_CURLY@[67; 68)\n+    WHITESPACE@[68; 69)\n+    R_CURLY@[69; 70)\n+    WHITESPACE@[70; 71)"}, {"sha": "f5fe0e6ef30973aafc569e213ca0c3ee8f104d84", "filename": "tests/data/parser/ok/0022_empty_extern_block.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.rs?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -0,0 +1,5 @@\n+extern {\n+}\n+\n+extern \"C\" {\n+}"}, {"sha": "789cba36429372384a2d97d6338d6724d03232ff", "filename": "tests/data/parser/ok/0022_empty_extern_block.txt", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.txt", "raw_url": "https://github.com/rust-lang/rust/raw/c9318e046c44fd3c161ff1253eb41c108e4733e3/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Fparser%2Fok%2F0022_empty_extern_block.txt?ref=c9318e046c44fd3c161ff1253eb41c108e4733e3", "patch": "@@ -0,0 +1,19 @@\n+FILE@[0; 27)\n+  EXTERN_BLOCK@[0; 12)\n+    ABI@[0; 7)\n+      EXTERN_KW@[0; 6)\n+      WHITESPACE@[6; 7)\n+    L_CURLY@[7; 8)\n+    WHITESPACE@[8; 9)\n+    R_CURLY@[9; 10)\n+    WHITESPACE@[10; 12)\n+  EXTERN_BLOCK@[12; 27)\n+    ABI@[12; 23)\n+      EXTERN_KW@[12; 18)\n+      WHITESPACE@[18; 19)\n+      STRING@[19; 22)\n+      WHITESPACE@[22; 23)\n+    L_CURLY@[23; 24)\n+    WHITESPACE@[24; 25)\n+    R_CURLY@[25; 26)\n+    WHITESPACE@[26; 27)"}]}