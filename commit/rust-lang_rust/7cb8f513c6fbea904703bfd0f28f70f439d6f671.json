{"sha": "7cb8f513c6fbea904703bfd0f28f70f439d6f671", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjYjhmNTEzYzZmYmVhOTA0NzAzYmZkMGYyOGY3MGY0MzlkNmY2NzE=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2021-03-25T13:22:15Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2021-03-25T13:24:27Z"}, "message": "write-up what is happening", "tree": {"sha": "fc99fc44a7040da49e85fd8192c53fe1549505e3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc99fc44a7040da49e85fd8192c53fe1549505e3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7cb8f513c6fbea904703bfd0f28f70f439d6f671", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7cb8f513c6fbea904703bfd0f28f70f439d6f671", "html_url": "https://github.com/rust-lang/rust/commit/7cb8f513c6fbea904703bfd0f28f70f439d6f671", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7cb8f513c6fbea904703bfd0f28f70f439d6f671/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cfbd0eed98c93fed6dbcec4eb2e63966ff0ffc1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfbd0eed98c93fed6dbcec4eb2e63966ff0ffc1b", "html_url": "https://github.com/rust-lang/rust/commit/cfbd0eed98c93fed6dbcec4eb2e63966ff0ffc1b"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "698e5048f7bdde484259a6dd483e01dc9e198bc3", "filename": "compiler/rustc_resolve/src/late/lifetimes.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7cb8f513c6fbea904703bfd0f28f70f439d6f671/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7cb8f513c6fbea904703bfd0f28f70f439d6f671/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs?ref=7cb8f513c6fbea904703bfd0f28f70f439d6f671", "patch": "@@ -341,6 +341,34 @@ pub fn provide(providers: &mut ty::query::Providers) {\n \n /// Like `resolve_lifetimes`, but does not resolve lifetimes for trait items.\n /// Also does not generate any diagnostics.\n+///\n+/// This is ultimately a subset of the `resolve_lifetimes` work. It effectively\n+/// resolves lifetimes only within the trait \"header\" -- that is, the trait\n+/// and supertrait list. In contrast, `resolve_lifetimes` resolves all the\n+/// lifetimes within the trait and its items. There is room to refactor this,\n+/// for example to resolve lifetimes for each trait item in separate queries,\n+/// but it's convenient to do the entire trait at once because the lifetimes\n+/// from the trait definition are in scope within the trait items as well.\n+///\n+/// The reason for this separate call is to resolve what would otherwise\n+/// be a cycle. Consider this example:\n+///\n+/// ```rust\n+/// trait Base<'a> {\n+///     type BaseItem;\n+/// }\n+/// trait Sub<'b>: for<'a> Base<'a> {\n+///    type SubItem: Sub<BaseItem = &'b u32>;\n+/// }\n+/// ```\n+///\n+/// When we resolve `Sub` and all its items, we also have to resolve `Sub<BaseItem = &'b u32>`.\n+/// To figure out the index of `'b`, we have to know about the supertraits\n+/// of `Sub` so that we can determine that the `for<'a>` will be in scope.\n+/// (This is because we -- currently at least -- flatten all the late-bound\n+/// lifetimes into a single binder.) This requires us to resolve the\n+/// *trait definition* of `Sub`; basically just enough lifetime information\n+/// to look at the supertraits.\n #[tracing::instrument(level = \"debug\", skip(tcx))]\n fn resolve_lifetimes_trait_definition(\n     tcx: TyCtxt<'_>,"}]}