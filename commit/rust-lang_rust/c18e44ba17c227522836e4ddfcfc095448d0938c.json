{"sha": "c18e44ba17c227522836e4ddfcfc095448d0938c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMxOGU0NGJhMTdjMjI3NTIyODM2ZTRkZGZjZmMwOTU0NDhkMDkzOGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-05-16T00:10:46Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-05-16T00:10:46Z"}, "message": "auto merge of #6501 : june0cho/rust/incoming, r=graydon\n\nFix #3783.", "tree": {"sha": "2283dc9b5ec667bb80fd0e07740bdadac532854e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2283dc9b5ec667bb80fd0e07740bdadac532854e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c18e44ba17c227522836e4ddfcfc095448d0938c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c18e44ba17c227522836e4ddfcfc095448d0938c", "html_url": "https://github.com/rust-lang/rust/commit/c18e44ba17c227522836e4ddfcfc095448d0938c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c18e44ba17c227522836e4ddfcfc095448d0938c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7012c42c4155198df282ac4ebf0000cb25fa10f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/7012c42c4155198df282ac4ebf0000cb25fa10f3", "html_url": "https://github.com/rust-lang/rust/commit/7012c42c4155198df282ac4ebf0000cb25fa10f3"}, {"sha": "37fe2b60d5a31c6dda957d5ee42c1f1e6f408d2e", "url": "https://api.github.com/repos/rust-lang/rust/commits/37fe2b60d5a31c6dda957d5ee42c1f1e6f408d2e", "html_url": "https://github.com/rust-lang/rust/commit/37fe2b60d5a31c6dda957d5ee42c1f1e6f408d2e"}], "stats": {"total": 43, "additions": 24, "deletions": 19}, "files": [{"sha": "0d8d4baaa8061fdb8bbad5426f5487c4ac14a75d", "filename": "src/librustc/middle/resolve.rs", "status": "modified", "additions": 24, "deletions": 19, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/c18e44ba17c227522836e4ddfcfc095448d0938c/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c18e44ba17c227522836e4ddfcfc095448d0938c/src%2Flibrustc%2Fmiddle%2Fresolve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve.rs?ref=c18e44ba17c227522836e4ddfcfc095448d0938c", "patch": "@@ -512,25 +512,22 @@ pub impl Module {\n pub struct TypeNsDef {\n     privacy: Privacy,\n     module_def: Option<@mut Module>,\n-    type_def: Option<def>\n+    type_def: Option<def>,\n+    type_span: Option<span>\n }\n \n // Records a possibly-private value definition.\n pub struct ValueNsDef {\n     privacy: Privacy,\n     def: def,\n+    value_span: Option<span>,\n }\n \n // Records the definitions (at most one for each namespace) that a name is\n // bound to.\n pub struct NameBindings {\n     type_def: Option<TypeNsDef>,    //< Meaning in type namespace.\n     value_def: Option<ValueNsDef>,  //< Meaning in value namespace.\n-\n-    // For error reporting\n-    // FIXME (#3783): Merge me into TypeNsDef and ValueNsDef.\n-    type_span: Option<span>,\n-    value_span: Option<span>,\n }\n \n pub impl NameBindings {\n@@ -548,18 +545,19 @@ pub impl NameBindings {\n                 self.type_def = Some(TypeNsDef {\n                     privacy: privacy,\n                     module_def: Some(module_),\n-                    type_def: None\n+                    type_def: None,\n+                    type_span: Some(sp)\n                 });\n             }\n             Some(copy type_def) => {\n                 self.type_def = Some(TypeNsDef {\n                     privacy: privacy,\n                     module_def: Some(module_),\n+                    type_span: Some(sp),\n                     .. type_def\n                 });\n             }\n         }\n-        self.type_span = Some(sp);\n     }\n \n     /// Records a type definition.\n@@ -570,24 +568,24 @@ pub impl NameBindings {\n                 self.type_def = Some(TypeNsDef {\n                     privacy: privacy,\n                     module_def: None,\n-                    type_def: Some(def)\n+                    type_def: Some(def),\n+                    type_span: Some(sp)\n                 });\n             }\n             Some(copy type_def) => {\n                 self.type_def = Some(TypeNsDef {\n                     privacy: privacy,\n                     type_def: Some(def),\n+                    type_span: Some(sp),\n                     .. type_def\n                 });\n             }\n         }\n-        self.type_span = Some(sp);\n     }\n \n     /// Records a value definition.\n     fn define_value(@mut self, privacy: Privacy, def: def, sp: span) {\n-        self.value_def = Some(ValueNsDef { privacy: privacy, def: def });\n-        self.value_span = Some(sp);\n+        self.value_def = Some(ValueNsDef { privacy: privacy, def: def, value_span: Some(sp) });\n     }\n \n     /// Returns the module node if applicable.\n@@ -686,8 +684,18 @@ pub impl NameBindings {\n     fn span_for_namespace(&self, namespace: Namespace) -> Option<span> {\n         if self.defined_in_namespace(namespace) {\n             match namespace {\n-                TypeNS  => self.type_span,\n-                ValueNS => self.value_span,\n+                TypeNS  => {\n+                    match self.type_def {\n+                        None => None,\n+                        Some(type_def) => type_def.type_span\n+                    }\n+                }\n+                ValueNS => {\n+                    match self.value_def {\n+                        None => None,\n+                        Some(value_def) => value_def.value_span\n+                    }\n+                }\n             }\n         } else {\n             None\n@@ -698,9 +706,7 @@ pub impl NameBindings {\n pub fn NameBindings() -> NameBindings {\n     NameBindings {\n         type_def: None,\n-        value_def: None,\n-        type_span: None,\n-        value_span: None\n+        value_def: None\n     }\n }\n \n@@ -2111,10 +2117,9 @@ pub impl Resolver {\n                 privacy: Public,\n                 module_def: Some(module),\n                 type_def: None,\n+                type_span: None\n             }),\n             value_def: None,\n-            type_span: None,\n-            value_span: None,\n         }\n     }\n "}]}