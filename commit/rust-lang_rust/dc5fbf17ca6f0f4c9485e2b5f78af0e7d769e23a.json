{"sha": "dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjNWZiZjE3Y2E2ZjBmNGM5NDg1ZTJiNWY3OGFmMGU3ZDc2OWUyM2E=", "commit": {"author": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2016-03-21T09:34:24Z"}, "committer": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2016-03-21T09:34:24Z"}, "message": "Support [x; N] array repeat rvalues.", "tree": {"sha": "24460cffc5981e1beb031435b3c42eb92db83183", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/24460cffc5981e1beb031435b3c42eb92db83183"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "html_url": "https://github.com/rust-lang/rust/commit/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/comments", "author": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6eef7cc01aa1f24c3a2462123cb4590a641bcd4c", "url": "https://api.github.com/repos/rust-lang/rust/commits/6eef7cc01aa1f24c3a2462123cb4590a641bcd4c", "html_url": "https://github.com/rust-lang/rust/commit/6eef7cc01aa1f24c3a2462123cb4590a641bcd4c"}], "stats": {"total": 54, "additions": 34, "deletions": 20}, "files": [{"sha": "9b3312c224dfe63e6dc9abb809b3825f2d673567", "filename": "src/interpreter.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/src%2Finterpreter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/src%2Finterpreter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Finterpreter.rs?ref=dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "patch": "@@ -530,8 +530,7 @@ impl<'a, 'tcx: 'a, 'arena> Interpreter<'a, 'tcx, 'arena> {\n                         assert_eq!(length, operands.len());\n                         for (i, operand) in operands.iter().enumerate() {\n                             let src = try!(self.eval_operand(operand));\n-                            let offset = i * elem_size;\n-                            let elem_dest = dest.offset(offset as isize);\n+                            let elem_dest = dest.offset((i * elem_size) as isize);\n                             try!(self.memory.copy(src, elem_dest, elem_size));\n                         }\n                     } else {\n@@ -540,7 +539,17 @@ impl<'a, 'tcx: 'a, 'arena> Interpreter<'a, 'tcx, 'arena> {\n                 }\n             }\n \n-            Repeat(_, _) => unimplemented!(),\n+            Repeat(ref operand, _) => {\n+                if let Repr::Array { elem_size, length } = *dest_repr {\n+                    let src = try!(self.eval_operand(operand));\n+                    for i in 0..length {\n+                        let elem_dest = dest.offset((i * elem_size) as isize);\n+                        try!(self.memory.copy(src, elem_dest, elem_size));\n+                    }\n+                } else {\n+                    panic!(\"expected Repr::Array target\");\n+                }\n+            }\n \n             Len(ref lvalue) => {\n                 let src = try!(self.eval_lvalue(lvalue));"}, {"sha": "835e09780fc489d3c21dc5a880624d7909073ccf", "filename": "test/arrays.rs", "status": "modified", "additions": 2, "deletions": 17, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/test%2Farrays.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/test%2Farrays.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test%2Farrays.rs?ref=dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "patch": "@@ -29,21 +29,6 @@ fn index() -> i32 {\n }\n \n #[miri_run]\n-fn index_for_loop() -> usize {\n-    let mut sum = 0;\n-    let a = [0, 10, 20, 30];\n-    for i in 0..a.len() {\n-        sum += a[i];\n-    }\n-    sum\n-}\n-\n-#[miri_run]\n-fn for_loop() -> usize {\n-    let mut sum = 0;\n-    let a = [0, 10, 20, 30];\n-    for &n in &a {\n-        sum += n;\n-    }\n-    sum\n+fn array_repeat() -> [u8; 8] {\n+    [42; 8]\n }"}, {"sha": "b59c813a423e0fe674c02d1d6a5a597a02e72243", "filename": "test/loops.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/test%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a/test%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test%2Floops.rs?ref=dc5fbf17ca6f0f4c9485e2b5f78af0e7d769e23a", "patch": "@@ -13,3 +13,23 @@ fn factorial_loop() -> i64 {\n \n     product\n }\n+\n+#[miri_run]\n+fn index_for_loop() -> usize {\n+    let mut sum = 0;\n+    let a = [0, 10, 20, 30];\n+    for i in 0..a.len() {\n+        sum += a[i];\n+    }\n+    sum\n+}\n+\n+#[miri_run]\n+fn for_loop() -> usize {\n+    let mut sum = 0;\n+    let a = [0, 10, 20, 30];\n+    for &n in &a {\n+        sum += n;\n+    }\n+    sum\n+}"}]}