{"sha": "a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE2OWZjZmFlY2ZjNGM4YmZhMjU2MjFhNzdmNzNhYWRlOTVhZWE0YjQ=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "arielb1@mail.tau.ac.il", "date": "2017-04-05T23:01:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-04-05T23:01:11Z"}, "message": "Rollup merge of #41052 - topecongiro:overlapping_inherent_impls, r=estebank\n\nMake 'overlapping_inherent_impls' lint a hard error\n\nThis is ought to be implemented in PR #40728. Unfortunately, when I rebased the PR to resolve merge conflict, the \"hard error\" code disappeared. This PR complements the initial PR.\n\nNow the following rust code gives the following error:\n```rust\nstruct Foo;\n\nimpl Foo {\n    fn id() {}\n}\n\nimpl Foo {\n    fn id() {}\n}\n\nfn main() {}\n```\n```\nerror[E0592]: duplicate definitions with name `id`\n --> /home/topecongiro/test.rs:4:5\n  |\n4 |     fn id() {}\n  |     ^^^^^^^^^^ duplicate definitions for `id`\n...\n8 |     fn id() {}\n  |     ---------- other definition for `id`\n\nerror: aborting due to previous error\n```", "tree": {"sha": "b8dc8ad17b97ded9cbfae772861e7a7236768c64", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b8dc8ad17b97ded9cbfae772861e7a7236768c64"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "html_url": "https://github.com/rust-lang/rust/commit/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5e410ba5efd5885120ab1bf39a1a1eec85c9d1db", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e410ba5efd5885120ab1bf39a1a1eec85c9d1db", "html_url": "https://github.com/rust-lang/rust/commit/5e410ba5efd5885120ab1bf39a1a1eec85c9d1db"}, {"sha": "db60b0b374ef4999e3c960a7230b18bcddf82ea0", "url": "https://api.github.com/repos/rust-lang/rust/commits/db60b0b374ef4999e3c960a7230b18bcddf82ea0", "html_url": "https://github.com/rust-lang/rust/commit/db60b0b374ef4999e3c960a7230b18bcddf82ea0"}], "stats": {"total": 64, "additions": 53, "deletions": 11}, "files": [{"sha": "33280fb931aafebb0fd7431e6fb09d69ffb20adf", "filename": "src/librustc_typeck/coherence/inherent_impls_overlap.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls_overlap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls_overlap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcoherence%2Finherent_impls_overlap.rs?ref=a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "patch": "@@ -11,7 +11,6 @@\n use rustc::hir::def_id::{CrateNum, DefId, LOCAL_CRATE};\n use rustc::hir;\n use rustc::hir::itemlikevisit::ItemLikeVisitor;\n-use rustc::lint;\n use rustc::traits::{self, Reveal};\n use rustc::ty::{self, TyCtxt};\n \n@@ -53,12 +52,16 @@ impl<'a, 'tcx> InherentOverlapChecker<'a, 'tcx> {\n \n             for &item2 in &impl_items2[..] {\n                 if (name, namespace) == name_and_namespace(item2) {\n-                    let msg = format!(\"duplicate definitions with name `{}`\", name);\n-                    let node_id = self.tcx.hir.as_local_node_id(item1).unwrap();\n-                    self.tcx.sess.add_lint(lint::builtin::OVERLAPPING_INHERENT_IMPLS,\n-                                           node_id,\n-                                           self.tcx.span_of_impl(item1).unwrap(),\n-                                           msg);\n+                    struct_span_err!(self.tcx.sess,\n+                                     self.tcx.span_of_impl(item1).unwrap(),\n+                                     E0592,\n+                                     \"duplicate definitions with name `{}`\",\n+                                     name)\n+                        .span_label(self.tcx.span_of_impl(item1).unwrap(),\n+                                    &format!(\"duplicate definitions for `{}`\", name))\n+                        .span_label(self.tcx.span_of_impl(item2).unwrap(),\n+                                    &format!(\"other definition for `{}`\", name))\n+                        .emit();\n                 }\n             }\n         }"}, {"sha": "a72ad0351e33baa323e44be565320ae08e6356ab", "filename": "src/test/ui/codemap_tests/coherence-overlapping-inherent-impl-trait.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.rs?ref=a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "patch": "@@ -11,6 +11,6 @@\n #![allow(dead_code)]\n \n trait C {}\n-impl C { fn f() {} } //~ ERROR duplicate definitions with name `f`\n+impl C { fn f() {} }\n impl C { fn f() {} }\n fn main() { }", "previous_filename": "src/test/compile-fail/coherence-overlapping-inherent-impl-trait.rs"}, {"sha": "7f1ab929c6fc2b32fcbd4e0a18cd4341d08da5e8", "filename": "src/test/ui/codemap_tests/coherence-overlapping-inherent-impl-trait.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodemap_tests%2Fcoherence-overlapping-inherent-impl-trait.stderr?ref=a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "patch": "@@ -0,0 +1,10 @@\n+error[E0592]: duplicate definitions with name `f`\n+  --> $DIR/coherence-overlapping-inherent-impl-trait.rs:14:10\n+   |\n+14 | impl C { fn f() {} }\n+   |          ^^^^^^^^^ duplicate definitions for `f`\n+15 | impl C { fn f() {} }\n+   |          --------- other definition for `f`\n+\n+error: aborting due to previous error\n+"}, {"sha": "a626b63b31ba0586fc3ef57105780f3f57e569cd", "filename": "src/test/ui/codemap_tests/overlapping_inherent_impls.rs", "status": "renamed", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.rs?ref=a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "patch": "@@ -16,7 +16,7 @@\n struct Foo;\n \n impl Foo {\n-    fn id() {} //~ ERROR duplicate definitions\n+    fn id() {}\n }\n \n impl Foo {\n@@ -26,7 +26,7 @@ impl Foo {\n struct Bar<T>(T);\n \n impl<T> Bar<T> {\n-    fn bar(&self) {} //~ ERROR duplicate definitions\n+    fn bar(&self) {}\n }\n \n impl Bar<u32> {\n@@ -36,7 +36,7 @@ impl Bar<u32> {\n struct Baz<T>(T);\n \n impl<T: Copy> Baz<T> {\n-    fn baz(&self) {} //~ ERROR duplicate definitions\n+    fn baz(&self) {}\n }\n \n impl<T> Baz<Vec<T>> {", "previous_filename": "src/test/compile-fail/inherent-overlap.rs"}, {"sha": "de8a24cf33f44c12f0e70d3dbf57e99101a67e09", "filename": "src/test/ui/codemap_tests/overlapping_inherent_impls.stderr", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a69fcfaecfc4c8bfa25621a77f73aade95aea4b4/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcodemap_tests%2Foverlapping_inherent_impls.stderr?ref=a69fcfaecfc4c8bfa25621a77f73aade95aea4b4", "patch": "@@ -0,0 +1,29 @@\n+error[E0592]: duplicate definitions with name `id`\n+  --> $DIR/overlapping_inherent_impls.rs:19:5\n+   |\n+19 |     fn id() {}\n+   |     ^^^^^^^^^^ duplicate definitions for `id`\n+...\n+23 |     fn id() {}\n+   |     ---------- other definition for `id`\n+\n+error[E0592]: duplicate definitions with name `bar`\n+  --> $DIR/overlapping_inherent_impls.rs:29:5\n+   |\n+29 |     fn bar(&self) {}\n+   |     ^^^^^^^^^^^^^^^^ duplicate definitions for `bar`\n+...\n+33 |     fn bar(&self) {}\n+   |     ---------------- other definition for `bar`\n+\n+error[E0592]: duplicate definitions with name `baz`\n+  --> $DIR/overlapping_inherent_impls.rs:39:5\n+   |\n+39 |     fn baz(&self) {}\n+   |     ^^^^^^^^^^^^^^^^ duplicate definitions for `baz`\n+...\n+43 |     fn baz(&self) {}\n+   |     ---------------- other definition for `baz`\n+\n+error: aborting due to 3 previous errors\n+"}]}