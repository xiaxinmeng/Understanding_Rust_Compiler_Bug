{"sha": "bd17319b413258966368ea0926e8815d30add281", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkMTczMTliNDEzMjU4OTY2MzY4ZWEwOTI2ZTg4MTVkMzBhZGQyODE=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-01-24T20:01:39Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-01-24T20:01:39Z"}, "message": "Merge pull request #1637 from grahame/cargo-errors\n\nsuggest sync/init to user as appropriate", "tree": {"sha": "09a281ad236423dc4250dabae1dc405c260030f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09a281ad236423dc4250dabae1dc405c260030f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd17319b413258966368ea0926e8815d30add281", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd17319b413258966368ea0926e8815d30add281", "html_url": "https://github.com/rust-lang/rust/commit/bd17319b413258966368ea0926e8815d30add281", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd17319b413258966368ea0926e8815d30add281/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "73561264572c1412b88695bf2f9563bff36857ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/73561264572c1412b88695bf2f9563bff36857ee", "html_url": "https://github.com/rust-lang/rust/commit/73561264572c1412b88695bf2f9563bff36857ee"}, {"sha": "fe70212f5a8450081c5ac60e996892338c9170be", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe70212f5a8450081c5ac60e996892338c9170be", "html_url": "https://github.com/rust-lang/rust/commit/fe70212f5a8450081c5ac60e996892338c9170be"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "c2b51c15e0466a9c7b3f4d873bba6ebbf592acdd", "filename": "src/cargo/cargo.rs", "status": "modified", "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/bd17319b413258966368ea0926e8815d30add281/src%2Fcargo%2Fcargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd17319b413258966368ea0926e8815d30add281/src%2Fcargo%2Fcargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcargo%2Fcargo.rs?ref=bd17319b413258966368ea0926e8815d30add281", "patch": "@@ -476,6 +476,25 @@ fn install_package(c: cargo, wd: str, pkg: package) {\n     }\n }\n \n+fn cargo_suggestion(c: cargo, syncing: bool, fallback: fn())\n+{\n+    if c.sources.size() == 0u {\n+        error(\"No sources defined. You may wish to run \" +\n+              \"\\\"cargo init\\\" then \\\"cargo sync\\\".\");\n+        ret;\n+    }\n+    if !syncing {\n+        let npkg = 0u;\n+        c.sources.values({ |v| npkg += vec::len(v.packages) });\n+        if npkg == 0u {\n+            error(\"No packages known. You may wish to run \" +\n+                  \"\\\"cargo sync\\\".\");\n+            ret;\n+        }\n+    }\n+    fallback();\n+}\n+\n fn install_uuid(c: cargo, wd: str, uuid: str) {\n     let ps = [];\n     for_each_package(c, { |s, p|\n@@ -489,7 +508,7 @@ fn install_uuid(c: cargo, wd: str, uuid: str) {\n         install_package(c, wd, p);\n         ret;\n     } else if vec::len(ps) == 0u {\n-        error(\"No packages.\");\n+        cargo_suggestion(c, false, { || error(\"No packages match uuid.\"); });\n         ret;\n     }\n     error(\"Found multiple packages:\");\n@@ -510,7 +529,7 @@ fn install_named(c: cargo, wd: str, name: str) {\n         install_package(c, wd, p);\n         ret;\n     } else if vec::len(ps) == 0u {\n-        error(\"No packages.\");\n+        cargo_suggestion(c, false, { || error(\"No packages match name.\"); });\n         ret;\n     }\n     error(\"Found multiple packages:\");\n@@ -651,6 +670,7 @@ fn cmd_sync(c: cargo, argv: [str]) {\n     if vec::len(argv) == 3u {\n         sync_one(c, argv[2], c.sources.get(argv[2]));\n     } else {\n+        cargo_suggestion(c, true, { || } );\n         c.sources.items { |k, v|\n             sync_one(c, k, v);\n         }"}]}