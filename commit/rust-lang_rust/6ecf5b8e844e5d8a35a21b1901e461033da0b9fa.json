{"sha": "6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlY2Y1YjhlODQ0ZTVkOGEzNWEyMWIxOTAxZTQ2MTAzM2RhMGI5ZmE=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-01-06T03:35:28Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2017-01-06T03:35:28Z"}, "message": "If a string goes over-width, give up formatting it\n\nLogic here is that the original might be better and at best we'll only make it a different kind of bad.\n\nFixes #1237", "tree": {"sha": "9a730d0d08c4be5377c350231f450f0392628254", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a730d0d08c4be5377c350231f450f0392628254"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "html_url": "https://github.com/rust-lang/rust/commit/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32cb83985541ec78fc17185c0847facf2f5da2ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/32cb83985541ec78fc17185c0847facf2f5da2ec", "html_url": "https://github.com/rust-lang/rust/commit/32cb83985541ec78fc17185c0847facf2f5da2ec"}], "stats": {"total": 65, "additions": 47, "deletions": 18}, "files": [{"sha": "b2ddd1c5731aeee3feb04b75b5053290b42058a2", "filename": "src/expr.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "patch": "@@ -64,7 +64,7 @@ fn format_expr(expr: &ast::Expr,\n         ast::ExprKind::Lit(ref l) => {\n             match l.node {\n                 ast::LitKind::Str(_, ast::StrStyle::Cooked) => {\n-                    rewrite_string_lit(context, l.span, width, offset)\n+                    Some(rewrite_string_lit(context, l.span, width, offset))\n                 }\n                 _ => {\n                     wrap_str(context.snippet(expr.span),\n@@ -1457,16 +1457,16 @@ fn rewrite_string_lit(context: &RewriteContext,\n                       span: Span,\n                       width: usize,\n                       offset: Indent)\n-                      -> Option<String> {\n+                      -> String {\n     let string_lit = context.snippet(span);\n \n     if !context.config.format_strings && !context.config.force_format_strings {\n-        return Some(string_lit);\n+        return string_lit;\n     }\n \n     if !context.config.force_format_strings &&\n        !string_requires_rewrite(context, span, &string_lit, width, offset) {\n-        return Some(string_lit);\n+        return string_lit;\n     }\n \n     let fmt = StringFormat {\n@@ -1483,7 +1483,7 @@ fn rewrite_string_lit(context: &RewriteContext,\n     // Remove the quote characters.\n     let str_lit = &string_lit[1..string_lit.len() - 1];\n \n-    rewrite_string(str_lit, &fmt)\n+    rewrite_string(str_lit, &fmt).unwrap_or_else(|| string_lit.to_owned())\n }\n \n fn string_requires_rewrite(context: &RewriteContext,"}, {"sha": "71d8f8415f0cd729815b38e3c1e1f97517981005", "filename": "src/string.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/src%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/src%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fstring.rs?ref=6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "patch": "@@ -15,6 +15,7 @@ use regex::Regex;\n \n use Indent;\n use config::Config;\n+use utils::wrap_str;\n \n use MIN_STRING;\n \n@@ -117,7 +118,7 @@ pub fn rewrite_string<'a>(orig: &str, fmt: &StringFormat<'a>) -> Option<String>\n     }\n \n     result.push_str(fmt.closer);\n-    Some(result)\n+    wrap_str(result, fmt.config.max_width, fmt.width, fmt.offset)\n }\n \n #[cfg(test)]"}, {"sha": "6b95e25a052b29ffdd171b46c783595cf608c468", "filename": "tests/source/string-lit-2.rs", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Fsource%2Fstring-lit-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Fsource%2Fstring-lit-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fstring-lit-2.rs?ref=6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "patch": "@@ -3,8 +3,23 @@ fn main() -> &'static str {\n     let leave_me = \"sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss\\\n                     s\n                     jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj\";\n-    // Crappy formatting :-(\n-    let change_me = \"ssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss\\\n-                     s\n-                     jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj\";\n+}\n+\n+fn issue_1237() {\n+    let msg = \"eedadn\\n\\\n+               drvtee\\n\\\n+               eandsr\\n\\\n+               raavrd\\n\\\n+               atevrs\\n\\\n+               tsrnev\\n\\\n+               sdttsa\\n\\\n+               rasrtv\\n\\\n+               nssdts\\n\\\n+               ntnada\\n\\\n+               svetve\\n\\\n+               tesnvt\\n\\\n+               vntsnd\\n\\\n+               vrdear\\n\\\n+               dvrsen\\n\\\n+               enarar\";\n }"}, {"sha": "5b3960014b63d0b0f476bbf8c4a93062bd699af1", "filename": "tests/target/enum.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Ftarget%2Fenum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Ftarget%2Fenum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fenum.rs?ref=6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "patch": "@@ -48,8 +48,7 @@ enum StructLikeVariants {\n enum X {\n     CreateWebGLPaintTask(Size2D<i32>,\n                          GLContextAttributes,\n-                         IpcSender<Result<(IpcSender<CanvasMsg>, usize), String>>), /* This is\n-                                                                                     * a post comment */\n+                         IpcSender<Result<(IpcSender<CanvasMsg>, usize), String>>), /* This is a post comment */\n }\n \n pub enum EnumWithAttributes {\n@@ -71,8 +70,7 @@ pub enum EnumWithAttributes {\n pub enum SingleTuple {\n     // Pre Comment AAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n     // AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n-    Match(usize, usize, String), /* Post-comment\n-                                  * AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA */\n+    Match(usize, usize, String), /* Post-comment AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA */\n }\n \n pub enum SingleStruct {"}, {"sha": "6b95e25a052b29ffdd171b46c783595cf608c468", "filename": "tests/target/string-lit-2.rs", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Ftarget%2Fstring-lit-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ecf5b8e844e5d8a35a21b1901e461033da0b9fa/tests%2Ftarget%2Fstring-lit-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fstring-lit-2.rs?ref=6ecf5b8e844e5d8a35a21b1901e461033da0b9fa", "patch": "@@ -3,8 +3,23 @@ fn main() -> &'static str {\n     let leave_me = \"sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss\\\n                     s\n                     jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj\";\n-    // Crappy formatting :-(\n-    let change_me = \"sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss\n-                     \\\n-                     jjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjj\";\n+}\n+\n+fn issue_1237() {\n+    let msg = \"eedadn\\n\\\n+               drvtee\\n\\\n+               eandsr\\n\\\n+               raavrd\\n\\\n+               atevrs\\n\\\n+               tsrnev\\n\\\n+               sdttsa\\n\\\n+               rasrtv\\n\\\n+               nssdts\\n\\\n+               ntnada\\n\\\n+               svetve\\n\\\n+               tesnvt\\n\\\n+               vntsnd\\n\\\n+               vrdear\\n\\\n+               dvrsen\\n\\\n+               enarar\";\n }"}]}