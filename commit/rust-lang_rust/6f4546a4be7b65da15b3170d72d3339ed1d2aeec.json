{"sha": "6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "node_id": "C_kwDOAAsO6NoAKDZmNDU0NmE0YmU3YjY1ZGExNWIzMTcwZDcyZDMzMzllZDFkMmFlZWM", "commit": {"author": {"name": "kraktus", "email": "kraktus@users.noreply.github.com", "date": "2022-10-08T14:15:18Z"}, "committer": {"name": "kraktus", "email": "kraktus@users.noreply.github.com", "date": "2022-10-08T14:15:18Z"}, "message": "[`unnecessary_cast`] Do not lint negative hexadecimal literals when cast as float\n\nFloats cannot be expressed as hexadecimal literals", "tree": {"sha": "572db4453dcf52035bf68e25f7d434383a7ec6fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/572db4453dcf52035bf68e25f7d434383a7ec6fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "html_url": "https://github.com/rust-lang/rust/commit/6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/comments", "author": {"login": "kraktus", "id": 56031107, "node_id": "MDQ6VXNlcjU2MDMxMTA3", "avatar_url": "https://avatars.githubusercontent.com/u/56031107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kraktus", "html_url": "https://github.com/kraktus", "followers_url": "https://api.github.com/users/kraktus/followers", "following_url": "https://api.github.com/users/kraktus/following{/other_user}", "gists_url": "https://api.github.com/users/kraktus/gists{/gist_id}", "starred_url": "https://api.github.com/users/kraktus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kraktus/subscriptions", "organizations_url": "https://api.github.com/users/kraktus/orgs", "repos_url": "https://api.github.com/users/kraktus/repos", "events_url": "https://api.github.com/users/kraktus/events{/privacy}", "received_events_url": "https://api.github.com/users/kraktus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kraktus", "id": 56031107, "node_id": "MDQ6VXNlcjU2MDMxMTA3", "avatar_url": "https://avatars.githubusercontent.com/u/56031107?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kraktus", "html_url": "https://github.com/kraktus", "followers_url": "https://api.github.com/users/kraktus/followers", "following_url": "https://api.github.com/users/kraktus/following{/other_user}", "gists_url": "https://api.github.com/users/kraktus/gists{/gist_id}", "starred_url": "https://api.github.com/users/kraktus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kraktus/subscriptions", "organizations_url": "https://api.github.com/users/kraktus/orgs", "repos_url": "https://api.github.com/users/kraktus/repos", "events_url": "https://api.github.com/users/kraktus/events{/privacy}", "received_events_url": "https://api.github.com/users/kraktus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c8e473ffea22fdf9ffbecb53c1c7288d38fe923", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c8e473ffea22fdf9ffbecb53c1c7288d38fe923", "html_url": "https://github.com/rust-lang/rust/commit/2c8e473ffea22fdf9ffbecb53c1c7288d38fe923"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "c8596987e4d719b158aa879d7f1bc2bf452d4c16", "filename": "clippy_lints/src/casts/unnecessary_cast.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs?ref=6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "patch": "@@ -59,9 +59,6 @@ pub(super) fn check<'tcx>(\n                 lint_unnecessary_cast(cx, expr, literal_str, cast_from, cast_to);\n                 return false;\n             },\n-            LitKind::Int(_, LitIntType::Unsuffixed) | LitKind::Float(_, LitFloatType::Unsuffixed) => {\n-                return false;\n-            },\n             LitKind::Int(_, LitIntType::Signed(_) | LitIntType::Unsigned(_))\n             | LitKind::Float(_, LitFloatType::Suffixed(_))\n                 if cast_from.kind() == cast_to.kind() =>"}, {"sha": "c5dcd7b31f58e7126b48d236669b5252d8b5ce03", "filename": "clippy_utils/src/numeric_literal.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/clippy_utils%2Fsrc%2Fnumeric_literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/clippy_utils%2Fsrc%2Fnumeric_literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_utils%2Fsrc%2Fnumeric_literal.rs?ref=6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "patch": "@@ -69,12 +69,13 @@ impl<'a> NumericLiteral<'a> {\n \n     #[must_use]\n     pub fn new(lit: &'a str, suffix: Option<&'a str>, float: bool) -> Self {\n+        let unsigned_lit = lit.trim_start_matches('-');\n         // Determine delimiter for radix prefix, if present, and radix.\n-        let radix = if lit.starts_with(\"0x\") {\n+        let radix = if unsigned_lit.starts_with(\"0x\") {\n             Radix::Hexadecimal\n-        } else if lit.starts_with(\"0b\") {\n+        } else if unsigned_lit.starts_with(\"0b\") {\n             Radix::Binary\n-        } else if lit.starts_with(\"0o\") {\n+        } else if unsigned_lit.starts_with(\"0o\") {\n             Radix::Octal\n         } else {\n             Radix::Decimal"}, {"sha": "ec8c6abfab91e725891f268967c59dabcb101e13", "filename": "tests/ui/unnecessary_cast.fixed", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/tests%2Fui%2Funnecessary_cast.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/tests%2Fui%2Funnecessary_cast.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast.fixed?ref=6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "patch": "@@ -111,4 +111,8 @@ mod fixable {\n \n         let _num = foo();\n     }\n+\n+    fn issue_9603() {\n+        let _: f32 = -0x400 as f32;\n+    }\n }"}, {"sha": "5213cdc269bd4c5a9aec63cb2c5ff31a87e4ccf9", "filename": "tests/ui/unnecessary_cast.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/tests%2Fui%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6f4546a4be7b65da15b3170d72d3339ed1d2aeec/tests%2Fui%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast.rs?ref=6f4546a4be7b65da15b3170d72d3339ed1d2aeec", "patch": "@@ -111,4 +111,8 @@ mod fixable {\n \n         let _num = foo() as f32;\n     }\n+\n+    fn issue_9603() {\n+        let _: f32 = -0x400 as f32;\n+    }\n }"}]}