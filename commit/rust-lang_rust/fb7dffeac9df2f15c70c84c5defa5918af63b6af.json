{"sha": "fb7dffeac9df2f15c70c84c5defa5918af63b6af", "node_id": "C_kwDOAAsO6NoAKGZiN2RmZmVhYzlkZjJmMTVjNzBjODRjNWRlZmE1OTE4YWY2M2I2YWY", "commit": {"author": {"name": "royrustdev", "email": "royrustdev@gmail.com", "date": "2022-08-26T07:16:41Z"}, "committer": {"name": "royrustdev", "email": "royrustdev@gmail.com", "date": "2022-08-26T11:35:52Z"}, "message": "add `multi_assignments` lint", "tree": {"sha": "16aba8c90f92ebb6d6ad227889aa11b578e10015", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/16aba8c90f92ebb6d6ad227889aa11b578e10015"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb7dffeac9df2f15c70c84c5defa5918af63b6af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb7dffeac9df2f15c70c84c5defa5918af63b6af", "html_url": "https://github.com/rust-lang/rust/commit/fb7dffeac9df2f15c70c84c5defa5918af63b6af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb7dffeac9df2f15c70c84c5defa5918af63b6af/comments", "author": {"login": "roynrishingha", "id": 99001889, "node_id": "U_kgDOBeamIQ", "avatar_url": "https://avatars.githubusercontent.com/u/99001889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roynrishingha", "html_url": "https://github.com/roynrishingha", "followers_url": "https://api.github.com/users/roynrishingha/followers", "following_url": "https://api.github.com/users/roynrishingha/following{/other_user}", "gists_url": "https://api.github.com/users/roynrishingha/gists{/gist_id}", "starred_url": "https://api.github.com/users/roynrishingha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roynrishingha/subscriptions", "organizations_url": "https://api.github.com/users/roynrishingha/orgs", "repos_url": "https://api.github.com/users/roynrishingha/repos", "events_url": "https://api.github.com/users/roynrishingha/events{/privacy}", "received_events_url": "https://api.github.com/users/roynrishingha/received_events", "type": "User", "site_admin": false}, "committer": {"login": "roynrishingha", "id": 99001889, "node_id": "U_kgDOBeamIQ", "avatar_url": "https://avatars.githubusercontent.com/u/99001889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roynrishingha", "html_url": "https://github.com/roynrishingha", "followers_url": "https://api.github.com/users/roynrishingha/followers", "following_url": "https://api.github.com/users/roynrishingha/following{/other_user}", "gists_url": "https://api.github.com/users/roynrishingha/gists{/gist_id}", "starred_url": "https://api.github.com/users/roynrishingha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roynrishingha/subscriptions", "organizations_url": "https://api.github.com/users/roynrishingha/orgs", "repos_url": "https://api.github.com/users/roynrishingha/repos", "events_url": "https://api.github.com/users/roynrishingha/events{/privacy}", "received_events_url": "https://api.github.com/users/roynrishingha/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41309df8efe99848a79782ae98ad73638668381c", "url": "https://api.github.com/repos/rust-lang/rust/commits/41309df8efe99848a79782ae98ad73638668381c", "html_url": "https://github.com/rust-lang/rust/commit/41309df8efe99848a79782ae98ad73638668381c"}], "stats": {"total": 120, "additions": 120, "deletions": 0}, "files": [{"sha": "c285c1e6859c8a1fa2081628e7d3ec0086bda2e3", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -3897,6 +3897,7 @@ Released 2018-09-13\n [`module_name_repetitions`]: https://rust-lang.github.io/rust-clippy/master/index.html#module_name_repetitions\n [`modulo_arithmetic`]: https://rust-lang.github.io/rust-clippy/master/index.html#modulo_arithmetic\n [`modulo_one`]: https://rust-lang.github.io/rust-clippy/master/index.html#modulo_one\n+[`multi_assignments`]: https://rust-lang.github.io/rust-clippy/master/index.html#multi_assignments\n [`multiple_crate_versions`]: https://rust-lang.github.io/rust-clippy/master/index.html#multiple_crate_versions\n [`multiple_inherent_impl`]: https://rust-lang.github.io/rust-clippy/master/index.html#multiple_inherent_impl\n [`must_use_candidate`]: https://rust-lang.github.io/rust-clippy/master/index.html#must_use_candidate"}, {"sha": "eaeb201ff508f8a14556684e2b56a75010d1c209", "filename": "clippy_lints/src/lib.register_all.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_all.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_all.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_all.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -233,6 +233,7 @@ store.register_group(true, \"clippy::all\", Some(\"clippy_all\"), vec![\n     LintId::of(misc_early::UNNEEDED_WILDCARD_PATTERN),\n     LintId::of(misc_early::ZERO_PREFIXED_LITERAL),\n     LintId::of(mixed_read_write_in_expression::DIVERGING_SUB_EXPRESSION),\n+    LintId::of(multi_assignments::MULTI_ASSIGNMENTS),\n     LintId::of(mut_key::MUTABLE_KEY_TYPE),\n     LintId::of(mut_reference::UNNECESSARY_MUT_PASSED),\n     LintId::of(needless_arbitrary_self_type::NEEDLESS_ARBITRARY_SELF_TYPE),"}, {"sha": "e058c45217e7d7e2936ac9f912a926c0fd1051ab", "filename": "clippy_lints/src/lib.register_lints.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_lints.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -398,6 +398,7 @@ store.register_lints(&[\n     mixed_read_write_in_expression::MIXED_READ_WRITE_IN_EXPRESSION,\n     module_style::MOD_MODULE_FILES,\n     module_style::SELF_NAMED_MODULE_FILES,\n+    multi_assignments::MULTI_ASSIGNMENTS,\n     mut_key::MUTABLE_KEY_TYPE,\n     mut_mut::MUT_MUT,\n     mut_reference::UNNECESSARY_MUT_PASSED,"}, {"sha": "6f480c52cc9429a8a19533a4fcda2c476884e1f0", "filename": "clippy_lints/src/lib.register_suspicious.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_suspicious.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.register_suspicious.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.register_suspicious.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -24,6 +24,7 @@ store.register_group(true, \"clippy::suspicious\", Some(\"clippy_suspicious\"), vec!\n     LintId::of(loops::MUT_RANGE_BOUND),\n     LintId::of(methods::NO_EFFECT_REPLACE),\n     LintId::of(methods::SUSPICIOUS_MAP),\n+    LintId::of(multi_assignments::MULTI_ASSIGNMENTS),\n     LintId::of(mut_key::MUTABLE_KEY_TYPE),\n     LintId::of(octal_escapes::OCTAL_ESCAPES),\n     LintId::of(operators::FLOAT_EQUALITY_WITHOUT_ABS),"}, {"sha": "a3a4267abea29e130e4eeb41176907701c33186c", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -289,6 +289,7 @@ mod missing_enforced_import_rename;\n mod missing_inline;\n mod mixed_read_write_in_expression;\n mod module_style;\n+mod multi_assignments;\n mod mut_key;\n mod mut_mut;\n mod mut_reference;\n@@ -896,6 +897,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n     store.register_late_pass(|| Box::new(partialeq_to_none::PartialeqToNone));\n     store.register_late_pass(|| Box::new(manual_empty_string_creations::ManualEmptyStringCreations));\n     store.register_late_pass(|| Box::new(unused_peekable::UnusedPeekable));\n+    store.register_early_pass(|| Box::new(multi_assignments::MultiAssignments));\n     // add lints here, do not remove this comment, it's used in `new_lint`\n }\n "}, {"sha": "81eb1a085aea9163eca1c0029766d95f99d9d280", "filename": "clippy_lints/src/multi_assignments.rs", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Fmulti_assignments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/clippy_lints%2Fsrc%2Fmulti_assignments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmulti_assignments.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -0,0 +1,65 @@\n+use clippy_utils::diagnostics::span_lint;\n+use rustc_ast::ast::{Expr, ExprKind, Stmt, StmtKind};\n+use rustc_lint::{EarlyContext, EarlyLintPass};\n+use rustc_session::{declare_lint_pass, declare_tool_lint};\n+\n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Checks for nested assignments.\n+    ///\n+    /// ### Why is this bad?\n+    /// While this is in most cases already a type mismatch,\n+    /// the result of an assignment being `()` can throw off people coming from languages like python or C,\n+    /// where such assignments return a copy of the assigned value.\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    ///# let (a, b);\n+    /// a = b = 42;\n+    /// ```\n+    /// Use instead:\n+    /// ```rust\n+    ///# let (a, b);\n+    /// b = 42;\n+    /// a = b;\n+    /// ```\n+    #[clippy::version = \"1.65.0\"]\n+    pub MULTI_ASSIGNMENTS,\n+    suspicious,\n+    \"instead of using `a = b = c;` use `a = c; b = c;`\"\n+}\n+\n+declare_lint_pass!(MultiAssignments => [MULTI_ASSIGNMENTS]);\n+\n+fn strip_paren_blocks(expr: &Expr) -> &Expr {\n+    match &expr.kind {\n+        ExprKind::Paren(e) => strip_paren_blocks(e),\n+        ExprKind::Block(b, _) => {\n+            if let [\n+                Stmt {\n+                    kind: StmtKind::Expr(e),\n+                    ..\n+                },\n+            ] = &b.stmts[..]\n+            {\n+                strip_paren_blocks(e)\n+            } else {\n+                expr\n+            }\n+        },\n+        _ => expr,\n+    }\n+}\n+\n+impl EarlyLintPass for MultiAssignments {\n+    fn check_expr(&mut self, cx: &EarlyContext<'_>, expr: &Expr) {\n+        if let ExprKind::Assign(target, source, _) = &expr.kind {\n+            if let ExprKind::Assign(_target, _source, _) = &strip_paren_blocks(target).kind {\n+                span_lint(cx, MULTI_ASSIGNMENTS, expr.span, \"assignments don't nest intuitively\");\n+            };\n+            if let ExprKind::Assign(_target, _source, _) = &strip_paren_blocks(source).kind {\n+                span_lint(cx, MULTI_ASSIGNMENTS, expr.span, \"assignments don't nest intuitively\");\n+            }\n+        };\n+    }\n+}"}, {"sha": "b186bf8bbdb424874495f06e80a9a1ddd6cedef3", "filename": "tests/ui/multi_assignments.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/tests%2Fui%2Fmulti_assignments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/tests%2Fui%2Fmulti_assignments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmulti_assignments.rs?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -0,0 +1,9 @@\n+#![warn(clippy::multi_assignments)]\n+fn main() {\n+    let (mut a, mut b, mut c, mut d) = ((), (), (), ());\n+    a = b = c;\n+    a = b = c = d;\n+    a = b = { c };\n+    a = { b = c };\n+    a = (b = c);\n+}"}, {"sha": "d6c42bb698cf97f34c5c02e30f9fd9e456bf6551", "filename": "tests/ui/multi_assignments.stderr", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/fb7dffeac9df2f15c70c84c5defa5918af63b6af/tests%2Fui%2Fmulti_assignments.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/fb7dffeac9df2f15c70c84c5defa5918af63b6af/tests%2Fui%2Fmulti_assignments.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmulti_assignments.stderr?ref=fb7dffeac9df2f15c70c84c5defa5918af63b6af", "patch": "@@ -0,0 +1,40 @@\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:4:5\n+   |\n+LL |     a = b = c;\n+   |     ^^^^^^^^^\n+   |\n+   = note: `-D clippy::multi-assignments` implied by `-D warnings`\n+\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:5:5\n+   |\n+LL |     a = b = c = d;\n+   |     ^^^^^^^^^^^^^\n+\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:5:9\n+   |\n+LL |     a = b = c = d;\n+   |         ^^^^^^^^^\n+\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:6:5\n+   |\n+LL |     a = b = { c };\n+   |     ^^^^^^^^^^^^^\n+\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:7:5\n+   |\n+LL |     a = { b = c };\n+   |     ^^^^^^^^^^^^^\n+\n+error: assignments don't nest intuitively\n+  --> $DIR/multi_assignments.rs:8:5\n+   |\n+LL |     a = (b = c);\n+   |     ^^^^^^^^^^^\n+\n+error: aborting due to 6 previous errors\n+"}]}