{"sha": "d123df26ff1796f4712b10290a3b6647d754a6e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxMjNkZjI2ZmYxNzk2ZjQ3MTJiMTAyOTBhM2I2NjQ3ZDc1NGE2ZTM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-08-05T04:54:59Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-08-05T04:56:47Z"}, "message": "std: Fix newsched logging truncation\n\nThe truncation needs to be done in the console logger in order\nto catch all the logging output, and because truncation only matters\nwhen outputting to the console.", "tree": {"sha": "47d7451739a7543ecb6703cfa3f1968090d40515", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47d7451739a7543ecb6703cfa3f1968090d40515"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d123df26ff1796f4712b10290a3b6647d754a6e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d123df26ff1796f4712b10290a3b6647d754a6e3", "html_url": "https://github.com/rust-lang/rust/commit/d123df26ff1796f4712b10290a3b6647d754a6e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d123df26ff1796f4712b10290a3b6647d754a6e3/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c12ca3ac2d0db3f9636e16fc5a507a12f313e7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c12ca3ac2d0db3f9636e16fc5a507a12f313e7f", "html_url": "https://github.com/rust-lang/rust/commit/6c12ca3ac2d0db3f9636e16fc5a507a12f313e7f"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "6e11d14aea9a316d069403083e9e97af069a6115", "filename": "src/libstd/logging.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d123df26ff1796f4712b10290a3b6647d754a6e3/src%2Flibstd%2Flogging.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d123df26ff1796f4712b10290a3b6647d754a6e3/src%2Flibstd%2Flogging.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flogging.rs?ref=d123df26ff1796f4712b10290a3b6647d754a6e3", "patch": "@@ -85,16 +85,6 @@ pub fn log_type<T>(level: u32, object: &T) {\n fn newsched_log_str(msg: ~str) {\n     use rt::task::Task;\n     use rt::local::Local;\n-    use str::StrSlice;\n-    use container::Container;\n-\n-    // Truncate the string\n-    let buf_bytes = 256;\n-    let msg = if msg.len() > buf_bytes {\n-        msg.slice(0, buf_bytes) + \"[...]\"\n-    } else {\n-        msg\n-    };\n \n     unsafe {\n         match Local::try_unsafe_borrow::<Task>() {"}, {"sha": "9056f0d52e09a1492231a472b122ae773bcbdc6a", "filename": "src/libstd/rt/logging.rs", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/d123df26ff1796f4712b10290a3b6647d754a6e3/src%2Flibstd%2Frt%2Flogging.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d123df26ff1796f4712b10290a3b6647d754a6e3/src%2Flibstd%2Frt%2Flogging.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Flogging.rs?ref=d123df26ff1796f4712b10290a3b6647d754a6e3", "patch": "@@ -10,6 +10,7 @@\n \n use either::*;\n use libc;\n+use str::StrSlice;\n \n pub trait Logger {\n     fn log(&mut self, msg: Either<~str, &'static str>);\n@@ -35,10 +36,22 @@ impl Logger for StdErrLogger {\n                 s\n             }\n         };\n-        let dbg = ::libc::STDERR_FILENO as ::io::fd_t;\n-        dbg.write_str(s);\n-        dbg.write_str(\"\\n\");\n-        dbg.flush();\n+\n+        // Truncate the string\n+        let buf_bytes = 256;\n+        if s.len() > buf_bytes {\n+            let s = s.slice(0, buf_bytes) + \"[...]\";\n+            print(s);\n+        } else {\n+            print(s)\n+        };\n+\n+        fn print(s: &str) {\n+            let dbg = ::libc::STDERR_FILENO as ::io::fd_t;\n+            dbg.write_str(s);\n+            dbg.write_str(\"\\n\");\n+            dbg.flush();\n+        }\n     }\n }\n "}]}