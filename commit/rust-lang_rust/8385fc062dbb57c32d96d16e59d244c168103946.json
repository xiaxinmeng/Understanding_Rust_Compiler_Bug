{"sha": "8385fc062dbb57c32d96d16e59d244c168103946", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgzODVmYzA2MmRiYjU3YzMyZDk2ZDE2ZTU5ZDI0NGMxNjgxMDM5NDY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-11-16T03:49:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-11-16T03:49:13Z"}, "message": "Auto merge of #46025 - nrc:rustfmt-fix, r=Mark-Simulacrum\n\nFix a bug where the rustfmt tarball was not being produced\n\nr? @alexcrichton\n\nThis makes rustfmt a dep of 'extended', which seems to be necessary for the rustfmt dist step to actually get run.", "tree": {"sha": "13664cdc046768dabba3a0964cfcfd1d144e6b5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/13664cdc046768dabba3a0964cfcfd1d144e6b5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8385fc062dbb57c32d96d16e59d244c168103946", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8385fc062dbb57c32d96d16e59d244c168103946", "html_url": "https://github.com/rust-lang/rust/commit/8385fc062dbb57c32d96d16e59d244c168103946", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8385fc062dbb57c32d96d16e59d244c168103946/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42ea30c8b0107cced6c85f9240111d61aa3ff654", "url": "https://api.github.com/repos/rust-lang/rust/commits/42ea30c8b0107cced6c85f9240111d61aa3ff654", "html_url": "https://github.com/rust-lang/rust/commit/42ea30c8b0107cced6c85f9240111d61aa3ff654"}, {"sha": "262029eca94ff4ec74d985b65d644f62fd593e5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/262029eca94ff4ec74d985b65d644f62fd593e5d", "html_url": "https://github.com/rust-lang/rust/commit/262029eca94ff4ec74d985b65d644f62fd593e5d"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "7bf385301fab52acc0cd1fd87c5f6cb79b60cbfb", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8385fc062dbb57c32d96d16e59d244c168103946/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8385fc062dbb57c32d96d16e59d244c168103946/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=8385fc062dbb57c32d96d16e59d244c168103946", "patch": "@@ -1159,8 +1159,6 @@ impl Step for Rustfmt {\n         t!(fs::create_dir_all(&image));\n \n         // Prepare the image directory\n-        // We expect RLS to build, because we've exited this step above if tool\n-        // state for RLS isn't testing.\n         let rustfmt = builder.ensure(tool::Rustfmt {\n             compiler: builder.compiler(stage, build.build),\n             target\n@@ -1262,6 +1260,7 @@ impl Step for Extended {\n             compiler: builder.compiler(stage, target),\n         });\n         let cargo_installer = builder.ensure(Cargo { stage, target });\n+        let rustfmt_installer = builder.ensure(Rustfmt { stage, target });\n         let rls_installer = builder.ensure(Rls { stage, target });\n         let mingw_installer = builder.ensure(Mingw { host: target });\n         let analysis_installer = builder.ensure(Analysis {\n@@ -1299,6 +1298,7 @@ impl Step for Extended {\n         tarballs.push(rustc_installer);\n         tarballs.push(cargo_installer);\n         tarballs.extend(rls_installer.clone());\n+        tarballs.extend(rustfmt_installer.clone());\n         tarballs.push(analysis_installer);\n         tarballs.push(std_installer);\n         if build.config.docs {\n@@ -1366,6 +1366,9 @@ impl Step for Extended {\n             if rls_installer.is_none() {\n                 contents = filter(&contents, \"rls\");\n             }\n+            if rustfmt_installer.is_none() {\n+                contents = filter(&contents, \"rustfmt\");\n+            }\n             let ret = tmp.join(p.file_name().unwrap());\n             t!(t!(File::create(&ret)).write_all(contents.as_bytes()));\n             return ret"}]}