{"sha": "5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "node_id": "C_kwDOAAsO6NoAKDVjNzY0ZGE5YjA1Y2Q3OGQwYjg5ZDViNGY3YjZiNDAxZmM3NzM1NzE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-11-13T16:37:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-13T16:37:37Z"}, "message": "Rollup merge of #104315 - SparkyPotato:fix-104276, r=cjgillot\n\nImprove spans with `use crate::{self}`\n\nFixes #104276.\n\nThe error becomes:\n```\nerror: crate root imports need to be explicitly named: `use crate as name;`\n --> src/lib.rs.rs:1:13\n  |\n1 | use crate::{self};\n  |             ^^^^\n\nwarning: unused import: `self`\n --> src/lib.rs:1:13\n  |\n1 | use crate::{self};\n  |             ^^^^\n  |\n  = note: `#[warn(unused_imports)]` on by default\n```", "tree": {"sha": "1efd02c8512a81cbd42f67eb3fd491de3224aa32", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1efd02c8512a81cbd42f67eb3fd491de3224aa32"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjcR1RCRBK7hj4Ov3rIwAAZ4AIALKOfeONT1nDqdb1b9gZ+HrS\nhIeo6y0t1+SEEDfkm+26g+mfe1EDKZtrbSBMvQ2kgzS42R1mNijaQXf7Z40psw8Q\nWEqH6e4/zw/959BTpNeIg+TNpfkq3UatTzBcVvdlFHYXDKfvWFf7h6TPKomIhdZ3\nb0hZWlTSkFIv9w1vt/ePbSOeLj8RmEClYxhxPVulN+ymratc50+IBx4kNnnBSq5v\nBYuB1B/tituexR7X/YFbWTPu3aBhLsQGJY6U5LLCV1tbLdKw+cLU67BY+zLVORo5\nDzoBsExXS9kAb8+eIsRv4wMqZoh8d993ilfXfw20qy4gl7BaWc7l/FPnkeHGVBw=\n=2bof\n-----END PGP SIGNATURE-----\n", "payload": "tree 1efd02c8512a81cbd42f67eb3fd491de3224aa32\nparent a1b0702ea5efd2f1bacc2bb5cfac7b82abc58bc5\nparent c7b28913151927e8fdda3878d0188ab02b767eae\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1668357457 +0100\ncommitter GitHub <noreply@github.com> 1668357457 +0100\n\nRollup merge of #104315 - SparkyPotato:fix-104276, r=cjgillot\n\nImprove spans with `use crate::{self}`\n\nFixes #104276.\n\nThe error becomes:\n```\nerror: crate root imports need to be explicitly named: `use crate as name;`\n --> src/lib.rs.rs:1:13\n  |\n1 | use crate::{self};\n  |             ^^^^\n\nwarning: unused import: `self`\n --> src/lib.rs:1:13\n  |\n1 | use crate::{self};\n  |             ^^^^\n  |\n  = note: `#[warn(unused_imports)]` on by default\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "html_url": "https://github.com/rust-lang/rust/commit/5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1b0702ea5efd2f1bacc2bb5cfac7b82abc58bc5", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1b0702ea5efd2f1bacc2bb5cfac7b82abc58bc5", "html_url": "https://github.com/rust-lang/rust/commit/a1b0702ea5efd2f1bacc2bb5cfac7b82abc58bc5"}, {"sha": "c7b28913151927e8fdda3878d0188ab02b767eae", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7b28913151927e8fdda3878d0188ab02b767eae", "html_url": "https://github.com/rust-lang/rust/commit/c7b28913151927e8fdda3878d0188ab02b767eae"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "e7e419c9b4238207d0c75fc8fc1931d779395765", "filename": "compiler/rustc_resolve/src/build_reduced_graph.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fbuild_reduced_graph.rs?ref=5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "patch": "@@ -469,9 +469,11 @@ impl<'a, 'b> BuildReducedGraphVisitor<'a, 'b> {\n                         }\n \n                         // Replace `use foo::{ self };` with `use foo;`\n+                        let self_span = source.ident.span;\n                         source = module_path.pop().unwrap();\n                         if rename.is_none() {\n-                            ident = source.ident;\n+                            // Keep the span of `self`, but the name of `foo`\n+                            ident = Ident { name: source.ident.name, span: self_span };\n                         }\n                     }\n                 } else {"}, {"sha": "65ab948147cdc3fce11acccc40e666b2cb9a929c", "filename": "src/test/ui/use/use-crate-self.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.rs?ref=5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "patch": "@@ -0,0 +1,4 @@\n+use crate::{self};\n+        //~^ ERROR crate root imports need to be explicitly named: `use crate as name;`\n+\n+fn main() {}"}, {"sha": "dd4036bfff475e1539ecc8024b08bb4ba1cf45ba", "filename": "src/test/ui/use/use-crate-self.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5c764da9b05cd78d0b89d5b4f7b6b401fc773571/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fuse%2Fuse-crate-self.stderr?ref=5c764da9b05cd78d0b89d5b4f7b6b401fc773571", "patch": "@@ -0,0 +1,8 @@\n+error: crate root imports need to be explicitly named: `use crate as name;`\n+  --> $DIR/use-crate-self.rs:1:13\n+   |\n+LL | use crate::{self};\n+   |             ^^^^\n+\n+error: aborting due to previous error\n+"}]}