{"sha": "0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkYjFjNmExYjBlYzJmZTVlN2EzYzE1MjczZThhOTdiODc0N2Q3Yjc=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-30T06:57:33Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-30T06:57:33Z"}, "message": "ignore memory leaks on Windows", "tree": {"sha": "5c1e34a6c9f798e5cfd0b5f1ce4bae759375c19a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c1e34a6c9f798e5cfd0b5f1ce4bae759375c19a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "html_url": "https://github.com/rust-lang/rust/commit/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7a3e040eb49129ce79ee604fb593671d1f86901", "url": "https://api.github.com/repos/rust-lang/rust/commits/d7a3e040eb49129ce79ee604fb593671d1f86901", "html_url": "https://github.com/rust-lang/rust/commit/d7a3e040eb49129ce79ee604fb593671d1f86901"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "8fff4635fa0ef8e24be18aafd9926ace43a755c6", "filename": "src/lib.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "patch": "@@ -159,7 +159,10 @@ pub fn eval_main<'a, 'tcx: 'a>(\n     match res {\n         Ok(()) => {\n             let leaks = ecx.memory().leak_report();\n-            if leaks != 0 {\n+            // Disable the leak test on some platforms where we likely do not\n+            // correctly implement TLS destructors.\n+            let target_os = &ecx.tcx.tcx.sess.target.target.target_os;\n+            if target_os.to_lowercase() != \"windows\" && leaks != 0 {\n                 tcx.sess.err(\"the evaluated program leaked memory\");\n             }\n         }"}, {"sha": "7f155edc35a51bd56f1151afe90022c0e7db293d", "filename": "tests/compile-fail/memleak.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/tests%2Fcompile-fail%2Fmemleak.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/tests%2Fcompile-fail%2Fmemleak.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fmemleak.rs?ref=0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "patch": "@@ -1,3 +1,5 @@\n+// ignore-windows\n+\n //error-pattern: the evaluated program leaked memory\n \n fn main() {"}, {"sha": "24e8363049c8c4047c0af1759111d4d8d0e2cd13", "filename": "tests/compile-fail/memleak_rc.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/tests%2Fcompile-fail%2Fmemleak_rc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7/tests%2Fcompile-fail%2Fmemleak_rc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fmemleak_rc.rs?ref=0db1c6a1b0ec2fe5e7a3c15273e8a97b8747d7b7", "patch": "@@ -1,3 +1,5 @@\n+// ignore-windows\n+\n //error-pattern: the evaluated program leaked memory\n \n use std::rc::Rc;"}]}