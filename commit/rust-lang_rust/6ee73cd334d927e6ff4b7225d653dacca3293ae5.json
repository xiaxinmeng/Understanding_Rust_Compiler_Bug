{"sha": "6ee73cd334d927e6ff4b7225d653dacca3293ae5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlZTczY2QzMzRkOTI3ZTZmZjRiNzIyNWQ2NTNkYWNjYTMyOTNhZTU=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-02T13:42:37Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2020-07-02T13:42:37Z"}, "message": "Use SmolStr", "tree": {"sha": "fad8058c56a2d1bf4f39fdaafe942f99da71f25d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fad8058c56a2d1bf4f39fdaafe942f99da71f25d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ee73cd334d927e6ff4b7225d653dacca3293ae5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ee73cd334d927e6ff4b7225d653dacca3293ae5", "html_url": "https://github.com/rust-lang/rust/commit/6ee73cd334d927e6ff4b7225d653dacca3293ae5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ee73cd334d927e6ff4b7225d653dacca3293ae5/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "361b399b6d0fd9315607387b0abdf40a07c6b91b", "url": "https://api.github.com/repos/rust-lang/rust/commits/361b399b6d0fd9315607387b0abdf40a07c6b91b", "html_url": "https://github.com/rust-lang/rust/commit/361b399b6d0fd9315607387b0abdf40a07c6b91b"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "869f3ca5a81f2121083361ad4392e57643ddeb81", "filename": "crates/ra_hir_def/src/import_map.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6ee73cd334d927e6ff4b7225d653dacca3293ae5/crates%2Fra_hir_def%2Fsrc%2Fimport_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ee73cd334d927e6ff4b7225d653dacca3293ae5/crates%2Fra_hir_def%2Fsrc%2Fimport_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fimport_map.rs?ref=6ee73cd334d927e6ff4b7225d653dacca3293ae5", "patch": "@@ -5,6 +5,7 @@ use std::{cmp::Ordering, fmt, hash::BuildHasherDefault, sync::Arc};\n use fst::{self, Streamer};\n use indexmap::{map::Entry, IndexMap};\n use ra_db::CrateId;\n+use ra_syntax::SmolStr;\n use rustc_hash::{FxHashMap, FxHasher};\n use smallvec::SmallVec;\n \n@@ -50,7 +51,7 @@ pub struct ImportMap {\n \n     /// Maps names of associated items to the item's ID. Only includes items whose defining trait is\n     /// exported.\n-    assoc_map: FxHashMap<String, SmallVec<[AssocItemId; 1]>>,\n+    assoc_map: FxHashMap<SmolStr, SmallVec<[AssocItemId; 1]>>,\n }\n \n impl ImportMap {\n@@ -162,7 +163,7 @@ impl ImportMap {\n     fn collect_trait_methods(&mut self, db: &dyn DefDatabase, tr: TraitId) {\n         let data = db.trait_data(tr);\n         for (name, item) in data.items.iter() {\n-            self.assoc_map.entry(name.to_string()).or_default().push(*item);\n+            self.assoc_map.entry(name.to_string().into()).or_default().push(*item);\n         }\n     }\n }\n@@ -310,7 +311,7 @@ pub fn search_dependencies<'a>(\n \n     // Add all exported associated items whose names match the query (exactly).\n     for map in &import_maps {\n-        if let Some(v) = map.assoc_map.get(&query.query) {\n+        if let Some(v) = map.assoc_map.get(&*query.query) {\n             res.extend(v.iter().map(|&assoc| {\n                 ItemInNs::Types(match assoc {\n                     AssocItemId::FunctionId(it) => it.into(),"}]}