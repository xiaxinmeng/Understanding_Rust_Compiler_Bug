{"sha": "1c0d76404939f401536271f8053dd999c5f254c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFjMGQ3NjQwNDkzOWY0MDE1MzYyNzFmODA1M2RkOTk5YzVmMjU0Yzk=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-07T11:44:37Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:03:08Z"}, "message": "ci: extract switching xcode into a script", "tree": {"sha": "0f40a1564db007a914f5bf4ea548e82475e7d6aa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f40a1564db007a914f5bf4ea548e82475e7d6aa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c0d76404939f401536271f8053dd999c5f254c9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAJwACgkQPgar6Auq\n8ZysWg//eER99bX1KXAhA3ESjxRwOSJBnDZLXHNHrGZFBF3njbvyRpCenAJNn6FQ\nhEfK/VwitQFkzPLPUCuz1bHZCn6+IvWBdW478SzNn2fIFW0JH7MGlM18d8PvW1UV\nhPhmBmZs4M0r/ByV0m3t0Uk2TT7PmKIBCpDZnrw0/k3D9d+fWwFputj5efqMiwuW\nAn5xHxInMTCkOLSGylfkkuiAweDTxWMh60QRZUERT8/pSFn2pyERD63Xn+VFy4p7\n0C4Y+GHgc4RKGSz3zs83IeKwDymBG+bmWogKbqgTHCpXjjA1zoYbYs9QDduLFwM7\nXffW1EsZ3smNMcY2zNYaDpcy7CO3eRGXfwfjE47D3wH0KVOBh8eFbrYhJ7ZLLlwJ\n5xVooonKzCL+XkitCF/18tDIyj+JtvwX3RWqRpPPyk36jCRz0FlEVGf5nGIyoRNG\n4hM6pmiav5N9JTmtgTQ/ZPEcJkpCNB3pA9D1znmFoehlAiZMWfjHEdCqnJCS+drX\nxGGaaGB0O41UebiSDFVSIKZfZ5FdjnfIE0qFxkyJeZoFZE3PWDUyztDmzV7jXh7y\nE6zjDccw18FdNETyJt3tpi12l1p1wJ2H/40lSGK7Nq5/08sV28DnxiKYJv1VcDtk\ndoXCTj/mJORWiJu3tJ7O9H8Bqt/2buXJv8ihhAfaQY/VzY3Y1yw=\n=nt+s\n-----END PGP SIGNATURE-----", "payload": "tree 0f40a1564db007a914f5bf4ea548e82475e7d6aa\nparent c5bbde3e2f0f681fb8ecded09924246cf5c508da\nauthor Pietro Albini <pietro@pietroalbini.org> 1570448677 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012188 +0200\n\nci: extract switching xcode into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c0d76404939f401536271f8053dd999c5f254c9", "html_url": "https://github.com/rust-lang/rust/commit/1c0d76404939f401536271f8053dd999c5f254c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c0d76404939f401536271f8053dd999c5f254c9/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5bbde3e2f0f681fb8ecded09924246cf5c508da", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5bbde3e2f0f681fb8ecded09924246cf5c508da", "html_url": "https://github.com/rust-lang/rust/commit/c5bbde3e2f0f681fb8ecded09924246cf5c508da"}], "stats": {"total": 26, "additions": 18, "deletions": 8}, "files": [{"sha": "cfade9a6f524037d073017e0c3ad0484557d39e6", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/1c0d76404939f401536271f8053dd999c5f254c9/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/1c0d76404939f401536271f8053dd999c5f254c9/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=1c0d76404939f401536271f8053dd999c5f254c9", "patch": "@@ -63,14 +63,11 @@ steps:\n   displayName: Install clang\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n \n-# Switch to XCode 9.3 on OSX since it seems to be the last version that supports\n-# i686-apple-darwin. We'll eventually want to upgrade this and it will probably\n-# force us to drop i686-apple-darwin, but let's keep the wheels turning for now.\n-- bash: |\n-    set -e\n-    sudo xcode-select --switch /Applications/Xcode_9.3.app\n-  displayName: Switch to Xcode 9.3 (OSX)\n-  condition: and(succeeded(), eq(variables['Agent.OS'], 'Darwin'))\n+- bash: src/ci/scripts/switch-xcode.sh\n+  env:\n+    AGENT_OS: $(Agent.OS)\n+  displayName: Switch to Xcode 9.3\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n \n - template: install-windows-build-deps.yml\n "}, {"sha": "2cbb2ddbc7046ab77caf06977f76aad5e750568f", "filename": "src/ci/scripts/switch-xcode.sh", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/1c0d76404939f401536271f8053dd999c5f254c9/src%2Fci%2Fscripts%2Fswitch-xcode.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1c0d76404939f401536271f8053dd999c5f254c9/src%2Fci%2Fscripts%2Fswitch-xcode.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fswitch-xcode.sh?ref=1c0d76404939f401536271f8053dd999c5f254c9", "patch": "@@ -0,0 +1,13 @@\n+#!/bin/bash\n+# Switch to XCode 9.3 on OSX since it seems to be the last version that supports\n+# i686-apple-darwin. We'll eventually want to upgrade this and it will probably\n+# force us to drop i686-apple-darwin, but let's keep the wheels turning for now.\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+if isMacOS; then\n+    sudo xcode-select --switch /Applications/Xcode_9.3.app\n+fi"}]}