{"sha": "ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkMDU4Y2ZhZmU1ODRlMTg0ODI3NmEwNWMyYjdiNWQzZmNjOTY1ZmY=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-01-28T18:48:39Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2018-01-29T09:02:03Z"}, "message": "Make pattern visiting consistent", "tree": {"sha": "caae2149f984c27216baeab6758e74ea820113b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/caae2149f984c27216baeab6758e74ea820113b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "html_url": "https://github.com/rust-lang/rust/commit/ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad058cfafe584e1848276a05c2b7b5d3fcc965ff/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "679f30e1aac510082b0fd3a2b5465321753aa7d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/679f30e1aac510082b0fd3a2b5465321753aa7d1", "html_url": "https://github.com/rust-lang/rust/commit/679f30e1aac510082b0fd3a2b5465321753aa7d1"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "9d6b29adb0496a269f5102849bb5194ac301c6b0", "filename": "src/librustc/middle/region.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ad058cfafe584e1848276a05c2b7b5d3fcc965ff/src%2Flibrustc%2Fmiddle%2Fregion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad058cfafe584e1848276a05c2b7b5d3fcc965ff/src%2Flibrustc%2Fmiddle%2Fregion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fregion.rs?ref=ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "patch": "@@ -467,9 +467,10 @@ impl<'tcx> Visitor<'tcx> for ExprLocatorVisitor {\n     }\n \n     fn visit_pat(&mut self, pat: &'tcx Pat) {\n+        intravisit::walk_pat(self, pat);\n+\n         self.expr_and_pat_count += 1;\n \n-        intravisit::walk_pat(self, pat);\n     }\n \n     fn visit_expr(&mut self, expr: &'tcx Expr) {\n@@ -814,7 +815,8 @@ impl<'tcx> ScopeTree {\n \n     /// Checks whether the given scope contains a `yield`. If so,\n     /// returns `Some((span, expr_count))` with the span of a yield we found and\n-    /// the number of expressions appearing before the `yield` in the body.\n+    /// the number of expressions and patterns appearing before the `yield` in the body + 1.\n+    /// If there a are multiple yields in a scope, the one with the highest number is returned.\n     pub fn yield_in_scope(&self, scope: Scope) -> Option<(Span, usize)> {\n         self.yield_in_scope.get(&scope).cloned()\n     }"}, {"sha": "2e45e3b1f3521db331ef2d9fc537bbd6e0dba346", "filename": "src/librustc_typeck/check/generator_interior.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ad058cfafe584e1848276a05c2b7b5d3fcc965ff/src%2Flibrustc_typeck%2Fcheck%2Fgenerator_interior.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad058cfafe584e1848276a05c2b7b5d3fcc965ff/src%2Flibrustc_typeck%2Fcheck%2Fgenerator_interior.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fgenerator_interior.rs?ref=ad058cfafe584e1848276a05c2b7b5d3fcc965ff", "patch": "@@ -150,15 +150,15 @@ impl<'a, 'gcx, 'tcx> Visitor<'tcx> for InteriorVisitor<'a, 'gcx, 'tcx> {\n     }\n \n     fn visit_pat(&mut self, pat: &'tcx Pat) {\n+        intravisit::walk_pat(self, pat);\n+\n+        self.expr_count += 1;\n+\n         if let PatKind::Binding(..) = pat.node {\n             let scope = self.region_scope_tree.var_scope(pat.hir_id.local_id);\n             let ty = self.fcx.tables.borrow().pat_ty(pat);\n             self.record(ty, Some(scope), None, pat.span);\n         }\n-\n-        self.expr_count += 1;\n-\n-        intravisit::walk_pat(self, pat);\n     }\n \n     fn visit_expr(&mut self, expr: &'tcx Expr) {"}]}