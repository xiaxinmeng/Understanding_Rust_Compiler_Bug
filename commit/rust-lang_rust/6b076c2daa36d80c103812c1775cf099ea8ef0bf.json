{"sha": "6b076c2daa36d80c103812c1775cf099ea8ef0bf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiMDc2YzJkYWEzNmQ4MGMxMDM4MTJjMTc3NWNmMDk5ZWE4ZWYwYmY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-18T16:29:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-18T16:29:55Z"}, "message": "Auto merge of #31734 - aliclark:bsd-stat-fixes, r=alexcrichton\n\nIn https://github.com/rust-lang/rust/issues/25155 the os::freebsd::raw stat was split for the x86 vs. x86-64 cases, which appears to have been done to implement the padding on the end of struct stat for the x86 case (the struct is otherwise the same notwistanding the size of long).\n\nThis PR de-duplicates the struct using #[cfg(target_arch = \"x86\")] for the __unused field, which also fixes the definitions which had sinced changed with the LFS work d088b671872f1df6993ccca6fa6139ebed0a8cf3.\n\nAlso changed definitions to c_long for dragonfly and freebsd where appropriate.\n\nAlso removes some unused imports that the compiler was complaining about.\n\ndragonfly's long time_t:\nhttps://gitweb.dragonflybsd.org/dragonfly.git/blob/a2a57c243ff8016578bc559f8603fb25bbcf1768:/lib/libstand/machine/stdint.h\n\nfreebsd's long time_t:\nhttps://svnweb.freebsd.org/base/release/10.1.0/sys/x86/include/_types.h?view=markup\nhttps://github.com/rust-lang/rust/blob/d088b671872f1df6993ccca6fa6139ebed0a8cf3/src/liblibc/lib.rs#L980\n\nfreebsd's padding for i686 stat:\nhttps://svnweb.freebsd.org/base/release/10.1.0/sys/sys/stat.h?view=markup#l139\nhttps://github.com/rust-lang/rust/blob/d088b671872f1df6993ccca6fa6139ebed0a8cf3/src/liblibc/lib.rs#L1038", "tree": {"sha": "94e22f6e099f6784b9166b0b1629117df1a3fcca", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94e22f6e099f6784b9166b0b1629117df1a3fcca"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6b076c2daa36d80c103812c1775cf099ea8ef0bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6b076c2daa36d80c103812c1775cf099ea8ef0bf", "html_url": "https://github.com/rust-lang/rust/commit/6b076c2daa36d80c103812c1775cf099ea8ef0bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6b076c2daa36d80c103812c1775cf099ea8ef0bf/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e2a577804b32b6d203abe61e0cdf3a88837d228", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e2a577804b32b6d203abe61e0cdf3a88837d228", "html_url": "https://github.com/rust-lang/rust/commit/8e2a577804b32b6d203abe61e0cdf3a88837d228"}, {"sha": "90afb85a0c6c51a82933094f79ab0027915148c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/90afb85a0c6c51a82933094f79ab0027915148c2", "html_url": "https://github.com/rust-lang/rust/commit/90afb85a0c6c51a82933094f79ab0027915148c2"}], "stats": {"total": 194, "additions": 63, "deletions": 131}, "files": [{"sha": "83e0be0d158ec3b8747e5b99d0a7b00fcb2f2336", "filename": "src/libstd/os/dragonfly/raw.rs", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/6b076c2daa36d80c103812c1775cf099ea8ef0bf/src%2Flibstd%2Fos%2Fdragonfly%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b076c2daa36d80c103812c1775cf099ea8ef0bf/src%2Flibstd%2Fos%2Fdragonfly%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fos%2Fdragonfly%2Fraw.rs?ref=6b076c2daa36d80c103812c1775cf099ea8ef0bf", "patch": "@@ -19,7 +19,6 @@\n #![allow(deprecated)]\n \n use os::raw::c_long;\n-use os::unix::raw::{uid_t, gid_t};\n \n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blkcnt_t = u64;\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blksize_t = u64;\n@@ -52,17 +51,17 @@ pub struct stat {\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n     pub st_rdev: u32,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_atime: i64,\n+    pub st_atime: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_atime_nsec: i64,\n+    pub st_atime_nsec: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_mtime: i64,\n+    pub st_mtime: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_mtime_nsec: i64,\n+    pub st_mtime_nsec: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_ctime: i64,\n+    pub st_ctime: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_ctime_nsec: i64,\n+    pub st_ctime_nsec: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n     pub st_size: i64,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n@@ -76,7 +75,7 @@ pub struct stat {\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n     pub st_lspare: i32,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_birthtime: i64,\n+    pub st_birthtime: c_long,\n     #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub st_birthtime_nsec: i64,\n+    pub st_birthtime_nsec: c_long,\n }"}, {"sha": "989eef63d82cf27b38e2e276605a5898ad37f6c0", "filename": "src/libstd/os/freebsd/raw.rs", "status": "modified", "additions": 55, "deletions": 122, "changes": 177, "blob_url": "https://github.com/rust-lang/rust/blob/6b076c2daa36d80c103812c1775cf099ea8ef0bf/src%2Flibstd%2Fos%2Ffreebsd%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6b076c2daa36d80c103812c1775cf099ea8ef0bf/src%2Flibstd%2Fos%2Ffreebsd%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fos%2Ffreebsd%2Fraw.rs?ref=6b076c2daa36d80c103812c1775cf099ea8ef0bf", "patch": "@@ -18,134 +18,67 @@\n                               definitions\")]\n #![allow(deprecated)]\n \n-#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type off_t = u64;\n+use os::raw::c_long;\n+\n+#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blkcnt_t = u64;\n+#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blksize_t = u64;\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type dev_t = u64;\n+#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type fflags_t = u32;\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type ino_t = u64;\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type mode_t = u32;\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type nlink_t = u64;\n-#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blksize_t = u64;\n-#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type blkcnt_t = u64;\n-#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type fflags_t = u32;\n+#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type off_t = u64;\n+#[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type time_t = i64;\n \n #[unstable(feature = \"pthread_t\", issue = \"29791\")] pub type pthread_t = usize;\n \n-#[doc(inline)]\n+#[repr(C)]\n+#[derive(Clone)]\n #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-pub use self::arch::{stat, time_t};\n-\n-#[cfg(target_arch = \"x86\")]\n-mod arch {\n-    use super::{off_t, dev_t, ino_t, mode_t, nlink_t, blksize_t, blkcnt_t, fflags_t};\n-    use os::raw::c_long;\n-    use os::unix::raw::{uid_t, gid_t};\n-\n-    #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type time_t = i64;\n-\n-    #[repr(C)]\n-    #[derive(Clone)]\n-    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub struct stat {\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_dev: dev_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ino: ino_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mode: mode_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_nlink: nlink_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_uid: uid_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_gid: gid_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_rdev: dev_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_atime: time_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_atime_nsec: c_long,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mtime: time_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mtime_nsec: c_long,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ctime: time_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ctime_nsec: c_long,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_size: off_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_blocks: blkcnt_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_blksize: blksize_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_flags: fflags_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_gen: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_lspare: i32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_birthtime: time_t,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_birthtime_nsec: c_long,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub __unused: [u8; 8],\n-    }\n-}\n-\n-#[cfg(target_arch = \"x86_64\")]\n-mod arch {\n-    use super::{off_t, dev_t, ino_t, mode_t, nlink_t, blksize_t, blkcnt_t, fflags_t};\n-    use os::raw::c_long;\n-    use os::unix::raw::{uid_t, gid_t};\n-\n-    #[stable(feature = \"raw_ext\", since = \"1.1.0\")] pub type time_t = i64;\n-\n-    #[repr(C)]\n-    #[derive(Clone)]\n-    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-    pub struct stat {\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_dev: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ino: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mode: u16,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_nlink: u16,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_uid: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_gid: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_rdev: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_atime: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_atime_nsec: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mtime: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_mtime_nsec: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ctime: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_ctime_nsec: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_size: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_blocks: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_blksize: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_flags: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_gen: u32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_lspare: i32,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_birthtime: i64,\n-        #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n-        pub st_birthtime_nsec: i64,\n-    }\n+pub struct stat {\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_dev: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_ino: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_mode: u16,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_nlink: u16,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_uid: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_gid: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_rdev: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_atime: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_atime_nsec: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_mtime: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_mtime_nsec: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_ctime: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_ctime_nsec: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_size: i64,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_blocks: i64,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_blksize: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_flags: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_gen: u32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_lspare: i32,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_birthtime: c_long,\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub st_birthtime_nsec: c_long,\n+    #[cfg(target_arch = \"x86\")]\n+    #[stable(feature = \"raw_ext\", since = \"1.1.0\")]\n+    pub __unused: [u8; 8],\n }\n-"}]}