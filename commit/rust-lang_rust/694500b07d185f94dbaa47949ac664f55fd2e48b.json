{"sha": "694500b07d185f94dbaa47949ac664f55fd2e48b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5NDUwMGIwN2QxODVmOTRkYmFhNDc5NDlhYzY2NGY1NWZkMmU0OGI=", "commit": {"author": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2014-12-01T08:00:43Z"}, "committer": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2014-12-03T23:20:24Z"}, "message": "rustup: extract the tarballs as part of installation", "tree": {"sha": "d528f5e0f717c57274cf8d80d3d73e786c62d7c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d528f5e0f717c57274cf8d80d3d73e786c62d7c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/694500b07d185f94dbaa47949ac664f55fd2e48b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/694500b07d185f94dbaa47949ac664f55fd2e48b", "html_url": "https://github.com/rust-lang/rust/commit/694500b07d185f94dbaa47949ac664f55fd2e48b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/694500b07d185f94dbaa47949ac664f55fd2e48b/comments", "author": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd8dac8f758fc76ff3c4553e187eba627728cf71", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd8dac8f758fc76ff3c4553e187eba627728cf71", "html_url": "https://github.com/rust-lang/rust/commit/bd8dac8f758fc76ff3c4553e187eba627728cf71"}], "stats": {"total": 27, "additions": 16, "deletions": 11}, "files": [{"sha": "869031e03c30395762fded6d361b05827a4ebed5", "filename": "src/etc/rustup.sh", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/694500b07d185f94dbaa47949ac664f55fd2e48b/src%2Fetc%2Frustup.sh", "raw_url": "https://github.com/rust-lang/rust/raw/694500b07d185f94dbaa47949ac664f55fd2e48b/src%2Fetc%2Frustup.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Frustup.sh?ref=694500b07d185f94dbaa47949ac664f55fd2e48b", "patch": "@@ -416,8 +416,8 @@ CARGO_TARBALL_NAME=\"${CARGO_PACKAGE_NAME_AND_TRIPLE}.tar.gz\"\n CARGO_LOCAL_INSTALL_DIR=\"${CFG_TMP_DIR}/${CARGO_PACKAGE_NAME_AND_TRIPLE}\"\n CARGO_LOCAL_INSTALL_SCRIPT=\"${CARGO_LOCAL_INSTALL_DIR}/install.sh\"\n \n-# Fetch the package and extract it.\n-download_and_extract_package() {\n+# Fetch the package.\n+download_package() {\n     remote_url=\"$1\"\n     tarball_name=\"$2\"\n     remote_tarball=\"${remote_url}/${tarball_name}\"\n@@ -434,18 +434,19 @@ download_and_extract_package() {\n         rm -Rf \"${CFG_TMP_DIR}\"\n         err \"failed to download installer\"\n     fi\n+}\n+\n+# Wrap all the commands needed to install a package.\n+install_package() {\n+    tarball_name=\"$1\"\n+    install_script=\"$2\"\n \n     msg \"Extracting ${tarball_name}\"\n     (cd \"${CFG_TMP_DIR}\" && \"${CFG_TAR}\" -xvf \"${tarball_name}\")\n     if [ $? -ne 0 ]; then\n         rm -Rf \"${CFG_TMP_DIR}\"\n         err \"failed to unpack installer\"\n     fi\n-}\n-\n-# Wrap all the commands needed to install a package.\n-install_package() {\n-    install_script=\"$1\"\n \n     sh \"${install_script}\" \"${CFG_INSTALL_FLAGS}\"\n     if [ $? -ne 0 ]\n@@ -468,20 +469,24 @@ install_packages() {\n     mkdir -p \"${CFG_TMP_DIR}\"\n     need_ok \"failed to create create temporary installation directory\"\n \n-    download_and_extract_package \\\n+    download_package \\\n         \"${RUST_URL}\" \\\n         \"${RUST_TARBALL_NAME}\"\n \n     if [ -z \"${CFG_DISABLE_CARGO}\" ]; then\n-        download_and_extract_package \\\n+        download_package \\\n             \"${CARGO_URL}\" \\\n             \"${CARGO_TARBALL_NAME}\"\n     fi\n \n-    install_package \"${RUST_LOCAL_INSTALL_SCRIPT}\"\n+    install_package \\\n+        \"${RUST_TARBALL_NAME}\" \\\n+        \"${RUST_LOCAL_INSTALL_SCRIPT}\"\n \n     if [ -z \"${CFG_DISABLE_CARGO}\" ]; then\n-        install_package \"${CARGO_LOCAL_INSTALL_SCRIPT}\"\n+        install_package \\\n+            \"${CARGO_TARBALL_NAME}\" \\\n+            \"${CARGO_LOCAL_INSTALL_SCRIPT}\"\n     fi\n \n     rm -Rf \"${CFG_TMP_DIR}\""}]}