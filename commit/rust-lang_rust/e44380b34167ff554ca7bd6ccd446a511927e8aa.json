{"sha": "e44380b34167ff554ca7bd6ccd446a511927e8aa", "node_id": "C_kwDOAAsO6NoAKGU0NDM4MGIzNDE2N2ZmNTU0Y2E3YmQ2Y2NkNDQ2YTUxMTkyN2U4YWE", "commit": {"author": {"name": "Yacin Tmimi", "email": "yacintmimi@gmail.com", "date": "2022-06-13T15:36:20Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2022-06-16T01:06:04Z"}, "message": "Version gate raw identifier use statement sorting\n\nWhen useing `version=One` rustfmt will treat the leading `r#` as part of\nthe `UseSegment` used for sorting. When using `version=Two` rustfmt will\nignore the leading `r#` and only consider the name of the identifier\nwhen sorting the `UseSegment`.", "tree": {"sha": "991a26365bec63247bcd00f3f55239d40068656c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/991a26365bec63247bcd00f3f55239d40068656c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e44380b34167ff554ca7bd6ccd446a511927e8aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e44380b34167ff554ca7bd6ccd446a511927e8aa", "html_url": "https://github.com/rust-lang/rust/commit/e44380b34167ff554ca7bd6ccd446a511927e8aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e44380b34167ff554ca7bd6ccd446a511927e8aa/comments", "author": {"login": "ytmimi", "id": 29028348, "node_id": "MDQ6VXNlcjI5MDI4MzQ4", "avatar_url": "https://avatars.githubusercontent.com/u/29028348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ytmimi", "html_url": "https://github.com/ytmimi", "followers_url": "https://api.github.com/users/ytmimi/followers", "following_url": "https://api.github.com/users/ytmimi/following{/other_user}", "gists_url": "https://api.github.com/users/ytmimi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ytmimi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ytmimi/subscriptions", "organizations_url": "https://api.github.com/users/ytmimi/orgs", "repos_url": "https://api.github.com/users/ytmimi/repos", "events_url": "https://api.github.com/users/ytmimi/events{/privacy}", "received_events_url": "https://api.github.com/users/ytmimi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "795efb206892041e81107cc58797ea61fd1c7b16", "url": "https://api.github.com/repos/rust-lang/rust/commits/795efb206892041e81107cc58797ea61fd1c7b16", "html_url": "https://github.com/rust-lang/rust/commit/795efb206892041e81107cc58797ea61fd1c7b16"}], "stats": {"total": 40, "additions": 33, "deletions": 7}, "files": [{"sha": "8d41c881589e5564c97fd3220a4c72b1ff0b63d0", "filename": "src/imports.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/e44380b34167ff554ca7bd6ccd446a511927e8aa/src%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e44380b34167ff554ca7bd6ccd446a511927e8aa/src%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fimports.rs?ref=e44380b34167ff554ca7bd6ccd446a511927e8aa", "patch": "@@ -890,14 +890,21 @@ impl Ord for UseSegment {\n             | (Super(ref a), Super(ref b))\n             | (Crate(ref a), Crate(ref b)) => match (a, b) {\n                 (Some(sa), Some(sb)) => {\n-                    sa.trim_start_matches(\"r#\").cmp(sb.trim_start_matches(\"r#\"))\n+                    if self.version == Version::Two {\n+                        sa.trim_start_matches(\"r#\").cmp(sb.trim_start_matches(\"r#\"))\n+                    } else {\n+                        a.cmp(b)\n+                    }\n                 }\n                 (_, _) => a.cmp(b),\n             },\n             (Glob, Glob) => Ordering::Equal,\n             (Ident(ref pia, ref aa), Ident(ref pib, ref ab)) => {\n-                let ia = pia.trim_start_matches(\"r#\");\n-                let ib = pib.trim_start_matches(\"r#\");\n+                let (ia, ib) = if self.version == Version::Two {\n+                    (pia.trim_start_matches(\"r#\"), pib.trim_start_matches(\"r#\"))\n+                } else {\n+                    (pia.as_str(), pib.as_str())\n+                };\n                 // snake_case < CamelCase < UPPER_SNAKE_CASE\n                 if ia.starts_with(char::is_uppercase) && ib.starts_with(char::is_lowercase) {\n                     return Ordering::Greater;\n@@ -918,9 +925,14 @@ impl Ord for UseSegment {\n                 match (aa, ab) {\n                     (None, Some(_)) => Ordering::Less,\n                     (Some(_), None) => Ordering::Greater,\n-                    (Some(aas), Some(abs)) => aas\n-                        .trim_start_matches(\"r#\")\n-                        .cmp(abs.trim_start_matches(\"r#\")),\n+                    (Some(aas), Some(abs)) => {\n+                        if self.version == Version::Two {\n+                            aas.trim_start_matches(\"r#\")\n+                                .cmp(abs.trim_start_matches(\"r#\"))\n+                        } else {\n+                            aas.cmp(abs)\n+                        }\n+                    }\n                     (None, None) => Ordering::Equal,\n                 }\n             }"}, {"sha": "bc4b5b135696a9791f8e1cef8b4853496e55f008", "filename": "tests/source/imports_raw_identifiers/version_One.rs", "status": "renamed", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_One.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_One.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_One.rs?ref=e44380b34167ff554ca7bd6ccd446a511927e8aa", "patch": "@@ -1,3 +1,5 @@\n+// rustfmt-version:One\n+\n use websocket::client::ClientBuilder;\n use websocket::r#async::futures::Stream;\n use websocket::result::WebSocketError;", "previous_filename": "tests/source/imports_raw_identifiers.rs"}, {"sha": "88e7fbd01ca6e5b9b0c750bab1a47c1b0566a921", "filename": "tests/source/imports_raw_identifiers/version_Two.rs", "status": "renamed", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_Two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_Two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fimports_raw_identifiers%2Fversion_Two.rs?ref=e44380b34167ff554ca7bd6ccd446a511927e8aa", "patch": "@@ -1,3 +1,5 @@\n-use websocket::r#async::futures::Stream;\n+// rustfmt-version:Two\n+\n use websocket::client::ClientBuilder;\n+use websocket::r#async::futures::Stream;\n use websocket::result::WebSocketError;", "previous_filename": "tests/target/imports_raw_identifiers.rs"}, {"sha": "bc4b5b135696a9791f8e1cef8b4853496e55f008", "filename": "tests/target/imports_raw_identifiers/version_One.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_One.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_One.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_One.rs?ref=e44380b34167ff554ca7bd6ccd446a511927e8aa", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-version:One\n+\n+use websocket::client::ClientBuilder;\n+use websocket::r#async::futures::Stream;\n+use websocket::result::WebSocketError;"}, {"sha": "22bfe93122f95aa383c9fd6dab7d4ea1f9247bcb", "filename": "tests/target/imports_raw_identifiers/version_Two.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_Two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e44380b34167ff554ca7bd6ccd446a511927e8aa/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_Two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fimports_raw_identifiers%2Fversion_Two.rs?ref=e44380b34167ff554ca7bd6ccd446a511927e8aa", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-version:Two\n+\n+use websocket::r#async::futures::Stream;\n+use websocket::client::ClientBuilder;\n+use websocket::result::WebSocketError;"}]}