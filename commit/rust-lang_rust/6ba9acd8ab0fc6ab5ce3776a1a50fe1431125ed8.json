{"sha": "6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZiYTlhY2Q4YWIwZmM2YWI1Y2UzNzc2YTFhNTBmZTE0MzExMjVlZDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-13T11:56:31Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-13T11:56:31Z"}, "message": "auto merge of #20963 : nick29581/rust/ast_map, r=eddyb", "tree": {"sha": "a79006c38fe75a55ac81a5b5c7e0b5eb100c998f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a79006c38fe75a55ac81a5b5c7e0b5eb100c998f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "html_url": "https://github.com/rust-lang/rust/commit/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1241f14dc8f5e708e258a46950e8c7635efe6c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1241f14dc8f5e708e258a46950e8c7635efe6c7", "html_url": "https://github.com/rust-lang/rust/commit/f1241f14dc8f5e708e258a46950e8c7635efe6c7"}, {"sha": "bc3a330abbede28a9ec14cd138b1c0e4ef79cbb0", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc3a330abbede28a9ec14cd138b1c0e4ef79cbb0", "html_url": "https://github.com/rust-lang/rust/commit/bc3a330abbede28a9ec14cd138b1c0e4ef79cbb0"}], "stats": {"total": 44, "additions": 40, "deletions": 4}, "files": [{"sha": "193b14174c7abc3890e14ead41568ca871491ce6", "filename": "src/librustc/metadata/filesearch.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Ffilesearch.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -54,7 +54,7 @@ impl<'a> FileSearch<'a> {\n \n         debug!(\"filesearch: searching lib path\");\n         let tlib_path = make_target_lib_path(self.sysroot,\n-                                    self.triple);\n+                                             self.triple);\n         if !visited_dirs.contains(tlib_path.as_vec()) {\n             match f(&tlib_path) {\n                 FileMatches => found = true,"}, {"sha": "0cd501ca05fcdf4ec1792e7a93e7f19401b110df", "filename": "src/librustc/session/search_paths.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc%2Fsession%2Fsearch_paths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc%2Fsession%2Fsearch_paths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fsearch_paths.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -10,7 +10,7 @@\n \n use std::slice;\n \n-#[derive(Clone)]\n+#[derive(Clone, Show)]\n pub struct SearchPaths {\n     paths: Vec<(PathKind, Path)>,\n }\n@@ -20,7 +20,7 @@ pub struct Iter<'a> {\n     iter: slice::Iter<'a, (PathKind, Path)>,\n }\n \n-#[derive(Eq, PartialEq, Clone, Copy)]\n+#[derive(Eq, PartialEq, Clone, Copy, Show)]\n pub enum PathKind {\n     Native,\n     Crate,"}, {"sha": "6893c4d72f7ded94ec5461abea8a107babd8a66c", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -186,7 +186,7 @@ fn run_compiler(args: &[String]) {\n                 list_metadata(&sess, &(*ifile), &mut stdout).unwrap();\n             }\n             Input::Str(_) => {\n-                early_error(\"can not list metadata for stdin\");\n+                early_error(\"cannot list metadata for stdin\");\n             }\n         }\n         return;"}, {"sha": "f52e7c0ec94c09122aef2551bffbeff53cdfe72e", "filename": "src/librustc_trans/trans/monomorphize.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmonomorphize.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -274,6 +274,7 @@ pub fn monomorphic_fn<'a, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n         ast_map::NodeArg(..) |\n         ast_map::NodeBlock(..) |\n         ast_map::NodePat(..) |\n+        ast_map::NodeViewItem(..) |\n         ast_map::NodeLocal(..) => {\n             ccx.sess().bug(&format!(\"can't monomorphize a {:?}\",\n                                    map_node)[])"}, {"sha": "c2cfa484aff3f2b51d5077ed14717b0a9ac52dfd", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -1528,6 +1528,19 @@ pub struct ViewItem {\n     pub span: Span,\n }\n \n+impl ViewItem {\n+    pub fn id(&self) -> NodeId {\n+        match self.node {\n+            ViewItemExternCrate(_, _, id) => id,\n+            ViewItemUse(ref vp) => match vp.node {\n+                ViewPathSimple(_, _, id) => id,\n+                ViewPathGlob(_, id) => id,\n+                ViewPathList(_, _, id) => id,\n+            }\n+        }\n+    }\n+}\n+\n #[derive(Clone, PartialEq, Eq, RustcEncodable, RustcDecodable, Hash, Show)]\n pub enum ViewItem_ {\n     /// Ident: name used to refer to this crate in the code"}, {"sha": "f851e468e8841945160a7a761da476a83153d662", "filename": "src/libsyntax/ast_map/mod.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibsyntax%2Fast_map%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8/src%2Flibsyntax%2Fast_map%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast_map%2Fmod.rs?ref=6ba9acd8ab0fc6ab5ce3776a1a50fe1431125ed8", "patch": "@@ -107,6 +107,7 @@ pub fn path_to_string<PI: Iterator<Item=PathElem>>(path: PI) -> String {\n #[derive(Copy, Show)]\n pub enum Node<'ast> {\n     NodeItem(&'ast Item),\n+    NodeViewItem(&'ast ViewItem),\n     NodeForeignItem(&'ast ForeignItem),\n     NodeTraitItem(&'ast TraitItem),\n     NodeImplItem(&'ast ImplItem),\n@@ -133,6 +134,7 @@ enum MapEntry<'ast> {\n \n     /// All the node types, with a parent ID.\n     EntryItem(NodeId, &'ast Item),\n+    EntryViewItem(NodeId, &'ast ViewItem),\n     EntryForeignItem(NodeId, &'ast ForeignItem),\n     EntryTraitItem(NodeId, &'ast TraitItem),\n     EntryImplItem(NodeId, &'ast ImplItem),\n@@ -167,6 +169,7 @@ impl<'ast> MapEntry<'ast> {\n     fn from_node(p: NodeId, node: Node<'ast>) -> MapEntry<'ast> {\n         match node {\n             NodeItem(n) => EntryItem(p, n),\n+            NodeViewItem(n) => EntryViewItem(p, n),\n             NodeForeignItem(n) => EntryForeignItem(p, n),\n             NodeTraitItem(n) => EntryTraitItem(p, n),\n             NodeImplItem(n) => EntryImplItem(p, n),\n@@ -185,6 +188,7 @@ impl<'ast> MapEntry<'ast> {\n     fn parent(self) -> Option<NodeId> {\n         Some(match self {\n             EntryItem(id, _) => id,\n+            EntryViewItem(id, _) => id,\n             EntryForeignItem(id, _) => id,\n             EntryTraitItem(id, _) => id,\n             EntryImplItem(id, _) => id,\n@@ -204,6 +208,7 @@ impl<'ast> MapEntry<'ast> {\n     fn to_node(self) -> Option<Node<'ast>> {\n         Some(match self {\n             EntryItem(_, n) => NodeItem(n),\n+            EntryViewItem(_, n) => NodeViewItem(n),\n             EntryForeignItem(_, n) => NodeForeignItem(n),\n             EntryTraitItem(_, n) => NodeTraitItem(n),\n             EntryImplItem(_, n) => NodeImplItem(n),\n@@ -336,6 +341,13 @@ impl<'ast> Map<'ast> {\n         }\n     }\n \n+    pub fn expect_view_item(&self, id: NodeId) -> &'ast ViewItem {\n+        match self.find(id) {\n+            Some(NodeViewItem(view_item)) => view_item,\n+            _ => panic!(\"expected view item, found {}\", self.node_to_string(id))\n+        }\n+    }\n+\n     pub fn expect_struct(&self, id: NodeId) -> &'ast StructDef {\n         match self.find(id) {\n             Some(NodeItem(i)) => {\n@@ -521,6 +533,7 @@ impl<'ast> Map<'ast> {\n     pub fn opt_span(&self, id: NodeId) -> Option<Span> {\n         let sp = match self.find(id) {\n             Some(NodeItem(item)) => item.span,\n+            Some(NodeViewItem(item)) => item.span,\n             Some(NodeForeignItem(foreign_item)) => foreign_item.span,\n             Some(NodeTraitItem(trait_method)) => {\n                 match *trait_method {\n@@ -813,6 +826,11 @@ impl<'ast> Visitor<'ast> for NodeCollector<'ast> {\n         self.parent = parent;\n     }\n \n+    fn visit_view_item(&mut self, item: &'ast ViewItem) {\n+        self.insert(item.id(), NodeViewItem(item));\n+        visit::walk_view_item(self, item);\n+    }\n+\n     fn visit_pat(&mut self, pat: &'ast Pat) {\n         self.insert(pat.id, match pat.node {\n             // Note: this is at least *potentially* a pattern...\n@@ -1018,6 +1036,7 @@ impl<'a> NodePrinter for pprust::State<'a> {\n     fn print_node(&mut self, node: &Node) -> IoResult<()> {\n         match *node {\n             NodeItem(a)        => self.print_item(&*a),\n+            NodeViewItem(a)    => self.print_view_item(&*a),\n             NodeForeignItem(a) => self.print_foreign_item(&*a),\n             NodeTraitItem(a)   => self.print_trait_method(&*a),\n             NodeImplItem(a)    => self.print_impl_item(&*a),\n@@ -1060,6 +1079,9 @@ fn node_id_to_string(map: &Map, id: NodeId, include_id: bool) -> String {\n             };\n             format!(\"{} {}{}\", item_str, path_str, id_str)\n         }\n+        Some(NodeViewItem(item)) => {\n+            format!(\"view item {}{}\", pprust::view_item_to_string(&*item), id_str)\n+        }\n         Some(NodeForeignItem(item)) => {\n             let path_str = map.path_to_str_with_ident(id, item.ident);\n             format!(\"foreign item {}{}\", path_str, id_str)"}]}