{"sha": "6656e5cd45e00b1707badbfb188aafd03eb7ab72", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2NTZlNWNkNDVlMDBiMTcwN2JhZGJmYjE4OGFhZmQwM2ViN2FiNzI=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2014-02-19T16:11:36Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2014-02-19T16:12:37Z"}, "message": "debuginfo: Fix a RUSTFLAGS incompatibility in test runner.", "tree": {"sha": "ef93310410907b49cf997001199d6536c214682b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef93310410907b49cf997001199d6536c214682b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6656e5cd45e00b1707badbfb188aafd03eb7ab72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6656e5cd45e00b1707badbfb188aafd03eb7ab72", "html_url": "https://github.com/rust-lang/rust/commit/6656e5cd45e00b1707badbfb188aafd03eb7ab72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6656e5cd45e00b1707badbfb188aafd03eb7ab72/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ce04dc71957d013b668f0b9cad9d40332daa1e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce04dc71957d013b668f0b9cad9d40332daa1e8", "html_url": "https://github.com/rust-lang/rust/commit/3ce04dc71957d013b668f0b9cad9d40332daa1e8"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "abb0ea5a55731802ad4d7cf281ca79674e7a88a2", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/6656e5cd45e00b1707badbfb188aafd03eb7ab72/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6656e5cd45e00b1707badbfb188aafd03eb7ab72/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=6656e5cd45e00b1707badbfb188aafd03eb7ab72", "patch": "@@ -258,15 +258,12 @@ actual:\\n\\\n }\n \n fn run_debuginfo_test(config: &config, props: &TestProps, testfile: &Path) {\n-\n-    // do not optimize debuginfo tests\n-    let mut config = match config.target_rustcflags {\n-        Some(ref flags) => config {\n-            target_rustcflags: Some(flags.replace(\"-O\", \"\")),\n-            .. (*config).clone()\n-        },\n-        None => (*config).clone()\n+    let mut config = config {\n+        target_rustcflags: cleanup_debug_info_options(&config.target_rustcflags),\n+        host_rustcflags: cleanup_debug_info_options(&config.host_rustcflags),\n+        .. config.clone()\n     };\n+\n     let config = &mut config;\n     let check_lines = &props.check_lines;\n     let mut cmds = props.debugger_cmds.connect(\"\\n\");\n@@ -436,6 +433,20 @@ fn run_debuginfo_test(config: &config, props: &TestProps, testfile: &Path) {\n                                   check_lines[i]), &ProcRes);\n         }\n     }\n+\n+    fn cleanup_debug_info_options(options: &Option<~str>) -> Option<~str> {\n+        if options.is_none() {\n+            return None;\n+        }\n+\n+        // Remove options that are either unwanted (-O) or may lead to duplicates due to RUSTFLAGS.\n+        let options_to_remove = [~\"-O\", ~\"-g\", ~\"--debuginfo\"];\n+        let new_options = split_maybe_args(options).move_iter()\n+                                                   .filter(|x| !options_to_remove.contains(x))\n+                                                   .to_owned_vec()\n+                                                   .connect(\" \");\n+        Some(new_options)\n+    }\n }\n \n fn check_error_patterns(props: &TestProps,"}]}