{"sha": "c670a15345467ad394df850bd3b81f76ca7e8cd3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2NzBhMTUzNDU0NjdhZDM5NGRmODUwYmQzYjgxZjc2Y2E3ZThjZDM=", "commit": {"author": {"name": "Vincent Rouill\u00e9", "email": "vincent@speedy37.fr", "date": "2019-12-30T16:07:23Z"}, "committer": {"name": "Vincent Rouill\u00e9", "email": "vincent@speedy37.fr", "date": "2019-12-30T16:09:07Z"}, "message": "Details about macro NestingState hit and at_end fields", "tree": {"sha": "a551ec9faf51258861d3b04e3f7d33a80304ce22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a551ec9faf51258861d3b04e3f7d33a80304ce22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c670a15345467ad394df850bd3b81f76ca7e8cd3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZNskgiIpwnvIy0J//KUTNzQDuFEFAl4KISMACgkQ/KUTNzQD\nuFFKlQ/+JfAPmqJXL15tuEU9NBtY9avzi6KtdFcHd+VfS54pORxpiR/MMM3Wwwk+\nqDDc0DgEVFowz02Nxsxjp1pz7qrh/GJm1A/P2rtJaka4lbyBhctZ8ZK7fswcm3eK\ngPjDxYoEphQMLOg/uWjDdwZi4z0TM3LDQ9Rf+j/OaC46h/cn89PBZ+efXRGEitij\njehQL3WZryPA2LqdvXpA8JMR+MY4RoaTf57b4pX65Lh4euJlLH1EflS96YN1uoU8\njGY1HNVjxWSM1i+Abufqi/KucvmviW6fIkpMO4590HKISb4yS1zkZqYukG7y/pN9\nDj2TlH667ti402pc9kQkw2SOBbNvnQjnQ/US0GQj175KF/d6IfHkY5nhfP/rSGji\nnbh9OjTnSVfruQu7dUjleW/6wS4YBKNrVuYWB4HYvMi9I/lyb+rYyn+1aC/s8V+f\nkdaBZeH36t3Wa9f5c8xOYRapuI69faVPxtqm84PDBR+BfQYVyROfzTxzQjQZehps\nbeqMhoKlBvvYKI0/3D+/Tq55AXd0/xzEXUBNklLPcAYNbFBKr9wyTG/kMvVRHZlu\nmfFqbxpeAXQWoBVgtp0loHoTvfEVn0EQ7IVF0ZNdlGqhB6d9Jcnj41qKb3CEpnVV\ninIX3DcIH+HcZjLxgquiEik3ZqyW/Y4fvAEIFNO0hiLElHJsKak=\n=7kj9\n-----END PGP SIGNATURE-----", "payload": "tree a551ec9faf51258861d3b04e3f7d33a80304ce22\nparent 6d84dee4e7d70f329df71365f98b2421652b2432\nauthor Vincent Rouill\u00e9 <vincent@speedy37.fr> 1577722043 +0100\ncommitter Vincent Rouill\u00e9 <vincent@speedy37.fr> 1577722147 +0100\n\nDetails about macro NestingState hit and at_end fields\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c670a15345467ad394df850bd3b81f76ca7e8cd3", "html_url": "https://github.com/rust-lang/rust/commit/c670a15345467ad394df850bd3b81f76ca7e8cd3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c670a15345467ad394df850bd3b81f76ca7e8cd3/comments", "author": {"login": "Speedy37", "id": 5376197, "node_id": "MDQ6VXNlcjUzNzYxOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5376197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Speedy37", "html_url": "https://github.com/Speedy37", "followers_url": "https://api.github.com/users/Speedy37/followers", "following_url": "https://api.github.com/users/Speedy37/following{/other_user}", "gists_url": "https://api.github.com/users/Speedy37/gists{/gist_id}", "starred_url": "https://api.github.com/users/Speedy37/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Speedy37/subscriptions", "organizations_url": "https://api.github.com/users/Speedy37/orgs", "repos_url": "https://api.github.com/users/Speedy37/repos", "events_url": "https://api.github.com/users/Speedy37/events{/privacy}", "received_events_url": "https://api.github.com/users/Speedy37/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Speedy37", "id": 5376197, "node_id": "MDQ6VXNlcjUzNzYxOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5376197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Speedy37", "html_url": "https://github.com/Speedy37", "followers_url": "https://api.github.com/users/Speedy37/followers", "following_url": "https://api.github.com/users/Speedy37/following{/other_user}", "gists_url": "https://api.github.com/users/Speedy37/gists{/gist_id}", "starred_url": "https://api.github.com/users/Speedy37/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Speedy37/subscriptions", "organizations_url": "https://api.github.com/users/Speedy37/orgs", "repos_url": "https://api.github.com/users/Speedy37/repos", "events_url": "https://api.github.com/users/Speedy37/events{/privacy}", "received_events_url": "https://api.github.com/users/Speedy37/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d84dee4e7d70f329df71365f98b2421652b2432", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d84dee4e7d70f329df71365f98b2421652b2432", "html_url": "https://github.com/rust-lang/rust/commit/6d84dee4e7d70f329df71365f98b2421652b2432"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "7662020f36dcd5c75739a1a4c1219a6796ce6947", "filename": "crates/ra_mbe/src/mbe_expander/transcriber.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c670a15345467ad394df850bd3b81f76ca7e8cd3/crates%2Fra_mbe%2Fsrc%2Fmbe_expander%2Ftranscriber.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c670a15345467ad394df850bd3b81f76ca7e8cd3/crates%2Fra_mbe%2Fsrc%2Fmbe_expander%2Ftranscriber.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fmbe_expander%2Ftranscriber.rs?ref=c670a15345467ad394df850bd3b81f76ca7e8cd3", "patch": "@@ -18,16 +18,16 @@ impl Bindings {\n         let mut b = self.inner.get(name).ok_or_else(|| {\n             ExpandError::BindingError(format!(\"could not find binding `{}`\", name))\n         })?;\n-        for s in nesting.iter_mut() {\n-            s.hit = true;\n+        for nesting_state in nesting.iter_mut() {\n+            nesting_state.hit = true;\n             b = match b {\n                 Binding::Fragment(_) => break,\n-                Binding::Nested(bs) => bs.get(s.idx).ok_or_else(|| {\n-                    s.at_end = true;\n+                Binding::Nested(bs) => bs.get(nesting_state.idx).ok_or_else(|| {\n+                    nesting_state.at_end = true;\n                     ExpandError::BindingError(format!(\"could not find nested binding `{}`\", name))\n                 })?,\n                 Binding::Empty => {\n-                    s.at_end = true;\n+                    nesting_state.at_end = true;\n                     return Err(ExpandError::BindingError(format!(\n                         \"could not find empty binding `{}`\",\n                         name\n@@ -61,7 +61,11 @@ pub(super) fn transcribe(\n #[derive(Debug)]\n struct NestingState {\n     idx: usize,\n+    /// `hit` is currently necessary to tell `expand_repeat` if it should stop\n+    /// because there is no variable in use by the current repetition\n     hit: bool,\n+    /// `at_end` is currently necessary to tell `expand_repeat` if it should stop\n+    /// because there is no more value avaible for the current repetition\n     at_end: bool,\n }\n \n@@ -130,8 +134,7 @@ fn expand_var(ctx: &mut ExpandCtx, v: &SmolStr) -> Result<Fragment, ExpandError>\n         .into();\n         Fragment::Tokens(tt)\n     } else {\n-        let fragment = ctx.bindings.get(&v, &mut ctx.nesting)?.clone();\n-        fragment\n+        ctx.bindings.get(&v, &mut ctx.nesting)?.clone()\n     };\n     Ok(res)\n }"}]}