{"sha": "7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "node_id": "C_kwDOAAsO6NoAKDdiOGUyYTUyZmYyOWQ0MDBiNGQ4NjlmYWQxZDkxN2ZmYTliZGNlNTk", "commit": {"author": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-08-24T05:02:37Z"}, "committer": {"name": "Joshua Nelson", "email": "jnelson@cloudflare.com", "date": "2022-08-24T05:37:49Z"}, "message": "Simplify the syntax for macros generated by `rustc_queries`\n\n- Disallow multiple macros callbacks in the same invocation. In practice, this was never used.\n- Remove the `[]` brackets around the macro name\n- Require an `ident`, not an arbitrary `tt`", "tree": {"sha": "636f16eae4d3f7948678fcf7449770f8e23e6588", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/636f16eae4d3f7948678fcf7449770f8e23e6588"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "html_url": "https://github.com/rust-lang/rust/commit/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e188868014da60bc266024e60c914b532445c743", "url": "https://api.github.com/repos/rust-lang/rust/commits/e188868014da60bc266024e60c914b532445c743", "html_url": "https://github.com/rust-lang/rust/commit/e188868014da60bc266024e60c914b532445c743"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "d80d35cb1fa322d09c5ac1ac3a42c404d1b29631", "filename": "compiler/rustc_macros/src/query.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_macros%2Fsrc%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_macros%2Fsrc%2Fquery.rs?ref=7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "patch": "@@ -400,15 +400,15 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n     TokenStream::from(quote! {\n         #[macro_export]\n         macro_rules! rustc_query_append {\n-            ([$($macro:tt)*]) => {\n-                $($macro)* {\n+            ($macro:ident !) => {\n+                $macro! {\n                     #query_stream\n                 }\n             }\n         }\n         macro_rules! rustc_dep_node_append {\n-            ([$($macro:tt)*][$($other:tt)*]) => {\n-                $($macro)*(\n+            ($macro:ident! [$($other:tt)*]) => {\n+                $macro!(\n                     $($other)*\n \n                     #dep_node_def_stream\n@@ -417,8 +417,8 @@ pub fn rustc_queries(input: TokenStream) -> TokenStream {\n         }\n         #[macro_export]\n         macro_rules! rustc_cached_queries {\n-            ($($macro:tt)*) => {\n-                $($macro)*(#cached_queries);\n+            ( $macro:ident! ) => {\n+                $macro!(#cached_queries);\n             }\n         }\n         #[macro_export]"}, {"sha": "65fc8a2e9cf5a4413e309a96726c9ea85126aae2", "filename": "compiler/rustc_middle/src/dep_graph/dep_node.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fdep_graph%2Fdep_node.rs?ref=7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "patch": "@@ -179,7 +179,7 @@ macro_rules! define_dep_nodes {\n     );\n }\n \n-rustc_dep_node_append!([define_dep_nodes!][\n+rustc_dep_node_append!(define_dep_nodes![\n     // We use this for most things when incr. comp. is turned off.\n     [] Null,\n "}, {"sha": "5665bb866d46c68218d2cf9a09f7fd6a99d184d4", "filename": "compiler/rustc_middle/src/ty/query.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fquery.rs?ref=7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "patch": "@@ -332,7 +332,7 @@ macro_rules! define_callbacks {\n // Queries marked with `fatal_cycle` do not need the latter implementation,\n // as they will raise an fatal error on query cycles instead.\n \n-rustc_query_append! { [define_callbacks!] }\n+rustc_query_append! { define_callbacks! }\n \n mod sealed {\n     use super::{DefId, LocalDefId};"}, {"sha": "8ea09880694eab7e4f57dbd735cf6d56322d0080", "filename": "compiler/rustc_query_impl/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Flib.rs?ref=7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "patch": "@@ -54,7 +54,7 @@ fn describe_as_module(def_id: LocalDefId, tcx: TyCtxt<'_>) -> String {\n     }\n }\n \n-rustc_query_append! { [define_queries!] }\n+rustc_query_append! { define_queries! }\n \n impl<'tcx> Queries<'tcx> {\n     // Force codegen in the dyn-trait transformation in this crate."}, {"sha": "260af0d54081560e6c35e9fff98d248f862bb422", "filename": "compiler/rustc_query_impl/src/profiling_support.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b8e2a52ff29d400b4d869fad1d917ffa9bdce59/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Fprofiling_support.rs?ref=7b8e2a52ff29d400b4d869fad1d917ffa9bdce59", "patch": "@@ -320,5 +320,5 @@ pub fn alloc_self_profile_query_strings(tcx: TyCtxt<'_>) {\n         }\n     }\n \n-    rustc_query_append! { [alloc_once!] }\n+    rustc_query_append! { alloc_once! }\n }"}]}