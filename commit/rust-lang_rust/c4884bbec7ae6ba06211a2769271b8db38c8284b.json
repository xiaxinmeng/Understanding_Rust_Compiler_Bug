{"sha": "c4884bbec7ae6ba06211a2769271b8db38c8284b", "node_id": "C_kwDOAAsO6NoAKGM0ODg0YmJlYzdhZTZiYTA2MjExYTI3NjkyNzFiOGRiMzhjODI4NGI", "commit": {"author": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2021-10-21T11:18:59Z"}, "committer": {"name": "Josh Triplett", "email": "josh@joshtriplett.org", "date": "2021-11-15T09:18:30Z"}, "message": "Support having -Z and -C options with the same name\n\nTweak the `options!` macro to allow for -Z and -C options with the same\nname without generating conflicting internal parsing functions.\n\nSplit out of the commit stabilizing -Z strip as -C strip.", "tree": {"sha": "60fc33d82fdc73ef2fe7eb9854c463daab769ef2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60fc33d82fdc73ef2fe7eb9854c463daab769ef2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4884bbec7ae6ba06211a2769271b8db38c8284b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4884bbec7ae6ba06211a2769271b8db38c8284b", "html_url": "https://github.com/rust-lang/rust/commit/c4884bbec7ae6ba06211a2769271b8db38c8284b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4884bbec7ae6ba06211a2769271b8db38c8284b/comments", "author": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42054811104bb005ded241ea8846ba7383921c46", "url": "https://api.github.com/repos/rust-lang/rust/commits/42054811104bb005ded241ea8846ba7383921c46", "html_url": "https://github.com/rust-lang/rust/commit/42054811104bb005ded241ea8846ba7383921c46"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8b9ec5028d13c20f1263de3c2a7e8ce9e1a5f742", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c4884bbec7ae6ba06211a2769271b8db38c8284b/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4884bbec7ae6ba06211a2769271b8db38c8284b/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=c4884bbec7ae6ba06211a2769271b8db38c8284b", "patch": "@@ -219,7 +219,7 @@ top_level_options!(\n /// generated code to parse an option into its respective field in the struct. There are a few\n /// hand-written parsers for parsing specific types of values in this module.\n macro_rules! options {\n-    ($struct_name:ident, $stat:ident, $prefix:expr, $outputname:expr,\n+    ($struct_name:ident, $stat:ident, $optmod:ident, $prefix:expr, $outputname:expr,\n      $($( #[$attr:meta] )* $opt:ident : $t:ty = (\n         $init:expr,\n         $parse:ident,\n@@ -264,13 +264,15 @@ macro_rules! options {\n     }\n \n     pub const $stat: OptionDescrs<$struct_name> =\n-        &[ $( (stringify!($opt), $opt, desc::$parse, $desc) ),* ];\n+        &[ $( (stringify!($opt), $optmod::$opt, desc::$parse, $desc) ),* ];\n \n+    mod $optmod {\n     $(\n-        fn $opt(cg: &mut $struct_name, v: Option<&str>) -> bool {\n-            parse::$parse(&mut redirect_field!(cg.$opt), v)\n+        pub(super) fn $opt(cg: &mut super::$struct_name, v: Option<&str>) -> bool {\n+            super::parse::$parse(&mut redirect_field!(cg.$opt), v)\n         }\n     )*\n+    }\n \n ) }\n \n@@ -918,7 +920,7 @@ mod parse {\n }\n \n options! {\n-    CodegenOptions, CG_OPTIONS, \"C\", \"codegen\",\n+    CodegenOptions, CG_OPTIONS, cgopts, \"C\", \"codegen\",\n \n     // This list is in alphabetical order.\n     //\n@@ -1027,7 +1029,7 @@ options! {\n }\n \n options! {\n-    DebuggingOptions, DB_OPTIONS, \"Z\", \"debugging\",\n+    DebuggingOptions, DB_OPTIONS, dbopts, \"Z\", \"debugging\",\n \n     // This list is in alphabetical order.\n     //"}]}