{"sha": "fedbe5dabc815bd710217221bfebad1ff9f37a43", "node_id": "C_kwDOAAsO6NoAKGZlZGJlNWRhYmM4MTViZDcxMDIxNzIyMWJmZWJhZDFmZjlmMzdhNDM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-25T04:24:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-25T04:24:10Z"}, "message": "Auto merge of #96106 - jihiggins:issue-96060, r=Mark-Simulacrum\n\nAdd type_name info to [TIMING] log output\n\nAdds type_name to the [TIMING] log output:\n```\n[TIMING] (bootstrap::compile::Sysroot) Sysroot { compiler: Compiler { stage: 0, host: TargetSelection { triple: \"x86_64-unknown-linux-gnu\", file: None } } } -- 0.020\n[TIMING] (bootstrap::builder::Builder::sysroot_libdir::Libdir) Libdir { compiler: Compiler { stage: 0, host: TargetSelection { triple: \"x86_64-unknown-linux-gnu\", file: None } }, target: TargetSelection { triple: \"x86_64-unknown-linux-gnu\", file: None } } -- 0.007\n```\n\nNot sure if that's the best way to format it. Thought about replacing the struct's name with the type_name output, but that feels kind of hacky?\n\nCloses #96060", "tree": {"sha": "5db43594a4a0fec41c5e1a605f5fc05c01d1a3c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5db43594a4a0fec41c5e1a605f5fc05c01d1a3c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fedbe5dabc815bd710217221bfebad1ff9f37a43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fedbe5dabc815bd710217221bfebad1ff9f37a43", "html_url": "https://github.com/rust-lang/rust/commit/fedbe5dabc815bd710217221bfebad1ff9f37a43", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fedbe5dabc815bd710217221bfebad1ff9f37a43/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f631e8e93681ddc6e62d6ba6065cac7c449534c", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f631e8e93681ddc6e62d6ba6065cac7c449534c", "html_url": "https://github.com/rust-lang/rust/commit/1f631e8e93681ddc6e62d6ba6065cac7c449534c"}, {"sha": "0fea00759fea1b25a60d2b729f61c885399bda83", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fea00759fea1b25a60d2b729f61c885399bda83", "html_url": "https://github.com/rust-lang/rust/commit/0fea00759fea1b25a60d2b729f61c885399bda83"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "f803388f0a6baa71bfa2abced3536f9f20f2e16a", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fedbe5dabc815bd710217221bfebad1ff9f37a43/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fedbe5dabc815bd710217221bfebad1ff9f37a43/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=fedbe5dabc815bd710217221bfebad1ff9f37a43", "patch": "@@ -1,4 +1,4 @@\n-use std::any::Any;\n+use std::any::{type_name, Any};\n use std::cell::{Cell, RefCell};\n use std::collections::BTreeSet;\n use std::env;\n@@ -1763,7 +1763,16 @@ impl<'a> Builder<'a> {\n         };\n \n         if self.config.print_step_timings && !self.config.dry_run {\n-            println!(\"[TIMING] {:?} -- {}.{:03}\", step, dur.as_secs(), dur.subsec_millis());\n+            let step_string = format!(\"{:?}\", step);\n+            let brace_index = step_string.find(\"{\").unwrap_or(0);\n+            let type_string = type_name::<S>();\n+            println!(\n+                \"[TIMING] {} {} -- {}.{:03}\",\n+                &type_string.strip_prefix(\"bootstrap::\").unwrap_or(type_string),\n+                &step_string[brace_index..],\n+                dur.as_secs(),\n+                dur.subsec_millis()\n+            );\n         }\n \n         {"}]}