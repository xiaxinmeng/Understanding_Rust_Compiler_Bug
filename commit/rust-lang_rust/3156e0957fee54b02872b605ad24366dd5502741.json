{"sha": "3156e0957fee54b02872b605ad24366dd5502741", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxNTZlMDk1N2ZlZTU0YjAyODcyYjYwNWFkMjQzNjZkZDU1MDI3NDE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-29T09:17:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-29T09:17:53Z"}, "message": "Auto merge of #4753 - mikerite:approx-const-20191029, r=flip1995\n\nSimplify approx const truncation check\n\nchangelog: none", "tree": {"sha": "460b6d860e22dd44db6dc5961b9d75c84c198b2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/460b6d860e22dd44db6dc5961b9d75c84c198b2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3156e0957fee54b02872b605ad24366dd5502741", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3156e0957fee54b02872b605ad24366dd5502741", "html_url": "https://github.com/rust-lang/rust/commit/3156e0957fee54b02872b605ad24366dd5502741", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3156e0957fee54b02872b605ad24366dd5502741/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a", "html_url": "https://github.com/rust-lang/rust/commit/e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a"}, {"sha": "5ce8990885eb09c6cc096c207c39b411aa6ce676", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce8990885eb09c6cc096c207c39b411aa6ce676", "html_url": "https://github.com/rust-lang/rust/commit/5ce8990885eb09c6cc096c207c39b411aa6ce676"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "81555a4c533b42eb677108146d354d27a2e1ac11", "filename": "clippy_lints/src/approx_const.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3156e0957fee54b02872b605ad24366dd5502741/clippy_lints%2Fsrc%2Fapprox_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3156e0957fee54b02872b605ad24366dd5502741/clippy_lints%2Fsrc%2Fapprox_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fapprox_const.rs?ref=3156e0957fee54b02872b605ad24366dd5502741", "patch": "@@ -97,14 +97,11 @@ fn check_known_consts(cx: &LateContext<'_, '_>, e: &Expr, s: symbol::Symbol, mod\n fn is_approx_const(constant: f64, value: &str, min_digits: usize) -> bool {\n     if value.len() <= min_digits {\n         false\n+    } else if constant.to_string().starts_with(value) {\n+        // The value is a truncated constant\n+        true\n     } else {\n         let round_const = format!(\"{:.*}\", value.len() - 2, constant);\n-\n-        let mut trunc_const = constant.to_string();\n-        if trunc_const.len() > value.len() {\n-            trunc_const.truncate(value.len());\n-        }\n-\n-        (value == round_const) || (value == trunc_const)\n+        value == round_const\n     }\n }"}]}