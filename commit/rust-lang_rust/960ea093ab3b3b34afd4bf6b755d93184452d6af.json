{"sha": "960ea093ab3b3b34afd4bf6b755d93184452d6af", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2MGVhMDkzYWIzYjNiMzRhZmQ0YmY2Yjc1NWQ5MzE4NDQ1MmQ2YWY=", "commit": {"author": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-06-23T21:40:06Z"}, "committer": {"name": "Cameron Steffen", "email": "cam.steffen94@gmail.com", "date": "2021-08-31T01:18:39Z"}, "message": "Add let_else feature gate", "tree": {"sha": "b7704720dca8faf1326b3f8265c2cc40364eec65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7704720dca8faf1326b3f8265c2cc40364eec65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/960ea093ab3b3b34afd4bf6b755d93184452d6af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/960ea093ab3b3b34afd4bf6b755d93184452d6af", "html_url": "https://github.com/rust-lang/rust/commit/960ea093ab3b3b34afd4bf6b755d93184452d6af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/960ea093ab3b3b34afd4bf6b755d93184452d6af/comments", "author": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camsteffen", "id": 5565418, "node_id": "MDQ6VXNlcjU1NjU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5565418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camsteffen", "html_url": "https://github.com/camsteffen", "followers_url": "https://api.github.com/users/camsteffen/followers", "following_url": "https://api.github.com/users/camsteffen/following{/other_user}", "gists_url": "https://api.github.com/users/camsteffen/gists{/gist_id}", "starred_url": "https://api.github.com/users/camsteffen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camsteffen/subscriptions", "organizations_url": "https://api.github.com/users/camsteffen/orgs", "repos_url": "https://api.github.com/users/camsteffen/repos", "events_url": "https://api.github.com/users/camsteffen/events{/privacy}", "received_events_url": "https://api.github.com/users/camsteffen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae32e88909350c631a26b3a37a9f07dd9656dba8", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae32e88909350c631a26b3a37a9f07dd9656dba8", "html_url": "https://github.com/rust-lang/rust/commit/ae32e88909350c631a26b3a37a9f07dd9656dba8"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "ca804ec6758b727b23ae4b02d59159c7dbc2b556", "filename": "compiler/rustc_ast_lowering/src/block.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_ast_lowering%2Fsrc%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_ast_lowering%2Fsrc%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fblock.rs?ref=960ea093ab3b3b34afd4bf6b755d93184452d6af", "patch": "@@ -1,6 +1,7 @@\n use crate::{ImplTraitContext, ImplTraitPosition, LoweringContext};\n use rustc_ast::{AttrVec, Block, BlockCheckMode, Expr, Local, LocalKind, Stmt, StmtKind};\n use rustc_hir as hir;\n+use rustc_session::parse::feature_err;\n use rustc_span::symbol::Ident;\n use rustc_span::{sym, DesugaringKind};\n \n@@ -170,6 +171,15 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n             span,\n             kind: hir::ExprKind::If(let_expr, then_expr, Some(else_expr)),\n         });\n+        if !self.sess.features_untracked().let_else {\n+            feature_err(\n+                &self.sess.parse_sess,\n+                sym::let_else,\n+                local.span,\n+                \"`let...else` statements are unstable\",\n+            )\n+            .emit();\n+        }\n         (stmt, if_expr)\n     }\n }"}, {"sha": "a3807a2bb9fde64cb5a3a6e2574de2a9176f145f", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=960ea093ab3b3b34afd4bf6b755d93184452d6af", "patch": "@@ -676,6 +676,9 @@ declare_features! (\n     /// Allows additional const parameter types, such as `&'static str` or user defined types\n     (incomplete, adt_const_params, \"1.56.0\", Some(44580), None),\n \n+    /// Allows `let...else` statements.\n+    (active, let_else, \"1.56.0\", Some(87335), None),\n+\n     // -------------------------------------------------------------------------\n     // feature-group-end: actual feature gates\n     // -------------------------------------------------------------------------"}, {"sha": "899c51e12ff1f42f25e5e3babf37748038077cef", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960ea093ab3b3b34afd4bf6b755d93184452d6af/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=960ea093ab3b3b34afd4bf6b755d93184452d6af", "patch": "@@ -744,6 +744,7 @@ symbols! {\n         le,\n         len,\n         let_chains,\n+        let_else,\n         lhs,\n         lib,\n         libc,"}, {"sha": "3f04a9dabfd1f743046b2a87c69b558919743863", "filename": "src/test/ui/feature-gates/feature-gate-let_else.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/960ea093ab3b3b34afd4bf6b755d93184452d6af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960ea093ab3b3b34afd4bf6b755d93184452d6af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.rs?ref=960ea093ab3b3b34afd4bf6b755d93184452d6af", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    let Some(x) = Some(1) else { //~ ERROR `let...else` statements are unstable\n+        return;\n+    };\n+}"}, {"sha": "8625260415467f23b3fdc983391bb6c791764a33", "filename": "src/test/ui/feature-gates/feature-gate-let_else.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/960ea093ab3b3b34afd4bf6b755d93184452d6af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/960ea093ab3b3b34afd4bf6b755d93184452d6af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-let_else.stderr?ref=960ea093ab3b3b34afd4bf6b755d93184452d6af", "patch": "@@ -0,0 +1,14 @@\n+error[E0658]: `let...else` statements are unstable\n+  --> $DIR/feature-gate-let_else.rs:2:5\n+   |\n+LL | /     let Some(x) = Some(1) else {\n+LL | |         return;\n+LL | |     };\n+   | |______^\n+   |\n+   = note: see issue #87335 <https://github.com/rust-lang/rust/issues/87335> for more information\n+   = help: add `#![feature(let_else)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}