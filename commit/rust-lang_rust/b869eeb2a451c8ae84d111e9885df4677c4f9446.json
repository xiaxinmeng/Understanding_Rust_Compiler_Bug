{"sha": "b869eeb2a451c8ae84d111e9885df4677c4f9446", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4NjllZWIyYTQ1MWM4YWU4NGQxMTFlOTg4NWRmNDY3N2M0Zjk0NDY=", "commit": {"author": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2019-10-21T08:09:53Z"}, "committer": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2019-10-22T03:14:39Z"}, "message": "build: improve script and travis config\n\n* fix a diff failure on windows\n\nSee https://travis-ci.com/rust-lang/rust-clippy/jobs/245971932#L1625\nfor an example.\n\n* use cmp instead of diff > /dev/null\n\n* clone single branch instead of clone then checking out\n\n* do not decrypt key if have no diff change", "tree": {"sha": "c35956b62229d273c54550a9faded7dba2471034", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c35956b62229d273c54550a9faded7dba2471034"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b869eeb2a451c8ae84d111e9885df4677c4f9446", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b869eeb2a451c8ae84d111e9885df4677c4f9446", "html_url": "https://github.com/rust-lang/rust/commit/b869eeb2a451c8ae84d111e9885df4677c4f9446", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b869eeb2a451c8ae84d111e9885df4677c4f9446/comments", "author": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d0f62570b2f58b09b991f7312dd1f1564c613f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d0f62570b2f58b09b991f7312dd1f1564c613f0", "html_url": "https://github.com/rust-lang/rust/commit/1d0f62570b2f58b09b991f7312dd1f1564c613f0"}], "stats": {"total": 186, "additions": 85, "deletions": 101}, "files": [{"sha": "b8209159284669ce911cad9e89f07d66cc6d5109", "filename": ".github/deploy.sh", "status": "modified", "additions": 25, "deletions": 30, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -13,11 +13,7 @@ SSH_REPO=${REPO/https:\\/\\/github.com\\//git@github.com:}\n SHA=$(git rev-parse --verify HEAD)\n \n # Clone the existing gh-pages for this repo into out/\n-(\n-    git clone \"$REPO\" out\n-    cd out\n-    git checkout $TARGET_BRANCH\n-)\n+git clone --quiet --single-branch --branch \"$TARGET_BRANCH\" \"$REPO\" out\n \n echo \"Removing the current docs for master\"\n rm -rf out/master/ || exit 0\n@@ -27,35 +23,44 @@ mkdir out/master/\n cp util/gh-pages/index.html out/master\n python ./util/export.py out/master/lints.json\n \n-if [ -n \"$TRAVIS_TAG\" ]; then\n+if [[ -n \"$TRAVIS_TAG\" ]]; then\n     echo \"Save the doc for the current tag ($TRAVIS_TAG) and point current/ to it\"\n     cp -r out/master \"out/$TRAVIS_TAG\"\n     rm -f out/current\n     ln -s \"$TRAVIS_TAG\" out/current\n fi\n \n # Generate version index that is shown as root index page\n-(\n-    cp util/gh-pages/versions.html out/index.html\n-\n-    cd out\n-    python -c '\\\n-        import os, json;\\\n-        print json.dumps([\\\n-            dir for dir in os.listdir(\".\")\\\n-            if not dir.startswith(\".\") and os.path.isdir(dir)\\\n-        ])' > versions.json\n-)\n+cp util/gh-pages/versions.html out/index.html\n+pushd out\n+\n+cat <<-EOF | python - > versions.json\n+import os, json\n+print json.dumps([\n+    dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n+])\n+EOF\n+popd\n \n # Pull requests and commits to other branches shouldn't try to deploy, just build to verify\n-if [ \"$TRAVIS_PULL_REQUEST\" != \"false\" ] || [ \"$TRAVIS_BRANCH\" != \"$SOURCE_BRANCH\" ]; then\n+if [[ \"$TRAVIS_PULL_REQUEST\" != \"false\" ]] || [[ \"$TRAVIS_BRANCH\" != \"$SOURCE_BRANCH\" ]]; then\n     # Tags should deploy\n-    if [ -z \"$TRAVIS_TAG\" ]; then\n+    if [[ -z \"$TRAVIS_TAG\" ]]; then\n         echo \"Generated, won't push\"\n         exit 0\n     fi\n fi\n \n+# Now let's go have some fun with the cloned repo\n+cd out\n+git config user.name \"Travis CI\"\n+git config user.email \"travis@ci.invalid\"\n+\n+if git diff --exit-code --quiet; then\n+    echo \"No changes to the output on this push; exiting.\"\n+    exit 0\n+fi\n+\n # Get the deploy key by using Travis's stored variables to decrypt deploy_key.enc\n ENCRYPTION_LABEL=e3a2d77100be\n ENCRYPTED_KEY_VAR=\"encrypted_${ENCRYPTION_LABEL}_key\"\n@@ -64,19 +69,9 @@ ENCRYPTED_KEY=${!ENCRYPTED_KEY_VAR}\n ENCRYPTED_IV=${!ENCRYPTED_IV_VAR}\n openssl aes-256-cbc -K \"$ENCRYPTED_KEY\" -iv \"$ENCRYPTED_IV\" -in .github/deploy_key.enc -out .github/deploy_key -d\n chmod 600 .github/deploy_key\n-eval $(ssh-agent -s)\n+eval \"$(ssh-agent -s)\"\n ssh-add .github/deploy_key\n \n-# Now let's go have some fun with the cloned repo\n-cd out\n-git config user.name \"Travis CI\"\n-git config user.email \"travis@ci.invalid\"\n-\n-if [ -z \"$(git diff --exit-code)\" ]; then\n-    echo \"No changes to the output on this push; exiting.\"\n-    exit 0\n-fi\n-\n git add .\n git commit -m \"Automatic deploy to GitHub Pages: ${SHA}\"\n "}, {"sha": "f707e622ad87e65cdb3d9f24da078b52bbd8705b", "filename": ".travis.yml", "status": "modified", "additions": 13, "deletions": 24, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -1,11 +1,6 @@\n dist: xenial\n language: bash\n \n-os:\n-  - linux\n-  - osx\n-  - windows\n-\n branches:\n   # Don't build these branches\n   except:\n@@ -34,13 +29,12 @@ install:\n       if ! rustup component add rustfmt; then\n         cargo install -Z install-upgrade --git https://github.com/rust-lang/rustfmt --bin rustfmt\n       fi\n-      if [ \"$TRAVIS_OS_NAME\" == \"linux\" ]; then\n+      if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then\n         . $HOME/.nvm/nvm.sh\n         nvm install stable\n         nvm use stable\n         npm install remark-cli remark-lint\n-      fi\n-      if [ \"$TRAVIS_OS_NAME\" == \"windows\" ]; then\n+      elif [[ \"$TRAVIS_OS_NAME\" == \"windows\" ]]; then\n         choco install windows-sdk-10.1\n       fi\n     fi\n@@ -96,50 +90,45 @@ matrix:\n   allow_failures:\n     - os: windows\n       env: CARGO_INCREMENTAL=0 BASE_TESTS=true OS_WINDOWS=true\n-  # prevent these jobs with default env vars\n-  exclude:\n-    - os: linux\n-    - os: osx\n-    - os: windows\n \n before_script:\n   - |\n-    if [ \"$TRAVIS_BRANCH\" == \"auto\" ] || [ \"$TRAVIS_BRANCH\" == \"try\" ]; then\n-      pr=$(echo $TRAVIS_COMMIT_MESSAGE | grep -o \"#[0-9]*\" | head -1 | sed 's/^#//g')\n-      output=$(curl -H \"Authorization: token $GITHUB_API_TOKEN\" -s \"https://api.github.com/repos/rust-lang/rust-clippy/pulls/$pr\" | \\\n+    if [[ \"$TRAVIS_BRANCH\" == \"auto\" ]] || [[ \"$TRAVIS_BRANCH\" == \"try\" ]]; then\n+      PR=$(echo \"$TRAVIS_COMMIT_MESSAGE\" | grep -o \"#[0-9]*\" | head -1 | sed 's/^#//g')\n+      output=$(curl -H \"Authorization: token $GITHUB_API_TOKEN\" -s \"https://api.github.com/repos/rust-lang/rust-clippy/pulls/$PR\" | \\\n         python -c \"import sys, json; print(json.load(sys.stdin)['body'])\" | \\\n         grep \"^changelog: \" | \\\n         sed \"s/changelog: //g\")\n-      if [ -z \"$output\" ]; then\n+      if [[ -z \"$output\" ]]; then\n         echo \"ERROR: PR body must contain 'changelog: ...'\"\n         exit 1\n-      elif [ \"$output\" = \"none\" ]; then\n+      elif [[ \"$output\" = \"none\" ]]; then\n         echo \"WARNING: changelog is 'none'\"\n       fi\n     fi\n   - |\n     rm rust-toolchain\n     ./setup-toolchain.sh\n   - |\n-    if [ \"$TRAVIS_OS_NAME\" == \"windows\" ]; then\n+    if [[ \"$TRAVIS_OS_NAME\" == \"windows\" ]]; then\n       export PATH=$PATH:$(rustc --print sysroot)/bin\n     else\n       export LD_LIBRARY_PATH=$(rustc --print sysroot)/lib\n     fi\n \n script:\n   - |\n-    if [ -z ${INTEGRATION} ]; then\n-      travis_wait 30 ./ci/base-tests.sh && sleep 5\n-    else\n+    if [[ -n ${INTEGRATION} ]]; then\n       ./ci/integration-tests.sh && sleep 5\n+    else\n+      travis_wait 30 ./ci/base-tests.sh && sleep 5\n     fi\n \n after_success:\n   - |\n-    if [ \"$TRAVIS_OS_NAME\" == \"linux\" ]; then\n+    if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then\n       set -e\n-      if [ -z ${INTEGRATION} ]; then\n+      if [[ -z ${INTEGRATION} ]]; then\n         ./.github/deploy.sh\n       else\n         echo \"Not deploying, because we're in an integration test run\""}, {"sha": "3fe0f17453563e31b70fa7f7ba4137e129864afb", "filename": "ci/base-tests.sh", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/ci%2Fbase-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/ci%2Fbase-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fbase-tests.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -1,16 +1,18 @@\n+#!/usr/bin/env bash\n set -ex\n \n echo \"Running clippy base tests\"\n \n PATH=$PATH:./node_modules/.bin\n-if [ \"$TRAVIS_OS_NAME\" == \"linux\" ]; then\n-  remark -f *.md -f doc/*.md > /dev/null\n+if [[ \"$TRAVIS_OS_NAME\" == \"linux\" ]]; then\n+  remark -f ./*.md -f doc/*.md > /dev/null\n fi\n # build clippy in debug mode and run tests\n cargo build --features \"debugging deny-warnings\"\n cargo test --features \"debugging deny-warnings\"\n # for faster build, share target dir between subcrates\n-export CARGO_TARGET_DIR=`pwd`/target/\n+CARGO_TARGET_DIR=$(pwd)/target/\n+export CARGO_TARGET_DIR\n (cd clippy_lints && cargo test)\n (cd rustc_tools_util && cargo test)\n (cd clippy_dev && cargo test)\n@@ -29,26 +31,27 @@ export CARGO_TARGET_DIR=`pwd`/target/\n (\n   # Check sysroot handling\n   sysroot=$(./target/debug/clippy-driver --print sysroot)\n-  test $sysroot = $(rustc --print sysroot)\n+  test \"$sysroot\" = \"$(rustc --print sysroot)\"\n \n-  if [ -z $OS_WINDOWS ]; then\n+  if [[ -z \"$OS_WINDOWS\" ]]; then\n     desired_sysroot=/tmp\n   else\n     desired_sysroot=C:/tmp\n   fi\n   sysroot=$(./target/debug/clippy-driver --sysroot $desired_sysroot --print sysroot)\n-  test $sysroot = $desired_sysroot\n+  test \"$sysroot\" = $desired_sysroot\n \n   sysroot=$(SYSROOT=$desired_sysroot ./target/debug/clippy-driver --print sysroot)\n-  test $sysroot = $desired_sysroot\n+  test \"$sysroot\" = $desired_sysroot\n \n   # Make sure this isn't set - clippy-driver should cope without it\n   unset CARGO_MANIFEST_DIR\n \n   # Run a lint and make sure it produces the expected output. It's also expected to exit with code 1\n-  # XXX How to match the clippy invocation in compile-test.rs?\n+  # FIXME: How to match the clippy invocation in compile-test.rs?\n   ! ./target/debug/clippy-driver -Dwarnings -Aunused -Zui-testing --emit metadata --crate-type bin tests/ui/cstring.rs 2> cstring.stderr\n-  diff <(sed -e 's,tests/ui,$DIR,' -e '/= help/d' cstring.stderr) tests/ui/cstring.stderr\n+  sed -e 's,tests/ui,$DIR,' -e '/= help/d' cstring.stderr > normalized.stderr\n+  diff normalized.stderr tests/ui/cstring.stderr\n \n   # TODO: CLIPPY_CONF_DIR / CARGO_MANIFEST_DIR\n )"}, {"sha": "7028b251ea0307bb669524afb702a8d62a038924", "filename": "tests/ui-toml/update-all-references.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui-toml%2Fupdate-all-references.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui-toml%2Fupdate-all-references.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-toml%2Fupdate-all-references.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -13,6 +13,6 @@ if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" ]]; then\n fi\n \n BUILD_DIR=$PWD/target/debug/test_build_base\n-MY_DIR=$(dirname $0)\n-cd $MY_DIR\n-find . -name '*.rs' | xargs ./update-references.sh $BUILD_DIR\n+MY_DIR=$(dirname \"$0\")\n+cd \"$MY_DIR\" || exit\n+find . -name '*.rs' -exec ./update-references.sh \"$BUILD_DIR\" {} +"}, {"sha": "50d42678734e9caca32b8d6c806ed576f4b04a8e", "filename": "tests/ui-toml/update-references.sh", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui-toml%2Fupdate-references.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui-toml%2Fupdate-references.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui-toml%2Fupdate-references.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -16,7 +16,7 @@ if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" || \"$1\" == \"\" || \"$2\" == \"\" ]]; then\n     echo \"   $0 ../../../build/x86_64-apple-darwin/test/ui *.rs */*.rs\"\n fi\n \n-MYDIR=$(dirname $0)\n+MYDIR=$(dirname \"$0\")\n \n BUILD_DIR=\"$1\"\n shift\n@@ -25,16 +25,14 @@ while [[ \"$1\" != \"\" ]]; do\n     STDERR_NAME=\"${1/%.rs/.stderr}\"\n     STDOUT_NAME=\"${1/%.rs/.stdout}\"\n     shift\n-    if [ -f $BUILD_DIR/$STDOUT_NAME ] && \\\n-           ! (diff $BUILD_DIR/$STDOUT_NAME $MYDIR/$STDOUT_NAME >& /dev/null); then\n-        echo updating $MYDIR/$STDOUT_NAME\n-        cp $BUILD_DIR/$STDOUT_NAME $MYDIR/$STDOUT_NAME\n+    if [[ -f \"$BUILD_DIR\"/\"$STDOUT_NAME\" ]] && \\\n+           ! (cmp -s -- \"$BUILD_DIR\"/\"$STDOUT_NAME\" \"$MYDIR\"/\"$STDOUT_NAME\"); then\n+        echo updating \"$MYDIR\"/\"$STDOUT_NAME\"\n+        cp \"$BUILD_DIR\"/\"$STDOUT_NAME\" \"$MYDIR\"/\"$STDOUT_NAME\"\n     fi\n-    if [ -f $BUILD_DIR/$STDERR_NAME ] && \\\n-           ! (diff $BUILD_DIR/$STDERR_NAME $MYDIR/$STDERR_NAME >& /dev/null); then\n-        echo updating $MYDIR/$STDERR_NAME\n-        cp $BUILD_DIR/$STDERR_NAME $MYDIR/$STDERR_NAME\n+    if [[ -f \"$BUILD_DIR\"/\"$STDERR_NAME\" ]] && \\\n+           ! (cmp -s -- \"$BUILD_DIR\"/\"$STDERR_NAME\" \"$MYDIR\"/\"$STDERR_NAME\"); then\n+        echo updating \"$MYDIR\"/\"$STDERR_NAME\"\n+        cp \"$BUILD_DIR\"/\"$STDERR_NAME\" \"$MYDIR\"/\"$STDERR_NAME\"\n     fi\n done\n-\n-"}, {"sha": "9f970ea26b71560542a2a098bf5d6b448cae07a9", "filename": "tests/ui/update-all-references.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui%2Fupdate-all-references.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui%2Fupdate-all-references.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fupdate-all-references.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -13,6 +13,6 @@ if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" ]]; then\n fi\n \n BUILD_DIR=$PWD/target/debug/test_build_base\n-MY_DIR=$(dirname $0)\n-cd $MY_DIR\n-find . -name '*.rs' | xargs ./update-references.sh $BUILD_DIR\n+MY_DIR=$(dirname \"$0\")\n+cd \"$MY_DIR\" || exit\n+find . -name '*.rs' -exec ./update-references.sh \"$BUILD_DIR\" {} +"}, {"sha": "2c13c327d79802247ea86914133f9c36df1682b4", "filename": "tests/ui/update-references.sh", "status": "modified", "additions": 13, "deletions": 15, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui%2Fupdate-references.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/tests%2Fui%2Fupdate-references.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fupdate-references.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -16,7 +16,7 @@ if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" || \"$1\" == \"\" || \"$2\" == \"\" ]]; then\n     echo \"   $0 ../../../build/x86_64-apple-darwin/test/ui *.rs */*.rs\"\n fi\n \n-MYDIR=$(dirname $0)\n+MYDIR=$(dirname \"$0\")\n \n BUILD_DIR=\"$1\"\n shift\n@@ -26,21 +26,19 @@ while [[ \"$1\" != \"\" ]]; do\n     STDOUT_NAME=\"${1/%.rs/.stdout}\"\n     FIXED_NAME=\"${1/%.rs/.fixed}\"\n     shift\n-    if [ -f $BUILD_DIR/$STDOUT_NAME ] && \\\n-           ! (diff $BUILD_DIR/$STDOUT_NAME $MYDIR/$STDOUT_NAME >& /dev/null); then\n-        echo updating $MYDIR/$STDOUT_NAME\n-        cp $BUILD_DIR/$STDOUT_NAME $MYDIR/$STDOUT_NAME\n+    if [[ -f \"$BUILD_DIR\"/\"$STDOUT_NAME\" ]] && \\\n+           ! (cmp -s -- \"$BUILD_DIR\"/\"$STDOUT_NAME\" \"$MYDIR\"/\"$STDOUT_NAME\"); then\n+        echo updating \"$MYDIR\"/\"$STDOUT_NAME\"\n+        cp \"$BUILD_DIR\"/\"$STDOUT_NAME\" \"$MYDIR\"/\"$STDOUT_NAME\"\n     fi\n-    if [ -f $BUILD_DIR/$STDERR_NAME ] && \\\n-           ! (diff $BUILD_DIR/$STDERR_NAME $MYDIR/$STDERR_NAME >& /dev/null); then\n-        echo updating $MYDIR/$STDERR_NAME\n-        cp $BUILD_DIR/$STDERR_NAME $MYDIR/$STDERR_NAME\n+    if [[ -f \"$BUILD_DIR\"/\"$STDERR_NAME\" ]] && \\\n+           ! (cmp -s -- \"$BUILD_DIR\"/\"$STDERR_NAME\" \"$MYDIR\"/\"$STDERR_NAME\"); then\n+        echo updating \"$MYDIR\"/\"$STDERR_NAME\"\n+        cp \"$BUILD_DIR\"/\"$STDERR_NAME\" \"$MYDIR\"/\"$STDERR_NAME\"\n     fi\n-    if [ -f $BUILD_DIR/$FIXED_NAME ] && \\\n-           ! (diff $BUILD_DIR/$FIXED_NAME $MYDIR/$FIXED_NAME >& /dev/null); then\n-        echo updating $MYDIR/$FIXED_NAME\n-        cp $BUILD_DIR/$FIXED_NAME $MYDIR/$FIXED_NAME\n+    if [[ -f \"$BUILD_DIR\"/\"$FIXED_NAME\" ]] && \\\n+           ! (cmp -s -- \"$BUILD_DIR\"/\"$FIXED_NAME\" \"$MYDIR\"/\"$FIXED_NAME\"); then\n+        echo updating \"$MYDIR\"/\"$FIXED_NAME\"\n+        cp \"$BUILD_DIR\"/\"$FIXED_NAME\" \"$MYDIR\"/\"$FIXED_NAME\"\n     fi\n done\n-\n-"}, {"sha": "881aba196e72340e5149ee68a3f102642e8a8035", "filename": "util/fetch_prs_between.sh", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/b869eeb2a451c8ae84d111e9885df4677c4f9446/util%2Ffetch_prs_between.sh", "raw_url": "https://github.com/rust-lang/rust/raw/b869eeb2a451c8ae84d111e9885df4677c4f9446/util%2Ffetch_prs_between.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Ffetch_prs_between.sh?ref=b869eeb2a451c8ae84d111e9885df4677c4f9446", "patch": "@@ -1,4 +1,4 @@\n-#!/bin/sh\n+#!/bin/bash\n \n # Fetches the merge commits between two git commits and prints the PR URL\n # together with the full commit message\n@@ -12,14 +12,15 @@ last=$2\n IFS='\n '\n for pr in $(git log --oneline --grep \"Merge #\" --grep \"Merge pull request\" --grep \"Auto merge of\" --grep \"Rollup merge of\" \"$first...$last\" | sort -rn | uniq); do\n-  id=$(echo $pr | rg -o '#[0-9]{3,5}' | cut -c 2-)\n-  commit=$(echo $pr | cut -d' ' -f 1)\n-  message=$(git --no-pager show --pretty=medium $commit)\n-  if [ ! -z $(echo \"$message\" | rg \"^[\\s]{4}changelog: [nN]one\\.*$\") ]; then\n+  id=$(echo \"$pr\" | rg -o '#[0-9]{3,5}' | cut -c 2-)\n+  commit=$(echo \"$pr\" | cut -d' ' -f 1)\n+  message=$(git --no-pager show --pretty=medium \"$commit\")\n+  if [[ -n $(echo \"$message\" | rg \"^[\\s]{4}changelog: [nN]one\\.*$\") ]]; then\n     continue\n   fi\n \n   echo \"URL: https://github.com/rust-lang/rust-clippy/pull/$id\"\n   echo \"$message\"\n-  echo \"---------------------------------------------------------\\n\"\n+  echo \"---------------------------------------------------------\"\n+  echo\n done"}]}