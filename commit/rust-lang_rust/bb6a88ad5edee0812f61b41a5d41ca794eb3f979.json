{"sha": "bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "node_id": "C_kwDOAAsO6NoAKGJiNmE4OGFkNWVkZWUwODEyZjYxYjQxYTVkNDFjYTc5NGViM2Y5Nzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-09T03:57:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-09T03:57:56Z"}, "message": "Rollup merge of #106602 - GuillaumeGomez:tidy-goml-scripts, r=Mark-Simulacrum\n\nAdd goml scripts to tidy checks\n\nr? ``@notriddle``", "tree": {"sha": "6071d8773c7c800beef0667f968c67ba6d235910", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6071d8773c7c800beef0667f968c67ba6d235910"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJju5DECRBK7hj4Ov3rIwAAczMIAKUaxJ9E7ZEnDgz8utTPwxj2\nJ6L4sUgjUKN/u92IJRvTvWMsNlIvxC+fdED9td5Eqymk9Jx3uoRjz8JpvZEajlY+\nRUkSCVkc2N+iDuPc+H93KfqWhplHioYtuMJ1hm6lNda8X/DfRXi+oJsyStU0vMKl\ndz8g8VciJyD5r1/5wlk/Rx7Y3aaXNPdpFKBgqvgjwx6//Ow++ZlgEhVYEReY5iZH\nlvXwaNExO6R3oFlVvdBaaTOuuKsJbcK/khQokADxu+ehwizYjkroNZyxIwLZcJAV\niSoE+WVBZhp2N07Y+j7AjW9VKzYJpV3LeRJh6KGzguy2oAlM21lEugC/gcvFWdQ=\n=eRoH\n-----END PGP SIGNATURE-----\n", "payload": "tree 6071d8773c7c800beef0667f968c67ba6d235910\nparent 29420a8e7ab5d5aeeacdd8103eed7c8c19be7001\nparent 31b39be9cef4f028b0a1cde5abff2f8acc426bfd\nauthor Michael Goulet <michael@errs.io> 1673236676 -0800\ncommitter GitHub <noreply@github.com> 1673236676 -0800\n\nRollup merge of #106602 - GuillaumeGomez:tidy-goml-scripts, r=Mark-Simulacrum\n\nAdd goml scripts to tidy checks\n\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "html_url": "https://github.com/rust-lang/rust/commit/bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29420a8e7ab5d5aeeacdd8103eed7c8c19be7001", "url": "https://api.github.com/repos/rust-lang/rust/commits/29420a8e7ab5d5aeeacdd8103eed7c8c19be7001", "html_url": "https://github.com/rust-lang/rust/commit/29420a8e7ab5d5aeeacdd8103eed7c8c19be7001"}, {"sha": "31b39be9cef4f028b0a1cde5abff2f8acc426bfd", "url": "https://api.github.com/repos/rust-lang/rust/commits/31b39be9cef4f028b0a1cde5abff2f8acc426bfd", "html_url": "https://github.com/rust-lang/rust/commit/31b39be9cef4f028b0a1cde5abff2f8acc426bfd"}], "stats": {"total": 61, "additions": 45, "deletions": 16}, "files": [{"sha": "5d80d24969ddeb638bd5684428f158e015a62a91", "filename": "src/test/rustdoc-gui/escape-key.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -5,7 +5,7 @@ goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n write: (\".search-input\", \"test\")\n // To be SURE that the search will be run.\n press-key: 'Enter'\n-wait-for: \"#search h1\" // The search element is empty before the first search \n+wait-for: \"#search h1\" // The search element is empty before the first search\n // Check that the currently displayed element is search.\n wait-for: \"#alternative-display #search\"\n assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})"}, {"sha": "6caffb9c39fc1b4210034753ad8e3251f7bad4db", "filename": "src/test/rustdoc-gui/impl-doc.goml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fimpl-doc.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fimpl-doc.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fimpl-doc.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -3,7 +3,7 @@ goto: \"file://\" + |DOC_PATH| + \"/test_docs/struct.TypeWithImplDoc.html\"\n \n // The text is about 24px tall, so if there's a margin, then their position will be >24px apart\n compare-elements-position-near-false: (\n-\t\"#implementations-list > .implementors-toggle > .docblock > p\",\n-\t\"#implementations-list > .implementors-toggle > .impl-items\",\n-\t{\"y\": 24}\n+    \"#implementations-list > .implementors-toggle > .docblock > p\",\n+    \"#implementations-list > .implementors-toggle > .impl-items\",\n+    {\"y\": 24}\n )"}, {"sha": "895864d89445fdfe85f57d799e276818d0517f5f", "filename": "src/test/rustdoc-gui/mobile.goml", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fmobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fmobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fmobile.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -27,4 +27,8 @@ assert-css-false: (\".content .out-of-band .since::before\", { \"content\": \"\\\"Since\n goto: \"file://\" + |DOC_PATH| + \"/settings.html\"\n size: (400, 600)\n // Ignored for now https://github.com/rust-lang/rust/issues/93784.\n-// compare-elements-position-near-false: (\"#preferred-light-theme .setting-name\", \"#preferred-light-theme .choice\", {\"y\": 16})\n+// compare-elements-position-near-false: (\n+//     \"#preferred-light-theme .setting-name\",\n+//     \"#preferred-light-theme .choice\",\n+//     {\"y\": 16},\n+// )"}, {"sha": "2d15e8b969921d4b1ea801bea88af2dba61e1ea0", "filename": "src/test/rustdoc-gui/rust-logo.goml", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Frust-logo.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Frust-logo.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Frust-logo.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -31,13 +31,28 @@ define-function: (\n \n call-function: (\n     \"check-logo\",\n-    (\"ayu\", \"drop-shadow(rgb(255, 255, 255) 1px 0px 0px) drop-shadow(rgb(255, 255, 255) 0px 1px 0px) drop-shadow(rgb(255, 255, 255) -1px 0px 0px) drop-shadow(rgb(255, 255, 255) 0px -1px 0px)\"),\n+    {\n+        \"theme\": \"ayu\",\n+        \"filter\": \"drop-shadow(rgb(255, 255, 255) 1px 0px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) 0px 1px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) -1px 0px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) 0px -1px 0px)\",\n+    },\n )\n call-function: (\n     \"check-logo\",\n-    (\"dark\", \"drop-shadow(rgb(255, 255, 255) 1px 0px 0px) drop-shadow(rgb(255, 255, 255) 0px 1px 0px) drop-shadow(rgb(255, 255, 255) -1px 0px 0px) drop-shadow(rgb(255, 255, 255) 0px -1px 0px)\"),\n+    {\n+        \"theme\": \"dark\",\n+        \"filter\": \"drop-shadow(rgb(255, 255, 255) 1px 0px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) 0px 1px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) -1px 0px 0px) \" +\n+            \"drop-shadow(rgb(255, 255, 255) 0px -1px 0px)\",\n+    },\n )\n call-function: (\n     \"check-logo\",\n-    (\"light\", \"none\"),\n+    {\n+        \"theme\": \"light\",\n+        \"filter\": \"none\",\n+    },\n )"}, {"sha": "10651a3f6696d5ef41eaef999ee37c527446b97a", "filename": "src/test/rustdoc-gui/scrape-examples-button-focus.goml", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-button-focus.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -5,25 +5,25 @@ store-property: (initialScrollTop, \".scraped-example-list > .scraped-example pre\n focus: \".scraped-example-list > .scraped-example .next\"\n press-key: \"Enter\"\n assert-property-false: (\".scraped-example-list > .scraped-example pre\", {\n-\t\"scrollTop\": |initialScrollTop|\n+    \"scrollTop\": |initialScrollTop|\n })\n focus: \".scraped-example-list > .scraped-example .prev\"\n press-key: \"Enter\"\n assert-property: (\".scraped-example-list > .scraped-example pre\", {\n-\t\"scrollTop\": |initialScrollTop|\n+    \"scrollTop\": |initialScrollTop|\n })\n \n // The expand button increases the scrollHeight of the minimized code viewport\n store-property: (smallOffsetHeight, \".scraped-example-list > .scraped-example pre\", \"offsetHeight\")\n assert-property-false: (\".scraped-example-list > .scraped-example pre\", {\n-\t\"scrollHeight\": |smallOffsetHeight|\n+    \"scrollHeight\": |smallOffsetHeight|\n })\n focus: \".scraped-example-list > .scraped-example .expand\"\n press-key: \"Enter\"\n assert-property-false: (\".scraped-example-list > .scraped-example pre\", {\n-\t\"offsetHeight\": |smallOffsetHeight|\n+    \"offsetHeight\": |smallOffsetHeight|\n })\n store-property: (fullOffsetHeight, \".scraped-example-list > .scraped-example pre\", \"offsetHeight\")\n assert-property: (\".scraped-example-list > .scraped-example pre\", {\n-\t\"scrollHeight\": |fullOffsetHeight|\n+    \"scrollHeight\": |fullOffsetHeight|\n })"}, {"sha": "9c742be0587c62a9fb09d85bf0a263f5f255d838", "filename": "src/test/rustdoc-gui/sidebar.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -148,4 +148,4 @@ assert-text: (\"#toggle-all-docs\", \"[+]\")\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n click: \"#toggle-all-docs\"\n assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n-assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n\\ No newline at end of file\n+assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})"}, {"sha": "9b60bc04738bfe542da46e5fc8d048c806743059", "filename": "src/test/rustdoc-gui/type-declation-overflow.goml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -1,3 +1,4 @@\n+// ignore-tidy-linelength\n // This test ensures that the items declaration content overflow is handled inside the <pre> directly.\n \n // We need to disable this check because"}, {"sha": "723a52c4c680a1ef0234926923fc5b5ec2d3ee7e", "filename": "src/tools/tidy/src/style.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb6a88ad5edee0812f61b41a5d41ca794eb3f979/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fstyle.rs?ref=bb6a88ad5edee0812f61b41a5d41ca794eb3f979", "patch": "@@ -25,6 +25,7 @@ use std::path::Path;\n /// displayed on the console with --example.\n const ERROR_CODE_COLS: usize = 80;\n const COLS: usize = 100;\n+const GOML_COLS: usize = 120;\n \n const LINES: usize = 3000;\n \n@@ -230,7 +231,8 @@ pub fn check(path: &Path, bad: &mut bool) {\n     walk(path, &mut skip, &mut |entry, contents| {\n         let file = entry.path();\n         let filename = file.file_name().unwrap().to_string_lossy();\n-        let extensions = [\".rs\", \".py\", \".js\", \".sh\", \".c\", \".cpp\", \".h\", \".md\", \".css\", \".ftl\"];\n+        let extensions =\n+            [\".rs\", \".py\", \".js\", \".sh\", \".c\", \".cpp\", \".h\", \".md\", \".css\", \".ftl\", \".goml\"];\n         if extensions.iter().all(|e| !filename.ends_with(e)) || filename.starts_with(\".#\") {\n             return;\n         }\n@@ -255,8 +257,15 @@ pub fn check(path: &Path, bad: &mut bool) {\n \n         let extension = file.extension().unwrap().to_string_lossy();\n         let is_error_code = extension == \"md\" && is_in(file, \"src\", \"error_codes\");\n+        let is_goml_code = extension == \"goml\";\n \n-        let max_columns = if is_error_code { ERROR_CODE_COLS } else { COLS };\n+        let max_columns = if is_error_code {\n+            ERROR_CODE_COLS\n+        } else if is_goml_code {\n+            GOML_COLS\n+        } else {\n+            COLS\n+        };\n \n         let can_contain = contents.contains(\"// ignore-tidy-\")\n             || contents.contains(\"# ignore-tidy-\")"}]}