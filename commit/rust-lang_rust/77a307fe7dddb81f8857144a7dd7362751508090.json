{"sha": "77a307fe7dddb81f8857144a7dd7362751508090", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3YTMwN2ZlN2RkZGI4MWY4ODU3MTQ0YTdkZDczNjI3NTE1MDgwOTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-01T18:34:59Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-01T18:34:59Z"}, "message": "Auto merge of #1292 - RalfJung:time, r=RalfJung\n\nsanity check time values a bit more", "tree": {"sha": "f4e83521a8ce092a9e241b9cfc6aa426f74049da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4e83521a8ce092a9e241b9cfc6aa426f74049da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77a307fe7dddb81f8857144a7dd7362751508090", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77a307fe7dddb81f8857144a7dd7362751508090", "html_url": "https://github.com/rust-lang/rust/commit/77a307fe7dddb81f8857144a7dd7362751508090", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77a307fe7dddb81f8857144a7dd7362751508090/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6536f3165e5cd14e71bdb8f33bdc6308ab0cde85", "url": "https://api.github.com/repos/rust-lang/rust/commits/6536f3165e5cd14e71bdb8f33bdc6308ab0cde85", "html_url": "https://github.com/rust-lang/rust/commit/6536f3165e5cd14e71bdb8f33bdc6308ab0cde85"}, {"sha": "41d90709f25b813c33943102b0d28329de1aaf73", "url": "https://api.github.com/repos/rust-lang/rust/commits/41d90709f25b813c33943102b0d28329de1aaf73", "html_url": "https://github.com/rust-lang/rust/commit/41d90709f25b813c33943102b0d28329de1aaf73"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "a9ca28161cacf1f1c8d19b1933571eb5c5e3e29a", "filename": "tests/run-pass/time.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/77a307fe7dddb81f8857144a7dd7362751508090/tests%2Frun-pass%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77a307fe7dddb81f8857144a7dd7362751508090/tests%2Frun-pass%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Ftime.rs?ref=77a307fe7dddb81f8857144a7dd7362751508090", "patch": "@@ -3,16 +3,22 @@\n use std::time::{SystemTime, Instant};\n \n fn main() {\n+    // Check `SystemTime`.\n     let now1 = SystemTime::now();\n     // Do some work to make time pass.\n     for _ in 0..10 { drop(vec![42]); }\n     let now2 = SystemTime::now();\n     assert!(now2 > now1);\n     let diff = now2.duration_since(now1).unwrap();\n-    assert!(diff.as_micros() > 0);\n     assert_eq!(now1 + diff, now2);\n     assert_eq!(now2 - diff, now1);\n+    // Sanity-check the time we got.\n+    let seconds_since_epoch = now1.duration_since(SystemTime::UNIX_EPOCH).unwrap().as_secs();\n+    let years_since_epoch = seconds_since_epoch / 3600 / 24 / 365;\n+    let year = 1970 + years_since_epoch;\n+    assert!(2020 <= year && year < 2100);\n \n+    // Check `Instant`.\n     #[cfg(not(windows))] // `Instant` shims not yet implemented on Windows\n     {\n         let now1 = Instant::now();\n@@ -24,9 +30,11 @@ fn main() {\n         #[cfg(target_os = \"linux\")] // TODO: macOS does not support Instant subtraction\n         {\n             let diff = now2.duration_since(now1);\n-            assert!(diff.as_micros() > 0);\n             assert_eq!(now1 + diff, now2);\n             assert_eq!(now2 - diff, now1);\n+            // Sanity-check the difference we got.\n+            assert!(diff.as_micros() > 1);\n+            assert!(diff.as_micros() < 1_000_000);\n         }\n     }\n }"}]}