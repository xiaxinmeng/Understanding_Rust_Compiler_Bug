{"sha": "6ad0346f0b7ed04454206521db82d2976ba3981d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhZDAzNDZmMGI3ZWQwNDQ1NDIwNjUyMWRiODJkMjk3NmJhMzk4MWQ=", "commit": {"author": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2014-08-25T18:45:19Z"}, "committer": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2014-08-25T19:48:35Z"}, "message": "librustc: Restrict transmute intrinsicck to just rust-intrinsic fn's.", "tree": {"sha": "69a76a8b3db11cf714de3e5d7d88cd8b5419f965", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69a76a8b3db11cf714de3e5d7d88cd8b5419f965"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6ad0346f0b7ed04454206521db82d2976ba3981d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6ad0346f0b7ed04454206521db82d2976ba3981d", "html_url": "https://github.com/rust-lang/rust/commit/6ad0346f0b7ed04454206521db82d2976ba3981d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6ad0346f0b7ed04454206521db82d2976ba3981d/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8", "html_url": "https://github.com/rust-lang/rust/commit/5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "9b7cd44196d7a8d72b59cc3ac14983cc7960d3d2", "filename": "src/librustc/middle/intrinsicck.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6ad0346f0b7ed04454206521db82d2976ba3981d/src%2Flibrustc%2Fmiddle%2Fintrinsicck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6ad0346f0b7ed04454206521db82d2976ba3981d/src%2Flibrustc%2Fmiddle%2Fintrinsicck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fintrinsicck.rs?ref=6ad0346f0b7ed04454206521db82d2976ba3981d", "patch": "@@ -73,21 +73,25 @@ struct IntrinsicCheckingVisitor<'a> {\n \n impl<'a> IntrinsicCheckingVisitor<'a> {\n     fn def_id_is_transmute(&self, def_id: DefId) -> bool {\n+        let intrinsic = match ty::get(ty::lookup_item_type(self.tcx, def_id).ty).sty {\n+            ty::ty_bare_fn(ref bfty) => bfty.abi == RustIntrinsic,\n+            _ => return false\n+        };\n         if def_id.krate == ast::LOCAL_CRATE {\n             match self.tcx.map.get(def_id.node) {\n-                NodeForeignItem(ref item) => {\n+                NodeForeignItem(ref item) if intrinsic => {\n                     token::get_ident(item.ident) ==\n                         token::intern_and_get_ident(\"transmute\")\n                 }\n                 _ => false,\n             }\n         } else {\n             match csearch::get_item_path(self.tcx, def_id).last() {\n-                None => false,\n-                Some(ref last) => {\n+                Some(ref last) if intrinsic => {\n                     token::get_name(last.name()) ==\n                         token::intern_and_get_ident(\"transmute\")\n                 }\n+                _ => false,\n             }\n         }\n     }"}]}