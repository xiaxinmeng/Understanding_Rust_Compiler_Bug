{"sha": "99952f3be254394a5c70ce8fb8436d76c779ed71", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OTUyZjNiZTI1NDM5NGE1YzcwY2U4ZmI4NDM2ZDc2Yzc3OWVkNzE=", "commit": {"author": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-10-02T18:16:22Z"}, "committer": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-10-02T18:16:22Z"}, "message": "Fix the hover dash issues", "tree": {"sha": "1dd257a6e3813ff901a9ec70969640d58e90aee6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1dd257a6e3813ff901a9ec70969640d58e90aee6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/99952f3be254394a5c70ce8fb8436d76c779ed71", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/99952f3be254394a5c70ce8fb8436d76c779ed71", "html_url": "https://github.com/rust-lang/rust/commit/99952f3be254394a5c70ce8fb8436d76c779ed71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/99952f3be254394a5c70ce8fb8436d76c779ed71/comments", "author": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cae2e859ffbf2b435c8675838e450b66d4c6153e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cae2e859ffbf2b435c8675838e450b66d4c6153e", "html_url": "https://github.com/rust-lang/rust/commit/cae2e859ffbf2b435c8675838e450b66d4c6153e"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "72f1fd6678253d12c8f66ef5d80cab49b6ebad5b", "filename": "crates/base_db/src/fixture.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fbase_db%2Fsrc%2Ffixture.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fbase_db%2Fsrc%2Ffixture.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fbase_db%2Fsrc%2Ffixture.rs?ref=99952f3be254394a5c70ce8fb8436d76c779ed71", "patch": "@@ -154,15 +154,15 @@ impl ChangeFixture {\n             assert!(meta.path.starts_with(&source_root_prefix));\n \n             if let Some(krate) = meta.krate {\n+                let crate_name = CrateName::normalize_dashes(&krate);\n                 let crate_id = crate_graph.add_crate_root(\n                     file_id,\n                     meta.edition,\n-                    Some(krate.clone()),\n+                    Some(crate_name.clone()),\n                     meta.cfg,\n                     meta.env,\n                     Default::default(),\n                 );\n-                let crate_name = CrateName::normalize_dashes(&krate);\n                 let prev = crates.insert(crate_name.clone(), crate_id);\n                 assert!(prev.is_none());\n                 for dep in meta.deps {\n@@ -187,7 +187,7 @@ impl ChangeFixture {\n             crate_graph.add_crate_root(\n                 crate_root,\n                 Edition::Edition2018,\n-                Some(\"test\".to_string()),\n+                Some(CrateName::new(\"test\").unwrap()),\n                 default_cfg,\n                 Env::default(),\n                 Default::default(),"}, {"sha": "251a7b2456816026a4923be41312ddff07dee98c", "filename": "crates/base_db/src/input.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fbase_db%2Fsrc%2Finput.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fbase_db%2Fsrc%2Finput.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fbase_db%2Fsrc%2Finput.rs?ref=99952f3be254394a5c70ce8fb8436d76c779ed71", "patch": "@@ -130,7 +130,7 @@ pub struct CrateData {\n     /// The name to display to the end user.\n     /// This actual crate name can be different in a particular dependent crate\n     /// or may even be missing for some cases, such as a dummy crate for the code snippet.\n-    pub display_name: Option<String>,\n+    pub display_name: Option<CrateName>,\n     pub cfg_options: CfgOptions,\n     pub env: Env,\n     pub dependencies: Vec<Dependency>,\n@@ -159,7 +159,7 @@ impl CrateGraph {\n         &mut self,\n         file_id: FileId,\n         edition: Edition,\n-        display_name: Option<String>,\n+        display_name: Option<CrateName>,\n         cfg_options: CfgOptions,\n         env: Env,\n         proc_macro: Vec<(SmolStr, Arc<dyn tt::TokenExpander>)>,"}, {"sha": "f3388da32d7304658d59707287361838b9e94446", "filename": "crates/hir/src/code_model.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fhir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fhir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fcode_model.rs?ref=99952f3be254394a5c70ce8fb8436d76c779ed71", "patch": "@@ -2,7 +2,7 @@\n use std::{iter, sync::Arc};\n \n use arrayvec::ArrayVec;\n-use base_db::{CrateId, Edition, FileId};\n+use base_db::{CrateId, CrateName, Edition, FileId};\n use either::Either;\n use hir_def::{\n     adt::ReprKind,\n@@ -98,7 +98,7 @@ impl Crate {\n         db.crate_graph()[self.id].edition\n     }\n \n-    pub fn display_name(self, db: &dyn HirDatabase) -> Option<String> {\n+    pub fn display_name(self, db: &dyn HirDatabase) -> Option<CrateName> {\n         db.crate_graph()[self.id].display_name.clone()\n     }\n "}, {"sha": "d1e7602fc51e5b63dcf638bed04b7662b8d371bf", "filename": "crates/project_model/src/lib.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fproject_model%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99952f3be254394a5c70ce8fb8436d76c779ed71/crates%2Fproject_model%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Flib.rs?ref=99952f3be254394a5c70ce8fb8436d76c779ed71", "patch": "@@ -411,7 +411,7 @@ impl ProjectWorkspace {\n                             let crate_id = crate_graph.add_crate_root(\n                                 file_id,\n                                 edition,\n-                                Some(cargo[pkg].name.clone()),\n+                                Some(CrateName::normalize_dashes(&cargo[pkg].name)),\n                                 cfg_options,\n                                 env,\n                                 proc_macro.clone(),\n@@ -546,7 +546,8 @@ fn sysroot_to_crate_graph(\n \n             let env = Env::default();\n             let proc_macro = vec![];\n-            let name = sysroot[krate].name.clone();\n+            let name = CrateName::new(&sysroot[krate].name)\n+                .expect(\"Sysroot crates' names do not contain dashes\");\n             let crate_id = crate_graph.add_crate_root(\n                 file_id,\n                 Edition::Edition2018,"}]}