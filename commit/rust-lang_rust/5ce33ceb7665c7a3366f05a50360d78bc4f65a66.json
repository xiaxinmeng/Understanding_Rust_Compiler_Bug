{"sha": "5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZTMzY2ViNzY2NWM3YTMzNjZmMDVhNTAzNjBkNzhiYzRmNjVhNjY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-29T20:42:05Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-11-29T21:01:10Z"}, "message": "improve install, fix MKFILE_DEPS so it works", "tree": {"sha": "3c54c6b7f16e418bafdfb2694b184fbb17c29c11", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c54c6b7f16e418bafdfb2694b184fbb17c29c11"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "html_url": "https://github.com/rust-lang/rust/commit/5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ce33ceb7665c7a3366f05a50360d78bc4f65a66/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "865a796081e9db596d3157233e2bb848d84a5d81", "url": "https://api.github.com/repos/rust-lang/rust/commits/865a796081e9db596d3157233e2bb848d84a5d81", "html_url": "https://github.com/rust-lang/rust/commit/865a796081e9db596d3157233e2bb848d84a5d81"}], "stats": {"total": 48, "additions": 23, "deletions": 25}, "files": [{"sha": "f4ab0426159f22c3f681e85d93bb26a17e64955b", "filename": "Makefile.in", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5ce33ceb7665c7a3366f05a50360d78bc4f65a66/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/5ce33ceb7665c7a3366f05a50360d78bc4f65a66/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "patch": "@@ -49,20 +49,18 @@ STAGES = 0 1 2 3\n ######################################################################\n \n include config.mk\n-OUR_MKFILES := Makefile config.mk $(wildcard $(CFG_SRC_DIR)/mk/*.mk)\n-3RDPARTY_MKFILES := $(CFG_SRC_DIR)/src/libuv/Makefile \\\n-                    $(wildcard $(CFG_SRC_DIR)/src/libuv/*.mk)\n-GEN_MKFILES := $(wildcard $(CFG_SRC_DIR)/mk/libuv/*/*/*) \\\n-               $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*) \\\n-               $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*) \\\n-               $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*)\n-\n-MKFILES := $(OUR_MKFILES) $(3RDPARTY_MKFILES) $(GEN_MKFILES)\n \n ifdef IGNORE_MKFILES\n   MKFILE_DEPS :=\n else\n-  MKFILE_DEPS := $(MKFILES)\n+  OUR_MKFILES := Makefile config.mk $(wildcard $(CFG_SRC_DIR)/mk/*.mk)\n+  3RDPARTY_MKFILES := $(CFG_SRC_DIR)/src/libuv/Makefile \\\n+                      $(wildcard $(CFG_SRC_DIR)/src/libuv/*.mk)\n+  GEN_MKFILES := $(wildcard $(CFG_SRC_DIR)/mk/libuv/*/*/*) \\\n+                 $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*) \\\n+                 $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*) \\\n+                 $(wildcard $(CFG_SRC_DIR)/mk/libuv/mac/src/libuv/*)\n+  MKFILE_DEPS := $(OUR_MKFILES) $(3RDPARTY_MKFILES) $(GEN_MKFILES)\n endif\n \n NON_HOST_TRIPLES = $(filter-out $(CFG_HOST_TRIPLE),$(CFG_TARGET_TRIPLES))\n@@ -286,7 +284,7 @@ HSREQ$(1)_H_$(3) = \\\n \t$$(HLIB$(1)_H_$(3))/$$(CFG_RUNTIME) \\\n \t$$(HLIB$(1)_H_$(3))/$$(CFG_RUSTLLVM) \\\n \t$$(HSTDLIB_DEFAULT$(1)_H_$(3)) \\\n-\t$$(MKFILES)\n+\t$$(MKFILE_DEPS)\n \n # Prerequisites for using the stageN compiler to build target artifacts\n TSREQ$(1)_T_$(2)_H_$(3) = \\"}, {"sha": "fc69b7131d77f11521bd5ef8f81f03202cba4956", "filename": "mk/install.mk", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/5ce33ceb7665c7a3366f05a50360d78bc4f65a66/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/5ce33ceb7665c7a3366f05a50360d78bc4f65a66/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=5ce33ceb7665c7a3366f05a50360d78bc4f65a66", "patch": "@@ -7,7 +7,7 @@\n ifdef VERBOSE\n  INSTALL = cp $(1)/$(3) $(2)/$(3)\n else\n- INSTALL = @$(call E, install: $(2)/$(3)) && cp $(1)/$(3) $(2)/$(3)\n+ INSTALL = $(Q)$(call E, install: $(2)/$(3)) && cp $(1)/$(3) $(2)/$(3)\n endif\n \n # The stage we install from\n@@ -22,20 +22,20 @@ define INSTALL_TARGET_N\n   # $(2) is the host triple\n \n # T{B,L} == Target {Bin, Lib} for stage ${ISTAGE}\n-TB$(1)_H_$(2) = $$(TBIN$$(ISTAGE)_T_$(1)_H_$(2))\n-TL$(1)_H_$(2) = $$(TLIB$$(ISTAGE))_T_$(1)_H_$(2))\n+TB$(1)$(2) = $$(TBIN$$(ISTAGE)_T_$(1)_H_$(2))\n+TL$(1)$(2) = $$(TLIB$$(ISTAGE)_T_$(1)_H_$(2))\n \n # PT{R,B,L} == Prefix Target {Root, Bin, Lib}\n-PTR_T_$(1)_H_$(2) = $$(PREFIX_LIB)/rustc/$(1)\n-PTB_T_$(1)_H_$(2) = $$(PTR_T_$(1)_H_$(2))/bin\n-PTL_T_$(1)_H_$(2) = $$(PTR_T_$(1)_H_$(2))/lib\n+PTR$(1)$(2) = $$(PREFIX_LIB)/rustc/$(1)\n+PTB$(1)$(2) = $$(PTR$(1)$(2))/bin\n+PTL$(1)$(2) = $$(PTR$(1)$(2))/lib\n \n install-target-$(1)-host-$(2): $$(SREQ$$(ISTAGE)_T_$(1)_H_$(2))\n-\t$(Q)mkdir -p $$(PTL_$(1)_H_$(2))\n-\t$(Q)$(call INSTALL,$$(TL$(1)_H_$(2)),$$(PTL$(1)_H_$(2)),$$(CFG_RUNTIME))\n-\t$(Q)$(call INSTALL,$$(TL$(1)_H_$(2)),$$(PTL$(1)_H_$(2)),$$(CFG_STDLIB))\n-\t$(Q)$(call INSTALL,$$(TL$(1)_H_$(2)),$$(PTL$(1)_H_$(2)),intrinsics.bc)\n-\t$(Q)$(call INSTALL,$$(TL$(1)_H_$(2)),$$(PTL$(1)_H_$(2)),libmorestack.a)\n+\t$$(Q)mkdir -p $$(PTL$(1)$(2))\n+\t$$(Q)$$(call INSTALL,$$(TL$(1)$(2)),$$(PTL$(1)$(2)),$$(CFG_RUNTIME))\n+\t$$(Q)$$(call INSTALL,$$(TL$(1)$(2)),$$(PTL$(1)$(2)),$$(CFG_STDLIB))\n+\t$$(Q)$$(call INSTALL,$$(TL$(1)$(2)),$$(PTL$(1)$(2)),intrinsics.bc)\n+\t$$(Q)$$(call INSTALL,$$(TL$(1)$(2)),$$(PTL$(1)$(2)),libmorestack.a)\n endef\n \n $(foreach target,$(CFG_TARGET_TRIPLES), \\\n@@ -47,15 +47,15 @@ INSTALL_TARGET_RULES = $(foreach target,$(CFG_TARGET_TRIPLES), \\\n install: install-host install-targets\n \n # Shorthand for build/stageN/bin\n-HB = $(HBIN$(ISTAGE)_H_$(HT))\n+HB = $(HBIN$(ISTAGE)_H_$(CFG_HOST_TRIPLE))\n # Shorthand for build/stageN/lib\n-HL = $(HLIB$(ISTAGE)_H_$(HT))\n+HL = $(HLIB$(ISTAGE)_H_$(CFG_HOST_TRIPLE))\n # Shorthand for the prefix bin directory\n PHB = $(PREFIX_BIN)\n # Shorthand for the prefix bin directory\n PHL = $(PREFIX_LIB)\n \n-install-host: $(SREQ$(ISTAGE)$(CFG_HOST_TRIPLE))\n+install-host: $(SREQ$(ISTAGE)_T_$(CFG_HOST_TRIPLE)_H_$(CFG_HOST_TRIPLE))\n \t$(Q)mkdir -p $(PREFIX_BIN)\n \t$(Q)mkdir -p $(PREFIX_LIB)\n \t$(Q)mkdir -p $(PREFIX_ROOT)/share/man/man1"}]}