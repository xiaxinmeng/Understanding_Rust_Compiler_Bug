{"sha": "6996ae1e79cf67a53115862c1273bfbec5790496", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5OTZhZTFlNzljZjY3YTUzMTE1ODYyYzEyNzNiZmJlYzU3OTA0OTY=", "commit": {"author": {"name": "Konrad Borowski", "email": "konrad@borowski.pw", "date": "2019-12-05T12:21:51Z"}, "committer": {"name": "Konrad Borowski", "email": "konrad@borowski.pw", "date": "2019-12-05T12:44:03Z"}, "message": "Add UI test for Pin PartialEq unsoundness", "tree": {"sha": "a4724e20d5407a74da47dfef10a8d97475273904", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4724e20d5407a74da47dfef10a8d97475273904"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6996ae1e79cf67a53115862c1273bfbec5790496", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6996ae1e79cf67a53115862c1273bfbec5790496", "html_url": "https://github.com/rust-lang/rust/commit/6996ae1e79cf67a53115862c1273bfbec5790496", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6996ae1e79cf67a53115862c1273bfbec5790496/comments", "author": {"login": "xfix", "id": 1297598, "node_id": "MDQ6VXNlcjEyOTc1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xfix", "html_url": "https://github.com/xfix", "followers_url": "https://api.github.com/users/xfix/followers", "following_url": "https://api.github.com/users/xfix/following{/other_user}", "gists_url": "https://api.github.com/users/xfix/gists{/gist_id}", "starred_url": "https://api.github.com/users/xfix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xfix/subscriptions", "organizations_url": "https://api.github.com/users/xfix/orgs", "repos_url": "https://api.github.com/users/xfix/repos", "events_url": "https://api.github.com/users/xfix/events{/privacy}", "received_events_url": "https://api.github.com/users/xfix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xfix", "id": 1297598, "node_id": "MDQ6VXNlcjEyOTc1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1297598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xfix", "html_url": "https://github.com/xfix", "followers_url": "https://api.github.com/users/xfix/followers", "following_url": "https://api.github.com/users/xfix/following{/other_user}", "gists_url": "https://api.github.com/users/xfix/gists{/gist_id}", "starred_url": "https://api.github.com/users/xfix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xfix/subscriptions", "organizations_url": "https://api.github.com/users/xfix/orgs", "repos_url": "https://api.github.com/users/xfix/repos", "events_url": "https://api.github.com/users/xfix/events{/privacy}", "received_events_url": "https://api.github.com/users/xfix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dfcf764d093445d1c5eedbc7ef1f72c7fa5dcac8", "url": "https://api.github.com/repos/rust-lang/rust/commits/dfcf764d093445d1c5eedbc7ef1f72c7fa5dcac8", "html_url": "https://github.com/rust-lang/rust/commit/dfcf764d093445d1c5eedbc7ef1f72c7fa5dcac8"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "a496e58a79bdd08f5b63596d9c758b0d78164bb0", "filename": "src/test/ui/issues/issue-67039-unsound-pin-partialeq.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/6996ae1e79cf67a53115862c1273bfbec5790496/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6996ae1e79cf67a53115862c1273bfbec5790496/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.rs?ref=6996ae1e79cf67a53115862c1273bfbec5790496", "patch": "@@ -0,0 +1,27 @@\n+// Pin's PartialEq implementation allowed to access the pointer allowing for\n+// unsoundness by using Rc::get_mut to move value within Rc.\n+// See https://internals.rust-lang.org/t/unsoundness-in-pin/11311/73 for more details.\n+\n+use std::ops::Deref;\n+use std::pin::Pin;\n+use std::rc::Rc;\n+\n+struct Apple;\n+\n+impl Deref for Apple {\n+    type Target = Apple;\n+    fn deref(&self) -> &Apple {\n+        &Apple\n+    }\n+}\n+\n+impl PartialEq<Rc<Apple>> for Apple {\n+    fn eq(&self, _rc: &Rc<Apple>) -> bool {\n+        unreachable!()\n+    }\n+}\n+\n+fn main() {\n+    let _ = Pin::new(Apple) == Rc::pin(Apple);\n+    //~^ ERROR type mismatch resolving\n+}"}, {"sha": "3330d60242f1b7178d269ecfa54f86470d9aa2dc", "filename": "src/test/ui/issues/issue-67039-unsound-pin-partialeq.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6996ae1e79cf67a53115862c1273bfbec5790496/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6996ae1e79cf67a53115862c1273bfbec5790496/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-67039-unsound-pin-partialeq.stderr?ref=6996ae1e79cf67a53115862c1273bfbec5790496", "patch": "@@ -0,0 +1,13 @@\n+error[E0271]: type mismatch resolving `<std::rc::Rc<Apple> as std::ops::Deref>::Target == std::rc::Rc<Apple>`\n+  --> $DIR/issue-67039-unsound-pin-partialeq.rs:25:29\n+   |\n+LL |     let _ = Pin::new(Apple) == Rc::pin(Apple);\n+   |                             ^^ expected struct `Apple`, found struct `std::rc::Rc`\n+   |\n+   = note: expected type `Apple`\n+            found struct `std::rc::Rc<Apple>`\n+   = note: required because of the requirements on the impl of `std::cmp::PartialEq<std::pin::Pin<std::rc::Rc<Apple>>>` for `std::pin::Pin<Apple>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0271`."}]}