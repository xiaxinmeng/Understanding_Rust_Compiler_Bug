{"sha": "e0cb1ae24abb9242263d0bbf40f631bd95512406", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwY2IxYWUyNGFiYjkyNDIyNjNkMGJiZjQwZjYzMWJkOTU1MTI0MDY=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-02-07T20:33:23Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-02-08T13:37:40Z"}, "message": "Make `provided_trait_methods` use `impl Iterator`", "tree": {"sha": "f82067b613e2d807f452b8ff86ba4cf6990ea584", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f82067b613e2d807f452b8ff86ba4cf6990ea584"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e0cb1ae24abb9242263d0bbf40f631bd95512406", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e0cb1ae24abb9242263d0bbf40f631bd95512406", "html_url": "https://github.com/rust-lang/rust/commit/e0cb1ae24abb9242263d0bbf40f631bd95512406", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e0cb1ae24abb9242263d0bbf40f631bd95512406/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52f77110d455b6b946ae0ca36a4671bdd9b7e145", "url": "https://api.github.com/repos/rust-lang/rust/commits/52f77110d455b6b946ae0ca36a4671bdd9b7e145", "html_url": "https://github.com/rust-lang/rust/commit/52f77110d455b6b946ae0ca36a4671bdd9b7e145"}], "stats": {"total": 26, "additions": 9, "deletions": 17}, "files": [{"sha": "0118fc4c8ac8421a35427106b33578ffa73e0aef", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=e0cb1ae24abb9242263d0bbf40f631bd95512406", "patch": "@@ -2705,11 +2705,10 @@ impl<'tcx> TyCtxt<'tcx> {\n             .for_each(|&body_id| f(self.hir().body_owner_def_id(body_id)));\n     }\n \n-    pub fn provided_trait_methods(self, id: DefId) -> Vec<&'tcx AssocItem> {\n+    pub fn provided_trait_methods(self, id: DefId) -> impl Iterator<Item = &'tcx AssocItem> {\n         self.associated_items(id)\n             .iter()\n             .filter(|item| item.kind == AssocKind::Method && item.defaultness.has_value())\n-            .collect()\n     }\n \n     pub fn trait_relevant_for_never(self, did: DefId) -> bool {"}, {"sha": "888f4370dd5e80d127ed2e512784847f7a05e994", "filename": "src/librustc_passes/reachable.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustc_passes%2Freachable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustc_passes%2Freachable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Freachable.rs?ref=e0cb1ae24abb9242263d0bbf40f631bd95512406", "patch": "@@ -362,12 +362,12 @@ impl<'a, 'tcx> ItemLikeVisitor<'tcx> for CollectPrivateImplItemsVisitor<'a, 'tcx\n                     return;\n                 }\n \n-                let provided_trait_methods = self.tcx.provided_trait_methods(trait_def_id);\n-                self.worklist.reserve(provided_trait_methods.len());\n-                for default_method in provided_trait_methods {\n-                    let hir_id = self.tcx.hir().as_local_hir_id(default_method.def_id).unwrap();\n-                    self.worklist.push(hir_id);\n-                }\n+                // FIXME(#53488) remove `let`\n+                let tcx = self.tcx;\n+                self.worklist.extend(\n+                    tcx.provided_trait_methods(trait_def_id)\n+                        .map(|assoc| tcx.hir().as_local_hir_id(assoc.def_id).unwrap()),\n+                );\n             }\n         }\n     }"}, {"sha": "288446b6219cea21533ec96ed5c7a7a8d5499b3c", "filename": "src/librustdoc/clean/blanket_impl.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fblanket_impl.rs?ref=e0cb1ae24abb9242263d0bbf40f631bd95512406", "patch": "@@ -87,7 +87,6 @@ impl<'a, 'tcx> BlanketImplFinder<'a, 'tcx> {\n                     .cx\n                     .tcx\n                     .provided_trait_methods(trait_def_id)\n-                    .into_iter()\n                     .map(|meth| meth.ident.to_string())\n                     .collect();\n "}, {"sha": "90ce8802f65845d7dfbc0722b441bfdd337bf033", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=e0cb1ae24abb9242263d0bbf40f631bd95512406", "patch": "@@ -402,9 +402,7 @@ pub fn build_impl(\n \n     let provided = trait_\n         .def_id()\n-        .map(|did| {\n-            tcx.provided_trait_methods(did).into_iter().map(|meth| meth.ident.to_string()).collect()\n-        })\n+        .map(|did| tcx.provided_trait_methods(did).map(|meth| meth.ident.to_string()).collect())\n         .unwrap_or_default();\n \n     debug!(\"build_impl: impl {:?} for {:?}\", trait_.def_id(), for_.def_id());"}, {"sha": "87edc88611f3ab64a2868784bab79450f05905df", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e0cb1ae24abb9242263d0bbf40f631bd95512406/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=e0cb1ae24abb9242263d0bbf40f631bd95512406", "patch": "@@ -2108,11 +2108,7 @@ impl Clean<Vec<Item>> for doctree::Impl<'_> {\n         let provided: FxHashSet<String> = trait_\n             .def_id()\n             .map(|did| {\n-                cx.tcx\n-                    .provided_trait_methods(did)\n-                    .into_iter()\n-                    .map(|meth| meth.ident.to_string())\n-                    .collect()\n+                cx.tcx.provided_trait_methods(did).map(|meth| meth.ident.to_string()).collect()\n             })\n             .unwrap_or_default();\n "}]}