{"sha": "654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1NGQwNTk2ZDNmMjFjOGY3NzRjOTUzMjRiZjc5ZTVkNmZiYjc1ZDQ=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-05-29T20:58:55Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-05-31T15:23:03Z"}, "message": "rustc_codegen_utils: test demangler output, not just symbol names.", "tree": {"sha": "5820099a48e1e98ecda66c9e0e9cfe7ef7e5bd39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5820099a48e1e98ecda66c9e0e9cfe7ef7e5bd39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "html_url": "https://github.com/rust-lang/rust/commit/654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e89890514149d31872ba486bbce2f762a2d99f88", "url": "https://api.github.com/repos/rust-lang/rust/commits/e89890514149d31872ba486bbce2f762a2d99f88", "html_url": "https://github.com/rust-lang/rust/commit/e89890514149d31872ba486bbce2f762a2d99f88"}], "stats": {"total": 91, "additions": 78, "deletions": 13}, "files": [{"sha": "5a981b3f08fef0ef6710ba5d7e117b9ab411b3e6", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -2688,6 +2688,7 @@ dependencies = [\n  \"flate2 1.0.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n+ \"rustc-demangle 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_data_structures 0.0.0\",\n  \"rustc_metadata 0.0.0\",\n  \"rustc_mir 0.0.0\","}, {"sha": "531c5abb147275cdee3ffd2661ae754b6ea87583", "filename": "src/librustc_codegen_utils/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Flibrustc_codegen_utils%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Flibrustc_codegen_utils%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2FCargo.toml?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -13,6 +13,7 @@ test = false\n [dependencies]\n flate2 = \"1.0\"\n log = \"0.4\"\n+rustc-demangle = \"0.1.15\"\n \n syntax = { path = \"../libsyntax\" }\n syntax_pos = { path = \"../libsyntax_pos\" }"}, {"sha": "b935ccb7398e23e33407343ffa7a991bffbaa1fb", "filename": "src/librustc_codegen_utils/symbol_names_test.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Flibrustc_codegen_utils%2Fsymbol_names_test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Flibrustc_codegen_utils%2Fsymbol_names_test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names_test.rs?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -39,8 +39,12 @@ impl<'a, 'tcx> SymbolNamesTest<'a, 'tcx> {\n             if attr.check_name(SYMBOL_NAME) {\n                 // for now, can only use on monomorphic names\n                 let instance = Instance::mono(tcx, def_id);\n-                let name = self.tcx.symbol_name(instance);\n-                tcx.sess.span_err(attr.span, &format!(\"symbol-name({})\", name));\n+                let mangled = self.tcx.symbol_name(instance);\n+                tcx.sess.span_err(attr.span, &format!(\"symbol-name({})\", mangled));\n+                if let Ok(demangling) = rustc_demangle::try_demangle(&mangled.as_str()) {\n+                    tcx.sess.span_err(attr.span, &format!(\"demangling({})\", demangling));\n+                    tcx.sess.span_err(attr.span, &format!(\"demangling-alt({:#})\", demangling));\n+                }\n             } else if attr.check_name(DEF_PATH) {\n                 let path = tcx.def_path_str(def_id);\n                 tcx.sess.span_err(attr.span, &format!(\"def-path({})\", path));"}, {"sha": "1459ac014ea35822001f587456fafcab762d342f", "filename": "src/test/ui/symbol-names/basic.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.rs?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -1,6 +1,9 @@\n #![feature(rustc_attrs)]\n \n-#[rustc_symbol_name] //~ ERROR _ZN5basic4main\n+#[rustc_symbol_name]\n+//~^ ERROR symbol-name(_ZN5basic4main\n+//~| ERROR demangling(basic::main\n+//~| ERROR demangling-alt(basic::main)\n #[rustc_def_path] //~ ERROR def-path(main)\n fn main() {\n }"}, {"sha": "ebb8b4390d28dc067fd0a68f6f98bb6bd4086fb6", "filename": "src/test/ui/symbol-names/basic.stderr", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fbasic.stderr?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -4,11 +4,23 @@ error: symbol-name(_ZN5basic4main17hd72940ef9669d526E)\n LL | #[rustc_symbol_name]\n    | ^^^^^^^^^^^^^^^^^^^^\n \n+error: demangling(basic::main::hd72940ef9669d526)\n+  --> $DIR/basic.rs:3:1\n+   |\n+LL | #[rustc_symbol_name]\n+   | ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(basic::main)\n+  --> $DIR/basic.rs:3:1\n+   |\n+LL | #[rustc_symbol_name]\n+   | ^^^^^^^^^^^^^^^^^^^^\n+\n error: def-path(main)\n-  --> $DIR/basic.rs:4:1\n+  --> $DIR/basic.rs:7:1\n    |\n LL | #[rustc_def_path]\n    | ^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 4 previous errors\n "}, {"sha": "803fa856b60cf8d92e3d7438b822aefb89b234df", "filename": "src/test/ui/symbol-names/impl1.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -5,7 +5,10 @@ mod foo {\n     pub struct Foo { x: u32 }\n \n     impl Foo {\n-        #[rustc_symbol_name] //~ ERROR _ZN5impl13foo3Foo3bar\n+        #[rustc_symbol_name]\n+        //~^ ERROR symbol-name(_ZN5impl13foo3Foo3bar\n+        //~| ERROR demangling(impl1::foo::Foo::bar\n+        //~| ERROR demangling-alt(impl1::foo::Foo::bar)\n         #[rustc_def_path] //~ ERROR def-path(foo::Foo::bar)\n         fn bar() { }\n     }\n@@ -15,7 +18,10 @@ mod bar {\n     use foo::Foo;\n \n     impl Foo {\n-        #[rustc_symbol_name] //~ ERROR _ZN5impl13bar33_$LT$impl$u20$impl1..foo..Foo$GT$3baz\n+        #[rustc_symbol_name]\n+        //~^ ERROR symbol-name(_ZN5impl13bar33_$LT$impl$u20$impl1..foo..Foo$GT$3baz\n+        //~| ERROR demangling(impl1::bar::<impl impl1::foo::Foo>::baz\n+        //~| ERROR demangling-alt(impl1::bar::<impl impl1::foo::Foo>::baz)\n         #[rustc_def_path] //~ ERROR def-path(bar::<impl foo::Foo>::baz)\n         fn baz() { }\n     }"}, {"sha": "3a7d540c4882dff1c7fa2c3db53db3223df6b38e", "filename": "src/test/ui/symbol-names/impl1.stderr", "status": "modified", "additions": 28, "deletions": 4, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.stderr?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -4,23 +4,47 @@ error: symbol-name(_ZN5impl13foo3Foo3bar17he53b9bee7600ed8dE)\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n+error: demangling(impl1::foo::Foo::bar::he53b9bee7600ed8d)\n+  --> $DIR/impl1.rs:8:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(impl1::foo::Foo::bar)\n+  --> $DIR/impl1.rs:8:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n error: def-path(foo::Foo::bar)\n-  --> $DIR/impl1.rs:9:9\n+  --> $DIR/impl1.rs:12:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n error: symbol-name(_ZN5impl13bar33_$LT$impl$u20$impl1..foo..Foo$GT$3baz17h86c41f0462d901d4E)\n-  --> $DIR/impl1.rs:18:9\n+  --> $DIR/impl1.rs:21:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling(impl1::bar::<impl impl1::foo::Foo>::baz::h86c41f0462d901d4)\n+  --> $DIR/impl1.rs:21:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(impl1::bar::<impl impl1::foo::Foo>::baz)\n+  --> $DIR/impl1.rs:21:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: def-path(bar::<impl foo::Foo>::baz)\n-  --> $DIR/impl1.rs:19:9\n+  --> $DIR/impl1.rs:25:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 8 previous errors\n "}, {"sha": "22efa978bd2b62f90a062e3c7847c8ea32508baa", "filename": "src/test/ui/symbol-names/issue-60925.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -14,7 +14,9 @@ mod foo {\n \n     impl Foo<::llvm::Foo> {\n         #[rustc_symbol_name]\n-//~^ ERROR _ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo17h059a991a004536adE\n+        //~^ ERROR symbol-name(_ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo\n+        //~| ERROR demangling(issue_60925::foo::Foo<issue_60925::llv$6d$..Foo$GT$::foo\n+        //~| ERROR demangling-alt(issue_60925::foo::Foo<issue_60925::llv$6d$..Foo$GT$::foo)\n         pub(crate) fn foo() {\n             for _ in 0..0 {\n                 for _ in &[::dummy()] {"}, {"sha": "ae753f0cebbcdf7b4f36c2bebbac69b3762ece10", "filename": "src/test/ui/symbol-names/issue-60925.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/654d0596d3f21c8f774c95324bf79e5d6fbb75d4/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr?ref=654d0596d3f21c8f774c95324bf79e5d6fbb75d4", "patch": "@@ -4,5 +4,17 @@ error: symbol-name(_ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3fo\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to previous error\n+error: demangling(issue_60925::foo::Foo<issue_60925::llv$6d$..Foo$GT$::foo::h059a991a004536ad)\n+  --> $DIR/issue-60925.rs:16:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(issue_60925::foo::Foo<issue_60925::llv$6d$..Foo$GT$::foo)\n+  --> $DIR/issue-60925.rs:16:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 3 previous errors\n "}]}