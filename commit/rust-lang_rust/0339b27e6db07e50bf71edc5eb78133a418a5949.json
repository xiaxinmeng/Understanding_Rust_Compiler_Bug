{"sha": "0339b27e6db07e50bf71edc5eb78133a418a5949", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzMzliMjdlNmRiMDdlNTBiZjcxZWRjNWViNzgxMzNhNDE4YTU5NDk=", "commit": {"author": {"name": "Cameron Zwarich", "email": "zwarich@mozilla.com", "date": "2014-06-06T18:59:32Z"}, "committer": {"name": "Cameron Zwarich", "email": "zwarich@mozilla.com", "date": "2014-06-06T18:59:32Z"}, "message": "Fix mem_categorization to treat an AutoObject adjustment as an rvalue.\n\nCurrently mem_categorization categorizes an AutoObject adjustment the\nsame as the original expression. This can cause two moves to be\ngenerated for the same underlying expression. Currently this isn't a\nproblem in practice, since check_loans doesn't rely on ExprUseVisitor.", "tree": {"sha": "f80ce3f9f982e9e3a2b2c9e3bdca0e04253b3aa7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f80ce3f9f982e9e3a2b2c9e3bdca0e04253b3aa7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0339b27e6db07e50bf71edc5eb78133a418a5949", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0339b27e6db07e50bf71edc5eb78133a418a5949", "html_url": "https://github.com/rust-lang/rust/commit/0339b27e6db07e50bf71edc5eb78133a418a5949", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0339b27e6db07e50bf71edc5eb78133a418a5949/comments", "author": null, "committer": null, "parents": [{"sha": "d123188b20222c8fc5fbc386bd15100b6f3c80ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/d123188b20222c8fc5fbc386bd15100b6f3c80ed", "html_url": "https://github.com/rust-lang/rust/commit/d123188b20222c8fc5fbc386bd15100b6f3c80ed"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "240212699e4de314cc36063faae2f48c1061b448", "filename": "src/librustc/middle/mem_categorization.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0339b27e6db07e50bf71edc5eb78133a418a5949/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0339b27e6db07e50bf71edc5eb78133a418a5949/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fmem_categorization.rs?ref=0339b27e6db07e50bf71edc5eb78133a418a5949", "patch": "@@ -390,12 +390,10 @@ impl<'t,TYPER:Typer> MemCategorizationContext<'t,TYPER> {\n             Some(adjustment) => {\n                 match *adjustment {\n                     ty::AutoObject(..) => {\n-                        // Implicity casts a concrete object to trait object\n-                        // so just patch up the type\n+                        // Implicity cast a concrete object to trait object.\n+                        // Result is an rvalue.\n                         let expr_ty = if_ok!(self.expr_ty_adjusted(expr));\n-                        let mut expr_cmt = (*if_ok!(self.cat_expr_unadjusted(expr))).clone();\n-                        expr_cmt.ty = expr_ty;\n-                        Ok(Rc::new(expr_cmt))\n+                        Ok(self.cat_rvalue_node(expr.id(), expr.span(), expr_ty))\n                     }\n \n                     ty::AutoAddEnv(..) => {"}]}