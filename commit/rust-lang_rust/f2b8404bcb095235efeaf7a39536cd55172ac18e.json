{"sha": "f2b8404bcb095235efeaf7a39536cd55172ac18e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyYjg0MDRiY2IwOTUyMzVlZmVhZjdhMzk1MzZjZDU1MTcyYWMxOGU=", "commit": {"author": {"name": "Oliver Schneider", "email": "git1984941651981@oli-obk.de", "date": "2015-01-16T09:49:35Z"}, "committer": {"name": "Oliver Schneider", "email": "git1984941651981@oli-obk.de", "date": "2015-01-20T13:18:17Z"}, "message": "prettier Buffer::read_until", "tree": {"sha": "add4fa880e8d82ea08df8fad0f6c16e9aa12a53f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/add4fa880e8d82ea08df8fad0f6c16e9aa12a53f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2b8404bcb095235efeaf7a39536cd55172ac18e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2b8404bcb095235efeaf7a39536cd55172ac18e", "html_url": "https://github.com/rust-lang/rust/commit/f2b8404bcb095235efeaf7a39536cd55172ac18e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2b8404bcb095235efeaf7a39536cd55172ac18e/comments", "author": null, "committer": null, "parents": [{"sha": "3bf41dafcfb6c979efb4e2438e047e1a54045eec", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bf41dafcfb6c979efb4e2438e047e1a54045eec", "html_url": "https://github.com/rust-lang/rust/commit/3bf41dafcfb6c979efb4e2438e047e1a54045eec"}], "stats": {"total": 18, "additions": 8, "deletions": 10}, "files": [{"sha": "88be8d1189efff6c245ed6535e2f1b132aadb5b0", "filename": "src/libstd/io/mod.rs", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/f2b8404bcb095235efeaf7a39536cd55172ac18e/src%2Flibstd%2Fio%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2b8404bcb095235efeaf7a39536cd55172ac18e/src%2Flibstd%2Fio%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fmod.rs?ref=f2b8404bcb095235efeaf7a39536cd55172ac18e", "patch": "@@ -1436,33 +1436,31 @@ pub trait Buffer: Reader {\n     fn read_until(&mut self, byte: u8) -> IoResult<Vec<u8>> {\n         let mut res = Vec::new();\n \n-        let mut used;\n         loop {\n-            {\n+            let (done, used) = {\n                 let available = match self.fill_buf() {\n                     Ok(n) => n,\n                     Err(ref e) if res.len() > 0 && e.kind == EndOfFile => {\n-                        used = 0;\n-                        break\n+                        return Ok(res);\n                     }\n                     Err(e) => return Err(e)\n                 };\n                 match available.iter().position(|&b| b == byte) {\n                     Some(i) => {\n                         res.push_all(&available[..(i + 1)]);\n-                        used = i + 1;\n-                        break\n+                        (true, i + 1)\n                     }\n                     None => {\n                         res.push_all(available);\n-                        used = available.len();\n+                        (false, available.len())\n                     }\n                 }\n+            };\n+            buffer.consume(used);\n+            if done {\n+                return Ok(res);\n             }\n-            self.consume(used);\n         }\n-        self.consume(used);\n-        Ok(res)\n     }\n \n     /// Reads the next utf8-encoded character from the underlying stream."}]}