{"sha": "37cb6805afc397adf769391cec99b2e11d0d52e0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3Y2I2ODA1YWZjMzk3YWRmNzY5MzkxY2VjOTliMmUxMWQwZDUyZTA=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2021-04-08T16:32:20Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2021-04-08T20:48:47Z"}, "message": "Intern types\n\nPerformance about the same, memory reduced by ~5%.", "tree": {"sha": "4fa7eb0e13bfd254ff9b6bb09d7af4d1b996551a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4fa7eb0e13bfd254ff9b6bb09d7af4d1b996551a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/37cb6805afc397adf769391cec99b2e11d0d52e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/37cb6805afc397adf769391cec99b2e11d0d52e0", "html_url": "https://github.com/rust-lang/rust/commit/37cb6805afc397adf769391cec99b2e11d0d52e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/37cb6805afc397adf769391cec99b2e11d0d52e0/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be03db0e3a75533f34d48c3014d532919b30a9e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/be03db0e3a75533f34d48c3014d532919b30a9e9", "html_url": "https://github.com/rust-lang/rust/commit/be03db0e3a75533f34d48c3014d532919b30a9e9"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "83787b8c0dc903000b225be8cbeacdb098204efc", "filename": "crates/hir_ty/src/traits/chalk/interner.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/37cb6805afc397adf769391cec99b2e11d0d52e0/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Finterner.rs", "raw_url": "https://github.com/rust-lang/rust/raw/37cb6805afc397adf769391cec99b2e11d0d52e0/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Finterner.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftraits%2Fchalk%2Finterner.rs?ref=37cb6805afc397adf769391cec99b2e11d0d52e0", "patch": "@@ -36,13 +36,17 @@ pub struct InternedVariableKindsInner(Vec<chalk_ir::VariableKind<Interner>>);\n #[derive(PartialEq, Eq, Hash, Debug)]\n pub struct InternedSubstitutionInner(SmallVec<[GenericArg; 2]>);\n \n+#[derive(PartialEq, Eq, Hash, Debug)]\n+pub struct InternedTypeInner(chalk_ir::TyData<Interner>);\n+\n impl_internable!(\n     InternedVariableKindsInner,\n     InternedSubstitutionInner,\n+    InternedTypeInner,\n );\n \n impl chalk_ir::interner::Interner for Interner {\n-    type InternedType = Arc<chalk_ir::TyData<Self>>;\n+    type InternedType = Interned<InternedTypeInner>;\n     type InternedLifetime = chalk_ir::LifetimeData<Self>;\n     type InternedConst = Arc<chalk_ir::ConstData<Self>>;\n     type InternedConcreteConst = ();\n@@ -209,11 +213,11 @@ impl chalk_ir::interner::Interner for Interner {\n \n     fn intern_ty(&self, kind: chalk_ir::TyKind<Self>) -> Self::InternedType {\n         let flags = kind.compute_flags(self);\n-        Arc::new(chalk_ir::TyData { kind, flags })\n+        Interned::new(InternedTypeInner(chalk_ir::TyData { kind, flags }))\n     }\n \n     fn ty_data<'a>(&self, ty: &'a Self::InternedType) -> &'a chalk_ir::TyData<Self> {\n-        ty\n+        &ty.0\n     }\n \n     fn intern_lifetime(&self, lifetime: chalk_ir::LifetimeData<Self>) -> Self::InternedLifetime {"}]}