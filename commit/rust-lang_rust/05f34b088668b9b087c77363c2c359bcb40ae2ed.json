{"sha": "05f34b088668b9b087c77363c2c359bcb40ae2ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1ZjM0YjA4ODY2OGI5YjA4N2M3NzM2M2MyYzM1OWJjYjQwYWUyZWQ=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-20T22:17:08Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-20T22:17:08Z"}, "message": "Adjust llasm, llabi to be aware of changes to rust_task structure. Still not working fully.", "tree": {"sha": "78359419990a790e28fee9d67075679714fa96f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/78359419990a790e28fee9d67075679714fa96f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/05f34b088668b9b087c77363c2c359bcb40ae2ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/05f34b088668b9b087c77363c2c359bcb40ae2ed", "html_url": "https://github.com/rust-lang/rust/commit/05f34b088668b9b087c77363c2c359bcb40ae2ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/05f34b088668b9b087c77363c2c359bcb40ae2ed/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9935a48e95e1a56b64f08e42abfae496f2906705", "url": "https://api.github.com/repos/rust-lang/rust/commits/9935a48e95e1a56b64f08e42abfae496f2906705", "html_url": "https://github.com/rust-lang/rust/commit/9935a48e95e1a56b64f08e42abfae496f2906705"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "08966efca7a77c2ca8f3c949492c9659b640182e", "filename": "src/boot/llvm/llabi.ml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/05f34b088668b9b087c77363c2c359bcb40ae2ed/src%2Fboot%2Fllvm%2Fllabi.ml", "raw_url": "https://github.com/rust-lang/rust/raw/05f34b088668b9b087c77363c2c359bcb40ae2ed/src%2Fboot%2Fllvm%2Fllabi.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fllvm%2Fllabi.ml?ref=05f34b088668b9b087c77363c2c359bcb40ae2ed", "patch": "@@ -43,6 +43,7 @@ let declare_abi (llctx:Llvm.llcontext) (llmod:Llvm.llmodule) : abi =\n     (* TODO: other architectures besides x86 *)\n     Llvm.struct_type llctx [|\n       i32;                    (* size_t refcnt *)\n+      Llvm.pointer_type i32;  (* rust_task *_delegate *)\n       Llvm.pointer_type i32;  (* stk_seg *stk *)\n       Llvm.pointer_type i32;  (* uintptr_t runtime_sp *)\n       Llvm.pointer_type i32;  (* uintptr_t rust_sp *)"}, {"sha": "5b66989d178bb346602fef01984056cb4d4b400d", "filename": "src/boot/llvm/llasm.ml", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/05f34b088668b9b087c77363c2c359bcb40ae2ed/src%2Fboot%2Fllvm%2Fllasm.ml", "raw_url": "https://github.com/rust-lang/rust/raw/05f34b088668b9b087c77363c2c359bcb40ae2ed/src%2Fboot%2Fllvm%2Fllasm.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fllvm%2Fllasm.ml?ref=05f34b088668b9b087c77363c2c359bcb40ae2ed", "patch": "@@ -41,10 +41,23 @@ let x86_glue\n      \"popl  %edi\";\n      \"popl  %ebp\";]\n   in\n-  let load_esp_from_rust_sp    = [\"movl  12(%edx), %esp\"] in\n-  let load_esp_from_runtime_sp = [\"movl   8(%edx), %esp\"] in\n-  let store_esp_to_rust_sp     = [\"movl  %esp, 12(%edx)\"] in\n-  let store_esp_to_runtime_sp  = [\"movl  %esp,  8(%edx)\"] in\n+  let load_esp_from_rust_sp =\n+    [ Printf.sprintf \"movl  %d(%%edx), %%esp\"\n+        (Abi.task_field_rust_sp * 4)]\n+  in\n+  let load_esp_from_runtime_sp =\n+    [ Printf.sprintf \"movl  %d(%%edx), %%esp\"\n+        (Abi.task_field_runtime_sp * 4) ]\n+  in\n+  let store_esp_to_rust_sp     =\n+    [ Printf.sprintf \"movl  %%esp, %d(%%edx)\"\n+        (Abi.task_field_rust_sp * 4) ]\n+  in\n+  let store_esp_to_runtime_sp  =\n+    [ Printf.sprintf \"movl  %%esp, %d(%%edx)\"\n+        (Abi.task_field_runtime_sp * 4) ]\n+  in\n+\n   let list_init i f = (Array.to_list (Array.init i f)) in\n   let list_init_concat i f = List.concat (list_init i f) in\n "}]}