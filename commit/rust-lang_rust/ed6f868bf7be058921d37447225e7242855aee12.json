{"sha": "ed6f868bf7be058921d37447225e7242855aee12", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkNmY4NjhiZjdiZTA1ODkyMWQzNzQ0NzIyNWU3MjQyODU1YWVlMTI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-08-28T23:50:25Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-09-05T14:37:11Z"}, "message": "rustc: Move `impl_defaultness` to a query", "tree": {"sha": "3d6daf2a56e16091b84efc854d2e6e954b60aeaa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d6daf2a56e16091b84efc854d2e6e954b60aeaa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed6f868bf7be058921d37447225e7242855aee12", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed6f868bf7be058921d37447225e7242855aee12", "html_url": "https://github.com/rust-lang/rust/commit/ed6f868bf7be058921d37447225e7242855aee12", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed6f868bf7be058921d37447225e7242855aee12/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dff0c074e467a1fbbeab44ffbd8da4882683b694", "url": "https://api.github.com/repos/rust-lang/rust/commits/dff0c074e467a1fbbeab44ffbd8da4882683b694", "html_url": "https://github.com/rust-lang/rust/commit/dff0c074e467a1fbbeab44ffbd8da4882683b694"}], "stats": {"total": 18, "additions": 4, "deletions": 14}, "files": [{"sha": "f7798fdad7ef5a4f773726fc24e61e8fe2084222", "filename": "src/librustc/dep_graph/dep_node.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs?ref=ed6f868bf7be058921d37447225e7242855aee12", "patch": "@@ -534,6 +534,7 @@ define_dep_nodes!( <'tcx>\n     [] IsProfilerRuntime(CrateNum),\n     [] GetPanicStrategy(CrateNum),\n     [] IsNoBuiltins(CrateNum),\n+    [] ImplDefaultness(DefId),\n );\n \n trait DepNodeParams<'a, 'gcx: 'tcx + 'a, 'tcx: 'a> : fmt::Debug {"}, {"sha": "8bcd76f405481cf71bce0b64c3fe44c2d8013424", "filename": "src/librustc/middle/cstore.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fmiddle%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcstore.rs?ref=ed6f868bf7be058921d37447225e7242855aee12", "patch": "@@ -236,9 +236,6 @@ pub trait CrateStore {\n     // trait info\n     fn implementations_of_trait(&self, filter: Option<DefId>) -> Vec<DefId>;\n \n-    // impl info\n-    fn impl_defaultness(&self, def: DefId) -> hir::Defaultness;\n-\n     // trait/impl-item info\n     fn associated_item_cloned(&self, def: DefId) -> ty::AssociatedItem;\n \n@@ -342,9 +339,6 @@ impl CrateStore for DummyCrateStore {\n     // trait info\n     fn implementations_of_trait(&self, filter: Option<DefId>) -> Vec<DefId> { vec![] }\n \n-    // impl info\n-    fn impl_defaultness(&self, def: DefId) -> hir::Defaultness { bug!(\"impl_defaultness\") }\n-\n     // trait/impl-item info\n     fn associated_item_cloned(&self, def: DefId) -> ty::AssociatedItem\n         { bug!(\"associated_item_cloned\") }"}, {"sha": "b0d6f4d5a31305f35a57802cf85af6bc7f07ade4", "filename": "src/librustc/traits/util.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Ftraits%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Ftraits%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Futil.rs?ref=ed6f868bf7be058921d37447225e7242855aee12", "patch": "@@ -538,8 +538,6 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n             }\n             None => {\n                 self.global_tcx()\n-                    .sess\n-                    .cstore\n                     .impl_defaultness(node_item_def_id)\n                     .is_default()\n             }"}, {"sha": "27d947654a4762e2d9902e6e0d754228157cb9d0", "filename": "src/librustc/ty/maps.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fty%2Fmaps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc%2Fty%2Fmaps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps.rs?ref=ed6f868bf7be058921d37447225e7242855aee12", "patch": "@@ -1161,6 +1161,8 @@ define_maps! { <'tcx>\n     [] fn in_scope_traits: InScopeTraits(HirId) -> Option<Rc<Vec<TraitCandidate>>>,\n     [] fn module_exports: ModuleExports(HirId) -> Option<Rc<Vec<Export>>>,\n     [] fn lint_levels: lint_levels_node(CrateNum) -> Rc<lint::LintLevelMap>,\n+\n+    [] fn impl_defaultness: ImplDefaultness(DefId) -> hir::Defaultness,\n }\n \n fn type_param_predicates<'tcx>((item_id, param_id): (DefId, DefId)) -> DepConstructor<'tcx> {"}, {"sha": "8710eb2ac41e4e61b7d1d4204afb039fdb751017", "filename": "src/librustc_metadata/cstore_impl.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc_metadata%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6f868bf7be058921d37447225e7242855aee12/src%2Flibrustc_metadata%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fcstore_impl.rs?ref=ed6f868bf7be058921d37447225e7242855aee12", "patch": "@@ -162,6 +162,7 @@ provide! { <'tcx> tcx, def_id, cdata,\n     panic_strategy => { cdata.panic_strategy(&tcx.dep_graph) }\n     extern_crate => { Rc::new(cdata.extern_crate.get()) }\n     is_no_builtins => { cdata.is_no_builtins(&tcx.dep_graph) }\n+    impl_defaultness => { cdata.get_impl_defaultness(def_id.index) }\n }\n \n pub fn provide_local<'tcx>(providers: &mut Providers<'tcx>) {\n@@ -211,12 +212,6 @@ impl CrateStore for cstore::CStore {\n         result\n     }\n \n-    fn impl_defaultness(&self, def: DefId) -> hir::Defaultness\n-    {\n-        self.read_dep_node(def);\n-        self.get_crate_data(def.krate).get_impl_defaultness(def.index)\n-    }\n-\n     fn associated_item_cloned(&self, def: DefId) -> ty::AssociatedItem\n     {\n         self.read_dep_node(def);"}]}