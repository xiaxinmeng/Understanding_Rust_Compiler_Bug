{"sha": "fd075c6f2144b33385a596b36eece02ed5d8be62", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkMDc1YzZmMjE0NGIzMzM4NWE1OTZiMzZlZWNlMDJlZDVkOGJlNjI=", "commit": {"author": {"name": "Pulkit Goyal", "email": "7895pulkit@gmail.com", "date": "2018-01-16T09:07:05Z"}, "committer": {"name": "Pulkit Goyal", "email": "7895pulkit@gmail.com", "date": "2018-01-16T09:07:05Z"}, "message": "implement \"only-<platforms>\" for test headers\n\nThis patch implements \"only-<platforms>\" for tests headers using which one can\nspecify just the platforms on which the test should run rather than listing all\nthe platforms to ignore using \"ignore-<platforms>\".\n\nThis is a fix for issues #33581 and #47459.", "tree": {"sha": "59a9bdeb5c463d143125e6b0986bd7b5af86ba4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59a9bdeb5c463d143125e6b0986bd7b5af86ba4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd075c6f2144b33385a596b36eece02ed5d8be62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd075c6f2144b33385a596b36eece02ed5d8be62", "html_url": "https://github.com/rust-lang/rust/commit/fd075c6f2144b33385a596b36eece02ed5d8be62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd075c6f2144b33385a596b36eece02ed5d8be62/comments", "author": {"login": "Pulkit07", "id": 8902250, "node_id": "MDQ6VXNlcjg5MDIyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/8902250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pulkit07", "html_url": "https://github.com/Pulkit07", "followers_url": "https://api.github.com/users/Pulkit07/followers", "following_url": "https://api.github.com/users/Pulkit07/following{/other_user}", "gists_url": "https://api.github.com/users/Pulkit07/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pulkit07/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pulkit07/subscriptions", "organizations_url": "https://api.github.com/users/Pulkit07/orgs", "repos_url": "https://api.github.com/users/Pulkit07/repos", "events_url": "https://api.github.com/users/Pulkit07/events{/privacy}", "received_events_url": "https://api.github.com/users/Pulkit07/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Pulkit07", "id": 8902250, "node_id": "MDQ6VXNlcjg5MDIyNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/8902250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pulkit07", "html_url": "https://github.com/Pulkit07", "followers_url": "https://api.github.com/users/Pulkit07/followers", "following_url": "https://api.github.com/users/Pulkit07/following{/other_user}", "gists_url": "https://api.github.com/users/Pulkit07/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pulkit07/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pulkit07/subscriptions", "organizations_url": "https://api.github.com/users/Pulkit07/orgs", "repos_url": "https://api.github.com/users/Pulkit07/repos", "events_url": "https://api.github.com/users/Pulkit07/events{/privacy}", "received_events_url": "https://api.github.com/users/Pulkit07/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "79a521bb9a8ace1a6663578a4c409906adde620d", "url": "https://api.github.com/repos/rust-lang/rust/commits/79a521bb9a8ace1a6663578a4c409906adde620d", "html_url": "https://github.com/rust-lang/rust/commit/79a521bb9a8ace1a6663578a4c409906adde620d"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "475991d7b8be4a032ab27103a4daa3ff9199fd2c", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fd075c6f2144b33385a596b36eece02ed5d8be62/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd075c6f2144b33385a596b36eece02ed5d8be62/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=fd075c6f2144b33385a596b36eece02ed5d8be62", "patch": "@@ -44,6 +44,8 @@ impl EarlyProps {\n             props.ignore =\n                 props.ignore ||\n                 config.parse_cfg_name_directive(ln, \"ignore\") ||\n+                (config.parse_cfg_prefix(ln, \"only\") &&\n+                !config.parse_cfg_name_directive(ln, \"only\")) ||\n                 ignore_gdb(config, ln) ||\n                 ignore_lldb(config, ln) ||\n                 ignore_llvm(config, ln);\n@@ -564,6 +566,17 @@ impl Config {\n         }\n     }\n \n+    fn parse_cfg_prefix(&self, line: &str, prefix: &str) -> bool {\n+        // returns whether this line contains this prefix or not. For prefix\n+        // \"ignore\", returns true if line says \"ignore-x86_64\", \"ignore-arch\",\n+        // \"ignore-andorid\" etc.\n+        if line.starts_with(prefix) && line.as_bytes().get(prefix.len()) == Some(&b'-') {\n+            true\n+        } else {\n+            false\n+        }\n+    }\n+\n     fn parse_name_directive(&self, line: &str, directive: &str) -> bool {\n         // Ensure the directive is a whole word. Do not match \"ignore-x86\" when\n         // the line says \"ignore-x86_64\"."}]}