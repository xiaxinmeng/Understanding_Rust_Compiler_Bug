{"sha": "a8a4d4ec056b68ac25a04ea020cdc674527a76df", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4YTRkNGVjMDU2YjY4YWMyNWEwNGVhMDIwY2RjNjc0NTI3YTc2ZGY=", "commit": {"author": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-08-10T22:57:03Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2011-08-11T00:22:57Z"}, "message": "Use actual type, not declared type, when zeroing move arguments\n\ntrans was failing with a bounds check error because the caller\nwas using the declared type (an out-of-scope ty param) and not\nthe actual type in a list of argument types to zero.\n\nCloses #811", "tree": {"sha": "dc92552f3ddf044015c5a66cc770d32202d35b5b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dc92552f3ddf044015c5a66cc770d32202d35b5b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a8a4d4ec056b68ac25a04ea020cdc674527a76df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a8a4d4ec056b68ac25a04ea020cdc674527a76df", "html_url": "https://github.com/rust-lang/rust/commit/a8a4d4ec056b68ac25a04ea020cdc674527a76df", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a8a4d4ec056b68ac25a04ea020cdc674527a76df/comments", "author": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b756c4b4a0f632e537cdfd2c0ac63cea357c8ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b756c4b4a0f632e537cdfd2c0ac63cea357c8ad", "html_url": "https://github.com/rust-lang/rust/commit/6b756c4b4a0f632e537cdfd2c0ac63cea357c8ad"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "34a01bb2e8137b1c8cc64fcc457cb5917231be41", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a8a4d4ec056b68ac25a04ea020cdc674527a76df/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8a4d4ec056b68ac25a04ea020cdc674527a76df/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=a8a4d4ec056b68ac25a04ea020cdc674527a76df", "patch": "@@ -995,7 +995,16 @@ fn get_tydesc(cx: &@block_ctxt, orig_t: &ty::t, escapes: bool,\n \n     // Is the supplied type a type param? If so, return the passed-in tydesc.\n     alt ty::type_param(bcx_tcx(cx), t) {\n-      some(id) { ret rslt(cx, cx.fcx.lltydescs.(id)); }\n+      some(id) {\n+        if id < std::ivec::len(cx.fcx.lltydescs) {\n+            ret rslt(cx, cx.fcx.lltydescs.(id));\n+        }\n+        else {\n+            bcx_tcx(cx).sess.span_bug(cx.sp, \"Unbound typaram in get_tydesc: \"\n+              + \"orig_t = \" + ty_to_str(bcx_tcx(cx), orig_t)\n+              + \" ty_param = \" + std::uint::str(id));\n+        }\n+      }\n       none. {/* fall through */ }\n     }\n \n@@ -4517,7 +4526,9 @@ fn trans_arg_expr(cx: &@block_ctxt, arg: &ty::arg,\n     // Collect arg for later if it happens to be one we've moving out.\n     if arg.mode == ty::mo_move {\n         if lv.is_mem {\n-            to_zero += ~[{v: lv.res.val, t: arg.ty}];\n+      // Use actual ty, not declared ty -- anything else doesn't make sense\n+      // if declared ty is a ty param\n+            to_zero += ~[{v: lv.res.val, t: e_ty}];\n         } else {\n             to_revoke += ~[lv.res.val];\n         }\n@@ -4668,7 +4679,7 @@ fn trans_call(cx: &@block_ctxt, f: &@ast::expr,\n     /*\n     log \"calling: \" + val_str(bcx_ccx(cx).tn, faddr);\n \n-    for (ValueRef arg in llargs) {\n+    for arg: ValueRef in llargs {\n         log \"arg: \" + val_str(bcx_ccx(cx).tn, arg);\n     }\n     */"}, {"sha": "2ecf7a7c29e38379eefbe0950ebc1f3b29bf0513", "filename": "src/test/run-fail/bug-811.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a8a4d4ec056b68ac25a04ea020cdc674527a76df/src%2Ftest%2Frun-fail%2Fbug-811.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8a4d4ec056b68ac25a04ea020cdc674527a76df/src%2Ftest%2Frun-fail%2Fbug-811.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fbug-811.rs?ref=a8a4d4ec056b68ac25a04ea020cdc674527a76df", "patch": "@@ -0,0 +1,16 @@\n+// error-pattern:quux\n+fn test00_start(ch: chan_t[int], message: int) {\n+    send(ch, message);\n+}\n+\n+type task_id = int;\n+type port_id = int;\n+\n+type chan_t[~T] = {\n+    task : task_id,\n+    port : port_id\n+};\n+\n+fn send[~T](ch : chan_t[T], data : -T) { fail; }\n+\n+fn main() { fail \"quux\"; }"}]}