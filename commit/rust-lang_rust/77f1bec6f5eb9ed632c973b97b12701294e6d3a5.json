{"sha": "77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3ZjFiZWM2ZjVlYjllZDYzMmM5NzNiOTdiMTI3MDEyOTRlNmQzYTU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-05-13T13:59:19Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-05-13T13:59:19Z"}, "message": "Auto merge of #41920 - arielb1:inline-drop, r=eddyb\n\nremove the #[inline] attribute from drop_in_place\n\nApparently LLVM has exponential code growth while inlining landing pads\nif that attribute is present.\n\nFixes #41696.\n\nbeta-nominating  because regression.\nr? @eddyb", "tree": {"sha": "db5d5501741d6de4eb1b382f4d1913908569109e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db5d5501741d6de4eb1b382f4d1913908569109e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "html_url": "https://github.com/rust-lang/rust/commit/77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef3ec5ece5bdf8950810225a9a3bc3cd1926e3d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef3ec5ece5bdf8950810225a9a3bc3cd1926e3d5", "html_url": "https://github.com/rust-lang/rust/commit/ef3ec5ece5bdf8950810225a9a3bc3cd1926e3d5"}, {"sha": "237dbe939a86dfd3477bfc8934c85ff1cd1db485", "url": "https://api.github.com/repos/rust-lang/rust/commits/237dbe939a86dfd3477bfc8934c85ff1cd1db485", "html_url": "https://github.com/rust-lang/rust/commit/237dbe939a86dfd3477bfc8934c85ff1cd1db485"}], "stats": {"total": 68, "additions": 67, "deletions": 1}, "files": [{"sha": "f89f86e18a149554d09dbf34f6f736ab22b93356", "filename": "src/libcore/ptr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Flibcore%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Flibcore%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fptr.rs?ref=77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "patch": "@@ -56,7 +56,6 @@ pub use intrinsics::write_bytes;\n /// invalid pointers, types, and double drops.\n #[stable(feature = \"drop_in_place\", since = \"1.8.0\")]\n #[lang=\"drop_in_place\"]\n-#[inline]\n #[allow(unconditional_recursion)]\n pub unsafe fn drop_in_place<T: ?Sized>(to_drop: *mut T) {\n     // Code here does not matter - this is replaced by the"}, {"sha": "efd4f13678502e3e556fa06050e5e9e61de8b36f", "filename": "src/librustc_trans/common.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Flibrustc_trans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Flibrustc_trans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fcommon.rs?ref=77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "patch": "@@ -537,6 +537,12 @@ pub fn requests_inline<'a, 'tcx>(\n     if is_inline_instance(tcx, instance) {\n         return true\n     }\n+    if let ty::InstanceDef::DropGlue(..) = instance.def {\n+        // Drop glue wants to be instantiated at every translation\n+        // unit, but without an #[inline] hint. We should make this\n+        // available to normal end-users.\n+        return true\n+    }\n     attr::requests_inline(&instance.def.attrs(tcx)[..])\n }\n "}, {"sha": "ae57e0cf255290ef81223ab40cf99072c68e3a4c", "filename": "src/test/run-pass/issue-41696.rs", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Ftest%2Frun-pass%2Fissue-41696.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77f1bec6f5eb9ed632c973b97b12701294e6d3a5/src%2Ftest%2Frun-pass%2Fissue-41696.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-41696.rs?ref=77f1bec6f5eb9ed632c973b97b12701294e6d3a5", "patch": "@@ -0,0 +1,61 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// this used to cause exponential code-size blowup during LLVM passes.\n+// min-llvm-version 3.9\n+\n+#![feature(test)]\n+\n+extern crate test;\n+\n+struct MayUnwind;\n+\n+impl Drop for MayUnwind {\n+    fn drop(&mut self) {\n+        if test::black_box(false) {\n+            panic!()\n+        }\n+    }\n+}\n+\n+struct DS<U> {\n+    may_unwind: MayUnwind,\n+    name: String,\n+    next: U,\n+}\n+\n+fn add<U>(ds: DS<U>, name: String) -> DS<DS<U>> {\n+    DS {\n+        may_unwind: MayUnwind,\n+        name: \"?\".to_owned(),\n+        next: ds,\n+    }\n+}\n+\n+fn main() {\n+    let deserializers = DS { may_unwind: MayUnwind, name: \"?\".to_owned(), next: () };\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned());\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 0.7s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 1.3s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 2.4s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 6.7s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 26.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 114.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 228.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 400.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 800.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 1600.0s\n+    let deserializers = add(deserializers, \"?\".to_owned()); // 3200.0s\n+}"}]}