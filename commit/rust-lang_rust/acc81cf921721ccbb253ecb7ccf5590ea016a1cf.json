{"sha": "acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjYzgxY2Y5MjE3MjFjY2JiMjUzZWNiN2NjZjU1OTBlYTAxNmExY2Y=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2017-11-19T08:28:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-11-19T08:28:47Z"}, "message": "Merge pull request #2232 from rust-lang-nursery/fixup-const-static-lifetime\n\nFixup \"const static lifetime\" lint for non-path types", "tree": {"sha": "b1db90eff0b70ff15361e1ee3868c9454e63b2e4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1db90eff0b70ff15361e1ee3868c9454e63b2e4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaEUC/CRBK7hj4Ov3rIwAAdHIIADsmn9DmoMM5JgOqhDS7Mhz3\nBvM6hVVcFAmG44PydMFSwksXKPTkI3U23ct0QbYyzidB1KEU/hHZZzicx+8U83fJ\nbAoHqH4PxLyegQJAKnQKCgWAo1ugs3lsvfjgESkypYphvZ2jXrdkU1FhQHOjN0Jr\nq4gdR5sL1y/LLg3vx8BjPQCbu6Tswg4eyo4OLIIRqI6lLg11ZR+Cci2bcL9JzDK/\nxrIy5ZqXrzUmuNkbUl7YMuicDwDVPBrfqUYNXLsi0mMWjLEN0ze4y3hT0I/46nFD\ny/m85A9CjTDyZ7tpg2em/RgG7aiWGIhd/EZ3QpG833ObNM46Xvxb+XxIG9VCD8g=\n=bFFh\n-----END PGP SIGNATURE-----\n", "payload": "tree b1db90eff0b70ff15361e1ee3868c9454e63b2e4\nparent 3bd4dcbba5b4be6f6c85929b49f505ea8c40e341\nparent 76324851b58652d05c92c084f3274748261ca1a4\nauthor Oliver Schneider <oli-obk@users.noreply.github.com> 1511080127 +0100\ncommitter GitHub <noreply@github.com> 1511080127 +0100\n\nMerge pull request #2232 from rust-lang-nursery/fixup-const-static-lifetime\n\nFixup \"const static lifetime\" lint for non-path types"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "html_url": "https://github.com/rust-lang/rust/commit/acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bd4dcbba5b4be6f6c85929b49f505ea8c40e341", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bd4dcbba5b4be6f6c85929b49f505ea8c40e341", "html_url": "https://github.com/rust-lang/rust/commit/3bd4dcbba5b4be6f6c85929b49f505ea8c40e341"}, {"sha": "76324851b58652d05c92c084f3274748261ca1a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/76324851b58652d05c92c084f3274748261ca1a4", "html_url": "https://github.com/rust-lang/rust/commit/76324851b58652d05c92c084f3274748261ca1a4"}], "stats": {"total": 72, "additions": 56, "deletions": 16}, "files": [{"sha": "c5dcec2167e000644be6762eec6a092912e058dc", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "patch": "@@ -70,8 +70,9 @@ Please document your lint with a doc comment akin to the following:\n \n Clippy uses UI tests. UI tests check that the output of the compiler is exactly as expected.\n Of course there's little sense in writing the output yourself or copying it around.\n-Therefore you can simply run `tests/ui/update-all-references.sh` and check whether\n-the output looks as you expect with `git diff`. Commit all `*.stderr` files, too.\n+Therefore you can simply run `tests/ui/update-all-references.sh` (after running\n+`cargo test`) and check whether the output looks as you expect with `git diff`. Commit all\n+`*.stderr` files, too.\n \n ### Testing manually\n "}, {"sha": "69a4c0ae8808bb489e487ad504892b1e1cf53fed", "filename": "clippy_lints/src/const_static_lifetime.rs", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs?ref=acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "patch": "@@ -48,20 +48,23 @@ impl StaticConst {\n             TyKind::Rptr(ref optional_lifetime, ref borrow_type) => {\n                 // Match the 'static lifetime\n                 if let Some(lifetime) = *optional_lifetime {\n-                    if let TyKind::Path(_, _) = borrow_type.ty.node {\n-                        // Verify that the path is a str\n-                        if lifetime.ident.name == \"'static\" {\n-                            let mut sug: String = String::new();\n-                            span_lint_and_then(\n-                                cx,\n-                                CONST_STATIC_LIFETIME,\n-                                lifetime.span,\n-                                \"Constants have by default a `'static` lifetime\",\n-                                |db| {\n-                                    db.span_suggestion(lifetime.span, \"consider removing `'static`\", sug);\n-                                },\n-                            );\n+                    match borrow_type.ty.node {\n+                        TyKind::Path(..) | TyKind::Slice(..) | TyKind::Array(..) |\n+                        TyKind::Tup(..) => {\n+                            if lifetime.ident.name == \"'static\" {\n+                                let mut sug: String = String::new();\n+                                span_lint_and_then(\n+                                    cx,\n+                                    CONST_STATIC_LIFETIME,\n+                                    lifetime.span,\n+                                    \"Constants have by default a `'static` lifetime\",\n+                                    |db| {\n+                                        db.span_suggestion(lifetime.span, \"consider removing `'static`\", sug);\n+                                    },\n+                                );\n+                            }\n                         }\n+                        _ => {}\n                     }\n                 }\n                 self.visit_type(&*borrow_type.ty, cx);"}, {"sha": "a033f2b368e26baa77250de1764bb46324fcfd9f", "filename": "tests/ui/const_static_lifetime.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.rs?ref=acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "patch": "@@ -17,6 +17,12 @@ const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"]\n \n const VAR_HEIGHT: &'static Foo = &Foo {};\n \n+const VAR_SLICE: &'static [u8] = b\"Test constant #1\"; // ERROR Consider removing 'static.\n+\n+const VAR_TUPLE: &'static (u8, u8) = &(1, 2); // ERROR Consider removing 'static.\n+\n+const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n+\n fn main() {\n     let false_positive: &'static str = \"test\";\n     println!(\"{}\", VAR_ONE);"}, {"sha": "d4558f7b24147d83b1f9214cdfe42ec88e84765a", "filename": "tests/ui/const_static_lifetime.stderr", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fconst_static_lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fconst_static_lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.stderr?ref=acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "patch": "@@ -24,6 +24,12 @@ error: Constants have by default a `'static` lifetime\n 10 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n    |                                               ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:12:18\n+   |\n+12 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n+   |                  ^^^^^^^ help: consider removing `'static`\n+\n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:12:30\n    |\n@@ -36,6 +42,12 @@ error: Constants have by default a `'static` lifetime\n 14 | const VAR_SIX: &'static u8 = &5;\n    |                 ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:16:29\n+   |\n+16 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n+   |                             ^^^^^^^ help: consider removing `'static`\n+\n error: Constants have by default a `'static` lifetime\n   --> $DIR/const_static_lifetime.rs:16:39\n    |\n@@ -48,3 +60,21 @@ error: Constants have by default a `'static` lifetime\n 18 | const VAR_HEIGHT: &'static Foo = &Foo {};\n    |                    ^^^^^^^ help: consider removing `'static`\n \n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:20:19\n+   |\n+20 | const VAR_SLICE: &'static [u8] = b\"Test constant #1\"; // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:22:19\n+   |\n+22 | const VAR_TUPLE: &'static (u8, u8) = &(1, 2); // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+\n+error: Constants have by default a `'static` lifetime\n+  --> $DIR/const_static_lifetime.rs:24:19\n+   |\n+24 | const VAR_ARRAY: &'static [u8; 1] = b\"T\"; // ERROR Consider removing 'static.\n+   |                   ^^^^^^^ help: consider removing `'static`\n+"}, {"sha": "acc38f15fbdc51779a20832bd599c376614c2f79", "filename": "tests/ui/update-all-references.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fupdate-all-references.sh", "raw_url": "https://github.com/rust-lang/rust/raw/acc81cf921721ccbb253ecb7ccf5590ea016a1cf/tests%2Fui%2Fupdate-all-references.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fupdate-all-references.sh?ref=acc81cf921721ccbb253ecb7ccf5590ea016a1cf", "patch": "@@ -18,7 +18,7 @@\n #\n # See all `update-references.sh`, if you just want to update a single test.\n \n-if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" || \"$1\" == \"\" ]]; then\n+if [[ \"$1\" == \"--help\" || \"$1\" == \"-h\" ]]; then\n     echo \"usage: $0\"\n fi\n "}]}