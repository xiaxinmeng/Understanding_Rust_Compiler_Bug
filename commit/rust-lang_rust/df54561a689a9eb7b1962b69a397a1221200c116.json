{"sha": "df54561a689a9eb7b1962b69a397a1221200c116", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmNTQ1NjFhNjg5YTllYjdiMTk2MmI2OWEzOTdhMTIyMTIwMGMxMTY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-08-21T11:21:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-21T11:21:05Z"}, "message": "Merge #5835\n\n5835: Switch to expect_test from crates.io\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "159c5f1041a915290a8b8a4dfd1cf2ea6d659ed8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/159c5f1041a915290a8b8a4dfd1cf2ea6d659ed8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df54561a689a9eb7b1962b69a397a1221200c116", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfP64hCRBK7hj4Ov3rIwAAdHIIAFMrf+Z/Hoil3Ft+89bxmxbH\np1j4bTiETNeSvQEdc6f2v3ZyzHnFdxgQgPCn21Bi9q1os3YFFeVtKFGb2yvsxdF+\nyjM6hmq0aP+eSNOeNHi1HSAnlPR4WX1IwY9VBQIhYVGaBnQBPa4aSTiOwN5Rfnpj\nzrLDb1T82zoVndB/QwIHyL7i9rsaHr+OVas8+eNBaW1UmBsRw/XW6rz6dQqd2OvO\n3GSSSSnIAA3Jehu6hTCqQ9swx2dbv0GF6Z7KW4UMNnjperHyQAE1SNCupWVELD8E\nFlmFpw4QqLTVFpW49P5Mcli9dgxOP2C1h3gy516F179UFWvlWgYscJBPsi6pRY8=\n=Ig+C\n-----END PGP SIGNATURE-----\n", "payload": "tree 159c5f1041a915290a8b8a4dfd1cf2ea6d659ed8\nparent 71d2c4a0278c2200a88dad40de94681a1e9768fc\nparent b0fd3faf36c94c3fc52151c6aa82b36b43b7cceb\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1598008865 +0000\ncommitter GitHub <noreply@github.com> 1598008865 +0000\n\nMerge #5835\n\n5835: Switch to expect_test from crates.io\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df54561a689a9eb7b1962b69a397a1221200c116", "html_url": "https://github.com/rust-lang/rust/commit/df54561a689a9eb7b1962b69a397a1221200c116", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df54561a689a9eb7b1962b69a397a1221200c116/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "71d2c4a0278c2200a88dad40de94681a1e9768fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/71d2c4a0278c2200a88dad40de94681a1e9768fc", "html_url": "https://github.com/rust-lang/rust/commit/71d2c4a0278c2200a88dad40de94681a1e9768fc"}, {"sha": "b0fd3faf36c94c3fc52151c6aa82b36b43b7cceb", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0fd3faf36c94c3fc52151c6aa82b36b43b7cceb", "html_url": "https://github.com/rust-lang/rust/commit/b0fd3faf36c94c3fc52151c6aa82b36b43b7cceb"}], "stats": {"total": 479, "additions": 54, "deletions": 425}, "files": [{"sha": "ad7760d98cfe103b662971a6473623d65758d6d5", "filename": "Cargo.lock", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -345,12 +345,13 @@ dependencies = [\n ]\n \n [[package]]\n-name = \"expect\"\n-version = \"0.0.0\"\n+name = \"expect-test\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a3e383741ea1982866572109d1a8c807bd36aad91fca701489fdca56ef92b3b8\"\n dependencies = [\n  \"difference\",\n  \"once_cell\",\n- \"stdx\",\n ]\n \n [[package]]\n@@ -508,7 +509,7 @@ dependencies = [\n  \"cfg\",\n  \"drop_bomb\",\n  \"either\",\n- \"expect\",\n+ \"expect-test\",\n  \"fst\",\n  \"hir_expand\",\n  \"indexmap\",\n@@ -553,7 +554,7 @@ dependencies = [\n  \"chalk-recursive\",\n  \"chalk-solve\",\n  \"ena\",\n- \"expect\",\n+ \"expect-test\",\n  \"hir_def\",\n  \"hir_expand\",\n  \"itertools\",\n@@ -587,7 +588,7 @@ dependencies = [\n  \"base_db\",\n  \"cfg\",\n  \"either\",\n- \"expect\",\n+ \"expect-test\",\n  \"hir\",\n  \"ide_db\",\n  \"indexmap\",\n@@ -1225,7 +1226,7 @@ dependencies = [\n  \"cfg\",\n  \"crossbeam-channel\",\n  \"env_logger\",\n- \"expect\",\n+ \"expect-test\",\n  \"flycheck\",\n  \"hir\",\n  \"hir_def\",\n@@ -1452,7 +1453,7 @@ name = \"ssr\"\n version = \"0.0.0\"\n dependencies = [\n  \"base_db\",\n- \"expect\",\n+ \"expect-test\",\n  \"hir\",\n  \"ide_db\",\n  \"itertools\",\n@@ -1494,7 +1495,7 @@ name = \"syntax\"\n version = \"0.0.0\"\n dependencies = [\n  \"arrayvec\",\n- \"expect\",\n+ \"expect-test\",\n  \"itertools\",\n  \"once_cell\",\n  \"parser\","}, {"sha": "b54d3a60e300e48e208623126cea2b80a74d95be", "filename": "crates/expect/Cargo.toml", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/71d2c4a0278c2200a88dad40de94681a1e9768fc/crates%2Fexpect%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/71d2c4a0278c2200a88dad40de94681a1e9768fc/crates%2Fexpect%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fexpect%2FCargo.toml?ref=71d2c4a0278c2200a88dad40de94681a1e9768fc", "patch": "@@ -1,15 +0,0 @@\n-[package]\n-name = \"expect\"\n-version = \"0.0.0\"\n-license = \"MIT OR Apache-2.0\"\n-authors = [\"rust-analyzer developers\"]\n-edition = \"2018\"\n-\n-[lib]\n-doctest = false\n-\n-[dependencies]\n-once_cell = \"1\"\n-difference = \"2\"\n-\n-stdx = { path = \"../stdx\" }"}, {"sha": "bd83895f78251f2ecac9cba72a3fd64e46ce31dd", "filename": "crates/expect/src/lib.rs", "status": "removed", "additions": 0, "deletions": 356, "changes": 356, "blob_url": "https://github.com/rust-lang/rust/blob/71d2c4a0278c2200a88dad40de94681a1e9768fc/crates%2Fexpect%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71d2c4a0278c2200a88dad40de94681a1e9768fc/crates%2Fexpect%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fexpect%2Fsrc%2Flib.rs?ref=71d2c4a0278c2200a88dad40de94681a1e9768fc", "patch": "@@ -1,356 +0,0 @@\n-//! Snapshot testing library, see\n-//! https://github.com/rust-analyzer/rust-analyzer/pull/5101\n-use std::{\n-    collections::HashMap,\n-    env, fmt, fs, mem,\n-    ops::Range,\n-    panic,\n-    path::{Path, PathBuf},\n-    sync::Mutex,\n-};\n-\n-use difference::Changeset;\n-use once_cell::sync::Lazy;\n-use stdx::{lines_with_ends, trim_indent};\n-\n-const HELP: &str = \"\n-You can update all `expect![[]]` tests by running:\n-\n-    env UPDATE_EXPECT=1 cargo test\n-\n-To update a single test, place the cursor on `expect` token and use `run` feature of rust-analyzer.\n-\";\n-\n-fn update_expect() -> bool {\n-    env::var(\"UPDATE_EXPECT\").is_ok()\n-}\n-\n-/// expect![[r#\"inline snapshot\"#]]\n-#[macro_export]\n-macro_rules! expect {\n-    [[$data:literal]] => {$crate::Expect {\n-        position: $crate::Position {\n-            file: file!(),\n-            line: line!(),\n-            column: column!(),\n-        },\n-        data: $data,\n-    }};\n-    [[]] => { $crate::expect![[\"\"]] };\n-}\n-\n-/// expect_file![\"/crates/foo/test_data/bar.html\"]\n-#[macro_export]\n-macro_rules! expect_file {\n-    [$path:expr] => {$crate::ExpectFile {\n-        path: std::path::PathBuf::from($path)\n-    }};\n-}\n-\n-#[derive(Debug)]\n-pub struct Expect {\n-    pub position: Position,\n-    pub data: &'static str,\n-}\n-\n-#[derive(Debug)]\n-pub struct ExpectFile {\n-    pub path: PathBuf,\n-}\n-\n-#[derive(Debug)]\n-pub struct Position {\n-    pub file: &'static str,\n-    pub line: u32,\n-    pub column: u32,\n-}\n-\n-impl fmt::Display for Position {\n-    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n-        write!(f, \"{}:{}:{}\", self.file, self.line, self.column)\n-    }\n-}\n-\n-impl Expect {\n-    pub fn assert_eq(&self, actual: &str) {\n-        let trimmed = self.trimmed();\n-        if trimmed == actual {\n-            return;\n-        }\n-        Runtime::fail_expect(self, &trimmed, actual);\n-    }\n-    pub fn assert_debug_eq(&self, actual: &impl fmt::Debug) {\n-        let actual = format!(\"{:#?}\\n\", actual);\n-        self.assert_eq(&actual)\n-    }\n-\n-    fn trimmed(&self) -> String {\n-        if !self.data.contains('\\n') {\n-            return self.data.to_string();\n-        }\n-        trim_indent(self.data)\n-    }\n-\n-    fn locate(&self, file: &str) -> Location {\n-        let mut target_line = None;\n-        let mut line_start = 0;\n-        for (i, line) in lines_with_ends(file).enumerate() {\n-            if i == self.position.line as usize - 1 {\n-                let pat = \"expect![[\";\n-                let offset = line.find(pat).unwrap();\n-                let literal_start = line_start + offset + pat.len();\n-                let indent = line.chars().take_while(|&it| it == ' ').count();\n-                target_line = Some((literal_start, indent));\n-                break;\n-            }\n-            line_start += line.len();\n-        }\n-        let (literal_start, line_indent) = target_line.unwrap();\n-        let literal_length =\n-            file[literal_start..].find(\"]]\").expect(\"Couldn't find matching `]]` for `expect![[`.\");\n-        let literal_range = literal_start..literal_start + literal_length;\n-        Location { line_indent, literal_range }\n-    }\n-}\n-\n-impl ExpectFile {\n-    pub fn assert_eq(&self, actual: &str) {\n-        let expected = self.read();\n-        if actual == expected {\n-            return;\n-        }\n-        Runtime::fail_file(self, &expected, actual);\n-    }\n-    pub fn assert_debug_eq(&self, actual: &impl fmt::Debug) {\n-        let actual = format!(\"{:#?}\\n\", actual);\n-        self.assert_eq(&actual)\n-    }\n-    fn read(&self) -> String {\n-        fs::read_to_string(self.abs_path()).unwrap_or_default().replace(\"\\r\\n\", \"\\n\")\n-    }\n-    fn write(&self, contents: &str) {\n-        fs::write(self.abs_path(), contents).unwrap()\n-    }\n-    fn abs_path(&self) -> PathBuf {\n-        WORKSPACE_ROOT.join(&self.path)\n-    }\n-}\n-\n-#[derive(Default)]\n-struct Runtime {\n-    help_printed: bool,\n-    per_file: HashMap<&'static str, FileRuntime>,\n-}\n-static RT: Lazy<Mutex<Runtime>> = Lazy::new(Default::default);\n-\n-impl Runtime {\n-    fn fail_expect(expect: &Expect, expected: &str, actual: &str) {\n-        let mut rt = RT.lock().unwrap_or_else(|poisoned| poisoned.into_inner());\n-        if update_expect() {\n-            println!(\"\\x1b[1m\\x1b[92mupdating\\x1b[0m: {}\", expect.position);\n-            rt.per_file\n-                .entry(expect.position.file)\n-                .or_insert_with(|| FileRuntime::new(expect))\n-                .update(expect, actual);\n-            return;\n-        }\n-        rt.panic(expect.position.to_string(), expected, actual);\n-    }\n-\n-    fn fail_file(expect: &ExpectFile, expected: &str, actual: &str) {\n-        let mut rt = RT.lock().unwrap_or_else(|poisoned| poisoned.into_inner());\n-        if update_expect() {\n-            println!(\"\\x1b[1m\\x1b[92mupdating\\x1b[0m: {}\", expect.path.display());\n-            expect.write(actual);\n-            return;\n-        }\n-        rt.panic(expect.path.display().to_string(), expected, actual);\n-    }\n-\n-    fn panic(&mut self, position: String, expected: &str, actual: &str) {\n-        let print_help = !mem::replace(&mut self.help_printed, true);\n-        let help = if print_help { HELP } else { \"\" };\n-\n-        let diff = Changeset::new(actual, expected, \"\\n\");\n-\n-        println!(\n-            \"\\n\n-\\x1b[1m\\x1b[91merror\\x1b[97m: expect test failed\\x1b[0m\n-   \\x1b[1m\\x1b[34m-->\\x1b[0m {}\n-{}\n-\\x1b[1mExpect\\x1b[0m:\n-----\n-{}\n-----\n-\n-\\x1b[1mActual\\x1b[0m:\n-----\n-{}\n-----\n-\n-\\x1b[1mDiff\\x1b[0m:\n-----\n-{}\n-----\n-\",\n-            position, help, expected, actual, diff\n-        );\n-        // Use resume_unwind instead of panic!() to prevent a backtrace, which is unnecessary noise.\n-        panic::resume_unwind(Box::new(()));\n-    }\n-}\n-\n-struct FileRuntime {\n-    path: PathBuf,\n-    original_text: String,\n-    patchwork: Patchwork,\n-}\n-\n-impl FileRuntime {\n-    fn new(expect: &Expect) -> FileRuntime {\n-        let path = WORKSPACE_ROOT.join(expect.position.file);\n-        let original_text = fs::read_to_string(&path).unwrap();\n-        let patchwork = Patchwork::new(original_text.clone());\n-        FileRuntime { path, original_text, patchwork }\n-    }\n-    fn update(&mut self, expect: &Expect, actual: &str) {\n-        let loc = expect.locate(&self.original_text);\n-        let patch = format_patch(loc.line_indent.clone(), actual);\n-        self.patchwork.patch(loc.literal_range, &patch);\n-        fs::write(&self.path, &self.patchwork.text).unwrap()\n-    }\n-}\n-\n-#[derive(Debug)]\n-struct Location {\n-    line_indent: usize,\n-    literal_range: Range<usize>,\n-}\n-\n-#[derive(Debug)]\n-struct Patchwork {\n-    text: String,\n-    indels: Vec<(Range<usize>, usize)>,\n-}\n-\n-impl Patchwork {\n-    fn new(text: String) -> Patchwork {\n-        Patchwork { text, indels: Vec::new() }\n-    }\n-    fn patch(&mut self, mut range: Range<usize>, patch: &str) {\n-        self.indels.push((range.clone(), patch.len()));\n-        self.indels.sort_by_key(|(delete, _insert)| delete.start);\n-\n-        let (delete, insert) = self\n-            .indels\n-            .iter()\n-            .take_while(|(delete, _)| delete.start < range.start)\n-            .map(|(delete, insert)| (delete.end - delete.start, insert))\n-            .fold((0usize, 0usize), |(x1, y1), (x2, y2)| (x1 + x2, y1 + y2));\n-\n-        for pos in &mut [&mut range.start, &mut range.end] {\n-            **pos -= delete;\n-            **pos += insert;\n-        }\n-\n-        self.text.replace_range(range, &patch);\n-    }\n-}\n-\n-fn format_patch(line_indent: usize, patch: &str) -> String {\n-    let mut max_hashes = 0;\n-    let mut cur_hashes = 0;\n-    for byte in patch.bytes() {\n-        if byte != b'#' {\n-            cur_hashes = 0;\n-            continue;\n-        }\n-        cur_hashes += 1;\n-        max_hashes = max_hashes.max(cur_hashes);\n-    }\n-    let hashes = &\"#\".repeat(max_hashes + 1);\n-    let indent = &\" \".repeat(line_indent);\n-    let is_multiline = patch.contains('\\n');\n-\n-    let mut buf = String::new();\n-    buf.push('r');\n-    buf.push_str(hashes);\n-    buf.push('\"');\n-    if is_multiline {\n-        buf.push('\\n');\n-    }\n-    let mut final_newline = false;\n-    for line in lines_with_ends(patch) {\n-        if is_multiline && !line.trim().is_empty() {\n-            buf.push_str(indent);\n-            buf.push_str(\"    \");\n-        }\n-        buf.push_str(line);\n-        final_newline = line.ends_with('\\n');\n-    }\n-    if final_newline {\n-        buf.push_str(indent);\n-    }\n-    buf.push('\"');\n-    buf.push_str(hashes);\n-    buf\n-}\n-\n-static WORKSPACE_ROOT: Lazy<PathBuf> = Lazy::new(|| {\n-    let my_manifest =\n-        env::var(\"CARGO_MANIFEST_DIR\").unwrap_or_else(|_| env!(\"CARGO_MANIFEST_DIR\").to_owned());\n-    // Heuristic, see https://github.com/rust-lang/cargo/issues/3946\n-    Path::new(&my_manifest)\n-        .ancestors()\n-        .filter(|it| it.join(\"Cargo.toml\").exists())\n-        .last()\n-        .unwrap()\n-        .to_path_buf()\n-});\n-\n-#[cfg(test)]\n-mod tests {\n-    use super::*;\n-\n-    #[test]\n-    fn test_format_patch() {\n-        let patch = format_patch(0, \"hello\\nworld\\n\");\n-        expect![[r##\"\n-            r#\"\n-                hello\n-                world\n-            \"#\"##]]\n-        .assert_eq(&patch);\n-\n-        let patch = format_patch(4, \"single line\");\n-        expect![[r##\"r#\"single line\"#\"##]].assert_eq(&patch);\n-    }\n-\n-    #[test]\n-    fn test_patchwork() {\n-        let mut patchwork = Patchwork::new(\"one two three\".to_string());\n-        patchwork.patch(4..7, \"zwei\");\n-        patchwork.patch(0..3, \"\u043e\u0434\u0438\u043d\");\n-        patchwork.patch(8..13, \"3\");\n-        expect![[r#\"\n-            Patchwork {\n-                text: \"\u043e\u0434\u0438\u043d zwei 3\",\n-                indels: [\n-                    (\n-                        0..3,\n-                        8,\n-                    ),\n-                    (\n-                        4..7,\n-                        4,\n-                    ),\n-                    (\n-                        8..13,\n-                        1,\n-                    ),\n-                ],\n-            }\n-        \"#]]\n-        .assert_debug_eq(&patchwork);\n-    }\n-}"}, {"sha": "57745322fd8d432f95557b8c34ea7ab81bc1affc", "filename": "crates/hir_def/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -32,4 +32,4 @@ cfg = { path = \"../cfg\" }\n tt = { path = \"../tt\" }\n \n [dev-dependencies]\n-expect = { path = \"../expect\" }\n+expect-test = \"0.1\""}, {"sha": "a442fb63a1be5d1ca1be51ae63ee6abf82a25766", "filename": "crates/hir_def/src/import_map.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fimport_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fimport_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fimport_map.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -328,7 +328,7 @@ pub fn search_dependencies<'a>(\n #[cfg(test)]\n mod tests {\n     use base_db::{fixture::WithFixture, SourceDatabase, Upcast};\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::{test_db::TestDB, AssocContainerId, Lookup};\n "}, {"sha": "620e697d4a101af5cf0360321ba9291bc1f6a4fd", "filename": "crates/hir_def/src/item_tree/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fitem_tree%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fitem_tree%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fitem_tree%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,5 +1,5 @@\n use base_db::fixture::WithFixture;\n-use expect::{expect, Expect};\n+use expect_test::{expect, Expect};\n use hir_expand::{db::AstDatabase, HirFileId, InFile};\n use rustc_hash::FxHashSet;\n use std::sync::Arc;"}, {"sha": "8aaf7a158ba42fa4141f334b9ef7ef6d3ad7a450", "filename": "crates/hir_def/src/nameres/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -7,7 +7,7 @@ mod primitives;\n use std::sync::Arc;\n \n use base_db::{fixture::WithFixture, SourceDatabase};\n-use expect::{expect, Expect};\n+use expect_test::{expect, Expect};\n use test_utils::mark;\n \n use crate::{db::DefDatabase, nameres::*, test_db::TestDB};"}, {"sha": "06da0d0ec8d23c783a1bc465db7e1b911325342d", "filename": "crates/hir_ty/Cargo.toml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -30,8 +30,7 @@ syntax = { path = \"../syntax\" }\n test_utils = { path = \"../test_utils\" }\n \n [dev-dependencies]\n+expect-test = \"0.1\"\n tracing = \"0.1\"\n tracing-subscriber = { version = \"0.2\", default-features = false, features = [\"env-filter\", \"registry\"] }\n tracing-tree = { version = \"0.1.4\" }\n-\n-expect = { path = \"../expect\" }"}, {"sha": "0445efc9e042a81f098bb29aae1c66ad74a5057a", "filename": "crates/hir_ty/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -11,7 +11,7 @@ mod display_source_code;\n use std::{env, sync::Arc};\n \n use base_db::{fixture::WithFixture, FileRange, SourceDatabase, SourceDatabaseExt};\n-use expect::Expect;\n+use expect_test::Expect;\n use hir_def::{\n     body::{BodySourceMap, SyntheticSyntax},\n     child_by_source::ChildBySource,"}, {"sha": "7bc6c79f3ff85c1e3eeab1349c6e83306ba6a4b3", "filename": "crates/hir_ty/src/tests/coercion.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fcoercion.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n use test_utils::mark;\n \n use super::{check_infer, check_infer_with_mismatches};"}, {"sha": "597a195d0248a503257a054960c1c41f141c262b", "filename": "crates/hir_ty/src/tests/macros.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmacros.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,6 +1,6 @@\n use std::fs;\n \n-use expect::expect;\n+use expect_test::expect;\n use test_utils::project_dir;\n \n use super::{check_infer, check_types};"}, {"sha": "23b2601e643b5d19de1849d61404a56fbe1248da", "filename": "crates/hir_ty/src/tests/method_resolution.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n \n use super::{check_infer, check_types};\n "}, {"sha": "335c474df767e81487ad1496261fcb826a7542c3", "filename": "crates/hir_ty/src/tests/never_type.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fnever_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fnever_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fnever_type.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n \n use super::{check_infer_with_mismatches, check_types};\n "}, {"sha": "aeb191c79a77f826987652677dce6d6784bf3e9d", "filename": "crates/hir_ty/src/tests/patterns.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fpatterns.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n use test_utils::mark;\n \n use super::{check_infer, check_infer_with_mismatches};"}, {"sha": "94d86b0d1f232a292616d933697ddecacbedccc9", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n use test_utils::mark;\n \n use super::{check_infer, check_types};"}, {"sha": "48db23a341609cbd1bed29ea4f4c35459e871138", "filename": "crates/hir_ty/src/tests/simple.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fsimple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Fsimple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fsimple.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n \n use super::{check_infer, check_types};\n "}, {"sha": "1f1056962b7c8f99adabd59a34516edb3a3f61d5", "filename": "crates/hir_ty/src/tests/traits.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,4 +1,4 @@\n-use expect::expect;\n+use expect_test::expect;\n use test_utils::mark;\n \n use super::{check_infer, check_infer_with_mismatches, check_types};"}, {"sha": "700944430f3bc526abadd1178d2d0c61d1b71e45", "filename": "crates/ide/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -32,4 +32,4 @@ ssr = { path = \"../ssr\" }\n hir = { path = \"../hir\" }\n \n [dev-dependencies]\n-expect = { path = \"../expect\" }\n+expect-test = \"0.1\""}, {"sha": "7e83a2381974c9ab3b29230007607f8cb8c5270e", "filename": "crates/ide/src/call_info.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcall_info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcall_info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcall_info.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -229,7 +229,7 @@ impl FnCallNode {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::mark;\n \n     use crate::mock_analysis::analysis_and_position;"}, {"sha": "0abfaebcbc669f4b887d9f33560c8a6f3d2567f9", "filename": "crates/ide/src/completion/complete_attribute.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -383,7 +383,7 @@ const DEFAULT_LINT_COMPLETIONS: &[LintCompletion] = &[\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "0b9f1798acafb6624dde9eee4348dc02edafe090", "filename": "crates/ide/src/completion/complete_dot.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_dot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_dot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_dot.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -61,7 +61,7 @@ fn complete_methods(acc: &mut Completions, ctx: &CompletionContext, receiver: &T\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::mark;\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};"}, {"sha": "9efe254618eee4e168bd85f392f51fba2d629a86", "filename": "crates/ide/src/completion/complete_fn_param.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_fn_param.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -66,7 +66,7 @@ pub(super) fn complete_fn_param(acc: &mut Completions, ctx: &CompletionContext)\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "95e4ff1ac6aa01cac94f1d3432286fd2fda894b2", "filename": "crates/ide/src/completion/complete_keyword.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_keyword.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -174,7 +174,7 @@ fn complete_return(\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{\n         test_utils::{check_edit, completion_list},"}, {"sha": "fc8625d8e0a027a787c54c3e578bef6810035bfc", "filename": "crates/ide/src/completion/complete_macro_in_item_position.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_macro_in_item_position.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_macro_in_item_position.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_macro_in_item_position.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -15,7 +15,7 @@ pub(super) fn complete_macro_in_item_position(acc: &mut Completions, ctx: &Compl\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "5a13574d45b0ab180a555751cc4602eb665b836d", "filename": "crates/ide/src/completion/complete_pattern.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_pattern.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -33,7 +33,7 @@ pub(super) fn complete_pattern(acc: &mut Completions, ctx: &CompletionContext) {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "84c4e129d27145535715fddf6f460bdcb08a2e83", "filename": "crates/ide/src/completion/complete_postfix.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_postfix.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -238,7 +238,7 @@ fn postfix_snippet(\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{\n         test_utils::{check_edit, completion_list},"}, {"sha": "accb09f7e8c874cbc646a0ddde2a5ccc51f33c60", "filename": "crates/ide/src/completion/complete_qualified_path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -146,7 +146,7 @@ pub(super) fn complete_qualified_path(acc: &mut Completions, ctx: &CompletionCon\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::mark;\n \n     use crate::completion::{"}, {"sha": "ceb8d16c10017d10ed3f96e9b40bf2d130457c77", "filename": "crates/ide/src/completion/complete_record.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_record.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_record.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_record.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -18,7 +18,7 @@ pub(super) fn complete_record(acc: &mut Completions, ctx: &CompletionContext) ->\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "c3b03b199e7902e54939c9a6375e25971f78b4ff", "filename": "crates/ide/src/completion/complete_snippet.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_snippet.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -70,7 +70,7 @@ fn ${1:feature}() {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{test_utils::completion_list, CompletionKind};\n "}, {"sha": "1a2b1e8a57e8b6c287d9df9d141a7424c73ed34a", "filename": "crates/ide/src/completion/complete_trait_impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_trait_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_trait_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_trait_impl.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -225,7 +225,7 @@ fn make_const_compl_syntax(const_: &ast::Const) -> String {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::completion::{\n         test_utils::{check_edit, completion_list},"}, {"sha": "1f1b682a78c98a7ccba16447d0571441eeda82e7", "filename": "crates/ide/src/completion/complete_unqualified_path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -64,7 +64,7 @@ fn complete_enum_variants(acc: &mut Completions, ctx: &CompletionContext, ty: &T\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::mark;\n \n     use crate::completion::{"}, {"sha": "3371aed2dfa33fba541b8b8e32a320aa5c65bdcc", "filename": "crates/ide/src/completion/presentation.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fpresentation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fcompletion%2Fpresentation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fpresentation.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -464,7 +464,7 @@ fn guess_macro_braces(macro_name: &str, docs: &str) -> (&'static str, &'static s\n mod tests {\n     use std::cmp::Reverse;\n \n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::mark;\n \n     use crate::{"}, {"sha": "b2b972b02cb8176b532229b40a7d921d0d573a14", "filename": "crates/ide/src/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdiagnostics.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -214,7 +214,7 @@ fn check_struct_shorthand_initialization(\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use stdx::trim_indent;\n     use test_utils::assert_eq_text;\n "}, {"sha": "1ee80c2dd4e92f724eaf8303f9610332c8632789", "filename": "crates/ide/src/display/navigation_target.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdisplay%2Fnavigation_target.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -421,7 +421,7 @@ pub(crate) fn description_from_symbol(db: &RootDatabase, symbol: &FileSymbol) ->\n \n #[cfg(test)]\n mod tests {\n-    use expect::expect;\n+    use expect_test::expect;\n \n     use crate::{mock_analysis::single_file, Query};\n "}, {"sha": "8a285bcf7a9698b0b4172d17efb345a6198d245d", "filename": "crates/ide/src/expand_macro.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fexpand_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fexpand_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fexpand_macro.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -120,7 +120,7 @@ fn insert_whitespaces(syn: SyntaxNode) -> String {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::mock_analysis::analysis_and_position;\n "}, {"sha": "6168fb837ccaee180eee7c62e31d4b4a7df62135", "filename": "crates/ide/src/file_structure.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Ffile_structure.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Ffile_structure.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Ffile_structure.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -164,7 +164,7 @@ fn structure_node(node: &SyntaxNode) -> Option<StructureNode> {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use super::*;\n "}, {"sha": "c75b2a51056af9c604a9e8e487d8fcf9d8381f47", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -353,7 +353,7 @@ fn pick_best(tokens: TokenAtOffset<SyntaxToken>) -> Option<SyntaxToken> {\n #[cfg(test)]\n mod tests {\n     use base_db::FileLoader;\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::mock_analysis::analysis_and_position;\n "}, {"sha": "583f39d85ba22e57cbf987ee985586aec68f8ed8", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -336,7 +336,7 @@ fn get_callable(sema: &Semantics<RootDatabase>, expr: &ast::Expr) -> Option<Call\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use test_utils::extract_annotations;\n \n     use crate::{inlay_hints::InlayHintsConfig, mock_analysis::single_file};"}, {"sha": "3016297633be58d2d1f12a5a8b96608fe7220105", "filename": "crates/ide/src/references/rename.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Freferences%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Freferences%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Freferences%2Frename.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -270,7 +270,7 @@ fn rename_reference(\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n     use stdx::trim_indent;\n     use test_utils::{assert_eq_text, mark};\n     use text_edit::TextEdit;"}, {"sha": "4139f329eb654274124c70554d5a36f11735147d", "filename": "crates/ide/src/runnables.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Frunnables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Frunnables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frunnables.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -268,7 +268,7 @@ fn has_test_function_or_multiple_test_submodules(module: &ast::Module) -> bool {\n \n #[cfg(test)]\n mod tests {\n-    use expect::{expect, Expect};\n+    use expect_test::{expect, Expect};\n \n     use crate::mock_analysis::analysis_and_position;\n "}, {"sha": "1c3fea0588b8457a1feeee4574940badd9ae41ee", "filename": "crates/ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,6 +1,6 @@\n use std::fs;\n \n-use expect::{expect_file, ExpectFile};\n+use expect_test::{expect_file, ExpectFile};\n use test_utils::project_dir;\n \n use crate::{mock_analysis::single_file, FileRange, TextRange};"}, {"sha": "068a961dc619a09f505f9bd3b405e1c1fd37b08f", "filename": "crates/rust-analyzer/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Frust-analyzer%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Frust-analyzer%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -57,7 +57,7 @@ proc_macro_srv = { path = \"../proc_macro_srv\" }\n winapi = \"0.3.8\"\n \n [dev-dependencies]\n-expect = { path = \"../expect\" }\n+expect-test = \"0.1\"\n test_utils = { path = \"../test_utils\" }\n mbe = { path = \"../mbe\" }\n tt = { path = \"../tt\" }"}, {"sha": "e52b97913a3dda062b2ea80526cdfb7738ea2112", "filename": "crates/rust-analyzer/src/diagnostics/to_proto.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -256,7 +256,7 @@ pub(crate) fn map_rust_diagnostic_to_lsp(\n mod tests {\n     use super::*;\n \n-    use expect::{expect_file, ExpectFile};\n+    use expect_test::{expect_file, ExpectFile};\n \n     fn check(diagnostics_json: &str, expect: ExpectFile) {\n         check_with_config(DiagnosticsMapConfig::default(), diagnostics_json, expect)"}, {"sha": "22b6af0fabe75952007452d58520a6cfd8571db3", "filename": "crates/ssr/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fssr%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fssr%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fssr%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -22,4 +22,4 @@ hir = { path = \"../hir\" }\n test_utils = { path = \"../test_utils\" }\n \n [dev-dependencies]\n-expect = { path = \"../expect\" }\n+expect-test = \"0.1\""}, {"sha": "20231a9bc6010a9da1bc6fa0a57d6a8c009ce303", "filename": "crates/ssr/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fssr%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fssr%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fssr%2Fsrc%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -1,6 +1,6 @@\n use crate::{MatchFinder, SsrRule};\n use base_db::{salsa::Durability, FileId, FilePosition, FileRange, SourceDatabaseExt};\n-use expect::{expect, Expect};\n+use expect_test::{expect, Expect};\n use rustc_hash::FxHashSet;\n use std::sync::Arc;\n use test_utils::{mark, RangeOrOffset};"}, {"sha": "6818f3ad8892bed4cb4d21e8088246ad3db06042", "filename": "crates/syntax/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fsyntax%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fsyntax%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2FCargo.toml?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -30,6 +30,6 @@ parser = { path = \"../parser\" }\n [dev-dependencies]\n walkdir = \"2.3.1\"\n rayon = \"1\"\n+expect-test = \"0.1\"\n \n test_utils = { path = \"../test_utils\" }\n-expect = { path = \"../expect\" }"}, {"sha": "8c217dfe01ec851258194af80776fbb0877c739d", "filename": "crates/syntax/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fsyntax%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df54561a689a9eb7b1962b69a397a1221200c116/crates%2Fsyntax%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Ftests.rs?ref=df54561a689a9eb7b1962b69a397a1221200c116", "patch": "@@ -4,7 +4,7 @@ use std::{\n     path::{Path, PathBuf},\n };\n \n-use expect::expect_file;\n+use expect_test::expect_file;\n use rayon::prelude::*;\n use test_utils::project_dir;\n "}]}