{"sha": "685d4cc7463afe2674dac4ac4298c93157965c2a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4NWQ0Y2M3NDYzYWZlMjY3NGRhYzRhYzQyOThjOTMxNTc5NjVjMmE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-12-12T01:09:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-12T01:09:29Z"}, "message": "Rollup merge of #67239 - llogiq:tiny-list-iterative-remove, r=Mark-Simulacrum\n\nMake TinyList::remove iterate instead of recurse\n\nMost of the diff is from from rustfmt, the actual change is in line 91..79 (or 79..89 in the \"after\" diff).\n\nI had converted the other methods to iterate instead of recurse already, so this is the last recursive function on `TinyList`.", "tree": {"sha": "5552e1ad7152ac5aab3a9e11d1e09fdf62ca5223", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5552e1ad7152ac5aab3a9e11d1e09fdf62ca5223"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/685d4cc7463afe2674dac4ac4298c93157965c2a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd8ZNKCRBK7hj4Ov3rIwAAdHIIAA4NsKc3Rwz++KMhaHWkRdOK\nkaRFOdnGo11OrimurP4QcUwCqB7nL4yo9+QMU68CkOgGSmHfNLXP0I32e0VMpGXX\nXPvxbBvkvGvUgjdcO9+05XRE30/T3BsQR8vviwZjbRT/Q9ZvBEcmBTSS18OEKBGs\naD1QPWdJDt6Xkba07qXw4izwRKOuoVRFa7tzU2EOd8Gi9z2zM7pZzm1BdNoShyVV\nvoQ5F1tywrvScPFMDjGyvKDyp+Inj6Wa9eT31fX2/O8iRa8O9vBxve+kyV9YJwti\ncoB9rKv34sxj9347HirAQJMLJqw5tIPkonqDBMru6d0OvelDbZwWGoiG5dLl0t8=\n=DPem\n-----END PGP SIGNATURE-----\n", "payload": "tree 5552e1ad7152ac5aab3a9e11d1e09fdf62ca5223\nparent 60ebeda94f0ca7caf8cecf29cc3196b3dbd01b31\nparent ab3afc0f0426ea7e2801043a874dd96b2831a1eb\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1576112969 +0900\ncommitter GitHub <noreply@github.com> 1576112969 +0900\n\nRollup merge of #67239 - llogiq:tiny-list-iterative-remove, r=Mark-Simulacrum\n\nMake TinyList::remove iterate instead of recurse\n\nMost of the diff is from from rustfmt, the actual change is in line 91..79 (or 79..89 in the \"after\" diff).\n\nI had converted the other methods to iterate instead of recurse already, so this is the last recursive function on `TinyList`.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/685d4cc7463afe2674dac4ac4298c93157965c2a", "html_url": "https://github.com/rust-lang/rust/commit/685d4cc7463afe2674dac4ac4298c93157965c2a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/685d4cc7463afe2674dac4ac4298c93157965c2a/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "60ebeda94f0ca7caf8cecf29cc3196b3dbd01b31", "url": "https://api.github.com/repos/rust-lang/rust/commits/60ebeda94f0ca7caf8cecf29cc3196b3dbd01b31", "html_url": "https://github.com/rust-lang/rust/commit/60ebeda94f0ca7caf8cecf29cc3196b3dbd01b31"}, {"sha": "ab3afc0f0426ea7e2801043a874dd96b2831a1eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab3afc0f0426ea7e2801043a874dd96b2831a1eb", "html_url": "https://github.com/rust-lang/rust/commit/ab3afc0f0426ea7e2801043a874dd96b2831a1eb"}], "stats": {"total": 40, "additions": 16, "deletions": 24}, "files": [{"sha": "78cbc1240b182654cb23cc45f26d1e3a61753833", "filename": "src/librustc_data_structures/tiny_list.rs", "status": "modified", "additions": 16, "deletions": 24, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/685d4cc7463afe2674dac4ac4298c93157965c2a/src%2Flibrustc_data_structures%2Ftiny_list.rs", "raw_url": "https://github.com/rust-lang/rust/raw/685d4cc7463afe2674dac4ac4298c93157965c2a/src%2Flibrustc_data_structures%2Ftiny_list.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Ftiny_list.rs?ref=685d4cc7463afe2674dac4ac4298c93157965c2a", "patch": "@@ -16,41 +16,29 @@ mod tests;\n \n #[derive(Clone)]\n pub struct TinyList<T: PartialEq> {\n-    head: Option<Element<T>>\n+    head: Option<Element<T>>,\n }\n \n impl<T: PartialEq> TinyList<T> {\n     #[inline]\n     pub fn new() -> TinyList<T> {\n-        TinyList {\n-            head: None\n-        }\n+        TinyList { head: None }\n     }\n \n     #[inline]\n     pub fn new_single(data: T) -> TinyList<T> {\n-        TinyList {\n-            head: Some(Element {\n-                data,\n-                next: None,\n-            })\n-        }\n+        TinyList { head: Some(Element { data, next: None }) }\n     }\n \n     #[inline]\n     pub fn insert(&mut self, data: T) {\n-        self.head = Some(Element {\n-            data,\n-            next: self.head.take().map(Box::new)\n-        });\n+        self.head = Some(Element { data, next: self.head.take().map(Box::new) });\n     }\n \n     #[inline]\n     pub fn remove(&mut self, data: &T) -> bool {\n         self.head = match self.head {\n-            Some(ref mut head) if head.data == *data => {\n-                head.next.take().map(|x| *x)\n-            }\n+            Some(ref mut head) if head.data == *data => head.next.take().map(|x| *x),\n             Some(ref mut head) => return head.remove_next(data),\n             None => return false,\n         };\n@@ -88,12 +76,16 @@ struct Element<T: PartialEq> {\n \n impl<T: PartialEq> Element<T> {\n     fn remove_next(&mut self, data: &T) -> bool {\n-        let new_next = match self.next {\n-            Some(ref mut next) if next.data == *data => next.next.take(),\n-            Some(ref mut next) => return next.remove_next(data),\n-            None => return false,\n-        };\n-        self.next = new_next;\n-        true\n+        let mut n = self;\n+        loop {\n+            match n.next {\n+                Some(ref mut next) if next.data == *data => {\n+                    n.next = next.next.take();\n+                    return true;\n+                }\n+                Some(ref mut next) => n = next,\n+                None => return false,\n+            }\n+        }\n     }\n }"}]}