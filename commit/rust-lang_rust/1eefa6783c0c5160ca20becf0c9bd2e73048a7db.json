{"sha": "1eefa6783c0c5160ca20becf0c9bd2e73048a7db", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlZWZhNjc4M2MwYzUxNjBjYTIwYmVjZjBjOWJkMmU3MzA0OGE3ZGI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-07T21:52:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-05-07T21:52:39Z"}, "message": "Auto merge of #71995 - pietroalbini:ci-windows-detect-latest-python, r=Mark-Simulacrum\n\n[CI] Use the latest Python available on Windows\n\nThis PR changes our Windows CI to always use the latest Python interpreter available in the GHA tool cache instead of hardcoding Python 3.7.6. This is needed because occasionally GitHub bumps the installed version, deleting the previous one.\n\nThis fixes the current GHA outage we're having. I fully expect the outage to propagate to Azure Pipelines in the coming days if we don't merge this, as both GHA and Azure use the same underlying image. Once the PR is merged we can re-enabled the double-gating.\n\nr? @Mark-Simulacrum", "tree": {"sha": "e2a89c60b5ba993b6373dc9435c0288bfcc5d3bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2a89c60b5ba993b6373dc9435c0288bfcc5d3bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1eefa6783c0c5160ca20becf0c9bd2e73048a7db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1eefa6783c0c5160ca20becf0c9bd2e73048a7db", "html_url": "https://github.com/rust-lang/rust/commit/1eefa6783c0c5160ca20becf0c9bd2e73048a7db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1eefa6783c0c5160ca20becf0c9bd2e73048a7db/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a08c47310c7d49cbdc5d7afb38408ba519967ecd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a08c47310c7d49cbdc5d7afb38408ba519967ecd", "html_url": "https://github.com/rust-lang/rust/commit/a08c47310c7d49cbdc5d7afb38408ba519967ecd"}, {"sha": "de2d9877dcc6b3a352165b220e4e9fb67f771bab", "url": "https://api.github.com/repos/rust-lang/rust/commits/de2d9877dcc6b3a352165b220e4e9fb67f771bab", "html_url": "https://github.com/rust-lang/rust/commit/de2d9877dcc6b3a352165b220e4e9fb67f771bab"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "ff7479c05d04e5d7821b220646862ea03290bbcf", "filename": "src/ci/scripts/install-msys2-packages.sh", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1eefa6783c0c5160ca20becf0c9bd2e73048a7db/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1eefa6783c0c5160ca20becf0c9bd2e73048a7db/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh?ref=1eefa6783c0c5160ca20becf0c9bd2e73048a7db", "patch": "@@ -9,11 +9,19 @@ if isWindows; then\n     pacman -S --noconfirm --needed base-devel ca-certificates make diffutils tar \\\n         binutils\n \n+    # Detect the native Python version installed on the agent. On GitHub\n+    # Actions, the C:\\hostedtoolcache\\windows\\Python directory contains a\n+    # subdirectory for each installed Python version.\n+    #\n+    # The -V flag of the sort command sorts the input by version number.\n+    native_python_version=\"$(ls /c/hostedtoolcache/windows/Python | sort -Vr | head -n 1)\"\n+\n     # Make sure we use the native python interpreter instead of some msys equivalent\n     # one way or another. The msys interpreters seem to have weird path conversions\n     # baked in which break LLVM's build system one way or another, so let's use the\n     # native version which keeps everything as native as possible.\n-    python_home=\"C:/hostedtoolcache/windows/Python/3.7.6/x64\"\n+    python_home=\"/c/hostedtoolcache/windows/Python/${native_python_version}/x64\"\n     cp \"${python_home}/python.exe\" \"${python_home}/python3.exe\"\n-    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\3.7.6\\\\x64\"\n+    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\${native_python_version}\\\\x64\"\n+    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\${native_python_version}\\\\x64\\\\Scripts\"\n fi"}]}