{"sha": "966361fe495def7f6ceb63fa769b892089e19cb3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2NjM2MWZlNDk1ZGVmN2Y2Y2ViNjNmYTc2OWI4OTIwODllMTljYjM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-18T07:49:41Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-06-18T07:49:41Z"}, "message": "Auto merge of #86322 - trinity-1686a:rustdoc-fix-overflow-recursive-deref, r=jyn514\n\nfix rustdoc stack overflow on mutually recursive Deref\n\nfix #85095\nfix #85037", "tree": {"sha": "9a1ba1552978fe38b1878472b0c2a7754cd01c33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a1ba1552978fe38b1878472b0c2a7754cd01c33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/966361fe495def7f6ceb63fa769b892089e19cb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/966361fe495def7f6ceb63fa769b892089e19cb3", "html_url": "https://github.com/rust-lang/rust/commit/966361fe495def7f6ceb63fa769b892089e19cb3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/966361fe495def7f6ceb63fa769b892089e19cb3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed3378733574e1acab67f6cd4e9f251be1a31ec4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed3378733574e1acab67f6cd4e9f251be1a31ec4", "html_url": "https://github.com/rust-lang/rust/commit/ed3378733574e1acab67f6cd4e9f251be1a31ec4"}, {"sha": "5f7d44171de8b84558fc76a0f305d83fd6fa34f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f7d44171de8b84558fc76a0f305d83fd6fa34f3", "html_url": "https://github.com/rust-lang/rust/commit/5f7d44171de8b84558fc76a0f305d83fd6fa34f3"}], "stats": {"total": 57, "additions": 44, "deletions": 13}, "files": [{"sha": "62d3c142eeb52962c65147814abbe82811085008", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=966361fe495def7f6ceb63fa769b892089e19cb3", "patch": "@@ -1997,19 +1997,6 @@ fn sidebar_deref_methods(cx: &Context<'_>, out: &mut Buffer, impl_: &Impl, v: &V\n                 out.push_str(\"</div>\");\n             }\n         }\n-\n-        // Recurse into any further impls that might exist for `target`\n-        if let Some(target_did) = target.def_id_full(c) {\n-            if let Some(target_impls) = c.impls.get(&target_did) {\n-                if let Some(target_deref_impl) = target_impls\n-                    .iter()\n-                    .filter(|i| i.inner_impl().trait_.is_some())\n-                    .find(|i| i.inner_impl().trait_.def_id_full(c) == c.deref_trait_did)\n-                {\n-                    sidebar_deref_methods(cx, out, target_deref_impl, target_impls);\n-                }\n-            }\n-        }\n     }\n }\n "}, {"sha": "fcb636ade8f7ad2729ae0f9786b005ba401ef6ed", "filename": "src/test/rustdoc/recursive-deref-sidebar.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Ftest%2Frustdoc%2Frecursive-deref-sidebar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Ftest%2Frustdoc%2Frecursive-deref-sidebar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Frecursive-deref-sidebar.rs?ref=966361fe495def7f6ceb63fa769b892089e19cb3", "patch": "@@ -0,0 +1,22 @@\n+use std::ops::Deref;\n+\n+pub struct A {}\n+impl A { pub fn foo_a(&self) {} }\n+\n+pub struct B {}\n+impl B { pub fn foo_b(&self) {} }\n+\n+pub struct C {}\n+impl C { pub fn foo_c(&self) {} }\n+\n+// @has recursive_deref_sidebar/struct.A.html '//div[@class=\"sidebar-links\"]' 'foo_b'\n+impl Deref for A {\n+    type Target = B;\n+    fn deref(&self) -> &B { todo!() }\n+}\n+\n+// @!has recursive_deref_sidebar/struct.A.html '//div[@class=\"sidebar-links\"]' 'foo_c'\n+impl Deref for B {\n+    type Target = C;\n+    fn deref(&self) -> &C { todo!() }\n+}"}, {"sha": "91db01177c5818f02d1aa86ebbf725b2ba245c52", "filename": "src/test/rustdoc/recursive-deref.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Ftest%2Frustdoc%2Frecursive-deref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966361fe495def7f6ceb63fa769b892089e19cb3/src%2Ftest%2Frustdoc%2Frecursive-deref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Frecursive-deref.rs?ref=966361fe495def7f6ceb63fa769b892089e19cb3", "patch": "@@ -0,0 +1,22 @@\n+use std::ops::Deref;\n+\n+pub struct A;\n+pub struct B;\n+\n+// @has recursive_deref/struct.A.html '//code' 'impl Deref for A'\n+impl Deref for A {\n+    type Target = B;\n+\n+    fn deref(&self) -> &Self::Target {\n+        panic!()\n+    }\n+}\n+\n+// @has recursive_deref/struct.B.html '//code' 'impl Deref for B'\n+impl Deref for B {\n+    type Target = A;\n+\n+    fn deref(&self) -> &Self::Target {\n+        panic!()\n+    }\n+}"}]}