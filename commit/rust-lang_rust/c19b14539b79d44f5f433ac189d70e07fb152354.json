{"sha": "c19b14539b79d44f5f433ac189d70e07fb152354", "node_id": "C_kwDOAAsO6NoAKGMxOWIxNDUzOWI3OWQ0NGY1ZjQzM2FjMTg5ZDcwZTA3ZmIxNTIzNTQ", "commit": {"author": {"name": "Yacin Tmimi", "email": "yacintmimi@gmail.com", "date": "2022-07-20T13:15:51Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2022-07-22T22:57:07Z"}, "message": "test for issue 3164\n\nCloses 3164\n\nShow that when `error_on_line_overflow=true` is set in the rustfmt.toml\nthat an error message is written to stderr.", "tree": {"sha": "abee23c6eaefa2a98608e7e06eeae6bc537753db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abee23c6eaefa2a98608e7e06eeae6bc537753db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c19b14539b79d44f5f433ac189d70e07fb152354", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c19b14539b79d44f5f433ac189d70e07fb152354", "html_url": "https://github.com/rust-lang/rust/commit/c19b14539b79d44f5f433ac189d70e07fb152354", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c19b14539b79d44f5f433ac189d70e07fb152354/comments", "author": {"login": "ytmimi", "id": 29028348, "node_id": "MDQ6VXNlcjI5MDI4MzQ4", "avatar_url": "https://avatars.githubusercontent.com/u/29028348?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ytmimi", "html_url": "https://github.com/ytmimi", "followers_url": "https://api.github.com/users/ytmimi/followers", "following_url": "https://api.github.com/users/ytmimi/following{/other_user}", "gists_url": "https://api.github.com/users/ytmimi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ytmimi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ytmimi/subscriptions", "organizations_url": "https://api.github.com/users/ytmimi/orgs", "repos_url": "https://api.github.com/users/ytmimi/repos", "events_url": "https://api.github.com/users/ytmimi/events{/privacy}", "received_events_url": "https://api.github.com/users/ytmimi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c78c738ba45c4ac4bab3bb74009712e00d307c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c78c738ba45c4ac4bab3bb74009712e00d307c7", "html_url": "https://github.com/rust-lang/rust/commit/4c78c738ba45c4ac4bab3bb74009712e00d307c7"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "701c36fadeafa835f8e5c4372e65c34c01512bba", "filename": "tests/cargo-fmt/main.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcargo-fmt%2Fmain.rs?ref=c19b14539b79d44f5f433ac189d70e07fb152354", "patch": "@@ -98,3 +98,22 @@ fn cargo_fmt_out_of_line_test_modules() {\n         assert!(stdout.contains(&format!(\"Diff in {}\", path.display())))\n     }\n }\n+\n+#[rustfmt_only_ci_test]\n+#[test]\n+fn cargo_fmt_emits_error_on_line_overflow_true() {\n+    // See also https://github.com/rust-lang/rustfmt/issues/3164\n+    let args = [\n+        \"--check\",\n+        \"--manifest-path\",\n+        \"tests/cargo-fmt/source/issue_3164/Cargo.toml\",\n+        \"--\",\n+        \"--config\",\n+        \"error_on_line_overflow=true\",\n+    ];\n+\n+    let (_stdout, stderr) = cargo_fmt(&args);\n+    assert!(stderr.contains(\n+        \"line formatted, but exceeded maximum width (maximum: 100 (see `max_width` option)\"\n+    ))\n+}"}, {"sha": "580ef7e6e24fe1405c83964ae8ca734f46cdd67d", "filename": "tests/cargo-fmt/source/issue_3164/Cargo.toml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2FCargo.toml?ref=c19b14539b79d44f5f433ac189d70e07fb152354", "patch": "@@ -0,0 +1,8 @@\n+[package]\n+name = \"issue_3164\"\n+version = \"0.1.0\"\n+edition = \"2021\"\n+\n+# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n+\n+[dependencies]"}, {"sha": "9330107ac8dc77571b5abe2a11c7d59f796f89d5", "filename": "tests/cargo-fmt/source/issue_3164/src/main.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcargo-fmt%2Fsource%2Fissue_3164%2Fsrc%2Fmain.rs?ref=c19b14539b79d44f5f433ac189d70e07fb152354", "patch": "@@ -0,0 +1,13 @@\n+#[allow(unused_macros)]\n+macro_rules! foo {\n+    ($id:ident) => {\n+        macro_rules! bar {\n+            ($id2:tt) => {\n+                #[cfg(any(target_feature = $id2, target_feature = $id2, target_feature = $id2, target_feature = $id2, target_feature = $id2))]\n+                fn $id() {}\n+            };\n+        }\n+    };\n+}\n+\n+fn main() {}"}, {"sha": "7ff301e80195aa0efdebdaf740e98697a8eaafb8", "filename": "tests/rustfmt/main.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Frustfmt%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c19b14539b79d44f5f433ac189d70e07fb152354/tests%2Frustfmt%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustfmt%2Fmain.rs?ref=c19b14539b79d44f5f433ac189d70e07fb152354", "patch": "@@ -159,3 +159,18 @@ fn mod_resolution_error_path_attribute_does_not_exist() {\n     // The path attribute points to a file that does not exist\n     assert!(stderr.contains(\"does_not_exist.rs does not exist\"));\n }\n+\n+#[test]\n+fn rustfmt_emits_error_on_line_overflow_true() {\n+    // See also https://github.com/rust-lang/rustfmt/issues/3164\n+    let args = [\n+        \"--config\",\n+        \"error_on_line_overflow=true\",\n+        \"tests/cargo-fmt/source/issue_3164/src/main.rs\",\n+    ];\n+\n+    let (_stdout, stderr) = rustfmt(&args);\n+    assert!(stderr.contains(\n+        \"line formatted, but exceeded maximum width (maximum: 100 (see `max_width` option)\"\n+    ))\n+}"}]}