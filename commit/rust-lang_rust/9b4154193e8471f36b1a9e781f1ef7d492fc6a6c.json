{"sha": "9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliNDE1NDE5M2U4NDcxZjM2YjFhOWU3ODFmMWVmN2Q0OTJmYzZhNmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-14T21:43:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-14T21:43:17Z"}, "message": "Auto merge of #76541 - matthiaskrgr:unstable_sort, r=davidtwco\n\nuse sort_unstable to sort primitive types\n\nIt's not important to retain original order if we have &[1, 1, 2, 3] for example.\n\nclippy::stable_sort_primitive", "tree": {"sha": "e6b2d628b74e7881a48bfae79107f09da7db18af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6b2d628b74e7881a48bfae79107f09da7db18af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "html_url": "https://github.com/rust-lang/rust/commit/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41dc3942eb33e8e882b6e4782a9bd9d2b8970647", "url": "https://api.github.com/repos/rust-lang/rust/commits/41dc3942eb33e8e882b6e4782a9bd9d2b8970647", "html_url": "https://github.com/rust-lang/rust/commit/41dc3942eb33e8e882b6e4782a9bd9d2b8970647"}, {"sha": "b4935e07269429e04abe0d6d25f7e3211f4fa3f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4935e07269429e04abe0d6d25f7e3211f4fa3f6", "html_url": "https://github.com/rust-lang/rust/commit/b4935e07269429e04abe0d6d25f7e3211f4fa3f6"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "754b1f13381cb5980e998e00b5b6e16f58dec5f6", "filename": "compiler/rustc_ast/src/util/lev_distance.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_ast%2Fsrc%2Futil%2Flev_distance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_ast%2Fsrc%2Futil%2Flev_distance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Futil%2Flev_distance.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -103,6 +103,7 @@ fn find_match_by_sorted_words<'a>(iter_names: Vec<&'a Symbol>, lookup: &str) ->\n \n fn sort_by_words(name: &str) -> String {\n     let mut split_words: Vec<&str> = name.split('_').collect();\n-    split_words.sort();\n+    // We are sorting primitive &strs and can use unstable sort here\n+    split_words.sort_unstable();\n     split_words.join(\"_\")\n }"}, {"sha": "c97f80cf09ba17ceeddf36937ecbe75c2117e9f8", "filename": "compiler/rustc_ast_lowering/src/expr.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Fexpr.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -1121,7 +1121,7 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                 // features. We check that at least one type is available for\n                 // the current target.\n                 let reg_class = reg.reg_class();\n-                let mut required_features = vec![];\n+                let mut required_features: Vec<&str> = vec![];\n                 for &(_, feature) in reg_class.supported_types(asm_arch) {\n                     if let Some(feature) = feature {\n                         if self.sess.target_features.contains(&Symbol::intern(feature)) {\n@@ -1135,7 +1135,8 @@ impl<'hir> LoweringContext<'_, 'hir> {\n                         break;\n                     }\n                 }\n-                required_features.sort();\n+                // We are sorting primitive strs here and can use unstable sort here\n+                required_features.sort_unstable();\n                 required_features.dedup();\n                 match &required_features[..] {\n                     [] => {}"}, {"sha": "a1c7e47e749add17a11cfc1d52536fe937342371", "filename": "compiler/rustc_lint/src/non_ascii_idents.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_lint%2Fsrc%2Fnon_ascii_idents.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_lint%2Fsrc%2Fnon_ascii_idents.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fnon_ascii_idents.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -341,7 +341,8 @@ impl EarlyLintPass for NonAsciiIdents {\n                         }\n                     }\n \n-                    ch_list.sort();\n+                    // We sort primitive chars here and can use unstable sort\n+                    ch_list.sort_unstable();\n                     ch_list.dedup();\n                     lint_reports.insert((sp, ch_list), augment_script_set);\n                 }"}, {"sha": "d92f1367e7d679208175d98b6a2c3e93389fa28f", "filename": "compiler/rustc_mir/src/monomorphize/partitioning/merging.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpartitioning%2Fmerging.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpartitioning%2Fmerging.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fmonomorphize%2Fpartitioning%2Fmerging.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -74,7 +74,9 @@ pub fn merge_codegen_units<'tcx>(\n \n                 // Sort the names, so things are deterministic and easy to\n                 // predict.\n-                cgu_contents.sort();\n+\n+                // We are sorting primitive &strs here so we can use unstable sort\n+                cgu_contents.sort_unstable();\n \n                 (current_cgu_name, cgu_contents.join(\"--\"))\n             })"}, {"sha": "76a60c45575b8674e6520a7e740c6a1c5edb84af", "filename": "compiler/rustc_mir/src/transform/simplify_try.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fsimplify_try.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fsimplify_try.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fsimplify_try.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -230,8 +230,8 @@ fn get_arm_identity_info<'a, 'tcx>(\n             }\n         }\n     }\n-\n-    nop_stmts.sort();\n+    // We sort primitive usize here so we can use unstable sort\n+    nop_stmts.sort_unstable();\n \n     // Use one of the statements we're going to discard between the point\n     // where the storage location for the variant field becomes live and"}, {"sha": "9a9e57638d7589ad10c85c3c13f94709bcf5407a", "filename": "compiler/rustc_typeck/src/check/mod.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4154193e8471f36b1a9e781f1ef7d492fc6a6c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fmod.rs?ref=9b4154193e8471f36b1a9e781f1ef7d492fc6a6c", "patch": "@@ -4285,11 +4285,13 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                             None\n                         }\n                     })\n-                    .collect::<Vec<_>>();\n+                    .collect::<Vec<usize>>();\n \n                 // Both checked and coerced types could have matched, thus we need to remove\n                 // duplicates.\n-                referenced_in.sort();\n+\n+                // We sort primitive type usize here and can use unstable sort\n+                referenced_in.sort_unstable();\n                 referenced_in.dedup();\n \n                 if let (Some(ref_in), None) = (referenced_in.pop(), referenced_in.pop()) {"}]}