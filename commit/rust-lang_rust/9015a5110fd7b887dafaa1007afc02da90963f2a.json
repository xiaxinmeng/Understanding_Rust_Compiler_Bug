{"sha": "9015a5110fd7b887dafaa1007afc02da90963f2a", "node_id": "C_kwDOAAsO6NoAKDkwMTVhNTExMGZkN2I4ODdkYWZhYTEwMDdhZmMwMmRhOTA5NjNmMmE", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-04-27T15:00:17Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-07-26T11:38:10Z"}, "message": "Collect features from `#[rustc_default_body_unstable]`", "tree": {"sha": "4ae4b5f49865e2639a9e169d64be2d7ae0f4e477", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ae4b5f49865e2639a9e169d64be2d7ae0f4e477"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9015a5110fd7b887dafaa1007afc02da90963f2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9015a5110fd7b887dafaa1007afc02da90963f2a", "html_url": "https://github.com/rust-lang/rust/commit/9015a5110fd7b887dafaa1007afc02da90963f2a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9015a5110fd7b887dafaa1007afc02da90963f2a/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "177af4710464d9f743d64f8792afcb0ee553ba6b", "url": "https://api.github.com/repos/rust-lang/rust/commits/177af4710464d9f743d64f8792afcb0ee553ba6b", "html_url": "https://github.com/rust-lang/rust/commit/177af4710464d9f743d64f8792afcb0ee553ba6b"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "868887c66cdec7a95e1bc723a460718c5d365c0d", "filename": "compiler/rustc_passes/src/lib_features.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9015a5110fd7b887dafaa1007afc02da90963f2a/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9015a5110fd7b887dafaa1007afc02da90963f2a/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Flib_features.rs?ref=9015a5110fd7b887dafaa1007afc02da90963f2a", "patch": "@@ -29,11 +29,16 @@ impl<'tcx> LibFeatureCollector<'tcx> {\n     }\n \n     fn extract(&self, attr: &Attribute) -> Option<(Symbol, Option<Symbol>, Span)> {\n-        let stab_attrs =\n-            [sym::stable, sym::unstable, sym::rustc_const_stable, sym::rustc_const_unstable];\n+        let stab_attrs = [\n+            sym::stable,\n+            sym::unstable,\n+            sym::rustc_const_stable,\n+            sym::rustc_const_unstable,\n+            sym::rustc_default_body_unstable,\n+        ];\n \n         // Find a stability attribute: one of #[stable(\u2026)], #[unstable(\u2026)],\n-        // #[rustc_const_stable(\u2026)], or #[rustc_const_unstable(\u2026)].\n+        // #[rustc_const_stable(\u2026)], #[rustc_const_unstable(\u2026)] or #[rustc_default_body_unstable].\n         if let Some(stab_attr) = stab_attrs.iter().find(|stab_attr| attr.has_name(**stab_attr)) {\n             let meta_kind = attr.meta_kind();\n             if let Some(MetaItemKind::List(ref metas)) = meta_kind {\n@@ -53,8 +58,12 @@ impl<'tcx> LibFeatureCollector<'tcx> {\n                     // This additional check for stability is to make sure we\n                     // don't emit additional, irrelevant errors for malformed\n                     // attributes.\n-                    let is_unstable =\n-                        matches!(*stab_attr, sym::unstable | sym::rustc_const_unstable);\n+                    let is_unstable = matches!(\n+                        *stab_attr,\n+                        sym::unstable\n+                            | sym::rustc_const_unstable\n+                            | sym::rustc_default_body_unstable\n+                    );\n                     if since.is_some() || is_unstable {\n                         return Some((feature, since, attr.span));\n                     }"}]}