{"sha": "09058388dec7b62680fd3d33df4b416d84975884", "node_id": "C_kwDOAAsO6NoAKDA5MDU4Mzg4ZGVjN2I2MjY4MGZkM2QzM2RmNGI0MTZkODQ5NzU4ODQ", "commit": {"author": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2023-02-20T09:47:05Z"}, "committer": {"name": "Alex Macleod", "email": "alex@macleod.io", "date": "2023-02-20T09:54:53Z"}, "message": "Ignore lifetimes from differing contexts in `needless_lifetimes`", "tree": {"sha": "016ee068c89b0ff346f030715087f45f0c0d0b1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/016ee068c89b0ff346f030715087f45f0c0d0b1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/09058388dec7b62680fd3d33df4b416d84975884", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/09058388dec7b62680fd3d33df4b416d84975884", "html_url": "https://github.com/rust-lang/rust/commit/09058388dec7b62680fd3d33df4b416d84975884", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/09058388dec7b62680fd3d33df4b416d84975884/comments", "author": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Alexendoo", "id": 1830331, "node_id": "MDQ6VXNlcjE4MzAzMzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1830331?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alexendoo", "html_url": "https://github.com/Alexendoo", "followers_url": "https://api.github.com/users/Alexendoo/followers", "following_url": "https://api.github.com/users/Alexendoo/following{/other_user}", "gists_url": "https://api.github.com/users/Alexendoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alexendoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alexendoo/subscriptions", "organizations_url": "https://api.github.com/users/Alexendoo/orgs", "repos_url": "https://api.github.com/users/Alexendoo/repos", "events_url": "https://api.github.com/users/Alexendoo/events{/privacy}", "received_events_url": "https://api.github.com/users/Alexendoo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "85d4b5ac4855433fdb7584285db4f0af65805041", "url": "https://api.github.com/repos/rust-lang/rust/commits/85d4b5ac4855433fdb7584285db4f0af65805041", "html_url": "https://github.com/rust-lang/rust/commit/85d4b5ac4855433fdb7584285db4f0af65805041"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "986ffcad883db909db9f0776a73d359a0bec31f0", "filename": "clippy_lints/src/lifetimes.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/09058388dec7b62680fd3d33df4b416d84975884/clippy_lints%2Fsrc%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09058388dec7b62680fd3d33df4b416d84975884/clippy_lints%2Fsrc%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flifetimes.rs?ref=09058388dec7b62680fd3d33df4b416d84975884", "patch": "@@ -144,6 +144,10 @@ fn check_fn_inner<'tcx>(\n         .filter(|param| matches!(param.kind, GenericParamKind::Type { .. }));\n \n     for typ in types {\n+        if !typ.span.eq_ctxt(span) {\n+            return;\n+        }\n+\n         for pred in generics.bounds_for_param(typ.def_id) {\n             if pred.origin == PredicateOrigin::WhereClause {\n                 // has_where_lifetimes checked that this predicate contains no lifetime.\n@@ -181,6 +185,10 @@ fn check_fn_inner<'tcx>(\n     }\n \n     if let Some((elidable_lts, usages)) = could_use_elision(cx, sig.decl, body, trait_sig, generics.params) {\n+        if usages.iter().any(|usage| !usage.ident.span.eq_ctxt(span)) {\n+            return;\n+        }\n+\n         let lts = elidable_lts\n             .iter()\n             // In principle, the result of the call to `Node::ident` could be `unwrap`ped, as `DefId` should refer to a"}, {"sha": "f0f1f9298ac65635416280a5a6600d6282af5d5c", "filename": "tests/ui/needless_lifetimes.fixed", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/09058388dec7b62680fd3d33df4b416d84975884/tests%2Fui%2Fneedless_lifetimes.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/09058388dec7b62680fd3d33df4b416d84975884/tests%2Fui%2Fneedless_lifetimes.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_lifetimes.fixed?ref=09058388dec7b62680fd3d33df4b416d84975884", "patch": "@@ -516,6 +516,16 @@ mod in_macro {\n \n     // no lint on external macro\n     macro_rules::needless_lifetime!();\n+\n+    macro_rules! expanded_lifetime {\n+        ($l:lifetime) => {\n+            fn f<$l>(arg: &$l str) -> &$l str {\n+                arg\n+            }\n+        }\n+    }\n+\n+    expanded_lifetime!('a);\n }\n \n mod issue5787 {"}, {"sha": "ddfd10430038effb10fdfe1a889835a0af6d564d", "filename": "tests/ui/needless_lifetimes.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/09058388dec7b62680fd3d33df4b416d84975884/tests%2Fui%2Fneedless_lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/09058388dec7b62680fd3d33df4b416d84975884/tests%2Fui%2Fneedless_lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_lifetimes.rs?ref=09058388dec7b62680fd3d33df4b416d84975884", "patch": "@@ -516,6 +516,16 @@ mod in_macro {\n \n     // no lint on external macro\n     macro_rules::needless_lifetime!();\n+\n+    macro_rules! expanded_lifetime {\n+        ($l:lifetime) => {\n+            fn f<$l>(arg: &$l str) -> &$l str {\n+                arg\n+            }\n+        }\n+    }\n+\n+    expanded_lifetime!('a);\n }\n \n mod issue5787 {"}]}