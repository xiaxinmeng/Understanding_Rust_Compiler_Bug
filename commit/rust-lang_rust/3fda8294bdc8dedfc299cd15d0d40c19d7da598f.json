{"sha": "3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmZGE4Mjk0YmRjOGRlZGZjMjk5Y2QxNWQwZDQwYzE5ZDdkYTU5OGY=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-11-27T14:06:51Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-12-11T16:43:12Z"}, "message": "test cargo miri test output when testing cargo miri", "tree": {"sha": "c5ce445b5dc0550f45afb4cc23b5ecf36671a8fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c5ce445b5dc0550f45afb4cc23b5ecf36671a8fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "html_url": "https://github.com/rust-lang/rust/commit/3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9417b28de55888d99aeefcd03243294b658b4d97", "url": "https://api.github.com/repos/rust-lang/rust/commits/9417b28de55888d99aeefcd03243294b658b4d97", "html_url": "https://github.com/rust-lang/rust/commit/9417b28de55888d99aeefcd03243294b658b4d97"}], "stats": {"total": 33, "additions": 25, "deletions": 8}, "files": [{"sha": "c7ab8f14df883257467967560064b4f703814621", "filename": "test-cargo-miri/run-test.py", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Frun-test.py", "raw_url": "https://github.com/rust-lang/rust/raw/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Frun-test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Frun-test.py?ref=3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "patch": "@@ -7,11 +7,11 @@\n \n import sys, subprocess\n \n-def test_cargo_miri():\n-    print(\"==> Testing `cargo miri run` <==\")\n+def test(name, cmd, stdout_ref, stderr_ref):\n+    print(\"==> Testing `{}` <==\".format(name))\n     ## Call `cargo miri`, capture all output\n     p = subprocess.Popen(\n-        [\"cargo\", \"miri\", \"run\", \"-q\"],\n+        cmd,\n         stdout=subprocess.PIPE,\n         stderr=subprocess.PIPE\n     )\n@@ -26,17 +26,20 @@ def test_cargo_miri():\n     # Test for failures\n     if p.returncode != 0:\n         sys.exit(1)\n-    if stdout != open('stdout.ref').read():\n+    if stdout != open(stdout_ref).read():\n         print(\"stdout does not match reference\")\n         sys.exit(1)\n-    if stderr != open('stderr.ref').read():\n+    if stderr != open(stderr_ref).read():\n         print(\"stderr does not match reference\")\n         sys.exit(1)\n \n+def test_cargo_miri_run():\n+    test(\"cargo miri run\", [\"cargo\", \"miri\", \"run\", \"-q\"], \"stout.ref\", \"stderr.ref\")\n+\n def test_cargo_miri_test():\n-    print(\"==> Testing `cargo miri test` <==\")\n-    subprocess.check_call([\"cargo\", \"miri\", \"test\"])\n+    # FIXME: validation disabled for now because of https://github.com/rust-lang/rust/issues/54957\n+    test(\"cargo miri test\", [\"cargo\", \"miri\", \"test\", \"-q\", \"--\", \"-Zmiri-disable-validation\"], \"stout.ref\", \"stderr.ref\")\n \n-test_cargo_miri()\n+test_cargo_miri_run()\n test_cargo_miri_test()\n sys.exit(0)"}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "test-cargo-miri/test.stderr.ref", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftest.stderr.ref", "raw_url": "https://github.com/rust-lang/rust/raw/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftest.stderr.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stderr.ref?ref=3fda8294bdc8dedfc299cd15d0d40c19d7da598f"}, {"sha": "94fd56b0cd6f35daa5ebb935ad751d0256fa65d3", "filename": "test-cargo-miri/test.stdout.ref", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftest.stdout.ref", "raw_url": "https://github.com/rust-lang/rust/raw/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftest.stdout.ref", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftest.stdout.ref?ref=3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "patch": "@@ -0,0 +1,7 @@\n+\n+running 2 tests\n+test bar ... ok\n+test baz ... ok\n+\n+test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n+"}, {"sha": "9827ae82d6cfd622c8f60090aa67ae727e985be0", "filename": "test-cargo-miri/tests/foo.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftests%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3fda8294bdc8dedfc299cd15d0d40c19d7da598f/test-cargo-miri%2Ftests%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Ftests%2Ffoo.rs?ref=3fda8294bdc8dedfc299cd15d0d40c19d7da598f", "patch": "@@ -2,3 +2,10 @@\n fn bar() {\n     assert_eq!(4, 4);\n }\n+\n+// Having more than 1 test does seem to make a difference\n+// (i.e., this calls ptr::swap which having just one test does not).\n+#[test]\n+fn baz() {\n+    assert_eq!(5, 5);\n+}"}]}