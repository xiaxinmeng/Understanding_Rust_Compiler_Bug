{"sha": "5321f9559bdb81fe0f2dda881bef2934ca65eba2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzMjFmOTU1OWJkYjgxZmUwZjJkZGE4ODFiZWYyOTM0Y2E2NWViYTI=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-04-24T03:17:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-24T03:17:02Z"}, "message": "Rollup merge of #84250 - jclulow:illumos-bash-bootstrap, r=Mark-Simulacrum\n\nbootstrap: use bash on illumos to run install scripts\n\nThe default illumos shell (\"sh\" in the default PATH) is ksh93, rather\nthan bash, and does not support constructs like \"local\" that came from\nbash.  The bootstrap function for invoking \"install.sh\" scripts should\nuse \"bash\" explicitly there to avoid issues.", "tree": {"sha": "4c6d4a37149fe1beb86092d27184e1f25c698659", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c6d4a37149fe1beb86092d27184e1f25c698659"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5321f9559bdb81fe0f2dda881bef2934ca65eba2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgg42uCRBK7hj4Ov3rIwAAKaUIAJ9vKHaojDoExoes2dZ1rkTK\nrxBEXXxmjtVjrdMT+WNc8CmUUGeK443yHMaUO+O0C3dxJjB+fk59D7yFyg4EdBRo\nUCKZKImNCTFgYFvlcdSjnwAoSFoUOCxV6pN/CepLB/J769gYJaMHVw6yj1hdaJ+x\neYztyTobwZ+oGKNXAWUpwRSV7iumN76y1htED0wF3v5bCqDxcWNDvBxa65uRwbIi\nfTw2OZTHpmzmVrczlesnIl9j5cWdNXOTIxtmSvTo+IfbAwZjILU0Mny36nLBEB3O\na8ZfcloigxUzRP7UbKChanMpzlpzUeZzkK3tQqXF2AuQh9AYMccBGyePXVtjJGQ=\n=/z4X\n-----END PGP SIGNATURE-----\n", "payload": "tree 4c6d4a37149fe1beb86092d27184e1f25c698659\nparent c00439f6822955a786603373c447b0f81d80a3ea\nparent 4873271955dde6d0d4a1e47851b3babf3577005d\nauthor Yuki Okushi <jtitor@2k36.org> 1619234222 +0900\ncommitter GitHub <noreply@github.com> 1619234222 +0900\n\nRollup merge of #84250 - jclulow:illumos-bash-bootstrap, r=Mark-Simulacrum\n\nbootstrap: use bash on illumos to run install scripts\n\nThe default illumos shell (\"sh\" in the default PATH) is ksh93, rather\nthan bash, and does not support constructs like \"local\" that came from\nbash.  The bootstrap function for invoking \"install.sh\" scripts should\nuse \"bash\" explicitly there to avoid issues.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5321f9559bdb81fe0f2dda881bef2934ca65eba2", "html_url": "https://github.com/rust-lang/rust/commit/5321f9559bdb81fe0f2dda881bef2934ca65eba2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5321f9559bdb81fe0f2dda881bef2934ca65eba2/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c00439f6822955a786603373c447b0f81d80a3ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/c00439f6822955a786603373c447b0f81d80a3ea", "html_url": "https://github.com/rust-lang/rust/commit/c00439f6822955a786603373c447b0f81d80a3ea"}, {"sha": "4873271955dde6d0d4a1e47851b3babf3577005d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4873271955dde6d0d4a1e47851b3babf3577005d", "html_url": "https://github.com/rust-lang/rust/commit/4873271955dde6d0d4a1e47851b3babf3577005d"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "13ee909afd5e408897a32d1a23395dd0efe5629e", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5321f9559bdb81fe0f2dda881bef2934ca65eba2/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5321f9559bdb81fe0f2dda881bef2934ca65eba2/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=5321f9559bdb81fe0f2dda881bef2934ca65eba2", "patch": "@@ -17,6 +17,11 @@ use crate::Compiler;\n use crate::builder::{Builder, RunConfig, ShouldRun, Step};\n use crate::config::{Config, TargetSelection};\n \n+#[cfg(target_os = \"illumos\")]\n+const SHELL: &str = \"bash\";\n+#[cfg(not(target_os = \"illumos\"))]\n+const SHELL: &str = \"sh\";\n+\n fn install_sh(\n     builder: &Builder<'_>,\n     package: &str,\n@@ -37,7 +42,7 @@ fn install_sh(\n     let empty_dir = builder.out.join(\"tmp/empty_dir\");\n     t!(fs::create_dir_all(&empty_dir));\n \n-    let mut cmd = Command::new(\"sh\");\n+    let mut cmd = Command::new(SHELL);\n     cmd.current_dir(&empty_dir)\n         .arg(sanitize_sh(&tarball.decompressed_output().join(\"install.sh\")))\n         .arg(format!(\"--prefix={}\", prepare_dir(prefix)))"}]}