{"sha": "e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4YzBhZWI4OGJhMWUxMmQwYzBhMWQwZWQ3YjRhOTBiNDQ0NjBhMjk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-19T08:49:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-04-19T08:49:13Z"}, "message": "Auto merge of #32985 - caipre:rustdoc-disambiguate-impl-anchors, r=alexcrichton\n\nrustdoc: Disambiguate anchors\n\nCloses https://github.com/rust-lang/rust/issues/32890", "tree": {"sha": "11160670040098eb205b14f842c7734d187a37b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/11160670040098eb205b14f842c7734d187a37b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "html_url": "https://github.com/rust-lang/rust/commit/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "14f61c87ff02e57d565d4fab4ce790156c9a596e", "url": "https://api.github.com/repos/rust-lang/rust/commits/14f61c87ff02e57d565d4fab4ce790156c9a596e", "html_url": "https://github.com/rust-lang/rust/commit/14f61c87ff02e57d565d4fab4ce790156c9a596e"}, {"sha": "894caf83648bb0a5e43e7aeb30f806b2fb9099a5", "url": "https://api.github.com/repos/rust-lang/rust/commits/894caf83648bb0a5e43e7aeb30f806b2fb9099a5", "html_url": "https://github.com/rust-lang/rust/commit/894caf83648bb0a5e43e7aeb30f806b2fb9099a5"}], "stats": {"total": 67, "additions": 53, "deletions": 14}, "files": [{"sha": "b845ee6ee0a1ec3bcf76d7669579d7a97ad6168c", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 26, "deletions": 14, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "patch": "@@ -1904,34 +1904,35 @@ fn item_trait(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n     if t.items.is_empty() {\n         write!(w, \"{{ }}\")?;\n     } else {\n+        // FIXME: we should be using a derived_id for the Anchors here\n         write!(w, \"{{\\n\")?;\n         for t in &types {\n             write!(w, \"    \")?;\n-            render_assoc_item(w, t, AssocItemLink::Anchor)?;\n+            render_assoc_item(w, t, AssocItemLink::Anchor(None))?;\n             write!(w, \";\\n\")?;\n         }\n         if !types.is_empty() && !consts.is_empty() {\n             w.write_str(\"\\n\")?;\n         }\n         for t in &consts {\n             write!(w, \"    \")?;\n-            render_assoc_item(w, t, AssocItemLink::Anchor)?;\n+            render_assoc_item(w, t, AssocItemLink::Anchor(None))?;\n             write!(w, \";\\n\")?;\n         }\n         if !consts.is_empty() && !required.is_empty() {\n             w.write_str(\"\\n\")?;\n         }\n         for m in &required {\n             write!(w, \"    \")?;\n-            render_assoc_item(w, m, AssocItemLink::Anchor)?;\n+            render_assoc_item(w, m, AssocItemLink::Anchor(None))?;\n             write!(w, \";\\n\")?;\n         }\n         if !required.is_empty() && !provided.is_empty() {\n             w.write_str(\"\\n\")?;\n         }\n         for m in &provided {\n             write!(w, \"    \")?;\n-            render_assoc_item(w, m, AssocItemLink::Anchor)?;\n+            render_assoc_item(w, m, AssocItemLink::Anchor(None))?;\n             write!(w, \" {{ ... }}\\n\")?;\n         }\n         write!(w, \"}}\")?;\n@@ -1948,7 +1949,7 @@ fn item_trait(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n         write!(w, \"<h3 id='{id}' class='method stab {stab}'><code>\",\n                id = id,\n                stab = m.stability_class())?;\n-        render_assoc_item(w, m, AssocItemLink::Anchor)?;\n+        render_assoc_item(w, m, AssocItemLink::Anchor(Some(&id)))?;\n         write!(w, \"</code>\")?;\n         render_stability_since(w, m, t)?;\n         write!(w, \"</h3>\")?;\n@@ -2045,7 +2046,8 @@ fn naive_assoc_href(it: &clean::Item, link: AssocItemLink) -> String {\n \n     let anchor = format!(\"#{}.{}\", ty, name);\n     match link {\n-        AssocItemLink::Anchor => anchor,\n+        AssocItemLink::Anchor(Some(ref id)) => format!(\"#{}\", id),\n+        AssocItemLink::Anchor(None) => anchor,\n         AssocItemLink::GotoSource(did, _) => {\n             href(did).map(|p| format!(\"{}{}\", p.0, anchor)).unwrap_or(anchor)\n         }\n@@ -2120,7 +2122,8 @@ fn render_assoc_item(w: &mut fmt::Formatter,\n         let name = meth.name.as_ref().unwrap();\n         let anchor = format!(\"#{}.{}\", shortty(meth), name);\n         let href = match link {\n-            AssocItemLink::Anchor => anchor,\n+            AssocItemLink::Anchor(Some(ref id)) => format!(\"#{}\", id),\n+            AssocItemLink::Anchor(None) => anchor,\n             AssocItemLink::GotoSource(did, provided_methods) => {\n                 // We're creating a link from an impl-item to the corresponding\n                 // trait-item and need to map the anchored type accordingly.\n@@ -2381,10 +2384,19 @@ fn render_struct(w: &mut fmt::Formatter, it: &clean::Item,\n \n #[derive(Copy, Clone)]\n enum AssocItemLink<'a> {\n-    Anchor,\n+    Anchor(Option<&'a str>),\n     GotoSource(DefId, &'a HashSet<String>),\n }\n \n+impl<'a> AssocItemLink<'a> {\n+    fn anchor(&self, id: &'a String) -> Self {\n+        match *self {\n+            AssocItemLink::Anchor(_) => { AssocItemLink::Anchor(Some(&id)) },\n+            ref other => *other,\n+        }\n+    }\n+}\n+\n enum AssocItemRender<'a> {\n     All,\n     DerefFor { trait_: &'a clean::Type, type_: &'a clean::Type },\n@@ -2416,7 +2428,7 @@ fn render_assoc_items(w: &mut fmt::Formatter,\n             }\n         };\n         for i in &non_trait {\n-            render_impl(w, cx, i, AssocItemLink::Anchor, render_header,\n+            render_impl(w, cx, i, AssocItemLink::Anchor(None), render_header,\n                         containing_item.stable_since())?;\n         }\n     }\n@@ -2512,32 +2524,32 @@ fn render_impl(w: &mut fmt::Formatter, cx: &Context, i: &Impl, link: AssocItemLi\n                     write!(w, \"<h4 id='{}' class='{}'>\", id, shortty)?;\n                     render_stability_since_raw(w, item.stable_since(), outer_version)?;\n                     write!(w, \"<code>\")?;\n-                    render_assoc_item(w, item, link)?;\n+                    render_assoc_item(w, item, link.anchor(&id))?;\n                     write!(w, \"</code></h4>\\n\")?;\n                 }\n             }\n             clean::TypedefItem(ref tydef, _) => {\n                 let id = derive_id(format!(\"{}.{}\", ItemType::AssociatedType, name));\n                 write!(w, \"<h4 id='{}' class='{}'><code>\", id, shortty)?;\n-                assoc_type(w, item, &Vec::new(), Some(&tydef.type_), link)?;\n+                assoc_type(w, item, &Vec::new(), Some(&tydef.type_), link.anchor(&id))?;\n                 write!(w, \"</code></h4>\\n\")?;\n             }\n             clean::AssociatedConstItem(ref ty, ref default) => {\n                 let id = derive_id(format!(\"{}.{}\", shortty, name));\n                 write!(w, \"<h4 id='{}' class='{}'><code>\", id, shortty)?;\n-                assoc_const(w, item, ty, default.as_ref(), link)?;\n+                assoc_const(w, item, ty, default.as_ref(), link.anchor(&id))?;\n                 write!(w, \"</code></h4>\\n\")?;\n             }\n             clean::ConstantItem(ref c) => {\n                 let id = derive_id(format!(\"{}.{}\", shortty, name));\n                 write!(w, \"<h4 id='{}' class='{}'><code>\", id, shortty)?;\n-                assoc_const(w, item, &c.type_, Some(&c.expr), link)?;\n+                assoc_const(w, item, &c.type_, Some(&c.expr), link.anchor(&id))?;\n                 write!(w, \"</code></h4>\\n\")?;\n             }\n             clean::AssociatedTypeItem(ref bounds, ref default) => {\n                 let id = derive_id(format!(\"{}.{}\", shortty, name));\n                 write!(w, \"<h4 id='{}' class='{}'><code>\", id, shortty)?;\n-                assoc_type(w, item, bounds, default.as_ref(), link)?;\n+                assoc_type(w, item, bounds, default.as_ref(), link.anchor(&id))?;\n                 write!(w, \"</code></h4>\\n\")?;\n             }\n             clean::StrippedItem(..) => return Ok(()),"}, {"sha": "ef62f12d55e3ccfc3dab2cba957c8fbc88a1979e", "filename": "src/test/rustdoc/issue-32890.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29/src%2Ftest%2Frustdoc%2Fissue-32890.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29/src%2Ftest%2Frustdoc%2Fissue-32890.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fissue-32890.rs?ref=e8c0aeb88ba1e12d0c0a1d0ed7b4a90b44460a29", "patch": "@@ -0,0 +1,27 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// @has issue_32890/struct.Foo.html\n+pub struct Foo<T>(T);\n+\n+impl Foo<u8> {\n+    // @has - '//a[@href=\"#method.pass\"]' 'pass'\n+    pub fn pass() {}\n+}\n+\n+impl Foo<u16> {\n+    // @has - '//a[@href=\"#method.pass-1\"]' 'pass'\n+    pub fn pass() {}\n+}\n+\n+impl Foo<u32> {\n+    // @has - '//a[@href=\"#method.pass-2\"]' 'pass'\n+    pub fn pass() {}\n+}"}]}