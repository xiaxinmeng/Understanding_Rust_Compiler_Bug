{"sha": "337c5b5fba002fa8f7ab826102d0885f3648142c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzN2M1YjVmYmEwMDJmYThmN2FiODI2MTAyZDA4ODVmMzY0ODE0MmM=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-07-15T19:05:54Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-07-15T19:05:54Z"}, "message": "Merge pull request #132 from cassiersg/fix-tup-lit\n\nFix bug in rewrite_tup_lit", "tree": {"sha": "04b926162df70013d69261284b7b6d4087ed7393", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04b926162df70013d69261284b7b6d4087ed7393"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/337c5b5fba002fa8f7ab826102d0885f3648142c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/337c5b5fba002fa8f7ab826102d0885f3648142c", "html_url": "https://github.com/rust-lang/rust/commit/337c5b5fba002fa8f7ab826102d0885f3648142c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/337c5b5fba002fa8f7ab826102d0885f3648142c/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04cf309f3280fdd95570593833b4e3bd67765d07", "url": "https://api.github.com/repos/rust-lang/rust/commits/04cf309f3280fdd95570593833b4e3bd67765d07", "html_url": "https://github.com/rust-lang/rust/commit/04cf309f3280fdd95570593833b4e3bd67765d07"}, {"sha": "b93b64381f4431e80f3752fe74714a5c4399d514", "url": "https://api.github.com/repos/rust-lang/rust/commits/b93b64381f4431e80f3752fe74714a5c4399d514", "html_url": "https://github.com/rust-lang/rust/commit/b93b64381f4431e80f3752fe74714a5c4399d514"}], "stats": {"total": 31, "additions": 22, "deletions": 9}, "files": [{"sha": "5dde0419c14cc3cf71adb934963c145094b92908", "filename": "src/expr.rs", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/337c5b5fba002fa8f7ab826102d0885f3648142c/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337c5b5fba002fa8f7ab826102d0885f3648142c/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=337c5b5fba002fa8f7ab826102d0885f3648142c", "patch": "@@ -239,7 +239,13 @@ fn rewrite_tuple_lit(context: &RewriteContext,\n                      width: usize,\n                      offset: usize)\n                      -> Option<String> {\n+    debug!(\"rewrite_tuple_lit: width: {}, offset: {}\", width, offset);\n     let indent = offset + 1;\n+    // In case of length 1, need a trailing comma\n+    if items.len() == 1 {\n+        // 3 = \"(\" + \",)\"\n+        return items[0].rewrite(context, width - 3, indent).map(|s| format!(\"({},)\", s));\n+    }\n \n     let items = itemize_list(context.codemap,\n                              Vec::new(),\n@@ -249,23 +255,16 @@ fn rewrite_tuple_lit(context: &RewriteContext,\n                              |item| item.span.lo,\n                              |item| item.span.hi,\n                              |item| item.rewrite(context,\n-                                                 context.config.max_width - indent - 2,\n+                                                 context.config.max_width - indent - 1,\n                                                  indent)\n                                         .unwrap_or(context.codemap.span_to_snippet(item.span)\n                                                                   .unwrap()),\n                              span.lo + BytePos(1), // Remove parens\n                              span.hi - BytePos(1));\n \n-    // In case of length 1, need a trailing comma\n-    let trailing_separator_tactic = if items.len() == 1 {\n-        SeparatorTactic::Always\n-    } else {\n-        SeparatorTactic::Never\n-    };\n-\n     let fmt = ListFormatting { tactic: ListTactic::HorizontalVertical,\n                                separator: \",\",\n-                               trailing_separator: trailing_separator_tactic,\n+                               trailing_separator: SeparatorTactic::Never,\n                                indent: indent,\n                                h_width: width - 2,\n                                v_width: width - 2,"}, {"sha": "a77fae11cb45e08455f84d8fd76b817c8c4084cb", "filename": "tests/target/tuple.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/337c5b5fba002fa8f7ab826102d0885f3648142c/tests%2Ftarget%2Ftuple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/337c5b5fba002fa8f7ab826102d0885f3648142c/tests%2Ftarget%2Ftuple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Ftuple.rs?ref=337c5b5fba002fa8f7ab826102d0885f3648142c", "patch": "@@ -13,3 +13,17 @@ fn foo() {\n              b, // Comment\n              b /* Trailing comment */);\n }\n+\n+fn a() {\n+    ((aaaaaaaa,\n+      aaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaaaa,\n+      aaaaaaaaaaaaaa),)\n+}\n+\n+fn b() {\n+    ((bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n+     bbbbbbbbbbbbbbbbbb)\n+}"}]}