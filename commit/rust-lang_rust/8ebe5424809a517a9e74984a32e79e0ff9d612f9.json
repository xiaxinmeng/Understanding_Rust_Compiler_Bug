{"sha": "8ebe5424809a517a9e74984a32e79e0ff9d612f9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlYmU1NDI0ODA5YTUxN2E5ZTc0OTg0YTMyZTc5ZTBmZjlkNjEyZjk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-01-30T23:40:44Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-01-31T18:16:26Z"}, "message": "rustc: Move location of `codegen-backends` dir\n\nRight now this directory is located under:\n\n  $sysroot/lib/rustlib/$target/lib/codegen-backends\n\nbut after seeing what we do in a few other places it seems that a more\nappropriate location would be:\n\n  $sysroot/lib/rustlib/$target/codegen-backends\n\nso this commit moves it!", "tree": {"sha": "0315049b77c8cebf8550945ac3621582affba1fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0315049b77c8cebf8550945ac3621582affba1fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ebe5424809a517a9e74984a32e79e0ff9d612f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ebe5424809a517a9e74984a32e79e0ff9d612f9", "html_url": "https://github.com/rust-lang/rust/commit/8ebe5424809a517a9e74984a32e79e0ff9d612f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ebe5424809a517a9e74984a32e79e0ff9d612f9/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "def3269a71be2e737cad27418a3dad9f5bd6cd32", "url": "https://api.github.com/repos/rust-lang/rust/commits/def3269a71be2e737cad27418a3dad9f5bd6cd32", "html_url": "https://github.com/rust-lang/rust/commit/def3269a71be2e737cad27418a3dad9f5bd6cd32"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "780513dd943946853c7085980219fd85c5778729", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=8ebe5424809a517a9e74984a32e79e0ff9d612f9", "patch": "@@ -377,6 +377,11 @@ impl<'a> Builder<'a> {\n         self.ensure(Libdir { compiler, target })\n     }\n \n+    pub fn sysroot_codegen_backends(&self, compiler: Compiler) -> PathBuf {\n+        self.sysroot_libdir(compiler, compiler.host)\n+            .with_file_name(\"codegen-backends\")\n+    }\n+\n     /// Returns the compiler's libdir where it stores the dynamic libraries that\n     /// it itself links against.\n     ///"}, {"sha": "1d5e11c5d6d41c06f55d088a82b6be93914928e1", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=8ebe5424809a517a9e74984a32e79e0ff9d612f9", "patch": "@@ -724,8 +724,7 @@ fn copy_codegen_backends_to_sysroot(builder: &Builder,\n     //\n     // Here we're looking for the output dylib of the `CodegenBackend` step and\n     // we're copying that into the `codegen-backends` folder.\n-    let libdir = builder.sysroot_libdir(target_compiler, target);\n-    let dst = libdir.join(\"codegen-backends\");\n+    let dst = builder.sysroot_codegen_backends(target_compiler);\n     t!(fs::create_dir_all(&dst));\n \n     for backend in builder.config.rust_codegen_backends.iter() {"}, {"sha": "dbb7d19e43285089515cb0c0878214ccc7181b13", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=8ebe5424809a517a9e74984a32e79e0ff9d612f9", "patch": "@@ -435,11 +435,9 @@ impl Step for Rustc {\n             }\n \n             // Copy over the codegen backends\n-            let backends_src = builder.sysroot_libdir(compiler, host)\n-                .join(\"codegen-backends\");\n-            let backends_dst = image.join(\"lib/rustlib\")\n-                .join(&*host)\n-                .join(\"lib/codegen-backends\");\n+            let backends_src = builder.sysroot_codegen_backends(compiler);\n+            let backends_rel = backends_src.strip_prefix(&src).unwrap();\n+            let backends_dst = image.join(&backends_rel);\n             t!(fs::create_dir_all(&backends_dst));\n             cp_r(&backends_src, &backends_dst);\n "}, {"sha": "2bf91f79b2bbe6729c798c962eadd0a846612cc8", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ebe5424809a517a9e74984a32e79e0ff9d612f9/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=8ebe5424809a517a9e74984a32e79e0ff9d612f9", "patch": "@@ -289,7 +289,7 @@ fn get_trans_sysroot(backend_name: &str) -> fn() -> Box<TransCrate> {\n     let sysroot = sysroot_candidates.iter()\n         .map(|sysroot| {\n             let libdir = filesearch::relative_target_lib_path(&sysroot, &target);\n-            sysroot.join(&libdir).join(\"codegen-backends\")\n+            sysroot.join(libdir).with_file_name(\"codegen-backends\")\n         })\n         .filter(|f| {\n             info!(\"codegen backend candidate: {}\", f.display());"}]}