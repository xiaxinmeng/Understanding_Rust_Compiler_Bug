{"sha": "966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2NmU5ZTI0NzFmOTc3MmNkMWI3NTc5M2M3ZDNmY2JmY2U3YTU3ZDU=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-05-02T22:32:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-02T22:32:40Z"}, "message": "Rollup merge of #84072 - nagisa:target-family-two-the-movie, r=petrochenkov\n\nAllow setting `target_family` to multiple values, and implement `target_family=\"wasm\"`\n\nAs per the conclusion in [this thread](https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/Are.20we.20comfortable.20with.20adding.20an.20insta-stable.20cfg.28wasm.29.3F/near/233158441), this implements an ability to specify any number of `target_family` values, allowing for more flexible generic groups, or \"families\", to be created than just the OS-based unix/windows dichotomy.\n\ncc https://github.com/rust-lang/reference/pull/1006", "tree": {"sha": "adc2c7bfaa84bf88aaf5ec0408478b97cab49bd7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/adc2c7bfaa84bf88aaf5ec0408478b97cab49bd7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgjyiJCRBK7hj4Ov3rIwAALIYIAGUkZSoAegCpcXq82lDDOLLe\nhTQAWsVVY5spncblXLG0ZH9cYlGyExcyk8278zfq+O/KmxjsaN46rk71ucn8SUqO\nYqxODzUFGcsm1MNOW7QeG/5KN8Q6/xXEhSWVHCyW9fyAo2aAyISAhZhO0sv/T9ms\nnzrl+q9jgM//te+b0IYh2N/w1nuyEAJsAKmCY4Jzdkpd84WjaCRxFbJd2NpwP7X1\nGZbHwyuNdZKKsxsQjEPiQipMcgdY2Ep4a0YdjRtKyqBcTcIOrqBT6dDiVbBgyFJq\nbcE9x3et+iz2dvReShHOtudX4gkhsxYhyfDfrMHYOMbilQO4IRL8qf5JpjHc6G0=\n=p69J\n-----END PGP SIGNATURE-----\n", "payload": "tree adc2c7bfaa84bf88aaf5ec0408478b97cab49bd7\nparent 6b5de7aaec2955f2c7c7c82521a9186f2ba4f037\nparent 1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89\nauthor Dylan DPC <dylan.dpc@gmail.com> 1619994760 +0200\ncommitter GitHub <noreply@github.com> 1619994760 +0200\n\nRollup merge of #84072 - nagisa:target-family-two-the-movie, r=petrochenkov\n\nAllow setting `target_family` to multiple values, and implement `target_family=\"wasm\"`\n\nAs per the conclusion in [this thread](https://rust-lang.zulipchat.com/#narrow/stream/213817-t-lang/topic/Are.20we.20comfortable.20with.20adding.20an.20insta-stable.20cfg.28wasm.29.3F/near/233158441), this implements an ability to specify any number of `target_family` values, allowing for more flexible generic groups, or \"families\", to be created than just the OS-based unix/windows dichotomy.\n\ncc https://github.com/rust-lang/reference/pull/1006\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "html_url": "https://github.com/rust-lang/rust/commit/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b5de7aaec2955f2c7c7c82521a9186f2ba4f037", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b5de7aaec2955f2c7c7c82521a9186f2ba4f037", "html_url": "https://github.com/rust-lang/rust/commit/6b5de7aaec2955f2c7c7c82521a9186f2ba4f037"}, {"sha": "1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89", "html_url": "https://github.com/rust-lang/rust/commit/1a491e2304387c2a50c5a0ae219e8d5a0ce1bc89"}], "stats": {"total": 78, "additions": 44, "deletions": 34}, "files": [{"sha": "1ddd7d694547d895b4f6034a00fb4eb1ce527edb", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -816,7 +816,7 @@ fn default_configuration(sess: &Session) -> CrateConfig {\n     ret.reserve(6); // the minimum number of insertions\n     // Target bindings.\n     ret.insert((sym::target_os, Some(Symbol::intern(os))));\n-    if let Some(ref fam) = sess.target.os_family {\n+    for fam in &sess.target.families {\n         ret.insert((sym::target_family, Some(Symbol::intern(fam))));\n         if fam == \"windows\" {\n             ret.insert((sym::windows, None));"}, {"sha": "bc2ec6709011a6cacb6db75cb30ae0e4cc3bdd60", "filename": "compiler/rustc_target/src/spec/apple_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fapple_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -23,7 +23,7 @@ pub fn opts(os: &str) -> TargetOptions {\n         function_sections: false,\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         is_like_osx: true,\n         dwarf_version: Some(2),\n         has_rpath: true,"}, {"sha": "fb94498c131fd38283062d398271ccdf02c0727e", "filename": "compiler/rustc_target/src/spec/dragonfly_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fdragonfly_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fdragonfly_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fdragonfly_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"dragonfly\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         position_independent_executables: true,"}, {"sha": "5d3c28e5f29c9d80a19675ff9f85d5ff4ce830be", "filename": "compiler/rustc_target/src/spec/freebsd_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffreebsd_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffreebsd_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffreebsd_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"freebsd\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         position_independent_executables: true,"}, {"sha": "13264dffeb4edd955caaf67e80247fc95ff07d3a", "filename": "compiler/rustc_target/src/spec/fuchsia_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffuchsia_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffuchsia_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Ffuchsia_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -25,7 +25,7 @@ pub fn opts() -> TargetOptions {\n         linker: Some(\"rust-lld\".to_owned()),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         is_like_fuchsia: true,\n         linker_is_gnu: true,\n         pre_link_args,"}, {"sha": "fae56f6a82dc8e7222b736c573166601f06a9045", "filename": "compiler/rustc_target/src/spec/haiku_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fhaiku_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fhaiku_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fhaiku_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"haiku\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         relro_level: RelroLevel::Full,\n         linker_is_gnu: true,\n         ..Default::default()"}, {"sha": "2e365d210f3f62356498e666dd010bf286b75a04", "filename": "compiler/rustc_target/src/spec/illumos_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fillumos_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fillumos_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fillumos_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -20,7 +20,7 @@ pub fn opts() -> TargetOptions {\n         dynamic_linking: true,\n         executables: true,\n         has_rpath: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         is_like_solaris: true,\n         limit_rdylib_exports: false, // Linker doesn't support this\n         eliminate_frame_pointer: false,"}, {"sha": "65c343a5f2169b07e645c79c42935a56642e5c22", "filename": "compiler/rustc_target/src/spec/l4re_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fl4re_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fl4re_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fl4re_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -20,7 +20,7 @@ pub fn opts() -> TargetOptions {\n         executables: true,\n         panic_strategy: PanicStrategy::Abort,\n         linker: Some(\"ld\".to_string()),\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         ..Default::default()\n     }\n }"}, {"sha": "184659e22d98693dabc233c64676ab709af615dd", "filename": "compiler/rustc_target/src/spec/linux_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"linux\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         position_independent_executables: true,"}, {"sha": "dfc97447ce042bb9b11a887725cc7f9b6e305eae", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 19, "deletions": 13, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -1042,8 +1042,12 @@ pub struct TargetOptions {\n     pub staticlib_prefix: String,\n     /// String to append to the name of every static library. Defaults to \".a\".\n     pub staticlib_suffix: String,\n-    /// OS family to use for conditional compilation. Valid options: \"unix\", \"windows\".\n-    pub os_family: Option<String>,\n+    /// Values of the `target_family` cfg set for this target.\n+    ///\n+    /// Common options are: \"unix\", \"windows\". Defaults to no families.\n+    ///\n+    /// See <https://doc.rust-lang.org/reference/conditional-compilation.html#target_family>.\n+    pub families: Vec<String>,\n     /// Whether the target toolchain's ABI supports returning small structs as an integer.\n     pub abi_return_struct_as_int: bool,\n     /// Whether the target toolchain is like macOS's. Only useful for compiling against iOS/macOS,\n@@ -1293,7 +1297,7 @@ impl Default for TargetOptions {\n             exe_suffix: String::new(),\n             staticlib_prefix: \"lib\".to_string(),\n             staticlib_suffix: \".a\".to_string(),\n-            os_family: None,\n+            families: Vec::new(),\n             abi_return_struct_as_int: false,\n             is_like_osx: false,\n             is_like_solaris: false,\n@@ -1605,14 +1609,6 @@ impl Target {\n                         .map(|s| s.to_string() );\n                 }\n             } );\n-            ($key_name:ident = $json_name:expr, optional) => ( {\n-                let name = $json_name;\n-                if let Some(o) = obj.find(name) {\n-                    base.$key_name = o\n-                        .as_string()\n-                        .map(|s| s.to_string() );\n-                }\n-            } );\n             ($key_name:ident, LldFlavor) => ( {\n                 let name = (stringify!($key_name)).replace(\"_\", \"-\");\n                 obj.find(&name[..]).and_then(|o| o.as_string().and_then(|s| {\n@@ -1759,6 +1755,16 @@ impl Target {\n                     Some(Ok(()))\n                 })).unwrap_or(Ok(()))\n             } );\n+            ($key_name:ident, TargetFamilies) => ( {\n+                let value = obj.find(\"target-family\");\n+                if let Some(v) = value.and_then(Json::as_array) {\n+                    base.$key_name = v.iter()\n+                        .map(|a| a.as_string().unwrap().to_string())\n+                        .collect();\n+                } else if let Some(v) = value.and_then(Json::as_string) {\n+                    base.$key_name = vec![v.to_string()];\n+                }\n+            } );\n         }\n \n         if let Some(s) = obj.find(\"target-endian\").and_then(Json::as_string) {\n@@ -1802,7 +1808,7 @@ impl Target {\n         key!(exe_suffix);\n         key!(staticlib_prefix);\n         key!(staticlib_suffix);\n-        key!(os_family = \"target-family\", optional);\n+        key!(families, TargetFamilies);\n         key!(abi_return_struct_as_int, bool);\n         key!(is_like_osx, bool);\n         key!(is_like_solaris, bool);\n@@ -2042,7 +2048,7 @@ impl ToJson for Target {\n         target_option_val!(exe_suffix);\n         target_option_val!(staticlib_prefix);\n         target_option_val!(staticlib_suffix);\n-        target_option_val!(os_family, \"target-family\");\n+        target_option_val!(families, \"target-family\");\n         target_option_val!(abi_return_struct_as_int);\n         target_option_val!(is_like_osx);\n         target_option_val!(is_like_solaris);"}, {"sha": "602fb6eb6413b7ac50d82ad5dde01e74351227e1", "filename": "compiler/rustc_target/src/spec/netbsd_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fnetbsd_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fnetbsd_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fnetbsd_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"netbsd\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         no_default_libraries: false,\n         has_rpath: true,"}, {"sha": "8f33bacd9228eb34166cbadd488257d8f728067c", "filename": "compiler/rustc_target/src/spec/openbsd_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fopenbsd_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fopenbsd_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fopenbsd_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -5,7 +5,7 @@ pub fn opts() -> TargetOptions {\n         os: \"openbsd\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         abi_return_struct_as_int: true,"}, {"sha": "72052b9e2e2e3e19f7f328057a057dc71a1f503a", "filename": "compiler/rustc_target/src/spec/redox_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fredox_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fredox_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fredox_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -6,7 +6,7 @@ pub fn opts() -> TargetOptions {\n         env: \"relibc\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         position_independent_executables: true,"}, {"sha": "4c922eb5cea55081d8c251501b657d412dd8adbf", "filename": "compiler/rustc_target/src/spec/solaris_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fsolaris_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fsolaris_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fsolaris_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -6,7 +6,7 @@ pub fn opts() -> TargetOptions {\n         dynamic_linking: true,\n         executables: true,\n         has_rpath: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         is_like_solaris: true,\n         limit_rdylib_exports: false, // Linker doesn't support this\n         eh_frame_header: false,"}, {"sha": "0e8e87f2dff5c9512574cc8c5b192d882c5a6d58", "filename": "compiler/rustc_target/src/spec/vxworks_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fvxworks_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fvxworks_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fvxworks_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -9,7 +9,7 @@ pub fn opts() -> TargetOptions {\n         exe_suffix: \".vxe\".to_string(),\n         dynamic_linking: true,\n         executables: true,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         linker_is_gnu: true,\n         has_rpath: true,\n         has_elf_tls: true,"}, {"sha": "ddf28b423f0d2df4266fe4780399b384eb6edc70", "filename": "compiler/rustc_target/src/spec/wasm32_unknown_emscripten.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm32_unknown_emscripten.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm32_unknown_emscripten.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm32_unknown_emscripten.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -38,7 +38,7 @@ pub fn target() -> Target {\n         is_like_emscripten: true,\n         panic_strategy: PanicStrategy::Unwind,\n         post_link_args,\n-        os_family: Some(\"unix\".to_string()),\n+        families: vec![\"unix\".to_string()],\n         ..options\n     };\n     Target {"}, {"sha": "87e740de08e9175e0099c03bac8ff93252d65c63", "filename": "compiler/rustc_target/src/spec/wasm_base.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwasm_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -61,6 +61,7 @@ pub fn options() -> TargetOptions {\n \n     TargetOptions {\n         is_like_wasm: true,\n+        families: vec![\"wasm\".to_string()],\n \n         // we allow dynamic linking, but only cdylibs. Basically we allow a\n         // final library artifact that exports some symbols (a wasm module) but"}, {"sha": "35a52896f6fa628e6842da4b68de2029b9a59260", "filename": "compiler/rustc_target/src/spec/windows_gnu_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_gnu_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_gnu_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_gnu_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -71,7 +71,7 @@ pub fn opts() -> TargetOptions {\n         dll_prefix: String::new(),\n         dll_suffix: \".dll\".to_string(),\n         exe_suffix: \".exe\".to_string(),\n-        os_family: Some(\"windows\".to_string()),\n+        families: vec![\"windows\".to_string()],\n         is_like_windows: true,\n         allows_weak_linkage: false,\n         pre_link_args,"}, {"sha": "0d58618a449a901bcf5955a352885c96b3e0156a", "filename": "compiler/rustc_target/src/spec/windows_msvc_base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_msvc_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_msvc_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fwindows_msvc_base.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -13,7 +13,7 @@ pub fn opts() -> TargetOptions {\n         exe_suffix: \".exe\".to_string(),\n         staticlib_prefix: String::new(),\n         staticlib_suffix: \".lib\".to_string(),\n-        os_family: Some(\"windows\".to_string()),\n+        families: vec![\"windows\".to_string()],\n         crt_static_allows_dylibs: true,\n         crt_static_respected: true,\n         requires_uwtable: true,"}, {"sha": "c7d196a2aa6eba992610f4ea1319b68450f37a99", "filename": "src/test/ui/cfg/cfg-family.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Fcfg-family.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -1,6 +1,6 @@\n-// run-pass\n+// build-pass\n // pretty-expanded FIXME #23616\n-// ignore-wasm32-bare no target_family\n+// ignore-wasm32-bare no bare family\n // ignore-sgx\n \n #[cfg(windows)]"}, {"sha": "90a59fab8e250b7c2808e21492146600abf425b5", "filename": "src/test/ui/cfg/cfg-target-family.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966e9e2471f9772cd1b75793c7d3fcbfce7a57d5/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Fcfg-target-family.rs?ref=966e9e2471f9772cd1b75793c7d3fcbfce7a57d5", "patch": "@@ -1,5 +1,4 @@\n-// run-pass\n-// ignore-wasm32-bare no target_family\n+// build-pass\n // ignore-sgx\n \n // pretty-expanded FIXME #23616\n@@ -11,3 +10,7 @@ pub fn main() {\n #[cfg(target_family = \"unix\")]\n pub fn main() {\n }\n+\n+#[cfg(target_family=\"wasm\")]\n+pub fn main() {\n+}"}]}