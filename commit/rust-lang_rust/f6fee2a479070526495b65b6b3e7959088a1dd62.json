{"sha": "f6fee2a479070526495b65b6b3e7959088a1dd62", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2ZmVlMmE0NzkwNzA1MjY0OTViNjViNmIzZTc5NTkwODhhMWRkNjI=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-01-13T23:28:42Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-01-27T11:46:26Z"}, "message": "Fixed off-by-one spans in MIR borrowck errors.", "tree": {"sha": "43667b1568cf4abbe5527305f29c8da96bcdc339", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43667b1568cf4abbe5527305f29c8da96bcdc339"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6fee2a479070526495b65b6b3e7959088a1dd62", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlpsZpIACgkQAXYLT59T\n8VS6+xAAt1sTck0micSPWK72CABTZ1sgv7DPEK5G0YjFl8ee0BRBCMDeyDRNrdNs\nBbHrE8lopeX+ymZRWPvNlw2QoWrEtgm04rjmCb/TOE6s27WuhlrQg7hBIEkiVa0S\nSxJZ9JXwrJlHLbuGL+nSJPn4hA0ktP8NyIOZZR0ZyB9+Oa7IH2S279f4hYnTKQqd\nAXRsrFAARUKIb8moqkeMdNdovDk/GMXLs6bR79a/0mbnl6DMcYVQ47d6U+ZDMBpm\nCOE5kTOQz31ibgg9EaB9XkxqMqAUUkAjNd5oZB9CcXwBm1UghACNbTHCUsDLjsf+\nxDvXzXolBmOLgS1rxbTphq07E7rxOHNH+DPCaczW02GewubY+D1iq+c0mg01npZd\ntDc47v5ujA9Pgogzi161vAV67wz5olQdZZKamjmtG7E6clVirGerT48Ac9dqGm3t\nYHJHoEz0X/TWzfovgMKCymwf/F6tvMxtwO0d3CSO/DlZTkJh4BC0gMQUuro9bNJV\nMW3tkKzUjrWewR1Na96TIM2bdR9bsE4Hh3VBgR7ZN5hOE3wtnS0yciTACDVHrrRP\njDZmDzcGFuutpOthYVR91nExah4boieWEZ68Ci6HLpshlGj9y8ce7qNq1eEazjcV\nvdgkEEk2hCw/pAaZHs3kXS0bHqV90Nkx0Ww3ThkXAJzcleeSs00=\n=gvnG\n-----END PGP SIGNATURE-----", "payload": "tree 43667b1568cf4abbe5527305f29c8da96bcdc339\nparent 6d00c9686becb0a84f7f4885fcaf9a764c201890\nauthor David Wood <david@davidtw.co> 1515886122 +0000\ncommitter David Wood <david@davidtw.co> 1517053586 +0000\n\nFixed off-by-one spans in MIR borrowck errors.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6fee2a479070526495b65b6b3e7959088a1dd62", "html_url": "https://github.com/rust-lang/rust/commit/f6fee2a479070526495b65b6b3e7959088a1dd62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6fee2a479070526495b65b6b3e7959088a1dd62/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d00c9686becb0a84f7f4885fcaf9a764c201890", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d00c9686becb0a84f7f4885fcaf9a764c201890", "html_url": "https://github.com/rust-lang/rust/commit/6d00c9686becb0a84f7f4885fcaf9a764c201890"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "389e06e93349050ea359492fd205caa1b3024ec9", "filename": "src/librustc_mir/build/scope.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f6fee2a479070526495b65b6b3e7959088a1dd62/src%2Flibrustc_mir%2Fbuild%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6fee2a479070526495b65b6b3e7959088a1dd62/src%2Flibrustc_mir%2Fbuild%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fscope.rs?ref=f6fee2a479070526495b65b6b3e7959088a1dd62", "patch": "@@ -695,10 +695,17 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                 if let DropKind::Value { .. } = drop_kind {\n                     scope.needs_cleanup = true;\n                 }\n+\n                 let region_scope_span = region_scope.span(self.hir.tcx(),\n                                                           &self.hir.region_scope_tree);\n-                // Attribute scope exit drops to scope's closing brace\n-                let scope_end = region_scope_span.with_lo(region_scope_span.hi());\n+                // Attribute scope exit drops to scope's closing brace.\n+                // Without this check when finding the endpoint, we'll run into an ICE.\n+                let scope_end = if region_scope_span.hi().0 == 0 {\n+                    region_scope_span\n+                } else {\n+                    region_scope_span.end_point()\n+                };\n+\n                 scope.drops.push(DropData {\n                     span: scope_end,\n                     location: place.clone(),"}]}