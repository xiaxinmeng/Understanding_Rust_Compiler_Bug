{"sha": "d77da9da84fc89908ad01578c33c2dca8f597ffe", "node_id": "C_kwDOAAsO6NoAKGQ3N2RhOWRhODRmYzg5OTA4YWQwMTU3OGMzM2MyZGNhOGY1OTdmZmU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-05T13:05:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-08-05T13:05:34Z"}, "message": "Auto merge of #100073 - dpaoliello:externvar, r=michaelwoerister\n\nAdd test for raw-dylib with an external variable\n\nAll existing tests of link kind `raw-dylib` only validate the ability to link against functions, but it is also possible to link against variables.\n\nThis adds tests for linking against a variable using `raw-dylib` both by-name and by-ordinal.", "tree": {"sha": "00e7a11bbb113dcd22d23227557af1d788ae2133", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00e7a11bbb113dcd22d23227557af1d788ae2133"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d77da9da84fc89908ad01578c33c2dca8f597ffe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d77da9da84fc89908ad01578c33c2dca8f597ffe", "html_url": "https://github.com/rust-lang/rust/commit/d77da9da84fc89908ad01578c33c2dca8f597ffe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d77da9da84fc89908ad01578c33c2dca8f597ffe/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9bbbf60b0442f1d56fc39f30274be77acc79164c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bbbf60b0442f1d56fc39f30274be77acc79164c", "html_url": "https://github.com/rust-lang/rust/commit/9bbbf60b0442f1d56fc39f30274be77acc79164c"}, {"sha": "0a754b309ce05a34a10aac339c1a4253b7a551ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a754b309ce05a34a10aac339c1a4253b7a551ee", "html_url": "https://github.com/rust-lang/rust/commit/0a754b309ce05a34a10aac339c1a4253b7a551ee"}], "stats": {"total": 142, "additions": 133, "deletions": 9}, "files": [{"sha": "2b213ac5c71f0b76f51514a9fe8c16382dbea332", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -209,7 +209,14 @@ impl CheckAttrVisitor<'_> {\n         }\n \n         // FIXME(@lcnr): this doesn't belong here.\n-        if matches!(target, Target::Closure | Target::Fn | Target::Method(_) | Target::ForeignFn) {\n+        if matches!(\n+            target,\n+            Target::Closure\n+                | Target::Fn\n+                | Target::Method(_)\n+                | Target::ForeignFn\n+                | Target::ForeignStatic\n+        ) {\n             self.tcx.ensure().codegen_fn_attrs(self.tcx.hir().local_def_id(hir_id));\n         }\n "}, {"sha": "ab1dc3a4105b7af70e61558c6c8d325d81af3ddf", "filename": "src/test/run-make/raw-dylib-c/extern_1.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Fextern_1.c", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Fextern_1.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Fextern_1.c?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -1,5 +1,7 @@\n #include <stdio.h>\n \n+__declspec(dllexport) int extern_variable = 0;\n+\n __declspec(dllexport) void extern_fn_1() {\n     printf(\"extern_fn_1\\n\");\n     fflush(stdout);\n@@ -10,6 +12,11 @@ __declspec(dllexport) void extern_fn_2() {\n     fflush(stdout);\n }\n \n+__declspec(dllexport) void print_extern_variable() {\n+    printf(\"extern_variable value: %d\\n\", extern_variable);\n+    fflush(stdout);\n+}\n+\n __declspec(dllexport) void extern_fn_with_long_name() {\n     printf(\"extern_fn_with_long_name; got the rename\\n\");\n     fflush(stdout);"}, {"sha": "74e0d3813d9462dad366b341911f5b07058ace55", "filename": "src/test/run-make/raw-dylib-c/lib.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Flib.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -12,12 +12,20 @@ extern {\n \n pub fn library_function() {\n     #[link(name = \"extern_1\", kind = \"raw-dylib\")]\n-    extern { fn extern_fn_2(); }\n+    extern {\n+        fn extern_fn_2();\n+        fn print_extern_variable();\n+        static mut extern_variable: i32;\n+    }\n \n     unsafe {\n         extern_fn_1();\n         extern_fn_2();\n         extern_fn_3();\n+        extern_variable = 42;\n+        print_extern_variable();\n+        extern_variable = -42;\n+        print_extern_variable();\n     }\n }\n "}, {"sha": "cd9fe47bee473f0a8a41311c38f93a27d2c32def", "filename": "src/test/run-make/raw-dylib-c/output.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Foutput.txt", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Foutput.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-c%2Foutput.txt?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -1,3 +1,5 @@\n extern_fn_1\n extern_fn_2; didn't get the rename\n extern_fn_3\n+extern_variable value: 42\n+extern_variable value: -42"}, {"sha": "aabf32ff19f0fda0176272649c65bd0278ff4b52", "filename": "src/test/run-make/raw-dylib-link-ordinal/exporter.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.c", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.c", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.c?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -3,3 +3,10 @@\n void exported_function() {\n     printf(\"exported_function\\n\");\n }\n+\n+int exported_variable = 0;\n+\n+void print_exported_variable() {\n+    printf(\"exported_variable value: %d\\n\", exported_variable);\n+    fflush(stdout);\n+}"}, {"sha": "5d87c580a54d58cf06740fdaa15c97e014e5dc22", "filename": "src/test/run-make/raw-dylib-link-ordinal/exporter.def", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.def", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.def", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Fexporter.def?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -1,3 +1,5 @@\n LIBRARY exporter\n EXPORTS\n     exported_function @13 NONAME\n+    exported_variable @5 NONAME\n+    print_exported_variable @9 NONAME"}, {"sha": "5efce4e938c8ff6b7f4f808f98d41b54ee1564fa", "filename": "src/test/run-make/raw-dylib-link-ordinal/lib.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Flib.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -4,10 +4,18 @@\n extern {\n     #[link_ordinal(13)]\n     fn imported_function();\n+    #[link_ordinal(5)]\n+    static mut imported_variable: i32;\n+    #[link_ordinal(9)]\n+    fn print_imported_variable();\n }\n \n pub fn library_function() {\n     unsafe {\n         imported_function();\n+        imported_variable = 42;\n+        print_imported_variable();\n+        imported_variable = -42;\n+        print_imported_variable();\n     }\n }"}, {"sha": "a4b2031d98b486a2a38145605606be4476af7363", "filename": "src/test/run-make/raw-dylib-link-ordinal/output.txt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Foutput.txt", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Foutput.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fraw-dylib-link-ordinal%2Foutput.txt?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -1 +1,3 @@\n exported_function\n+exported_variable value: 42\n+exported_variable value: -42"}, {"sha": "0594b1384ec2345fb6bd7f95c5e9ac9c02d671c6", "filename": "src/test/ui/feature-gates/feature-gate-raw-dylib-2.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -3,6 +3,9 @@ extern \"C\" {\n     #[link_ordinal(42)]\n     //~^ ERROR: the `#[link_ordinal]` attribute is an experimental feature\n     fn foo();\n+    #[link_ordinal(5)]\n+    //~^ ERROR: the `#[link_ordinal]` attribute is an experimental feature\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "d39969b61cac23986498fca82859c3e58f99bc62", "filename": "src/test/ui/feature-gates/feature-gate-raw-dylib-2.stderr", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-raw-dylib-2.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -7,6 +7,15 @@ LL |     #[link_ordinal(42)]\n    = note: see issue #58713 <https://github.com/rust-lang/rust/issues/58713> for more information\n    = help: add `#![feature(raw_dylib)]` to the crate attributes to enable\n \n-error: aborting due to previous error\n+error[E0658]: the `#[link_ordinal]` attribute is an experimental feature\n+  --> $DIR/feature-gate-raw-dylib-2.rs:6:5\n+   |\n+LL |     #[link_ordinal(5)]\n+   |     ^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #58713 <https://github.com/rust-lang/rust/issues/58713> for more information\n+   = help: add `#![feature(raw_dylib)]` to the crate attributes to enable\n+\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0658`."}, {"sha": "77f425c3e4530200e234caaa7b56c807b3367e79", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-and-name.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -7,6 +7,10 @@ extern \"C\" {\n     #[link_ordinal(42)]\n     //~^ ERROR cannot use `#[link_name]` with `#[link_ordinal]`\n     fn foo();\n+    #[link_name=\"foo\"]\n+    #[link_ordinal(5)]\n+    //~^ ERROR cannot use `#[link_name]` with `#[link_ordinal]`\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "dfe9d031c776d7faec47c722bfb18010663d9934", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-and-name.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-and-name.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -13,5 +13,11 @@ error: cannot use `#[link_name]` with `#[link_ordinal]`\n LL |     #[link_ordinal(42)]\n    |     ^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to previous error; 1 warning emitted\n+error: cannot use `#[link_name]` with `#[link_ordinal]`\n+  --> $DIR/link-ordinal-and-name.rs:11:5\n+   |\n+LL |     #[link_ordinal(5)]\n+   |     ^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}, {"sha": "4687fe47f906e0124905f80c74bb4667c0518fc9", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-invalid-format.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -6,6 +6,9 @@ extern \"C\" {\n     #[link_ordinal(\"JustMonika\")]\n     //~^ ERROR illegal ordinal format in `link_ordinal`\n     fn foo();\n+    #[link_ordinal(\"JustMonika\")]\n+    //~^ ERROR illegal ordinal format in `link_ordinal`\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "1d0fad6cb49db11d804eadd71d0bddbf49d1ea3d", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-invalid-format.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-invalid-format.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -15,5 +15,13 @@ LL |     #[link_ordinal(\"JustMonika\")]\n    |\n    = note: an unsuffixed integer value, e.g., `1`, is expected\n \n-error: aborting due to previous error; 1 warning emitted\n+error: illegal ordinal format in `link_ordinal`\n+  --> $DIR/link-ordinal-invalid-format.rs:9:5\n+   |\n+LL |     #[link_ordinal(\"JustMonika\")]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: an unsuffixed integer value, e.g., `1`, is expected\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}, {"sha": "becf2700aebc55518133d133e7e72baa29dd7998", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-missing-argument.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -6,6 +6,9 @@ extern \"C\" {\n     #[link_ordinal()]\n     //~^ ERROR incorrect number of arguments to `#[link_ordinal]`\n     fn foo();\n+    #[link_ordinal()]\n+    //~^ ERROR incorrect number of arguments to `#[link_ordinal]`\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "5b0ec869d03b8225995fa9b6d8d3cd3ec0c33261", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-missing-argument.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-missing-argument.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -15,5 +15,13 @@ LL |     #[link_ordinal()]\n    |\n    = note: the attribute requires exactly one argument\n \n-error: aborting due to previous error; 1 warning emitted\n+error: incorrect number of arguments to `#[link_ordinal]`\n+  --> $DIR/link-ordinal-missing-argument.rs:9:5\n+   |\n+LL |     #[link_ordinal()]\n+   |     ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: the attribute requires exactly one argument\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}, {"sha": "7b07d09e72a5d3b64258a6807c362067cbfef28e", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-multiple.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -7,6 +7,9 @@ extern \"C\" {\n     #[link_ordinal(1)] //~ ERROR multiple `link_ordinal` attributes\n     #[link_ordinal(2)]\n     fn foo();\n+    #[link_ordinal(1)] //~ ERROR multiple `link_ordinal` attributes\n+    #[link_ordinal(2)]\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "92a39b3d1b09951672a895cc5e570b72530e9186", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-multiple.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-multiple.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -19,5 +19,17 @@ note: attribute also specified here\n LL |     #[link_ordinal(2)]\n    |     ^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to previous error; 1 warning emitted\n+error: multiple `link_ordinal` attributes\n+  --> $DIR/link-ordinal-multiple.rs:10:5\n+   |\n+LL |     #[link_ordinal(1)]\n+   |     ^^^^^^^^^^^^^^^^^^ help: remove this attribute\n+   |\n+note: attribute also specified here\n+  --> $DIR/link-ordinal-multiple.rs:11:5\n+   |\n+LL |     #[link_ordinal(2)]\n+   |     ^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}, {"sha": "99d7d9d0b7edabb06785e145dcf4566dee329eeb", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-large.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -6,6 +6,9 @@ extern \"C\" {\n     #[link_ordinal(72436)]\n     //~^ ERROR ordinal value in `link_ordinal` is too large: `72436`\n     fn foo();\n+    #[link_ordinal(72436)]\n+    //~^ ERROR ordinal value in `link_ordinal` is too large: `72436`\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "36f278bd85645e09391e9cd488f587b436db270e", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-large.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-large.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -15,5 +15,13 @@ LL |     #[link_ordinal(72436)]\n    |\n    = note: the value may not exceed `u16::MAX`\n \n-error: aborting due to previous error; 1 warning emitted\n+error: ordinal value in `link_ordinal` is too large: `72436`\n+  --> $DIR/link-ordinal-too-large.rs:9:5\n+   |\n+LL |     #[link_ordinal(72436)]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: the value may not exceed `u16::MAX`\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}, {"sha": "eca4186e593e82c4180b5bb4addaf656c14a4ff4", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-many-arguments.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.rs?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -6,6 +6,9 @@ extern \"C\" {\n     #[link_ordinal(3, 4)]\n     //~^ ERROR incorrect number of arguments to `#[link_ordinal]`\n     fn foo();\n+    #[link_ordinal(3, 4)]\n+    //~^ ERROR incorrect number of arguments to `#[link_ordinal]`\n+    static mut imported_variable: i32;\n }\n \n fn main() {}"}, {"sha": "745aab24dc768ce6a498757807920192e44ded1d", "filename": "src/test/ui/rfc-2627-raw-dylib/link-ordinal-too-many-arguments.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d77da9da84fc89908ad01578c33c2dca8f597ffe/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2627-raw-dylib%2Flink-ordinal-too-many-arguments.stderr?ref=d77da9da84fc89908ad01578c33c2dca8f597ffe", "patch": "@@ -15,5 +15,13 @@ LL |     #[link_ordinal(3, 4)]\n    |\n    = note: the attribute requires exactly one argument\n \n-error: aborting due to previous error; 1 warning emitted\n+error: incorrect number of arguments to `#[link_ordinal]`\n+  --> $DIR/link-ordinal-too-many-arguments.rs:9:5\n+   |\n+LL |     #[link_ordinal(3, 4)]\n+   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: the attribute requires exactly one argument\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}]}