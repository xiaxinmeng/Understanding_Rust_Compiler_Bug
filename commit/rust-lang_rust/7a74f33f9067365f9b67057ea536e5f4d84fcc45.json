{"sha": "7a74f33f9067365f9b67057ea536e5f4d84fcc45", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhNzRmMzNmOTA2NzM2NWY5YjY3MDU3ZWE1MzZlNWY0ZDg0ZmNjNDU=", "commit": {"author": {"name": "L117", "email": "l117@l117.xyz", "date": "2019-06-07T23:02:15Z"}, "committer": {"name": "L117", "email": "l117@l117.xyz", "date": "2019-06-07T23:39:52Z"}, "message": "Remove useless allocations in macro_rules follow logic.", "tree": {"sha": "53a1c74e108ed8a74a870209efae8cb66caf681d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53a1c74e108ed8a74a870209efae8cb66caf681d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a74f33f9067365f9b67057ea536e5f4d84fcc45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a74f33f9067365f9b67057ea536e5f4d84fcc45", "html_url": "https://github.com/rust-lang/rust/commit/7a74f33f9067365f9b67057ea536e5f4d84fcc45", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a74f33f9067365f9b67057ea536e5f4d84fcc45/comments", "author": {"login": "L117", "id": 50594896, "node_id": "MDQ6VXNlcjUwNTk0ODk2", "avatar_url": "https://avatars.githubusercontent.com/u/50594896?v=4", "gravatar_id": "", "url": "https://api.github.com/users/L117", "html_url": "https://github.com/L117", "followers_url": "https://api.github.com/users/L117/followers", "following_url": "https://api.github.com/users/L117/following{/other_user}", "gists_url": "https://api.github.com/users/L117/gists{/gist_id}", "starred_url": "https://api.github.com/users/L117/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/L117/subscriptions", "organizations_url": "https://api.github.com/users/L117/orgs", "repos_url": "https://api.github.com/users/L117/repos", "events_url": "https://api.github.com/users/L117/events{/privacy}", "received_events_url": "https://api.github.com/users/L117/received_events", "type": "User", "site_admin": false}, "committer": {"login": "L117", "id": 50594896, "node_id": "MDQ6VXNlcjUwNTk0ODk2", "avatar_url": "https://avatars.githubusercontent.com/u/50594896?v=4", "gravatar_id": "", "url": "https://api.github.com/users/L117", "html_url": "https://github.com/L117", "followers_url": "https://api.github.com/users/L117/followers", "following_url": "https://api.github.com/users/L117/following{/other_user}", "gists_url": "https://api.github.com/users/L117/gists{/gist_id}", "starred_url": "https://api.github.com/users/L117/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/L117/subscriptions", "organizations_url": "https://api.github.com/users/L117/orgs", "repos_url": "https://api.github.com/users/L117/repos", "events_url": "https://api.github.com/users/L117/events{/privacy}", "received_events_url": "https://api.github.com/users/L117/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d132f544f9d74e3cc047ef211e57eae60b78e5c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/d132f544f9d74e3cc047ef211e57eae60b78e5c5", "html_url": "https://github.com/rust-lang/rust/commit/d132f544f9d74e3cc047ef211e57eae60b78e5c5"}], "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "5dd3138c9adf01ba1094193c612e665341e7e609", "filename": "src/libsyntax/ext/tt/macro_rules.rs", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/7a74f33f9067365f9b67057ea536e5f4d84fcc45/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a74f33f9067365f9b67057ea536e5f4d84fcc45/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs?ref=7a74f33f9067365f9b67057ea536e5f4d84fcc45", "patch": "@@ -909,7 +909,7 @@ fn check_matcher_core(sess: &ParseSess,\n                             continue 'each_last;\n                         }\n                         IsInFollow::Yes => {}\n-                        IsInFollow::No(ref possible) => {\n+                        IsInFollow::No(possible) => {\n                             let may_be = if last.tokens.len() == 1 &&\n                                 suffix_first.tokens.len() == 1\n                             {\n@@ -933,7 +933,7 @@ fn check_matcher_core(sess: &ParseSess,\n                                 format!(\"not allowed after `{}` fragments\", frag_spec),\n                             );\n                             let msg = \"allowed there are: \";\n-                            match &possible[..] {\n+                            match possible {\n                                 &[] => {}\n                                 &[t] => {\n                                     err.note(&format!(\n@@ -997,7 +997,7 @@ fn frag_can_be_followed_by_any(frag: &str) -> bool {\n \n enum IsInFollow {\n     Yes,\n-    No(Vec<&'static str>),\n+    No(&'static [&'static str]),\n     Invalid(String, &'static str),\n }\n \n@@ -1029,28 +1029,28 @@ fn is_in_follow(tok: &quoted::TokenTree, frag: &str) -> IsInFollow {\n                 IsInFollow::Yes\n             },\n             \"stmt\" | \"expr\"  => {\n-                let tokens = vec![\"`=>`\", \"`,`\", \"`;`\"];\n+                const TOKENS: &[&str] = &[\"`=>`\", \"`,`\", \"`;`\"];\n                 match tok {\n                     TokenTree::Token(token) => match token.kind {\n                         FatArrow | Comma | Semi => IsInFollow::Yes,\n-                        _ => IsInFollow::No(tokens),\n+                        _ => IsInFollow::No(TOKENS),\n                     },\n-                    _ => IsInFollow::No(tokens),\n+                    _ => IsInFollow::No(TOKENS),\n                 }\n             },\n             \"pat\" => {\n-                let tokens = vec![\"`=>`\", \"`,`\", \"`=`\", \"`|`\", \"`if`\", \"`in`\"];\n+                const TOKENS: &[&str] = &[\"`=>`\", \"`,`\", \"`=`\", \"`|`\", \"`if`\", \"`in`\"];\n                 match tok {\n                     TokenTree::Token(token) => match token.kind {\n                         FatArrow | Comma | Eq | BinOp(token::Or) => IsInFollow::Yes,\n                         Ident(name, false) if name == kw::If || name == kw::In => IsInFollow::Yes,\n-                        _ => IsInFollow::No(tokens),\n+                        _ => IsInFollow::No(TOKENS),\n                     },\n-                    _ => IsInFollow::No(tokens),\n+                    _ => IsInFollow::No(TOKENS),\n                 }\n             },\n             \"path\" | \"ty\" => {\n-                let tokens = vec![\n+                const TOKENS: &[&str] = &[\n                     \"`{`\", \"`[`\", \"`=>`\", \"`,`\", \"`>`\",\"`=`\", \"`:`\", \"`;`\", \"`|`\", \"`as`\",\n                     \"`where`\",\n                 ];\n@@ -1062,11 +1062,11 @@ fn is_in_follow(tok: &quoted::TokenTree, frag: &str) -> IsInFollow {\n                         BinOp(token::Or) => IsInFollow::Yes,\n                         Ident(name, false) if name == kw::As ||\n                                               name == kw::Where => IsInFollow::Yes,\n-                        _ => IsInFollow::No(tokens),\n+                        _ => IsInFollow::No(TOKENS),\n                     },\n                     TokenTree::MetaVarDecl(_, _, frag) if frag.name == sym::block =>\n                         IsInFollow::Yes,\n-                    _ => IsInFollow::No(tokens),\n+                    _ => IsInFollow::No(TOKENS),\n                 }\n             },\n             \"ident\" | \"lifetime\" => {\n@@ -1084,22 +1084,22 @@ fn is_in_follow(tok: &quoted::TokenTree, frag: &str) -> IsInFollow {\n             },\n             \"vis\" => {\n                 // Explicitly disallow `priv`, on the off chance it comes back.\n-                let tokens = vec![\"`,`\", \"an ident\", \"a type\"];\n+                const TOKENS: &[&str] = &[\"`,`\", \"an ident\", \"a type\"];\n                 match tok {\n                     TokenTree::Token(token) => match token.kind {\n                         Comma => IsInFollow::Yes,\n                         Ident(name, is_raw) if is_raw || name != kw::Priv => IsInFollow::Yes,\n                         _ => if token.can_begin_type() {\n                             IsInFollow::Yes\n                         } else {\n-                            IsInFollow::No(tokens)\n+                            IsInFollow::No(TOKENS)\n                         }\n                     },\n                     TokenTree::MetaVarDecl(_, _, frag) if frag.name == sym::ident\n                                                        || frag.name == sym::ty\n                                                        || frag.name == sym::path =>\n                         IsInFollow::Yes,\n-                    _ => IsInFollow::No(tokens),\n+                    _ => IsInFollow::No(TOKENS),\n                 }\n             },\n             \"\" => IsInFollow::Yes, // kw::Invalid"}]}