{"sha": "3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiOWZlNzdiZmNkNGM4MDBmYWI4YWZjZGNjODJkMzFmYWNkYzUxNWI=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2017-06-04T18:44:57Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2017-06-22T20:12:01Z"}, "message": "Fix NaN handling in is_sign_negative/positive\n\nSee #42425", "tree": {"sha": "464db7167313be8d61001eabd038521e9fcf0d0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/464db7167313be8d61001eabd038521e9fcf0d0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "html_url": "https://github.com/rust-lang/rust/commit/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0da9721ab49d80bf74208e94a891b12c4a248507", "url": "https://api.github.com/repos/rust-lang/rust/commits/0da9721ab49d80bf74208e94a891b12c4a248507", "html_url": "https://github.com/rust-lang/rust/commit/0da9721ab49d80bf74208e94a891b12c4a248507"}], "stats": {"total": 86, "additions": 40, "deletions": 46}, "files": [{"sha": "aca37221f094f55101df79aaf2bb96a61b573c49", "filename": "src/libcore/num/f32.rs", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibcore%2Fnum%2Ff32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibcore%2Fnum%2Ff32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Ff32.rs?ref=3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "patch": "@@ -205,18 +205,25 @@ impl Float for f32 {\n         }\n     }\n \n-    /// Returns `true` if `self` is positive, including `+0.0` and\n-    /// `Float::infinity()`.\n+    /// Returns `true` if and only if `self` has a positive sign, including `+0.0`, `NaN`s with\n+    /// positive sign bit and positive infinity.\n     #[inline]\n     fn is_sign_positive(self) -> bool {\n-        self > 0.0 || (1.0 / self) == INFINITY\n+        !self.is_sign_negative()\n     }\n \n-    /// Returns `true` if `self` is negative, including `-0.0` and\n-    /// `Float::neg_infinity()`.\n+    /// Returns `true` if and only if `self` has a negative sign, including `-0.0`, `NaN`s with\n+    /// negative sign bit and negative infinity.\n     #[inline]\n     fn is_sign_negative(self) -> bool {\n-        self < 0.0 || (1.0 / self) == NEG_INFINITY\n+        // IEEE754 says: isSignMinus(x) is true if and only if x has negative sign. isSignMinus\n+        // applies to zeros and NaNs as well.\n+        #[repr(C)]\n+        union F32Bytes {\n+            f: f32,\n+            b: u32\n+        }\n+        unsafe { F32Bytes { f: self }.b & 0x8000_0000 != 0 }\n     }\n \n     /// Returns the reciprocal (multiplicative inverse) of the number."}, {"sha": "ebe5daa67a77f6c0d3a07a01cec7c40c7f075acf", "filename": "src/libcore/num/f64.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibcore%2Fnum%2Ff64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibcore%2Fnum%2Ff64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Ff64.rs?ref=3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "patch": "@@ -205,18 +205,23 @@ impl Float for f64 {\n         }\n     }\n \n-    /// Returns `true` if `self` is positive, including `+0.0` and\n-    /// `Float::infinity()`.\n+    /// Returns `true` if and only if `self` has a positive sign, including `+0.0`, `NaN`s with\n+    /// positive sign bit and positive infinity.\n     #[inline]\n     fn is_sign_positive(self) -> bool {\n-        self > 0.0 || (1.0 / self) == INFINITY\n+        !self.is_sign_negative()\n     }\n \n-    /// Returns `true` if `self` is negative, including `-0.0` and\n-    /// `Float::neg_infinity()`.\n+    /// Returns `true` if and only if `self` has a negative sign, including `-0.0`, `NaN`s with\n+    /// negative sign bit and negative infinity.\n     #[inline]\n     fn is_sign_negative(self) -> bool {\n-        self < 0.0 || (1.0 / self) == NEG_INFINITY\n+        #[repr(C)]\n+        union F64Bytes {\n+            f: f64,\n+            b: u64\n+        }\n+        unsafe { F64Bytes { f: self }.b & 0x8000_0000_0000_0000 != 0 }\n     }\n \n     /// Returns the reciprocal (multiplicative inverse) of the number."}, {"sha": "2f5a7c72411c34d98ecd2e60d708d08b238fb153", "filename": "src/libstd/f32.rs", "status": "modified", "additions": 8, "deletions": 16, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibstd%2Ff32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibstd%2Ff32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ff32.rs?ref=3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "patch": "@@ -365,39 +365,29 @@ impl f32 {\n     #[inline]\n     pub fn signum(self) -> f32 { num::Float::signum(self) }\n \n-    /// Returns `true` if `self`'s sign bit is positive, including\n-    /// `+0.0` and `INFINITY`.\n+    /// Returns `true` if and only if `self` has a positive sign, including `+0.0`, `NaN`s with\n+    /// positive sign bit and positive infinity.\n     ///\n     /// ```\n-    /// use std::f32;\n-    ///\n-    /// let nan = f32::NAN;\n     /// let f = 7.0_f32;\n     /// let g = -7.0_f32;\n     ///\n     /// assert!(f.is_sign_positive());\n     /// assert!(!g.is_sign_positive());\n-    /// // Requires both tests to determine if is `NaN`\n-    /// assert!(!nan.is_sign_positive() && !nan.is_sign_negative());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[inline]\n     pub fn is_sign_positive(self) -> bool { num::Float::is_sign_positive(self) }\n \n-    /// Returns `true` if `self`'s sign is negative, including `-0.0`\n-    /// and `NEG_INFINITY`.\n+    /// Returns `true` if and only if `self` has a negative sign, including `-0.0`, `NaN`s with\n+    /// negative sign bit and negative infinity.\n     ///\n     /// ```\n-    /// use std::f32;\n-    ///\n-    /// let nan = f32::NAN;\n     /// let f = 7.0f32;\n     /// let g = -7.0f32;\n     ///\n     /// assert!(!f.is_sign_negative());\n     /// assert!(g.is_sign_negative());\n-    /// // Requires both tests to determine if is `NaN`.\n-    /// assert!(!nan.is_sign_positive() && !nan.is_sign_negative());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[inline]\n@@ -1186,7 +1176,7 @@ mod tests {\n         assert!(!nan.is_infinite());\n         assert!(!nan.is_finite());\n         assert!(!nan.is_normal());\n-        assert!(!nan.is_sign_positive());\n+        assert!(nan.is_sign_positive());\n         assert!(!nan.is_sign_negative());\n         assert_eq!(Fp::Nan, nan.classify());\n     }\n@@ -1430,7 +1420,8 @@ mod tests {\n         assert!(!(-1f32).is_sign_positive());\n         assert!(!NEG_INFINITY.is_sign_positive());\n         assert!(!(1f32/NEG_INFINITY).is_sign_positive());\n-        assert!(!NAN.is_sign_positive());\n+        assert!(NAN.is_sign_positive());\n+        assert!(!(-NAN).is_sign_positive());\n     }\n \n     #[test]\n@@ -1443,6 +1434,7 @@ mod tests {\n         assert!(NEG_INFINITY.is_sign_negative());\n         assert!((1f32/NEG_INFINITY).is_sign_negative());\n         assert!(!NAN.is_sign_negative());\n+        assert!((-NAN).is_sign_negative());\n     }\n \n     #[test]"}, {"sha": "3513546fb64c4d57c59ed3270d64ec3fe3132152", "filename": "src/libstd/f64.rs", "status": "modified", "additions": 8, "deletions": 18, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibstd%2Ff64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b9fe77bfcd4c800fab8afcdcc82d31facdc515b/src%2Flibstd%2Ff64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ff64.rs?ref=3b9fe77bfcd4c800fab8afcdcc82d31facdc515b", "patch": "@@ -303,21 +303,15 @@ impl f64 {\n     #[inline]\n     pub fn signum(self) -> f64 { num::Float::signum(self) }\n \n-    /// Returns `true` if `self`'s sign bit is positive, including\n-    /// `+0.0` and `INFINITY`.\n+    /// Returns `true` if and only if `self` has a positive sign, including `+0.0`, `NaN`s with\n+    /// positive sign bit and positive infinity.\n     ///\n     /// ```\n-    /// use std::f64;\n-    ///\n-    /// let nan: f64 = f64::NAN;\n-    ///\n     /// let f = 7.0_f64;\n     /// let g = -7.0_f64;\n     ///\n     /// assert!(f.is_sign_positive());\n     /// assert!(!g.is_sign_positive());\n-    /// // Requires both tests to determine if is `NaN`\n-    /// assert!(!nan.is_sign_positive() && !nan.is_sign_negative());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[inline]\n@@ -328,21 +322,15 @@ impl f64 {\n     #[inline]\n     pub fn is_positive(self) -> bool { num::Float::is_sign_positive(self) }\n \n-    /// Returns `true` if `self`'s sign is negative, including `-0.0`\n-    /// and `NEG_INFINITY`.\n+    /// Returns `true` if and only if `self` has a negative sign, including `-0.0`, `NaN`s with\n+    /// negative sign bit and negative infinity.\n     ///\n     /// ```\n-    /// use std::f64;\n-    ///\n-    /// let nan = f64::NAN;\n-    ///\n     /// let f = 7.0_f64;\n     /// let g = -7.0_f64;\n     ///\n     /// assert!(!f.is_sign_negative());\n     /// assert!(g.is_sign_negative());\n-    /// // Requires both tests to determine if is `NaN`.\n-    /// assert!(!nan.is_sign_positive() && !nan.is_sign_negative());\n     /// ```\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[inline]\n@@ -1103,7 +1091,7 @@ mod tests {\n         assert!(!nan.is_infinite());\n         assert!(!nan.is_finite());\n         assert!(!nan.is_normal());\n-        assert!(!nan.is_sign_positive());\n+        assert!(nan.is_sign_positive());\n         assert!(!nan.is_sign_negative());\n         assert_eq!(Fp::Nan, nan.classify());\n     }\n@@ -1346,7 +1334,8 @@ mod tests {\n         assert!(!(-1f64).is_sign_positive());\n         assert!(!NEG_INFINITY.is_sign_positive());\n         assert!(!(1f64/NEG_INFINITY).is_sign_positive());\n-        assert!(!NAN.is_sign_positive());\n+        assert!(NAN.is_sign_positive());\n+        assert!(!(-NAN).is_sign_positive());\n     }\n \n     #[test]\n@@ -1359,6 +1348,7 @@ mod tests {\n         assert!(NEG_INFINITY.is_sign_negative());\n         assert!((1f64/NEG_INFINITY).is_sign_negative());\n         assert!(!NAN.is_sign_negative());\n+        assert!((-NAN).is_sign_negative());\n     }\n \n     #[test]"}]}