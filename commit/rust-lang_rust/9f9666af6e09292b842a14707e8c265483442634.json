{"sha": "9f9666af6e09292b842a14707e8c265483442634", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmOTY2NmFmNmUwOTI5MmI4NDJhMTQ3MDdlOGMyNjU0ODM0NDI2MzQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-30T04:34:46Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-30T05:58:34Z"}, "message": "Tweak makefiles, change the way the fuzzer is built\n\nSince librustc and the fuzzer depend on rustllvm, build them\nlike rustc, linking to libraries in lib instead of lib/rustc/$(target)", "tree": {"sha": "2c9f71f4c7d90f9100a6d5c80f425aac6bc45b47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c9f71f4c7d90f9100a6d5c80f425aac6bc45b47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f9666af6e09292b842a14707e8c265483442634", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f9666af6e09292b842a14707e8c265483442634", "html_url": "https://github.com/rust-lang/rust/commit/9f9666af6e09292b842a14707e8c265483442634", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f9666af6e09292b842a14707e8c265483442634/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9385ad49529551e9d59404315f2995bf41c763e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9385ad49529551e9d59404315f2995bf41c763e5", "html_url": "https://github.com/rust-lang/rust/commit/9385ad49529551e9d59404315f2995bf41c763e5"}], "stats": {"total": 39, "additions": 25, "deletions": 14}, "files": [{"sha": "a0a1e3f6f6e767aa22cbf576ce587da71dcfab8d", "filename": "Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9f9666af6e09292b842a14707e8c265483442634/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/9f9666af6e09292b842a14707e8c265483442634/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=9f9666af6e09292b842a14707e8c265483442634", "patch": "@@ -226,7 +226,8 @@ CFG_INFO := $(info cfg: *** compiler is in snapshot transition ***)\n CFG_INFO := $(info cfg: *** stage2 and later will not be built ***)\n CFG_INFO := $(info cfg:)\n \n-all: $(SREQ0$(CFG_HOST_TRIPLE)) $(SREQ1$(CFG_HOST_TRIPLE)) $(GENERATED) $(DOCS) $(FUZZ)\n+all: $(SREQ0$(CFG_HOST_TRIPLE)) $(SREQ1$(CFG_HOST_TRIPLE)) \\\n+     $(GENERATED) $(DOCS) $(FUZZ)\n else\n \n ALL_SREQS = $(foreach target,$(CFG_TARGET_TRIPLES), \\"}, {"sha": "a36e3b92a3ccf9d6452ac74c8f77c94283a31c41", "filename": "mk/fuzzer.mk", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/9f9666af6e09292b842a14707e8c265483442634/mk%2Ffuzzer.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9f9666af6e09292b842a14707e8c265483442634/mk%2Ffuzzer.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ffuzzer.mk?ref=9f9666af6e09292b842a14707e8c265483442634", "patch": "@@ -1,9 +1,19 @@\n-# At the moment the fuzzer only exists in stage1.\n-\n FUZZER_CRATE := $(S)src/fuzzer/fuzzer.rc\n FUZZER_INPUTS := $(wildcard $(addprefix $(S)src/fuzzer/, *.rs))\n \n-stage1/bin/fuzzer$(X): $(FUZZER_CRATE) $(FUZZER_INPUTS) $(SREQ1) \\\n-                   stage1/lib/rustc/$(CFG_HOST_TRIPLE)/$(CFG_LIBRUSTC)\n-\t@$(call E, compile_and_link: $@)\n-\t$(STAGE1) -o $@ $<\n+define FUZZ_STAGE_N\n+\n+stage$(2)/bin/fuzzer$$(X): $$(FUZZER_CRATE) $$(FUZZER_INPUTS) \\\n+                          $$(SREQ$(2)$(CFG_HOST_TRIPLE)) \\\n+                          stage$(2)/lib/$$(CFG_RUNTIME)                       \\\n+                          stage$(2)/lib/$$(CFG_RUSTLLVM)                      \\\n+                          stage$(2)/lib/$$(CFG_STDLIB) \\\n+                          stage$(2)/lib/$$(CFG_LIBRUSTC)\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)) -L stage1/lib -o $$@ $$<\n+\n+endef\n+\n+$(eval $(call FUZZ_STAGE_N,0,1))\n+$(eval $(call FUZZ_STAGE_N,1,2))\n+$(eval $(call FUZZ_STAGE_N,2,3))"}, {"sha": "bf390561c079ec228440751b260ac4db25ca9612", "filename": "mk/stageN.mk", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/9f9666af6e09292b842a14707e8c265483442634/mk%2FstageN.mk", "raw_url": "https://github.com/rust-lang/rust/raw/9f9666af6e09292b842a14707e8c265483442634/mk%2FstageN.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2FstageN.mk?ref=9f9666af6e09292b842a14707e8c265483442634", "patch": "@@ -36,7 +36,13 @@ stage$(2)/bin/rustc$$(X): $$(COMPILER_CRATE) $$(COMPILER_INPUTS)          \\\n                           stage$(1)/bin/lib/$$(CFG_STDLIB) \\\n                           $$(SREQ$(1)$(3))\n \t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(1)) -L stage$(2) -o $$@ $$<\n+\t$$(STAGE$(1)) -L stage$(2)/lib -o $$@ $$<\n+\n+stage$(2)/lib/$$(CFG_LIBRUSTC): \\\n+          $$(COMPILER_CRATE) $$(COMPILER_INPUTS) \\\n+          $$(SREQ$(2)$(3))\n+\t@$$(call E, compile_and_link: $$@)\n+\t$$(STAGE$(1)) -L stage$(2)/lib --lib -o $$@ $$<\n \n stage$(2)/lib/$$(CFG_RUNTIME): rt/$$(CFG_RUNTIME)\n \t@$$(call E, cp: $$@)\n@@ -71,12 +77,6 @@ stage$(2)/lib/rustc/$(3)/main.o: rt/main.o\n \t@$$(call E, cp: $$@)\n \t$$(Q)cp $$< $$@\n \n-stage$(2)/lib/rustc/$(3)/$$(CFG_LIBRUSTC): \\\n-          $$(COMPILER_CRATE) $$(COMPILER_INPUTS) \\\n-          $$(SREQ$(2)$(3))\n-\t@$$(call E, compile_and_link: $$@)\n-\t$$(STAGE$(2)) --lib -o $$@ $$<\n-\n stage$(2)/lib/rustc/$(3)/$$(CFG_STDLIB): \\\n         $$(STDLIB_CRATE) $$(STDLIB_INPUTS) \\\n         stage$(2)/bin/rustc$$(X)               \\"}]}