{"sha": "5118a51b4d49a139ea21d280001105948de298f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxMThhNTFiNGQ0OWExMzllYTIxZDI4MDAwMTEwNTk0OGRlMjk4Zjc=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-09-06T19:07:14Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-09-06T21:40:07Z"}, "message": "rustbuild: Propagate LLD to more places when `use-lld` is enabled", "tree": {"sha": "adfeb57f7fa72150cb75209651925df7829c40a7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/adfeb57f7fa72150cb75209651925df7829c40a7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5118a51b4d49a139ea21d280001105948de298f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5118a51b4d49a139ea21d280001105948de298f7", "html_url": "https://github.com/rust-lang/rust/commit/5118a51b4d49a139ea21d280001105948de298f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5118a51b4d49a139ea21d280001105948de298f7/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e6b563b934c0f5b57b38c57efdd005ed100d64c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e6b563b934c0f5b57b38c57efdd005ed100d64c", "html_url": "https://github.com/rust-lang/rust/commit/8e6b563b934c0f5b57b38c57efdd005ed100d64c"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "3694bdbf67054e68d44d757e48979bb67b6ba179", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=5118a51b4d49a139ea21d280001105948de298f7", "patch": "@@ -112,6 +112,9 @@ fn main() {\n         if let Ok(host_linker) = env::var(\"RUSTC_HOST_LINKER\") {\n             cmd.arg(format!(\"-Clinker={}\", host_linker));\n         }\n+        if env::var_os(\"RUSTC_HOST_FUSE_LD_LLD\").is_some() {\n+            cmd.arg(\"-Clink-args=-fuse-ld=lld\");\n+        }\n \n         if let Ok(s) = env::var(\"RUSTC_HOST_CRT_STATIC\") {\n             if s == \"true\" {"}, {"sha": "cb58eb89ad870315fff8516a02459a853dd1185a", "filename": "src/bootstrap/bin/rustdoc.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustdoc.rs?ref=5118a51b4d49a139ea21d280001105948de298f7", "patch": "@@ -42,11 +42,14 @@ fn main() {\n     if env::var_os(\"RUSTC_FORCE_UNSTABLE\").is_some() {\n         cmd.arg(\"-Z\").arg(\"force-unstable-if-unmarked\");\n     }\n-    if let Some(linker) = env::var_os(\"RUSTC_TARGET_LINKER\") {\n+    if let Some(linker) = env::var_os(\"RUSTDOC_LINKER\") {\n         let mut arg = OsString::from(\"-Clinker=\");\n         arg.push(&linker);\n         cmd.arg(arg);\n     }\n+    if env::var_os(\"RUSTDOC_FUSE_LD_LLD\").is_some() {\n+        cmd.arg(\"-Clink-args=-fuse-ld=lld\");\n+    }\n \n     // Needed to be able to run all rustdoc tests.\n     if let Some(ref x) = env::var_os(\"RUSTDOC_RESOURCE_SUFFIX\") {"}, {"sha": "ca2e159d2d948f451904550b271ad701dc3bc65a", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=5118a51b4d49a139ea21d280001105948de298f7", "patch": "@@ -756,7 +756,10 @@ impl<'a> Builder<'a> {\n         cmd.env_remove(\"MFLAGS\");\n \n         if let Some(linker) = self.linker(compiler.host) {\n-            cmd.env(\"RUSTC_TARGET_LINKER\", linker);\n+            cmd.env(\"RUSTDOC_LINKER\", linker);\n+        }\n+        if self.config.use_lld && !compiler.host.contains(\"msvc\") {\n+            cmd.env(\"RUSTDOC_FUSE_LD_LLD\", \"1\");\n         }\n         cmd\n     }\n@@ -1044,6 +1047,9 @@ impl<'a> Builder<'a> {\n         if let Some(host_linker) = self.linker(compiler.host) {\n             cargo.env(\"RUSTC_HOST_LINKER\", host_linker);\n         }\n+        if self.config.use_lld && !compiler.host.contains(\"msvc\") {\n+            cargo.env(\"RUSTC_HOST_FUSE_LD_LLD\", \"1\");\n+        }\n \n         if let Some(target_linker) = self.linker(target) {\n             let target = crate::envify(&target.triple);"}, {"sha": "98a219e39792d45a6f17a974c585f5c9440b2eb7", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5118a51b4d49a139ea21d280001105948de298f7/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=5118a51b4d49a139ea21d280001105948de298f7", "patch": "@@ -601,7 +601,10 @@ impl Step for RustdocTheme {\n             .env(\"RUSTDOC_REAL\", builder.rustdoc(self.compiler))\n             .env(\"RUSTC_BOOTSTRAP\", \"1\");\n         if let Some(linker) = builder.linker(self.compiler.host) {\n-            cmd.env(\"RUSTC_TARGET_LINKER\", linker);\n+            cmd.env(\"RUSTDOC_LINKER\", linker);\n+        }\n+        if builder.config.use_lld && !self.compiler.host.contains(\"msvc\") {\n+            cmd.env(\"RUSTDOC_FUSE_LD_LLD\", \"1\");\n         }\n         try_run(builder, &mut cmd);\n     }"}]}