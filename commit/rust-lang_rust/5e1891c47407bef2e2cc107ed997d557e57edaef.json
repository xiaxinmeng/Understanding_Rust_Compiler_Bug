{"sha": "5e1891c47407bef2e2cc107ed997d557e57edaef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlMTg5MWM0NzQwN2JlZjJlMmNjMTA3ZWQ5OTdkNTU3ZTU3ZWRhZWY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-13T14:18:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-13T14:18:35Z"}, "message": "Rollup merge of #62577 - Zoxc:atomic-cell, r=matthewjasper\n\nAdd an AtomicCell abstraction\n\nSplit out from https://github.com/rust-lang/rust/pull/61923.", "tree": {"sha": "89da4f91d748457cf66f7427790df96e9f6d6ab0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/89da4f91d748457cf66f7427790df96e9f6d6ab0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e1891c47407bef2e2cc107ed997d557e57edaef", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdKeg7CRBK7hj4Ov3rIwAAdHIIACy+GkY1Nnc9icPSz11WQJ93\nV8ZildxRswxOMxoeoj+2ydNb3EHBzFhR34RIcBDzbB+B9XC23s3F0amlczhCP1gT\nTHGVv4JH9qk2CebjEAVUr1MSRQFGiC3LV1/3DfVKCzd7sHcy9qBQ9GUnJjzdjd8O\nRbn8QF0Lti5fYUeD6JwptaiU3ggXGFLKoMNLyYFlVpoi2g/ebf/ZNo35jJO+apf2\ntxIF0OpPWlyKYKNU6rZHJnZO5fnCxuBkUrhJe9JcIF6ycHVHTi9gVgK+tlOVwMCI\nbWADbCS22wx8vwsl6a6Q3t58xFPciMAp+ddsvxJGxUkYeBXPk1xqMFFVeoHcn24=\n=FGH+\n-----END PGP SIGNATURE-----\n", "payload": "tree 89da4f91d748457cf66f7427790df96e9f6d6ab0\nparent 6b468c6360cba002ba1e97b70cf51223a498442e\nparent 498bdc9b42e1de6db051a24be0a4318f075a5562\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1563027515 +0200\ncommitter GitHub <noreply@github.com> 1563027515 +0200\n\nRollup merge of #62577 - Zoxc:atomic-cell, r=matthewjasper\n\nAdd an AtomicCell abstraction\n\nSplit out from https://github.com/rust-lang/rust/pull/61923.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e1891c47407bef2e2cc107ed997d557e57edaef", "html_url": "https://github.com/rust-lang/rust/commit/5e1891c47407bef2e2cc107ed997d557e57edaef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e1891c47407bef2e2cc107ed997d557e57edaef/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b468c6360cba002ba1e97b70cf51223a498442e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b468c6360cba002ba1e97b70cf51223a498442e", "html_url": "https://github.com/rust-lang/rust/commit/6b468c6360cba002ba1e97b70cf51223a498442e"}, {"sha": "498bdc9b42e1de6db051a24be0a4318f075a5562", "url": "https://api.github.com/repos/rust-lang/rust/commits/498bdc9b42e1de6db051a24be0a4318f075a5562", "html_url": "https://github.com/rust-lang/rust/commit/498bdc9b42e1de6db051a24be0a4318f075a5562"}], "stats": {"total": 57, "additions": 56, "deletions": 1}, "files": [{"sha": "9a9c89cd9c19923060416d6b3304515c8108c8f7", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5e1891c47407bef2e2cc107ed997d557e57edaef/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/5e1891c47407bef2e2cc107ed997d557e57edaef/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=5e1891c47407bef2e2cc107ed997d557e57edaef", "patch": "@@ -3018,6 +3018,7 @@ name = \"rustc_data_structures\"\n version = \"0.0.0\"\n dependencies = [\n  \"cfg-if 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"crossbeam-utils 0.6.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ena 0.13.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"graphviz 0.0.0\",\n  \"indexmap 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "79cbe26e73e836f36c75f20b85b1659b8d6798a8", "filename": "src/librustc_data_structures/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5e1891c47407bef2e2cc107ed997d557e57edaef/src%2Flibrustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/5e1891c47407bef2e2cc107ed997d557e57edaef/src%2Flibrustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2FCargo.toml?ref=5e1891c47407bef2e2cc107ed997d557e57edaef", "patch": "@@ -18,6 +18,7 @@ lazy_static = \"1\"\n serialize = { path = \"../libserialize\" }\n graphviz = { path = \"../libgraphviz\" }\n cfg-if = \"0.1.2\"\n+crossbeam-utils = { version = \"0.6.5\", features = [\"nightly\"] }\n stable_deref_trait = \"1.0.0\"\n rayon = { version = \"0.2.0\", package = \"rustc-rayon\" }\n rayon-core = { version = \"0.2.0\", package = \"rustc-rayon-core\" }"}, {"sha": "3277b85c281443278329629b81c1d6d7f859acae", "filename": "src/librustc_data_structures/sync.rs", "status": "modified", "additions": 54, "deletions": 1, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/5e1891c47407bef2e2cc107ed997d557e57edaef/src%2Flibrustc_data_structures%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e1891c47407bef2e2cc107ed997d557e57edaef/src%2Flibrustc_data_structures%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Fsync.rs?ref=5e1891c47407bef2e2cc107ed997d557e57edaef", "patch": "@@ -67,6 +67,51 @@ cfg_if! {\n         use std::ops::Add;\n         use std::panic::{resume_unwind, catch_unwind, AssertUnwindSafe};\n \n+        /// This is a single threaded variant of AtomicCell provided by crossbeam.\n+        /// Unlike `Atomic` this is intended for all `Copy` types,\n+        /// but it lacks the explicit ordering arguments.\n+        #[derive(Debug)]\n+        pub struct AtomicCell<T: Copy>(Cell<T>);\n+\n+        impl<T: Copy> AtomicCell<T> {\n+            #[inline]\n+            pub fn new(v: T) -> Self {\n+                AtomicCell(Cell::new(v))\n+            }\n+\n+            #[inline]\n+            pub fn get_mut(&mut self) -> &mut T {\n+                self.0.get_mut()\n+            }\n+        }\n+\n+        impl<T: Copy> AtomicCell<T> {\n+            #[inline]\n+            pub fn into_inner(self) -> T {\n+                self.0.into_inner()\n+            }\n+\n+            #[inline]\n+            pub fn load(&self) -> T {\n+                self.0.get()\n+            }\n+\n+            #[inline]\n+            pub fn store(&self, val: T) {\n+                self.0.set(val)\n+            }\n+\n+            #[inline]\n+            pub fn swap(&self, val: T) -> T {\n+                self.0.replace(val)\n+            }\n+        }\n+\n+        /// This is a single threaded variant of `AtomicU64`, `AtomicUsize`, etc.\n+        /// It differs from `AtomicCell` in that it has explicit ordering arguments\n+        /// and is only intended for use with the native atomic types.\n+        /// You should use this type through the `AtomicU64`, `AtomicUsize`, etc, type aliases\n+        /// as it's not intended to be used separately.\n         #[derive(Debug)]\n         pub struct Atomic<T: Copy>(Cell<T>);\n \n@@ -77,7 +122,8 @@ cfg_if! {\n             }\n         }\n \n-        impl<T: Copy + PartialEq> Atomic<T> {\n+        impl<T: Copy> Atomic<T> {\n+            #[inline]\n             pub fn into_inner(self) -> T {\n                 self.0.into_inner()\n             }\n@@ -92,10 +138,14 @@ cfg_if! {\n                 self.0.set(val)\n             }\n \n+            #[inline]\n             pub fn swap(&self, val: T, _: Ordering) -> T {\n                 self.0.replace(val)\n             }\n+        }\n \n+        impl<T: Copy + PartialEq> Atomic<T> {\n+            #[inline]\n             pub fn compare_exchange(&self,\n                                     current: T,\n                                     new: T,\n@@ -113,6 +163,7 @@ cfg_if! {\n         }\n \n         impl<T: Add<Output=T> + Copy> Atomic<T> {\n+            #[inline]\n             pub fn fetch_add(&self, val: T, _: Ordering) -> T {\n                 let old = self.0.get();\n                 self.0.set(old + val);\n@@ -271,6 +322,8 @@ cfg_if! {\n \n         pub use std::sync::atomic::{AtomicBool, AtomicUsize, AtomicU32, AtomicU64};\n \n+        pub use crossbeam_utils::atomic::AtomicCell;\n+\n         pub use std::sync::Arc as Lrc;\n         pub use std::sync::Weak as Weak;\n "}]}