{"sha": "69837b14d69821c54c151b87ebf873f45c92868b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5ODM3YjE0ZDY5ODIxYzU0YzE1MWI4N2ViZjg3M2Y0NWM5Mjg2OGI=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2019-10-03T23:25:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-03T23:25:41Z"}, "message": "Rollup merge of #64741 - GuillaumeGomez:prevent-rustdoc-feature-doctests, r=QuietMisdreavus\n\nPrevent rustdoc feature doctests\n\nPart of https://github.com/rust-lang/rust/pull/61351\n\ncc @ollie27", "tree": {"sha": "3e559d2571e3b12530fcdf88a216383c9ce081f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e559d2571e3b12530fcdf88a216383c9ce081f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69837b14d69821c54c151b87ebf873f45c92868b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdloN2CRBK7hj4Ov3rIwAAdHIIACrOfzmRpfvj0aCgn62lWl8p\nBWOOLtif2vg8a970aNxfdEv7mpjR5gkzqAX3YzwsKMB2PTRIHEYmaj+Iz8gUeRFA\nqYtl2RHlcA+5VhjhqH5QKiDkG5wP/+D6+rkJTJ/B0bohEg6mSA5UUnuAQfNiB7NT\ntx4SpI3SJTk/ZkeMkDwrBwnJ4VhidHgBkF8Pdcnpo+S8M7R+OnpP/mmS2ZkgmJhd\nC9r1l6omUrlFgumHFpwMfERfAU7A4pfhO8WJo2ZbBPrQZJ93DlrBoHVA/u1gbKNc\n2yDETruYdvu9gNprBwzDqhmJiCj7/fjIIFKonPDPzVBIJ+Y/SnrbuIePY7u8bE4=\n=4g/D\n-----END PGP SIGNATURE-----\n", "payload": "tree 3e559d2571e3b12530fcdf88a216383c9ce081f5\nparent c6999a5834ff22561041035b2463dd9fb037ceb5\nparent 366fdebff8dc6259c67206f78d53f1b1d64854ab\nauthor Tyler Mandry <tmandry@gmail.com> 1570145141 -0700\ncommitter GitHub <noreply@github.com> 1570145141 -0700\n\nRollup merge of #64741 - GuillaumeGomez:prevent-rustdoc-feature-doctests, r=QuietMisdreavus\n\nPrevent rustdoc feature doctests\n\nPart of https://github.com/rust-lang/rust/pull/61351\n\ncc @ollie27\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69837b14d69821c54c151b87ebf873f45c92868b", "html_url": "https://github.com/rust-lang/rust/commit/69837b14d69821c54c151b87ebf873f45c92868b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69837b14d69821c54c151b87ebf873f45c92868b/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6999a5834ff22561041035b2463dd9fb037ceb5", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6999a5834ff22561041035b2463dd9fb037ceb5", "html_url": "https://github.com/rust-lang/rust/commit/c6999a5834ff22561041035b2463dd9fb037ceb5"}, {"sha": "366fdebff8dc6259c67206f78d53f1b1d64854ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/366fdebff8dc6259c67206f78d53f1b1d64854ab", "html_url": "https://github.com/rust-lang/rust/commit/366fdebff8dc6259c67206f78d53f1b1d64854ab"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "fe4e2bd091519b9e912d3a2fe5fb8854af8fd473", "filename": "src/librustdoc/config.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fconfig.rs?ref=69837b14d69821c54c151b87ebf873f45c92868b", "patch": "@@ -344,7 +344,6 @@ impl Options {\n                             .map(|s| PathBuf::from(&s))\n                             .unwrap_or_else(|| PathBuf::from(\"doc\"));\n         let mut cfgs = matches.opt_strs(\"cfg\");\n-        cfgs.push(\"rustdoc\".to_string());\n         if should_test {\n             cfgs.push(\"doctest\".to_string());\n         }"}, {"sha": "00265caa965ea69b683aefa87ecee9fc4e1a9305", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=69837b14d69821c54c151b87ebf873f45c92868b", "patch": "@@ -234,7 +234,7 @@ pub fn run_core(options: RustdocOptions) -> (clean::Crate, RenderInfo, RenderOpt\n         error_format,\n         libs,\n         externs,\n-        cfgs,\n+        mut cfgs,\n         codegen_options,\n         debugging_options,\n         target,\n@@ -250,6 +250,9 @@ pub fn run_core(options: RustdocOptions) -> (clean::Crate, RenderInfo, RenderOpt\n         ..\n     } = options;\n \n+    // Add the rustdoc cfg into the doc build.\n+    cfgs.push(\"rustdoc\".to_string());\n+\n     let cpath = Some(input.clone());\n     let input = Input::File(input);\n "}, {"sha": "3e77ca47e8a6a887feb2a67a87715acbf00f399e", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69837b14d69821c54c151b87ebf873f45c92868b/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=69837b14d69821c54c151b87ebf873f45c92868b", "patch": "@@ -62,9 +62,11 @@ pub fn run(options: Options) -> i32 {\n         ..config::Options::default()\n     };\n \n+    let mut cfgs = options.cfgs.clone();\n+    cfgs.push(\"rustdoc\".to_owned());\n     let config = interface::Config {\n         opts: sessopts,\n-        crate_cfg: config::parse_cfgspecs(options.cfgs.clone()),\n+        crate_cfg: config::parse_cfgspecs(cfgs),\n         input,\n         input_path: None,\n         output_file: None,"}, {"sha": "d0ead4136575fac9dfad2f6f7965f26e418bbd01", "filename": "src/test/rustdoc-ui/doc-test-rustdoc-feature.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/69837b14d69821c54c151b87ebf873f45c92868b/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69837b14d69821c54c151b87ebf873f45c92868b/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.rs?ref=69837b14d69821c54c151b87ebf873f45c92868b", "patch": "@@ -0,0 +1,14 @@\n+// build-pass\n+// compile-flags:--test\n+// normalize-stdout-test: \"src/test/rustdoc-ui\" -> \"$$DIR\"\n+\n+#![feature(doc_cfg)]\n+\n+// Make sure `cfg(rustdoc)` is set when finding doctests but not inside the doctests.\n+\n+/// ```\n+/// #![feature(doc_cfg)]\n+/// assert!(!cfg!(rustdoc));\n+/// ```\n+#[cfg(rustdoc)]\n+pub struct Foo;"}, {"sha": "f2525c2dbec2138851370aaa8bba805e71f210fd", "filename": "src/test/rustdoc-ui/doc-test-rustdoc-feature.stdout", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/69837b14d69821c54c151b87ebf873f45c92868b/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/69837b14d69821c54c151b87ebf873f45c92868b/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-test-rustdoc-feature.stdout?ref=69837b14d69821c54c151b87ebf873f45c92868b", "patch": "@@ -0,0 +1,6 @@\n+\n+running 1 test\n+test $DIR/doc-test-rustdoc-feature.rs - Foo (line 9) ... ok\n+\n+test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n+"}]}