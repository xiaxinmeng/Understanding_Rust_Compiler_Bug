{"sha": "a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "node_id": "C_kwDOAAsO6NoAKGE4ZDNjNDYwODI2OTZiNWY3ZGNmNGI5NjAyMDBmMmNkYzJlNDhiZDg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-03T10:51:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-03T10:51:15Z"}, "message": "Auto merge of #14239 - Veykril:sysroot-cli, r=Veykril\n\nfix: Load the sysroot in all CLI commands", "tree": {"sha": "08a10c2e76ca70fa37834bafdea3514c26be21cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08a10c2e76ca70fa37834bafdea3514c26be21cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "html_url": "https://github.com/rust-lang/rust/commit/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c229a836e8397afba3fddfb062aa764a620a8098", "url": "https://api.github.com/repos/rust-lang/rust/commits/c229a836e8397afba3fddfb062aa764a620a8098", "html_url": "https://github.com/rust-lang/rust/commit/c229a836e8397afba3fddfb062aa764a620a8098"}, {"sha": "80ddfb89a2c12b9017f5a82424796d4ab9d6da37", "url": "https://api.github.com/repos/rust-lang/rust/commits/80ddfb89a2c12b9017f5a82424796d4ab9d6da37", "html_url": "https://github.com/rust-lang/rust/commit/80ddfb89a2c12b9017f5a82424796d4ab9d6da37"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "0721d486ef1f969182cc51b1c2a5637c1b04a6e0", "filename": "crates/rust-analyzer/src/cli/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fdiagnostics.rs?ref=a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "patch": "@@ -1,6 +1,7 @@\n //! Analyze all modules in a project for diagnostics. Exits with a non-zero\n //! status code if any errors are found.\n \n+use project_model::{CargoConfig, RustcSource};\n use rustc_hash::FxHashSet;\n \n use hir::{db::HirDatabase, Crate, Module};\n@@ -14,7 +15,8 @@ use crate::cli::{\n \n impl flags::Diagnostics {\n     pub fn run(self) -> anyhow::Result<()> {\n-        let cargo_config = Default::default();\n+        let mut cargo_config = CargoConfig::default();\n+        cargo_config.sysroot = Some(RustcSource::Discover);\n         let load_cargo_config = LoadCargoConfig {\n             load_out_dirs_from_check: !self.disable_build_scripts,\n             with_proc_macro_server: ProcMacroServerChoice::Sysroot,"}, {"sha": "9b5451496c6c5c0377a7b8a5ed39062b5a6c2c55", "filename": "crates/rust-analyzer/src/cli/lsif.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs?ref=a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "patch": "@@ -13,7 +13,7 @@ use ide_db::LineIndexDatabase;\n use ide_db::base_db::salsa::{self, ParallelDatabase};\n use ide_db::line_index::WideEncoding;\n use lsp_types::{self, lsif};\n-use project_model::{CargoConfig, ProjectManifest, ProjectWorkspace};\n+use project_model::{CargoConfig, ProjectManifest, ProjectWorkspace, RustcSource};\n use vfs::{AbsPathBuf, Vfs};\n \n use crate::cli::load_cargo::ProcMacroServerChoice;\n@@ -289,7 +289,8 @@ impl flags::Lsif {\n     pub fn run(self) -> Result<()> {\n         eprintln!(\"Generating LSIF started...\");\n         let now = Instant::now();\n-        let cargo_config = CargoConfig::default();\n+        let mut cargo_config = CargoConfig::default();\n+        cargo_config.sysroot = Some(RustcSource::Discover);\n         let no_progress = &|_| ();\n         let load_cargo_config = LoadCargoConfig {\n             load_out_dirs_from_check: true,"}, {"sha": "df5c26cf77a940685a8e3ab7c6e173a75192c3b6", "filename": "crates/rust-analyzer/src/cli/scip.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fscip.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fscip.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fscip.rs?ref=a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "patch": "@@ -15,7 +15,7 @@ use ide::{\n     TokenStaticData,\n };\n use ide_db::LineIndexDatabase;\n-use project_model::{CargoConfig, ProjectManifest, ProjectWorkspace};\n+use project_model::{CargoConfig, ProjectManifest, ProjectWorkspace, RustcSource};\n use scip::types as scip_types;\n use std::env;\n \n@@ -29,7 +29,8 @@ impl flags::Scip {\n     pub fn run(self) -> Result<()> {\n         eprintln!(\"Generating SCIP start...\");\n         let now = Instant::now();\n-        let cargo_config = CargoConfig::default();\n+        let mut cargo_config = CargoConfig::default();\n+        cargo_config.sysroot = Some(RustcSource::Discover);\n \n         let no_progress = &|s| (eprintln!(\"rust-analyzer: Loading {s}\"));\n         let load_cargo_config = LoadCargoConfig {"}, {"sha": "35a874f89207ba974cdbf8b0b5e72fac919c2672", "filename": "crates/rust-analyzer/src/cli/ssr.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fssr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fssr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fssr.rs?ref=a8d3c46082696b5f7dcf4b960200f2cdc2e48bd8", "patch": "@@ -1,7 +1,7 @@\n //! Applies structured search replace rules from the command line.\n \n use ide_ssr::MatchFinder;\n-use project_model::CargoConfig;\n+use project_model::{CargoConfig, RustcSource};\n \n use crate::cli::{\n     flags,\n@@ -12,7 +12,8 @@ use crate::cli::{\n impl flags::Ssr {\n     pub fn run(self) -> Result<()> {\n         use ide_db::base_db::SourceDatabaseExt;\n-        let cargo_config = CargoConfig::default();\n+        let mut cargo_config = CargoConfig::default();\n+        cargo_config.sysroot = Some(RustcSource::Discover);\n         let load_cargo_config = LoadCargoConfig {\n             load_out_dirs_from_check: true,\n             with_proc_macro_server: ProcMacroServerChoice::Sysroot,"}]}