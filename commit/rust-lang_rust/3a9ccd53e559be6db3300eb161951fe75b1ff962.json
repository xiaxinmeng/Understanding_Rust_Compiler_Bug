{"sha": "3a9ccd53e559be6db3300eb161951fe75b1ff962", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhOWNjZDUzZTU1OWJlNmRiMzMwMGViMTYxOTUxZmU3NWIxZmY5NjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-11-15T01:03:07Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-11-15T05:56:55Z"}, "message": "Factor out some position management code in the lexer", "tree": {"sha": "61a317786587ad8020a34a1a4367efb4438a1afc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/61a317786587ad8020a34a1a4367efb4438a1afc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a9ccd53e559be6db3300eb161951fe75b1ff962", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a9ccd53e559be6db3300eb161951fe75b1ff962", "html_url": "https://github.com/rust-lang/rust/commit/3a9ccd53e559be6db3300eb161951fe75b1ff962", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a9ccd53e559be6db3300eb161951fe75b1ff962/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8069d2f266b5e5f21d9cc846b0b8b8daa1812dcc", "url": "https://api.github.com/repos/rust-lang/rust/commits/8069d2f266b5e5f21d9cc846b0b8b8daa1812dcc", "html_url": "https://github.com/rust-lang/rust/commit/8069d2f266b5e5f21d9cc846b0b8b8daa1812dcc"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "e8e39ff272aba5aee589d7aaf9899cbdecac812f", "filename": "src/libsyntax/codemap.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3a9ccd53e559be6db3300eb161951fe75b1ff962/src%2Flibsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a9ccd53e559be6db3300eb161951fe75b1ff962/src%2Flibsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fcodemap.rs?ref=3a9ccd53e559be6db3300eb161951fe75b1ff962", "patch": "@@ -189,7 +189,7 @@ pub impl FileMap {\n         return FileMap {\n             name: filename, substr: substr, src: src,\n             start_pos: start_pos,\n-            mut lines: ~[start_pos]\n+            mut lines: ~[]\n         };\n     }\n "}, {"sha": "178d772ecc69442d5634b3a391d9473575a1a0b8", "filename": "src/libsyntax/parse/lexer.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3a9ccd53e559be6db3300eb161951fe75b1ff962/src%2Flibsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a9ccd53e559be6db3300eb161951fe75b1ff962/src%2Flibsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Flexer.rs?ref=3a9ccd53e559be6db3300eb161951fe75b1ff962", "patch": "@@ -45,18 +45,17 @@ fn new_low_level_string_reader(span_diagnostic: span_handler,\n                                filemap: @codemap::FileMap,\n                                itr: @token::ident_interner)\n     -> string_reader {\n+    // Force the initial reader bump to start on a fresh line\n+    let initial_char = '\\n';\n     let r = @{span_diagnostic: span_diagnostic, src: filemap.src,\n-              mut col: CharPos(0), mut pos: BytePos(0), mut curr: -1 as char,\n+              mut col: CharPos(0), mut pos: BytePos(0),\n+              mut curr: initial_char,\n               mut chpos: filemap.start_pos.ch,\n               filemap: filemap, interner: itr,\n               /* dummy values; not read */\n               mut peek_tok: token::EOF,\n               mut peek_span: ast_util::dummy_sp()};\n-    if r.pos.to_uint() < (*filemap.src).len() {\n-        let next = str::char_range_at(*r.src, r.pos.to_uint());\n-        r.pos = BytePos(next.next);\n-        r.curr = next.ch;\n-    }\n+    bump(r);\n     return r;\n }\n \n@@ -142,9 +141,10 @@ fn bump(rdr: string_reader) {\n         rdr.pos = BytePos(next.next);\n         rdr.curr = next.ch;\n     } else {\n+        // XXX: What does this accomplish?\n         if (rdr.curr != -1 as char) {\n-            rdr.col += CharPos(1u);\n             rdr.chpos += CharPos(1u);\n+            rdr.col += CharPos(1u);\n             rdr.curr = -1 as char;\n         }\n     }"}]}