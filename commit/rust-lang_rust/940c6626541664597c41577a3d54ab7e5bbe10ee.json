{"sha": "940c6626541664597c41577a3d54ab7e5bbe10ee", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0MGM2NjI2NTQxNjY0NTk3YzQxNTc3YTNkNTRhYjdlNWJiZTEwZWU=", "commit": {"author": {"name": "CrazyRoka", "email": "RokaRostuk@gmail.com", "date": "2020-04-26T14:57:19Z"}, "committer": {"name": "CrazyRoka", "email": "RokaRostuk@gmail.com", "date": "2020-04-26T15:00:51Z"}, "message": "Small lint update\n\n- Changed lint category to `correctness`\n- Moved main function to bottom in test file\n- Added `FIXME` comment to `span_lint_and_sugg` to improve later", "tree": {"sha": "45237b0ebb144e63d92c2fafef37f3be4563233e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45237b0ebb144e63d92c2fafef37f3be4563233e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/940c6626541664597c41577a3d54ab7e5bbe10ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/940c6626541664597c41577a3d54ab7e5bbe10ee", "html_url": "https://github.com/rust-lang/rust/commit/940c6626541664597c41577a3d54ab7e5bbe10ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/940c6626541664597c41577a3d54ab7e5bbe10ee/comments", "author": {"login": "CrazyRoka", "id": 19844144, "node_id": "MDQ6VXNlcjE5ODQ0MTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/19844144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CrazyRoka", "html_url": "https://github.com/CrazyRoka", "followers_url": "https://api.github.com/users/CrazyRoka/followers", "following_url": "https://api.github.com/users/CrazyRoka/following{/other_user}", "gists_url": "https://api.github.com/users/CrazyRoka/gists{/gist_id}", "starred_url": "https://api.github.com/users/CrazyRoka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CrazyRoka/subscriptions", "organizations_url": "https://api.github.com/users/CrazyRoka/orgs", "repos_url": "https://api.github.com/users/CrazyRoka/repos", "events_url": "https://api.github.com/users/CrazyRoka/events{/privacy}", "received_events_url": "https://api.github.com/users/CrazyRoka/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CrazyRoka", "id": 19844144, "node_id": "MDQ6VXNlcjE5ODQ0MTQ0", "avatar_url": "https://avatars.githubusercontent.com/u/19844144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CrazyRoka", "html_url": "https://github.com/CrazyRoka", "followers_url": "https://api.github.com/users/CrazyRoka/followers", "following_url": "https://api.github.com/users/CrazyRoka/following{/other_user}", "gists_url": "https://api.github.com/users/CrazyRoka/gists{/gist_id}", "starred_url": "https://api.github.com/users/CrazyRoka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CrazyRoka/subscriptions", "organizations_url": "https://api.github.com/users/CrazyRoka/orgs", "repos_url": "https://api.github.com/users/CrazyRoka/repos", "events_url": "https://api.github.com/users/CrazyRoka/events{/privacy}", "received_events_url": "https://api.github.com/users/CrazyRoka/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63b451ea25c7797530c84b82781e0800c9bda68d", "url": "https://api.github.com/repos/rust-lang/rust/commits/63b451ea25c7797530c84b82781e0800c9bda68d", "html_url": "https://github.com/rust-lang/rust/commit/63b451ea25c7797530c84b82781e0800c9bda68d"}], "stats": {"total": 65, "additions": 33, "deletions": 32}, "files": [{"sha": "4071406cc84c3366cd29e94d6e0012038ebe0cf1", "filename": "clippy_lints/src/match_on_vec_items.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/940c6626541664597c41577a3d54ab7e5bbe10ee/clippy_lints%2Fsrc%2Fmatch_on_vec_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940c6626541664597c41577a3d54ab7e5bbe10ee/clippy_lints%2Fsrc%2Fmatch_on_vec_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmatch_on_vec_items.rs?ref=940c6626541664597c41577a3d54ab7e5bbe10ee", "patch": "@@ -1,4 +1,4 @@\n-use crate::utils::{is_type_diagnostic_item, snippet_with_applicability, span_lint_and_sugg, walk_ptrs_ty};\n+use crate::utils::{is_type_diagnostic_item, snippet, span_lint_and_sugg, walk_ptrs_ty};\n use if_chain::if_chain;\n use rustc_errors::Applicability;\n use rustc_hir::{Expr, ExprKind, MatchSource};\n@@ -38,7 +38,7 @@ declare_clippy_lint! {\n     /// }\n     /// ```\n     pub MATCH_ON_VEC_ITEMS,\n-    style,\n+    correctness,\n     \"matching on vector elements can panic\"\n }\n \n@@ -53,19 +53,20 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MatchOnVecItems {\n             if let ExprKind::Index(vec, idx) = idx_expr.kind;\n \n             then {\n-                let mut applicability = Applicability::MaybeIncorrect;\n+                // FIXME: could be improved to suggest surrounding every pattern with Some(_),\n+                // but only when `or_patterns` are stabilized.\n                 span_lint_and_sugg(\n                     cx,\n                     MATCH_ON_VEC_ITEMS,\n                     match_expr.span,\n-                    \"indexing vector may panic. Consider using `get`\",\n+                    \"indexing into a vector may panic\",\n                     \"try this\",\n                     format!(\n                         \"{}.get({})\",\n-                        snippet_with_applicability(cx, vec.span, \"..\", &mut applicability),\n-                        snippet_with_applicability(cx, idx.span, \"..\", &mut applicability)\n+                        snippet(cx, vec.span, \"..\"),\n+                        snippet(cx, idx.span, \"..\")\n                     ),\n-                    applicability\n+                    Applicability::MaybeIncorrect\n                 );\n             }\n         }"}, {"sha": "0bb39d77e461ea9edd610d0f82535537ba1a7654", "filename": "tests/ui/match_on_vec_items.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/940c6626541664597c41577a3d54ab7e5bbe10ee/tests%2Fui%2Fmatch_on_vec_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/940c6626541664597c41577a3d54ab7e5bbe10ee/tests%2Fui%2Fmatch_on_vec_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_on_vec_items.rs?ref=940c6626541664597c41577a3d54ab7e5bbe10ee", "patch": "@@ -1,14 +1,5 @@\n #![warn(clippy::match_on_vec_items)]\n \n-fn main() {\n-    match_with_wildcard();\n-    match_without_wildcard();\n-    match_wildcard_and_action();\n-    match_vec_ref();\n-    match_with_get();\n-    match_with_array();\n-}\n-\n fn match_with_wildcard() {\n     let arr = vec![0, 1, 2, 3];\n     let range = 1..3;\n@@ -128,3 +119,12 @@ fn match_with_array() {\n         _ => {},\n     }\n }\n+\n+fn main() {\n+    match_with_wildcard();\n+    match_without_wildcard();\n+    match_wildcard_and_action();\n+    match_vec_ref();\n+    match_with_get();\n+    match_with_array();\n+}"}, {"sha": "49446d715abe26682174f6f707475954cba14e1e", "filename": "tests/ui/match_on_vec_items.stderr", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/940c6626541664597c41577a3d54ab7e5bbe10ee/tests%2Fui%2Fmatch_on_vec_items.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/940c6626541664597c41577a3d54ab7e5bbe10ee/tests%2Fui%2Fmatch_on_vec_items.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmatch_on_vec_items.stderr?ref=940c6626541664597c41577a3d54ab7e5bbe10ee", "patch": "@@ -1,49 +1,49 @@\n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:18:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:9:11\n    |\n LL |     match arr[idx] {\n    |           ^^^^^^^^ help: try this: `arr.get(idx)`\n    |\n    = note: `-D clippy::match-on-vec-items` implied by `-D warnings`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:25:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:16:11\n    |\n LL |     match arr[range] {\n    |           ^^^^^^^^^^ help: try this: `arr.get(range)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:38:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:29:11\n    |\n LL |     match arr[idx] {\n    |           ^^^^^^^^ help: try this: `arr.get(idx)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:45:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:36:11\n    |\n LL |     match arr[range] {\n    |           ^^^^^^^^^^ help: try this: `arr.get(range)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:58:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:49:11\n    |\n LL |     match arr[idx] {\n    |           ^^^^^^^^ help: try this: `arr.get(idx)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:65:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:56:11\n    |\n LL |     match arr[range] {\n    |           ^^^^^^^^^^ help: try this: `arr.get(range)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:78:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:69:11\n    |\n LL |     match arr[idx] {\n    |           ^^^^^^^^ help: try this: `arr.get(idx)`\n \n-error: indexing vector may panic. Consider using `get`\n-  --> $DIR/match_on_vec_items.rs:85:11\n+error: indexing into a vector may panic\n+  --> $DIR/match_on_vec_items.rs:76:11\n    |\n LL |     match arr[range] {\n    |           ^^^^^^^^^^ help: try this: `arr.get(range)`"}]}