{"sha": "a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5MGIyM2ZkMzBjY2UzZjgzYjljMTc3MWJhYjMxYzE5NjRjZTJmZTI=", "commit": {"author": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2019-02-01T08:28:49Z"}, "committer": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2019-02-01T08:28:49Z"}, "message": "Fix `std::os::fortanix_sgx::usercalls::raw::UsercallNrs`\n\nFixes https://github.com/fortanix/rust-sgx/issues/88", "tree": {"sha": "3e9dd9193a83c3d9b2bde248d79e35f5abe34204", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e9dd9193a83c3d9b2bde248d79e35f5abe34204"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "html_url": "https://github.com/rust-lang/rust/commit/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2/comments", "author": null, "committer": null, "parents": [{"sha": "d30b99f9c23f8e1d6ef993cc94da96510ad709b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/d30b99f9c23f8e1d6ef993cc94da96510ad709b3", "html_url": "https://github.com/rust-lang/rust/commit/d30b99f9c23f8e1d6ef993cc94da96510ad709b3"}], "stats": {"total": 30, "additions": 10, "deletions": 20}, "files": [{"sha": "c6106b9f8278f099d52c41bcf1719cab1f00684f", "filename": "src/libstd/os/fortanix_sgx/mod.rs", "status": "modified", "additions": 1, "deletions": 16, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fos%2Ffortanix_sgx%2Fmod.rs?ref=a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "patch": "@@ -21,26 +21,11 @@ pub mod usercalls {\n \n     /// Lowest-level interfaces to usercalls and usercall ABI type definitions.\n     pub mod raw {\n-        use sys::abi::usercalls::raw::invoke_with_usercalls;\n-        pub use sys::abi::usercalls::raw::do_usercall;\n+        pub use sys::abi::usercalls::raw::{do_usercall, Usercalls as UsercallNrs};\n         pub use sys::abi::usercalls::raw::{accept_stream, alloc, async_queues, bind_stream, close,\n                                            connect_stream, exit, flush, free, insecure_time,\n                                            launch_thread, read, read_alloc, send, wait, write};\n \n-        macro_rules! define_usercallnrs {\n-            ($(fn $f:ident($($n:ident: $t:ty),*) $(-> $r:ty)*; )*) => {\n-                /// Usercall numbers as per the ABI.\n-                #[repr(C)]\n-                #[unstable(feature = \"sgx_platform\", issue = \"56975\")]\n-                #[derive(Copy, Clone, Hash, PartialEq, Eq, Debug)]\n-                #[allow(missing_docs)]\n-                pub enum UsercallNrs {\n-                    $($f,)*\n-                }\n-            };\n-        }\n-        invoke_with_usercalls!(define_usercallnrs);\n-\n         // fortanix-sgx-abi re-exports\n         pub use sys::abi::usercalls::raw::{ByteBuffer, FifoDescriptor, Return, Usercall};\n         pub use sys::abi::usercalls::raw::Error;"}, {"sha": "27f780ca224dbe3cda3cdadc4712b01be902c488", "filename": "src/libstd/sys/sgx/abi/usercalls/raw.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90b23fd30cce3f83b9c1771bab31c1964ce2fe2/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fraw.rs?ref=a90b23fd30cce3f83b9c1771bab31c1964ce2fe2", "patch": "@@ -41,10 +41,15 @@ trait ReturnValue {\n macro_rules! define_usercalls {\n     // Using `$r:tt` because `$r:ty` doesn't match ! in `clobber_diverging`\n     ($(fn $f:ident($($n:ident: $t:ty),*) $(-> $r:tt)*; )*) => {\n-        #[repr(C)]\n-        #[allow(non_camel_case_types)]\n-        enum Usercalls {\n-            __enclave_usercalls_invalid,\n+        /// Usercall numbers as per the ABI.\n+        #[repr(u64)]\n+        #[unstable(feature = \"sgx_platform\", issue = \"56975\")]\n+        #[derive(Copy, Clone, Hash, PartialEq, Eq, Debug)]\n+        #[allow(missing_docs, non_camel_case_types)]\n+        #[non_exhaustive]\n+        pub enum Usercalls {\n+            #[doc(hidden)]\n+            __enclave_usercalls_invalid = 0,\n             $($f,)*\n         }\n "}]}