{"sha": "5457db94108b3c3ca75e1875b7e60bc4ea6b4b66", "node_id": "C_kwDOAAsO6NoAKDU0NTdkYjk0MTA4YjNjM2NhNzVlMTg3NWI3ZTYwYmM0ZWE2YjRiNjY", "commit": {"author": {"name": "R\u00e9my Rakic", "email": "remy.rakic+github@gmail.com", "date": "2022-12-19T15:41:36Z"}, "committer": {"name": "R\u00e9my Rakic", "email": "remy.rakic+github@gmail.com", "date": "2022-12-19T18:27:13Z"}, "message": "add non-regression test for issue 105809", "tree": {"sha": "3bee9b02ad4a38ce52e554b21024602e7455f481", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bee9b02ad4a38ce52e554b21024602e7455f481"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66", "html_url": "https://github.com/rust-lang/rust/commit/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66/comments", "author": {"login": "lqd", "id": 247183, "node_id": "MDQ6VXNlcjI0NzE4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/247183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lqd", "html_url": "https://github.com/lqd", "followers_url": "https://api.github.com/users/lqd/followers", "following_url": "https://api.github.com/users/lqd/following{/other_user}", "gists_url": "https://api.github.com/users/lqd/gists{/gist_id}", "starred_url": "https://api.github.com/users/lqd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lqd/subscriptions", "organizations_url": "https://api.github.com/users/lqd/orgs", "repos_url": "https://api.github.com/users/lqd/repos", "events_url": "https://api.github.com/users/lqd/events{/privacy}", "received_events_url": "https://api.github.com/users/lqd/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lqd", "id": 247183, "node_id": "MDQ6VXNlcjI0NzE4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/247183?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lqd", "html_url": "https://github.com/lqd", "followers_url": "https://api.github.com/users/lqd/followers", "following_url": "https://api.github.com/users/lqd/following{/other_user}", "gists_url": "https://api.github.com/users/lqd/gists{/gist_id}", "starred_url": "https://api.github.com/users/lqd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lqd/subscriptions", "organizations_url": "https://api.github.com/users/lqd/orgs", "repos_url": "https://api.github.com/users/lqd/repos", "events_url": "https://api.github.com/users/lqd/events{/privacy}", "received_events_url": "https://api.github.com/users/lqd/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8275d115fbc86a95a483fe3a344387b8b3883a83", "url": "https://api.github.com/repos/rust-lang/rust/commits/8275d115fbc86a95a483fe3a344387b8b3883a83", "html_url": "https://github.com/rust-lang/rust/commit/8275d115fbc86a95a483fe3a344387b8b3883a83"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "57828feef2d6af22bf51cb2ddb0c91f3c6b4f5a8", "filename": "src/test/ui/mir/issue-105809.rs", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66/src%2Ftest%2Fui%2Fmir%2Fissue-105809.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5457db94108b3c3ca75e1875b7e60bc4ea6b4b66/src%2Ftest%2Fui%2Fmir%2Fissue-105809.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmir%2Fissue-105809.rs?ref=5457db94108b3c3ca75e1875b7e60bc4ea6b4b66", "patch": "@@ -0,0 +1,36 @@\n+// Non-regression test ICE from issue #105809 and duplicates.\n+\n+// build-pass: the ICE is during codegen\n+// compile-flags: --edition 2018 -Zmir-opt-level=1\n+\n+use std::{future::Future, pin::Pin};\n+\n+// Create a `T` without affecting analysis like `loop {}`.\n+fn create<T>() -> T {\n+    loop {}\n+}\n+\n+async fn trivial_future() {}\n+\n+struct Connection<H> {\n+    _h: H,\n+}\n+\n+async fn complex_future<H>(conn: &Connection<H>) {\n+    let small_fut = async move {\n+        let _ = conn;\n+        trivial_future().await;\n+    };\n+\n+    let mut tuple = (small_fut,);\n+    let (small_fut_again,) = &mut tuple;\n+    let _ = small_fut_again;\n+}\n+\n+fn main() {\n+    let mut fut = complex_future(&Connection { _h: () });\n+\n+    let mut cx = create();\n+    let future = unsafe { Pin::new_unchecked(&mut fut) };\n+    let _ = future.poll(&mut cx);\n+}"}]}