{"sha": "fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiNzEwNWE1ODAxYWIxZDBlZGU4MzBjZDUzYmJjM2NjYmYwYjVlMmM=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-05-30T14:41:33Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-05-31T13:14:56Z"}, "message": "Add config setting for self-on-the-fly", "tree": {"sha": "958c7a8548dcc6cfce25ace53476183d73b1460d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/958c7a8548dcc6cfce25ace53476183d73b1460d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "html_url": "https://github.com/rust-lang/rust/commit/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4507382f2e66cd0e6498228bfdffb16769063b0f", "url": "https://api.github.com/repos/rust-lang/rust/commits/4507382f2e66cd0e6498228bfdffb16769063b0f", "html_url": "https://github.com/rust-lang/rust/commit/4507382f2e66cd0e6498228bfdffb16769063b0f"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "302c9ccbd369678eeb12ec95891602174396002e", "filename": "crates/ide_completion/src/completions/dot.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fdot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fdot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fdot.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -30,7 +30,7 @@ pub(crate) fn complete_dot(acc: &mut Completions, ctx: &CompletionContext) {\n }\n \n fn complete_undotted_self(acc: &mut Completions, ctx: &CompletionContext) {\n-    if !ctx.is_trivial_path {\n+    if !ctx.is_trivial_path || !ctx.config.enable_self_on_the_fly {\n         return;\n     }\n     ctx.scope.process_all_names(&mut |name, def| {"}, {"sha": "c300ce887befed5bc35a43894bfc485396cb5dcf", "filename": "crates/ide_completion/src/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fconfig.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -10,6 +10,7 @@ use ide_db::helpers::{insert_use::InsertUseConfig, SnippetCap};\n pub struct CompletionConfig {\n     pub enable_postfix_completions: bool,\n     pub enable_imports_on_the_fly: bool,\n+    pub enable_self_on_the_fly: bool,\n     pub add_call_parenthesis: bool,\n     pub add_call_argument_snippets: bool,\n     pub snippet_cap: Option<SnippetCap>,"}, {"sha": "a49a6071127bd7bab49df0ddf4b966756cd299cd", "filename": "crates/ide_completion/src/render.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -139,7 +139,7 @@ impl<'a> Render<'a> {\n         let mut item = CompletionItem::new(\n             CompletionKind::Reference,\n             self.ctx.source_range(),\n-            receiver.map_or_else(|| name.to_string(), |receiver| format!(\"{}.{}\", receiver, name)),\n+            receiver.map_or_else(|| name.clone(), |receiver| format!(\"{}.{}\", receiver, name)),\n         );\n         item.kind(SymbolKind::Field)\n             .detail(ty.display(self.ctx.db()).to_string())"}, {"sha": "b0a4b2026b0b947ee243438438a40f8f24172fa7", "filename": "crates/ide_completion/src/test_utils.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Ftest_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Fide_completion%2Fsrc%2Ftest_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Ftest_utils.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -19,6 +19,7 @@ use crate::{item::CompletionKind, CompletionConfig, CompletionItem};\n pub(crate) const TEST_CONFIG: CompletionConfig = CompletionConfig {\n     enable_postfix_completions: true,\n     enable_imports_on_the_fly: true,\n+    enable_self_on_the_fly: true,\n     add_call_parenthesis: true,\n     add_call_argument_snippets: true,\n     snippet_cap: SnippetCap::new(true),"}, {"sha": "ae78fd4f612e97af868fecd6bb06c2be030cd49e", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -100,6 +100,9 @@ config_data! {\n         /// Toggles the additional completions that automatically add imports when completed.\n         /// Note that your client must specify the `additionalTextEdits` LSP client capability to truly have this feature enabled.\n         completion_autoimport_enable: bool       = \"true\",\n+        /// Toggles the additional completions that automatically show method calls and field accesses\n+        /// with `self` prefixed to them when inside a method.\n+        completion_autoself_enable: bool       = \"true\",\n \n         /// Whether to show native rust-analyzer diagnostics.\n         diagnostics_enable: bool                = \"true\",\n@@ -666,6 +669,7 @@ impl Config {\n             enable_postfix_completions: self.data.completion_postfix_enable,\n             enable_imports_on_the_fly: self.data.completion_autoimport_enable\n                 && completion_item_edit_resolve(&self.caps),\n+            enable_self_on_the_fly: self.data.completion_autoself_enable,\n             add_call_parenthesis: self.data.completion_addCallParenthesis,\n             add_call_argument_snippets: self.data.completion_addCallArgumentSnippets,\n             insert_use: self.insert_use_config(),"}, {"sha": "ec36a5f5c0094e6e5bb58fb4a520fff842e8ae16", "filename": "crates/rust-analyzer/src/integrated_benchmarks.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -132,6 +132,7 @@ fn integrated_completion_benchmark() {\n         let config = CompletionConfig {\n             enable_postfix_completions: true,\n             enable_imports_on_the_fly: true,\n+            enable_self_on_the_fly: true,\n             add_call_parenthesis: true,\n             add_call_argument_snippets: true,\n             snippet_cap: SnippetCap::new(true),\n@@ -166,6 +167,7 @@ fn integrated_completion_benchmark() {\n         let config = CompletionConfig {\n             enable_postfix_completions: true,\n             enable_imports_on_the_fly: true,\n+            enable_self_on_the_fly: true,\n             add_call_parenthesis: true,\n             add_call_argument_snippets: true,\n             snippet_cap: SnippetCap::new(true),"}, {"sha": "2b2ef2c60c3ab70891c7f74ecd8225c98e1551f3", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -1178,6 +1178,7 @@ mod tests {\n                 &ide::CompletionConfig {\n                     enable_postfix_completions: true,\n                     enable_imports_on_the_fly: true,\n+                    enable_self_on_the_fly: true,\n                     add_call_parenthesis: true,\n                     add_call_argument_snippets: true,\n                     snippet_cap: SnippetCap::new(true),"}, {"sha": "2624069a5ccd8baa5ecf7e26be9a05cb3d9bca7e", "filename": "docs/dev/architecture.md", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/docs%2Fdev%2Farchitecture.md", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/docs%2Fdev%2Farchitecture.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Farchitecture.md?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -447,3 +447,8 @@ This is cheap enough to enable in production.\n \n Similarly, we save live object counting (`RA_COUNT=1`).\n It is not cheap enough to enable in prod, and this is a bug which should be fixed.\n+\n+### Configurability\n+\n+rust-analyzer strives to be as configurable as possible while offering reasonable defaults where no configuration exists yet.\n+There will always be features that some people find more annoying than helpful, so giving the users the ability to tweak or disable these is a big part of offering a good user experience."}, {"sha": "dbd9a3503b5569601a48f1600141f4852baa8408", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -136,6 +136,12 @@ Whether to show postfix snippets like `dbg`, `if`, `not`, etc.\n Toggles the additional completions that automatically add imports when completed.\n Note that your client must specify the `additionalTextEdits` LSP client capability to truly have this feature enabled.\n --\n+[[rust-analyzer.completion.autoself.enable]]rust-analyzer.completion.autoself.enable (default: `true`)::\n++\n+--\n+Toggles the additional completions that automatically show method calls and field accesses\n+with `self` prefixed to them when inside a method.\n+--\n [[rust-analyzer.diagnostics.enable]]rust-analyzer.diagnostics.enable (default: `true`)::\n +\n --"}, {"sha": "42a06e13744c81707cc6be2f912809c98ee485ff", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=fb7105a5801ab1d0ede830cd53bbc3ccbf0b5e2c", "patch": "@@ -572,6 +572,11 @@\n                     \"default\": true,\n                     \"type\": \"boolean\"\n                 },\n+                \"rust-analyzer.completion.autoself.enable\": {\n+                    \"markdownDescription\": \"Toggles the additional completions that automatically show method calls and field accesses\\nwith `self` prefixed to them when inside a method.\",\n+                    \"default\": true,\n+                    \"type\": \"boolean\"\n+                },\n                 \"rust-analyzer.diagnostics.enable\": {\n                     \"markdownDescription\": \"Whether to show native rust-analyzer diagnostics.\",\n                     \"default\": true,"}]}