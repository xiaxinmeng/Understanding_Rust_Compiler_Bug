{"sha": "34a3154bd9ba92360966fd942df17eb11c7baca7", "node_id": "C_kwDOAAsO6NoAKDM0YTMxNTRiZDliYTkyMzYwOTY2ZmQ5NDJkZjE3ZWIxMWM3YmFjYTc", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-05-21T19:46:25Z"}, "committer": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2022-05-22T19:21:27Z"}, "message": "Use revisions for NLL in async-await", "tree": {"sha": "b74039aabab85313a731eb4f4a98711a977b10f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b74039aabab85313a731eb4f4a98711a977b10f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34a3154bd9ba92360966fd942df17eb11c7baca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34a3154bd9ba92360966fd942df17eb11c7baca7", "html_url": "https://github.com/rust-lang/rust/commit/34a3154bd9ba92360966fd942df17eb11c7baca7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34a3154bd9ba92360966fd942df17eb11c7baca7/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fbb315be70aaaa19bd38801ad894657332f9fc3", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fbb315be70aaaa19bd38801ad894657332f9fc3", "html_url": "https://github.com/rust-lang/rust/commit/0fbb315be70aaaa19bd38801ad894657332f9fc3"}], "stats": {"total": 107, "additions": 76, "deletions": 31}, "files": [{"sha": "34705d4838e76ac979160f0b84c5e9dac894b0c1", "filename": "src/test/ui/async-await/issue-76547.base.stderr", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.base.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.base.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.base.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,13 +1,13 @@\n error[E0623]: lifetime mismatch\n-  --> $DIR/issue-76547.rs:20:13\n+  --> $DIR/issue-76547.rs:24:13\n    |\n LL | async fn fut(bufs: &mut [&mut [u8]]) {\n    |                    ---------------- these two types are declared with different lifetimes...\n LL |     ListFut(bufs).await\n    |             ^^^^ ...but data from `bufs` flows into `bufs` here\n \n error[E0623]: lifetime mismatch\n-  --> $DIR/issue-76547.rs:34:14\n+  --> $DIR/issue-76547.rs:39:14\n    |\n LL | async fn fut2(bufs: &mut [&mut [u8]]) -> i32 {\n    |                     ---------------- these two types are declared with different lifetimes...", "previous_filename": "src/test/ui/async-await/issue-76547.stderr"}, {"sha": "bc30da1e389b3634b8f7d6202bb3d72aa5ed0d84", "filename": "src/test/ui/async-await/issue-76547.nll.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.nll.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,5 +1,5 @@\n error: lifetime may not live long enough\n-  --> $DIR/issue-76547.rs:20:13\n+  --> $DIR/issue-76547.rs:24:13\n    |\n LL | async fn fut(bufs: &mut [&mut [u8]]) {\n    |                    -     - let's call the lifetime of this reference `'2`\n@@ -9,7 +9,7 @@ LL |     ListFut(bufs).await\n    |             ^^^^ this usage requires that `'1` must outlive `'2`\n \n error: lifetime may not live long enough\n-  --> $DIR/issue-76547.rs:34:14\n+  --> $DIR/issue-76547.rs:39:14\n    |\n LL | async fn fut2(bufs: &mut [&mut [u8]]) -> i32 {\n    |                     -     - let's call the lifetime of this reference `'2`"}, {"sha": "45c7ab63135b1d328223e586a52f6bd97a00b7db", "filename": "src/test/ui/async-await/issue-76547.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissue-76547.rs?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,3 +1,7 @@\n+// ignore-compare-mode-nll\n+// revisions: base nll\n+// [nll]compile-flags: -Zborrowck=mir\n+\n // Test for diagnostic improvement issue #76547\n // edition:2018\n \n@@ -18,7 +22,8 @@ impl<'a> Future for ListFut<'a> {\n \n async fn fut(bufs: &mut [&mut [u8]]) {\n     ListFut(bufs).await\n-    //~^ ERROR lifetime mismatch\n+    //[base]~^ ERROR lifetime mismatch\n+    //[nll]~^^ ERROR lifetime may not live long enough\n }\n \n pub struct ListFut2<'a>(&'a mut [&'a mut [u8]]);\n@@ -32,7 +37,8 @@ impl<'a> Future for ListFut2<'a> {\n \n async fn fut2(bufs: &mut [&mut [u8]]) -> i32 {\n     ListFut2(bufs).await\n-    //~^ ERROR lifetime mismatch\n+    //[base]~^ ERROR lifetime mismatch\n+    //[nll]~^^ ERROR lifetime may not live long enough\n }\n \n fn main() {}"}, {"sha": "7577b95fa2e2f94c0ececdb5519f81caf6565bfe", "filename": "src/test/ui/async-await/issues/issue-62097.base.stderr", "status": "renamed", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.base.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.base.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.base.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,13 +1,14 @@\n error[E0759]: `self` has an anonymous lifetime `'_` but it needs to satisfy a `'static` lifetime requirement\n-  --> $DIR/issue-62097.rs:12:31\n+  --> $DIR/issue-62097.rs:16:31\n    |\n LL |     pub async fn run_dummy_fn(&self) {\n    |                               ^^^^^ this data with an anonymous lifetime `'_`...\n+LL |\n LL |         foo(|| self.bar()).await;\n    |         --- ...is used and required to live as long as `'static` here\n    |\n note: `'static` lifetime requirement introduced by this bound\n-  --> $DIR/issue-62097.rs:4:19\n+  --> $DIR/issue-62097.rs:8:19\n    |\n LL |     F: FnOnce() + 'static\n    |                   ^^^^^^^", "previous_filename": "src/test/ui/async-await/issues/issue-62097.stderr"}, {"sha": "b2b7c46d3487884b5114f2b999ac0a99f289c56e", "filename": "src/test/ui/async-await/issues/issue-62097.nll.stderr", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.nll.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,13 +1,13 @@\n error[E0373]: closure may outlive the current function, but it borrows `self`, which is owned by the current function\n-  --> $DIR/issue-62097.rs:13:13\n+  --> $DIR/issue-62097.rs:18:13\n    |\n LL |         foo(|| self.bar()).await;\n    |             ^^ ---- `self` is borrowed here\n    |             |\n    |             may outlive borrowed value `self`\n    |\n note: function requires argument type to outlive `'static`\n-  --> $DIR/issue-62097.rs:13:9\n+  --> $DIR/issue-62097.rs:18:9\n    |\n LL |         foo(|| self.bar()).await;\n    |         ^^^^^^^^^^^^^^^^^^\n@@ -17,13 +17,14 @@ LL |         foo(move || self.bar()).await;\n    |             ++++\n \n error[E0521]: borrowed data escapes outside of associated function\n-  --> $DIR/issue-62097.rs:13:9\n+  --> $DIR/issue-62097.rs:18:9\n    |\n LL |     pub async fn run_dummy_fn(&self) {\n    |                               -----\n    |                               |\n    |                               `self` is a reference that is only valid in the associated function body\n    |                               let's call the lifetime of this reference `'1`\n+LL |\n LL |         foo(|| self.bar()).await;\n    |         ^^^^^^^^^^^^^^^^^^\n    |         |"}, {"sha": "d2260cd68c1ad9f90ba3088b73cb160a66f0a412", "filename": "src/test/ui/async-await/issues/issue-62097.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-62097.rs?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,3 +1,7 @@\n+// ignore-compare-mode-nll\n+// revisions: base nll\n+// [nll]compile-flags: -Zborrowck=mir\n+\n // edition:2018\n async fn foo<F>(fun: F)\n where\n@@ -9,8 +13,11 @@ where\n struct Struct;\n \n impl Struct {\n-    pub async fn run_dummy_fn(&self) { //~ ERROR E0759\n+    pub async fn run_dummy_fn(&self) {\n+        //[base]~^ ERROR E0759\n         foo(|| self.bar()).await;\n+        //[nll]~^ ERROR closure may outlive the current function\n+        //[nll]~| ERROR borrowed data escapes outside of associated function\n     }\n \n     pub fn bar(&self) {}"}, {"sha": "2ff85a27a4645266ce804891dcbff92842a22049", "filename": "src/test/ui/async-await/issues/issue-63388-1.base.stderr", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.base.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.base.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.base.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,11 +1,11 @@\n error[E0623]: lifetime mismatch\n-  --> $DIR/issue-63388-1.rs:14:9\n+  --> $DIR/issue-63388-1.rs:19:9\n    |\n LL |         &'a self, foo: &dyn Foo\n    |                        -------- this parameter and the return type are declared with different lifetimes...\n LL |     ) -> &dyn Foo\n    |          --------\n-LL |     {\n+...\n LL |         foo\n    |         ^^^ ...but data from `foo` is returned here\n ", "previous_filename": "src/test/ui/async-await/issues/issue-63388-1.stderr"}, {"sha": "eee0cee278b9ca857902f526cda783b67900b9b0", "filename": "src/test/ui/async-await/issues/issue-63388-1.nll.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.nll.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,13 +1,15 @@\n error: lifetime may not live long enough\n-  --> $DIR/issue-63388-1.rs:13:5\n+  --> $DIR/issue-63388-1.rs:17:5\n    |\n LL |       async fn do_sth<'a>(\n    |                       -- lifetime `'a` defined here\n LL |           &'a self, foo: &dyn Foo\n    |                          - let's call the lifetime of this reference `'1`\n LL |       ) -> &dyn Foo\n LL | /     {\n+LL | |\n LL | |         foo\n+LL | |\n LL | |     }\n    | |_____^ associated function was supposed to return data with lifetime `'a` but it is returning data with lifetime `'1`\n "}, {"sha": "c45d2a42177cece425f85812021754f3fc18efdf", "filename": "src/test/ui/async-await/issues/issue-63388-1.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-63388-1.rs?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,3 +1,7 @@\n+// ignore-compare-mode-nll\n+// revisions: base nll\n+// [nll]compile-flags: -Zborrowck=mir\n+\n // edition:2018\n \n struct Xyz {\n@@ -11,7 +15,9 @@ impl Xyz {\n         &'a self, foo: &dyn Foo\n     ) -> &dyn Foo\n     {\n-        foo  //~ ERROR lifetime mismatch\n+        //[nll]~^ ERROR lifetime may not live long enough\n+        foo\n+        //[base]~^ ERROR lifetime mismatch\n     }\n }\n "}, {"sha": "a4bdc447f65048fbb01d20c5f8069b3dd1ae48c3", "filename": "src/test/ui/async-await/issues/issue-72312.base.stderr", "status": "renamed", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.base.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.base.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.base.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,5 +1,5 @@\n error[E0759]: `self` has an anonymous lifetime `'_` but it needs to satisfy a `'static` lifetime requirement\n-  --> $DIR/issue-72312.rs:10:24\n+  --> $DIR/issue-72312.rs:14:24\n    |\n LL |     pub async fn start(&self) {\n    |                        ^^^^^ this data with an anonymous lifetime `'_`...\n@@ -8,12 +8,12 @@ LL |             &self;\n    |             ----- ...is used here...\n    |\n note: ...and is required to live as long as `'static` here\n-  --> $DIR/issue-72312.rs:13:9\n+  --> $DIR/issue-72312.rs:20:9\n    |\n LL |         require_static(async move {\n    |         ^^^^^^^^^^^^^^\n note: `'static` lifetime requirement introduced by this bound\n-  --> $DIR/issue-72312.rs:2:22\n+  --> $DIR/issue-72312.rs:6:22\n    |\n LL | fn require_static<T: 'static>(val: T) -> T {\n    |                      ^^^^^^^", "previous_filename": "src/test/ui/async-await/issues/issue-72312.stderr"}, {"sha": "53b2c931cceab253904caeea4821cc84900b8451", "filename": "src/test/ui/async-await/issues/issue-72312.nll.stderr", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.nll.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,5 +1,5 @@\n error[E0521]: borrowed data escapes outside of associated function\n-  --> $DIR/issue-72312.rs:13:24\n+  --> $DIR/issue-72312.rs:20:24\n    |\n LL |       pub async fn start(&self) {\n    |                          -----\n@@ -9,6 +9,10 @@ LL |       pub async fn start(&self) {\n ...\n LL |           require_static(async move {\n    |  ________________________^\n+LL | |\n+LL | |\n+LL | |\n+LL | |\n LL | |             &self;\n LL | |         });\n    | |         ^"}, {"sha": "c1eceefd64377e92fcf07ecfd47ed5431f5cd61d", "filename": "src/test/ui/async-await/issues/issue-72312.rs", "status": "modified", "additions": 17, "deletions": 6, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fissues%2Fissue-72312.rs?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,17 +1,28 @@\n+// ignore-compare-mode-nll\n+// revisions: base nll\n+// [nll]compile-flags: -Zborrowck=mir\n+\n // edition:2018\n fn require_static<T: 'static>(val: T) -> T {\n-    //~^ NOTE 'static` lifetime requirement introduced by this bound\n+    //[base]~^ NOTE 'static` lifetime requirement introduced by this bound\n     val\n }\n \n struct Problem;\n \n impl Problem {\n-    pub async fn start(&self) { //~ ERROR E0759\n-        //~^ NOTE this data with an anonymous lifetime `'_`\n-        //~| NOTE in this expansion of desugaring of `async` block or function\n-        require_static(async move { //~ NOTE ...and is required to live as long as `'static` here\n-            &self; //~ NOTE ...is used here...\n+    pub async fn start(&self) {\n+        //[base]~^ ERROR E0759\n+        //[base]~| NOTE this data with an anonymous lifetime `'_`\n+        //[base]~| NOTE in this expansion of desugaring of `async` block or function\n+        //[nll]~^^^^ NOTE let's call\n+        //[nll]~| NOTE `self` is a reference\n+        require_static(async move {\n+            //[base]~^ NOTE ...and is required to live as long as `'static` here\n+            //[nll]~^^ ERROR borrowed data escapes\n+            //[nll]~| NOTE `self` escapes\n+            //[nll]~| NOTE argument requires\n+            &self; //[base]~ NOTE ...is used here...\n         });\n     }\n }"}, {"sha": "907c1f6c4079fd4bdd078f24ba8bb75e6b61c182", "filename": "src/test/ui/async-await/multiple-lifetimes/ret-impl-trait-one.base.stderr", "status": "renamed", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.base.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.base.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.base.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,17 +1,18 @@\n error[E0623]: lifetime mismatch\n-  --> $DIR/ret-impl-trait-one.rs:10:85\n+  --> $DIR/ret-impl-trait-one.rs:14:85\n    |\n LL |   async fn async_ret_impl_trait3<'a, 'b>(a: &'a u8, b: &'b u8) -> impl Trait<'a> + 'b {\n    |  ______________________________________________________------_____-------------------_^\n    | |                                                      |\n    | |                                                      this parameter and the return type are declared with different lifetimes...\n LL | |\n+LL | |\n LL | |     (a, b)\n LL | | }\n    | |_^ ...but data from `a` is returned here\n \n error[E0700]: hidden type for `impl Trait` captures lifetime that does not appear in bounds\n-  --> $DIR/ret-impl-trait-one.rs:16:80\n+  --> $DIR/ret-impl-trait-one.rs:21:80\n    |\n LL |   async fn async_ret_impl_trait1<'a, 'b>(a: &'a u8, b: &'b u8) -> impl Trait<'a> {\n    |  ____________________________________--__________________________________________^", "previous_filename": "src/test/ui/async-await/multiple-lifetimes/ret-impl-trait-one.stderr"}, {"sha": "dbf7293a3890345e55732efee5b3de1c461d7e4f", "filename": "src/test/ui/async-await/multiple-lifetimes/ret-impl-trait-one.nll.stderr", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.nll.stderr?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,20 +1,21 @@\n error: lifetime may not live long enough\n-  --> $DIR/ret-impl-trait-one.rs:10:85\n+  --> $DIR/ret-impl-trait-one.rs:14:85\n    |\n LL |   async fn async_ret_impl_trait3<'a, 'b>(a: &'a u8, b: &'b u8) -> impl Trait<'a> + 'b {\n    |  ________________________________--__--_______________________________________________^\n    | |                                |   |\n    | |                                |   lifetime `'b` defined here\n    | |                                lifetime `'a` defined here\n LL | |\n+LL | |\n LL | |     (a, b)\n LL | | }\n    | |_^ function was supposed to return data with lifetime `'b` but it is returning data with lifetime `'a`\n    |\n    = help: consider adding the following bound: `'a: 'b`\n \n error[E0700]: hidden type for `impl Trait` captures lifetime that does not appear in bounds\n-  --> $DIR/ret-impl-trait-one.rs:16:80\n+  --> $DIR/ret-impl-trait-one.rs:21:80\n    |\n LL |   async fn async_ret_impl_trait1<'a, 'b>(a: &'a u8, b: &'b u8) -> impl Trait<'a> {\n    |  ____________________________________--__________________________________________^"}, {"sha": "f4c309b4c10da192da86bf9481fd93705c2247e8", "filename": "src/test/ui/async-await/multiple-lifetimes/ret-impl-trait-one.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34a3154bd9ba92360966fd942df17eb11c7baca7/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fmultiple-lifetimes%2Fret-impl-trait-one.rs?ref=34a3154bd9ba92360966fd942df17eb11c7baca7", "patch": "@@ -1,3 +1,7 @@\n+// ignore-compare-mode-nll\n+// revisions: base nll\n+// [nll]compile-flags: -Zborrowck=mir\n+\n // edition:2018\n \n // Test that a feature gate is needed to use `impl Trait` as the\n@@ -8,7 +12,8 @@ impl<T> Trait<'_> for T { }\n \n // Fails to recognize that both 'a and 'b are mentioned and should thus be accepted\n async fn async_ret_impl_trait3<'a, 'b>(a: &'a u8, b: &'b u8) -> impl Trait<'a> + 'b {\n-    //~^ ERROR lifetime mismatch\n+    //[base]~^ ERROR lifetime mismatch\n+    //[nll]~^^ ERROR lifetime may not live long enough\n     (a, b)\n }\n "}]}