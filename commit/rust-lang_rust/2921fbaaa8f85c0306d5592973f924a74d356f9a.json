{"sha": "2921fbaaa8f85c0306d5592973f924a74d356f9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5MjFmYmFhYThmODVjMDMwNmQ1NTkyOTczZjkyNGE3NGQzNTZmOWE=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-10-22T13:19:33Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2018-10-22T14:04:47Z"}, "message": "flesh out closure-substs test", "tree": {"sha": "5431dca31a953b267da7885f866cdd1e6fe1f712", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5431dca31a953b267da7885f866cdd1e6fe1f712"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2921fbaaa8f85c0306d5592973f924a74d356f9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2921fbaaa8f85c0306d5592973f924a74d356f9a", "html_url": "https://github.com/rust-lang/rust/commit/2921fbaaa8f85c0306d5592973f924a74d356f9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2921fbaaa8f85c0306d5592973f924a74d356f9a/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0afccbb654cfe98ac426b32ccd19ce069e7138a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/0afccbb654cfe98ac426b32ccd19ce069e7138a7", "html_url": "https://github.com/rust-lang/rust/commit/0afccbb654cfe98ac426b32ccd19ce069e7138a7"}], "stats": {"total": 74, "additions": 66, "deletions": 8}, "files": [{"sha": "7dd2d4113bb4868393bbe24eae4b51578ed143c8", "filename": "src/test/ui/nll/user-annotations/closure-substs.rs", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2921fbaaa8f85c0306d5592973f924a74d356f9a/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2921fbaaa8f85c0306d5592973f924a74d356f9a/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.rs?ref=2921fbaaa8f85c0306d5592973f924a74d356f9a", "patch": "@@ -13,12 +13,30 @@\n // Test that we enforce user-provided type annotations on closures.\n \n fn foo<'a>() {\n+    // Here `x` is free in the closure sig:\n     |x: &'a i32| -> &'static i32 {\n-        return x; //~ ERROR\n+        return x; //~ ERROR unsatisfied lifetime constraints\n+    };\n+}\n+\n+fn foo1() {\n+    // Here `x` is bound in the closure sig:\n+    |x: &i32| -> &'static i32 {\n+        return x; //~ ERROR unsatisfied lifetime constraints\n+        //~^ ERROR unsatisfied lifetime constraints\n+        //~| ERROR unsatisfied lifetime constraints\n     };\n }\n \n fn bar<'a>() {\n+    // Here `x` is free in the closure sig:\n+    |x: &'a i32, b: fn(&'static i32)| {\n+        b(x); //~ ERROR unsatisfied lifetime constraints\n+    };\n+}\n+\n+fn bar1() {\n+    // Here `x` is bound in the closure sig:\n     |x: &i32, b: fn(&'static i32)| {\n         b(x); //~ ERROR\n         //~^ ERROR borrowed data escapes outside of closure"}, {"sha": "126a66b80592c475fc78b434c32c4f3912da2137", "filename": "src/test/ui/nll/user-annotations/closure-substs.stderr", "status": "modified", "additions": 47, "deletions": 7, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/2921fbaaa8f85c0306d5592973f924a74d356f9a/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2921fbaaa8f85c0306d5592973f924a74d356f9a/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fuser-annotations%2Fclosure-substs.stderr?ref=2921fbaaa8f85c0306d5592973f924a74d356f9a", "patch": "@@ -1,22 +1,62 @@\n error: unsatisfied lifetime constraints\n-  --> $DIR/closure-substs.rs:17:16\n+  --> $DIR/closure-substs.rs:18:16\n    |\n LL | fn foo<'a>() {\n    |        -- lifetime `'a` defined here\n-LL |     |x: &'a i32| -> &'static i32 {\n-LL |         return x; //~ ERROR\n+...\n+LL |         return x; //~ ERROR unsatisfied lifetime constraints\n    |                ^ returning this value requires that `'a` must outlive `'static`\n \n+error: unsatisfied lifetime constraints\n+  --> $DIR/closure-substs.rs:25:16\n+   |\n+LL |     |x: &i32| -> &'static i32 {\n+   |         - let's call the lifetime of this reference `'1`\n+LL |         return x; //~ ERROR unsatisfied lifetime constraints\n+   |                ^ returning this value requires that `'1` must outlive `'static`\n+\n+error: unsatisfied lifetime constraints\n+  --> $DIR/closure-substs.rs:25:16\n+   |\n+LL |     |x: &i32| -> &'static i32 {\n+   |         -                   - return type of closure is &'2 i32\n+   |         |\n+   |         let's call the lifetime of this reference `'1`\n+LL |         return x; //~ ERROR unsatisfied lifetime constraints\n+   |                ^ returning this value requires that `'1` must outlive `'2`\n+\n+error: unsatisfied lifetime constraints\n+  --> $DIR/closure-substs.rs:25:16\n+   |\n+LL |     |x: &i32| -> &'static i32 {\n+   |     -------------------------\n+   |     |   |\n+   |     |   let's call the lifetime of this reference `'1`\n+   |     lifetime `'2` represents this closure's body\n+LL |         return x; //~ ERROR unsatisfied lifetime constraints\n+   |                ^ closure was supposed to return data with lifetime `'2` but it is returning data with lifetime `'1`\n+   |\n+   = note: closure implements `Fn`, so references to captured variables can't escape the closure\n+\n+error: unsatisfied lifetime constraints\n+  --> $DIR/closure-substs.rs:34:9\n+   |\n+LL | fn bar<'a>() {\n+   |        -- lifetime `'a` defined here\n+...\n+LL |         b(x); //~ ERROR unsatisfied lifetime constraints\n+   |         ^^^^ argument requires that `'a` must outlive `'static`\n+\n error: borrowed data escapes outside of closure\n-  --> $DIR/closure-substs.rs:23:9\n+  --> $DIR/closure-substs.rs:41:9\n    |\n LL |     |x: &i32, b: fn(&'static i32)| {\n    |      - `x` is a reference that is only valid in the closure body\n LL |         b(x); //~ ERROR\n    |         ^^^^ `x` escapes the closure body here\n \n error: borrowed data escapes outside of closure\n-  --> $DIR/closure-substs.rs:23:9\n+  --> $DIR/closure-substs.rs:41:9\n    |\n LL |     |x: &i32, b: fn(&'static i32)| {\n    |      -        - `b` is declared here, outside of the closure body\n@@ -26,7 +66,7 @@ LL |         b(x); //~ ERROR\n    |         ^^^^ `x` escapes the closure body here\n \n error: unsatisfied lifetime constraints\n-  --> $DIR/closure-substs.rs:23:9\n+  --> $DIR/closure-substs.rs:41:9\n    |\n LL |     |x: &i32, b: fn(&'static i32)| {\n    |     ------------------------------\n@@ -38,5 +78,5 @@ LL |         b(x); //~ ERROR\n    |\n    = note: closure implements `Fn`, so references to captured variables can't escape the closure\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 8 previous errors\n "}]}