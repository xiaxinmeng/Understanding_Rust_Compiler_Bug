{"sha": "408d4027d0c469be4ab442b8d0223565cdb09229", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwOGQ0MDI3ZDBjNDY5YmU0YWI0NDJiOGQwMjIzNTY1Y2RiMDkyMjk=", "commit": {"author": {"name": "Nathan Nguyen", "email": "nathan.tm.nguyen@gmail.com", "date": "2021-02-19T20:50:15Z"}, "committer": {"name": "Nathan Nguyen", "email": "nathan.tm.nguyen@gmail.com", "date": "2021-02-20T17:46:58Z"}, "message": "nhwn: use plain u32 in DebugLoc", "tree": {"sha": "c42345390aab4780efed9561995425ed71e63bb9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c42345390aab4780efed9561995425ed71e63bb9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/408d4027d0c469be4ab442b8d0223565cdb09229", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/408d4027d0c469be4ab442b8d0223565cdb09229", "html_url": "https://github.com/rust-lang/rust/commit/408d4027d0c469be4ab442b8d0223565cdb09229", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/408d4027d0c469be4ab442b8d0223565cdb09229/comments", "author": {"login": "nhwn", "id": 43092380, "node_id": "MDQ6VXNlcjQzMDkyMzgw", "avatar_url": "https://avatars.githubusercontent.com/u/43092380?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nhwn", "html_url": "https://github.com/nhwn", "followers_url": "https://api.github.com/users/nhwn/followers", "following_url": "https://api.github.com/users/nhwn/following{/other_user}", "gists_url": "https://api.github.com/users/nhwn/gists{/gist_id}", "starred_url": "https://api.github.com/users/nhwn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nhwn/subscriptions", "organizations_url": "https://api.github.com/users/nhwn/orgs", "repos_url": "https://api.github.com/users/nhwn/repos", "events_url": "https://api.github.com/users/nhwn/events{/privacy}", "received_events_url": "https://api.github.com/users/nhwn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nhwn", "id": 43092380, "node_id": "MDQ6VXNlcjQzMDkyMzgw", "avatar_url": "https://avatars.githubusercontent.com/u/43092380?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nhwn", "html_url": "https://github.com/nhwn", "followers_url": "https://api.github.com/users/nhwn/followers", "following_url": "https://api.github.com/users/nhwn/following{/other_user}", "gists_url": "https://api.github.com/users/nhwn/gists{/gist_id}", "starred_url": "https://api.github.com/users/nhwn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nhwn/subscriptions", "organizations_url": "https://api.github.com/users/nhwn/orgs", "repos_url": "https://api.github.com/users/nhwn/repos", "events_url": "https://api.github.com/users/nhwn/events{/privacy}", "received_events_url": "https://api.github.com/users/nhwn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5aa1bceb92ce2207a2f3db07c3fe892fa196086", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5aa1bceb92ce2207a2f3db07c3fe892fa196086", "html_url": "https://github.com/rust-lang/rust/commit/f5aa1bceb92ce2207a2f3db07c3fe892fa196086"}], "stats": {"total": 41, "additions": 15, "deletions": 26}, "files": [{"sha": "c2725b83f50d62f32a6d9f1180da76e25fc010cc", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/create_scope_map.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fcreate_scope_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fcreate_scope_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fcreate_scope_map.rs?ref=408d4027d0c469be4ab442b8d0223565cdb09229", "patch": "@@ -1,4 +1,4 @@\n-use super::metadata::{file_metadata, UNKNOWN_COLUMN_NUMBER, UNKNOWN_LINE_NUMBER};\n+use super::metadata::file_metadata;\n use super::utils::DIB;\n use rustc_codegen_ssa::mir::debuginfo::{DebugScope, FunctionDebugContext};\n use rustc_codegen_ssa::traits::*;\n@@ -102,8 +102,8 @@ fn make_mir_scope(\n                 DIB(cx),\n                 parent_scope.dbg_scope.unwrap(),\n                 file_metadata,\n-                loc.line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n-                loc.col.map_or(UNKNOWN_COLUMN_NUMBER, |n| n.get()),\n+                loc.line,\n+                loc.col,\n             )\n         },\n     };"}, {"sha": "d6873af0522b8b2948ebb0a254486a922b5d57f1", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=408d4027d0c469be4ab442b8d0223565cdb09229", "patch": "@@ -1839,10 +1839,7 @@ impl<'tcx> VariantInfo<'_, 'tcx> {\n                     .span;\n                 if !span.is_dummy() {\n                     let loc = cx.lookup_debug_loc(span.lo());\n-                    return Some(SourceInfo {\n-                        file: file_metadata(cx, &loc.file),\n-                        line: loc.line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n-                    });\n+                    return Some(SourceInfo { file: file_metadata(cx, &loc.file), line: loc.line });\n                 }\n             }\n             _ => {}\n@@ -2481,7 +2478,7 @@ pub fn create_global_var_metadata(cx: &CodegenCx<'ll, '_>, def_id: DefId, global\n         let loc = cx.lookup_debug_loc(span.lo());\n         (file_metadata(cx, &loc.file), loc.line)\n     } else {\n-        (unknown_file_metadata(cx), None)\n+        (unknown_file_metadata(cx), UNKNOWN_LINE_NUMBER)\n     };\n \n     let is_local_to_unit = is_node_local_to_unit(cx, def_id);\n@@ -2504,7 +2501,7 @@ pub fn create_global_var_metadata(cx: &CodegenCx<'ll, '_>, def_id: DefId, global\n             linkage_name.as_ptr().cast(),\n             linkage_name.len(),\n             file_metadata,\n-            line_number.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n+            line_number,\n             type_metadata,\n             is_local_to_unit,\n             global,"}, {"sha": "1429b4ff2178101c7b2b33ef2593b830e223d180", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/mod.rs", "status": "modified", "additions": 9, "deletions": 17, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/408d4027d0c469be4ab442b8d0223565cdb09229/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmod.rs?ref=408d4027d0c469be4ab442b8d0223565cdb09229", "patch": "@@ -38,7 +38,6 @@ use rustc_target::abi::{LayoutOf, Primitive, Size};\n use libc::c_uint;\n use smallvec::SmallVec;\n use std::cell::RefCell;\n-use std::num::NonZeroU32;\n use tracing::debug;\n \n mod create_scope_map;\n@@ -225,9 +224,9 @@ pub struct DebugLoc {\n     /// Information about the original source file.\n     pub file: Lrc<SourceFile>,\n     /// The (1-based) line number.\n-    pub line: Option<NonZeroU32>,\n+    pub line: u32,\n     /// The (1-based) column number.\n-    pub col: Option<NonZeroU32>,\n+    pub col: u32,\n }\n \n impl CodegenCx<'ll, '_> {\n@@ -244,16 +243,16 @@ impl CodegenCx<'ll, '_> {\n                 let line = (line + 1) as u32;\n                 let col = (pos - line_pos).to_u32() + 1;\n \n-                (file, NonZeroU32::new(line), NonZeroU32::new(col))\n+                (file, line, col)\n             }\n-            Err(file) => (file, None, None),\n+            Err(file) => (file, UNKNOWN_LINE_NUMBER, UNKNOWN_COLUMN_NUMBER),\n         };\n \n         // For MSVC, omit the column number.\n         // Otherwise, emit it. This mimics clang behaviour.\n         // See discussion in https://github.com/rust-lang/rust/issues/42921\n         if self.sess().target.is_like_msvc {\n-            DebugLoc { file, line, col: None }\n+            DebugLoc { file, line, col: UNKNOWN_COLUMN_NUMBER }\n         } else {\n             DebugLoc { file, line, col }\n         }\n@@ -359,9 +358,9 @@ impl DebugInfoMethods<'tcx> for CodegenCx<'ll, 'tcx> {\n                 linkage_name.as_ptr().cast(),\n                 linkage_name.len(),\n                 file_metadata,\n-                loc.line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n+                loc.line,\n                 function_type_metadata,\n-                scope_line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n+                scope_line,\n                 flags,\n                 spflags,\n                 maybe_definition_llfn,\n@@ -551,14 +550,7 @@ impl DebugInfoMethods<'tcx> for CodegenCx<'ll, 'tcx> {\n     ) -> &'ll DILocation {\n         let DebugLoc { line, col, .. } = self.lookup_debug_loc(span.lo());\n \n-        unsafe {\n-            llvm::LLVMRustDIBuilderCreateDebugLocation(\n-                line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n-                col.map_or(UNKNOWN_COLUMN_NUMBER, |n| n.get()),\n-                scope,\n-                inlined_at,\n-            )\n-        }\n+        unsafe { llvm::LLVMRustDIBuilderCreateDebugLocation(line, col, scope, inlined_at) }\n     }\n \n     fn create_vtable_metadata(&self, ty: Ty<'tcx>, vtable: Self::Value) {\n@@ -607,7 +599,7 @@ impl DebugInfoMethods<'tcx> for CodegenCx<'ll, 'tcx> {\n                 name.as_ptr().cast(),\n                 name.len(),\n                 file_metadata,\n-                loc.line.map_or(UNKNOWN_LINE_NUMBER, |n| n.get()),\n+                loc.line,\n                 type_metadata,\n                 true,\n                 DIFlags::FlagZero,"}]}