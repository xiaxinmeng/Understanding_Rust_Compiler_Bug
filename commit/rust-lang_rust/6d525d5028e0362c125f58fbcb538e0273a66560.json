{"sha": "6d525d5028e0362c125f58fbcb538e0273a66560", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkNTI1ZDUwMjhlMDM2MmMxMjVmNThmYmNiNTM4ZTAyNzNhNjY1NjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-16T00:54:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-16T00:54:01Z"}, "message": "Auto merge of #85259 - Smittyvb:thir-unsafeck-inline-asm, r=nikomatsakis\n\nCheck for inline assembly in THIR unsafeck\n\n#83129 was merged recently and added a THIR unsafe checker. This adds a check for inline assembly. (and this is 2x simpler than the MIR version, which has to check for `asm` and `llvm_asm` in two separate spots!)\n\n see also rust-lang/project-thir-unsafeck#7", "tree": {"sha": "0d75f0b401c4fa0de34975ba2cded3f94b27630b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d75f0b401c4fa0de34975ba2cded3f94b27630b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6d525d5028e0362c125f58fbcb538e0273a66560", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6d525d5028e0362c125f58fbcb538e0273a66560", "html_url": "https://github.com/rust-lang/rust/commit/6d525d5028e0362c125f58fbcb538e0273a66560", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6d525d5028e0362c125f58fbcb538e0273a66560/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d565c7488749fd0e998d6be21efeb20354e4696d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d565c7488749fd0e998d6be21efeb20354e4696d", "html_url": "https://github.com/rust-lang/rust/commit/d565c7488749fd0e998d6be21efeb20354e4696d"}, {"sha": "f23d231c50172cdba8bad01507eb27062134c98d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f23d231c50172cdba8bad01507eb27062134c98d", "html_url": "https://github.com/rust-lang/rust/commit/f23d231c50172cdba8bad01507eb27062134c98d"}], "stats": {"total": 315, "additions": 288, "deletions": 27}, "files": [{"sha": "83288fa541e44f8777f575355d8a3cf79aec60fb", "filename": "compiler/rustc_mir_build/src/check_unsafety.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/compiler%2Frustc_mir_build%2Fsrc%2Fcheck_unsafety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/compiler%2Frustc_mir_build%2Fsrc%2Fcheck_unsafety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fcheck_unsafety.rs?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -153,6 +153,9 @@ impl<'thir, 'tcx> Visitor<'thir, 'tcx> for UnsafetyVisitor<'tcx> {\n                     self.requires_unsafe(expr.span, CallToUnsafeFunction);\n                 }\n             }\n+            ExprKind::InlineAsm { .. } | ExprKind::LlvmInlineAsm { .. } => {\n+                self.requires_unsafe(expr.span, UseOfInlineAssembly);\n+            }\n             _ => {}\n         }\n \n@@ -194,7 +197,6 @@ impl BodyUnsafety {\n #[derive(Clone, Copy, PartialEq)]\n enum UnsafeOpKind {\n     CallToUnsafeFunction,\n-    #[allow(dead_code)] // FIXME\n     UseOfInlineAssembly,\n     #[allow(dead_code)] // FIXME\n     InitializingTypeWith,"}, {"sha": "d86e53c06267139101b80c201907dfdbf6085622", "filename": "src/test/ui/asm/bad-arch.mirunsafeck.stderr", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.mirunsafeck.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.mirunsafeck.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-arch.mirunsafeck.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -1,11 +1,11 @@\n error[E0472]: inline assembly is unsupported on this target\n-  --> $DIR/bad-arch.rs:20:9\n+  --> $DIR/bad-arch.rs:22:9\n    |\n LL |         asm!(\"\");\n    |         ^^^^^^^^^\n \n error[E0472]: inline assembly is unsupported on this target\n-  --> $DIR/bad-arch.rs:25:1\n+  --> $DIR/bad-arch.rs:27:1\n    |\n LL | global_asm!(\"\");\n    | ^^^^^^^^^^^^^^^^", "previous_filename": "src/test/ui/asm/bad-arch.stderr"}, {"sha": "93309899bf387e2fc4abcd62a55b7975d0c4ca22", "filename": "src/test/ui/asm/bad-arch.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-arch.rs?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -1,5 +1,7 @@\n // compile-flags: --target sparc-unknown-linux-gnu\n // needs-llvm-components: sparc\n+// revisions: mirunsafeck thirunsafeck\n+// [thirunsafeck]compile-flags: -Z thir-unsafeck\n \n #![feature(no_core, lang_items, rustc_attrs)]\n #![no_core]"}, {"sha": "d86e53c06267139101b80c201907dfdbf6085622", "filename": "src/test/ui/asm/bad-arch.thirunsafeck.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.thirunsafeck.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-arch.thirunsafeck.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-arch.thirunsafeck.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -0,0 +1,16 @@\n+error[E0472]: inline assembly is unsupported on this target\n+  --> $DIR/bad-arch.rs:22:9\n+   |\n+LL |         asm!(\"\");\n+   |         ^^^^^^^^^\n+\n+error[E0472]: inline assembly is unsupported on this target\n+  --> $DIR/bad-arch.rs:27:1\n+   |\n+LL | global_asm!(\"\");\n+   | ^^^^^^^^^^^^^^^^\n+   |\n+   = note: this error originates in the macro `global_asm` (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "13ef032ab1071a13851d7e4754eb5411598a6fa4", "filename": "src/test/ui/asm/bad-template.mirunsafeck.stderr", "status": "renamed", "additions": 24, "deletions": 24, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.mirunsafeck.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.mirunsafeck.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-template.mirunsafeck.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -1,35 +1,35 @@\n error: invalid reference to argument at index 0\n-  --> $DIR/bad-template.rs:8:15\n+  --> $DIR/bad-template.rs:10:15\n    |\n LL |         asm!(\"{}\");\n    |               ^^ from here\n    |\n    = note: no arguments were given\n \n error: invalid reference to argument at index 1\n-  --> $DIR/bad-template.rs:10:15\n+  --> $DIR/bad-template.rs:12:15\n    |\n LL |         asm!(\"{1}\", in(reg) foo);\n    |               ^^^ from here\n    |\n    = note: there is 1 argument\n \n error: argument never used\n-  --> $DIR/bad-template.rs:10:21\n+  --> $DIR/bad-template.rs:12:21\n    |\n LL |         asm!(\"{1}\", in(reg) foo);\n    |                     ^^^^^^^^^^^ argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {0} */\"`\n \n error: there is no argument named `a`\n-  --> $DIR/bad-template.rs:13:15\n+  --> $DIR/bad-template.rs:15:15\n    |\n LL |         asm!(\"{a}\");\n    |               ^^^\n \n error: invalid reference to argument at index 0\n-  --> $DIR/bad-template.rs:15:15\n+  --> $DIR/bad-template.rs:17:15\n    |\n LL |         asm!(\"{}\", a = in(reg) foo);\n    |               ^^   --------------- named argument\n@@ -38,37 +38,37 @@ LL |         asm!(\"{}\", a = in(reg) foo);\n    |\n    = note: no positional arguments were given\n note: named arguments cannot be referenced by position\n-  --> $DIR/bad-template.rs:15:20\n+  --> $DIR/bad-template.rs:17:20\n    |\n LL |         asm!(\"{}\", a = in(reg) foo);\n    |                    ^^^^^^^^^^^^^^^\n \n error: named argument never used\n-  --> $DIR/bad-template.rs:15:20\n+  --> $DIR/bad-template.rs:17:20\n    |\n LL |         asm!(\"{}\", a = in(reg) foo);\n    |                    ^^^^^^^^^^^^^^^ named argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n \n error: invalid reference to argument at index 1\n-  --> $DIR/bad-template.rs:18:15\n+  --> $DIR/bad-template.rs:20:15\n    |\n LL |         asm!(\"{1}\", a = in(reg) foo);\n    |               ^^^ from here\n    |\n    = note: no positional arguments were given\n \n error: named argument never used\n-  --> $DIR/bad-template.rs:18:21\n+  --> $DIR/bad-template.rs:20:21\n    |\n LL |         asm!(\"{1}\", a = in(reg) foo);\n    |                     ^^^^^^^^^^^^^^^ named argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n \n error: invalid reference to argument at index 0\n-  --> $DIR/bad-template.rs:21:15\n+  --> $DIR/bad-template.rs:23:15\n    |\n LL |         asm!(\"{}\", in(\"eax\") foo);\n    |               ^^   ------------- explicit register argument\n@@ -77,19 +77,19 @@ LL |         asm!(\"{}\", in(\"eax\") foo);\n    |\n    = note: no positional arguments were given\n note: explicit register arguments cannot be used in the asm template\n-  --> $DIR/bad-template.rs:21:20\n+  --> $DIR/bad-template.rs:23:20\n    |\n LL |         asm!(\"{}\", in(\"eax\") foo);\n    |                    ^^^^^^^^^^^^^\n \n error: asm template modifier must be a single character\n-  --> $DIR/bad-template.rs:23:17\n+  --> $DIR/bad-template.rs:25:17\n    |\n LL |         asm!(\"{:foo}\", in(reg) foo);\n    |                 ^^^\n \n error: multiple unused asm arguments\n-  --> $DIR/bad-template.rs:25:18\n+  --> $DIR/bad-template.rs:27:18\n    |\n LL |         asm!(\"\", in(reg) 0, in(reg) 1);\n    |                  ^^^^^^^^^  ^^^^^^^^^ argument never used\n@@ -99,37 +99,37 @@ LL |         asm!(\"\", in(reg) 0, in(reg) 1);\n    = help: if these arguments are intentionally unused, consider using them in an asm comment: `\"/* {0} {1} */\"`\n \n error: invalid reference to argument at index 0\n-  --> $DIR/bad-template.rs:31:14\n+  --> $DIR/bad-template.rs:33:14\n    |\n LL | global_asm!(\"{}\");\n    |              ^^ from here\n    |\n    = note: no arguments were given\n \n error: invalid reference to argument at index 1\n-  --> $DIR/bad-template.rs:33:14\n+  --> $DIR/bad-template.rs:35:14\n    |\n LL | global_asm!(\"{1}\", const FOO);\n    |              ^^^ from here\n    |\n    = note: there is 1 argument\n \n error: argument never used\n-  --> $DIR/bad-template.rs:33:20\n+  --> $DIR/bad-template.rs:35:20\n    |\n LL | global_asm!(\"{1}\", const FOO);\n    |                    ^^^^^^^^^ argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {0} */\"`\n \n error: there is no argument named `a`\n-  --> $DIR/bad-template.rs:36:14\n+  --> $DIR/bad-template.rs:38:14\n    |\n LL | global_asm!(\"{a}\");\n    |              ^^^\n \n error: invalid reference to argument at index 0\n-  --> $DIR/bad-template.rs:38:14\n+  --> $DIR/bad-template.rs:40:14\n    |\n LL | global_asm!(\"{}\", a = const FOO);\n    |              ^^   ------------- named argument\n@@ -138,43 +138,43 @@ LL | global_asm!(\"{}\", a = const FOO);\n    |\n    = note: no positional arguments were given\n note: named arguments cannot be referenced by position\n-  --> $DIR/bad-template.rs:38:19\n+  --> $DIR/bad-template.rs:40:19\n    |\n LL | global_asm!(\"{}\", a = const FOO);\n    |                   ^^^^^^^^^^^^^\n \n error: named argument never used\n-  --> $DIR/bad-template.rs:38:19\n+  --> $DIR/bad-template.rs:40:19\n    |\n LL | global_asm!(\"{}\", a = const FOO);\n    |                   ^^^^^^^^^^^^^ named argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n \n error: invalid reference to argument at index 1\n-  --> $DIR/bad-template.rs:41:14\n+  --> $DIR/bad-template.rs:43:14\n    |\n LL | global_asm!(\"{1}\", a = const FOO);\n    |              ^^^ from here\n    |\n    = note: no positional arguments were given\n \n error: named argument never used\n-  --> $DIR/bad-template.rs:41:20\n+  --> $DIR/bad-template.rs:43:20\n    |\n LL | global_asm!(\"{1}\", a = const FOO);\n    |                    ^^^^^^^^^^^^^ named argument never used\n    |\n    = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n \n error: asm template modifier must be a single character\n-  --> $DIR/bad-template.rs:44:16\n+  --> $DIR/bad-template.rs:46:16\n    |\n LL | global_asm!(\"{:foo}\", const FOO);\n    |                ^^^\n \n error: multiple unused asm arguments\n-  --> $DIR/bad-template.rs:46:17\n+  --> $DIR/bad-template.rs:48:17\n    |\n LL | global_asm!(\"\", const FOO, const FOO);\n    |                 ^^^^^^^^^  ^^^^^^^^^ argument never used", "previous_filename": "src/test/ui/asm/bad-template.stderr"}, {"sha": "5aed2c62f0bddaa29aa0bace25bc869dc64f660e", "filename": "src/test/ui/asm/bad-template.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-template.rs?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -1,4 +1,6 @@\n // only-x86_64\n+// revisions: mirunsafeck thirunsafeck\n+// [thirunsafeck]compile-flags: -Z thir-unsafeck\n \n #![feature(asm, global_asm)]\n "}, {"sha": "13ef032ab1071a13851d7e4754eb5411598a6fa4", "filename": "src/test/ui/asm/bad-template.thirunsafeck.stderr", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.thirunsafeck.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fbad-template.thirunsafeck.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fbad-template.thirunsafeck.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -0,0 +1,187 @@\n+error: invalid reference to argument at index 0\n+  --> $DIR/bad-template.rs:10:15\n+   |\n+LL |         asm!(\"{}\");\n+   |               ^^ from here\n+   |\n+   = note: no arguments were given\n+\n+error: invalid reference to argument at index 1\n+  --> $DIR/bad-template.rs:12:15\n+   |\n+LL |         asm!(\"{1}\", in(reg) foo);\n+   |               ^^^ from here\n+   |\n+   = note: there is 1 argument\n+\n+error: argument never used\n+  --> $DIR/bad-template.rs:12:21\n+   |\n+LL |         asm!(\"{1}\", in(reg) foo);\n+   |                     ^^^^^^^^^^^ argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {0} */\"`\n+\n+error: there is no argument named `a`\n+  --> $DIR/bad-template.rs:15:15\n+   |\n+LL |         asm!(\"{a}\");\n+   |               ^^^\n+\n+error: invalid reference to argument at index 0\n+  --> $DIR/bad-template.rs:17:15\n+   |\n+LL |         asm!(\"{}\", a = in(reg) foo);\n+   |               ^^   --------------- named argument\n+   |               |\n+   |               from here\n+   |\n+   = note: no positional arguments were given\n+note: named arguments cannot be referenced by position\n+  --> $DIR/bad-template.rs:17:20\n+   |\n+LL |         asm!(\"{}\", a = in(reg) foo);\n+   |                    ^^^^^^^^^^^^^^^\n+\n+error: named argument never used\n+  --> $DIR/bad-template.rs:17:20\n+   |\n+LL |         asm!(\"{}\", a = in(reg) foo);\n+   |                    ^^^^^^^^^^^^^^^ named argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n+\n+error: invalid reference to argument at index 1\n+  --> $DIR/bad-template.rs:20:15\n+   |\n+LL |         asm!(\"{1}\", a = in(reg) foo);\n+   |               ^^^ from here\n+   |\n+   = note: no positional arguments were given\n+\n+error: named argument never used\n+  --> $DIR/bad-template.rs:20:21\n+   |\n+LL |         asm!(\"{1}\", a = in(reg) foo);\n+   |                     ^^^^^^^^^^^^^^^ named argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n+\n+error: invalid reference to argument at index 0\n+  --> $DIR/bad-template.rs:23:15\n+   |\n+LL |         asm!(\"{}\", in(\"eax\") foo);\n+   |               ^^   ------------- explicit register argument\n+   |               |\n+   |               from here\n+   |\n+   = note: no positional arguments were given\n+note: explicit register arguments cannot be used in the asm template\n+  --> $DIR/bad-template.rs:23:20\n+   |\n+LL |         asm!(\"{}\", in(\"eax\") foo);\n+   |                    ^^^^^^^^^^^^^\n+\n+error: asm template modifier must be a single character\n+  --> $DIR/bad-template.rs:25:17\n+   |\n+LL |         asm!(\"{:foo}\", in(reg) foo);\n+   |                 ^^^\n+\n+error: multiple unused asm arguments\n+  --> $DIR/bad-template.rs:27:18\n+   |\n+LL |         asm!(\"\", in(reg) 0, in(reg) 1);\n+   |                  ^^^^^^^^^  ^^^^^^^^^ argument never used\n+   |                  |\n+   |                  argument never used\n+   |\n+   = help: if these arguments are intentionally unused, consider using them in an asm comment: `\"/* {0} {1} */\"`\n+\n+error: invalid reference to argument at index 0\n+  --> $DIR/bad-template.rs:33:14\n+   |\n+LL | global_asm!(\"{}\");\n+   |              ^^ from here\n+   |\n+   = note: no arguments were given\n+\n+error: invalid reference to argument at index 1\n+  --> $DIR/bad-template.rs:35:14\n+   |\n+LL | global_asm!(\"{1}\", const FOO);\n+   |              ^^^ from here\n+   |\n+   = note: there is 1 argument\n+\n+error: argument never used\n+  --> $DIR/bad-template.rs:35:20\n+   |\n+LL | global_asm!(\"{1}\", const FOO);\n+   |                    ^^^^^^^^^ argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {0} */\"`\n+\n+error: there is no argument named `a`\n+  --> $DIR/bad-template.rs:38:14\n+   |\n+LL | global_asm!(\"{a}\");\n+   |              ^^^\n+\n+error: invalid reference to argument at index 0\n+  --> $DIR/bad-template.rs:40:14\n+   |\n+LL | global_asm!(\"{}\", a = const FOO);\n+   |              ^^   ------------- named argument\n+   |              |\n+   |              from here\n+   |\n+   = note: no positional arguments were given\n+note: named arguments cannot be referenced by position\n+  --> $DIR/bad-template.rs:40:19\n+   |\n+LL | global_asm!(\"{}\", a = const FOO);\n+   |                   ^^^^^^^^^^^^^\n+\n+error: named argument never used\n+  --> $DIR/bad-template.rs:40:19\n+   |\n+LL | global_asm!(\"{}\", a = const FOO);\n+   |                   ^^^^^^^^^^^^^ named argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n+\n+error: invalid reference to argument at index 1\n+  --> $DIR/bad-template.rs:43:14\n+   |\n+LL | global_asm!(\"{1}\", a = const FOO);\n+   |              ^^^ from here\n+   |\n+   = note: no positional arguments were given\n+\n+error: named argument never used\n+  --> $DIR/bad-template.rs:43:20\n+   |\n+LL | global_asm!(\"{1}\", a = const FOO);\n+   |                    ^^^^^^^^^^^^^ named argument never used\n+   |\n+   = help: if this argument is intentionally unused, consider using it in an asm comment: `\"/* {a} */\"`\n+\n+error: asm template modifier must be a single character\n+  --> $DIR/bad-template.rs:46:16\n+   |\n+LL | global_asm!(\"{:foo}\", const FOO);\n+   |                ^^^\n+\n+error: multiple unused asm arguments\n+  --> $DIR/bad-template.rs:48:17\n+   |\n+LL | global_asm!(\"\", const FOO, const FOO);\n+   |                 ^^^^^^^^^  ^^^^^^^^^ argument never used\n+   |                 |\n+   |                 argument never used\n+   |\n+   = help: if these arguments are intentionally unused, consider using them in an asm comment: `\"/* {0} {1} */\"`\n+\n+error: aborting due to 21 previous errors\n+"}, {"sha": "d4de9abb8caf08a51531274721f73e896d289ffc", "filename": "src/test/ui/asm/const.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fconst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Fasm%2Fconst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fconst.rs?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -1,6 +1,8 @@\n // min-llvm-version: 10.0.1\n // only-x86_64\n // run-pass\n+// revisions: mirunsafeck thirunsafeck\n+// [thirunsafeck]compile-flags: -Z thir-unsafeck\n \n #![feature(asm, global_asm)]\n "}, {"sha": "daacd234eb487f8a31282bffb987957b2765576f", "filename": "src/test/ui/unsafe/inline_asm.mir.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.mir.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -0,0 +1,20 @@\n+error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n+  --> $DIR/inline_asm.rs:8:5\n+   |\n+LL |     asm!(\"nop\");\n+   |     ^^^^^^^^^^^^ use of inline assembly\n+   |\n+   = note: inline assembly is entirely unchecked and can cause undefined behavior\n+\n+error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n+  --> $DIR/inline_asm.rs:9:5\n+   |\n+LL |     llvm_asm!(\"nop\");\n+   |     ^^^^^^^^^^^^^^^^^ use of inline assembly\n+   |\n+   = note: inline assembly is entirely unchecked and can cause undefined behavior\n+   = note: this error originates in the macro `llvm_asm` (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0133`."}, {"sha": "d002d0e701a6f1d75b88702458f192dbdb629b14", "filename": "src/test/ui/unsafe/inline_asm.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.rs?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -0,0 +1,10 @@\n+// revisions: mir thir\n+// [thir]compile-flags: -Z thir-unsafeck\n+\n+#![feature(llvm_asm)]\n+#![feature(asm)]\n+\n+fn main() {\n+    asm!(\"nop\"); //~ ERROR use of inline assembly is unsafe and requires unsafe function or block\n+    llvm_asm!(\"nop\"); //~ ERROR use of inline assembly is unsafe and requires unsafe function or block\n+}"}, {"sha": "daacd234eb487f8a31282bffb987957b2765576f", "filename": "src/test/ui/unsafe/inline_asm.thir.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6d525d5028e0362c125f58fbcb538e0273a66560/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Funsafe%2Finline_asm.thir.stderr?ref=6d525d5028e0362c125f58fbcb538e0273a66560", "patch": "@@ -0,0 +1,20 @@\n+error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n+  --> $DIR/inline_asm.rs:8:5\n+   |\n+LL |     asm!(\"nop\");\n+   |     ^^^^^^^^^^^^ use of inline assembly\n+   |\n+   = note: inline assembly is entirely unchecked and can cause undefined behavior\n+\n+error[E0133]: use of inline assembly is unsafe and requires unsafe function or block\n+  --> $DIR/inline_asm.rs:9:5\n+   |\n+LL |     llvm_asm!(\"nop\");\n+   |     ^^^^^^^^^^^^^^^^^ use of inline assembly\n+   |\n+   = note: inline assembly is entirely unchecked and can cause undefined behavior\n+   = note: this error originates in the macro `llvm_asm` (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0133`."}]}