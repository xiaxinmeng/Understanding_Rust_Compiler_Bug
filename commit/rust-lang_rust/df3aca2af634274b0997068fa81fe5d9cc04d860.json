{"sha": "df3aca2af634274b0997068fa81fe5d9cc04d860", "node_id": "C_kwDOAAsO6NoAKGRmM2FjYTJhZjYzNDI3NGIwOTk3MDY4ZmE4MWZlNWQ5Y2MwNGQ4NjA", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-04-20T08:03:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-20T08:03:23Z"}, "message": "Rollup merge of #102341 - jmillikin:nonzero-impl-neg, r=dtolnay\n\nImplement `Neg` for signed non-zero integers.\n\nNegating a non-zero integer currently requires unpacking to a primitive and re-wrapping. Since negation of non-zero signed integers always produces a non-zero result, it is safe to implement `Neg` for `NonZeroI{N}`.\n\nThe new `impl` is marked as stable because trait impls for two stable types can't be marked unstable.\n\nSee discussion on https://github.com/rust-lang/libs-team/issues/105 for additional context.", "tree": {"sha": "71f7f26da4a3b85486a622895baffd5298f0a4b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71f7f26da4a3b85486a622895baffd5298f0a4b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df3aca2af634274b0997068fa81fe5d9cc04d860", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkQPHLCRBK7hj4Ov3rIwAACugIAE2BK+MwaxFJZ5U/pjcM0Yql\nM0XRZX0y42HurA/kGirAlY4EpO8JCR+hoq5Eceb7+sYYEMWcrQsJLtUXoHHlo687\n2iNSGfmQXBbrz4xI2/gW5Q6/CQ+GuHvEN9oLS2xDhGOzv+0n4zdbodCyMUzdfqmA\n0GbgiVSNNvg2rIndYpTCsR130NjXUJwQOoz7T22S16fCEYCWqvrYUyvOYDdteRjI\nGdgvmN4vaLk+ckQeVHrzmjMDobv0/t7bVXDVta3FIJLFAymoiu2gbYDp4y6YdIvK\nom6MB5ys5dvEK/2cUZofNEkvWVoqh3YHI3RyUH0oQKRoB1fBrNTBYINTNMnbBUY=\n=Sy7Y\n-----END PGP SIGNATURE-----\n", "payload": "tree 71f7f26da4a3b85486a622895baffd5298f0a4b2\nparent 7fde08365c4c3cfc9a9f8a6a02693b789adbe6da\nparent 4e2797dd76363370eac74cc9480e7d8c0ff17b4b\nauthor Yuki Okushi <jtitor@2k36.org> 1681977803 +0900\ncommitter GitHub <noreply@github.com> 1681977803 +0900\n\nRollup merge of #102341 - jmillikin:nonzero-impl-neg, r=dtolnay\n\nImplement `Neg` for signed non-zero integers.\n\nNegating a non-zero integer currently requires unpacking to a primitive and re-wrapping. Since negation of non-zero signed integers always produces a non-zero result, it is safe to implement `Neg` for `NonZeroI{N}`.\n\nThe new `impl` is marked as stable because trait impls for two stable types can't be marked unstable.\n\nSee discussion on https://github.com/rust-lang/libs-team/issues/105 for additional context.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df3aca2af634274b0997068fa81fe5d9cc04d860", "html_url": "https://github.com/rust-lang/rust/commit/df3aca2af634274b0997068fa81fe5d9cc04d860", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df3aca2af634274b0997068fa81fe5d9cc04d860/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7fde08365c4c3cfc9a9f8a6a02693b789adbe6da", "url": "https://api.github.com/repos/rust-lang/rust/commits/7fde08365c4c3cfc9a9f8a6a02693b789adbe6da", "html_url": "https://github.com/rust-lang/rust/commit/7fde08365c4c3cfc9a9f8a6a02693b789adbe6da"}, {"sha": "4e2797dd76363370eac74cc9480e7d8c0ff17b4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e2797dd76363370eac74cc9480e7d8c0ff17b4b", "html_url": "https://github.com/rust-lang/rust/commit/4e2797dd76363370eac74cc9480e7d8c0ff17b4b"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "fc9b07d29e26695e143aefb1e17aad5ad1891379", "filename": "library/core/src/num/nonzero.rs", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/df3aca2af634274b0997068fa81fe5d9cc04d860/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df3aca2af634274b0997068fa81fe5d9cc04d860/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs?ref=df3aca2af634274b0997068fa81fe5d9cc04d860", "patch": "@@ -1,7 +1,7 @@\n //! Definitions of integer that is known not to equal zero.\n \n use crate::fmt;\n-use crate::ops::{BitOr, BitOrAssign, Div, Rem};\n+use crate::ops::{BitOr, BitOrAssign, Div, Neg, Rem};\n use crate::str::FromStr;\n \n use super::from_str_radix;\n@@ -664,8 +664,7 @@ macro_rules! nonzero_signed_operations {\n                 /// assert_eq!(pos, pos.wrapping_abs());\n                 /// assert_eq!(pos, neg.wrapping_abs());\n                 /// assert_eq!(min, min.wrapping_abs());\n-                /// # // FIXME: add once Neg is implemented?\n-                /// # // assert_eq!(max, (-max).wrapping_abs());\n+                /// assert_eq!(max, (-max).wrapping_abs());\n                 /// # Some(())\n                 /// # }\n                 /// ```\n@@ -868,6 +867,20 @@ macro_rules! nonzero_signed_operations {\n                     unsafe { $Ty::new_unchecked(result) }\n                 }\n             }\n+\n+            #[stable(feature = \"signed_nonzero_neg\", since = \"CURRENT_RUSTC_VERSION\")]\n+            impl Neg for $Ty {\n+                type Output = $Ty;\n+\n+                #[inline]\n+                fn neg(self) -> $Ty {\n+                    // SAFETY: negation of nonzero cannot yield zero values.\n+                    unsafe { $Ty::new_unchecked(self.get().neg()) }\n+                }\n+            }\n+\n+            forward_ref_unop! { impl Neg, neg for $Ty,\n+                #[stable(feature = \"signed_nonzero_neg\", since = \"CURRENT_RUSTC_VERSION\")] }\n         )+\n     }\n }"}, {"sha": "007f8442533081cd615a28362b02c42092a8212e", "filename": "library/core/tests/nonzero.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/df3aca2af634274b0997068fa81fe5d9cc04d860/library%2Fcore%2Ftests%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df3aca2af634274b0997068fa81fe5d9cc04d860/library%2Fcore%2Ftests%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fnonzero.rs?ref=df3aca2af634274b0997068fa81fe5d9cc04d860", "patch": "@@ -336,3 +336,21 @@ fn test_nonzero_uint_rem() {\n     let x: u32 = 42u32 % nz;\n     assert_eq!(x, 2u32);\n }\n+\n+#[test]\n+fn test_signed_nonzero_neg() {\n+    assert_eq!((-NonZeroI8::new(1).unwrap()).get(), -1);\n+    assert_eq!((-NonZeroI8::new(-1).unwrap()).get(), 1);\n+\n+    assert_eq!((-NonZeroI16::new(1).unwrap()).get(), -1);\n+    assert_eq!((-NonZeroI16::new(-1).unwrap()).get(), 1);\n+\n+    assert_eq!((-NonZeroI32::new(1).unwrap()).get(), -1);\n+    assert_eq!((-NonZeroI32::new(-1).unwrap()).get(), 1);\n+\n+    assert_eq!((-NonZeroI64::new(1).unwrap()).get(), -1);\n+    assert_eq!((-NonZeroI64::new(-1).unwrap()).get(), 1);\n+\n+    assert_eq!((-NonZeroI128::new(1).unwrap()).get(), -1);\n+    assert_eq!((-NonZeroI128::new(-1).unwrap()).get(), 1);\n+}"}, {"sha": "565b7e86fc4b954c875905b45b9bf84a3c912a71", "filename": "tests/ui/numbers-arithmetic/overflowing-neg-nonzero.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/df3aca2af634274b0997068fa81fe5d9cc04d860/tests%2Fui%2Fnumbers-arithmetic%2Foverflowing-neg-nonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df3aca2af634274b0997068fa81fe5d9cc04d860/tests%2Fui%2Fnumbers-arithmetic%2Foverflowing-neg-nonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fnumbers-arithmetic%2Foverflowing-neg-nonzero.rs?ref=df3aca2af634274b0997068fa81fe5d9cc04d860", "patch": "@@ -0,0 +1,12 @@\n+// run-fail\n+// error-pattern:thread 'main' panicked at 'attempt to negate with overflow'\n+// ignore-emscripten no processes\n+// compile-flags: -C debug-assertions\n+\n+#![allow(arithmetic_overflow)]\n+\n+use std::num::NonZeroI8;\n+\n+fn main() {\n+    let _x = -NonZeroI8::new(i8::MIN).unwrap();\n+}"}]}