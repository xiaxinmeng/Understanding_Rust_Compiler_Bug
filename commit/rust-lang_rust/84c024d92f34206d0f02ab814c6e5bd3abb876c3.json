{"sha": "84c024d92f34206d0f02ab814c6e5bd3abb876c3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0YzAyNGQ5MmYzNDIwNmQwZjAyYWI4MTRjNmU1YmQzYWJiODc2YzM=", "commit": {"author": {"name": "Markus Westerlind", "email": "markus.westerlind@distilnetworks.com", "date": "2020-02-16T22:23:44Z"}, "committer": {"name": "Markus Westerlind", "email": "markus.westerlind@distilnetworks.com", "date": "2020-02-16T22:23:44Z"}, "message": "Clarify mir block merging", "tree": {"sha": "a578ac5b5bd2ffdccd03a6255f658064136bc5b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a578ac5b5bd2ffdccd03a6255f658064136bc5b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84c024d92f34206d0f02ab814c6e5bd3abb876c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84c024d92f34206d0f02ab814c6e5bd3abb876c3", "html_url": "https://github.com/rust-lang/rust/commit/84c024d92f34206d0f02ab814c6e5bd3abb876c3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84c024d92f34206d0f02ab814c6e5bd3abb876c3/comments", "author": null, "committer": null, "parents": [{"sha": "2440998666cb9fe5f35c1de9ef44849b71870fc3", "url": "https://api.github.com/repos/rust-lang/rust/commits/2440998666cb9fe5f35c1de9ef44849b71870fc3", "html_url": "https://github.com/rust-lang/rust/commit/2440998666cb9fe5f35c1de9ef44849b71870fc3"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "1534b9bdceade94a133857689cdf0cbe709a65ec", "filename": "src/librustc_mir/transform/simplify.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/84c024d92f34206d0f02ab814c6e5bd3abb876c3/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84c024d92f34206d0f02ab814c6e5bd3abb876c3/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fsimplify.rs?ref=84c024d92f34206d0f02ab814c6e5bd3abb876c3", "patch": "@@ -95,6 +95,10 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n \n         let mut start = START_BLOCK;\n \n+        // Vec of the blocks that should be merged. We store the indices here, instead of the\n+        // statements itself to avoid moving the (relatively) large statements twice.\n+        // We do not push the statements directly into the target block (`bb`) as that is slower\n+        // due to additional reallocations\n         let mut merged_blocks = Vec::new();\n         loop {\n             let mut changed = false;\n@@ -116,6 +120,7 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n                 }\n \n                 let mut inner_changed = true;\n+                merged_blocks.clear();\n                 while inner_changed {\n                     inner_changed = false;\n                     inner_changed |= self.simplify_branch(&mut terminator);\n@@ -134,7 +139,6 @@ impl<'a, 'tcx> CfgSimplifier<'a, 'tcx> {\n                     }\n                     self.basic_blocks[bb].statements = statements;\n                 }\n-                merged_blocks.clear();\n \n                 self.basic_blocks[bb].terminator = Some(terminator);\n "}]}