{"sha": "c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1MzNmOTYzZDlmN2Y2YzY2NWM0ZDZlOWM4YzAyYzVhMmQ2MmM5ZTY=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2015-08-06T14:00:41Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "arielb1@mail.tau.ac.il", "date": "2015-08-06T14:31:11Z"}, "message": "handle associated types correctly in null pointer optimization\n\nFixes #27532\n\nThanks @eefriedman for the test.", "tree": {"sha": "8b826415e405e63827a57bf43b2dd2c78e416885", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b826415e405e63827a57bf43b2dd2c78e416885"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "html_url": "https://github.com/rust-lang/rust/commit/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6/comments", "author": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "34942331a3288bbebc5a00fef57b6976afc0eb75", "url": "https://api.github.com/repos/rust-lang/rust/commits/34942331a3288bbebc5a00fef57b6976afc0eb75", "html_url": "https://github.com/rust-lang/rust/commit/34942331a3288bbebc5a00fef57b6976afc0eb75"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "ec6823e7622550cb7378655587d2ae8de08fdbea", "filename": "src/librustc_trans/trans/adt.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6/src%2Flibrustc_trans%2Ftrans%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6/src%2Flibrustc_trans%2Ftrans%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fadt.rs?ref=c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "patch": "@@ -462,8 +462,7 @@ fn find_discr_field_candidate<'tcx>(tcx: &ty::ctxt<'tcx>,\n         // let's recurse and find out\n         ty::TyStruct(def, substs) => {\n             for (j, field) in def.struct_variant().fields.iter().enumerate() {\n-                // TODO(#27532)\n-                let field_ty = field.ty(tcx, substs);\n+                let field_ty = monomorphize::field_ty(tcx, substs, field);\n                 if let Some(mut fpath) = find_discr_field_candidate(tcx, field_ty, path.clone()) {\n                     fpath.push(j);\n                     return Some(fpath);"}, {"sha": "e296aff2782c53a1480e30b6c4ef625d321dc271", "filename": "src/test/run-pass/enum-null-pointer-opt.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6/src%2Ftest%2Frun-pass%2Fenum-null-pointer-opt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6/src%2Ftest%2Frun-pass%2Fenum-null-pointer-opt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fenum-null-pointer-opt.rs?ref=c533f963d9f7f6c665c4d6e9c8c02c5a2d62c9e6", "patch": "@@ -18,6 +18,10 @@ use std::rc::Rc;\n use std::sync::Arc;\n \n trait Trait { fn dummy(&self) { } }\n+trait Mirror { type Image; }\n+impl<T> Mirror for T { type Image = T; }\n+struct ParamTypeStruct<T>(T);\n+struct AssocTypeStruct<T>(<T as Mirror>::Image);\n \n fn main() {\n     // Functions\n@@ -66,4 +70,7 @@ fn main() {\n     // Should apply to types that have NonZero transitively\n     assert_eq!(size_of::<String>(), size_of::<Option<String>>());\n \n+    // Should apply to types where the pointer is substituted\n+    assert_eq!(size_of::<&u8>(), size_of::<Option<ParamTypeStruct<&u8>>>());\n+    assert_eq!(size_of::<&u8>(), size_of::<Option<AssocTypeStruct<&u8>>>());\n }"}]}