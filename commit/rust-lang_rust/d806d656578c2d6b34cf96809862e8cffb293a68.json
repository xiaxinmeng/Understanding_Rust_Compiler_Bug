{"sha": "d806d656578c2d6b34cf96809862e8cffb293a68", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4MDZkNjU2NTc4YzJkNmIzNGNmOTY4MDk4NjJlOGNmZmIyOTNhNjg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-21T15:43:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-21T15:43:09Z"}, "message": "Auto merge of #79115 - cuviper:rust-description, r=Mark-Simulacrum\n\nx.py: allow a custom string appended to the version\n\nThis adds `rust.description` to the config as a descriptive string to be\nappended to `rustc --version` output, which is also used in places like\ndebuginfo `DW_AT_producer`. This may be useful for supplementary build\ninformation, like distro-specific package versions.\n\nFor example, in Fedora 33, `gcc --version` outputs:\n\n    gcc (GCC) 10.2.1 20201016 (Red Hat 10.2.1-6)\n\nWith this change, we can add similar vendor info to `rustc --version`.", "tree": {"sha": "43fdf25af00fa8a4c660bcb79f4bad3b8146e960", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43fdf25af00fa8a4c660bcb79f4bad3b8146e960"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d806d656578c2d6b34cf96809862e8cffb293a68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d806d656578c2d6b34cf96809862e8cffb293a68", "html_url": "https://github.com/rust-lang/rust/commit/d806d656578c2d6b34cf96809862e8cffb293a68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d806d656578c2d6b34cf96809862e8cffb293a68/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "539402cb0b0f1639a4be14e40eaf8db61a62ae41", "url": "https://api.github.com/repos/rust-lang/rust/commits/539402cb0b0f1639a4be14e40eaf8db61a62ae41", "html_url": "https://github.com/rust-lang/rust/commit/539402cb0b0f1639a4be14e40eaf8db61a62ae41"}, {"sha": "5f0856804292a6f4b73cb0f5771877657d8f6af8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f0856804292a6f4b73cb0f5771877657d8f6af8", "html_url": "https://github.com/rust-lang/rust/commit/5f0856804292a6f4b73cb0f5771877657d8f6af8"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "5b045d4e32d8d739ebbab49580d20affbdcd1cda", "filename": "config.toml.example", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d806d656578c2d6b34cf96809862e8cffb293a68/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/d806d656578c2d6b34cf96809862e8cffb293a68/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=d806d656578c2d6b34cf96809862e8cffb293a68", "patch": "@@ -446,6 +446,11 @@ changelog-seen = 2\n # nightly features\n #channel = \"dev\"\n \n+# A descriptive string to be appended to `rustc --version` output, which is\n+# also used in places like debuginfo `DW_AT_producer`. This may be useful for\n+# supplementary build information, like distro-specific package versions.\n+#description = \"\"\n+\n # The root location of the musl installation directory.\n #musl-root = \"...\"\n "}, {"sha": "9fcbe8e1e3564c7a67948d6025b0a927d3531dc3", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=d806d656578c2d6b34cf96809862e8cffb293a68", "patch": "@@ -152,6 +152,7 @@ pub struct Config {\n     // misc\n     pub low_priority: bool,\n     pub channel: String,\n+    pub description: Option<String>,\n     pub verbose_tests: bool,\n     pub save_toolstates: Option<PathBuf>,\n     pub print_step_timings: bool,\n@@ -470,6 +471,7 @@ struct Rust {\n     parallel_compiler: Option<bool>,\n     default_linker: Option<String>,\n     channel: Option<String>,\n+    description: Option<String>,\n     musl_root: Option<String>,\n     rpath: Option<bool>,\n     verbose_tests: Option<bool>,\n@@ -841,6 +843,7 @@ impl Config {\n                 .map(|v| v.parse().expect(\"failed to parse rust.llvm-libunwind\"));\n             set(&mut config.backtrace, rust.backtrace);\n             set(&mut config.channel, rust.channel);\n+            config.description = rust.description;\n             set(&mut config.rust_dist_src, rust.dist_src);\n             set(&mut config.verbose_tests, rust.verbose_tests);\n             // in the case \"false\" is set explicitly, do not overwrite the command line args"}, {"sha": "42f00ce9621743cb3a283355074b07a10b7f4e77", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=d806d656578c2d6b34cf96809862e8cffb293a68", "patch": "@@ -146,6 +146,7 @@ def v(*args):\n v(\"experimental-targets\", \"llvm.experimental-targets\",\n   \"experimental LLVM targets to build\")\n v(\"release-channel\", \"rust.channel\", \"the name of the release channel to build\")\n+v(\"release-description\", \"rust.description\", \"optional descriptive string for version output\")\n \n # Used on systems where \"cc\" is unavailable\n v(\"default-linker\", \"rust.default-linker\", \"the default linker\")"}, {"sha": "06ccd72186dd1edf67f8139cb4883911710a9c65", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d806d656578c2d6b34cf96809862e8cffb293a68/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=d806d656578c2d6b34cf96809862e8cffb293a68", "patch": "@@ -1082,7 +1082,13 @@ impl Build {\n     /// Note that this is a descriptive string which includes the commit date,\n     /// sha, version, etc.\n     fn rust_version(&self) -> String {\n-        self.rust_info.version(self, &self.version)\n+        let mut version = self.rust_info.version(self, &self.version);\n+        if let Some(ref s) = self.config.description {\n+            version.push_str(\" (\");\n+            version.push_str(s);\n+            version.push_str(\")\");\n+        }\n+        version\n     }\n \n     /// Returns the full commit hash."}]}