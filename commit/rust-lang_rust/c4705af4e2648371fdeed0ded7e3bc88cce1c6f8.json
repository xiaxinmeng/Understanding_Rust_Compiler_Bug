{"sha": "c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0NzA1YWY0ZTI2NDgzNzFmZGVlZDBkZWQ3ZTNiYzg4Y2NlMWM2Zjg=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-08-08T12:39:46Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2018-08-08T12:39:46Z"}, "message": "Implement intrinsics {ctlz,cttz}{,_nonzero} and ctpop", "tree": {"sha": "a3f4b2b1a6aeb170abb16a8f64b77650324372d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a3f4b2b1a6aeb170abb16a8f64b77650324372d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "html_url": "https://github.com/rust-lang/rust/commit/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4b6bce39c41add57c56b03ad950cae9ad54b3ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4b6bce39c41add57c56b03ad950cae9ad54b3ad", "html_url": "https://github.com/rust-lang/rust/commit/d4b6bce39c41add57c56b03ad950cae9ad54b3ad"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "05b370f91e08c1edcd929354390767f958328fbb", "filename": "examples/example.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/examples%2Fexample.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/examples%2Fexample.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/examples%2Fexample.rs?ref=c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "patch": "@@ -150,3 +150,7 @@ fn use_array(arr: [u8; 3]) -> u8 {\n fn repeat_array() -> [u8; 3] {\n     [0; 3]\n }\n+\n+unsafe fn use_ctlz_nonzero(a: u16) -> u16 {\n+    intrinsics::ctlz_nonzero(a)\n+}"}, {"sha": "17d321db345daaeb1de3cef386d5934248defb6d", "filename": "examples/mini_core.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/examples%2Fmini_core.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/examples%2Fmini_core.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/examples%2Fmini_core.rs?ref=c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "patch": "@@ -139,6 +139,7 @@ pub mod intrinsics {\n         pub fn copy<T>(src: *const T, dst: *mut T, count: usize);\n         pub fn transmute<T, U>(e: T) -> U;\n         pub fn uninit<T>() -> T;\n+        pub fn ctlz_nonzero<T>(x: T) -> T;\n     }\n }\n "}, {"sha": "0d44952dc0d58086db73bfa56cca47c023a8d704", "filename": "src/abi.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/src%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/src%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fabi.rs?ref=c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "patch": "@@ -500,6 +500,24 @@ pub fn codegen_call<'a, 'tcx: 'a>(\n                     let uninit_val = uninit_place.to_cvalue(fx);\n                     ret.write_cvalue(fx, uninit_val);\n                 }\n+                \"ctlz\" | \"ctlz_nonzero\" => {\n+                    assert_eq!(args.len(), 1);\n+                    let arg = args[0].load_value(fx);\n+                    let res = CValue::ByVal(fx.bcx.ins().clz(arg), args[0].layout());\n+                    ret.write_cvalue(fx, res);\n+                }\n+                \"cttz\" | \"cttz_nonzero\" => {\n+                    assert_eq!(args.len(), 1);\n+                    let arg = args[0].load_value(fx);\n+                    let res = CValue::ByVal(fx.bcx.ins().clz(arg), args[0].layout());\n+                    ret.write_cvalue(fx, res);\n+                }\n+                \"ctpop\" => {\n+                    assert_eq!(args.len(), 1);\n+                    let arg = args[0].load_value(fx);\n+                    let res = CValue::ByVal(fx.bcx.ins().popcnt(arg), args[0].layout());\n+                    ret.write_cvalue(fx, res);\n+                }\n                 _ => fx\n                     .tcx\n                     .sess"}, {"sha": "31be6e58f4207c516129a7b66c475693ae39c24f", "filename": "src/base.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4705af4e2648371fdeed0ded7e3bc88cce1c6f8/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=c4705af4e2648371fdeed0ded7e3bc88cce1c6f8", "patch": "@@ -359,7 +359,8 @@ fn trans_stmt<'a, 'tcx: 'a>(\n                         UnOp::Not => fx.bcx.ins().bnot(val),\n                         UnOp::Neg => match ty.sty {\n                             TypeVariants::TyInt(_) => {\n-                                let zero = fx.bcx.ins().iconst(types::I64, 0);\n+                                let clif_ty = fx.cton_type(ty).unwrap();\n+                                let zero = fx.bcx.ins().iconst(clif_ty, 0);\n                                 fx.bcx.ins().isub(zero, val)\n                             }\n                             TypeVariants::TyFloat(_) => fx.bcx.ins().fneg(val),"}]}