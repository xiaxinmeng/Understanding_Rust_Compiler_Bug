{"sha": "fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8", "node_id": "C_kwDOAAsO6NoAKGZmZmI3ZjI5NWFkZWE5N2E2MmI3YzNjMmViOTllMGVhNWVkMTQ5Yjg", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-09-17T03:37:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-17T03:37:14Z"}, "message": "Rollup merge of #101340 - andrewpollack:fuchsia-zxdb-docs, r=tmandry\n\nAdding Fuchsia zxdb debugging walkthrough to docs\n\nAdding `zxdb` docs to walkthrough to show debugging steps", "tree": {"sha": "6ccc45d4cb5770d9da211e4994b7ee51f5ab445f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ccc45d4cb5770d9da211e4994b7ee51f5ab445f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjJUDqCRBK7hj4Ov3rIwAAxV4IAImdUBfb9dkpTDnOjwbw6293\nhVtq8W86+SSPRUJxc77inb6tAw9tfeWiBZqoZE6/3fmPd225XAqPIyD5DOQyFH6l\nxdMsABPpF/AlSZwd+DOX4xntwXskEvOgGaz3s5TJR5NiLgNL0it5frPEkUePfA37\noeltvBOrdnGLY0RyRQzvWBW0plSjujKrUqiPrO4OS1QNYX1UcjGWcFxaaG7QHirG\ndG+7Bbnyj44vPigYXKZO/oZoOZY/gyUa2YjWJPqTKMSgYaZshyoPhWg7TP3PjxTG\nWPP5H4iQK7zwY91KqH6bLNh4UCRbRdyvkl8X+i5kQS2uxkfmCbDyeVF2gxlJ/S8=\n=f+3X\n-----END PGP SIGNATURE-----\n", "payload": "tree 6ccc45d4cb5770d9da211e4994b7ee51f5ab445f\nparent 95a992a68694d8bf3959bd2c0ac27ce9e9208b59\nparent 2b8886fb5d757fe71265a6d89e5f6a6786a04ec5\nauthor Michael Howell <michael@notriddle.com> 1663385834 -0700\ncommitter GitHub <noreply@github.com> 1663385834 -0700\n\nRollup merge of #101340 - andrewpollack:fuchsia-zxdb-docs, r=tmandry\n\nAdding Fuchsia zxdb debugging walkthrough to docs\n\nAdding `zxdb` docs to walkthrough to show debugging steps\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8", "html_url": "https://github.com/rust-lang/rust/commit/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95a992a68694d8bf3959bd2c0ac27ce9e9208b59", "url": "https://api.github.com/repos/rust-lang/rust/commits/95a992a68694d8bf3959bd2c0ac27ce9e9208b59", "html_url": "https://github.com/rust-lang/rust/commit/95a992a68694d8bf3959bd2c0ac27ce9e9208b59"}, {"sha": "2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5", "html_url": "https://github.com/rust-lang/rust/commit/2b8886fb5d757fe71265a6d89e5f6a6786a04ec5"}], "stats": {"total": 137, "additions": 135, "deletions": 2}, "files": [{"sha": "1ff6003c121cd51f2b2079e2f106796a9f7297c1", "filename": "src/doc/rustc/src/platform-support/fuchsia.md", "status": "modified", "additions": 135, "deletions": 2, "changes": 137, "blob_url": "https://github.com/rust-lang/rust/blob/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md", "raw_url": "https://github.com/rust-lang/rust/raw/fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Ffuchsia.md?ref=fffb7f295adea97a62b7c3c2eb99e0ea5ed149b8", "patch": "@@ -42,6 +42,11 @@ authoritative if this occurs. Instead of pinging individual members, use\n 1. [Testing](#testing)\n     1. [Running unit tests](#running-unit-tests)\n     1. [Running the compiler test suite](#running-the-compiler-test-suite)\n+1. [Debugging](#debugging)\n+    1. [`zxdb`](#zxdb)\n+    1. [Attaching `zxdb`](#attaching-zxdb)\n+    1. [Using `zxdb`](#using-zxdb)\n+    1. [Displaying source code in `zxdb`](#displaying-source-code-in-zxdb)\n \n ## Requirements\n \n@@ -136,7 +141,7 @@ These options configure the following:\n \n * `-Lnative=${SDK_PATH}/arch/${ARCH}/lib`: Link against Fuchsia libraries from\n   the SDK\n-* `-Lnative=${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia kernel\n+* `-Lnative=${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia sysroot\n   libraries from the SDK\n \n In total, our new project will look like:\n@@ -253,7 +258,7 @@ the following options:\n   platform of your choice\n * `-Lnative ${SDK_PATH}/arch/${ARCH}/lib`: Link against Fuchsia libraries from\n   the SDK\n-* `-Lnative ${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia kernel\n+* `-Lnative ${SDK_PATH}/arch/${ARCH}/sysroot/lib`: Link against Fuchsia sysroot\n   libraries from the SDK\n \n Putting it all together:\n@@ -639,6 +644,130 @@ available on the [Fuchsia devsite].\n Running the Rust test suite on Fuchsia is [not currently supported], but work is\n underway to enable it.\n \n+## Debugging\n+\n+### `zxdb`\n+\n+Debugging components running on a Fuchsia emulator can be done using the\n+console-mode debugger: [zxdb]. We will demonstrate attaching necessary symbol\n+paths to debug our `hello-fuchsia` component.\n+\n+### Attaching `zxdb`\n+\n+In a separate terminal, issue the following command from our `hello_fuchsia`\n+directory to launch `zxdb`:\n+\n+**In separate terminal**\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx debug connect -- \\\n+    --symbol-path target/x86_64-fuchsia/debug\n+```\n+\n+* `--symbol-path` gets required symbol paths, which are\n+necessary for stepping through your program.\n+\n+The \"[displaying source code in `zxdb`](#displaying-source-code-in-zxdb)\" section describes how you can\n+display Rust and/or Fuchsia source code in your debugging session.\n+\n+### Using `zxdb`\n+\n+Once launched, you will be presented with the window:\n+\n+```sh\n+Connecting (use \"disconnect\" to cancel)...\n+Connected successfully.\n+\ud83d\udc49 To get started, try \"status\" or \"help\".\n+[zxdb]\n+```\n+\n+To attach to our program, we can run:\n+\n+```sh\n+[zxdb] attach hello_fuchsia\n+```\n+\n+**Expected output**\n+```sh\n+Waiting for process matching \"hello_fuchsia\".\n+Type \"filter\" to see the current filters.\n+```\n+\n+Next, we can create a breakpoint at main using \"b main\":\n+\n+```sh\n+[zxdb] b main\n+```\n+\n+**Expected output**\n+```sh\n+Created Breakpoint 1 @ main\n+```\n+\n+Finally, we can re-run the \"hello_fuchsia\" component from our original\n+terminal:\n+\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx component run \\\n+    --recreate \\\n+    fuchsia-pkg://hello-fuchsia/hello_fuchsia_manifest#meta/hello_fuchsia.cm\n+```\n+\n+Once our component is running, our `zxdb` window will stop execution\n+in our main as desired:\n+\n+**Expected output**\n+```txt\n+Breakpoint 1 now matching 1 addrs for main\n+\ud83d\uded1 on bp 1 hello_fuchsia::main() \u2022 main.rs:2\n+   1 fn main() {\n+ \u25b6 2     println!(\"Hello Fuchsia!\");\n+   3 }\n+   4\n+[zxdb]\n+```\n+\n+`zxdb` has similar commands to other debuggers like [gdb].\n+To list the available commands, run \"help\" in the\n+`zxdb` window or visit [the zxdb documentation].\n+\n+```sh\n+[zxdb] help\n+```\n+\n+**Expected output**\n+```sh\n+Help!\n+\n+  Type \"help <command>\" for command-specific help.\n+\n+Other help topics (see \"help <topic>\")\n+...\n+```\n+\n+### Displaying source code in `zxdb`\n+\n+By default, the debugger will not be able to display\n+source code while debugging. For our user code, we displayed\n+source code by pointing our debugger to our debug binary via\n+the `--symbol-path` arg. To display library source code in\n+the debugger, you must provide paths to the source using\n+`--build-dir`. For example, to display the Rust and Fuchsia\n+source code:\n+\n+```sh\n+${SDK_PATH}/tools/${ARCH}/ffx debug connect -- \\\n+    --symbol-path target/x86_64-fuchsia/debug \\\n+    --build-dir ${RUST_SRC_PATH}/rust \\\n+    --build-dir ${FUCHSIA_SRC_PATH}/fuchsia/out/default\n+```\n+\n+ * `--build-dir` links against source code paths, which\n+ are not strictly necessary for debugging, but is a nice-to-have\n+ for displaying source code in `zxdb`.\n+\n+ Linking to a Fuchsia checkout can help with debugging Fuchsia libraries,\n+ such as [fdio].\n+\n [Fuchsia team]: https://team-api.infra.rust-lang.org/v1/teams/fuchsia.json\n [Fuchsia]: https://fuchsia.dev/\n [source tree]: https://fuchsia.dev/fuchsia-src/get-started/learn/build\n@@ -649,3 +778,7 @@ underway to enable it.\n [reference for the file format]: https://fuchsia.dev/reference/cml\n [Fuchsia devsite]: https://fuchsia.dev/reference/cml\n [not currently supported]: https://fxbug.dev/105393\n+[zxdb]: https://fuchsia.dev/fuchsia-src/development/debugger\n+[gdb]: https://www.sourceware.org/gdb/\n+[the zxdb documentation]: https://fuchsia.dev/fuchsia-src/development/debugger\n+[fdio]: https://cs.opensource.google/fuchsia/fuchsia/+/main:sdk/lib/fdio/"}]}