{"sha": "39db9cdb7dc7310b6488c0c904ecae71765649cd", "node_id": "C_kwDOAAsO6NoAKDM5ZGI5Y2RiN2RjNzMxMGI2NDg4YzBjOTA0ZWNhZTcxNzY1NjQ5Y2Q", "commit": {"author": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-21T19:35:15Z"}, "committer": {"name": "Amos Wenger", "email": "amoswenger@gmail.com", "date": "2022-07-21T19:35:15Z"}, "message": "Use std::panic::resume_unwind", "tree": {"sha": "94d205bdec78c7add0ecccc786e9645a9e43918e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94d205bdec78c7add0ecccc786e9645a9e43918e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39db9cdb7dc7310b6488c0c904ecae71765649cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39db9cdb7dc7310b6488c0c904ecae71765649cd", "html_url": "https://github.com/rust-lang/rust/commit/39db9cdb7dc7310b6488c0c904ecae71765649cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39db9cdb7dc7310b6488c0c904ecae71765649cd/comments", "author": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fasterthanlime", "id": 7998310, "node_id": "MDQ6VXNlcjc5OTgzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7998310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasterthanlime", "html_url": "https://github.com/fasterthanlime", "followers_url": "https://api.github.com/users/fasterthanlime/followers", "following_url": "https://api.github.com/users/fasterthanlime/following{/other_user}", "gists_url": "https://api.github.com/users/fasterthanlime/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasterthanlime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasterthanlime/subscriptions", "organizations_url": "https://api.github.com/users/fasterthanlime/orgs", "repos_url": "https://api.github.com/users/fasterthanlime/repos", "events_url": "https://api.github.com/users/fasterthanlime/events{/privacy}", "received_events_url": "https://api.github.com/users/fasterthanlime/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48bcc229bf80bfc7e3db2d4728fd83381d9e2ce6", "url": "https://api.github.com/repos/rust-lang/rust/commits/48bcc229bf80bfc7e3db2d4728fd83381d9e2ce6", "html_url": "https://github.com/rust-lang/rust/commit/48bcc229bf80bfc7e3db2d4728fd83381d9e2ce6"}], "stats": {"total": 26, "additions": 17, "deletions": 9}, "files": [{"sha": "5b96b5c69296b0840b67972c5274b94ada4f82e4", "filename": "crates/proc-macro-srv/src/lib.rs", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/39db9cdb7dc7310b6488c0c904ecae71765649cd/crates%2Fproc-macro-srv%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39db9cdb7dc7310b6488c0c904ecae71765649cd/crates%2Fproc-macro-srv%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc-macro-srv%2Fsrc%2Flib.rs?ref=39db9cdb7dc7310b6488c0c904ecae71765649cd", "patch": "@@ -64,15 +64,23 @@ impl ProcMacroSrv {\n         let macro_body = task.macro_body.to_subtree();\n         let attributes = task.attributes.map(|it| it.to_subtree());\n         let result = crossbeam::scope(|s| {\n-            s.spawn(|_| {\n-                expander\n-                    .expand(&task.macro_name, &macro_body, attributes.as_ref())\n-                    .map(|it| FlatTree::new(&it))\n-            })\n-            .join()\n-            .unwrap()\n-        })\n-        .unwrap();\n+            let res = s\n+                .spawn(|_| {\n+                    expander\n+                        .expand(&task.macro_name, &macro_body, attributes.as_ref())\n+                        .map(|it| FlatTree::new(&it))\n+                })\n+                .join();\n+\n+            match res {\n+                Ok(res) => res,\n+                Err(e) => std::panic::resume_unwind(e),\n+            }\n+        });\n+        let result = match result {\n+            Ok(result) => result,\n+            Err(e) => std::panic::resume_unwind(e),\n+        };\n \n         prev_env.rollback();\n "}]}