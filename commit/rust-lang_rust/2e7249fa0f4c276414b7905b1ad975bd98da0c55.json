{"sha": "2e7249fa0f4c276414b7905b1ad975bd98da0c55", "node_id": "C_kwDOAAsO6NoAKDJlNzI0OWZhMGY0YzI3NjQxNGI3OTA1YjFhZDk3NWJkOThkYTBjNTU", "commit": {"author": {"name": "ozkanonur", "email": "work@onurozkan.dev", "date": "2023-03-10T16:47:09Z"}, "committer": {"name": "ozkanonur", "email": "work@onurozkan.dev", "date": "2023-03-15T10:20:02Z"}, "message": "add `enable-warnings` flag for llvm\n\nSigned-off-by: ozkanonur <work@onurozkan.dev>", "tree": {"sha": "60392dcccf92d5cbc6bca47cb4d03a2d94b21910", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/60392dcccf92d5cbc6bca47cb4d03a2d94b21910"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e7249fa0f4c276414b7905b1ad975bd98da0c55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7249fa0f4c276414b7905b1ad975bd98da0c55", "html_url": "https://github.com/rust-lang/rust/commit/2e7249fa0f4c276414b7905b1ad975bd98da0c55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e7249fa0f4c276414b7905b1ad975bd98da0c55/comments", "author": {"login": "ozkanonur", "id": 39852038, "node_id": "MDQ6VXNlcjM5ODUyMDM4", "avatar_url": "https://avatars.githubusercontent.com/u/39852038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ozkanonur", "html_url": "https://github.com/ozkanonur", "followers_url": "https://api.github.com/users/ozkanonur/followers", "following_url": "https://api.github.com/users/ozkanonur/following{/other_user}", "gists_url": "https://api.github.com/users/ozkanonur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ozkanonur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ozkanonur/subscriptions", "organizations_url": "https://api.github.com/users/ozkanonur/orgs", "repos_url": "https://api.github.com/users/ozkanonur/repos", "events_url": "https://api.github.com/users/ozkanonur/events{/privacy}", "received_events_url": "https://api.github.com/users/ozkanonur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ozkanonur", "id": 39852038, "node_id": "MDQ6VXNlcjM5ODUyMDM4", "avatar_url": "https://avatars.githubusercontent.com/u/39852038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ozkanonur", "html_url": "https://github.com/ozkanonur", "followers_url": "https://api.github.com/users/ozkanonur/followers", "following_url": "https://api.github.com/users/ozkanonur/following{/other_user}", "gists_url": "https://api.github.com/users/ozkanonur/gists{/gist_id}", "starred_url": "https://api.github.com/users/ozkanonur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ozkanonur/subscriptions", "organizations_url": "https://api.github.com/users/ozkanonur/orgs", "repos_url": "https://api.github.com/users/ozkanonur/repos", "events_url": "https://api.github.com/users/ozkanonur/events{/privacy}", "received_events_url": "https://api.github.com/users/ozkanonur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0058748944abb3282aba0e0a74823c6411703565", "url": "https://api.github.com/repos/rust-lang/rust/commits/0058748944abb3282aba0e0a74823c6411703565", "html_url": "https://github.com/rust-lang/rust/commit/0058748944abb3282aba0e0a74823c6411703565"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "7ae46203f972a8619ce8c93549fff6b591666e65", "filename": "config.example.toml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2e7249fa0f4c276414b7905b1ad975bd98da0c55/config.example.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2e7249fa0f4c276414b7905b1ad975bd98da0c55/config.example.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.example.toml?ref=2e7249fa0f4c276414b7905b1ad975bd98da0c55", "patch": "@@ -146,6 +146,9 @@ changelog-seen = 2\n # Whether to build the clang compiler.\n #clang = false\n \n+# Whether to enable llvm compilation warnings.\n+#enable-warnings = false\n+\n # Custom CMake defines to set when building LLVM.\n #build-config = {}\n "}, {"sha": "654e03d0c3c7f5d222b700f105dc997f0d61f8e0", "filename": "src/bootstrap/CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCHANGELOG.md?ref=2e7249fa0f4c276414b7905b1ad975bd98da0c55", "patch": "@@ -25,6 +25,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - If you have Rust already installed, `x.py` will now infer the host target\n   from the default rust toolchain. [#78513](https://github.com/rust-lang/rust/pull/78513)\n - Add options for enabling overflow checks, one for std (`overflow-checks-std`) and one for everything else (`overflow-checks`). Both default to false.\n+- Add llvm option `enable-warnings` to have control on llvm compilation warnings. Default to false.\n \n \n ## [Version 2] - 2020-09-25"}, {"sha": "58729f396f0b65a09519b3bd098e73c3098aa867", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=2e7249fa0f4c276414b7905b1ad975bd98da0c55", "patch": "@@ -133,6 +133,7 @@ pub struct Config {\n     pub llvm_allow_old_toolchain: bool,\n     pub llvm_polly: bool,\n     pub llvm_clang: bool,\n+    pub llvm_enable_warnings: bool,\n     pub llvm_from_ci: bool,\n     pub llvm_build_config: HashMap<String, String>,\n \n@@ -688,6 +689,7 @@ define_config! {\n         allow_old_toolchain: Option<bool> = \"allow-old-toolchain\",\n         polly: Option<bool> = \"polly\",\n         clang: Option<bool> = \"clang\",\n+        enable_warnings: Option<bool> = \"enable-warnings\",\n         download_ci_llvm: Option<StringOrBool> = \"download-ci-llvm\",\n         build_config: Option<HashMap<String, String>> = \"build-config\",\n     }\n@@ -1184,6 +1186,7 @@ impl Config {\n             config.llvm_allow_old_toolchain = llvm.allow_old_toolchain.unwrap_or(false);\n             config.llvm_polly = llvm.polly.unwrap_or(false);\n             config.llvm_clang = llvm.clang.unwrap_or(false);\n+            config.llvm_enable_warnings = llvm.enable_warnings.unwrap_or(false);\n             config.llvm_build_config = llvm.build_config.clone().unwrap_or(Default::default());\n \n             let asserts = llvm_assertions.unwrap_or(false);"}, {"sha": "20b2699c761bf8c6ad89b0a6147154dadebc2221", "filename": "src/bootstrap/defaults/config.codegen.toml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fdefaults%2Fconfig.codegen.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fdefaults%2Fconfig.codegen.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdefaults%2Fconfig.codegen.toml?ref=2e7249fa0f4c276414b7905b1ad975bd98da0c55", "patch": "@@ -7,6 +7,8 @@ compiler-docs = true\n # This enables debug-assertions in LLVM,\n # catching logic errors in codegen much earlier in the process.\n assertions = true\n+# enable warnings during the llvm compilation\n+enable-warnings = true\n \n [rust]\n # This enables `RUSTC_LOG=debug`, avoiding confusing situations"}, {"sha": "41ee509655326a02b7f54a764dcbdc4cd74b73a1", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7249fa0f4c276414b7905b1ad975bd98da0c55/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=2e7249fa0f4c276414b7905b1ad975bd98da0c55", "patch": "@@ -304,6 +304,7 @@ impl Step for Llvm {\n         let assertions = if builder.config.llvm_assertions { \"ON\" } else { \"OFF\" };\n         let plugins = if builder.config.llvm_plugins { \"ON\" } else { \"OFF\" };\n         let enable_tests = if builder.config.llvm_tests { \"ON\" } else { \"OFF\" };\n+        let enable_warnings = if builder.config.llvm_enable_warnings { \"ON\" } else { \"OFF\" };\n \n         cfg.out_dir(&out_dir)\n             .profile(profile)\n@@ -321,7 +322,8 @@ impl Step for Llvm {\n             .define(\"LLVM_ENABLE_Z3_SOLVER\", \"OFF\")\n             .define(\"LLVM_PARALLEL_COMPILE_JOBS\", builder.jobs().to_string())\n             .define(\"LLVM_TARGET_ARCH\", target_native.split('-').next().unwrap())\n-            .define(\"LLVM_DEFAULT_TARGET_TRIPLE\", target_native);\n+            .define(\"LLVM_DEFAULT_TARGET_TRIPLE\", target_native)\n+            .define(\"LLVM_ENABLE_WARNINGS\", enable_warnings);\n \n         // Parts of our test suite rely on the `FileCheck` tool, which is built by default in\n         // `build/$TARGET/llvm/build/bin` is but *not* then installed to `build/$TARGET/llvm/bin`.\n@@ -483,11 +485,6 @@ impl Step for Llvm {\n             cfg.define(key, val);\n         }\n \n-        // FIXME: we don't actually need to build all LLVM tools and all LLVM\n-        //        libraries here, e.g., we just want a few components and a few\n-        //        tools. Figure out how to filter them down and only build the right\n-        //        tools and libs on all platforms.\n-\n         if builder.config.dry_run() {\n             return res;\n         }"}]}