{"sha": "151180057b0304ee4dee75401e8f1aaa7aaaec21", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1MTE4MDA1N2IwMzA0ZWU0ZGVlNzU0MDFlOGYxYWFhN2FhYWVjMjE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-24T12:20:59Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-11-24T12:20:59Z"}, "message": "Simplify", "tree": {"sha": "f61f810aa5f0c9cda0f07bd15d8f03b2d3b5ee83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f61f810aa5f0c9cda0f07bd15d8f03b2d3b5ee83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/151180057b0304ee4dee75401e8f1aaa7aaaec21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/151180057b0304ee4dee75401e8f1aaa7aaaec21", "html_url": "https://github.com/rust-lang/rust/commit/151180057b0304ee4dee75401e8f1aaa7aaaec21", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/151180057b0304ee4dee75401e8f1aaa7aaaec21/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0b06cb672b7aae770fea24e4a5efdbec8cbf5c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0b06cb672b7aae770fea24e4a5efdbec8cbf5c6", "html_url": "https://github.com/rust-lang/rust/commit/e0b06cb672b7aae770fea24e4a5efdbec8cbf5c6"}], "stats": {"total": 19, "additions": 3, "deletions": 16}, "files": [{"sha": "f506bba705ffea3b3cc4fcd9593d1b7e5903323a", "filename": "crates/ra_hir/src/from_source.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/151180057b0304ee4dee75401e8f1aaa7aaaec21/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs", "raw_url": "https://github.com/rust-lang/rust/raw/151180057b0304ee4dee75401e8f1aaa7aaaec21/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Ffrom_source.rs?ref=151180057b0304ee4dee75401e8f1aaa7aaaec21", "patch": "@@ -282,7 +282,9 @@ where\n     let module_src = ModuleSource::from_child_node(db, src.as_ref().map(|it| it.syntax()));\n     let module = Module::from_definition(db, Source::new(src.file_id, module_src))?;\n     let ctx = LocationCtx::new(db, module.id, src.file_id);\n-    Some(DEF::from_ast(ctx, &src.value))\n+    let items = db.ast_id_map(src.file_id);\n+    let item_id = items.ast_id(&src.value);\n+    Some(DEF::from_ast_id(ctx, item_id))\n }\n \n enum Container {"}, {"sha": "f60feb5fa9feaa73c537185714aa267fb6e4338f", "filename": "crates/ra_hir_def/src/lib.rs", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/151180057b0304ee4dee75401e8f1aaa7aaaec21/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/151180057b0304ee4dee75401e8f1aaa7aaaec21/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Flib.rs?ref=151180057b0304ee4dee75401e8f1aaa7aaaec21", "patch": "@@ -94,25 +94,10 @@ impl<'a, DB> LocationCtx<&'a DB> {\n     }\n }\n \n-impl<'a, DB: AstDatabase + InternDatabase> LocationCtx<&'a DB> {\n-    pub fn to_def<N, DEF>(self, ast: &N) -> DEF\n-    where\n-        N: AstNode,\n-        DEF: AstItemDef<N>,\n-    {\n-        DEF::from_ast(self, ast)\n-    }\n-}\n-\n pub trait AstItemDef<N: AstNode>: salsa::InternKey + Clone {\n     fn intern(db: &impl InternDatabase, loc: ItemLoc<N>) -> Self;\n     fn lookup_intern(self, db: &impl InternDatabase) -> ItemLoc<N>;\n \n-    fn from_ast(ctx: LocationCtx<&(impl AstDatabase + InternDatabase)>, ast: &N) -> Self {\n-        let items = ctx.db.ast_id_map(ctx.file_id);\n-        let item_id = items.ast_id(ast);\n-        Self::from_ast_id(ctx, item_id)\n-    }\n     fn from_ast_id(ctx: LocationCtx<&impl InternDatabase>, ast_id: FileAstId<N>) -> Self {\n         let loc = ItemLoc { module: ctx.module, ast_id: AstId::new(ctx.file_id, ast_id) };\n         Self::intern(ctx.db, loc)"}]}