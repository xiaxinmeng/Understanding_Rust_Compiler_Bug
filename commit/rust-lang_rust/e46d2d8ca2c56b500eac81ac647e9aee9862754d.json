{"sha": "e46d2d8ca2c56b500eac81ac647e9aee9862754d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0NmQyZDhjYTJjNTZiNTAwZWFjODFhYzY0N2U5YWVlOTg2Mjc1NGQ=", "commit": {"author": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-31T06:31:08Z"}, "committer": {"name": "Wang Xuerui", "email": "git@xen0n.name", "date": "2016-12-31T15:07:55Z"}, "message": "rustbuild: fix save-analysis not being saved for 2-stage builds", "tree": {"sha": "1d805d6a35ae6142299d29d5ab782a4694da80d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d805d6a35ae6142299d29d5ab782a4694da80d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e46d2d8ca2c56b500eac81ac647e9aee9862754d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYZ8nOAAoJEDhUS04t5/q5XH0P/Rm3/YQTCCenbRPO2fRCa3wk\nQJSDAPzYC+zg/t1SEW+/CLWWxxweWqyBAuRIz6a/MRLnETU6HxZ+65K3ggyA5iHt\n24IDkXsd1g8ShhQqNIzCe+8afEJgAP+UVVUcihrmClV6+kKnz4Jc+fdXEAsnted5\nOl/GkBEg4XQExyyWWYvwPb3eHlfPiGBB+WqLlEfdRcBDm6Ziu/mml8mWqd2yTLs1\nchycv2E6EFSUo4RPFJyRcDUMhDfjJfwLEilsl5zcwXBO5p2+qChjO1eHwYPCDEFQ\noX2KEouN+DKWFbMwslWCqx6BywhxkrICYMVuPIM+TclUP+Q3MeoJrqu/7QVPjMBn\nvbjNkN6fC2/1+rCmsEFcZSk6ai5IHFrF3EGMVC3V18wa2in5AUU87jzg/5k7BU9E\np2sfJarR2gofe2dJgljigKY1PQr3srfzQauHMdtlzwOMwMzc/5/2WMI22UAJylt5\n3LVkEMvSQPyn21bpHRGXqHfg5PwcTHIEl8QLW0UDVpOWGS6J5MqqaTgYfXHxJGXK\nqBTsPetOztaTeiMFFHaNVB8sU6iX7voPS8N0EyCa+SKK9gThAsBX6ANkNbu8Uyfr\nZNo9bvqzGADjrAPC6Ldo4UHCcqXcR6Pv0E/2LL4RMGUa7tLS0UI9H5FJ9ZPzWZXY\nQC9RvBQfHgD011GMJcPM\n=3WUR\n-----END PGP SIGNATURE-----", "payload": "tree 1d805d6a35ae6142299d29d5ab782a4694da80d9\nparent 8d5b91a19f0992445a6b19f7c774cdeb54b7632a\nauthor Wang Xuerui <git@xen0n.name> 1483165868 +0800\ncommitter Wang Xuerui <git@xen0n.name> 1483196875 +0800\n\nrustbuild: fix save-analysis not being saved for 2-stage builds\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e46d2d8ca2c56b500eac81ac647e9aee9862754d", "html_url": "https://github.com/rust-lang/rust/commit/e46d2d8ca2c56b500eac81ac647e9aee9862754d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e46d2d8ca2c56b500eac81ac647e9aee9862754d/comments", "author": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d5b91a19f0992445a6b19f7c774cdeb54b7632a", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d5b91a19f0992445a6b19f7c774cdeb54b7632a", "html_url": "https://github.com/rust-lang/rust/commit/8d5b91a19f0992445a6b19f7c774cdeb54b7632a"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "bef852493e3de231ba86536192bd1f68f0e5bc60", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e46d2d8ca2c56b500eac81ac647e9aee9862754d/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e46d2d8ca2c56b500eac81ac647e9aee9862754d/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=e46d2d8ca2c56b500eac81ac647e9aee9862754d", "patch": "@@ -521,7 +521,7 @@ impl Build {\n                  .env(format!(\"CFLAGS_{}\", target), self.cflags(target).join(\" \"));\n         }\n \n-        if self.config.channel == \"nightly\" && compiler.stage == 2 {\n+        if self.config.channel == \"nightly\" && compiler.is_final_stage(self) {\n             cargo.env(\"RUSTC_SAVE_ANALYSIS\", \"api\".to_string());\n         }\n \n@@ -915,9 +915,10 @@ impl<'a> Compiler<'a> {\n         self.stage == 0 && self.host == build.config.build\n     }\n \n-    /// Returns if this compiler is to be treated as a final stage one, whether\n-    /// we're performing a full bootstrap or not. Don't do that by comparing\n-    /// stages with `2`!\n+    /// Returns if this compiler should be treated as a final stage one in the\n+    /// current build session.\n+    /// This takes into account whether we're performing a full bootstrap or\n+    /// not; don't directly compare the stage with `2`!\n     fn is_final_stage(&self, build: &Build) -> bool {\n         let final_stage = if build.config.full_bootstrap { 2 } else { 1 };\n         self.stage >= final_stage"}]}