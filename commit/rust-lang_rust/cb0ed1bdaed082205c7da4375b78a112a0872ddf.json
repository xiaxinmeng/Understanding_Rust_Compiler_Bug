{"sha": "cb0ed1bdaed082205c7da4375b78a112a0872ddf", "node_id": "C_kwDOAAsO6NoAKGNiMGVkMWJkYWVkMDgyMjA1YzdkYTQzNzViNzhhMTEyYTA4NzJkZGY", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-07-24T18:06:54Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-07-24T18:11:39Z"}, "message": "Add regression test minimized from async-std write", "tree": {"sha": "870d9f2eca744b6fb49201bd4015188f0ac7a570", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/870d9f2eca744b6fb49201bd4015188f0ac7a570"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb0ed1bdaed082205c7da4375b78a112a0872ddf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmLdi1sACgkQ+boUO5X/\nbYJqdw/9Gmu/u4XJpUgTUe7RQP01cJOdIeHg3UPRlZR+fuRwBXUpRLJHXatG49si\naSU/BLfVAyb6vyvkkQ4k5ENNmbPM3V303kSmWhLdobOeasGngaUUoHGan4JzgJye\nUGAH43ZRiPv40tKYT3gHvTunYtvDr4JC8Q+dvAlqz5sDzjm+kBJRVJxkyv/IkgG/\nMFbofdBqvgRUoOpHM0vyI/7MCSHZx4eywjbqQXbxpQX+jCAA6lwjFyTRHCTREDSo\npYBnraRoowrOcCbapTtTmE23wgGaVa2DqMQNtb7uBVsMaPKs9t4qocKn5b7fxcmS\n6a1ToMFhwPcpgdLUu8tyros9OUzoKsDh6ge376JcDpWVWvxwgAI/Vn9J7mfN0htO\nWrmJ7zTI0omTQPLmPxFYVMjDJW5P/Pg7WQBC5RZdpbos83raKRnIFXjVcDymPi2I\nZpOTburyz6zEqnOM3Gj9xgDqlS16Ll24m3pH60v9Mp70qXzhc419S/N44ZeBV70R\nLTc9CC9r5p/1vOZPvYr3JnxuIzCwvlqAFrMR+rHNtKdlHH4eVx+c3m94Rom1nTWo\nXY71QY4l1rWl5mkIasYZf0+ANFjSe4YL+F9QShdS9P567oaww9d7fzbbVdLNZvn1\n9BIrfVuMYDh+gGMOz/94fqFFKVSyFtqSZZdvfEFMyV1u8vSghXI=\n=YxLs\n-----END PGP SIGNATURE-----", "payload": "tree 870d9f2eca744b6fb49201bd4015188f0ac7a570\nparent c32dcbba187d1ee0dbe92dc152cb9c2f3f42900c\nauthor David Tolnay <dtolnay@gmail.com> 1658686014 -0700\ncommitter David Tolnay <dtolnay@gmail.com> 1658686299 -0700\n\nAdd regression test minimized from async-std write\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb0ed1bdaed082205c7da4375b78a112a0872ddf", "html_url": "https://github.com/rust-lang/rust/commit/cb0ed1bdaed082205c7da4375b78a112a0872ddf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb0ed1bdaed082205c7da4375b78a112a0872ddf/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c32dcbba187d1ee0dbe92dc152cb9c2f3f42900c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c32dcbba187d1ee0dbe92dc152cb9c2f3f42900c", "html_url": "https://github.com/rust-lang/rust/commit/c32dcbba187d1ee0dbe92dc152cb9c2f3f42900c"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "fc2e5e2190f33de5513f58912186448384d277bf", "filename": "src/test/ui/macros/format-args-temporaries-async.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/cb0ed1bdaed082205c7da4375b78a112a0872ddf/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb0ed1bdaed082205c7da4375b78a112a0872ddf/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.rs?ref=cb0ed1bdaed082205c7da4375b78a112a0872ddf", "patch": "@@ -0,0 +1,40 @@\n+// FIXME: check-pass\n+// check-fail\n+// edition:2021\n+\n+use std::fmt::{self, Display};\n+use std::future::Future;\n+use std::io;\n+use std::pin::Pin;\n+use std::task::{Context, Poll};\n+\n+struct AsyncStdout;\n+\n+impl AsyncStdout {\n+    fn write_fmt<'a>(&'a mut self, _args: fmt::Arguments) -> WriteFmtFuture<'a, Self>\n+    where\n+        Self: Unpin,\n+    {\n+        WriteFmtFuture(self)\n+    }\n+}\n+\n+struct WriteFmtFuture<'a, T>(&'a mut T);\n+\n+impl<'a, T> Future for WriteFmtFuture<'a, T> {\n+    type Output = io::Result<()>;\n+    fn poll(self: Pin<&mut Self>, cx: &mut Context) -> Poll<Self::Output> {\n+        unimplemented!()\n+    }\n+}\n+\n+async fn async_main() {\n+    let _write = write!(&mut AsyncStdout, \"...\").await;\n+    //~^ ERROR temporary value dropped while borrowed\n+    let _writeln = writeln!(&mut AsyncStdout, \"...\").await;\n+    //~^ ERROR temporary value dropped while borrowed\n+}\n+\n+fn main() {\n+    let _ = async_main;\n+}"}, {"sha": "73019d7eb6e497ffb8ad84559192bebe32a5d49c", "filename": "src/test/ui/macros/format-args-temporaries-async.stderr", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/cb0ed1bdaed082205c7da4375b78a112a0872ddf/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cb0ed1bdaed082205c7da4375b78a112a0872ddf/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fformat-args-temporaries-async.stderr?ref=cb0ed1bdaed082205c7da4375b78a112a0872ddf", "patch": "@@ -0,0 +1,27 @@\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/format-args-temporaries-async.rs:32:30\n+   |\n+LL |     let _write = write!(&mut AsyncStdout, \"...\").await;\n+   |                  ------------^^^^^^^^^^^--------\n+   |                  |           |\n+   |                  |           creates a temporary which is freed while still in use\n+   |                  temporary value is freed at the end of this statement\n+   |                  borrow later used here\n+   |\n+   = note: consider using a `let` binding to create a longer lived value\n+\n+error[E0716]: temporary value dropped while borrowed\n+  --> $DIR/format-args-temporaries-async.rs:34:34\n+   |\n+LL |     let _writeln = writeln!(&mut AsyncStdout, \"...\").await;\n+   |                    --------------^^^^^^^^^^^--------\n+   |                    |             |\n+   |                    |             creates a temporary which is freed while still in use\n+   |                    temporary value is freed at the end of this statement\n+   |                    borrow later used here\n+   |\n+   = note: consider using a `let` binding to create a longer lived value\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0716`."}]}