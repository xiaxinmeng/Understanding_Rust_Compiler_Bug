{"sha": "2870e701630c198bafb346e5a9c91c1d2fc9f092", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4NzBlNzAxNjMwYzE5OGJhZmIzNDZlNWE5YzkxYzFkMmZjOWYwOTI=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-01-26T13:18:01Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-01-26T13:45:54Z"}, "message": "Add config option to ignore directories", "tree": {"sha": "cf85185c893a344bbfe29e48fcf856b630a06ec5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf85185c893a344bbfe29e48fcf856b630a06ec5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2870e701630c198bafb346e5a9c91c1d2fc9f092", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2870e701630c198bafb346e5a9c91c1d2fc9f092", "html_url": "https://github.com/rust-lang/rust/commit/2870e701630c198bafb346e5a9c91c1d2fc9f092", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2870e701630c198bafb346e5a9c91c1d2fc9f092/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a733f65126451784c8b158d6c6318b556d68ebfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/a733f65126451784c8b158d6c6318b556d68ebfc", "html_url": "https://github.com/rust-lang/rust/commit/a733f65126451784c8b158d6c6318b556d68ebfc"}], "stats": {"total": 38, "additions": 32, "deletions": 6}, "files": [{"sha": "dbab4f5f46388d4cf00a37ff04748a12654e5378", "filename": "crates/rust-analyzer/src/cli/load_cargo.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fload_cargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fload_cargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fload_cargo.rs?ref=2870e701630c198bafb346e5a9c91c1d2fc9f092", "patch": "@@ -46,7 +46,7 @@ pub fn load_cargo(\n         vfs.file_id(&path)\n     });\n \n-    let project_folders = ProjectFolders::new(&[ws]);\n+    let project_folders = ProjectFolders::new(&[ws], &[]);\n     loader.set_config(vfs::loader::Config { load: project_folders.load, watch: vec![] });\n \n     log::debug!(\"crate graph: {:?}\", crate_graph);"}, {"sha": "37487b6ac37aa10d336b5f94024454f68c164264", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=2870e701630c198bafb346e5a9c91c1d2fc9f092", "patch": "@@ -105,6 +105,8 @@ config_data! {\n \n         /// Controls file watching implementation.\n         files_watcher: String = \"\\\"client\\\"\",\n+        /// These directories will be ignored by rust-analyzer.\n+        files_excludeDirs: Vec<PathBuf> = \"[]\",\n \n         /// Whether to show `Debug` action. Only applies when\n         /// `#rust-analyzer.hoverActions.enable#` is set.\n@@ -248,7 +250,7 @@ impl LensConfig {\n #[derive(Debug, Clone)]\n pub struct FilesConfig {\n     pub watcher: FilesWatcher,\n-    pub exclude: Vec<String>,\n+    pub exclude: Vec<AbsPathBuf>,\n }\n \n #[derive(Debug, Clone)]\n@@ -458,7 +460,7 @@ impl Config {\n                 \"notify\" => FilesWatcher::Notify,\n                 \"client\" | _ => FilesWatcher::Client,\n             },\n-            exclude: Vec::new(),\n+            exclude: self.data.files_excludeDirs.iter().map(|it| self.root_path.join(it)).collect(),\n         }\n     }\n     pub fn notifications(&self) -> NotificationsConfig {\n@@ -763,6 +765,10 @@ fn field_props(field: &str, ty: &str, doc: &[&str], default: &str) -> serde_json\n             \"type\": \"array\",\n             \"items\": { \"type\": \"string\" },\n         },\n+        \"Vec<PathBuf>\" => set! {\n+            \"type\": \"array\",\n+            \"items\": { \"type\": \"string\" },\n+        },\n         \"FxHashSet<String>\" => set! {\n             \"type\": \"array\",\n             \"items\": { \"type\": \"string\" },"}, {"sha": "0507186dce52911a00c34fb7ed990836d7d9d3e6", "filename": "crates/rust-analyzer/src/reload.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2870e701630c198bafb346e5a9c91c1d2fc9f092/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Freload.rs?ref=2870e701630c198bafb346e5a9c91c1d2fc9f092", "patch": "@@ -214,7 +214,8 @@ impl GlobalState {\n \n         let mut change = Change::new();\n \n-        let project_folders = ProjectFolders::new(&workspaces);\n+        let files_config = self.config.files();\n+        let project_folders = ProjectFolders::new(&workspaces, &files_config.exclude);\n \n         self.proc_macro_client = match self.config.proc_macro_srv() {\n             None => None,\n@@ -231,7 +232,7 @@ impl GlobalState {\n             },\n         };\n \n-        let watch = match self.config.files().watcher {\n+        let watch = match files_config.watcher {\n             FilesWatcher::Client => vec![],\n             FilesWatcher::Notify => project_folders.watch,\n         };\n@@ -319,7 +320,10 @@ pub(crate) struct ProjectFolders {\n }\n \n impl ProjectFolders {\n-    pub(crate) fn new(workspaces: &[ProjectWorkspace]) -> ProjectFolders {\n+    pub(crate) fn new(\n+        workspaces: &[ProjectWorkspace],\n+        global_excludes: &[AbsPathBuf],\n+    ) -> ProjectFolders {\n         let mut res = ProjectFolders::default();\n         let mut fsc = FileSetConfig::builder();\n         let mut local_filesets = vec![];\n@@ -333,6 +337,12 @@ impl ProjectFolders {\n                 dirs.extensions.push(\"rs\".into());\n                 dirs.include.extend(root.include);\n                 dirs.exclude.extend(root.exclude);\n+                for excl in global_excludes {\n+                    if dirs.include.iter().any(|incl| incl.starts_with(excl)) {\n+                        dirs.exclude.push(excl.clone());\n+                    }\n+                }\n+\n                 vfs::loader::Entry::Directories(dirs)\n             };\n "}, {"sha": "55178c84c4ccd78206a50aad1dc7cc52687ee715", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2870e701630c198bafb346e5a9c91c1d2fc9f092/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/2870e701630c198bafb346e5a9c91c1d2fc9f092/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=2870e701630c198bafb346e5a9c91c1d2fc9f092", "patch": "@@ -56,6 +56,8 @@\n  List of warnings that should be displayed with hint severity.\\n\\nThe  warnings will be indicated by faded text or three dots in code and  will not show up in the `Problems Panel`.\n [[rust-analyzer.files.watcher]]rust-analyzer.files.watcher (default: `\"client\"`)::\n  Controls file watching implementation.\n+[[rust-analyzer.files.excludeDirs]]rust-analyzer.files.excludeDirs (default: `[]`)::\n+ These directories will be ignored by rust-analyzer.\n [[rust-analyzer.hoverActions.debug]]rust-analyzer.hoverActions.debug (default: `true`)::\n  Whether to show `Debug` action. Only applies when  `#rust-analyzer.hoverActions.enable#` is set.\n [[rust-analyzer.hoverActions.enable]]rust-analyzer.hoverActions.enable (default: `true`)::"}, {"sha": "66af94186fee39b6e5077f302b9b5be7e414fa85", "filename": "editors/code/package.json", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2870e701630c198bafb346e5a9c91c1d2fc9f092/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/2870e701630c198bafb346e5a9c91c1d2fc9f092/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=2870e701630c198bafb346e5a9c91c1d2fc9f092", "patch": "@@ -555,6 +555,14 @@\n                     \"default\": \"client\",\n                     \"type\": \"string\"\n                 },\n+                \"rust-analyzer.files.excludeDirs\": {\n+                    \"markdownDescription\": \"These directories will be ignored by rust-analyzer.\",\n+                    \"default\": [],\n+                    \"type\": \"array\",\n+                    \"items\": {\n+                        \"type\": \"string\"\n+                    }\n+                },\n                 \"rust-analyzer.hoverActions.debug\": {\n                     \"markdownDescription\": \"Whether to show `Debug` action. Only applies when `#rust-analyzer.hoverActions.enable#` is set.\",\n                     \"default\": true,"}]}