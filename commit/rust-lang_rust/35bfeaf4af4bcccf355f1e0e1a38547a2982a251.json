{"sha": "35bfeaf4af4bcccf355f1e0e1a38547a2982a251", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1YmZlYWY0YWY0YmNjY2YzNTVmMWUwZTFhMzg1NDdhMjk4MmEyNTE=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-01-14T11:16:48Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-01-15T15:52:28Z"}, "message": "Add a test", "tree": {"sha": "7e972f3d3f4873e6ce401140c41587b72a616e00", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e972f3d3f4873e6ce401140c41587b72a616e00"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35bfeaf4af4bcccf355f1e0e1a38547a2982a251", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35bfeaf4af4bcccf355f1e0e1a38547a2982a251", "html_url": "https://github.com/rust-lang/rust/commit/35bfeaf4af4bcccf355f1e0e1a38547a2982a251", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35bfeaf4af4bcccf355f1e0e1a38547a2982a251/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c640c2ea114f21bc6e4913dac38cdc451c41ceae", "url": "https://api.github.com/repos/rust-lang/rust/commits/c640c2ea114f21bc6e4913dac38cdc451c41ceae", "html_url": "https://github.com/rust-lang/rust/commit/c640c2ea114f21bc6e4913dac38cdc451c41ceae"}], "stats": {"total": 4003, "additions": 4000, "deletions": 3}, "files": [{"sha": "0cacc58d45323eeb9539545dd3e7de62f2016603", "filename": "crates/ra_ide/src/syntax_highlighting.rs", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/35bfeaf4af4bcccf355f1e0e1a38547a2982a251/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/35bfeaf4af4bcccf355f1e0e1a38547a2982a251/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting.rs?ref=35bfeaf4af4bcccf355f1e0e1a38547a2982a251", "patch": "@@ -310,9 +310,12 @@ pre                 { color: #DCDCCC; background: #3F3F3F; font-size: 22px; padd\n \n #[cfg(test)]\n mod tests {\n-    use crate::mock_analysis::single_file;\n+    use std::fs;\n+\n     use test_utils::{assert_eq_text, project_dir, read_text};\n \n+    use crate::mock_analysis::{single_file, MockAnalysis};\n+\n     #[test]\n     fn te3st_highlighting() {\n         let (analysis, file_id) = single_file(\n@@ -359,7 +362,7 @@ impl<X> E<X> {\n         let dst_file = project_dir().join(\"crates/ra_ide/src/snapshots/highlighting.html\");\n         let actual_html = &analysis.highlight_as_html(file_id, false).unwrap();\n         let expected_html = &read_text(&dst_file);\n-        std::fs::write(dst_file, &actual_html).unwrap();\n+        fs::write(dst_file, &actual_html).unwrap();\n         assert_eq_text!(expected_html, actual_html);\n     }\n \n@@ -385,7 +388,21 @@ fn bar() {\n         let dst_file = project_dir().join(\"crates/ra_ide/src/snapshots/rainbow_highlighting.html\");\n         let actual_html = &analysis.highlight_as_html(file_id, true).unwrap();\n         let expected_html = &read_text(&dst_file);\n-        std::fs::write(dst_file, &actual_html).unwrap();\n+        fs::write(dst_file, &actual_html).unwrap();\n         assert_eq_text!(expected_html, actual_html);\n     }\n+\n+    #[test]\n+    fn accidentally_quadratic() {\n+        let file = project_dir().join(\"crates/ra_syntax/test_data/accidentally_quadratic\");\n+        let src = fs::read_to_string(file).unwrap();\n+\n+        let mut mock = MockAnalysis::new();\n+        let file_id = mock.add_file(\"/main.rs\", &src);\n+        let host = mock.analysis_host();\n+\n+        // let t = std::time::Instant::now();\n+        let _ = host.analysis().highlight(file_id).unwrap();\n+        // eprintln!(\"elapsed: {:?}\", t.elapsed());\n+    }\n }"}, {"sha": "428f83a627b2e597ffefe9f77e02abbe675f847b", "filename": "crates/ra_syntax/test_data/accidentally_quadratic", "status": "added", "additions": 3980, "deletions": 0, "changes": 3980, "blob_url": "https://github.com/rust-lang/rust/blob/35bfeaf4af4bcccf355f1e0e1a38547a2982a251/crates%2Fra_syntax%2Ftest_data%2Faccidentally_quadratic", "raw_url": "https://github.com/rust-lang/rust/raw/35bfeaf4af4bcccf355f1e0e1a38547a2982a251/crates%2Fra_syntax%2Ftest_data%2Faccidentally_quadratic", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Faccidentally_quadratic?ref=35bfeaf4af4bcccf355f1e0e1a38547a2982a251"}]}