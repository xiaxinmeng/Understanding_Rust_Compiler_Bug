{"sha": "c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0NGNhMTdhNDQyNWI5YmJkNWQ2MjE5YzhjZjVkNzViZjY3MGU2Njc=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-07-14T23:08:02Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2020-07-14T23:08:02Z"}, "message": "Remove string comparison and use diagnostic item instead", "tree": {"sha": "0b901632a6e8f83cb2a4341d467a3a2370b95250", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b901632a6e8f83cb2a4341d467a3a2370b95250"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "html_url": "https://github.com/rust-lang/rust/commit/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c724b67e1b474262917a5154d74e7072267593fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/c724b67e1b474262917a5154d74e7072267593fe", "html_url": "https://github.com/rust-lang/rust/commit/c724b67e1b474262917a5154d74e7072267593fe"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "a27e8d2a724529f67c3110d0bd1c747542dda36a", "filename": "src/libcore/option.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibcore%2Foption.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibcore%2Foption.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Foption.rs?ref=c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "patch": "@@ -1681,6 +1681,7 @@ impl<A, V: FromIterator<A>> FromIterator<Option<A>> for Option<V> {\n /// to allow `x?` (where `x` is an `Option<T>`) to be converted into your error type, you can\n /// implement `impl From<NoneError>` for `YourErrorType`. In that case, `x?` within a function that\n /// returns `Result<_, YourErrorType>` will translate a `None` value into an `Err` result.\n+#[rustc_diagnostic_item = \"none_error\"]\n #[unstable(feature = \"try_trait\", issue = \"42327\")]\n #[derive(Clone, Copy, PartialEq, PartialOrd, Eq, Ord, Debug, Hash)]\n pub struct NoneError;"}, {"sha": "c2fae47616f3b582dee27cba90e3a5e5ee4a7551", "filename": "src/librustc_span/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibrustc_span%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibrustc_span%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fsymbol.rs?ref=c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "patch": "@@ -564,6 +564,7 @@ symbols! {\n         nomem,\n         non_ascii_idents,\n         None,\n+        none_error,\n         non_exhaustive,\n         non_modrs_mods,\n         nontemporal_store,"}, {"sha": "d8af3da3b7018f56d1b670f6567ae3cb1b1276bb", "filename": "src/librustc_trait_selection/traits/error_reporting/mod.rs", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c44ca17a4425b9bbd5d6219c8cf5d75bf670e667/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=c44ca17a4425b9bbd5d6219c8cf5d75bf670e667", "patch": "@@ -26,6 +26,7 @@ use rustc_middle::ty::{\n     TypeFoldable, WithConstness,\n };\n use rustc_session::DiagnosticMessageId;\n+use rustc_span::symbol::sym;\n use rustc_span::{ExpnKind, MultiSpan, Span, DUMMY_SP};\n use std::fmt;\n \n@@ -283,8 +284,8 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             .span_to_snippet(span)\n                             .map(|s| &s == \"?\")\n                             .unwrap_or(false);\n-                        let is_from = format!(\"{}\", trait_ref.print_only_trait_path())\n-                            .starts_with(\"std::convert::From<\");\n+                        let is_from = self.tcx.get_diagnostic_item(sym::from_trait)\n+                            == Some(trait_ref.def_id());\n                         let is_unsize =\n                             { Some(trait_ref.def_id()) == self.tcx.lang_items().unsize_trait() };\n                         let (message, note) = if is_try && is_from {\n@@ -315,12 +316,15 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             ))\n                         );\n \n-                        let should_convert_option_to_result =\n-                            format!(\"{}\", trait_ref.print_only_trait_path())\n-                                .starts_with(\"std::convert::From<std::option::NoneError\");\n-                        let should_convert_result_to_option = format!(\"{}\", trait_ref)\n-                            .starts_with(\"<std::option::NoneError as std::convert::From<\");\n                         if is_try && is_from {\n+                            let none_error = self\n+                                .tcx\n+                                .get_diagnostic_item(sym::none_error)\n+                                .map(|def_id| tcx.type_of(def_id));\n+                            let should_convert_option_to_result =\n+                                Some(trait_ref.skip_binder().substs.type_at(1)) == none_error;\n+                            let should_convert_result_to_option =\n+                                Some(trait_ref.self_ty().skip_binder()) == none_error;\n                             if should_convert_option_to_result {\n                                 err.span_suggestion_verbose(\n                                     span.shrink_to_lo(),"}]}