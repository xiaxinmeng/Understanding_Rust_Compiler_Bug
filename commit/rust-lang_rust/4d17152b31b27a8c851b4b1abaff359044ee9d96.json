{"sha": "4d17152b31b27a8c851b4b1abaff359044ee9d96", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkMTcxNTJiMzFiMjdhOGM4NTFiNGIxYWJhZmYzNTkwNDRlZTlkOTY=", "commit": {"author": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-03-09T18:14:55Z"}, "committer": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-03-14T00:01:46Z"}, "message": "vscode: make bailing out on custom serverPath more evident", "tree": {"sha": "6f8e3f3750c54201cd80cdc07d25c747e3f3dc4d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f8e3f3750c54201cd80cdc07d25c747e3f3dc4d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4d17152b31b27a8c851b4b1abaff359044ee9d96", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4d17152b31b27a8c851b4b1abaff359044ee9d96", "html_url": "https://github.com/rust-lang/rust/commit/4d17152b31b27a8c851b4b1abaff359044ee9d96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4d17152b31b27a8c851b4b1abaff359044ee9d96/comments", "author": null, "committer": null, "parents": [{"sha": "7e6b1a60c3d7b20e1b4cee2ab210b617e359a002", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e6b1a60c3d7b20e1b4cee2ab210b617e359a002", "html_url": "https://github.com/rust-lang/rust/commit/7e6b1a60c3d7b20e1b4cee2ab210b617e359a002"}], "stats": {"total": 18, "additions": 8, "deletions": 10}, "files": [{"sha": "345c9e21a3f72668ed315b5c6dc4f037c388ba88", "filename": "editors/code/src/config.ts", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4d17152b31b27a8c851b4b1abaff359044ee9d96/editors%2Fcode%2Fsrc%2Fconfig.ts", "raw_url": "https://github.com/rust-lang/rust/raw/4d17152b31b27a8c851b4b1abaff359044ee9d96/editors%2Fcode%2Fsrc%2Fconfig.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fconfig.ts?ref=4d17152b31b27a8c851b4b1abaff359044ee9d96", "patch": "@@ -45,7 +45,7 @@ export class Config {\n     /**\n      * Either `nightly` or `YYYY-MM-DD` (i.e. `stable` release)\n      */\n-    private readonly extensionVersion: string = (() => {\n+    readonly extensionReleaseTag: string = (() => {\n         const packageJsonVersion = vscode\n             .extensions\n             .getExtension(this.extensionId)!\n@@ -135,10 +135,8 @@ export class Config {\n         }\n     }\n \n-    get installedExtensionUpdateChannel() {\n-        if (this.serverPath !== null) return null;\n-\n-        return this.extensionVersion === NIGHTLY_TAG\n+    get installedExtensionUpdateChannel(): UpdatesChannel {\n+        return this.extensionReleaseTag === NIGHTLY_TAG\n             ? UpdatesChannel.Nightly\n             : UpdatesChannel.Stable;\n     }\n@@ -159,7 +157,7 @@ export class Config {\n \n         return this.createGithubReleaseSource(\n             prebuiltBinaryName,\n-            this.extensionVersion\n+            this.extensionReleaseTag\n         );\n     }\n \n@@ -195,7 +193,7 @@ export class Config {\n     // We don't do runtime config validation here for simplicity. More on stackoverflow:\n     // https://stackoverflow.com/questions/60135780/what-is-the-best-way-to-type-check-the-configuration-for-vscode-extension\n \n-    private get serverPath() { return this.cfg.get(\"serverPath\") as null | string; }\n+    get serverPath() { return this.cfg.get(\"serverPath\") as null | string; }\n     get updatesChannel() { return this.cfg.get(\"updates.channel\") as UpdatesChannel; }\n     get askBeforeDownload() { return this.cfg.get(\"updates.askBeforeDownload\") as boolean; }\n     get highlightingSemanticTokens() { return this.cfg.get(\"highlighting.semanticTokens\") as boolean; }"}, {"sha": "a0925acaa5d130b15daabab22b6c31aa9bc50c40", "filename": "editors/code/src/installation/extension.ts", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4d17152b31b27a8c851b4b1abaff359044ee9d96/editors%2Fcode%2Fsrc%2Finstallation%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/4d17152b31b27a8c851b4b1abaff359044ee9d96/editors%2Fcode%2Fsrc%2Finstallation%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Fextension.ts?ref=4d17152b31b27a8c851b4b1abaff359044ee9d96", "patch": "@@ -15,6 +15,9 @@ const HEURISTIC_NIGHTLY_RELEASE_PERIOD_IN_HOURS = 25;\n  * extension version is what's needed according to `desiredUpdateChannel`.\n  */\n export async function ensureProperExtensionVersion(config: Config): Promise<never | void> {\n+    // User has built lsp server from sources, she should manage updates manually\n+    if (config.serverPath !== null) return;\n+\n     const currentUpdChannel = config.installedExtensionUpdateChannel;\n     const desiredUpdChannel = config.updatesChannel;\n \n@@ -23,9 +26,6 @@ export async function ensureProperExtensionVersion(config: Config): Promise<neve\n         config.installedNightlyExtensionReleaseDate.set(null);\n     }\n \n-    // User has built lsp server from sources, she should manage updates manually\n-    if (currentUpdChannel === null) return;\n-\n     if (desiredUpdChannel === UpdatesChannel.Stable) {\n         // VSCode should handle updates for stable channel\n         if (currentUpdChannel === UpdatesChannel.Stable) return;"}]}