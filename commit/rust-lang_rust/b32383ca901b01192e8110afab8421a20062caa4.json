{"sha": "b32383ca901b01192e8110afab8421a20062caa4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzMjM4M2NhOTAxYjAxMTkyZTgxMTBhZmFiODQyMWEyMDA2MmNhYTQ=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-22T23:34:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-22T23:34:50Z"}, "message": "Rollup merge of #74643 - petrochenkov:noenvrerun, r=Mark-Simulacrum\n\nbuild: Remove unnecessary `cargo:rerun-if-env-changed` annotations\n\n... and a couple of related cleanups.\n\nrustc and cargo now track the majority of env var dependencies automatically (https://github.com/rust-lang/cargo/pull/8421), so the annotations are no longer necessary.", "tree": {"sha": "1fd7e116f0ca341d398fdf157cb5f2606791cfc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1fd7e116f0ca341d398fdf157cb5f2606791cfc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b32383ca901b01192e8110afab8421a20062caa4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfGM0aCRBK7hj4Ov3rIwAAdHIIAE9r8qQsOFOq+G9S7oLe8Pkc\nmgyjYAeP/eMTKkwmxj8vGGaloSlzBfW+io5wX3DONLENLlh9lqIKtLNYeFCv/Dpt\nTw19t7IQg2AfVv2MCcCRjMz3+iDe2hUCnrl3pXfkoiqX6IhW3UkVVzwfygq/xyfX\nQH39voDmQu2rTvZtP++MtnE6nIkMxfm571xE1qxjrAb4CzVhTjzgGm9sWLB6rjdq\nyZBxVzRBH5a4lfAc8iMOuVXkOb/1i9+2dxG/8PAX778/InV11rabpF+afEmV2/lw\nXG2jUQvmuuJYWUeWuNzJmWXgTf6T4s9ieezH2p9f9s4TEOVe9QXe484PodnlIH0=\n=rRaT\n-----END PGP SIGNATURE-----\n", "payload": "tree 1fd7e116f0ca341d398fdf157cb5f2606791cfc2\nparent 7b28e7bf6bd209b76639748b1ab15ac65b586e22\nparent 7be36a86f7b7798e662d844b33bd744a136b4f60\nauthor Manish Goregaokar <manishsmail@gmail.com> 1595460890 -0700\ncommitter GitHub <noreply@github.com> 1595460890 -0700\n\nRollup merge of #74643 - petrochenkov:noenvrerun, r=Mark-Simulacrum\n\nbuild: Remove unnecessary `cargo:rerun-if-env-changed` annotations\n\n... and a couple of related cleanups.\n\nrustc and cargo now track the majority of env var dependencies automatically (https://github.com/rust-lang/cargo/pull/8421), so the annotations are no longer necessary.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b32383ca901b01192e8110afab8421a20062caa4", "html_url": "https://github.com/rust-lang/rust/commit/b32383ca901b01192e8110afab8421a20062caa4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b32383ca901b01192e8110afab8421a20062caa4/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b28e7bf6bd209b76639748b1ab15ac65b586e22", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b28e7bf6bd209b76639748b1ab15ac65b586e22", "html_url": "https://github.com/rust-lang/rust/commit/7b28e7bf6bd209b76639748b1ab15ac65b586e22"}, {"sha": "7be36a86f7b7798e662d844b33bd744a136b4f60", "url": "https://api.github.com/repos/rust-lang/rust/commits/7be36a86f7b7798e662d844b33bd744a136b4f60", "html_url": "https://github.com/rust-lang/rust/commit/7be36a86f7b7798e662d844b33bd744a136b4f60"}], "stats": {"total": 107, "additions": 26, "deletions": 81}, "files": [{"sha": "e30da8d56e10fca3ebb0fb3e289f07665e4e27e0", "filename": "src/build_helper/lib.rs", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Fbuild_helper%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Fbuild_helper%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbuild_helper%2Flib.rs?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -1,3 +1,5 @@\n+use std::ffi::{OsStr, OsString};\n+use std::fmt::Display;\n use std::path::{Path, PathBuf};\n use std::process::{Command, Stdio};\n use std::time::{SystemTime, UNIX_EPOCH};\n@@ -28,6 +30,14 @@ macro_rules! t {\n     };\n }\n \n+/// Reads an environment variable and adds it to dependencies.\n+/// Supposed to be used for all variables except those set for build scripts by cargo\n+/// https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts\n+pub fn tracked_env_var_os<K: AsRef<OsStr> + Display>(key: K) -> Option<OsString> {\n+    println!(\"cargo:rerun-if-env-changed={}\", key);\n+    env::var_os(key)\n+}\n+\n // Because Cargo adds the compiler's dylib path to our library search path, llvm-config may\n // break: the dylib path for the compiler, as of this writing, contains a copy of the LLVM\n // shared library, which means that when our freshly built llvm-config goes to load it's\n@@ -37,10 +47,8 @@ macro_rules! t {\n // perfect -- we might actually want to see something from Cargo's added library paths -- but\n // for now it works.\n pub fn restore_library_path() {\n-    println!(\"cargo:rerun-if-env-changed=REAL_LIBRARY_PATH_VAR\");\n-    println!(\"cargo:rerun-if-env-changed=REAL_LIBRARY_PATH\");\n-    let key = env::var_os(\"REAL_LIBRARY_PATH_VAR\").expect(\"REAL_LIBRARY_PATH_VAR\");\n-    if let Some(env) = env::var_os(\"REAL_LIBRARY_PATH\") {\n+    let key = tracked_env_var_os(\"REAL_LIBRARY_PATH_VAR\").expect(\"REAL_LIBRARY_PATH_VAR\");\n+    if let Some(env) = tracked_env_var_os(\"REAL_LIBRARY_PATH\") {\n         env::set_var(&key, &env);\n     } else {\n         env::remove_var(&key);"}, {"sha": "899f923b957fe3af07644fe48f79a65d5adc53dc", "filename": "src/libprofiler_builtins/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibprofiler_builtins%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibprofiler_builtins%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibprofiler_builtins%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -1,6 +1,5 @@\n [package]\n authors = [\"The Rust Project Developers\"]\n-build = \"build.rs\"\n name = \"profiler_builtins\"\n version = \"0.0.0\"\n edition = \"2018\""}, {"sha": "d2cb873058c282f14f04317fe77e4cc6e46554b1", "filename": "src/libprofiler_builtins/build.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibprofiler_builtins%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibprofiler_builtins%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibprofiler_builtins%2Fbuild.rs?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -9,6 +9,8 @@ fn main() {\n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n     let cfg = &mut cc::Build::new();\n \n+    // FIXME: `rerun-if-changed` directives are not currently emitted and the build script\n+    // will not rerun on changes in these source files or headers included into them.\n     let mut profile_sources = vec![\n         \"GCDAProfiling.c\",\n         \"InstrProfiling.c\","}, {"sha": "9b861f9640904b51bdc7ef32d294f40d054ebb26", "filename": "src/librustc_ast/build.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_ast%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_ast%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ast%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,5 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_RELEASE_CHANNEL\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_DISABLE_UNSTABLE_FEATURES\");\n-}"}, {"sha": "496becb8f1b5948235438afe758fdc9db0282829", "filename": "src/librustc_attr/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_attr%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_attr%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_attr%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -3,7 +3,6 @@ authors = [\"The Rust Project Developers\"]\n name = \"rustc_attr\"\n version = \"0.0.0\"\n edition = \"2018\"\n-build = \"build.rs\"\n \n [lib]\n name = \"rustc_attr\""}, {"sha": "863f2b7337b2588aa7f31db1693496f9468d8121", "filename": "src/librustc_attr/build.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_attr%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_attr%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_attr%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,5 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_RELEASE\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_RELEASE_CHANNEL\");\n-}"}, {"sha": "d1fc624c689279cf3b11d79c508a63031e2fbff5", "filename": "src/librustc_codegen_llvm/build.rs", "status": "removed", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_codegen_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_codegen_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,6 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VERSION\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_PREFIX\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_LLVM_ROOT\");\n-}"}, {"sha": "ea2af6e192e7c1d0c927393717dcab497c453240", "filename": "src/librustc_codegen_ssa/build.rs", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_codegen_ssa%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_codegen_ssa%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,4 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_RELEASE_CHANNEL\");\n-}"}, {"sha": "414d13445f01e70b3784b2cb3b503c0d3f58d2c7", "filename": "src/librustc_driver/build.rs", "status": "removed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_driver%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_driver%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,7 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_RELEASE\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VERSION\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VER_DATE\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VER_HASH\");\n-}"}, {"sha": "d230ba91039adc9581745ee39a492fa91e3b52b0", "filename": "src/librustc_incremental/build.rs", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_incremental%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_incremental%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,4 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VERSION\");\n-}"}, {"sha": "79a343e0fee0bfcc2ce20a53e36fc92f822b0ec0", "filename": "src/librustc_interface/build.rs", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_interface%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_interface%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,4 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=RUSTC_INSTALL_BINDIR\");\n-}"}, {"sha": "9f2711eec10acb26b7d1e004bbb103e034daa6c9", "filename": "src/librustc_llvm/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_llvm%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_llvm%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -2,7 +2,6 @@\n authors = [\"The Rust Project Developers\"]\n name = \"rustc_llvm\"\n version = \"0.0.0\"\n-build = \"build.rs\"\n edition = \"2018\"\n \n [lib]"}, {"sha": "21b8080714c1744ca54130adbb6325ece0082bff", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -2,21 +2,20 @@ use std::env;\n use std::path::{Path, PathBuf};\n use std::process::Command;\n \n-use build_helper::output;\n+use build_helper::{output, tracked_env_var_os};\n \n fn detect_llvm_link() -> (&'static str, &'static str) {\n     // Force the link mode we want, preferring static by default, but\n     // possibly overridden by `configure --enable-llvm-link-shared`.\n-    if env::var_os(\"LLVM_LINK_SHARED\").is_some() {\n+    if tracked_env_var_os(\"LLVM_LINK_SHARED\").is_some() {\n         (\"dylib\", \"--link-shared\")\n     } else {\n         (\"static\", \"--link-static\")\n     }\n }\n \n fn main() {\n-    println!(\"cargo:rerun-if-env-changed=RUST_CHECK\");\n-    if env::var_os(\"RUST_CHECK\").is_some() {\n+    if tracked_env_var_os(\"RUST_CHECK\").is_some() {\n         // If we're just running `check`, there's no need for LLVM to be built.\n         return;\n     }\n@@ -25,8 +24,8 @@ fn main() {\n \n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n     let llvm_config =\n-        env::var_os(\"LLVM_CONFIG\").map(|x| Some(PathBuf::from(x))).unwrap_or_else(|| {\n-            if let Some(dir) = env::var_os(\"CARGO_TARGET_DIR\").map(PathBuf::from) {\n+        tracked_env_var_os(\"LLVM_CONFIG\").map(|x| Some(PathBuf::from(x))).unwrap_or_else(|| {\n+            if let Some(dir) = tracked_env_var_os(\"CARGO_TARGET_DIR\").map(PathBuf::from) {\n                 let to_test = dir\n                     .parent()\n                     .unwrap()\n@@ -46,8 +45,6 @@ fn main() {\n     }\n     let llvm_config = llvm_config.unwrap_or_else(|| PathBuf::from(\"llvm-config\"));\n \n-    println!(\"cargo:rerun-if-env-changed=LLVM_CONFIG\");\n-\n     // Test whether we're cross-compiling LLVM. This is a pretty rare case\n     // currently where we're producing an LLVM for a different platform than\n     // what this build script is currently running on.\n@@ -163,12 +160,11 @@ fn main() {\n         cfg.define(&flag, None);\n     }\n \n-    println!(\"cargo:rerun-if-changed-env=LLVM_RUSTLLVM\");\n-    if env::var_os(\"LLVM_RUSTLLVM\").is_some() {\n+    if tracked_env_var_os(\"LLVM_RUSTLLVM\").is_some() {\n         cfg.define(\"LLVM_RUSTLLVM\", None);\n     }\n \n-    if env::var_os(\"LLVM_NDEBUG\").is_some() {\n+    if tracked_env_var_os(\"LLVM_NDEBUG\").is_some() {\n         cfg.define(\"NDEBUG\", None);\n         cfg.debug(false);\n     }\n@@ -255,7 +251,7 @@ fn main() {\n     // librustc_llvm, for example when using static libc++, we may need to\n     // manually specify the library search path and -ldl -lpthread as link\n     // dependencies.\n-    let llvm_linker_flags = env::var_os(\"LLVM_LINKER_FLAGS\");\n+    let llvm_linker_flags = tracked_env_var_os(\"LLVM_LINKER_FLAGS\");\n     if let Some(s) = llvm_linker_flags {\n         for lib in s.into_string().unwrap().split_whitespace() {\n             if lib.starts_with(\"-l\") {\n@@ -266,8 +262,8 @@ fn main() {\n         }\n     }\n \n-    let llvm_static_stdcpp = env::var_os(\"LLVM_STATIC_STDCPP\");\n-    let llvm_use_libcxx = env::var_os(\"LLVM_USE_LIBCXX\");\n+    let llvm_static_stdcpp = tracked_env_var_os(\"LLVM_STATIC_STDCPP\");\n+    let llvm_use_libcxx = tracked_env_var_os(\"LLVM_USE_LIBCXX\");\n \n     let stdcppname = if target.contains(\"openbsd\") {\n         if target.contains(\"sparc64\") { \"estdc++\" } else { \"c++\" }"}, {"sha": "7d5c58ecea2a135c1c076d2d8f04bb562468670f", "filename": "src/librustc_metadata/build.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_metadata%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_metadata%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,5 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VERSION\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_VIRTUAL_RUST_SOURCE_BASE_DIR\");\n-}"}, {"sha": "af7723aea34e466edfd582741d409baec623c5ea", "filename": "src/librustc_middle/build.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_middle%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_middle%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,12 +0,0 @@\n-use std::env;\n-\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_LIBDIR_RELATIVE\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_COMPILER_HOST_TRIPLE\");\n-    println!(\"cargo:rerun-if-env-changed=RUSTC_VERIFY_LLVM_IR\");\n-\n-    if env::var_os(\"RUSTC_VERIFY_LLVM_IR\").is_some() {\n-        println!(\"cargo:rustc-cfg=always_verify_llvm_ir\");\n-    }\n-}"}, {"sha": "1b8f6cdd8bebcc7a2d8bd328a4dd14d25a7c27be", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -548,7 +548,7 @@ impl Session {\n         self.opts.debugging_opts.asm_comments\n     }\n     pub fn verify_llvm_ir(&self) -> bool {\n-        self.opts.debugging_opts.verify_llvm_ir || cfg!(always_verify_llvm_ir)\n+        self.opts.debugging_opts.verify_llvm_ir || option_env!(\"RUSTC_VERIFY_LLVM_IR\").is_some()\n     }\n     pub fn borrowck_stats(&self) -> bool {\n         self.opts.debugging_opts.borrowck_stats"}, {"sha": "368200b776d74c4454a705eb210bdc09ce53274c", "filename": "src/librustc_target/build.rs", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_target%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b28e7bf6bd209b76639748b1ab15ac65b586e22/src%2Flibrustc_target%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fbuild.rs?ref=7b28e7bf6bd209b76639748b1ab15ac65b586e22", "patch": "@@ -1,4 +0,0 @@\n-fn main() {\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-    println!(\"cargo:rerun-if-env-changed=CFG_DEFAULT_LINKER\");\n-}"}, {"sha": "f5d8119f711cb739139481fad27f2f54287d370e", "filename": "src/libstd/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibstd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibstd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -2,7 +2,6 @@\n authors = [\"The Rust Project Developers\"]\n name = \"std\"\n version = \"0.0.0\"\n-build = \"build.rs\"\n license = \"MIT OR Apache-2.0\"\n repository = \"https://github.com/rust-lang/rust.git\"\n description = \"The Rust Standard Library\""}, {"sha": "83073cc77dd1a12354ce6b9e535804e83f33e27e", "filename": "src/libstd/build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibstd%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibstd%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fbuild.rs?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -1,6 +1,7 @@\n use std::env;\n \n fn main() {\n+    println!(\"cargo:rerun-if-changed=build.rs\");\n     let target = env::var(\"TARGET\").expect(\"TARGET was not set\");\n     if target.contains(\"linux\") {\n         if target.contains(\"android\") {"}, {"sha": "b6baa9a8c6bcc71b77d42e3ffe1cf2fef45ab7bd", "filename": "src/libunwind/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibunwind%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Flibunwind%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibunwind%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -2,7 +2,6 @@\n authors = [\"The Rust Project Developers\"]\n name = \"unwind\"\n version = \"0.0.0\"\n-build = \"build.rs\"\n edition = \"2018\"\n include = [\n   '/libunwind/*',"}, {"sha": "787e08404e1c61581768d4425129d939b96cbfb0", "filename": "src/tools/error_index_generator/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b32383ca901b01192e8110afab8421a20062caa4/src%2Ftools%2Ferror_index_generator%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b32383ca901b01192e8110afab8421a20062caa4/src%2Ftools%2Ferror_index_generator%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ferror_index_generator%2FCargo.toml?ref=b32383ca901b01192e8110afab8421a20062caa4", "patch": "@@ -3,7 +3,6 @@ authors = [\"The Rust Project Developers\"]\n name = \"error_index_generator\"\n version = \"0.0.0\"\n edition = \"2018\"\n-build = \"build.rs\"\n \n [dependencies]\n rustdoc = { path = \"../../librustdoc\" }"}]}