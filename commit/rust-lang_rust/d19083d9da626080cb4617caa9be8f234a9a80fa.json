{"sha": "d19083d9da626080cb4617caa9be8f234a9a80fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxOTA4M2Q5ZGE2MjYwODBjYjQ2MTdjYWE5YmU4ZjIzNGE5YTgwZmE=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-28T04:25:07Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-04-05T08:13:36Z"}, "message": "Fix bug where rustc_lint would not apply renamed tool lints", "tree": {"sha": "26996073e09daa2e37c75d7be9e655d3dd1f6add", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26996073e09daa2e37c75d7be9e655d3dd1f6add"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d19083d9da626080cb4617caa9be8f234a9a80fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d19083d9da626080cb4617caa9be8f234a9a80fa", "html_url": "https://github.com/rust-lang/rust/commit/d19083d9da626080cb4617caa9be8f234a9a80fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d19083d9da626080cb4617caa9be8f234a9a80fa/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef4e5b9ecb10480cd87bd7875e4169ca5edeb0fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef4e5b9ecb10480cd87bd7875e4169ca5edeb0fd", "html_url": "https://github.com/rust-lang/rust/commit/ef4e5b9ecb10480cd87bd7875e4169ca5edeb0fd"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "e0857ad1eb997c11eaf9efc533bb276233c1d730", "filename": "compiler/rustc_lint/src/levels.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d19083d9da626080cb4617caa9be8f234a9a80fa/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d19083d9da626080cb4617caa9be8f234a9a80fa/compiler%2Frustc_lint%2Fsrc%2Flevels.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flevels.rs?ref=d19083d9da626080cb4617caa9be8f234a9a80fa", "patch": "@@ -464,15 +464,16 @@ impl<'s> LintLevelsBuilder<'s> {\n                 // we don't warn about the name change.\n                 if let CheckLintNameResult::Warning(_, Some(new_name)) = lint_result {\n                     // Ignore any errors or warnings that happen because the new name is inaccurate\n-                    if let CheckLintNameResult::Ok(ids) =\n-                        store.check_lint_name(&new_name, tool_name)\n-                    {\n+                    // NOTE: `new_name` already includes the tool name, so we don't have to add it again.\n+                    if let CheckLintNameResult::Ok(ids) = store.check_lint_name(&new_name, None) {\n                         let src =\n                             LintLevelSource::Node(Symbol::intern(&new_name), li.span(), reason);\n                         for &id in ids {\n                             self.check_gated_lint(id, attr.span);\n                             self.insert_spec(&mut specs, id, (level, src));\n                         }\n+                    } else {\n+                        panic!(\"renamed lint does not exist: {}\", new_name);\n                     }\n                 }\n             }"}, {"sha": "05a32d3cc310962fb075ecdae376289a53ed9ceb", "filename": "src/test/rustdoc-ui/renamed-lint-still-applies.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d19083d9da626080cb4617caa9be8f234a9a80fa/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d19083d9da626080cb4617caa9be8f234a9a80fa/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.rs?ref=d19083d9da626080cb4617caa9be8f234a9a80fa", "patch": "@@ -4,3 +4,8 @@\n // stable channel.\n //! [x]\n //~^ ERROR unresolved link\n+\n+#![deny(rustdoc::non_autolinks)]\n+//~^ WARNING renamed to `rustdoc::bare_urls`\n+//! http://example.com\n+//~^ ERROR not a hyperlink"}, {"sha": "19c253b366b25c828bc8bbb933c00ad5921a4af3", "filename": "src/test/rustdoc-ui/renamed-lint-still-applies.stderr", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d19083d9da626080cb4617caa9be8f234a9a80fa/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d19083d9da626080cb4617caa9be8f234a9a80fa/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Frenamed-lint-still-applies.stderr?ref=d19083d9da626080cb4617caa9be8f234a9a80fa", "patch": "@@ -1,3 +1,11 @@\n+warning: lint `rustdoc::non_autolinks` has been renamed to `rustdoc::bare_urls`\n+  --> $DIR/renamed-lint-still-applies.rs:8:9\n+   |\n+LL | #![deny(rustdoc::non_autolinks)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^ help: use the new name: `rustdoc::bare_urls`\n+   |\n+   = note: `#[warn(renamed_and_removed_lints)]` on by default\n+\n error: unresolved link to `x`\n   --> $DIR/renamed-lint-still-applies.rs:5:6\n    |\n@@ -12,5 +20,17 @@ LL | #![deny(broken_intra_doc_links)]\n    = note: `#[deny(rustdoc::broken_intra_doc_links)]` implied by `#[deny(broken_intra_doc_links)]`\n    = help: to escape `[` and `]` characters, add '\\' before them like `\\[` or `\\]`\n \n-error: aborting due to previous error\n+error: this URL is not a hyperlink\n+  --> $DIR/renamed-lint-still-applies.rs:10:5\n+   |\n+LL | //! http://example.com\n+   |     ^^^^^^^^^^^^^^^^^^ help: use an automatic link instead: `<http://example.com>`\n+   |\n+note: the lint level is defined here\n+  --> $DIR/renamed-lint-still-applies.rs:8:9\n+   |\n+LL | #![deny(rustdoc::non_autolinks)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n "}]}