{"sha": "d832525809fdc87f72723340484899b0a685983e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ4MzI1MjU4MDlmZGM4N2Y3MjcyMzM0MDQ4NDg5OWIwYTY4NTk4M2U=", "commit": {"author": {"name": "crw5996", "email": "crw5996@protonmail.com", "date": "2018-08-28T03:03:29Z"}, "committer": {"name": "crw5996", "email": "crw5996@protonmail.com", "date": "2018-08-28T03:04:55Z"}, "message": "Merge branch 'master' of https://github.com/rust-lang-nursery/rustfmt into fix-use-bug", "tree": {"sha": "09de76cb46bd88d2e0427fe82572fdc954e4d40b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09de76cb46bd88d2e0427fe82572fdc954e4d40b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d832525809fdc87f72723340484899b0a685983e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d832525809fdc87f72723340484899b0a685983e", "html_url": "https://github.com/rust-lang/rust/commit/d832525809fdc87f72723340484899b0a685983e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d832525809fdc87f72723340484899b0a685983e/comments", "author": {"login": "chwoda1", "id": 15281447, "node_id": "MDQ6VXNlcjE1MjgxNDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/15281447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chwoda1", "html_url": "https://github.com/chwoda1", "followers_url": "https://api.github.com/users/chwoda1/followers", "following_url": "https://api.github.com/users/chwoda1/following{/other_user}", "gists_url": "https://api.github.com/users/chwoda1/gists{/gist_id}", "starred_url": "https://api.github.com/users/chwoda1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chwoda1/subscriptions", "organizations_url": "https://api.github.com/users/chwoda1/orgs", "repos_url": "https://api.github.com/users/chwoda1/repos", "events_url": "https://api.github.com/users/chwoda1/events{/privacy}", "received_events_url": "https://api.github.com/users/chwoda1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chwoda1", "id": 15281447, "node_id": "MDQ6VXNlcjE1MjgxNDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/15281447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chwoda1", "html_url": "https://github.com/chwoda1", "followers_url": "https://api.github.com/users/chwoda1/followers", "following_url": "https://api.github.com/users/chwoda1/following{/other_user}", "gists_url": "https://api.github.com/users/chwoda1/gists{/gist_id}", "starred_url": "https://api.github.com/users/chwoda1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chwoda1/subscriptions", "organizations_url": "https://api.github.com/users/chwoda1/orgs", "repos_url": "https://api.github.com/users/chwoda1/repos", "events_url": "https://api.github.com/users/chwoda1/events{/privacy}", "received_events_url": "https://api.github.com/users/chwoda1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "20075306f7f18050744b851b82a72e2bd12fc9d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/20075306f7f18050744b851b82a72e2bd12fc9d1", "html_url": "https://github.com/rust-lang/rust/commit/20075306f7f18050744b851b82a72e2bd12fc9d1"}, {"sha": "c4d845f998b507718a362416abee05eb0c135dc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4d845f998b507718a362416abee05eb0c135dc9", "html_url": "https://github.com/rust-lang/rust/commit/c4d845f998b507718a362416abee05eb0c135dc9"}], "stats": {"total": 45, "additions": 28, "deletions": 17}, "files": [{"sha": "d5c4802904b65ed9747d90099e413d556b7b4400", "filename": "src/patterns.rs", "status": "modified", "additions": 16, "deletions": 17, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/d832525809fdc87f72723340484899b0a685983e/src%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d832525809fdc87f72723340484899b0a685983e/src%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fpatterns.rs?ref=d832525809fdc87f72723340484899b0a685983e", "patch": "@@ -336,29 +336,28 @@ fn rewrite_tuple_pat(\n         ));\n         pat_vec.insert(pos, dotdot);\n     }\n-\n     if pat_vec.is_empty() {\n         return Some(format!(\"{}()\", path_str.unwrap_or_default()));\n     }\n-\n     let wildcard_suffix_len = count_wildcard_suffix_len(context, &pat_vec, span, shape);\n-    let (pat_vec, span) = if context.config.condense_wildcard_suffixes() && wildcard_suffix_len >= 2\n-    {\n-        let new_item_count = 1 + pat_vec.len() - wildcard_suffix_len;\n-        let sp = pat_vec[new_item_count - 1].span();\n-        let snippet = context.snippet(sp);\n-        let lo = sp.lo() + BytePos(snippet.find_uncommented(\"_\").unwrap() as u32);\n-        pat_vec[new_item_count - 1] = TuplePatField::Dotdot(mk_sp(lo, lo + BytePos(1)));\n-        (\n-            &pat_vec[..new_item_count],\n-            mk_sp(span.lo(), lo + BytePos(1)),\n-        )\n-    } else {\n-        (&pat_vec[..], span)\n-    };\n+    let (pat_vec, span, condensed) =\n+        if context.config.condense_wildcard_suffixes() && wildcard_suffix_len >= 2 {\n+            let new_item_count = 1 + pat_vec.len() - wildcard_suffix_len;\n+            let sp = pat_vec[new_item_count - 1].span();\n+            let snippet = context.snippet(sp);\n+            let lo = sp.lo() + BytePos(snippet.find_uncommented(\"_\").unwrap() as u32);\n+            pat_vec[new_item_count - 1] = TuplePatField::Dotdot(mk_sp(lo, lo + BytePos(1)));\n+            (\n+                &pat_vec[..new_item_count],\n+                mk_sp(span.lo(), lo + BytePos(1)),\n+                true,\n+            )\n+        } else {\n+            (&pat_vec[..], span, false)\n+        };\n \n     // add comma if `(x,)`\n-    let add_comma = path_str.is_none() && pat_vec.len() == 1 && dotdot_pos.is_none();\n+    let add_comma = path_str.is_none() && pat_vec.len() == 1 && dotdot_pos.is_none() && !condensed;\n     let path_str = path_str.unwrap_or_default();\n     let pat_ref_vec = pat_vec.iter().collect::<Vec<_>>();\n "}, {"sha": "525e070a57eee7df83adfed1cb4437b578010326", "filename": "tests/source/issue-2955.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d832525809fdc87f72723340484899b0a685983e/tests%2Fsource%2Fissue-2955.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d832525809fdc87f72723340484899b0a685983e/tests%2Fsource%2Fissue-2955.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-2955.rs?ref=d832525809fdc87f72723340484899b0a685983e", "patch": "@@ -0,0 +1,6 @@\n+// rustfmt-condense_wildcard_suffixes: true\n+fn main() {\n+    match (1, 2, 3) {\n+        (_, _, _) => (),\n+    }\n+}"}, {"sha": "799cd36e29ac28cc47aa9287a81d7d213b1bd6c0", "filename": "tests/target/issue-2955.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d832525809fdc87f72723340484899b0a685983e/tests%2Ftarget%2Fissue-2955.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d832525809fdc87f72723340484899b0a685983e/tests%2Ftarget%2Fissue-2955.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-2955.rs?ref=d832525809fdc87f72723340484899b0a685983e", "patch": "@@ -0,0 +1,6 @@\n+// rustfmt-condense_wildcard_suffixes: true\n+fn main() {\n+    match (1, 2, 3) {\n+        (..) => (),\n+    }\n+}"}]}