{"sha": "30efdeeca1bd0d60412fdb9e88eba6336ffcacea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwZWZkZWVjYTFiZDBkNjA0MTJmZGI5ZTg4ZWJhNjMzNmZmY2FjZWE=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-06-01T19:45:31Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-06-01T19:45:31Z"}, "message": "Visibility is an ELF concept and protected visibility is not very well implemented,\navoid using it for now.\n\nInstead, mark pairs that are not needed elsewhere as internal.", "tree": {"sha": "8e6e044d4515457c2cc5285f95afff7811507b97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e6e044d4515457c2cc5285f95afff7811507b97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30efdeeca1bd0d60412fdb9e88eba6336ffcacea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30efdeeca1bd0d60412fdb9e88eba6336ffcacea", "html_url": "https://github.com/rust-lang/rust/commit/30efdeeca1bd0d60412fdb9e88eba6336ffcacea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30efdeeca1bd0d60412fdb9e88eba6336ffcacea/comments", "author": null, "committer": null, "parents": [{"sha": "2ef2bda276d2fe28d8b15f722850f5f21b226792", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ef2bda276d2fe28d8b15f722850f5f21b226792", "html_url": "https://github.com/rust-lang/rust/commit/2ef2bda276d2fe28d8b15f722850f5f21b226792"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "78850d20fa1b13daab7dacf8489130aad6dc734e", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/30efdeeca1bd0d60412fdb9e88eba6336ffcacea/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30efdeeca1bd0d60412fdb9e88eba6336ffcacea/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=30efdeeca1bd0d60412fdb9e88eba6336ffcacea", "patch": "@@ -7436,9 +7436,12 @@ fn register_fn_pair(&@crate_ctxt cx, str ps, TypeRef llpairty, ValueRef llfn,\n \n     llvm::LLVMSetInitializer(gvar, pair);\n     llvm::LLVMSetGlobalConstant(gvar, True);\n-    llvm::LLVMSetVisibility(gvar,\n-                           lib::llvm::LLVMProtectedVisibility\n-                           as llvm::Visibility);\n+\n+    // FIXME: We should also hide the unexported pairs in crates.\n+    if (!cx.sess.get_opts().shared) {\n+        llvm::LLVMSetLinkage(gvar, lib::llvm::LLVMInternalLinkage\n+                             as llvm::Linkage);\n+    }\n \n     cx.item_ids.insert(id, llfn);\n     cx.item_symbols.insert(id, ps);"}]}