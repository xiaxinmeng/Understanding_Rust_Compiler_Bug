{"sha": "48ed3c058f0e24dab66ce486d0080e96634529c6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4ZWQzYzA1OGYwZTI0ZGFiNjZjZTQ4NmQwMDgwZTk2NjM0NTI5YzY=", "commit": {"author": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2017-09-16T23:17:22Z"}, "committer": {"name": "Marcus Klaas", "email": "mail@marcusklaas.nl", "date": "2017-09-16T23:17:22Z"}, "message": "Extend MANUAL_MEMCPY lint so that it also detects manual clones between slices", "tree": {"sha": "8daa041d87955d82b73b537c5491350afc983b41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8daa041d87955d82b73b537c5491350afc983b41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/48ed3c058f0e24dab66ce486d0080e96634529c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/48ed3c058f0e24dab66ce486d0080e96634529c6", "html_url": "https://github.com/rust-lang/rust/commit/48ed3c058f0e24dab66ce486d0080e96634529c6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/48ed3c058f0e24dab66ce486d0080e96634529c6/comments", "author": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marcusklaas", "id": 1255413, "node_id": "MDQ6VXNlcjEyNTU0MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1255413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marcusklaas", "html_url": "https://github.com/marcusklaas", "followers_url": "https://api.github.com/users/marcusklaas/followers", "following_url": "https://api.github.com/users/marcusklaas/following{/other_user}", "gists_url": "https://api.github.com/users/marcusklaas/gists{/gist_id}", "starred_url": "https://api.github.com/users/marcusklaas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marcusklaas/subscriptions", "organizations_url": "https://api.github.com/users/marcusklaas/orgs", "repos_url": "https://api.github.com/users/marcusklaas/repos", "events_url": "https://api.github.com/users/marcusklaas/events{/privacy}", "received_events_url": "https://api.github.com/users/marcusklaas/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6206cc5f88a1a5396425269c04f91e9e92a3261", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6206cc5f88a1a5396425269c04f91e9e92a3261", "html_url": "https://github.com/rust-lang/rust/commit/a6206cc5f88a1a5396425269c04f91e9e92a3261"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "5beb7eab71debe2881a887555015304c8484e723", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/48ed3c058f0e24dab66ce486d0080e96634529c6/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48ed3c058f0e24dab66ce486d0080e96634529c6/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=48ed3c058f0e24dab66ce486d0080e96634529c6", "patch": "@@ -718,6 +718,23 @@ fn get_fixed_offset_var<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &Expr, var:\n     }\n }\n \n+fn fetch_cloned_fixed_offset_var<'a, 'tcx>(\n+    cx: &LateContext<'a, 'tcx>,\n+    expr: &Expr,\n+    var: ast::NodeId,\n+) -> Option<FixedOffsetVar> {\n+    if_let_chain! {[\n+        let ExprMethodCall(ref method, _, ref args) = expr.node,\n+        method.name == \"clone\",\n+        args.len() == 1,\n+        let Some(arg) = args.get(0),\n+    ], {\n+        return get_fixed_offset_var(cx, arg, var);\n+    }}\n+\n+    get_fixed_offset_var(cx, expr, var)\n+}\n+\n fn get_indexed_assignments<'a, 'tcx>(\n     cx: &LateContext<'a, 'tcx>,\n     body: &Expr,\n@@ -729,7 +746,7 @@ fn get_indexed_assignments<'a, 'tcx>(\n         var: ast::NodeId,\n     ) -> Option<(FixedOffsetVar, FixedOffsetVar)> {\n         if let Expr_::ExprAssign(ref lhs, ref rhs) = e.node {\n-            match (get_fixed_offset_var(cx, lhs, var), get_fixed_offset_var(cx, rhs, var)) {\n+            match (get_fixed_offset_var(cx, lhs, var), fetch_cloned_fixed_offset_var(cx, rhs, var)) {\n                 (Some(offset_left), Some(offset_right)) => Some((offset_left, offset_right)),\n                 _ => None,\n             }"}, {"sha": "79c6c781a7a5aae16a1b7b4069497d2b0c004dde", "filename": "tests/ui/for_loop.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/48ed3c058f0e24dab66ce486d0080e96634529c6/tests%2Fui%2Ffor_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/48ed3c058f0e24dab66ce486d0080e96634529c6/tests%2Fui%2Ffor_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffor_loop.stderr?ref=48ed3c058f0e24dab66ce486d0080e96634529c6", "patch": "@@ -578,5 +578,13 @@ error: it looks like you're manually copying between slices\n 522 | |     }\n     | |_____^ help: try replacing the loop by: `dst_vec[..src_vec.len()].clone_from_slice(&src_vec[..])`\n \n-error: aborting due to 58 previous errors\n+error: it looks like you're manually copying between slices\n+   --> $DIR/for_loop.rs:547:5\n+    |\n+547 | /     for i in 0..src.len() {\n+548 | |         dst[i] = src[i].clone();\n+549 | |     }\n+    | |_____^ help: try replacing the loop by: `dst[..src.len()].clone_from_slice(&src[..])`\n+\n+error: aborting due to 59 previous errors\n "}]}