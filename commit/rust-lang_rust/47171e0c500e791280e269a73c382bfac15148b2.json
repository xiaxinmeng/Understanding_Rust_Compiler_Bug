{"sha": "47171e0c500e791280e269a73c382bfac15148b2", "node_id": "C_kwDOAAsO6NoAKDQ3MTcxZTBjNTAwZTc5MTI4MGUyNjlhNzNjMzgyYmZhYzE1MTQ4YjI", "commit": {"author": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2022-11-06T21:24:20Z"}, "committer": {"name": "Gary Guo", "email": "gary@garyguo.net", "date": "2023-05-07T11:35:54Z"}, "message": "Use `landingpad filter` to encode aborting landing pad", "tree": {"sha": "65e052089fd16288eea113b5d4d35c0d976a73f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/65e052089fd16288eea113b5d4d35c0d976a73f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47171e0c500e791280e269a73c382bfac15148b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47171e0c500e791280e269a73c382bfac15148b2", "html_url": "https://github.com/rust-lang/rust/commit/47171e0c500e791280e269a73c382bfac15148b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47171e0c500e791280e269a73c382bfac15148b2/comments", "author": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nbdd0121", "id": 4065244, "node_id": "MDQ6VXNlcjQwNjUyNDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4065244?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbdd0121", "html_url": "https://github.com/nbdd0121", "followers_url": "https://api.github.com/users/nbdd0121/followers", "following_url": "https://api.github.com/users/nbdd0121/following{/other_user}", "gists_url": "https://api.github.com/users/nbdd0121/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbdd0121/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbdd0121/subscriptions", "organizations_url": "https://api.github.com/users/nbdd0121/orgs", "repos_url": "https://api.github.com/users/nbdd0121/repos", "events_url": "https://api.github.com/users/nbdd0121/events{/privacy}", "received_events_url": "https://api.github.com/users/nbdd0121/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8660707bb22b2fa0ef6e2d37c60da20d9cf3d7b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/8660707bb22b2fa0ef6e2d37c60da20d9cf3d7b9", "html_url": "https://github.com/rust-lang/rust/commit/8660707bb22b2fa0ef6e2d37c60da20d9cf3d7b9"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "5fba09d795ce88203af182e7784d8a35dc5734b7", "filename": "compiler/rustc_codegen_gcc/src/builder.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_gcc%2Fsrc%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_gcc%2Fsrc%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_gcc%2Fsrc%2Fbuilder.rs?ref=47171e0c500e791280e269a73c382bfac15148b2", "patch": "@@ -1227,6 +1227,10 @@ impl<'a, 'gcc, 'tcx> BuilderMethods<'a, 'tcx> for Builder<'a, 'gcc, 'tcx> {\n         (value1, value2)\n     }\n \n+    fn filter_landing_pad(&mut self, pers_fn: RValue<'gcc>) -> (RValue<'gcc>, RValue<'gcc>) {\n+        self.cleanup_landing_pad(pers_fn)\n+    }\n+\n     #[cfg(feature=\"master\")]\n     fn resume(&mut self, exn0: RValue<'gcc>, _exn1: RValue<'gcc>) {\n         let exn_type = exn0.get_type();"}, {"sha": "10da8cc4c255218fe42192083aa5869a7aaf6a06", "filename": "compiler/rustc_codegen_llvm/src/builder.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs?ref=47171e0c500e791280e269a73c382bfac15148b2", "patch": "@@ -992,6 +992,13 @@ impl<'a, 'll, 'tcx> BuilderMethods<'a, 'tcx> for Builder<'a, 'll, 'tcx> {\n         (self.extract_value(landing_pad, 0), self.extract_value(landing_pad, 1))\n     }\n \n+    fn filter_landing_pad(&mut self, pers_fn: &'ll Value) -> (&'ll Value, &'ll Value) {\n+        let ty = self.type_struct(&[self.type_i8p(), self.type_i32()], false);\n+        let landing_pad = self.landing_pad(ty, pers_fn, 1 /* FIXME should this be 0? */);\n+        self.add_clause(landing_pad, self.const_array(self.type_i8p(), &[]));\n+        (self.extract_value(landing_pad, 0), self.extract_value(landing_pad, 1))\n+    }\n+\n     fn resume(&mut self, exn0: &'ll Value, exn1: &'ll Value) {\n         let ty = self.type_struct(&[self.type_i8p(), self.type_i32()], false);\n         let mut exn = self.const_poison(ty);"}, {"sha": "a832999225ab667c89212c885313f3e0ab91e3c1", "filename": "compiler/rustc_codegen_ssa/src/mir/block.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fblock.rs?ref=47171e0c500e791280e269a73c382bfac15148b2", "patch": "@@ -1600,7 +1600,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                 bx = Bx::build(self.cx, llbb);\n \n                 let llpersonality = self.cx.eh_personality();\n-                bx.cleanup_landing_pad(llpersonality);\n+                bx.filter_landing_pad(llpersonality);\n \n                 funclet = None;\n             }"}, {"sha": "853c6934c2c243b68ab7797c7650dadb04abfb8e", "filename": "compiler/rustc_codegen_ssa/src/traits/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_ssa%2Fsrc%2Ftraits%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47171e0c500e791280e269a73c382bfac15148b2/compiler%2Frustc_codegen_ssa%2Fsrc%2Ftraits%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Ftraits%2Fbuilder.rs?ref=47171e0c500e791280e269a73c382bfac15148b2", "patch": "@@ -274,6 +274,7 @@ pub trait BuilderMethods<'a, 'tcx>:\n \n     // These are used by everyone except msvc\n     fn cleanup_landing_pad(&mut self, pers_fn: Self::Value) -> (Self::Value, Self::Value);\n+    fn filter_landing_pad(&mut self, pers_fn: Self::Value) -> (Self::Value, Self::Value);\n     fn resume(&mut self, exn0: Self::Value, exn1: Self::Value);\n \n     // These are used only by msvc"}]}