{"sha": "e078d8271182c0923c671a05d43d2b6e9d8d6e42", "node_id": "C_kwDOAAsO6NoAKGUwNzhkODI3MTE4MmMwOTIzYzY3MWEwNWQ0M2QyYjZlOWQ4ZDZlNDI", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2023-01-11T05:18:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-11T05:18:55Z"}, "message": "Rollup merge of #106645 - c410-f3r:rfc-2397-1, r=oli-obk\n\n[RFC 2397] Initial implementation\n\ncc #51992\n\nBecause of previous experiences where ppl didn't have the time to review large PRs (or any at all), the implementation of this feature will be delivered in small chunks to hopefully make things faster.\n\nIn this initial PR, only the attribute is being declared and gated with ordinary tests.", "tree": {"sha": "51596f372c448aa25c2a939418a9e024cd5b2c76", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/51596f372c448aa25c2a939418a9e024cd5b2c76"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e078d8271182c0923c671a05d43d2b6e9d8d6e42", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjvka/CRBK7hj4Ov3rIwAA4fcIAGcwH6a3n0AUKIkuxICdNxDv\nxA3/wq5mw6WRjV7JTVn52jcDAJwymnrTkt2ZB9mUxhfifR69xYErxrzdvcFMXITe\ntRxUBx9d5SOTXIAdR96HwQB//UyOLXQOUUt5Th9cRhnkvSn4vJIl+/TNSSHJgXyw\nnFvtRctT4Kf40BEeXtQUzNh3wRIpk9bUmscMm+e8DH3jU5C2ZS1nS5OpHuO6bPrd\ny/Rhrj8Av+8lczduNDTLgZYdH7ov77m8pMcNa+A7k59yaeCdOq9nwA55N2GuxnAA\nlCaY/Fh+TJ1g/3Ei/6SErow6t4SLi+i+XFPmoGMS/xjSGd0b/A15HCrSocuCTvU=\n=TitP\n-----END PGP SIGNATURE-----\n", "payload": "tree 51596f372c448aa25c2a939418a9e024cd5b2c76\nparent f547c4b33a87fb167fe9314bd225304e00268fce\nparent c43faf110de5ee6abce0899872457dc8904723ad\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1673414335 +0900\ncommitter GitHub <noreply@github.com> 1673414335 +0900\n\nRollup merge of #106645 - c410-f3r:rfc-2397-1, r=oli-obk\n\n[RFC 2397] Initial implementation\n\ncc #51992\n\nBecause of previous experiences where ppl didn't have the time to review large PRs (or any at all), the implementation of this feature will be delivered in small chunks to hopefully make things faster.\n\nIn this initial PR, only the attribute is being declared and gated with ordinary tests.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e078d8271182c0923c671a05d43d2b6e9d8d6e42", "html_url": "https://github.com/rust-lang/rust/commit/e078d8271182c0923c671a05d43d2b6e9d8d6e42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e078d8271182c0923c671a05d43d2b6e9d8d6e42/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f547c4b33a87fb167fe9314bd225304e00268fce", "url": "https://api.github.com/repos/rust-lang/rust/commits/f547c4b33a87fb167fe9314bd225304e00268fce", "html_url": "https://github.com/rust-lang/rust/commit/f547c4b33a87fb167fe9314bd225304e00268fce"}, {"sha": "c43faf110de5ee6abce0899872457dc8904723ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/c43faf110de5ee6abce0899872457dc8904723ad", "html_url": "https://github.com/rust-lang/rust/commit/c43faf110de5ee6abce0899872457dc8904723ad"}], "stats": {"total": 69, "additions": 69, "deletions": 0}, "files": [{"sha": "691c0955cad7d056f7ed0ef9c18c0c50f04aabf8", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -374,6 +374,8 @@ declare_features! (\n     (active, deprecated_safe, \"1.61.0\", Some(94978), None),\n     /// Allows having using `suggestion` in the `#[deprecated]` attribute.\n     (active, deprecated_suggestion, \"1.61.0\", Some(94785), None),\n+    /// Controls errors in trait implementations.\n+    (active, do_not_recommend, \"1.67.0\", Some(51992), None),\n     /// Tells rustdoc to automatically generate `#[doc(cfg(...))]`.\n     (active, doc_auto_cfg, \"1.58.0\", Some(43781), None),\n     /// Allows `#[doc(cfg(...))]`."}, {"sha": "af56a0b245987059426e27e8919856d7b2e36563", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -487,6 +487,9 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n         experimental!(collapse_debuginfo)\n     ),\n \n+    // RFC 2397\n+    gated!(do_not_recommend, Normal, template!(Word), WarnFollowing, experimental!(do_not_recommend)),\n+\n     // ==========================================================================\n     // Internal attributes: Stability, deprecation, and unsafe:\n     // =========================================================================="}, {"sha": "fbb12701d96ab05b7a9d8e22b8ef873de6ffe4d5", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -613,6 +613,7 @@ symbols! {\n         dispatch_from_dyn,\n         div,\n         div_assign,\n+        do_not_recommend,\n         doc,\n         doc_alias,\n         doc_auto_cfg,"}, {"sha": "5053c115b45377e7ed748399508f3d6f3dab54e9", "filename": "src/test/ui/rfc-2397-do-not-recommend/feature-gate-do_not_recommend.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.rs?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -0,0 +1,21 @@\n+#![feature(do_not_recommend)]\n+\n+pub trait Foo {\n+}\n+\n+impl Foo for i32 {\n+}\n+\n+pub trait Bar {\n+}\n+\n+#[do_not_recommend]\n+impl<T: Foo> Bar for T {\n+}\n+\n+fn stuff<T: Bar>(_: T) {}\n+\n+fn main() {\n+    stuff(1u8);\n+    //~^ the trait bound `u8: Foo` is not satisfied\n+}"}, {"sha": "2749add82ac0ce36989b27949c6d13c0d7f212d7", "filename": "src/test/ui/rfc-2397-do-not-recommend/feature-gate-do_not_recommend.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Ffeature-gate-do_not_recommend.stderr?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -0,0 +1,23 @@\n+error[E0277]: the trait bound `u8: Foo` is not satisfied\n+  --> $DIR/feature-gate-do_not_recommend.rs:19:11\n+   |\n+LL |     stuff(1u8);\n+   |     ----- ^^^ the trait `Foo` is not implemented for `u8`\n+   |     |\n+   |     required by a bound introduced by this call\n+   |\n+   = help: the trait `Foo` is implemented for `i32`\n+note: required for `u8` to implement `Bar`\n+  --> $DIR/feature-gate-do_not_recommend.rs:13:14\n+   |\n+LL | impl<T: Foo> Bar for T {\n+   |              ^^^     ^\n+note: required by a bound in `stuff`\n+  --> $DIR/feature-gate-do_not_recommend.rs:16:13\n+   |\n+LL | fn stuff<T: Bar>(_: T) {}\n+   |             ^^^ required by this bound in `stuff`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "b816c4a19da1dce877332070843e4a5c9cf637c3", "filename": "src/test/ui/rfc-2397-do-not-recommend/unstable-feature.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.rs?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -0,0 +1,7 @@\n+#[do_not_recommend]\n+//~^ ERROR the `#[do_not_recommend]` attribute is an experimental feature\n+trait Foo {\n+}\n+\n+fn main() {\n+}"}, {"sha": "425d7e4bca0bd138370c46533f4b29fcac894968", "filename": "src/test/ui/rfc-2397-do-not-recommend/unstable-feature.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e078d8271182c0923c671a05d43d2b6e9d8d6e42/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2397-do-not-recommend%2Funstable-feature.stderr?ref=e078d8271182c0923c671a05d43d2b6e9d8d6e42", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: the `#[do_not_recommend]` attribute is an experimental feature\n+  --> $DIR/unstable-feature.rs:1:1\n+   |\n+LL | #[do_not_recommend]\n+   | ^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #51992 <https://github.com/rust-lang/rust/issues/51992> for more information\n+   = help: add `#![feature(do_not_recommend)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}