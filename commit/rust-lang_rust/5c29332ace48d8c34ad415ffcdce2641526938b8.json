{"sha": "5c29332ace48d8c34ad415ffcdce2641526938b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjMjkzMzJhY2U0OGQ4YzM0YWQ0MTVmZmNkY2UyNjQxNTI2OTM4Yjg=", "commit": {"author": {"name": "Rich Kadel", "email": "richkadel@google.com", "date": "2020-09-16T15:10:06Z"}, "committer": {"name": "Rich Kadel", "email": "richkadel@google.com", "date": "2020-09-16T15:10:06Z"}, "message": "Make graphviz font configurable\n\nAlternative to PR ##76776.\n\nTo change the graphviz output to use an alternative `fontname` value,\nadd a command line option like: `rustc --graphviz-font=monospace`.", "tree": {"sha": "728e033d3f83aa8fce29aa9243c104651fe76c28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/728e033d3f83aa8fce29aa9243c104651fe76c28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c29332ace48d8c34ad415ffcdce2641526938b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c29332ace48d8c34ad415ffcdce2641526938b8", "html_url": "https://github.com/rust-lang/rust/commit/5c29332ace48d8c34ad415ffcdce2641526938b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c29332ace48d8c34ad415ffcdce2641526938b8/comments", "author": {"login": "richkadel", "id": 3827298, "node_id": "MDQ6VXNlcjM4MjcyOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3827298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richkadel", "html_url": "https://github.com/richkadel", "followers_url": "https://api.github.com/users/richkadel/followers", "following_url": "https://api.github.com/users/richkadel/following{/other_user}", "gists_url": "https://api.github.com/users/richkadel/gists{/gist_id}", "starred_url": "https://api.github.com/users/richkadel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richkadel/subscriptions", "organizations_url": "https://api.github.com/users/richkadel/orgs", "repos_url": "https://api.github.com/users/richkadel/repos", "events_url": "https://api.github.com/users/richkadel/events{/privacy}", "received_events_url": "https://api.github.com/users/richkadel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "richkadel", "id": 3827298, "node_id": "MDQ6VXNlcjM4MjcyOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3827298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richkadel", "html_url": "https://github.com/richkadel", "followers_url": "https://api.github.com/users/richkadel/followers", "following_url": "https://api.github.com/users/richkadel/following{/other_user}", "gists_url": "https://api.github.com/users/richkadel/gists{/gist_id}", "starred_url": "https://api.github.com/users/richkadel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richkadel/subscriptions", "organizations_url": "https://api.github.com/users/richkadel/orgs", "repos_url": "https://api.github.com/users/richkadel/repos", "events_url": "https://api.github.com/users/richkadel/events{/privacy}", "received_events_url": "https://api.github.com/users/richkadel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7aee330c70ef787d2224adb49804343978dd145", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7aee330c70ef787d2224adb49804343978dd145", "html_url": "https://github.com/rust-lang/rust/commit/f7aee330c70ef787d2224adb49804343978dd145"}], "stats": {"total": 28, "additions": 17, "deletions": 11}, "files": [{"sha": "58db81bc1dc619c35d5d6c2ef984f95d928a23b9", "filename": "compiler/rustc_graphviz/src/lib.rs", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_graphviz%2Fsrc%2Flib.rs?ref=5c29332ace48d8c34ad415ffcdce2641526938b8", "patch": "@@ -591,14 +591,14 @@ pub trait GraphWalk<'a> {\n     fn target(&'a self, edge: &Self::Edge) -> Self::Node;\n }\n \n-#[derive(Copy, Clone, PartialEq, Eq, Debug)]\n+#[derive(Clone, PartialEq, Eq, Debug)]\n pub enum RenderOption {\n     NoEdgeLabels,\n     NoNodeLabels,\n     NoEdgeStyles,\n     NoNodeStyles,\n \n-    Monospace,\n+    Fontname(String),\n     DarkTheme,\n }\n \n@@ -633,11 +633,14 @@ where\n     // Global graph properties\n     let mut graph_attrs = Vec::new();\n     let mut content_attrs = Vec::new();\n-    if options.contains(&RenderOption::Monospace) {\n-        let font = r#\"fontname=\"Courier, monospace\"\"#;\n-        graph_attrs.push(font);\n-        content_attrs.push(font);\n-    };\n+    let font;\n+    if let Some(fontname) = options.iter().find_map(|option| {\n+        if let RenderOption::Fontname(fontname) = option { Some(fontname) } else { None }\n+    }) {\n+        font = format!(r#\"fontname=\"{}\"\"#, fontname);\n+        graph_attrs.push(&font[..]);\n+        content_attrs.push(&font[..]);\n+    }\n     if options.contains(&RenderOption::DarkTheme) {\n         graph_attrs.push(r#\"bgcolor=\"black\"\"#);\n         content_attrs.push(r#\"color=\"white\"\"#);"}, {"sha": "4084083bd9956a4a493aee952e254243e2812937", "filename": "compiler/rustc_mir/src/dataflow/framework/engine.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fdataflow%2Fframework%2Fengine.rs?ref=5c29332ace48d8c34ad415ffcdce2641526938b8", "patch": "@@ -306,7 +306,8 @@ where\n     let mut buf = Vec::new();\n \n     let graphviz = graphviz::Formatter::new(body, def_id, results, style);\n-    let mut render_opts = vec![dot::RenderOption::Monospace];\n+    let mut render_opts =\n+        vec![dot::RenderOption::Fontname(tcx.sess.opts.debugging_opts.graphviz_font.clone())];\n     if tcx.sess.opts.debugging_opts.graphviz_dark_mode {\n         render_opts.push(dot::RenderOption::DarkTheme);\n     }"}, {"sha": "4511962d68f032dcfccfc933aa943c8f2f3fd383", "filename": "compiler/rustc_mir/src/util/graphviz.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Futil%2Fgraphviz.rs?ref=5c29332ace48d8c34ad415ffcdce2641526938b8", "patch": "@@ -55,9 +55,9 @@ where\n     writeln!(w, \"{} {}Mir_{} {{\", kind, cluster, def_name)?;\n \n     // Global graph properties\n-    let font = r#\"fontname=\"Courier, monospace\"\"#;\n-    let mut graph_attrs = vec![font];\n-    let mut content_attrs = vec![font];\n+    let font = format!(r#\"fontname=\"{}\"\"#, tcx.sess.opts.debugging_opts.graphviz_font);\n+    let mut graph_attrs = vec![&font[..]];\n+    let mut content_attrs = vec![&font[..]];\n \n     let dark_mode = tcx.sess.opts.debugging_opts.graphviz_dark_mode;\n     if dark_mode {"}, {"sha": "60bd557b880eb956f846d16ac9fc425d5eca9bba", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c29332ace48d8c34ad415ffcdce2641526938b8/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=5c29332ace48d8c34ad415ffcdce2641526938b8", "patch": "@@ -909,6 +909,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"set the optimization fuel quota for a crate\"),\n     graphviz_dark_mode: bool = (false, parse_bool, [UNTRACKED],\n         \"use dark-themed colors in graphviz output (default: no)\"),\n+    graphviz_font: String = (\"Courier, monospace\".to_string(), parse_string, [UNTRACKED],\n+        \"use the given `fontname` in graphviz output (default: `Courier, monospace`)\"),\n     hir_stats: bool = (false, parse_bool, [UNTRACKED],\n         \"print some statistics about AST and HIR (default: no)\"),\n     human_readable_cgu_names: bool = (false, parse_bool, [TRACKED],"}]}