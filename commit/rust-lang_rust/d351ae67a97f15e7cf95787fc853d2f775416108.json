{"sha": "d351ae67a97f15e7cf95787fc853d2f775416108", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzNTFhZTY3YTk3ZjE1ZTdjZjk1Nzg3ZmM4NTNkMmY3NzU0MTYxMDg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-28T18:14:13Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-28T18:14:13Z"}, "message": "Smart return completion", "tree": {"sha": "7ff7f09c826626dcc277dc702c0dcbd8ca0dda8b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ff7f09c826626dcc277dc702c0dcbd8ca0dda8b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d351ae67a97f15e7cf95787fc853d2f775416108", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d351ae67a97f15e7cf95787fc853d2f775416108", "html_url": "https://github.com/rust-lang/rust/commit/d351ae67a97f15e7cf95787fc853d2f775416108", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d351ae67a97f15e7cf95787fc853d2f775416108/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2257c08cb159a30492bf2aec172539b1dd504700", "url": "https://api.github.com/repos/rust-lang/rust/commits/2257c08cb159a30492bf2aec172539b1dd504700", "html_url": "https://github.com/rust-lang/rust/commit/2257c08cb159a30492bf2aec172539b1dd504700"}], "stats": {"total": 29, "additions": 24, "deletions": 5}, "files": [{"sha": "cfb1c0d1be4012402b8c802564193666ab35da0b", "filename": "crates/libeditor/src/completion.rs", "status": "modified", "additions": 24, "deletions": 5, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/d351ae67a97f15e7cf95787fc853d2f775416108/crates%2Flibeditor%2Fsrc%2Fcompletion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d351ae67a97f15e7cf95787fc853d2f775416108/crates%2Flibeditor%2Fsrc%2Fcompletion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibeditor%2Fsrc%2Fcompletion.rs?ref=d351ae67a97f15e7cf95787fc853d2f775416108", "patch": "@@ -75,9 +75,13 @@ fn complete_keywords(file: &File, fn_def: Option<ast::FnDef>, name_ref: ast::Nam\n         }\n     }\n \n-    // if let Some(fn_def) = fn_def {\n-    //     acc.push(keyword(\"return\", \"\"))\n-    // }\n+    if let Some(fn_def) = fn_def {\n+        if fn_def.ret_type().is_some() {\n+            acc.push(keyword(\"return\", \"return $0;\"))\n+        } else {\n+            acc.push(keyword(\"return\", \"return;\"))\n+        }\n+    }\n \n     fn keyword(kw: &str, snip: &str) -> CompletionItem {\n         CompletionItem {\n@@ -189,7 +193,8 @@ mod tests {\n             \", r#\"[CompletionItem { name: \"if\", snippet: Some(\"if $0 { }\") },\n                    CompletionItem { name: \"match\", snippet: Some(\"match $0 { }\") },\n                    CompletionItem { name: \"while\", snippet: Some(\"while $0 { }\") },\n-                   CompletionItem { name: \"loop\", snippet: Some(\"loop {$0}\") }]\"#);\n+                   CompletionItem { name: \"loop\", snippet: Some(\"loop {$0}\") },\n+                   CompletionItem { name: \"return\", snippet: Some(\"return;\") }]\"#);\n     }\n \n     #[test]\n@@ -205,6 +210,20 @@ mod tests {\n                    CompletionItem { name: \"while\", snippet: Some(\"while $0 { }\") },\n                    CompletionItem { name: \"loop\", snippet: Some(\"loop {$0}\") },\n                    CompletionItem { name: \"else\", snippet: Some(\"else {$0}\") },\n-                   CompletionItem { name: \"else if\", snippet: Some(\"else if $0 { }\") }]\"#);\n+                   CompletionItem { name: \"else if\", snippet: Some(\"else if $0 { }\") },\n+                   CompletionItem { name: \"return\", snippet: Some(\"return;\") }]\"#);\n+    }\n+\n+    #[test]\n+    fn test_completion_return_value() {\n+        check_snippet_completion(r\"\n+            fn quux() -> i32{\n+                <|>\n+            }\n+            \", r#\"[CompletionItem { name: \"if\", snippet: Some(\"if $0 { }\") },\n+                   CompletionItem { name: \"match\", snippet: Some(\"match $0 { }\") },\n+                   CompletionItem { name: \"while\", snippet: Some(\"while $0 { }\") },\n+                   CompletionItem { name: \"loop\", snippet: Some(\"loop {$0}\") },\n+                   CompletionItem { name: \"return\", snippet: Some(\"return $0;\") }]\"#);\n     }\n }"}]}