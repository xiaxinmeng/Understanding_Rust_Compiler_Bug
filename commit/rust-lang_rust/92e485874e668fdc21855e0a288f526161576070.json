{"sha": "92e485874e668fdc21855e0a288f526161576070", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyZTQ4NTg3NGU2NjhmZGMyMTg1NWUwYTI4OGY1MjYxNjE1NzYwNzA=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-03-08T12:23:23Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-03-17T19:51:53Z"}, "message": "mir: Load FatPtr constants instead of keeping them indirect.", "tree": {"sha": "496e4d33d1ca2a0e0d69ef3af10e15083bccfec2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/496e4d33d1ca2a0e0d69ef3af10e15083bccfec2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92e485874e668fdc21855e0a288f526161576070", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92e485874e668fdc21855e0a288f526161576070", "html_url": "https://github.com/rust-lang/rust/commit/92e485874e668fdc21855e0a288f526161576070", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92e485874e668fdc21855e0a288f526161576070/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb43d952118f8d33e221c00f71a343f32ce17655", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb43d952118f8d33e221c00f71a343f32ce17655", "html_url": "https://github.com/rust-lang/rust/commit/eb43d952118f8d33e221c00f71a343f32ce17655"}], "stats": {"total": 24, "additions": 13, "deletions": 11}, "files": [{"sha": "06eef5d300520fcd9206a84a1c1075d991397e92", "filename": "src/librustc_trans/trans/mir/constant.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/92e485874e668fdc21855e0a288f526161576070/src%2Flibrustc_trans%2Ftrans%2Fmir%2Fconstant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92e485874e668fdc21855e0a288f526161576070/src%2Flibrustc_trans%2Ftrans%2Fmir%2Fconstant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmir%2Fconstant.rs?ref=92e485874e668fdc21855e0a288f526161576070", "patch": "@@ -17,6 +17,7 @@ use trans::abi;\n use trans::common::{self, BlockAndBuilder, C_bool, C_bytes, C_floating_f64, C_integral,\n                     C_str_slice, C_undef};\n use trans::consts;\n+use trans::datum;\n use trans::expr;\n use trans::inline;\n use trans::type_of;\n@@ -122,7 +123,18 @@ impl<'bcx, 'tcx> MirContext<'bcx, 'tcx> {\n                 let d = bcx.with_block(|bcx| {\n                     expr::trans(bcx, expr)\n                 });\n-                OperandRef::from_rvalue_datum(d.datum.to_rvalue_datum(d.bcx, \"\").datum)\n+\n+                let datum = d.datum.to_rvalue_datum(d.bcx, \"\").datum;\n+\n+                match datum.kind.mode {\n+                    datum::RvalueMode::ByValue => {\n+                        OperandRef {\n+                            ty: datum.ty,\n+                            val: OperandValue::Immediate(datum.val)\n+                        }\n+                    }\n+                    datum::RvalueMode::ByRef => self.trans_load(bcx, datum.val, datum.ty)\n+                }\n             }\n             mir::Literal::Value { ref value } => {\n                 self.trans_constval(bcx, value, ty)"}, {"sha": "d1b2025fd4c46a233a92d78efbd161705574783a", "filename": "src/librustc_trans/trans/mir/operand.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92e485874e668fdc21855e0a288f526161576070/src%2Flibrustc_trans%2Ftrans%2Fmir%2Foperand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92e485874e668fdc21855e0a288f526161576070/src%2Flibrustc_trans%2Ftrans%2Fmir%2Foperand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fmir%2Foperand.rs?ref=92e485874e668fdc21855e0a288f526161576070", "patch": "@@ -81,16 +81,6 @@ impl<'tcx> OperandRef<'tcx> {\n             _ => unreachable!()\n         }\n     }\n-\n-    pub fn from_rvalue_datum(datum: datum::Datum<'tcx, datum::Rvalue>) -> OperandRef {\n-        OperandRef {\n-            ty: datum.ty,\n-            val: match datum.kind.mode {\n-                datum::RvalueMode::ByRef => OperandValue::Ref(datum.val),\n-                datum::RvalueMode::ByValue => OperandValue::Immediate(datum.val),\n-            }\n-        }\n-    }\n }\n \n impl<'bcx, 'tcx> MirContext<'bcx, 'tcx> {"}]}