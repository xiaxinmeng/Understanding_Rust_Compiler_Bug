{"sha": "8700b45b67b2cc138718a17fdb606db0944d03aa", "node_id": "C_kwDOAAsO6NoAKDg3MDBiNDViNjdiMmNjMTM4NzE4YTE3ZmRiNjA2ZGIwOTQ0ZDAzYWE", "commit": {"author": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-02-12T02:04:44Z"}, "committer": {"name": "Eric Holk", "email": "ericholk@microsoft.com", "date": "2022-03-07T16:47:18Z"}, "message": "Stabilize const_impl_trait as well", "tree": {"sha": "3ac4d60e8857b49eb6f8659aabd5a9326707c356", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ac4d60e8857b49eb6f8659aabd5a9326707c356"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8700b45b67b2cc138718a17fdb606db0944d03aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8700b45b67b2cc138718a17fdb606db0944d03aa", "html_url": "https://github.com/rust-lang/rust/commit/8700b45b67b2cc138718a17fdb606db0944d03aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8700b45b67b2cc138718a17fdb606db0944d03aa/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "801be21d11806d37bacd7c7adaeb93a33871f31e", "url": "https://api.github.com/repos/rust-lang/rust/commits/801be21d11806d37bacd7c7adaeb93a33871f31e", "html_url": "https://github.com/rust-lang/rust/commit/801be21d11806d37bacd7c7adaeb93a33871f31e"}], "stats": {"total": 63, "additions": 5, "deletions": 58}, "files": [{"sha": "7dc279cc840fba930b174c3e11b720e82c91d9d8", "filename": "compiler/rustc_const_eval/src/transform/check_consts/check.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fcheck.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -356,7 +356,6 @@ impl<'mir, 'tcx> Checker<'mir, 'tcx> {\n \n             match *ty.kind() {\n                 ty::Ref(_, _, hir::Mutability::Mut) => self.check_op(ops::ty::MutRef(kind)),\n-                ty::Opaque(..) => self.check_op(ops::ty::ImplTrait),\n                 _ => {}\n             }\n         }"}, {"sha": "ba248a3b6cbe59e286d9b84a1e21770f6c962c41", "filename": "compiler/rustc_const_eval/src/transform/check_consts/ops.rs", "status": "modified", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fcheck_consts%2Fops.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -795,25 +795,4 @@ pub mod ty {\n             )\n         }\n     }\n-\n-    #[derive(Debug)]\n-    pub struct ImplTrait;\n-    impl<'tcx> NonConstOp<'tcx> for ImplTrait {\n-        fn status_in_item(&self, _: &ConstCx<'_, '_>) -> Status {\n-            Status::Unstable(sym::const_impl_trait)\n-        }\n-\n-        fn build_error(\n-            &self,\n-            ccx: &ConstCx<'_, 'tcx>,\n-            span: Span,\n-        ) -> DiagnosticBuilder<'tcx, ErrorGuaranteed> {\n-            feature_err(\n-                &ccx.tcx.sess.parse_sess,\n-                sym::const_impl_trait,\n-                span,\n-                &format!(\"`impl Trait` is not allowed in {}s\", ccx.const_kind()),\n-            )\n-        }\n-    }\n }"}, {"sha": "3fa11a6cd6325faafab6faeb055fa3fe8738a090", "filename": "compiler/rustc_feature/src/accepted.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -100,6 +100,8 @@ declare_features! (\n     (accepted, const_generics_defaults, \"1.59.0\", Some(44580), None),\n     /// Allows the use of `if` and `match` in constants.\n     (accepted, const_if_match, \"1.46.0\", Some(49146), None),\n+    /// Allows argument and return position `impl Trait` in a `const fn`.\n+    (accepted, const_impl_trait, \"1.60.0\", Some(77463), None),\n     /// Allows indexing into constant arrays.\n     (accepted, const_indexing, \"1.26.0\", Some(29947), None),\n     /// Allows let bindings, assignments and destructuring in `const` functions and constants."}, {"sha": "a69d28b184aed8b1ee5102286fc8ebd78ae2bff5", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -340,8 +340,6 @@ declare_features! (\n     (active, const_fn_floating_point_arithmetic, \"1.48.0\", Some(57241), None),\n     /// Allows `for _ in _` loops in const contexts.\n     (active, const_for, \"1.56.0\", Some(87575), None),\n-    /// Allows argument and return position `impl Trait` in a `const fn`.\n-    (active, const_impl_trait, \"1.48.0\", Some(77463), None),\n     /// Allows using `&mut` in constant functions.\n     (active, const_mut_refs, \"1.41.0\", Some(57349), None),\n     /// Be more precise when looking for live drops in a const context."}, {"sha": "f436afbee448e4cb375ec379621c130fb9b8e7c0", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -160,7 +160,7 @@\n #![feature(const_fn_floating_point_arithmetic)]\n #![cfg_attr(bootstrap, feature(const_fn_fn_ptr_basics))]\n #![cfg_attr(bootstrap, feature(const_fn_trait_bound))]\n-#![feature(const_impl_trait)]\n+#![cfg_attr(bootstrap, feature(const_impl_trait))]\n #![feature(const_mut_refs)]\n #![feature(const_precise_live_drops)]\n #![feature(const_refs_to_cell)]"}, {"sha": "e062c9f0aa38c4cc80c0187b22e510edf041027a", "filename": "src/test/ui/consts/min_const_fn/min_const_fn_impl_trait.rs", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/801be21d11806d37bacd7c7adaeb93a33871f31e/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/801be21d11806d37bacd7c7adaeb93a33871f31e/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.rs?ref=801be21d11806d37bacd7c7adaeb93a33871f31e", "patch": "@@ -1,10 +0,0 @@\n-// gate-test-const_impl_trait\n-\n-struct AlanTuring<T>(T);\n-const fn no_rpit2() -> AlanTuring<impl std::fmt::Debug> { //~ `impl Trait`\n-    AlanTuring(0)\n-}\n-\n-const fn no_rpit() -> impl std::fmt::Debug {} //~ `impl Trait`\n-\n-fn main() {}"}, {"sha": "01c797cd96b4db422420dad736e7ec007fadcbd6", "filename": "src/test/ui/consts/min_const_fn/min_const_fn_impl_trait.stderr", "status": "removed", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/801be21d11806d37bacd7c7adaeb93a33871f31e/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/801be21d11806d37bacd7c7adaeb93a33871f31e/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmin_const_fn%2Fmin_const_fn_impl_trait.stderr?ref=801be21d11806d37bacd7c7adaeb93a33871f31e", "patch": "@@ -1,21 +0,0 @@\n-error[E0658]: `impl Trait` is not allowed in constant functions\n-  --> $DIR/min_const_fn_impl_trait.rs:4:24\n-   |\n-LL | const fn no_rpit2() -> AlanTuring<impl std::fmt::Debug> {\n-   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: see issue #77463 <https://github.com/rust-lang/rust/issues/77463> for more information\n-   = help: add `#![feature(const_impl_trait)]` to the crate attributes to enable\n-\n-error[E0658]: `impl Trait` is not allowed in constant functions\n-  --> $DIR/min_const_fn_impl_trait.rs:8:23\n-   |\n-LL | const fn no_rpit() -> impl std::fmt::Debug {}\n-   |                       ^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: see issue #77463 <https://github.com/rust-lang/rust/issues/77463> for more information\n-   = help: add `#![feature(const_impl_trait)]` to the crate attributes to enable\n-\n-error: aborting due to 2 previous errors\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "007dcf3bcb6800d466d3f466909c0a1a7437e7bc", "filename": "src/test/ui/type-alias-impl-trait/issue-53096.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53096.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53096.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53096.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -1,4 +1,4 @@\n-#![feature(const_impl_trait, rustc_attrs)]\n+#![feature(rustc_attrs)]\n #![feature(type_alias_impl_trait)]\n \n type Foo = impl Fn() -> usize;"}, {"sha": "a3f126d56cf204c6cc704a636b389d85d73ef99f", "filename": "src/test/ui/type-alias-impl-trait/issue-53678-generator-and-const-fn.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8700b45b67b2cc138718a17fdb606db0944d03aa/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53678-generator-and-const-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8700b45b67b2cc138718a17fdb606db0944d03aa/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53678-generator-and-const-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53678-generator-and-const-fn.rs?ref=8700b45b67b2cc138718a17fdb606db0944d03aa", "patch": "@@ -1,4 +1,4 @@\n-#![feature(const_impl_trait, generators, generator_trait, rustc_attrs)]\n+#![feature(generators, generator_trait, rustc_attrs)]\n #![feature(type_alias_impl_trait)]\n \n use std::ops::Generator;"}]}