{"sha": "d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQxZjFmMzhjMGU5ZTgzMTFiYWU1MDYwOGVlYWViNDRmYTgzYzFmZmU=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-04-14T18:49:09Z"}, "committer": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-04-14T18:49:09Z"}, "message": "Rollup merge of #32865 - caipre:llvm-ninja, r=alexcrichton\n\nAdd rustbuild option to use Ninja for LLVM build\n\nThis change adds support for a `ninja` option in the `[llvm]` section of rustbuild's `config.toml`. When `true`, the option enables use of the Ninja build tool. Note that this change does not add support for Ninja to the old makefile based build system.\n\nCloses https://github.com/rust-lang/rust/issues/32809\n\nr? @alexcrichton", "tree": {"sha": "a318a390b3145c45432adcfae853743ea93290fa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a318a390b3145c45432adcfae853743ea93290fa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "html_url": "https://github.com/rust-lang/rust/commit/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eae0b72ad830526f2492f554b70242e4d6df3ed4", "url": "https://api.github.com/repos/rust-lang/rust/commits/eae0b72ad830526f2492f554b70242e4d6df3ed4", "html_url": "https://github.com/rust-lang/rust/commit/eae0b72ad830526f2492f554b70242e4d6df3ed4"}, {"sha": "7dd0bebff406dae343b8ae1b242940284986526d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7dd0bebff406dae343b8ae1b242940284986526d", "html_url": "https://github.com/rust-lang/rust/commit/7dd0bebff406dae343b8ae1b242940284986526d"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "9bb3e79744bb634b0f5838b5e9f87ff8c2b1d893", "filename": "src/bootstrap/Cargo.lock", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.lock?ref=d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "patch": "@@ -3,7 +3,7 @@ name = \"bootstrap\"\n version = \"0.0.0\"\n dependencies = [\n  \"build_helper 0.1.0\",\n- \"cmake 0.1.16 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"cmake 0.1.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"gcc 0.3.26 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -21,7 +21,7 @@ version = \"0.1.0\"\n \n [[package]]\n name = \"cmake\"\n-version = \"0.1.16\"\n+version = \"0.1.17\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"gcc 0.3.26 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "7b379e1c7b6b9443dacb55701ccfe4dda278d1ba", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "patch": "@@ -21,7 +21,7 @@ path = \"rustdoc.rs\"\n \n [dependencies]\n build_helper = { path = \"../build_helper\" }\n-cmake = \"0.1.10\"\n+cmake = \"0.1.17\"\n filetime = \"0.1\"\n num_cpus = \"0.2\"\n toml = \"0.1\""}, {"sha": "98fdaae64a5f202cd73d3c510daec05cfaa1fb82", "filename": "src/bootstrap/build/config.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fconfig.rs?ref=d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "patch": "@@ -31,6 +31,7 @@ use toml::{Parser, Decoder, Value};\n #[derive(Default)]\n pub struct Config {\n     pub ccache: bool,\n+    pub ninja: bool,\n     pub verbose: bool,\n     pub submodules: bool,\n     pub compiler_docs: bool,\n@@ -107,6 +108,7 @@ struct Build {\n #[derive(RustcDecodable, Default)]\n struct Llvm {\n     ccache: Option<bool>,\n+    ninja: Option<bool>,\n     assertions: Option<bool>,\n     optimize: Option<bool>,\n     version_check: Option<bool>,\n@@ -200,9 +202,9 @@ impl Config {\n \n         if let Some(ref llvm) = toml.llvm {\n             set(&mut config.ccache, llvm.ccache);\n+            set(&mut config.ninja, llvm.ninja);\n             set(&mut config.llvm_assertions, llvm.assertions);\n             set(&mut config.llvm_optimize, llvm.optimize);\n-            set(&mut config.llvm_optimize, llvm.optimize);\n             set(&mut config.llvm_version_check, llvm.version_check);\n             set(&mut config.llvm_static_stdcpp, llvm.static_libstdcpp);\n         }"}, {"sha": "91bc0924b1fef36ca07a17347bc834601100197a", "filename": "src/bootstrap/build/native.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fnative.rs?ref=d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "patch": "@@ -43,6 +43,9 @@ pub fn llvm(build: &Build, target: &str) {\n \n     // http://llvm.org/docs/CMake.html\n     let mut cfg = cmake::Config::new(build.src.join(\"src/llvm\"));\n+    if build.config.ninja {\n+        cfg.generator(\"Ninja\");\n+    }\n     cfg.target(target)\n        .host(&build.config.build)\n        .out_dir(&dst)"}, {"sha": "50fd9c2453826f897607cb3219e2cfbc394dc522", "filename": "src/bootstrap/build/sanity.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe/src%2Fbootstrap%2Fbuild%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fsanity.rs?ref=d1f1f38c0e9e8311bae50608eeaeb44fa83c1ffe", "patch": "@@ -48,6 +48,9 @@ pub fn check(build: &mut Build) {\n             }\n         }\n         need_cmd(\"cmake\".as_ref());\n+        if build.config.ninja {\n+            need_cmd(\"ninja\".as_ref())\n+        }\n         break\n     }\n "}]}