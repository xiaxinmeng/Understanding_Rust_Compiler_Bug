{"sha": "47456ad4ef7c011cef4274439df555cc7b3c2911", "node_id": "C_kwDOAAsO6NoAKDQ3NDU2YWQ0ZWY3YzAxMWNlZjQyNzQ0MzlkZjU1NWNjN2IzYzI5MTE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-04T04:08:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-04T04:08:08Z"}, "message": "Rollup merge of #98774 - notriddle:notriddle/source-code-sidebar-button, r=GuillaumeGomez\n\nrustdoc: make source sidebar toggle a real button\n\nThis fixes tab focus, so that you can open and close the sidebar from keyboard.\n\nThis should cause no visible change in appearance at all. The only way you'd know anything different is if you tried to use keyboard controls to open the source code file navigation sidebar.\n\nSeparated out from #98772", "tree": {"sha": "a795212617d517516817c5a943a1bee19d0d03b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a795212617d517516817c5a943a1bee19d0d03b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47456ad4ef7c011cef4274439df555cc7b3c2911", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiwmeoCRBK7hj4Ov3rIwAAuHcIABgXfoRCjjL7UDri1LCR+NMd\n8+Ctld2m/QoZpM34AwzvhK1Gg3p31Zz4XvGuu8J4YvRf1/BzVyiilzY1vPJbl7J1\noA0g0Xy+I0QSM0j5w6D/6ql5NpRby4TnrUfqpyNzMBepy77CCHnF6XcmwlHxP3hd\nZZ566I4eHq97tSEeXusBCLbqS0+0KAbFzpxF5ISVp8tCz8JPMLqhf1D57Lx3G17H\n8eCN3d4cB5cpmabv8tW8BoPuVwbD6axtMvLx0X7eTK4taVsEn3NJtCMjSb1rwRmG\nHQQUuCEG1u/WWuQr8WjCM+jhKy8ErxxoeLEPqk1kGLGIcazHzMe7vgrg6NuKeVU=\n=y7fH\n-----END PGP SIGNATURE-----\n", "payload": "tree a795212617d517516817c5a943a1bee19d0d03b8\nparent 7352c7b6cda42e7aaf8f13060ee12bd0cd15c99a\nparent 9938d56d8cefb09584f6b75136ecb22a3d3dd759\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1656907688 +0200\ncommitter GitHub <noreply@github.com> 1656907688 +0200\n\nRollup merge of #98774 - notriddle:notriddle/source-code-sidebar-button, r=GuillaumeGomez\n\nrustdoc: make source sidebar toggle a real button\n\nThis fixes tab focus, so that you can open and close the sidebar from keyboard.\n\nThis should cause no visible change in appearance at all. The only way you'd know anything different is if you tried to use keyboard controls to open the source code file navigation sidebar.\n\nSeparated out from #98772\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47456ad4ef7c011cef4274439df555cc7b3c2911", "html_url": "https://github.com/rust-lang/rust/commit/47456ad4ef7c011cef4274439df555cc7b3c2911", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47456ad4ef7c011cef4274439df555cc7b3c2911/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7352c7b6cda42e7aaf8f13060ee12bd0cd15c99a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7352c7b6cda42e7aaf8f13060ee12bd0cd15c99a", "html_url": "https://github.com/rust-lang/rust/commit/7352c7b6cda42e7aaf8f13060ee12bd0cd15c99a"}, {"sha": "9938d56d8cefb09584f6b75136ecb22a3d3dd759", "url": "https://api.github.com/repos/rust-lang/rust/commits/9938d56d8cefb09584f6b75136ecb22a3d3dd759", "html_url": "https://github.com/rust-lang/rust/commit/9938d56d8cefb09584f6b75136ecb22a3d3dd759"}], "stats": {"total": 55, "additions": 49, "deletions": 6}, "files": [{"sha": "8d99b85bebecec01810312404083d6ba6c613a08", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=47456ad4ef7c011cef4274439df555cc7b3c2911", "patch": "@@ -418,7 +418,7 @@ nav.sub {\n \tbackground-color: var(--sidebar-background-color);\n }\n \n-#sidebar-toggle:hover {\n+#sidebar-toggle > button:hover, #sidebar-toggle > button:focus {\n \tbackground-color: var(--sidebar-background-color-hover);\n }\n \n@@ -1401,7 +1401,6 @@ pre.rust {\n \tposition: sticky;\n \ttop: 0;\n \tleft: 0;\n-\tcursor: pointer;\n \tfont-weight: bold;\n \tfont-size: 1.25rem;\n \tborder-bottom: 1px solid;\n@@ -1422,7 +1421,24 @@ pre.rust {\n \tborder-bottom: 1px solid;\n \tmargin-bottom: 6px;\n }\n-\n+#sidebar-toggle > button {\n+\tbackground: none;\n+\tcolor: inherit;\n+\tcursor: pointer;\n+\ttext-align: center;\n+\tborder: none;\n+\toutline: none;\n+\tposition: absolute;\n+\ttop: 0;\n+\tbottom: 0;\n+\tleft: 0;\n+\tright: 0;\n+\t/* work around button layout strangeness: https://stackoverflow.com/q/7271561 */\n+\twidth: 100%;\n+\t/* iOS button gradient: https://stackoverflow.com/q/5438567 */\n+\t-webkit-appearance: none;\n+\topacity: 1;\n+}\n #settings-menu, #help-button {\n \tmargin-left: 4px;\n \toutline: none;"}, {"sha": "45e70c9a7c721d326f0486c64b691b47f25121e8", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=47456ad4ef7c011cef4274439df555cc7b3c2911", "patch": "@@ -57,7 +57,7 @@ function createDirEntry(elem, parent, fullPath, hasFoundFile) {\n }\n \n function toggleSidebar() {\n-    const child = this.children[0];\n+    const child = this.parentNode.children[0];\n     if (child.innerText === \">\") {\n         if (window.innerWidth < 701) {\n             // This is to keep the scroll position on mobile.\n@@ -86,15 +86,15 @@ function toggleSidebar() {\n function createSidebarToggle() {\n     const sidebarToggle = document.createElement(\"div\");\n     sidebarToggle.id = \"sidebar-toggle\";\n-    sidebarToggle.onclick = toggleSidebar;\n \n-    const inner = document.createElement(\"div\");\n+    const inner = document.createElement(\"button\");\n \n     if (getCurrentValue(\"source-sidebar-show\") === \"true\") {\n         inner.innerText = \"<\";\n     } else {\n         inner.innerText = \">\";\n     }\n+    inner.onclick = toggleSidebar;\n \n     sidebarToggle.appendChild(inner);\n     return sidebarToggle;"}, {"sha": "25699d82e61decf49c939fa9b277a8b2213cd745", "filename": "src/test/rustdoc-gui/sidebar-source-code-display.goml", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "raw_url": "https://github.com/rust-lang/rust/raw/47456ad4ef7c011cef4274439df555cc7b3c2911/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml?ref=47456ad4ef7c011cef4274439df555cc7b3c2911", "patch": "@@ -30,6 +30,15 @@ assert-css: (\n     \"#source-sidebar details[open] > .files a.selected\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(255, 255, 255)\"},\n )\n+// Without hover or focus.\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgba(0, 0, 0, 0)\"})\n+// With focus.\n+focus: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgb(224, 224, 224)\"})\n+focus: \".search-input\"\n+// With hover.\n+move-cursor-to: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgb(224, 224, 224)\"})\n // Without hover.\n assert-css: (\n     \"#source-sidebar details[open] > .files a:not(.selected)\",\n@@ -76,6 +85,15 @@ assert-css: (\n     \"#source-sidebar details[open] > .files > a.selected\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgb(51, 51, 51)\"},\n )\n+// Without hover or focus.\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgba(0, 0, 0, 0)\"})\n+// With focus.\n+focus: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgb(103, 103, 103)\"})\n+focus: \".search-input\"\n+// With hover.\n+move-cursor-to: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgb(103, 103, 103)\"})\n // Without hover.\n assert-css: (\n     \"#source-sidebar details[open] > .files > a:not(.selected)\",\n@@ -122,6 +140,15 @@ assert-css: (\n     \"#source-sidebar details[open] > .files a.selected\",\n     {\"color\": \"rgb(255, 180, 76)\", \"background-color\": \"rgb(20, 25, 31)\"},\n )\n+// Without hover or focus.\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgba(0, 0, 0, 0)\"})\n+// With focus.\n+focus: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgba(70, 70, 70, 0.33)\"})\n+focus: \".search-input\"\n+// With hover.\n+move-cursor-to: \"#sidebar-toggle > button\"\n+assert-css: (\"#sidebar-toggle > button\", {\"background-color\": \"rgba(70, 70, 70, 0.33)\"})\n // Without hover.\n assert-css: (\n     \"#source-sidebar details[open] > .files a:not(.selected)\","}]}