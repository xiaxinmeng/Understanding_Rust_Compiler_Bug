{"sha": "ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVhNmExYmRmNmJhNzU0ZjNiOTZlM2E0NmY5MTczYjE3ZmYxOGVkMDc=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2018-03-01T10:46:06Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2018-03-16T13:57:07Z"}, "message": "Compute each key only one during slice::sort_by_key", "tree": {"sha": "d10cc0401caf55a84bff1adb41b748625c94298b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d10cc0401caf55a84bff1adb41b748625c94298b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07", "html_url": "https://github.com/rust-lang/rust/commit/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff2d506c2c748bd218f74c6014abc4cecc8c74c4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff2d506c2c748bd218f74c6014abc4cecc8c74c4", "html_url": "https://github.com/rust-lang/rust/commit/ff2d506c2c748bd218f74c6014abc4cecc8c74c4"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "c57f1e7f57297752f2ea6d3bfea7fb4774df920d", "filename": "src/liballoc/slice.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07/src%2Fliballoc%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07/src%2Fliballoc%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fslice.rs?ref=ea6a1bdf6ba754f3b96e3a46f9173b17ff18ed07", "patch": "@@ -1328,10 +1328,18 @@ impl<T> [T] {\n     /// ```\n     #[stable(feature = \"slice_sort_by_key\", since = \"1.7.0\")]\n     #[inline]\n-    pub fn sort_by_key<B, F>(&mut self, mut f: F)\n+    pub fn sort_by_key<B, F>(&mut self, f: F)\n         where F: FnMut(&T) -> B, B: Ord\n     {\n-        merge_sort(self, |a, b| f(a).lt(&f(b)));\n+        let mut indices: Vec<_> = self.iter().map(f).enumerate().map(|(i, k)| (k, i)).collect();\n+        indices.sort();\n+        for i in 0..self.len() {\n+            let mut index = indices[i].1;\n+            while index < i {\n+                index = indices[index].1;\n+            }\n+            self.swap(i, index);\n+        }\n     }\n \n     /// Sorts the slice, but may not preserve the order of equal elements."}]}