{"sha": "a569c249c297a7c3e36ff80aeddf6f42aca5abe6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1NjljMjQ5YzI5N2E3YzNlMzZmZjgwYWVkZGY2ZjQyYWNhNWFiZTY=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-07-14T00:45:13Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2018-07-14T02:15:11Z"}, "message": "Do not attempt to recompile codegen backend(s) with --keep-stage\n\nPreviously we'd attempt to recompile them and that would fail since\nwe've essentially not built the entire compiler yet, or we're faking\nthat fact. This commit should make us ignore the codegen backend build\nas well.\n\nUnlike the other compile steps, there is no CodegenBackendLink step that\nwe run here, because that is done later as a part of assembling the\nfinal compiler and as an explicit function call.", "tree": {"sha": "23da83609f6492e87e6239952bf10fa6a3580dd1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23da83609f6492e87e6239952bf10fa6a3580dd1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a569c249c297a7c3e36ff80aeddf6f42aca5abe6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a569c249c297a7c3e36ff80aeddf6f42aca5abe6", "html_url": "https://github.com/rust-lang/rust/commit/a569c249c297a7c3e36ff80aeddf6f42aca5abe6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a569c249c297a7c3e36ff80aeddf6f42aca5abe6/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a14a361c2c80fdcd0270766e0bd57104e608988e", "url": "https://api.github.com/repos/rust-lang/rust/commits/a14a361c2c80fdcd0270766e0bd57104e608988e", "html_url": "https://github.com/rust-lang/rust/commit/a14a361c2c80fdcd0270766e0bd57104e608988e"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "8cfd85590169841c815c5cb8010c5b4d755d17fc", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a569c249c297a7c3e36ff80aeddf6f42aca5abe6/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a569c249c297a7c3e36ff80aeddf6f42aca5abe6/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=a569c249c297a7c3e36ff80aeddf6f42aca5abe6", "patch": "@@ -660,6 +660,16 @@ impl Step for CodegenBackend {\n \n         builder.ensure(Rustc { compiler, target });\n \n+        if let Some(keep_stage) = builder.config.keep_stage {\n+            if keep_stage <= compiler.stage {\n+                println!(\"Warning: Using a potentially old codegen backend. \\\n+                    This may not behave well.\");\n+                // Codegen backends are linked separately from this step today, so we don't do\n+                // anything here.\n+                return;\n+            }\n+        }\n+\n         if builder.force_use_stage1(compiler, target) {\n             builder.ensure(CodegenBackend {\n                 compiler: builder.compiler(1, builder.config.build),"}]}