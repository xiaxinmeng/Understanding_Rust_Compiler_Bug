{"sha": "f6bde0352b52eb3b31c78b7abd70c1be396ccb0f", "node_id": "C_kwDOAAsO6NoAKGY2YmRlMDM1MmI1MmViM2IzMWM3OGI3YWJkNzBjMWJlMzk2Y2NiMGY", "commit": {"author": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-03-29T08:52:48Z"}, "committer": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-03-29T08:52:48Z"}, "message": "std: use `cvt` to handle errors from `read_entropy` on Hermit", "tree": {"sha": "2bd9c38d27c9a57d9228a835a5c281a7854e8887", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2bd9c38d27c9a57d9228a835a5c281a7854e8887"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEVuz3PwcqDyifNyYbcE4BSbAZSzwFAmQj/GAACgkQcE4BSbAZ\nSzy3mA//fy+LeuUu2snMOg7YNL+W6kKc6F6YtZEvfma3/5q2Fpz8pTWoadC1T2hS\nTkvJ3IJJBBJZAG/kyRLbNCkrQdrwhiMh71mW6LpPP830M5qKDHVyRCQksbz2cczx\nDfitgPuAZk38Uz3f9FLKNXYeSaDCa3cKyzvWdR9FI9lKl45/psiUwC1ObTfqABtt\nlyq2bxsDdOHZ4T0u7TP6F3b2GxJXe2v+/o97OrlbK2/D5YdtsXqQym4u191Cm8WP\nS1tfS2U4UHakddx7ARamGsxVH+dBDjP47M8RMFGuTnxGIAhUkT8b8robA4bZuP/f\n4p3L/Uaok7CEQq/OpfTfSNjvB2e0UeJfkcQpdDvoaog+ovzt2A1MiKKceyajAJPU\nzVKPe8fzNwLuTvbI1TmpVb3b/gmfZ0Ojq2R2tl7CsolVliZxhFFNNXHQaOAFwfoa\nn1oHTU6sSM/UZA5Fe7ssOQgQp4+YZLGAwG/lgN3p2sdaMEYUF4UgaLegihDYFs67\nNOUClTAbaZ+Zk9qtSQwW/luvUvQBI4ynI0f9zXeQukUdA7pXMXRn1cqWy6ih1ng7\ndQJHxGxgVroEx18Zoqb9aUV9BdohGoOXVdJ/DBA9+rKR//me/9KwhAe1YJ/0bLPW\nYLOBG94mq/Dn7TM2n5M70WDZLPsKzlrRMglOuQ4v6DI3Lz5HY9g=\n=QAYi\n-----END PGP SIGNATURE-----", "payload": "tree 2bd9c38d27c9a57d9228a835a5c281a7854e8887\nparent fdbf109b635d8928b7b47570f2a8f00ec9d39d94\nauthor joboet <jonasboettiger@icloud.com> 1680079968 +0200\ncommitter joboet <jonasboettiger@icloud.com> 1680079968 +0200\n\nstd: use `cvt` to handle errors from `read_entropy` on Hermit\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f", "html_url": "https://github.com/rust-lang/rust/commit/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f/comments", "author": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "url": "https://api.github.com/repos/rust-lang/rust/commits/fdbf109b635d8928b7b47570f2a8f00ec9d39d94", "html_url": "https://github.com/rust-lang/rust/commit/fdbf109b635d8928b7b47570f2a8f00ec9d39d94"}], "stats": {"total": 12, "additions": 3, "deletions": 9}, "files": [{"sha": "111150b06e1b032406234196e10209591b59d67a", "filename": "library/std/src/sys/hermit/mod.rs", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f6bde0352b52eb3b31c78b7abd70c1be396ccb0f/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs?ref=f6bde0352b52eb3b31c78b7abd70c1be396ccb0f", "patch": "@@ -80,15 +80,9 @@ pub fn hashmap_random_keys() -> (u64, u64) {\n     let mut buf = [0; 16];\n     let mut slice = &mut buf[..];\n     while !slice.is_empty() {\n-        let res = unsafe { abi::read_entropy(slice.as_mut_ptr(), slice.len(), 0) };\n-        if res < 0 {\n-            panic!(\n-                \"random key generation failed: {}\",\n-                crate::io::Error::from_raw_os_error(-res as i32)\n-            );\n-        } else {\n-            slice = &mut slice[res as usize..];\n-        }\n+        let res = cvt(unsafe { abi::read_entropy(slice.as_mut_ptr(), slice.len(), 0) })\n+            .expect(\"failed to generate random hashmap keys\");\n+        slice = &mut slice[res as usize..];\n     }\n \n     let key1 = buf[..8].try_into().unwrap();"}]}