{"sha": "cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmZDFmNzRlYmI2MzRlYWFhNmNhNjA4NDQ2OTBjNWNkN2RlMTZmNTI=", "commit": {"author": {"name": "Michael Sullivan", "email": "sully@msully.net", "date": "2011-06-14T00:34:54Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-06-16T18:47:54Z"}, "message": "Bring swap through typechecking and typestate.", "tree": {"sha": "c6eac2d075c199c1f0a7ec75b4dc36af786d81a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6eac2d075c199c1f0a7ec75b4dc36af786d81a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "html_url": "https://github.com/rust-lang/rust/commit/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/comments", "author": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "066599104aa50b684e63c0e8c39c5240a1fd597e", "url": "https://api.github.com/repos/rust-lang/rust/commits/066599104aa50b684e63c0e8c39c5240a1fd597e", "html_url": "https://github.com/rust-lang/rust/commit/066599104aa50b684e63c0e8c39c5240a1fd597e"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "cfa5aed2faf788b0a6536d2288025da0b7a2e8c0", "filename": "src/comp/middle/tstate/pre_post_conditions.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fpre_post_conditions.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -292,6 +292,10 @@ fn find_pre_post_expr(&fn_ctxt fcx, @expr e) {\n                 case (_) { find_pre_post_exprs(fcx, [lhs, rhs], a); }\n             }\n         }\n+        case (expr_swap(?lhs, ?rhs, ?a)) {\n+            // Both sides must already be initialized\n+            find_pre_post_exprs(fcx, [lhs, rhs], a);\n+        }\n         case (expr_assign(?lhs, ?rhs, ?a)) {\n             alt (lhs.node) {\n                 case (expr_path(?p, ?a_lhs)) {"}, {"sha": "ebf6b7ca3004d9b774126e350ea3ca98734f15be", "filename": "src/comp/middle/tstate/states.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -327,6 +327,20 @@ fn find_pre_post_state_expr(&fn_ctxt fcx, &prestate pres, @expr e) -> bool {\n             }\n             ret changed;\n         }\n+        case (expr_swap(?lhs, ?rhs, ?a)) {\n+            /* quite similar to binary -- should abstract this */\n+            changed = extend_prestate_ann(fcx.ccx, a, pres) || changed;\n+            changed = find_pre_post_state_expr(fcx, pres, lhs)\n+                || changed;\n+            changed =\n+                find_pre_post_state_expr(fcx,\n+                                         expr_poststate(fcx.ccx, lhs),\n+                                         rhs) || changed;\n+            changed =\n+                extend_poststate_ann(fcx.ccx, a,\n+                                     expr_poststate(fcx.ccx, rhs)) || changed;\n+        ret changed;\n+    }\n         case (expr_recv(?lhs, ?rhs, ?a)) {\n             extend_prestate_ann(fcx.ccx, a, pres);\n             alt (lhs.node) {"}, {"sha": "e7f43e75bede3fab5bef4045fb73857f82a7928a", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -1528,6 +1528,7 @@ fn expr_ann(&@ast::expr e) -> ast::ann {\n         case (ast::expr_block(_, ?a)) { ret a; }\n         case (ast::expr_move(_, _, ?a)) { ret a; }\n         case (ast::expr_assign(_, _, ?a)) { ret a; }\n+        case (ast::expr_swap(_,_,?a)) { ret a; }\n         case (ast::expr_assign_op(_, _, _, ?a)) { ret a; }\n         case (ast::expr_send(_, _, ?a)) { ret a; }\n         case (ast::expr_recv(_, _, ?a)) { ret a; }"}, {"sha": "0b615740e3cd114484c6795693f248fabcca8ca9", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -1637,6 +1637,10 @@ fn check_expr(&@fn_ctxt fcx, &@ast::expr expr) {\n             require_impure(fcx.ccx.tcx.sess, fcx.purity, expr.span);\n             check_assignment(fcx, expr.span, lhs, rhs, a);\n         }\n+        case (ast::expr_swap(?lhs, ?rhs, ?a)) {\n+            require_impure(fcx.ccx.tcx.sess, fcx.purity, expr.span);\n+            check_assignment(fcx, expr.span, lhs, rhs, a);\n+        }\n         case (ast::expr_assign_op(?op, ?lhs, ?rhs, ?a)) {\n             require_impure(fcx.ccx.tcx.sess, fcx.purity, expr.span);\n             check_assignment(fcx, expr.span, lhs, rhs, a);"}, {"sha": "642d4d26e5226c2b8e323138379340593b9415a2", "filename": "src/comp/middle/visit.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fvisit.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -314,6 +314,10 @@ fn visit_expr[E](&@expr ex, &E e, &vt[E] v) {\n             vt(v).visit_expr(b, e, v);\n             vt(v).visit_expr(a, e, v);\n         }\n+        case (expr_swap(?a, ?b, _)) {\n+            vt(v).visit_expr(a, e, v);\n+            vt(v).visit_expr(b, e, v);\n+        }\n         case (expr_assign_op(_, ?a, ?b, _)) {\n             vt(v).visit_expr(b, e, v);\n             vt(v).visit_expr(a, e, v);"}, {"sha": "143069c3f58d093b1f3e14fb562a48c21e9955f2", "filename": "src/comp/middle/walk.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fwalk.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fmiddle%2Fwalk.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fwalk.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -347,6 +347,7 @@ fn walk_expr(&ast_visitor v, @ast::expr e) {\n             walk_expr(v, b);\n         }\n         case (ast::expr_move(?a, ?b, _)) { walk_expr(v, a); walk_expr(v, b); }\n+        case (ast::expr_swap(?a, ?b, _)) { walk_expr(v, a); walk_expr(v, b); }\n         case (ast::expr_assign_op(_, ?a, ?b, _)) {\n             walk_expr(v, a);\n             walk_expr(v, b);"}, {"sha": "9e5e905eb80ea5dcdc9cd1fcf578bd795a8a1103", "filename": "src/comp/pretty/pprust.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fpretty%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cfd1f74ebb634eaaa6ca60844690c5cd7de16f52/src%2Fcomp%2Fpretty%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fpretty%2Fpprust.rs?ref=cfd1f74ebb634eaaa6ca60844690c5cd7de16f52", "patch": "@@ -704,6 +704,12 @@ fn print_expr(&ps s, &@ast::expr expr) {\n             word_space(s, \"=\");\n             print_expr(s, rhs);\n         }\n+        case (ast::expr_swap(?lhs, ?rhs, _)) {\n+            print_expr(s, lhs);\n+            space(s.s);\n+            word_space(s, \"<->\");\n+            print_expr(s, rhs);\n+        }\n         case (ast::expr_assign_op(?op, ?lhs, ?rhs, _)) {\n             print_expr(s, lhs);\n             space(s.s);"}]}