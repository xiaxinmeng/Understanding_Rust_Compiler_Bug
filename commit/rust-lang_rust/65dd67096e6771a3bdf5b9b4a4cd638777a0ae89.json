{"sha": "65dd67096e6771a3bdf5b9b4a4cd638777a0ae89", "node_id": "C_kwDOAAsO6NoAKDY1ZGQ2NzA5NmU2NzcxYTNiZGY1YjliNGE0Y2Q2Mzg3NzdhMGFlODk", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-20T02:46:49Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-20T03:04:33Z"}, "message": "Touch up print_string", "tree": {"sha": "b7324d91b135c8d9db7035a76a0e82a1f2c3a5d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7324d91b135c8d9db7035a76a0e82a1f2c3a5d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmHo0UEACgkQ+boUO5X/\nbYLsPg//T1PZXk8NxIeJghPHE5cWjd9EhLyvDnmWiTnJP36lKUYkXWb0Ru4iEFFt\nUbgH5HoXyY/Zoqr3pG86ec/wPW6qx01iuzY66oMf2cXvhpEniDlWQUYutdRPHhg2\ne7XkIhFzLAzyJLK7paUnGWtD0pmsAywRIl9xDrXu/uWni+9m5I2iWUMZrEZe2EkY\nWxMbGEtbLm2bYn2GbVmboeT/MzQcCecXlrF7okiMH875P8Zm2gb59EaDUuyxYyN1\nUCMIRZhOixa2Oyd2zc6FGkWAdWjOo3gmQ7Kkm/42Ct/nTfUl14B07NCZ8ErV7F+K\nHu6W7o0Lsb2+N2ao66LnElSzqTVhLN8kxsjX0L70T1zrw02jaWyRAY0enKbF5/v6\nQfbIihSBaFtpF7swHQyBn/u1g1xEWAEWgJqGhrJWhp1CBv055U6Vz4IMi26r66RH\nmYWSfBOgQL/CXz+hNl5b4CfWEtlUnKJvvg+SuU93HngPJgPDZVTblUbQyt3LTYfU\n0kVwU4jkhslwDP7DDxYQmxBiTRAPrAVn+9zhx4GN3tGYEn1950DJGf1IxGLIBnac\nmPqmXKEjc3FObMEpgk2So5Tk0DytJyuj0Rn7gXvWwtiRwRiPw3w+x9xhjLLvKmlT\nK5CnI99/P0DKeNS5T3UBa3annOTA27KnqoHQ+6C67PrD+Ch1yW4=\n=5F/I\n-----END PGP SIGNATURE-----", "payload": "tree b7324d91b135c8d9db7035a76a0e82a1f2c3a5d1\nparent d5f15a8c18a80cce04641e4801deee94b3a0bf45\nauthor David Tolnay <dtolnay@gmail.com> 1642646809 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1642647873 -0800\n\nTouch up print_string\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89", "html_url": "https://github.com/rust-lang/rust/commit/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d5f15a8c18a80cce04641e4801deee94b3a0bf45", "url": "https://api.github.com/repos/rust-lang/rust/commits/d5f15a8c18a80cce04641e4801deee94b3a0bf45", "html_url": "https://github.com/rust-lang/rust/commit/d5f15a8c18a80cce04641e4801deee94b3a0bf45"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "11114b5322077a425b7a6e78aa12dc1cefa6972c", "filename": "compiler/rustc_ast_pretty/src/pp.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65dd67096e6771a3bdf5b9b4a4cd638777a0ae89/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs?ref=65dd67096e6771a3bdf5b9b4a4cd638777a0ae89", "patch": "@@ -137,6 +137,7 @@ mod ring;\n use ring::RingBuffer;\n use std::borrow::Cow;\n use std::collections::VecDeque;\n+use std::iter;\n \n /// How to break. Described in more detail in the module docs.\n #[derive(Clone, Copy, PartialEq)]\n@@ -425,20 +426,18 @@ impl Printer {\n     }\n \n     fn print_string(&mut self, string: &str) {\n-        let len = string.len() as isize;\n-        // assert!(len <= space);\n-        self.space -= len;\n-\n         // Write the pending indent. A more concise way of doing this would be:\n         //\n         //   write!(self.out, \"{: >n$}\", \"\", n = self.pending_indentation as usize)?;\n         //\n         // But that is significantly slower. This code is sufficiently hot, and indents can get\n         // sufficiently large, that the difference is significant on some workloads.\n         self.out.reserve(self.pending_indentation as usize);\n-        self.out.extend(std::iter::repeat(' ').take(self.pending_indentation as usize));\n+        self.out.extend(iter::repeat(' ').take(self.pending_indentation as usize));\n         self.pending_indentation = 0;\n+\n         self.out.push_str(string);\n+        self.space -= string.len() as isize;\n     }\n \n     // Convenience functions to talk to the printer."}]}