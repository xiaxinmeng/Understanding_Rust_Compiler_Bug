{"sha": "ec448ca4b33202e384eb034b4e15ed751355488c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVjNDQ4Y2E0YjMzMjAyZTM4NGViMDM0YjRlMTVlZDc1MTM1NTQ4OGM=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-01-01T23:42:07Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-01-01T23:44:59Z"}, "message": "Impl HasAttrs for GenericParam", "tree": {"sha": "1d9dab48356bee385c637fe6c344935e8ef96766", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d9dab48356bee385c637fe6c344935e8ef96766"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec448ca4b33202e384eb034b4e15ed751355488c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec448ca4b33202e384eb034b4e15ed751355488c", "html_url": "https://github.com/rust-lang/rust/commit/ec448ca4b33202e384eb034b4e15ed751355488c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec448ca4b33202e384eb034b4e15ed751355488c/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4a7caedb066a653560dfe9ec005f20b9e2548c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4a7caedb066a653560dfe9ec005f20b9e2548c0", "html_url": "https://github.com/rust-lang/rust/commit/b4a7caedb066a653560dfe9ec005f20b9e2548c0"}], "stats": {"total": 89, "additions": 78, "deletions": 11}, "files": [{"sha": "a027f881e98abb9ec4a9b106896e72972ffbf1a3", "filename": "crates/hir/src/attrs.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Fattrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Fattrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fattrs.rs?ref=ec448ca4b33202e384eb034b4e15ed751355488c", "patch": "@@ -3,15 +3,15 @@ use hir_def::{\n     attr::{Attrs, Documentation},\n     path::ModPath,\n     resolver::HasResolver,\n-    AttrDefId, ModuleDefId,\n+    AttrDefId, GenericParamId, ModuleDefId,\n };\n use hir_expand::hygiene::Hygiene;\n use hir_ty::db::HirDatabase;\n use syntax::ast;\n \n use crate::{\n-    Adt, Const, Enum, Field, Function, MacroDef, Module, ModuleDef, Static, Struct, Trait,\n-    TypeAlias, Union, Variant,\n+    Adt, Const, Enum, Field, Function, GenericParam, MacroDef, Module, ModuleDef, Static, Struct,\n+    Trait, TypeAlias, Union, Variant,\n };\n \n pub trait HasAttrs {\n@@ -62,6 +62,7 @@ impl_has_attrs![\n     (Function, FunctionId),\n     (Adt, AdtId),\n     (Module, ModuleId),\n+    (GenericParam, GenericParamId),\n ];\n \n macro_rules! impl_has_attrs_adt {\n@@ -99,6 +100,12 @@ fn resolve_doc_path(\n         AttrDefId::TraitId(it) => it.resolver(db.upcast()),\n         AttrDefId::TypeAliasId(it) => it.resolver(db.upcast()),\n         AttrDefId::ImplId(it) => it.resolver(db.upcast()),\n+        AttrDefId::GenericParamId(it) => match it {\n+            GenericParamId::TypeParamId(it) => it.parent,\n+            GenericParamId::LifetimeParamId(it) => it.parent,\n+            GenericParamId::ConstParamId(it) => it.parent,\n+        }\n+        .resolver(db.upcast()),\n         AttrDefId::MacroDefId(_) => return None,\n     };\n     let path = ast::Path::parse(link).ok()?;"}, {"sha": "3e47a5e9dbc229374cbf8dbdabf108180c048f18", "filename": "crates/hir/src/from_id.rs", "status": "modified", "additions": 24, "deletions": 4, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Ffrom_id.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Ffrom_id.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Ffrom_id.rs?ref=ec448ca4b33202e384eb034b4e15ed751355488c", "patch": "@@ -6,13 +6,13 @@\n use hir_def::{\n     expr::{LabelId, PatId},\n     item_scope::ItemInNs,\n-    AdtId, AssocItemId, DefWithBodyId, EnumVariantId, FieldId, GenericDefId, ModuleDefId,\n-    VariantId,\n+    AdtId, AssocItemId, DefWithBodyId, EnumVariantId, FieldId, GenericDefId, GenericParamId,\n+    ModuleDefId, VariantId,\n };\n \n use crate::{\n-    Adt, AssocItem, DefWithBody, Field, GenericDef, Label, Local, MacroDef, ModuleDef, Variant,\n-    VariantDef,\n+    code_model::GenericParam, Adt, AssocItem, DefWithBody, Field, GenericDef, Label, Local,\n+    MacroDef, ModuleDef, Variant, VariantDef,\n };\n \n macro_rules! from_id {\n@@ -68,6 +68,26 @@ impl From<Adt> for AdtId {\n     }\n }\n \n+impl From<GenericParamId> for GenericParam {\n+    fn from(id: GenericParamId) -> Self {\n+        match id {\n+            GenericParamId::TypeParamId(it) => GenericParam::TypeParam(it.into()),\n+            GenericParamId::LifetimeParamId(it) => GenericParam::LifetimeParam(it.into()),\n+            GenericParamId::ConstParamId(it) => GenericParam::ConstParam(it.into()),\n+        }\n+    }\n+}\n+\n+impl From<GenericParam> for GenericParamId {\n+    fn from(id: GenericParam) -> Self {\n+        match id {\n+            GenericParam::TypeParam(it) => GenericParamId::TypeParamId(it.id),\n+            GenericParam::LifetimeParam(it) => GenericParamId::LifetimeParamId(it.id),\n+            GenericParam::ConstParam(it) => GenericParamId::ConstParamId(it.id),\n+        }\n+    }\n+}\n+\n impl From<EnumVariantId> for Variant {\n     fn from(id: EnumVariantId) -> Self {\n         Variant { parent: id.parent.into(), id: id.local_id }"}, {"sha": "769945c474ecf1a5eb67d4360e8268c70a588034", "filename": "crates/hir/src/lib.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Flib.rs?ref=ec448ca4b33202e384eb034b4e15ed751355488c", "patch": "@@ -35,8 +35,9 @@ pub use crate::{\n     code_model::{\n         Access, Adt, AsAssocItem, AssocItem, AssocItemContainer, Callable, CallableKind, Const,\n         ConstParam, Crate, CrateDependency, DefWithBody, Enum, Field, FieldSource, Function,\n-        GenericDef, HasVisibility, Impl, Label, LifetimeParam, Local, MacroDef, Module, ModuleDef,\n-        ScopeDef, Static, Struct, Trait, Type, TypeAlias, TypeParam, Union, Variant, VariantDef,\n+        GenericDef, GenericParam, HasVisibility, Impl, Label, LifetimeParam, Local, MacroDef,\n+        Module, ModuleDef, ScopeDef, Static, Struct, Trait, Type, TypeAlias, TypeParam, Union,\n+        Variant, VariantDef,\n     },\n     has_source::HasSource,\n     semantics::{PathResolution, Semantics, SemanticsScope},"}, {"sha": "86ae2f0fa9d648778f9063d231864ffa4ea36bb5", "filename": "crates/hir_def/src/attr.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir_def%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir_def%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fattr.rs?ref=ec448ca4b33202e384eb034b4e15ed751355488c", "patch": "@@ -21,7 +21,7 @@ use crate::{\n     nameres::ModuleSource,\n     path::{ModPath, PathKind},\n     src::HasChildSource,\n-    AdtId, AttrDefId, Lookup,\n+    AdtId, AttrDefId, GenericParamId, Lookup,\n };\n \n /// Holds documentation\n@@ -235,6 +235,25 @@ impl Attrs {\n             AttrDefId::StaticId(it) => attrs_from_item_tree(it.lookup(db).id, db),\n             AttrDefId::FunctionId(it) => attrs_from_item_tree(it.lookup(db).id, db),\n             AttrDefId::TypeAliasId(it) => attrs_from_item_tree(it.lookup(db).id, db),\n+            AttrDefId::GenericParamId(it) => match it {\n+                GenericParamId::TypeParamId(it) => {\n+                    let src = it.parent.child_source(db);\n+                    RawAttrs::from_attrs_owner(\n+                        db,\n+                        src.with_value(\n+                            src.value[it.local_id].as_ref().either(|it| it as _, |it| it as _),\n+                        ),\n+                    )\n+                }\n+                GenericParamId::LifetimeParamId(it) => {\n+                    let src = it.parent.child_source(db);\n+                    RawAttrs::from_attrs_owner(db, src.with_value(&src.value[it.local_id]))\n+                }\n+                GenericParamId::ConstParamId(it) => {\n+                    let src = it.parent.child_source(db);\n+                    RawAttrs::from_attrs_owner(db, src.with_value(&src.value[it.local_id]))\n+                }\n+            },\n         };\n \n         raw_attrs.filter(db, def.krate(db))"}, {"sha": "211cb2fafc08519455a678c4c3454f75259be91a", "filename": "crates/hir_def/src/lib.rs", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir_def%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec448ca4b33202e384eb034b4e15ed751355488c/crates%2Fhir_def%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Flib.rs?ref=ec448ca4b33202e384eb034b4e15ed751355488c", "patch": "@@ -261,6 +261,15 @@ pub enum AdtId {\n }\n impl_from!(StructId, UnionId, EnumId for AdtId);\n \n+/// A generic param\n+#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash)]\n+pub enum GenericParamId {\n+    TypeParamId(TypeParamId),\n+    LifetimeParamId(LifetimeParamId),\n+    ConstParamId(ConstParamId),\n+}\n+impl_from!(TypeParamId, LifetimeParamId, ConstParamId for GenericParamId);\n+\n /// The defs which can be visible in the module.\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub enum ModuleDefId {\n@@ -357,6 +366,7 @@ pub enum AttrDefId {\n     TypeAliasId(TypeAliasId),\n     MacroDefId(MacroDefId),\n     ImplId(ImplId),\n+    GenericParamId(GenericParamId),\n }\n \n impl_from!(\n@@ -370,7 +380,8 @@ impl_from!(\n     TraitId,\n     TypeAliasId,\n     MacroDefId,\n-    ImplId\n+    ImplId,\n+    GenericParamId\n     for AttrDefId\n );\n \n@@ -495,6 +506,15 @@ impl AttrDefId {\n             AttrDefId::TraitId(it) => it.lookup(db).container.module(db).krate,\n             AttrDefId::TypeAliasId(it) => it.lookup(db).module(db).krate,\n             AttrDefId::ImplId(it) => it.lookup(db).container.module(db).krate,\n+            AttrDefId::GenericParamId(it) => {\n+                match it {\n+                    GenericParamId::TypeParamId(it) => it.parent,\n+                    GenericParamId::LifetimeParamId(it) => it.parent,\n+                    GenericParamId::ConstParamId(it) => it.parent,\n+                }\n+                .module(db)\n+                .krate\n+            }\n             // FIXME: `MacroDefId` should store the defining module, then this can implement\n             // `HasModule`\n             AttrDefId::MacroDefId(it) => it.krate,"}]}