{"sha": "1d3ca135d055dbda6c255227084296f3552b99a9", "node_id": "C_kwDOAAsO6NoAKDFkM2NhMTM1ZDA1NWRiZGE2YzI1NTIyNzA4NDI5NmYzNTUyYjk5YTk", "commit": {"author": {"name": "Andy Sadler", "email": "andrewsadler122@gmail.com", "date": "2022-08-30T22:33:55Z"}, "committer": {"name": "Andy Sadler", "email": "andrewsadler122@gmail.com", "date": "2022-08-31T00:34:27Z"}, "message": "simd: implement simd_fmin/fmax\n\nThis implements simd_fmin/fmax in a largely-optimal method.\n\nSigned-off-by: Andy Sadler <andrewsadler122@gmail.com>", "tree": {"sha": "18e45c3e51d6a694357a85555ff4492e044302fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18e45c3e51d6a694357a85555ff4492e044302fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d3ca135d055dbda6c255227084296f3552b99a9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJOBAABCAA4FiEE/gSIuZZ6oleJBl8UelM1fNWBc90FAmMOrJMaHGFuZHJld3Nh\nZGxlcjEyMkBnbWFpbC5jb20ACgkQelM1fNWBc91wqg/7BZ+CxiAFrZ4FBFshezVY\ndVl6Fkg/Op0KTegA8YisSsnB8e5i+QjjEmhjPHcOlUCMfsWK1Xsxa3fYED+3/w+1\nPfc/uhYEXubUSp0rNPYeEe+hCLuWoLjpJqxsY+/PKzfVI64c8nQF4O3wpXzq2KmR\nS4GHQa8vO65PZx0A6laz6Btq8dDDVzfmmHDs+FkIsLPtUft+D9aTO6oLbUvqPZj9\nLZ2aHafcCI4ogzUbddT5r1q95S1StrLs47WNRMlaH/fg0yQTNz8gnPyj5UVvdJmi\nVOlXFpHpF458TOYe8jFo6a350PgzwLbrWs5z3Da8xxKUHA0vNswx7egL7TE9Tu6M\nl3n8tzR908oZY0a4CNr4EaLUgf/8UQ73Dbo6NJuuYWXqIHGOA7acpLVTGaSmqNQh\nRD8l8I3Ui83BLyN9QtwYE7Ecf3Qvlxby7tTGBdB+6hIp8/f6+95UdKo4UdKkwzLa\nq4RLTKZv0IM9oQPegSKiofqGous7mBW6MFoTC3PvBQZS6cEUCnjpWrIxDzMCRlLN\nyS7vgSS31R84/6OxhpnTtHIf9/fQtxiKlUxeDXgjB2dqTNLIxZj4mSQYAs4N/z9X\nkAuqG+/6+pOjhz8jce5ObfOhOHoiGEe5V+UocADoynTqF6dWhtijDtccWHbwj1Ep\n4GRECbkKjIM3P0vXb2SriTY=\n=Rbei\n-----END PGP SIGNATURE-----", "payload": "tree 18e45c3e51d6a694357a85555ff4492e044302fc\nparent 2342414f497ea6d76f91d109c28259aad5ec014c\nauthor Andy Sadler <andrewsadler122@gmail.com> 1661898835 -0500\ncommitter Andy Sadler <andrewsadler122@gmail.com> 1661906067 -0500\n\nsimd: implement simd_fmin/fmax\n\nThis implements simd_fmin/fmax in a largely-optimal method.\n\nSigned-off-by: Andy Sadler <andrewsadler122@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d3ca135d055dbda6c255227084296f3552b99a9", "html_url": "https://github.com/rust-lang/rust/commit/1d3ca135d055dbda6c255227084296f3552b99a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d3ca135d055dbda6c255227084296f3552b99a9/comments", "author": {"login": "sadlerap", "id": 20480359, "node_id": "MDQ6VXNlcjIwNDgwMzU5", "avatar_url": "https://avatars.githubusercontent.com/u/20480359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sadlerap", "html_url": "https://github.com/sadlerap", "followers_url": "https://api.github.com/users/sadlerap/followers", "following_url": "https://api.github.com/users/sadlerap/following{/other_user}", "gists_url": "https://api.github.com/users/sadlerap/gists{/gist_id}", "starred_url": "https://api.github.com/users/sadlerap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sadlerap/subscriptions", "organizations_url": "https://api.github.com/users/sadlerap/orgs", "repos_url": "https://api.github.com/users/sadlerap/repos", "events_url": "https://api.github.com/users/sadlerap/events{/privacy}", "received_events_url": "https://api.github.com/users/sadlerap/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sadlerap", "id": 20480359, "node_id": "MDQ6VXNlcjIwNDgwMzU5", "avatar_url": "https://avatars.githubusercontent.com/u/20480359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sadlerap", "html_url": "https://github.com/sadlerap", "followers_url": "https://api.github.com/users/sadlerap/followers", "following_url": "https://api.github.com/users/sadlerap/following{/other_user}", "gists_url": "https://api.github.com/users/sadlerap/gists{/gist_id}", "starred_url": "https://api.github.com/users/sadlerap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sadlerap/subscriptions", "organizations_url": "https://api.github.com/users/sadlerap/orgs", "repos_url": "https://api.github.com/users/sadlerap/repos", "events_url": "https://api.github.com/users/sadlerap/events{/privacy}", "received_events_url": "https://api.github.com/users/sadlerap/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2342414f497ea6d76f91d109c28259aad5ec014c", "url": "https://api.github.com/repos/rust-lang/rust/commits/2342414f497ea6d76f91d109c28259aad5ec014c", "html_url": "https://github.com/rust-lang/rust/commit/2342414f497ea6d76f91d109c28259aad5ec014c"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "fc6dcfc7bc7b4540d8b1bdd0d23b61fedb811228", "filename": "failing-ui-tests.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1d3ca135d055dbda6c255227084296f3552b99a9/failing-ui-tests.txt", "raw_url": "https://github.com/rust-lang/rust/raw/1d3ca135d055dbda6c255227084296f3552b99a9/failing-ui-tests.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/failing-ui-tests.txt?ref=1d3ca135d055dbda6c255227084296f3552b99a9", "patch": "@@ -32,7 +32,6 @@ src/test/ui/sepcomp/sepcomp-fns.rs\n src/test/ui/sepcomp/sepcomp-statics.rs\n src/test/ui/simd/generics.rs\n src/test/ui/simd/intrinsic/float-math-pass.rs\n-src/test/ui/simd/intrinsic/float-minmax-pass.rs\n src/test/ui/simd/intrinsic/generic-arithmetic-pass.rs\n src/test/ui/simd/intrinsic/generic-as.rs\n src/test/ui/simd/intrinsic/generic-bitmask-pass.rs"}, {"sha": "e7952f524124b6e0072843589c7ff21c8e47d1d9", "filename": "failing-ui-tests12.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1d3ca135d055dbda6c255227084296f3552b99a9/failing-ui-tests12.txt", "raw_url": "https://github.com/rust-lang/rust/raw/1d3ca135d055dbda6c255227084296f3552b99a9/failing-ui-tests12.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/failing-ui-tests12.txt?ref=1d3ca135d055dbda6c255227084296f3552b99a9", "patch": "@@ -8,6 +8,7 @@ src/test/ui/packed/packed-struct-size.rs\n src/test/ui/packed/packed-struct-vec.rs\n src/test/ui/packed/packed-tuple-struct-layout.rs\n src/test/ui/simd/array-type.rs\n+src/test/ui/simd/intrinsic/float-minmax-pass.rs\n src/test/ui/simd/intrinsic/generic-arithmetic-saturating-pass.rs\n src/test/ui/simd/intrinsic/generic-cast-pass.rs\n src/test/ui/simd/intrinsic/generic-cast-pointer-width.rs"}, {"sha": "52a4854aca3aa03f5cb97135b7b130ded7e85194", "filename": "src/builder.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/1d3ca135d055dbda6c255227084296f3552b99a9/src%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d3ca135d055dbda6c255227084296f3552b99a9/src%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbuilder.rs?ref=1d3ca135d055dbda6c255227084296f3552b99a9", "patch": "@@ -1505,6 +1505,34 @@ impl<'a, 'gcc, 'tcx> Builder<'a, 'gcc, 'tcx> {\n         })\n     }\n \n+    fn vector_extremum(&mut self, a: RValue<'gcc>, b: RValue<'gcc>, direction: ExtremumOperation) -> RValue<'gcc> {\n+        let vector_type = a.get_type();\n+\n+        // mask out the NaNs in b and replace them with the corresponding lane in a, so when a and\n+        // b get compared & spliced together, we get the numeric values instead of NaNs.\n+        let b_nan_mask = self.context.new_comparison(None, ComparisonOp::NotEquals, b, b);\n+        let mask_type = b_nan_mask.get_type();\n+        let b_nan_mask_inverted = self.context.new_unary_op(None, UnaryOp::BitwiseNegate, mask_type, b_nan_mask);\n+        let a_cast = self.context.new_bitcast(None, a, mask_type);\n+        let b_cast = self.context.new_bitcast(None, b, mask_type);\n+        let res = (b_nan_mask & a_cast) | (b_nan_mask_inverted & b_cast);\n+        let b = self.context.new_bitcast(None, res, vector_type);\n+\n+        // now do the actual comparison\n+        let comparison_op = match direction {\n+            ExtremumOperation::Min => ComparisonOp::LessThan,\n+            ExtremumOperation::Max => ComparisonOp::GreaterThan,\n+        };\n+        let cmp = self.context.new_comparison(None, comparison_op, a, b);\n+        let cmp_inverted = self.context.new_unary_op(None, UnaryOp::BitwiseNegate, cmp.get_type(), cmp);\n+        let res = (cmp & a_cast) | (cmp_inverted & res);\n+        self.context.new_bitcast(None, res, vector_type)\n+    }\n+\n+    pub fn vector_fmin(&mut self, a: RValue<'gcc>, b: RValue<'gcc>) -> RValue<'gcc> {\n+        self.vector_extremum(a, b, ExtremumOperation::Min)\n+    }\n+\n     #[cfg(feature=\"master\")]\n     pub fn vector_reduce_fmin(&mut self, src: RValue<'gcc>) -> RValue<'gcc> {\n         let vector_type = src.get_type().unqualified().dyncast_vector().expect(\"vector type\");\n@@ -1525,6 +1553,10 @@ impl<'a, 'gcc, 'tcx> Builder<'a, 'gcc, 'tcx> {\n         unimplemented!();\n     }\n \n+    pub fn vector_fmax(&mut self, a: RValue<'gcc>, b: RValue<'gcc>) -> RValue<'gcc> {\n+        self.vector_extremum(a, b, ExtremumOperation::Max)\n+    }\n+\n     #[cfg(feature=\"master\")]\n     pub fn vector_reduce_fmax(&mut self, src: RValue<'gcc>) -> RValue<'gcc> {\n         let vector_type = src.get_type().unqualified().dyncast_vector().expect(\"vector type\");"}, {"sha": "36b5ab12b172f03dbfb0c88dc610321d0121dcb8", "filename": "src/intrinsic/simd.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1d3ca135d055dbda6c255227084296f3552b99a9/src%2Fintrinsic%2Fsimd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d3ca135d055dbda6c255227084296f3552b99a9/src%2Fintrinsic%2Fsimd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fintrinsic%2Fsimd.rs?ref=1d3ca135d055dbda6c255227084296f3552b99a9", "patch": "@@ -492,6 +492,8 @@ pub fn generic_simd_intrinsic<'a, 'gcc, 'tcx>(bx: &mut Builder<'a, 'gcc, 'tcx>,\n         simd_and: Uint, Int => and;\n         simd_or: Uint, Int => or; // FIXME(antoyo): calling `or` might not work on vectors.\n         simd_xor: Uint, Int => xor;\n+        simd_fmin: Float => vector_fmin;\n+        simd_fmax: Float => vector_fmax;\n     }\n \n     macro_rules! arith_unary {"}]}