{"sha": "c568807989774c8728ef10fad412418653f739c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM1Njg4MDc5ODk3NzRjODcyOGVmMTBmYWQ0MTI0MTg2NTNmNzM5Yzk=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2018-01-29T10:38:47Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2018-03-08T07:34:13Z"}, "message": "Remove single field struct by just using the field", "tree": {"sha": "c93055a6fa32c726542a7fddf02e9a4a18d1b8a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c93055a6fa32c726542a7fddf02e9a4a18d1b8a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c568807989774c8728ef10fad412418653f739c9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEYFTdM4NKd7XQft77pp+NIls619kFAlqg53UACgkQpp+NIls6\n19llXxAAinfURbWKT/L9ei780ogHnsKvyj2c4iI3vJZVrtUOcR9g4VgzsHGMHnX5\nmtafWXcnhahh1ybNBd9IbdkhwUFMHbzKxt4hx5P+u7SOOrZhek1du4pdddnGAZwS\nIQZvG7fap2a7egHvHHq1VeYWuBr8NCmNKD59VjddTHxHl0ggaGGEZ1UA8NhcXzDl\nA+vO9a9bVbWfm/iuypK5B0dz+xRKL/cNnDVT+ab+TsXTXpwhEMN0uDsM9IG97cpV\nfAC2Xk1wfcFY4z0Q2Tk6kjxOFp5o8z0tmosg7RGZNKN8wz+skxRhuh7RiAdCesj+\nar7JjQc7lqGbwPqaAEuOqCIlyunV1zw994MEznFCfv1b8bLS1BCqF50ZJlZn9Z6/\nwEsHoPvm7rwth/HgxYRAapwHlCxYp+oxOsV+50mdoo9eLPFhSVlnOXXYsauzWJST\n6ALRF+4+oZ+8tt4vASbQ6KbC3dp4Q7Wd4AyONA33aPcY+HGLvyIW5g60ooT4syuE\nn8jKzGawYdiOOZuSzREwef32sHNXC8sWAlxb4XXRgRfUeq7XGJUtOm2/bVRcIfqf\nl9OPtfpdXS+m2wO1/ZOI9iOVRqGBHnbSKppsj9oWH3nbut6HiRs/PXv00zN7N+YC\n2M8CdcVGL9XLLyOD7zfT//LJPxJVw0INunBvjrFMspogBeHWXqI=\n=GKKQ\n-----END PGP SIGNATURE-----", "payload": "tree c93055a6fa32c726542a7fddf02e9a4a18d1b8a8\nparent e093ab0df4c2c2113ff6bd9bdc83aadb1f6c1f6c\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1517222327 +0100\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1520494453 +0100\n\nRemove single field struct by just using the field\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c568807989774c8728ef10fad412418653f739c9", "html_url": "https://github.com/rust-lang/rust/commit/c568807989774c8728ef10fad412418653f739c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c568807989774c8728ef10fad412418653f739c9/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e093ab0df4c2c2113ff6bd9bdc83aadb1f6c1f6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e093ab0df4c2c2113ff6bd9bdc83aadb1f6c1f6c", "html_url": "https://github.com/rust-lang/rust/commit/e093ab0df4c2c2113ff6bd9bdc83aadb1f6c1f6c"}], "stats": {"total": 13, "additions": 4, "deletions": 9}, "files": [{"sha": "3b37e755af38829df5e09710e0606d731e7e248c", "filename": "src/librustc_mir/transform/const_prop.rs", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c568807989774c8728ef10fad412418653f739c9/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c568807989774c8728ef10fad412418653f739c9/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fconst_prop.rs?ref=c568807989774c8728ef10fad412418653f739c9", "patch": "@@ -52,7 +52,7 @@ struct OptimizationFinder<'b, 'a, 'tcx:'a+'b> {\n     mir: &'b Mir<'tcx>,\n     tcx: TyCtxt<'a, 'tcx, 'tcx>,\n     source: MirSource,\n-    optimizations: OptimizationList<'tcx>,\n+    places: FxHashMap<Local, Const<'tcx>>,\n }\n \n impl<'b, 'a, 'tcx:'b> OptimizationFinder<'b, 'a, 'tcx> {\n@@ -65,7 +65,7 @@ impl<'b, 'a, 'tcx:'b> OptimizationFinder<'b, 'a, 'tcx> {\n             mir,\n             tcx,\n             source,\n-            optimizations: OptimizationList::default(),\n+            places: FxHashMap::default(),\n         }\n     }\n \n@@ -117,7 +117,7 @@ impl<'b, 'a, 'tcx:'b> OptimizationFinder<'b, 'a, 'tcx> {\n         match *op {\n             Operand::Constant(ref c) => self.eval_constant(c),\n             Operand::Move(ref place) | Operand::Copy(ref place) => match *place {\n-                Place::Local(loc) => self.optimizations.places.get(&loc).cloned(),\n+                Place::Local(loc) => self.places.get(&loc).cloned(),\n                 // FIXME(oli-obk): field and index projections\n                 Place::Projection(_) => None,\n                 _ => None,\n@@ -353,7 +353,7 @@ impl<'b, 'a, 'tcx> Visitor<'tcx> for OptimizationFinder<'b, 'a, 'tcx> {\n                     if self.mir.local_kind(local) == LocalKind::Temp\n                         && CanConstProp::check(local, self.mir) {\n                         trace!(\"storing {:?} to {:?}\", value, local);\n-                        assert!(self.optimizations.places.insert(local, value).is_none());\n+                        assert!(self.places.insert(local, value).is_none());\n                     }\n                 }\n             }\n@@ -443,8 +443,3 @@ impl<'b, 'a, 'tcx> Visitor<'tcx> for OptimizationFinder<'b, 'a, 'tcx> {\n         }\n     }\n }\n-\n-#[derive(Default)]\n-struct OptimizationList<'tcx> {\n-    places: FxHashMap<Local, Const<'tcx>>,\n-}"}]}