{"sha": "471db2b84bbeafb128bae8a8a9cf7fed13d2df4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3MWRiMmI4NGJiZWFmYjEyOGJhZThhOGE5Y2Y3ZmVkMTNkMmRmNGY=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-04-04T20:23:42Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2019-04-04T20:23:42Z"}, "message": "wasm32: Default to a \"static\" relocation model\n\nLLVM 9 is adding support for a \"pic\" relocation model for wasm code,\nwhich is quite different than the current model. In order to preserve\nthe mode of compilation that we have today default to \"static\" to ensure\nthat we don't accidentally start creating experimental relocatable\nbinaries.", "tree": {"sha": "e4a7a4843f5d0fa6e6d0f6e4bbd9419d82334e5c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e4a7a4843f5d0fa6e6d0f6e4bbd9419d82334e5c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f", "html_url": "https://github.com/rust-lang/rust/commit/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52980d0fb39134a26f73b39b384407e010fc3af5", "url": "https://api.github.com/repos/rust-lang/rust/commits/52980d0fb39134a26f73b39b384407e010fc3af5", "html_url": "https://github.com/rust-lang/rust/commit/52980d0fb39134a26f73b39b384407e010fc3af5"}], "stats": {"total": 9, "additions": 9, "deletions": 0}, "files": [{"sha": "edaf902c130d8995055ba81c084501b90f32884c", "filename": "src/librustc_target/spec/wasm32_base.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f/src%2Flibrustc_target%2Fspec%2Fwasm32_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/471db2b84bbeafb128bae8a8a9cf7fed13d2df4f/src%2Flibrustc_target%2Fspec%2Fwasm32_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fwasm32_base.rs?ref=471db2b84bbeafb128bae8a8a9cf7fed13d2df4f", "patch": "@@ -118,6 +118,15 @@ pub fn options() -> TargetOptions {\n \n         pre_link_args,\n \n+        // This has no effect in LLVM 8 or prior, but in LLVM 9 and later when\n+        // PIC code is implemented this has quite a drastric effect if it stays\n+        // at the default, `pic`. In an effort to keep wasm binaries as minimal\n+        // as possible we're defaulting to `static` for now, but the hope is\n+        // that eventually we can ship a `pic`-compatible standard library which\n+        // works with `static` as well (or works with some method of generating\n+        // non-relative calls and such later on).\n+        relocation_model: \"static\".to_string(),\n+\n         .. Default::default()\n     }\n }"}]}