{"sha": "c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2MjQzYzk1MGVlMzM3NmY1NjJjYzJkZDA4YTNkMzFjOWMzODE4YjI=", "commit": {"author": {"name": "est31", "email": "MTest31@outlook.com", "date": "2016-09-17T01:20:00Z"}, "committer": {"name": "est31", "email": "MTest31@outlook.com", "date": "2016-09-17T01:41:11Z"}, "message": "Improve comment rewriting with normalize_comments == false\n\nOnly change multiline comments of the form\n\n```rust\n/*\n * Text\n */\n```\n\nwhile not affecting comments of the form\n\n```rust\n/*\nText\n*/\n```\n\nwhen normalize_comments is off. In the first case,\nwe have a known character we can align against, while\nwe don't have one in the second case.\n\nBefore, we have converted the second form into the first,\nbut this is against the spirit of normalize_comments being\nturned off.\n\nFixes #956", "tree": {"sha": "abd0b4caf34941859ee100873b3e319980256dc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abd0b4caf34941859ee100873b3e319980256dc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "html_url": "https://github.com/rust-lang/rust/commit/c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/comments", "author": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "committer": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efd3e5c0914f0c8d401a504be4116bf947296218", "url": "https://api.github.com/repos/rust-lang/rust/commits/efd3e5c0914f0c8d401a504be4116bf947296218", "html_url": "https://github.com/rust-lang/rust/commit/efd3e5c0914f0c8d401a504be4116bf947296218"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "5a525f1bb23da4020479d75562ebd54deceb0de1", "filename": "src/comment.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "patch": "@@ -71,6 +71,16 @@ pub fn rewrite_comment(orig: &str,\n     let indent_str = offset.to_string(config);\n     let line_breaks = s.chars().filter(|&c| c == '\\n').count();\n \n+    let num_bare_lines = s.lines()\n+        .enumerate()\n+        .map(|(_, line)| line.trim())\n+        .filter(|l| !(l.starts_with('*') || l.starts_with(\"//\") || l.starts_with(\"/*\")))\n+        .count();\n+\n+    if num_bare_lines > 0 && !config.normalize_comments {\n+        return Some(orig.to_owned());\n+    }\n+\n     let lines = s.lines()\n         .enumerate()\n         .map(|(i, mut line)| {"}, {"sha": "0ed18ca8da12a70cc417e7c80453380bd4afce79", "filename": "tests/source/comment4.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/tests%2Fsource%2Fcomment4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/tests%2Fsource%2Fcomment4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fcomment4.rs?ref=c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "patch": "@@ -33,3 +33,15 @@ fn test() {\n   /// test123\n fn doc_comment() {\n }\n+\n+/*\n+Regression test for issue #956\n+\n+(some very important text)\n+*/\n+\n+/*\n+fn debug_function() {\n+    println!(\"hello\");\n+}\n+// */"}, {"sha": "910bade6c88f46620e149f8d286d5b418e35deec", "filename": "tests/target/comment4.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/tests%2Ftarget%2Fcomment4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6243c950ee3376f562cc2dd08a3d31c9c3818b2/tests%2Ftarget%2Fcomment4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fcomment4.rs?ref=c6243c950ee3376f562cc2dd08a3d31c9c3818b2", "patch": "@@ -32,3 +32,15 @@ fn test() {\n \n /// test123\n fn doc_comment() {}\n+\n+/*\n+Regression test for issue #956\n+\n+(some very important text)\n+*/\n+\n+/*\n+fn debug_function() {\n+    println!(\"hello\");\n+}\n+// */"}]}