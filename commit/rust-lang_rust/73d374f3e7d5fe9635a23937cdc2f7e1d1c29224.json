{"sha": "73d374f3e7d5fe9635a23937cdc2f7e1d1c29224", "node_id": "C_kwDOAAsO6NoAKDczZDM3NGYzZTdkNWZlOTYzNWEyMzkzN2NkYzJmN2UxZDFjMjkyMjQ", "commit": {"author": {"name": "Jacob Bramley", "email": "jacob.bramley@arm.com", "date": "2022-12-13T17:04:02Z"}, "committer": {"name": "Jacob Bramley", "email": "jacob.bramley@arm.com", "date": "2022-12-13T17:04:02Z"}, "message": "bug! if branch-protection makes it to non-AArch64 codegen.", "tree": {"sha": "7b4c0037e3c7aa9e187a917e0dbaa2979d2e40ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b4c0037e3c7aa9e187a917e0dbaa2979d2e40ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224", "html_url": "https://github.com/rust-lang/rust/commit/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224/comments", "author": {"login": "jacobbramley", "id": 5206553, "node_id": "MDQ6VXNlcjUyMDY1NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5206553?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacobbramley", "html_url": "https://github.com/jacobbramley", "followers_url": "https://api.github.com/users/jacobbramley/followers", "following_url": "https://api.github.com/users/jacobbramley/following{/other_user}", "gists_url": "https://api.github.com/users/jacobbramley/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacobbramley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacobbramley/subscriptions", "organizations_url": "https://api.github.com/users/jacobbramley/orgs", "repos_url": "https://api.github.com/users/jacobbramley/repos", "events_url": "https://api.github.com/users/jacobbramley/events{/privacy}", "received_events_url": "https://api.github.com/users/jacobbramley/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jacobbramley", "id": 5206553, "node_id": "MDQ6VXNlcjUyMDY1NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5206553?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jacobbramley", "html_url": "https://github.com/jacobbramley", "followers_url": "https://api.github.com/users/jacobbramley/followers", "following_url": "https://api.github.com/users/jacobbramley/following{/other_user}", "gists_url": "https://api.github.com/users/jacobbramley/gists{/gist_id}", "starred_url": "https://api.github.com/users/jacobbramley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jacobbramley/subscriptions", "organizations_url": "https://api.github.com/users/jacobbramley/orgs", "repos_url": "https://api.github.com/users/jacobbramley/repos", "events_url": "https://api.github.com/users/jacobbramley/events{/privacy}", "received_events_url": "https://api.github.com/users/jacobbramley/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f4d51b8ca954d9353e5a250646c219d2e597b8cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4d51b8ca954d9353e5a250646c219d2e597b8cb", "html_url": "https://github.com/rust-lang/rust/commit/f4d51b8ca954d9353e5a250646c219d2e597b8cb"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "f6fcdc90cb61f3217845a0a4e6f69119197ddce9", "filename": "compiler/rustc_codegen_llvm/src/context.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73d374f3e7d5fe9635a23937cdc2f7e1d1c29224/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs?ref=73d374f3e7d5fe9635a23937cdc2f7e1d1c29224", "patch": "@@ -274,9 +274,8 @@ pub unsafe fn create_module<'ll>(\n         }\n     }\n \n-    // AArch64-only options (checked in rustc_session).\n-    if sess.target.arch == \"aarch64\" {\n-        if let Some(BranchProtection { bti, pac_ret }) = sess.opts.unstable_opts.branch_protection {\n+    if let Some(BranchProtection { bti, pac_ret }) = sess.opts.unstable_opts.branch_protection {\n+        if sess.target.arch == \"aarch64\" {\n             llvm::LLVMRustAddModuleFlag(\n                 llmod,\n                 llvm::LLVMModFlagBehavior::Error,\n@@ -302,6 +301,11 @@ pub unsafe fn create_module<'ll>(\n                 \"sign-return-address-with-bkey\\0\".as_ptr().cast(),\n                 u32::from(pac_opts.key == PAuthKey::B),\n             );\n+        } else {\n+            bug!(\n+                \"branch-protection used on non-AArch64 target; \\\n+                  this should be checked in rustc_session.\"\n+            );\n         }\n     }\n "}]}