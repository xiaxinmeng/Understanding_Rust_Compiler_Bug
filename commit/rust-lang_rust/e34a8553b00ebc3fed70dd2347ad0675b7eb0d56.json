{"sha": "e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzNGE4NTUzYjAwZWJjM2ZlZDcwZGQyMzQ3YWQwNjc1YjdlYjBkNTY=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2018-03-28T10:04:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-03-28T10:04:18Z"}, "message": "Merge pull request #2582 from rust-lang-nursery/clippy_aint_no_compiler\n\nUse cargo check instead of cargo rustc", "tree": {"sha": "2de3182af1c040031da41e0511ad9a4eeae21875", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2de3182af1c040031da41e0511ad9a4eeae21875"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJau2iiCRBK7hj4Ov3rIwAAdHIIAJGfRn/CGTKOFZOwtSbdlSVf\nqdkdWAJN1z2segay7vLcctGjk3PkWMcZprKVBgQnwj0kBGmhKLZh8hQ12BFJAexH\n3Yvm3LoTQYkCT0U9yBQHAJUs/IvEDZzM+u3uzfRlLTZXe3q3vqhJ2nhUAKKXlZWM\nj32Ep61R/eeJhjXw1sGwuDrHNwlxFsP8RDiXNdv2oQUrOCOgLWI6c817cuPCHth+\n+M3+mQYL4GCom1Q/g9TCl7b82fFogEHxtCFZXS7JLkWuSUwq5ybroUZVGTjFzpQg\nfI5gcSwOrYhWJHIzBfMyBuHPdD8q26NOL03PFwQqw5Ld/d7mDbw9LLsBj/Rli24=\n=eHMT\n-----END PGP SIGNATURE-----\n", "payload": "tree 2de3182af1c040031da41e0511ad9a4eeae21875\nparent 9b10c4be8cb5850fbb52b55f876e9095ca61e088\nparent 66a98d2658997ad8ede2939e68222bd4df626718\nauthor Oliver Schneider <oli-obk@users.noreply.github.com> 1522231458 +0200\ncommitter GitHub <noreply@github.com> 1522231458 +0200\n\nMerge pull request #2582 from rust-lang-nursery/clippy_aint_no_compiler\n\nUse cargo check instead of cargo rustc"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "html_url": "https://github.com/rust-lang/rust/commit/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b10c4be8cb5850fbb52b55f876e9095ca61e088", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b10c4be8cb5850fbb52b55f876e9095ca61e088", "html_url": "https://github.com/rust-lang/rust/commit/9b10c4be8cb5850fbb52b55f876e9095ca61e088"}, {"sha": "66a98d2658997ad8ede2939e68222bd4df626718", "url": "https://api.github.com/repos/rust-lang/rust/commits/66a98d2658997ad8ede2939e68222bd4df626718", "html_url": "https://github.com/rust-lang/rust/commit/66a98d2658997ad8ede2939e68222bd4df626718"}], "stats": {"total": 23, "additions": 13, "deletions": 10}, "files": [{"sha": "73746798601d3bbeedbbc2452984b348eac2a0db", "filename": "src/driver.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "patch": "@@ -186,10 +186,13 @@ pub fn main() {\n     let clippy_enabled = env::var(\"CLIPPY_TESTS\")\n         .ok()\n         .map_or(false, |val| val == \"true\")\n-        || orig_args.iter().any(|s| s == \"--emit=metadata\");\n+        || orig_args.iter().any(|s| s == \"--emit=dep-info,metadata\");\n \n     if clippy_enabled {\n         args.extend_from_slice(&[\"--cfg\".to_owned(), r#\"feature=\"cargo-clippy\"\"#.to_owned()]);\n+        if let Ok(extra_args) = env::var(\"CLIPPY_ARGS\") {\n+            args.extend(extra_args.split(\"__CLIPPY_HACKERY__\").filter(|s| !s.is_empty()).map(str::to_owned));\n+        }\n     }\n \n     let mut ccc = ClippyCompilerCalls::new(clippy_enabled);"}, {"sha": "598d129dec2b22e813812467f91e96944325782a", "filename": "src/main.rs", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56/src%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e34a8553b00ebc3fed70dd2347ad0675b7eb0d56/src%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain.rs?ref=e34a8553b00ebc3fed70dd2347ad0675b7eb0d56", "patch": "@@ -175,23 +175,22 @@ pub fn main() {\n     }\n }\n \n-fn process<I>(old_args: I) -> Result<(), i32>\n+fn process<I>(mut old_args: I) -> Result<(), i32>\n where\n     I: Iterator<Item = String>,\n {\n-    let mut args = vec![\"rustc\".to_owned()];\n+    let mut args = vec![\"check\".to_owned()];\n \n     let mut found_dashes = false;\n-    for arg in old_args {\n+    for arg in old_args.by_ref() {\n         found_dashes |= arg == \"--\";\n+        if found_dashes {\n+            break;\n+        }\n         args.push(arg);\n     }\n-    if !found_dashes {\n-        args.push(\"--\".to_owned());\n-    }\n-    args.push(\"--emit=metadata\".to_owned());\n-    args.push(\"--cfg\".to_owned());\n-    args.push(r#\"feature=\"cargo-clippy\"\"#.to_owned());\n+\n+    let clippy_args: String = old_args.map(|arg| format!(\"{}__CLIPPY_HACKERY__\", arg)).collect();\n \n     let mut path = std::env::current_exe()\n         .expect(\"current executable path invalid\")\n@@ -202,6 +201,7 @@ where\n     let exit_status = std::process::Command::new(\"cargo\")\n         .args(&args)\n         .env(\"RUSTC_WRAPPER\", path)\n+        .env(\"CLIPPY_ARGS\", clippy_args)\n         .spawn()\n         .expect(\"could not run cargo\")\n         .wait()"}]}