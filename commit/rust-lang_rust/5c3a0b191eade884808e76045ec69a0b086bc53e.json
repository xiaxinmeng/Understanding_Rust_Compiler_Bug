{"sha": "5c3a0b191eade884808e76045ec69a0b086bc53e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjM2EwYjE5MWVhZGU4ODQ4MDhlNzYwNDVlYzY5YTBiMDg2YmM1M2U=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2015-03-09T18:18:43Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2015-03-09T18:18:43Z"}, "message": "Add tests checking that a number of feature gates are gating their features.\n\nNamely:\n\n * `quote`\n * `link_args`\n * `link_llvm_intrinsics`\n * `thread_local`\n * `unsafe_destructor`\n\nAlso updates test for `plugin_registrar` to make it clear that\nit is only testing the `plugin_registrar` feature gate.\n\nCc #22820.", "tree": {"sha": "882d7645988ecf83759222d83ffed13eae2f4265", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/882d7645988ecf83759222d83ffed13eae2f4265"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c3a0b191eade884808e76045ec69a0b086bc53e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c3a0b191eade884808e76045ec69a0b086bc53e", "html_url": "https://github.com/rust-lang/rust/commit/5c3a0b191eade884808e76045ec69a0b086bc53e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c3a0b191eade884808e76045ec69a0b086bc53e/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2574009af0ff70dc233beab246db8f2d715be2cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/2574009af0ff70dc233beab246db8f2d715be2cb", "html_url": "https://github.com/rust-lang/rust/commit/2574009af0ff70dc233beab246db8f2d715be2cb"}], "stats": {"total": 144, "additions": 142, "deletions": 2}, "files": [{"sha": "6a5cd88a591563676d71a7b5cffbb519765f85d7", "filename": "src/test/compile-fail-fulldeps/gated-quote.rs", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail-fulldeps%2Fgated-quote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail-fulldeps%2Fgated-quote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail-fulldeps%2Fgated-quote.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -0,0 +1,50 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that `quote`-related macro are gated by `quote` feature gate.\n+\n+// (To sanity-check the code, uncomment this.)\n+// #![feature(quote)]\n+\n+// FIXME the error message that is current emitted seems pretty bad.\n+\n+#![feature(rustc_private)]\n+#![allow(dead_code, unused_imports, unused_variables)]\n+\n+#[macro_use]\n+extern crate syntax;\n+\n+use syntax::ast;\n+use syntax::codemap::Span;\n+use syntax::parse;\n+\n+struct ParseSess;\n+\n+impl ParseSess {\n+    fn cfg(&self) -> ast::CrateConfig { loop { } }\n+    fn parse_sess<'a>(&'a self) -> &'a parse::ParseSess { loop { } }\n+    fn call_site(&self) -> Span { loop { } }\n+    fn ident_of(&self, st: &str) -> ast::Ident { loop { } }\n+    fn name_of(&self, st: &str) -> ast::Name { loop { } }\n+}\n+\n+pub fn main() {\n+    let ecx = &ParseSess;\n+    let x = quote_tokens!(ecx, 3);   //~ ERROR macro undefined: 'quote_tokens!'\n+    let x = quote_expr!(ecx, 3);     //~ ERROR macro undefined: 'quote_expr!'\n+    let x = quote_ty!(ecx, 3);       //~ ERROR macro undefined: 'quote_ty!'\n+    let x = quote_method!(ecx, 3);   //~ ERROR macro undefined: 'quote_method!'\n+    let x = quote_item!(ecx, 3);     //~ ERROR macro undefined: 'quote_item!'\n+    let x = quote_pat!(ecx, 3);      //~ ERROR macro undefined: 'quote_pat!'\n+    let x = quote_arm!(ecx, 3);      //~ ERROR macro undefined: 'quote_arm!'\n+    let x = quote_stmt!(ecx, 3);     //~ ERROR macro undefined: 'quote_stmt!'\n+    let x = quote_matcher!(ecx, 3);  //~ ERROR macro undefined: 'quote_matcher!'\n+    let x = quote_attr!(ecx, 3);     //~ ERROR macro undefined: 'quote_attr!'\n+}"}, {"sha": "c8845ced2fc92cb9c99dd9156622eea020563ab0", "filename": "src/test/compile-fail/gated-link-args.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-link-args.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that `#[link_args]` attribute is gated by `link_args`\n+// feature gate.\n+\n+#[link_args = \"aFdEfSeVEEE\"]\n+extern {}\n+//~^ ERROR the `link_args` attribute is not portable across platforms\n+//~| HELP add #![feature(link_args)] to the crate attributes to enable\n+\n+fn main() { }"}, {"sha": "716ea9f8dba21ff678941d09bbd7ffe0e35ae60b", "filename": "src/test/compile-fail/gated-link-llvm-intrinsics.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-link-llvm-intrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-link-llvm-intrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-link-llvm-intrinsics.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -0,0 +1,19 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+extern {\n+    #[link_name = \"llvm.sqrt.f32\"]\n+    fn sqrt(x: f32) -> f32;\n+    //~^ ERROR linking to LLVM intrinsics is experimental\n+    //~| HELP add #![feature(link_llvm_intrinsics)] to the crate attributes\n+}\n+\n+fn main(){\n+}"}, {"sha": "d716c53e1d18ce68c4db2f1a79f42b7c9802cae4", "filename": "src/test/compile-fail/gated-plugin_registrar.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-plugin_registrar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-plugin_registrar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-plugin_registrar.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -8,8 +8,12 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// Test that `#[plugin_registrar]` attribute is gated by `plugin_registrar`\n+// feature gate.\n+\n // the registration function isn't typechecked yet\n #[plugin_registrar]\n-pub fn registrar() {} //~ ERROR compiler plugins are experimental\n-\n+pub fn registrar() {}\n+//~^ ERROR compiler plugins are experimental\n+//~| HELP add #![feature(plugin_registrar)] to the crate attributes to enable\n fn main() {}"}, {"sha": "f355c6562c8b0a2e18cd8babd32c44c608297ff2", "filename": "src/test/compile-fail/gated-thread-local.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-thread-local.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-thread-local.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-thread-local.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that `#[thread_local]` attribute is gated by `thread_local`\n+// feature gate.\n+//\n+// (Note that the `thread_local!` macro is explicitly *not* gated; it\n+// is given permission to expand into this unstable attribute even\n+// when the surrounding context does not have permission to use it.)\n+\n+#[thread_local] //~ ERROR `#[thread_local]` is an experimental feature\n+static FOO: i32 = 3;\n+\n+pub fn main() {\n+    FOO.with(|x| {\n+        println!(\"x: {}\", x);\n+    });\n+}"}, {"sha": "6024fef9fb81f043256f4f189995349a6943e8b4", "filename": "src/test/compile-fail/gated-unsafe-destructor.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-unsafe-destructor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c3a0b191eade884808e76045ec69a0b086bc53e/src%2Ftest%2Fcompile-fail%2Fgated-unsafe-destructor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fgated-unsafe-destructor.rs?ref=5c3a0b191eade884808e76045ec69a0b086bc53e", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Test that `#[unsafe_destructor]` attribute is gated by `unsafe_destructor`\n+// feature gate.\n+\n+struct D<'a>(&'a u32);\n+\n+#[unsafe_destructor]\n+impl<'a> Drop for D<'a> {\n+    //~^ ERROR `#[unsafe_destructor]` allows too many unsafe patterns\n+    fn drop(&mut self) { }\n+}\n+//~^ HELP: add #![feature(unsafe_destructor)] to the crate attributes to enable\n+\n+pub fn main() { }"}]}