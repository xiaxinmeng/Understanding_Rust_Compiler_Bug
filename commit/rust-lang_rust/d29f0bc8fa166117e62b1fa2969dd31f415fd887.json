{"sha": "d29f0bc8fa166117e62b1fa2969dd31f415fd887", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyOWYwYmM4ZmExNjYxMTdlNjJiMWZhMjk2OWRkMzFmNDE1ZmQ4ODc=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2017-02-10T20:59:40Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2017-02-13T23:52:03Z"}, "message": "Automatically vendor Cargo deps when building the source tarballs.", "tree": {"sha": "29bf430d515a0cd59cc2c99c88bf355e7a7fee26", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29bf430d515a0cd59cc2c99c88bf355e7a7fee26"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d29f0bc8fa166117e62b1fa2969dd31f415fd887", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d29f0bc8fa166117e62b1fa2969dd31f415fd887", "html_url": "https://github.com/rust-lang/rust/commit/d29f0bc8fa166117e62b1fa2969dd31f415fd887", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d29f0bc8fa166117e62b1fa2969dd31f415fd887/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42c1ea2915d7787e4280b13b9d48bdb29f50e1d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/42c1ea2915d7787e4280b13b9d48bdb29f50e1d1", "html_url": "https://github.com/rust-lang/rust/commit/42c1ea2915d7787e4280b13b9d48bdb29f50e1d1"}], "stats": {"total": 142, "additions": 106, "deletions": 36}, "files": [{"sha": "a3bcc85998bce7e840dc967f9566ce7838feef88", "filename": ".travis.yml", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -47,15 +47,24 @@ matrix:\n       install: &osx_install_sccache >\n         curl -L https://api.pub.build.mozilla.org/tooltool/sha512/d0025b286468cc5ada83b23d3fafbc936b9f190eaa7d4a981715b18e8e3bf720a7bcee7bfe758cfdeb8268857f6098fd52dcdd8818232692a30ce91039936596 |\n           tar xJf - -C /usr/local/bin --strip-components=1\n+    - env: >\n+        RUST_CHECK_TARGET=check\n+        RUST_CONFIGURE_ARGS=--build=i686-apple-darwin\n+        SRC=.\n+      os: osx\n+      osx_image: xcode8.2\n+      install: *osx_install_sccache\n \n     - env: >\n-        SCRIPT=\"./x.py test && ./x.py dist\"\n+        RUST_CHECK_TARGET=dist\n         RUST_CONFIGURE_ARGS=\"--build=i686-apple-darwin --enable-extended\"\n         SRC=.\n         DEPLOY=1\n       os: osx\n       osx_image: xcode8.2\n-      install: *osx_install_sccache\n+      install: >\n+        curl -L https://api.pub.build.mozilla.org/tooltool/sha512/d0025b286468cc5ada83b23d3fafbc936b9f190eaa7d4a981715b18e8e3bf720a7bcee7bfe758cfdeb8268857f6098fd52dcdd8818232692a30ce91039936596 |\n+          tar xJf - -C /usr/local/bin --strip-components=1 && brew uninstall --ignore-dependencies openssl && brew install openssl --universal --without-test\n     - env: >\n         RUST_CHECK_TARGET=dist\n         RUST_CONFIGURE_ARGS=\"--target=aarch64-apple-ios,armv7-apple-ios,armv7s-apple-ios,i386-apple-ios,x86_64-apple-ios --enable-extended\""}, {"sha": "9fff2f3c8b4df4dcea452371f1dad28d28892679", "filename": "appveyor.yml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -17,7 +17,6 @@ environment:\n \n   # MSVC cargotest\n   - MSYS_BITS: 64\n-    NO_VENDOR: 1\n     RUST_CHECK_TARGET: check-aux\n     RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc\n "}, {"sha": "e9a0b4c476eb23b4767e684061327b040a17d6bc", "filename": "configure", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/configure", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -648,6 +648,7 @@ opt rustbuild 1 \"use the rust and cargo based build system\"\n opt codegen-tests 1 \"run the src/test/codegen tests\"\n opt option-checking 1 \"complain about unrecognized options in this configure script\"\n opt ninja 0 \"build LLVM using the Ninja generator (for MSVC, requires building in the correct environment)\"\n+opt locked-deps 0 \"force Cargo.lock to be up to date\"\n opt vendor 0 \"enable usage of vendored Rust crates\"\n opt sanitizers 0 \"build the sanitizer runtimes (asan, lsan, msan, tsan)\"\n "}, {"sha": "92a075ea9dc2e153e552340a0d7c07bfc4d38ce6", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -294,6 +294,8 @@ def build_bootstrap(self):\n             raise Exception(\"no cargo executable found at `%s`\" % self.cargo())\n         args = [self.cargo(), \"build\", \"--manifest-path\",\n                 os.path.join(self.rust_root, \"src/bootstrap/Cargo.toml\")]\n+        if self.use_locked_deps:\n+            args.append(\"--locked\")\n         if self.use_vendored_sources:\n             args.append(\"--frozen\")\n         self.run(args, env)\n@@ -440,6 +442,9 @@ def main():\n     rb.use_vendored_sources = '\\nvendor = true' in rb.config_toml or \\\n                               'CFG_ENABLE_VENDOR' in rb.config_mk\n \n+    rb.use_locked_deps = '\\nlocked-deps = true' in rb.config_toml or \\\n+                         'CFG_ENABLE_LOCKED_DEPS' in rb.config_mk\n+\n     if 'SUDO_USER' in os.environ and not rb.use_vendored_sources:\n         if os.environ.get('USER') != os.environ['SUDO_USER']:\n             rb.use_vendored_sources = True"}, {"sha": "00758460becc58790ef7e9547bfa4cc70633d647", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -108,8 +108,12 @@ pub fn cargotest(build: &Build, stage: u32, host: &str) {\n pub fn tidy(build: &Build, host: &str) {\n     println!(\"tidy check ({})\", host);\n     let compiler = Compiler::new(0, host);\n-    build.run(build.tool_cmd(&compiler, \"tidy\")\n-                   .arg(build.src.join(\"src\")));\n+    let mut cmd = build.tool_cmd(&compiler, \"tidy\");\n+    cmd.arg(build.src.join(\"src\"));\n+    if !build.config.vendor {\n+        cmd.arg(\"--no-vendor\");\n+    }\n+    build.run(&mut cmd);\n }\n \n fn testdir(build: &Build, host: &str) -> PathBuf {\n@@ -643,6 +647,7 @@ pub fn distcheck(build: &Build) {\n     build.run(&mut cmd);\n     build.run(Command::new(\"./configure\")\n                      .args(&build.config.configure_args)\n+                     .arg(\"--enable-vendor\")\n                      .current_dir(&dir));\n     build.run(Command::new(build_helper::make(&build.config.build))\n                      .arg(\"check\")"}, {"sha": "e95416be4b6dc75fd4488bbb5195eb008db7a722", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -44,6 +44,7 @@ pub struct Config {\n     pub submodules: bool,\n     pub compiler_docs: bool,\n     pub docs: bool,\n+    pub locked_deps: bool,\n     pub vendor: bool,\n     pub target_config: HashMap<String, Target>,\n     pub full_bootstrap: bool,\n@@ -145,6 +146,7 @@ struct Build {\n     docs: Option<bool>,\n     submodules: Option<bool>,\n     gdb: Option<String>,\n+    locked_deps: Option<bool>,\n     vendor: Option<bool>,\n     nodejs: Option<String>,\n     python: Option<String>,\n@@ -294,6 +296,7 @@ impl Config {\n         set(&mut config.compiler_docs, build.compiler_docs);\n         set(&mut config.docs, build.docs);\n         set(&mut config.submodules, build.submodules);\n+        set(&mut config.locked_deps, build.locked_deps);\n         set(&mut config.vendor, build.vendor);\n         set(&mut config.full_bootstrap, build.full_bootstrap);\n         set(&mut config.extended, build.extended);\n@@ -440,6 +443,7 @@ impl Config {\n                 (\"LOCAL_REBUILD\", self.local_rebuild),\n                 (\"NINJA\", self.ninja),\n                 (\"CODEGEN_TESTS\", self.codegen_tests),\n+                (\"LOCKED_DEPS\", self.locked_deps),\n                 (\"VENDOR\", self.vendor),\n                 (\"FULL_BOOTSTRAP\", self.full_bootstrap),\n                 (\"EXTENDED\", self.extended),"}, {"sha": "f95e890f346eedc3b4f059248eebbd09d6d76729", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -108,6 +108,10 @@\n # Note that Python 2 is currently required.\n #python = \"python2.7\"\n \n+# Force Cargo to check that Cargo.lock describes the precise dependency\n+# set that all the Cargo.toml files create, instead of updating it.\n+#locked-deps = false\n+\n # Indicate whether the vendored sources are used for Rust dependencies or not\n #vendor = false\n "}, {"sha": "52a7c63c9045fd086c72725779c88faefbb9d09e", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -360,6 +360,8 @@ pub fn analysis(build: &Build, compiler: &Compiler, target: &str) {\n     t!(fs::remove_dir_all(&image));\n }\n \n+const CARGO_VENDOR_VERSION: &'static str = \"0.1.4\";\n+\n /// Creates the `rust-src` installer component and the plain source tarball\n pub fn rust_src(build: &Build) {\n     println!(\"Dist src\");\n@@ -404,13 +406,6 @@ pub fn rust_src(build: &Build) {\n             }\n         }\n \n-        // If we're inside the vendor directory then we need to preserve\n-        // everything as Cargo's vendoring support tracks all checksums and we\n-        // want to be sure we don't accidentally leave out a file.\n-        if spath.contains(\"vendor\") {\n-            return true\n-        }\n-\n         let excludes = [\n             \"CVS\", \"RCS\", \"SCCS\", \".git\", \".gitignore\", \".gitmodules\",\n             \".gitattributes\", \".cvsignore\", \".svn\", \".arch-ids\", \"{arch}\",\n@@ -433,6 +428,29 @@ pub fn rust_src(build: &Build) {\n         copy(&build.src.join(item), &dst_src.join(item));\n     }\n \n+    // Get cargo-vendor installed, if it isn't already.\n+    let mut has_cargo_vendor = false;\n+    let mut cmd = Command::new(&build.cargo);\n+    for line in output(cmd.arg(\"install\").arg(\"--list\")).lines() {\n+        has_cargo_vendor |= line.starts_with(\"cargo-vendor \");\n+    }\n+    if !has_cargo_vendor {\n+        let mut cmd = Command::new(&build.cargo);\n+        cmd.arg(\"install\")\n+           .arg(\"--force\")\n+           .arg(\"--debug\")\n+           .arg(\"--vers\").arg(CARGO_VENDOR_VERSION)\n+           .arg(\"cargo-vendor\")\n+           .env(\"RUSTC\", &build.rustc);\n+        build.run(&mut cmd);\n+    }\n+\n+    // Vendor all Cargo dependencies\n+    let mut cmd = Command::new(&build.cargo);\n+    cmd.arg(\"vendor\")\n+       .current_dir(&dst_src.join(\"src\"));\n+    build.run(&mut cmd);\n+\n     // Create source tarball in rust-installer format\n     let mut cmd = Command::new(\"sh\");\n     cmd.arg(sanitize_sh(&build.src.join(\"src/rust-installer/gen-installer.sh\")))"}, {"sha": "7bd611eb53e3c136d329ec5bb5c56855fb77acb3", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -528,6 +528,9 @@ impl Build {\n         if self.config.rust_optimize && cmd != \"bench\" {\n             cargo.arg(\"--release\");\n         }\n+        if self.config.locked_deps {\n+            cargo.arg(\"--locked\");\n+        }\n         if self.config.vendor || self.is_sudo {\n             cargo.arg(\"--frozen\");\n         }"}, {"sha": "ae1bfd9e40a80861548838ed05d011d20e891b3a", "filename": "src/ci/docker/android/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fandroid%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fandroid%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fandroid%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -16,7 +16,9 @@ RUN dpkg --add-architecture i386 && \\\n   openjdk-9-jre \\\n   sudo \\\n   libstdc++6:i386 \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n WORKDIR /android/\n ENV PATH=$PATH:/android/ndk-arm-9/bin:/android/sdk/tools:/android/sdk/platform-tools"}, {"sha": "52c5b83f2632284986b0ecf06d331fee56866de2", "filename": "src/ci/docker/cross/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fcross%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fcross%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -17,7 +17,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gcc-sparc64-linux-gnu \\\n   libc6-dev-sparc64-cross \\\n   bzip2 \\\n-  patch\n+  patch \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "e5619564b05d222516a1fb3c336a2623dc1ae925", "filename": "src/ci/docker/dist-arm-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-arm-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,7 +23,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   texinfo \\\n   wget \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "5b94d5a972704ff9d30619ffdd6f27280b304bfc", "filename": "src/ci/docker/dist-armv7-aarch64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-armv7-aarch64-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,7 +23,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   texinfo \\\n   wget \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "c39e298e3ceb09f909a840300e7fd2ee10800d2a", "filename": "src/ci/docker/dist-freebsd/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-freebsd%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -12,7 +12,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   bzip2 \\\n   xz-utils \\\n-  wget\n+  wget \\\n+  libssl-dev \\\n+  pkg-config\n \n COPY build-toolchain.sh /tmp/\n RUN /tmp/build-toolchain.sh x86_64"}, {"sha": "5d8b3cfeae2a3116c3e1a5b1b04d250c3bc3b856", "filename": "src/ci/docker/dist-mips-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -13,7 +13,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils \\\n   g++-mips-linux-gnu \\\n-  g++-mipsel-linux-gnu\n+  g++-mipsel-linux-gnu \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "8feba12e72203db87de50a8e45defb9df0d07640", "filename": "src/ci/docker/dist-mips64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-mips64-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -13,7 +13,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   gdb \\\n   xz-utils \\\n   g++-mips64-linux-gnuabi64 \\\n-  g++-mips64el-linux-gnuabi64\n+  g++-mips64el-linux-gnuabi64 \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "e5ffbfc090d5ad9a32296fcd5b4b5c91eb9a9928", "filename": "src/ci/docker/dist-powerpc-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,7 +23,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   texinfo \\\n   wget \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "7d13bc3d438bab213be729c2b0c170dc12cec096", "filename": "src/ci/docker/dist-powerpc64-linux/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-powerpc64-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,7 +23,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   texinfo \\\n   wget \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "7f4c6d4647c7d5c83455a3b45c092d069a91d28b", "filename": "src/ci/docker/dist-s390x-linux-netbsd/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-s390x-linux-netbsd%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,7 +23,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   sudo \\\n   texinfo \\\n   wget \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "61c23201c2cee663e3cd7fdb0ec062fbf07ac21c", "filename": "src/ci/docker/dist-x86-linux/Dockerfile", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -13,13 +13,14 @@ RUN yum upgrade -y && yum install -y \\\n       file \\\n       xz \\\n       which \\\n-      pkg-config \\\n+      pkgconfig \\\n       wget \\\n       autoconf \\\n       gettext\n \n ENV PATH=/rustroot/bin:$PATH\n ENV LD_LIBRARY_PATH=/rustroot/lib64:/rustroot/lib\n+ENV PKG_CONFIG_PATH=/rustroot/lib/pkgconfig\n WORKDIR /tmp\n COPY shared.sh build-binutils.sh /tmp/\n "}, {"sha": "84b98712b3385c6670e782ec5dd3f47ee6b966ac", "filename": "src/ci/docker/i686-gnu/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fi686-gnu%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,4 +23,4 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu\n-ENV SCRIPT python2.7 ../x.py test && python2.7 ../x.py dist\n+ENV SCRIPT python2.7 ../x.py test"}, {"sha": "feb73bebbdbec0592eaed535b7e2c23ecb437378", "filename": "src/ci/docker/linux-tested-targets/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Flinux-tested-targets%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Flinux-tested-targets%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Flinux-tested-targets%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -12,7 +12,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   xz-utils \\\n   sudo \\\n   gdb \\\n-  patch\n+  patch \\\n+  libssl-dev \\\n+  pkg-config\n \n WORKDIR /build/\n COPY musl-libunwind-patch.patch build-musl.sh /build/"}, {"sha": "607163ea547a302d1b487871ed908b4014d16b28", "filename": "src/ci/docker/x86_64-gnu-aux/Dockerfile", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-aux%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -25,4 +25,3 @@ ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n ENV RUST_CHECK_TARGET check-aux\n-ENV NO_VENDOR 1"}, {"sha": "ad6c0c15f728262c04f7278ab25e6ffb117969aa", "filename": "src/ci/docker/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -11,7 +11,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   sudo \\\n   gdb \\\n-  xz-utils\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n \n ENV SCCACHE_DIGEST=7237e38e029342fa27b7ac25412cb9d52554008b12389727320bd533fd7f05b6a96d55485f305caf95e5c8f5f97c3313e10012ccad3e752aba2518f3522ba783\n RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST | \\"}, {"sha": "427498fabb2d72943b2ea14e36c2f3fcbe1e43f9", "filename": "src/ci/docker/x86_64-gnu/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu%2FDockerfile?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,4 +23,4 @@ RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-ini\n ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --enable-sanitizers\n-ENV SCRIPT python2.7 ../x.py test && python2.7 ../x.py dist\n+ENV SCRIPT python2.7 ../x.py test"}, {"sha": "c161d9980369cc366d87cdbad0f395742162c099", "filename": "src/ci/run.sh", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -23,6 +23,7 @@ fi\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-sccache\"\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-quiet-tests\"\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-manage-submodules\"\n+RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-locked-deps\"\n \n # If we're deploying artifacts then we set the release channel, otherwise if\n # we're not deploying then we want to be sure to enable all assertions becauase\n@@ -47,13 +48,6 @@ else\n   fi\n fi\n \n-# We want to enable usage of the `src/vendor` dir as much as possible, but not\n-# all test suites have all their deps in there (just the main bootstrap) so we\n-# have the ability to disable this flag\n-if [ \"$NO_VENDOR\" = \"\" ]; then\n-  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-vendor\"\n-fi\n-\n set -ex\n \n $SRC/configure $RUST_CONFIGURE_ARGS"}, {"sha": "1bb7919c1d35bdad815bb576f72e232074dd1375", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d29f0bc8fa166117e62b1fa2969dd31f415fd887/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=d29f0bc8fa166117e62b1fa2969dd31f415fd887", "patch": "@@ -42,14 +42,18 @@ fn main() {\n     let path = env::args_os().skip(1).next().expect(\"need an argument\");\n     let path = PathBuf::from(path);\n \n+    let args: Vec<String> = env::args().skip(1).collect();\n+\n     let mut bad = false;\n     bins::check(&path, &mut bad);\n     style::check(&path, &mut bad);\n     errors::check(&path, &mut bad);\n     cargo::check(&path, &mut bad);\n     features::check(&path, &mut bad);\n     pal::check(&path, &mut bad);\n-    deps::check(&path, &mut bad);\n+    if !args.iter().any(|s| *s == \"--no-vendor\") {\n+        deps::check(&path, &mut bad);\n+    }\n \n     if bad {\n         panic!(\"some tidy checks failed\");"}]}