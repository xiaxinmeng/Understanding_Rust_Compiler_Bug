{"sha": "5ed6a13a2c81f24bd12cc74332f7e94301c73980", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlZDZhMTNhMmM4MWYyNGJkMTJjYzc0MzMyZjdlOTQzMDFjNzM5ODA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-08-15T05:49:13Z"}, "committer": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-08-15T05:49:13Z"}, "message": "Merge #1685\n\n1685: fix error of RangeFrom in for-loop r=DJMcNab a=bravomikekilo\n\nfix [issue-1542](https://github.com/rust-analyzer/rust-analyzer/issues/1542) @matklad \n\nCo-authored-by: bravomikekilo <bmk1221@126.com>", "tree": {"sha": "87a7c456d17459f7c903ac34d3a1f60371762ac3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87a7c456d17459f7c903ac34d3a1f60371762ac3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ed6a13a2c81f24bd12cc74332f7e94301c73980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ed6a13a2c81f24bd12cc74332f7e94301c73980", "html_url": "https://github.com/rust-lang/rust/commit/5ed6a13a2c81f24bd12cc74332f7e94301c73980", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ed6a13a2c81f24bd12cc74332f7e94301c73980/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "19e0d7d596015599fd705eecfe6f695aabc8632d", "url": "https://api.github.com/repos/rust-lang/rust/commits/19e0d7d596015599fd705eecfe6f695aabc8632d", "html_url": "https://github.com/rust-lang/rust/commit/19e0d7d596015599fd705eecfe6f695aabc8632d"}, {"sha": "4f31fed362e1bb08f748b188eedc0bdc5a070bee", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f31fed362e1bb08f748b188eedc0bdc5a070bee", "html_url": "https://github.com/rust-lang/rust/commit/4f31fed362e1bb08f748b188eedc0bdc5a070bee"}], "stats": {"total": 143, "additions": 142, "deletions": 1}, "files": [{"sha": "bc942ae010286ffc388fad8608189ac49f6fa3e1", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=5ed6a13a2c81f24bd12cc74332f7e94301c73980", "patch": "@@ -110,7 +110,19 @@ pub(super) fn atom_expr(p: &mut Parser, r: Restrictions) -> Option<(CompletedMar\n             p.bump();\n             block_expr(p, Some(m))\n         }\n-        T!['{'] => block_expr(p, None),\n+        T!['{'] => {\n+            // test for_range_from\n+            // fn foo() {\n+            //    for x in 0 .. {\n+            //        break;\n+            //    }\n+            // }\n+            if r.forbid_structs {\n+                return None;\n+            } else {\n+                block_expr(p, None)\n+            }\n+        }\n         T![return] => return_expr(p),\n         T![continue] => continue_expr(p),\n         T![break] => break_expr(p, r),"}, {"sha": "af0d40a7aa20c14c7bbea59b86512cb5b4a61ff2", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0142_for_range_from.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.rs?ref=5ed6a13a2c81f24bd12cc74332f7e94301c73980", "patch": "@@ -0,0 +1,5 @@\n+fn foo() {\n+   for x in 0 .. {\n+       break;\n+   }\n+}"}, {"sha": "9e5836233ae333ec09224221f548fab873ce78ab", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0142_for_range_from.txt", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_from.txt?ref=5ed6a13a2c81f24bd12cc74332f7e94301c73980", "patch": "@@ -0,0 +1,40 @@\n+SOURCE_FILE@[0; 51)\n+  FN_DEF@[0; 50)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 6)\n+      IDENT@[3; 6) \"foo\"\n+    PARAM_LIST@[6; 8)\n+      L_PAREN@[6; 7) \"(\"\n+      R_PAREN@[7; 8) \")\"\n+    WHITESPACE@[8; 9) \" \"\n+    BLOCK@[9; 50)\n+      L_CURLY@[9; 10) \"{\"\n+      WHITESPACE@[10; 14) \"\\n   \"\n+      FOR_EXPR@[14; 48)\n+        FOR_KW@[14; 17) \"for\"\n+        WHITESPACE@[17; 18) \" \"\n+        BIND_PAT@[18; 19)\n+          NAME@[18; 19)\n+            IDENT@[18; 19) \"x\"\n+        WHITESPACE@[19; 20) \" \"\n+        IN_KW@[20; 22) \"in\"\n+        WHITESPACE@[22; 23) \" \"\n+        RANGE_EXPR@[23; 27)\n+          LITERAL@[23; 24)\n+            INT_NUMBER@[23; 24) \"0\"\n+          WHITESPACE@[24; 25) \" \"\n+          DOTDOT@[25; 27) \"..\"\n+        WHITESPACE@[27; 28) \" \"\n+        BLOCK@[28; 48)\n+          L_CURLY@[28; 29) \"{\"\n+          WHITESPACE@[29; 37) \"\\n       \"\n+          EXPR_STMT@[37; 43)\n+            BREAK_EXPR@[37; 42)\n+              BREAK_KW@[37; 42) \"break\"\n+            SEMI@[42; 43) \";\"\n+          WHITESPACE@[43; 47) \"\\n   \"\n+          R_CURLY@[47; 48) \"}\"\n+      WHITESPACE@[48; 49) \"\\n\"\n+      R_CURLY@[49; 50) \"}\"\n+  WHITESPACE@[50; 51) \"\\n\""}, {"sha": "b51b1963008ce390ae9da2e985bb02b5194307ad", "filename": "crates/ra_syntax/test_data/parser/ok/0052_for_range_block.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.rs?ref=5ed6a13a2c81f24bd12cc74332f7e94301c73980", "patch": "@@ -0,0 +1,5 @@\n+fn foo() {\n+   for _x in 0 .. (0 .. {1 + 2}).sum::<u32>() {\n+       break;\n+   }\n+}"}, {"sha": "858f042c612187b022863bfd7e7c491f31c99f44", "filename": "crates/ra_syntax/test_data/parser/ok/0052_for_range_block.txt", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/rust-lang/rust/blob/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5ed6a13a2c81f24bd12cc74332f7e94301c73980/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Fok%2F0052_for_range_block.txt?ref=5ed6a13a2c81f24bd12cc74332f7e94301c73980", "patch": "@@ -0,0 +1,79 @@\n+SOURCE_FILE@[0; 80)\n+  FN_DEF@[0; 79)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 6)\n+      IDENT@[3; 6) \"foo\"\n+    PARAM_LIST@[6; 8)\n+      L_PAREN@[6; 7) \"(\"\n+      R_PAREN@[7; 8) \")\"\n+    WHITESPACE@[8; 9) \" \"\n+    BLOCK@[9; 79)\n+      L_CURLY@[9; 10) \"{\"\n+      WHITESPACE@[10; 14) \"\\n   \"\n+      FOR_EXPR@[14; 77)\n+        FOR_KW@[14; 17) \"for\"\n+        WHITESPACE@[17; 18) \" \"\n+        BIND_PAT@[18; 20)\n+          NAME@[18; 20)\n+            IDENT@[18; 20) \"_x\"\n+        WHITESPACE@[20; 21) \" \"\n+        IN_KW@[21; 23) \"in\"\n+        WHITESPACE@[23; 24) \" \"\n+        RANGE_EXPR@[24; 56)\n+          LITERAL@[24; 25)\n+            INT_NUMBER@[24; 25) \"0\"\n+          WHITESPACE@[25; 26) \" \"\n+          DOTDOT@[26; 28) \"..\"\n+          WHITESPACE@[28; 29) \" \"\n+          METHOD_CALL_EXPR@[29; 56)\n+            PAREN_EXPR@[29; 43)\n+              L_PAREN@[29; 30) \"(\"\n+              RANGE_EXPR@[30; 42)\n+                LITERAL@[30; 31)\n+                  INT_NUMBER@[30; 31) \"0\"\n+                WHITESPACE@[31; 32) \" \"\n+                DOTDOT@[32; 34) \"..\"\n+                WHITESPACE@[34; 35) \" \"\n+                BLOCK_EXPR@[35; 42)\n+                  BLOCK@[35; 42)\n+                    L_CURLY@[35; 36) \"{\"\n+                    BIN_EXPR@[36; 41)\n+                      LITERAL@[36; 37)\n+                        INT_NUMBER@[36; 37) \"1\"\n+                      WHITESPACE@[37; 38) \" \"\n+                      PLUS@[38; 39) \"+\"\n+                      WHITESPACE@[39; 40) \" \"\n+                      LITERAL@[40; 41)\n+                        INT_NUMBER@[40; 41) \"2\"\n+                    R_CURLY@[41; 42) \"}\"\n+              R_PAREN@[42; 43) \")\"\n+            DOT@[43; 44) \".\"\n+            NAME_REF@[44; 47)\n+              IDENT@[44; 47) \"sum\"\n+            TYPE_ARG_LIST@[47; 54)\n+              COLONCOLON@[47; 49) \"::\"\n+              L_ANGLE@[49; 50) \"<\"\n+              TYPE_ARG@[50; 53)\n+                PATH_TYPE@[50; 53)\n+                  PATH@[50; 53)\n+                    PATH_SEGMENT@[50; 53)\n+                      NAME_REF@[50; 53)\n+                        IDENT@[50; 53) \"u32\"\n+              R_ANGLE@[53; 54) \">\"\n+            ARG_LIST@[54; 56)\n+              L_PAREN@[54; 55) \"(\"\n+              R_PAREN@[55; 56) \")\"\n+        WHITESPACE@[56; 57) \" \"\n+        BLOCK@[57; 77)\n+          L_CURLY@[57; 58) \"{\"\n+          WHITESPACE@[58; 66) \"\\n       \"\n+          EXPR_STMT@[66; 72)\n+            BREAK_EXPR@[66; 71)\n+              BREAK_KW@[66; 71) \"break\"\n+            SEMI@[71; 72) \";\"\n+          WHITESPACE@[72; 76) \"\\n   \"\n+          R_CURLY@[76; 77) \"}\"\n+      WHITESPACE@[77; 78) \"\\n\"\n+      R_CURLY@[78; 79) \"}\"\n+  WHITESPACE@[79; 80) \"\\n\""}]}