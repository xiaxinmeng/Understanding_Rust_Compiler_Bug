{"sha": "c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwY2I1ZWI1MzU4YzM4YzA3YzBiNTcyMTdlNjkxYmMzZWJiYjVlODU=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2019-08-06T02:09:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-08-06T02:09:45Z"}, "message": "Fix broken tuple pattern (#3729)", "tree": {"sha": "114e83a8516b41c5aef4344ca131149e41e427c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/114e83a8516b41c5aef4344ca131149e41e427c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdSOFpCRBK7hj4Ov3rIwAAdHIIABaUXvrFFPFwRLm217P1tkRx\ndtFE5NRMH6iD+jr4EB4XUfa5ebtqbZf3VQU9puCAVe9r5fI3igpuBCFk4cTA8/Hu\nBQiao6qF9iuAQVVEtEPn8a9Ayjn1q2x55ERn+F8fWmod+n+PgfkyZYk5IbyVDi5D\nEsQFRRO61QA4b6n/Jowx4gzo5Mn4ZL/pEDWKTtIkKBKCd5RxANZHaGLXqc0ENFgT\nyXz+wHJ+zo0ppsGxEYVm/Ei04bqM0doYFRzO8asIJaA5tu+fLBCwREFFp7Lz+N98\n5hJeCSdZh9yj4g6eS3OvJQAordtgotirnwjAlvxPsJqVI/LyUe/7nHVc8r1pH5Y=\n=8tJT\n-----END PGP SIGNATURE-----\n", "payload": "tree 114e83a8516b41c5aef4344ca131149e41e427c3\nparent 127de250417eac37c71f0383472d920e553ff814\nauthor Seiichi Uchida <seuchida@gmail.com> 1565057385 +0900\ncommitter GitHub <noreply@github.com> 1565057385 +0900\n\nFix broken tuple pattern (#3729)\n\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "html_url": "https://github.com/rust-lang/rust/commit/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "127de250417eac37c71f0383472d920e553ff814", "url": "https://api.github.com/repos/rust-lang/rust/commits/127de250417eac37c71f0383472d920e553ff814", "html_url": "https://github.com/rust-lang/rust/commit/127de250417eac37c71f0383472d920e553ff814"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "b5032eca6d5be7dd3f93c09984d868ff5ff2061b", "filename": "src/patterns.rs", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/src%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/src%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fpatterns.rs?ref=c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "patch": "@@ -272,6 +272,18 @@ impl<'a> Spanned for TuplePatField<'a> {\n     }\n }\n \n+impl<'a> TuplePatField<'a> {\n+    fn is_dotdot(&self) -> bool {\n+        match self {\n+            TuplePatField::Pat(pat) => match pat.node {\n+                ast::PatKind::Rest => true,\n+                _ => false,\n+            },\n+            TuplePatField::Dotdot(_) => true,\n+        }\n+    }\n+}\n+\n pub(crate) fn can_be_overflowed_pat(\n     context: &RewriteContext<'_>,\n     pat: &TuplePatField<'_>,\n@@ -321,15 +333,22 @@ fn rewrite_tuple_pat(\n         (&pat_vec[..], span)\n     };\n \n+    let is_last_pat_dotdot = pat_vec.last().map_or(false, |p| p.is_dotdot());\n+    let add_comma = path_str.is_none() && pat_vec.len() == 1 && !is_last_pat_dotdot;\n     let path_str = path_str.unwrap_or_default();\n+\n     overflow::rewrite_with_parens(\n         &context,\n         &path_str,\n         pat_vec.iter(),\n         shape,\n         span,\n         context.config.max_width(),\n-        None,\n+        if add_comma {\n+            Some(SeparatorTactic::Always)\n+        } else {\n+            None\n+        },\n     )\n }\n "}, {"sha": "f06d03cadf2f79556e5ae76b151605128087790d", "filename": "tests/source/pattern.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Fsource%2Fpattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Fsource%2Fpattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fpattern.rs?ref=c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "patch": "@@ -81,3 +81,10 @@ fn slice_patterns() {\n         _ => {}\n     }\n }\n+\n+fn issue3728() {\n+    let foo = |\n+    (c,)\n+        | c;\n+    foo((1,));\n+}"}, {"sha": "ba1029d4e61e2fe9f85ff9e5e474426bf2c8616e", "filename": "tests/target/issue-1021.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Ftarget%2Fissue-1021.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Ftarget%2Fissue-1021.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-1021.rs?ref=c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "patch": "@@ -15,7 +15,7 @@ fn main() {\n         (true, ..) => (),\n         (.., true) => (),\n         (..) => (),\n-        (_) => (),\n+        (_,) => (),\n         (/* .. */ ..) => (),\n         (/* .. */ .., true) => (),\n     }"}, {"sha": "576018ac623fd53264d702e59a981090272a092c", "filename": "tests/target/pattern.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Ftarget%2Fpattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85/tests%2Ftarget%2Fpattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fpattern.rs?ref=c0cb5eb5358c38c07c0b57217e691bc3ebbb5e85", "patch": "@@ -91,3 +91,8 @@ fn slice_patterns() {\n         _ => {}\n     }\n }\n+\n+fn issue3728() {\n+    let foo = |(c,)| c;\n+    foo((1,));\n+}"}]}