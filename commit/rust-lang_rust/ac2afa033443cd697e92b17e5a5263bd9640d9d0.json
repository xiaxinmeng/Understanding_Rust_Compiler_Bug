{"sha": "ac2afa033443cd697e92b17e5a5263bd9640d9d0", "node_id": "C_kwDOAAsO6NoAKGFjMmFmYTAzMzQ0M2NkNjk3ZTkyYjE3ZTVhNTI2M2JkOTY0MGQ5ZDA", "commit": {"author": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2022-03-09T22:47:00Z"}, "committer": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2022-03-09T23:51:10Z"}, "message": "Account for suggestions for complete removal of lines\n\nFix  #94192.", "tree": {"sha": "4c50ca0516e6540a9b2d9fe2017ac22aa452228d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4c50ca0516e6540a9b2d9fe2017ac22aa452228d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ac2afa033443cd697e92b17e5a5263bd9640d9d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ac2afa033443cd697e92b17e5a5263bd9640d9d0", "html_url": "https://github.com/rust-lang/rust/commit/ac2afa033443cd697e92b17e5a5263bd9640d9d0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ac2afa033443cd697e92b17e5a5263bd9640d9d0/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b97dc20784698730bd7bc1a20eabdcd32066d174", "url": "https://api.github.com/repos/rust-lang/rust/commits/b97dc20784698730bd7bc1a20eabdcd32066d174", "html_url": "https://github.com/rust-lang/rust/commit/b97dc20784698730bd7bc1a20eabdcd32066d174"}], "stats": {"total": 138, "additions": 138, "deletions": 0}, "files": [{"sha": "831d408195e2feede83e3e6f26f7f475bcff38cf", "filename": "compiler/rustc_errors/src/emitter.rs", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ac2afa033443cd697e92b17e5a5263bd9640d9d0/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac2afa033443cd697e92b17e5a5263bd9640d9d0/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Femitter.rs?ref=ac2afa033443cd697e92b17e5a5263bd9640d9d0", "patch": "@@ -1657,6 +1657,31 @@ impl EmitterWriter {\n             let line_start = sm.lookup_char_pos(parts[0].span.lo()).line;\n             draw_col_separator_no_space(&mut buffer, 1, max_line_num_len + 1);\n             let mut lines = complete.lines();\n+            if lines.clone().next().is_none() {\n+                // Account for a suggestion to completely remove a line(s) with whitespace (#94192).\n+                let line_end = sm.lookup_char_pos(parts[0].span.hi()).line;\n+                for line in line_start..=line_end {\n+                    buffer.puts(\n+                        row_num - 1 + line - line_start,\n+                        0,\n+                        &self.maybe_anonymized(line),\n+                        Style::LineNumber,\n+                    );\n+                    buffer.puts(\n+                        row_num - 1 + line - line_start,\n+                        max_line_num_len + 1,\n+                        \"- \",\n+                        Style::Removal,\n+                    );\n+                    buffer.puts(\n+                        row_num - 1 + line - line_start,\n+                        max_line_num_len + 3,\n+                        &normalize_whitespace(&*file_lines.file.get_line(line - 1).unwrap()),\n+                        Style::Removal,\n+                    );\n+                }\n+                row_num += line_end - line_start;\n+            }\n             for (line_pos, (line, highlight_parts)) in\n                 lines.by_ref().zip(highlights).take(MAX_SUGGESTION_HIGHLIGHT_LINES).enumerate()\n             {"}, {"sha": "56aed77c10e6877ee4b453e28cb620f6d316fb30", "filename": "src/test/ui/suggestions/removal-of-multiline-trait-bound-in-where-clause.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/ac2afa033443cd697e92b17e5a5263bd9640d9d0/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ac2afa033443cd697e92b17e5a5263bd9640d9d0/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.rs?ref=ac2afa033443cd697e92b17e5a5263bd9640d9d0", "patch": "@@ -0,0 +1,30 @@\n+struct Wrapper<T>(T);\n+\n+fn foo<T>(foo: Wrapper<T>)\n+//~^ ERROR the size for values of type `T` cannot be known at compilation time\n+where\n+    T\n+    :\n+    ?\n+    Sized\n+{\n+    //\n+}\n+\n+fn bar<T>(foo: Wrapper<T>)\n+//~^ ERROR the size for values of type `T` cannot be known at compilation time\n+where T: ?Sized\n+{\n+    //\n+}\n+\n+fn qux<T>(foo: Wrapper<T>)\n+//~^ ERROR the size for values of type `T` cannot be known at compilation time\n+where\n+    T: ?Sized\n+{\n+    //\n+}\n+\n+\n+fn main() {}"}, {"sha": "3df17056ef42cbbf034457dfdd8c697ca1413dd2", "filename": "src/test/ui/suggestions/removal-of-multiline-trait-bound-in-where-clause.stderr", "status": "added", "additions": 83, "deletions": 0, "changes": 83, "blob_url": "https://github.com/rust-lang/rust/blob/ac2afa033443cd697e92b17e5a5263bd9640d9d0/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ac2afa033443cd697e92b17e5a5263bd9640d9d0/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fremoval-of-multiline-trait-bound-in-where-clause.stderr?ref=ac2afa033443cd697e92b17e5a5263bd9640d9d0", "patch": "@@ -0,0 +1,83 @@\n+error[E0277]: the size for values of type `T` cannot be known at compilation time\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:3:16\n+   |\n+LL | fn foo<T>(foo: Wrapper<T>)\n+   |        -       ^^^^^^^^^^ doesn't have a size known at compile-time\n+   |        |\n+   |        this type parameter needs to be `std::marker::Sized`\n+   |\n+note: required by a bound in `Wrapper`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^ required by this bound in `Wrapper`\n+help: you could relax the implicit `Sized` bound on `T` if it were used through indirection like `&T` or `Box<T>`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^  - ...if indirection were used here: `Box<T>`\n+   |                |\n+   |                this could be changed to `T: ?Sized`...\n+help: consider removing the `?Sized` bound to make the type parameter `Sized`\n+   |\n+LL - where\n+LL -     T\n+LL -     :\n+LL -     ?\n+LL -     Sized\n+   | \n+\n+error[E0277]: the size for values of type `T` cannot be known at compilation time\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:14:16\n+   |\n+LL | fn bar<T>(foo: Wrapper<T>)\n+   |        -       ^^^^^^^^^^ doesn't have a size known at compile-time\n+   |        |\n+   |        this type parameter needs to be `std::marker::Sized`\n+   |\n+note: required by a bound in `Wrapper`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^ required by this bound in `Wrapper`\n+help: you could relax the implicit `Sized` bound on `T` if it were used through indirection like `&T` or `Box<T>`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^  - ...if indirection were used here: `Box<T>`\n+   |                |\n+   |                this could be changed to `T: ?Sized`...\n+help: consider removing the `?Sized` bound to make the type parameter `Sized`\n+   |\n+LL - where T: ?Sized\n+   | \n+\n+error[E0277]: the size for values of type `T` cannot be known at compilation time\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:21:16\n+   |\n+LL | fn qux<T>(foo: Wrapper<T>)\n+   |        -       ^^^^^^^^^^ doesn't have a size known at compile-time\n+   |        |\n+   |        this type parameter needs to be `std::marker::Sized`\n+   |\n+note: required by a bound in `Wrapper`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^ required by this bound in `Wrapper`\n+help: you could relax the implicit `Sized` bound on `T` if it were used through indirection like `&T` or `Box<T>`\n+  --> $DIR/removal-of-multiline-trait-bound-in-where-clause.rs:1:16\n+   |\n+LL | struct Wrapper<T>(T);\n+   |                ^  - ...if indirection were used here: `Box<T>`\n+   |                |\n+   |                this could be changed to `T: ?Sized`...\n+help: consider removing the `?Sized` bound to make the type parameter `Sized`\n+   |\n+LL - where\n+LL -     T: ?Sized\n+   | \n+\n+error: aborting due to 3 previous errors\n+\n+For more information about this error, try `rustc --explain E0277`."}]}