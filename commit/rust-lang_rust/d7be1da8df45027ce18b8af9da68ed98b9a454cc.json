{"sha": "d7be1da8df45027ce18b8af9da68ed98b9a454cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3YmUxZGE4ZGY0NTAyN2NlMThiOGFmOWRhNjhlZDk4YjlhNDU0Y2M=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-17T16:31:09Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-17T16:32:17Z"}, "message": "Inline ra_batch", "tree": {"sha": "bbbf059cd41cb48859710155c30d5dac4a657440", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbbf059cd41cb48859710155c30d5dac4a657440"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7be1da8df45027ce18b8af9da68ed98b9a454cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7be1da8df45027ce18b8af9da68ed98b9a454cc", "html_url": "https://github.com/rust-lang/rust/commit/d7be1da8df45027ce18b8af9da68ed98b9a454cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7be1da8df45027ce18b8af9da68ed98b9a454cc/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "559c5f37f6d0435eb3a0bbb1cf10051783df4dfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/559c5f37f6d0435eb3a0bbb1cf10051783df4dfc", "html_url": "https://github.com/rust-lang/rust/commit/559c5f37f6d0435eb3a0bbb1cf10051783df4dfc"}], "stats": {"total": 72, "additions": 23, "deletions": 49}, "files": [{"sha": "4ae611a6bc0dc5ac286cca510cdd533021503f91", "filename": "Cargo.lock", "status": "modified", "additions": 6, "deletions": 16, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -917,21 +917,6 @@ dependencies = [\n  \"test_utils\",\n ]\n \n-[[package]]\n-name = \"ra_batch\"\n-version = \"0.1.0\"\n-dependencies = [\n- \"crossbeam-channel\",\n- \"log\",\n- \"ra_db\",\n- \"ra_hir\",\n- \"ra_ide\",\n- \"ra_project_model\",\n- \"ra_vfs\",\n- \"ra_vfs_glob\",\n- \"rustc-hash\",\n-]\n-\n [[package]]\n name = \"ra_cargo_watch\"\n version = \"0.1.0\"\n@@ -960,18 +945,23 @@ dependencies = [\n name = \"ra_cli\"\n version = \"0.1.0\"\n dependencies = [\n+ \"crossbeam-channel\",\n  \"env_logger\",\n  \"itertools\",\n+ \"log\",\n  \"pico-args\",\n- \"ra_batch\",\n  \"ra_db\",\n  \"ra_hir\",\n  \"ra_hir_def\",\n  \"ra_hir_ty\",\n  \"ra_ide\",\n  \"ra_prof\",\n+ \"ra_project_model\",\n  \"ra_syntax\",\n+ \"ra_vfs\",\n+ \"ra_vfs_glob\",\n  \"rand\",\n+ \"rustc-hash\",\n ]\n \n [[package]]"}, {"sha": "3bf351fe3771ce17670cfb91fced6984b110d967", "filename": "crates/ra_batch/Cargo.toml", "status": "removed", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/559c5f37f6d0435eb3a0bbb1cf10051783df4dfc/crates%2Fra_batch%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/559c5f37f6d0435eb3a0bbb1cf10051783df4dfc/crates%2Fra_batch%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_batch%2FCargo.toml?ref=559c5f37f6d0435eb3a0bbb1cf10051783df4dfc", "patch": "@@ -1,20 +0,0 @@\n-[package]\n-edition = \"2018\"\n-name = \"ra_batch\"\n-version = \"0.1.0\"\n-authors = [\"rust-analyzer developers\"]\n-\n-[lib]\n-doctest = false\n-\n-[dependencies]\n-log = \"0.4.5\"\n-rustc-hash = \"1.0\"\n-crossbeam-channel = \"0.4.0\"\n-\n-ra_vfs = \"0.5.0\"\n-ra_vfs_glob = { path = \"../ra_vfs_glob\" }\n-ra_db = { path = \"../ra_db\" }\n-ra_ide = { path = \"../ra_ide\" }\n-ra_hir = { path = \"../ra_hir\" }\n-ra_project_model = { path = \"../ra_project_model\" }"}, {"sha": "03494a809fde230930a5ef834c8b4d8633fbcce9", "filename": "crates/ra_cli/Cargo.toml", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2FCargo.toml?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -6,18 +6,23 @@ authors = [\"rust-analyzer developers\"]\n publish = false\n \n [dependencies]\n+crossbeam-channel = \"0.4.0\"\n+env_logger = { version = \"0.7.1\", default-features = false }\n itertools = \"0.8.0\"\n+log = \"0.4.5\"\n pico-args = \"0.3.0\"\n-env_logger = { version = \"0.7.1\", default-features = false }\n rand = { version = \"0.7.0\", features = [\"small_rng\"] }\n+rustc-hash = \"1.0\"\n \n-ra_syntax = { path = \"../ra_syntax\" }\n-ra_ide = { path = \"../ra_ide\" }\n-ra_batch = { path = \"../ra_batch\" }\n hir = { path = \"../ra_hir\", package = \"ra_hir\" }\n-hir_ty = { path = \"../ra_hir_ty\", package = \"ra_hir_ty\" }\n hir_def = { path = \"../ra_hir_def\", package = \"ra_hir_def\" }\n+hir_ty = { path = \"../ra_hir_ty\", package = \"ra_hir_ty\" }\n ra_db = { path = \"../ra_db\" }\n+ra_ide = { path = \"../ra_ide\" }\n+ra_project_model = { path = \"../ra_project_model\" }\n+ra_syntax = { path = \"../ra_syntax\" }\n+ra_vfs = \"0.5.0\"\n+ra_vfs_glob = { path = \"../ra_vfs_glob\" }\n \n [dependencies.ra_prof]\n path = \"../ra_prof\""}, {"sha": "3f10ed4002b1b0c6d275a016990528bcd3a58049", "filename": "crates/ra_cli/src/analysis_bench.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fanalysis_bench.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fanalysis_bench.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fanalysis_bench.rs?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -13,7 +13,7 @@ use ra_db::{\n };\n use ra_ide::{Analysis, AnalysisChange, AnalysisHost, FilePosition, LineCol};\n \n-use crate::Result;\n+use crate::{load_cargo::load_cargo, Result};\n \n pub(crate) struct Position {\n     path: PathBuf,\n@@ -46,7 +46,7 @@ pub(crate) fn run(verbose: bool, path: &Path, op: Op) -> Result<()> {\n \n     let start = Instant::now();\n     eprint!(\"loading: \");\n-    let (mut host, roots) = ra_batch::load_cargo(path)?;\n+    let (mut host, roots) = load_cargo(path)?;\n     let db = host.raw_database();\n     eprintln!(\"{:?}\\n\", start.elapsed());\n "}, {"sha": "d40f0439199512da710f4251e3037c25bed81ff1", "filename": "crates/ra_cli/src/analysis_stats.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fanalysis_stats.rs?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -13,7 +13,7 @@ use ra_db::SourceDatabaseExt;\n use ra_syntax::AstNode;\n use rand::{seq::SliceRandom, thread_rng};\n \n-use crate::{progress_report::ProgressReport, Result, Verbosity};\n+use crate::{load_cargo::load_cargo, progress_report::ProgressReport, Result, Verbosity};\n \n pub fn run(\n     verbosity: Verbosity,\n@@ -24,7 +24,7 @@ pub fn run(\n     randomize: bool,\n ) -> Result<()> {\n     let db_load_time = Instant::now();\n-    let (mut host, roots) = ra_batch::load_cargo(path)?;\n+    let (mut host, roots) = load_cargo(path)?;\n     let db = host.raw_database();\n     println!(\"Database loaded, {} roots, {:?}\", roots.len(), db_load_time.elapsed());\n     let analysis_time = Instant::now();"}, {"sha": "2d6433f184a9ed0e5d049d56dcb50e24f2df8caa", "filename": "crates/ra_cli/src/load_cargo.rs", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fload_cargo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fload_cargo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fload_cargo.rs?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -139,7 +139,8 @@ pub fn load(\n #[cfg(test)]\n mod tests {\n     use super::*;\n-    use ra_hir::Crate;\n+\n+    use hir::Crate;\n \n     #[test]\n     fn test_loading_rust_analyzer() {", "previous_filename": "crates/ra_batch/src/lib.rs"}, {"sha": "4a428faff89a44b5dec7515e33392447537f2151", "filename": "crates/ra_cli/src/main.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/crates%2Fra_cli%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_cli%2Fsrc%2Fmain.rs?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -1,5 +1,6 @@\n //! FIXME: write short doc here\n \n+mod load_cargo;\n mod analysis_stats;\n mod analysis_bench;\n mod progress_report;\n@@ -157,12 +158,10 @@ ARGS:\n             let path = {\n                 let mut trailing = matches.free()?;\n                 if trailing.len() != 1 {\n-                    eprintln!(\"{}\", help::ANALYSIS_STATS_HELP);\n                     Err(\"Invalid flags\")?;\n                 }\n                 trailing.pop().unwrap()\n             };\n-            matches.finish().or_else(handle_extra_flags)?;\n \n             analysis_stats::run(\n                 verbosity,"}, {"sha": "a8ed9793f2010d4d8babd5dcfe639c4f029a49e8", "filename": "xtask/tests/tidy-tests/docs.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d7be1da8df45027ce18b8af9da68ed98b9a454cc/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7be1da8df45027ce18b8af9da68ed98b9a454cc/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Ftests%2Ftidy-tests%2Fdocs.rs?ref=d7be1da8df45027ce18b8af9da68ed98b9a454cc", "patch": "@@ -73,7 +73,6 @@ fn no_docs_comments() {\n     }\n \n     let whitelist = [\n-        \"ra_batch\",\n         \"ra_cli\",\n         \"ra_db\",\n         \"ra_hir\","}]}