{"sha": "54d2620ead1dd8ace78f5877e58971b96cd14767", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0ZDI2MjBlYWQxZGQ4YWNlNzhmNTg3N2U1ODk3MWI5NmNkMTQ3Njc=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-07-03T00:58:02Z"}, "committer": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2015-07-03T00:58:02Z"}, "message": "Merge pull request #124 from cassiersg/fix-bin-op\n\nFix bugs in width computation for bin op", "tree": {"sha": "c25d8a31c854417cd81f0cd3c06c5c0540a01dd2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c25d8a31c854417cd81f0cd3c06c5c0540a01dd2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54d2620ead1dd8ace78f5877e58971b96cd14767", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54d2620ead1dd8ace78f5877e58971b96cd14767", "html_url": "https://github.com/rust-lang/rust/commit/54d2620ead1dd8ace78f5877e58971b96cd14767", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54d2620ead1dd8ace78f5877e58971b96cd14767/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "08b9837a1f5fe49380ac7309d70bf0f2e34e33bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/08b9837a1f5fe49380ac7309d70bf0f2e34e33bc", "html_url": "https://github.com/rust-lang/rust/commit/08b9837a1f5fe49380ac7309d70bf0f2e34e33bc"}, {"sha": "163fbf62ee5c5b9ad1a39482ebf2f8c2e464e6b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/163fbf62ee5c5b9ad1a39482ebf2f8c2e464e6b5", "html_url": "https://github.com/rust-lang/rust/commit/163fbf62ee5c5b9ad1a39482ebf2f8c2e464e6b5"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "6fff8be9fc7e7a56a77bfd6591701b97f61934c3", "filename": "src/expr.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/54d2620ead1dd8ace78f5877e58971b96cd14767/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54d2620ead1dd8ace78f5877e58971b96cd14767/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=54d2620ead1dd8ace78f5877e58971b96cd14767", "patch": "@@ -287,13 +287,14 @@ fn rewrite_binary_op(context: &RewriteContext,\n     let operator_str = context.codemap.span_to_snippet(op.span).unwrap();\n \n     // 1 = space between lhs expr and operator\n-    let mut result = try_opt!(lhs.rewrite(context, width - 1 - operator_str.len(), offset));\n+    let mut result =\n+        try_opt!(lhs.rewrite(context, context.config.max_width - offset - 1 - operator_str.len(), offset));\n \n     result.push(' ');\n     result.push_str(&operator_str);\n \n     let remaining_width = match result.rfind('\\n') {\n-        Some(idx) => (context.config.max_width + idx).checked_sub(result.len()).unwrap_or(0),\n+        Some(idx) => (offset + width + idx).checked_sub(result.len()).unwrap_or(0),\n         None => width.checked_sub(result.len()).unwrap_or(0)\n     };\n \n@@ -302,7 +303,9 @@ fn rewrite_binary_op(context: &RewriteContext,\n     // operations with high precendence close together.\n     let rhs_result = try_opt!(rhs.rewrite(context, width, offset));\n \n-    if rhs_result.len() > remaining_width {\n+    // Second condition is needed in case of line break not caused by a\n+    // shortage of space, but by end-of-line comments, for example.\n+    if rhs_result.len() > remaining_width || rhs_result.contains('\\n') {\n         result.push('\\n');\n         result.push_str(&make_indent(offset));\n     } else {"}, {"sha": "373e42d67c5e00cc3101ede1312f9da78f4878e7", "filename": "tests/source/expr.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/54d2620ead1dd8ace78f5877e58971b96cd14767/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54d2620ead1dd8ace78f5877e58971b96cd14767/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=54d2620ead1dd8ace78f5877e58971b96cd14767", "patch": "@@ -10,5 +10,7 @@ fn foo() -> bool {\n \n some_ridiculously_loooooooooooooooooooooong_function(10000 * 30000000000 + 40000 / 1002200000000\n                                                      - 50000 * sqrt(-1),\n-                                                     trivial_value)\n+                                                     trivial_value);\n+    (((((((((aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa + a +\n+             aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa + aaaaa)))))))))\n }"}, {"sha": "25c84511c415030da3b28992d8ee6563b4bd96ec", "filename": "tests/target/expr.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/54d2620ead1dd8ace78f5877e58971b96cd14767/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54d2620ead1dd8ace78f5877e58971b96cd14767/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=54d2620ead1dd8ace78f5877e58971b96cd14767", "patch": "@@ -10,5 +10,8 @@ fn foo() -> bool {\n \n     some_ridiculously_loooooooooooooooooooooong_function(10000 * 30000000000 +\n                                                          40000 / 1002200000000 - 50000 * sqrt(-1),\n-                                                         trivial_value)\n+                                                         trivial_value);\n+    (((((((((aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa +\n+             a + aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa +\n+             aaaaa)))))))))\n }"}]}