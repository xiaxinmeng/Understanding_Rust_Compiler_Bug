{"sha": "74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0ZmNmN2RlNGE0YTFkNjUwNjIxODM1YThjOWRkNzM0MmZiYmUxN2Q=", "commit": {"author": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-07-31T10:20:32Z"}, "committer": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-07-31T10:20:32Z"}, "message": "single_char_pattern: lint only on the argument span", "tree": {"sha": "46fd7ed6dc0e98f6c3a665b3e0ed9a2932bb5969", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46fd7ed6dc0e98f6c3a665b3e0ed9a2932bb5969"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE8rLaPclMjvVJWRZHnxhOEWSDEYEFAltgN/AACgkQnxhOEWSD\nEYFfWg/+KBzTfM+bXM5hiQrYD6l0fMbuLAdmCvz0QvOUBm0eLDcpvU4pK+lSe+Qz\ncJg2IVLtq2/HtfyuWK/yPf/a0iYJ0w8UBZhxWVlfzP5fmGCAv+P/kJ28Nj/TjcLr\nStt0IJAwTg4PaTq5pT4SBomso/c49IQ95oceKr03kXlPv9ZuUI+Keflh1vK8g7pM\n/Xi6xNYjgayk9241eVuEP51EVHTSLa6b36e/KY6fm8ktJORwvvScXrnM59wrtnDW\neiZJhdo8yVhm4Xrzwva5JDbDqruSlBXyqOdvw/IORj/OAJOlTronB1G/IAaLomjP\npcx4qZEAM6f/PebGndbp/9yHDG4YP+Rwu8RwWT92gLVSoXKNj2Y6tXuaaYsdd9o3\nlIZc0T8q2+VPYdJoWxS+nZe9DR9TUeXQnd/m81/6IEkRbVLObSia+pZ/tT/4ahUZ\nmK5N7uWshaMRAuTuxwLjzBDEZdb3/MTS62f4yrqRwzYOZ7vLbG6GrmsS0fnQtpiD\nD28mtul1DA4tuiFqYEYc4+LZL+UFXprrK9VCJ8PCvsCu9geexwOcOPXMKFjMPgjf\nHhnE3Qn6T1iePbpwZv1YspzXilhAJOK+flNl91shWnfaS54CTeAAzELu7bnfl4B2\nruGAW9hs3wbuBlS3+bDlIdyApOy0SyraeZJeblNjVgOl0ZzMC/8=\n=wfxW\n-----END PGP SIGNATURE-----", "payload": "tree 46fd7ed6dc0e98f6c3a665b3e0ed9a2932bb5969\nparent bc98346baac852613bbae92cc0592f3b5823eaaf\nauthor flip1995 <9744647+flip1995@users.noreply.github.com> 1533032432 +0200\ncommitter flip1995 <9744647+flip1995@users.noreply.github.com> 1533032432 +0200\n\nsingle_char_pattern: lint only on the argument span\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "html_url": "https://github.com/rust-lang/rust/commit/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc98346baac852613bbae92cc0592f3b5823eaaf", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc98346baac852613bbae92cc0592f3b5823eaaf", "html_url": "https://github.com/rust-lang/rust/commit/bc98346baac852613bbae92cc0592f3b5823eaaf"}], "stats": {"total": 55, "additions": 31, "deletions": 24}, "files": [{"sha": "6850ef2f81d697e4751599be1f02982283e2d8c2", "filename": "clippy_lints/src/methods.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/clippy_lints%2Fsrc%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/clippy_lints%2Fsrc%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods.rs?ref=74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "patch": "@@ -1889,18 +1889,17 @@ fn lint_single_char_pattern<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &'tcx hi\n     if let Some((Constant::Str(r), _)) = constant(cx, cx.tables, arg) {\n         if r.len() == 1 {\n             let c = r.chars().next().unwrap();\n-            let snip = snippet(cx, expr.span, \"..\");\n+            let snip = snippet(cx, arg.span, \"..\");\n             let hint = snip.replace(\n                 &format!(\"\\\"{}\\\"\", c.escape_default()),\n                 &format!(\"'{}'\", c.escape_default()));\n-            span_lint_and_then(\n+            span_lint_and_sugg(\n                 cx,\n                 SINGLE_CHAR_PATTERN,\n                 arg.span,\n                 \"single-character string constant used as pattern\",\n-                |db| {\n-                    db.span_suggestion(expr.span, \"try using a char instead\", hint);\n-                },\n+                \"try using a char instead\",\n+                hint,\n             );\n         }\n     }"}, {"sha": "73d00857415844d1301a3790d10b712fe17dc3e0", "filename": "tests/ui/single_char_pattern.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/tests%2Fui%2Fsingle_char_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/tests%2Fui%2Fsingle_char_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.rs?ref=74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "patch": "@@ -40,4 +40,6 @@ fn main() {\n \n     let h = HashSet::<String>::new();\n     h.contains(\"X\"); // should not warn\n+\n+    x.replace(\";\", \",\").split(\",\"); // issue #2978\n }"}, {"sha": "1e7e9cf78cf13a4d3a32339751ff7465bcf7942c", "filename": "tests/ui/single_char_pattern.stderr", "status": "modified", "additions": 25, "deletions": 19, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/tests%2Fui%2Fsingle_char_pattern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/74fcf7de4a4a1d650621835a8c9dd7342fbbe17d/tests%2Fui%2Fsingle_char_pattern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.stderr?ref=74fcf7de4a4a1d650621835a8c9dd7342fbbe17d", "patch": "@@ -2,111 +2,117 @@ error: single-character string constant used as pattern\n  --> $DIR/single_char_pattern.rs:5:13\n   |\n 5 |     x.split(\"x\");\n-  |     --------^^^- help: try using a char instead: `x.split('x')`\n+  |             ^^^ help: try using a char instead: `'x'`\n   |\n   = note: `-D single-char-pattern` implied by `-D warnings`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:22:16\n    |\n 22 |     x.contains(\"x\");\n-   |     -----------^^^- help: try using a char instead: `x.contains('x')`\n+   |                ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:23:19\n    |\n 23 |     x.starts_with(\"x\");\n-   |     --------------^^^- help: try using a char instead: `x.starts_with('x')`\n+   |                   ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:24:17\n    |\n 24 |     x.ends_with(\"x\");\n-   |     ------------^^^- help: try using a char instead: `x.ends_with('x')`\n+   |                 ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:25:12\n    |\n 25 |     x.find(\"x\");\n-   |     -------^^^- help: try using a char instead: `x.find('x')`\n+   |            ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:26:13\n    |\n 26 |     x.rfind(\"x\");\n-   |     --------^^^- help: try using a char instead: `x.rfind('x')`\n+   |             ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:27:14\n    |\n 27 |     x.rsplit(\"x\");\n-   |     ---------^^^- help: try using a char instead: `x.rsplit('x')`\n+   |              ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:28:24\n    |\n 28 |     x.split_terminator(\"x\");\n-   |     -------------------^^^- help: try using a char instead: `x.split_terminator('x')`\n+   |                        ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:29:25\n    |\n 29 |     x.rsplit_terminator(\"x\");\n-   |     --------------------^^^- help: try using a char instead: `x.rsplit_terminator('x')`\n+   |                         ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:30:17\n    |\n 30 |     x.splitn(0, \"x\");\n-   |     ------------^^^- help: try using a char instead: `x.splitn(0, 'x')`\n+   |                 ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:31:18\n    |\n 31 |     x.rsplitn(0, \"x\");\n-   |     -------------^^^- help: try using a char instead: `x.rsplitn(0, 'x')`\n+   |                  ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:32:15\n    |\n 32 |     x.matches(\"x\");\n-   |     ----------^^^- help: try using a char instead: `x.matches('x')`\n+   |               ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:33:16\n    |\n 33 |     x.rmatches(\"x\");\n-   |     -----------^^^- help: try using a char instead: `x.rmatches('x')`\n+   |                ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:34:21\n    |\n 34 |     x.match_indices(\"x\");\n-   |     ----------------^^^- help: try using a char instead: `x.match_indices('x')`\n+   |                     ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:35:22\n    |\n 35 |     x.rmatch_indices(\"x\");\n-   |     -----------------^^^- help: try using a char instead: `x.rmatch_indices('x')`\n+   |                      ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:36:25\n    |\n 36 |     x.trim_left_matches(\"x\");\n-   |     --------------------^^^- help: try using a char instead: `x.trim_left_matches('x')`\n+   |                         ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:37:26\n    |\n 37 |     x.trim_right_matches(\"x\");\n-   |     ---------------------^^^- help: try using a char instead: `x.trim_right_matches('x')`\n+   |                          ^^^ help: try using a char instead: `'x'`\n \n error: single-character string constant used as pattern\n   --> $DIR/single_char_pattern.rs:39:13\n    |\n 39 |     x.split(\"/n\");\n-   |     --------^^^^- help: try using a char instead: `x.split('/n')`\n+   |             ^^^^ help: try using a char instead: `'/n'`\n \n-error: aborting due to 18 previous errors\n+error: single-character string constant used as pattern\n+  --> $DIR/single_char_pattern.rs:44:31\n+   |\n+44 |     x.replace(\";\", \",\").split(\",\"); // issue #2978\n+   |                               ^^^ help: try using a char instead: `','`\n+\n+error: aborting due to 19 previous errors\n "}]}