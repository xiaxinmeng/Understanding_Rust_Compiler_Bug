{"sha": "cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmMzQ3MGE1ZmM4ZmMwODAxOGY0ZmU0MmIyYzAzYTFiOTZhOTAwMjk=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-04-18T09:16:07Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-04-18T09:38:25Z"}, "message": "miri-unleashed: test that we detect heap allocations", "tree": {"sha": "b564e5df3679d87cefbe4d4d2f328b4e9a6fef63", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b564e5df3679d87cefbe4d4d2f328b4e9a6fef63"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "html_url": "https://github.com/rust-lang/rust/commit/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76cb95ef4dba0e21c9befef1450a22c9c03e34bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/76cb95ef4dba0e21c9befef1450a22c9c03e34bf", "html_url": "https://github.com/rust-lang/rust/commit/76cb95ef4dba0e21c9befef1450a22c9c03e34bf"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "b5e62aa20130b1eb0bdebfdaa3ad111cdcf5da70", "filename": "src/librustc_mir/transform/check_consts/ops.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs?ref=cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "patch": "@@ -113,8 +113,6 @@ impl NonConstOp for FnCallUnstable {\n #[derive(Debug)]\n pub struct HeapAllocation;\n impl NonConstOp for HeapAllocation {\n-    const IS_SUPPORTED_IN_MIRI: bool = false;\n-\n     fn emit_error(&self, item: &Item<'_, '_>, span: Span) {\n         let mut err = struct_span_err!(\n             item.tcx.sess,"}, {"sha": "049727684d0eb96f7fbaf0d3882e9a7e82370da5", "filename": "src/test/ui/consts/miri_unleashed/box.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.rs?ref=cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "patch": "@@ -0,0 +1,14 @@\n+// compile-flags: -Zunleash-the-miri-inside-of-you\n+#![feature(const_mut_refs, box_syntax)]\n+#![deny(const_err)]\n+\n+use std::mem::ManuallyDrop;\n+\n+fn main() {}\n+\n+static TEST_BAD: &mut i32 = {\n+    &mut *(box 0)\n+    //~^ WARN skipping const check\n+    //~| ERROR could not evaluate static initializer\n+    //~| NOTE heap allocations\n+};"}, {"sha": "d1b404ea737cafdb2826cf27d0650f150f1a4b9d", "filename": "src/test/ui/consts/miri_unleashed/box.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf3470a5fc8fc08018f4fe42b2c03a1b96a90029/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fmiri_unleashed%2Fbox.stderr?ref=cf3470a5fc8fc08018f4fe42b2c03a1b96a90029", "patch": "@@ -0,0 +1,15 @@\n+warning: skipping const checks\n+  --> $DIR/box.rs:10:11\n+   |\n+LL |     &mut *(box 0)\n+   |           ^^^^^^^\n+\n+error[E0080]: could not evaluate static initializer\n+  --> $DIR/box.rs:10:11\n+   |\n+LL |     &mut *(box 0)\n+   |           ^^^^^^^ \"heap allocations via `box` keyword\" needs an rfc before being allowed inside constants\n+\n+error: aborting due to previous error; 1 warning emitted\n+\n+For more information about this error, try `rustc --explain E0080`."}]}