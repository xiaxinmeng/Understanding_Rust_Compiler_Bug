{"sha": "e5796c46de20856f2eee0d8651572343d4fea9db", "node_id": "C_kwDOAAsO6NoAKGU1Nzk2YzQ2ZGUyMDg1NmYyZWVlMGQ4NjUxNTcyMzQzZDRmZWE5ZGI", "commit": {"author": {"name": "Andy Wang", "email": "cbeuw.andy@gmail.com", "date": "2021-12-05T20:49:23Z"}, "committer": {"name": "Andy Wang", "email": "cbeuw.andy@gmail.com", "date": "2021-12-05T20:49:23Z"}, "message": "Apply path remapping to DW_AT_GNU_dwo_name", "tree": {"sha": "4ebf751e5541b0d3c225b5b17140bf5bc6a23078", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ebf751e5541b0d3c225b5b17140bf5bc6a23078"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e5796c46de20856f2eee0d8651572343d4fea9db", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEE7dcbcBMl24/h63ldGBtJ+fOPM3QFAmGtJdQACgkQGBtJ+fOP\nM3QGBgwAniAwprlmEtt46PO3ZVv4h1Z9xjMCk1P1CIkEaWVtb/LpdaxFm18ZvFP9\nFqlkZ9zru7o0cEigKoTTR7RGjIPEJDKMudkcTgqHLEhDeYffUr3LMy5LXdHG6vL1\nXRp1GisBZmAqVf9arFm5hFVR0JUdK1st1gr16PbQ0+kk2mBRD6Rje62ewIJATyID\n0ozDhyH7koCS+vf+MZoASX2SGOb7jcU3ZOUp/d6S4+Mjtsk3EEVqduw5CldKYTTL\nhsmjsOew7k1czo5J/zXGWq9yBpXxrN0xaw5tKZwGaMnoeyFXxwTqx6HNoM3ERiia\ntWLk9MAVLs5AWm4a3jw2NwQ+fUVqCs9ekhPQIjpWW/6JGr0q7PzMyseomZZ+69yo\npns6N0jCpF7j7N0b6wxUVdkYz73gTM5oYCHofnwOGvQ1ukywk5VEw3c21mbAfNG0\n5W9UNdruSMlBlZLVhuRZqSfRdNWjtmF23K3EZc/Lg4IOtWk1IxQldZdkTciveO24\nlQLH39G5\n=F9mm\n-----END PGP SIGNATURE-----", "payload": "tree 4ebf751e5541b0d3c225b5b17140bf5bc6a23078\nparent efec545293b9263be9edfb283a7aa66350b3acbf\nauthor Andy Wang <cbeuw.andy@gmail.com> 1638737363 +0000\ncommitter Andy Wang <cbeuw.andy@gmail.com> 1638737363 +0000\n\nApply path remapping to DW_AT_GNU_dwo_name\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e5796c46de20856f2eee0d8651572343d4fea9db", "html_url": "https://github.com/rust-lang/rust/commit/e5796c46de20856f2eee0d8651572343d4fea9db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e5796c46de20856f2eee0d8651572343d4fea9db/comments", "author": {"login": "cbeuw", "id": 7034308, "node_id": "MDQ6VXNlcjcwMzQzMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7034308?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbeuw", "html_url": "https://github.com/cbeuw", "followers_url": "https://api.github.com/users/cbeuw/followers", "following_url": "https://api.github.com/users/cbeuw/following{/other_user}", "gists_url": "https://api.github.com/users/cbeuw/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbeuw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbeuw/subscriptions", "organizations_url": "https://api.github.com/users/cbeuw/orgs", "repos_url": "https://api.github.com/users/cbeuw/repos", "events_url": "https://api.github.com/users/cbeuw/events{/privacy}", "received_events_url": "https://api.github.com/users/cbeuw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cbeuw", "id": 7034308, "node_id": "MDQ6VXNlcjcwMzQzMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/7034308?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbeuw", "html_url": "https://github.com/cbeuw", "followers_url": "https://api.github.com/users/cbeuw/followers", "following_url": "https://api.github.com/users/cbeuw/following{/other_user}", "gists_url": "https://api.github.com/users/cbeuw/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbeuw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbeuw/subscriptions", "organizations_url": "https://api.github.com/users/cbeuw/orgs", "repos_url": "https://api.github.com/users/cbeuw/repos", "events_url": "https://api.github.com/users/cbeuw/events{/privacy}", "received_events_url": "https://api.github.com/users/cbeuw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efec545293b9263be9edfb283a7aa66350b3acbf", "url": "https://api.github.com/repos/rust-lang/rust/commits/efec545293b9263be9edfb283a7aa66350b3acbf", "html_url": "https://github.com/rust-lang/rust/commit/efec545293b9263be9edfb283a7aa66350b3acbf"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "f15f81a83b051b04b9d168e2857aad55b229f501", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e5796c46de20856f2eee0d8651572343d4fea9db/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e5796c46de20856f2eee0d8651572343d4fea9db/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=e5796c46de20856f2eee0d8651572343d4fea9db", "patch": "@@ -1057,9 +1057,12 @@ pub fn compile_unit_metadata(\n     let output_filenames = tcx.output_filenames(());\n     let out_dir = &output_filenames.out_directory;\n     let split_name = if tcx.sess.target_can_use_split_dwarf() {\n-        output_filenames\n-            .split_dwarf_path(tcx.sess.split_debuginfo(), Some(codegen_unit_name))\n-            .map(|f| out_dir.join(f))\n+        output_filenames.split_dwarf_path(tcx.sess.split_debuginfo(), Some(codegen_unit_name)).map(\n+            |f| {\n+                let joined = out_dir.join(f);\n+                tcx.sess.source_map().path_mapping().map_prefix(joined).0\n+            },\n+        )\n     } else {\n         None\n     }"}, {"sha": "5fef8eac3524ea76c39f926f1a2e503bb1d94dfe", "filename": "src/test/run-make-fulldeps/split-dwarf/Makefile", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/e5796c46de20856f2eee0d8651572343d4fea9db/src%2Ftest%2Frun-make-fulldeps%2Fsplit-dwarf%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/e5796c46de20856f2eee0d8651572343d4fea9db/src%2Ftest%2Frun-make-fulldeps%2Fsplit-dwarf%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fsplit-dwarf%2FMakefile?ref=e5796c46de20856f2eee0d8651572343d4fea9db", "patch": "@@ -2,7 +2,16 @@\n \n # only-linux\n \n-all:\n+all: packed remapped\n+\n+remapped:\n+\t$(RUSTC) -Z unstable-options -C split-debuginfo=packed -C debuginfo=2 --remap-path-prefix $$PWD= foo.rs -g\n+\tobjdump -Wi $(TMPDIR)/foo | grep $$PWD && exit 1 || exit 0\n+\n+\t$(RUSTC) -Z unstable-options -C split-debuginfo=unpacked -C debuginfo=2 --remap-path-prefix $$PWD= foo.rs -g\n+\tobjdump -Wi $(TMPDIR)/foo | grep $$PWD && exit 1 || exit 0\n+\n+packed:\n \t$(RUSTC) -Z unstable-options -C split-debuginfo=packed -C debuginfo=2 foo.rs -g\n \trm $(TMPDIR)/foo.dwp\n \trm $(TMPDIR)/$(call BIN,foo)"}]}