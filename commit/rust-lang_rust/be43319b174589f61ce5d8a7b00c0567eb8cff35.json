{"sha": "be43319b174589f61ce5d8a7b00c0567eb8cff35", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlNDMzMTliMTc0NTg5ZjYxY2U1ZDhhN2IwMGMwNTY3ZWI4Y2ZmMzU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-07-19T13:18:32Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-07-19T14:42:06Z"}, "message": "Do not clobber RUSTDOCFLAGS\n\nWe were setting these in both Builder::cargo and here, which ended up only\nsetting the first of the two.", "tree": {"sha": "771ec7aa3ee7a48206920bc54d948f60039dcc7a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/771ec7aa3ee7a48206920bc54d948f60039dcc7a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be43319b174589f61ce5d8a7b00c0567eb8cff35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be43319b174589f61ce5d8a7b00c0567eb8cff35", "html_url": "https://github.com/rust-lang/rust/commit/be43319b174589f61ce5d8a7b00c0567eb8cff35", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be43319b174589f61ce5d8a7b00c0567eb8cff35/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47ea6d90b073ab977cf072e2f5f46d63de532cc6", "url": "https://api.github.com/repos/rust-lang/rust/commits/47ea6d90b073ab977cf072e2f5f46d63de532cc6", "html_url": "https://github.com/rust-lang/rust/commit/47ea6d90b073ab977cf072e2f5f46d63de532cc6"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "737176c48f878ef5cb59a81a173cfb8ca6c5102e", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/be43319b174589f61ce5d8a7b00c0567eb8cff35/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be43319b174589f61ce5d8a7b00c0567eb8cff35/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=be43319b174589f61ce5d8a7b00c0567eb8cff35", "patch": "@@ -1444,6 +1444,10 @@ pub struct Cargo {\n }\n \n impl Cargo {\n+    pub fn rustdocflag(&mut self, arg: &str) -> &mut Cargo {\n+        self.rustdocflags.arg(arg);\n+        self\n+    }\n     pub fn rustflag(&mut self, arg: &str) -> &mut Cargo {\n         self.rustflags.arg(arg);\n         self\n@@ -1466,6 +1470,9 @@ impl Cargo {\n     }\n \n     pub fn env(&mut self, key: impl AsRef<OsStr>, value: impl AsRef<OsStr>) -> &mut Cargo {\n+        // These are managed through rustflag/rustdocflag interfaces.\n+        assert_ne!(key.as_ref(), \"RUSTFLAGS\");\n+        assert_ne!(key.as_ref(), \"RUSTDOCFLAGS\");\n         self.command.env(key.as_ref(), value.as_ref());\n         self\n     }"}, {"sha": "f8a549afc88fb81da408d64ca8c9f7519fee8bf8", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/be43319b174589f61ce5d8a7b00c0567eb8cff35/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be43319b174589f61ce5d8a7b00c0567eb8cff35/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=be43319b174589f61ce5d8a7b00c0567eb8cff35", "patch": "@@ -527,11 +527,9 @@ impl Step for Rustc {\n \n         // Build cargo command.\n         let mut cargo = builder.cargo(compiler, Mode::Rustc, SourceType::InTree, target, \"doc\");\n-        cargo.env(\n-            \"RUSTDOCFLAGS\",\n-            \"--document-private-items \\\n-            --enable-index-page -Zunstable-options\",\n-        );\n+        cargo.rustdocflag(\"--document-private-items\");\n+        cargo.rustdocflag(\"--enable-index-page\");\n+        cargo.rustdocflag(\"-Zunstable-options\");\n         compile::rustc_cargo(builder, &mut cargo, target);\n \n         // Only include compiler crates, no dependencies of those, such as `libc`.\n@@ -624,7 +622,7 @@ impl Step for Rustdoc {\n         cargo.arg(\"--no-deps\");\n         cargo.arg(\"-p\").arg(\"rustdoc\");\n \n-        cargo.env(\"RUSTDOCFLAGS\", \"--document-private-items\");\n+        cargo.rustdocflag(\"--document-private-items\");\n         builder.run(&mut cargo.into());\n     }\n }"}]}