{"sha": "991b62a4f935ce49dafbf0ce252f7fdb467daae8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5MWI2MmE0ZjkzNWNlNDlkYWZiZjBjZTI1MmY3ZmRiNDY3ZGFhZTg=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-01-11T03:51:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-11T03:51:04Z"}, "message": "Merge #2790\n\n2790: Add test for macro expansion in various expressions r=edwin0cheng a=flodiebold\n\ncc @edwin0cheng \n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "4a3f664b0b4337500cf904661597a9169511de85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a3f664b0b4337500cf904661597a9169511de85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/991b62a4f935ce49dafbf0ce252f7fdb467daae8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeGUYoCRBK7hj4Ov3rIwAAdHIIADTYpbB8zNK+odHRNckn0v5I\nhf6QxYL5cGfCDHn+M/OpkpypEQOogjx6q0kV8R/2L2VYvy1VGR7ES3K3HZDsErGU\nKs9+n58kQFVgWvvgcA7bd7V4vMrTidkU09xmVhVmNML6pxPNlv0qfU0qgLhkZiLF\n9diS22Nb6XuwqsH7Ls7QBdg3EayralntITsEal1wl3pQwGVH2svKGGZ97tLRa5Z1\ncCDqr4C2V1/baGTj6obInEbTyk3W+fuURJnip8PG1/hwF0pWWSXA/21hMyMenBjK\niDcDwBgSpNaoMYWXaPqikm881HOetD4Ug4akfzaaJrSMplNFNHVhrfjgVK6IrvQ=\n=UyDM\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a3f664b0b4337500cf904661597a9169511de85\nparent a9ba32e2e659dbbe78f7921f5b0abe7288c83aa9\nparent dd6ec81d658f7cd06b7ed37174b170f0e8930eed\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1578714664 +0000\ncommitter GitHub <noreply@github.com> 1578714664 +0000\n\nMerge #2790\n\n2790: Add test for macro expansion in various expressions r=edwin0cheng a=flodiebold\n\ncc @edwin0cheng \n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/991b62a4f935ce49dafbf0ce252f7fdb467daae8", "html_url": "https://github.com/rust-lang/rust/commit/991b62a4f935ce49dafbf0ce252f7fdb467daae8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/991b62a4f935ce49dafbf0ce252f7fdb467daae8/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9ba32e2e659dbbe78f7921f5b0abe7288c83aa9", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9ba32e2e659dbbe78f7921f5b0abe7288c83aa9", "html_url": "https://github.com/rust-lang/rust/commit/a9ba32e2e659dbbe78f7921f5b0abe7288c83aa9"}, {"sha": "dd6ec81d658f7cd06b7ed37174b170f0e8930eed", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd6ec81d658f7cd06b7ed37174b170f0e8930eed", "html_url": "https://github.com/rust-lang/rust/commit/dd6ec81d658f7cd06b7ed37174b170f0e8930eed"}], "stats": {"total": 82, "additions": 81, "deletions": 1}, "files": [{"sha": "af5b22d1c63449912cb468b6de15fc0dd928c94f", "filename": "crates/ra_hir_expand/src/db.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/991b62a4f935ce49dafbf0ce252f7fdb467daae8/crates%2Fra_hir_expand%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/991b62a4f935ce49dafbf0ce252f7fdb467daae8/crates%2Fra_hir_expand%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_expand%2Fsrc%2Fdb.rs?ref=991b62a4f935ce49dafbf0ce252f7fdb467daae8", "patch": "@@ -190,7 +190,6 @@ fn to_fragment_kind(db: &dyn AstDatabase, macro_call_id: MacroCallId) -> Fragmen\n         TUPLE_EXPR => FragmentKind::Expr,\n         PAREN_EXPR => FragmentKind::Expr,\n \n-        // FIXME: Add tests for following cases in hir_ty\n         FOR_EXPR => FragmentKind::Expr,\n         PATH_EXPR => FragmentKind::Expr,\n         LAMBDA_EXPR => FragmentKind::Expr,"}, {"sha": "9d09d93a7c64a150bbbf74b96382396314717261", "filename": "crates/ra_hir_ty/src/tests/macros.rs", "status": "modified", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/rust-lang/rust/blob/991b62a4f935ce49dafbf0ce252f7fdb467daae8/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/991b62a4f935ce49dafbf0ce252f7fdb467daae8/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fmacros.rs?ref=991b62a4f935ce49dafbf0ce252f7fdb467daae8", "patch": "@@ -135,6 +135,87 @@ fn main() {\n     );\n }\n \n+#[test]\n+fn expr_macro_expanded_in_various_places() {\n+    assert_snapshot!(\n+        infer(r#\"\n+macro_rules! spam {\n+    () => (1isize);\n+}\n+\n+fn spam() {\n+    spam!();\n+    (spam!());\n+    spam!().spam(spam!());\n+    for _ in spam!() {}\n+    || spam!();\n+    while spam!() {}\n+    break spam!();\n+    return spam!();\n+    match spam!() {\n+        _ if spam!() => spam!(),\n+    }\n+    spam!()(spam!());\n+    Spam { spam: spam!() };\n+    spam!()[spam!()];\n+    await spam!();\n+    spam!() as usize;\n+    &spam!();\n+    -spam!();\n+    spam!()..spam!();\n+    spam!() + spam!();\n+}\n+\"#),\n+        @r###\"\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    ![0; 6) '1isize': isize\n+    [54; 457) '{     ...!(); }': !\n+    [88; 109) 'spam!(...am!())': {unknown}\n+    [115; 134) 'for _ ...!() {}': ()\n+    [119; 120) '_': {unknown}\n+    [132; 134) '{}': ()\n+    [139; 149) '|| spam!()': || -> isize\n+    [155; 171) 'while ...!() {}': ()\n+    [169; 171) '{}': ()\n+    [176; 189) 'break spam!()': !\n+    [195; 209) 'return spam!()': !\n+    [215; 269) 'match ...     }': isize\n+    [239; 240) '_': isize\n+    [274; 290) 'spam!(...am!())': {unknown}\n+    [296; 318) 'Spam {...m!() }': {unknown}\n+    [324; 340) 'spam!(...am!()]': {unknown}\n+    [365; 381) 'spam!(... usize': usize\n+    [387; 395) '&spam!()': &isize\n+    [401; 409) '-spam!()': isize\n+    [415; 431) 'spam!(...pam!()': {unknown}\n+    [437; 454) 'spam!(...pam!()': isize\n+    \"###\n+    );\n+}\n+\n #[test]\n fn infer_type_value_macro_having_same_name() {\n     assert_snapshot!("}]}