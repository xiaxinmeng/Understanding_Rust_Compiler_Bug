{"sha": "697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5N2Q2YjNmM2ZhMWYxNjNhY2I1YWUwOTExZDdkZjdmMDJhNTQ0NDQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-03-27T09:54:02Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-03-27T09:54:02Z"}, "message": "Auto merge of #70282 - ssomers:btreemap_gdb_pretty_print, r=Mark-Simulacrum\n\nTest and fix gdb pretty printing more\n\nOver time I had oversimplified the test case for #68098: it does not have an internal node to print so it did not test what it pretended to test. And then I also realized not spotting the same mistake reviewing #70111, and more likely to occur in the wild. Now, both test cases fail if you put back the flawed python code.\n\nr? @Mark-Simulacrum", "tree": {"sha": "12a72c78854f246c11a5166228d1978e0debdc24", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12a72c78854f246c11a5166228d1978e0debdc24"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "html_url": "https://github.com/rust-lang/rust/commit/697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/697d6b3f3fa1f163acb5ae0911d7df7f02a54444/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9ac29169ac541a64471b83d8019cd0b442f8065", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9ac29169ac541a64471b83d8019cd0b442f8065", "html_url": "https://github.com/rust-lang/rust/commit/b9ac29169ac541a64471b83d8019cd0b442f8065"}, {"sha": "3d435d802376f1136ba191a1ead46cec1bd00fe0", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d435d802376f1136ba191a1ead46cec1bd00fe0", "html_url": "https://github.com/rust-lang/rust/commit/3d435d802376f1136ba191a1ead46cec1bd00fe0"}], "stats": {"total": 23, "additions": 17, "deletions": 6}, "files": [{"sha": "d580329cb504ed9c6d40ddf36e486e94f9df5670", "filename": "src/etc/gdb_rust_pretty_printing.py", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/697d6b3f3fa1f163acb5ae0911d7df7f02a54444/src%2Fetc%2Fgdb_rust_pretty_printing.py", "raw_url": "https://github.com/rust-lang/rust/raw/697d6b3f3fa1f163acb5ae0911d7df7f02a54444/src%2Fetc%2Fgdb_rust_pretty_printing.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_rust_pretty_printing.py?ref=697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "patch": "@@ -374,7 +374,7 @@ def children(self):\n         innermap = GdbValue(self.__val.get_wrapped_value()['map'])\n         if innermap.get_wrapped_value()['length'] > 0:\n             root = GdbValue(innermap.get_wrapped_value()['root'])\n-            type_name = str(root.type.ty.name).replace('core::option::Option<', '')[:-1]\n+            type_name = str(root.type.ty.name).replace('core::option::Option<', '', 1)[:-1]\n             root = root.get_wrapped_value().cast(gdb.lookup_type(type_name))\n             node_ptr = root['node']\n             i = 0\n@@ -398,7 +398,7 @@ def to_string(self):\n     def children(self):\n         if self.__val.get_wrapped_value()['length'] > 0:\n             root = GdbValue(self.__val.get_wrapped_value()['root'])\n-            type_name = str(root.type.ty.name).replace('core::option::Option<', '')[:-1]\n+            type_name = str(root.type.ty.name).replace('core::option::Option<', '', 1)[:-1]\n             root = root.get_wrapped_value().cast(gdb.lookup_type(type_name))\n             node_ptr = root['node']\n             i = 0"}, {"sha": "1f4ff00100a233f835b3c97bdf358462b7013bd0", "filename": "src/test/debuginfo/pretty-std-collections.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/697d6b3f3fa1f163acb5ae0911d7df7f02a54444/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs", "raw_url": "https://github.com/rust-lang/rust/raw/697d6b3f3fa1f163acb5ae0911d7df7f02a54444/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fpretty-std-collections.rs?ref=697d6b3f3fa1f163acb5ae0911d7df7f02a54444", "patch": "@@ -26,14 +26,19 @@\n // gdb-command: print empty_btree_map\n // gdb-check:$4 = BTreeMap<i32, u32>(len: 0)\n \n+// gdb-command: print option_btree_map\n+// gdb-check:$5 = BTreeMap<bool, core::option::Option<bool>>(len: 2) = {[false] = [...], [true] = [...]}\n+// (abbreviated because both values vary wildly over gdb versions and/or linux distributions)\n+\n // gdb-command: print nasty_btree_map\n-// gdb-check:$5 = BTreeMap<i32, pretty_std_collections::MyLeafNode>(len: 1) = {[1] = pretty_std_collections::MyLeafNode (11)}\n+// gdb-check:$6 = BTreeMap<i32, pretty_std_collections::MyLeafNode>(len: 15) = {[0] = pretty_std_collections::MyLeafNode (0), [...]}\n+// (abbreviated because it's boring but we need enough elements to include internal nodes)\n \n // gdb-command: print vec_deque\n-// gdb-check:$6 = VecDeque<i32>(len: 3, cap: 8) = {5, 3, 7}\n+// gdb-check:$7 = VecDeque<i32>(len: 3, cap: 8) = {5, 3, 7}\n \n // gdb-command: print vec_deque2\n-// gdb-check:$7 = VecDeque<i32>(len: 7, cap: 8) = {2, 3, 4, 5, 6, 7, 8}\n+// gdb-check:$8 = VecDeque<i32>(len: 7, cap: 8) = {2, 3, 4, 5, 6, 7, 8}\n \n #![allow(unused_variables)]\n use std::collections::BTreeMap;\n@@ -59,8 +64,14 @@ fn main() {\n \n     let mut empty_btree_map: BTreeMap<i32, u32> = BTreeMap::new();\n \n+    let mut option_btree_map: BTreeMap<bool, Option<bool>> = BTreeMap::new();\n+    option_btree_map.insert(false, None);\n+    option_btree_map.insert(true, Some(true));\n+\n     let mut nasty_btree_map: BTreeMap<i32, MyLeafNode> = BTreeMap::new();\n-    nasty_btree_map.insert(1, MyLeafNode(11));\n+    for i in 0..15 {\n+        nasty_btree_map.insert(i, MyLeafNode(i));\n+    }\n \n     // VecDeque\n     let mut vec_deque = VecDeque::new();"}]}