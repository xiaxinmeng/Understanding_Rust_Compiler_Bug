{"sha": "14ee66acecc353c0b3045d74fbe3addd66f96d79", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE0ZWU2NmFjZWNjMzUzYzBiMzA0NWQ3NGZiZTNhZGRkNjZmOTZkNzk=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-05T22:04:17Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-11-06T09:05:34Z"}, "message": "miri cast: avoid unnecessary to_scalar_ptr", "tree": {"sha": "858bf4413b32f6ce1f54374c3de547f8ae840658", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/858bf4413b32f6ce1f54374c3de547f8ae840658"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/14ee66acecc353c0b3045d74fbe3addd66f96d79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/14ee66acecc353c0b3045d74fbe3addd66f96d79", "html_url": "https://github.com/rust-lang/rust/commit/14ee66acecc353c0b3045d74fbe3addd66f96d79", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/14ee66acecc353c0b3045d74fbe3addd66f96d79/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e4931eaaa3d95189b30e90d3af9f0db17c41bbb0", "url": "https://api.github.com/repos/rust-lang/rust/commits/e4931eaaa3d95189b30e90d3af9f0db17c41bbb0", "html_url": "https://github.com/rust-lang/rust/commit/e4931eaaa3d95189b30e90d3af9f0db17c41bbb0"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "2037305580ad33a23dd9c60a8ca4550cd7f3f9b1", "filename": "src/librustc_mir/interpret/cast.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/14ee66acecc353c0b3045d74fbe3addd66f96d79/src%2Flibrustc_mir%2Finterpret%2Fcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14ee66acecc353c0b3045d74fbe3addd66f96d79/src%2Flibrustc_mir%2Finterpret%2Fcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fcast.rs?ref=14ee66acecc353c0b3045d74fbe3addd66f96d79", "patch": "@@ -260,7 +260,7 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n \n         match (&src_pointee_ty.kind, &dest_pointee_ty.kind) {\n             (&ty::Array(_, length), &ty::Slice(_)) => {\n-                let ptr = self.read_immediate(src)?.to_scalar_ptr()?;\n+                let ptr = self.read_immediate(src)?.to_scalar()?;\n                 // u64 cast is from usize to u64, which is always good\n                 let val = Immediate::new_slice(\n                     ptr,\n@@ -279,7 +279,7 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n             (_, &ty::Dynamic(ref data, _)) => {\n                 // Initial cast from sized to dyn trait\n                 let vtable = self.get_vtable(src_pointee_ty, data.principal())?;\n-                let ptr = self.read_immediate(src)?.to_scalar_ptr()?;\n+                let ptr = self.read_immediate(src)?.to_scalar()?;\n                 let val = Immediate::new_dyn_trait(ptr, vtable);\n                 self.write_immediate(val, dest)\n             }"}, {"sha": "d696a595777a4e1728eee4e513994e96fae9161a", "filename": "src/librustc_mir/interpret/place.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/14ee66acecc353c0b3045d74fbe3addd66f96d79/src%2Flibrustc_mir%2Finterpret%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/14ee66acecc353c0b3045d74fbe3addd66f96d79/src%2Flibrustc_mir%2Finterpret%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fplace.rs?ref=14ee66acecc353c0b3045d74fbe3addd66f96d79", "patch": "@@ -287,7 +287,9 @@ where\n         &self,\n         val: ImmTy<'tcx, M::PointerTag>,\n     ) -> InterpResult<'tcx, MPlaceTy<'tcx, M::PointerTag>> {\n-        let pointee_type = val.layout.ty.builtin_deref(true).unwrap().ty;\n+        let pointee_type = val.layout.ty.builtin_deref(true)\n+            .expect(\"`ref_to_mplace` called on non-ptr type\")\n+            .ty;\n         let layout = self.layout_of(pointee_type)?;\n \n         let mplace = MemPlace {"}]}