{"sha": "145ebb1cd723e34dc5a940ec3e498de814e6293d", "node_id": "C_kwDOAAsO6NoAKDE0NWViYjFjZDcyM2UzNGRjNWE5NDBlYzNlNDk4ZGU4MTRlNjI5M2Q", "commit": {"author": {"name": "Daniel Macovei", "email": "djmacovei@gmail.com", "date": "2022-08-02T15:39:35Z"}, "committer": {"name": "Daniel Macovei", "email": "djmacovei@gmail.com", "date": "2022-08-02T15:39:35Z"}, "message": "add paren before '?' when suggesting deref", "tree": {"sha": "db3cedf02e68268905a1e0e3b02268229801c53d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db3cedf02e68268905a1e0e3b02268229801c53d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/145ebb1cd723e34dc5a940ec3e498de814e6293d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/145ebb1cd723e34dc5a940ec3e498de814e6293d", "html_url": "https://github.com/rust-lang/rust/commit/145ebb1cd723e34dc5a940ec3e498de814e6293d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/145ebb1cd723e34dc5a940ec3e498de814e6293d/comments", "author": {"login": "macovedj", "id": 20097860, "node_id": "MDQ6VXNlcjIwMDk3ODYw", "avatar_url": "https://avatars.githubusercontent.com/u/20097860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/macovedj", "html_url": "https://github.com/macovedj", "followers_url": "https://api.github.com/users/macovedj/followers", "following_url": "https://api.github.com/users/macovedj/following{/other_user}", "gists_url": "https://api.github.com/users/macovedj/gists{/gist_id}", "starred_url": "https://api.github.com/users/macovedj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/macovedj/subscriptions", "organizations_url": "https://api.github.com/users/macovedj/orgs", "repos_url": "https://api.github.com/users/macovedj/repos", "events_url": "https://api.github.com/users/macovedj/events{/privacy}", "received_events_url": "https://api.github.com/users/macovedj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "macovedj", "id": 20097860, "node_id": "MDQ6VXNlcjIwMDk3ODYw", "avatar_url": "https://avatars.githubusercontent.com/u/20097860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/macovedj", "html_url": "https://github.com/macovedj", "followers_url": "https://api.github.com/users/macovedj/followers", "following_url": "https://api.github.com/users/macovedj/following{/other_user}", "gists_url": "https://api.github.com/users/macovedj/gists{/gist_id}", "starred_url": "https://api.github.com/users/macovedj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/macovedj/subscriptions", "organizations_url": "https://api.github.com/users/macovedj/orgs", "repos_url": "https://api.github.com/users/macovedj/repos", "events_url": "https://api.github.com/users/macovedj/events{/privacy}", "received_events_url": "https://api.github.com/users/macovedj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05e7d5481b7d405f0ebb04f3c83fb19618871c19", "url": "https://api.github.com/repos/rust-lang/rust/commits/05e7d5481b7d405f0ebb04f3c83fb19618871c19", "html_url": "https://github.com/rust-lang/rust/commit/05e7d5481b7d405f0ebb04f3c83fb19618871c19"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "a813d39441b547ffb0aa1e900fd6bcbf4a4697f5", "filename": "clippy_lints/src/methods/clone_on_copy.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/145ebb1cd723e34dc5a940ec3e498de814e6293d/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/145ebb1cd723e34dc5a940ec3e498de814e6293d/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs?ref=145ebb1cd723e34dc5a940ec3e498de814e6293d", "patch": "@@ -4,7 +4,7 @@ use clippy_utils::source::snippet_with_context;\n use clippy_utils::sugg;\n use clippy_utils::ty::is_copy;\n use rustc_errors::Applicability;\n-use rustc_hir::{BindingAnnotation, Expr, ExprKind, MatchSource, Node, PatKind};\n+use rustc_hir::{BindingAnnotation, Expr, ExprKind, MatchSource, Node, PatKind, QPath};\n use rustc_lint::LateContext;\n use rustc_middle::ty::{self, adjustment::Adjust};\n use rustc_span::symbol::{sym, Symbol};\n@@ -86,6 +86,10 @@ pub(super) fn check(cx: &LateContext<'_>, expr: &Expr<'_>, method_name: Symbol,\n                 {\n                     return;\n                 },\n+                ExprKind::Call(hir_callee, _) => match hir_callee.kind {\n+                    ExprKind::Path(QPath::LangItem(rustc_hir::LangItem::TryTraitBranch, _, _)) => true,\n+                    _ => false,\n+                },\n                 ExprKind::MethodCall(_, [self_arg, ..], _) if expr.hir_id == self_arg.hir_id => true,\n                 ExprKind::Match(_, _, MatchSource::TryDesugar | MatchSource::AwaitDesugar)\n                 | ExprKind::Field(..)"}, {"sha": "43849121b04330d7212ca3ba76713f414c91c18f", "filename": "tests/ui/clone_on_copy.fixed", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.fixed?ref=145ebb1cd723e34dc5a940ec3e498de814e6293d", "patch": "@@ -21,7 +21,7 @@ fn is_ascii(ch: char) -> bool {\n     ch.is_ascii()\n }\n \n-fn clone_on_copy() {\n+fn clone_on_copy() -> Option<(i32)> {\n     42;\n \n     vec![1].clone(); // ok, not a Copy type\n@@ -71,4 +71,8 @@ fn clone_on_copy() {\n     // Issue #5436\n     let mut vec = Vec::new();\n     vec.push(42);\n+\n+    let opt: &Option<i32> = &None;\n+    let value = (*opt)?;\n+    None\n }"}, {"sha": "1f10599da22832881eba7092c039ac94a5fe6606", "filename": "tests/ui/clone_on_copy.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.rs?ref=145ebb1cd723e34dc5a940ec3e498de814e6293d", "patch": "@@ -21,7 +21,7 @@ fn is_ascii(ch: char) -> bool {\n     ch.is_ascii()\n }\n \n-fn clone_on_copy() {\n+fn clone_on_copy() -> Option<(i32)> {\n     42.clone();\n \n     vec![1].clone(); // ok, not a Copy type\n@@ -71,4 +71,8 @@ fn clone_on_copy() {\n     // Issue #5436\n     let mut vec = Vec::new();\n     vec.push(42.clone());\n+\n+    let opt: &Option<i32> = &None;\n+    let value = opt.clone()?;\n+    None\n }"}, {"sha": "483ea35af2a0bf22772d4d38470cc061f0a6518b", "filename": "tests/ui/clone_on_copy.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/145ebb1cd723e34dc5a940ec3e498de814e6293d/tests%2Fui%2Fclone_on_copy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.stderr?ref=145ebb1cd723e34dc5a940ec3e498de814e6293d", "patch": "@@ -48,5 +48,11 @@ error: using `clone` on type `i32` which implements the `Copy` trait\n LL |     vec.push(42.clone());\n    |              ^^^^^^^^^^ help: try removing the `clone` call: `42`\n \n-error: aborting due to 8 previous errors\n+error: using `clone` on type `std::option::Option<i32>` which implements the `Copy` trait\n+  --> $DIR/clone_on_copy.rs:76:17\n+   |\n+LL |     let value = opt.clone()?;\n+   |                 ^^^^^^^^^^^ help: try dereferencing it: `(*opt)`\n+\n+error: aborting due to 9 previous errors\n "}]}