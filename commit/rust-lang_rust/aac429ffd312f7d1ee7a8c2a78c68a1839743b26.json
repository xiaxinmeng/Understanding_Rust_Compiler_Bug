{"sha": "aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhYzQyOWZmZDMxMmY3ZDFlZTdhOGMyYTc4YzY4YTE4Mzk3NDNiMjY=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-12-30T11:10:31Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-12-31T10:34:38Z"}, "message": "bootstrap: never delete the tarball temporary directory\n\nFiles in the temporary directory are used by ./x.py install.", "tree": {"sha": "c2690c553324403f5f7352f826d1863269be6270", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2690c553324403f5f7352f826d1863269be6270"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl/tqT4ACgkQPgar6Auq\n8ZwF8g//bd+DvwZhyUgFL+fIU04BBxq+54WN8NKmFObccXF519g7muAX2wCg1RQC\nu2AJXe0hZ/bCp2M2VNTm3F6+cTO7BstiTXIZNeeaSf4+lwC+QoZSAufm1xWPlgS0\nmyhnj3GzQHce+OEW0LkbF5pLZQh8eS+R3iEgmOAgCxnbH2KeFfnWlENsWCKfjR7m\nYvQ+FsJtCH1ehTmrhx1Rn8cZ+QGmVjBzPq9WgaiaxgHHI4QlnsXxMGQv8NIA+Vqi\nhiz+1AzfMPT0xjg08LLrEEe/3+eyK6aydxybQ2I8KhoDUmh77lc/BoDIFU4FdA76\ne0pRRHo7YcJ2NdshHNlNGumuyMujRtvz9DwkrbkQ7p3Zwtgp56kf7+6LxmXB2hD3\nNdQ940khfG7BlzD5O3Jo/7DeUi8Xa0BhpXHy1pA+pMmWwdJ0ubhyISJB1z2Kwr7G\nIOjdtOEt32HHL2Odu3BRXthHPWBRHDLvkxaz+rfeGMv4NKizxnYAc+VGwcvdw9qZ\nSY5H84Yk5qmsTCOkMxgMMHyW+pYSA4kdCC7Mz2zrgQ3fCA5v/tIxzNk/ZcIF8UOA\n+n64jSdm8GTqHkzXiAxErFfaMQAlhVJZUJnne5g7rHh2+CWKqZDAkRq64cy/z9s7\ng9L6sPYQ0jdsaN41zrjAlQWht+FCS00w8rPoCqJEsUjcfm7bYvI=\n=twfW\n-----END PGP SIGNATURE-----", "payload": "tree c2690c553324403f5f7352f826d1863269be6270\nparent 8b002d5c3489a21db2c16e5af63cf5d234f6972c\nauthor Pietro Albini <pietro@pietroalbini.org> 1609326631 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1609410878 +0100\n\nbootstrap: never delete the tarball temporary directory\n\nFiles in the temporary directory are used by ./x.py install.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "html_url": "https://github.com/rust-lang/rust/commit/aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aac429ffd312f7d1ee7a8c2a78c68a1839743b26/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b002d5c3489a21db2c16e5af63cf5d234f6972c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b002d5c3489a21db2c16e5af63cf5d234f6972c", "html_url": "https://github.com/rust-lang/rust/commit/8b002d5c3489a21db2c16e5af63cf5d234f6972c"}], "stats": {"total": 12, "additions": 3, "deletions": 9}, "files": [{"sha": "01c4ef4f5ae6e19d2726610d7a54f036b01c0146", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aac429ffd312f7d1ee7a8c2a78c68a1839743b26/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aac429ffd312f7d1ee7a8c2a78c68a1839743b26/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "patch": "@@ -1316,8 +1316,8 @@ impl Step for Extended {\n             tarballs.push(mingw_installer.unwrap());\n         }\n \n-        let mut tarball = Tarball::new(builder, \"rust\", &target.triple);\n-        let work = tarball.persist_work_dir();\n+        let tarball = Tarball::new(builder, \"rust\", &target.triple);\n+        let work = tarball.work_dir();\n         tarball.combine(&tarballs);\n \n         let tmp = tmpdir(builder).join(\"combined-tarball\");"}, {"sha": "91302dc3cfdcba589d689b991ea7d85733b532ac", "filename": "src/bootstrap/tarball.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/aac429ffd312f7d1ee7a8c2a78c68a1839743b26/src%2Fbootstrap%2Ftarball.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aac429ffd312f7d1ee7a8c2a78c68a1839743b26/src%2Fbootstrap%2Ftarball.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftarball.rs?ref=aac429ffd312f7d1ee7a8c2a78c68a1839743b26", "patch": "@@ -97,7 +97,6 @@ pub(crate) struct Tarball<'a> {\n \n     include_target_in_component_name: bool,\n     is_preview: bool,\n-    delete_temp_dir: bool,\n }\n \n impl<'a> Tarball<'a> {\n@@ -136,7 +135,6 @@ impl<'a> Tarball<'a> {\n \n             include_target_in_component_name: false,\n             is_preview: false,\n-            delete_temp_dir: true,\n         }\n     }\n \n@@ -198,8 +196,7 @@ impl<'a> Tarball<'a> {\n         self.builder.cp_r(src.as_ref(), &dest);\n     }\n \n-    pub(crate) fn persist_work_dir(&mut self) -> PathBuf {\n-        self.delete_temp_dir = false;\n+    pub(crate) fn work_dir(&self) -> PathBuf {\n         self.temp_dir.clone()\n     }\n \n@@ -299,9 +296,6 @@ impl<'a> Tarball<'a> {\n             cmd.arg(\"--compression-formats\").arg(formats.join(\",\"));\n         }\n         self.builder.run(&mut cmd);\n-        if self.delete_temp_dir {\n-            t!(std::fs::remove_dir_all(&self.temp_dir));\n-        }\n \n         // Use either the first compression format defined, or \"gz\" as the default.\n         let ext = self"}]}