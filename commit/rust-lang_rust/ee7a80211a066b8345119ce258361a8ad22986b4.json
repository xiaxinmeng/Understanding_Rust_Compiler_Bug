{"sha": "ee7a80211a066b8345119ce258361a8ad22986b4", "node_id": "C_kwDOAAsO6NoAKGVlN2E4MDIxMWEwNjZiODM0NTExOWNlMjU4MzYxYThhZDIyOTg2YjQ", "commit": {"author": {"name": "Jack Grigg", "email": "thestr4d@gmail.com", "date": "2022-11-07T03:25:54Z"}, "committer": {"name": "Jack Grigg", "email": "thestr4d@gmail.com", "date": "2022-11-07T03:25:54Z"}, "message": "Migrate linker-plugin-lto.md compatibility table to show Rust ranges\n\nThe helper shell script has been rewritten as a helper Python script\nthat generates the range-based table.", "tree": {"sha": "4ddbf135927f9de43846fb0c6ba9966b24f1b0c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ddbf135927f9de43846fb0c6ba9966b24f1b0c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee7a80211a066b8345119ce258361a8ad22986b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee7a80211a066b8345119ce258361a8ad22986b4", "html_url": "https://github.com/rust-lang/rust/commit/ee7a80211a066b8345119ce258361a8ad22986b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee7a80211a066b8345119ce258361a8ad22986b4/comments", "author": {"login": "str4d", "id": 4993799, "node_id": "MDQ6VXNlcjQ5OTM3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4993799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/str4d", "html_url": "https://github.com/str4d", "followers_url": "https://api.github.com/users/str4d/followers", "following_url": "https://api.github.com/users/str4d/following{/other_user}", "gists_url": "https://api.github.com/users/str4d/gists{/gist_id}", "starred_url": "https://api.github.com/users/str4d/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/str4d/subscriptions", "organizations_url": "https://api.github.com/users/str4d/orgs", "repos_url": "https://api.github.com/users/str4d/repos", "events_url": "https://api.github.com/users/str4d/events{/privacy}", "received_events_url": "https://api.github.com/users/str4d/received_events", "type": "User", "site_admin": false}, "committer": {"login": "str4d", "id": 4993799, "node_id": "MDQ6VXNlcjQ5OTM3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/4993799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/str4d", "html_url": "https://github.com/str4d", "followers_url": "https://api.github.com/users/str4d/followers", "following_url": "https://api.github.com/users/str4d/following{/other_user}", "gists_url": "https://api.github.com/users/str4d/gists{/gist_id}", "starred_url": "https://api.github.com/users/str4d/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/str4d/subscriptions", "organizations_url": "https://api.github.com/users/str4d/orgs", "repos_url": "https://api.github.com/users/str4d/repos", "events_url": "https://api.github.com/users/str4d/events{/privacy}", "received_events_url": "https://api.github.com/users/str4d/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee7c58bc1615963079edfed0e43d8d3578a55bf3", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee7c58bc1615963079edfed0e43d8d3578a55bf3", "html_url": "https://github.com/rust-lang/rust/commit/ee7c58bc1615963079edfed0e43d8d3578a55bf3"}], "stats": {"total": 99, "additions": 49, "deletions": 50}, "files": [{"sha": "9272b9ac9b2d45be95b2278b97dc36b0b5c00446", "filename": "src/doc/rustc/src/linker-plugin-lto.md", "status": "modified", "additions": 49, "deletions": 50, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/ee7a80211a066b8345119ce258361a8ad22986b4/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md", "raw_url": "https://github.com/rust-lang/rust/raw/ee7a80211a066b8345119ce258361a8ad22986b4/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Flinker-plugin-lto.md?ref=ee7a80211a066b8345119ce258361a8ad22986b4", "patch": "@@ -131,24 +131,47 @@ able to get around this problem by setting `-Clinker=lld-link` in RUSTFLAGS\n \n ## Toolchain Compatibility\n \n-<!-- NOTE: to update the below table, you can use this shell script:\n-\n-```sh\n-rustup toolchain install --profile minimal nightly\n-MINOR_VERSION=$(rustc +nightly --version | cut -d . -f 2)\n-LOWER_BOUND=66\n-\n-llvm_version() {\n-    toolchain=\"$1\"\n-    printf \"Rust $toolchain    |    Clang \"\n-    rustc +\"$toolchain\" -Vv | grep LLVM | cut -d ':' -f 2 | tr -d ' '\n-}\n-\n-for version in `seq $LOWER_BOUND $((MINOR_VERSION - 2))`; do\n-    toolchain=1.$version.0\n-    rustup toolchain install --no-self-update --profile  minimal $toolchain >/dev/null 2>&1\n-    llvm_version $toolchain\n-done\n+<!-- NOTE: to update the below table, you can use this Python script:\n+\n+```python\n+from collections import defaultdict\n+import subprocess\n+\n+def minor_version(version):\n+    return int(version.split('.')[1])\n+\n+INSTALL_TOOLCHAIN = [\"rustup\", \"toolchain\", \"install\", \"--profile\", \"minimal\"]\n+subprocess.run(INSTALL_TOOLCHAIN + [\"nightly\"])\n+\n+LOWER_BOUND = 65\n+NIGHTLY_VERSION = minor_version(subprocess.run(\n+    [\"rustc\", \"+nightly\", \"--version\"],\n+    capture_output=True,\n+    text=True).stdout)\n+\n+def llvm_version(toolchain):\n+    version_text = subprocess.run(\n+        [\"rustc\", \"+{}\".format(toolchain), \"-Vv\"],\n+        capture_output=True,\n+        text=True).stdout\n+    return int(version_text.split(\"LLVM\")[1].split(':')[1].split('.')[0])\n+\n+version_map = defaultdict(lambda: [])\n+for version in range(LOWER_BOUND, NIGHTLY_VERSION - 1):\n+    toolchain = \"1.{}.0\".format(version)\n+    subprocess.run(\n+        INSTALL_TOOLCHAIN + [\"--no-self-update\", toolchain],\n+        capture_output=True)\n+    version_map[llvm_version(toolchain)].append(version)\n+\n+print(\"| Rust Version | Clang Version |\")\n+print(\"|--------------|---------------|\")\n+for clang, rust in sorted(version_map.items()):\n+    if len(rust) > 1:\n+        rust_range = \"1.{} - 1.{}\".format(rust[0], rust[-1])\n+    else:\n+        rust_range = \"1.{}       \".format(rust[0])\n+    print(\"| {}  |      {}       |\".format(rust_range, clang))\n ```\n \n -->\n@@ -166,37 +189,13 @@ The following table shows known good combinations of toolchain versions.\n \n | Rust Version | Clang Version |\n |--------------|---------------|\n-| Rust 1.34    |    Clang 8    |\n-| Rust 1.35    |    Clang 8    |\n-| Rust 1.36    |    Clang 8    |\n-| Rust 1.37    |    Clang 8    |\n-| Rust 1.38    |    Clang 9    |\n-| Rust 1.39    |    Clang 9    |\n-| Rust 1.40    |    Clang 9    |\n-| Rust 1.41    |    Clang 9    |\n-| Rust 1.42    |    Clang 9    |\n-| Rust 1.43    |    Clang 9    |\n-| Rust 1.44    |    Clang 9    |\n-| Rust 1.45    |    Clang 10   |\n-| Rust 1.46    |    Clang 10   |\n-| Rust 1.47    |    Clang 11   |\n-| Rust 1.48    |    Clang 11   |\n-| Rust 1.49    |    Clang 11   |\n-| Rust 1.50    |    Clang 11   |\n-| Rust 1.51    |    Clang 11   |\n-| Rust 1.52    |    Clang 12   |\n-| Rust 1.53    |    Clang 12   |\n-| Rust 1.54    |    Clang 12   |\n-| Rust 1.55    |    Clang 12   |\n-| Rust 1.56    |    Clang 13   |\n-| Rust 1.57    |    Clang 13   |\n-| Rust 1.58    |    Clang 13   |\n-| Rust 1.59    |    Clang 13   |\n-| Rust 1.60    |    Clang 14   |\n-| Rust 1.61    |    Clang 14   |\n-| Rust 1.62    |    Clang 14   |\n-| Rust 1.63    |    Clang 14   |\n-| Rust 1.64    |    Clang 14   |\n-| Rust 1.65    |    Clang 15   |\n+| 1.34 - 1.37  |       8       |\n+| 1.38 - 1.44  |       9       |\n+| 1.45 - 1.46  |      10       |\n+| 1.47 - 1.51  |      11       |\n+| 1.52 - 1.55  |      12       |\n+| 1.56 - 1.59  |      13       |\n+| 1.60 - 1.64  |      14       |\n+| 1.65         |      15       |\n \n Note that the compatibility policy for this feature might change in the future."}]}