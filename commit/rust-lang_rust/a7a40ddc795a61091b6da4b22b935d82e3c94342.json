{"sha": "a7a40ddc795a61091b6da4b22b935d82e3c94342", "node_id": "C_kwDOAAsO6NoAKGE3YTQwZGRjNzk1YTYxMDkxYjZkYTRiMjJiOTM1ZDgyZTNjOTQzNDI", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-11-08T14:45:24Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-11-08T14:45:24Z"}, "message": "Simplify some `Autoderef::new` calls", "tree": {"sha": "6d1f49c40bd1c91f52f35bf69e87362c17690e32", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d1f49c40bd1c91f52f35bf69e87362c17690e32"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7a40ddc795a61091b6da4b22b935d82e3c94342", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7a40ddc795a61091b6da4b22b935d82e3c94342", "html_url": "https://github.com/rust-lang/rust/commit/a7a40ddc795a61091b6da4b22b935d82e3c94342", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7a40ddc795a61091b6da4b22b935d82e3c94342/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57d3c58ed6e0faf89a62411f96c000ffc9fd3937", "url": "https://api.github.com/repos/rust-lang/rust/commits/57d3c58ed6e0faf89a62411f96c000ffc9fd3937", "html_url": "https://github.com/rust-lang/rust/commit/57d3c58ed6e0faf89a62411f96c000ffc9fd3937"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "f30d53a4c8703a3471480f053eb4079b1a952b49", "filename": "compiler/rustc_hir_typeck/src/autoderef.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7a40ddc795a61091b6da4b22b935d82e3c94342/compiler%2Frustc_hir_typeck%2Fsrc%2Fautoderef.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7a40ddc795a61091b6da4b22b935d82e3c94342/compiler%2Frustc_hir_typeck%2Fsrc%2Fautoderef.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fautoderef.rs?ref=a7a40ddc795a61091b6da4b22b935d82e3c94342", "patch": "@@ -12,7 +12,7 @@ use std::iter;\n \n impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n     pub fn autoderef(&'a self, span: Span, base_ty: Ty<'tcx>) -> Autoderef<'a, 'tcx> {\n-        Autoderef::new(self, self.param_env, self.body_id, span, base_ty, span)\n+        self.autoderef_overloaded_span(span, base_ty, span)\n     }\n \n     /// Like `autoderef`, but provides a custom `Span` to use for calls to"}, {"sha": "c4f1a3e4e1bb0145a3a5d699209bd30824f583fe", "filename": "compiler/rustc_hir_typeck/src/pat.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a7a40ddc795a61091b6da4b22b935d82e3c94342/compiler%2Frustc_hir_typeck%2Fsrc%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7a40ddc795a61091b6da4b22b935d82e3c94342/compiler%2Frustc_hir_typeck%2Fsrc%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fpat.rs?ref=a7a40ddc795a61091b6da4b22b935d82e3c94342", "patch": "@@ -19,7 +19,6 @@ use rustc_span::lev_distance::find_best_match_for_name;\n use rustc_span::source_map::{Span, Spanned};\n use rustc_span::symbol::{kw, sym, Ident};\n use rustc_span::{BytePos, DUMMY_SP};\n-use rustc_trait_selection::autoderef::Autoderef;\n use rustc_trait_selection::traits::{ObligationCause, Pattern};\n use ty::VariantDef;\n \n@@ -2132,7 +2131,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             && let ty::Array(..) | ty::Slice(..) = ty.kind()\n         {\n             err.help(\"the semantics of slice patterns changed recently; see issue #62254\");\n-        } else if Autoderef::new(&self.infcx, self.param_env, self.body_id, span, expected_ty, span)\n+        } else if self.autoderef(span, expected_ty)\n             .any(|(ty, _)| matches!(ty.kind(), ty::Slice(..) | ty::Array(..)))\n             && let (Some(span), true) = (ti.span, ti.origin_expr)\n             && let Ok(snippet) = self.tcx.sess.source_map().span_to_snippet(span)"}]}