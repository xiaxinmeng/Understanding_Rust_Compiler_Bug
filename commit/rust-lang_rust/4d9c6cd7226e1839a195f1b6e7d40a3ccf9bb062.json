{"sha": "4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkOWM2Y2Q3MjI2ZTE4MzlhMTk1ZjFiNmU3ZDQwYTNjY2Y5YmIwNjI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-21T07:20:14Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-21T07:20:14Z"}, "message": "Auto merge of #60132 - davidtwco:issue-60075, r=estebank\n\nFix fn front matter parsing ICE from invalid code.\n\nFixes #60075.\n\nThis PR fixes an \"unreachable code\" ICE that results from parsing\ninvalid code where the compiler is expecting the next trait item\ndeclaration in the middle of the previous trait item due to extra\nclosing braces.\n\nr? @estebank (thanks for the minimized test case)", "tree": {"sha": "57987160b517735c1654f387d18b1c24b35a4788", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57987160b517735c1654f387d18b1c24b35a4788"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "html_url": "https://github.com/rust-lang/rust/commit/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9224be5fa39f6170f6e046342976efee5453a1ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/9224be5fa39f6170f6e046342976efee5453a1ff", "html_url": "https://github.com/rust-lang/rust/commit/9224be5fa39f6170f6e046342976efee5453a1ff"}, {"sha": "60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "url": "https://api.github.com/repos/rust-lang/rust/commits/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "html_url": "https://github.com/rust-lang/rust/commit/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "29d2d2ad73d62a1aff4ee33f12572da303060e5f", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "patch": "@@ -6618,7 +6618,12 @@ impl<'a> Parser<'a> {\n             };\n             (respan(self.prev_span, Constness::NotConst), unsafety, abi)\n         };\n-        self.expect_keyword(keywords::Fn)?;\n+        if !self.eat_keyword(keywords::Fn) {\n+            // It is possible for `expect_one_of` to recover given the contents of\n+            // `self.expected_tokens`, therefore, do not use `self.unexpected()` which doesn't\n+            // account for this.\n+            if !self.expect_one_of(&[], &[])? { unreachable!() }\n+        }\n         Ok((constness, unsafety, asyncness, abi))\n     }\n "}, {"sha": "5788716a52629bba22af262129cb35db60dc6360", "filename": "src/test/ui/issue-60075.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Ftest%2Fui%2Fissue-60075.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Ftest%2Fui%2Fissue-60075.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-60075.rs?ref=4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "patch": "@@ -0,0 +1,12 @@\n+fn main() {}\n+\n+trait T {\n+    fn qux() -> Option<usize> {\n+        let _ = if true {\n+        });\n+//~^ ERROR expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `;`\n+//~^^ ERROR expected one of `.`, `;`, `?`, `else`, or an operator, found `}`\n+//~^^^ ERROR 6:11: 6:12: expected identifier, found `;`\n+//~^^^^ ERROR missing `fn`, `type`, or `const` for trait-item declaration\n+        Some(4)\n+    }"}, {"sha": "244aef2d1f0f5aad7d4706be7a4167cb0e943d9c", "filename": "src/test/ui/issue-60075.stderr", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Ftest%2Fui%2Fissue-60075.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062/src%2Ftest%2Fui%2Fissue-60075.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-60075.stderr?ref=4d9c6cd7226e1839a195f1b6e7d40a3ccf9bb062", "patch": "@@ -0,0 +1,37 @@\n+error: expected one of `.`, `;`, `?`, `else`, or an operator, found `}`\n+  --> $DIR/issue-60075.rs:6:10\n+   |\n+LL |         });\n+   |          ^ expected one of `.`, `;`, `?`, `else`, or an operator here\n+\n+error: expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `;`\n+  --> $DIR/issue-60075.rs:6:11\n+   |\n+LL |     fn qux() -> Option<usize> {\n+   |                               - unclosed delimiter\n+LL |         let _ = if true {\n+LL |         });\n+   |           ^\n+   |           |\n+   |           help: `}` may belong here\n+\n+error: expected identifier, found `;`\n+  --> $DIR/issue-60075.rs:6:11\n+   |\n+LL |         });\n+   |           ^ expected identifier\n+\n+error: missing `fn`, `type`, or `const` for trait-item declaration\n+  --> $DIR/issue-60075.rs:6:12\n+   |\n+LL |           });\n+   |  ____________^\n+LL | |\n+LL | |\n+LL | |\n+LL | |\n+LL | |         Some(4)\n+   | |________^ missing `fn`, `type`, or `const`\n+\n+error: aborting due to 4 previous errors\n+"}]}