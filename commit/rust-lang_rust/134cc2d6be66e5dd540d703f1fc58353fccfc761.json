{"sha": "134cc2d6be66e5dd540d703f1fc58353fccfc761", "node_id": "C_kwDOAAsO6NoAKDEzNGNjMmQ2YmU2NmU1ZGQ1NDBkNzAzZjFmYzU4MzUzZmNjZmM3NjE", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-08-27T04:14:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-27T04:14:16Z"}, "message": "Rollup merge of #99784 - est31:deny_cfg_attr_crate_type_name, r=Mark-Simulacrum\n\nMake forward compatibility lint deprecated_cfg_attr_crate_type_name deny by default\n\nTurns the forward compatibility lint added by #83744 to deprecate `cfg_attr` usage with `#![crate_type]` and `#![crate_name]` attributes into deny by default. Copying the example from #83744:\n\n```Rust\n#![crate_type = \"lib\"] // remains working\n#![cfg_attr(foo, crate_type = \"bin\")] // will stop working\n```\n\nOver 8 months have passed since #83744 was merged so I'd say this gives ample time for people to have been warned, so we can make the warning stronger. No usage was found via grep.app except for one, which was in an unmaintained code base that didn't seem to be used in the open source eco system. The crater run conducted in #83744 also didn't show up anything.\n\ncc #91632 - tracking issue for the lint", "tree": {"sha": "672b11f4bc05e0bf116d8f3836d3fc4b84684b4b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/672b11f4bc05e0bf116d8f3836d3fc4b84684b4b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/134cc2d6be66e5dd540d703f1fc58353fccfc761", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjCZoYCRBK7hj4Ov3rIwAAK44IAI/qd2UKash85yPBdYLcCX8M\nK23WcwFDsaJAy8aXh64z1GMiTqP/wVof94pwZScStDzINhOkXUgo+Dj1rfdQUtrR\nb+bz7y3ISaumRuG3D0WXWxdSolFJxd1HHzlQc6r0InRfrNZ6QxEhTOARudppUcy+\nt5/DQqvQHvyelTs8aiG2KLl3Rtp431Ej5UZB2XpKMjeAX+Q7ywOlLm7UuHFk0Mp1\nvlKg/MKXCEjrVbij50SiPfSip/+xNyw2nk0SrPqRkMzn3AYBBjzEkCSbUV0s5FKQ\ndbKQNRlfuV4voX31BQWzqm8dfJTXeKw9uXQBUVHKj9fzn3vAkTyOeI+nchGmt+0=\n=rPSR\n-----END PGP SIGNATURE-----\n", "payload": "tree 672b11f4bc05e0bf116d8f3836d3fc4b84684b4b\nparent 539e408e1e3b9bcf983735462e8ffad2004f27fc\nparent 152c851f891eaade1bbb3cc5d35d3e7b7412c7fa\nauthor Yuki Okushi <jtitor@2k36.org> 1661573656 +0900\ncommitter GitHub <noreply@github.com> 1661573656 +0900\n\nRollup merge of #99784 - est31:deny_cfg_attr_crate_type_name, r=Mark-Simulacrum\n\nMake forward compatibility lint deprecated_cfg_attr_crate_type_name deny by default\n\nTurns the forward compatibility lint added by #83744 to deprecate `cfg_attr` usage with `#![crate_type]` and `#![crate_name]` attributes into deny by default. Copying the example from #83744:\n\n```Rust\n#![crate_type = \"lib\"] // remains working\n#![cfg_attr(foo, crate_type = \"bin\")] // will stop working\n```\n\nOver 8 months have passed since #83744 was merged so I'd say this gives ample time for people to have been warned, so we can make the warning stronger. No usage was found via grep.app except for one, which was in an unmaintained code base that didn't seem to be used in the open source eco system. The crater run conducted in #83744 also didn't show up anything.\n\ncc #91632 - tracking issue for the lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/134cc2d6be66e5dd540d703f1fc58353fccfc761", "html_url": "https://github.com/rust-lang/rust/commit/134cc2d6be66e5dd540d703f1fc58353fccfc761", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/134cc2d6be66e5dd540d703f1fc58353fccfc761/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "539e408e1e3b9bcf983735462e8ffad2004f27fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/539e408e1e3b9bcf983735462e8ffad2004f27fc", "html_url": "https://github.com/rust-lang/rust/commit/539e408e1e3b9bcf983735462e8ffad2004f27fc"}, {"sha": "152c851f891eaade1bbb3cc5d35d3e7b7412c7fa", "url": "https://api.github.com/repos/rust-lang/rust/commits/152c851f891eaade1bbb3cc5d35d3e7b7412c7fa", "html_url": "https://github.com/rust-lang/rust/commit/152c851f891eaade1bbb3cc5d35d3e7b7412c7fa"}], "stats": {"total": 25, "additions": 9, "deletions": 16}, "files": [{"sha": "2dca6acdd6d6fb562331476c6bec93a59df7f847", "filename": "compiler/rustc_lint_defs/src/builtin.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/134cc2d6be66e5dd540d703f1fc58353fccfc761/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/134cc2d6be66e5dd540d703f1fc58353fccfc761/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint_defs%2Fsrc%2Fbuiltin.rs?ref=134cc2d6be66e5dd540d703f1fc58353fccfc761", "patch": "@@ -3094,7 +3094,7 @@ declare_lint! {\n     ///\n     /// ### Example\n     ///\n-    /// ```rust\n+    /// ```rust,compile_fail\n     /// #![cfg_attr(debug_assertions, crate_type = \"lib\")]\n     /// ```\n     ///\n@@ -3114,7 +3114,7 @@ declare_lint! {\n     /// rustc instead of `#![cfg_attr(..., crate_type = \"...\")]` and\n     /// `--crate-name` instead of `#![cfg_attr(..., crate_name = \"...\")]`.\n     pub DEPRECATED_CFG_ATTR_CRATE_TYPE_NAME,\n-    Warn,\n+    Deny,\n     \"detects usage of `#![cfg_attr(..., crate_type/crate_name = \\\"...\\\")]`\",\n     @future_incompatible = FutureIncompatibleInfo {\n         reference: \"issue #91632 <https://github.com/rust-lang/rust/issues/91632>\","}, {"sha": "c6ecb7aa96abcaf2defd9c6724c04385fc768c1a", "filename": "src/test/codegen/external-no-mangle-statics.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fcodegen%2Fexternal-no-mangle-statics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fcodegen%2Fexternal-no-mangle-statics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fexternal-no-mangle-statics.rs?ref=134cc2d6be66e5dd540d703f1fc58353fccfc761", "patch": "@@ -1,12 +1,11 @@\n // revisions: lib staticlib\n // ignore-emscripten default visibility is hidden\n // compile-flags: -O\n+// [lib] compile-flags: --crate-type lib\n+// [staticlib] compile-flags: --crate-type staticlib\n // `#[no_mangle]`d static variables always have external linkage, i.e., no `internal` in their\n // definitions\n \n-#![cfg_attr(lib, crate_type = \"lib\")]\n-#![cfg_attr(staticlib, crate_type = \"staticlib\")]\n-\n // CHECK: @A = local_unnamed_addr constant\n #[no_mangle]\n static A: u8 = 0;"}, {"sha": "1f23dadc4322659906d35c7b80dbb61f3d1e7c95", "filename": "src/test/ui/cfg/future-compat-crate-attributes-using-cfg_attr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.rs?ref=134cc2d6be66e5dd540d703f1fc58353fccfc761", "patch": "@@ -1,7 +1,6 @@\n // check-fail\n // compile-flags:--cfg foo\n \n-#![deny(warnings)]\n #![cfg_attr(foo, crate_type=\"bin\")]\n //~^ERROR `crate_type` within\n //~| WARN this was previously accepted"}, {"sha": "b52535ffdbab2d0fb2cd2f62f36aeae196490e1b", "filename": "src/test/ui/cfg/future-compat-crate-attributes-using-cfg_attr.stderr", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/134cc2d6be66e5dd540d703f1fc58353fccfc761/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcfg%2Ffuture-compat-crate-attributes-using-cfg_attr.stderr?ref=134cc2d6be66e5dd540d703f1fc58353fccfc761", "patch": "@@ -1,20 +1,15 @@\n error: `crate_type` within an `#![cfg_attr] attribute is deprecated`\n-  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:5:18\n+  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:4:18\n    |\n LL | #![cfg_attr(foo, crate_type=\"bin\")]\n    |                  ^^^^^^^^^^^^^^^^\n    |\n-note: the lint level is defined here\n-  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:4:9\n-   |\n-LL | #![deny(warnings)]\n-   |         ^^^^^^^^\n-   = note: `#[deny(deprecated_cfg_attr_crate_type_name)]` implied by `#[deny(warnings)]`\n+   = note: `#[deny(deprecated_cfg_attr_crate_type_name)]` on by default\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #91632 <https://github.com/rust-lang/rust/issues/91632>\n \n error: `crate_name` within an `#![cfg_attr] attribute is deprecated`\n-  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:10:18\n+  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:9:18\n    |\n LL | #![cfg_attr(foo, crate_name=\"bar\")]\n    |                  ^^^^^^^^^^^^^^^^\n@@ -23,7 +18,7 @@ LL | #![cfg_attr(foo, crate_name=\"bar\")]\n    = note: for more information, see issue #91632 <https://github.com/rust-lang/rust/issues/91632>\n \n error: `crate_type` within an `#![cfg_attr] attribute is deprecated`\n-  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:5:18\n+  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:4:18\n    |\n LL | #![cfg_attr(foo, crate_type=\"bin\")]\n    |                  ^^^^^^^^^^^^^^^^\n@@ -32,7 +27,7 @@ LL | #![cfg_attr(foo, crate_type=\"bin\")]\n    = note: for more information, see issue #91632 <https://github.com/rust-lang/rust/issues/91632>\n \n error: `crate_name` within an `#![cfg_attr] attribute is deprecated`\n-  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:10:18\n+  --> $DIR/future-compat-crate-attributes-using-cfg_attr.rs:9:18\n    |\n LL | #![cfg_attr(foo, crate_name=\"bar\")]\n    |                  ^^^^^^^^^^^^^^^^"}]}