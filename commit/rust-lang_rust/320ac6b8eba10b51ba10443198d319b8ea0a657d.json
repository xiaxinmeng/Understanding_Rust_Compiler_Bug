{"sha": "320ac6b8eba10b51ba10443198d319b8ea0a657d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyMGFjNmI4ZWJhMTBiNTFiYTEwNDQzMTk4ZDMxOWI4ZWEwYTY1N2Q=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-17T00:36:49Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-03-17T00:36:49Z"}, "message": "Teach configure.sh to probe paths, factor a bit.", "tree": {"sha": "ffc5dbcc5db117b56e8a070d7f0aa5013ff34ef8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ffc5dbcc5db117b56e8a070d7f0aa5013ff34ef8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/320ac6b8eba10b51ba10443198d319b8ea0a657d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/320ac6b8eba10b51ba10443198d319b8ea0a657d", "html_url": "https://github.com/rust-lang/rust/commit/320ac6b8eba10b51ba10443198d319b8ea0a657d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/320ac6b8eba10b51ba10443198d319b8ea0a657d/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a6a30b7924d2a12a73cf3243a736c0efe26c6b4", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a6a30b7924d2a12a73cf3243a736c0efe26c6b4", "html_url": "https://github.com/rust-lang/rust/commit/6a6a30b7924d2a12a73cf3243a736c0efe26c6b4"}], "stats": {"total": 74, "additions": 48, "deletions": 26}, "files": [{"sha": "03678e013a913336b0b9ae6e9b64841efa22cf71", "filename": "src/configure.sh", "status": "modified", "additions": 48, "deletions": 26, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/320ac6b8eba10b51ba10443198d319b8ea0a657d/src%2Fconfigure.sh", "raw_url": "https://github.com/rust-lang/rust/raw/320ac6b8eba10b51ba10443198d319b8ea0a657d/src%2Fconfigure.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconfigure.sh?ref=320ac6b8eba10b51ba10443198d319b8ea0a657d", "patch": "@@ -3,37 +3,59 @@\n CFG_SRC_DIR=${0%${0##*/}}\n CFG_BUILD_DIR=$PWD\n \n-CFG_OSTYPE=$(uname -s)\n-CFG_CPUTYPE=$(uname -m)\n-\n-echo \"configuring on $CFG_CPUTYPE $CFG_OSTYPE\"\n-\n-echo \"setting up build directories\"\n-for i in boot/{fe,me,be,driver,util} \\\n-         rt/{isaac,bigint,sync,test} \\\n-         stage{0,1,2}                \\\n-         test/{run-pass,compile-{pass,fail}}\n+echo \"configure: recreating config.mk\"\n+echo '' >config.mk\n+\n+echo \"configure: making directories\"\n+for i in \\\n+    boot/fe boot/me boot/be boot/driver boot/util \\\n+    rt/isaac rt/bigint rt/sync rt/test \\\n+    stage0 stage1 stage2 \\\n+    test/run-pass test/compile-pass test/compile-fail\n do\n     mkdir -p -v $i\n done\n \n-CFG_VALGRIND=$(sh which valgrind)\n-CFG_OCAMLC_OPT=$(sh which ocamlc.opt)\n-\n-echo \"copying Makefile\"\n+echo \"configure: copying Makefile\"\n cp -v ${CFG_SRC_DIR}Makefile.in ./Makefile\n \n-echo \"writing config.mk\"\n-cat >config.mk <<EOF\n+putvar() {\n+    local T\n+    eval T=\\$$1\n+    printf \"%-20s := %s\\n\" $1 $T\n+    printf \"%-20s := %s\\n\" $1 $T >>config.mk\n+}\n+\n+probe() {\n+    local V=$1\n+    local P=$2\n+    local T\n+    T=$(which $P 2>&1)\n+    if [ $? -ne 0 ]\n+    then\n+        T=\"\"\n+    fi\n+    eval $V=\\$T\n+    putvar $V\n+}\n+\n+echo \"configure: inspecting environment\"\n \n-CFG_OSTYPE        := $CFG_OSTYPE\n-CFG_CPUTYPE       := $CFG_CPUTYPE\n-CFG_SRC_DIR       := $CFG_SRC_DIR\n-CFG_BUILD_DIR     := $CFG_BUILD_DIR\n-\n-CFG_VALGRIND      := $CFG_VALGRIND\n-CFG_OCAMLC_OPT    := $CFG_OCAMLC_OPT\n-\n-EOF\n+CFG_OSTYPE=$(uname -s)\n+CFG_CPUTYPE=$(uname -m)\n \n-echo \"configured ok\"\n+putvar CFG_SRC_DIR\n+putvar CFG_BUILD_DIR\n+putvar CFG_OSTYPE\n+putvar CFG_CPUTYPE\n+\n+echo \"configure: looking for programs\"\n+probe CFG_VALGRIND         valgrind\n+probe CFG_OCAMLC           ocamlc\n+probe CFG_OCAMLC_OPT       ocamlc.opt\n+probe CFG_OCAMLOPT         ocamlopt\n+probe CFG_OCAMLOPT_OPT     ocamlopt.opt\n+probe CFG_FLEXLINK         flexlink\n+probe CFG_LLVM_CONFIG      llvm-config\n+\n+echo \"configure: complete\""}]}