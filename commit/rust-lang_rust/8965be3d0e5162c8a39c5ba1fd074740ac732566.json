{"sha": "8965be3d0e5162c8a39c5ba1fd074740ac732566", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5NjViZTNkMGU1MTYyYzhhMzljNWJhMWZkMDc0NzQwYWM3MzI1NjY=", "commit": {"author": {"name": "Dawer", "email": "7803845+iDawer@users.noreply.github.com", "date": "2021-04-16T12:22:11Z"}, "committer": {"name": "Dawer", "email": "7803845+iDawer@users.noreply.github.com", "date": "2021-04-16T12:22:11Z"}, "message": "Fill match arms for a tuple of a single enum.", "tree": {"sha": "8e5cccb9a99518807384cc4a4551ddf63c5d7f9e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e5cccb9a99518807384cc4a4551ddf63c5d7f9e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8965be3d0e5162c8a39c5ba1fd074740ac732566", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8965be3d0e5162c8a39c5ba1fd074740ac732566", "html_url": "https://github.com/rust-lang/rust/commit/8965be3d0e5162c8a39c5ba1fd074740ac732566", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8965be3d0e5162c8a39c5ba1fd074740ac732566/comments", "author": {"login": "iDawer", "id": 7803845, "node_id": "MDQ6VXNlcjc4MDM4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7803845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iDawer", "html_url": "https://github.com/iDawer", "followers_url": "https://api.github.com/users/iDawer/followers", "following_url": "https://api.github.com/users/iDawer/following{/other_user}", "gists_url": "https://api.github.com/users/iDawer/gists{/gist_id}", "starred_url": "https://api.github.com/users/iDawer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iDawer/subscriptions", "organizations_url": "https://api.github.com/users/iDawer/orgs", "repos_url": "https://api.github.com/users/iDawer/repos", "events_url": "https://api.github.com/users/iDawer/events{/privacy}", "received_events_url": "https://api.github.com/users/iDawer/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iDawer", "id": 7803845, "node_id": "MDQ6VXNlcjc4MDM4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7803845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iDawer", "html_url": "https://github.com/iDawer", "followers_url": "https://api.github.com/users/iDawer/followers", "following_url": "https://api.github.com/users/iDawer/following{/other_user}", "gists_url": "https://api.github.com/users/iDawer/gists{/gist_id}", "starred_url": "https://api.github.com/users/iDawer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iDawer/subscriptions", "organizations_url": "https://api.github.com/users/iDawer/orgs", "repos_url": "https://api.github.com/users/iDawer/repos", "events_url": "https://api.github.com/users/iDawer/events{/privacy}", "received_events_url": "https://api.github.com/users/iDawer/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "042c248cc5fd9ce8f73ecdb99b6177a66add1b51", "url": "https://api.github.com/repos/rust-lang/rust/commits/042c248cc5fd9ce8f73ecdb99b6177a66add1b51", "html_url": "https://github.com/rust-lang/rust/commit/042c248cc5fd9ce8f73ecdb99b6177a66add1b51"}], "stats": {"total": 40, "additions": 24, "deletions": 16}, "files": [{"sha": "80bd1b7e8a493eec4398e757daa3e358eea79816", "filename": "crates/ide_assists/src/handlers/fill_match_arms.rs", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/8965be3d0e5162c8a39c5ba1fd074740ac732566/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8965be3d0e5162c8a39c5ba1fd074740ac732566/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Ffill_match_arms.rs?ref=8965be3d0e5162c8a39c5ba1fd074740ac732566", "patch": "@@ -71,12 +71,6 @@ pub(crate) fn fill_match_arms(acc: &mut Assists, ctx: &AssistContext) -> Option<\n             return None;\n         }\n \n-        // We do not currently support filling match arms for a tuple\n-        // containing a single enum.\n-        if enum_defs.len() < 2 {\n-            return None;\n-        }\n-\n         // When calculating the match arms for a tuple of enums, we want\n         // to create a match arm for each possible combination of enum\n         // values. The `multi_cartesian_product` method transforms\n@@ -514,10 +508,7 @@ fn main() {\n \n     #[test]\n     fn fill_match_arms_single_element_tuple_of_enum() {\n-        // For now we don't hande the case of a single element tuple, but\n-        // we could handle this in the future if `make::tuple_pat` allowed\n-        // creating a tuple with a single pattern.\n-        check_assist_not_applicable(\n+        check_assist(\n             fill_match_arms,\n             r#\"\n             enum A { One, Two }\n@@ -528,6 +519,17 @@ fn main() {\n                 }\n             }\n             \"#,\n+            r#\"\n+            enum A { One, Two }\n+\n+            fn main() {\n+                let a = A::One;\n+                match (a, ) {\n+                    $0(A::One,) => {}\n+                    (A::Two,) => {}\n+                }\n+            }\n+            \"#,\n         );\n     }\n "}, {"sha": "94d4f2cf0b986659f1cbfbea4212d87941fd38bf", "filename": "crates/syntax/src/ast/make.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8965be3d0e5162c8a39c5ba1fd074740ac732566/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8965be3d0e5162c8a39c5ba1fd074740ac732566/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fmake.rs?ref=8965be3d0e5162c8a39c5ba1fd074740ac732566", "patch": "@@ -29,9 +29,13 @@ pub fn ty(text: &str) -> ast::Type {\n pub fn ty_unit() -> ast::Type {\n     ty(\"()\")\n }\n-// FIXME: handle types of length == 1\n pub fn ty_tuple(types: impl IntoIterator<Item = ast::Type>) -> ast::Type {\n-    let contents = types.into_iter().join(\", \");\n+    let mut count: usize = 0;\n+    let mut contents = types.into_iter().inspect(|_| count += 1).join(\", \");\n+    if count == 1 {\n+        contents.push(',');\n+    }\n+\n     ty(&format!(\"({})\", contents))\n }\n // FIXME: handle path to type\n@@ -292,11 +296,13 @@ pub fn wildcard_pat() -> ast::WildcardPat {\n \n /// Creates a tuple of patterns from an iterator of patterns.\n ///\n-/// Invariant: `pats` must be length > 1\n-///\n-/// FIXME handle `pats` length == 1\n+/// Invariant: `pats` must be length > 0\n pub fn tuple_pat(pats: impl IntoIterator<Item = ast::Pat>) -> ast::TuplePat {\n-    let pats_str = pats.into_iter().map(|p| p.to_string()).join(\", \");\n+    let mut count: usize = 0;\n+    let mut pats_str = pats.into_iter().inspect(|_| count += 1).join(\", \");\n+    if count == 1 {\n+        pats_str.push(',');\n+    }\n     return from_text(&format!(\"({})\", pats_str));\n \n     fn from_text(text: &str) -> ast::TuplePat {"}]}