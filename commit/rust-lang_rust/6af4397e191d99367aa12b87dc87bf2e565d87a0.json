{"sha": "6af4397e191d99367aa12b87dc87bf2e565d87a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhZjQzOTdlMTkxZDk5MzY3YWExMmI4N2RjODdiZjJlNTY1ZDg3YTA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-07-03T09:31:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-07-03T09:31:12Z"}, "message": "Rollup merge of #52004 - kennytm:toolstate-fixes, r=Mark-Simulacrum\n\ntoolstate: Fixed detection of changed submodule, and other fixes.\n\n1. Make sure that if a submodule is updated but failed to test-pass, we'll block the merge.\n2. Make sure failure on external docs (nomicon/RBE/etc) are properly checked.\n3. If the commit message starts with \"Update RLS\" (or clippy etc), automatically run the \"tools\" job on the PR, so that we could know if the update failed before merging.", "tree": {"sha": "3086ee509c1cba3ced357f08bbb7febd2f19d275", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3086ee509c1cba3ced357f08bbb7febd2f19d275"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6af4397e191d99367aa12b87dc87bf2e565d87a0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbO0JgCRBK7hj4Ov3rIwAAdHIIAK8OSmS+HJbWSaj7XkS+j3cA\nrMVqV9x8KekJOtqxmZ9BawyqitD4OgBuR/CvSQh4WFyGbu6z8nDsWWUa5v6GiEcY\nexcTFQ9h9zk1Trhc8C53OnV/5deQdYGftkuBbks+372li4mTXXPo8bpHx2C7AHZN\nfYEn47Oo446HqcKALXPyC65ILMV+xa2T+NTw0ojqNBR58s5V7ZfEF/k1VpkAsSdP\nyDm3JNz4M7cjcUdiFlMKBKthpdMk/Rpy158M5sBlf6pTzmy2EiAchjDsjvQu1G7Q\nyP8SDOdN/QsNm83g4AHNWXnSAtInQm3DYL0bPWksP+b3CrRmj9U7SnI1KsStN0c=\n=8caP\n-----END PGP SIGNATURE-----\n", "payload": "tree 3086ee509c1cba3ced357f08bbb7febd2f19d275\nparent 5feb26cc554ba723e5e052f5e3bfa3f9308cce88\nparent 689cffa211e4c2c2c74dbc759020be40fe222d23\nauthor Pietro Albini <pietro@pietroalbini.org> 1530610272 +0200\ncommitter GitHub <noreply@github.com> 1530610272 +0200\n\nRollup merge of #52004 - kennytm:toolstate-fixes, r=Mark-Simulacrum\n\ntoolstate: Fixed detection of changed submodule, and other fixes.\n\n1. Make sure that if a submodule is updated but failed to test-pass, we'll block the merge.\n2. Make sure failure on external docs (nomicon/RBE/etc) are properly checked.\n3. If the commit message starts with \"Update RLS\" (or clippy etc), automatically run the \"tools\" job on the PR, so that we could know if the update failed before merging.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6af4397e191d99367aa12b87dc87bf2e565d87a0", "html_url": "https://github.com/rust-lang/rust/commit/6af4397e191d99367aa12b87dc87bf2e565d87a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6af4397e191d99367aa12b87dc87bf2e565d87a0/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5feb26cc554ba723e5e052f5e3bfa3f9308cce88", "url": "https://api.github.com/repos/rust-lang/rust/commits/5feb26cc554ba723e5e052f5e3bfa3f9308cce88", "html_url": "https://github.com/rust-lang/rust/commit/5feb26cc554ba723e5e052f5e3bfa3f9308cce88"}, {"sha": "689cffa211e4c2c2c74dbc759020be40fe222d23", "url": "https://api.github.com/repos/rust-lang/rust/commits/689cffa211e4c2c2c74dbc759020be40fe222d23", "html_url": "https://github.com/rust-lang/rust/commit/689cffa211e4c2c2c74dbc759020be40fe222d23"}], "stats": {"total": 24, "additions": 11, "deletions": 13}, "files": [{"sha": "ba8a39f355c4ba0544643f7dd9900471bd98f81e", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6af4397e191d99367aa12b87dc87bf2e565d87a0/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/6af4397e191d99367aa12b87dc87bf2e565d87a0/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=6af4397e191d99367aa12b87dc87bf2e565d87a0", "patch": "@@ -169,7 +169,7 @@ matrix:\n     - env: IMAGE=x86_64-gnu-aux\n       if: branch = auto\n     - env: IMAGE=x86_64-gnu-tools\n-      if: branch = auto\n+      if: branch = auto OR (type = pull_request AND commit_message =~ /(?i:^update.*\\b(rls|rustfmt|clippy|miri)\\b)/)\n     - env: IMAGE=x86_64-gnu-debug\n       if: branch = auto\n     - env: IMAGE=x86_64-gnu-nopt"}, {"sha": "3adfbb5e36b51d2088ba4f6aa7f18b11b21fc7b7", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6af4397e191d99367aa12b87dc87bf2e565d87a0/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6af4397e191d99367aa12b87dc87bf2e565d87a0/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=6af4397e191d99367aa12b87dc87bf2e565d87a0", "patch": "@@ -1269,17 +1269,15 @@ impl Step for DocTest {\n \n         files.sort();\n \n+        let mut toolstate = ToolState::TestPass;\n         for file in files {\n-            let test_result = markdown_test(builder, compiler, &file);\n-            if self.is_ext_doc {\n-                let toolstate = if test_result {\n-                    ToolState::TestPass\n-                } else {\n-                    ToolState::TestFail\n-                };\n-                builder.save_toolstate(self.name, toolstate);\n+            if !markdown_test(builder, compiler, &file) {\n+                toolstate = ToolState::TestFail;\n             }\n         }\n+        if self.is_ext_doc {\n+            builder.save_toolstate(self.name, toolstate);\n+        }\n     }\n }\n "}, {"sha": "e8197e9085182accd4e53aa2c43f9e7c95ac5fb1", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6af4397e191d99367aa12b87dc87bf2e565d87a0/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/6af4397e191d99367aa12b87dc87bf2e565d87a0/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=6af4397e191d99367aa12b87dc87bf2e565d87a0", "patch": "@@ -79,11 +79,11 @@ status_check() {\n     check_dispatch $1 beta nomicon src/doc/nomicon\n     check_dispatch $1 beta reference src/doc/reference\n     check_dispatch $1 beta rust-by-example src/doc/rust-by-example\n-    check_dispatch $1 beta rls src/tool/rls\n-    check_dispatch $1 beta rustfmt src/tool/rustfmt\n+    check_dispatch $1 beta rls src/tools/rls\n+    check_dispatch $1 beta rustfmt src/tools/rustfmt\n     # these tools are not required for beta to successfully branch\n-    check_dispatch $1 nightly clippy-driver src/tool/clippy\n-    check_dispatch $1 nightly miri src/tool/miri\n+    check_dispatch $1 nightly clippy-driver src/tools/clippy\n+    check_dispatch $1 nightly miri src/tools/miri\n }\n \n # If this PR is intended to update one of these tools, do not let the build pass"}]}