{"sha": "b20d8d3396faadd76f413d1d073be5c7576e5780", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyMGQ4ZDMzOTZmYWFkZDc2ZjQxM2QxZDA3M2JlNWM3NTc2ZTU3ODA=", "commit": {"author": {"name": "Mateusz Miku\u0142a", "email": "mati865@gmail.com", "date": "2019-10-28T20:43:37Z"}, "committer": {"name": "Mateusz Miku\u0142a", "email": "mati865@gmail.com", "date": "2019-10-30T22:18:57Z"}, "message": "Statically link libstdc++ on windows-gnu", "tree": {"sha": "af39dfc80cb5dfe59a083daac3d96221fcf1c1d5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af39dfc80cb5dfe59a083daac3d96221fcf1c1d5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b20d8d3396faadd76f413d1d073be5c7576e5780", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b20d8d3396faadd76f413d1d073be5c7576e5780", "html_url": "https://github.com/rust-lang/rust/commit/b20d8d3396faadd76f413d1d073be5c7576e5780", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b20d8d3396faadd76f413d1d073be5c7576e5780/comments", "author": {"login": "mati865", "id": 1174646, "node_id": "MDQ6VXNlcjExNzQ2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mati865", "html_url": "https://github.com/mati865", "followers_url": "https://api.github.com/users/mati865/followers", "following_url": "https://api.github.com/users/mati865/following{/other_user}", "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}", "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mati865/subscriptions", "organizations_url": "https://api.github.com/users/mati865/orgs", "repos_url": "https://api.github.com/users/mati865/repos", "events_url": "https://api.github.com/users/mati865/events{/privacy}", "received_events_url": "https://api.github.com/users/mati865/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mati865", "id": 1174646, "node_id": "MDQ6VXNlcjExNzQ2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1174646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mati865", "html_url": "https://github.com/mati865", "followers_url": "https://api.github.com/users/mati865/followers", "following_url": "https://api.github.com/users/mati865/following{/other_user}", "gists_url": "https://api.github.com/users/mati865/gists{/gist_id}", "starred_url": "https://api.github.com/users/mati865/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mati865/subscriptions", "organizations_url": "https://api.github.com/users/mati865/orgs", "repos_url": "https://api.github.com/users/mati865/repos", "events_url": "https://api.github.com/users/mati865/events{/privacy}", "received_events_url": "https://api.github.com/users/mati865/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c553e8e8812c19809e70523064989e66c5cfd3f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/c553e8e8812c19809e70523064989e66c5cfd3f1", "html_url": "https://github.com/rust-lang/rust/commit/c553e8e8812c19809e70523064989e66c5cfd3f1"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "8e5fe2520cad7fde10c3bda64895444e9f56f6a6", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=b20d8d3396faadd76f413d1d073be5c7576e5780", "patch": "@@ -657,11 +657,11 @@ pub fn build_codegen_backend(builder: &Builder<'_>,\n             if let Some(ref s) = builder.config.llvm_ldflags {\n                 cargo.env(\"LLVM_LINKER_FLAGS\", s);\n             }\n-            // Building with a static libstdc++ is only supported on linux right now,\n+            // Building with a static libstdc++ is only supported on linux and mingw right now,\n             // not for MSVC or macOS\n             if builder.config.llvm_static_stdcpp &&\n                !target.contains(\"freebsd\") &&\n-               !target.contains(\"windows\") &&\n+               !target.contains(\"msvc\") &&\n                !target.contains(\"apple\") {\n                 let file = compiler_file(builder,\n                                          builder.cxx(target).unwrap(),"}, {"sha": "67907bc8cbf0adf8c01867a9a43bb557246aa9a7", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=b20d8d3396faadd76f413d1d073be5c7576e5780", "patch": "@@ -236,7 +236,7 @@ fn make_win_dist(\n     }\n \n     let target_tools = [\"gcc.exe\", \"ld.exe\", \"dlltool.exe\", \"libwinpthread-1.dll\"];\n-    let mut rustc_dlls = vec![\"libstdc++-6.dll\", \"libwinpthread-1.dll\"];\n+    let mut rustc_dlls = vec![\"libwinpthread-1.dll\"];\n     if target_triple.starts_with(\"i686-\") {\n         rustc_dlls.push(\"libgcc_s_dw2-1.dll\");\n     } else {"}, {"sha": "2e89fd5398dfc94a252daec80c76bc9ad1f36c0b", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=b20d8d3396faadd76f413d1d073be5c7576e5780", "patch": "@@ -159,7 +159,7 @@ impl Step for Llvm {\n \n         // For distribution we want the LLVM tools to be *statically* linked to libstdc++\n         if builder.config.llvm_tools_enabled || builder.config.lldb_enabled {\n-            if !target.contains(\"windows\") {\n+            if !target.contains(\"msvc\") {\n                 if target.contains(\"apple\") {\n                     cfg.define(\"CMAKE_EXE_LINKER_FLAGS\", \"-static-libstdc++\");\n                 } else {\n@@ -395,7 +395,7 @@ fn configure_cmake(builder: &Builder<'_>,\n     cfg.define(\"CMAKE_C_FLAGS\", cflags);\n     let mut cxxflags = builder.cflags(target, GitRepo::Llvm).join(\" \");\n     if builder.config.llvm_static_stdcpp &&\n-        !target.contains(\"windows\") &&\n+        !target.contains(\"msvc\") &&\n         !target.contains(\"netbsd\")\n     {\n         cxxflags.push_str(\" -static-libstdc++\");"}, {"sha": "c5d5f066f4f821d156aded803472942de655a88c", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b20d8d3396faadd76f413d1d073be5c7576e5780/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=b20d8d3396faadd76f413d1d073be5c7576e5780", "patch": "@@ -279,7 +279,11 @@ fn main() {\n             let path = PathBuf::from(s);\n             println!(\"cargo:rustc-link-search=native={}\",\n                      path.parent().unwrap().display());\n-            println!(\"cargo:rustc-link-lib=static={}\", stdcppname);\n+            if target.contains(\"windows\") {\n+                println!(\"cargo:rustc-link-lib=static-nobundle={}\", stdcppname);\n+            } else {\n+                println!(\"cargo:rustc-link-lib=static={}\", stdcppname);\n+            }\n         } else if cxxflags.contains(\"stdlib=libc++\") {\n             println!(\"cargo:rustc-link-lib=c++\");\n         } else {"}]}