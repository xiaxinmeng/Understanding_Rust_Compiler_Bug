{"sha": "3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "node_id": "C_kwDOAAsO6NoAKDNlYjllMWE3YWU2MmVkMDc0MDU2OTI4YjdhZTEyYWI1ZGI3MTNmMDc", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-06-20T14:29:16Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-06-22T22:22:25Z"}, "message": "Add/update GUI tests for help pocket menu", "tree": {"sha": "8912ab1c9117c61b8b9da4b9a08e5e0f5328a80f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8912ab1c9117c61b8b9da4b9a08e5e0f5328a80f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "html_url": "https://github.com/rust-lang/rust/commit/3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "html_url": "https://github.com/rust-lang/rust/commit/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae"}], "stats": {"total": 89, "additions": 74, "deletions": 15}, "files": [{"sha": "d083b0ae0c9319e8af6b6fb746eb8638b778f572", "filename": "src/test/rustdoc-gui/escape-key.goml", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "raw_url": "https://github.com/rust-lang/rust/raw/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fescape-key.goml?ref=3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "patch": "@@ -21,25 +21,13 @@ wait-for: \"#alternative-display #search\"\n assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})\n assert-document-property: ({\"URL\": \"index.html?search=test\"}, ENDS_WITH)\n \n-// Now let's check that when the help popup is displayed and we press Escape, it doesn't\n-// hide the search results too.\n-click: \"#help-button\"\n-assert-document-property: ({\"URL\": \"index.html?search=test\"}, [ENDS_WITH])\n-assert-attribute: (\"#help\", {\"class\": \"\"})\n-press-key: \"Escape\"\n-wait-for: \"#alternative-display #search\"\n-assert-attribute: (\"#help\", {\"class\": \"hidden\"})\n-assert-attribute: (\"#main-content\", {\"class\": \"content hidden\"})\n-assert-document-property: ({\"URL\": \"index.html?search=test\"}, [ENDS_WITH])\n-\n // Check that Escape hides the search results when a search result is focused.\n focus: \".search-input\"\n assert: \".search-input:focus\"\n press-key: \"ArrowDown\"\n assert-false: \".search-input:focus\"\n assert: \"#results a:focus\"\n press-key: \"Escape\"\n-assert-attribute: (\"#help\", {\"class\": \"hidden\"})\n wait-for: \"#not-displayed #search\"\n assert-false: \"#alternative-display #search\"\n assert-attribute: (\"#main-content\", {\"class\": \"content\"})"}, {"sha": "ba2986e969a3506d0adf8601fa8b31cd736a6b29", "filename": "src/test/rustdoc-gui/pocket-menu.goml", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fpocket-menu.goml", "raw_url": "https://github.com/rust-lang/rust/raw/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fpocket-menu.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fpocket-menu.goml?ref=3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "patch": "@@ -0,0 +1,72 @@\n+// This test ensures that the \"pocket menus\" are working as expected.\n+goto: file://|DOC_PATH|/test_docs/index.html\n+// First we check that the help menu doesn't exist yet.\n+assert-false: \"#help-button .popover\"\n+// Then we display the help menu.\n+click: \"#help-button\"\n+assert: \"#help-button .popover\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"block\"})\n+\n+// Now we click somewhere else on the page to ensure it is handling the blur event\n+// correctly.\n+click: \".sidebar\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"none\"})\n+\n+// Now we will check that we cannot have two \"pocket menus\" displayed at the same time.\n+click: \"#help-button\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"block\"})\n+click: \"#settings-menu\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"none\"})\n+assert-css: (\"#settings-menu .popover\", {\"display\": \"block\"})\n+\n+// Now the other way.\n+click: \"#help-button\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"block\"})\n+assert-css: (\"#settings-menu .popover\", {\"display\": \"none\"})\n+\n+// We check the borders color now:\n+\n+// Ayu theme\n+local-storage: {\n+    \"rustdoc-theme\": \"ayu\",\n+    \"rustdoc-use-system-theme\": \"false\",\n+}\n+reload:\n+\n+click: \"#help-button\"\n+assert-css: (\n+    \"#help-button .popover\",\n+    {\"display\": \"block\", \"border-color\": \"rgb(92, 103, 115)\"},\n+)\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .top\", [\"border-color\"])\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .bottom\", [\"border-color\"])\n+\n+// Dark theme\n+local-storage: {\n+    \"rustdoc-theme\": \"dark\",\n+    \"rustdoc-use-system-theme\": \"false\",\n+}\n+reload:\n+\n+click: \"#help-button\"\n+assert-css: (\n+    \"#help-button .popover\",\n+    {\"display\": \"block\", \"border-color\": \"rgb(210, 210, 210)\"},\n+)\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .top\", [\"border-color\"])\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .bottom\", [\"border-color\"])\n+\n+// Light theme\n+local-storage: {\n+    \"rustdoc-theme\": \"light\",\n+    \"rustdoc-use-system-theme\": \"false\",\n+}\n+reload:\n+\n+click: \"#help-button\"\n+assert-css: (\n+    \"#help-button .popover\",\n+    {\"display\": \"block\", \"border-color\": \"rgb(221, 221, 221)\"},\n+)\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .top\", [\"border-color\"])\n+compare-elements-css: (\"#help-button .popover\", \"#help-button .bottom\", [\"border-color\"])"}, {"sha": "1f20a0eaa9982d21630b0fcad056e01356bacabf", "filename": "src/test/rustdoc-gui/shortcuts.goml", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fshortcuts.goml", "raw_url": "https://github.com/rust-lang/rust/raw/3eb9e1a7ae62ed074056928b7ae12ab5db713f07/src%2Ftest%2Frustdoc-gui%2Fshortcuts.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fshortcuts.goml?ref=3eb9e1a7ae62ed074056928b7ae12ab5db713f07", "patch": "@@ -8,7 +8,6 @@ press-key: \"Escape\"\n assert-false: \"input.search-input:focus\"\n // We now check for the help popup.\n press-key: \"?\"\n-assert-css: (\"#help\", {\"display\": \"flex\"})\n-assert-false: \"#help.hidden\"\n+assert-css: (\"#help-button .popover\", {\"display\": \"block\"})\n press-key: \"Escape\"\n-assert-css: (\"#help.hidden\", {\"display\": \"none\"})\n+assert-css: (\"#help-button .popover\", {\"display\": \"none\"})"}]}