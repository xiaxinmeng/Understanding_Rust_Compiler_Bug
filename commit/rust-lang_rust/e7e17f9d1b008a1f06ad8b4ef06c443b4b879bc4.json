{"sha": "e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3ZTE3ZjlkMWIwMDhhMWYwNmFkOGI0ZWYwNmM0NDNiNGI4NzliYzQ=", "commit": {"author": {"name": "Dan Robertson", "email": "dan@dlrobertson.com", "date": "2018-12-17T03:17:59Z"}, "committer": {"name": "Dan Robertson", "email": "dan@dlrobertson.com", "date": "2018-12-17T17:45:14Z"}, "message": "static eval: Do not ICE on layout size overflow\n\nLayout size overflow and typeck eval errors are reported. Trigger a bug\nonly when the eval error is strictly labeled as TooGeneric.", "tree": {"sha": "2d49d117803cc9e866f9275cc195efae90ae068e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d49d117803cc9e866f9275cc195efae90ae068e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEF5dO2RaKc5C+SCJ9RcSmUsR+QqUFAlwX4KsACgkQRcSmUsR+\nQqVdiQ/9Gh+k+sA82oDb/OCF13QduC+hxaVxDMzUkCd/Nmk0mdXY6AGJMwqchI3K\n56B8MdM9k2gKosdEGy8K5iGIlbifhnZRymX1HsXV+fwT2sc1X6rj2VUVx+bKXq2l\nPhPPUK8+nQpfqIP+BoN1wl3loQgxZNdsvnt4pq7S7jdEbOOpNzEwusarMCaymfZx\nwaE9iNRMa8OCoQEa3TRagf0Ua18WQj/qK8B70tvkbdg3/egjoyTFJzc8FgCbYtSY\n2Lt78pS5WP5je0u7f9bTX7X9jDLndcSY9ESOtygW2IGLz9ngJVI6mq3CbVBkW1Io\nF6SWQavoZxAWevjurqKSJrgliBez61YmXh8F+NoTpXk1uV7D0gIbvfWdASSVp75S\nNglfHALlSUWlKc/ZpITZYfxBEbBZEeDlDWZiA/EtQpX3rJMGYIMLUl1CLvzmu5AF\niiudcTGnJyH3mCsjbOOx0DRrgYcoPKPHPdU6MQzJItWQvLH61HwbZiFG2VXlZfXg\nDXl3G1xxL9t8hnj4zZShQqRdn7yrHtQXyjzer/Gv16WJhZNbJjrFaKs5QiyZ0XuI\noqDU8JgSBaBg0P1HseMnzx9O8319L06/OJXnvUa9IZK5TpP11PwIs+wM6lua7HmK\neplTQR5jSXYexFJH249AO45mrKCGC2ZxMZGEFXIL2APyimphHrA=\n=nZO0\n-----END PGP SIGNATURE-----", "payload": "tree 2d49d117803cc9e866f9275cc195efae90ae068e\nparent a8a2a887d0a65fff6c777f9bcd7b1c0bdfbbddc0\nauthor Dan Robertson <dan@dlrobertson.com> 1545016679 +0000\ncommitter Dan Robertson <dan@dlrobertson.com> 1545068714 +0000\n\nstatic eval: Do not ICE on layout size overflow\n\nLayout size overflow and typeck eval errors are reported. Trigger a bug\nonly when the eval error is strictly labeled as TooGeneric.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "html_url": "https://github.com/rust-lang/rust/commit/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/comments", "author": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dlrobertson", "id": 7504153, "node_id": "MDQ6VXNlcjc1MDQxNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/7504153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlrobertson", "html_url": "https://github.com/dlrobertson", "followers_url": "https://api.github.com/users/dlrobertson/followers", "following_url": "https://api.github.com/users/dlrobertson/following{/other_user}", "gists_url": "https://api.github.com/users/dlrobertson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlrobertson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlrobertson/subscriptions", "organizations_url": "https://api.github.com/users/dlrobertson/orgs", "repos_url": "https://api.github.com/users/dlrobertson/repos", "events_url": "https://api.github.com/users/dlrobertson/events{/privacy}", "received_events_url": "https://api.github.com/users/dlrobertson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8a2a887d0a65fff6c777f9bcd7b1c0bdfbbddc0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8a2a887d0a65fff6c777f9bcd7b1c0bdfbbddc0", "html_url": "https://github.com/rust-lang/rust/commit/a8a2a887d0a65fff6c777f9bcd7b1c0bdfbbddc0"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "d5bc83aba7b990d7298833cb35ea6fd8c3bc806a", "filename": "src/librustc_mir/const_eval.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Flibrustc_mir%2Fconst_eval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Flibrustc_mir%2Fconst_eval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fconst_eval.rs?ref=e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "patch": "@@ -692,12 +692,16 @@ pub fn const_eval_raw_provider<'a, 'tcx>(\n         let err = error_to_const_error(&ecx, error);\n         // errors in statics are always emitted as fatal errors\n         if tcx.is_static(def_id).is_some() {\n-            let err = err.report_as_error(ecx.tcx, \"could not evaluate static initializer\");\n-            // check that a static never produces `TooGeneric`\n+            let reported_err = err.report_as_error(ecx.tcx,\n+                                                   \"could not evaluate static initializer\");\n+            // Ensure that if the above error was either `TooGeneric` or `Reported`\n+            // an error must be reported.\n             if tcx.sess.err_count() == 0 {\n-                span_bug!(ecx.tcx.span, \"static eval failure didn't emit an error: {:#?}\", err);\n+                tcx.sess.delay_span_bug(err.span,\n+                                        &format!(\"static eval failure did not emit an error: {:#?}\",\n+                                                 reported_err));\n             }\n-            err\n+            reported_err\n         } else if def_id.is_local() {\n             // constant defined in this crate, we can figure out a lint level!\n             match tcx.describe_def(def_id) {"}, {"sha": "97b66b2c7c9236c250b18ec88c0e0f9fac57867f", "filename": "src/test/ui/issues/issue-56762.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56762.rs?ref=e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "patch": "@@ -0,0 +1,18 @@\n+// only-x86_64\n+const HUGE_SIZE: usize = !0usize / 8;\n+\n+\n+pub struct TooBigArray {\n+    arr: [u8; HUGE_SIZE],\n+}\n+\n+impl TooBigArray {\n+    pub const fn new() -> Self {\n+        TooBigArray { arr: [0x00; HUGE_SIZE], }\n+    }\n+}\n+\n+static MY_TOO_BIG_ARRAY_1: TooBigArray = TooBigArray::new();\n+static MY_TOO_BIG_ARRAY_2: [u8; HUGE_SIZE] = [0x00; HUGE_SIZE];\n+\n+fn main() { }"}, {"sha": "83d5dc62e61618ce10a19e370df78706992692f5", "filename": "src/test/ui/issues/issue-56762.stderr", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-56762.stderr?ref=e7e17f9d1b008a1f06ad8b4ef06c443b4b879bc4", "patch": "@@ -0,0 +1,4 @@\n+error: the type `[u8; 2305843009213693951]` is too big for the current architecture\n+\n+error: aborting due to previous error\n+"}]}