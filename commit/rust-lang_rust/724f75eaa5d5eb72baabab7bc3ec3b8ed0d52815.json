{"sha": "724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyNGY3NWVhYTVkNWViNzJiYWFiYWI3YmMzZWMzYjhlZDBkNTI4MTU=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2016-10-12T04:48:20Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-10-12T04:48:20Z"}, "message": "Merge pull request #1182 from philipc/issue-1149\n\nPreserve macro formatting if we can't rewrite it", "tree": {"sha": "be366fd04c241a988cd1a4698c05d2918271e279", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be366fd04c241a988cd1a4698c05d2918271e279"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "html_url": "https://github.com/rust-lang/rust/commit/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ffb581563e65129dcd07add9113e42e5e0a2951", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ffb581563e65129dcd07add9113e42e5e0a2951", "html_url": "https://github.com/rust-lang/rust/commit/8ffb581563e65129dcd07add9113e42e5e0a2951"}, {"sha": "c4a7a7108e155dfb3ada7b0e7def78962f5d6263", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4a7a7108e155dfb3ada7b0e7def78962f5d6263", "html_url": "https://github.com/rust-lang/rust/commit/c4a7a7108e155dfb3ada7b0e7def78962f5d6263"}], "stats": {"total": 25, "additions": 12, "deletions": 13}, "files": [{"sha": "dd301ad9de7b6fd115b0de85e069acb2bb9e9c39", "filename": "src/macros.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "patch": "@@ -30,7 +30,6 @@ use codemap::SpanUtils;\n use rewrite::{Rewrite, RewriteContext};\n use expr::{rewrite_call, rewrite_array};\n use comment::{FindUncommented, contains_comment};\n-use utils::wrap_str;\n \n const FORCED_BRACKET_MACROS: &'static [&'static str] = &[\"vec!\"];\n \n@@ -141,10 +140,7 @@ pub fn rewrite_macro(mac: &ast::Mac,\n         }\n         MacroStyle::Braces => {\n             // Skip macro invocations with braces, for now.\n-            wrap_str(context.snippet(mac.span),\n-                     context.config.max_width,\n-                     width,\n-                     offset)\n+            None\n         }\n     }\n }"}, {"sha": "f05fcefdfe8c4a1711427ee4f005576a77a386e7", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "patch": "@@ -66,7 +66,6 @@ impl<'a> FmtVisitor<'a> {\n             }\n             ast::StmtKind::Mac(ref mac) => {\n                 let (ref mac, _macro_style, _) = **mac;\n-                self.format_missing_with_indent(source!(self, stmt.span).lo);\n                 self.visit_mac(mac, None);\n             }\n         }\n@@ -281,7 +280,6 @@ impl<'a> FmtVisitor<'a> {\n                 self.format_mod(module, &item.vis, item.span, item.ident);\n             }\n             ast::ItemKind::Mac(ref mac) => {\n-                self.format_missing_with_indent(source!(self, item.span).lo);\n                 self.visit_mac(mac, Some(item.ident));\n             }\n             ast::ItemKind::ForeignMod(ref foreign_mod) => {\n@@ -418,7 +416,6 @@ impl<'a> FmtVisitor<'a> {\n                 self.push_rewrite(ii.span, rewrite);\n             }\n             ast::ImplItemKind::Macro(ref mac) => {\n-                self.format_missing_with_indent(source!(self, ii.span).lo);\n                 self.visit_mac(mac, Some(ii.ident));\n             }\n         }\n@@ -428,11 +425,7 @@ impl<'a> FmtVisitor<'a> {\n         // 1 = ;\n         let width = self.config.max_width - self.block_indent.width() - 1;\n         let rewrite = rewrite_macro(mac, ident, &self.get_context(), width, self.block_indent);\n-\n-        if let Some(res) = rewrite {\n-            self.buffer.push_str(&res);\n-            self.last_pos = source!(self, mac.span).hi;\n-        }\n+        self.push_rewrite(mac.span, rewrite);\n     }\n \n     fn push_rewrite(&mut self, span: Span, rewrite: Option<String>) {"}, {"sha": "ca28d5c625b5735d5d137fbdcfddc414331fc12a", "filename": "tests/source/macros.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/tests%2Fsource%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/tests%2Fsource%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fmacros.rs?ref=724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "patch": "@@ -50,6 +50,11 @@ fn main() {\n     some_macro!{\n         // comment\n     };\n+\n+    some_macro!(\n+        // comment\n+        not function like\n+    );\n }\n \n impl X {"}, {"sha": "79a42524939f45678d015d4bc2bf66156c4c086c", "filename": "tests/target/macros.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/tests%2Ftarget%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815/tests%2Ftarget%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fmacros.rs?ref=724f75eaa5d5eb72baabab7bc3ec3b8ed0d52815", "patch": "@@ -53,6 +53,11 @@ fn main() {\n     some_macro!{\n         // comment\n     };\n+\n+    some_macro!(\n+        // comment\n+        not function like\n+    );\n }\n \n impl X {"}]}