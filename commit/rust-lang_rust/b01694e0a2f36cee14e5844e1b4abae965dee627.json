{"sha": "b01694e0a2f36cee14e5844e1b4abae965dee627", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIwMTY5NGUwYTJmMzZjZWUxNGU1ODQ0ZTFiNGFiYWU5NjVkZWU2Mjc=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-01T22:23:25Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-01T22:23:25Z"}, "message": "Returns values up to 2*usize by value", "tree": {"sha": "d28eaf9d193ca7bc3dbd985326b13f66238678ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d28eaf9d193ca7bc3dbd985326b13f66238678ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b01694e0a2f36cee14e5844e1b4abae965dee627", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b01694e0a2f36cee14e5844e1b4abae965dee627", "html_url": "https://github.com/rust-lang/rust/commit/b01694e0a2f36cee14e5844e1b4abae965dee627", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b01694e0a2f36cee14e5844e1b4abae965dee627/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fe73e80d762bc575040239fc05fb1c612873554", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fe73e80d762bc575040239fc05fb1c612873554", "html_url": "https://github.com/rust-lang/rust/commit/8fe73e80d762bc575040239fc05fb1c612873554"}], "stats": {"total": 17, "additions": 3, "deletions": 14}, "files": [{"sha": "b61fde32c9ce84e5646d9e5a8366733ab4120769", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b01694e0a2f36cee14e5844e1b4abae965dee627/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b01694e0a2f36cee14e5844e1b4abae965dee627/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=b01694e0a2f36cee14e5844e1b4abae965dee627", "patch": "@@ -2787,8 +2787,9 @@ where\n                     _ => return,\n                 }\n \n-                let max_by_val_size =\n-                    if is_ret { call::max_ret_by_val(cx) } else { Pointer.size(cx) };\n+                // Return structures up to 2 pointers in size by value, matching `ScalarPair`. LLVM\n+                // will usually return these in 2 registers, which is more efficient than by-ref.\n+                let max_by_val_size = if is_ret { Pointer.size(cx) * 2 } else { Pointer.size(cx) };\n                 let size = arg.layout.size;\n \n                 if arg.layout.is_unsized() || size > max_by_val_size {"}, {"sha": "8f7e2bba5aa6d785ea72f08fbd39d01ef7bfd55e", "filename": "compiler/rustc_target/src/abi/call/mod.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b01694e0a2f36cee14e5844e1b4abae965dee627/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b01694e0a2f36cee14e5844e1b4abae965dee627/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fabi%2Fcall%2Fmod.rs?ref=b01694e0a2f36cee14e5844e1b4abae965dee627", "patch": "@@ -610,15 +610,3 @@ impl<'a, Ty> FnAbi<'a, Ty> {\n         Ok(())\n     }\n }\n-\n-/// Returns the maximum size of return values to be passed by value in the Rust ABI.\n-///\n-/// Return values beyond this size will use an implicit out-pointer instead.\n-pub fn max_ret_by_val<C: HasTargetSpec + HasDataLayout>(spec: &C) -> Size {\n-    match spec.target_spec().arch.as_str() {\n-        // System-V will pass return values up to 128 bits in RAX/RDX.\n-        \"x86_64\" => Size::from_bits(128),\n-\n-        _ => spec.data_layout().pointer_size,\n-    }\n-}"}]}