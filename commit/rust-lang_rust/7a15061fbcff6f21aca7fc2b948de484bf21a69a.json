{"sha": "7a15061fbcff6f21aca7fc2b948de484bf21a69a", "node_id": "C_kwDOAAsO6NoAKDdhMTUwNjFmYmNmZjZmMjFhY2E3ZmMyYjk0OGRlNDg0YmYyMWE2OWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-01T19:56:03Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-01T20:32:18Z"}, "message": "tests: use std::thread::available_parallelism() instead of num_cpus to get thread count\n\nremoves the dependency added in https://github.com/rust-lang/rust-clippy/pull/8451", "tree": {"sha": "a3280788c3f7e688f6896bcc6784a2641b443575", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a3280788c3f7e688f6896bcc6784a2641b443575"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a15061fbcff6f21aca7fc2b948de484bf21a69a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a15061fbcff6f21aca7fc2b948de484bf21a69a", "html_url": "https://github.com/rust-lang/rust/commit/7a15061fbcff6f21aca7fc2b948de484bf21a69a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a15061fbcff6f21aca7fc2b948de484bf21a69a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "28b1fe51293096e763da8442465ea42bd341a0b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/28b1fe51293096e763da8442465ea42bd341a0b6", "html_url": "https://github.com/rust-lang/rust/commit/28b1fe51293096e763da8442465ea42bd341a0b6"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "6cf24a0c6d037d1d76cb47dea7e65bd658acbe92", "filename": "Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7a15061fbcff6f21aca7fc2b948de484bf21a69a/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/7a15061fbcff6f21aca7fc2b948de484bf21a69a/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=7a15061fbcff6f21aca7fc2b948de484bf21a69a", "patch": "@@ -51,7 +51,6 @@ futures = \"0.3\"\n parking_lot = \"0.11.2\"\n tokio = { version = \"1\", features = [\"io-util\"] }\n rustc-semver = \"1.1\"\n-num_cpus = \"1.13\"\n \n [build-dependencies]\n rustc_tools_util = { version = \"0.2\", path = \"rustc_tools_util\" }"}, {"sha": "c9710e3db8e8d264e956dc8cb8e2eb04f07911dd", "filename": "tests/compile-test.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7a15061fbcff6f21aca7fc2b948de484bf21a69a/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a15061fbcff6f21aca7fc2b948de484bf21a69a/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=7a15061fbcff6f21aca7fc2b948de484bf21a69a", "patch": "@@ -168,7 +168,11 @@ fn run_ui() {\n     let _threads = VarGuard::set(\n         \"RUST_TEST_THREADS\",\n         // if RUST_TEST_THREADS is set, adhere to it, otherwise override it\n-        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| num_cpus::get().to_string()),\n+        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| {\n+            std::thread::available_parallelism()\n+                .map_or(1, std::num::NonZeroUsize::get)\n+                .to_string()\n+        }),\n     );\n     compiletest::run_tests(&config);\n }"}]}