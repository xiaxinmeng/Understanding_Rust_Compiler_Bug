{"sha": "f76a46242b6a34ac09643ddf4050be9d1ad11573", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3NmE0NjI0MmI2YTM0YWMwOTY0M2RkZjQwNTBiZTlkMWFkMTE1NzM=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-08-01T22:28:28Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-08-03T01:55:44Z"}, "message": "Convert pfib to pipes. This is a useful stress test.", "tree": {"sha": "983a2e176b7b306d902932e2f9a7e0fe1d456d0d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/983a2e176b7b306d902932e2f9a7e0fe1d456d0d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f76a46242b6a34ac09643ddf4050be9d1ad11573", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f76a46242b6a34ac09643ddf4050be9d1ad11573", "html_url": "https://github.com/rust-lang/rust/commit/f76a46242b6a34ac09643ddf4050be9d1ad11573", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f76a46242b6a34ac09643ddf4050be9d1ad11573/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d04b0ed5ac829594a412298cb9f9455d1a4d843", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d04b0ed5ac829594a412298cb9f9455d1a4d843", "html_url": "https://github.com/rust-lang/rust/commit/1d04b0ed5ac829594a412298cb9f9455d1a4d843"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "5b309659ee5056925a81a858d4f10fdf24462379", "filename": "src/test/bench/shootout-pfib.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f76a46242b6a34ac09643ddf4050be9d1ad11573/src%2Ftest%2Fbench%2Fshootout-pfib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f76a46242b6a34ac09643ddf4050be9d1ad11573/src%2Ftest%2Fbench%2Fshootout-pfib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fshootout-pfib.rs?ref=f76a46242b6a34ac09643ddf4050be9d1ad11573", "patch": "@@ -15,33 +15,33 @@ use std;\n import std::{time, getopts};\n import io::writer_util;\n import int::range;\n-import comm::port;\n-import comm::chan;\n-import comm::send;\n-import comm::recv;\n+import pipes::port;\n+import pipes::chan;\n+import pipes::send;\n+import pipes::recv;\n \n import core::result;\n import result::{ok, err};\n \n fn fib(n: int) -> int {\n     fn pfib(c: chan<int>, n: int) {\n         if n == 0 {\n-            send(c, 0);\n+            c.send(0);\n         } else if n <= 2 {\n-            send(c, 1);\n+            c.send(1);\n         } else {\n-            let p = port();\n-            let ch = chan(p);\n+            let p = pipes::port_set();\n+            let ch = p.chan();\n             task::spawn(|| pfib(ch, n - 1) );\n+            let ch = p.chan();\n             task::spawn(|| pfib(ch, n - 2) );\n-            send(c, recv(p) + recv(p));\n+            c.send(p.recv() + p.recv());\n         }\n     }\n \n-    let p = port();\n-    let ch = chan(p);\n+    let (ch, p) = pipes::stream();\n     let t = task::spawn(|| pfib(ch, n) );\n-    return recv(p);\n+    p.recv()\n }\n \n type config = {stress: bool};"}]}