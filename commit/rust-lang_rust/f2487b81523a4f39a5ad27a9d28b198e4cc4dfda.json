{"sha": "f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyNDg3YjgxNTIzYTRmMzlhNWFkMjdhOWQyOGIxOThlNGNjNGRmZGE=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-04-13T22:08:36Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2017-04-13T22:37:47Z"}, "message": "refactor `metadata_symbol_name`", "tree": {"sha": "98c272a23f7a2554bcf5ab9c4bdb4b909bfcf40f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98c272a23f7a2554bcf5ab9c4bdb4b909bfcf40f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "html_url": "https://github.com/rust-lang/rust/commit/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e26983c86c6e6a51c85e1bd5c4621f3b43afe99", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e26983c86c6e6a51c85e1bd5c4621f3b43afe99", "html_url": "https://github.com/rust-lang/rust/commit/8e26983c86c6e6a51c85e1bd5c4621f3b43afe99"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "5d6717272fdf3d000fdea7c56f5a14815f081cc1", "filename": "src/librustc_trans/back/symbol_export.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fback%2Fsymbol_export.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fback%2Fsymbol_export.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Fsymbol_export.rs?ref=f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "patch": "@@ -15,6 +15,7 @@ use back::symbol_names::symbol_name;\n use util::nodemap::FxHashMap;\n use rustc::hir::def_id::{DefId, CrateNum, LOCAL_CRATE};\n use rustc::session::config;\n+use rustc::ty::TyCtxt;\n use syntax::attr;\n use trans_item::TransItem;\n \n@@ -72,7 +73,7 @@ impl ExportedSymbols {\n         }\n \n         if scx.sess().crate_types.borrow().contains(&config::CrateTypeDylib) {\n-            local_crate.push((scx.metadata_symbol_name(),\n+            local_crate.push((metadata_symbol_name(scx.tcx()),\n                               SymbolExportLevel::Rust));\n         }\n \n@@ -173,6 +174,12 @@ impl ExportedSymbols {\n     }\n }\n \n+pub fn metadata_symbol_name(tcx: TyCtxt) -> String {\n+    format!(\"rust_metadata_{}_{}\",\n+            tcx.crate_name(LOCAL_CRATE),\n+            tcx.crate_disambiguator(LOCAL_CRATE))\n+}\n+\n pub fn crate_export_threshold(crate_type: config::CrateType)\n                                      -> SymbolExportLevel {\n     match crate_type {"}, {"sha": "b364814d07e80f3d15e135a0cdf6011de72514fd", "filename": "src/librustc_trans/base.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fbase.rs?ref=f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "patch": "@@ -776,7 +776,7 @@ fn write_metadata(cx: &SharedCrateContext,\n \n     let llmeta = C_bytes_in_context(metadata_llcx, &compressed);\n     let llconst = C_struct_in_context(metadata_llcx, &[llmeta], false);\n-    let name = cx.metadata_symbol_name();\n+    let name = symbol_export::metadata_symbol_name(cx.tcx());\n     let buf = CString::new(name).unwrap();\n     let llglobal = unsafe {\n         llvm::LLVMAddGlobal(metadata_llmod, val_ty(llconst).to_ref(), buf.as_ptr())"}, {"sha": "c3770470bfd056536d620c38affa728d11e11aa7", "filename": "src/librustc_trans/context.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f2487b81523a4f39a5ad27a9d28b198e4cc4dfda/src%2Flibrustc_trans%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fcontext.rs?ref=f2487b81523a4f39a5ad27a9d28b198e4cc4dfda", "patch": "@@ -12,7 +12,7 @@ use llvm;\n use llvm::{ContextRef, ModuleRef, ValueRef};\n use rustc::dep_graph::{DepGraph, DepGraphSafe, DepNode, DepTrackingMap, DepTrackingMapConfig};\n use rustc::hir;\n-use rustc::hir::def_id::{DefId, LOCAL_CRATE};\n+use rustc::hir::def_id::DefId;\n use rustc::traits;\n use debuginfo;\n use callee;\n@@ -430,12 +430,6 @@ impl<'b, 'tcx> SharedCrateContext<'b, 'tcx> {\n     pub fn translation_items(&self) -> &RefCell<FxHashSet<TransItem<'tcx>>> {\n         &self.translation_items\n     }\n-\n-    pub fn metadata_symbol_name(&self) -> String {\n-        format!(\"rust_metadata_{}_{}\",\n-                self.tcx().crate_name(LOCAL_CRATE),\n-                self.tcx().crate_disambiguator(LOCAL_CRATE))\n-    }\n }\n \n impl<'tcx> LocalCrateContext<'tcx> {"}]}