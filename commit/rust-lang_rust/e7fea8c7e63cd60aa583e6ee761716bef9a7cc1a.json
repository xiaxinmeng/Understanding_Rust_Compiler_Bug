{"sha": "e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "node_id": "C_kwDOAAsO6NoAKGU3ZmVhOGM3ZTYzY2Q2MGFhNTgzZTZlZTc2MTcxNmJlZjlhN2NjMWE", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-12-21T14:51:02Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2023-01-12T02:28:37Z"}, "message": "gate const closures", "tree": {"sha": "159bb53939c36097dc0b069caed4c242286a026d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/159bb53939c36097dc0b069caed4c242286a026d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "html_url": "https://github.com/rust-lang/rust/commit/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fb10c0ce45673264d5dd428f4d5a4a389a2f1de", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fb10c0ce45673264d5dd428f4d5a4a389a2f1de", "html_url": "https://github.com/rust-lang/rust/commit/4fb10c0ce45673264d5dd428f4d5a4a389a2f1de"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "89ba6f936d14448b32d201026259d1e999fec6b7", "filename": "compiler/rustc_ast_passes/src/feature_gate.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs?ref=e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "patch": "@@ -385,6 +385,14 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n             ast::ExprKind::TryBlock(_) => {\n                 gate_feature_post!(&self, try_blocks, e.span, \"`try` expression is experimental\");\n             }\n+            ast::ExprKind::Closure(box ast::Closure { constness: ast::Const::Yes(_), .. }) => {\n+                gate_feature_post!(\n+                    &self,\n+                    const_closures,\n+                    e.span,\n+                    \"const closures are experimental\"\n+                );\n+            }\n             _ => {}\n         }\n         visit::walk_expr(self, e)"}, {"sha": "d6eda08f6621d74709e103fe77f2655438b43a84", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "patch": "@@ -342,7 +342,9 @@ declare_features! (\n     (active, collapse_debuginfo, \"1.65.0\", Some(100758), None),\n     /// Allows `async {}` expressions in const contexts.\n     (active, const_async_blocks, \"1.53.0\", Some(85368), None),\n-    // Allows limiting the evaluation steps of const expressions\n+    /// Allows `const || {}` closures in const contexts.\n+    (incomplete, const_closures, \"CURRENT_RUSTC_VERSION\", Some(106003), None),\n+    /// Allows limiting the evaluation steps of const expressions\n     (active, const_eval_limit, \"1.43.0\", Some(67217), None),\n     /// Allows the definition of `const extern fn` and `const unsafe extern fn`.\n     (active, const_extern_fn, \"1.40.0\", Some(64926), None),"}, {"sha": "706002f79b1fb98163ff6e2abe678f0fdabe443c", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "patch": "@@ -498,6 +498,7 @@ symbols! {\n         console,\n         const_allocate,\n         const_async_blocks,\n+        const_closures,\n         const_compare_raw_pointers,\n         const_constructor,\n         const_deallocate,"}, {"sha": "89551121ad24ccac97a23b6e6fd7ad37eb669976", "filename": "src/test/ui/rfc-2632-const-trait-impl/const_closures/gate.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.rs?ref=e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    (const || {})();\n+    //~^ ERROR: const closures are experimental\n+}"}, {"sha": "94a7fe9e62c47e03077a2adcf0e476248122207b", "filename": "src/test/ui/rfc-2632-const-trait-impl/const_closures/gate.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst_closures%2Fgate.stderr?ref=e7fea8c7e63cd60aa583e6ee761716bef9a7cc1a", "patch": "@@ -0,0 +1,12 @@\n+error[E0658]: const closures are experimental\n+  --> $DIR/gate.rs:2:6\n+   |\n+LL |     (const || {})();\n+   |      ^^^^^^^^^^^\n+   |\n+   = note: see issue #106003 <https://github.com/rust-lang/rust/issues/106003> for more information\n+   = help: add `#![feature(const_closures)]` to the crate attributes to enable\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0658`."}]}