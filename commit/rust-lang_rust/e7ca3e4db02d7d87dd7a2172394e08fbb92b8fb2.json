{"sha": "e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3Y2EzZTRkYjAyZDdkODdkZDdhMjE3MjM5NGUwOGZiYjkyYjhmYjI=", "commit": {"author": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-04-14T00:33:02Z"}, "committer": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-05-19T17:08:43Z"}, "message": "expose tzset", "tree": {"sha": "85e99c02274bf82a499033fe4448b114ce5d2d85", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85e99c02274bf82a499033fe4448b114ce5d2d85"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "html_url": "https://github.com/rust-lang/rust/commit/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/comments", "author": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "047f629b31e1af929923b54239d83059263d995b", "url": "https://api.github.com/repos/rust-lang/rust/commits/047f629b31e1af929923b54239d83059263d995b", "html_url": "https://github.com/rust-lang/rust/commit/047f629b31e1af929923b54239d83059263d995b"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "2c7902c63e9d9bf2f7d21265d30f76a45b553bce", "filename": "src/libstd/time.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Flibstd%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Flibstd%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftime.rs?ref=e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "patch": "@@ -7,6 +7,7 @@ export\n     get_time,\n     precise_time_ns,\n     precise_time_s,\n+    tzset,\n     tm,\n     empty_tm,\n     now,\n@@ -20,6 +21,7 @@ native mod rustrt {\n     fn get_time(&sec: i64, &nsec: i32);\n     fn precise_time_ns(&ns: u64);\n \n+    fn rust_tzset();\n     // FIXME: The i64 values can be passed by-val when #2064 is fixed.\n     fn rust_gmtime(&&sec: i64, &&nsec: i32, &&result: tm);\n     fn rust_localtime(&&sec: i64, &&nsec: i32, &&result: tm);\n@@ -59,6 +61,10 @@ fn precise_time_s() -> float {\n     ret (precise_time_ns() as float) / 1000000000.;\n }\n \n+fn tzset() {\n+    rustrt::rust_tzset();\n+}\n+\n type tm = {\n     tm_sec: i32, // seconds after the minute [0-60]\n     tm_min: i32, // minutes after the hour [0-59]\n@@ -869,6 +875,7 @@ mod tests {\n     #[test]\n     fn test_at_utc() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -890,10 +897,13 @@ mod tests {\n     #[test]\n     fn test_at() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let local = at(time);\n \n+        #error(\"time_at: %?\", local);\n+\n         assert local.tm_sec == 30_i32;\n         assert local.tm_min == 31_i32;\n         assert local.tm_hour == 15_i32;\n@@ -916,6 +926,7 @@ mod tests {\n     #[test]\n     fn test_to_timespec() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -927,6 +938,7 @@ mod tests {\n     #[test]\n     fn test_conversions() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);\n@@ -943,6 +955,7 @@ mod tests {\n     #[test]\n     fn test_strptime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         alt strptime(\"\", \"\") {\n           ok(tm) {\n@@ -1088,18 +1101,22 @@ mod tests {\n     #[test]\n     fn test_ctime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc   = at_utc(time);\n         let local = at(time);\n \n+        #error(\"test_ctime: %? %?\", utc.ctime(), local.ctime());\n+\n         assert utc.ctime()   == \"Fri Feb 13 23:31:30 2009\";\n         assert local.ctime() == \"Fri Feb 13 15:31:30 2009\";\n     }\n \n     #[test]\n     fn test_strftime() {\n         os::setenv(\"TZ\", \"America/Los_Angeles\");\n+        tzset();\n \n         let time = { sec: 1234567890_i64, nsec: 54321_i32 };\n         let utc = at_utc(time);"}, {"sha": "aa7597f6a26a10be6af7640eea758fa6cc8249e7", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "patch": "@@ -529,6 +529,11 @@ struct tm* LOCALTIME(const time_t *clock, tm *result) {\n #define TIMEGM(result) timegm(result)\n #endif\n \n+extern \"C\" CDECL void\n+rust_tzset() {\n+    TZSET();\n+}\n+\n extern \"C\" CDECL void\n rust_gmtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n     tm tm;\n@@ -541,7 +546,6 @@ rust_gmtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n extern \"C\" CDECL void\n rust_localtime(int64_t *sec, int32_t *nsec, rust_tm *timeptr) {\n     tm tm;\n-    TZSET();\n     time_t s = *sec;\n     LOCALTIME(&s, &tm);\n "}, {"sha": "6cf024a7dee537872e4adcb347466b790d101363", "filename": "src/rt/rustrt.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Frt%2Frustrt.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2/src%2Frt%2Frustrt.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frustrt.def.in?ref=e7ca3e4db02d7d87dd7a2172394e08fbb92b8fb2", "patch": "@@ -12,6 +12,7 @@ debug_abi_2\n get_port_id\n get_task_id\n get_time\n+rust_tzset\n rust_gmtime\n rust_localtime\n rust_timegm"}]}