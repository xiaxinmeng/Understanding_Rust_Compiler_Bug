{"sha": "78ca43ef3df5b015ec615a267cd0777401cf6ad3", "node_id": "C_kwDOAAsO6NoAKDc4Y2E0M2VmM2RmNWIwMTVlYzYxNWEyNjdjZDA3Nzc0MDFjZjZhZDM", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-09T10:51:02Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2021-10-09T10:51:02Z"}, "message": "internal: move test", "tree": {"sha": "3cd07a4a69e26c8937f99aaa07c1afdb91d53c17", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3cd07a4a69e26c8937f99aaa07c1afdb91d53c17"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78ca43ef3df5b015ec615a267cd0777401cf6ad3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78ca43ef3df5b015ec615a267cd0777401cf6ad3", "html_url": "https://github.com/rust-lang/rust/commit/78ca43ef3df5b015ec615a267cd0777401cf6ad3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78ca43ef3df5b015ec615a267cd0777401cf6ad3/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "093f99b809d377274e6626a24124caa741ce07f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/093f99b809d377274e6626a24124caa741ce07f2", "html_url": "https://github.com/rust-lang/rust/commit/093f99b809d377274e6626a24124caa741ce07f2"}], "stats": {"total": 40, "additions": 21, "deletions": 19}, "files": [{"sha": "8ecdbec7aef082f48100db031a7dcb6963ef0db7", "filename": "crates/hir_def/src/macro_expansion_tests.rs", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/78ca43ef3df5b015ec615a267cd0777401cf6ad3/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78ca43ef3df5b015ec615a267cd0777401cf6ad3/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests.rs?ref=78ca43ef3df5b015ec615a267cd0777401cf6ad3", "patch": "@@ -69,7 +69,7 @@ fn check(ra_fixture: &str, expect: Expect) {\n }\n \n #[test]\n-fn test_expand_rule() {\n+fn wrong_nesting_level() {\n     check(\n         r#\"\n macro_rules! m {\n@@ -85,3 +85,23 @@ macro_rules! m {\n \"#]],\n     );\n }\n+\n+#[test]\n+fn expansion_does_not_parse_as_expression() {\n+    check(\n+        r#\"\n+macro_rules! stmts {\n+    () => { let _ = 0; }\n+}\n+\n+fn f() { let _ = stmts!(); }\n+\"#,\n+        expect![[r#\"\n+macro_rules! stmts {\n+    () => { let _ = 0; }\n+}\n+\n+fn f() { let _ = /* error: could not convert tokens */; }\n+\"#]],\n+    )\n+}"}, {"sha": "631eb82de7e25c0cc3c2fb46bdabf187063c70dd", "filename": "crates/mbe/src/syntax_bridge.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/78ca43ef3df5b015ec615a267cd0777401cf6ad3/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78ca43ef3df5b015ec615a267cd0777401cf6ad3/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs?ref=78ca43ef3df5b015ec615a267cd0777401cf6ad3", "patch": "@@ -797,24 +797,6 @@ mod tests {\n         assert_eq!(tokens[2 + 15 + 3].0, STRING);\n     }\n \n-    #[test]\n-    fn stmts_token_trees_to_expr_is_err() {\n-        let expansion = parse_macro(\n-            r#\"\n-            macro_rules! stmts {\n-                () => {\n-                    let a = 0;\n-                    let b = 0;\n-                    let c = 0;\n-                    let d = 0;\n-                }\n-            }\n-            \"#,\n-        )\n-        .expand_tt(\"stmts!();\");\n-        assert!(token_tree_to_syntax_node(&expansion, ParserEntryPoint::Expr).is_err());\n-    }\n-\n     #[test]\n     fn test_token_tree_last_child_is_white_space() {\n         let source_file = ast::SourceFile::parse(\"f!{}\").ok().unwrap();"}]}