{"sha": "2e7ba785b34b040154761d42bdd4a208707e0d29", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlN2JhNzg1YjM0YjA0MDE1NDc2MWQ0MmJkZDRhMjA4NzA3ZTBkMjk=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-08-02T16:31:21Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-08-02T16:34:18Z"}, "message": "Recover strictness for `yield`", "tree": {"sha": "3f6f477e17f873fc927e846eddb836b03ff182a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f6f477e17f873fc927e846eddb836b03ff182a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e7ba785b34b040154761d42bdd4a208707e0d29", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEXmatGLoofN5+9u4rsJhshcDi2qEFAl8m6woACgkQsJhshcDi\n2qG9vg/9FnnsGQMNyC8loRg4fYgRDreohxAjIq4GIHRDwflXe3GgOKYpnul+hX4C\n6VWtZIGOb7VtazHruV0IJIPcgtoL6vHarnqRydLmCSOsmqwcwe2e3jaw2/2KXJbQ\naxj5VA4csbKlPKxShBvyQlfVjPRl4VGrhcCDvFt3nxN0GT+lpx5WLOodzI46zR+X\neBNLn8wPMEgOy4pC6BQSVnPqotMLMCVpHW4abrFe+VdgEctB/vJRkS6cU+pAdSC/\nf56I/gm9Y1bS1LQuC1byxn/jbo7Yh9+k1/QsxSmDau61R2o+ae1+fG8Wqd+2yG9O\nqY1ShlYFJ6NAq7CFCBUg+i6YnjokBE4Ks3XrdzeFSlZgUJSvwWRyUj8WfN1w5J5u\nkp6+CBkvbcTswS6MdLonuZWJeGSE+vVzDc40YCMGrNP9/sau+VH7FX2DVIN97c2w\nXUK3F0GxgZXiuhel3+H/lXEUxItMwHedtfQaXe2CxkVmBQyJUdQDCzibLCYGsW9/\nb+Lpl4baHRVdTxrRRBtlD2hV5yQJVQ/tyBlakaO5QJMuq/KmlJloIx0Mi41ntwRS\nCPBSSZsYMhCxlwzEd5QFGMXfrslSN/Fw4utw/1Hz8pDQLsOxJ1erhsO5CTxOT2Ds\nGdj2uPOIJKFY+ofISp9UROGi14E8rV2pLpHPvam+g355GwEfXxs=\n=bBC6\n-----END PGP SIGNATURE-----", "payload": "tree 3f6f477e17f873fc927e846eddb836b03ff182a3\nparent 86d0b9cbd0242b06a747b14903dfbd4fda911a1d\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1596385881 +0900\ncommitter Yuki Okushi <huyuumi.dev@gmail.com> 1596386058 +0900\n\nRecover strictness for `yield`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7ba785b34b040154761d42bdd4a208707e0d29", "html_url": "https://github.com/rust-lang/rust/commit/2e7ba785b34b040154761d42bdd4a208707e0d29", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e7ba785b34b040154761d42bdd4a208707e0d29/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "86d0b9cbd0242b06a747b14903dfbd4fda911a1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/86d0b9cbd0242b06a747b14903dfbd4fda911a1d", "html_url": "https://github.com/rust-lang/rust/commit/86d0b9cbd0242b06a747b14903dfbd4fda911a1d"}], "stats": {"total": 69, "additions": 60, "deletions": 9}, "files": [{"sha": "a33f920603592691d95881aa371ebc80b2d565f7", "filename": "src/librustc_lint/unused.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Flibrustc_lint%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Flibrustc_lint%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Funused.rs?ref=2e7ba785b34b040154761d42bdd4a208707e0d29", "patch": "@@ -422,10 +422,9 @@ trait UnusedDelimLint {\n         lhs_needs_parens\n             || (followed_by_block\n                 && match inner.kind {\n-                    ExprKind::Ret(_) | ExprKind::Break(..) => true,\n+                    ExprKind::Ret(_) | ExprKind::Break(..) | ExprKind::Yield(..) => true,\n                     _ => parser::contains_exterior_struct_lit(&inner),\n                 })\n-            || if let ExprKind::Yield(..) = inner.kind { true } else { false }\n     }\n \n     fn emit_unused_delims_expr("}, {"sha": "02182ec299321fedb2d0593714b251f624039022", "filename": "src/test/ui/lint/issue-74883-unused-paren-baren-yield.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.rs?ref=2e7ba785b34b040154761d42bdd4a208707e0d29", "patch": "@@ -9,9 +9,25 @@ fn main() {\n     let mut x = |_| {\n         while let Some(_) = (yield) {}\n         while let Some(_) = {yield} {}\n+\n         // Only warn these cases\n         while let Some(_) = ({yield}) {} //~ ERROR: unnecessary parentheses\n-        while let Some(_) = {(yield)} {} //~ ERROR: unnecessary braces\n+        while let Some(_) = ((yield)) {} //~ ERROR: unnecessary parentheses\n+        {{yield}}; //~ ERROR: unnecessary braces\n+        {( yield )}; //~ ERROR: unnecessary parentheses\n+\n+        // FIXME: Reduce duplicate warnings.\n+        // Perhaps we should tweak checks in `BlockRetValue`?\n+        while let Some(_) = {(yield)} {}\n+        //~^ ERROR: unnecessary braces\n+        //~| ERROR: unnecessary parentheses\n+        while let Some(_) = {{yield}} {}\n+        //~^ ERROR: unnecessary braces\n+        //~| ERROR: unnecessary braces\n+\n+        // FIXME: It'd be great if we could also warn them.\n+        ((yield));\n+        ({ yield });\n     };\n     let _ = Pin::new(&mut x).resume(Some(5));\n }"}, {"sha": "267cc9e031a11f96aaa23d4891639e9db47a761e", "filename": "src/test/ui/lint/issue-74883-unused-paren-baren-yield.stderr", "status": "modified", "additions": 42, "deletions": 6, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2e7ba785b34b040154761d42bdd4a208707e0d29/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-74883-unused-paren-baren-yield.stderr?ref=2e7ba785b34b040154761d42bdd4a208707e0d29", "patch": "@@ -1,5 +1,5 @@\n error: unnecessary parentheses around `let` scrutinee expression\n-  --> $DIR/issue-74883-unused-paren-baren-yield.rs:13:29\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:14:29\n    |\n LL |         while let Some(_) = ({yield}) {}\n    |                             ^^^^^^^^^ help: remove these parentheses\n@@ -10,17 +10,53 @@ note: the lint level is defined here\n LL | #![deny(unused_braces, unused_parens)]\n    |                        ^^^^^^^^^^^^^\n \n-error: unnecessary braces around `let` scrutinee expression\n-  --> $DIR/issue-74883-unused-paren-baren-yield.rs:14:29\n+error: unnecessary parentheses around `let` scrutinee expression\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:15:29\n    |\n-LL |         while let Some(_) = {(yield)} {}\n-   |                             ^^^^^^^^^ help: remove these braces\n+LL |         while let Some(_) = ((yield)) {}\n+   |                             ^^^^^^^^^ help: remove these parentheses\n+\n+error: unnecessary braces around block return value\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:16:10\n+   |\n+LL |         {{yield}};\n+   |          ^^^^^^^ help: remove these braces\n    |\n note: the lint level is defined here\n   --> $DIR/issue-74883-unused-paren-baren-yield.rs:3:9\n    |\n LL | #![deny(unused_braces, unused_parens)]\n    |         ^^^^^^^^^^^^^\n \n-error: aborting due to 2 previous errors\n+error: unnecessary parentheses around block return value\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:17:10\n+   |\n+LL |         {( yield )};\n+   |          ^^^^^^^^^ help: remove these parentheses\n+\n+error: unnecessary braces around `let` scrutinee expression\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:21:29\n+   |\n+LL |         while let Some(_) = {(yield)} {}\n+   |                             ^^^^^^^^^ help: remove these braces\n+\n+error: unnecessary parentheses around block return value\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:21:30\n+   |\n+LL |         while let Some(_) = {(yield)} {}\n+   |                              ^^^^^^^ help: remove these parentheses\n+\n+error: unnecessary braces around `let` scrutinee expression\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:24:29\n+   |\n+LL |         while let Some(_) = {{yield}} {}\n+   |                             ^^^^^^^^^ help: remove these braces\n+\n+error: unnecessary braces around block return value\n+  --> $DIR/issue-74883-unused-paren-baren-yield.rs:24:30\n+   |\n+LL |         while let Some(_) = {{yield}} {}\n+   |                              ^^^^^^^ help: remove these braces\n+\n+error: aborting due to 8 previous errors\n "}]}