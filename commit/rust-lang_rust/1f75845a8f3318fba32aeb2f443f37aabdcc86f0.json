{"sha": "1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "node_id": "C_kwDOAAsO6NoAKDFmNzU4NDVhOGYzMzE4ZmJhMzJhZWIyZjQ0M2YzN2FhYmRjYzg2ZjA", "commit": {"author": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2022-08-21T08:29:07Z"}, "committer": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2022-08-21T08:29:26Z"}, "message": "Reduce indentation and add comment about lint name", "tree": {"sha": "ce805629f29f4fdf0e99272e612d95ebfb19115e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce805629f29f4fdf0e99272e612d95ebfb19115e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmMB7OYACgkQHKDfKvWd\naKU+ZhAAocqkTBH7bSHgVDJk92OqEPTjlAFCBy3ceLbXj/fDYL9AWua7b5bAHjMG\nVyens7OlXwzNd06EnV5Chic587t8afodRg+fcG7lAUEKYcSh+VA6JPp6BmxY9+0i\nLDZHAne/ljt6NozD2GPBgHRwRRfD+xE2S+1B5btIVxzAy6kz/9PxZRxp1uuMDUyk\nb/LIxHaL0uAuE2smG9Bk3GU9htDvnhj6lNqkTt70zBroyytcYp+6o1QwANonfxkI\nWE2dJbcriOoAE0WmlJ5bCrj1RUB/I7/tHxdgy3CbV5Dqad9hWiFj2rVtHU5vaSyx\nBnUfrvTMu38C7l7GcXCDLYYwecAET2oP+n7r6PPgj3HMzt2kVCKaUvLsbm5pjKPA\nxbIhQ8YNQdQlL6WKSqLuJOk5zCjpY1Mc0pJ44YlT+4DgR8T9bwkDufpg7SCnwEbi\nfqhGrCXFaybEDiJfW4wgOWHWqSCutDVWMo4hTLzuHbZ4s0qVHUlGg1baWIza0kYt\nWiqvSgr3Ou66YbcpZeebRUD9T5/XiGW6ZhnrOjwzj5JidQw9Zqx3PfYhm+LegMLk\nA6LIo1TH6EkOM28gF/o0FOQGSoslJ/JQsjwuOcWFnSu4ybn0hKn2H7pEQceWbxUR\nYPHtkJX28ZUy7LcGBUM9phPuZ4lahsJ5BdzbfULDDVYZIQsgd7c=\n=jRVU\n-----END PGP SIGNATURE-----", "payload": "tree ce805629f29f4fdf0e99272e612d95ebfb19115e\nparent ffe71251638d8f1c19de61905ff56a423132a692\nauthor Philipp Krones <hello@philkrones.com> 1661070547 +0200\ncommitter Philipp Krones <hello@philkrones.com> 1661070566 +0200\n\nReduce indentation and add comment about lint name\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "html_url": "https://github.com/rust-lang/rust/commit/1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1f75845a8f3318fba32aeb2f443f37aabdcc86f0/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ffe71251638d8f1c19de61905ff56a423132a692", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffe71251638d8f1c19de61905ff56a423132a692", "html_url": "https://github.com/rust-lang/rust/commit/ffe71251638d8f1c19de61905ff56a423132a692"}], "stats": {"total": 49, "additions": 26, "deletions": 23}, "files": [{"sha": "9602d0d1d2ea1a725963b38f8762a4744c2c4328", "filename": "clippy_lints/src/option_if_let_else.rs", "status": "modified", "additions": 21, "deletions": 18, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/1f75845a8f3318fba32aeb2f443f37aabdcc86f0/clippy_lints%2Fsrc%2Foption_if_let_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1f75845a8f3318fba32aeb2f443f37aabdcc86f0/clippy_lints%2Fsrc%2Foption_if_let_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Foption_if_let_else.rs?ref=1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "patch": "@@ -64,6 +64,8 @@ declare_clippy_lint! {\n     ///     y*y\n     /// }, |foo| foo);\n     /// ```\n+    // FIXME: Before moving this lint out of nursery, the lint name needs to be updated. It now also\n+    // covers matches and `Result`.\n     #[clippy::version = \"1.47.0\"]\n     pub OPTION_IF_LET_ELSE,\n     nursery,\n@@ -235,24 +237,25 @@ fn is_none_or_err_arm(cx: &LateContext<'_>, arm: &Arm<'_>) -> bool {\n \n impl<'tcx> LateLintPass<'tcx> for OptionIfLetElse {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &Expr<'tcx>) {\n-        // Don't lint macros, because it behaves weirdly\n-        // and don't lint constant as well\n-        if !expr.span.from_expansion() && !in_constant(cx, expr.hir_id) {\n-            let detection = detect_option_if_let_else(cx, expr).or_else(|| detect_option_match(cx, expr));\n-            if let Some(det) = detection {\n-                span_lint_and_sugg(\n-                    cx,\n-                    OPTION_IF_LET_ELSE,\n-                    expr.span,\n-                    format!(\"use Option::{} instead of an if let/else\", det.method_sugg).as_str(),\n-                    \"try\",\n-                    format!(\n-                        \"{}.{}({}, {})\",\n-                        det.option, det.method_sugg, det.none_expr, det.some_expr\n-                    ),\n-                    Applicability::MaybeIncorrect,\n-                );\n-            }\n+        // Don't lint macros and constants\n+        if expr.span.from_expansion() || in_constant(cx, expr.hir_id) {\n+            return;\n+        }\n+\n+        let detection = detect_option_if_let_else(cx, expr).or_else(|| detect_option_match(cx, expr));\n+        if let Some(det) = detection {\n+            span_lint_and_sugg(\n+                cx,\n+                OPTION_IF_LET_ELSE,\n+                expr.span,\n+                format!(\"use Option::{} instead of an if let/else\", det.method_sugg).as_str(),\n+                \"try\",\n+                format!(\n+                    \"{}.{}({}, {})\",\n+                    det.option, det.method_sugg, det.none_expr, det.some_expr\n+                ),\n+                Applicability::MaybeIncorrect,\n+            );\n         }\n     }\n }"}, {"sha": "a5dbf6e1f2218020a7439059f9a59f5dba493fde", "filename": "tests/ui/option_if_let_else.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1f75845a8f3318fba32aeb2f443f37aabdcc86f0/tests%2Fui%2Foption_if_let_else.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1f75845a8f3318fba32aeb2f443f37aabdcc86f0/tests%2Fui%2Foption_if_let_else.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Foption_if_let_else.stderr?ref=1f75845a8f3318fba32aeb2f443f37aabdcc86f0", "patch": "@@ -207,7 +207,7 @@ LL ~     });\n    |\n \n error: use Option::map_or instead of an if let/else\n-  --> $DIR/option_if_let_else.rs:212:13\n+  --> $DIR/option_if_let_else.rs:213:13\n    |\n LL |       let _ = match s {\n    |  _____________^\n@@ -217,7 +217,7 @@ LL | |     };\n    | |_____^ help: try: `s.map_or(1, |string| string.len())`\n \n error: use Option::map_or instead of an if let/else\n-  --> $DIR/option_if_let_else.rs:216:13\n+  --> $DIR/option_if_let_else.rs:217:13\n    |\n LL |       let _ = match Some(10) {\n    |  _____________^\n@@ -227,7 +227,7 @@ LL | |     };\n    | |_____^ help: try: `Some(10).map_or(5, |a| a + 1)`\n \n error: use Option::map_or instead of an if let/else\n-  --> $DIR/option_if_let_else.rs:222:13\n+  --> $DIR/option_if_let_else.rs:223:13\n    |\n LL |       let _ = match res {\n    |  _____________^\n@@ -237,7 +237,7 @@ LL | |     };\n    | |_____^ help: try: `res.map_or(1, |a| a + 1)`\n \n error: use Option::map_or instead of an if let/else\n-  --> $DIR/option_if_let_else.rs:226:13\n+  --> $DIR/option_if_let_else.rs:227:13\n    |\n LL |       let _ = match res {\n    |  _____________^\n@@ -247,7 +247,7 @@ LL | |     };\n    | |_____^ help: try: `res.map_or(1, |a| a + 1)`\n \n error: use Option::map_or instead of an if let/else\n-  --> $DIR/option_if_let_else.rs:230:13\n+  --> $DIR/option_if_let_else.rs:231:13\n    |\n LL |     let _ = if let Ok(a) = res { a + 1 } else { 5 };\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `res.map_or(5, |a| a + 1)`"}]}