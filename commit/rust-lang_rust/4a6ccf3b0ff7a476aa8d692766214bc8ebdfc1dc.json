{"sha": "4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRhNmNjZjNiMGZmN2E0NzZhYThkNjkyNzY2MjE0YmM4ZWJkZmMxZGM=", "commit": {"author": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-07-22T23:22:20Z"}, "committer": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-07-22T23:22:20Z"}, "message": "Adding test case for #687.\n\nThe test no longer repros after a lot of my recent channel work.\n\nCloses #687.", "tree": {"sha": "e002b4be5b3199c4cb00e87375f08a566c81a18e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e002b4be5b3199c4cb00e87375f08a566c81a18e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc", "html_url": "https://github.com/rust-lang/rust/commit/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc/comments", "author": null, "committer": null, "parents": [{"sha": "54be5b044f71ca9e191b26b2e65ff6541f377358", "url": "https://api.github.com/repos/rust-lang/rust/commits/54be5b044f71ca9e191b26b2e65ff6541f377358", "html_url": "https://github.com/rust-lang/rust/commit/54be5b044f71ca9e191b26b2e65ff6541f377358"}], "stats": {"total": 62, "additions": 62, "deletions": 0}, "files": [{"sha": "aee3495b866694be6f175e7439ec26bea65874df", "filename": "src/test/run-pass/issue-687.rs", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc/src%2Ftest%2Frun-pass%2Fissue-687.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc/src%2Ftest%2Frun-pass%2Fissue-687.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-687.rs?ref=4a6ccf3b0ff7a476aa8d692766214bc8ebdfc1dc", "patch": "@@ -0,0 +1,62 @@\n+// xfail-stage0\n+\n+use std;\n+import std::ivec;\n+\n+tag msg {\n+    closed;\n+    received(u8[]);\n+}\n+\n+fn producer(chan[u8[]] c) {\n+    c <| ~[1u8, 2u8, 3u8, 4u8];\n+    let u8[] empty = ~[];\n+    c <| empty;\n+}\n+\n+fn packager(chan[chan[u8[]]] cb, chan[msg] msg) {\n+    let port[u8[]] p = port();\n+    cb <| chan(p);\n+    while (true) {\n+        log \"waiting for bytes\";\n+        let u8[] data;\n+        p |> data;\n+        log \"got bytes\";\n+        if (ivec::len[u8](data) == 0u) {\n+            log \"got empty bytes, quitting\";\n+            break;\n+        }\n+        log \"sending non-empty buffer of length\";\n+        log ivec::len[u8](data);\n+        msg <| received(data);\n+        log \"sent non-empty buffer\";\n+    }\n+    log \"sending closed message\";\n+    msg <| closed;\n+    log \"sent closed message\";\n+}\n+\n+fn main() {\n+    let port[msg] p = port();\n+    let port[chan[u8[]]] recv_reader = port();\n+    auto pack = spawn packager(chan(recv_reader), chan(p));\n+\n+    let chan[u8[]] source_chan;\n+    recv_reader |> source_chan;\n+    let task prod = spawn producer(source_chan);\n+\n+    while (true) {\n+        let msg msg;\n+        p |> msg;\n+        alt (msg) {\n+            case (closed) {\n+                log \"Got close message\";\n+                break;\n+            }\n+            case (received(?data)) {\n+                log \"Got data. Length is:\";\n+                log ivec::len[u8](data);\n+            }\n+        }\n+    }\n+}"}]}