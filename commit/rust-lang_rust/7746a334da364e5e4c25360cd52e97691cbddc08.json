{"sha": "7746a334da364e5e4c25360cd52e97691cbddc08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3NDZhMzM0ZGEzNjRlNWU0YzI1MzYwY2Q1MmU5NzY5MWNiZGRjMDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-28T23:21:53Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-28T23:21:53Z"}, "message": "Auto merge of #33825 - alexcrichton:fix-beta, r=aturon\n\nmk: Fix bootstrapping cross-hosts on beta\n\nThe beta builds are currently failing, unfortunately, due to what is presumably\nsome odd behavior with our makefiles. The wrong bootstrap key is being used to\ngenerate the stage1 cross-compiled libraries, which fails the build.\nInterestingly enough if the targets are directly specified as part of the build\nthen it works just fine! Just a bare `make` fails...\n\nInstead of trying to understand what's happening in the makefiles instead just\ntweak how we configure the bootstrap key in a way that's more likely to work.", "tree": {"sha": "c4da2fef705e4f95344c8a9afee80bc66a4f4080", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4da2fef705e4f95344c8a9afee80bc66a4f4080"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7746a334da364e5e4c25360cd52e97691cbddc08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7746a334da364e5e4c25360cd52e97691cbddc08", "html_url": "https://github.com/rust-lang/rust/commit/7746a334da364e5e4c25360cd52e97691cbddc08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7746a334da364e5e4c25360cd52e97691cbddc08/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90d9a515af7b80ab99d77cf8b3fa29d0272e2b3c", "url": "https://api.github.com/repos/rust-lang/rust/commits/90d9a515af7b80ab99d77cf8b3fa29d0272e2b3c", "html_url": "https://github.com/rust-lang/rust/commit/90d9a515af7b80ab99d77cf8b3fa29d0272e2b3c"}, {"sha": "a2434eb950bee72f8c7e5186fad657852cbf14bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/a2434eb950bee72f8c7e5186fad657852cbf14bf", "html_url": "https://github.com/rust-lang/rust/commit/a2434eb950bee72f8c7e5186fad657852cbf14bf"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "2a08b7b0465343e39ed0dd753bdbc7a1cde02b07", "filename": "mk/target.mk", "status": "modified", "additions": 20, "deletions": 9, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/7746a334da364e5e4c25360cd52e97691cbddc08/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7746a334da364e5e4c25360cd52e97691cbddc08/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=7746a334da364e5e4c25360cd52e97691cbddc08", "patch": "@@ -42,6 +42,23 @@ $(foreach host,$(CFG_HOST), \\\n    $(foreach crate,$(CRATES), \\\n     $(eval $(call RUST_CRATE_FULLDEPS,$(stage),$(target),$(host),$(crate)))))))\n \n+# $(1) stage\n+# $(2) target\n+# $(3) host\n+define DEFINE_BOOTSTRAP_KEY\n+BOOTSTRAP_KEY$(1)_T_$(2)_H_$(3) := $$(CFG_BOOTSTRAP_KEY)\n+ifeq ($(1),0)\n+ifeq ($(3),$$(CFG_BUILD))\n+BOOTSTRAP_KEY$(1)_T_$(2)_H_$(3) := $$(CFG_BOOTSTRAP_KEY_STAGE0)\n+endif\n+endif\n+endef\n+\n+$(foreach host,$(CFG_TARGET), \\\n+ $(foreach target,$(CFG_TARGET), \\\n+  $(foreach stage,$(STAGES), \\\n+   $(eval $(call DEFINE_BOOTSTRAP_KEY,$(stage),$(target),$(host))))))\n+\n # RUST_TARGET_STAGE_N template: This defines how target artifacts are built\n # for all stage/target architecture combinations. This is one giant rule which\n # works as follows:\n@@ -65,12 +82,9 @@ $(foreach host,$(CFG_HOST), \\\n # $(4) is the crate name\n define RUST_TARGET_STAGE_N\n \n-ifeq ($(1),0)\n-$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): \\\n-\texport RUSTC_BOOTSTRAP_KEY := $$(CFG_BOOTSTRAP_KEY_STAGE0)\n-endif\n-\n $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): CFG_COMPILER_HOST_TRIPLE = $(2)\n+$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): \\\n+\texport RUSTC_BOOTSTRAP_KEY := $$(BOOTSTRAP_KEY$(1)_T_$(2)_H_$(3))\n $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$(4): \\\n \t\t$$(CRATEFILE_$(4)) \\\n \t\t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4)) \\\n@@ -118,11 +132,8 @@ endef\n # $(4) - name of the tool being built\n define TARGET_TOOL\n \n-ifeq ($(1),0)\n $$(TBIN$(1)_T_$(2)_H_$(3))/$(4)$$(X_$(2)): \\\n-\texport RUSTC_BOOTSTRAP_KEY := $$(CFG_BOOTSTRAP_KEY_STAGE0)\n-endif\n-\n+\texport RUSTC_BOOTSTRAP_KEY := $$(BOOTSTRAP_KEY$(1)_T_$(2)_H_$(3))\n $$(TBIN$(1)_T_$(2)_H_$(3))/$(4)$$(X_$(2)): \\\n \t\t$$(TOOL_SOURCE_$(4)) \\\n \t\t$$(TOOL_INPUTS_$(4)) \\"}]}