{"sha": "a69af9daa3e9b3f61ce83d904b0b27022d759869", "node_id": "C_kwDOAAsO6NoAKGE2OWFmOWRhYTNlOWIzZjYxY2U4M2Q5MDRiMGIyNzAyMmQ3NTk4Njk", "commit": {"author": {"name": "Jake Heinz", "email": "jh@discordapp.com", "date": "2021-11-27T11:49:51Z"}, "committer": {"name": "Jake Heinz", "email": "jh@discordapp.com", "date": "2021-11-27T11:49:51Z"}, "message": "sema parse_or_expand", "tree": {"sha": "9ccc691519bd3bbf9599d833c2b07a77f2b24b1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9ccc691519bd3bbf9599d833c2b07a77f2b24b1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a69af9daa3e9b3f61ce83d904b0b27022d759869", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a69af9daa3e9b3f61ce83d904b0b27022d759869", "html_url": "https://github.com/rust-lang/rust/commit/a69af9daa3e9b3f61ce83d904b0b27022d759869", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a69af9daa3e9b3f61ce83d904b0b27022d759869/comments", "author": {"login": "jhgg", "id": 5489149, "node_id": "MDQ6VXNlcjU0ODkxNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/5489149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhgg", "html_url": "https://github.com/jhgg", "followers_url": "https://api.github.com/users/jhgg/followers", "following_url": "https://api.github.com/users/jhgg/following{/other_user}", "gists_url": "https://api.github.com/users/jhgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhgg/subscriptions", "organizations_url": "https://api.github.com/users/jhgg/orgs", "repos_url": "https://api.github.com/users/jhgg/repos", "events_url": "https://api.github.com/users/jhgg/events{/privacy}", "received_events_url": "https://api.github.com/users/jhgg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhgg", "id": 5489149, "node_id": "MDQ6VXNlcjU0ODkxNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/5489149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhgg", "html_url": "https://github.com/jhgg", "followers_url": "https://api.github.com/users/jhgg/followers", "following_url": "https://api.github.com/users/jhgg/following{/other_user}", "gists_url": "https://api.github.com/users/jhgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhgg/subscriptions", "organizations_url": "https://api.github.com/users/jhgg/orgs", "repos_url": "https://api.github.com/users/jhgg/repos", "events_url": "https://api.github.com/users/jhgg/events{/privacy}", "received_events_url": "https://api.github.com/users/jhgg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0447be7589445826a859ee6aa117e70c0bb179ef", "url": "https://api.github.com/repos/rust-lang/rust/commits/0447be7589445826a859ee6aa117e70c0bb179ef", "html_url": "https://github.com/rust-lang/rust/commit/0447be7589445826a859ee6aa117e70c0bb179ef"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "27ba42ce1afcde6399a28bc65037a6e1c89e13d0", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a69af9daa3e9b3f61ce83d904b0b27022d759869/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a69af9daa3e9b3f61ce83d904b0b27022d759869/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=a69af9daa3e9b3f61ce83d904b0b27022d759869", "patch": "@@ -143,6 +143,10 @@ impl<'db, DB: HirDatabase> Semantics<'db, DB> {\n         self.imp.parse(file_id)\n     }\n \n+    pub fn parse_or_expand(&self, file_id: HirFileId) -> Option<SyntaxNode> {\n+        self.imp.parse_or_expand(file_id)\n+    }\n+\n     pub fn expand(&self, macro_call: &ast::MacroCall) -> Option<SyntaxNode> {\n         self.imp.expand(macro_call)\n     }\n@@ -416,6 +420,12 @@ impl<'db> SemanticsImpl<'db> {\n         tree\n     }\n \n+    fn parse_or_expand(&self, file_id: HirFileId) -> Option<SyntaxNode> {\n+        let node = self.db.parse_or_expand(file_id)?;\n+        self.cache(node.clone(), file_id);\n+        Some(node)\n+    }\n+\n     fn expand(&self, macro_call: &ast::MacroCall) -> Option<SyntaxNode> {\n         let sa = self.analyze(macro_call.syntax());\n         let file_id = sa.expand(self.db, InFile::new(sa.file_id, macro_call))?;"}, {"sha": "788cfdc03950c4f5766017246aa21db8bc8117d1", "filename": "crates/ide_db/src/items_locator.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a69af9daa3e9b3f61ce83d904b0b27022d759869/crates%2Fide_db%2Fsrc%2Fitems_locator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a69af9daa3e9b3f61ce83d904b0b27022d759869/crates%2Fide_db%2Fsrc%2Fitems_locator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fitems_locator.rs?ref=a69af9daa3e9b3f61ce83d904b0b27022d759869", "patch": "@@ -4,7 +4,6 @@\n //! are located in different caches, with different APIs.\n use either::Either;\n use hir::{\n-    db::AstDatabase,\n     import_map::{self, ImportKind},\n     AsAssocItem, Crate, ItemInNs, Semantics,\n };\n@@ -136,7 +135,7 @@ fn get_name_definition(\n     let _p = profile::span(\"get_name_definition\");\n     let file_id = import_candidate.file_id;\n \n-    let candidate_node = import_candidate.ptr.to_node(&sema.db.parse_or_expand(file_id)?);\n+    let candidate_node = import_candidate.ptr.to_node(&sema.parse_or_expand(file_id)?);\n     let candidate_name_node = if candidate_node.kind() != NAME {\n         candidate_node.children().find(|it| it.kind() == NAME)?\n     } else {"}]}