{"sha": "6aff4c67f607a38bc4d95e132fe40563e7422beb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZhZmY0YzY3ZjYwN2EzOGJjNGQ5NWUxMzJmZTQwNTYzZTc0MjJiZWI=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-08-12T06:06:06Z"}, "committer": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2013-08-26T13:15:32Z"}, "message": "std: Bind write() on Win64", "tree": {"sha": "ab9556b66bd068fd39483905811a6ffe33d24f5f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab9556b66bd068fd39483905811a6ffe33d24f5f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6aff4c67f607a38bc4d95e132fe40563e7422beb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6aff4c67f607a38bc4d95e132fe40563e7422beb", "html_url": "https://github.com/rust-lang/rust/commit/6aff4c67f607a38bc4d95e132fe40563e7422beb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6aff4c67f607a38bc4d95e132fe40563e7422beb/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37e99ae4cd510a92e3306d4938200124c2451c23", "url": "https://api.github.com/repos/rust-lang/rust/commits/37e99ae4cd510a92e3306d4938200124c2451c23", "html_url": "https://github.com/rust-lang/rust/commit/37e99ae4cd510a92e3306d4938200124c2451c23"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "e3f88033bd06bc74296c46e91e9d7b9d97a571ee", "filename": "src/libstd/io.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/6aff4c67f607a38bc4d95e132fe40563e7422beb/src%2Flibstd%2Fio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6aff4c67f607a38bc4d95e132fe40563e7422beb/src%2Flibstd%2Fio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio.rs?ref=6aff4c67f607a38bc4d95e132fe40563e7422beb", "patch": "@@ -53,7 +53,7 @@ use container::Container;\n use int;\n use iterator::Iterator;\n use libc::consts::os::posix88::*;\n-use libc::{c_int, c_long, c_void, size_t, ssize_t};\n+use libc::{c_int, c_void, size_t};\n use libc;\n use num;\n use ops::Drop;\n@@ -970,7 +970,7 @@ impl Reader for *libc::FILE {\n \n         unsafe {\n             assert!(libc::fseek(*self,\n-                                     offset as c_long,\n+                                     offset as libc::c_long,\n                                      convert_whence(whence)) == 0 as c_int);\n         }\n     }\n@@ -1199,7 +1199,7 @@ impl Writer for *libc::FILE {\n \n         unsafe {\n             assert!(libc::fseek(*self,\n-                                     offset as c_long,\n+                                     offset as libc::c_long,\n                                      convert_whence(whence)) == 0 as c_int);\n         }\n     }\n@@ -1240,13 +1240,23 @@ impl Writer for fd_t {\n     fn write(&self, v: &[u8]) {\n         #[fixed_stack_segment]; #[inline(never)];\n \n+        #[cfg(windows)]\n+        type IoSize = libc::c_uint;\n+        #[cfg(windows)]\n+        type IoRet = c_int;\n+\n+        #[cfg(unix)]\n+        type IoSize = size_t;\n+        #[cfg(unix)]\n+        type IoRet = libc::ssize_t;\n+\n         unsafe {\n             let mut count = 0u;\n             do v.as_imm_buf |vbuf, len| {\n                 while count < len {\n                     let vb = ptr::offset(vbuf, count as int) as *c_void;\n-                    let nout = libc::write(*self, vb, len as size_t);\n-                    if nout < 0 as ssize_t {\n+                    let nout = libc::write(*self, vb, len as IoSize);\n+                    if nout < 0 as IoRet {\n                         error!(\"error writing buffer\");\n                         error!(\"%s\", os::last_os_error());\n                         fail!();"}]}