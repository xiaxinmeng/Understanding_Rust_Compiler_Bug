{"sha": "bc395bc71e02a7726565725ce026758f948b2d76", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjMzk1YmM3MWUwMmE3NzI2NTY1NzI1Y2UwMjY3NThmOTQ4YjJkNzY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-07T09:51:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-07T09:51:39Z"}, "message": "auto merge of #11329 : fhahn/rust/unused-cast-lint2, r=alexcrichton\n\nUpdates as mentioned in #11135", "tree": {"sha": "86576b45e6b489f635fdca29bc4687c7ebd3be96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86576b45e6b489f635fdca29bc4687c7ebd3be96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc395bc71e02a7726565725ce026758f948b2d76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc395bc71e02a7726565725ce026758f948b2d76", "html_url": "https://github.com/rust-lang/rust/commit/bc395bc71e02a7726565725ce026758f948b2d76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc395bc71e02a7726565725ce026758f948b2d76/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "777f1e8d24a5816a7ca1308ef4243201a6b81221", "url": "https://api.github.com/repos/rust-lang/rust/commits/777f1e8d24a5816a7ca1308ef4243201a6b81221", "html_url": "https://github.com/rust-lang/rust/commit/777f1e8d24a5816a7ca1308ef4243201a6b81221"}, {"sha": "82365501043735dd8ec5eadaa5d30354cee19252", "url": "https://api.github.com/repos/rust-lang/rust/commits/82365501043735dd8ec5eadaa5d30354cee19252", "html_url": "https://github.com/rust-lang/rust/commit/82365501043735dd8ec5eadaa5d30354cee19252"}], "stats": {"total": 119, "additions": 93, "deletions": 26}, "files": [{"sha": "9f40507826fdec9ee107cf40f16b38031cd6198b", "filename": "src/libextra/bitv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Fbitv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Fbitv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Fbitv.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -80,7 +80,7 @@ impl SmallBitv {\n             self.bits |= 1<<i;\n         }\n         else {\n-            self.bits &= !(1<<i as uint);\n+            self.bits &= !(1<<i);\n         }\n     }\n "}, {"sha": "fd5e95d8c239a071e2a299eb4e330ea0875ef837", "filename": "src/libextra/ebml.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Febml.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Febml.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Febml.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -647,7 +647,7 @@ pub mod writer {\n             let cur_pos = self.writer.tell();\n             self.writer.seek(last_size_pos as i64, io::SeekSet);\n             let size = (cur_pos as uint - last_size_pos - 4);\n-            write_sized_vuint(self.writer, size as uint, 4u);\n+            write_sized_vuint(self.writer, size, 4u);\n             self.writer.seek(cur_pos as i64, io::SeekSet);\n \n             debug!(\"End tag (size = {})\", size);"}, {"sha": "c592290ee16d0e493793d71dab4974a48dc5e89b", "filename": "src/libextra/test.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Ftest.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -929,8 +929,8 @@ fn calc_result(desc: &TestDesc, task_succeeded: bool) -> TestResult {\n impl ToJson for Metric {\n     fn to_json(&self) -> json::Json {\n         let mut map = ~TreeMap::new();\n-        map.insert(~\"value\", json::Number(self.value as f64));\n-        map.insert(~\"noise\", json::Number(self.noise as f64));\n+        map.insert(~\"value\", json::Number(self.value));\n+        map.insert(~\"noise\", json::Number(self.noise));\n         json::Object(map)\n     }\n }\n@@ -1132,15 +1132,15 @@ impl BenchHarness {\n             let loop_start = precise_time_ns();\n \n             for p in samples.mut_iter() {\n-                self.bench_n(n as u64, |x| f(x));\n+                self.bench_n(n, |x| f(x));\n                 *p = self.ns_per_iter() as f64;\n             };\n \n             stats::winsorize(samples, 5.0);\n             let summ = stats::Summary::new(samples);\n \n             for p in samples.mut_iter() {\n-                self.bench_n(5 * n as u64, |x| f(x));\n+                self.bench_n(5 * n, |x| f(x));\n                 *p = self.ns_per_iter() as f64;\n             };\n "}, {"sha": "c2948024e28010134beb1bdb49fb2566ab8e52f2", "filename": "src/libextra/time.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibextra%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Ftime.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -767,13 +767,13 @@ pub fn strptime(s: &str, format: &str) -> Result<Tm, ~str> {\n \n         let mut buf = [0];\n         let c = match rdr.read(buf) {\n-            Some(..) => buf[0] as u8 as char,\n+            Some(..) => buf[0] as char,\n             None => break\n         };\n         match c {\n             '%' => {\n                 let ch = match rdr.read(buf) {\n-                    Some(..) => buf[0] as u8 as char,\n+                    Some(..) => buf[0] as char,\n                     None => break\n                 };\n                 match parse_type(s, pos, ch, &mut tm) {"}, {"sha": "7d8e8f7d6f3386cc3a354e00717e25a84e6d4bb0", "filename": "src/librustc/middle/lint.rs", "status": "modified", "additions": 44, "deletions": 1, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibrustc%2Fmiddle%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibrustc%2Fmiddle%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Flint.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -41,6 +41,10 @@ use middle::typeck;\n use middle::pat_util;\n use metadata::csearch;\n use util::ppaux::{ty_to_str};\n+use std::to_str::ToStr;\n+\n+use middle::typeck::infer;\n+use middle::typeck::astconv::{ast_ty_to_ty, AstConv};\n \n use std::cmp;\n use std::hashmap::HashMap;\n@@ -91,6 +95,7 @@ pub enum lint {\n     unused_mut,\n     unnecessary_allocation,\n     dead_code,\n+    unnecessary_typecast,\n \n     missing_doc,\n     unreachable_code,\n@@ -267,6 +272,13 @@ static lint_table: &'static [(&'static str, LintSpec)] = &[\n         default: warn\n     }),\n \n+    (\"unnecessary_typecast\",\n+     LintSpec {\n+        lint: unnecessary_typecast,\n+        desc: \"detects unnecessary type casts, that can be removed\",\n+        default: allow,\n+    }),\n+\n     (\"unused_mut\",\n      LintSpec {\n         lint: unused_mut,\n@@ -336,7 +348,6 @@ static lint_table: &'static [(&'static str, LintSpec)] = &[\n         desc: \"unknown features found in crate-level #[feature] directives\",\n         default: deny,\n     }),\n-\n      (\"unknown_crate_type\",\n      LintSpec {\n          lint: unknown_crate_type,\n@@ -569,6 +580,37 @@ fn check_while_true_expr(cx: &Context, e: &ast::Expr) {\n         _ => ()\n     }\n }\n+impl<'a> AstConv for Context<'a>{\n+    fn tcx(&self) -> ty::ctxt { self.tcx }\n+\n+    fn get_item_ty(&self, id: ast::DefId) -> ty::ty_param_bounds_and_ty {\n+        ty::lookup_item_type(self.tcx, id)\n+    }\n+\n+    fn get_trait_def(&self, id: ast::DefId) -> @ty::TraitDef {\n+        ty::lookup_trait_def(self.tcx, id)\n+    }\n+\n+    fn ty_infer(&self, _span: Span) -> ty::t {\n+        let infcx: @infer::InferCtxt = infer::new_infer_ctxt(self.tcx);\n+        infcx.next_ty_var()\n+    }\n+}\n+\n+\n+fn check_unused_casts(cx: &Context, e: &ast::Expr) {\n+    return match e.node {\n+        ast::ExprCast(expr, ty) => {\n+            let infcx: @infer::InferCtxt = infer::new_infer_ctxt(cx.tcx);\n+            let t_t = ast_ty_to_ty(cx, &infcx, ty);\n+            if  ty::get(ty::expr_ty(cx.tcx, expr)).sty == ty::get(t_t).sty {\n+                cx.span_lint(unnecessary_typecast, ty.span,\n+                             \"unnecessary type cast\");\n+            }\n+        }\n+        _ => ()\n+    };\n+}\n \n fn check_type_limits(cx: &Context, e: &ast::Expr) {\n     return match e.node {\n@@ -1361,6 +1403,7 @@ impl<'a> Visitor<()> for Context<'a> {\n         check_heap_expr(self, e);\n \n         check_type_limits(self, e);\n+        check_unused_casts(self, e);\n \n         visit::walk_expr(self, e, ());\n     }"}, {"sha": "fd9040423a3d9517e73422262798c9980ae8314d", "filename": "src/libstd/cleanup.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fcleanup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fcleanup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fcleanup.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -42,7 +42,7 @@ unsafe fn each_live_alloc(read_next_before: bool,\n         let next_before = (*alloc).next;\n         let uniq = (*alloc).ref_count == managed::RC_MANAGED_UNIQUE;\n \n-        if !f(alloc as *mut raw::Box<()>, uniq) {\n+        if !f(alloc, uniq) {\n             return false;\n         }\n "}, {"sha": "823ca80a8a17608ee6a7e80edec5af7cdcea8cfd", "filename": "src/libstd/io/mod.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fmod.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -725,7 +725,7 @@ pub trait Reader {\n     ///\n     /// `u64`s are 8 bytes long.\n     fn read_be_u64(&mut self) -> u64 {\n-        self.read_be_uint_n(8) as u64\n+        self.read_be_uint_n(8)\n     }\n \n     /// Reads a big-endian `u32`.\n@@ -746,7 +746,7 @@ pub trait Reader {\n     ///\n     /// `i64`s are 8 bytes long.\n     fn read_be_i64(&mut self) -> i64 {\n-        self.read_be_int_n(8) as i64\n+        self.read_be_int_n(8)\n     }\n \n     /// Reads a big-endian `i32`.\n@@ -785,7 +785,7 @@ pub trait Reader {\n     ///\n     /// `u64`s are 8 bytes long.\n     fn read_le_u64(&mut self) -> u64 {\n-        self.read_le_uint_n(8) as u64\n+        self.read_le_uint_n(8)\n     }\n \n     /// Reads a little-endian `u32`.\n@@ -806,7 +806,7 @@ pub trait Reader {\n     ///\n     /// `i64`s are 8 bytes long.\n     fn read_le_i64(&mut self) -> i64 {\n-        self.read_le_int_n(8) as i64\n+        self.read_le_int_n(8)\n     }\n \n     /// Reads a little-endian `i32`.\n@@ -846,7 +846,7 @@ pub trait Reader {\n     /// `u8`s are 1 byte.\n     fn read_u8(&mut self) -> u8 {\n         match self.read_byte() {\n-            Some(b) => b as u8,\n+            Some(b) => b,\n             None => 0\n         }\n     }"}, {"sha": "9fd183ca7704cd2461a5aabea8f1e59567cbf125", "filename": "src/libstd/io/net/ip.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fnet%2Fip.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fnet%2Fip.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fnet%2Fip.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -153,11 +153,11 @@ impl<'a> Parser<'a> {\n             let c = c as u8;\n             // assuming radix is either 10 or 16\n             if c >= '0' as u8 && c <= '9' as u8 {\n-                Some((c - '0' as u8) as u8)\n+                Some(c - '0' as u8)\n             } else if radix > 10 && c >= 'a' as u8 && c < 'a' as u8 + (radix - 10) {\n-                Some((c - 'a' as u8 + 10) as u8)\n+                Some(c - 'a' as u8 + 10)\n             } else if radix > 10 && c >= 'A' as u8 && c < 'A' as u8 + (radix - 10) {\n-                Some((c - 'A' as u8 + 10) as u8)\n+                Some(c - 'A' as u8 + 10)\n             } else {\n                 None\n             }"}, {"sha": "1fcafd7d12f784551e7e24fae51c46607b9864aa", "filename": "src/libstd/io/stdio.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fstdio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fio%2Fstdio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fstdio.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -209,7 +209,7 @@ impl Reader for StdReader {\n                 io_error::cond.raise(standard_error(EndOfFile));\n                 None\n             }\n-            Ok(amt) => Some(amt as uint),\n+            Ok(amt) => Some(amt),\n             Err(e) => {\n                 io_error::cond.raise(e);\n                 None"}, {"sha": "7dcae69f70d6d78a332732fb7a1428ffa3156a4b", "filename": "src/libstd/num/strconv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fnum%2Fstrconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fnum%2Fstrconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fnum%2Fstrconv.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -344,7 +344,7 @@ pub fn float_to_str_bytes_common<T:NumCast+Zero+One+Eq+Ord+Float+Round+\n         // round the remaining ones.\n         if limit_digits && dig == digit_count {\n             let ascii2value = |chr: u8| {\n-                char::to_digit(chr as char, radix).unwrap() as uint\n+                char::to_digit(chr as char, radix).unwrap()\n             };\n             let value2ascii = |val: uint| {\n                 char::from_digit(val, radix).unwrap() as u8"}, {"sha": "8dc9372aec929a4ce9ab1c8714b97e6d0be9b74b", "filename": "src/libstd/rand/distributions/normal.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Frand%2Fdistributions%2Fnormal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Frand%2Fdistributions%2Fnormal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frand%2Fdistributions%2Fnormal.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -32,7 +32,7 @@ impl Rand for StandardNormal {\n     fn rand<R:Rng>(rng: &mut R) -> StandardNormal {\n         #[inline]\n         fn pdf(x: f64) -> f64 {\n-            ((-x*x/2.0) as f64).exp()\n+            (-x*x/2.0).exp()\n         }\n         #[inline]\n         fn zero_case<R:Rng>(rng: &mut R, u: f64) -> f64 {"}, {"sha": "c094344f6b9267f55207e08c82dfc7cd8df71c29", "filename": "src/libstd/rt/global_heap.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Frt%2Fglobal_heap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Frt%2Fglobal_heap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Fglobal_heap.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -76,7 +76,7 @@ pub unsafe fn closure_exchange_malloc(td: *c_char, size: uintptr_t) -> *c_char {\n     assert!(td.is_not_null());\n \n     let total_size = get_box_size(size, (*td).align);\n-    let p = malloc_raw(total_size as uint);\n+    let p = malloc_raw(total_size);\n \n     let alloc = p as *mut raw::Box<()>;\n     (*alloc).type_desc = td;"}, {"sha": "230564c6bf1cbed373403b3c865494fb0c32b0f3", "filename": "src/libstd/str.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstr.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -901,7 +901,7 @@ pub fn utf16_chars(v: &[u16], f: |char|) {\n             let mut c: u32 = (u - 0xD800_u16) as u32;\n             c = c << 10;\n             c |= (u2 - 0xDC00_u16) as u32;\n-            c |= 0x1_0000_u32 as u32;\n+            c |= 0x1_0000_u32;\n             f(unsafe { cast::transmute(c) });\n             i += 2u;\n         }\n@@ -987,7 +987,7 @@ pub mod raw {\n     /// Create a Rust string from a *u8 buffer of the given length\n     pub unsafe fn from_buf_len(buf: *u8, len: uint) -> ~str {\n         let mut v: ~[u8] = vec::with_capacity(len);\n-        ptr::copy_memory(v.as_mut_ptr(), buf as *u8, len);\n+        ptr::copy_memory(v.as_mut_ptr(), buf, len);\n         v.set_len(len);\n \n         assert!(is_utf8(v));"}, {"sha": "e11557ff337c27d28e63e1f9d394499544927f4c", "filename": "src/libstd/unstable/mutex.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Funstable%2Fmutex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Flibstd%2Funstable%2Fmutex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Funstable%2Fmutex.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -66,8 +66,8 @@ impl Mutex {\n     /// Creates a new mutex, with the lock/condition variable pre-initialized\n     pub unsafe fn new() -> Mutex {\n         Mutex {\n-            lock: atomics::AtomicUint::new(imp::init_lock() as uint),\n-            cond: atomics::AtomicUint::new(imp::init_cond() as uint),\n+            lock: atomics::AtomicUint::new(imp::init_lock()),\n+            cond: atomics::AtomicUint::new(imp::init_cond()),\n         }\n     }\n "}, {"sha": "9324bf110056ab15af9856e54419cb7470905af8", "filename": "src/test/compile-fail/lint-unnecessary-casts.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/bc395bc71e02a7726565725ce026758f948b2d76/src%2Ftest%2Fcompile-fail%2Flint-unnecessary-casts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc395bc71e02a7726565725ce026758f948b2d76/src%2Ftest%2Fcompile-fail%2Flint-unnecessary-casts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-unnecessary-casts.rs?ref=bc395bc71e02a7726565725ce026758f948b2d76", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[forbid(unnecessary_typecast)];\n+\n+fn foo_i32(_: i32) {}\n+\n+fn foo_u64(a: u64) {\n+    let b: i32 = a as i32;\n+    foo_i32(b as i32); //~ ERROR: unnecessary type cast\n+}\n+\n+fn main() {\n+    let x: u64 = 1;\n+    let y: u64 = x as u64; //~ ERROR: unnecessary type cast\n+    foo_u64(y as u64); //~ ERROR: unnecessary type cast\n+}"}]}