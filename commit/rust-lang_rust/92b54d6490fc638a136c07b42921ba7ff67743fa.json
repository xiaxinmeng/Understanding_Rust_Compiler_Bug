{"sha": "92b54d6490fc638a136c07b42921ba7ff67743fa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyYjU0ZDY0OTBmYzYzOGExMzZjMDdiNDI5MjFiYTdmZjY3NzQzZmE=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-05-23T15:06:23Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-05-23T15:06:23Z"}, "message": "Add heuristic when rewriting chain with a single child\n\nrustfmt splits chain into multiline when the length of chain exceeds\n`chain_one_line_max`. However, currenly this rule only applies when the chain\nhas more than one child. This can lead to unexpected long chain if the parent\nis long. This commit adds heuristic that if the length of parent is longer\nthan the half of `chain_one_line_max` we use multiline even if there is\nonly a single child.", "tree": {"sha": "7f419d83c7b0594d86e900f5a49861a7450a5eef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7f419d83c7b0594d86e900f5a49861a7450a5eef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92b54d6490fc638a136c07b42921ba7ff67743fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92b54d6490fc638a136c07b42921ba7ff67743fa", "html_url": "https://github.com/rust-lang/rust/commit/92b54d6490fc638a136c07b42921ba7ff67743fa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92b54d6490fc638a136c07b42921ba7ff67743fa/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec33121aafb081f33c78f062492cd61b77cef565", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec33121aafb081f33c78f062492cd61b77cef565", "html_url": "https://github.com/rust-lang/rust/commit/ec33121aafb081f33c78f062492cd61b77cef565"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "5ea43708af39e7161c4f8d5b6316b5b10c569305", "filename": "src/chains.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/92b54d6490fc638a136c07b42921ba7ff67743fa/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/92b54d6490fc638a136c07b42921ba7ff67743fa/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=92b54d6490fc638a136c07b42921ba7ff67743fa", "patch": "@@ -155,10 +155,10 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n            first_child_shape,\n            other_child_shape);\n \n-    let child_shape_iter =\n-        Some(first_child_shape)\n-            .into_iter()\n-            .chain(::std::iter::repeat(other_child_shape).take(subexpr_list.len() - 1));\n+    let child_shape_iter = Some(first_child_shape)\n+        .into_iter()\n+        .chain(::std::iter::repeat(other_child_shape)\n+                   .take(subexpr_list.len() - 1));\n     let iter = subexpr_list.iter().rev().zip(child_shape_iter);\n     let mut rewrites =\n         try_opt!(iter.map(|(e, shape)| rewrite_chain_subexpr(e, total_span, context, shape))\n@@ -175,7 +175,7 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n         if rewrites.len() > 1 {\n             true\n         } else if rewrites.len() == 1 {\n-            one_line_len > shape.width\n+            parent_rewrite.len() > context.config.chain_one_line_max() / 2\n         } else {\n             false\n         }"}]}