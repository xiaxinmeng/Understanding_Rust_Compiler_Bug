{"sha": "776b90cee204ddfdb868d16ef37d571fec9002c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3NmI5MGNlZTIwNGRkZmRiODY4ZDE2ZWYzN2Q1NzFmZWM5MDAyYzg=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-09-07T05:47:20Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-09-07T10:13:52Z"}, "message": "Rollup merge of #53966 - ljedrz:mir_dataflow_cleanups, r=estebank\n\nA few cleanups and minor improvements to mir/dataflow\n\n- simplify `dot::GraphWalk::edges` and optimize its vector's allocation\n- turn a `kill` loop into `kill_all`\n- remove the `prepost` parameter from `dataflow_path` (it doesn't seem to do anything)\n- a couple of other minor improvements", "tree": {"sha": "2273bd5a5ea35d45649cf7caff339953deb08446", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2273bd5a5ea35d45649cf7caff339953deb08446"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/776b90cee204ddfdb868d16ef37d571fec9002c8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAluST2EACgkQ/vbIBR0O\nATz1mw//cu957+LUaAZp+cO6dJP8A2pv2Z5TNtxxMvk5m+koo+lMIKf16HiaMINL\nOqy/bX1jAPZSkJWnBZ+q9o5vm2MGqBbXvx2UGx93CHezl5amgDVIDQfVNf8NSGs7\nym1R37Qw5kYSecuq/xo1mqvRFwK6esZiOsEVt+bQms9jlpz/noFqu8q6r+d3UAew\nhApFKKfGEy2u4AwYv7bkolJA3sy/uOU4b/LQZ9qsGIltjxHhLiyVByz+EDYahrx4\nMPgHBqabxV7Ywm0o+q3sqyZvw5ngw7ozrZSnlyqwG6vJNRyJWcOLyC7gxk0qsX6t\nh72QiOJpwr94AMUdbRgrlTIVEC991e7ihEGx7Tq5BC0iAeb5ZCGc4zkNjfiZr2UG\nfouzKX2L3Y7rpzIBdZ8Az5XDVS6oIVGEQL+XpjW95SL9OV8qDl83dPf6AVcWk2AW\ngARVAOPx2O3bHKhQm6gnpIIthXYdUdiH6fcDjul4j7e2Hd4ZGhrLIp8C43hKVolU\nEcgPZYCWsvxPEjwtiy4mT/1+jkyOY0JE8DSswRqPonMs7KOLrJIXfgLj+tL9hVMr\n1aZzhz6Jw8VEzRnPhOMH8BnR32KDTrAIq5d6oc767BNcoflh/qZtT1WJuACTfkjf\n+4CNyn8XTW0ea7OHvdPfVw3St3/G2HtWu4xGwR7tBbJnQ0mlVTw=\n=11kd\n-----END PGP SIGNATURE-----", "payload": "tree 2273bd5a5ea35d45649cf7caff339953deb08446\nparent 7e9fb7896284955ccf6543a117d6d9b3732cb8dc\nparent b7c0d32c5f53d748dc3d05672dedc71dc786970a\nauthor kennytm <kennytm@gmail.com> 1536299240 +0800\ncommitter kennytm <kennytm@gmail.com> 1536315232 +0800\n\nRollup merge of #53966 - ljedrz:mir_dataflow_cleanups, r=estebank\n\nA few cleanups and minor improvements to mir/dataflow\n\n- simplify `dot::GraphWalk::edges` and optimize its vector's allocation\n- turn a `kill` loop into `kill_all`\n- remove the `prepost` parameter from `dataflow_path` (it doesn't seem to do anything)\n- a couple of other minor improvements\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/776b90cee204ddfdb868d16ef37d571fec9002c8", "html_url": "https://github.com/rust-lang/rust/commit/776b90cee204ddfdb868d16ef37d571fec9002c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/776b90cee204ddfdb868d16ef37d571fec9002c8/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e9fb7896284955ccf6543a117d6d9b3732cb8dc", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e9fb7896284955ccf6543a117d6d9b3732cb8dc", "html_url": "https://github.com/rust-lang/rust/commit/7e9fb7896284955ccf6543a117d6d9b3732cb8dc"}, {"sha": "b7c0d32c5f53d748dc3d05672dedc71dc786970a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7c0d32c5f53d748dc3d05672dedc71dc786970a", "html_url": "https://github.com/rust-lang/rust/commit/b7c0d32c5f53d748dc3d05672dedc71dc786970a"}], "stats": {"total": 30, "additions": 12, "deletions": 18}, "files": [{"sha": "1d35bb85a21a199243561b508383932342d28e78", "filename": "src/librustc_mir/dataflow/graphviz.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs", "raw_url": "https://github.com/rust-lang/rust/raw/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fgraphviz.rs?ref=776b90cee204ddfdb868d16ef37d571fec9002c8", "patch": "@@ -265,15 +265,12 @@ impl<'a, 'tcx, MWF, P> dot::GraphWalk<'a> for Graph<'a, 'tcx, MWF, P>\n \n     fn edges(&self) -> dot::Edges<Edge> {\n         let mir = self.mbcx.mir();\n-        // base initial capacity on assumption every block has at\n-        // least one outgoing edge (Which should be true for all\n-        // blocks but one, the exit-block).\n-        let mut edges = Vec::with_capacity(mir.basic_blocks().len());\n-        for bb in mir.basic_blocks().indices() {\n-            let outgoing = outgoing(mir, bb);\n-            edges.extend(outgoing.into_iter());\n-        }\n-        edges.into_cow()\n+\n+        mir.basic_blocks()\n+           .indices()\n+           .flat_map(|bb| outgoing(mir, bb))\n+           .collect::<Vec<_>>()\n+           .into_cow()\n     }\n \n     fn source(&self, edge: &Edge) -> Node {"}, {"sha": "cb551df910627c4d6e8ed8b044177d0bd9974237", "filename": "src/librustc_mir/dataflow/impls/borrows.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "raw_url": "https://github.com/rust-lang/rust/raw/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs?ref=776b90cee204ddfdb868d16ef37d571fec9002c8", "patch": "@@ -168,9 +168,7 @@ impl<'a, 'gcx, 'tcx> Borrows<'a, 'gcx, 'tcx> {\n         // region, then setting that gen-bit will override any\n         // potential kill introduced here.\n         if let Some(indices) = self.borrows_out_of_scope_at_location.get(&location) {\n-            for index in indices {\n-                sets.kill(&index);\n-            }\n+            sets.kill_all(indices);\n         }\n     }\n "}, {"sha": "d6874e290d4f6cb7398fff416d826d55c70338ab", "filename": "src/librustc_mir/dataflow/mod.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmod.rs?ref=776b90cee204ddfdb868d16ef37d571fec9002c8", "patch": "@@ -250,8 +250,7 @@ impl<'b, 'a: 'b, 'tcx: 'a, BD> PropagationContext<'b, 'a, 'tcx, BD> where BD: Bi\n     }\n }\n \n-fn dataflow_path(context: &str, prepost: &str, path: &str) -> PathBuf {\n-    format!(\"{}_{}\", context, prepost);\n+fn dataflow_path(context: &str, path: &str) -> PathBuf {\n     let mut path = PathBuf::from(path);\n     let new_file_name = {\n         let orig_file_name = path.file_name().unwrap().to_str().unwrap();\n@@ -267,7 +266,7 @@ impl<'a, 'tcx: 'a, BD> DataflowBuilder<'a, 'tcx, BD> where BD: BitDenotation\n         where P: Fn(&BD, BD::Idx) -> DebugFormatted\n     {\n         if let Some(ref path_str) = self.print_preflow_to {\n-            let path = dataflow_path(BD::name(), \"preflow\", path_str);\n+            let path = dataflow_path(BD::name(), path_str);\n             graphviz::print_borrowck_graph_to(self, &path, p)\n         } else {\n             Ok(())\n@@ -278,9 +277,9 @@ impl<'a, 'tcx: 'a, BD> DataflowBuilder<'a, 'tcx, BD> where BD: BitDenotation\n         where P: Fn(&BD, BD::Idx) -> DebugFormatted\n     {\n         if let Some(ref path_str) = self.print_postflow_to {\n-            let path = dataflow_path(BD::name(), \"postflow\", path_str);\n+            let path = dataflow_path(BD::name(), path_str);\n             graphviz::print_borrowck_graph_to(self, &path, p)\n-        } else{\n+        } else {\n             Ok(())\n         }\n     }"}, {"sha": "732aa7904d3198ebd8d551896d8dffd898161065", "filename": "src/librustc_mir/dataflow/move_paths/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/776b90cee204ddfdb868d16ef37d571fec9002c8/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs?ref=776b90cee204ddfdb868d16ef37d571fec9002c8", "patch": "@@ -201,7 +201,7 @@ impl<'a, 'gcx, 'tcx> MoveDataBuilder<'a, 'gcx, 'tcx> {\n             \"done dumping moves\"\n         });\n \n-        if self.errors.len() > 0 {\n+        if !self.errors.is_empty() {\n             Err((self.data, self.errors))\n         } else {\n             Ok(self.data)"}]}