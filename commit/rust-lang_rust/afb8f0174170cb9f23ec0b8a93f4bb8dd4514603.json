{"sha": "afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmYjhmMDE3NDE3MGNiOWYyM2VjMGI4YTkzZjRiYjhkZDQ1MTQ2MDM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-29T21:47:23Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-11-29T21:47:54Z"}, "message": "rt: Fix calculation of stack args location in x86_64/morestack.S", "tree": {"sha": "e037e6b867954238a38cdc79333f90c42079f395", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e037e6b867954238a38cdc79333f90c42079f395"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "html_url": "https://github.com/rust-lang/rust/commit/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9675343dc975a0159d5f7b52e4a7f72737f0549c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9675343dc975a0159d5f7b52e4a7f72737f0549c", "html_url": "https://github.com/rust-lang/rust/commit/9675343dc975a0159d5f7b52e4a7f72737f0549c"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "7a17cb6744e88a12924f8c6ad78cc2f092d06096", "filename": "src/rt/arch/x86_64/morestack.S", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "raw_url": "https://github.com/rust-lang/rust/raw/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Farch%2Fx86_64%2Fmorestack.S?ref=afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "patch": "@@ -76,10 +76,11 @@ MORESTACK:\n \tpushq\t%r8\n \tpushq\t%r9\n \n-\t// Calculate the address of the stack arguments\n+\t// Calculate the address of the stack arguments.\n+\t// We have the base pointer, __morestack's return address,\n+\t// and __morestack's caller's return address to skip\n \tmovq %rbp, %rcx\n-\taddq $16, %rcx   // Add the saved %rbp, and return address\n-\taddq %r11, %rcx // Add the size of stack arguments\n+\taddq $24, %rcx  // Base pointer, return address x2\n \n \tpushq %rbp // Save the Rust stack pointer\n \tpushq %r11 // Size of stack arguments"}, {"sha": "dd679df0c5a0c2b3b2dad89a0897cf0ccd4e0e2c", "filename": "src/test/run-pass/morestack3.rs", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603/src%2Ftest%2Frun-pass%2Fmorestack3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/afb8f0174170cb9f23ec0b8a93f4bb8dd4514603/src%2Ftest%2Frun-pass%2Fmorestack3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmorestack3.rs?ref=afb8f0174170cb9f23ec0b8a93f4bb8dd4514603", "patch": "@@ -0,0 +1,45 @@\n+// xfail-test\n+// compile-flags:--stack-growth\n+\n+// Here we're testing that all of the argument registers, argument\n+// stack slots, and return value are preserved across split stacks.\n+fn getbig(a0: int,\n+          a1: int,\n+          a2: int,\n+          a3: int,\n+          a4: int,\n+          a5: int,\n+          a6: int,\n+          a7: int,\n+          a8: int,\n+          a9: int) -> int {\n+\n+    assert a0 + 1 == a1;\n+    assert a1 + 1 == a2;\n+    assert a2 + 1 == a3;\n+    assert a3 + 1 == a4;\n+    assert a4 + 1 == a5;\n+    assert a5 + 1 == a6;\n+    assert a6 + 1 == a7;\n+    assert a7 + 1 == a8;\n+    assert a8 + 1 == a9;\n+    if a0 != 0 {\n+        let j = getbig(a0 - 1,\n+                       a1 - 1,\n+                       a2 - 1,\n+                       a3 - 1,\n+                       a4 - 1,\n+                       a5 - 1,\n+                       a6 - 1,\n+                       a7 - 1,\n+                       a8 - 1,\n+                       a9 - 1);\n+        assert j == a0 - 1;\n+    }\n+    ret a0;\n+}\n+\n+fn main() {\n+    let a = 1000000;\n+    getbig(a, a+1, a+2, a+3, a+4, a+5, a+6, a+7, a+8, a+9);\n+}\n\\ No newline at end of file"}]}