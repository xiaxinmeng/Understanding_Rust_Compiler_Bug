{"sha": "7051d622c0536718816152b14ff04a0072884d7e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwNTFkNjIyYzA1MzY3MTg4MTYxNTJiMTRmZjA0YTAwNzI4ODRkN2U=", "commit": {"author": {"name": "Paul Stansifer", "email": "paul.stansifer@gmail.com", "date": "2012-11-27T03:34:01Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2012-11-29T20:09:11Z"}, "message": "Properly sync macro_parser.rs after it escapes out to the Rust parser. Closes #3201.", "tree": {"sha": "49938aac8f8067d5de9fead51cc4a291cfc84909", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49938aac8f8067d5de9fead51cc4a291cfc84909"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7051d622c0536718816152b14ff04a0072884d7e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7051d622c0536718816152b14ff04a0072884d7e", "html_url": "https://github.com/rust-lang/rust/commit/7051d622c0536718816152b14ff04a0072884d7e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7051d622c0536718816152b14ff04a0072884d7e/comments", "author": {"login": "paulstansifer", "id": 1431, "node_id": "MDQ6VXNlcjE0MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1431?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulstansifer", "html_url": "https://github.com/paulstansifer", "followers_url": "https://api.github.com/users/paulstansifer/followers", "following_url": "https://api.github.com/users/paulstansifer/following{/other_user}", "gists_url": "https://api.github.com/users/paulstansifer/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulstansifer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulstansifer/subscriptions", "organizations_url": "https://api.github.com/users/paulstansifer/orgs", "repos_url": "https://api.github.com/users/paulstansifer/repos", "events_url": "https://api.github.com/users/paulstansifer/events{/privacy}", "received_events_url": "https://api.github.com/users/paulstansifer/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ff8d1876630e7e3d1b0eef6c0c51610a19c4b98", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ff8d1876630e7e3d1b0eef6c0c51610a19c4b98", "html_url": "https://github.com/rust-lang/rust/commit/9ff8d1876630e7e3d1b0eef6c0c51610a19c4b98"}], "stats": {"total": 22, "additions": 13, "deletions": 9}, "files": [{"sha": "a9390914829031a9520c079b987a4d9bac02fd8d", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=7051d622c0536718816152b14ff04a0072884d7e", "patch": "@@ -349,10 +349,15 @@ fn core_macros() -> ~str {\n     return\n ~\"{\n     macro_rules! ignore (($($x:tt)*) => (()))\n-    #macro[[#error[f, ...], log(core::error, #fmt[f, ...])]];\n-    #macro[[#warn[f, ...], log(core::warn, #fmt[f, ...])]];\n-    #macro[[#info[f, ...], log(core::info, #fmt[f, ...])]];\n-    #macro[[#debug[f, ...], log(core::debug, #fmt[f, ...])]];\n+\n+    macro_rules! error ( ($( $arg:expr ),+) => (\n+        log(core::error, fmt!( $($arg),+ )) ))\n+    macro_rules! warn ( ($( $arg:expr ),+) => (\n+        log(core::warn, fmt!( $($arg),+ )) ))\n+    macro_rules! info ( ($( $arg:expr ),+) => (\n+        log(core::info, fmt!( $($arg),+ )) ))\n+    macro_rules! debug ( ($( $arg:expr ),+) => (\n+        log(core::debug, fmt!( $($arg),+ )) ))\n \n     macro_rules! die(\n         ($msg: expr) => ("}, {"sha": "13d9e87f26e263e37a3a67beeb27ba14ac8f9dbd", "filename": "src/libsyntax/ext/tt/macro_parser.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs?ref=7051d622c0536718816152b14ff04a0072884d7e", "patch": "@@ -368,11 +368,7 @@ fn parse(sess: parse_sess, cfg: ast::crate_cfg, rdr: reader, ms: ~[matcher])\n                 }\n                 cur_eis.push(move ei);\n \n-                /* this would fail if zero-length tokens existed */\n-                while rdr.peek().sp.lo < rust_parser.span.lo {\n-                    rdr.next_token();\n-                } /* except for EOF... */\n-                while rust_parser.token == EOF && rdr.peek().tok != EOF {\n+                for rust_parser.tokens_consumed.times() || {\n                     rdr.next_token();\n                 }\n             }"}, {"sha": "96364790956b7775d1e68bb4ba6caae40e5a66af", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7051d622c0536718816152b14ff04a0072884d7e/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=7051d622c0536718816152b14ff04a0072884d7e", "patch": "@@ -191,6 +191,7 @@ fn Parser(sess: parse_sess, cfg: ast::crate_cfg,\n         buffer: [mut {tok: tok0.tok, sp: span0}, ..4],\n         buffer_start: 0,\n         buffer_end: 0,\n+        tokens_consumed: 0u,\n         restriction: UNRESTRICTED,\n         quote_depth: 0u,\n         keywords: token::keyword_table(),\n@@ -209,6 +210,7 @@ struct Parser {\n     mut buffer: [mut {tok: token::Token, sp: span} * 4],\n     mut buffer_start: int,\n     mut buffer_end: int,\n+    mut tokens_consumed: uint,\n     mut restriction: restriction,\n     mut quote_depth: uint, // not (yet) related to the quasiquoter\n     reader: reader,\n@@ -235,6 +237,7 @@ impl Parser {\n         };\n         self.token = next.tok;\n         self.span = next.sp;\n+        self.tokens_consumed += 1u;\n     }\n     fn swap(next: token::Token, +lo: BytePos, +hi: BytePos) {\n         self.token = next;"}]}