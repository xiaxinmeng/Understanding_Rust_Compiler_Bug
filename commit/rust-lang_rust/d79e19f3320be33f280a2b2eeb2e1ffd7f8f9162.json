{"sha": "d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3OWUxOWYzMzIwYmUzM2YyODBhMmIyZWViMmUxZmZkN2Y4ZjkxNjI=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-12-12T17:13:04Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-12-12T17:13:04Z"}, "message": "Don't require cmake and ninja when the LLVM backend is not used", "tree": {"sha": "b5082f08b8f7c59368a4aa56fae95a67b1122675", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5082f08b8f7c59368a4aa56fae95a67b1122675"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162", "html_url": "https://github.com/rust-lang/rust/commit/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16f69b5430cd543d5767401d760cc644dc836906", "url": "https://api.github.com/repos/rust-lang/rust/commits/16f69b5430cd543d5767401d760cc644dc836906", "html_url": "https://github.com/rust-lang/rust/commit/16f69b5430cd543d5767401d760cc644dc836906"}], "stats": {"total": 36, "additions": 20, "deletions": 16}, "files": [{"sha": "8d7ad345ab4dd6d3beb80bb8ab327ff569ab8d2e", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=d79e19f3320be33f280a2b2eeb2e1ffd7f8f9162", "patch": "@@ -17,6 +17,7 @@ use std::process::Command;\n \n use build_helper::{output, t};\n \n+use crate::cache::INTERNER;\n use crate::config::Target;\n use crate::Build;\n \n@@ -79,18 +80,19 @@ pub fn check(build: &mut Build) {\n     }\n \n     // We need cmake, but only if we're actually building LLVM or sanitizers.\n-    let building_llvm = build\n-        .hosts\n-        .iter()\n-        .map(|host| {\n-            build\n-                .config\n-                .target_config\n-                .get(host)\n-                .map(|config| config.llvm_config.is_none())\n-                .unwrap_or(true)\n-        })\n-        .any(|build_llvm_ourselves| build_llvm_ourselves);\n+    let building_llvm = build.config.rust_codegen_backends.contains(&INTERNER.intern_str(\"llvm\"))\n+        && build\n+            .hosts\n+            .iter()\n+            .map(|host| {\n+                build\n+                    .config\n+                    .target_config\n+                    .get(host)\n+                    .map(|config| config.llvm_config.is_none())\n+                    .unwrap_or(true)\n+            })\n+            .any(|build_llvm_ourselves| build_llvm_ourselves);\n     if building_llvm || build.config.any_sanitizers_enabled() {\n         cmd_finder.must_have(\"cmake\");\n     }\n@@ -147,10 +149,12 @@ pub fn check(build: &mut Build) {\n         }\n     }\n \n-    // Externally configured LLVM requires FileCheck to exist\n-    let filecheck = build.llvm_filecheck(build.build);\n-    if !filecheck.starts_with(&build.out) && !filecheck.exists() && build.config.codegen_tests {\n-        panic!(\"FileCheck executable {:?} does not exist\", filecheck);\n+    if build.config.rust_codegen_backends.contains(&INTERNER.intern_str(\"llvm\")) {\n+        // Externally configured LLVM requires FileCheck to exist\n+        let filecheck = build.llvm_filecheck(build.build);\n+        if !filecheck.starts_with(&build.out) && !filecheck.exists() && build.config.codegen_tests {\n+            panic!(\"FileCheck executable {:?} does not exist\", filecheck);\n+        }\n     }\n \n     for target in &build.targets {"}]}