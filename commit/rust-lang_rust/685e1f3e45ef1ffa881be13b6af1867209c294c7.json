{"sha": "685e1f3e45ef1ffa881be13b6af1867209c294c7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4NWUxZjNlNDVlZjFmZmE4ODFiZTEzYjZhZjE4NjcyMDljMjk0Yzc=", "commit": {"author": {"name": "ortem", "email": "ortem00@gmail.com", "date": "2020-11-20T15:01:15Z"}, "committer": {"name": "ortem", "email": "ortem00@gmail.com", "date": "2020-11-23T14:07:14Z"}, "message": "Fix zero-sized BTreeMap gdb pretty-printer\n\n`gdb.parse_and_eval(\"()\")` is needed because GDB treats \"()\" as a Rust array of two characters, not as a unit", "tree": {"sha": "86dc51c1922230917cd784bd94d1f2b32654bcc7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86dc51c1922230917cd784bd94d1f2b32654bcc7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/685e1f3e45ef1ffa881be13b6af1867209c294c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/685e1f3e45ef1ffa881be13b6af1867209c294c7", "html_url": "https://github.com/rust-lang/rust/commit/685e1f3e45ef1ffa881be13b6af1867209c294c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/685e1f3e45ef1ffa881be13b6af1867209c294c7/comments", "author": {"login": "artemmukhin", "id": 4854600, "node_id": "MDQ6VXNlcjQ4NTQ2MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4854600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/artemmukhin", "html_url": "https://github.com/artemmukhin", "followers_url": "https://api.github.com/users/artemmukhin/followers", "following_url": "https://api.github.com/users/artemmukhin/following{/other_user}", "gists_url": "https://api.github.com/users/artemmukhin/gists{/gist_id}", "starred_url": "https://api.github.com/users/artemmukhin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/artemmukhin/subscriptions", "organizations_url": "https://api.github.com/users/artemmukhin/orgs", "repos_url": "https://api.github.com/users/artemmukhin/repos", "events_url": "https://api.github.com/users/artemmukhin/events{/privacy}", "received_events_url": "https://api.github.com/users/artemmukhin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "artemmukhin", "id": 4854600, "node_id": "MDQ6VXNlcjQ4NTQ2MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4854600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/artemmukhin", "html_url": "https://github.com/artemmukhin", "followers_url": "https://api.github.com/users/artemmukhin/followers", "following_url": "https://api.github.com/users/artemmukhin/following{/other_user}", "gists_url": "https://api.github.com/users/artemmukhin/gists{/gist_id}", "starred_url": "https://api.github.com/users/artemmukhin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/artemmukhin/subscriptions", "organizations_url": "https://api.github.com/users/artemmukhin/orgs", "repos_url": "https://api.github.com/users/artemmukhin/repos", "events_url": "https://api.github.com/users/artemmukhin/events{/privacy}", "received_events_url": "https://api.github.com/users/artemmukhin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "068320b39e3e4839d832b3aa71fa910ba170673b", "url": "https://api.github.com/repos/rust-lang/rust/commits/068320b39e3e4839d832b3aa71fa910ba170673b", "html_url": "https://github.com/rust-lang/rust/commit/068320b39e3e4839d832b3aa71fa910ba170673b"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "d9e08eb581dc65da0b374da85f6b0322755b2d16", "filename": "src/etc/gdb_providers.py", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/685e1f3e45ef1ffa881be13b6af1867209c294c7/src%2Fetc%2Fgdb_providers.py", "raw_url": "https://github.com/rust-lang/rust/raw/685e1f3e45ef1ffa881be13b6af1867209c294c7/src%2Fetc%2Fgdb_providers.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_providers.py?ref=685e1f3e45ef1ffa881be13b6af1867209c294c7", "patch": "@@ -1,7 +1,6 @@\n from sys import version_info\n \n import gdb\n-from gdb import lookup_type\n \n if version_info[0] >= 3:\n     xrange = range\n@@ -213,7 +212,7 @@ def children_of_btree_map(map):\n     def children_of_node(node_ptr, height):\n         def cast_to_internal(node):\n             internal_type_name = node.type.target().name.replace(\"LeafNode\", \"InternalNode\", 1)\n-            internal_type = lookup_type(internal_type_name)\n+            internal_type = gdb.lookup_type(internal_type_name)\n             return node.cast(internal_type.pointer())\n \n         leaf = node_ptr.dereference()\n@@ -230,8 +229,10 @@ def cast_to_internal(node):\n                     yield child\n             if i < length:\n                 # Avoid \"Cannot perform pointer math on incomplete type\" on zero-sized arrays.\n-                key = keys[i][\"value\"][\"value\"] if keys.type.sizeof > 0 else \"()\"\n-                val = vals[i][\"value\"][\"value\"] if vals.type.sizeof > 0 else \"()\"\n+                key_type_size = keys.type.sizeof\n+                val_type_size = vals.type.sizeof\n+                key = keys[i][\"value\"][\"value\"] if key_type_size > 0 else gdb.parse_and_eval(\"()\")\n+                val = vals[i][\"value\"][\"value\"] if val_type_size > 0 else gdb.parse_and_eval(\"()\")\n                 yield key, val\n \n     if map[\"length\"] > 0:"}]}