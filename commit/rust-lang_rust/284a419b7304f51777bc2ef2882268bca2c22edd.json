{"sha": "284a419b7304f51777bc2ef2882268bca2c22edd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4NGE0MTliNzMwNGY1MTc3N2JjMmVmMjg4MjI2OGJjYTJjMjJlZGQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2019-01-05T15:57:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-05T15:57:02Z"}, "message": "Rollup merge of #57338 - QuietMisdreavus:doctest-file-name, r=GuillaumeGomez\n\nrustdoc: force binary filename for compiled doctests\n\nFixes https://github.com/rust-lang/rust/issues/57317, needed for https://github.com/rust-lang/rust-by-example/issues/1137\n\nRight now, when building a doctest, rustdoc provides the compiler an output directory (a temp dir) but lets the compiler name the executable. If the doctest needs to be executed, it then tries to run a binary named `rust_out` from that directory. For the most part, this works fine. However, if the doctest sets its own crate name, the compiler uses that name for the output binary instead. This causes rustdoc to try to execute a nonexistent binary, causing the test to fail.\n\nThis PR changes the paths rustdoc gives to the compiler when building doctests to force the output *filename* instead of just the *directory*.", "tree": {"sha": "b5d49c9a6618730dcbd8713e365e61d4d6e27248", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5d49c9a6618730dcbd8713e365e61d4d6e27248"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/284a419b7304f51777bc2ef2882268bca2c22edd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcMNPOCRBK7hj4Ov3rIwAAdHIIABSvxOOgBac7gIV5U6A4KLmW\ni009hmXqLSxv5Lu4nMSrEo0Sw6XL/dpVZSN74g9tdgHg8Bt68m8+e0Q8tNsinCL7\n5svH0y+/A98m+LuRKOJdXWZFXQZDNDtdIsvQzeCkB1nD2d5jl5+Q8uNI3FFn2N5v\nQybyaeseh6s2KnZPVbmRtjiljOZdxbkvvS///VpXNRmgzOpwvbI7tfdw2rQy+36X\nqB8Ivy5sqVoazzLC0fTnqJ3ObKbw0z0VbExnHMl4oyt2/OV0KFdPEb7TSrbXgC3b\nFZ6qD+dvHNKd12hd40IBai5LHQP2eM5C4C9+jvs2HYTckQYxKQ3o33c9KupQdcA=\n=qrVq\n-----END PGP SIGNATURE-----\n", "payload": "tree b5d49c9a6618730dcbd8713e365e61d4d6e27248\nparent a3afdd41bced85896b3e8b5efb182fe40fb809a4\nparent 0b55c79072eca1c697dfee8c1d098b7d0ee828d0\nauthor kennytm <kennytm@gmail.com> 1546703822 +0800\ncommitter GitHub <noreply@github.com> 1546703822 +0800\n\nRollup merge of #57338 - QuietMisdreavus:doctest-file-name, r=GuillaumeGomez\n\nrustdoc: force binary filename for compiled doctests\n\nFixes https://github.com/rust-lang/rust/issues/57317, needed for https://github.com/rust-lang/rust-by-example/issues/1137\n\nRight now, when building a doctest, rustdoc provides the compiler an output directory (a temp dir) but lets the compiler name the executable. If the doctest needs to be executed, it then tries to run a binary named `rust_out` from that directory. For the most part, this works fine. However, if the doctest sets its own crate name, the compiler uses that name for the output binary instead. This causes rustdoc to try to execute a nonexistent binary, causing the test to fail.\n\nThis PR changes the paths rustdoc gives to the compiler when building doctests to force the output *filename* instead of just the *directory*.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/284a419b7304f51777bc2ef2882268bca2c22edd", "html_url": "https://github.com/rust-lang/rust/commit/284a419b7304f51777bc2ef2882268bca2c22edd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/284a419b7304f51777bc2ef2882268bca2c22edd/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3afdd41bced85896b3e8b5efb182fe40fb809a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3afdd41bced85896b3e8b5efb182fe40fb809a4", "html_url": "https://github.com/rust-lang/rust/commit/a3afdd41bced85896b3e8b5efb182fe40fb809a4"}, {"sha": "0b55c79072eca1c697dfee8c1d098b7d0ee828d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b55c79072eca1c697dfee8c1d098b7d0ee828d0", "html_url": "https://github.com/rust-lang/rust/commit/0b55c79072eca1c697dfee8c1d098b7d0ee828d0"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "2170054b532b96eb1d23dc7d4c29088c2bb367d6", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/284a419b7304f51777bc2ef2882268bca2c22edd/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284a419b7304f51777bc2ef2882268bca2c22edd/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=284a419b7304f51777bc2ef2882268bca2c22edd", "patch": "@@ -278,7 +278,7 @@ fn run_test(test: &str, cratename: &str, filename: &FileName, line: usize,\n         target_features::add_configuration(&mut cfg, &sess, &*codegen_backend);\n         sess.parse_sess.config = cfg;\n \n-        let out = Some(outdir.lock().unwrap().path().to_path_buf());\n+        let out = Some(outdir.lock().unwrap().path().join(\"rust_out\"));\n \n         if no_run {\n             control.after_analysis.stop = Compilation::Stop;\n@@ -291,8 +291,8 @@ fn run_test(test: &str, cratename: &str, filename: &FileName, line: usize,\n                 &cstore,\n                 &None,\n                 &input,\n-                &out,\n                 &None,\n+                &out,\n                 None,\n                 &control\n             )"}, {"sha": "3a5e3734e140d08316ec157da04ef2709fe07473", "filename": "src/test/rustdoc/doctest-manual-crate-name.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/284a419b7304f51777bc2ef2882268bca2c22edd/src%2Ftest%2Frustdoc%2Fdoctest-manual-crate-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/284a419b7304f51777bc2ef2882268bca2c22edd/src%2Ftest%2Frustdoc%2Fdoctest-manual-crate-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fdoctest-manual-crate-name.rs?ref=284a419b7304f51777bc2ef2882268bca2c22edd", "patch": "@@ -0,0 +1,7 @@\n+// compile-flags:--test\n+\n+//! ```\n+//! #![crate_name=\"asdf\"]\n+//!\n+//! println!(\"yo\");\n+//! ```"}]}