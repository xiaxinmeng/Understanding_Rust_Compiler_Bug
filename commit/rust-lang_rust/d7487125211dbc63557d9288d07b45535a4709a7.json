{"sha": "d7487125211dbc63557d9288d07b45535a4709a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3NDg3MTI1MjExZGJjNjM1NTdkOTI4OGQwN2I0NTUzNWE0NzA5YTc=", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-12-03T23:17:02Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-12-03T23:17:02Z"}, "message": "Propagate all closure requirements to the caller", "tree": {"sha": "e22cd0a0ce97a74d08f0ba26b91705aff11b6ed8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e22cd0a0ce97a74d08f0ba26b91705aff11b6ed8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7487125211dbc63557d9288d07b45535a4709a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7487125211dbc63557d9288d07b45535a4709a7", "html_url": "https://github.com/rust-lang/rust/commit/d7487125211dbc63557d9288d07b45535a4709a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7487125211dbc63557d9288d07b45535a4709a7/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c999ed132d67bf2520643e9bd619972cf3888ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c999ed132d67bf2520643e9bd619972cf3888ba", "html_url": "https://github.com/rust-lang/rust/commit/0c999ed132d67bf2520643e9bd619972cf3888ba"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "fbde699264b4a485a52c518e2a577abb5982c03a", "filename": "src/librustc_mir/borrow_check/nll/region_infer/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7487125211dbc63557d9288d07b45535a4709a7/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7487125211dbc63557d9288d07b45535a4709a7/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Fmod.rs?ref=d7487125211dbc63557d9288d07b45535a4709a7", "patch": "@@ -1208,7 +1208,7 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n                         blame_span: blame_span_category.1,\n                         category: blame_span_category.0,\n                     });\n-                    return;\n+                    continue;\n                 }\n             }\n "}, {"sha": "dbc659b4aeef94c145180dcea3ff23a7148d7349", "filename": "src/test/ui/nll/closure-requirements/propagate-multiple-requirements.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/d7487125211dbc63557d9288d07b45535a4709a7/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d7487125211dbc63557d9288d07b45535a4709a7/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.rs?ref=d7487125211dbc63557d9288d07b45535a4709a7", "patch": "@@ -0,0 +1,25 @@\n+// Test that we propagate *all* requirements to the caller, not just the first\n+// one.\n+\n+#![feature(nll)]\n+\n+fn once<S, T, U, F: FnOnce(S, T) -> U>(f: F, s: S, t: T) -> U {\n+    f(s, t)\n+}\n+\n+pub fn dangle() -> &'static [i32] {\n+    let other_local_arr = [0, 2, 4];\n+    let local_arr = other_local_arr;\n+    let mut out: &mut &'static [i32] = &mut (&[1] as _);\n+    once(|mut z: &[i32], mut out_val: &mut &[i32]| {\n+        // We unfortunately point to the first use in the closure in the error\n+        // message\n+        z = &local_arr; //~ ERROR\n+        *out_val = &local_arr;\n+    }, &[] as &[_], &mut *out);\n+    *out\n+}\n+\n+fn main() {\n+    println!(\"{:?}\", dangle());\n+}"}, {"sha": "2ad4577869a5536ef6c482f8a35caf04133b4988", "filename": "src/test/ui/nll/closure-requirements/propagate-multiple-requirements.stderr", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/d7487125211dbc63557d9288d07b45535a4709a7/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d7487125211dbc63557d9288d07b45535a4709a7/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fclosure-requirements%2Fpropagate-multiple-requirements.stderr?ref=d7487125211dbc63557d9288d07b45535a4709a7", "patch": "@@ -0,0 +1,17 @@\n+error[E0597]: `local_arr` does not live long enough\n+  --> $DIR/propagate-multiple-requirements.rs:17:14\n+   |\n+LL |     let mut out: &mut &'static [i32] = &mut (&[1] as _);\n+   |                  ------------------- type annotation requires that `local_arr` is borrowed for `'static`\n+LL |     once(|mut z: &[i32], mut out_val: &mut &[i32]| {\n+   |          ----------------------------------------- value captured here\n+...\n+LL |         z = &local_arr; //~ ERROR\n+   |              ^^^^^^^^^ borrowed value does not live long enough\n+...\n+LL | }\n+   | - `local_arr` dropped here while still borrowed\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0597`."}]}