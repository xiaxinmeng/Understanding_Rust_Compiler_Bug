{"sha": "e7949d0013bb8b45c884b173ca22c20e6899d612", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3OTQ5ZDAwMTNiYjhiNDVjODg0YjE3M2NhMjJjMjBlNjg5OWQ2MTI=", "commit": {"author": {"name": "Adam Ransom", "email": "v0id.gmr@gmail.com", "date": "2017-03-21T12:38:32Z"}, "committer": {"name": "Adam Ransom", "email": "v0id.gmr@gmail.com", "date": "2017-03-25T01:47:19Z"}, "message": "Warn when using a `'static` lifetime bound\n\nPreviously a `'static` lifetime bound would result in an `undeclared\nlifetime` error when compiling, even though it could be considered\nvalid.\n\nHowever, it is unnecessary to use it as a lifetime bound so we present\nthe user with a warning instead and suggest using the `'static` lifetime\ndirectly, in place of the lifetime parameter.", "tree": {"sha": "27f11544a66ed4473441cc1e50d07c8b6a0d5887", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/27f11544a66ed4473441cc1e50d07c8b6a0d5887"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7949d0013bb8b45c884b173ca22c20e6899d612", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7949d0013bb8b45c884b173ca22c20e6899d612", "html_url": "https://github.com/rust-lang/rust/commit/e7949d0013bb8b45c884b173ca22c20e6899d612", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7949d0013bb8b45c884b173ca22c20e6899d612/comments", "author": {"login": "adamransom", "id": 1046872, "node_id": "MDQ6VXNlcjEwNDY4NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1046872?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamransom", "html_url": "https://github.com/adamransom", "followers_url": "https://api.github.com/users/adamransom/followers", "following_url": "https://api.github.com/users/adamransom/following{/other_user}", "gists_url": "https://api.github.com/users/adamransom/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamransom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamransom/subscriptions", "organizations_url": "https://api.github.com/users/adamransom/orgs", "repos_url": "https://api.github.com/users/adamransom/repos", "events_url": "https://api.github.com/users/adamransom/events{/privacy}", "received_events_url": "https://api.github.com/users/adamransom/received_events", "type": "User", "site_admin": false}, "committer": {"login": "adamransom", "id": 1046872, "node_id": "MDQ6VXNlcjEwNDY4NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1046872?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamransom", "html_url": "https://github.com/adamransom", "followers_url": "https://api.github.com/users/adamransom/followers", "following_url": "https://api.github.com/users/adamransom/following{/other_user}", "gists_url": "https://api.github.com/users/adamransom/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamransom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamransom/subscriptions", "organizations_url": "https://api.github.com/users/adamransom/orgs", "repos_url": "https://api.github.com/users/adamransom/repos", "events_url": "https://api.github.com/users/adamransom/events{/privacy}", "received_events_url": "https://api.github.com/users/adamransom/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ae1a19ba6156479969f493c8e05871539e69b52", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ae1a19ba6156479969f493c8e05871539e69b52", "html_url": "https://github.com/rust-lang/rust/commit/1ae1a19ba6156479969f493c8e05871539e69b52"}], "stats": {"total": 30, "additions": 28, "deletions": 2}, "files": [{"sha": "5094e28475b2640e9faea82e38e71fe28b91bba1", "filename": "src/librustc/middle/resolve_lifetime.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e7949d0013bb8b45c884b173ca22c20e6899d612/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7949d0013bb8b45c884b173ca22c20e6899d612/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fresolve_lifetime.rs?ref=e7949d0013bb8b45c884b173ca22c20e6899d612", "patch": "@@ -29,7 +29,7 @@ use syntax::ast;\n use syntax::attr;\n use syntax::ptr::P;\n use syntax::symbol::keywords;\n-use syntax_pos::Span;\n+use syntax_pos::{mk_sp, Span};\n use errors::DiagnosticBuilder;\n use util::nodemap::{NodeMap, NodeSet, FxHashSet, FxHashMap, DefIdMap};\n use rustc_back::slice;\n@@ -1464,7 +1464,17 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n             self.check_lifetime_def_for_shadowing(old_scope, &lifetime_i.lifetime);\n \n             for bound in &lifetime_i.bounds {\n-                self.resolve_lifetime_ref(bound);\n+                if !bound.is_static() {\n+                    self.resolve_lifetime_ref(bound);\n+                } else {\n+                    self.insert_lifetime(bound, Region::Static);\n+                    let full_span = mk_sp(lifetime_i.lifetime.span.lo, bound.span.hi);\n+                    self.sess.struct_span_warn(full_span,\n+                        &format!(\"unnecessary lifetime parameter `{}`\", lifetime_i.lifetime.name))\n+                        .help(&format!(\"you can use the `'static` lifetime directly, in place \\\n+                                        of `{}`\", lifetime_i.lifetime.name))\n+                        .emit();\n+                }\n             }\n         }\n     }"}, {"sha": "38534ab0a36876ec56346e519985365ea7213437", "filename": "src/test/compile-fail/static-lifetime-bound.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e7949d0013bb8b45c884b173ca22c20e6899d612/src%2Ftest%2Fcompile-fail%2Fstatic-lifetime-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7949d0013bb8b45c884b173ca22c20e6899d612/src%2Ftest%2Fcompile-fail%2Fstatic-lifetime-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstatic-lifetime-bound.rs?ref=e7949d0013bb8b45c884b173ca22c20e6899d612", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn f<'a: 'static>(_: &'a i32) {} //~WARN unnecessary lifetime parameter `'a`\n+\n+fn main() {\n+    let x = 0;\n+    f(&x); //~ERROR does not live long enough\n+}"}]}