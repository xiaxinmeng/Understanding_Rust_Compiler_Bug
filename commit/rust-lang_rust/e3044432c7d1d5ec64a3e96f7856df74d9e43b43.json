{"sha": "e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMDQ0NDMyYzdkMWQ1ZWM2NGEzZTk2Zjc4NTZkZjc0ZDllNDNiNDM=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-07-07T16:25:46Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-07-08T00:33:36Z"}, "message": "Move [debug_]assert_matches to mod {core, std}::assert.", "tree": {"sha": "b2f1b3c2dcb305a57159dcafc92aee2e9533eb03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2f1b3c2dcb305a57159dcafc92aee2e9533eb03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "html_url": "https://github.com/rust-lang/rust/commit/e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5e344f7747dbd7e7d4b209e3c480deb5979a56f", "html_url": "https://github.com/rust-lang/rust/commit/c5e344f7747dbd7e7d4b209e3c480deb5979a56f"}], "stats": {"total": 51, "additions": 36, "deletions": 15}, "files": [{"sha": "1c66f831b5f4b40b705d0b5b8901c6661a6ba4f3", "filename": "compiler/rustc_middle/src/ich/impls_syntax.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fich%2Fimpls_syntax.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -6,6 +6,7 @@ use crate::ich::StableHashingContext;\n use rustc_ast as ast;\n use rustc_data_structures::stable_hasher::{HashStable, StableHasher};\n use rustc_span::{BytePos, NormalizedPos, SourceFile};\n+use std::assert::assert_matches;\n \n use smallvec::SmallVec;\n "}, {"sha": "4ac0e4efb3b5f68adfee7e0991690bad5913108b", "filename": "compiler/rustc_mir/src/interpret/memory.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Finterpret%2Fmemory.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -6,6 +6,7 @@\n //! integer. It is crucial that these operations call `check_align` *before*\n //! short-circuiting the empty case!\n \n+use std::assert::assert_matches;\n use std::borrow::Cow;\n use std::collections::VecDeque;\n use std::convert::{TryFrom, TryInto};"}, {"sha": "01d33409a423800c730ea7644a6dd1517056d2fc", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -179,6 +179,16 @@ use prelude::v1::*;\n #[macro_use]\n mod macros;\n \n+// We don't export this through #[macro_export] for now, to avoid breakage.\n+// See https://github.com/rust-lang/rust/issues/82913\n+#[cfg(not(test))]\n+#[unstable(feature = \"assert_matches\", issue = \"82775\")]\n+/// Unstable module containing the unstable `assert_matches` macro.\n+pub mod assert {\n+    #[unstable(feature = \"assert_matches\", issue = \"82775\")]\n+    pub use crate::macros::{assert_matches, debug_assert_matches};\n+}\n+\n #[macro_use]\n mod internal_macros;\n "}, {"sha": "5a8e2f543921b59ee196f197fdc3698e7b241db0", "filename": "library/core/src/macros/mod.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -126,6 +126,8 @@ macro_rules! assert_ne {\n /// ```\n /// #![feature(assert_matches)]\n ///\n+/// use std::assert::assert_matches;\n+///\n /// let a = 1u32.checked_add(2);\n /// let b = 1u32.checked_sub(2);\n /// assert_matches!(a, Some(_));\n@@ -134,10 +136,10 @@ macro_rules! assert_ne {\n /// let c = Ok(\"abc\".to_string());\n /// assert_matches!(c, Ok(x) | Err(x) if x.len() < 100);\n /// ```\n-#[macro_export]\n #[unstable(feature = \"assert_matches\", issue = \"82775\")]\n #[allow_internal_unstable(core_panic)]\n-macro_rules! assert_matches {\n+#[rustc_macro_transparency = \"semitransparent\"]\n+pub macro assert_matches {\n     ($left:expr, $( $pattern:pat_param )|+ $( if $guard: expr )? $(,)?) => ({\n         match $left {\n             $( $pattern )|+ $( if $guard )? => {}\n@@ -149,7 +151,7 @@ macro_rules! assert_matches {\n                 );\n             }\n         }\n-    });\n+    }),\n     ($left:expr, $( $pattern:pat_param )|+ $( if $guard: expr )?, $($arg:tt)+) => ({\n         match $left {\n             $( $pattern )|+ $( if $guard )? => {}\n@@ -161,7 +163,7 @@ macro_rules! assert_matches {\n                 );\n             }\n         }\n-    });\n+    }),\n }\n \n /// Asserts that a boolean expression is `true` at runtime.\n@@ -283,6 +285,8 @@ macro_rules! debug_assert_ne {\n /// ```\n /// #![feature(assert_matches)]\n ///\n+/// use std::assert::debug_assert_matches;\n+///\n /// let a = 1u32.checked_add(2);\n /// let b = 1u32.checked_sub(2);\n /// debug_assert_matches!(a, Some(_));\n@@ -294,8 +298,9 @@ macro_rules! debug_assert_ne {\n #[macro_export]\n #[unstable(feature = \"assert_matches\", issue = \"82775\")]\n #[allow_internal_unstable(assert_matches)]\n-macro_rules! debug_assert_matches {\n-    ($($arg:tt)*) => (if $crate::cfg!(debug_assertions) { $crate::assert_matches!($($arg)*); })\n+#[rustc_macro_transparency = \"semitransparent\"]\n+pub macro debug_assert_matches($($arg:tt)*) {\n+    if $crate::cfg!(debug_assertions) { $crate::assert::assert_matches!($($arg)*); }\n }\n \n /// Returns whether the given expression matches any of the given patterns."}, {"sha": "472bca3460f4678d5d404d6b36279b7be5b9250b", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -548,8 +548,8 @@ pub use std_detect::{\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[allow(deprecated, deprecated_in_future)]\n pub use core::{\n-    assert_eq, assert_matches, assert_ne, debug_assert, debug_assert_eq, debug_assert_matches,\n-    debug_assert_ne, matches, r#try, todo, unimplemented, unreachable, write, writeln,\n+    assert_eq, assert_ne, debug_assert, debug_assert_eq, debug_assert_ne, matches, r#try, todo,\n+    unimplemented, unreachable, write, writeln,\n };\n \n // Re-export built-in macros defined through libcore."}, {"sha": "714a6561a6d0990b0bc2255b6b2b0105deb617f2", "filename": "src/test/ui/macros/assert-matches-macro-msg.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fmacros%2Fassert-matches-macro-msg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fmacros%2Fassert-matches-macro-msg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fassert-matches-macro-msg.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -6,6 +6,8 @@\n \n #![feature(assert_matches)]\n \n+use std::assert::assert_matches;\n+\n fn main() {\n     assert_matches!(1 + 1, 3, \"1 + 1 definitely should be 3\");\n }"}, {"sha": "a6fa5128d2f862d66136cdc22e98883f9ed56ed1", "filename": "src/test/ui/matches2021.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fmatches2021.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fmatches2021.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatches2021.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -6,6 +6,8 @@\n \n #![feature(assert_matches)]\n \n+use std::assert::assert_matches;\n+\n fn main() {\n     assert!(matches!((), ()));\n     assert_matches!((), ());"}, {"sha": "5532c8b90e32685aecd7ff4f252860c585c92567", "filename": "src/test/ui/resolve/resolve-hint-macro.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.rs?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -1,4 +1,4 @@\n fn main() {\n-    assert(true);\n-    //~^ ERROR expected function, found macro `assert`\n+    assert_eq(1, 1);\n+    //~^ ERROR expected function, found macro `assert_eq`\n }"}, {"sha": "efcfc7198ab51291f49e763c4627838e83298457", "filename": "src/test/ui/resolve/resolve-hint-macro.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e3044432c7d1d5ec64a3e96f7856df74d9e43b43/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fresolve-hint-macro.stderr?ref=e3044432c7d1d5ec64a3e96f7856df74d9e43b43", "patch": "@@ -1,13 +1,13 @@\n-error[E0423]: expected function, found macro `assert`\n+error[E0423]: expected function, found macro `assert_eq`\n   --> $DIR/resolve-hint-macro.rs:2:5\n    |\n-LL |     assert(true);\n-   |     ^^^^^^ not a function\n+LL |     assert_eq(1, 1);\n+   |     ^^^^^^^^^ not a function\n    |\n help: use `!` to invoke the macro\n    |\n-LL |     assert!(true);\n-   |           ^\n+LL |     assert_eq!(1, 1);\n+   |              ^\n \n error: aborting due to previous error\n "}]}