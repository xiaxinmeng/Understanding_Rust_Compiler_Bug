{"sha": "840e50e97f023c2d0bfeb0222d094fa407f12f2f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0MGU1MGU5N2YwMjNjMmQwYmZlYjAyMjJkMDk0ZmE0MDdmMTJmMmY=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-27T13:37:56Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-27T13:47:56Z"}, "message": "Don't expand macro in or_fun_call suggestion", "tree": {"sha": "8015c49a611aa4a36c00c273f49272ebe9b79b69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8015c49a611aa4a36c00c273f49272ebe9b79b69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/840e50e97f023c2d0bfeb0222d094fa407f12f2f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlvUbIwACgkQtvoGpuDi\nZlsnYQ/9GNdhdFl1WtFxcsYVn0fd1ih3A7G+IQ63QDmsmnvh7Ul+5UhuhaANDd3t\nLBZ9yLpSYeB0B55oKc+VNP+XFAGx7bvnXriG7RBhPKswCHDgqGOixdxjLpmCiPzX\nVxqbA5FbPm4cvRBZVbXu8MApxxDXgC7cSgGgBI1D1uy9Y4VTq3pQGbLvQ22GzcIG\n2RW4CUaHCuv6l2Kj0PLtOVeMvS2yq015uanhxFGcJ4L3NcWAAmPLLP5Qf9ZtLBaS\nLs1h/6WwuE6XoG8nWJQBJbawPxkRBbzfsJoNGX/5/NDfcIrN6emNWKjY+7di7gq1\nup8Puuuw2/8EipE0558Bou5pxaq5Yu6ug9LMRTXEjsHkd1EkmQYj/Psoxmic05AC\nA6nlm7OwDFxy7lhwhvE9Kn/92pSwzCeOScmRSCtiUDjLZmRREtmksUbzOaLWLPeT\np+/8LqIL3VqbJzl/byTrhq4/VmvHsfCySPXvs6p4OGsR9LdIojB2bfSZq3b0w2aJ\n220rdTa2yjFPnRsQDdBKXONcsY0d6eqJaG7USIiB30FD5EKSb7eTUZvelMUUlANO\nMmx4hTWskTK9T7I3GKI8VhJ2ke7kDD8A1W0nhcBdZEXeSOPHU8XfxyNU3n78OsDI\nuLOFnoNjWJkJe+jM8zrULJUoFKnLI+p5y3hYsUlMGZYZFdKy9O8=\n=Edcf\n-----END PGP SIGNATURE-----", "payload": "tree 8015c49a611aa4a36c00c273f49272ebe9b79b69\nparent af1548f58f2a9a356a7c122f2fba25c816492a91\nauthor Philipp Hansch <dev@phansch.net> 1540647476 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1540648076 +0200\n\nDon't expand macro in or_fun_call suggestion\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/840e50e97f023c2d0bfeb0222d094fa407f12f2f", "html_url": "https://github.com/rust-lang/rust/commit/840e50e97f023c2d0bfeb0222d094fa407f12f2f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/840e50e97f023c2d0bfeb0222d094fa407f12f2f/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af1548f58f2a9a356a7c122f2fba25c816492a91", "url": "https://api.github.com/repos/rust-lang/rust/commits/af1548f58f2a9a356a7c122f2fba25c816492a91", "html_url": "https://github.com/rust-lang/rust/commit/af1548f58f2a9a356a7c122f2fba25c816492a91"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "8d0cd32e23bf46c2cf3ebdadccf2e8859e7c28ef", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/840e50e97f023c2d0bfeb0222d094fa407f12f2f/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/840e50e97f023c2d0bfeb0222d094fa407f12f2f/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=840e50e97f023c2d0bfeb0222d094fa407f12f2f", "patch": "@@ -21,7 +21,7 @@ use crate::utils::sugg;\n use crate::utils::{\n     get_arg_name, get_trait_def_id, implements_trait, in_macro, is_copy, is_expn_of, is_self, is_self_ty,\n     iter_input_pats, last_path_segment, match_def_path, match_path, match_qpath, match_trait_method, match_type,\n-    match_var, method_chain_args, remove_blocks, return_ty, same_tys, single_segment_path, snippet, span_lint,\n+    match_var, method_chain_args, remove_blocks, return_ty, same_tys, single_segment_path, snippet, snippet_with_macro_callsite, span_lint,\n     span_lint_and_sugg, span_lint_and_then, span_note_and_lint, walk_ptrs_ty, walk_ptrs_ty_depth, SpanlessEq,\n };\n use if_chain::if_chain;\n@@ -1062,9 +1062,9 @@ fn lint_or_fun_call(cx: &LateContext<'_, '_>, expr: &hir::Expr, method_span: Spa\n         }\n \n         let sugg: Cow<'_, _> = match (fn_has_arguments, !or_has_args) {\n-            (true, _) => format!(\"|_| {}\", snippet(cx, arg.span, \"..\")).into(),\n-            (false, false) => format!(\"|| {}\", snippet(cx, arg.span, \"..\")).into(),\n-            (false, true) => snippet(cx, fun_span, \"..\"),\n+            (true, _) => format!(\"|_| {}\", snippet_with_macro_callsite(cx, arg.span, \"..\")).into(),\n+            (false, false) => format!(\"|| {}\", snippet_with_macro_callsite(cx, arg.span, \"..\")).into(),\n+            (false, true) => snippet_with_macro_callsite(cx, fun_span, \"..\"),\n         };\n         let span_replace_word = method_span.with_hi(span.hi());\n         span_lint_and_sugg("}, {"sha": "896b15481bb49bf3102377ab9a731ee4dc552e6e", "filename": "tests/ui/methods.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/840e50e97f023c2d0bfeb0222d094fa407f12f2f/tests%2Fui%2Fmethods.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/840e50e97f023c2d0bfeb0222d094fa407f12f2f/tests%2Fui%2Fmethods.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmethods.stderr?ref=840e50e97f023c2d0bfeb0222d094fa407f12f2f", "patch": "@@ -297,7 +297,7 @@ error: use of `unwrap_or` followed by a function call\n    --> $DIR/methods.rs:339:14\n     |\n 339 |     with_vec.unwrap_or(vec![]);\n-    |              ^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| < [ _ ] > :: into_vec ( box [ $ ( $ x ) , * ] ))`\n+    |              ^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| vec![])`\n \n error: use of `unwrap_or` followed by a function call\n    --> $DIR/methods.rs:344:21"}]}