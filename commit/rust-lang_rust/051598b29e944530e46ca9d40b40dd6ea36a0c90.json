{"sha": "051598b29e944530e46ca9d40b40dd6ea36a0c90", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MTU5OGIyOWU5NDQ1MzBlNDZjYTlkNDBiNDBkZDZlYTM2YTBjOTA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-08-14T02:18:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-08-14T02:18:52Z"}, "message": "Rollup merge of #63511 - pietroalbini:pa-ci-date, r=Mark-Simulacrum\n\nci: add a check for clock drift\n\nRecently we encountered multiple spurious failures where the crates.io\ncertificate was reported as expired, even though it's currently due to\nexpire in a few months. This adds some code to our CI to check for clock\ndrifts, to possibly find the cause or rule out a bad VM clock.\n\ncc https://github.com/rust-lang/rust/issues/63510\nr? @Mark-Simulacrum", "tree": {"sha": "3dd6da935fec35b2a4f254bb7f68e62f97528be7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3dd6da935fec35b2a4f254bb7f68e62f97528be7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/051598b29e944530e46ca9d40b40dd6ea36a0c90", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdU2+MCRBK7hj4Ov3rIwAAdHIIAKTMTgOBHU6unv7LFXAVskjC\nxbxDgNDAVvlY5vheYyb9PIi9rJFRFyv0IcSdMWfNQBs/47GKpS4uM8lw2uBVN2SZ\noChbLrxkeC21NvE4lji+8WW2kAUOMxd0zJRoY+6mAA3ap0EgLs3GLp6xpPIGZYfW\nRyBJXVXN+r3V9pla6BgeJXgjmeyAk1ZqvctZ4nDev7UhVOx6r9H90gETzLXCBX4D\norKb2bvoN9CtQY4oN5fmoou2D9f7PVIYEd6ZNBKzXUG8Oh8xTgoKI/tt/TxKkzWe\nRN5lHBcs3d/cfKwUi99vLeBX6Ck9HSRS0uTa345YaBoO5Xy8bl5aRAG3iRIXN4w=\n=7lbE\n-----END PGP SIGNATURE-----\n", "payload": "tree 3dd6da935fec35b2a4f254bb7f68e62f97528be7\nparent 43f4990fc468ef922dbe2ab16b396fd51054a708\nparent 686553dfce92eb35b3709f64b687c2757334df86\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1565749132 +0200\ncommitter GitHub <noreply@github.com> 1565749132 +0200\n\nRollup merge of #63511 - pietroalbini:pa-ci-date, r=Mark-Simulacrum\n\nci: add a check for clock drift\n\nRecently we encountered multiple spurious failures where the crates.io\ncertificate was reported as expired, even though it's currently due to\nexpire in a few months. This adds some code to our CI to check for clock\ndrifts, to possibly find the cause or rule out a bad VM clock.\n\ncc https://github.com/rust-lang/rust/issues/63510\nr? @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/051598b29e944530e46ca9d40b40dd6ea36a0c90", "html_url": "https://github.com/rust-lang/rust/commit/051598b29e944530e46ca9d40b40dd6ea36a0c90", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/051598b29e944530e46ca9d40b40dd6ea36a0c90/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43f4990fc468ef922dbe2ab16b396fd51054a708", "url": "https://api.github.com/repos/rust-lang/rust/commits/43f4990fc468ef922dbe2ab16b396fd51054a708", "html_url": "https://github.com/rust-lang/rust/commit/43f4990fc468ef922dbe2ab16b396fd51054a708"}, {"sha": "686553dfce92eb35b3709f64b687c2757334df86", "url": "https://api.github.com/repos/rust-lang/rust/commits/686553dfce92eb35b3709f64b687c2757334df86", "html_url": "https://github.com/rust-lang/rust/commit/686553dfce92eb35b3709f64b687c2757334df86"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "457ba9717120710623411d44e7d8afdca1831882", "filename": "src/ci/run.sh", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/051598b29e944530e46ca9d40b40dd6ea36a0c90/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/051598b29e944530e46ca9d40b40dd6ea36a0c90/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=051598b29e944530e46ca9d40b40dd6ea36a0c90", "patch": "@@ -78,6 +78,21 @@ if [ \"$RUST_RELEASE_CHANNEL\" = \"nightly\" ] || [ \"$DIST_REQUIRE_ALL_TOOLS\" = \"\" ]\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-missing-tools\"\n fi\n \n+# Print the date from the local machine and the date from an external source to\n+# check for clock drifts. An HTTP URL is used instead of HTTPS since on Azure\n+# Pipelines it happened that the certificates were marked as expired.\n+datecheck() {\n+  echo \"== clock drift check ==\"\n+  echo -n \"  local time: \"\n+  date\n+  echo -n \"  network time: \"\n+  curl -fs --head http://detectportal.firefox.com/success.txt | grep ^Date: \\\n+      | sed 's/Date: //g' || true\n+  echo \"== end clock drift check ==\"\n+}\n+datecheck\n+trap datecheck EXIT\n+\n # We've had problems in the past of shell scripts leaking fds into the sccache\n # server (#48192) which causes Cargo to erroneously think that a build script\n # hasn't finished yet. Try to solve that problem by starting a very long-lived"}]}