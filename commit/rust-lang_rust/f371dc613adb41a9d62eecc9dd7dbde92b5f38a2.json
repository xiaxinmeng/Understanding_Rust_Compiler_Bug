{"sha": "f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzNzFkYzYxM2FkYjQxYTlkNjJlZWNjOWRkN2RiZGU5MmI1ZjM4YTI=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-03T21:51:46Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-03T21:52:54Z"}, "message": "rustc: Set data layout and target triple", "tree": {"sha": "b0ef7da69050eab1c4d888194b9c3b16258995b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0ef7da69050eab1c4d888194b9c3b16258995b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "html_url": "https://github.com/rust-lang/rust/commit/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aeef8cee2904cc52e00fc34bcd370c38e8615fa8", "url": "https://api.github.com/repos/rust-lang/rust/commits/aeef8cee2904cc52e00fc34bcd370c38e8615fa8", "html_url": "https://github.com/rust-lang/rust/commit/aeef8cee2904cc52e00fc34bcd370c38e8615fa8"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "ac52fca5baf2b4b75eb1e0c83a9fea9ea71a5a71", "filename": "src/comp/back/x86.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2/src%2Fcomp%2Fback%2Fx86.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2/src%2Fcomp%2Fback%2Fx86.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Fx86.rs?ref=f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "patch": "@@ -157,6 +157,26 @@ fn get_module_asm() -> str {\n     ret _str.connect(glues, \"\\n\\n\");\n }\n \n+fn get_data_layout() -> str {\n+    if (_str.eq(target_os(), \"macos\")) {\n+      ret \"e-p:32:32-f64:32:64-i64:32:64-f80:128:128-n8:16:32\";\n+    }\n+    if (_str.eq(target_os(), \"win32\")) {\n+      ret \"e-p:32:32-f64:64:64-i64:64:64-f80:32:32-n8:16:32\";\n+    }\n+    ret \"e-p:32:32-f64:32:64-i64:32:64-f80:32:32-n8:16:32\";\n+}\n+\n+fn get_target_triple() -> str {\n+    if (_str.eq(target_os(), \"macos\")) {\n+        ret \"i686-apple-darwin\";\n+    }\n+    if (_str.eq(target_os(), \"win32\")) {\n+        ret \"i686-pc-mingw32\";\n+    }\n+    ret \"i686-pc-linux-gnu\";\n+}\n+\n \n //\n // Local Variables:"}, {"sha": "9b6fa0abad95ce216cfb9888631972679d65ba2b", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f371dc613adb41a9d62eecc9dd7dbde92b5f38a2/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=f371dc613adb41a9d62eecc9dd7dbde92b5f38a2", "patch": "@@ -2151,6 +2151,9 @@ fn trans_crate(session.session sess, @ast.crate crate, str output) {\n         llvm.LLVMModuleCreateWithNameInContext(_str.buf(\"rust_out\"),\n                                                llvm.LLVMGetGlobalContext());\n \n+    llvm.LLVMSetDataLayout(llmod, _str.buf(x86.get_data_layout()));\n+    llvm.LLVMSetTarget(llmod, _str.buf(x86.get_target_triple()));\n+\n     llvm.LLVMSetModuleInlineAsm(llmod, _str.buf(x86.get_module_asm()));\n \n     auto intrinsics = declare_intrinsics(llmod);"}]}