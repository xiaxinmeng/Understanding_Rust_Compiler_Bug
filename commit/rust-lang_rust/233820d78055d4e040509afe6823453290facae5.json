{"sha": "233820d78055d4e040509afe6823453290facae5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzMzgyMGQ3ODA1NWQ0ZTA0MDUwOWFmZTY4MjM0NTMyOTBmYWNhZTU=", "commit": {"author": {"name": "Conrad Ludgate", "email": "conradludgate@gmail.com", "date": "2021-03-11T10:36:45Z"}, "committer": {"name": "Conrad Ludgate", "email": "conradludgate@gmail.com", "date": "2021-03-11T10:36:45Z"}, "message": "fix: add semicolon after type ascription", "tree": {"sha": "1535e87e9279ba6047891aab1a84efb437dc54db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1535e87e9279ba6047891aab1a84efb437dc54db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/233820d78055d4e040509afe6823453290facae5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE6pcFW95LJgarInbuPdGh2zy0v2MFAmBJ8r0ACgkQPdGh2zy0\nv2Nmuw/9EQykmnyf15ls44xrjfNBbZI+cBr0BA3AEI8N4hN7ZqAAxVpp3LzoXJzg\nuy1T+mTzYCZy6s0Ys+btnf6DyvNb6jD9PbCB1OtoWG4Sc2qwmSyz/SQSWBTdlFOs\nC+JxElWlqnRQ9iAIAsjHy88ZaU6ysEODDOmiLMUO7k1MRqpT+uucMqWEo2+X1iFR\n8OLYNsHCTdbLG/lyUpAtJSeCZOzVyxuLw0nn68TqpdKbc0HFpWQA7iDdF7C4ih8N\nFVH0bz9EAzkj5TmGAmNfd1/Ysm2vPj8lPo0s+BIGxk4yvf5rsthpvuBVeBM1yttu\nrE20hvSNBJRgqnTzkfSwC0TBXP9VskIF8gzhhBDLAdCVAJrkNHbOBDqpokXdKFHi\nTxdLu/spB/+H8QGKRe1qOZSpoI8r6eOhPns4U0OuiA7Y9gjYmvFoLRmhd2aEU/1d\n9x/5gV+CxyVUsNPVBJTsiO/UH4yaPY+mXAMW4cP9CMOZ8WizjMEebHGySwpphNvz\nYg+9PEnlmPVg4jtXQtkAgOZTBQ0VNfo0PB8NUrIhOjz6IIfDsKYRB1AuiJ161my+\n/wF1Sz1m41RzCouMMXDuNjNb/wPU0aC1j3tf36gjBiXYS61SMcHBX7oUz3r6jUVx\nz4E4ZdW8WFRwmP+j+680Zn/oMpg3lVLcGG7KzZk/8cH1um2OQ6g=\n=Y43Q\n-----END PGP SIGNATURE-----", "payload": "tree 1535e87e9279ba6047891aab1a84efb437dc54db\nparent 610eba33207a22611e914b2f52ba4850f1dba427\nauthor Conrad Ludgate <conradludgate@gmail.com> 1615459005 +0000\ncommitter Conrad Ludgate <conradludgate@gmail.com> 1615459005 +0000\n\nfix: add semicolon after type ascription\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/233820d78055d4e040509afe6823453290facae5", "html_url": "https://github.com/rust-lang/rust/commit/233820d78055d4e040509afe6823453290facae5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/233820d78055d4e040509afe6823453290facae5/comments", "author": {"login": "conradludgate", "id": 6625462, "node_id": "MDQ6VXNlcjY2MjU0NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/6625462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/conradludgate", "html_url": "https://github.com/conradludgate", "followers_url": "https://api.github.com/users/conradludgate/followers", "following_url": "https://api.github.com/users/conradludgate/following{/other_user}", "gists_url": "https://api.github.com/users/conradludgate/gists{/gist_id}", "starred_url": "https://api.github.com/users/conradludgate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/conradludgate/subscriptions", "organizations_url": "https://api.github.com/users/conradludgate/orgs", "repos_url": "https://api.github.com/users/conradludgate/repos", "events_url": "https://api.github.com/users/conradludgate/events{/privacy}", "received_events_url": "https://api.github.com/users/conradludgate/received_events", "type": "User", "site_admin": false}, "committer": {"login": "conradludgate", "id": 6625462, "node_id": "MDQ6VXNlcjY2MjU0NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/6625462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/conradludgate", "html_url": "https://github.com/conradludgate", "followers_url": "https://api.github.com/users/conradludgate/followers", "following_url": "https://api.github.com/users/conradludgate/following{/other_user}", "gists_url": "https://api.github.com/users/conradludgate/gists{/gist_id}", "starred_url": "https://api.github.com/users/conradludgate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/conradludgate/subscriptions", "organizations_url": "https://api.github.com/users/conradludgate/orgs", "repos_url": "https://api.github.com/users/conradludgate/repos", "events_url": "https://api.github.com/users/conradludgate/events{/privacy}", "received_events_url": "https://api.github.com/users/conradludgate/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "610eba33207a22611e914b2f52ba4850f1dba427", "url": "https://api.github.com/repos/rust-lang/rust/commits/610eba33207a22611e914b2f52ba4850f1dba427", "html_url": "https://github.com/rust-lang/rust/commit/610eba33207a22611e914b2f52ba4850f1dba427"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "ee879c15197bad428c57294f8884f5d858a71e0d", "filename": "crates/ide_assists/src/handlers/add_turbo_fish.rs", "status": "modified", "additions": 30, "deletions": 3, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/233820d78055d4e040509afe6823453290facae5/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_turbo_fish.rs", "raw_url": "https://github.com/rust-lang/rust/raw/233820d78055d4e040509afe6823453290facae5/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_turbo_fish.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fadd_turbo_fish.rs?ref=233820d78055d4e040509afe6823453290facae5", "patch": "@@ -56,13 +56,20 @@ pub(crate) fn add_turbo_fish(acc: &mut Assists, ctx: &AssistContext) -> Option<(\n     if let Some(let_stmt) = ctx.find_node_at_offset::<ast::LetStmt>() {\n         if let_stmt.colon_token().is_none() {\n             let type_pos = let_stmt.pat()?.syntax().last_token()?.text_range().end();\n+            let semi_pos = let_stmt.syntax().last_token()?.text_range().end();\n+\n             acc.add(\n                 AssistId(\"add_type_ascription\", AssistKind::RefactorRewrite),\n                 \"Add `: _` before assignment operator\",\n                 ident.text_range(),\n-                |builder| match ctx.config.snippet_cap {\n-                    Some(cap) => builder.insert_snippet(cap, type_pos, \": ${0:_}\"),\n-                    None => builder.insert(type_pos, \": _\"),\n+                |builder| {\n+                    if let_stmt.semicolon_token().is_none() {\n+                        builder.insert(semi_pos, \";\");\n+                    }\n+                    match ctx.config.snippet_cap {\n+                        Some(cap) => builder.insert_snippet(cap, type_pos, \": ${0:_}\"),\n+                        None => builder.insert(type_pos, \": _\"),\n+                    }\n                 },\n             )?\n         } else {\n@@ -265,4 +272,24 @@ fn main() {\n \"#,\n         );\n     }\n+\n+    #[test]\n+    fn add_type_ascription_append_semicolon() {\n+        check_assist_by_label(\n+            add_turbo_fish,\n+            r#\"\n+fn make<T>() -> T {}\n+fn main() {\n+    let x = make$0()\n+}\n+\"#,\n+            r#\"\n+fn make<T>() -> T {}\n+fn main() {\n+    let x: ${0:_} = make();\n+}\n+\"#,\n+            \"Add `: _` before assignment operator\",\n+        );\n+    }\n }"}]}