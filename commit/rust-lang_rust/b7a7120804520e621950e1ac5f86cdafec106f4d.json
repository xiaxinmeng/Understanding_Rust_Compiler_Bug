{"sha": "b7a7120804520e621950e1ac5f86cdafec106f4d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3YTcxMjA4MDQ1MjBlNjIxOTUwZTFhYzVmODZjZGFmZWMxMDZmNGQ=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-07-20T18:52:31Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-07-20T18:55:01Z"}, "message": "give rust_metadata internal linkage but mark it as used. This allows\nmultiple static crates to be used.", "tree": {"sha": "6b6f6fd694b7dd45f77c656c0ab91a560887087f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6b6f6fd694b7dd45f77c656c0ab91a560887087f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7a7120804520e621950e1ac5f86cdafec106f4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7a7120804520e621950e1ac5f86cdafec106f4d", "html_url": "https://github.com/rust-lang/rust/commit/b7a7120804520e621950e1ac5f86cdafec106f4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7a7120804520e621950e1ac5f86cdafec106f4d/comments", "author": null, "committer": null, "parents": [{"sha": "a467e8e4e6981208b0de4e5fb44885f12c390412", "url": "https://api.github.com/repos/rust-lang/rust/commits/a467e8e4e6981208b0de4e5fb44885f12c390412", "html_url": "https://github.com/rust-lang/rust/commit/a467e8e4e6981208b0de4e5fb44885f12c390412"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "14d102ca8ce2d734eba142af9aa931e24694e6eb", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b7a7120804520e621950e1ac5f86cdafec106f4d/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a7120804520e621950e1ac5f86cdafec106f4d/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=b7a7120804520e621950e1ac5f86cdafec106f4d", "patch": "@@ -8564,6 +8564,17 @@ fn write_metadata(&@trans::crate_ctxt cx, &@ast::crate crate) {\n                             str::buf(\"rust_metadata\"));\n     llvm::LLVMSetInitializer(llglobal, llconst);\n     llvm::LLVMSetSection(llglobal, str::buf(x86::get_meta_sect_name()));\n+    llvm::LLVMSetLinkage(llglobal,\n+                         lib::llvm::LLVMInternalLinkage as llvm::Linkage);\n+\n+    auto t_ptr_i8 = T_ptr(T_i8());\n+    llglobal = llvm::LLVMConstBitCast(llglobal, t_ptr_i8);\n+    auto llvm_used =\n+        llvm::LLVMAddGlobal(cx.llmod, T_array(t_ptr_i8, 1u),\n+                            str::buf(\"llvm_used\"));\n+    llvm::LLVMSetLinkage(llvm_used,\n+                         lib::llvm::LLVMAppendingLinkage as llvm::Linkage);\n+    llvm::LLVMSetInitializer(llvm_used, C_array(t_ptr_i8, ~[llglobal]));\n }\n \n fn trans_crate(&session::session sess, &@ast::crate crate, &ty::ctxt tcx,"}]}