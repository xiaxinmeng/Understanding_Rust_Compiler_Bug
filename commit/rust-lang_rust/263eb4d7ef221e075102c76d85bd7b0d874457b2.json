{"sha": "263eb4d7ef221e075102c76d85bd7b0d874457b2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2M2ViNGQ3ZWYyMjFlMDc1MTAyYzc2ZDg1YmQ3YjBkODc0NDU3YjI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-12-01T17:38:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-12-01T17:38:53Z"}, "message": "Rollup merge of #46280 - tamird:remove-old-refs, r=alexcrichton\n\nrustc_llvm: remove stale references\n\n...that were removed in 77c3bfa7429abf87b76ba84108df018d9e9d90e2.\n\nr? @alexcrichton", "tree": {"sha": "8b15be5f94205e878f47675f56b82fbf910a0d33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b15be5f94205e878f47675f56b82fbf910a0d33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/263eb4d7ef221e075102c76d85bd7b0d874457b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/263eb4d7ef221e075102c76d85bd7b0d874457b2", "html_url": "https://github.com/rust-lang/rust/commit/263eb4d7ef221e075102c76d85bd7b0d874457b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/263eb4d7ef221e075102c76d85bd7b0d874457b2/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95f465d5355f559e9c1955a7e4774dc3e619ed63", "url": "https://api.github.com/repos/rust-lang/rust/commits/95f465d5355f559e9c1955a7e4774dc3e619ed63", "html_url": "https://github.com/rust-lang/rust/commit/95f465d5355f559e9c1955a7e4774dc3e619ed63"}, {"sha": "94d02b896c3feb5e997b95a660e850c7ad8cbe74", "url": "https://api.github.com/repos/rust-lang/rust/commits/94d02b896c3feb5e997b95a660e850c7ad8cbe74", "html_url": "https://github.com/rust-lang/rust/commit/94d02b896c3feb5e997b95a660e850c7ad8cbe74"}], "stats": {"total": 35, "additions": 15, "deletions": 20}, "files": [{"sha": "57407a2399a2f249f85ecf5ad69d05b3888ef481", "filename": ".gitignore", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -95,7 +95,6 @@ config.stamp\n keywords.md\n lexer.ml\n src/etc/dl\n-src/librustc_llvm/llvmdeps.rs\n tmp.*.rs\n version.md\n version.ml"}, {"sha": "a5408ee381bbbb23c2338ce0cdd5eb04316856c5", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -316,7 +316,7 @@ impl Step for TestHelpers {\n            .warnings(false)\n            .debug(false)\n            .file(build.src.join(\"src/rt/rust_test_helpers.c\"))\n-           .compile(\"librust_test_helpers.a\");\n+           .compile(\"rust_test_helpers\");\n     }\n }\n "}, {"sha": "de5006ad3960abc82b2d375fab6a318c6d015660", "filename": "src/liballoc_jemalloc/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Fliballoc_jemalloc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Fliballoc_jemalloc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2Fbuild.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -140,6 +140,6 @@ fn main() {\n         cc::Build::new()\n             .flag(\"-fvisibility=hidden\")\n             .file(\"pthread_atfork_dummy.c\")\n-            .compile(\"libpthread_atfork_dummy.a\");\n+            .compile(\"pthread_atfork_dummy\");\n     }\n }"}, {"sha": "dd88dd933f6911f50ebca356411c774d862e59d5", "filename": "src/libprofiler_builtins/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibprofiler_builtins%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibprofiler_builtins%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibprofiler_builtins%2Fbuild.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -56,5 +56,5 @@ fn main() {\n         cfg.file(Path::new(\"../libcompiler_builtins/compiler-rt/lib/profile\").join(src));\n     }\n \n-    cfg.compile(\"libprofiler-rt.a\");\n+    cfg.compile(\"profiler-rt\");\n }"}, {"sha": "f294ceb3f3832e4d3de518f49665fcf897e9a24b", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -154,13 +154,13 @@ fn main() {\n     }\n \n     for component in &components {\n-        let mut flag = String::from(\"-DLLVM_COMPONENT_\");\n+        let mut flag = String::from(\"LLVM_COMPONENT_\");\n         flag.push_str(&component.to_uppercase());\n-        cfg.flag(&flag);\n+        cfg.define(&flag, None);\n     }\n \n     if env::var_os(\"LLVM_RUSTLLVM\").is_some() {\n-        cfg.flag(\"-DLLVM_RUSTLLVM\");\n+        cfg.define(\"LLVM_RUSTLLVM\", None);\n     }\n \n     build_helper::rerun_if_changed_anything_in_dir(Path::new(\"../rustllvm\"));\n@@ -169,7 +169,7 @@ fn main() {\n        .file(\"../rustllvm/ArchiveWrapper.cpp\")\n        .cpp(true)\n        .cpp_link_stdlib(None) // we handle this below\n-       .compile(\"librustllvm.a\");\n+       .compile(\"rustllvm\");\n \n     let (llvm_kind, llvm_link_arg) = detect_llvm_link(major, minor, &llvm_config);\n "}, {"sha": "1c2fa1bbb484817abd96356c0e63ee402462c979", "filename": "src/librustc_llvm/ffi.rs", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustc_llvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustc_llvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fffi.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -505,17 +505,13 @@ pub mod debuginfo {\n \n pub enum ModuleBuffer {}\n \n-// Link to our native llvm bindings (things that we need to use the C++ api\n-// for) and because llvm is written in C++ we need to link against libstdc++\n-//\n-// You'll probably notice that there is an omission of all LLVM libraries\n-// from this location. This is because the set of LLVM libraries that we\n-// link to is mostly defined by LLVM, and the `llvm-config` tool is used to\n-// figure out the exact set of libraries. To do this, the build system\n-// generates an llvmdeps.rs file next to this one which will be\n-// automatically updated whenever LLVM is updated to include an up-to-date\n-// set of the libraries we need to link to LLVM for.\n-#[link(name = \"rustllvm\", kind = \"static\")] // not quite true but good enough\n+// This annotation is primarily needed for MSVC where attributes like\n+// dllimport/dllexport are applied and need to be correct for everything to\n+// link successfully. The #[link] annotation here says \"these symbols are\n+// included statically\" which means that they're all exported with dllexport\n+// and from the rustc_llvm dynamic library. Otherwise the rustc_trans dynamic\n+// library would not be able to access these symbols.\n+#[link(name = \"rustllvm\", kind = \"static\")]\n extern \"C\" {\n     // Create and destroy contexts.\n     pub fn LLVMContextCreate() -> ContextRef;"}, {"sha": "276825bd31a75ed41778cf5e8465a45ccdbbb91c", "filename": "src/librustdoc/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustdoc%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/263eb4d7ef221e075102c76d85bd7b0d874457b2/src%2Flibrustdoc%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fbuild.rs?ref=263eb4d7ef221e075102c76d85bd7b0d874457b2", "patch": "@@ -27,6 +27,6 @@ fn main() {\n        .warnings(false)\n        .include(src_dir)\n        .warnings(false)\n-       .compile(\"libhoedown.a\");\n+       .compile(\"hoedown\");\n }\n "}]}