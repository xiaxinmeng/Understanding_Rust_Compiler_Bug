{"sha": "3e7a5145219edb786255028b2e03643a7030ecd8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlN2E1MTQ1MjE5ZWRiNzg2MjU1MDI4YjJlMDM2NDNhNzAzMGVjZDg=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2012-03-23T12:30:29Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2012-03-23T12:30:29Z"}, "message": "Fix inconsistent-iteration hazard in map.rs\n\nCloses #2049", "tree": {"sha": "36afd967239cae3c4e0f18c454a5def598f4e40e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36afd967239cae3c4e0f18c454a5def598f4e40e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e7a5145219edb786255028b2e03643a7030ecd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e7a5145219edb786255028b2e03643a7030ecd8", "html_url": "https://github.com/rust-lang/rust/commit/3e7a5145219edb786255028b2e03643a7030ecd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e7a5145219edb786255028b2e03643a7030ecd8/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "683085b3f069b771d48d9ae3f20edb9670451b88", "url": "https://api.github.com/repos/rust-lang/rust/commits/683085b3f069b771d48d9ae3f20edb9670451b88", "html_url": "https://github.com/rust-lang/rust/commit/683085b3f069b771d48d9ae3f20edb9670451b88"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "5722789e64ad8d464a5ca8f8bc975ec2293f7cc4", "filename": "src/libstd/map.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3e7a5145219edb786255028b2e03643a7030ecd8/src%2Flibstd%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e7a5145219edb786255028b2e03643a7030ecd8/src%2Flibstd%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmap.rs?ref=3e7a5145219edb786255028b2e03643a7030ecd8", "patch": "@@ -257,12 +257,16 @@ mod chained {\n         fn size() -> uint { self.count }\n \n         fn insert(k: K, v: V) -> bool {\n-            let nchains = vec::len(self.chains);\n-            let load = {num: (self.count + 1u) as int, den: nchains as int};\n-            // Structural consts would be nice. This is a const 3/4\n-            // load factor that we compare against.\n-            if !util::rational_leq(load, {num:3, den:4}) { rehash(self); }\n-            ret insert(self, k, v);\n+            let grew = insert(self, k, v);\n+            if grew {\n+                let nchains = vec::len(self.chains);\n+                let load = {num: (self.count + 1u) as int,\n+                            den: nchains as int};\n+                // Structural consts would be nice. This is a const 3/4\n+                // load factor that we compare against.\n+                if !util::rational_leq(load, {num:3, den:4}) { rehash(self); }\n+            }\n+            grew\n         }\n \n         fn contains_key(k: K) -> bool { option::is_some(get(self, k)) }"}]}