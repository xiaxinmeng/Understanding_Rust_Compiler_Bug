{"sha": "00cf19a75a7055171a4ffc8cc557ff63953c9754", "node_id": "C_kwDOAAsO6NoAKDAwY2YxOWE3NWE3MDU1MTcxYTRmZmM4Y2M1NTdmZjYzOTUzYzk3NTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-12T14:28:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-12T14:28:43Z"}, "message": "Auto merge of #107933 - petrochenkov:rmdlc, r=GuillaumeGomez\n\nrustdoc: Remove cache for preprocessed markdown links\n\nIt's quite possible that it's no longer useful after https://github.com/rust-lang/rust/pull/94857 is merged.", "tree": {"sha": "c65f6e55e3aaf0fec52860a166ebb90b4ab8cd13", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c65f6e55e3aaf0fec52860a166ebb90b4ab8cd13"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00cf19a75a7055171a4ffc8cc557ff63953c9754", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00cf19a75a7055171a4ffc8cc557ff63953c9754", "html_url": "https://github.com/rust-lang/rust/commit/00cf19a75a7055171a4ffc8cc557ff63953c9754", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00cf19a75a7055171a4ffc8cc557ff63953c9754/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "adb4bfd25d3c1190b0e7433ef945221d8aeea427", "url": "https://api.github.com/repos/rust-lang/rust/commits/adb4bfd25d3c1190b0e7433ef945221d8aeea427", "html_url": "https://github.com/rust-lang/rust/commit/adb4bfd25d3c1190b0e7433ef945221d8aeea427"}, {"sha": "0e61d3ab3f6205ce0906837be25d5cf3ec1b2730", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e61d3ab3f6205ce0906837be25d5cf3ec1b2730", "html_url": "https://github.com/rust-lang/rust/commit/0e61d3ab3f6205ce0906837be25d5cf3ec1b2730"}], "stats": {"total": 17, "additions": 2, "deletions": 15}, "files": [{"sha": "a26c25c978277de62e5323e5c7664d5773c62aa0", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=00cf19a75a7055171a4ffc8cc557ff63953c9754", "patch": "@@ -27,13 +27,11 @@ use crate::clean::inline::build_external_trait;\n use crate::clean::{self, ItemId};\n use crate::config::{Options as RustdocOptions, OutputFormat, RenderOptions};\n use crate::formats::cache::Cache;\n-use crate::passes::collect_intra_doc_links::PreprocessedMarkdownLink;\n use crate::passes::{self, Condition::*};\n \n pub(crate) use rustc_session::config::{Input, Options, UnstableOptions};\n \n pub(crate) struct ResolverCaches {\n-    pub(crate) markdown_links: Option<FxHashMap<String, Vec<PreprocessedMarkdownLink>>>,\n     pub(crate) all_trait_impls: Option<Vec<DefId>>,\n     pub(crate) all_macro_rules: FxHashMap<Symbol, Res<NodeId>>,\n     pub(crate) extern_doc_reachable: DefIdSet,"}, {"sha": "779cbaa680226cb5bb151853b3e7f719d2d81efe", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=00cf19a75a7055171a4ffc8cc557ff63953c9754", "patch": "@@ -807,22 +807,12 @@ impl<'a, 'tcx> DocVisitor for LinkCollector<'a, 'tcx> {\n             // NOTE: if there are links that start in one crate and end in another, this will not resolve them.\n             // This is a degenerate case and it's not supported by rustdoc.\n             let parent_node = parent_module.or(parent_node);\n-            let mut tmp_links = self\n-                .cx\n-                .resolver_caches\n-                .markdown_links\n-                .take()\n-                .expect(\"`markdown_links` are already borrowed\");\n-            if !tmp_links.contains_key(&doc) {\n-                tmp_links.insert(doc.clone(), preprocessed_markdown_links(&doc));\n-            }\n-            for md_link in &tmp_links[&doc] {\n-                let link = self.resolve_link(item, &doc, parent_node, md_link);\n+            for md_link in preprocessed_markdown_links(&doc) {\n+                let link = self.resolve_link(item, &doc, parent_node, &md_link);\n                 if let Some(link) = link {\n                     self.cx.cache.intra_doc_links.entry(item.item_id).or_default().push(link);\n                 }\n             }\n-            self.cx.resolver_caches.markdown_links = Some(tmp_links);\n         }\n \n         if item.is_mod() {"}, {"sha": "ec449e94ce587612be11ddbd4c768af6e9b55e81", "filename": "src/librustdoc/passes/collect_intra_doc_links/early.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00cf19a75a7055171a4ffc8cc557ff63953c9754/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs?ref=00cf19a75a7055171a4ffc8cc557ff63953c9754", "patch": "@@ -24,7 +24,6 @@ pub(crate) fn early_resolve_intra_doc_links(\n     link_resolver.process_extern_impls();\n \n     ResolverCaches {\n-        markdown_links: Some(Default::default()),\n         all_trait_impls: Some(link_resolver.all_trait_impls),\n         all_macro_rules: link_resolver.all_macro_rules,\n         extern_doc_reachable: link_resolver.extern_doc_reachable,"}]}