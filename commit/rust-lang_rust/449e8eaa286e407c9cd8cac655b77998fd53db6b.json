{"sha": "449e8eaa286e407c9cd8cac655b77998fd53db6b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0OWU4ZWFhMjg2ZTQwN2M5Y2Q4Y2FjNjU1Yjc3OTk4ZmQ1M2RiNmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-10T18:02:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-10T18:02:34Z"}, "message": "Auto merge of #73213 - ehuss:fix-emsdk, r=Mark-Simulacrum\n\nFix emcc failure for wasm32.\n\nThe wasm32 job is currently failing on CI with the error `ERROR: llc executable not found at /usr/bin/llc`.  The issue is that https://github.com/emscripten-core/emsdk/pull/472 has changed how emsdk discovers its configuration.  We were relying on the global behavior that would use a configuration from the home directory.  However, it looks like emsdk is moving away from that approach.  This change adds the necessary env var for emcc to find the correct configuration.\n\nThere are a few alternate approaches this could take.  The `--no-embedded` option could be passed to `emsdk activate` to use the old behavior, but it seems like they want to move away from that.  Another option is to source `emsdk_env.sh`, which is how these env vars normally get set.  I'm not entirely sure how to do that easily in a Dockerfile, though.", "tree": {"sha": "cb71bdd2912776e49536de305e580b2b5bc66f8d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb71bdd2912776e49536de305e580b2b5bc66f8d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/449e8eaa286e407c9cd8cac655b77998fd53db6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/449e8eaa286e407c9cd8cac655b77998fd53db6b", "html_url": "https://github.com/rust-lang/rust/commit/449e8eaa286e407c9cd8cac655b77998fd53db6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/449e8eaa286e407c9cd8cac655b77998fd53db6b/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb8674837a9cc5225020e07fc3f164762bb4c11c", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb8674837a9cc5225020e07fc3f164762bb4c11c", "html_url": "https://github.com/rust-lang/rust/commit/bb8674837a9cc5225020e07fc3f164762bb4c11c"}, {"sha": "cd02052ad083ae0927a08483035b5dca214bdd0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd02052ad083ae0927a08483035b5dca214bdd0d", "html_url": "https://github.com/rust-lang/rust/commit/cd02052ad083ae0927a08483035b5dca214bdd0d"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "8232539edda7743d7a929f30830cbe0abee9d1f2", "filename": "src/ci/docker/wasm32/Dockerfile", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/449e8eaa286e407c9cd8cac655b77998fd53db6b/src%2Fci%2Fdocker%2Fwasm32%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/449e8eaa286e407c9cd8cac655b77998fd53db6b/src%2Fci%2Fdocker%2Fwasm32%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fwasm32%2FDockerfile?ref=449e8eaa286e407c9cd8cac655b77998fd53db6b", "patch": "@@ -27,6 +27,9 @@ ENV PATH=$PATH:/emsdk-portable\n ENV PATH=$PATH:/emsdk-portable/upstream/emscripten/\n ENV PATH=$PATH:/emsdk-portable/node/12.9.1_64bit/bin/\n ENV BINARYEN_ROOT=/emsdk-portable/upstream/\n+ENV EMSDK=/emsdk-portable\n+ENV EM_CONFIG=/emsdk-portable/.emscripten\n+ENV EM_CACHE=/emsdk-portable/upstream/emscripten/cache\n \n ENV TARGETS=wasm32-unknown-emscripten\n "}]}