{"sha": "0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "node_id": "C_kwDOAAsO6NoAKDBkYzM2ZmNkNWIwYmRmMDdmZTFjMTgwYzA1MGUwMzM3ZjFjZDNlZmU", "commit": {"author": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-03-16T09:21:59Z"}, "committer": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-03-18T03:19:00Z"}, "message": "fix: don't suggest similar method when unstable", "tree": {"sha": "3b37e7fb6bea93a370ae48c9a008129578ee8e5f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b37e7fb6bea93a370ae48c9a008129578ee8e5f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEINUdoc4Vb1yVx04IZ6vxb7Ds2HAFAmQVLaQACgkQZ6vxb7Ds\n2HDM6hAAyVBgOgYibnAFv7avfWnwVExTFg89rKeOrnsty4s+RHX18eNMutl0RVWL\nCIF21I+cBwZZp/l/WOr67Ngv5fq4m/3nFRI5cEh7NI9DZeAj1LEXnv+3wCujRMpT\nKerSuvnCxSo/sd1HfVzpm92QmW1sw/Fa0XbZyrNmqZJ8HDvKgZGBdcOkTVPkqNMN\noyo76KxI5V6Mx5MXwf/qvHEGExDGLXmULAEQKye/7hm/ffwkWrtprYY5t5ldI2Mu\nBeCnKOzyveVPYEdeBnma4LXQm+B/kkwg5pMXsxa2IAZ/yuYIuXB/NfGxkXWR1ioF\nrOn4h4Ej2dwNQwC7y03bdbCs9qf2WhfI/gQ5qyH2GJVuM/tN4OexOnssVcBSRwCq\n0kkiT9ifde/Rm2G70YFfQ8ZXzjrsf4ZeYXweaeKUVdJtfvUwsXY23K1RDd37GbtC\n7/fLYbCMhfEziak/BFb7MB9d25+0Dlj6OWmOCC6DEzlUc7gACSkz6xwKzCnvpz12\nYLVB4ieyLDEIweDj0zCv2W0hxMVm5221ShL2KsGKx7NIp1F+o50PA3Wad06D3P7U\n2BoTbIU1ZOEllkIo2t9bp7PKt8CNgUK2ZHXDGH0jYJ/UcBm0RYh54NE+w1K+SCdc\n6jNZoHTN7x5XsuRGTtnUhAytHMNeuTqstfluVfLi7VxTesadZU8=\n=SA4y\n-----END PGP SIGNATURE-----", "payload": "tree 3b37e7fb6bea93a370ae48c9a008129578ee8e5f\nparent 18e305dfca6dfef07478378cb9a673fdba6ac3b3\nauthor Ezra Shaw <ezrasure@outlook.com> 1678958519 +1300\ncommitter Ezra Shaw <ezrasure@outlook.com> 1679109540 +1300\n\nfix: don't suggest similar method when unstable\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "html_url": "https://github.com/rust-lang/rust/commit/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/comments", "author": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18e305dfca6dfef07478378cb9a673fdba6ac3b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/18e305dfca6dfef07478378cb9a673fdba6ac3b3", "html_url": "https://github.com/rust-lang/rust/commit/18e305dfca6dfef07478378cb9a673fdba6ac3b3"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "79ef2d053fec3bb9c537202186176e48d5987608", "filename": "compiler/rustc_hir_typeck/src/method/probe.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fprobe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fprobe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fprobe.rs?ref=0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "patch": "@@ -1027,6 +1027,15 @@ impl<'a, 'tcx> ProbeContext<'a, 'tcx> {\n                     true\n                 }\n             })\n+            // ensure that we don't suggest unstable methods\n+            .filter(|candidate| {\n+                // note that `DUMMY_SP` is ok here because it is only used for\n+                // suggestions and macro stuff which isn't applicable here.\n+                !matches!(\n+                    self.tcx.eval_stability(candidate.item.def_id, None, DUMMY_SP, None),\n+                    stability::EvalResult::Deny { .. }\n+                )\n+            })\n             .map(|candidate| candidate.item.ident(self.tcx))\n             .filter(|&name| set.insert(name))\n             .collect();"}, {"sha": "8804186ee1a6b915777f028ae86925e044c5b78b", "filename": "tests/ui/stability-attribute/auxiliary/similar-unstable-method.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fauxiliary%2Fsimilar-unstable-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fauxiliary%2Fsimilar-unstable-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstability-attribute%2Fauxiliary%2Fsimilar-unstable-method.rs?ref=0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "patch": "@@ -0,0 +1,13 @@\n+#![feature(staged_api)]\n+#![stable(feature = \"libfoo\", since = \"1.0.0\")]\n+\n+#[unstable(feature = \"foo\", reason = \"...\", issue = \"none\")]\n+pub fn foo() {}\n+\n+#[stable(feature = \"libfoo\", since = \"1.0.0\")]\n+pub struct Foo;\n+\n+impl Foo {\n+    #[unstable(feature = \"foo\", reason = \"...\", issue = \"none\")]\n+    pub fn foo(&self) {}\n+}"}, {"sha": "6d052779c6d363339ac4943b468045308ca629af", "filename": "tests/ui/stability-attribute/issue-109177.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fissue-109177.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fissue-109177.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstability-attribute%2Fissue-109177.rs?ref=0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "patch": "@@ -0,0 +1,13 @@\n+// aux-build: similar-unstable-method.rs\n+\n+extern crate similar_unstable_method;\n+\n+fn main() {\n+    // FIXME: this function should not suggest the `foo` function.\n+    similar_unstable_method::foo1();\n+    //~^ ERROR cannot find function `foo1` in crate `similar_unstable_method` [E0425]\n+\n+    let foo = similar_unstable_method::Foo;\n+    foo.foo1();\n+    //~^ ERROR no method named `foo1` found for struct `Foo` in the current scope [E0599]\n+}"}, {"sha": "9c2ac591ace05374c6259c3965ffa317e448d210", "filename": "tests/ui/stability-attribute/issue-109177.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fissue-109177.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe/tests%2Fui%2Fstability-attribute%2Fissue-109177.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fstability-attribute%2Fissue-109177.stderr?ref=0dc36fcd5b0bdf07fe1c180c050e0337f1cd3efe", "patch": "@@ -0,0 +1,21 @@\n+error[E0425]: cannot find function `foo1` in crate `similar_unstable_method`\n+  --> $DIR/issue-109177.rs:7:30\n+   |\n+LL |     similar_unstable_method::foo1();\n+   |                              ^^^^ help: a function with a similar name exists: `foo`\n+   |\n+  ::: $DIR/auxiliary/similar-unstable-method.rs:5:1\n+   |\n+LL | pub fn foo() {}\n+   | ------------ similarly named function `foo` defined here\n+\n+error[E0599]: no method named `foo1` found for struct `Foo` in the current scope\n+  --> $DIR/issue-109177.rs:11:9\n+   |\n+LL |     foo.foo1();\n+   |         ^^^^ method not found in `Foo`\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0425, E0599.\n+For more information about an error, try `rustc --explain E0425`."}]}