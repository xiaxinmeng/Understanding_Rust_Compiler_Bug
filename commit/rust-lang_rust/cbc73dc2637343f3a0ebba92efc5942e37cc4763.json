{"sha": "cbc73dc2637343f3a0ebba92efc5942e37cc4763", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiYzczZGMyNjM3MzQzZjNhMGViYmE5MmVmYzU5NDJlMzdjYzQ3NjM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-05-31T10:03:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-31T10:03:30Z"}, "message": "Rollup merge of #72781 - marmeladema:rustdoc-def-id-resolve-str-path-error, r=petrochenkov\n\nUse `LocalDefId` instead of `NodeId` in `resolve_str_path_error`\n\nTogether with https://github.com/rust-lang/rust/pull/72777 this should remove all uses of `NodeId` in `rustdoc`.\n\ncc #50928\n\nr? @petrochenkov", "tree": {"sha": "48e4c29a2703327308b7681c6caf126bea8d72b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48e4c29a2703327308b7681c6caf126bea8d72b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbc73dc2637343f3a0ebba92efc5942e37cc4763", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe04DyCRBK7hj4Ov3rIwAAdHIIADw3OYgJRdVt0zCqs8YDPRty\nX1nS6db8IPghEzrVUhaX2ecWkfqVmlShhMbRPur6LlMc2aBXAgyPNq4ua9bFQJ1o\nR6Hyc8w7Cy42RmNJMd8r3GRbLHck/YzV/iHRKMmLpXB6VbDDwS5ZubpcQXuHiC5s\nrX7eyrIRe/vaEiXMveAA+UPsm4Sizd1Xh67TShzIdzCUlyxDdYC50tpb//NzNucS\n4OFZa/dfPPs668Do0eYrcnd0spQWD9p8NkliTzIcmt7isifakbUEaHcwHe5PWYg9\n/YZIHBoPUTxfCHCd+uC+gHBiPMtm6VA6iVPLaBVEw+37aJOSCQPnRIO/skpXmyY=\n=2S3w\n-----END PGP SIGNATURE-----\n", "payload": "tree 48e4c29a2703327308b7681c6caf126bea8d72b2\nparent e16bd0206bdd5dfc75f5b7c02a763de6baafd430\nparent 372ba2a03d7180c3a58631ecbd93e8912e697bab\nauthor Ralf Jung <post@ralfj.de> 1590919410 +0200\ncommitter GitHub <noreply@github.com> 1590919410 +0200\n\nRollup merge of #72781 - marmeladema:rustdoc-def-id-resolve-str-path-error, r=petrochenkov\n\nUse `LocalDefId` instead of `NodeId` in `resolve_str_path_error`\n\nTogether with https://github.com/rust-lang/rust/pull/72777 this should remove all uses of `NodeId` in `rustdoc`.\n\ncc #50928\n\nr? @petrochenkov\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbc73dc2637343f3a0ebba92efc5942e37cc4763", "html_url": "https://github.com/rust-lang/rust/commit/cbc73dc2637343f3a0ebba92efc5942e37cc4763", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbc73dc2637343f3a0ebba92efc5942e37cc4763/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e16bd0206bdd5dfc75f5b7c02a763de6baafd430", "url": "https://api.github.com/repos/rust-lang/rust/commits/e16bd0206bdd5dfc75f5b7c02a763de6baafd430", "html_url": "https://github.com/rust-lang/rust/commit/e16bd0206bdd5dfc75f5b7c02a763de6baafd430"}, {"sha": "372ba2a03d7180c3a58631ecbd93e8912e697bab", "url": "https://api.github.com/repos/rust-lang/rust/commits/372ba2a03d7180c3a58631ecbd93e8912e697bab", "html_url": "https://github.com/rust-lang/rust/commit/372ba2a03d7180c3a58631ecbd93e8912e697bab"}], "stats": {"total": 23, "additions": 12, "deletions": 11}, "files": [{"sha": "e5fc23e14d2ab729c423824fa97e0ab7b736fd05", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=cbc73dc2637343f3a0ebba92efc5942e37cc4763", "patch": "@@ -2902,7 +2902,7 @@ impl<'a> Resolver<'a> {\n         span: Span,\n         path_str: &str,\n         ns: Namespace,\n-        module_id: NodeId,\n+        module_id: LocalDefId,\n     ) -> Result<(ast::Path, Res), ()> {\n         let path = if path_str.starts_with(\"::\") {\n             ast::Path {\n@@ -2922,10 +2922,7 @@ impl<'a> Resolver<'a> {\n                     .collect(),\n             }\n         };\n-        let module = self.block_map.get(&module_id).copied().unwrap_or_else(|| {\n-            let def_id = self.definitions.local_def_id(module_id);\n-            self.module_map.get(&def_id).copied().unwrap_or(self.graph_root)\n-        });\n+        let module = self.module_map.get(&module_id).copied().unwrap_or(self.graph_root);\n         let parent_scope = &ParentScope::module(module);\n         let res = self.resolve_ast_path(&path, ns, parent_scope).map_err(|_| ())?;\n         Ok((path, res))"}, {"sha": "06293a987124e7301a945cca26efaf4e088d2813", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=cbc73dc2637343f3a0ebba92efc5942e37cc4763", "patch": "@@ -1,4 +1,3 @@\n-use rustc_ast::ast::CRATE_NODE_ID;\n use rustc_attr as attr;\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n use rustc_data_structures::sync::{self, Lrc};\n@@ -7,7 +6,7 @@ use rustc_errors::emitter::{Emitter, EmitterWriter};\n use rustc_errors::json::JsonEmitter;\n use rustc_feature::UnstableFeatures;\n use rustc_hir::def::Namespace::TypeNS;\n-use rustc_hir::def_id::{CrateNum, DefId, DefIndex, LOCAL_CRATE};\n+use rustc_hir::def_id::{CrateNum, DefId, DefIndex, LocalDefId, CRATE_DEF_INDEX, LOCAL_CRATE};\n use rustc_hir::HirId;\n use rustc_interface::interface;\n use rustc_middle::middle::cstore::CrateStore;\n@@ -390,7 +389,12 @@ pub fn run_core(options: RustdocOptions) -> (clean::Crate, RenderInfo, RenderOpt\n                 resolver.borrow_mut().access(|resolver| {\n                     for extern_name in &extern_names {\n                         resolver\n-                            .resolve_str_path_error(DUMMY_SP, extern_name, TypeNS, CRATE_NODE_ID)\n+                            .resolve_str_path_error(\n+                                DUMMY_SP,\n+                                extern_name,\n+                                TypeNS,\n+                                LocalDefId { local_def_index: CRATE_DEF_INDEX },\n+                            )\n                             .unwrap_or_else(|()| {\n                                 panic!(\"Unable to resolve external crate {}\", extern_name)\n                             });"}, {"sha": "149480ec80f2960a81073c1e16ffe8c72c4aad42", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbc73dc2637343f3a0ebba92efc5942e37cc4763/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=cbc73dc2637343f3a0ebba92efc5942e37cc4763", "patch": "@@ -8,7 +8,7 @@ use rustc_hir::def::{\n     Namespace::{self, *},\n     PerNS, Res,\n };\n-use rustc_hir::def_id::DefId;\n+use rustc_hir::def_id::{DefId, LocalDefId};\n use rustc_middle::ty;\n use rustc_resolve::ParentScope;\n use rustc_session::lint;\n@@ -61,7 +61,7 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n         &self,\n         path_str: &str,\n         current_item: &Option<String>,\n-        module_id: rustc_ast::ast::NodeId,\n+        module_id: LocalDefId,\n     ) -> Result<(Res, Option<String>), ErrorKind> {\n         let cx = self.cx;\n \n@@ -137,7 +137,7 @@ impl<'a, 'tcx> LinkCollector<'a, 'tcx> {\n \n         // In case we're in a module, try to resolve the relative path.\n         if let Some(module_id) = parent_id.or(self.mod_ids.last().cloned()) {\n-            let module_id = cx.tcx.hir().hir_id_to_node_id(module_id);\n+            let module_id = cx.tcx.hir().local_def_id(module_id);\n             let result = cx.enter_resolver(|resolver| {\n                 resolver.resolve_str_path_error(DUMMY_SP, &path_str, ns, module_id)\n             });"}]}