{"sha": "fdf8c498823452c720cb48e2f36841b9d4b72c25", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkZjhjNDk4ODIzNDUyYzcyMGNiNDhlMmYzNjg0MWI5ZDRiNzJjMjU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T04:08:55Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T04:09:34Z"}, "message": "rustc: Don't rebuild the AST when typechecking statements", "tree": {"sha": "f04ba9dcfe9921f5d9ce5e8b6a038f899af3ec48", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f04ba9dcfe9921f5d9ce5e8b6a038f899af3ec48"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fdf8c498823452c720cb48e2f36841b9d4b72c25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fdf8c498823452c720cb48e2f36841b9d4b72c25", "html_url": "https://github.com/rust-lang/rust/commit/fdf8c498823452c720cb48e2f36841b9d4b72c25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fdf8c498823452c720cb48e2f36841b9d4b72c25/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc78544d3627dd39cf2c721a16219b16276d6660", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc78544d3627dd39cf2c721a16219b16276d6660", "html_url": "https://github.com/rust-lang/rust/commit/dc78544d3627dd39cf2c721a16219b16276d6660"}], "stats": {"total": 36, "additions": 8, "deletions": 28}, "files": [{"sha": "66240834a28c7a265dc83291c460e497613fe2fd", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 8, "deletions": 28, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/fdf8c498823452c720cb48e2f36841b9d4b72c25/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fdf8c498823452c720cb48e2f36841b9d4b72c25/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=fdf8c498823452c720cb48e2f36841b9d4b72c25", "patch": "@@ -2598,46 +2598,26 @@ fn check_decl_local(&@fn_ctxt fcx, &@ast::decl decl) -> @ast::decl {\n     }\n }\n \n-fn check_stmt(&@fn_ctxt fcx, &@ast::stmt stmt) -> @ast::stmt {\n+fn check_stmt(&@fn_ctxt fcx, &@ast::stmt stmt) {\n+    auto node_id;\n     alt (stmt.node) {\n         case (ast::stmt_decl(?decl,?a)) {\n+            node_id = a.id;\n             alt (decl.node) {\n-                case (ast::decl_local(_)) {\n-                    auto decl_1 = check_decl_local(fcx, decl);\n-\n-                    auto new_ann = plain_ann(a.id, fcx.ccx.tcx);\n-                    write_nil_type(fcx.ccx.tcx, fcx.ccx.node_types, a.id);\n-\n-                    ret @fold::respan[ast::stmt_](stmt.span,\n-                           ast::stmt_decl(decl_1, new_ann));\n-                }\n-\n-                case (ast::decl_item(_)) {\n-                    // Ignore for now. We'll return later.\n-                    auto new_ann = plain_ann(a.id, fcx.ccx.tcx);\n-                    write_nil_type(fcx.ccx.tcx, fcx.ccx.node_types, a.id);\n-\n-                    ret @fold::respan[ast::stmt_](stmt.span,\n-                           ast::stmt_decl(decl, new_ann));\n-                }\n+                case (ast::decl_local(_)) { check_decl_local(fcx, decl); }\n+                case (ast::decl_item(_)) { /* ignore for now */ }\n             }\n-\n-            //         ret stmt;\n         }\n-\n         case (ast::stmt_expr(?expr,?a)) {\n+            node_id = a.id;\n+\n             check_expr(fcx, expr);\n             auto ety = expr_ty(fcx.ccx.tcx, fcx.ccx.node_types, expr);\n             Pushdown::pushdown_expr(fcx, ety, expr);\n-\n-            auto new_ann = plain_ann(a.id, fcx.ccx.tcx);\n-            write_nil_type(fcx.ccx.tcx, fcx.ccx.node_types, a.id);\n-\n-            ret @fold::respan(stmt.span, ast::stmt_expr(expr, new_ann));\n         }\n     }\n \n-    fail;\n+    write_nil_type(fcx.ccx.tcx, fcx.ccx.node_types, node_id);\n }\n \n fn check_block(&@fn_ctxt fcx, &ast::block block) {"}]}