{"sha": "75e14873b83f458841f815ccb3b7f4eac83b4327", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc1ZTE0ODczYjgzZjQ1ODg0MWY4MTVjY2IzYjdmNGVhYzgzYjQzMjc=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-08-03T23:05:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-08-03T23:05:53Z"}, "message": "Rollup merge of #87663 - GuillaumeGomez:rustdoc-brace-minus-brace, r=notriddle\n\nRustdoc accessibility: use an icon for the [-]/[+] controls\n\nThis is a reopening of #87207 with improvement for the way of generating the `background-image` CSS property.\n\nI quote from the original PR:\n\n> This way, we can show the plus and minus buttons on screens, while voice\n> control will read off actual words \"Collapse\" and \"Expand\" instead of reading\n> \"open brace minus close brace\" and \"open brace plus close brace\".\n\nPart of #87059\n\nr? ``@notriddle``", "tree": {"sha": "f4606a92ba8259407228ee9afc8fce7a049bb128", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4606a92ba8259407228ee9afc8fce7a049bb128"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/75e14873b83f458841f815ccb3b7f4eac83b4327", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhCcvRCRBK7hj4Ov3rIwAACigIAFWBGgCCwscQ/6zTBmT9UMF5\nL9RhpsA2Q/kaxCZDTEgTePMCJUIIW0WnLjJcauxuePhpkhXVvMeViR0vKKt7CF+s\nm4ZhgJYBaCBRDMq+TwFkjbVMuIMzX3BaBCs5xbsusSS37WOI8FNe5mX9fF9Zk/fM\nO+Z42QXVo6BQhsGMtw+K6qRQoSQysEYINQH6DlfLqqSg/V8lp9qhLLGsZlZEPa++\nHBI7NYU8jEk9EtrgSgO/yL/wNAAuSvE+Apu2wMlCYzMTvyegzZTBGUTA4HpS7Lef\n6t1svOjUioWBh32LzJAOz0AyCYQi6V3KjTZaZONe2/JW3GcX9zGGxKXUXfjNzt4=\n=/GhQ\n-----END PGP SIGNATURE-----\n", "payload": "tree f4606a92ba8259407228ee9afc8fce7a049bb128\nparent 87c820573a0ed8733523bb697a78021620a9bf94\nparent 6fe09722ea0762405558b6ea5eb5f765a24af9df\nauthor Yuki Okushi <jtitor@2k36.org> 1628031953 +0900\ncommitter GitHub <noreply@github.com> 1628031953 +0900\n\nRollup merge of #87663 - GuillaumeGomez:rustdoc-brace-minus-brace, r=notriddle\n\nRustdoc accessibility: use an icon for the [-]/[+] controls\n\nThis is a reopening of #87207 with improvement for the way of generating the `background-image` CSS property.\n\nI quote from the original PR:\n\n> This way, we can show the plus and minus buttons on screens, while voice\n> control will read off actual words \"Collapse\" and \"Expand\" instead of reading\n> \"open brace minus close brace\" and \"open brace plus close brace\".\n\nPart of #87059\n\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/75e14873b83f458841f815ccb3b7f4eac83b4327", "html_url": "https://github.com/rust-lang/rust/commit/75e14873b83f458841f815ccb3b7f4eac83b4327", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/75e14873b83f458841f815ccb3b7f4eac83b4327/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87c820573a0ed8733523bb697a78021620a9bf94", "url": "https://api.github.com/repos/rust-lang/rust/commits/87c820573a0ed8733523bb697a78021620a9bf94", "html_url": "https://github.com/rust-lang/rust/commit/87c820573a0ed8733523bb697a78021620a9bf94"}, {"sha": "6fe09722ea0762405558b6ea5eb5f765a24af9df", "url": "https://api.github.com/repos/rust-lang/rust/commits/6fe09722ea0762405558b6ea5eb5f765a24af9df", "html_url": "https://github.com/rust-lang/rust/commit/6fe09722ea0762405558b6ea5eb5f765a24af9df"}], "stats": {"total": 124, "additions": 114, "deletions": 10}, "files": [{"sha": "4411b7771eda7771414d04927e25e9fd0ea3dfe2", "filename": "src/librustdoc/html/render/write_shared.rs", "status": "modified", "additions": 39, "deletions": 1, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -175,9 +175,45 @@ pub(super) fn write_shared(\n         cx.write_shared(SharedResource::InvocationSpecific { basename: p }, content, &options.emit)\n     };\n \n+    fn add_background_image_to_css(\n+        cx: &Context<'_>,\n+        css: &mut String,\n+        rule: &str,\n+        file: &'static str,\n+    ) {\n+        css.push_str(&format!(\n+            \"{} {{ background-image: url({}); }}\",\n+            rule,\n+            SharedResource::ToolchainSpecific { basename: file }\n+                .path(cx)\n+                .file_name()\n+                .unwrap()\n+                .to_str()\n+                .unwrap()\n+        ))\n+    }\n+\n+    // Add all the static files. These may already exist, but we just\n+    // overwrite them anyway to make sure that they're fresh and up-to-date.\n+    let mut rustdoc_css = static_files::RUSTDOC_CSS.to_owned();\n+    add_background_image_to_css(\n+        cx,\n+        &mut rustdoc_css,\n+        \"details.undocumented[open] > summary::before, \\\n+         details.rustdoc-toggle[open] > summary::before, \\\n+         details.rustdoc-toggle[open] > summary.hideme::before\",\n+        \"toggle-minus.svg\",\n+    );\n+    add_background_image_to_css(\n+        cx,\n+        &mut rustdoc_css,\n+        \"details.undocumented > summary::before, details.rustdoc-toggle > summary::before\",\n+        \"toggle-plus.svg\",\n+    );\n+    write_minify(\"rustdoc.css\", &rustdoc_css)?;\n+\n     // Add all the static files. These may already exist, but we just\n     // overwrite them anyway to make sure that they're fresh and up-to-date.\n-    write_minify(\"rustdoc.css\", static_files::RUSTDOC_CSS)?;\n     write_minify(\"settings.css\", static_files::SETTINGS_CSS)?;\n     write_minify(\"noscript.css\", static_files::NOSCRIPT_CSS)?;\n \n@@ -217,6 +253,8 @@ pub(super) fn write_shared(\n     write_toolchain(\"wheel.svg\", static_files::WHEEL_SVG)?;\n     write_toolchain(\"clipboard.svg\", static_files::CLIPBOARD_SVG)?;\n     write_toolchain(\"down-arrow.svg\", static_files::DOWN_ARROW_SVG)?;\n+    write_toolchain(\"toggle-minus.svg\", static_files::TOGGLE_MINUS_PNG)?;\n+    write_toolchain(\"toggle-plus.svg\", static_files::TOGGLE_PLUS_PNG)?;\n \n     let mut themes: Vec<&String> = themes.iter().collect();\n     themes.sort();"}, {"sha": "4e33eab5650065a01e34b63fadab824c0f3c654e", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 57, "deletions": 9, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -1508,11 +1508,35 @@ details.rustdoc-toggle > summary.hideme > span {\n }\n \n details.rustdoc-toggle > summary::before {\n-\tcontent: \"[+]\";\n-\tfont-weight: 300;\n-\tfont-size: 0.8em;\n-\tletter-spacing: 1px;\n+\tcontent: \"\";\n \tcursor: pointer;\n+\twidth: 17px;\n+\theight: max(17px, 1.1em);\n+\tbackground-repeat: no-repeat;\n+\tbackground-position: top left;\n+\tdisplay: inline-block;\n+\tvertical-align: middle;\n+\topacity: .5;\n+}\n+\n+/* Screen readers see the text version at the end the line.\n+\tVisual readers see the icon at the start of the line, but small and transparent. */\n+details.rustdoc-toggle > summary::after {\n+\tcontent: \"Expand\";\n+\toverflow: hidden;\n+\twidth: 0;\n+\theight: 0;\n+\tposition: absolute;\n+}\n+\n+details.rustdoc-toggle > summary.hideme::after {\n+\t/* \"hideme\" toggles already have a description when they're contracted */\n+\tcontent: \"\";\n+}\n+\n+details.rustdoc-toggle > summary:focus::before,\n+details.rustdoc-toggle > summary:hover::before {\n+\topacity: 1;\n }\n \n details.rustdoc-toggle.top-doc > summary,\n@@ -1560,20 +1584,44 @@ details.rustdoc-toggle[open] > summary.hideme > span {\n \tdisplay: none;\n }\n \n-details.rustdoc-toggle[open] > summary::before {\n-\tcontent: \"[\u2212]\";\n-\tdisplay: inline;\n+details.rustdoc-toggle[open] > summary::before,\n+details.rustdoc-toggle[open] > summary.hideme::before {\n+\twidth: 17px;\n+\theight: max(17px, 1.1em);\n+\tbackground-repeat: no-repeat;\n+\tbackground-position: top left;\n+\tdisplay: inline-block;\n+\tcontent: \"\";\n+}\n+\n+details.rustdoc-toggle[open] > summary::after,\n+details.rustdoc-toggle[open] > summary.hideme::after {\n+\tcontent: \"Collapse\";\n }\n \n details.undocumented > summary::before {\n-\tcontent: \"[+] Show hidden undocumented items\";\n+\tpadding-left: 17px;\n+\theight: max(17px, 1.1em);\n+\tbackground-repeat: no-repeat;\n+\tbackground-position: top left;\n+\tcontent: \"Show hidden undocumented items\";\n \tcursor: pointer;\n \tfont-size: 16px;\n \tfont-weight: 300;\n+\topacity: .5;\n+}\n+\n+details.undocumented > summary:focus::before,\n+details.undocumented > summary:hover::before {\n+\topacity: 1;\n }\n \n details.undocumented[open] > summary::before {\n-\tcontent: \"[\u2212] Hide undocumented items\";\n+\tpadding-left: 17px;\n+\theight: max(17px, 1.1em);\n+\tbackground-repeat: no-repeat\n+\tbackground-position: top left;\n+\tcontent: \"Hide undocumented items\";\n }\n \n /* Media Queries */"}, {"sha": "849924ea5501e1d92f85bbc8be650907a4e11fbb", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -229,6 +229,11 @@ details.undocumented > summary::before {\n \tcolor: #999;\n }\n \n+details.rustdoc-toggle > summary::before,\n+details.undocumented > summary::before {\n+\tfilter: invert(100%);\n+}\n+\n #crate-search {\n \tcolor: #c5c5c5;\n \tbackground-color: #141920;"}, {"sha": "c26122e4bffb5844ad3617806026713877a65597", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -194,6 +194,11 @@ details.undocumented > summary::before {\n \tcolor: #999;\n }\n \n+details.rustdoc-toggle > summary::before,\n+details.undocumented > summary::before {\n+\tfilter: invert(100%);\n+}\n+\n #crate-search {\n \tcolor: #111;\n \tbackground-color: #f0f0f0;"}, {"sha": "73154788a0e8ed4563843abf5da671263aa9571a", "filename": "src/librustdoc/html/static/images/toggle-minus.svg", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-minus.svg", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-minus.svg", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-minus.svg?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -0,0 +1 @@\n+<svg width=\"17\" height=\"17\" shape-rendering=\"crispEdges\" stroke=\"#000\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M5 2.5H2.5v12H5m7-12h2.5v12H12M5 8.5h7\"/></svg>\n\\ No newline at end of file"}, {"sha": "08b17033e164b15fb31decfbb5befc16209d697e", "filename": "src/librustdoc/html/static/images/toggle-plus.svg", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-plus.svg", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-plus.svg", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fimages%2Ftoggle-plus.svg?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -0,0 +1 @@\n+<svg width=\"17\" height=\"17\" shape-rendering=\"crispEdges\" stroke=\"#000\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M5 2.5H2.5v12H5m7-12h2.5v12H12M5 8.5h7M8.5 12V8.625v0V5\"/></svg>\n\\ No newline at end of file"}, {"sha": "6f3d08ea655691350729431fad47730689b2edf2", "filename": "src/librustdoc/html/static_files.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "raw_url": "https://github.com/rust-lang/rust/raw/75e14873b83f458841f815ccb3b7f4eac83b4327/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs?ref=75e14873b83f458841f815ccb3b7f4eac83b4327", "patch": "@@ -47,6 +47,12 @@ crate static CLIPBOARD_SVG: &[u8] = include_bytes!(\"static/images/clipboard.svg\"\n /// The file contents of `down-arrow.svg`, the icon used for the crate choice combobox.\n crate static DOWN_ARROW_SVG: &[u8] = include_bytes!(\"static/images/down-arrow.svg\");\n \n+/// The file contents of `toggle-minus.svg`, the icon used for opened toggles.\n+crate static TOGGLE_MINUS_PNG: &[u8] = include_bytes!(\"static/images/toggle-minus.svg\");\n+\n+/// The file contents of `toggle-plus.svg`, the icon used for closed toggles.\n+crate static TOGGLE_PLUS_PNG: &[u8] = include_bytes!(\"static/images/toggle-plus.svg\");\n+\n /// The contents of `COPYRIGHT.txt`, the license listing for files distributed with documentation\n /// output.\n crate static COPYRIGHT: &[u8] = include_bytes!(\"static/COPYRIGHT.txt\");"}]}