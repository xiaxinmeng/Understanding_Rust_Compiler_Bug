{"sha": "b90ed92a5c7029146ca2c24686a1247d97648c61", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5MGVkOTJhNWM3MDI5MTQ2Y2EyYzI0Njg2YTEyNDdkOTc2NDhjNjE=", "commit": {"author": {"name": "Jade", "email": "software@lfcode.ca", "date": "2021-08-04T04:31:57Z"}, "committer": {"name": "Jade", "email": "software@lfcode.ca", "date": "2021-08-04T04:36:29Z"}, "message": "Support exclusive_range_pattern\n\nFix #9779", "tree": {"sha": "584b7a4ba3932d5ea965e908544e3f61309683bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/584b7a4ba3932d5ea965e908544e3f61309683bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b90ed92a5c7029146ca2c24686a1247d97648c61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b90ed92a5c7029146ca2c24686a1247d97648c61", "html_url": "https://github.com/rust-lang/rust/commit/b90ed92a5c7029146ca2c24686a1247d97648c61", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b90ed92a5c7029146ca2c24686a1247d97648c61/comments", "author": {"login": "lf-", "id": 6652840, "node_id": "MDQ6VXNlcjY2NTI4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6652840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lf-", "html_url": "https://github.com/lf-", "followers_url": "https://api.github.com/users/lf-/followers", "following_url": "https://api.github.com/users/lf-/following{/other_user}", "gists_url": "https://api.github.com/users/lf-/gists{/gist_id}", "starred_url": "https://api.github.com/users/lf-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lf-/subscriptions", "organizations_url": "https://api.github.com/users/lf-/orgs", "repos_url": "https://api.github.com/users/lf-/repos", "events_url": "https://api.github.com/users/lf-/events{/privacy}", "received_events_url": "https://api.github.com/users/lf-/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lf-", "id": 6652840, "node_id": "MDQ6VXNlcjY2NTI4NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/6652840?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lf-", "html_url": "https://github.com/lf-", "followers_url": "https://api.github.com/users/lf-/followers", "following_url": "https://api.github.com/users/lf-/following{/other_user}", "gists_url": "https://api.github.com/users/lf-/gists{/gist_id}", "starred_url": "https://api.github.com/users/lf-/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lf-/subscriptions", "organizations_url": "https://api.github.com/users/lf-/orgs", "repos_url": "https://api.github.com/users/lf-/repos", "events_url": "https://api.github.com/users/lf-/events{/privacy}", "received_events_url": "https://api.github.com/users/lf-/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3a67ccec6d0840781e8ff863bc091f9f9492915", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3a67ccec6d0840781e8ff863bc091f9f9492915", "html_url": "https://github.com/rust-lang/rust/commit/e3a67ccec6d0840781e8ff863bc091f9f9492915"}], "stats": {"total": 63, "additions": 42, "deletions": 21}, "files": [{"sha": "ccd3f8e76278f26902922e2e0856a324570f0839", "filename": "crates/parser/src/grammar/patterns.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fpatterns.rs?ref=b90ed92a5c7029146ca2c24686a1247d97648c61", "patch": "@@ -65,14 +65,18 @@ fn pattern_single_r(p: &mut Parser, recovery_set: TokenSet) {\n         //     match 92 {\n         //         0 ... 100 => (),\n         //         101 ..= 200 => (),\n-        //         200 .. 301=> (),\n+        //         200 .. 301 => (),\n+        //         302 .. => (),\n         //     }\n         // }\n         for &range_op in [T![...], T![..=], T![..]].iter() {\n             if p.at(range_op) {\n                 let m = lhs.precede(p);\n                 p.bump(range_op);\n-                atom_pat(p, recovery_set);\n+                if !p.at(T![=>]) {\n+                    // not a range pat like `302 .. => ()`\n+                    atom_pat(p, recovery_set);\n+                }\n                 m.complete(p, RANGE_PAT);\n                 return;\n             }\n@@ -84,7 +88,7 @@ const PAT_RECOVERY_SET: TokenSet =\n     TokenSet::new(&[T![let], T![if], T![while], T![loop], T![match], T![')'], T![,], T![=]]);\n \n fn atom_pat(p: &mut Parser, recovery_set: TokenSet) -> Option<CompletedMarker> {\n-    let m = match p.nth(0) {\n+    let m = match p.current() {\n         T![box] => box_pat(p),\n         T![ref] | T![mut] => ident_pat(p, true),\n         T![const] => const_block_pat(p),"}, {"sha": "75982c3dee98580597ea757cb0849d4c1579b94e", "filename": "crates/syntax/test_data/parser/inline/ok/0058_range_pat.rast", "status": "modified", "additions": 33, "deletions": 17, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rast", "raw_url": "https://github.com/rust-lang/rust/raw/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rast?ref=b90ed92a5c7029146ca2c24686a1247d97648c61", "patch": "@@ -1,5 +1,5 @@\n-SOURCE_FILE@0..112\n-  FN@0..111\n+SOURCE_FILE@0..135\n+  FN@0..134\n     FN_KW@0..2 \"fn\"\n     WHITESPACE@2..3 \" \"\n     NAME@3..7\n@@ -8,16 +8,16 @@ SOURCE_FILE@0..112\n       L_PAREN@7..8 \"(\"\n       R_PAREN@8..9 \")\"\n     WHITESPACE@9..10 \" \"\n-    BLOCK_EXPR@10..111\n+    BLOCK_EXPR@10..134\n       L_CURLY@10..11 \"{\"\n       WHITESPACE@11..16 \"\\n    \"\n-      MATCH_EXPR@16..109\n+      MATCH_EXPR@16..132\n         MATCH_KW@16..21 \"match\"\n         WHITESPACE@21..22 \" \"\n         LITERAL@22..24\n           INT_NUMBER@22..24 \"92\"\n         WHITESPACE@24..25 \" \"\n-        MATCH_ARM_LIST@25..109\n+        MATCH_ARM_LIST@25..132\n           L_CURLY@25..26 \"{\"\n           WHITESPACE@26..35 \"\\n        \"\n           MATCH_ARM@35..51\n@@ -58,7 +58,7 @@ SOURCE_FILE@0..112\n               R_PAREN@76..77 \")\"\n             COMMA@77..78 \",\"\n           WHITESPACE@78..87 \"\\n        \"\n-          MATCH_ARM@87..103\n+          MATCH_ARM@87..104\n             RANGE_PAT@87..97\n               LITERAL_PAT@87..90\n                 LITERAL@87..90\n@@ -69,14 +69,30 @@ SOURCE_FILE@0..112\n               LITERAL_PAT@94..97\n                 LITERAL@94..97\n                   INT_NUMBER@94..97 \"301\"\n-            FAT_ARROW@97..99 \"=>\"\n-            WHITESPACE@99..100 \" \"\n-            TUPLE_EXPR@100..102\n-              L_PAREN@100..101 \"(\"\n-              R_PAREN@101..102 \")\"\n-            COMMA@102..103 \",\"\n-          WHITESPACE@103..108 \"\\n    \"\n-          R_CURLY@108..109 \"}\"\n-      WHITESPACE@109..110 \"\\n\"\n-      R_CURLY@110..111 \"}\"\n-  WHITESPACE@111..112 \"\\n\"\n+            WHITESPACE@97..98 \" \"\n+            FAT_ARROW@98..100 \"=>\"\n+            WHITESPACE@100..101 \" \"\n+            TUPLE_EXPR@101..103\n+              L_PAREN@101..102 \"(\"\n+              R_PAREN@102..103 \")\"\n+            COMMA@103..104 \",\"\n+          WHITESPACE@104..113 \"\\n        \"\n+          MATCH_ARM@113..126\n+            RANGE_PAT@113..119\n+              LITERAL_PAT@113..116\n+                LITERAL@113..116\n+                  INT_NUMBER@113..116 \"302\"\n+              WHITESPACE@116..117 \" \"\n+              DOT2@117..119 \"..\"\n+            WHITESPACE@119..120 \" \"\n+            FAT_ARROW@120..122 \"=>\"\n+            WHITESPACE@122..123 \" \"\n+            TUPLE_EXPR@123..125\n+              L_PAREN@123..124 \"(\"\n+              R_PAREN@124..125 \")\"\n+            COMMA@125..126 \",\"\n+          WHITESPACE@126..131 \"\\n    \"\n+          R_CURLY@131..132 \"}\"\n+      WHITESPACE@132..133 \"\\n\"\n+      R_CURLY@133..134 \"}\"\n+  WHITESPACE@134..135 \"\\n\""}, {"sha": "3833fbd8d5a060ed01838967c57f9c0e23cb7c01", "filename": "crates/syntax/test_data/parser/inline/ok/0058_range_pat.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b90ed92a5c7029146ca2c24686a1247d97648c61/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0058_range_pat.rs?ref=b90ed92a5c7029146ca2c24686a1247d97648c61", "patch": "@@ -2,6 +2,7 @@ fn main() {\n     match 92 {\n         0 ... 100 => (),\n         101 ..= 200 => (),\n-        200 .. 301=> (),\n+        200 .. 301 => (),\n+        302 .. => (),\n     }\n }"}]}