{"sha": "857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg1Nzk0MmVlZDBkMmEzN2ExY2U0YWI0YWY3YjU4OWFiM2E3OWRhNDE=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2020-04-02T12:28:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-02T12:28:00Z"}, "message": "Rollup merge of #70658 - davidtwco:issue-70285-still-further-specializable, r=eddyb\n\nadd `STILL_FURTHER_SPECIALIZABLE` flag\n\nContributes to #70285.\n\nThis PR adds a `STILL_FURTHER_SPECIALIZABLE` flag to `TypeFlags`\nwhich replaces `needs_infer` and `needs_subst` in `Instance::resolve`\nand `assemble_candidates_from_impls`.\n\nr? @eddyb", "tree": {"sha": "ae5a04386959660bdbca2cb71ab63da48959dc6b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ae5a04386959660bdbca2cb71ab63da48959dc6b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJehdpQCRBK7hj4Ov3rIwAAdHIIAJQWn7zgZoEhYIuP+3MZp9Ht\nuiU/cwXwPGDvBuGho8vcIyXx4VVOuN2b6xyF6UCvN/iOvT9499i+isWEFR69A4H9\njJJjKUQJeeuQT+LKD6TtLYPj0f6WMk57Xd5B9F+m6Ia+15fURccwqObWUVvrNLc6\nxqX42eQl6l5703xu2EFd2S40B5+sApYNDSgLGtOi/SJkKP414iLIB1RLJvibZymV\nc9ae3GZQU9wdKvKxt0fyREsKwsdIy9UHZ0FIPHZNWwnvHyWXVo7D0Sp+OYDXOqbD\ntiHu8SvFg6XqmGRdW7sTZaCKiJ4+XRfvqtJRdPxR9TK17ebU70E+PIJARNy6mCY=\n=3fs5\n-----END PGP SIGNATURE-----\n", "payload": "tree ae5a04386959660bdbca2cb71ab63da48959dc6b\nparent 791e872c53c05365687e67e521c9f977c6f952c8\nparent c665eaeeb05d2149cd3ecfd8af62b6af7858a6a2\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1585830480 +0200\ncommitter GitHub <noreply@github.com> 1585830480 +0200\n\nRollup merge of #70658 - davidtwco:issue-70285-still-further-specializable, r=eddyb\n\nadd `STILL_FURTHER_SPECIALIZABLE` flag\n\nContributes to #70285.\n\nThis PR adds a `STILL_FURTHER_SPECIALIZABLE` flag to `TypeFlags`\nwhich replaces `needs_infer` and `needs_subst` in `Instance::resolve`\nand `assemble_candidates_from_impls`.\n\nr? @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "html_url": "https://github.com/rust-lang/rust/commit/857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "791e872c53c05365687e67e521c9f977c6f952c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/791e872c53c05365687e67e521c9f977c6f952c8", "html_url": "https://github.com/rust-lang/rust/commit/791e872c53c05365687e67e521c9f977c6f952c8"}, {"sha": "c665eaeeb05d2149cd3ecfd8af62b6af7858a6a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/c665eaeeb05d2149cd3ecfd8af62b6af7858a6a2", "html_url": "https://github.com/rust-lang/rust/commit/c665eaeeb05d2149cd3ecfd8af62b6af7858a6a2"}], "stats": {"total": 143, "additions": 86, "deletions": 57}, "files": [{"sha": "99a6511b297acff58ac56216f88666edf735de9c", "filename": "src/librustc_middle/ty/flags.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fty%2Fflags.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -1,4 +1,4 @@\n-use crate::ty::subst::{GenericArgKind, SubstsRef};\n+use crate::ty::subst::{GenericArg, GenericArgKind};\n use crate::ty::{self, InferConst, Ty, TypeFlags};\n \n #[derive(Debug)]\n@@ -81,6 +81,7 @@ impl FlagComputation {\n \n             &ty::Param(_) => {\n                 self.add_flags(TypeFlags::HAS_TY_PARAM);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n             }\n \n             &ty::Generator(_, ref substs, _) => {\n@@ -99,14 +100,17 @@ impl FlagComputation {\n \n             &ty::Bound(debruijn, _) => {\n                 self.add_binder(debruijn);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n             }\n \n             &ty::Placeholder(..) => {\n                 self.add_flags(TypeFlags::HAS_TY_PLACEHOLDER);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n             }\n \n             &ty::Infer(infer) => {\n                 self.add_flags(TypeFlags::HAS_TY_INFER);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n                 match infer {\n                     ty::FreshTy(_) | ty::FreshIntTy(_) | ty::FreshFloatTy(_) => {}\n \n@@ -218,17 +222,23 @@ impl FlagComputation {\n             }\n             ty::ConstKind::Infer(infer) => {\n                 self.add_flags(TypeFlags::HAS_CT_INFER);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n                 match infer {\n                     InferConst::Fresh(_) => {}\n                     InferConst::Var(_) => self.add_flags(TypeFlags::KEEP_IN_LOCAL_TCX),\n                 }\n             }\n-            ty::ConstKind::Bound(debruijn, _) => self.add_binder(debruijn),\n+            ty::ConstKind::Bound(debruijn, _) => {\n+                self.add_binder(debruijn);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n+            }\n             ty::ConstKind::Param(_) => {\n                 self.add_flags(TypeFlags::HAS_CT_PARAM);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n             }\n             ty::ConstKind::Placeholder(_) => {\n                 self.add_flags(TypeFlags::HAS_CT_PLACEHOLDER);\n+                self.add_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE);\n             }\n             ty::ConstKind::Value(_) => {}\n         }\n@@ -243,7 +253,7 @@ impl FlagComputation {\n         self.add_substs(projection_ty.substs);\n     }\n \n-    fn add_substs(&mut self, substs: SubstsRef<'_>) {\n+    fn add_substs(&mut self, substs: &[GenericArg<'_>]) {\n         for kind in substs {\n             match kind.unpack() {\n                 GenericArgKind::Type(ty) => self.add_ty(ty),"}, {"sha": "a3d611a13259226c22493a565bd4f3c089d2caee", "filename": "src/librustc_middle/ty/fold.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fty%2Ffold.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -142,6 +142,13 @@ pub trait TypeFoldable<'tcx>: fmt::Debug + Clone {\n         self.has_type_flags(TypeFlags::HAS_RE_LATE_BOUND)\n     }\n \n+    /// Indicates whether this value still has parameters/placeholders/inference variables\n+    /// which could be replaced later, in a way that would change the results of `impl`\n+    /// specialization.\n+    fn still_further_specializable(&self) -> bool {\n+        self.has_type_flags(TypeFlags::STILL_FURTHER_SPECIALIZABLE)\n+    }\n+\n     /// A visitor that does not recurse into types, works like `fn walk_shallow` in `Ty`.\n     fn visit_tys_shallow(&self, visit: impl FnMut(Ty<'tcx>) -> bool) -> bool {\n         pub struct Visitor<F>(F);"}, {"sha": "901365ef691703e2743b6c18ba2bddda92078d91", "filename": "src/librustc_middle/ty/mod.rs", "status": "modified", "additions": 57, "deletions": 52, "changes": 109, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fty%2Fmod.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -523,101 +523,106 @@ bitflags! {\n         // Does this have parameters? Used to determine whether substitution is\n         // required.\n         /// Does this have [Param]?\n-        const HAS_TY_PARAM              = 1 << 0;\n+        const HAS_TY_PARAM                = 1 << 0;\n         /// Does this have [ReEarlyBound]?\n-        const HAS_RE_PARAM              = 1 << 1;\n+        const HAS_RE_PARAM                = 1 << 1;\n         /// Does this have [ConstKind::Param]?\n-        const HAS_CT_PARAM              = 1 << 2;\n+        const HAS_CT_PARAM                = 1 << 2;\n \n-        const NEEDS_SUBST               = TypeFlags::HAS_TY_PARAM.bits\n-                                        | TypeFlags::HAS_RE_PARAM.bits\n-                                        | TypeFlags::HAS_CT_PARAM.bits;\n+        const NEEDS_SUBST                 = TypeFlags::HAS_TY_PARAM.bits\n+                                          | TypeFlags::HAS_RE_PARAM.bits\n+                                          | TypeFlags::HAS_CT_PARAM.bits;\n \n         /// Does this have [Infer]?\n-        const HAS_TY_INFER              = 1 << 3;\n+        const HAS_TY_INFER                = 1 << 3;\n         /// Does this have [ReVar]?\n-        const HAS_RE_INFER              = 1 << 4;\n+        const HAS_RE_INFER                = 1 << 4;\n         /// Does this have [ConstKind::Infer]?\n-        const HAS_CT_INFER              = 1 << 5;\n+        const HAS_CT_INFER                = 1 << 5;\n \n         /// Does this have inference variables? Used to determine whether\n         /// inference is required.\n-        const NEEDS_INFER               = TypeFlags::HAS_TY_INFER.bits\n-                                        | TypeFlags::HAS_RE_INFER.bits\n-                                        | TypeFlags::HAS_CT_INFER.bits;\n+        const NEEDS_INFER                 = TypeFlags::HAS_TY_INFER.bits\n+                                          | TypeFlags::HAS_RE_INFER.bits\n+                                          | TypeFlags::HAS_CT_INFER.bits;\n \n         /// Does this have [Placeholder]?\n-        const HAS_TY_PLACEHOLDER        = 1 << 6;\n+        const HAS_TY_PLACEHOLDER          = 1 << 6;\n         /// Does this have [RePlaceholder]?\n-        const HAS_RE_PLACEHOLDER        = 1 << 7;\n+        const HAS_RE_PLACEHOLDER          = 1 << 7;\n         /// Does this have [ConstKind::Placeholder]?\n-        const HAS_CT_PLACEHOLDER        = 1 << 8;\n+        const HAS_CT_PLACEHOLDER          = 1 << 8;\n \n         /// `true` if there are \"names\" of regions and so forth\n         /// that are local to a particular fn/inferctxt\n-        const HAS_FREE_LOCAL_REGIONS    = 1 << 9;\n+        const HAS_FREE_LOCAL_REGIONS      = 1 << 9;\n \n         /// `true` if there are \"names\" of types and regions and so forth\n         /// that are local to a particular fn\n-        const HAS_FREE_LOCAL_NAMES      = TypeFlags::HAS_TY_PARAM.bits\n-                                        | TypeFlags::HAS_CT_PARAM.bits\n-                                        | TypeFlags::HAS_TY_INFER.bits\n-                                        | TypeFlags::HAS_CT_INFER.bits\n-                                        | TypeFlags::HAS_TY_PLACEHOLDER.bits\n-                                        | TypeFlags::HAS_CT_PLACEHOLDER.bits\n-                                        | TypeFlags::HAS_FREE_LOCAL_REGIONS.bits;\n+        const HAS_FREE_LOCAL_NAMES        = TypeFlags::HAS_TY_PARAM.bits\n+                                          | TypeFlags::HAS_CT_PARAM.bits\n+                                          | TypeFlags::HAS_TY_INFER.bits\n+                                          | TypeFlags::HAS_CT_INFER.bits\n+                                          | TypeFlags::HAS_TY_PLACEHOLDER.bits\n+                                          | TypeFlags::HAS_CT_PLACEHOLDER.bits\n+                                          | TypeFlags::HAS_FREE_LOCAL_REGIONS.bits;\n \n         /// Does this have [Projection] or [UnnormalizedProjection]?\n-        const HAS_TY_PROJECTION         = 1 << 10;\n+        const HAS_TY_PROJECTION           = 1 << 10;\n         /// Does this have [Opaque]?\n-        const HAS_TY_OPAQUE             = 1 << 11;\n+        const HAS_TY_OPAQUE               = 1 << 11;\n         /// Does this have [ConstKind::Unevaluated]?\n-        const HAS_CT_PROJECTION         = 1 << 12;\n+        const HAS_CT_PROJECTION           = 1 << 12;\n \n         /// Could this type be normalized further?\n-        const HAS_PROJECTION            = TypeFlags::HAS_TY_PROJECTION.bits\n-                                        | TypeFlags::HAS_TY_OPAQUE.bits\n-                                        | TypeFlags::HAS_CT_PROJECTION.bits;\n+        const HAS_PROJECTION              = TypeFlags::HAS_TY_PROJECTION.bits\n+                                          | TypeFlags::HAS_TY_OPAQUE.bits\n+                                          | TypeFlags::HAS_CT_PROJECTION.bits;\n \n         /// Present if the type belongs in a local type context.\n         /// Set for placeholders and inference variables that are not \"Fresh\".\n-        const KEEP_IN_LOCAL_TCX         = 1 << 13;\n+        const KEEP_IN_LOCAL_TCX           = 1 << 13;\n \n         /// Is an error type reachable?\n-        const HAS_TY_ERR                = 1 << 14;\n+        const HAS_TY_ERR                  = 1 << 14;\n \n         /// Does this have any region that \"appears free\" in the type?\n         /// Basically anything but [ReLateBound] and [ReErased].\n-        const HAS_FREE_REGIONS          = 1 << 15;\n+        const HAS_FREE_REGIONS            = 1 << 15;\n \n         /// Does this have any [ReLateBound] regions? Used to check\n         /// if a global bound is safe to evaluate.\n-        const HAS_RE_LATE_BOUND         = 1 << 16;\n+        const HAS_RE_LATE_BOUND           = 1 << 16;\n \n         /// Does this have any [ReErased] regions?\n-        const HAS_RE_ERASED             = 1 << 17;\n+        const HAS_RE_ERASED               = 1 << 17;\n+\n+        /// Does this value have parameters/placeholders/inference variables which could be\n+        /// replaced later, in a way that would change the results of `impl` specialization?\n+        const STILL_FURTHER_SPECIALIZABLE = 1 << 18;\n \n         /// Flags representing the nominal content of a type,\n         /// computed by FlagsComputation. If you add a new nominal\n         /// flag, it should be added here too.\n-        const NOMINAL_FLAGS             = TypeFlags::HAS_TY_PARAM.bits\n-                                        | TypeFlags::HAS_RE_PARAM.bits\n-                                        | TypeFlags::HAS_CT_PARAM.bits\n-                                        | TypeFlags::HAS_TY_INFER.bits\n-                                        | TypeFlags::HAS_RE_INFER.bits\n-                                        | TypeFlags::HAS_CT_INFER.bits\n-                                        | TypeFlags::HAS_TY_PLACEHOLDER.bits\n-                                        | TypeFlags::HAS_RE_PLACEHOLDER.bits\n-                                        | TypeFlags::HAS_CT_PLACEHOLDER.bits\n-                                        | TypeFlags::HAS_FREE_LOCAL_REGIONS.bits\n-                                        | TypeFlags::HAS_TY_PROJECTION.bits\n-                                        | TypeFlags::HAS_TY_OPAQUE.bits\n-                                        | TypeFlags::HAS_CT_PROJECTION.bits\n-                                        | TypeFlags::KEEP_IN_LOCAL_TCX.bits\n-                                        | TypeFlags::HAS_TY_ERR.bits\n-                                        | TypeFlags::HAS_FREE_REGIONS.bits\n-                                        | TypeFlags::HAS_RE_LATE_BOUND.bits\n-                                        | TypeFlags::HAS_RE_ERASED.bits;\n+        const NOMINAL_FLAGS               = TypeFlags::HAS_TY_PARAM.bits\n+                                          | TypeFlags::HAS_RE_PARAM.bits\n+                                          | TypeFlags::HAS_CT_PARAM.bits\n+                                          | TypeFlags::HAS_TY_INFER.bits\n+                                          | TypeFlags::HAS_RE_INFER.bits\n+                                          | TypeFlags::HAS_CT_INFER.bits\n+                                          | TypeFlags::HAS_TY_PLACEHOLDER.bits\n+                                          | TypeFlags::HAS_RE_PLACEHOLDER.bits\n+                                          | TypeFlags::HAS_CT_PLACEHOLDER.bits\n+                                          | TypeFlags::HAS_FREE_LOCAL_REGIONS.bits\n+                                          | TypeFlags::HAS_TY_PROJECTION.bits\n+                                          | TypeFlags::HAS_TY_OPAQUE.bits\n+                                          | TypeFlags::HAS_CT_PROJECTION.bits\n+                                          | TypeFlags::KEEP_IN_LOCAL_TCX.bits\n+                                          | TypeFlags::HAS_TY_ERR.bits\n+                                          | TypeFlags::HAS_FREE_REGIONS.bits\n+                                          | TypeFlags::HAS_RE_LATE_BOUND.bits\n+                                          | TypeFlags::HAS_RE_ERASED.bits\n+                                          | TypeFlags::STILL_FURTHER_SPECIALIZABLE.bits;\n     }\n }\n "}, {"sha": "ef815aaab75e98b82b09e3b618ce244498fc5ae9", "filename": "src/librustc_middle/ty/sty.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_middle%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fty%2Fsty.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -1623,16 +1623,19 @@ impl RegionKind {\n                 flags = flags | TypeFlags::HAS_FREE_LOCAL_REGIONS;\n                 flags = flags | TypeFlags::HAS_RE_INFER;\n                 flags = flags | TypeFlags::KEEP_IN_LOCAL_TCX;\n+                flags = flags | TypeFlags::STILL_FURTHER_SPECIALIZABLE;\n             }\n             ty::RePlaceholder(..) => {\n                 flags = flags | TypeFlags::HAS_FREE_REGIONS;\n                 flags = flags | TypeFlags::HAS_FREE_LOCAL_REGIONS;\n                 flags = flags | TypeFlags::HAS_RE_PLACEHOLDER;\n+                flags = flags | TypeFlags::STILL_FURTHER_SPECIALIZABLE;\n             }\n             ty::ReEarlyBound(..) => {\n                 flags = flags | TypeFlags::HAS_FREE_REGIONS;\n                 flags = flags | TypeFlags::HAS_FREE_LOCAL_REGIONS;\n                 flags = flags | TypeFlags::HAS_RE_PARAM;\n+                flags = flags | TypeFlags::STILL_FURTHER_SPECIALIZABLE;\n             }\n             ty::ReFree { .. } | ty::ReScope { .. } => {\n                 flags = flags | TypeFlags::HAS_FREE_REGIONS;"}, {"sha": "3057b79547dc05aa0565019e3211687b3abd5690", "filename": "src/librustc_trait_selection/traits/project.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_trait_selection%2Ftraits%2Fproject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_trait_selection%2Ftraits%2Fproject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trait_selection%2Ftraits%2Fproject.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -1028,7 +1028,7 @@ fn assemble_candidates_from_impls<'cx, 'tcx>(\n                         // assume `poly_trait_ref` isn't monomorphic, if it contains any.\n                         let poly_trait_ref =\n                             selcx.infcx().resolve_vars_if_possible(&poly_trait_ref);\n-                        !poly_trait_ref.needs_infer() && !poly_trait_ref.needs_subst()\n+                        !poly_trait_ref.still_further_specializable()\n                     } else {\n                         debug!(\n                             \"assemble_candidates_from_impls: not eligible due to default: \\"}, {"sha": "e845cc9a15869b6d15f05d968017e2699b450774", "filename": "src/librustc_ty/instance.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_ty%2Finstance.rs", "raw_url": "https://github.com/rust-lang/rust/raw/857942eed0d2a37a1ce4ab4af7b589ab3a79da41/src%2Flibrustc_ty%2Finstance.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_ty%2Finstance.rs?ref=857942eed0d2a37a1ce4ab4af7b589ab3a79da41", "patch": "@@ -127,7 +127,11 @@ fn resolve_associated_item<'tcx>(\n                 // and the obligation is monomorphic, otherwise passes such as\n                 // transmute checking and polymorphic MIR optimizations could\n                 // get a result which isn't correct for all monomorphizations.\n-                if param_env.reveal == Reveal::All { !trait_ref.needs_subst() } else { false }\n+                if param_env.reveal == Reveal::All {\n+                    !trait_ref.still_further_specializable()\n+                } else {\n+                    false\n+                }\n             };\n \n             if !eligible {"}]}