{"sha": "2aa45693039c2a5c235125e065c68c5e155fbaf1", "node_id": "C_kwDOAAsO6NoAKDJhYTQ1NjkzMDM5YzJhNWMyMzUxMjVlMDY1YzY4YzVlMTU1ZmJhZjE", "commit": {"author": {"name": "Micha White", "email": "botahamec@outlook.com", "date": "2022-05-26T16:52:43Z"}, "committer": {"name": "Micha White", "email": "botahamec@outlook.com", "date": "2022-05-30T17:39:18Z"}, "message": "Triggered the lint on tuple struct and struct patterns", "tree": {"sha": "187df2208e0ea280d86e3f473ea60793076db035", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/187df2208e0ea280d86e3f473ea60793076db035"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2aa45693039c2a5c235125e065c68c5e155fbaf1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEGofhdE61kfoixWy+rtlL+hwwE4kFAmKVAYUACgkQrtlL+hww\nE4mteRAAhn18+i/2HlMSrcGsUTl4Bdgcz4lgRawJzsXm24666OMUdAFn73cBCkCr\nnkzXOZse1RIjeUy0sFdQ8I1Sg+0uDZVDnOSBbl1kBOKoiD5AT0aPryCSg3UDL1NO\npTgBCDsjmyr+d8I9HhLxJ4+3Qh1bWXj/mSsinpBC7tZH2fW0UnOu45J4nJ71y0nq\n3m6iunJaslbHddRb+7itzE9CbiG0qT8JRcqmaZ0dLKE4Kir3ID2JrThkTAo/CUsc\nuZU94pVOFl2RUH0nCxA6n0yK2tRQtISFLHIbECOLTrM/jyOYoTAAXkIQnzy2qALQ\n+8MfyF+AzZ1BfogCI098j3VpFMVs2ZeA9/RCDtC7YolWqPLOQPi7zuN0ukMgEf3/\nDaD9t1TKEpVp/uRkyS4hRCPXCpPS/c+XZM6i/QrJvCbZ1zGPI37a49OQPdwQIlNl\neFPRcxpjNP15rfKFGbWcjuwE60jxoQAR8eCwf/QjoOUtIVvcuNKSvU4nzomZWtNS\n7XUMibGuruxWrOv+O2abv1bhgpU3+tahlP2SwobHauWveRGZXSPK5R7Drm4fqZZE\n2pLgGgKYiS/WsImnDkppBYzLc9S1V839eJJtFNAabrm3BppjdrfVRqwdTs9OIKXm\n6HmcZvlsdSjQHjQt/LwEegek6N1nUAKlO/vPzvZrZViVQQD9/Cc=\n=1gAT\n-----END PGP SIGNATURE-----", "payload": "tree 187df2208e0ea280d86e3f473ea60793076db035\nparent 6553b985408dba318cd93b96eb9ce2b858100635\nauthor Micha White <botahamec@outlook.com> 1653583963 -0400\ncommitter Micha White <botahamec@outlook.com> 1653932358 -0400\n\nTriggered the lint on tuple struct and struct patterns\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2aa45693039c2a5c235125e065c68c5e155fbaf1", "html_url": "https://github.com/rust-lang/rust/commit/2aa45693039c2a5c235125e065c68c5e155fbaf1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2aa45693039c2a5c235125e065c68c5e155fbaf1/comments", "author": {"login": "botahamec", "id": 32026883, "node_id": "MDQ6VXNlcjMyMDI2ODgz", "avatar_url": "https://avatars.githubusercontent.com/u/32026883?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botahamec", "html_url": "https://github.com/botahamec", "followers_url": "https://api.github.com/users/botahamec/followers", "following_url": "https://api.github.com/users/botahamec/following{/other_user}", "gists_url": "https://api.github.com/users/botahamec/gists{/gist_id}", "starred_url": "https://api.github.com/users/botahamec/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botahamec/subscriptions", "organizations_url": "https://api.github.com/users/botahamec/orgs", "repos_url": "https://api.github.com/users/botahamec/repos", "events_url": "https://api.github.com/users/botahamec/events{/privacy}", "received_events_url": "https://api.github.com/users/botahamec/received_events", "type": "User", "site_admin": false}, "committer": {"login": "botahamec", "id": 32026883, "node_id": "MDQ6VXNlcjMyMDI2ODgz", "avatar_url": "https://avatars.githubusercontent.com/u/32026883?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botahamec", "html_url": "https://github.com/botahamec", "followers_url": "https://api.github.com/users/botahamec/followers", "following_url": "https://api.github.com/users/botahamec/following{/other_user}", "gists_url": "https://api.github.com/users/botahamec/gists{/gist_id}", "starred_url": "https://api.github.com/users/botahamec/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botahamec/subscriptions", "organizations_url": "https://api.github.com/users/botahamec/orgs", "repos_url": "https://api.github.com/users/botahamec/repos", "events_url": "https://api.github.com/users/botahamec/events{/privacy}", "received_events_url": "https://api.github.com/users/botahamec/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6553b985408dba318cd93b96eb9ce2b858100635", "url": "https://api.github.com/repos/rust-lang/rust/commits/6553b985408dba318cd93b96eb9ce2b858100635", "html_url": "https://github.com/rust-lang/rust/commit/6553b985408dba318cd93b96eb9ce2b858100635"}], "stats": {"total": 212, "additions": 206, "deletions": 6}, "files": [{"sha": "486ea5e5ccfa90c54386b6e7da4971136f9717fd", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2aa45693039c2a5c235125e065c68c5e155fbaf1/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2aa45693039c2a5c235125e065c68c5e155fbaf1/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=2aa45693039c2a5c235125e065c68c5e155fbaf1", "patch": "@@ -258,13 +258,21 @@ impl<'tcx> LateLintPass<'tcx> for UseSelf {\n             if !pat.span.from_expansion();\n             if meets_msrv(self.msrv, msrvs::TYPE_ALIAS_ENUM_VARIANTS);\n             if let Some(&StackItem::Check { impl_id, .. }) = self.stack.last();\n-            if let PatKind::Path(QPath::Resolved(_, path)) = pat.kind;\n-            if !matches!(path.res, Res::SelfTy { .. } | Res::Def(DefKind::TyParam, _));\n+            // get the path from the pattern\n+            if let PatKind::Path(QPath::Resolved(_, path))\n+                 | PatKind::TupleStruct(QPath::Resolved(_, path), _, _)\n+                 | PatKind::Struct(QPath::Resolved(_, path), _, _) = pat.kind;\n             if cx.typeck_results().pat_ty(pat) == cx.tcx.type_of(impl_id);\n-            if let [first, ..] = path.segments;\n-            if let Some(hir_id) = first.hir_id;\n             then {\n-                span_lint(cx, cx.tcx.hir().span(hir_id));\n+                match path.res {\n+                    Res::Def(DefKind::Ctor(ctor_of, _), ..) => match ctor_of {\n+                            CtorOf::Variant => lint_path_to_variant(cx, path),\n+                            CtorOf::Struct => span_lint(cx, path.span),\n+                    },\n+                    Res::Def(DefKind::Variant, ..) => lint_path_to_variant(cx, path),\n+                    Res::Def(DefKind::Struct, ..) => span_lint(cx, path.span),\n+                    _ => ()\n+                }\n             }\n         }\n     }"}, {"sha": "4f80aaecc902d1d49aa1d2c09ab19ce76787b26d", "filename": "tests/ui/use_self.fixed", "status": "modified", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.fixed?ref=2aa45693039c2a5c235125e065c68c5e155fbaf1", "patch": "@@ -542,3 +542,69 @@ mod use_self_in_pat {\n         }\n     }\n }\n+\n+mod issue8845 {\n+    pub enum Something {\n+        Num(u8),\n+        TupleNums(u8, u8),\n+        StructNums { one: u8, two: u8 },\n+    }\n+\n+    struct Foo(u8);\n+\n+    struct Bar {\n+        x: u8,\n+        y: usize,\n+    }\n+\n+    impl Something {\n+        fn get_value(&self) -> u8 {\n+            match self {\n+                Self::Num(n) => *n,\n+                Self::TupleNums(n, _m) => *n,\n+                Self::StructNums { one, two: _ } => *one,\n+            }\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            match self {\n+                Self::Num(n) => *n,\n+                Self::TupleNums(n, _m) => *n,\n+                Self::StructNums { one, two: _ } => *one,\n+            }\n+        }\n+\n+        fn imported_values(&self) -> u8 {\n+            use Something::*;\n+            match self {\n+                Num(n) => *n,\n+                TupleNums(n, _m) => *n,\n+                StructNums { one, two: _ } => *one,\n+            }\n+        }\n+    }\n+\n+    impl Foo {\n+        fn get_value(&self) -> u8 {\n+            let Self(x) = self;\n+            *x\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            let Self(x) = self;\n+            *x\n+        }\n+    }\n+\n+    impl Bar {\n+        fn get_value(&self) -> u8 {\n+            let Self { x, .. } = self;\n+            *x\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            let Self { x, .. } = self;\n+            *x\n+        }\n+    }\n+}"}, {"sha": "52da72db53ce3a9706847825d85b8a0fe062eb65", "filename": "tests/ui/use_self.rs", "status": "modified", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.rs?ref=2aa45693039c2a5c235125e065c68c5e155fbaf1", "patch": "@@ -542,3 +542,69 @@ mod use_self_in_pat {\n         }\n     }\n }\n+\n+mod issue8845 {\n+    pub enum Something {\n+        Num(u8),\n+        TupleNums(u8, u8),\n+        StructNums { one: u8, two: u8 },\n+    }\n+\n+    struct Foo(u8);\n+\n+    struct Bar {\n+        x: u8,\n+        y: usize,\n+    }\n+\n+    impl Something {\n+        fn get_value(&self) -> u8 {\n+            match self {\n+                Something::Num(n) => *n,\n+                Something::TupleNums(n, _m) => *n,\n+                Something::StructNums { one, two: _ } => *one,\n+            }\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            match self {\n+                crate::issue8845::Something::Num(n) => *n,\n+                crate::issue8845::Something::TupleNums(n, _m) => *n,\n+                crate::issue8845::Something::StructNums { one, two: _ } => *one,\n+            }\n+        }\n+\n+        fn imported_values(&self) -> u8 {\n+            use Something::*;\n+            match self {\n+                Num(n) => *n,\n+                TupleNums(n, _m) => *n,\n+                StructNums { one, two: _ } => *one,\n+            }\n+        }\n+    }\n+\n+    impl Foo {\n+        fn get_value(&self) -> u8 {\n+            let Foo(x) = self;\n+            *x\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            let crate::issue8845::Foo(x) = self;\n+            *x\n+        }\n+    }\n+\n+    impl Bar {\n+        fn get_value(&self) -> u8 {\n+            let Bar { x, .. } = self;\n+            *x\n+        }\n+\n+        fn use_crate(&self) -> u8 {\n+            let crate::issue8845::Bar { x, .. } = self;\n+            *x\n+        }\n+    }\n+}"}, {"sha": "f06bb959b3bdefe38cd776bf016403187e09b1e4", "filename": "tests/ui/use_self.stderr", "status": "modified", "additions": 61, "deletions": 1, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2aa45693039c2a5c235125e065c68c5e155fbaf1/tests%2Fui%2Fuse_self.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.stderr?ref=2aa45693039c2a5c235125e065c68c5e155fbaf1", "patch": "@@ -186,5 +186,65 @@ error: unnecessary structure name repetition\n LL |             if let Foo::Bar = self {\n    |                    ^^^ help: use the applicable keyword: `Self`\n \n-error: aborting due to 31 previous errors\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:563:17\n+   |\n+LL |                 Something::Num(n) => *n,\n+   |                 ^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:564:17\n+   |\n+LL |                 Something::TupleNums(n, _m) => *n,\n+   |                 ^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:565:17\n+   |\n+LL |                 Something::StructNums { one, two: _ } => *one,\n+   |                 ^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:571:17\n+   |\n+LL |                 crate::issue8845::Something::Num(n) => *n,\n+   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:572:17\n+   |\n+LL |                 crate::issue8845::Something::TupleNums(n, _m) => *n,\n+   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:573:17\n+   |\n+LL |                 crate::issue8845::Something::StructNums { one, two: _ } => *one,\n+   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:589:17\n+   |\n+LL |             let Foo(x) = self;\n+   |                 ^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:594:17\n+   |\n+LL |             let crate::issue8845::Foo(x) = self;\n+   |                 ^^^^^^^^^^^^^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:601:17\n+   |\n+LL |             let Bar { x, .. } = self;\n+   |                 ^^^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:606:17\n+   |\n+LL |             let crate::issue8845::Bar { x, .. } = self;\n+   |                 ^^^^^^^^^^^^^^^^^^^^^ help: use the applicable keyword: `Self`\n+\n+error: aborting due to 41 previous errors\n "}]}