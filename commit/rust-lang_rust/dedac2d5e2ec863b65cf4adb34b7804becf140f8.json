{"sha": "dedac2d5e2ec863b65cf4adb34b7804becf140f8", "node_id": "C_kwDOAAsO6NoAKGRlZGFjMmQ1ZTJlYzg2M2I2NWNmNGFkYjM0Yjc4MDRiZWNmMTQwZjg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-11T23:12:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-11T23:12:57Z"}, "message": "Auto merge of #2838 - DebugSteven:disable-epoll_wait, r=oli-obk\n\nthrow unsupported for `epoll_wait`\n\nThis PR throws unsupported to indicate miri doesn't yet return ready events. Previously it always returned 0, indicating no ready events, even if events for the epoll file descriptor may have been ready.", "tree": {"sha": "de65e628c99a3cc998781e94e13ee99ea209e1b3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de65e628c99a3cc998781e94e13ee99ea209e1b3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dedac2d5e2ec863b65cf4adb34b7804becf140f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dedac2d5e2ec863b65cf4adb34b7804becf140f8", "html_url": "https://github.com/rust-lang/rust/commit/dedac2d5e2ec863b65cf4adb34b7804becf140f8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dedac2d5e2ec863b65cf4adb34b7804becf140f8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93a05753cb866d4a4302fc6ed69ebd09aa86ba95", "url": "https://api.github.com/repos/rust-lang/rust/commits/93a05753cb866d4a4302fc6ed69ebd09aa86ba95", "html_url": "https://github.com/rust-lang/rust/commit/93a05753cb866d4a4302fc6ed69ebd09aa86ba95"}, {"sha": "9311b4a83c99571d1286e9b6f4e799a020e59aa0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9311b4a83c99571d1286e9b6f4e799a020e59aa0", "html_url": "https://github.com/rust-lang/rust/commit/9311b4a83c99571d1286e9b6f4e799a020e59aa0"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "3c263e4df9288bae88a0bf6205910d675b7b9028", "filename": "src/tools/miri/src/shims/unix/linux/fd.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Funix%2Flinux%2Ffd.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Funix%2Flinux%2Ffd.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fsrc%2Fshims%2Funix%2Flinux%2Ffd.rs?ref=dedac2d5e2ec863b65cf4adb34b7804becf140f8", "patch": "@@ -152,15 +152,14 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriInterpCxExt<'mir, 'tcx> {\n         let _maxevents = this.read_scalar(maxevents)?.to_i32()?;\n         let _timeout = this.read_scalar(timeout)?.to_i32()?;\n \n-        let numevents = 0;\n         if let Some(epfd) = this.machine.file_handler.handles.get_mut(&epfd) {\n             let _epfd = epfd\n                 .as_any_mut()\n                 .downcast_mut::<Epoll>()\n                 .ok_or_else(|| err_unsup_format!(\"non-epoll FD passed to `epoll_wait`\"))?;\n \n             // FIXME return number of events ready when scheme for marking events ready exists\n-            Ok(Scalar::from_i32(numevents))\n+            throw_unsup_format!(\"returning ready events from epoll_wait is not yet implemented\");\n         } else {\n             Ok(Scalar::from_i32(this.handle_not_found()?))\n         }"}, {"sha": "6fdfbc9913a114aa91d66687b99ddfefba66e4a4", "filename": "src/tools/miri/tests/fail/tokio/sleep.rs", "status": "renamed", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.rs?ref=dedac2d5e2ec863b65cf4adb34b7804becf140f8", "patch": "@@ -1,5 +1,7 @@\n //@compile-flags: -Zmiri-permissive-provenance -Zmiri-backtrace=full\n //@only-target-x86_64-unknown-linux: support for tokio only on linux and x86\n+//@error-pattern: returning ready events from epoll_wait is not yet implemented\n+//@normalize-stderr-test: \" += note:.*\\n\" -> \"\"\n \n use tokio::time::{sleep, Duration, Instant};\n ", "previous_filename": "src/tools/miri/tests/pass-dep/tokio/sleep.rs"}, {"sha": "ac2a984ed514af0367da59688e7e037c41bb2399", "filename": "src/tools/miri/tests/fail/tokio/sleep.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dedac2d5e2ec863b65cf4adb34b7804becf140f8/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftests%2Ffail%2Ftokio%2Fsleep.stderr?ref=dedac2d5e2ec863b65cf4adb34b7804becf140f8", "patch": "@@ -0,0 +1,15 @@\n+error: unsupported operation: returning ready events from epoll_wait is not yet implemented\n+  --> CARGO_REGISTRY/.../epoll.rs:LL:CC\n+   |\n+LL | /         syscall!(epoll_wait(\n+LL | |             self.ep,\n+LL | |             events.as_mut_ptr(),\n+LL | |             events.capacity() as i32,\n+LL | |             timeout,\n+LL | |         ))\n+   | |__________^ returning ready events from epoll_wait is not yet implemented\n+   |\n+   = help: this is likely not a bug in the program; it indicates that the program performed an operation that the interpreter does not support\n+\n+error: aborting due to previous error\n+"}]}