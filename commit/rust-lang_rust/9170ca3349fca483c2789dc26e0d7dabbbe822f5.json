{"sha": "9170ca3349fca483c2789dc26e0d7dabbbe822f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxNzBjYTMzNDlmY2E0ODNjMjc4OWRjMjZlMGQ3ZGFiYmJlODIyZjU=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2019-05-16T16:47:21Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2019-05-17T11:05:43Z"}, "message": "Backport #4101\n\nhttps://github.com/rust-lang/rust-clippy/pull/4101\n\nSplits up redundant_closure's method checking into a pedantic lint", "tree": {"sha": "2d8da49f1120363e93d61237f975a44950c48416", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d8da49f1120363e93d61237f975a44950c48416"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9170ca3349fca483c2789dc26e0d7dabbbe822f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9170ca3349fca483c2789dc26e0d7dabbbe822f5", "html_url": "https://github.com/rust-lang/rust/commit/9170ca3349fca483c2789dc26e0d7dabbbe822f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9170ca3349fca483c2789dc26e0d7dabbbe822f5/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37f5c1ec734f806fe98930b8d5f54f00013f06f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/37f5c1ec734f806fe98930b8d5f54f00013f06f1", "html_url": "https://github.com/rust-lang/rust/commit/37f5c1ec734f806fe98930b8d5f54f00013f06f1"}], "stats": {"total": 82, "additions": 54, "deletions": 28}, "files": [{"sha": "7a73156638518031ab5b54356ba488bc7ed13aa2", "filename": ".travis.yml", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -1,6 +1,6 @@\n language: rust\n \n-rust: nightly\n+rust: beta\n \n os:\n   - linux\n@@ -17,6 +17,7 @@ branches:\n env:\n  global:\n    - RUST_BACKTRACE=1\n+   - RUSTC_BOOTSTRAP=1\n \n install:\n   - |\n@@ -90,7 +91,7 @@ matrix:\n script:\n   - |\n       rm rust-toolchain\n-      ./setup-toolchain.sh\n+      rustup override set beta\n       export LD_LIBRARY_PATH=$(rustc --print sysroot)/lib\n   - |\n     if [ -z ${INTEGRATION} ]; then"}, {"sha": "aca02b53d01764ce4564258e5f72da1eac9fa02a", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -978,6 +978,7 @@ All notable changes to this project will be documented in this file.\n [`redundant_clone`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone\n [`redundant_closure`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure\n [`redundant_closure_call`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_call\n+[`redundant_closure_for_method_calls`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_closure_for_method_calls\n [`redundant_field_names`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_field_names\n [`redundant_pattern`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_pattern\n [`redundant_pattern_matching`]: https://rust-lang.github.io/rust-clippy/master/index.html#redundant_pattern_matching"}, {"sha": "523704a86f3381426c73b4e6964722f40ae13b9c", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -7,7 +7,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 298 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 299 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "0bf74c6fe707e74d8c747b498f5f92e3fdccbc25", "filename": "appveyor.yml", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -16,14 +16,8 @@ branches:\n \n install:\n     - curl -sSf -o rustup-init.exe https://win.rustup.rs/\n-    - rustup-init.exe -y --default-host %TARGET% --default-toolchain nightly\n+    - rustup-init.exe -y --default-host %TARGET% --default-toolchain beta\n     - set PATH=%PATH%;C:\\Users\\appveyor\\.cargo\\bin\n-    - git ls-remote https://github.com/rust-lang/rust.git master | awk '{print $1}' >rustc-hash.txt\n-    - set /p RUSTC_HASH=<rustc-hash.txt\n-    - del rust-toolchain\n-    - cargo install rustup-toolchain-install-master --debug || echo \"rustup-toolchain-install-master already installed\"\n-    - rustup-toolchain-install-master %RUSTC_HASH% -f -n master\n-    - rustup default master\n     - set PATH=%PATH%;C:\\Users\\appveyor\\.rustup\\toolchains\\master\\bin\n     - rustc -V\n     - cargo -V\n@@ -32,6 +26,7 @@ build: false\n \n test_script:\n     - set RUST_BACKTRACE=1\n+    - set RUSTC_BOOTSTRAP=1\n     - cargo build --features debugging\n     - cargo test --features debugging\n "}, {"sha": "187fc062fbf6888f2f036e956452d04535049736", "filename": "ci/base-tests.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/ci%2Fbase-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/ci%2Fbase-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fbase-tests.sh?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -75,4 +75,4 @@ if [ \"${tests_need_reformatting}\" == \"true\" ] ; then\n fi\n \n # switch back to master\n-rustup override set master\n+# rustup override set master"}, {"sha": "afbee6f8ded2a1b1b519efeee72b480195f9b5bf", "filename": "clippy_lints/src/eta_reduction.rs", "status": "modified", "additions": 24, "deletions": 2, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/clippy_lints%2Fsrc%2Feta_reduction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/clippy_lints%2Fsrc%2Feta_reduction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Feta_reduction.rs?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -33,9 +33,31 @@ declare_clippy_lint! {\n     \"redundant closures, i.e., `|a| foo(a)` (which can be written as just `foo`)\"\n }\n \n+declare_clippy_lint! {\n+    /// **What it does:** Checks for closures which only invoke a method on the closure\n+    /// argument and can be replaced by referencing the method directly.\n+    ///\n+    /// **Why is this bad?** It's unnecessary to create the closure.\n+    ///\n+    /// **Known problems:** rust-lang/rust-clippy#3071, rust-lang/rust-clippy#4002,\n+    /// rust-lang/rust-clippy#3942\n+    ///\n+    /// **Example:**\n+    /// ```rust,ignore\n+    /// Some('a').map(|s| s.to_uppercase());\n+    /// ```\n+    /// may be rewritten as\n+    /// ```rust,ignore\n+    /// Some('a').map(char::to_uppercase);\n+    /// ```\n+    pub REDUNDANT_CLOSURE_FOR_METHOD_CALLS,\n+    pedantic,\n+    \"redundant closures for method calls\"\n+}\n+\n impl LintPass for EtaPass {\n     fn get_lints(&self) -> LintArray {\n-        lint_array!(REDUNDANT_CLOSURE)\n+        lint_array!(REDUNDANT_CLOSURE, REDUNDANT_CLOSURE_FOR_METHOD_CALLS)\n     }\n \n     fn name(&self) -> &'static str {\n@@ -110,7 +132,7 @@ fn check_closure(cx: &LateContext<'_, '_>, expr: &Expr) {\n             if let Some(name) = get_ufcs_type_name(cx, method_def_id, &args[0]);\n \n             then {\n-                span_lint_and_then(cx, REDUNDANT_CLOSURE, expr.span, \"redundant closure found\", |db| {\n+                span_lint_and_then(cx, REDUNDANT_CLOSURE_FOR_METHOD_CALLS, expr.span, \"redundant closure found\", |db| {\n                     db.span_suggestion(\n                         expr.span,\n                         \"remove closure as shown\","}, {"sha": "dca0badc29f2bfe7c7ea048a0d229899fb0689e1", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -611,6 +611,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry<'_>, conf: &Conf) {\n         enum_glob_use::ENUM_GLOB_USE,\n         enum_variants::MODULE_NAME_REPETITIONS,\n         enum_variants::PUB_ENUM_VARIANT_NAMES,\n+        eta_reduction::REDUNDANT_CLOSURE_FOR_METHOD_CALLS,\n         functions::TOO_MANY_LINES,\n         if_not_else::IF_NOT_ELSE,\n         infinite_iter::MAYBE_INFINITE_ITER,"}, {"sha": "65b2df87f7df3aeedef04be96703e55ac19c2cfb", "filename": "rust-toolchain", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/rust-toolchain", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/rust-toolchain", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/rust-toolchain?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -1 +1 @@\n-nightly\n+beta"}, {"sha": "d65f8eaab1cbf249992b01916b066f205d29bed4", "filename": "tests/ui/eta.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Feta.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Feta.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Feta.rs?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -7,7 +7,11 @@\n     clippy::option_map_unit_fn,\n     clippy::trivially_copy_pass_by_ref\n )]\n-#![warn(clippy::redundant_closure, clippy::needless_borrow)]\n+#![warn(\n+    clippy::redundant_closure,\n+    clippy::redundant_closure_for_method_calls,\n+    clippy::needless_borrow\n+)]\n \n use std::path::PathBuf;\n "}, {"sha": "0d9f48d6f4a26d0d2aa20f9838a3871e501b6887", "filename": "tests/ui/eta.stderr", "status": "modified", "additions": 13, "deletions": 11, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Feta.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Feta.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Feta.stderr?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -1,69 +1,71 @@\n error: redundant closure found\n-  --> $DIR/eta.rs:15:27\n+  --> $DIR/eta.rs:19:27\n    |\n LL |     let a = Some(1u8).map(|a| foo(a));\n    |                           ^^^^^^^^^^ help: remove closure as shown: `foo`\n    |\n    = note: `-D clippy::redundant-closure` implied by `-D warnings`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:16:10\n+  --> $DIR/eta.rs:20:10\n    |\n LL |     meta(|a| foo(a));\n    |          ^^^^^^^^^^ help: remove closure as shown: `foo`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:17:27\n+  --> $DIR/eta.rs:21:27\n    |\n LL |     let c = Some(1u8).map(|a| {1+2; foo}(a));\n    |                           ^^^^^^^^^^^^^^^^^ help: remove closure as shown: `{1+2; foo}`\n \n error: this expression borrows a reference that is immediately dereferenced by the compiler\n-  --> $DIR/eta.rs:19:21\n+  --> $DIR/eta.rs:23:21\n    |\n LL |     all(&[1, 2, 3], &&2, |x, y| below(x, y)); //is adjusted\n    |                     ^^^ help: change this to: `&2`\n    |\n    = note: `-D clippy::needless-borrow` implied by `-D warnings`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:26:27\n+  --> $DIR/eta.rs:30:27\n    |\n LL |     let e = Some(1u8).map(|a| generic(a));\n    |                           ^^^^^^^^^^^^^^ help: remove closure as shown: `generic`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:69:51\n+  --> $DIR/eta.rs:73:51\n    |\n LL |     let e = Some(TestStruct { some_ref: &i }).map(|a| a.foo());\n    |                                                   ^^^^^^^^^^^ help: remove closure as shown: `TestStruct::foo`\n+   |\n+   = note: `-D clippy::redundant-closure-for-method-calls` implied by `-D warnings`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:71:51\n+  --> $DIR/eta.rs:75:51\n    |\n LL |     let e = Some(TestStruct { some_ref: &i }).map(|a| a.trait_foo());\n    |                                                   ^^^^^^^^^^^^^^^^^ help: remove closure as shown: `TestTrait::trait_foo`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:74:42\n+  --> $DIR/eta.rs:78:42\n    |\n LL |     let e = Some(&mut vec![1, 2, 3]).map(|v| v.clear());\n    |                                          ^^^^^^^^^^^^^ help: remove closure as shown: `std::vec::Vec::clear`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:79:29\n+  --> $DIR/eta.rs:83:29\n    |\n LL |     let e = Some(\"str\").map(|s| s.to_string());\n    |                             ^^^^^^^^^^^^^^^^^ help: remove closure as shown: `std::string::ToString::to_string`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:81:27\n+  --> $DIR/eta.rs:85:27\n    |\n LL |     let e = Some('a').map(|s| s.to_uppercase());\n    |                           ^^^^^^^^^^^^^^^^^^^^ help: remove closure as shown: `char::to_uppercase`\n \n error: redundant closure found\n-  --> $DIR/eta.rs:84:65\n+  --> $DIR/eta.rs:88:65\n    |\n LL |     let e: std::vec::Vec<char> = vec!['a', 'b', 'c'].iter().map(|c| c.to_ascii_uppercase()).collect();\n    |                                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: remove closure as shown: `char::to_ascii_uppercase`"}, {"sha": "afd1568a3e11ab6c26c5e88e6be0a069d81e7ffd", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -3,7 +3,7 @@\n #![allow(clippy::iter_cloned_collect)]\n #![allow(clippy::clone_on_copy)]\n #![allow(clippy::missing_docs_in_private_items)]\n-#![allow(clippy::redundant_closure)]\n+#![allow(clippy::redundant_closure_for_method_calls)]\n \n fn main() {\n     let _: Vec<i8> = vec![5_i8; 6].iter().cloned().collect();"}, {"sha": "deacaf4abe8bb5b6590550182adcc1816e0870b0", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9170ca3349fca483c2789dc26e0d7dabbbe822f5/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=9170ca3349fca483c2789dc26e0d7dabbbe822f5", "patch": "@@ -3,7 +3,7 @@\n #![allow(clippy::iter_cloned_collect)]\n #![allow(clippy::clone_on_copy)]\n #![allow(clippy::missing_docs_in_private_items)]\n-#![allow(clippy::redundant_closure)]\n+#![allow(clippy::redundant_closure_for_method_calls)]\n \n fn main() {\n     let _: Vec<i8> = vec![5_i8; 6].iter().map(|x| *x).collect();"}]}