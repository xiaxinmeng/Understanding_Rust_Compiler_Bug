{"sha": "a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "node_id": "C_kwDOAAsO6NoAKGE5YzRjNmRhNGNmN2Y3OTA3YjBiMGEwMGI4OTZmY2I0YjEyOGVjMmQ", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-11-22T17:00:32Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-11-22T17:00:32Z"}, "message": "Fix mbe::Shift::new not accounting for non-ident token ids", "tree": {"sha": "0ac7bd59afe8bb0ece258ab64d073b3fb15e7ab9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ac7bd59afe8bb0ece258ab64d073b3fb15e7ab9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "html_url": "https://github.com/rust-lang/rust/commit/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0bc30039609e34b7df251340f71c7b3446e5a0a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/0bc30039609e34b7df251340f71c7b3446e5a0a6", "html_url": "https://github.com/rust-lang/rust/commit/0bc30039609e34b7df251340f71c7b3446e5a0a6"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "466c85fc5b092f0c80377a557b6008936575e196", "filename": "crates/hir_def/src/macro_expansion_tests/mbe.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fmacro_expansion_tests%2Fmbe.rs?ref=a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "patch": "@@ -27,7 +27,7 @@ macro_rules! f {\n f!(struct MyTraitMap2);\n \"#,\n         expect![[r##\"\n-// call ids will be shifted by Shift(27)\n+// call ids will be shifted by Shift(30)\n // +tokenids\n macro_rules! f {#0\n     (#1 struct#2 $#3ident#4:#5ident#6 )#1 =#7>#8 {#9\n@@ -39,7 +39,7 @@ macro_rules! f {#0\n \n // // +tokenids\n // f!(struct#1 MyTraitMap2#2);\n-struct#10 MyTraitMap2#29 {#13\n+struct#10 MyTraitMap2#32 {#13\n     map#14:#15 ::std#18::collections#21::HashSet#24<#25(#26)#26>#27,#28\n }#13\n \"##]],"}, {"sha": "b58b86b38d665e0476c2eedab4f5857b6f252f28", "filename": "crates/mbe/src/lib.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d/crates%2Fmbe%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d/crates%2Fmbe%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Flib.rs?ref=a9c4c6da4cf7f7907b0b0a00b896fcb4b128ec2d", "patch": "@@ -120,12 +120,15 @@ impl Shift {\n                             _ => tree_id,\n                         }\n                     }\n-                    tt::TokenTree::Leaf(tt::Leaf::Ident(ident))\n-                        if ident.id != tt::TokenId::unspecified() =>\n-                    {\n-                        Some(ident.id.0)\n+                    tt::TokenTree::Leaf(leaf) => {\n+                        let id = match leaf {\n+                            tt::Leaf::Literal(it) => it.id,\n+                            tt::Leaf::Punct(it) => it.id,\n+                            tt::Leaf::Ident(it) => it.id,\n+                        };\n+\n+                        (id != tt::TokenId::unspecified()).then(|| id.0)\n                     }\n-                    _ => None,\n                 })\n                 .max()\n         }"}]}