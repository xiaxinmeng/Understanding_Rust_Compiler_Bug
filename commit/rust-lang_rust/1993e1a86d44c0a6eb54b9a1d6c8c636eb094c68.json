{"sha": "1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5OTNlMWE4NmQ0NGMwYTZlYjU0YjlhMWQ2YzhjNjM2ZWIwOTRjNjg=", "commit": {"author": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2021-04-30T04:01:04Z"}, "committer": {"name": "Tyler Mandry", "email": "tmandry@gmail.com", "date": "2021-05-06T02:49:34Z"}, "message": "Support multi target-rustcflags for -Zpanic-abort-tests\n\nI just need this until rustbuild supports -Cpanic=abort std directly.", "tree": {"sha": "1b0ea97b3d0a3f53d60c1fc042e7471526d959ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b0ea97b3d0a3f53d60c1fc042e7471526d959ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "html_url": "https://github.com/rust-lang/rust/commit/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68/comments", "author": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1a8ecf771485d517010c66b8532c39635725813", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1a8ecf771485d517010c66b8532c39635725813", "html_url": "https://github.com/rust-lang/rust/commit/e1a8ecf771485d517010c66b8532c39635725813"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "874dbdb42c33c133a14dfe75d19b5e33e2049333", "filename": "src/test/ui/test-panic-abort-disabled.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68/src%2Ftest%2Fui%2Ftest-panic-abort-disabled.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68/src%2Ftest%2Fui%2Ftest-panic-abort-disabled.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftest-panic-abort-disabled.rs?ref=1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "patch": "@@ -1,6 +1,6 @@\n // error-pattern:building tests with panic=abort is not supported\n // no-prefer-dynamic\n-// compile-flags: --test -Cpanic=abort\n+// compile-flags: --test -Cpanic=abort -Zpanic-abort-tests=no\n // run-flags: --test-threads=1\n \n // ignore-wasm no panic or subprocess support"}, {"sha": "5edeefb609982a449c8e58aa0d0692ddabc23e5d", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=1993e1a86d44c0a6eb54b9a1d6c8c636eb094c68", "patch": "@@ -98,8 +98,8 @@ pub fn parse_config(args: Vec<String>) -> Config {\n              (eg. emulator, valgrind)\",\n             \"PROGRAM\",\n         )\n-        .optopt(\"\", \"host-rustcflags\", \"flags to pass to rustc for host\", \"FLAGS\")\n-        .optopt(\"\", \"target-rustcflags\", \"flags to pass to rustc for target\", \"FLAGS\")\n+        .optmulti(\"\", \"host-rustcflags\", \"flags to pass to rustc for host\", \"FLAGS\")\n+        .optmulti(\"\", \"target-rustcflags\", \"flags to pass to rustc for target\", \"FLAGS\")\n         .optopt(\"\", \"target-panic\", \"what panic strategy the target supports\", \"unwind | abort\")\n         .optflag(\"\", \"verbose\", \"run tests verbosely, showing all output\")\n         .optflag(\n@@ -239,8 +239,8 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         }),\n         logfile: matches.opt_str(\"logfile\").map(|s| PathBuf::from(&s)),\n         runtool: matches.opt_str(\"runtool\"),\n-        host_rustcflags: matches.opt_str(\"host-rustcflags\"),\n-        target_rustcflags: matches.opt_str(\"target-rustcflags\"),\n+        host_rustcflags: Some(matches.opt_strs(\"host-rustcflags\").join(\" \")),\n+        target_rustcflags: Some(matches.opt_strs(\"target-rustcflags\").join(\" \")),\n         target_panic: match matches.opt_str(\"target-panic\").as_deref() {\n             Some(\"unwind\") | None => PanicStrategy::Unwind,\n             Some(\"abort\") => PanicStrategy::Abort,"}]}