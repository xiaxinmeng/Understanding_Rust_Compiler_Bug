{"sha": "8ae74da63b11ca298a30cc1af686019c7417938a", "node_id": "C_kwDOAAsO6NoAKDhhZTc0ZGE2M2IxMWNhMjk4YTMwY2MxYWY2ODYwMTljNzQxNzkzOGE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-10T03:08:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-10T03:08:34Z"}, "message": "Auto merge of #8070 - CrazyRoka:update-gh-pages-checkbox-styles, r=camsteffen\n\nImprove styles of filtering options for Clippy's lint list\n\nPartially solves #7958\n\nUpdated styles for filtering options. It now uses dropdown menus.\n\n![image](https://user-images.githubusercontent.com/19844144/144608479-cdd9de0b-f101-4d49-a135-0969efb01a11.png)\n\nchangelog: none", "tree": {"sha": "2fd31e2ec27c853627126b8d5e05fa8bac097ca8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2fd31e2ec27c853627126b8d5e05fa8bac097ca8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ae74da63b11ca298a30cc1af686019c7417938a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ae74da63b11ca298a30cc1af686019c7417938a", "html_url": "https://github.com/rust-lang/rust/commit/8ae74da63b11ca298a30cc1af686019c7417938a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ae74da63b11ca298a30cc1af686019c7417938a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c483f69db979f9dc88f96493ea4b21d946d845d", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c483f69db979f9dc88f96493ea4b21d946d845d", "html_url": "https://github.com/rust-lang/rust/commit/0c483f69db979f9dc88f96493ea4b21d946d845d"}, {"sha": "296af08b3c4ee2cd74b53e71279c8d2be254031e", "url": "https://api.github.com/repos/rust-lang/rust/commits/296af08b3c4ee2cd74b53e71279c8d2be254031e", "html_url": "https://github.com/rust-lang/rust/commit/296af08b3c4ee2cd74b53e71279c8d2be254031e"}], "stats": {"total": 282, "additions": 211, "deletions": 71}, "files": [{"sha": "97c974003c62fe7ebf6881db8494db8f092314d7", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 211, "deletions": 71, "changes": 282, "blob_url": "https://github.com/rust-lang/rust/blob/8ae74da63b11ca298a30cc1af686019c7417938a/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/8ae74da63b11ca298a30cc1af686019c7417938a/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=8ae74da63b11ca298a30cc1af686019c7417938a", "patch": "@@ -25,7 +25,56 @@\n         blockquote { font-size: 1em; }\n         [ng\\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak { display: none !important; }\n \n-        .form-inline .checkbox { margin-right: 0.6em }\n+        .dropdown-menu {\n+            color: var(--fg);\n+            background: var(--theme-popup-bg);\n+            border: 1px solid var(--theme-popup-border);\n+        }\n+\n+        .dropdown-menu .divider {\n+            background-color: var(--theme-popup-border);\n+        }\n+\n+        .dropdown-menu .checkbox {\n+            display: block;\n+            white-space: nowrap;\n+            margin: 0;\n+        }\n+        .dropdown-menu .checkbox label {\n+            padding: 3px 20px;\n+            width: 100%;\n+        }\n+\n+        .dropdown-menu .checkbox input {\n+            position: relative;\n+            margin: 0 0.5rem 0;\n+            padding: 0;\n+        }\n+\n+        .dropdown-menu .checkbox:hover {\n+            background-color: var(--theme-hover);\n+        }\n+\n+        div.panel div.panel-body button.dropdown-toggle {\n+            background: var(--searchbar-bg);\n+            color: var(--searchbar-fg);\n+            border-color: var(--theme-popup-border);\n+        }\n+\n+        div.panel div.panel-body button.dropdown-toggle:hover {\n+            box-shadow: 0 0 3px var(--searchbar-shadow-color);\n+        }\n+\n+        div.panel div.panel-body .open button.dropdown-toggle {\n+            background: var(--searchbar-bg);\n+            color: var(--searchbar-fg);\n+            border-color: var(--theme-popup-border);\n+            filter: brightness(90%);\n+        }\n+\n+        .dropdown-toggle .badge {\n+            background-color: #777;\n+        }\n \n         .panel-heading { cursor: pointer; }\n \n@@ -38,6 +87,16 @@\n         .panel .panel-title-name .anchor { display: none; }\n         .panel:hover .panel-title-name .anchor { display: inline;}\n \n+        .search-control {\n+            margin-top: 15px;\n+        }\n+\n+        @media (min-width: 992px) {\n+            .search-control {\n+                margin-top: 0;\n+            }\n+        }\n+\n         .label {\n             padding-top: 0.3em;\n             padding-bottom: 0.3em;\n@@ -143,13 +202,17 @@\n             --inline-code-bg: #191f26;\n         }\n \n+        .theme-dropdown {\n+            position: absolute;\n+            margin: 0.7em;\n+            z-index: 10;\n+        }\n+\n         /* Applying the mdBook theme */\n         .theme-icon {\n-            position: absolute;\n             text-align: center;\n             width: 2em;\n             height: 2em;\n-            margin: 0.7em;\n             line-height: 2em;\n             border: solid 1px var(--icons);\n             border-radius: 5px;\n@@ -160,23 +223,28 @@\n             background: var(--theme-hover);\n         }\n         .theme-choice {\n-            position: absolute;\n-            margin-top: calc(2em + 0.7em);\n-            margin-left: 0.7em;\n+            display: none;\n             list-style: none;\n             border: 1px solid var(--theme-popup-border);\n             border-radius: 5px;\n             color: var(--fg);\n             background: var(--theme-popup-bg);\n             padding: 0 0;\n+            overflow: hidden;\n         }\n+\n+        .theme-dropdown.open .theme-choice {\n+            display: block;\n+        }\n+\n         .theme-choice > li {\n             padding: 5px 10px;\n             font-size: 0.8em;\n             user-select: none;\n             cursor: pointer;\n         }\n-        .theme-choice > li:hover {\n+\n+        .theme-choice>li:hover {\n             background: var(--theme-hover);\n         }\n \n@@ -240,17 +308,15 @@\n \n     </style>\n </head>\n-<body>\n-    <div id=\"theme-icon\" class=\"theme-icon\">&#128396;</div>\n-    <ul id=\"theme-menu\" class=\"theme-choice\" style=\"display: none;\">\n-        <li id=\"light\">Light</li>\n-        <li id=\"rust\">Rust</li>\n-        <li id=\"coal\">Coal</li>\n-        <li id=\"navy\">Navy</li>\n-        <li id=\"ayu\">Ayu</li>\n-    </ul>\n-\n-    <div class=\"container\" ng-app=\"clippy\" ng-controller=\"lintList\">\n+<body ng-app=\"clippy\" ng-controller=\"lintList\">\n+    <div theme-dropdown class=\"theme-dropdown\">\n+        <div id=\"theme-icon\" class=\"theme-icon\">&#128396;</div>\n+        <ul id=\"theme-menu\" class=\"theme-choice\">\n+            <li id=\"{{id}}\" ng-repeat=\"(id, name) in themes\" ng-click=\"selectTheme(id)\">{{name}}</li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"container\">\n         <div class=\"page-header\">\n             <h1>Clippy Lints</h1>\n         </div>\n@@ -271,38 +337,62 @@ <h1>Clippy Lints</h1>\n             </div>\n \n             <div class=\"panel panel-default\" ng-show=\"data\">\n-                <div class=\"panel-body row filter-panel\">\n-                    <div class=\"col-md-6 form-inline\">\n-                        <div class=\"form-group form-group-lg\">\n-                            <p class=\"h4\">\n-                                Lint levels\n-                                <a href=\"https://doc.rust-lang.org/rustc/lints/levels.html\">(?)</a>\n-                            </p>\n-                            <div class=\"checkbox\" ng-repeat=\"(level, enabled) in levels\">\n-                                <label class=\"text-capitalize\">\n-                                    <input type=\"checkbox\" ng-model=\"levels[level]\" />\n-                                    {{level}}\n-                                </label>\n-                            </div>\n+                <div class=\"panel-body row\">\n+                    <div class=\"col-12 col-md-4\">\n+                        <div class=\"btn-group\" filter-dropdown>\n+                            <button type=\"button\" class=\"btn btn-default dropdown-toggle\">\n+                                Lint levels <span class=\"badge\">{{selectedValuesCount(levels)}}</span> <span class=\"caret\"></span>\n+                            </button>\n+                            <ul class=\"dropdown-menu\">\n+                                <li class=\"checkbox\">\n+                                    <label ng-click=\"toggleLevels(true)\">\n+                                        <input type=\"checkbox\" class=\"invisible\" />\n+                                        All\n+                                    </label>\n+                                </li>\n+                                <li class=\"checkbox\">\n+                                    <label ng-click=\"toggleLevels(false)\">\n+                                        <input type=\"checkbox\" class=\"invisible\" />\n+                                        None\n+                                    </label>\n+                                </li>\n+                                <li role=\"separator\" class=\"divider\"></li>\n+                                <li class=\"checkbox\" ng-repeat=\"(level, enabled) in levels\">\n+                                    <label class=\"text-capitalize\">\n+                                        <input type=\"checkbox\" ng-model=\"levels[level]\" />\n+                                        {{level}}\n+                                    </label>\n+                                </li>\n+                            </ul>\n                         </div>\n-                    </div>\n-                    <div class=\"col-md-6 form-inline\">\n-                        <div class=\"form-group form-group-lg\">\n-                            <p class=\"h4\">\n-                                Lint groups\n-                                <a href=\"https://github.com/rust-lang/rust-clippy/#clippy\">(?)</a>\n-                            </p>\n-                            <div class=\"checkbox\" ng-repeat=\"(group, enabled) in groups\">\n-                                <label class=\"text-capitalize\">\n-                                    <input type=\"checkbox\" ng-model=\"groups[group]\" />\n-                                    {{group}}\n-                                </label>\n-                            </div>\n+                        <div class=\"btn-group\" filter-dropdown>\n+                            <button type=\"button\" class=\"btn btn-default dropdown-toggle\">\n+                                Lint groups <span class=\"badge\">{{selectedValuesCount(groups)}}</span> <span class=\"caret\"></span>\n+                            </button>\n+                            <ul class=\"dropdown-menu\">\n+                                <li class=\"checkbox\">\n+                                    <label ng-click=\"toggleGroups(true)\">\n+                                        <input type=\"checkbox\" class=\"invisible\" />\n+                                        All\n+                                    </label>\n+                                </li>\n+                                <li class=\"checkbox\">\n+                                    <label ng-click=\"toggleGroups(false)\">\n+                                        <input type=\"checkbox\" class=\"invisible\" />\n+                                        None\n+                                    </label>\n+                                </li>\n+                                <li role=\"separator\" class=\"divider\"></li>\n+                                <li class=\"checkbox\" ng-repeat=\"(group, enabled) in groups\">\n+                                    <label class=\"text-capitalize\">\n+                                        <input type=\"checkbox\" ng-model=\"groups[group]\" />\n+                                        {{group}}\n+                                    </label>\n+                                </li>\n+                            </ul>\n                         </div>\n                     </div>\n-                </div>\n-                <div class=\"panel-body row\">\n-                    <div class=\"col-md-12 form-horizontal\">\n+                    <div class=\"col-12 col-md-8 search-control\">\n                         <div class=\"input-group\">\n                             <label class=\"input-group-addon\" id=\"filter-label\" for=\"filter-input\">Filter:</label>\n                             <input type=\"text\" class=\"form-control\" placeholder=\"Keywords or search string\" id=\"filter-input\" ng-model=\"search\" ng-model-options=\"{debounce: 50}\"/>\n@@ -336,7 +426,7 @@ <h2 class=\"panel-title\">\n                     </h2>\n                 </header>\n \n-                <div class=\"list-group lint-docs\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n+                <div class=\"list-group lint-docs\" ng-if=\"open[lint.id]\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n                     <div class=\"list-group-item lint-doc-md\" ng-bind-html=\"lint.docs | markdown\"></div>\n                     <div class=\"lint-additional-info-container\">\n                         <!-- Applicability -->\n@@ -365,7 +455,7 @@ <h2 class=\"panel-title\">\n     </div>\n \n     <a href=\"https://github.com/rust-lang/rust-clippy\">\n-        <img style=\"position: absolute; top: 0; right: 0; border: 0;\" src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png\" alt=\"Fork me on Github\"/>\n+        <img style=\"position: absolute; top: 0; right: 0; border: 0; clip-path: polygon(0% 0%, 100% 0%, 100% 100%);\" src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png\" alt=\"Fork me on Github\"/>\n     </a>\n \n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.3.2/markdown-it.min.js\"></script>\n@@ -429,6 +519,46 @@ <h2 class=\"panel-title\">\n                 );\n             };\n         })\n+        .directive('themeDropdown', function ($document) {\n+            return {\n+                restrict: 'A',\n+                link: function ($scope, $element, $attr) {\n+                    $element.bind('click', function () {\n+                        $element.toggleClass('open');\n+                        $element.addClass('open-recent');\n+                    });\n+\n+                    $document.bind('click', function () {\n+                        if (!$element.hasClass('open-recent')) {\n+                            $element.removeClass('open');\n+                        }\n+                        $element.removeClass('open-recent');\n+                    })\n+                }\n+            }\n+        })\n+        .directive('filterDropdown', function ($document) {\n+            return {\n+                restrict: 'A',\n+                link: function ($scope, $element, $attr) {\n+                    $element.bind('click', function (event) {\n+                        if (event.target.closest('button')) {\n+                            $element.toggleClass('open');\n+                        } else {\n+                            $element.addClass('open');\n+                        }\n+                        $element.addClass('open-recent');\n+                    });\n+\n+                    $document.bind('click', function () {\n+                        if (!$element.hasClass('open-recent')) {\n+                            $element.removeClass('open');\n+                        }\n+                        $element.removeClass('open-recent');\n+                    })\n+                }\n+            }\n+        })\n         .directive('onFinishRender', function ($timeout) {\n             return {\n                 restrict: 'A',\n@@ -462,6 +592,38 @@ <h2 class=\"panel-title\">\n                 suspicious: true,\n             };\n             $scope.groups = GROUPS_FILTER_DEFAULT;\n+            const THEMES_DEFAULT = {\n+                light: \"Light\",\n+                rust: \"Rust\",\n+                coal: \"Coal\",\n+                navy: \"Navy\",\n+                ayu: \"Ayu\"\n+            };\n+            $scope.themes = THEMES_DEFAULT;\n+\n+            $scope.selectTheme = function (theme) {\n+                setTheme(theme, true);\n+            }\n+\n+            $scope.toggleLevels = function (value) {\n+                const levels = $scope.levels;\n+                for (const key in levels) {\n+                    if (levels.hasOwnProperty(key)) {\n+                        levels[key] = value;\n+                    }\n+                }\n+            };\n+            $scope.toggleGroups = function (value) {\n+                const groups = $scope.groups;\n+                for (const key in groups) {\n+                    if (groups.hasOwnProperty(key)) {\n+                        groups[key] = value;\n+                    }\n+                }\n+            };\n+            $scope.selectedValuesCount = function (obj) {\n+                return Object.values(obj).filter(x => x).length;\n+            }\n             $scope.byGroups = function (lint) {\n                 return $scope.groups[lint.group];\n             };\n@@ -558,28 +720,6 @@ <h2 class=\"panel-title\">\n         }\n     }\n \n-    function setupListeners() {\n-        let themeIcon = document.getElementById(\"theme-icon\");\n-        let themeMenu = document.getElementById(\"theme-menu\");\n-        themeIcon.addEventListener(\"click\", function(e) {\n-            if (themeMenu.style.display == \"none\") {\n-                themeMenu.style.display = \"block\";\n-            } else {\n-                themeMenu.style.display = \"none\";\n-            }\n-        });\n-\n-        let children = themeMenu.children;\n-        for (let index = 0; index < children.length; index++) {\n-            let child = children[index];\n-            child.addEventListener(\"click\", function(e) {\n-                setTheme(child.id, true);\n-            });\n-        }\n-    }\n-\n-    setupListeners();\n-\n     function setTheme(theme, store) {\n         let enableHighlight = false;\n         let enableNight = false;"}]}