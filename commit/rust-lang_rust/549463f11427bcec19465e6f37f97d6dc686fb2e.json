{"sha": "549463f11427bcec19465e6f37f97d6dc686fb2e", "node_id": "C_kwDOAAsO6NoAKDU0OTQ2M2YxMTQyN2JjZWMxOTQ2NWU2ZjM3Zjk3ZDZkYzY4NmZiMmU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-31T21:39:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-31T21:39:42Z"}, "message": "Rollup merge of #99973 - RalfJung:layout-things, r=eddyb\n\nLayout things\n\nThese two commits are pretty independent, but didn't seem worth doing individual PRs for:\n- Always check that size is a multiple of align, even without debug assertions\n- Change Layout debug printing to put `variants` last, since it often huge and not usually the part we are most interested in\n\nCc `@eddyb`", "tree": {"sha": "96af010d69449ddaf3fc8cc18f7815c70d7d4aab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/96af010d69449ddaf3fc8cc18f7815c70d7d4aab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/549463f11427bcec19465e6f37f97d6dc686fb2e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi5vaeCRBK7hj4Ov3rIwAAW4UIAELDdEJDfcqfic0NOZg5DIB0\nZrxwM7ictceSG0O5c+D7G18gmoO1fgFdxIMixKBzvdXP+3fp6SgRyJQaOwXkumny\nPmahnXREWWT+peizfw/6W0dFCPkWvK/Pmqmhcl6hiiWZhEn7xjsNdgVVXBpX9mNy\ne9+qvwDmDSRKN81TLkel75NBJkLmLGJxav6U8m3hXGyu5WmvL0YtAU80qXlLoOQZ\n5+tpEsyqVjCZki32sLiJHsCwJqewAnjZp5+Tgq/QsnCh6gfXWGmlsjcbQ+K5X64K\nQZagKwjc2Axtd/m8foic5RxXpJ0yI+bE85ZXAgaKFLf2yVd84u+Qx/QozvEPz2w=\n=M94w\n-----END PGP SIGNATURE-----\n", "payload": "tree 96af010d69449ddaf3fc8cc18f7815c70d7d4aab\nparent c98e893badd1204797e261a0ebf2341f01ff1a61\nparent abd80d904ba89f04f4ddb15a0a610d0dfbb44afe\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1659303582 +0200\ncommitter GitHub <noreply@github.com> 1659303582 +0200\n\nRollup merge of #99973 - RalfJung:layout-things, r=eddyb\n\nLayout things\n\nThese two commits are pretty independent, but didn't seem worth doing individual PRs for:\n- Always check that size is a multiple of align, even without debug assertions\n- Change Layout debug printing to put `variants` last, since it often huge and not usually the part we are most interested in\n\nCc `@eddyb`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/549463f11427bcec19465e6f37f97d6dc686fb2e", "html_url": "https://github.com/rust-lang/rust/commit/549463f11427bcec19465e6f37f97d6dc686fb2e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/549463f11427bcec19465e6f37f97d6dc686fb2e/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c98e893badd1204797e261a0ebf2341f01ff1a61", "url": "https://api.github.com/repos/rust-lang/rust/commits/c98e893badd1204797e261a0ebf2341f01ff1a61", "html_url": "https://github.com/rust-lang/rust/commit/c98e893badd1204797e261a0ebf2341f01ff1a61"}, {"sha": "abd80d904ba89f04f4ddb15a0a610d0dfbb44afe", "url": "https://api.github.com/repos/rust-lang/rust/commits/abd80d904ba89f04f4ddb15a0a610d0dfbb44afe", "html_url": "https://github.com/rust-lang/rust/commit/abd80d904ba89f04f4ddb15a0a610d0dfbb44afe"}], "stats": {"total": 1857, "additions": 931, "deletions": 926}, "files": [{"sha": "ad78d24e954653f80791612914f822a0dbbd9851", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -232,6 +232,10 @@ fn sanity_check_layout<'tcx>(\n         assert!(layout.abi.is_uninhabited());\n     }\n \n+    if layout.size.bytes() % layout.align.abi.bytes() != 0 {\n+        bug!(\"size is not a multiple of align, in the following layout:\\n{layout:#?}\");\n+    }\n+\n     if cfg!(debug_assertions) {\n         fn check_layout_abi<'tcx>(tcx: TyCtxt<'tcx>, layout: Layout<'tcx>) {\n             match layout.abi() {"}, {"sha": "d4d5674e246d86f0a5e68bfa71e552d1c069d1ad", "filename": "compiler/rustc_target/src/abi/mod.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fabi%2Fmod.rs?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1279,13 +1279,14 @@ impl<'a> fmt::Debug for LayoutS<'a> {\n         // This is how `Layout` used to print before it become\n         // `Interned<LayoutS>`. We print it like this to avoid having to update\n         // expected output in a lot of tests.\n+        let LayoutS { size, align, abi, fields, largest_niche, variants } = self;\n         f.debug_struct(\"Layout\")\n-            .field(\"fields\", &self.fields)\n-            .field(\"variants\", &self.variants)\n-            .field(\"abi\", &self.abi)\n-            .field(\"largest_niche\", &self.largest_niche)\n-            .field(\"align\", &self.align)\n-            .field(\"size\", &self.size)\n+            .field(\"size\", size)\n+            .field(\"align\", align)\n+            .field(\"abi\", abi)\n+            .field(\"fields\", fields)\n+            .field(\"largest_niche\", largest_niche)\n+            .field(\"variants\", variants)\n             .finish()\n     }\n }"}, {"sha": "c5e1c41d1304c0515dd3ad359e8963754a4fefbe", "filename": "src/test/ui/layout/debug.stderr", "status": "modified", "additions": 121, "deletions": 121, "changes": 242, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fdebug.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fdebug.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fdebug.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,12 @@\n error: layout_of(E) = Layout {\n+           size: Size(12 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +15,16 @@ error: layout_of(E) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 0..=0,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,24 +37,30 @@ error: layout_of(E) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(12 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n+                           abi: Align(4 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(4 bytes),\n-                   },\n-                   Layout {\n+                       abi: Uninhabited,\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(4 bytes),\n@@ -49,58 +73,24 @@ error: layout_of(E) = Layout {\n                                2,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Uninhabited,\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(12 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n-           },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 0..=0,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(12 bytes),\n        }\n   --> $DIR/debug.rs:6:1\n    |\n LL | enum E { Foo, Bar(!, i32, i32) }\n    | ^^^^^^\n \n error: layout_of(S) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-                   Size(0 bytes),\n-                   Size(4 bytes),\n-               ],\n-               memory_index: [\n-                   1,\n-                   0,\n-                   2,\n-               ],\n-           },\n-           variants: Single {\n-               index: 0,\n+           size: Size(8 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n            },\n            abi: ScalarPair(\n                Initialized {\n@@ -118,41 +108,72 @@ error: layout_of(S) = Layout {\n                    valid_range: 0..=4294967295,\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+                   Size(0 bytes),\n+                   Size(4 bytes),\n+               ],\n+               memory_index: [\n+                   1,\n+                   0,\n+                   2,\n+               ],\n+           },\n            largest_niche: None,\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n+           variants: Single {\n+               index: 0,\n            },\n-           size: Size(8 bytes),\n        }\n   --> $DIR/debug.rs:9:1\n    |\n LL | struct S { f1: i32, f2: (), f3: i32 }\n    | ^^^^^^^^\n \n error: layout_of(U) = Layout {\n-           fields: Union(\n-               2,\n-           ),\n-           variants: Single {\n-               index: 0,\n+           size: Size(8 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n            },\n            abi: Aggregate {\n                sized: true,\n            },\n+           fields: Union(\n+               2,\n+           ),\n            largest_niche: None,\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n+           variants: Single {\n+               index: 0,\n            },\n-           size: Size(8 bytes),\n        }\n   --> $DIR/debug.rs:12:1\n    |\n LL | union U { f1: (i32, i32), f3: i32 }\n    | ^^^^^^^\n \n error: layout_of(std::result::Result<i32, i32>) = Layout {\n+           size: Size(8 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: ScalarPair(\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       true,\n+                   ),\n+                   valid_range: 0..=4294967295,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -161,6 +182,16 @@ error: layout_of(std::result::Result<i32, i32>) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -173,16 +204,10 @@ error: layout_of(std::result::Result<i32, i32>) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(4 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(8 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -200,14 +225,6 @@ error: layout_of(std::result::Result<i32, i32>) = Layout {\n                                valid_range: 0..=4294967295,\n                            },\n                        ),\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(8 bytes),\n-                   },\n-                   Layout {\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(4 bytes),\n@@ -216,8 +233,16 @@ error: layout_of(std::result::Result<i32, i32>) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n-                           index: 1,\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(8 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -235,56 +260,32 @@ error: layout_of(std::result::Result<i32, i32>) = Layout {\n                                valid_range: 0..=4294967295,\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(4 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                           ],\n+                       },\n                        largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(8 bytes),\n                    },\n                ],\n            },\n-           abi: ScalarPair(\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       true,\n-                   ),\n-                   valid_range: 0..=4294967295,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(8 bytes),\n        }\n   --> $DIR/debug.rs:15:1\n    |\n LL | type Test = Result<i32, i32>;\n    | ^^^^^^^^^\n \n error: layout_of(i32) = Layout {\n-           fields: Primitive,\n-           variants: Single {\n-               index: 0,\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n            },\n            abi: Scalar(\n                Initialized {\n@@ -295,12 +296,11 @@ error: layout_of(i32) = Layout {\n                    valid_range: 0..=4294967295,\n                },\n            ),\n+           fields: Primitive,\n            largest_niche: None,\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n+           variants: Single {\n+               index: 0,\n            },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/debug.rs:18:1\n    |"}, {"sha": "d850dd69c96e3a6f7b8413fd19a38a561a90d832", "filename": "src/test/ui/layout/hexagon-enum.stderr", "status": "modified", "additions": 163, "deletions": 163, "changes": 326, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fhexagon-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fhexagon-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fhexagon-enum.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,18 @@\n error: layout_of(A) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: Align(1 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=0,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +21,16 @@ error: layout_of(A) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=0,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,64 +43,64 @@ error: layout_of(A) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(1 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: Align(1 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: Align(1 bytes),\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/hexagon-enum.rs:16:1\n+   |\n+LL | enum A { Apple }\n+   | ^^^^^^\n+\n+error: layout_of(B) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: Align(1 bytes),\n+           },\n            abi: Scalar(\n                Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=0,\n+                   valid_range: 255..=255,\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+               ],\n+               memory_index: [\n+                   0,\n+               ],\n+           },\n            largest_niche: Some(\n                Niche {\n                    offset: Size(0 bytes),\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=0,\n+                   valid_range: 255..=255,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: Align(1 bytes),\n-           },\n-           size: Size(1 bytes),\n-       }\n-  --> $DIR/hexagon-enum.rs:16:1\n-   |\n-LL | enum A { Apple }\n-   | ^^^^^^\n-\n-error: layout_of(B) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-               ],\n-               memory_index: [\n-                   0,\n-               ],\n-           },\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -89,56 +113,46 @@ error: layout_of(B) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(1 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: Align(1 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: Align(1 bytes),\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 255..=255,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 255..=255,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: Align(1 bytes),\n-           },\n-           size: Size(1 bytes),\n        }\n   --> $DIR/hexagon-enum.rs:20:1\n    |\n LL | enum B { Banana = 255, }\n    | ^^^^^^\n \n error: layout_of(C) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(2 bytes),\n+               pref: Align(2 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I16,\n+                       false,\n+                   ),\n+                   valid_range: 256..=256,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -147,6 +161,16 @@ error: layout_of(C) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I16,\n+                       false,\n+                   ),\n+                   valid_range: 256..=256,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -159,56 +183,46 @@ error: layout_of(C) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(2 bytes),\n+                           pref: Align(2 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(2 bytes),\n-                           pref: Align(2 bytes),\n-                       },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I16,\n-                       false,\n-                   ),\n-                   valid_range: 256..=256,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I16,\n-                       false,\n-                   ),\n-                   valid_range: 256..=256,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(2 bytes),\n-               pref: Align(2 bytes),\n-           },\n-           size: Size(2 bytes),\n        }\n   --> $DIR/hexagon-enum.rs:24:1\n    |\n LL | enum C { Chaenomeles = 256, }\n    | ^^^^^^\n \n error: layout_of(P) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 268435456..=268435456,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -217,6 +231,16 @@ error: layout_of(P) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 268435456..=268435456,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -229,56 +253,46 @@ error: layout_of(P) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(4 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 268435456..=268435456,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 268435456..=268435456,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/hexagon-enum.rs:28:1\n    |\n LL | enum P { Peach = 0x1000_0000isize, }\n    | ^^^^^^\n \n error: layout_of(T) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       true,\n+                   ),\n+                   valid_range: 2164260864..=2164260864,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -287,6 +301,16 @@ error: layout_of(T) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       true,\n+                   ),\n+                   valid_range: 2164260864..=2164260864,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -299,49 +323,25 @@ error: layout_of(T) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(4 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       true,\n-                   ),\n-                   valid_range: 2164260864..=2164260864,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       true,\n-                   ),\n-                   valid_range: 2164260864..=2164260864,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/hexagon-enum.rs:34:1\n    |"}, {"sha": "6deb1f271a72870f21157ff37e12dafa1d9615e7", "filename": "src/test/ui/layout/issue-96158-scalarpair-payload-might-be-uninit.stderr", "status": "modified", "additions": 248, "deletions": 248, "changes": 496, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fissue-96158-scalarpair-payload-might-be-uninit.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fissue-96158-scalarpair-payload-might-be-uninit.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fissue-96158-scalarpair-payload-might-be-uninit.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,24 @@\n error: layout_of(MissingPayloadField) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: ScalarPair(\n+               Initialized {\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+               Union {\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +27,16 @@ error: layout_of(MissingPayloadField) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,16 +49,10 @@ error: layout_of(MissingPayloadField) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(1 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -45,33 +69,51 @@ error: layout_of(MissingPayloadField) = Layout {\n                                ),\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(1 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                           ],\n+                       },\n                        largest_niche: None,\n+                       variants: Single {\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(1 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:16:1\n+   |\n+LL | pub enum MissingPayloadField {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: layout_of(CommonPayloadField) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n            abi: ScalarPair(\n                Initialized {\n                    value: Int(\n@@ -80,13 +122,22 @@ error: layout_of(MissingPayloadField) = Layout {\n                    ),\n                    valid_range: 0..=1,\n                },\n-               Union {\n+               Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n+                   valid_range: 0..=255,\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+               ],\n+               memory_index: [\n+                   0,\n+               ],\n+           },\n            largest_niche: Some(\n                Niche {\n                    offset: Size(0 bytes),\n@@ -97,26 +148,6 @@ error: layout_of(MissingPayloadField) = Layout {\n                    valid_range: 0..=1,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(2 bytes),\n-       }\n-  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:16:1\n-   |\n-LL | pub enum MissingPayloadField {\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: layout_of(CommonPayloadField) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-               ],\n-               memory_index: [\n-                   0,\n-               ],\n-           },\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -129,16 +160,10 @@ error: layout_of(CommonPayloadField) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(1 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -156,14 +181,6 @@ error: layout_of(CommonPayloadField) = Layout {\n                                valid_range: 0..=255,\n                            },\n                        ),\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(1 bytes),\n@@ -172,8 +189,16 @@ error: layout_of(CommonPayloadField) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n-                           index: 1,\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -191,15 +216,33 @@ error: layout_of(CommonPayloadField) = Layout {\n                                valid_range: 0..=255,\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(1 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                           ],\n+                       },\n                        largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:25:1\n+   |\n+LL | pub enum CommonPayloadField {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n            abi: ScalarPair(\n                Initialized {\n                    value: Int(\n@@ -208,14 +251,21 @@ error: layout_of(CommonPayloadField) = Layout {\n                    ),\n                    valid_range: 0..=1,\n                },\n-               Initialized {\n+               Union {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=255,\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+               ],\n+               memory_index: [\n+                   0,\n+               ],\n+           },\n            largest_niche: Some(\n                Niche {\n                    offset: Size(0 bytes),\n@@ -226,26 +276,6 @@ error: layout_of(CommonPayloadField) = Layout {\n                    valid_range: 0..=1,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(2 bytes),\n-       }\n-  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:25:1\n-   |\n-LL | pub enum CommonPayloadField {\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-               ],\n-               memory_index: [\n-                   0,\n-               ],\n-           },\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -258,16 +288,10 @@ error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(1 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -284,14 +308,6 @@ error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n                                ),\n                            },\n                        ),\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(1 bytes),\n@@ -300,8 +316,16 @@ error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n-                           index: 1,\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -318,22 +342,40 @@ error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n                                ),\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(1 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                           ],\n+                       },\n                        largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:33:1\n+   |\n+LL | pub enum CommonPayloadFieldIsMaybeUninit {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: layout_of(NicheFirst) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n            abi: ScalarPair(\n                Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=1,\n+                   valid_range: 0..=4,\n                },\n                Union {\n                    value: Int(\n@@ -342,36 +384,24 @@ error: layout_of(CommonPayloadFieldIsMaybeUninit) = Layout {\n                    ),\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+               ],\n+               memory_index: [\n+                   0,\n+               ],\n+           },\n            largest_niche: Some(\n                Niche {\n                    offset: Size(0 bytes),\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=1,\n+                   valid_range: 0..=4,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(2 bytes),\n-       }\n-  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:33:1\n-   |\n-LL | pub enum CommonPayloadFieldIsMaybeUninit {\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: layout_of(NicheFirst) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-               ],\n-               memory_index: [\n-                   0,\n-               ],\n-           },\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -388,18 +418,10 @@ error: layout_of(NicheFirst) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(0 bytes),\n-                               Size(1 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                               1,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -417,6 +439,16 @@ error: layout_of(NicheFirst) = Layout {\n                                valid_range: 0..=255,\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(0 bytes),\n+                               Size(1 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                               1,\n+                           ],\n+                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(0 bytes),\n@@ -427,87 +459,75 @@ error: layout_of(NicheFirst) = Layout {\n                                valid_range: 0..=2,\n                            },\n                        ),\n+                       variants: Single {\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(0 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(0 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(0 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 2,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(0 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:41:1\n+   |\n+LL | pub enum NicheFirst {\n+   | ^^^^^^^^^^^^^^^^^^^\n+\n+error: layout_of(NicheSecond) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n            abi: ScalarPair(\n-               Initialized {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=4,\n-               },\n                Union {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n                },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n+               Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n                    valid_range: 0..=4,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(2 bytes),\n-       }\n-  --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:41:1\n-   |\n-LL | pub enum NicheFirst {\n-   | ^^^^^^^^^^^^^^^^^^^\n-\n-error: layout_of(NicheSecond) = Layout {\n            fields: Arbitrary {\n                offsets: [\n                    Size(1 bytes),\n@@ -516,6 +536,16 @@ error: layout_of(NicheSecond) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(1 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=4,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -532,18 +562,10 @@ error: layout_of(NicheSecond) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n-                       fields: Arbitrary {\n-                           offsets: [\n-                               Size(0 bytes),\n-                               Size(1 bytes),\n-                           ],\n-                           memory_index: [\n-                               0,\n-                               1,\n-                           ],\n-                       },\n-                       variants: Single {\n-                           index: 0,\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n                        },\n                        abi: ScalarPair(\n                            Initialized {\n@@ -561,6 +583,16 @@ error: layout_of(NicheSecond) = Layout {\n                                valid_range: 0..=2,\n                            },\n                        ),\n+                       fields: Arbitrary {\n+                           offsets: [\n+                               Size(0 bytes),\n+                               Size(1 bytes),\n+                           ],\n+                           memory_index: [\n+                               0,\n+                               1,\n+                           ],\n+                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(1 bytes),\n@@ -571,80 +603,48 @@ error: layout_of(NicheSecond) = Layout {\n                                valid_range: 0..=2,\n                            },\n                        ),\n+                       variants: Single {\n+                           index: 0,\n+                       },\n+                   },\n+                   Layout {\n+                       size: Size(0 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(0 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(0 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 2,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(0 bytes),\n                    },\n                ],\n            },\n-           abi: ScalarPair(\n-               Union {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-               },\n-               Initialized {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=4,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(1 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=4,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(2 bytes),\n        }\n   --> $DIR/issue-96158-scalarpair-payload-might-be-uninit.rs:50:1\n    |"}, {"sha": "de6177c8dfc4d24aba0b98ace81c35546e1cb8bd", "filename": "src/test/ui/layout/issue-96185-overaligned-enum.stderr", "status": "modified", "additions": 73, "deletions": 73, "changes": 146, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fissue-96185-overaligned-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fissue-96185-overaligned-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fissue-96185-overaligned-enum.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,12 @@\n error: layout_of(Aligned1) = Layout {\n+           size: Size(8 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(8 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +15,16 @@ error: layout_of(Aligned1) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,68 +37,64 @@ error: layout_of(Aligned1) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(8 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(8 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(8 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(8 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(8 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(8 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(8 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n+       }\n+  --> $DIR/issue-96185-overaligned-enum.rs:8:1\n+   |\n+LL | pub enum Aligned1 {\n+   | ^^^^^^^^^^^^^^^^^\n+\n+error: layout_of(Aligned2) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: $PREF_ALIGN,\n            },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n+           abi: Scalar(\n+               Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n                    valid_range: 0..=1,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(8 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(8 bytes),\n-       }\n-  --> $DIR/issue-96185-overaligned-enum.rs:8:1\n-   |\n-LL | pub enum Aligned1 {\n-   | ^^^^^^^^^^^^^^^^^\n-\n-error: layout_of(Aligned2) = Layout {\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -89,6 +103,16 @@ error: layout_of(Aligned2) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -101,67 +125,43 @@ error: layout_of(Aligned2) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(1 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(1 bytes),\n                        align: AbiAndPrefAlign {\n                            abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(1 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(1 bytes),\n        }\n   --> $DIR/issue-96185-overaligned-enum.rs:16:1\n    |"}, {"sha": "227bd950b66663d0e2a64fbdaea9a001c01b74ee", "filename": "src/test/ui/layout/thumb-enum.stderr", "status": "modified", "additions": 163, "deletions": 163, "changes": 326, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fthumb-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fthumb-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fthumb-enum.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,18 @@\n error: layout_of(A) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=0,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +21,16 @@ error: layout_of(A) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=0,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,64 +43,64 @@ error: layout_of(A) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(1 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n+       }\n+  --> $DIR/thumb-enum.rs:16:1\n+   |\n+LL | enum A { Apple }\n+   | ^^^^^^\n+\n+error: layout_of(B) = Layout {\n+           size: Size(1 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(1 bytes),\n+               pref: Align(4 bytes),\n+           },\n            abi: Scalar(\n                Initialized {\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=0,\n+                   valid_range: 255..=255,\n                },\n            ),\n+           fields: Arbitrary {\n+               offsets: [\n+                   Size(0 bytes),\n+               ],\n+               memory_index: [\n+                   0,\n+               ],\n+           },\n            largest_niche: Some(\n                Niche {\n                    offset: Size(0 bytes),\n                    value: Int(\n                        I8,\n                        false,\n                    ),\n-                   valid_range: 0..=0,\n+                   valid_range: 255..=255,\n                },\n            ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(1 bytes),\n-       }\n-  --> $DIR/thumb-enum.rs:16:1\n-   |\n-LL | enum A { Apple }\n-   | ^^^^^^\n-\n-error: layout_of(B) = Layout {\n-           fields: Arbitrary {\n-               offsets: [\n-                   Size(0 bytes),\n-               ],\n-               memory_index: [\n-                   0,\n-               ],\n-           },\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -89,56 +113,46 @@ error: layout_of(B) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(1 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(1 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(1 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 255..=255,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 255..=255,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(1 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(1 bytes),\n        }\n   --> $DIR/thumb-enum.rs:20:1\n    |\n LL | enum B { Banana = 255, }\n    | ^^^^^^\n \n error: layout_of(C) = Layout {\n+           size: Size(2 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(2 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I16,\n+                       false,\n+                   ),\n+                   valid_range: 256..=256,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -147,6 +161,16 @@ error: layout_of(C) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I16,\n+                       false,\n+                   ),\n+                   valid_range: 256..=256,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -159,56 +183,46 @@ error: layout_of(C) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(2 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(2 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I16,\n-                       false,\n-                   ),\n-                   valid_range: 256..=256,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I16,\n-                       false,\n-                   ),\n-                   valid_range: 256..=256,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(2 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(2 bytes),\n        }\n   --> $DIR/thumb-enum.rs:24:1\n    |\n LL | enum C { Chaenomeles = 256, }\n    | ^^^^^^\n \n error: layout_of(P) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 268435456..=268435456,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -217,6 +231,16 @@ error: layout_of(P) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       false,\n+                   ),\n+                   valid_range: 268435456..=268435456,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -229,56 +253,46 @@ error: layout_of(P) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(4 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 268435456..=268435456,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       false,\n-                   ),\n-                   valid_range: 268435456..=268435456,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/thumb-enum.rs:28:1\n    |\n LL | enum P { Peach = 0x1000_0000isize, }\n    | ^^^^^^\n \n error: layout_of(T) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: Align(4 bytes),\n+           },\n+           abi: Scalar(\n+               Initialized {\n+                   value: Int(\n+                       I32,\n+                       true,\n+                   ),\n+                   valid_range: 2164260864..=2164260864,\n+               },\n+           ),\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -287,6 +301,16 @@ error: layout_of(T) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I32,\n+                       true,\n+                   ),\n+                   valid_range: 2164260864..=2164260864,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -299,49 +323,25 @@ error: layout_of(T) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: Align(4 bytes),\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [],\n                            memory_index: [],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n-                           pref: Align(4 bytes),\n-                       },\n-                       size: Size(4 bytes),\n                    },\n                ],\n            },\n-           abi: Scalar(\n-               Initialized {\n-                   value: Int(\n-                       I32,\n-                       true,\n-                   ),\n-                   valid_range: 2164260864..=2164260864,\n-               },\n-           ),\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I32,\n-                       true,\n-                   ),\n-                   valid_range: 2164260864..=2164260864,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: Align(4 bytes),\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/thumb-enum.rs:34:1\n    |"}, {"sha": "56d3a52bb7ff9133a2f0fcdcf0ea3f95572d30b2", "filename": "src/test/ui/layout/zero-sized-array-enum-niche.stderr", "status": "modified", "additions": 152, "deletions": 152, "changes": 304, "blob_url": "https://github.com/rust-lang/rust/blob/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fzero-sized-array-enum-niche.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/549463f11427bcec19465e6f37f97d6dc686fb2e/src%2Ftest%2Fui%2Flayout%2Fzero-sized-array-enum-niche.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flayout%2Fzero-sized-array-enum-niche.stderr?ref=549463f11427bcec19465e6f37f97d6dc686fb2e", "patch": "@@ -1,4 +1,12 @@\n error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -7,6 +15,16 @@ error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -19,6 +37,14 @@ error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(4 bytes),\n@@ -27,20 +53,20 @@ error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(2 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n+                           abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(4 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(1 bytes),\n@@ -49,12 +75,6 @@ error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n                                0,\n                            ],\n                        },\n-                       variants: Single {\n-                           index: 1,\n-                       },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(1 bytes),\n@@ -65,39 +85,27 @@ error: layout_of(std::result::Result<[u32; 0], bool>) = Layout {\n                                valid_range: 0..=1,\n                            },\n                        ),\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n-           },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/zero-sized-array-enum-niche.rs:13:1\n    |\n LL | type AlignedResult = Result<[u32; 0], bool>;\n    | ^^^^^^^^^^^^^^^^^^\n \n error: layout_of(MultipleAlignments) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -106,6 +114,16 @@ error: layout_of(MultipleAlignments) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=2,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -118,6 +136,14 @@ error: layout_of(MultipleAlignments) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(2 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(2 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(2 bytes),\n@@ -126,20 +152,20 @@ error: layout_of(MultipleAlignments) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(4 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(2 bytes),\n+                           abi: Align(4 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(2 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(4 bytes),\n@@ -148,20 +174,20 @@ error: layout_of(MultipleAlignments) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 1,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(2 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n+                           abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(4 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(1 bytes),\n@@ -170,12 +196,6 @@ error: layout_of(MultipleAlignments) = Layout {\n                                0,\n                            ],\n                        },\n-                       variants: Single {\n-                           index: 2,\n-                       },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(1 bytes),\n@@ -186,39 +206,27 @@ error: layout_of(MultipleAlignments) = Layout {\n                                valid_range: 0..=1,\n                            },\n                        ),\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 2,\n                        },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n-           },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=2,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/zero-sized-array-enum-niche.rs:21:1\n    |\n LL | enum MultipleAlignments {\n    | ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -227,6 +235,16 @@ error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) =\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I8,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -239,6 +257,14 @@ error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) =\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(4 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(4 bytes),\n@@ -247,20 +273,20 @@ error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) =\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(3 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n+                           abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(4 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(1 bytes),\n@@ -269,12 +295,6 @@ error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) =\n                                0,\n                            ],\n                        },\n-                       variants: Single {\n-                           index: 1,\n-                       },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(1 bytes),\n@@ -285,39 +305,27 @@ error: layout_of(std::result::Result<[u32; 0], Packed<std::num::NonZeroU16>>) =\n                                valid_range: 1..=65535,\n                            },\n                        ),\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(3 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n-           },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I8,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/zero-sized-array-enum-niche.rs:37:1\n    |\n LL | type NicheLosesToTagged = Result<[u32; 0], Packed<std::num::NonZeroU16>>;\n    | ^^^^^^^^^^^^^^^^^^^^^^^\n \n error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n+           size: Size(4 bytes),\n+           align: AbiAndPrefAlign {\n+               abi: Align(4 bytes),\n+               pref: $PREF_ALIGN,\n+           },\n+           abi: Aggregate {\n+               sized: true,\n+           },\n            fields: Arbitrary {\n                offsets: [\n                    Size(0 bytes),\n@@ -326,6 +334,16 @@ error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n                    0,\n                ],\n            },\n+           largest_niche: Some(\n+               Niche {\n+                   offset: Size(0 bytes),\n+                   value: Int(\n+                       I16,\n+                       false,\n+                   ),\n+                   valid_range: 0..=1,\n+               },\n+           ),\n            variants: Multiple {\n                tag: Initialized {\n                    value: Int(\n@@ -342,6 +360,14 @@ error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n                tag_field: 0,\n                variants: [\n                    Layout {\n+                       size: Size(0 bytes),\n+                       align: AbiAndPrefAlign {\n+                           abi: Align(4 bytes),\n+                           pref: $PREF_ALIGN,\n+                       },\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(0 bytes),\n@@ -350,20 +376,20 @@ error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n                                0,\n                            ],\n                        },\n+                       largest_niche: None,\n                        variants: Single {\n                            index: 0,\n                        },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n-                       largest_niche: None,\n+                   },\n+                   Layout {\n+                       size: Size(2 bytes),\n                        align: AbiAndPrefAlign {\n-                           abi: Align(4 bytes),\n+                           abi: Align(1 bytes),\n                            pref: $PREF_ALIGN,\n                        },\n-                       size: Size(0 bytes),\n-                   },\n-                   Layout {\n+                       abi: Aggregate {\n+                           sized: true,\n+                       },\n                        fields: Arbitrary {\n                            offsets: [\n                                Size(0 bytes),\n@@ -372,12 +398,6 @@ error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n                                0,\n                            ],\n                        },\n-                       variants: Single {\n-                           index: 1,\n-                       },\n-                       abi: Aggregate {\n-                           sized: true,\n-                       },\n                        largest_niche: Some(\n                            Niche {\n                                offset: Size(0 bytes),\n@@ -388,32 +408,12 @@ error: layout_of(std::result::Result<[u32; 0], Packed<U16IsZero>>) = Layout {\n                                valid_range: 0..=0,\n                            },\n                        ),\n-                       align: AbiAndPrefAlign {\n-                           abi: Align(1 bytes),\n-                           pref: $PREF_ALIGN,\n+                       variants: Single {\n+                           index: 1,\n                        },\n-                       size: Size(2 bytes),\n                    },\n                ],\n            },\n-           abi: Aggregate {\n-               sized: true,\n-           },\n-           largest_niche: Some(\n-               Niche {\n-                   offset: Size(0 bytes),\n-                   value: Int(\n-                       I16,\n-                       false,\n-                   ),\n-                   valid_range: 0..=1,\n-               },\n-           ),\n-           align: AbiAndPrefAlign {\n-               abi: Align(4 bytes),\n-               pref: $PREF_ALIGN,\n-           },\n-           size: Size(4 bytes),\n        }\n   --> $DIR/zero-sized-array-enum-niche.rs:44:1\n    |"}]}