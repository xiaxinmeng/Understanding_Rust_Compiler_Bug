{"sha": "6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZmYzczMGJhZjZiM2QxNTZlN2JlNzUyMWNkNjBmMzUyZjJjMGVhOTM=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-06-28T23:01:55Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-06-28T23:02:48Z"}, "message": "Cleanup failure handling around rust_new_task_in_sched - closes #2668", "tree": {"sha": "e472aa6ab0779ae281a50bbd05d8f86217f8bb67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e472aa6ab0779ae281a50bbd05d8f86217f8bb67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "html_url": "https://github.com/rust-lang/rust/commit/6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d91e3109824af5460bc2476bc6dbd74f8b0100d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/d91e3109824af5460bc2476bc6dbd74f8b0100d4", "html_url": "https://github.com/rust-lang/rust/commit/d91e3109824af5460bc2476bc6dbd74f8b0100d4"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "9f379bbd94a222caa5201c9a4ee59890aed9180a", "filename": "src/libcore/task.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Flibcore%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Flibcore%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask.rs?ref=6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "patch": "@@ -538,6 +538,7 @@ fn spawn_raw(opts: task_opts, +f: fn~()) {\n             new_task_in_new_sched(sched_opts)\n           }\n         };\n+        assert !new_task.is_null();\n \n         option::iter(opts.notify_chan) {|c|\n             // FIXME (#1087): Would like to do notification in Rust"}, {"sha": "150156ddae953e8832b266b3c7835a4223b6106c", "filename": "src/rt/rust.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust.cpp?ref=6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "patch": "@@ -95,6 +95,7 @@ rust_start(uintptr_t main_fn, int argc, char **argv, void* crate_map) {\n     // Create the main scheduler and the main task\n     rust_sched_id sched_id = kernel->create_scheduler(env->num_sched_threads);\n     rust_scheduler *sched = kernel->get_scheduler_by_id(sched_id);\n+    assert(sched != NULL);\n     rust_task *root_task = sched->create_task(NULL, \"main\");\n \n     // Build the command line arguments to pass to the root task"}, {"sha": "a33d3cb90fedbdbee784c3a8c99f84dc47aaae60", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "patch": "@@ -630,7 +630,8 @@ extern \"C\" CDECL rust_task*\n rust_new_task_in_sched(rust_sched_id id) {\n     rust_task *task = rust_get_current_task();\n     rust_scheduler *sched = task->kernel->get_scheduler_by_id(id);\n-    // FIXME (#2668): What if we didn't get the scheduler?\n+    if (sched == NULL)\n+        return NULL;\n     return new_task_common(sched, task);\n }\n "}, {"sha": "82fec98e86ae24583d55a746e175a6de841c6855", "filename": "src/rt/rust_kernel.cpp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust_kernel.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Frt%2Frust_kernel.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_kernel.cpp?ref=6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "patch": "@@ -121,7 +121,9 @@ rust_kernel::get_scheduler_by_id(rust_sched_id id) {\n \n rust_scheduler *\n rust_kernel::get_scheduler_by_id_nolock(rust_sched_id id) {\n-    assert(id != 0 && \"invalid scheduler id\");\n+    if (id == 0) {\n+        return NULL;\n+    }\n     sched_lock.must_have_lock();\n     sched_map::iterator iter = sched_table.find(id);\n     if (iter != sched_table.end()) {"}, {"sha": "a8ce61370a6fdd1d8c3530e905227299a9d3690c", "filename": "src/test/run-pass/rt-sched-1.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Ftest%2Frun-pass%2Frt-sched-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6fc730baf6b3d156e7be7521cd60f352f2c0ea93/src%2Ftest%2Frun-pass%2Frt-sched-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frt-sched-1.rs?ref=6fc730baf6b3d156e7be7521cd60f352f2c0ea93", "patch": "@@ -22,6 +22,7 @@ fn main() unsafe {\n     let new_sched_id = rustrt::rust_new_sched(num_threads);\n     #error(\"new_sched_id %?\", new_sched_id);\n     let new_task_id = rustrt::rust_new_task_in_sched(new_sched_id);\n+    assert !new_task_id.is_null();\n     let f = fn~() {\n         let child_sched_id = rustrt::rust_get_sched_id();\n         #error(\"child_sched_id %?\", child_sched_id);\n@@ -33,4 +34,4 @@ fn main() unsafe {\n     rustrt::start_task(new_task_id, fptr);\n     unsafe::forget(f);\n     comm::recv(po);\n-}\n\\ No newline at end of file\n+}"}]}