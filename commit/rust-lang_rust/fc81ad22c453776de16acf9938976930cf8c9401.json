{"sha": "fc81ad22c453776de16acf9938976930cf8c9401", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZjODFhZDIyYzQ1Mzc3NmRlMTZhY2Y5OTM4OTc2OTMwY2Y4Yzk0MDE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-21T11:21:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-21T11:21:06Z"}, "message": "Auto merge of #85416 - durin42:llvm-catchup-may-2021, r=nagisa\n\nPassWrapper: update for LLVM change D102093\n\nIn https://reviews.llvm.org/D102093 lots of things stopped taking the\nDebugLogging boolean parameter. Mercifully we appear to always set\nDebugPassManager to false, so I don't think we're losing anything by not\npassing this parameter.", "tree": {"sha": "f944338b7a7fbdee96240f5d9f68b1cb1e544bc8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f944338b7a7fbdee96240f5d9f68b1cb1e544bc8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc81ad22c453776de16acf9938976930cf8c9401", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc81ad22c453776de16acf9938976930cf8c9401", "html_url": "https://github.com/rust-lang/rust/commit/fc81ad22c453776de16acf9938976930cf8c9401", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc81ad22c453776de16acf9938976930cf8c9401/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "237b1ef0b9147eb4d66220c589c39009bd79784f", "url": "https://api.github.com/repos/rust-lang/rust/commits/237b1ef0b9147eb4d66220c589c39009bd79784f", "html_url": "https://github.com/rust-lang/rust/commit/237b1ef0b9147eb4d66220c589c39009bd79784f"}, {"sha": "445658ba6d00ae8fbbd7705ec1b1cf19b92d1ad2", "url": "https://api.github.com/repos/rust-lang/rust/commits/445658ba6d00ae8fbbd7705ec1b1cf19b92d1ad2", "html_url": "https://github.com/rust-lang/rust/commit/445658ba6d00ae8fbbd7705ec1b1cf19b92d1ad2"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "3595e37cf96255253f8916c2ce91f24f3ad1a7c9", "filename": "compiler/rustc_llvm/llvm-wrapper/PassWrapper.cpp", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fc81ad22c453776de16acf9938976930cf8c9401/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/fc81ad22c453776de16acf9938976930cf8c9401/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FPassWrapper.cpp?ref=fc81ad22c453776de16acf9938976930cf8c9401", "patch": "@@ -793,16 +793,23 @@ LLVMRustOptimizeWithNewPassManager(\n     PGOOpt = PGOOptions(PGOUsePath, \"\", \"\", PGOOptions::IRUse);\n   }\n \n-#if LLVM_VERSION_GE(12, 0)\n+#if LLVM_VERSION_GE(12, 0) && !LLVM_VERSION_GE(13,0)\n   PassBuilder PB(DebugPassManager, TM, PTO, PGOOpt, &PIC);\n #else\n   PassBuilder PB(TM, PTO, PGOOpt, &PIC);\n #endif\n \n+#if LLVM_VERSION_GE(13, 0)\n+  LoopAnalysisManager LAM;\n+  FunctionAnalysisManager FAM;\n+  CGSCCAnalysisManager CGAM;\n+  ModuleAnalysisManager MAM;\n+#else\n   LoopAnalysisManager LAM(DebugPassManager);\n   FunctionAnalysisManager FAM(DebugPassManager);\n   CGSCCAnalysisManager CGAM(DebugPassManager);\n   ModuleAnalysisManager MAM(DebugPassManager);\n+#endif\n \n   FAM.registerPass([&] { return PB.buildDefaultAAPipeline(); });\n \n@@ -956,7 +963,11 @@ LLVMRustOptimizeWithNewPassManager(\n     }\n   }\n \n+#if LLVM_VERSION_GE(13, 0)\n+  ModulePassManager MPM;\n+#else\n   ModulePassManager MPM(DebugPassManager);\n+#endif\n   bool NeedThinLTOBufferPasses = UseThinLTOBuffers;\n   if (!NoPrepopulatePasses) {\n     if (OptLevel == PassBuilder::OptimizationLevel::O0) {"}]}