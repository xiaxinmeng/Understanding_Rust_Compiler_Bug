{"sha": "6c0398da7d74ec7bf16e4f48a900036aecfd714c", "node_id": "C_kwDOAAsO6NoAKDZjMDM5OGRhN2Q3NGVjN2JmMTZlNGY0OGE5MDAwMzZhZWNmZDcxNGM", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-23T16:47:26Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-23T16:47:26Z"}, "message": "don't dump xargo output onto users of 'cargo miri test'", "tree": {"sha": "7ec18fdbdb20b6468c0d412dfde2e6dfe6a19337", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ec18fdbdb20b6468c0d412dfde2e6dfe6a19337"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c0398da7d74ec7bf16e4f48a900036aecfd714c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c0398da7d74ec7bf16e4f48a900036aecfd714c", "html_url": "https://github.com/rust-lang/rust/commit/6c0398da7d74ec7bf16e4f48a900036aecfd714c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c0398da7d74ec7bf16e4f48a900036aecfd714c/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b08e51d79a0a4051eab997007ff36d9ca1ee4ace", "url": "https://api.github.com/repos/rust-lang/rust/commits/b08e51d79a0a4051eab997007ff36d9ca1ee4ace", "html_url": "https://github.com/rust-lang/rust/commit/b08e51d79a0a4051eab997007ff36d9ca1ee4ace"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "72e56daf57eb3419306e9acc7d9919366901f11f", "filename": "cargo-miri/bin.rs", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/6c0398da7d74ec7bf16e4f48a900036aecfd714c/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c0398da7d74ec7bf16e4f48a900036aecfd714c/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=6c0398da7d74ec7bf16e4f48a900036aecfd714c", "patch": "@@ -497,9 +497,24 @@ path = \"lib.rs\"\n     // Disable debug assertions in the standard library -- Miri is already slow enough.\n     // But keep the overflow checks, they are cheap.\n     command.env(\"RUSTFLAGS\", \"-Cdebug-assertions=off -Coverflow-checks=on\");\n+    // Manage the output the user sees.\n+    if only_setup {\n+        eprintln!(\"Preparing a sysroot for Miri...\");\n+    } else {\n+        eprint!(\"Preparing a sysroot for Miri... \");\n+        command.stdout(process::Stdio::null());\n+        command.stderr(process::Stdio::null());\n+    }\n     // Finally run it!\n     if command.status().expect(\"failed to run xargo\").success().not() {\n-        show_error(format!(\"failed to run xargo\"));\n+        if only_setup {\n+            show_error(format!(\"failed to run xargo, see error details above\"))\n+        } else {\n+            show_error(format!(\"failed to run xargo; run `cargo miri setup` to see the error details\"))\n+        }\n+    }\n+    if !only_setup {\n+        eprintln!(\"done\");\n     }\n \n     // That should be it! But we need to figure out where xargo built stuff.\n@@ -510,10 +525,10 @@ path = \"lib.rs\"\n     // Figure out what to print.\n     let print_sysroot = only_setup && has_arg_flag(\"--print-sysroot\"); // whether we just print the sysroot path\n     if print_sysroot {\n-        // Print just the sysroot and nothing else; this way we do not need any escaping.\n+        // Print just the sysroot and nothing else to stdout; this way we do not need any escaping.\n         println!(\"{}\", sysroot.display());\n     } else if only_setup {\n-        println!(\"A libstd for Miri is now available in `{}`.\", sysroot.display());\n+        eprintln!(\"A sysroot for Miri is now available in `{}`.\", sysroot.display());\n     }\n }\n "}]}