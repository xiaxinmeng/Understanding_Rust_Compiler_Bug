{"sha": "a7a74c79fa09d918703083f35d22c77351bfc992", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3YTc0Yzc5ZmEwOWQ5MTg3MDMwODNmMzVkMjJjNzczNTFiZmM5OTI=", "commit": {"author": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-08-13T18:19:52Z"}, "committer": {"name": "Elliott Slaughter", "email": "eslaughter@mozilla.com", "date": "2012-08-24T21:01:26Z"}, "message": "rustc: Emit index of tydescs by addrspace.", "tree": {"sha": "0cf2b2ef0543b0d830fe2abeab7f2c6d65ea54bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0cf2b2ef0543b0d830fe2abeab7f2c6d65ea54bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7a74c79fa09d918703083f35d22c77351bfc992", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7a74c79fa09d918703083f35d22c77351bfc992", "html_url": "https://github.com/rust-lang/rust/commit/a7a74c79fa09d918703083f35d22c77351bfc992", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7a74c79fa09d918703083f35d22c77351bfc992/comments", "author": null, "committer": null, "parents": [{"sha": "c2e99ba8265085bde0a80283a68b4010a4a3aa34", "url": "https://api.github.com/repos/rust-lang/rust/commits/c2e99ba8265085bde0a80283a68b4010a4a3aa34", "html_url": "https://github.com/rust-lang/rust/commit/c2e99ba8265085bde0a80283a68b4010a4a3aa34"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "90b314aac30dba3a7b0eb0016d33a66e0b4b6f91", "filename": "src/rustc/middle/trans/base.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a7a74c79fa09d918703083f35d22c77351bfc992/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7a74c79fa09d918703083f35d22c77351bfc992/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=a7a74c79fa09d918703083f35d22c77351bfc992", "patch": "@@ -657,6 +657,16 @@ fn emit_tydescs(ccx: @crate_ctxt) {\n         llvm::LLVMSetInitializer(gvar, tydesc);\n         llvm::LLVMSetGlobalConstant(gvar, True);\n         lib::llvm::SetLinkage(gvar, lib::llvm::InternalLinkage);\n+\n+        // Index tydesc by addrspace.\n+        let llty = T_ptr(ccx.tydesc_type);\n+        let addrspace_name = #fmt(\"_gc_addrspace_metadata_%u\",\n+                                  ti.addrspace as uint);\n+        let addrspace_gvar = str::as_c_str(addrspace_name, |buf| {\n+            llvm::LLVMAddGlobal(ccx.llmod, llty, buf)\n+        });\n+        lib::llvm::SetLinkage(addrspace_gvar, lib::llvm::InternalLinkage);\n+        llvm::LLVMSetInitializer(addrspace_gvar, gvar);\n     };\n }\n "}]}