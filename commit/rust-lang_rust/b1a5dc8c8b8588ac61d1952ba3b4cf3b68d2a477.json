{"sha": "b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxYTVkYzhjOGI4NTg4YWM2MWQxOTUyYmEzYjRjZjNiNjhkMmE0Nzc=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-05-04T10:34:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-05-04T10:34:06Z"}, "message": "Merge #4269 #4293\n\n4269: add support of use alias semantic in definition r=matklad a=bnjjj\n\nclose #4202 \n\n4293: no doctests for flycheck r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Benjamin Coenen <5719034+bnjjj@users.noreply.github.com>\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "31f1a2d3fc824849849c26d9f42fd048b4858ad9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/31f1a2d3fc824849849c26d9f42fd048b4858ad9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJer++eCRBK7hj4Ov3rIwAAdHIIAFv7WE9YZgQcAI5fL88PIDQs\no/stpJOodPbiZrVoExB0f3yopJC7PAlZvUkB+MPVUEuQ6CjI3f0nUs36vIaE5jGA\nDnIDP+ceZn9OiGwjN3jRl1OdGQcveNK19FonSs3IUaeKvqCuWxtm/0bFOa/NL1/U\nfjwU3WjxihNDdcUITCYOvpsaOBBKu5i8BIKlNoAFb2cbxCzEA0pftlRuVHeIXtKl\nsZERBfL9K7vNDrHpVKTN2ZS9R164po+TOpBOZX8SSqGPPG4VyTDr3l7AhXR3Wesp\nco1xabxQpCVLQ279WNq2ab7BBalvjLituvrNgQJsO0Fm8VyQyX1knyvKdIJR3So=\n=Syyp\n-----END PGP SIGNATURE-----\n", "payload": "tree 31f1a2d3fc824849849c26d9f42fd048b4858ad9\nparent 0ef4665d42ed7274ee847306722e2a53d2603bc9\nparent 99c2ca84945cb12d51ca4353ac20f844e7b40eaa\nparent 6af464d185dc12db9d523c24c483ad8d6ad53d0e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1588588446 +0000\ncommitter GitHub <noreply@github.com> 1588588446 +0000\n\nMerge #4269 #4293\n\n4269: add support of use alias semantic in definition r=matklad a=bnjjj\n\nclose #4202 \n\n4293: no doctests for flycheck r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Benjamin Coenen <5719034+bnjjj@users.noreply.github.com>\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "html_url": "https://github.com/rust-lang/rust/commit/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0ef4665d42ed7274ee847306722e2a53d2603bc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ef4665d42ed7274ee847306722e2a53d2603bc9", "html_url": "https://github.com/rust-lang/rust/commit/0ef4665d42ed7274ee847306722e2a53d2603bc9"}, {"sha": "99c2ca84945cb12d51ca4353ac20f844e7b40eaa", "url": "https://api.github.com/repos/rust-lang/rust/commits/99c2ca84945cb12d51ca4353ac20f844e7b40eaa", "html_url": "https://github.com/rust-lang/rust/commit/99c2ca84945cb12d51ca4353ac20f844e7b40eaa"}, {"sha": "6af464d185dc12db9d523c24c483ad8d6ad53d0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6af464d185dc12db9d523c24c483ad8d6ad53d0e", "html_url": "https://github.com/rust-lang/rust/commit/6af464d185dc12db9d523c24c483ad8d6ad53d0e"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "3d5093264e826bbd353de0479b8160999894cf86", "filename": "crates/ra_flycheck/Cargo.toml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_flycheck%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_flycheck%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_flycheck%2FCargo.toml?ref=b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "patch": "@@ -4,6 +4,9 @@ name = \"ra_flycheck\"\n version = \"0.1.0\"\n authors = [\"rust-analyzer developers\"]\n \n+[lib]\n+doctest = false\n+\n [dependencies]\n crossbeam-channel = \"0.4.0\"\n lsp-types = { version = \"0.74.0\", features = [\"proposed\"] }"}, {"sha": "150895abb4273098ca43f2bd0495db0383f2f78f", "filename": "crates/ra_ide/src/goto_definition.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fgoto_definition.rs?ref=b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "patch": "@@ -243,6 +243,39 @@ mod tests {\n         );\n     }\n \n+    #[test]\n+    fn goto_def_for_use_alias() {\n+        covers!(ra_ide_db::goto_def_for_use_alias);\n+        check_goto(\n+            \"\n+            //- /lib.rs\n+            use foo as bar<|>;\n+\n+\n+            //- /foo/lib.rs\n+            #[macro_export]\n+            macro_rules! foo { () => { () } }\",\n+            \"SOURCE_FILE FileId(2) 0..50\",\n+            \"#[macro_export]\\nmacro_rules! foo { () => { () } }\\n\",\n+        );\n+    }\n+\n+    #[test]\n+    fn goto_def_for_use_alias_foo_macro() {\n+        check_goto(\n+            \"\n+            //- /lib.rs\n+            use foo::foo as bar<|>;\n+\n+            //- /foo/lib.rs\n+            #[macro_export]\n+            macro_rules! foo { () => { () } }\n+            \",\n+            \"foo MACRO_CALL FileId(2) 0..49 29..32\",\n+            \"#[macro_export]\\nmacro_rules! foo { () => { () } }|foo\",\n+        );\n+    }\n+\n     #[test]\n     fn goto_def_for_macros_in_use_tree() {\n         check_goto("}, {"sha": "d5d06962bb568ee0b2d2884db1e7fbe358751182", "filename": "crates/ra_ide_db/src/defs.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs?ref=b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "patch": "@@ -119,6 +119,16 @@ fn classify_name_inner(sema: &Semantics<RootDatabase>, name: &ast::Name) -> Opti\n \n     match_ast! {\n         match parent {\n+            ast::Alias(it) => {\n+                tested_by!(goto_def_for_use_alias; force);\n+                let use_tree = it.syntax().ancestors().find_map(ast::UseTree::cast)?;\n+                let path = use_tree.path()?;\n+                let path_segment = path.segment()?;\n+                let name_ref = path_segment.name_ref()?;\n+                let name_ref_class = classify_name_ref(sema, &name_ref)?;\n+\n+                Some(name_ref_class.definition())\n+            },\n             ast::BindPat(it) => {\n                 let local = sema.to_def(&it)?;\n                 Some(Definition::Local(local))"}, {"sha": "386fe605c74884c7ee29657b7443c0ddb48ff74a", "filename": "crates/ra_ide_db/src/marks.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide_db%2Fsrc%2Fmarks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477/crates%2Fra_ide_db%2Fsrc%2Fmarks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fmarks.rs?ref=b1a5dc8c8b8588ac61d1952ba3b4cf3b68d2a477", "patch": "@@ -2,6 +2,7 @@\n \n test_utils::marks![\n     goto_def_for_macros\n+    goto_def_for_use_alias\n     goto_def_for_methods\n     goto_def_for_fields\n     goto_def_for_record_fields"}]}