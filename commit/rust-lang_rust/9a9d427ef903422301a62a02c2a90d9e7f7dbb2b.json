{"sha": "9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhOWQ0MjdlZjkwMzQyMjMwMWE2MmEwMmMyYTkwZDllN2Y3ZGJiMmI=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-08T09:57:06Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:08:33Z"}, "message": "ci: extract checking out submodules into a script", "tree": {"sha": "b48e8fb46d99396a0a6b9756f19e92c3242530ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b48e8fb46d99396a0a6b9756f19e92c3242530ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zAeEACgkQPgar6Auq\n8Zw9jxAAhSWERsYa2TdnMrSd744pxFAiIETupzAZhRWsMgktITHt9iZw3j1J2pvE\nwG3KZ5BTsthVYC3oMAZasMClYxWVhV57FcNtzyWlp3iEpN2uOug9KkrOYtRA3Jjl\n8VQSDHQdvEnH53+lmSsmbAFlviArBiDw9MhkUCh5HHrODEFDeTVuGaASdqfDTmRe\nw9UqfwDQURNqTCUaCyjQDkZWss9zcWfDCHmt7vkXiyIkpufJa8QCDiCpk6y39pjq\nUcWgfQw/K2PnaTGIuUdMLGahZIRAAyFqWfHOebz7qK+BRdKVxerlQ3vakPvlwurb\n5mnlGYquCeqQdTewzpHf/Ukj5kzS2MZyzReB+tN65p5JeTgex0dB0TSzZeUEntSb\nAtugI1y/dntYrVfu4tmuC0ck4ycHquoi92+UP/BSgYSVlmAU1XReDrubrc9I+4mD\nDHcgs8lbyvvqNtQIGwWTKqcGsq0x99nL0UkS0gq/pj1FGPLpeTvxcCjWHDdAuJ+s\nez1cmbIooYfWVXzN896NJL8yrcd0s1tVVpxtT6laTr+rDl/5nLTBRPrKi7GJrj/X\njp/guUHnxkdEOjtIHIaKof2t5Hy3SciqHrqE3G8ELjF/kAgWCOVRg+BwR+8/o2xr\nJfprDgAT1uE7dOGJ+75k5nR+2oHmvwPE919G/XNh5uRo2xUP5wM=\n=NIaK\n-----END PGP SIGNATURE-----", "payload": "tree b48e8fb46d99396a0a6b9756f19e92c3242530ac\nparent d264e954dc885bcb9cc5cc35cbbff862dffff6db\nauthor Pietro Albini <pietro@pietroalbini.org> 1570528626 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572012513 +0200\n\nci: extract checking out submodules into a script\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "html_url": "https://github.com/rust-lang/rust/commit/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d264e954dc885bcb9cc5cc35cbbff862dffff6db", "url": "https://api.github.com/repos/rust-lang/rust/commits/d264e954dc885bcb9cc5cc35cbbff862dffff6db", "html_url": "https://github.com/rust-lang/rust/commit/d264e954dc885bcb9cc5cc35cbbff862dffff6db"}], "stats": {"total": 33, "additions": 22, "deletions": 11}, "files": [{"sha": "0b15ae36e0c4bcf9afb296e981133e98055df4f5", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "patch": "@@ -128,17 +128,11 @@ steps:\n \n # Check out all our submodules, but more quickly than using git by using one of\n # our custom scripts\n-- bash: |\n-    set -e\n-    mkdir -p $HOME/rustsrc\n-    $BUILD_SOURCESDIRECTORY/src/ci/init_repo.sh . $HOME/rustsrc\n-  condition: and(succeeded(), not(variables.SKIP_JOB), ne(variables['Agent.OS'], 'Windows_NT'))\n-  displayName: Check out submodules (Unix)\n-- script: |\n-    if not exist C:\\cache\\rustsrc\\NUL mkdir C:\\cache\\rustsrc\n-    sh src/ci/init_repo.sh . /c/cache/rustsrc\n-  condition: and(succeeded(), not(variables.SKIP_JOB), eq(variables['Agent.OS'], 'Windows_NT'))\n-  displayName: Check out submodules (Windows)\n+- bash: src/ci/scripts/checkout-submodules.sh\n+  env:\n+    AGENT_OS: $(Agent.OS)\n+  displayName: Checkout submodules\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n \n # See also the disable for autocrlf above, this just checks that it worked\n #"}, {"sha": "0b44ea3c90bc91ea780f94082d1cafffdb6b3074", "filename": "src/ci/scripts/checkout-submodules.sh", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b/src%2Fci%2Fscripts%2Fcheckout-submodules.sh", "raw_url": "https://github.com/rust-lang/rust/raw/9a9d427ef903422301a62a02c2a90d9e7f7dbb2b/src%2Fci%2Fscripts%2Fcheckout-submodules.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Fcheckout-submodules.sh?ref=9a9d427ef903422301a62a02c2a90d9e7f7dbb2b", "patch": "@@ -0,0 +1,17 @@\n+#!/bin/bash\n+# Check out all our submodules, but more quickly than using git by using one of\n+# our custom scripts\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+if isWindows; then\n+    path=\"/c/cache/rustsrc\"\n+else\n+    path=\"${HOME}/rustsrc\"\n+fi\n+\n+mkdir -p \"${path}\"\n+\"$(cd \"$(dirname \"$0\")\" && pwd)/../init_repo.sh\" . \"${path}\""}]}