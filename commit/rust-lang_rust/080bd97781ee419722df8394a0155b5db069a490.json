{"sha": "080bd97781ee419722df8394a0155b5db069a490", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4MGJkOTc3ODFlZTQxOTcyMmRmODM5NGEwMTU1YjVkYjA2OWE0OTA=", "commit": {"author": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-03-10T11:08:20Z"}, "committer": {"name": "Eduard Burtescu", "email": "edy.burt@gmail.com", "date": "2016-03-17T20:48:07Z"}, "message": "compiletest: Add rustc-env for run-pass/super-fast-paren-parsing.", "tree": {"sha": "71ab89c8431aef68549f69526d4a958011aa1dc2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71ab89c8431aef68549f69526d4a958011aa1dc2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/080bd97781ee419722df8394a0155b5db069a490", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/080bd97781ee419722df8394a0155b5db069a490", "html_url": "https://github.com/rust-lang/rust/commit/080bd97781ee419722df8394a0155b5db069a490", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/080bd97781ee419722df8394a0155b5db069a490/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f990fb4f000077216d96bf31ea33623a9875e9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f990fb4f000077216d96bf31ea33623a9875e9e", "html_url": "https://github.com/rust-lang/rust/commit/5f990fb4f000077216d96bf31ea33623a9875e9e"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "ef93fcfa013f89f10b99c00917a462cbe21aea18", "filename": "src/compiletest/header.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/080bd97781ee419722df8394a0155b5db069a490/src%2Fcompiletest%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/080bd97781ee419722df8394a0155b5db069a490/src%2Fcompiletest%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fheader.rs?ref=080bd97781ee419722df8394a0155b5db069a490", "patch": "@@ -31,6 +31,8 @@ pub struct TestProps {\n     pub pp_exact: Option<PathBuf>,\n     // Modules from aux directory that should be compiled\n     pub aux_builds: Vec<String> ,\n+    // Environment settings to use for compiling\n+    pub rustc_env: Vec<(String,String)> ,\n     // Environment settings to use during execution\n     pub exec_env: Vec<(String,String)> ,\n     // Lines to check if they appear in the expected debugger output\n@@ -77,6 +79,7 @@ pub fn load_props(testfile: &Path) -> TestProps {\n         pp_exact: pp_exact,\n         aux_builds: aux_builds,\n         revisions: vec![],\n+        rustc_env: vec![],\n         exec_env: exec_env,\n         check_lines: check_lines,\n         build_aux_docs: build_aux_docs,\n@@ -153,10 +156,14 @@ pub fn load_props_into(props: &mut TestProps, testfile: &Path, cfg: Option<&str>\n             props.aux_builds.push(ab);\n         }\n \n-        if let Some(ee) = parse_exec_env(ln) {\n+        if let Some(ee) = parse_env(ln, \"exec-env\") {\n             props.exec_env.push(ee);\n         }\n \n+        if let Some(ee) = parse_env(ln, \"rustc-env\") {\n+            props.rustc_env.push(ee);\n+        }\n+\n         if let Some(cl) =  parse_check_line(ln) {\n             props.check_lines.push(cl);\n         }\n@@ -372,8 +379,8 @@ fn parse_pretty_compare_only(line: &str) -> bool {\n     parse_name_directive(line, \"pretty-compare-only\")\n }\n \n-fn parse_exec_env(line: &str) -> Option<(String, String)> {\n-    parse_name_value_directive(line, \"exec-env\").map(|nv| {\n+fn parse_env(line: &str, name: &str) -> Option<(String, String)> {\n+    parse_name_value_directive(line, name).map(|nv| {\n         // nv is either FOO or FOO=BAR\n         let mut strs: Vec<String> = nv\n                                       .splitn(2, '=')"}, {"sha": "1d1f5489c48f304ffe23838515f0aeaa17eda68d", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/080bd97781ee419722df8394a0155b5db069a490/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/080bd97781ee419722df8394a0155b5db069a490/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=080bd97781ee419722df8394a0155b5db069a490", "patch": "@@ -1386,7 +1386,7 @@ fn compose_and_run_compiler(config: &Config, props: &TestProps,\n     compose_and_run(config,\n                     testpaths,\n                     args,\n-                    Vec::new(),\n+                    props.rustc_env.clone(),\n                     &config.compile_lib_path,\n                     Some(aux_dir.to_str().unwrap()),\n                     input)"}, {"sha": "b764a983a0c0960aa872a4c00c0982f5cc7f0456", "filename": "src/test/run-pass/super-fast-paren-parsing.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/080bd97781ee419722df8394a0155b5db069a490/src%2Ftest%2Frun-pass%2Fsuper-fast-paren-parsing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/080bd97781ee419722df8394a0155b5db069a490/src%2Ftest%2Frun-pass%2Fsuper-fast-paren-parsing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsuper-fast-paren-parsing.rs?ref=080bd97781ee419722df8394a0155b5db069a490", "patch": "@@ -11,6 +11,7 @@\n // ignore-pretty\n //\n // exec-env:RUST_MIN_STACK=16000000\n+// rustc-env:RUST_MIN_STACK=16000000\n //\n // Big stack is needed for pretty printing, a little sad...\n "}]}