{"sha": "a3947129c5dc60cf051260c364833946f92e3350", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzOTQ3MTI5YzVkYzYwY2YwNTEyNjBjMzY0ODMzOTQ2ZjkyZTMzNTA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-08-18T12:32:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-08-18T12:32:32Z"}, "message": "Merge #5794\n\n5794: Simplify building a symbol hierarchy\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "a69f4c1574f8f3ff97d21b4877f6530c979efce3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a69f4c1574f8f3ff97d21b4877f6530c979efce3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3947129c5dc60cf051260c364833946f92e3350", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfO8pgCRBK7hj4Ov3rIwAAdHIIADjyobNnyLBnUXcIXRd9+B1v\nPAwpfomkpaiT0p1w6v69G4M+o3Pv5uAOAcKiYgvGUN4jO7RiPiH9LIrkfODVBr2T\nkDJd8icspDLfy2jQ7jgygjVacQlN7K5cDePITfzqjhbEK0+iJzvvmSncpAjIhsbL\nf5E5poc6AH6E1Cxw0Bibg8pcAclkjeu+9SY6nNOB+g4HtLkr422EzAzKeU+1WHO7\nBw6MAnbvJ3cYfSsdLt9V3vz/NT9pbwoJvgUcgBtX1ZQg1HXKqRLKK2O5DifkOpae\nirfXRJ0o2yIDU/Zvp6Y0bl83dbrk4GR6CDSWjEJ7B74L4+E2Yg/bniFcO1+V8Ak=\n=rsMg\n-----END PGP SIGNATURE-----\n", "payload": "tree a69f4c1574f8f3ff97d21b4877f6530c979efce3\nparent b8dfc331abbfce6aad0c248c91c57bd9890a668f\nparent 0d201638d9c7710795fa24765f7b761432cd5622\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1597753952 +0000\ncommitter GitHub <noreply@github.com> 1597753952 +0000\n\nMerge #5794\n\n5794: Simplify building a symbol hierarchy\n r=matklad a=matklad\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3947129c5dc60cf051260c364833946f92e3350", "html_url": "https://github.com/rust-lang/rust/commit/a3947129c5dc60cf051260c364833946f92e3350", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3947129c5dc60cf051260c364833946f92e3350/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b8dfc331abbfce6aad0c248c91c57bd9890a668f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b8dfc331abbfce6aad0c248c91c57bd9890a668f", "html_url": "https://github.com/rust-lang/rust/commit/b8dfc331abbfce6aad0c248c91c57bd9890a668f"}, {"sha": "0d201638d9c7710795fa24765f7b761432cd5622", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d201638d9c7710795fa24765f7b761432cd5622", "html_url": "https://github.com/rust-lang/rust/commit/0d201638d9c7710795fa24765f7b761432cd5622"}], "stats": {"total": 41, "additions": 23, "deletions": 18}, "files": [{"sha": "6510e8ccc9028ab6c01560077a7b140c80f7216c", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/a3947129c5dc60cf051260c364833946f92e3350/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3947129c5dc60cf051260c364833946f92e3350/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=a3947129c5dc60cf051260c364833946f92e3350", "patch": "@@ -271,24 +271,24 @@ pub(crate) fn handle_document_symbol(\n         };\n         parents.push((doc_symbol, symbol.parent));\n     }\n-    let mut document_symbols = Vec::new();\n-    // Constructs `document_symbols` from `parents`, in order from the end.\n-    while let Some((node, parent)) = parents.pop() {\n-        match parent {\n-            None => document_symbols.push(node),\n-            Some(i) => {\n-                parents[i].0.children.get_or_insert_with(Vec::new).push(node);\n-            }\n-        }\n-    }\n \n-    fn reverse(symbols: &mut Vec<DocumentSymbol>) {\n-        for sym in symbols.iter_mut() {\n-            sym.children.as_mut().map(|c| reverse(c));\n+    // Builds hierarchy from a flat list, in reverse order (so that indices\n+    // makes sense)\n+    let document_symbols = {\n+        let mut acc = Vec::new();\n+        while let Some((mut node, parent_idx)) = parents.pop() {\n+            if let Some(children) = &mut node.children {\n+                children.reverse();\n+            }\n+            let parent = match parent_idx {\n+                None => &mut acc,\n+                Some(i) => parents[i].0.children.get_or_insert_with(Vec::new),\n+            };\n+            parent.push(node);\n         }\n-        symbols.reverse();\n-    }\n-    reverse(&mut document_symbols);\n+        acc.reverse();\n+        acc\n+    };\n \n     let res = if snap.config.client_caps.hierarchical_symbols {\n         document_symbols.into()"}, {"sha": "2454087e89d39d158972ba311827dccfab349409", "filename": "docs/dev/style.md", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a3947129c5dc60cf051260c364833946f92e3350/docs%2Fdev%2Fstyle.md", "raw_url": "https://github.com/rust-lang/rust/raw/a3947129c5dc60cf051260c364833946f92e3350/docs%2Fdev%2Fstyle.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Fstyle.md?ref=a3947129c5dc60cf051260c364833946f92e3350", "patch": "@@ -148,8 +148,13 @@ struct Foo {\n Use boring and long names for local variables ([yay code completion](https://github.com/rust-analyzer/rust-analyzer/pull/4162#discussion_r417130973)).\n The default name is a lowercased name of the type: `global_state: GlobalState`.\n Avoid ad-hoc acronyms and contractions, but use the ones that exist consistently (`db`, `ctx`, `acc`).\n-The default name for \"result of the function\" local variable is `res`.\n-The default name for \"I don't really care about the name\" variable is `it`.\n+\n+Default names:\n+\n+* `res` -- \"result of the function\" local variable\n+* `it` -- I don't really care about the name\n+* `n_foo` -- number of foos\n+* `foo_idx` -- index of `foo`\n \n # Collection types\n "}]}