{"sha": "1de2705c7985819e4d36975fe26aad1510521140", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkZTI3MDVjNzk4NTgxOWU0ZDM2OTc1ZmUyNmFhZDE1MTA1MjExNDA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-12-23T14:16:23Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-23T14:16:23Z"}, "message": "Rollup merge of #67466 - oli-obk:const_intrinsic, r=Centril\n\nRequire const stability attributes on intrinsics to be able to use them in constant contexts\n\nr? @Centril\n\nfinally fixes #61495\n\ncc @RalfJung", "tree": {"sha": "bfda86c8cc21cb0ce394904f14f84b1f7c2fb0b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bfda86c8cc21cb0ce394904f14f84b1f7c2fb0b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1de2705c7985819e4d36975fe26aad1510521140", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeAMw3CRBK7hj4Ov3rIwAAdHIIAGdyCXMSvY3dJkoREz5rBP6x\n5UwmpEWToWH1PFAQoZUeOY1U9u4SPmxCKXoaAp3ziTZs++xbglUhuzJ+QjAj12+e\n/ALARqp0U6X+v4K1OnJsZ0ytNM0U/WE79/HdzbLY1eosMuoC1B0Ve+l5wFPionbC\nr5reuXjdpIgWhcHHcnnt8ChUS+ii9fTLSukpwAW2ZDnWHTUo1g3Tk/za7SvWMpfi\nYZNXBhaB9c6h3k0vWcn4kT4y//EFg9OVvSYB2q/VgOp3Zge6dJiZMQYF8heuF4bQ\nd3+uPySUGDFj5IaYx9uOOuK0LVd0CDHGLntxpuIFbSe3cwu7NW45xkl0YJbIZag=\n=bmmG\n-----END PGP SIGNATURE-----\n", "payload": "tree bfda86c8cc21cb0ce394904f14f84b1f7c2fb0b8\nparent 260514da942f281bc2dc3b14b629d3e660b3484f\nparent 63d28221c62be5c63d6df4ac83043d9cacd2a226\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1577110583 +0100\ncommitter GitHub <noreply@github.com> 1577110583 +0100\n\nRollup merge of #67466 - oli-obk:const_intrinsic, r=Centril\n\nRequire const stability attributes on intrinsics to be able to use them in constant contexts\n\nr? @Centril\n\nfinally fixes #61495\n\ncc @RalfJung\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1de2705c7985819e4d36975fe26aad1510521140", "html_url": "https://github.com/rust-lang/rust/commit/1de2705c7985819e4d36975fe26aad1510521140", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1de2705c7985819e4d36975fe26aad1510521140/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "260514da942f281bc2dc3b14b629d3e660b3484f", "url": "https://api.github.com/repos/rust-lang/rust/commits/260514da942f281bc2dc3b14b629d3e660b3484f", "html_url": "https://github.com/rust-lang/rust/commit/260514da942f281bc2dc3b14b629d3e660b3484f"}, {"sha": "63d28221c62be5c63d6df4ac83043d9cacd2a226", "url": "https://api.github.com/repos/rust-lang/rust/commits/63d28221c62be5c63d6df4ac83043d9cacd2a226", "html_url": "https://github.com/rust-lang/rust/commit/63d28221c62be5c63d6df4ac83043d9cacd2a226"}], "stats": {"total": 149, "additions": 53, "deletions": 96}, "files": [{"sha": "502090731f4a159f04c25151a60f17721c63ced6", "filename": "src/libcore/intrinsics.rs", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fintrinsics.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -1,6 +1,22 @@\n //! Compiler intrinsics.\n //!\n //! The corresponding definitions are in `librustc_codegen_llvm/intrinsic.rs`.\n+//! The corresponding const implementations are in `librustc_mir/interpret/intrinsics.rs`\n+//!\n+//! # Const intrinsics\n+//!\n+//! Note: any changes to the constness of intrinsics should be discussed with the language team.\n+//! This includes changes in the stability of the constness.\n+//!\n+//! In order to make an intrinsic usable at compile-time, one needs to copy the implementation\n+//! from https://github.com/rust-lang/miri/blob/master/src/shims/intrinsics.rs to\n+//! `librustc_mir/interpret/intrinsics.rs` and add a\n+//! `#[rustc_const_unstable(feature = \"foo\", issue = \"01234\")]` to the intrinsic.\n+//!\n+//! If an intrinsic is supposed to be used from a `const fn` with a `rustc_const_stable` attribute,\n+//! the intrinsic's attribute must be `rustc_const_stable`, too. Such a change should not be done\n+//! without T-lang consulation, because it bakes a feature into the language that cannot be\n+//! replicated in user code without compiler support.\n //!\n //! # Volatiles\n //!\n@@ -671,14 +687,17 @@ extern \"rust-intrinsic\" {\n     ///\n     /// The stabilized version of this intrinsic is\n     /// [`std::mem::size_of`](../../std/mem/fn.size_of.html).\n+    #[rustc_const_stable(feature = \"const_size_of\", since = \"1.40.0\")]\n     pub fn size_of<T>() -> usize;\n \n     /// Moves a value to an uninitialized memory location.\n     ///\n     /// Drop glue is not run on the destination.\n     pub fn move_val_init<T>(dst: *mut T, src: T);\n \n+    #[rustc_const_stable(feature = \"const_min_align_of\", since = \"1.40.0\")]\n     pub fn min_align_of<T>() -> usize;\n+    #[rustc_const_unstable(feature = \"const_pref_align_of\", issue = \"0\")]\n     pub fn pref_align_of<T>() -> usize;\n \n     /// The size of the referenced value in bytes.\n@@ -689,18 +708,21 @@ extern \"rust-intrinsic\" {\n     pub fn min_align_of_val<T: ?Sized>(_: &T) -> usize;\n \n     /// Gets a static string slice containing the name of a type.\n+    #[rustc_const_unstable(feature = \"const_type_name\", issue = \"0\")]\n     pub fn type_name<T: ?Sized>() -> &'static str;\n \n     /// Gets an identifier which is globally unique to the specified type. This\n     /// function will return the same value for a type regardless of whichever\n     /// crate it is invoked in.\n+    #[rustc_const_unstable(feature = \"const_type_id\", issue = \"0\")]\n     pub fn type_id<T: ?Sized + 'static>() -> u64;\n \n     /// A guard for unsafe functions that cannot ever be executed if `T` is uninhabited:\n     /// This will statically either panic, or do nothing.\n     pub fn panic_if_uninhabited<T>();\n \n     /// Gets a reference to a static `Location` indicating where it was called.\n+    #[rustc_const_unstable(feature = \"const_caller_location\", issue = \"47809\")]\n     pub fn caller_location() -> &'static crate::panic::Location<'static>;\n \n     /// Creates a value initialized to zero.\n@@ -957,6 +979,7 @@ extern \"rust-intrinsic\" {\n     ///\n     /// The stabilized version of this intrinsic is\n     /// [`std::mem::needs_drop`](../../std/mem/fn.needs_drop.html).\n+    #[rustc_const_stable(feature = \"const_needs_drop\", since = \"1.40.0\")]\n     pub fn needs_drop<T>() -> bool;\n \n     /// Calculates the offset from a pointer.\n@@ -1154,6 +1177,7 @@ extern \"rust-intrinsic\" {\n     pub fn float_to_int_approx_unchecked<Float, Int>(value: Float) -> Int;\n \n     /// Returns the number of bits set in an integer type `T`\n+    #[rustc_const_stable(feature = \"const_ctpop\", since = \"1.40.0\")]\n     pub fn ctpop<T>(x: T) -> T;\n \n     /// Returns the number of leading unset bits (zeroes) in an integer type `T`.\n@@ -1181,6 +1205,7 @@ extern \"rust-intrinsic\" {\n     /// let num_leading = ctlz(x);\n     /// assert_eq!(num_leading, 16);\n     /// ```\n+    #[rustc_const_stable(feature = \"const_ctlz\", since = \"1.40.0\")]\n     pub fn ctlz<T>(x: T) -> T;\n \n     /// Like `ctlz`, but extra-unsafe as it returns `undef` when\n@@ -1197,6 +1222,7 @@ extern \"rust-intrinsic\" {\n     /// let num_leading = unsafe { ctlz_nonzero(x) };\n     /// assert_eq!(num_leading, 3);\n     /// ```\n+    #[rustc_const_unstable(feature = \"constctlz\", issue = \"0\")]\n     pub fn ctlz_nonzero<T>(x: T) -> T;\n \n     /// Returns the number of trailing unset bits (zeroes) in an integer type `T`.\n@@ -1224,6 +1250,7 @@ extern \"rust-intrinsic\" {\n     /// let num_trailing = cttz(x);\n     /// assert_eq!(num_trailing, 16);\n     /// ```\n+    #[rustc_const_stable(feature = \"const_cttz\", since = \"1.40.0\")]\n     pub fn cttz<T>(x: T) -> T;\n \n     /// Like `cttz`, but extra-unsafe as it returns `undef` when\n@@ -1240,30 +1267,36 @@ extern \"rust-intrinsic\" {\n     /// let num_trailing = unsafe { cttz_nonzero(x) };\n     /// assert_eq!(num_trailing, 3);\n     /// ```\n+    #[rustc_const_unstable(feature = \"const_cttz\", issue = \"0\")]\n     pub fn cttz_nonzero<T>(x: T) -> T;\n \n     /// Reverses the bytes in an integer type `T`.\n+    #[rustc_const_stable(feature = \"const_bswap\", since = \"1.40.0\")]\n     pub fn bswap<T>(x: T) -> T;\n \n     /// Reverses the bits in an integer type `T`.\n+    #[rustc_const_stable(feature = \"const_bitreverse\", since = \"1.40.0\")]\n     pub fn bitreverse<T>(x: T) -> T;\n \n     /// Performs checked integer addition.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `overflowing_add` method. For example,\n     /// [`std::u32::overflowing_add`](../../std/primitive.u32.html#method.overflowing_add)\n+    #[rustc_const_stable(feature = \"const_int_overflow\", since = \"1.40.0\")]\n     pub fn add_with_overflow<T>(x: T, y: T) -> (T, bool);\n \n     /// Performs checked integer subtraction\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `overflowing_sub` method. For example,\n     /// [`std::u32::overflowing_sub`](../../std/primitive.u32.html#method.overflowing_sub)\n+    #[rustc_const_stable(feature = \"const_int_overflow\", since = \"1.40.0\")]\n     pub fn sub_with_overflow<T>(x: T, y: T) -> (T, bool);\n \n     /// Performs checked integer multiplication\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `overflowing_mul` method. For example,\n     /// [`std::u32::overflowing_mul`](../../std/primitive.u32.html#method.overflowing_mul)\n+    #[rustc_const_stable(feature = \"const_int_overflow\", since = \"1.40.0\")]\n     pub fn mul_with_overflow<T>(x: T, y: T) -> (T, bool);\n \n     /// Performs an exact division, resulting in undefined behavior where\n@@ -1279,9 +1312,11 @@ extern \"rust-intrinsic\" {\n \n     /// Performs an unchecked left shift, resulting in undefined behavior when\n     /// y < 0 or y >= N, where N is the width of T in bits.\n+    #[rustc_const_stable(feature = \"const_int_unchecked\", since = \"1.40.0\")]\n     pub fn unchecked_shl<T>(x: T, y: T) -> T;\n     /// Performs an unchecked right shift, resulting in undefined behavior when\n     /// y < 0 or y >= N, where N is the width of T in bits.\n+    #[rustc_const_stable(feature = \"const_int_unchecked\", since = \"1.40.0\")]\n     pub fn unchecked_shr<T>(x: T, y: T) -> T;\n \n     /// Returns the result of an unchecked addition, resulting in\n@@ -1300,39 +1335,46 @@ extern \"rust-intrinsic\" {\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `rotate_left` method. For example,\n     /// [`std::u32::rotate_left`](../../std/primitive.u32.html#method.rotate_left)\n+    #[rustc_const_stable(feature = \"const_int_rotate\", since = \"1.40.0\")]\n     pub fn rotate_left<T>(x: T, y: T) -> T;\n \n     /// Performs rotate right.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `rotate_right` method. For example,\n     /// [`std::u32::rotate_right`](../../std/primitive.u32.html#method.rotate_right)\n+    #[rustc_const_stable(feature = \"const_int_rotate\", since = \"1.40.0\")]\n     pub fn rotate_right<T>(x: T, y: T) -> T;\n \n     /// Returns (a + b) mod 2<sup>N</sup>, where N is the width of T in bits.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `wrapping_add` method. For example,\n     /// [`std::u32::wrapping_add`](../../std/primitive.u32.html#method.wrapping_add)\n+    #[rustc_const_stable(feature = \"const_int_wrapping\", since = \"1.40.0\")]\n     pub fn wrapping_add<T>(a: T, b: T) -> T;\n     /// Returns (a - b) mod 2<sup>N</sup>, where N is the width of T in bits.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `wrapping_sub` method. For example,\n     /// [`std::u32::wrapping_sub`](../../std/primitive.u32.html#method.wrapping_sub)\n+    #[rustc_const_stable(feature = \"const_int_wrapping\", since = \"1.40.0\")]\n     pub fn wrapping_sub<T>(a: T, b: T) -> T;\n     /// Returns (a * b) mod 2<sup>N</sup>, where N is the width of T in bits.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `wrapping_mul` method. For example,\n     /// [`std::u32::wrapping_mul`](../../std/primitive.u32.html#method.wrapping_mul)\n+    #[rustc_const_stable(feature = \"const_int_wrapping\", since = \"1.40.0\")]\n     pub fn wrapping_mul<T>(a: T, b: T) -> T;\n \n     /// Computes `a + b`, while saturating at numeric bounds.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `saturating_add` method. For example,\n     /// [`std::u32::saturating_add`](../../std/primitive.u32.html#method.saturating_add)\n+    #[rustc_const_stable(feature = \"const_int_saturating\", since = \"1.40.0\")]\n     pub fn saturating_add<T>(a: T, b: T) -> T;\n     /// Computes `a - b`, while saturating at numeric bounds.\n     /// The stabilized versions of this intrinsic are available on the integer\n     /// primitives via the `saturating_sub` method. For example,\n     /// [`std::u32::saturating_sub`](../../std/primitive.u32.html#method.saturating_sub)\n+    #[rustc_const_stable(feature = \"const_int_saturating\", since = \"1.40.0\")]\n     pub fn saturating_sub<T>(a: T, b: T) -> T;\n \n     /// Returns the value of the discriminant for the variant in 'v',\n@@ -1354,6 +1396,7 @@ extern \"rust-intrinsic\" {\n     pub fn nontemporal_store<T>(ptr: *mut T, val: T);\n \n     /// See documentation of `<*const T>::offset_from` for details.\n+    #[rustc_const_unstable(feature = \"const_ptr_offset_from\", issue = \"0\")]\n     pub fn ptr_offset_from<T>(ptr: *const T, base: *const T) -> isize;\n \n     /// Internal hook used by Miri to implement unwinding."}, {"sha": "d12aebb87b975a5a58e135881e47198feace7ce8", "filename": "src/libcore/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Flib.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -127,6 +127,8 @@\n #![feature(maybe_uninit_slice)]\n #![feature(external_doc)]\n #![feature(associated_type_bounds)]\n+#![feature(const_type_id)]\n+#![feature(const_caller_location)]\n \n #[prelude_import]\n #[allow(unused)]"}, {"sha": "1a3d338fb98767401bff787f1cf484d38ef4baf6", "filename": "src/libcore/macros/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibcore%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmacros%2Fmod.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -5,6 +5,7 @@\n     // the `caller_location` intrinsic, but once  `#[track_caller]` is implemented,\n     // `panicking::{panic, panic_fmt}` can use that instead of a `Location` argument.\n     core_intrinsics,\n+    const_caller_location,\n )]\n #[stable(feature = \"core\", since = \"1.6.0\")]\n macro_rules! panic {"}, {"sha": "7fe950ef7b7f6050268fcf4bd69a92e836f26070", "filename": "src/librustc/ty/constness.rs", "status": "modified", "additions": 2, "deletions": 96, "changes": 98, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibrustc%2Fty%2Fconstness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Flibrustc%2Fty%2Fconstness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fconstness.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -2,7 +2,7 @@ use crate::ty::query::Providers;\n use crate::hir::def_id::DefId;\n use crate::hir;\n use crate::ty::TyCtxt;\n-use syntax_pos::symbol::{sym, Symbol};\n+use syntax_pos::symbol::Symbol;\n use rustc_target::spec::abi::Abi;\n use crate::hir::map::blocks::FnLikeNode;\n use syntax::attr;\n@@ -41,51 +41,12 @@ impl<'tcx> TyCtxt<'tcx> {\n         }\n     }\n \n-    /// Returns `true` if the `def_id` refers to an intrisic which we've whitelisted\n-    /// for being called from stable `const fn`s (`min_const_fn`).\n-    ///\n-    /// Adding more intrinsics requires sign-off from @rust-lang/lang.\n-    ///\n-    /// This list differs from the list in `is_const_intrinsic` in the sense that any item on this\n-    /// list must be on the `is_const_intrinsic` list, too, because if an intrinsic is callable from\n-    /// stable, it must be callable at all.\n-    fn is_intrinsic_min_const_fn(self, def_id: DefId) -> bool {\n-        match self.item_name(def_id) {\n-            | sym::size_of\n-            | sym::min_align_of\n-            | sym::needs_drop\n-            // Arithmetic:\n-            | sym::add_with_overflow // ~> .overflowing_add\n-            | sym::sub_with_overflow // ~> .overflowing_sub\n-            | sym::mul_with_overflow // ~> .overflowing_mul\n-            | sym::wrapping_add // ~> .wrapping_add\n-            | sym::wrapping_sub // ~> .wrapping_sub\n-            | sym::wrapping_mul // ~> .wrapping_mul\n-            | sym::saturating_add // ~> .saturating_add\n-            | sym::saturating_sub // ~> .saturating_sub\n-            | sym::unchecked_shl // ~> .wrapping_shl\n-            | sym::unchecked_shr // ~> .wrapping_shr\n-            | sym::rotate_left // ~> .rotate_left\n-            | sym::rotate_right // ~> .rotate_right\n-            | sym::ctpop // ~> .count_ones\n-            | sym::ctlz // ~> .leading_zeros\n-            | sym::cttz // ~> .trailing_zeros\n-            | sym::bswap // ~> .swap_bytes\n-            | sym::bitreverse // ~> .reverse_bits\n-            => true,\n-            _ => false,\n-        }\n-    }\n-\n     /// Returns `true` if this function must conform to `min_const_fn`\n     pub fn is_min_const_fn(self, def_id: DefId) -> bool {\n         // Bail out if the signature doesn't contain `const`\n         if !self.is_const_fn_raw(def_id) {\n             return false;\n         }\n-        if let Abi::RustIntrinsic = self.fn_sig(def_id).abi() {\n-            return self.is_intrinsic_min_const_fn(def_id);\n-        }\n \n         if self.features().staged_api {\n             // In order for a libstd function to be considered min_const_fn\n@@ -134,62 +95,7 @@ pub fn provide(providers: &mut Providers<'_>) {\n     fn is_const_intrinsic(tcx: TyCtxt<'_>, def_id: DefId) -> Option<bool> {\n         match tcx.fn_sig(def_id).abi() {\n             Abi::RustIntrinsic |\n-            Abi::PlatformIntrinsic => {\n-                // FIXME: deduplicate these two lists as much as possible\n-                match tcx.item_name(def_id) {\n-                    // Keep this list in the same order as the match patterns in\n-                    // `librustc_mir/interpret/intrinsics.rs`\n-\n-                    // This whitelist is a list of intrinsics that have a miri-engine implementation\n-                    // and can thus be called when enabling enough feature gates. The similar\n-                    // whitelist in `is_intrinsic_min_const_fn` (in this file), exists for allowing\n-                    // the intrinsics to be called by stable const fns.\n-                    | sym::caller_location\n-\n-                    | sym::min_align_of\n-                    | sym::pref_align_of\n-                    | sym::needs_drop\n-                    | sym::size_of\n-                    | sym::type_id\n-                    | sym::type_name\n-\n-                    | sym::ctpop\n-                    | sym::cttz\n-                    | sym::cttz_nonzero\n-                    | sym::ctlz\n-                    | sym::ctlz_nonzero\n-                    | sym::bswap\n-                    | sym::bitreverse\n-\n-                    | sym::wrapping_add\n-                    | sym::wrapping_sub\n-                    | sym::wrapping_mul\n-                    | sym::add_with_overflow\n-                    | sym::sub_with_overflow\n-                    | sym::mul_with_overflow\n-\n-                    | sym::saturating_add\n-                    | sym::saturating_sub\n-\n-                    | sym::unchecked_shl\n-                    | sym::unchecked_shr\n-\n-                    | sym::rotate_left\n-                    | sym::rotate_right\n-\n-                    | sym::ptr_offset_from\n-\n-                    | sym::transmute\n-\n-                    | sym::simd_insert\n-\n-                    | sym::simd_extract\n-\n-                    => Some(true),\n-\n-                    _ => Some(false)\n-                }\n-            }\n+            Abi::PlatformIntrinsic => Some(tcx.lookup_const_stability(def_id).is_some()),\n             _ => None\n         }\n     }"}, {"sha": "92231d4ced321ea9f87d0ff529ed9deedbca36b2", "filename": "src/test/ui/consts/const-eval/simd/insert_extract.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fsimd%2Finsert_extract.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fsimd%2Finsert_extract.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-eval%2Fsimd%2Finsert_extract.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -2,14 +2,18 @@\n #![feature(const_fn)]\n #![feature(repr_simd)]\n #![feature(platform_intrinsics)]\n+#![feature(staged_api)]\n+#![stable(feature = \"foo\", since = \"1.33.7\")]\n #![allow(non_camel_case_types)]\n \n #[repr(simd)] struct i8x1(i8);\n #[repr(simd)] struct u16x2(u16, u16);\n #[repr(simd)] struct f32x3(f32, f32, f32);\n \n extern \"platform-intrinsic\" {\n+    #[rustc_const_stable(feature = \"foo\", since = \"1.3.37\")]\n     fn simd_insert<T, U>(x: T, idx: u32, val: U) -> T;\n+    #[rustc_const_stable(feature = \"foo\", since = \"1.3.37\")]\n     fn simd_extract<T, U>(x: T, idx: u32) -> U;\n }\n "}, {"sha": "72fac19c191739171f29d3e6fcd5c4380d8086d6", "filename": "src/test/ui/consts/const-fn-type-name.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1de2705c7985819e4d36975fe26aad1510521140/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-type-name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1de2705c7985819e4d36975fe26aad1510521140/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-type-name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-type-name.rs?ref=1de2705c7985819e4d36975fe26aad1510521140", "patch": "@@ -2,6 +2,7 @@\n \n #![feature(core_intrinsics)]\n #![feature(const_fn)]\n+#![feature(const_type_name)]\n #![allow(dead_code)]\n \n const fn type_name_wrapper<T>(_: &T) -> &'static str {"}]}