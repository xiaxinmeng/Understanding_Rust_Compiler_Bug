{"sha": "be967b94e15f238a6fe806e93359e302c43d0e45", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlOTY3Yjk0ZTE1ZjIzOGE2ZmU4MDZlOTMzNTllMzAyYzQzZDBlNDU=", "commit": {"author": {"name": "Michal Terepeta", "email": "michal.terepeta@gmail.com", "date": "2020-01-06T21:06:01Z"}, "committer": {"name": "Michal Terepeta", "email": "michal.terepeta@gmail.com", "date": "2020-01-06T21:21:56Z"}, "message": "Fix a problem with `Durability` of libraries\n\nWhen processing a change with added libraries, we used\n`Default::default` for `SourceRoot` which sets `is_library` to false.\nSince we use `is_library` to decide whether to use low or high\ndurability, I believe that this caused us to mark many library\ndependencies as having low durability and thus increased the size of the\ngraph that salsa needed to verify on every change.\n\nBased on my initial tests this speeds up the `CrateDefMapQuery` on\nrust-analyzer from about ~64ms to ~14ms and reduces the number of\nvalidations for the query from over 60k to about 7k.\n\nSigned-off-by: Michal Terepeta <michal.terepeta@gmail.com>", "tree": {"sha": "6a28cc8aa0172f54b0a0e659b9f45eca7aac7f91", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a28cc8aa0172f54b0a0e659b9f45eca7aac7f91"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be967b94e15f238a6fe806e93359e302c43d0e45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be967b94e15f238a6fe806e93359e302c43d0e45", "html_url": "https://github.com/rust-lang/rust/commit/be967b94e15f238a6fe806e93359e302c43d0e45", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be967b94e15f238a6fe806e93359e302c43d0e45/comments", "author": {"login": "michalt", "id": 119711, "node_id": "MDQ6VXNlcjExOTcxMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/119711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michalt", "html_url": "https://github.com/michalt", "followers_url": "https://api.github.com/users/michalt/followers", "following_url": "https://api.github.com/users/michalt/following{/other_user}", "gists_url": "https://api.github.com/users/michalt/gists{/gist_id}", "starred_url": "https://api.github.com/users/michalt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michalt/subscriptions", "organizations_url": "https://api.github.com/users/michalt/orgs", "repos_url": "https://api.github.com/users/michalt/repos", "events_url": "https://api.github.com/users/michalt/events{/privacy}", "received_events_url": "https://api.github.com/users/michalt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michalt", "id": 119711, "node_id": "MDQ6VXNlcjExOTcxMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/119711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michalt", "html_url": "https://github.com/michalt", "followers_url": "https://api.github.com/users/michalt/followers", "following_url": "https://api.github.com/users/michalt/following{/other_user}", "gists_url": "https://api.github.com/users/michalt/gists{/gist_id}", "starred_url": "https://api.github.com/users/michalt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michalt/subscriptions", "organizations_url": "https://api.github.com/users/michalt/orgs", "repos_url": "https://api.github.com/users/michalt/repos", "events_url": "https://api.github.com/users/michalt/events{/privacy}", "received_events_url": "https://api.github.com/users/michalt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07340a62cc1b34efcebfc9f4cfc42f655edd2fc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/07340a62cc1b34efcebfc9f4cfc42f655edd2fc8", "html_url": "https://github.com/rust-lang/rust/commit/07340a62cc1b34efcebfc9f4cfc42f655edd2fc8"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "8b197d642d0ab76a919631abc35e11aff1115f38", "filename": "crates/ra_ide/src/change.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/be967b94e15f238a6fe806e93359e302c43d0e45/crates%2Fra_ide%2Fsrc%2Fchange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be967b94e15f238a6fe806e93359e302c43d0e45/crates%2Fra_ide%2Fsrc%2Fchange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fchange.rs?ref=be967b94e15f238a6fe806e93359e302c43d0e45", "patch": "@@ -201,7 +201,7 @@ impl RootDatabase {\n                 libraries.push(library.root_id);\n                 self.set_source_root_with_durability(\n                     library.root_id,\n-                    Default::default(),\n+                    Arc::new(SourceRoot::new_library()),\n                     Durability::HIGH,\n                 );\n                 self.set_library_symbols_with_durability("}]}