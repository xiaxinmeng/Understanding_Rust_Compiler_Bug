{"sha": "a7d75463c7d1473e4276601688baa22c10eec255", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE3ZDc1NDYzYzdkMTQ3M2U0Mjc2NjAxNjg4YmFhMjJjMTBlZWMyNTU=", "commit": {"author": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-09-07T23:34:11Z"}, "committer": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-09-09T22:42:20Z"}, "message": "Fix the tests", "tree": {"sha": "868ecc92831effcda1c904f0526beb1e1fac9c34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/868ecc92831effcda1c904f0526beb1e1fac9c34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7d75463c7d1473e4276601688baa22c10eec255", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7d75463c7d1473e4276601688baa22c10eec255", "html_url": "https://github.com/rust-lang/rust/commit/a7d75463c7d1473e4276601688baa22c10eec255", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7d75463c7d1473e4276601688baa22c10eec255/comments", "author": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5aebf54fd4d075389ce2c74a460ea0c48ccdbad2", "url": "https://api.github.com/repos/rust-lang/rust/commits/5aebf54fd4d075389ce2c74a460ea0c48ccdbad2", "html_url": "https://github.com/rust-lang/rust/commit/5aebf54fd4d075389ce2c74a460ea0c48ccdbad2"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "f4a9864d10e7aab77d19c932c7c236b4a4be62f1", "filename": "crates/ide/src/completion/complete_attribute.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_attribute.rs?ref=a7d75463c7d1473e4276601688baa22c10eec255", "patch": "@@ -13,7 +13,7 @@ use crate::completion::{\n };\n \n pub(super) fn complete_attribute(acc: &mut Completions, ctx: &CompletionContext) -> Option<()> {\n-    if ctx.mod_under_caret.is_some() {\n+    if ctx.mod_declaration_under_caret.is_some() {\n         return None;\n     }\n "}, {"sha": "d457ff6bf43cd2413bde2e7c75a98e083dd93b5f", "filename": "crates/ide/src/completion/complete_mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_mod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_mod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_mod.rs?ref=a7d75463c7d1473e4276601688baa22c10eec255", "patch": "@@ -14,7 +14,7 @@ use super::{\n \n /// Complete mod declaration, i.e. `mod <|> ;`\n pub(super) fn complete_mod(acc: &mut Completions, ctx: &CompletionContext) -> Option<()> {\n-    let mod_under_caret = match &ctx.mod_under_caret {\n+    let mod_under_caret = match &ctx.mod_declaration_under_caret {\n         Some(mod_under_caret) if mod_under_caret.item_list().is_some() => return None,\n         Some(mod_under_caret) => mod_under_caret,\n         None => return None,"}, {"sha": "79de50792782d237d33afe90be5a24df1e8c2fe2", "filename": "crates/ide/src/completion/complete_qualified_path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_qualified_path.rs?ref=a7d75463c7d1473e4276601688baa22c10eec255", "patch": "@@ -13,7 +13,7 @@ pub(super) fn complete_qualified_path(acc: &mut Completions, ctx: &CompletionCon\n         None => return,\n     };\n \n-    if ctx.attribute_under_caret.is_some() || ctx.mod_under_caret.is_some() {\n+    if ctx.attribute_under_caret.is_some() || ctx.mod_declaration_under_caret.is_some() {\n         return;\n     }\n "}, {"sha": "8eda4b64d49aa94d141b2911ea8518ff4bddc490", "filename": "crates/ide/src/completion/complete_unqualified_path.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcomplete_unqualified_path.rs?ref=a7d75463c7d1473e4276601688baa22c10eec255", "patch": "@@ -13,7 +13,7 @@ pub(super) fn complete_unqualified_path(acc: &mut Completions, ctx: &CompletionC\n     if ctx.record_lit_syntax.is_some()\n         || ctx.record_pat_syntax.is_some()\n         || ctx.attribute_under_caret.is_some()\n-        || ctx.mod_under_caret.is_some()\n+        || ctx.mod_declaration_under_caret.is_some()\n     {\n         return;\n     }"}, {"sha": "161f59c1e48c5b6d7df563dad70b341f40410684", "filename": "crates/ide/src/completion/completion_context.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7d75463c7d1473e4276601688baa22c10eec255/crates%2Fide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fcompletion%2Fcompletion_context.rs?ref=a7d75463c7d1473e4276601688baa22c10eec255", "patch": "@@ -77,7 +77,7 @@ pub(crate) struct CompletionContext<'a> {\n     pub(super) is_path_type: bool,\n     pub(super) has_type_args: bool,\n     pub(super) attribute_under_caret: Option<ast::Attr>,\n-    pub(super) mod_under_caret: Option<ast::Module>,\n+    pub(super) mod_declaration_under_caret: Option<ast::Module>,\n     pub(super) unsafe_is_prev: bool,\n     pub(super) if_is_prev: bool,\n     pub(super) block_expr_parent: bool,\n@@ -153,7 +153,7 @@ impl<'a> CompletionContext<'a> {\n             has_type_args: false,\n             dot_receiver_is_ambiguous_float_literal: false,\n             attribute_under_caret: None,\n-            mod_under_caret: None,\n+            mod_declaration_under_caret: None,\n             unsafe_is_prev: false,\n             in_loop_body: false,\n             ref_pat_parent: false,\n@@ -241,7 +241,9 @@ impl<'a> CompletionContext<'a> {\n         self.is_match_arm = is_match_arm(syntax_element.clone());\n         self.has_item_list_or_source_file_parent =\n             has_item_list_or_source_file_parent(syntax_element.clone());\n-        self.mod_under_caret = find_node_at_offset(&file_with_fake_ident, offset);\n+        self.mod_declaration_under_caret =\n+            find_node_at_offset::<ast::Module>(&file_with_fake_ident, offset)\n+                .filter(|module| module.item_list().is_none());\n     }\n \n     fn fill("}]}