{"sha": "5b8504401c7590130eb01a34155b12c26881b0b1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViODUwNDQwMWM3NTkwMTMwZWIwMWEzNDE1NWIxMmMyNjg4MWIwYjE=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-01-22T23:45:34Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-01-22T23:45:34Z"}, "message": "Fasten even more theme switch", "tree": {"sha": "6e33e25c97061a22f2869e21f182105dcfe38355", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e33e25c97061a22f2869e21f182105dcfe38355"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b8504401c7590130eb01a34155b12c26881b0b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b8504401c7590130eb01a34155b12c26881b0b1", "html_url": "https://github.com/rust-lang/rust/commit/5b8504401c7590130eb01a34155b12c26881b0b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b8504401c7590130eb01a34155b12c26881b0b1/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5f93159e9ddc05f479ade72e604a0267b5413be7", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f93159e9ddc05f479ade72e604a0267b5413be7", "html_url": "https://github.com/rust-lang/rust/commit/5f93159e9ddc05f479ade72e604a0267b5413be7"}], "stats": {"total": 27, "additions": 15, "deletions": 12}, "files": [{"sha": "8395b0686e1b07f60f7b35841b13a63c74046e41", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=5b8504401c7590130eb01a34155b12c26881b0b1", "patch": "@@ -10,6 +10,7 @@\n \n use std::fmt;\n use std::io;\n+use std::path::PathBuf;\n \n use externalfiles::ExternalHtml;\n \n@@ -31,7 +32,7 @@ pub struct Page<'a> {\n \n pub fn render<T: fmt::Display, S: fmt::Display>(\n     dst: &mut io::Write, layout: &Layout, page: &Page, sidebar: &S, t: &T,\n-    css_file_extension: bool)\n+    css_file_extension: bool, themes: &[PathBuf])\n     -> io::Result<()>\n {\n     write!(dst,\n@@ -48,7 +49,9 @@ r##\"<!DOCTYPE html>\n \n     <link rel=\"stylesheet\" type=\"text/css\" href=\"{root_path}normalize.css\">\n     <link rel=\"stylesheet\" type=\"text/css\" href=\"{root_path}rustdoc.css\" id=\"mainThemeStyle\">\n-    <link rel=\"stylesheet\" type=\"text/css\" href=\"\" id=\"themeStyle\">\n+    {themes}\n+    <link rel=\"stylesheet\" type=\"text/css\" href=\"{root_path}dark.css\">\n+    <link rel=\"stylesheet\" type=\"text/css\" href=\"{root_path}main.css\" id=\"themeStyle\">\n     <script src=\"{root_path}storage.js\"></script>\n     {css_extension}\n \n@@ -182,6 +185,12 @@ r##\"<!DOCTYPE html>\n     after_content = layout.external_html.after_content,\n     sidebar   = *sidebar,\n     krate     = layout.krate,\n+    themes = themes.iter()\n+                   .filter_map(|t| t.file_stem())\n+                   .filter_map(|t| t.to_str())\n+                   .map(|t| format!(r#\"<link rel=\"stylesheet\" type=\"text/css\" href=\"{}{}\">\"#,\n+                                    page.root_path, t))\n+                   .collect::<String>(),\n     )\n }\n "}, {"sha": "4a56dbac50ec3001a74bfc78c49ce6c7395f9713", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=5b8504401c7590130eb01a34155b12c26881b0b1", "patch": "@@ -1224,7 +1224,8 @@ impl<'a> SourceCollector<'a> {\n         };\n         layout::render(&mut w, &self.scx.layout,\n                        &page, &(\"\"), &Source(contents),\n-                       self.scx.css_file_extension.is_some())?;\n+                       self.scx.css_file_extension.is_some(),\n+                       &self.scx.themes)?;\n         w.flush()?;\n         self.scx.local_sources.insert(p.clone(), href);\n         Ok(())\n@@ -1588,7 +1589,8 @@ impl Context {\n             layout::render(writer, &self.shared.layout, &page,\n                            &Sidebar{ cx: self, item: it },\n                            &Item{ cx: self, item: it },\n-                           self.shared.css_file_extension.is_some())?;\n+                           self.shared.css_file_extension.is_some(),\n+                           &self.shared.themes)?;\n         } else {\n             let mut url = self.root_path();\n             if let Some(&(ref names, ty)) = cache().paths.get(&it.def_id) {"}, {"sha": "0aa1065b3786a39c259789ebbb08da96d1cbadfc", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/5b8504401c7590130eb01a34155b12c26881b0b1/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=5b8504401c7590130eb01a34155b12c26881b0b1", "patch": "@@ -31,14 +31,6 @@ function getCurrentValue(name) {\n function switchTheme(styleElem, mainStyleElem, newTheme) {\n     styleElem.href = mainStyleElem.href.replace(\"rustdoc.css\", newTheme + \".css\");\n     updateLocalStorage('theme', newTheme);\n-    /*var elem = document.getElementsByTagName('body')[0];\n-    if (elem) {\n-        updateLocalStorage('background', getComputedStyle(elem)['background-color']);\n-    }*/\n }\n \n-/*var elem = document.getElementsByTagName('body')[0];\n-if (elem) {\n-    var value = \n-}*/\n switchTheme(currentTheme, mainTheme, getCurrentValue('theme') || 'main');"}]}