{"sha": "64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY0Yjc2ZGE0YjZhZTQ0MTg2ODdlNzM3YWIxYmM0YzFlOGM1ODQ4ZjE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-03-03T07:27:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-03T07:27:44Z"}, "message": "Rollup merge of #82695 - XAMPPRocky:remove-non-power-of-two-limit, r=nagisa\n\nRevert non-power-of-two vector restriction\n\nRemoves the power of two restriction from rustc. As discussed in https://github.com/rust-lang/stdsimd/issues/63\n\nr? ```@calebzulawski```\n\ncc ```@workingjubilee``` ```@thomcc```", "tree": {"sha": "47cdf0f153ec462f2717fb31bdf5a0cc52aae4ed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47cdf0f153ec462f2717fb31bdf5a0cc52aae4ed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgPzpwCRBK7hj4Ov3rIwAAdHIIAFLe3TviEmX78R8szupey9ki\nx/znFPUJwPhWO8gMrI7ZOuxhyQGzTOw/9YE2RRQqiTcAwBZvxFDGW0V/kJYqppuI\nRaAmi9fUawAQbP0LdapCMRQzHSI5E66SGpIsGWNC3uVk1NFI6KFUPsEE+eeyExsg\n0UUTXOAXFLEAbmU2DGS3g1HYUiLu/ao30lz8jQp1dwJEURNm/pjoy3dgIaVlw7E5\nwhsy+u9DlMPquF50epffK3BFUrzEbgyMCaHV1tJ0zpiRPpYaVMFID8LZ5M5BvjV3\nuvf9lHvevferXzwxLoTp0zW13lhNQ6Yu/1IdnfNLvovLB6SQ2LeYsX+NTz0e1oo=\n=1oql\n-----END PGP SIGNATURE-----\n", "payload": "tree 47cdf0f153ec462f2717fb31bdf5a0cc52aae4ed\nparent 9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690\nparent 5f344a28832101e9913e134cc8cf34ddaae9e894\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1614756464 +0900\ncommitter GitHub <noreply@github.com> 1614756464 +0900\n\nRollup merge of #82695 - XAMPPRocky:remove-non-power-of-two-limit, r=nagisa\n\nRevert non-power-of-two vector restriction\n\nRemoves the power of two restriction from rustc. As discussed in https://github.com/rust-lang/stdsimd/issues/63\n\nr? ```@calebzulawski```\n\ncc ```@workingjubilee``` ```@thomcc```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "html_url": "https://github.com/rust-lang/rust/commit/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690", "html_url": "https://github.com/rust-lang/rust/commit/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690"}, {"sha": "5f344a28832101e9913e134cc8cf34ddaae9e894", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f344a28832101e9913e134cc8cf34ddaae9e894", "html_url": "https://github.com/rust-lang/rust/commit/5f344a28832101e9913e134cc8cf34ddaae9e894"}], "stats": {"total": 63, "additions": 5, "deletions": 58}, "files": [{"sha": "6d2ab0e5f5a80ac8bdd5829b6aa0b392e866e963", "filename": "compiler/rustc_middle/src/ty/layout.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Flayout.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -732,11 +732,6 @@ impl<'tcx> LayoutCx<'tcx, TyCtxt<'tcx>> {\n                 // Can't be caught in typeck if the array length is generic.\n                 if e_len == 0 {\n                     tcx.sess.fatal(&format!(\"monomorphising SIMD type `{}` of zero length\", ty));\n-                } else if !e_len.is_power_of_two() {\n-                    tcx.sess.fatal(&format!(\n-                        \"monomorphising SIMD type `{}` of non-power-of-two length\",\n-                        ty\n-                    ));\n                 } else if e_len > MAX_SIMD_LANES {\n                     tcx.sess.fatal(&format!(\n                         \"monomorphising SIMD type `{}` of length greater than {}\","}, {"sha": "0010d59f710cdc0ec0c361636352044a7d60224d", "filename": "compiler/rustc_typeck/src/check/check.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcheck.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -1161,15 +1161,6 @@ pub fn check_simd(tcx: TyCtxt<'_>, sp: Span, def_id: LocalDefId) {\n                 if len == 0 {\n                     struct_span_err!(tcx.sess, sp, E0075, \"SIMD vector cannot be empty\").emit();\n                     return;\n-                } else if !len.is_power_of_two() {\n-                    struct_span_err!(\n-                        tcx.sess,\n-                        sp,\n-                        E0075,\n-                        \"SIMD vector length must be a power of two\"\n-                    )\n-                    .emit();\n-                    return;\n                 } else if len > MAX_SIMD_LANES {\n                     struct_span_err!(\n                         tcx.sess,"}, {"sha": "8d70dacdc90104a7aa180e2fd7cce7038e10e003", "filename": "src/test/ui/simd/issue-17170.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -1,8 +1,8 @@\n+// run-pass\n #![feature(repr_simd)]\n \n #[repr(simd)]\n struct T(f64, f64, f64);\n-//~^ ERROR SIMD vector length must be a power of two\n \n static X: T = T(0.0, 0.0, 0.0);\n "}, {"sha": "b35c3c4dc980d7ffcb076322f5b7b39f84b7f14b", "filename": "src/test/ui/simd/issue-17170.stderr", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fissue-17170.stderr?ref=9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690", "patch": "@@ -1,11 +0,0 @@\n-error[E0075]: SIMD vector length must be a power of two\n-  --> $DIR/issue-17170.rs:4:1\n-   |\n-LL | struct T(f64, f64, f64);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: monomorphising SIMD type `T` of non-power-of-two length\n-\n-error: aborting due to 2 previous errors\n-\n-For more information about this error, try `rustc --explain E0075`."}, {"sha": "8cf841f9371215a254302992dcdbd3984431fb0c", "filename": "src/test/ui/simd/issue-39720.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -1,16 +1,15 @@\n+// run-pass\n // ignore-emscripten FIXME(#45351)\n \n #![feature(repr_simd, platform_intrinsics)]\n \n #[repr(simd)]\n #[derive(Copy, Clone, Debug)]\n pub struct Char3(pub i8, pub i8, pub i8);\n-//~^ ERROR SIMD vector length must be a power of two\n \n #[repr(simd)]\n #[derive(Copy, Clone, Debug)]\n pub struct Short3(pub i16, pub i16, pub i16);\n-//~^ ERROR SIMD vector length must be a power of two\n \n extern \"platform-intrinsic\" {\n     fn simd_cast<T, U>(x: T) -> U;"}, {"sha": "355ceff00508aa0d44e692d41314f5390216162e", "filename": "src/test/ui/simd/issue-39720.stderr", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fissue-39720.stderr?ref=9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690", "patch": "@@ -1,15 +0,0 @@\n-error[E0075]: SIMD vector length must be a power of two\n-  --> $DIR/issue-39720.rs:7:1\n-   |\n-LL | pub struct Char3(pub i8, pub i8, pub i8);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error[E0075]: SIMD vector length must be a power of two\n-  --> $DIR/issue-39720.rs:12:1\n-   |\n-LL | pub struct Short3(pub i16, pub i16, pub i16);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 2 previous errors\n-\n-For more information about this error, try `rustc --explain E0075`."}, {"sha": "9b645d363e93250fc941eb8b446e312d99e6bde4", "filename": "src/test/ui/simd/simd-type-generic-monomorphisation-power-of-two.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -1,9 +1,7 @@\n-// build-fail\n+// run-pass\n \n #![feature(repr_simd, platform_intrinsics)]\n \n-// error-pattern:monomorphising SIMD type `Simd<3_usize>` of non-power-of-two length\n-\n #[repr(simd)]\n struct Simd<const N: usize>([f32; N]);\n "}, {"sha": "82cc0d8714aba77a2de487f1241506d6b62946b7", "filename": "src/test/ui/simd/simd-type-generic-monomorphisation-power-of-two.stderr", "status": "removed", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fsimd-type-generic-monomorphisation-power-of-two.stderr?ref=9b58b8b7f002c2ef8788f1bb85c53a33cb5cb690", "patch": "@@ -1,4 +0,0 @@\n-error: monomorphising SIMD type `Simd<3_usize>` of non-power-of-two length\n-\n-error: aborting due to previous error\n-"}, {"sha": "73d032a0c8e5542673fdaebc60627e4def4caf08", "filename": "src/test/ui/simd/simd-type.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.rs?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -10,7 +10,7 @@ struct empty; //~ ERROR SIMD vector cannot be empty\n struct empty2([f32; 0]); //~ ERROR SIMD vector cannot be empty\n \n #[repr(simd)]\n-struct pow2([f32; 7]); //~ ERROR SIMD vector length must be a power of two\n+struct pow2([f32; 7]);\n \n #[repr(simd)]\n struct i64f64(i64, f64); //~ ERROR SIMD vector should be homogeneous"}, {"sha": "823f10f5daf201af3e116facdefe6e4abcc18920", "filename": "src/test/ui/simd/simd-type.stderr", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/64b76da4b6ae4418687e737ab1bc4c1e8c5848f1/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd%2Fsimd-type.stderr?ref=64b76da4b6ae4418687e737ab1bc4c1e8c5848f1", "patch": "@@ -10,12 +10,6 @@ error[E0075]: SIMD vector cannot be empty\n LL | struct empty2([f32; 0]);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error[E0075]: SIMD vector length must be a power of two\n-  --> $DIR/simd-type.rs:13:1\n-   |\n-LL | struct pow2([f32; 7]);\n-   | ^^^^^^^^^^^^^^^^^^^^^^\n-\n error[E0076]: SIMD vector should be homogeneous\n   --> $DIR/simd-type.rs:16:1\n    |\n@@ -40,7 +34,7 @@ error[E0075]: SIMD vector cannot have more than 32768 elements\n LL | struct TooBig([f32; 65536]);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 7 previous errors\n+error: aborting due to 6 previous errors\n \n Some errors have detailed explanations: E0075, E0076, E0077.\n For more information about an error, try `rustc --explain E0075`."}]}