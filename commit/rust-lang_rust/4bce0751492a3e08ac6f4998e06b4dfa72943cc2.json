{"sha": "4bce0751492a3e08ac6f4998e06b4dfa72943cc2", "node_id": "C_kwDOAAsO6NoAKDRiY2UwNzUxNDkyYTNlMDhhYzZmNDk5OGUwNmI0ZGZhNzI5NDNjYzI", "commit": {"author": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2023-02-01T16:50:11Z"}, "committer": {"name": "Jakub Ber\u00e1nek", "email": "berykubik@gmail.com", "date": "2023-02-01T16:50:11Z"}, "message": "Dynamically align values in staged build timer table to avoid overflow", "tree": {"sha": "c87e61f8de14a239984831d0f1b39627300d80e3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c87e61f8de14a239984831d0f1b39627300d80e3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4bce0751492a3e08ac6f4998e06b4dfa72943cc2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEzFQynJm4WzBnfhz8kJzQ0mSDUWsFAmPamEMACgkQkJzQ0mSD\nUWtkpgv/aCmUtCmObTITsyQFXWazyF+Qdna4y8iFllMOwWKOHtc/3MQrpwntS/3/\nHA/RWhPVZFE9yDzFjVmq7jnRsIjpkgA03ZDCooAlPSYiBqWbO9Y2xdRAx2Hpa8yp\n7lXoMwgObCaMjXtxC1QojxR+3wOZVx5No8ZDYUpCXZp2wY/LIZBnk4jiYjmBo3vf\nzgH0Wpqj3QdQrKBZs84L1mHQWi3P7pPzHU94quyNEiS015wTmcLoAtTGtsMKrM0R\ncmK4AXcydmKX9qMve8wWtsIQB57wrlKVyPl8+PNEvDdp+YYC/vtONwqpRu/KeuN/\nEae7wC72/A7bNVJN24/HcSTBA9ngXm9LmeRDGesCX3ADRJ4Uu0L7+3yPBMvkg3Iy\nVyhggDaNy5Z3l6bVZPRiMkroujqSuWTmnMzoBnx5rqUk0ZJIyNc0wXk9oxQ/Wbu6\nxALKT6bHpqzG9DbfEEHEPdJeRzWf/vDmL+p0LZ8TsHE0dQU+UAQdMUwZbZQAPx5i\nigvcyejz\n=E8x5\n-----END PGP SIGNATURE-----", "payload": "tree c87e61f8de14a239984831d0f1b39627300d80e3\nparent 11d96b59307b1702fffe871bfc2d0145d070881e\nauthor Jakub Ber\u00e1nek <berykubik@gmail.com> 1675270211 +0100\ncommitter Jakub Ber\u00e1nek <berykubik@gmail.com> 1675270211 +0100\n\nDynamically align values in staged build timer table to avoid overflow\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4bce0751492a3e08ac6f4998e06b4dfa72943cc2", "html_url": "https://github.com/rust-lang/rust/commit/4bce0751492a3e08ac6f4998e06b4dfa72943cc2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4bce0751492a3e08ac6f4998e06b4dfa72943cc2/comments", "author": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11d96b59307b1702fffe871bfc2d0145d070881e", "url": "https://api.github.com/repos/rust-lang/rust/commits/11d96b59307b1702fffe871bfc2d0145d070881e", "html_url": "https://github.com/rust-lang/rust/commit/11d96b59307b1702fffe871bfc2d0145d070881e"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "7421ea3f65978677c37e34e5400219d7cb92d29d", "filename": "src/ci/stage-build.py", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/4bce0751492a3e08ac6f4998e06b4dfa72943cc2/src%2Fci%2Fstage-build.py", "raw_url": "https://github.com/rust-lang/rust/raw/4bce0751492a3e08ac6f4998e06b4dfa72943cc2/src%2Fci%2Fstage-build.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fstage-build.py?ref=4bce0751492a3e08ac6f4998e06b4dfa72943cc2", "patch": "@@ -234,18 +234,27 @@ def stage(self, name: str):\n     def print_stats(self):\n         total_duration = sum(self.stages.values())\n \n-        # 57 is the width of the whole table\n-        divider = \"-\" * 57\n+        total_duration_label = \"Total duration:\"\n+\n+        # 1 is for \":\", 2 is horizontal space\n+        max_label_length = max(16, max(\n+            len(label) for label in list(self.stages.keys()) + [total_duration_label[:-1]]\n+        )) + 1 + 2\n+\n+        table_width = max_label_length + 24\n+        divider = \"-\" * table_width\n \n         with StringIO() as output:\n             print(divider, file=output)\n             for (name, duration) in self.stages.items():\n                 pct = (duration / total_duration) * 100\n                 name_str = f\"{name}:\"\n-                print(f\"{name_str:<34} {duration:>12.2f}s ({pct:>5.2f}%)\", file=output)\n+                print(f\"{name_str:<{max_label_length}} {duration:>12.2f}s ({pct:>5.2f}%)\",\n+                      file=output)\n \n-            total_duration_label = \"Total duration:\"\n-            print(f\"{total_duration_label:<34} {total_duration:>12.2f}s\", file=output)\n+            print(file=output)\n+            print(f\"{total_duration_label:<{max_label_length}} {total_duration:>12.2f}s\",\n+                  file=output)\n             print(divider, file=output, end=\"\")\n             LOGGER.info(f\"Timer results\\n{output.getvalue()}\")\n "}]}