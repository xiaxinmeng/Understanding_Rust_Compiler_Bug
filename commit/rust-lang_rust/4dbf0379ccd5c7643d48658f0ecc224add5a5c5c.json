{"sha": "4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRkYmYwMzc5Y2NkNWM3NjQzZDQ4NjU4ZjBlY2MyMjRhZGQ1YTVjNWM=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-10-17T16:53:00Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-10-17T16:53:00Z"}, "message": "Merge #141\n\n141: Update rowan r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "aa44f39e0433087c2f862789ed739348f982efdb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa44f39e0433087c2f862789ed739348f982efdb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "html_url": "https://github.com/rust-lang/rust/commit/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "2a704035f4b36a0db737f59a7c939d17656b516f", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a704035f4b36a0db737f59a7c939d17656b516f", "html_url": "https://github.com/rust-lang/rust/commit/2a704035f4b36a0db737f59a7c939d17656b516f"}, {"sha": "00cdde2c5218020b8f6ec751042a436aeef923c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/00cdde2c5218020b8f6ec751042a436aeef923c7", "html_url": "https://github.com/rust-lang/rust/commit/00cdde2c5218020b8f6ec751042a436aeef923c7"}], "stats": {"total": 75, "additions": 26, "deletions": 49}, "files": [{"sha": "bb93b8b0e1c2f366e77ff5827bd3b6898f6cf355", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -484,7 +484,7 @@ dependencies = [\n  \"num-traits 0.2.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc-macro2 0.4.20 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -684,7 +684,7 @@ dependencies = [\n  \"drop_bomb 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.7.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"parking_lot 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"rowan 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"rowan 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"walkdir 2.2.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -804,7 +804,7 @@ dependencies = [\n \n [[package]]\n name = \"rowan\"\n-version = \"0.1.0\"\n+version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"parking_lot 0.6.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -898,7 +898,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.20 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"quote 0.6.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"syn 0.15.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"syn 0.15.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -973,7 +973,7 @@ dependencies = [\n \n [[package]]\n name = \"syn\"\n-version = \"0.15.11\"\n+version = \"0.15.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"proc-macro2 0.4.20 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1355,7 +1355,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum relative-path 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e614f96449605730b4f7ad2c019e88c1652d730634b4eba07b810801856635e3\"\n \"checksum remove_dir_all 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3488ba1b9a2084d38645c4c08276a1752dcbf2c7130d74f1569681ad5d2799c5\"\n \"checksum ron 0.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c48677d8a9247a4e0d1f3f9cb4b0a8e29167fdc3c04f383a5e669cd7a960ae0f\"\n-\"checksum rowan 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4a1a7366ece9deee5e7df8316a136d585d5c5042854c2297f7f1aee3014c9130\"\n+\"checksum rowan 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4bb1f952404091f61bfea7cd09c564090a0fcee3d22223f98084e8756e01c04d\"\n \"checksum rustc-demangle 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bcfe5b13211b4d78e5c2cadfebd7769197d95c639c35a50057eb4c05de811395\"\n \"checksum rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7540fc8b0c49f096ee9c961cda096467dce8084bec6bdca2fc83895fd9b28cb8\"\n \"checksum rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"138e3e0acb6c9fb258b19b67cb8abd63c00679d2851805ea151465464fe9030a\"\n@@ -1377,7 +1377,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum strsim 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb4f380125926a99e52bc279241539c018323fab05ad6368b56f93d9369ff550\"\n \"checksum superslice 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b50b13d42370e0f5fc62eafdd5c2d20065eaf5458dab215ff3e20e63eea96b30\"\n \"checksum syn 0.14.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"261ae9ecaa397c42b960649561949d69311f08eeaea86a65696e6e46517cf741\"\n-\"checksum syn 0.15.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b036b7b35e846707c0e55c2c9441fa47867c0f87fca416921db3261b1d8c741a\"\n+\"checksum syn 0.15.12 (registry+https://github.com/rust-lang/crates.io-index)\" = \"34ab9797e47d24cb76b8dc4d24ff36807018c7cc549c4cba050b068be0c586b0\"\n \"checksum synstructure 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"85bb9b7550d063ea184027c9b8c20ac167cd36d3e06b3a40bceb9d746dc1a7b7\"\n \"checksum tempdir 0.3.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"15f2b5fb00ccdf689e0149d1b1b3c03fead81c2b37735d812fa8bddbbf41b6d8\"\n \"checksum tera 0.11.18 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6c87cae42cc4fc480278c7583792cc5da2d51a25be916b7921cbb45c43063b8d\""}, {"sha": "c3c66680d58f64f90b6f7549966bd52114d3d00c", "filename": "crates/ra_editor/src/symbols.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_editor%2Fsrc%2Fsymbols.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_editor%2Fsrc%2Fsymbols.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Fsymbols.rs?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -3,10 +3,10 @@ use crate::TextRange;\n use ra_syntax::{\n     algo::{\n         visit::{visitor, Visitor},\n-        walk::{walk, WalkEvent},\n     },\n     ast::{self, NameOwner},\n     AstNode, File, SmolStr, SyntaxKind, SyntaxNodeRef,\n+    WalkEvent,\n };\n \n #[derive(Debug, Clone)]\n@@ -54,7 +54,7 @@ pub fn file_structure(file: &File) -> Vec<StructureNode> {\n     let mut res = Vec::new();\n     let mut stack = Vec::new();\n \n-    for event in walk(file.syntax()) {\n+    for event in file.syntax().preorder() {\n         match event {\n             WalkEvent::Enter(node) => match structure_node(node) {\n                 Some(mut symbol) => {\n@@ -64,7 +64,7 @@ pub fn file_structure(file: &File) -> Vec<StructureNode> {\n                 }\n                 None => (),\n             },\n-            WalkEvent::Exit(node) => {\n+            WalkEvent::Leave(node) => {\n                 if structure_node(node).is_some() {\n                     stack.pop().unwrap();\n                 }"}, {"sha": "7efebab8bde0637b51a3450b3442ccc339bab57d", "filename": "crates/ra_syntax/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2FCargo.toml?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -10,7 +10,7 @@ unicode-xid = \"0.1.0\"\n itertools = \"0.7.8\"\n drop_bomb = \"0.1.4\"\n parking_lot = \"0.6.0\"\n-rowan = \"0.1.0\"\n+rowan = \"0.1.1\"\n \n [dev-dependencies]\n test_utils = { path = \"../test_utils\" }"}, {"sha": "9d2014bc7c406111fed438fc2d8e9178b1db55fa", "filename": "crates/ra_syntax/src/algo/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Falgo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Falgo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Falgo%2Fmod.rs?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -1,5 +1,5 @@\n pub mod visit;\n-pub mod walk;\n+// pub mod walk;\n \n use crate::{\n     text_utils::{contains_offset_nonstrict, is_subrange},"}, {"sha": "9afa86401bf82e3394a0f7b11f245d77954e01ff", "filename": "crates/ra_syntax/src/algo/walk.rs", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/2a704035f4b36a0db737f59a7c939d17656b516f/crates%2Fra_syntax%2Fsrc%2Falgo%2Fwalk.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a704035f4b36a0db737f59a7c939d17656b516f/crates%2Fra_syntax%2Fsrc%2Falgo%2Fwalk.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Falgo%2Fwalk.rs?ref=2a704035f4b36a0db737f59a7c939d17656b516f", "patch": "@@ -1,28 +0,0 @@\n-use crate::{algo::generate, SyntaxNodeRef};\n-\n-#[derive(Debug, Copy, Clone)]\n-pub enum WalkEvent<'a> {\n-    Enter(SyntaxNodeRef<'a>),\n-    Exit(SyntaxNodeRef<'a>),\n-}\n-\n-pub fn walk<'a>(root: SyntaxNodeRef<'a>) -> impl Iterator<Item = WalkEvent<'a>> {\n-    generate(Some(WalkEvent::Enter(root)), move |pos| {\n-        let next = match *pos {\n-            WalkEvent::Enter(node) => match node.first_child() {\n-                Some(child) => WalkEvent::Enter(child),\n-                None => WalkEvent::Exit(node),\n-            },\n-            WalkEvent::Exit(node) => {\n-                if node == root {\n-                    return None;\n-                }\n-                match node.next_sibling() {\n-                    Some(sibling) => WalkEvent::Enter(sibling),\n-                    None => WalkEvent::Exit(node.parent().unwrap()),\n-                }\n-            }\n-        };\n-        Some(next)\n-    })\n-}"}, {"sha": "3698eccd7ad6479130ef12017618b0b75958fa7a", "filename": "crates/ra_syntax/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Flib.rs?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -52,7 +52,7 @@ pub use crate::{\n     reparsing::AtomEdit,\n     rowan::{SmolStr, TextRange, TextUnit},\n     syntax_kinds::SyntaxKind,\n-    yellow::{Direction, OwnedRoot, RefRoot, SyntaxError, SyntaxNode, SyntaxNodeRef, TreeRoot},\n+    yellow::{Direction, OwnedRoot, RefRoot, SyntaxError, SyntaxNode, SyntaxNodeRef, TreeRoot, WalkEvent},\n };\n \n use crate::yellow::GreenNode;"}, {"sha": "7d0ef2fa2730718ec5d6885ed99747e11f9f3b77", "filename": "crates/ra_syntax/src/utils.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Futils.rs?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -1,6 +1,5 @@\n use crate::{\n-    algo::walk::{walk, WalkEvent},\n-    File, SyntaxKind, SyntaxNodeRef,\n+    File, SyntaxKind, SyntaxNodeRef, WalkEvent\n };\n use std::fmt::Write;\n \n@@ -19,7 +18,7 @@ pub fn dump_tree(syntax: SyntaxNodeRef) -> String {\n         };\n     }\n \n-    for event in walk(syntax) {\n+    for event in syntax.preorder() {\n         match event {\n             WalkEvent::Enter(node) => {\n                 indent!();\n@@ -34,7 +33,7 @@ pub fn dump_tree(syntax: SyntaxNodeRef) -> String {\n                 }\n                 level += 1;\n             }\n-            WalkEvent::Exit(_) => level -= 1,\n+            WalkEvent::Leave(_) => level -= 1,\n         }\n     }\n "}, {"sha": "650917214236517b1dfa6da0be7fb8e5f26277f8", "filename": "crates/ra_syntax/src/yellow/mod.rs", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4dbf0379ccd5c7643d48658f0ecc224add5a5c5c/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fmod.rs?ref=4dbf0379ccd5c7643d48658f0ecc224add5a5c5c", "patch": "@@ -10,7 +10,7 @@ use std::{\n };\n \n pub(crate) use self::builder::GreenBuilder;\n-pub use rowan::TreeRoot;\n+pub use rowan::{TreeRoot, WalkEvent};\n \n #[derive(Debug, Clone, Copy)]\n pub enum RaTypes {}\n@@ -71,9 +71,9 @@ impl<'a> SyntaxNodeRef<'a> {\n         crate::algo::generate(Some(self), |&node| node.parent())\n     }\n     pub fn descendants(self) -> impl Iterator<Item = SyntaxNodeRef<'a>> {\n-        crate::algo::walk::walk(self).filter_map(|event| match event {\n-            crate::algo::walk::WalkEvent::Enter(node) => Some(node),\n-            crate::algo::walk::WalkEvent::Exit(_) => None,\n+        self.preorder().filter_map(|event| match event {\n+            WalkEvent::Enter(node) => Some(node),\n+            WalkEvent::Leave(_) => None,\n         })\n     }\n     pub fn siblings(self, direction: Direction) -> impl Iterator<Item = SyntaxNodeRef<'a>> {\n@@ -82,6 +82,12 @@ impl<'a> SyntaxNodeRef<'a> {\n             Direction::Prev => node.prev_sibling(),\n         })\n     }\n+    pub fn preorder(self) -> impl Iterator<Item = WalkEvent<SyntaxNodeRef<'a>>> {\n+        self.0.preorder().map(|event| match event {\n+            WalkEvent::Enter(n) => WalkEvent::Enter(SyntaxNode(n)),\n+            WalkEvent::Leave(n) => WalkEvent::Leave(SyntaxNode(n)),\n+        })\n+    }\n }\n \n impl<R: TreeRoot<RaTypes>> SyntaxNode<R> {"}]}