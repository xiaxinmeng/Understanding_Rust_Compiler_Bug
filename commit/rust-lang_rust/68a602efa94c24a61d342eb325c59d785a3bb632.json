{"sha": "68a602efa94c24a61d342eb325c59d785a3bb632", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4YTYwMmVmYTk0YzI0YTYxZDM0MmViMzI1YzU5ZDc4NWEzYmI2MzI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-03-15T17:49:41Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-03-15T17:49:41Z"}, "message": "Rollup merge of #48892 - alexcrichton:thinlto-again, r=Mark-Simulacrum\n\nrustbuild: Remove ThinLTO-related configuration\n\nThis commit removes some ThinLTO/codegen unit cruft primarily only needed during\nthe initial phase where we were adding ThinLTO support to rustc itself. The\ncurrent bootstrap compiler knows about ThinLTO and has it enabled by default for\nmulti-CGU builds which are also enabled by default. One CGU builds (aka\ndisabling ThinLTO) can be achieved by configuring the number of codegen units to\n1 for a particular builds.\n\nThis also changes the defaults for our dist builders to go back to multiple\nCGUs. Unfortunately we're seriously bleeding for cycle time on the bots right\nnow so we need to recover any time we can.", "tree": {"sha": "88594db26296f54ec54ad5328ef076c24d343558", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88594db26296f54ec54ad5328ef076c24d343558"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68a602efa94c24a61d342eb325c59d785a3bb632", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaqrI1CRBK7hj4Ov3rIwAAdHIIAIjbX/pdW7vFLNt5FJcmIAAT\nevsB3vrRe+cEwypz5aJ61LvAGb85yhw12ilAbmM1+2/AuZ6CE0jR54EJEpTgTua7\nq/blONqPvsNFaFyw2B29mWOZYbagINrRRscr3pS9aXWQ2BJqUhQR0a6qXymbcFV4\nmwLH0u4DCU+bAxT35kFUCK+F1MNSES3P1AuSEBtu/9Z0U8Dlm8gudtpxvFDqoZIT\ncHkN6zjNdfb9KMW57EC9dSRJFop+GmXp4zhPG+jkORKOl1lWw48fbI58QXsk2zRp\nD7wGAnC8Gx94A44CLiiO2z4ykAR1cRvoamyfcwnqy+AEifURC8LAo0P150f28R0=\n=Ibgi\n-----END PGP SIGNATURE-----\n", "payload": "tree 88594db26296f54ec54ad5328ef076c24d343558\nparent da888272673e14778235a72976e418c1ba7f3f27\nparent ff227c4a2d8a2fad5abf322f6f1391ae6779197f\nauthor kennytm <kennytm@gmail.com> 1521136181 +0800\ncommitter GitHub <noreply@github.com> 1521136181 +0800\n\nRollup merge of #48892 - alexcrichton:thinlto-again, r=Mark-Simulacrum\n\nrustbuild: Remove ThinLTO-related configuration\n\nThis commit removes some ThinLTO/codegen unit cruft primarily only needed during\nthe initial phase where we were adding ThinLTO support to rustc itself. The\ncurrent bootstrap compiler knows about ThinLTO and has it enabled by default for\nmulti-CGU builds which are also enabled by default. One CGU builds (aka\ndisabling ThinLTO) can be achieved by configuring the number of codegen units to\n1 for a particular builds.\n\nThis also changes the defaults for our dist builders to go back to multiple\nCGUs. Unfortunately we're seriously bleeding for cycle time on the bots right\nnow so we need to recover any time we can.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68a602efa94c24a61d342eb325c59d785a3bb632", "html_url": "https://github.com/rust-lang/rust/commit/68a602efa94c24a61d342eb325c59d785a3bb632", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68a602efa94c24a61d342eb325c59d785a3bb632/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da888272673e14778235a72976e418c1ba7f3f27", "url": "https://api.github.com/repos/rust-lang/rust/commits/da888272673e14778235a72976e418c1ba7f3f27", "html_url": "https://github.com/rust-lang/rust/commit/da888272673e14778235a72976e418c1ba7f3f27"}, {"sha": "ff227c4a2d8a2fad5abf322f6f1391ae6779197f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff227c4a2d8a2fad5abf322f6f1391ae6779197f", "html_url": "https://github.com/rust-lang/rust/commit/ff227c4a2d8a2fad5abf322f6f1391ae6779197f"}], "stats": {"total": 21, "additions": 0, "deletions": 21}, "files": [{"sha": "4be16475590f4fdf946019953785b881a141e607", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=68a602efa94c24a61d342eb325c59d785a3bb632", "patch": "@@ -175,9 +175,6 @@ fn main() {\n         if let Ok(s) = env::var(\"RUSTC_CODEGEN_UNITS\") {\n             cmd.arg(\"-C\").arg(format!(\"codegen-units={}\", s));\n         }\n-        if env::var(\"RUSTC_THINLTO\").is_ok() {\n-            cmd.arg(\"-Ccodegen-units=16\").arg(\"-Zthinlto\");\n-        }\n \n         // Emit save-analysis info.\n         if env::var(\"RUSTC_SAVE_ANALYSIS\") == Ok(\"api\".to_string()) {"}, {"sha": "fab7a2b3fcc5c01993d26d20462fa786090416ba", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=68a602efa94c24a61d342eb325c59d785a3bb632", "patch": "@@ -778,17 +778,6 @@ impl<'a> Builder<'a> {\n             if cmd != \"bench\" {\n                 cargo.arg(\"--release\");\n             }\n-\n-            if self.config.rust_codegen_units.is_none() &&\n-               self.build.is_rust_llvm(compiler.host) &&\n-               self.config.rust_thinlto {\n-                cargo.env(\"RUSTC_THINLTO\", \"1\");\n-            } else if self.config.rust_codegen_units.is_none() {\n-                // Generally, if ThinLTO has been disabled for some reason, we\n-                // want to set the codegen units to 1. However, we shouldn't do\n-                // this if the option was specifically set by the user.\n-                cargo.env(\"RUSTC_CODEGEN_UNITS\", \"1\");\n-            }\n         }\n \n         if self.config.locked_deps {"}, {"sha": "920a8ffc2fc860e1981fe053d451cb07f3c9f2dc", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=68a602efa94c24a61d342eb325c59d785a3bb632", "patch": "@@ -86,7 +86,6 @@ pub struct Config {\n     // rust codegen options\n     pub rust_optimize: bool,\n     pub rust_codegen_units: Option<u32>,\n-    pub rust_thinlto: bool,\n     pub rust_debug_assertions: bool,\n     pub rust_debuginfo: bool,\n     pub rust_debuginfo_lines: bool,\n@@ -270,7 +269,6 @@ impl Default for StringOrBool {\n struct Rust {\n     optimize: Option<bool>,\n     codegen_units: Option<u32>,\n-    thinlto: Option<bool>,\n     debug_assertions: Option<bool>,\n     debuginfo: Option<bool>,\n     debuginfo_lines: Option<bool>,\n@@ -429,7 +427,6 @@ impl Config {\n \n         // Store off these values as options because if they're not provided\n         // we'll infer default values for them later\n-        let mut thinlto = None;\n         let mut llvm_assertions = None;\n         let mut debuginfo_lines = None;\n         let mut debuginfo_only_std = None;\n@@ -473,7 +470,6 @@ impl Config {\n             optimize = rust.optimize;\n             ignore_git = rust.ignore_git;\n             debug_jemalloc = rust.debug_jemalloc;\n-            thinlto = rust.thinlto;\n             set(&mut config.rust_optimize_tests, rust.optimize_tests);\n             set(&mut config.rust_debuginfo_tests, rust.debuginfo_tests);\n             set(&mut config.codegen_tests, rust.codegen_tests);\n@@ -561,7 +557,6 @@ impl Config {\n             \"stable\" | \"beta\" | \"nightly\" => true,\n             _ => false,\n         };\n-        config.rust_thinlto = thinlto.unwrap_or(true);\n         config.rust_debuginfo_lines = debuginfo_lines.unwrap_or(default);\n         config.rust_debuginfo_only_std = debuginfo_only_std.unwrap_or(default);\n "}, {"sha": "97da7cae07f7c6e9aa99810121584496f5484791", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=68a602efa94c24a61d342eb325c59d785a3bb632", "patch": "@@ -71,7 +71,6 @@ def v(*args):\n # Optimization and debugging options. These may be overridden by the release\n # channel, etc.\n o(\"optimize\", \"rust.optimize\", \"build optimized rust code\")\n-o(\"thinlto\", \"rust.thinlto\", \"build Rust with ThinLTO enabled\")\n o(\"optimize-llvm\", \"llvm.optimize\", \"build optimized LLVM\")\n o(\"llvm-assertions\", \"llvm.assertions\", \"build LLVM with assertions\")\n o(\"debug-assertions\", \"rust.debug-assertions\", \"build with debugging assertions\")"}, {"sha": "e3f38e4834a92dcf86643532ed9df5930b66fa87", "filename": "src/ci/run.sh", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/68a602efa94c24a61d342eb325c59d785a3bb632/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=68a602efa94c24a61d342eb325c59d785a3bb632", "patch": "@@ -46,7 +46,6 @@ export RUST_RELEASE_CHANNEL=nightly\n if [ \"$DEPLOY$DEPLOY_ALT\" != \"\" ]; then\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-llvm-static-stdcpp\"\n-  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-thinlto\"\n \n   if [ \"$NO_LLVM_ASSERTIONS\" = \"1\" ]; then\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-llvm-assertions\""}]}