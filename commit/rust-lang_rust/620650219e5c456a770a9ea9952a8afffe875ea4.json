{"sha": "620650219e5c456a770a9ea9952a8afffe875ea4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyMDY1MDIxOWU1YzQ1NmE3NzBhOWVhOTk1MmE4YWZmZmU4NzVlYTQ=", "commit": {"author": {"name": "Pavel Sountsov", "email": "siege@google.com", "date": "2015-09-19T06:57:27Z"}, "committer": {"name": "SiegeLord", "email": "slabode@aim.com", "date": "2015-09-19T17:36:46Z"}, "message": "Use the block_indent inside visit_expr.\n\nThis seems to pass all the tests and greatly improves the formatting output\nwhen using hard tabs.", "tree": {"sha": "4dae6997e7d18bd5a461273630bfac2dbeff7bd8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4dae6997e7d18bd5a461273630bfac2dbeff7bd8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/620650219e5c456a770a9ea9952a8afffe875ea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/620650219e5c456a770a9ea9952a8afffe875ea4", "html_url": "https://github.com/rust-lang/rust/commit/620650219e5c456a770a9ea9952a8afffe875ea4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/620650219e5c456a770a9ea9952a8afffe875ea4/comments", "author": {"login": "SiegeLordEx", "id": 43966695, "node_id": "MDQ6VXNlcjQzOTY2Njk1", "avatar_url": "https://avatars.githubusercontent.com/u/43966695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SiegeLordEx", "html_url": "https://github.com/SiegeLordEx", "followers_url": "https://api.github.com/users/SiegeLordEx/followers", "following_url": "https://api.github.com/users/SiegeLordEx/following{/other_user}", "gists_url": "https://api.github.com/users/SiegeLordEx/gists{/gist_id}", "starred_url": "https://api.github.com/users/SiegeLordEx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SiegeLordEx/subscriptions", "organizations_url": "https://api.github.com/users/SiegeLordEx/orgs", "repos_url": "https://api.github.com/users/SiegeLordEx/repos", "events_url": "https://api.github.com/users/SiegeLordEx/events{/privacy}", "received_events_url": "https://api.github.com/users/SiegeLordEx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SiegeLord", "id": 480550, "node_id": "MDQ6VXNlcjQ4MDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/480550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SiegeLord", "html_url": "https://github.com/SiegeLord", "followers_url": "https://api.github.com/users/SiegeLord/followers", "following_url": "https://api.github.com/users/SiegeLord/following{/other_user}", "gists_url": "https://api.github.com/users/SiegeLord/gists{/gist_id}", "starred_url": "https://api.github.com/users/SiegeLord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SiegeLord/subscriptions", "organizations_url": "https://api.github.com/users/SiegeLord/orgs", "repos_url": "https://api.github.com/users/SiegeLord/repos", "events_url": "https://api.github.com/users/SiegeLord/events{/privacy}", "received_events_url": "https://api.github.com/users/SiegeLord/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03e1b2782616cbc8f06ba4e484b1540ae23e32be", "url": "https://api.github.com/repos/rust-lang/rust/commits/03e1b2782616cbc8f06ba4e484b1540ae23e32be", "html_url": "https://github.com/rust-lang/rust/commit/03e1b2782616cbc8f06ba4e484b1540ae23e32be"}], "stats": {"total": 7, "additions": 2, "deletions": 5}, "files": [{"sha": "7c56bf675c71f3d659925edfe4019ce0828283db", "filename": "src/visitor.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/620650219e5c456a770a9ea9952a8afffe875ea4/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/620650219e5c456a770a9ea9952a8afffe875ea4/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=620650219e5c456a770a9ea9952a8afffe875ea4", "patch": "@@ -39,12 +39,9 @@ impl<'a, 'v> visit::Visitor<'v> for FmtVisitor<'a> {\n                self.codemap.lookup_char_pos(ex.span.hi));\n         self.format_missing(ex.span.lo);\n \n-        let offset = self.buffer.cur_offset();\n-        // FIXME: We put the entire offset into the block_indent, which might not be correct in all\n-        // situations.\n         let rewrite = ex.rewrite(&self.get_context(),\n-                                 self.config.max_width - offset,\n-                                 Indent::new(offset, 0));\n+                                 self.config.max_width - self.block_indent.width(),\n+                                 self.block_indent);\n \n         if let Some(new_str) = rewrite {\n             self.buffer.push_str(&new_str);"}]}