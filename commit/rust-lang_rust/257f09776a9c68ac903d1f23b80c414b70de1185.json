{"sha": "257f09776a9c68ac903d1f23b80c414b70de1185", "node_id": "C_kwDOAAsO6NoAKDI1N2YwOTc3NmE5YzY4YWM5MDNkMWYyM2I4MGM0MTRiNzBkZTExODU", "commit": {"author": {"name": "Evan Typanski", "email": "evan.typanski@microfocus.com", "date": "2022-05-24T18:09:56Z"}, "committer": {"name": "Evan Typanski", "email": "evan.typanski@microfocus.com", "date": "2022-05-24T18:57:49Z"}, "message": "Fix issue with mismatched parens in suggestion", "tree": {"sha": "6ad32bc8d5d1c1696f0070df9d0e18f8b572478c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ad32bc8d5d1c1696f0070df9d0e18f8b572478c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/257f09776a9c68ac903d1f23b80c414b70de1185", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/257f09776a9c68ac903d1f23b80c414b70de1185", "html_url": "https://github.com/rust-lang/rust/commit/257f09776a9c68ac903d1f23b80c414b70de1185", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/257f09776a9c68ac903d1f23b80c414b70de1185/comments", "author": null, "committer": null, "parents": [{"sha": "78f7e3745fe59db1e6309b1e42ea25df3317ee36", "url": "https://api.github.com/repos/rust-lang/rust/commits/78f7e3745fe59db1e6309b1e42ea25df3317ee36", "html_url": "https://github.com/rust-lang/rust/commit/78f7e3745fe59db1e6309b1e42ea25df3317ee36"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "584b561dcf0ba7406e650368dd35a8920558dd11", "filename": "clippy_lints/src/ranges.rs", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/257f09776a9c68ac903d1f23b80c414b70de1185/clippy_lints%2Fsrc%2Franges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/257f09776a9c68ac903d1f23b80c414b70de1185/clippy_lints%2Fsrc%2Franges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Franges.rs?ref=257f09776a9c68ac903d1f23b80c414b70de1185", "patch": "@@ -296,10 +296,15 @@ fn check_possible_range_contains(\n     }\n \n     // If the LHS is the same operator, we have to recurse to get the \"real\" RHS, since they have\n-    // the same operator precedence.\n-    if let ExprKind::Binary(ref lhs_op, _left, new_lhs) = left.kind {\n-        if op == lhs_op.node {\n-            let new_span = Span::new(new_lhs.span.lo(), right.span.hi(), expr.span.ctxt(), expr.span.parent());\n+    // the same operator precedence\n+    if_chain! {\n+        if let ExprKind::Binary(ref lhs_op, _left, new_lhs) = left.kind;\n+        if op == lhs_op.node;\n+        let new_span = Span::new(new_lhs.span.lo(), right.span.hi(), expr.span.ctxt(), expr.span.parent());\n+        if let Some(snip) = &snippet_opt(cx, new_span);\n+        // Do not continue if we have mismatched number of parens, otherwise the suggestion is wrong\n+        if snip.matches('(').count() == snip.matches(')').count();\n+        then {\n             check_possible_range_contains(cx, op, new_lhs, right, expr, new_span);\n         }\n     }"}, {"sha": "85d021b2f25e2094435df55fc9e40bcaa39caa34", "filename": "tests/ui/range_contains.fixed", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/257f09776a9c68ac903d1f23b80c414b70de1185/tests%2Fui%2Frange_contains.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/257f09776a9c68ac903d1f23b80c414b70de1185/tests%2Fui%2Frange_contains.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frange_contains.fixed?ref=257f09776a9c68ac903d1f23b80c414b70de1185", "patch": "@@ -54,6 +54,8 @@ fn main() {\n     let z = 42;\n     (0..=10).contains(&x) && (0..=10).contains(&z);\n     !(0..10).contains(&x) || !(0..10).contains(&z);\n+    // Make sure operators in parens don't give a breaking suggestion\n+    ((x % 2 == 0) || (x < 0)) || (x >= 10);\n }\n \n // Fix #6373"}, {"sha": "9a7a75dc13254ed2883943eabbd0c350fd991b6a", "filename": "tests/ui/range_contains.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/257f09776a9c68ac903d1f23b80c414b70de1185/tests%2Fui%2Frange_contains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/257f09776a9c68ac903d1f23b80c414b70de1185/tests%2Fui%2Frange_contains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frange_contains.rs?ref=257f09776a9c68ac903d1f23b80c414b70de1185", "patch": "@@ -54,6 +54,8 @@ fn main() {\n     let z = 42;\n     (x >= 0) && (x <= 10) && (z >= 0) && (z <= 10);\n     (x < 0) || (x >= 10) || (z < 0) || (z >= 10);\n+    // Make sure operators in parens don't give a breaking suggestion\n+    ((x % 2 == 0) || (x < 0)) || (x >= 10);\n }\n \n // Fix #6373"}]}