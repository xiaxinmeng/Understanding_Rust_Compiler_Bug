{"sha": "82a1d79dffd5e6ba86271046f795a4235d734845", "node_id": "C_kwDOAAsO6NoAKDgyYTFkNzlkZmZkNWU2YmE4NjI3MTA0NmY3OTVhNDIzNWQ3MzQ4NDU", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-06-08T11:43:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-08T11:43:19Z"}, "message": "Rollup merge of #97846 - pcwalton:align-bits, r=michaelwoerister\n\nSpecify DWARF alignment in bits, not bytes.\n\nIn DWARF, alignment of types is specified in bits, as is made clear by the\nparameter name `AlignInBits`. However, `rustc` was incorrectly passing a byte\nalignment. This commit fixes that.\n\nThis was noticed in upstream LLVM when I tried to check in a test consisting of\nLLVM IR generated from `rustc` and it triggered assertions [1].\n\n[1]: https://reviews.llvm.org/D126835", "tree": {"sha": "a505e884701454c9f93bf5165b8edae21e4140d3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a505e884701454c9f93bf5165b8edae21e4140d3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/82a1d79dffd5e6ba86271046f795a4235d734845", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJioItXCRBK7hj4Ov3rIwAAr44IAIPPFIPggawXbnCpbJ04FnXh\nnPNVvAdMF+XQ+W7AjjnpnZ0uLG0J44NF0Doku9upoN1sAP6oJlxt7W6W2iNB4XiU\nRT+YV8NaeFRZzvOYBlOCmhi7oPJZe4bg9UPY75VboYfdsDgYkDAJ/XdcItXBIbMW\nJHn2jnLPAzX13vIfCti4xi0UbEUmrx46S5GcmwvTOvYwiGujC3rC+C1lKhK1SiA6\n6VynYAE8VdrHZaKuy+QAIJN/bYmUIh/Qb5xDzjxFAlp1x9TMGVBN+bXkmMzXms6t\nuvqr0lDxF4lgIS2aFtRE8I39wuqimlKCTobbBPEberUmjdczOLm7kemdEiV+Tn4=\n=Wzux\n-----END PGP SIGNATURE-----\n", "payload": "tree a505e884701454c9f93bf5165b8edae21e4140d3\nparent 29c6f5f60322663349f0a167fedc7240f498dd7b\nparent fe533e862cd2d2d65e14970d327365dfe593aa27\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1654688599 +0200\ncommitter GitHub <noreply@github.com> 1654688599 +0200\n\nRollup merge of #97846 - pcwalton:align-bits, r=michaelwoerister\n\nSpecify DWARF alignment in bits, not bytes.\n\nIn DWARF, alignment of types is specified in bits, as is made clear by the\nparameter name `AlignInBits`. However, `rustc` was incorrectly passing a byte\nalignment. This commit fixes that.\n\nThis was noticed in upstream LLVM when I tried to check in a test consisting of\nLLVM IR generated from `rustc` and it triggered assertions [1].\n\n[1]: https://reviews.llvm.org/D126835\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/82a1d79dffd5e6ba86271046f795a4235d734845", "html_url": "https://github.com/rust-lang/rust/commit/82a1d79dffd5e6ba86271046f795a4235d734845", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/82a1d79dffd5e6ba86271046f795a4235d734845/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29c6f5f60322663349f0a167fedc7240f498dd7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/29c6f5f60322663349f0a167fedc7240f498dd7b", "html_url": "https://github.com/rust-lang/rust/commit/29c6f5f60322663349f0a167fedc7240f498dd7b"}, {"sha": "fe533e862cd2d2d65e14970d327365dfe593aa27", "url": "https://api.github.com/repos/rust-lang/rust/commits/fe533e862cd2d2d65e14970d327365dfe593aa27", "html_url": "https://github.com/rust-lang/rust/commit/fe533e862cd2d2d65e14970d327365dfe593aa27"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "f5cbbc7ca919872c8bf160df1c25592eda96d742", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82a1d79dffd5e6ba86271046f795a4235d734845/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82a1d79dffd5e6ba86271046f795a4235d734845/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=82a1d79dffd5e6ba86271046f795a4235d734845", "patch": "@@ -1365,7 +1365,7 @@ pub fn build_global_var_di_node<'ll>(cx: &CodegenCx<'ll, '_>, def_id: DefId, glo\n             is_local_to_unit,\n             global,\n             None,\n-            global_align.bytes() as u32,\n+            global_align.bits() as u32,\n         );\n     }\n }"}, {"sha": "f6c1062e0fc6cee420a54df67690129bf5efb884", "filename": "src/test/codegen/debug-alignment.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/82a1d79dffd5e6ba86271046f795a4235d734845/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82a1d79dffd5e6ba86271046f795a4235d734845/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fdebug-alignment.rs?ref=82a1d79dffd5e6ba86271046f795a4235d734845", "patch": "@@ -0,0 +1,8 @@\n+// Verifies that DWARF alignment is specified properly.\n+//\n+// compile-flags: -C debuginfo=2\n+#![crate_type = \"lib\"]\n+\n+// CHECK: !DIGlobalVariable\n+// CHECK: align: 32\n+pub static A: u32 = 1;"}]}