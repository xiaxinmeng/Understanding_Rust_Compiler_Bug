{"sha": "36018a4d062fe30f0817685cab7b7ee2f2a367a8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2MDE4YTRkMDYyZmUzMGYwODE3Njg1Y2FiN2I3ZWUyZjJhMzY3YTg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-25T14:08:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-25T14:08:47Z"}, "message": "Auto merge of #79400 - camelid:rustdoc-summary_opts, r=GuillaumeGomez\n\nAdd `summary_opts()` for Markdown summary rendering options\n\nWe have a similar function `opts()` that is for rendering the main body\nof the documentation, but until now we just constructed the options for\nrendering summaries on the fly. This is a problem if/when we change the\nenabled options since the different places can get out-of-sync.", "tree": {"sha": "d414d9598631868d1a55e00d7e01384250f2a342", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d414d9598631868d1a55e00d7e01384250f2a342"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/36018a4d062fe30f0817685cab7b7ee2f2a367a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/36018a4d062fe30f0817685cab7b7ee2f2a367a8", "html_url": "https://github.com/rust-lang/rust/commit/36018a4d062fe30f0817685cab7b7ee2f2a367a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/36018a4d062fe30f0817685cab7b7ee2f2a367a8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "20dcbf0df013c1d2568350c5bde32a6f12928ecf", "url": "https://api.github.com/repos/rust-lang/rust/commits/20dcbf0df013c1d2568350c5bde32a6f12928ecf", "html_url": "https://github.com/rust-lang/rust/commit/20dcbf0df013c1d2568350c5bde32a6f12928ecf"}, {"sha": "50c2739bb4f5692134a152990d9ea96127c47e90", "url": "https://api.github.com/repos/rust-lang/rust/commits/50c2739bb4f5692134a152990d9ea96127c47e90", "html_url": "https://github.com/rust-lang/rust/commit/50c2739bb4f5692134a152990d9ea96127c47e90"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8ce686c65502f5b549e97603c4338a316a272267", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/36018a4d062fe30f0817685cab7b7ee2f2a367a8/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/36018a4d062fe30f0817685cab7b7ee2f2a367a8/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=36018a4d062fe30f0817685cab7b7ee2f2a367a8", "patch": "@@ -43,10 +43,16 @@ use pulldown_cmark::{html, BrokenLink, CodeBlockKind, CowStr, Event, Options, Pa\n #[cfg(test)]\n mod tests;\n \n+/// Options for rendering Markdown in the main body of documentation.\n pub(crate) fn opts() -> Options {\n     Options::ENABLE_TABLES | Options::ENABLE_FOOTNOTES | Options::ENABLE_STRIKETHROUGH\n }\n \n+/// A subset of [`opts()`] used for rendering summaries.\n+pub(crate) fn summary_opts() -> Options {\n+    Options::ENABLE_STRIKETHROUGH\n+}\n+\n /// When `to_string` is called, this struct will emit the HTML corresponding to\n /// the rendered version of the contained markdown string.\n pub struct Markdown<'a>(\n@@ -1021,11 +1027,7 @@ impl MarkdownSummaryLine<'_> {\n             }\n         };\n \n-        let p = Parser::new_with_broken_link_callback(\n-            md,\n-            Options::ENABLE_STRIKETHROUGH,\n-            Some(&mut replacer),\n-        );\n+        let p = Parser::new_with_broken_link_callback(md, summary_opts(), Some(&mut replacer));\n \n         let mut s = String::new();\n \n@@ -1047,7 +1049,7 @@ crate fn plain_text_summary(md: &str) -> String {\n \n     let mut s = String::with_capacity(md.len() * 3 / 2);\n \n-    for event in Parser::new_ext(md, Options::ENABLE_STRIKETHROUGH) {\n+    for event in Parser::new_ext(md, summary_opts()) {\n         match &event {\n             Event::Text(text) => s.push_str(text),\n             Event::Code(code) => {"}]}