{"sha": "acce384c22f123211af5d3dd9839ee87fe0b7904", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjY2UzODRjMjJmMTIzMjExYWY1ZDNkZDk4MzllZTg3ZmUwYjc5MDQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-12T13:20:56Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-12T13:20:56Z"}, "message": "Auto merge of #37554 - mikhail-m1:dnlle, r=jonathandturner\n\nImprove \"Doesn't live long enough\" error\n\ncase with temporary variable\n\nissue #36279 part of #35233\n\nr? @jonathandturner", "tree": {"sha": "87803d841e3a41eeb31bec10008c39366db409d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87803d841e3a41eeb31bec10008c39366db409d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/acce384c22f123211af5d3dd9839ee87fe0b7904", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/acce384c22f123211af5d3dd9839ee87fe0b7904", "html_url": "https://github.com/rust-lang/rust/commit/acce384c22f123211af5d3dd9839ee87fe0b7904", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/acce384c22f123211af5d3dd9839ee87fe0b7904/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3af8c8505255555023e4cb7c6c4f297ce22d80d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3af8c8505255555023e4cb7c6c4f297ce22d80d", "html_url": "https://github.com/rust-lang/rust/commit/f3af8c8505255555023e4cb7c6c4f297ce22d80d"}, {"sha": "cfdf7633f08ee77e303f1bf88b613a35f9946e75", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfdf7633f08ee77e303f1bf88b613a35f9946e75", "html_url": "https://github.com/rust-lang/rust/commit/cfdf7633f08ee77e303f1bf88b613a35f9946e75"}], "stats": {"total": 87, "additions": 63, "deletions": 24}, "files": [{"sha": "7ad5e8fc9ee3f62cbf56f4f96ea131d8ec6839cb", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 12, "deletions": 13, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -1009,11 +1009,11 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n             }\n \n             err_out_of_scope(super_scope, sub_scope, cause) => {\n-                let (value_kind, value_msg, is_temporary) = match err.cmt.cat {\n+                let (value_kind, value_msg) = match err.cmt.cat {\n                     mc::Categorization::Rvalue(_) =>\n-                        (\"temporary value\", \"temporary value created here\", true),\n+                        (\"temporary value\", \"temporary value created here\"),\n                     _ =>\n-                        (\"borrowed value\", \"does not live long enough\", false)\n+                        (\"borrowed value\", \"borrow occurs here\")\n                 };\n \n                 let is_closure = match cause {\n@@ -1026,14 +1026,14 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                             Some(primary) => {\n                                 db.span = MultiSpan::from_span(s);\n                                 db.span_label(primary, &format!(\"capture occurs here\"));\n-                                db.span_label(s, &value_msg);\n+                                db.span_label(s, &\"does not live long enough\");\n                                 true\n                             }\n                             None => false\n                         }\n                     }\n                     _ => {\n-                        db.span_label(error_span, &value_msg);\n+                        db.span_label(error_span, &\"does not live long enough\");\n                         false\n                     }\n                 };\n@@ -1043,11 +1043,11 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n \n                 match (sub_span, super_span) {\n                     (Some(s1), Some(s2)) if s1 == s2 => {\n-                        if !is_temporary && !is_closure {\n+                        if !is_closure {\n                             db.span = MultiSpan::from_span(s1);\n-                            db.span_label(error_span, &format!(\"borrow occurs here\"));\n+                            db.span_label(error_span, &value_msg);\n                             let msg = match opt_loan_path(&err.cmt) {\n-                                None => \"borrowed value\".to_string(),\n+                                None => value_kind.to_string(),\n                                 Some(lp) => {\n                                     format!(\"`{}`\", self.loan_path_to_string(&lp))\n                                 }\n@@ -1060,17 +1060,16 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                         db.note(\"values in a scope are dropped in the opposite order \\\n                                 they are created\");\n                     }\n-                    (Some(s1), Some(s2)) if !is_temporary && !is_closure => {\n+                    (Some(s1), Some(s2)) if !is_closure => {\n                         db.span = MultiSpan::from_span(s2);\n-                        db.span_label(error_span, &format!(\"borrow occurs here\"));\n+                        db.span_label(error_span, &value_msg);\n                         let msg = match opt_loan_path(&err.cmt) {\n-                            None => \"borrowed value\".to_string(),\n+                            None => value_kind.to_string(),\n                             Some(lp) => {\n                                 format!(\"`{}`\", self.loan_path_to_string(&lp))\n                             }\n                         };\n-                        db.span_label(s2,\n-                                      &format!(\"{} dropped here while still borrowed\", msg));\n+                        db.span_label(s2, &format!(\"{} dropped here while still borrowed\", msg));\n                         db.span_label(s1, &format!(\"{} needs to live until here\", value_kind));\n                     }\n                     _ => {"}, {"sha": "d85483f43c9e02dfb57a38b5551da5e8d475237a", "filename": "src/test/ui/lifetimes/borrowck-let-suggestion.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Flifetimes%2Fborrowck-let-suggestion.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Flifetimes%2Fborrowck-let-suggestion.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fborrowck-let-suggestion.stderr?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -1,8 +1,8 @@\n error: borrowed value does not live long enough\n-  --> $DIR/borrowck-let-suggestion.rs:12:13\n+  --> $DIR/borrowck-let-suggestion.rs:12:23\n    |\n 12 |     let x = [1].iter();\n-   |             ^^^       - temporary value only lives until here\n+   |             ---       ^ temporary value dropped here while still borrowed\n    |             |\n    |             temporary value created here\n 13 | }"}, {"sha": "5bb656878b3f3b7d384a760621b84503453b8e6c", "filename": "src/test/ui/span/borrowck-let-suggestion-suffixes.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fborrowck-let-suggestion-suffixes.stderr?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -10,10 +10,10 @@ error: `young[..]` does not live long enough\n    = note: values in a scope are dropped in the opposite order they are created\n \n error: borrowed value does not live long enough\n-  --> $DIR/borrowck-let-suggestion-suffixes.rs:24:14\n+  --> $DIR/borrowck-let-suggestion-suffixes.rs:24:18\n    |\n 24 |     v3.push(&'x');           // statement 6\n-   |              ^^^ - temporary value only lives until here\n+   |              --- ^ temporary value dropped here while still borrowed\n    |              |\n    |              temporary value created here\n ...\n@@ -23,10 +23,10 @@ error: borrowed value does not live long enough\n    = note: consider using a `let` binding to increase its lifetime\n \n error: borrowed value does not live long enough\n-  --> $DIR/borrowck-let-suggestion-suffixes.rs:34:18\n+  --> $DIR/borrowck-let-suggestion-suffixes.rs:34:22\n    |\n 34 |         v4.push(&'y');\n-   |                  ^^^ - temporary value only lives until here\n+   |                  --- ^ temporary value dropped here while still borrowed\n    |                  |\n    |                  temporary value created here\n ...\n@@ -36,10 +36,10 @@ error: borrowed value does not live long enough\n    = note: consider using a `let` binding to increase its lifetime\n \n error: borrowed value does not live long enough\n-  --> $DIR/borrowck-let-suggestion-suffixes.rs:45:14\n+  --> $DIR/borrowck-let-suggestion-suffixes.rs:45:18\n    |\n 45 |     v5.push(&'z');\n-   |              ^^^ - temporary value only lives until here\n+   |              --- ^ temporary value dropped here while still borrowed\n    |              |\n    |              temporary value created here\n ..."}, {"sha": "ea5f4d3fe60e3c8bee319374237d227dadca0ea3", "filename": "src/test/ui/span/issue-15480.rs", "status": "renamed", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-15480.rs?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -11,7 +11,6 @@\n fn main() {\n     let v = vec![\n         &3\n-//~^ ERROR borrowed value does not live long enough\n     ];\n \n     for &&x in &v {", "previous_filename": "src/test/compile-fail/issue-15480.rs"}, {"sha": "85f6c41c366413320ca85c8d37f1cba702a9f40f", "filename": "src/test/ui/span/issue-15480.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue-15480.stderr?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -0,0 +1,15 @@\n+error: borrowed value does not live long enough\n+  --> $DIR/issue-15480.rs:14:6\n+   |\n+13 |         &3\n+   |          - temporary value created here\n+14 |     ];\n+   |      ^ temporary value dropped here while still borrowed\n+...\n+19 | }\n+   | - temporary value needs to live until here\n+   |\n+   = note: consider using a `let` binding to increase its lifetime\n+\n+error: aborting due to previous error\n+"}, {"sha": "a524562f2d959b3f0b346a3077dc2c898ba2f918", "filename": "src/test/ui/span/regions-close-over-borrowed-ref-in-obj.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.rs?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -17,7 +17,7 @@ impl<'a> Foo for &'a isize { }\n fn main() {\n     let blah;\n     {\n-        let ss: &isize = &1; //~ ERROR borrowed value does not live long enough\n+        let ss: &isize = &1;\n         blah = box ss as Box<Foo>;\n     }\n }", "previous_filename": "src/test/compile-fail/regions-close-over-borrowed-ref-in-obj.rs"}, {"sha": "205734c25e0e6cd4926fc870e852f62e7032dea0", "filename": "src/test/ui/span/regions-close-over-borrowed-ref-in-obj.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fregions-close-over-borrowed-ref-in-obj.stderr?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -0,0 +1,13 @@\n+error: borrowed value does not live long enough\n+  --> $DIR/regions-close-over-borrowed-ref-in-obj.rs:22:5\n+   |\n+20 |         let ss: &isize = &1;\n+   |                           - temporary value created here\n+21 |         blah = box ss as Box<Foo>;\n+22 |     }\n+   |     ^ temporary value dropped here while still borrowed\n+23 | }\n+   | - temporary value needs to live until here\n+\n+error: aborting due to previous error\n+"}, {"sha": "4ca0ccaa731d8f30b62abd9332560fe615c294cf", "filename": "src/test/ui/span/slice-borrow.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.rs?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -13,7 +13,7 @@\n fn main() {\n     let y;\n     {\n-        let x: &[isize] = &[1, 2, 3, 4, 5]; //~ ERROR borrowed value does not live long enough\n+        let x: &[isize] = &[1, 2, 3, 4, 5];\n         y = &x[1..];\n     }\n }", "previous_filename": "src/test/compile-fail/slice-borrow.rs"}, {"sha": "efe81fd00bf4789b2069fb255d68782041d53b98", "filename": "src/test/ui/span/slice-borrow.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/acce384c22f123211af5d3dd9839ee87fe0b7904/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fslice-borrow.stderr?ref=acce384c22f123211af5d3dd9839ee87fe0b7904", "patch": "@@ -0,0 +1,13 @@\n+error: borrowed value does not live long enough\n+  --> $DIR/slice-borrow.rs:18:5\n+   |\n+16 |         let x: &[isize] = &[1, 2, 3, 4, 5];\n+   |                            --------------- temporary value created here\n+17 |         y = &x[1..];\n+18 |     }\n+   |     ^ temporary value dropped here while still borrowed\n+19 | }\n+   | - temporary value needs to live until here\n+\n+error: aborting due to previous error\n+"}]}