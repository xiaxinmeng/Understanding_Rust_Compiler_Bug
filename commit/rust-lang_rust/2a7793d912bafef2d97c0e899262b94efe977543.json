{"sha": "2a7793d912bafef2d97c0e899262b94efe977543", "node_id": "C_kwDOAAsO6NoAKDJhNzc5M2Q5MTJiYWZlZjJkOTdjMGU4OTkyNjJiOTRlZmU5Nzc1NDM", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-02-23T15:02:54Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-02-25T21:16:40Z"}, "message": "feat: Make private editable completions configurable, disable by default", "tree": {"sha": "ab3f893f3b2c88ddbbaf0abbdec77c7fb2a9c3cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab3f893f3b2c88ddbbaf0abbdec77c7fb2a9c3cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a7793d912bafef2d97c0e899262b94efe977543", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a7793d912bafef2d97c0e899262b94efe977543", "html_url": "https://github.com/rust-lang/rust/commit/2a7793d912bafef2d97c0e899262b94efe977543", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a7793d912bafef2d97c0e899262b94efe977543/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "789f2b9cb648c94368bead534c676a8dbfc8ba04", "url": "https://api.github.com/repos/rust-lang/rust/commits/789f2b9cb648c94368bead534c676a8dbfc8ba04", "html_url": "https://github.com/rust-lang/rust/commit/789f2b9cb648c94368bead534c676a8dbfc8ba04"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "c4e91e72830bcd962efe8d55936d0066ec9a5195", "filename": "crates/ide_completion/src/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fconfig.rs?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -13,6 +13,7 @@ pub struct CompletionConfig {\n     pub enable_postfix_completions: bool,\n     pub enable_imports_on_the_fly: bool,\n     pub enable_self_on_the_fly: bool,\n+    pub enable_private_editable: bool,\n     pub add_call_parenthesis: bool,\n     pub add_call_argument_snippets: bool,\n     pub snippet_cap: Option<SnippetCap>,"}, {"sha": "c4e145ffcb55a114f9a8be8f21cf90edb4370b4e", "filename": "crates/ide_completion/src/context.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcontext.rs?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -360,6 +360,9 @@ impl<'a> CompletionContext<'a> {\n             None => return Visible::No,\n         };\n         if !vis.is_visible_from(self.db, module.into()) {\n+            if !self.config.enable_private_editable {\n+                return Visible::No;\n+            }\n             // If the definition location is editable, also show private items\n             let root_file = defining_crate.root_file(self.db);\n             let source_root_id = self.db.file_source_root(root_file);"}, {"sha": "45c7c58dc03aad21e68fa50c370a20ba0a108b34", "filename": "crates/ide_completion/src/tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Fide_completion%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Ftests.rs?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -64,6 +64,7 @@ pub(crate) const TEST_CONFIG: CompletionConfig = CompletionConfig {\n     enable_postfix_completions: true,\n     enable_imports_on_the_fly: true,\n     enable_self_on_the_fly: true,\n+    enable_private_editable: true,\n     add_call_parenthesis: true,\n     add_call_argument_snippets: true,\n     snippet_cap: SnippetCap::new(true),"}, {"sha": "af779ee000d8c3157e46262d992ae440951ce8b5", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -161,13 +161,15 @@ config_data! {\n             }\n         }\"#,\n         /// Whether to show postfix snippets like `dbg`, `if`, `not`, etc.\n-        completion_postfix_enable: bool          = \"true\",\n+        completion_postfix_enable: bool         = \"true\",\n         /// Toggles the additional completions that automatically add imports when completed.\n         /// Note that your client must specify the `additionalTextEdits` LSP client capability to truly have this feature enabled.\n         completion_autoimport_enable: bool       = \"true\",\n         /// Toggles the additional completions that automatically show method calls and field accesses\n         /// with `self` prefixed to them when inside a method.\n-        completion_autoself_enable: bool       = \"true\",\n+        completion_autoself_enable: bool        = \"true\",\n+        /// Enables completions of private items and fields that are defined in the current workspace even if they are not visible at the current position.\n+        completion_privateEditable_enable: bool = \"false\",\n \n         /// Whether to show native rust-analyzer diagnostics.\n         diagnostics_enable: bool                = \"true\",\n@@ -875,6 +877,7 @@ impl Config {\n             enable_imports_on_the_fly: self.data.completion_autoimport_enable\n                 && completion_item_edit_resolve(&self.caps),\n             enable_self_on_the_fly: self.data.completion_autoself_enable,\n+            enable_private_editable: self.data.completion_privateEditable_enable,\n             add_call_parenthesis: self.data.completion_addCallParenthesis,\n             add_call_argument_snippets: self.data.completion_addCallArgumentSnippets,\n             insert_use: self.insert_use_config(),"}, {"sha": "a910a910bb24748fe3ecc1b359bbe4418cf95978", "filename": "crates/rust-analyzer/src/integrated_benchmarks.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fintegrated_benchmarks.rs?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -134,6 +134,7 @@ fn integrated_completion_benchmark() {\n             enable_postfix_completions: true,\n             enable_imports_on_the_fly: true,\n             enable_self_on_the_fly: true,\n+            enable_private_editable: true,\n             add_call_parenthesis: true,\n             add_call_argument_snippets: true,\n             snippet_cap: SnippetCap::new(true),\n@@ -171,6 +172,7 @@ fn integrated_completion_benchmark() {\n             enable_postfix_completions: true,\n             enable_imports_on_the_fly: true,\n             enable_self_on_the_fly: true,\n+            enable_private_editable: true,\n             add_call_parenthesis: true,\n             add_call_argument_snippets: true,\n             snippet_cap: SnippetCap::new(true),"}, {"sha": "7e6c8225b1847796d722faf9d4946e1908b7a004", "filename": "docs/user/generated_config.adoc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/docs%2Fuser%2Fgenerated_config.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/docs%2Fuser%2Fgenerated_config.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fgenerated_config.adoc?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -213,6 +213,11 @@ Note that your client must specify the `additionalTextEdits` LSP client capabili\n Toggles the additional completions that automatically show method calls and field accesses\n with `self` prefixed to them when inside a method.\n --\n+[[rust-analyzer.completion.privateEditable.enable]]rust-analyzer.completion.privateEditable.enable (default: `false`)::\n++\n+--\n+Enables completions of private items and fields that are defined in the current workspace even if they are not visible at the current position.\n+--\n [[rust-analyzer.diagnostics.enable]]rust-analyzer.diagnostics.enable (default: `true`)::\n +\n --"}, {"sha": "1252752a9ae0192bd5e27774194995bb882f2cf2", "filename": "editors/code/package.json", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2a7793d912bafef2d97c0e899262b94efe977543/editors%2Fcode%2Fpackage.json", "raw_url": "https://github.com/rust-lang/rust/raw/2a7793d912bafef2d97c0e899262b94efe977543/editors%2Fcode%2Fpackage.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fpackage.json?ref=2a7793d912bafef2d97c0e899262b94efe977543", "patch": "@@ -643,6 +643,11 @@\n                     \"default\": true,\n                     \"type\": \"boolean\"\n                 },\n+                \"rust-analyzer.completion.privateEditable.enable\": {\n+                    \"markdownDescription\": \"Enables completions of private items and fields that are defined in the current workspace even if they are not visible at the current position.\",\n+                    \"default\": false,\n+                    \"type\": \"boolean\"\n+                },\n                 \"rust-analyzer.diagnostics.enable\": {\n                     \"markdownDescription\": \"Whether to show native rust-analyzer diagnostics.\",\n                     \"default\": true,"}]}