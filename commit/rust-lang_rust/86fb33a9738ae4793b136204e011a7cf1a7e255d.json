{"sha": "86fb33a9738ae4793b136204e011a7cf1a7e255d", "node_id": "C_kwDOAAsO6NoAKDg2ZmIzM2E5NzM4YWU0NzkzYjEzNjIwNGUwMTFhN2NmMWE3ZTI1NWQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-16T11:40:45Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-02-16T11:40:45Z"}, "message": "Auto merge of #10353 - nindalf:master, r=llogiq\n\nChange unusual_byte_groupings to require byte groupings of equal size\n\nFixes issue #6556\n\nThis lint required byte groupings of size 2 or 4 for `Radix::Binary` and `Radix::Hexadecimal`. Since there are good reasons for allowing groups of other sizes, this PR relaxes the restriction. This lint now requires that\n\n- group sizes after the first group be of the same size and\n- greater or equal in size to the first group.\n\n---\n\nchangelog: [`unusual_byte_groupings`]: reduce false positives by relaxing restriction requiring groups of specific sizes.", "tree": {"sha": "d934df8d6964e57187ee6ae6c5df25a34a961a18", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d934df8d6964e57187ee6ae6c5df25a34a961a18"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86fb33a9738ae4793b136204e011a7cf1a7e255d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86fb33a9738ae4793b136204e011a7cf1a7e255d", "html_url": "https://github.com/rust-lang/rust/commit/86fb33a9738ae4793b136204e011a7cf1a7e255d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86fb33a9738ae4793b136204e011a7cf1a7e255d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b6795f50b521b11393d39f823d8a3e5b262b134", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b6795f50b521b11393d39f823d8a3e5b262b134", "html_url": "https://github.com/rust-lang/rust/commit/5b6795f50b521b11393d39f823d8a3e5b262b134"}, {"sha": "f12b492ee09eb39ba1ec9867a241a4b87c51528c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f12b492ee09eb39ba1ec9867a241a4b87c51528c", "html_url": "https://github.com/rust-lang/rust/commit/f12b492ee09eb39ba1ec9867a241a4b87c51528c"}], "stats": {"total": 56, "additions": 17, "deletions": 39}, "files": [{"sha": "879bcca33a8b79de76a3a02b23c8453711f740b7", "filename": "clippy_lints/src/literal_representation.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/clippy_lints%2Fsrc%2Fliteral_representation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/clippy_lints%2Fsrc%2Fliteral_representation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fliteral_representation.rs?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -210,7 +210,7 @@ impl WarningType {\n                 cx,\n                 UNUSUAL_BYTE_GROUPINGS,\n                 span,\n-                \"digits of hex or binary literal not grouped by four\",\n+                \"digits of hex, binary or octal literal not in groups of equal size\",\n                 \"consider\",\n                 suggested_format,\n                 Applicability::MachineApplicable,\n@@ -427,8 +427,12 @@ impl LiteralDigitGrouping {\n \n         let first = groups.next().expect(\"At least one group\");\n \n-        if (radix == Radix::Binary || radix == Radix::Hexadecimal) && groups.any(|i| i != 4 && i != 2) {\n-            return Err(WarningType::UnusualByteGroupings);\n+        if radix == Radix::Binary || radix == Radix::Octal || radix == Radix::Hexadecimal {\n+            if let Some(second_size) = groups.next() {\n+                if !groups.all(|i| i == second_size) || first > second_size {\n+                    return Err(WarningType::UnusualByteGroupings);\n+                }\n+            }\n         }\n \n         if let Some(second) = groups.next() {"}, {"sha": "ea18dac0683361ea65a077b3e17824b4f9b5201d", "filename": "tests/ui/large_digit_groups.fixed", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Flarge_digit_groups.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Flarge_digit_groups.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flarge_digit_groups.fixed?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -11,15 +11,15 @@ fn main() {\n     let _good = (\n         0b1011_i64,\n         0o1_234_u32,\n-        0x0123_4567,\n+        0x1_234_567,\n         1_2345_6789,\n         1234_f32,\n         1_234.12_f32,\n         1_234.123_f32,\n         1.123_4_f32,\n     );\n     let _bad = (\n-        0b11_0110_i64,\n+        0b1_10110_i64,\n         0xdead_beef_usize,\n         123_456_f32,\n         123_456.12_f32,"}, {"sha": "19c0fae98a645188e3d15050e58c6d065e524dc7", "filename": "tests/ui/large_digit_groups.stderr", "status": "modified", "additions": 4, "deletions": 16, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Flarge_digit_groups.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Flarge_digit_groups.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flarge_digit_groups.stderr?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -1,22 +1,10 @@\n-error: digits of hex or binary literal not grouped by four\n-  --> $DIR/large_digit_groups.rs:14:9\n-   |\n-LL |         0x1_234_567,\n-   |         ^^^^^^^^^^^ help: consider: `0x0123_4567`\n-   |\n-   = note: `-D clippy::unusual-byte-groupings` implied by `-D warnings`\n-\n-error: digits of hex or binary literal not grouped by four\n-  --> $DIR/large_digit_groups.rs:22:9\n-   |\n-LL |         0b1_10110_i64,\n-   |         ^^^^^^^^^^^^^ help: consider: `0b11_0110_i64`\n-\n-error: digits of hex or binary literal not grouped by four\n+error: digits of hex, binary or octal literal not in groups of equal size\n   --> $DIR/large_digit_groups.rs:23:9\n    |\n LL |         0xd_e_adbee_f_usize,\n    |         ^^^^^^^^^^^^^^^^^^^ help: consider: `0xdead_beef_usize`\n+   |\n+   = note: `-D clippy::unusual-byte-groupings` implied by `-D warnings`\n \n error: digit groups should be smaller\n   --> $DIR/large_digit_groups.rs:24:9\n@@ -44,5 +32,5 @@ error: digit groups should be smaller\n LL |         1_23456.12345_6_f64,\n    |         ^^^^^^^^^^^^^^^^^^^ help: consider: `123_456.123_456_f64`\n \n-error: aborting due to 7 previous errors\n+error: aborting due to 5 previous errors\n "}, {"sha": "9bc7948c7cc1fc615fa86ba7a088a8b9640698be", "filename": "tests/ui/literals.stderr", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Fliterals.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Fliterals.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fliterals.stderr?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -121,20 +121,14 @@ error: digits grouped inconsistently by underscores\n LL |     let fail23 = 3__16___23;\n    |                  ^^^^^^^^^^ help: consider: `31_623`\n \n-error: digits of hex or binary literal not grouped by four\n+error: digits of hex, binary or octal literal not in groups of equal size\n   --> $DIR/literals.rs:38:18\n    |\n LL |     let fail24 = 0xAB_ABC_AB;\n    |                  ^^^^^^^^^^^ help: consider: `0x0ABA_BCAB`\n    |\n    = note: `-D clippy::unusual-byte-groupings` implied by `-D warnings`\n \n-error: digits of hex or binary literal not grouped by four\n-  --> $DIR/literals.rs:39:18\n-   |\n-LL |     let fail25 = 0b01_100_101;\n-   |                  ^^^^^^^^^^^^ help: consider: `0b0110_0101`\n-\n error: this is a decimal constant\n   --> $DIR/literals.rs:46:13\n    |\n@@ -168,5 +162,5 @@ help: if you mean to use a decimal constant, remove the `0` to avoid confusion\n LL |     let _ = 89;\n    |             ~~\n \n-error: aborting due to 21 previous errors\n+error: aborting due to 20 previous errors\n "}, {"sha": "13e5feb19263ef7015460332ce3e7fcbeab10931", "filename": "tests/ui/unreadable_literal.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Funreadable_literal.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Funreadable_literal.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funreadable_literal.fixed?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -23,7 +23,7 @@ fn main() {\n     let _good = (\n         0b1011_i64,\n         0o1_234_u32,\n-        0x0123_4567,\n+        0x1_234_567,\n         65536,\n         1_2345_6789,\n         1234_f32,"}, {"sha": "450121b1c5a92afd43bacd81c810699c64b7f9f3", "filename": "tests/ui/unreadable_literal.stderr", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Funreadable_literal.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/86fb33a9738ae4793b136204e011a7cf1a7e255d/tests%2Fui%2Funreadable_literal.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funreadable_literal.stderr?ref=86fb33a9738ae4793b136204e011a7cf1a7e255d", "patch": "@@ -1,11 +1,3 @@\n-error: digits of hex or binary literal not grouped by four\n-  --> $DIR/unreadable_literal.rs:26:9\n-   |\n-LL |         0x1_234_567,\n-   |         ^^^^^^^^^^^ help: consider: `0x0123_4567`\n-   |\n-   = note: `-D clippy::unusual-byte-groupings` implied by `-D warnings`\n-\n error: long literal lacking separators\n   --> $DIR/unreadable_literal.rs:34:17\n    |\n@@ -68,5 +60,5 @@ error: long literal lacking separators\n LL |     let _fail5 = 1.100300400;\n    |                  ^^^^^^^^^^^ help: consider: `1.100_300_400`\n \n-error: aborting due to 11 previous errors\n+error: aborting due to 10 previous errors\n "}]}