{"sha": "39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5YzBmYTg0N2U3NGU1OWY5NmRjNmIwMWQ5MTIyNTJmOGNkYjcyZWI=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-11-20T02:35:11Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-11-20T02:35:11Z"}, "message": "Move syntax_expand::config to rustc_parse::config", "tree": {"sha": "8aeb03506588c284990f6a8920197d84071e83be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8aeb03506588c284990f6a8920197d84071e83be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "html_url": "https://github.com/rust-lang/rust/commit/39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "618b01f9fa0a6b4e7e2ce5b3409abe104b80c4a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/618b01f9fa0a6b4e7e2ce5b3409abe104b80c4a8", "html_url": "https://github.com/rust-lang/rust/commit/618b01f9fa0a6b4e7e2ce5b3409abe104b80c4a8"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "7ce555ed57a3d0dc9552700e7e0d3008bb3f89fe", "filename": "src/librustc_parse/config.rs", "status": "renamed", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fconfig.rs?ref=39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "patch": "@@ -1,4 +1,14 @@\n-use rustc_parse::validate_attr;\n+//! Process the potential `cfg` attributes on a module.\n+//! Also determine if the module should be included in this configuration.\n+//!\n+//! This module properly belongs in syntax_expand, but for now it's tied into\n+//! parsing, so we leave it here to avoid complicated out-of-line dependencies.\n+//!\n+//! A principled solution to this wrong location would be to implement [#64197].\n+//!\n+//! [#64197]: https://github.com/rust-lang/rust/issues/64197\n+\n+use crate::validate_attr;\n use syntax::attr::HasAttrs;\n use syntax::feature_gate::{\n     feature_err,\n@@ -113,7 +123,7 @@ impl<'a> StripUnconfigured<'a> {\n             return vec![];\n         }\n \n-        let res = rustc_parse::parse_in_attr(self.sess, &attr, |p| p.parse_cfg_attr());\n+        let res = crate::parse_in_attr(self.sess, &attr, |p| p.parse_cfg_attr());\n         let (cfg_predicate, expanded_attrs) = match res {\n             Ok(result) => result,\n             Err(mut e) => {", "previous_filename": "src/libsyntax_expand/config.rs"}, {"sha": "1215c7a199a98816d90e73fb3ef5f57f31d78764", "filename": "src/librustc_parse/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Flib.rs?ref=39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "patch": "@@ -25,6 +25,8 @@ pub mod parser;\n use parser::{Parser, emit_unclosed_delims, make_unclosed_delims_error};\n pub mod lexer;\n pub mod validate_attr;\n+#[macro_use]\n+pub mod config;\n \n #[derive(Clone)]\n pub struct Directory<'a> {"}, {"sha": "1621c9ffc02c314532dee3f611e6327a776c5870", "filename": "src/librustc_parse/parser/module.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Fparser%2Fmodule.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibrustc_parse%2Fparser%2Fmodule.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_parse%2Fparser%2Fmodule.rs?ref=39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "patch": "@@ -41,7 +41,7 @@ impl<'a> Parser<'a> {\n     /// Parses a `mod <foo> { ... }` or `mod <foo>;` item.\n     pub(super) fn parse_item_mod(&mut self, outer_attrs: &[Attribute]) -> PResult<'a, ItemInfo> {\n         // HACK(Centril): See documentation on `ParseSess::process_cfg_mod`.\n-        let (in_cfg, outer_attrs) = (self.sess.process_cfg_mod)(\n+        let (in_cfg, outer_attrs) = crate::config::process_configure_mod(\n             self.sess,\n             self.cfg_mods,\n             outer_attrs,"}, {"sha": "2532bbc0fe240d47294bd60362a2cda7e62d9f7c", "filename": "src/libsyntax_expand/expand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibsyntax_expand%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibsyntax_expand%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_expand%2Fexpand.rs?ref=39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "patch": "@@ -4,7 +4,7 @@ use crate::hygiene::{ExpnId, SyntaxContext, ExpnData, ExpnKind};\n use crate::mbe::macro_rules::annotate_err_with_kind;\n use crate::placeholders::{placeholder, PlaceholderExpander};\n use crate::config::StripUnconfigured;\n-use crate::configure;\n+use rustc_parse::configure;\n \n use rustc_parse::DirectoryOwnership;\n use rustc_parse::parser::Parser;"}, {"sha": "0aa34af7a762d32708429d2236d988d9e8f31517", "filename": "src/libsyntax_expand/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibsyntax_expand%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39c0fa847e74e59f96dc6b01d912252f8cdb72eb/src%2Flibsyntax_expand%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_expand%2Flib.rs?ref=39c0fa847e74e59f96dc6b01d912252f8cdb72eb", "patch": "@@ -33,7 +33,7 @@ pub use mbe::macro_rules::compile_declarative_macro;\n pub mod base;\n pub mod build;\n pub mod expand;\n-#[macro_use] pub mod config;\n+pub use rustc_parse::config;\n pub mod proc_macro;\n \n crate mod mbe;"}]}