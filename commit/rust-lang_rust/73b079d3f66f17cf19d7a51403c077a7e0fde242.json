{"sha": "73b079d3f66f17cf19d7a51403c077a7e0fde242", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczYjA3OWQzZjY2ZjE3Y2YxOWQ3YTUxNDAzYzA3N2E3ZTBmZGUyNDI=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2017-10-26T19:32:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-10-26T19:32:44Z"}, "message": "Merge pull request #2079 from SingingTree/issue-1979-errors-go-to-stdout\n\nUse stderr for various errors and warnings.", "tree": {"sha": "668925bd007d1b635282a4b0553f5e0fe2bb7e31", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/668925bd007d1b635282a4b0553f5e0fe2bb7e31"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73b079d3f66f17cf19d7a51403c077a7e0fde242", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73b079d3f66f17cf19d7a51403c077a7e0fde242", "html_url": "https://github.com/rust-lang/rust/commit/73b079d3f66f17cf19d7a51403c077a7e0fde242", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73b079d3f66f17cf19d7a51403c077a7e0fde242/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36ed1566eadc1aa663b12cc6fb72541cc16d3395", "url": "https://api.github.com/repos/rust-lang/rust/commits/36ed1566eadc1aa663b12cc6fb72541cc16d3395", "html_url": "https://github.com/rust-lang/rust/commit/36ed1566eadc1aa663b12cc6fb72541cc16d3395"}, {"sha": "adac9fb43cd7ab33de3978614c5493f98ba0b432", "url": "https://api.github.com/repos/rust-lang/rust/commits/adac9fb43cd7ab33de3978614c5493f98ba0b432", "html_url": "https://github.com/rust-lang/rust/commit/adac9fb43cd7ab33de3978614c5493f98ba0b432"}], "stats": {"total": 72, "additions": 46, "deletions": 26}, "files": [{"sha": "826476bed3ee83019be7003e42031d8727bfe144", "filename": "src/bin/cargo-fmt.rs", "status": "modified", "additions": 22, "deletions": 12, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fbin%2Fcargo-fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fbin%2Fcargo-fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcargo-fmt.rs?ref=73b079d3f66f17cf19d7a51403c077a7e0fde242", "patch": "@@ -55,14 +55,14 @@ fn execute() -> i32 {\n         .take_while(|a| a != \"--\")\n         .find(|a| !a.starts_with('-'))\n     {\n-        print_usage(&opts, &format!(\"Invalid argument: `{}`.\", arg));\n+        print_usage_to_stderr(&opts, &format!(\"Invalid argument: `{}`.\", arg));\n         return failure;\n     }\n \n     let matches = match opts.parse(env::args().skip(1).take_while(|a| a != \"--\")) {\n         Ok(m) => m,\n         Err(e) => {\n-            print_usage(&opts, &e.to_string());\n+            print_usage_to_stderr(&opts, &e.to_string());\n             return failure;\n         }\n     };\n@@ -72,21 +72,21 @@ fn execute() -> i32 {\n         (false, true) => Verbosity::Quiet,\n         (true, false) => Verbosity::Verbose,\n         (true, true) => {\n-            print_usage(&opts, \"quiet mode and verbose mode are not compatible\");\n+            print_usage_to_stderr(&opts, \"quiet mode and verbose mode are not compatible\");\n             return failure;\n         }\n     };\n \n     if matches.opt_present(\"h\") {\n-        print_usage(&opts, \"\");\n+        print_usage_to_stdout(&opts, \"\");\n         return success;\n     }\n \n     let workspace_hitlist = WorkspaceHitlist::from_matches(&matches);\n \n     match format_crate(verbosity, &workspace_hitlist) {\n         Err(e) => {\n-            print_usage(&opts, &e.to_string());\n+            print_usage_to_stderr(&opts, &e.to_string());\n             failure\n         }\n         Ok(status) => if status.success() {\n@@ -97,13 +97,23 @@ fn execute() -> i32 {\n     }\n }\n \n-fn print_usage(opts: &Options, reason: &str) {\n-    let msg = format!(\"{}\\nusage: cargo fmt [options]\", reason);\n-    println!(\n-        \"{}\\nThis utility formats all bin and lib files of the current crate using rustfmt. \\\n-         Arguments after `--` are passed to rustfmt.\",\n-        opts.usage(&msg)\n-    );\n+macro_rules! print_usage {\n+    ($print:ident, $opts:ident, $reason:expr) => ({\n+        let msg = format!(\"{}\\nusage: cargo fmt [options]\", $reason);\n+        $print!(\n+            \"{}\\nThis utility formats all bin and lib files of the current crate using rustfmt. \\\n+             Arguments after `--` are passed to rustfmt.\",\n+            $opts.usage(&msg)\n+        );\n+    })\n+}\n+\n+fn print_usage_to_stdout(opts: &Options, reason: &str) {\n+    print_usage!(println, opts, reason);\n+}\n+\n+fn print_usage_to_stderr(opts: &Options, reason: &str) {\n+    print_usage!(eprintln, opts, reason);\n }\n \n #[derive(Debug, Clone, Copy, PartialEq)]"}, {"sha": "5189b3396c60a53478a8589a3e423b5069c0d118", "filename": "src/bin/rustfmt.rs", "status": "modified", "additions": 23, "deletions": 13, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fbin%2Frustfmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fbin%2Frustfmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Frustfmt.rs?ref=73b079d3f66f17cf19d7a51403c077a7e0fde242", "patch": "@@ -161,7 +161,7 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n \n     match determine_operation(&matches)? {\n         Operation::Help => {\n-            print_usage(opts, \"\");\n+            print_usage_to_stdout(opts, \"\");\n             Summary::print_exit_codes();\n             Ok(Summary::default())\n         }\n@@ -196,7 +196,7 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n                 config.set().file_lines(file_lines.parse()?);\n                 for f in config.file_lines().files() {\n                     if f != \"stdin\" {\n-                        println!(\"Warning: Extra file listed in file_lines option '{}'\", f);\n+                        eprintln!(\"Warning: Extra file listed in file_lines option '{}'\", f);\n                     }\n                 }\n             }\n@@ -217,7 +217,7 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n \n             for f in options.file_lines.files() {\n                 if !files.contains(&PathBuf::from(f)) {\n-                    println!(\"Warning: Extra file listed in file_lines option '{}'\", f);\n+                    eprintln!(\"Warning: Extra file listed in file_lines option '{}'\", f);\n                 }\n             }\n \n@@ -236,10 +236,10 @@ fn execute(opts: &Options) -> FmtResult<Summary> {\n             let mut error_summary = Summary::default();\n             for file in files {\n                 if !file.exists() {\n-                    println!(\"Error: file `{}` does not exist\", file.to_str().unwrap());\n+                    eprintln!(\"Error: file `{}` does not exist\", file.to_str().unwrap());\n                     error_summary.add_operational_error();\n                 } else if file.is_dir() {\n-                    println!(\"Error: `{}` is a directory\", file.to_str().unwrap());\n+                    eprintln!(\"Error: `{}` is a directory\", file.to_str().unwrap());\n                     error_summary.add_operational_error();\n                 } else {\n                     // Check the file directory if the config-path could not be read or not provided\n@@ -302,7 +302,7 @@ fn main() {\n             }\n         }\n         Err(e) => {\n-            print_usage(&opts, &e.to_string());\n+            print_usage_to_stderr(&opts, &e.to_string());\n             1\n         }\n     };\n@@ -316,13 +316,23 @@ fn main() {\n     std::process::exit(exit_code);\n }\n \n-fn print_usage(opts: &Options, reason: &str) {\n-    let reason = format!(\n-        \"{}\\n\\nusage: {} [options] <file>...\",\n-        reason,\n-        env::args_os().next().unwrap().to_string_lossy()\n-    );\n-    println!(\"{}\", opts.usage(&reason));\n+macro_rules! print_usage {\n+    ($print:ident, $opts:ident, $reason:expr) => ({\n+        let msg = format!(\n+            \"{}\\n\\nusage: {} [options] <file>...\",\n+            $reason,\n+            env::args_os().next().unwrap().to_string_lossy()\n+        );\n+        $print!(\"{}\", $opts.usage(&msg));\n+    })\n+}\n+\n+fn print_usage_to_stdout(opts: &Options, reason: &str) {\n+    print_usage!(println, opts, reason);\n+}\n+\n+fn print_usage_to_stderr(opts: &Options, reason: &str) {\n+    print_usage!(eprintln, opts, reason);\n }\n \n fn print_version() {"}, {"sha": "1241c27b8cfb9f3fc978a7476c80df16aa5a9adf", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73b079d3f66f17cf19d7a51403c077a7e0fde242/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=73b079d3f66f17cf19d7a51403c077a7e0fde242", "patch": "@@ -610,7 +610,7 @@ impl<'a> FmtVisitor<'a> {\n         match self.codemap.span_to_snippet(span) {\n             Ok(s) => s,\n             Err(_) => {\n-                println!(\n+                eprintln!(\n                     \"Couldn't make snippet for span {:?}->{:?}\",\n                     self.codemap.lookup_char_pos(span.lo()),\n                     self.codemap.lookup_char_pos(span.hi())"}]}