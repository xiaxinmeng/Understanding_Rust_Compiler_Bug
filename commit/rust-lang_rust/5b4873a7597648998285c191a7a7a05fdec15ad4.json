{"sha": "5b4873a7597648998285c191a7a7a05fdec15ad4", "node_id": "C_kwDOAAsO6NoAKDViNDg3M2E3NTk3NjQ4OTk4Mjg1YzE5MWE3YTdhMDVmZGVjMTVhZDQ", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-10-02T19:10:00Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2021-10-02T19:16:23Z"}, "message": "Run the #85441 regression test on MSVC only\n\nOn MinGW toolchains the various features (such as function sections)\nnecessary to eliminate dead function references are disabled due to\nvarious bugs. This means that the windows sockets library will most\nlikely remain linked to any mingw toolchain built program that also\nutilizes libstd.\n\nThat said, I made an attempt to also enable `function-sections` and\n`--gc-sections` during my experiments, but the symbol references\nremained, sadly.", "tree": {"sha": "1c585a804606d8092a6706d75a63298e7cea5f0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c585a804606d8092a6706d75a63298e7cea5f0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b4873a7597648998285c191a7a7a05fdec15ad4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b4873a7597648998285c191a7a7a05fdec15ad4", "html_url": "https://github.com/rust-lang/rust/commit/5b4873a7597648998285c191a7a7a05fdec15ad4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b4873a7597648998285c191a7a7a05fdec15ad4/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7d2b465b9a3d375ad3c1fbce75fa2ed47cc9e99", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7d2b465b9a3d375ad3c1fbce75fa2ed47cc9e99", "html_url": "https://github.com/rust-lang/rust/commit/b7d2b465b9a3d375ad3c1fbce75fa2ed47cc9e99"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "9c631e7e51c1d10eb4f220fcbd67deb8f02bec16", "filename": "library/std/src/sys/windows/net.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5b4873a7597648998285c191a7a7a05fdec15ad4/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b4873a7597648998285c191a7a7a05fdec15ad4/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fnet.rs?ref=5b4873a7597648998285c191a7a7a05fdec15ad4", "patch": "@@ -29,12 +29,12 @@ pub mod netc {\n \n pub struct Socket(OwnedSocket);\n \n-static WSA: SyncOnceCell<unsafe extern \"system\" fn() -> i32> = SyncOnceCell::new();\n+static WSA_CLEANUP: SyncOnceCell<unsafe extern \"system\" fn() -> i32> = SyncOnceCell::new();\n \n /// Checks whether the Windows socket interface has been started already, and\n /// if not, starts it.\n pub fn init() {\n-    let _ = WSA.get_or_init(|| unsafe {\n+    let _ = WSA_CLEANUP.get_or_init(|| unsafe {\n         let mut data: c::WSADATA = mem::zeroed();\n         let ret = c::WSAStartup(\n             0x202, // version 2.2\n@@ -51,7 +51,7 @@ pub fn init() {\n \n pub fn cleanup() {\n     // only perform cleanup if network functionality was actually initialized\n-    if let Some(cleanup) = WSA.get() {\n+    if let Some(cleanup) = WSA_CLEANUP.get() {\n         unsafe {\n             cleanup();\n         }"}, {"sha": "c7ae708c173c1b0ec42a7efdb9fb93c49e3a3677", "filename": "src/test/run-make/issue-85441/Makefile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5b4873a7597648998285c191a7a7a05fdec15ad4/src%2Ftest%2Frun-make%2Fissue-85441%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/5b4873a7597648998285c191a7a7a05fdec15ad4/src%2Ftest%2Frun-make%2Fissue-85441%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fissue-85441%2FMakefile?ref=5b4873a7597648998285c191a7a7a05fdec15ad4", "patch": "@@ -1,4 +1,4 @@\n-# only-windows\n+# only-windows-msvc\n \n -include ../../run-make-fulldeps/tools.mk\n "}]}