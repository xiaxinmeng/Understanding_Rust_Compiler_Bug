{"sha": "988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "node_id": "C_kwDOAAsO6NoAKDk4OGU3NWJiNjVmNjg4ZDc2ZjRmODBlMGZiNzJlZjIxZTgzMWQwYjA", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-04-06T01:21:10Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-10-22T05:54:39Z"}, "message": "Stabilize arbitrary_enum_discriminant, take 2", "tree": {"sha": "6e988b95e3f8e3614e3263b05e9cd998b7b4ea80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6e988b95e3f8e3614e3263b05e9cd998b7b4ea80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "html_url": "https://github.com/rust-lang/rust/commit/988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eecde5850cade0c058dc12330081329b31a826c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/eecde5850cade0c058dc12330081329b31a826c7", "html_url": "https://github.com/rust-lang/rust/commit/eecde5850cade0c058dc12330081329b31a826c7"}], "stats": {"total": 233, "additions": 12, "deletions": 221}, "files": [{"sha": "546010135a72532fa0324c2adbaa4bc1a16781c6", "filename": "compiler/rustc_ast_passes/src/feature_gate.rs", "status": "modified", "additions": 1, "deletions": 61, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Ffeature_gate.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,7 +1,7 @@\n use rustc_ast as ast;\n use rustc_ast::visit::{self, AssocCtxt, FnCtxt, FnKind, Visitor};\n use rustc_ast::{AssocConstraint, AssocConstraintKind, NodeId};\n-use rustc_ast::{PatKind, RangeEnd, VariantData};\n+use rustc_ast::{PatKind, RangeEnd};\n use rustc_errors::{struct_span_err, Applicability, StashKey};\n use rustc_feature::{AttributeGate, BuiltinAttribute, Features, GateIssue, BUILTIN_ATTRIBUTE_MAP};\n use rustc_session::parse::{feature_err, feature_err_issue, feature_warn};\n@@ -116,46 +116,6 @@ impl<'a> PostExpansionVisitor<'a> {\n         }\n     }\n \n-    fn maybe_report_invalid_custom_discriminants(&self, variants: &[ast::Variant]) {\n-        let has_fields = variants.iter().any(|variant| match variant.data {\n-            VariantData::Tuple(..) | VariantData::Struct(..) => true,\n-            VariantData::Unit(..) => false,\n-        });\n-\n-        let discriminant_spans = variants\n-            .iter()\n-            .filter(|variant| match variant.data {\n-                VariantData::Tuple(..) | VariantData::Struct(..) => false,\n-                VariantData::Unit(..) => true,\n-            })\n-            .filter_map(|variant| variant.disr_expr.as_ref().map(|c| c.value.span))\n-            .collect::<Vec<_>>();\n-\n-        if !discriminant_spans.is_empty() && has_fields {\n-            let mut err = feature_err(\n-                &self.sess.parse_sess,\n-                sym::arbitrary_enum_discriminant,\n-                discriminant_spans.clone(),\n-                \"custom discriminant values are not allowed in enums with tuple or struct variants\",\n-            );\n-            for sp in discriminant_spans {\n-                err.span_label(sp, \"disallowed custom discriminant\");\n-            }\n-            for variant in variants.iter() {\n-                match &variant.data {\n-                    VariantData::Struct(..) => {\n-                        err.span_label(variant.span, \"struct variant defined here\");\n-                    }\n-                    VariantData::Tuple(..) => {\n-                        err.span_label(variant.span, \"tuple variant defined here\");\n-                    }\n-                    VariantData::Unit(..) => {}\n-                }\n-            }\n-            err.emit();\n-        }\n-    }\n-\n     /// Feature gate `impl Trait` inside `type Alias = $type_expr;`.\n     fn check_impl_trait(&self, ty: &ast::Ty) {\n         struct ImplTraitVisitor<'a> {\n@@ -273,26 +233,6 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 }\n             }\n \n-            ast::ItemKind::Enum(ast::EnumDef { ref variants, .. }, ..) => {\n-                for variant in variants {\n-                    match (&variant.data, &variant.disr_expr) {\n-                        (ast::VariantData::Unit(..), _) => {}\n-                        (_, Some(disr_expr)) => gate_feature_post!(\n-                            &self,\n-                            arbitrary_enum_discriminant,\n-                            disr_expr.value.span,\n-                            \"discriminants on non-unit variants are experimental\"\n-                        ),\n-                        _ => {}\n-                    }\n-                }\n-\n-                let has_feature = self.features.arbitrary_enum_discriminant;\n-                if !has_feature && !i.span.allows_unstable(sym::arbitrary_enum_discriminant) {\n-                    self.maybe_report_invalid_custom_discriminants(&variants);\n-                }\n-            }\n-\n             ast::ItemKind::Impl(box ast::Impl { polarity, defaultness, ref of_trait, .. }) => {\n                 if let ast::ImplPolarity::Negative(span) = polarity {\n                     gate_feature_post!("}, {"sha": "9536fdbf0df87362eac7e509c289361d8be95c73", "filename": "compiler/rustc_error_codes/src/error_codes/E0732.md", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0732.md", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0732.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0732.md?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -3,8 +3,6 @@ An `enum` with a discriminant must specify a `#[repr(inttype)]`.\n Erroneous code example:\n \n ```compile_fail,E0732\n-#![feature(arbitrary_enum_discriminant)]\n-\n enum Enum { // error!\n     Unit = 1,\n     Tuple() = 2,\n@@ -20,8 +18,6 @@ is a well-defined way to extract a variant's discriminant from a value;\n for instance:\n \n ```\n-#![feature(arbitrary_enum_discriminant)]\n-\n #[repr(u8)]\n enum Enum {\n     Unit = 3,"}, {"sha": "db289a64046a7dac4f38c3642259761e0236c30f", "filename": "compiler/rustc_feature/src/accepted.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -53,6 +53,8 @@ declare_features! (\n     (accepted, abi_sysv64, \"1.24.0\", Some(36167), None),\n     /// Allows using ADX intrinsics from `core::arch::{x86, x86_64}`.\n     (accepted, adx_target_feature, \"1.61.0\", Some(44839), None),\n+    /// Allows explicit discriminants on non-unit enum variants.\n+    (accepted, arbitrary_enum_discriminant, \"CURRENT_RUSTC_VERSION\", Some(60553), None),\n     /// Allows using `sym` operands in inline assembly.\n     (accepted, asm_sym, \"CURRENT_RUSTC_VERSION\", Some(93333), None),\n     /// Allows the definition of associated constants in `trait` or `impl` blocks."}, {"sha": "4facb6140a300046e710b06a9aa82c35c6c15115", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -292,8 +292,6 @@ declare_features! (\n     (incomplete, adt_const_params, \"1.56.0\", Some(95174), None),\n     /// Allows defining an `#[alloc_error_handler]`.\n     (active, alloc_error_handler, \"1.29.0\", Some(51540), None),\n-    /// Allows explicit discriminants on non-unit enum variants.\n-    (active, arbitrary_enum_discriminant, \"1.37.0\", Some(60553), None),\n     /// Allows trait methods with arbitrary self types.\n     (active, arbitrary_self_types, \"1.23.0\", Some(44874), None),\n     /// Allows using `const` operands in inline assembly."}, {"sha": "b302cee4816fbf29f6b31235216f663a6bababab", "filename": "compiler/rustc_hir_analysis/src/check/check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcheck.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1180,7 +1180,7 @@ fn check_enum<'tcx>(tcx: TyCtxt<'tcx>, vs: &'tcx [hir::Variant<'tcx>], def_id: L\n         }\n     }\n \n-    if tcx.adt_def(def_id).repr().int.is_none() && tcx.features().arbitrary_enum_discriminant {\n+    if tcx.adt_def(def_id).repr().int.is_none() {\n         let is_unit = |var: &hir::Variant<'_>| matches!(var.data, hir::VariantData::Unit(..));\n \n         let has_disr = |var: &hir::Variant<'_>| var.disr_expr.is_some();"}, {"sha": "e0bb782270e22821f416ac44a45d91236e985ffd", "filename": "src/doc/unstable-book/src/language-features/arbitrary-enum-discriminant.md", "status": "removed", "additions": 0, "deletions": 37, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Farbitrary-enum-discriminant.md", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Farbitrary-enum-discriminant.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Farbitrary-enum-discriminant.md?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,37 +0,0 @@\n-# `arbitrary_enum_discriminant`\n-\n-The tracking issue for this feature is: [#60553]\n-\n-[#60553]: https://github.com/rust-lang/rust/issues/60553\n-\n-------------------------\n-\n-The `arbitrary_enum_discriminant` feature permits tuple-like and\n-struct-like enum variants with `#[repr(<int-type>)]` to have explicit discriminants.\n-\n-## Examples\n-\n-```rust\n-#![feature(arbitrary_enum_discriminant)]\n-\n-#[allow(dead_code)]\n-#[repr(u8)]\n-enum Enum {\n-    Unit = 3,\n-    Tuple(u16) = 2,\n-    Struct {\n-        a: u8,\n-        b: u16,\n-    } = 1,\n-}\n-\n-impl Enum {\n-    fn tag(&self) -> u8 {\n-        unsafe { *(self as *const Self as *const u8) }\n-    }\n-}\n-\n-assert_eq!(3, Enum::Unit.tag());\n-assert_eq!(2, Enum::Tuple(5).tag());\n-assert_eq!(1, Enum::Struct{a: 7, b: 11}.tag());\n-```"}, {"sha": "1679793ee6834e0404fad5e3ee7d37dd9eb92a2f", "filename": "src/test/ui/cast/issue-88621.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fcast%2Fissue-88621.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fcast%2Fissue-88621.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcast%2Fissue-88621.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,5 +1,3 @@\n-#![feature(arbitrary_enum_discriminant)]\n-\n #[repr(u8)]\n enum Kind2 {\n     Foo() = 1,"}, {"sha": "a6e5f70fdefa63dc66b816a3316a41d0e7d77ca1", "filename": "src/test/ui/enum-discriminant/arbitrary_enum_discriminant-no-repr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant-no-repr.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,5 +1,4 @@\n #![crate_type=\"lib\"]\n-#![feature(arbitrary_enum_discriminant)]\n \n enum Enum {\n //~^ ERROR `#[repr(inttype)]` must be specified"}, {"sha": "83e74a6e685a7dbcc3ee65d4f10c15a94cdfee86", "filename": "src/test/ui/enum-discriminant/arbitrary_enum_discriminant.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Farbitrary_enum_discriminant.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,5 +1,5 @@\n // run-pass\n-#![feature(arbitrary_enum_discriminant, test)]\n+#![feature(test)]\n \n extern crate test;\n "}, {"sha": "f3dfac298ad7b4b70c090d67b537d8dd0b87006e", "filename": "src/test/ui/enum-discriminant/discriminant_value.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fdiscriminant_value.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,6 +1,6 @@\n // run-pass\n #![allow(stable_features)]\n-#![feature(arbitrary_enum_discriminant, core, core_intrinsics)]\n+#![feature(core, core_intrinsics)]\n \n extern crate core;\n use core::intrinsics::discriminant_value;"}, {"sha": "3e90af4d36af3fddc8a6de00a048e8ff1eb9d4be", "filename": "src/test/ui/enum-discriminant/feature-gate-arbitrary_enum_discriminant.rs", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.rs?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,10 +0,0 @@\n-#![crate_type=\"lib\"]\n-\n-enum Enum {\n-  Unit = 1,\n-  //~^ ERROR custom discriminant values are not allowed in enums with tuple or struct variants\n-  Tuple() = 2,\n-  //~^ ERROR discriminants on non-unit variants are experimental\n-  Struct{} = 3,\n-  //~^ ERROR discriminants on non-unit variants are experimental\n-}"}, {"sha": "b5f61e6e991d842efbe57f34b6f89a008ab2c3a3", "filename": "src/test/ui/enum-discriminant/feature-gate-arbitrary_enum_discriminant.stderr", "status": "removed", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Ffeature-gate-arbitrary_enum_discriminant.stderr?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,36 +0,0 @@\n-error[E0658]: discriminants on non-unit variants are experimental\n-  --> $DIR/feature-gate-arbitrary_enum_discriminant.rs:6:13\n-   |\n-LL |   Tuple() = 2,\n-   |             ^\n-   |\n-   = note: see issue #60553 <https://github.com/rust-lang/rust/issues/60553> for more information\n-   = help: add `#![feature(arbitrary_enum_discriminant)]` to the crate attributes to enable\n-\n-error[E0658]: discriminants on non-unit variants are experimental\n-  --> $DIR/feature-gate-arbitrary_enum_discriminant.rs:8:14\n-   |\n-LL |   Struct{} = 3,\n-   |              ^\n-   |\n-   = note: see issue #60553 <https://github.com/rust-lang/rust/issues/60553> for more information\n-   = help: add `#![feature(arbitrary_enum_discriminant)]` to the crate attributes to enable\n-\n-error[E0658]: custom discriminant values are not allowed in enums with tuple or struct variants\n-  --> $DIR/feature-gate-arbitrary_enum_discriminant.rs:4:10\n-   |\n-LL |   Unit = 1,\n-   |          ^ disallowed custom discriminant\n-LL |\n-LL |   Tuple() = 2,\n-   |   ----------- tuple variant defined here\n-LL |\n-LL |   Struct{} = 3,\n-   |   ------------ struct variant defined here\n-   |\n-   = note: see issue #60553 <https://github.com/rust-lang/rust/issues/60553> for more information\n-   = help: add `#![feature(arbitrary_enum_discriminant)]` to the crate attributes to enable\n-\n-error: aborting due to 3 previous errors\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "ad9fcc25b4127da69aee30dd033a9aa853a61750", "filename": "src/test/ui/enum-discriminant/issue-70453-generics-in-discr-ice-2.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-generics-in-discr-ice-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-generics-in-discr-ice-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-generics-in-discr-ice-2.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,4 +1,4 @@\n-#![feature(arbitrary_enum_discriminant, core_intrinsics)]\n+#![feature(core_intrinsics)]\n \n extern crate core;\n use core::intrinsics::discriminant_value;"}, {"sha": "42a062239d34addbc5f30a5ac616d268eaada333", "filename": "src/test/ui/enum-discriminant/issue-70453-polymorphic-ctfe.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-polymorphic-ctfe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-polymorphic-ctfe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70453-polymorphic-ctfe.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,4 +1,4 @@\n-#![feature(arbitrary_enum_discriminant, core_intrinsics)]\n+#![feature(core_intrinsics)]\n \n extern crate core;\n use core::intrinsics::discriminant_value;"}, {"sha": "3adac7b72621ccc0cc5709420bf025392e652db5", "filename": "src/test/ui/enum-discriminant/issue-70509-partial_eq.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,5 +1,5 @@\n // run-pass\n-#![feature(repr128, arbitrary_enum_discriminant)]\n+#![feature(repr128)]\n //~^ WARN the feature `repr128` is incomplete\n \n #[derive(PartialEq, Debug)]"}, {"sha": "2eef930c3943439d8a5d8c3d6ec8b59d8de87df7", "filename": "src/test/ui/enum-discriminant/issue-70509-partial_eq.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fenum-discriminant%2Fissue-70509-partial_eq.stderr?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -1,7 +1,7 @@\n warning: the feature `repr128` is incomplete and may not be safe to use and/or cause compiler crashes\n   --> $DIR/issue-70509-partial_eq.rs:2:12\n    |\n-LL | #![feature(repr128, arbitrary_enum_discriminant)]\n+LL | #![feature(repr128)]\n    |            ^^^^^^^\n    |\n    = note: see issue #56071 <https://github.com/rust-lang/rust/issues/56071> for more information"}, {"sha": "ec3860a322fc53bf9b8bbcc9c113a367dae288c2", "filename": "src/test/ui/intrinsics/panic-uninitialized-zeroed.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fintrinsics%2Fpanic-uninitialized-zeroed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fintrinsics%2Fpanic-uninitialized-zeroed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fintrinsics%2Fpanic-uninitialized-zeroed.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -7,7 +7,7 @@\n \n // This test checks panic emitted from `mem::{uninitialized,zeroed}`.\n \n-#![feature(never_type, arbitrary_enum_discriminant)]\n+#![feature(never_type)]\n #![allow(deprecated, invalid_value)]\n \n use std::{"}, {"sha": "ab14c35893d0a74d759e8ad1085eae2cea73c045", "filename": "src/test/ui/macros/macros-nonfatal-errors.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/988e75bb65f688d76f4f80e0fb72ef21e831d0b0/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fmacros-nonfatal-errors.rs?ref=988e75bb65f688d76f4f80e0fb72ef21e831d0b0", "patch": "@@ -4,7 +4,7 @@\n // immediately, so that we get more errors listed at a time.\n \n #![feature(trace_macros, concat_idents)]\n-#![feature(stmt_expr_attributes, arbitrary_enum_discriminant)]\n+#![feature(stmt_expr_attributes)]\n \n use std::arch::asm;\n "}, {"sha": "7bf0e64f2c0a30eecf3963b7bee955d7059ce399", "filename": "src/test/ui/parser/issues/issue-17383.rs", "status": "removed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.rs?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,7 +0,0 @@\n-enum X {\n-    A = 3,\n-    //~^ ERROR custom discriminant values are not allowed in enums with tuple or struct variants\n-    B(usize)\n-}\n-\n-fn main() {}"}, {"sha": "265d6e14866149a674cc7a6cb9818b7628463709", "filename": "src/test/ui/parser/issues/issue-17383.stderr", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-17383.stderr?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,15 +0,0 @@\n-error[E0658]: custom discriminant values are not allowed in enums with tuple or struct variants\n-  --> $DIR/issue-17383.rs:2:9\n-   |\n-LL |     A = 3,\n-   |         ^ disallowed custom discriminant\n-LL |\n-LL |     B(usize)\n-   |     -------- tuple variant defined here\n-   |\n-   = note: see issue #60553 <https://github.com/rust-lang/rust/issues/60553> for more information\n-   = help: add `#![feature(arbitrary_enum_discriminant)]` to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "a9cfdd549c752233f40a6608474f7a9d362ee375", "filename": "src/test/ui/parser/tag-variant-disr-non-nullary.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.rs?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,12 +0,0 @@\n-enum Color {\n-    Red = 0xff0000,\n-    //~^ ERROR custom discriminant values are not allowed in enums with tuple or struct variants\n-    Green = 0x00ff00,\n-    Blue = 0x0000ff,\n-    Black = 0x000000,\n-    White = 0xffffff,\n-    Other(usize),\n-    Other2(usize, usize),\n-}\n-\n-fn main() {}"}, {"sha": "79f044a0675b7b075f3756eaf7d51be8fbdce74f", "filename": "src/test/ui/parser/tag-variant-disr-non-nullary.stderr", "status": "removed", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/eecde5850cade0c058dc12330081329b31a826c7/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Ftag-variant-disr-non-nullary.stderr?ref=eecde5850cade0c058dc12330081329b31a826c7", "patch": "@@ -1,25 +0,0 @@\n-error[E0658]: custom discriminant values are not allowed in enums with tuple or struct variants\n-  --> $DIR/tag-variant-disr-non-nullary.rs:2:11\n-   |\n-LL |     Red = 0xff0000,\n-   |           ^^^^^^^^ disallowed custom discriminant\n-LL |\n-LL |     Green = 0x00ff00,\n-   |             ^^^^^^^^ disallowed custom discriminant\n-LL |     Blue = 0x0000ff,\n-   |            ^^^^^^^^ disallowed custom discriminant\n-LL |     Black = 0x000000,\n-   |             ^^^^^^^^ disallowed custom discriminant\n-LL |     White = 0xffffff,\n-   |             ^^^^^^^^ disallowed custom discriminant\n-LL |     Other(usize),\n-   |     ------------ tuple variant defined here\n-LL |     Other2(usize, usize),\n-   |     -------------------- tuple variant defined here\n-   |\n-   = note: see issue #60553 <https://github.com/rust-lang/rust/issues/60553> for more information\n-   = help: add `#![feature(arbitrary_enum_discriminant)]` to the crate attributes to enable\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}]}