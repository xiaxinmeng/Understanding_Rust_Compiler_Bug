{"sha": "331d1db3174853a435991c9341367c235e89eca4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzMWQxZGIzMTc0ODUzYTQzNTk5MWM5MzQxMzY3YzIzNWU4OWVjYTQ=", "commit": {"author": {"name": "o0Ignition0o", "email": "jeremy.lempereur@gmail.com", "date": "2020-03-31T07:39:04Z"}, "committer": {"name": "o0Ignition0o", "email": "jeremy.lempereur@gmail.com", "date": "2020-03-31T12:43:39Z"}, "message": "Add crate versions when running cargo -p commands.\n\nUntil now cargo commands with the -p flag would pass the package name only.\nIt doesn't play super well with the toml Renaming dependencies feature.\nThis commit specifies the package name and version when a cargo command is run with the -p flag,\nto avoid ambiguities.", "tree": {"sha": "84a2bab2fe9c53afb4f7503c68f44610b8f4d2a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84a2bab2fe9c53afb4f7503c68f44610b8f4d2a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/331d1db3174853a435991c9341367c235e89eca4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/331d1db3174853a435991c9341367c235e89eca4", "html_url": "https://github.com/rust-lang/rust/commit/331d1db3174853a435991c9341367c235e89eca4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/331d1db3174853a435991c9341367c235e89eca4/comments", "author": {"login": "o0Ignition0o", "id": 9465678, "node_id": "MDQ6VXNlcjk0NjU2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/9465678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/o0Ignition0o", "html_url": "https://github.com/o0Ignition0o", "followers_url": "https://api.github.com/users/o0Ignition0o/followers", "following_url": "https://api.github.com/users/o0Ignition0o/following{/other_user}", "gists_url": "https://api.github.com/users/o0Ignition0o/gists{/gist_id}", "starred_url": "https://api.github.com/users/o0Ignition0o/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/o0Ignition0o/subscriptions", "organizations_url": "https://api.github.com/users/o0Ignition0o/orgs", "repos_url": "https://api.github.com/users/o0Ignition0o/repos", "events_url": "https://api.github.com/users/o0Ignition0o/events{/privacy}", "received_events_url": "https://api.github.com/users/o0Ignition0o/received_events", "type": "User", "site_admin": false}, "committer": {"login": "o0Ignition0o", "id": 9465678, "node_id": "MDQ6VXNlcjk0NjU2Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/9465678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/o0Ignition0o", "html_url": "https://github.com/o0Ignition0o", "followers_url": "https://api.github.com/users/o0Ignition0o/followers", "following_url": "https://api.github.com/users/o0Ignition0o/following{/other_user}", "gists_url": "https://api.github.com/users/o0Ignition0o/gists{/gist_id}", "starred_url": "https://api.github.com/users/o0Ignition0o/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/o0Ignition0o/subscriptions", "organizations_url": "https://api.github.com/users/o0Ignition0o/orgs", "repos_url": "https://api.github.com/users/o0Ignition0o/repos", "events_url": "https://api.github.com/users/o0Ignition0o/events{/privacy}", "received_events_url": "https://api.github.com/users/o0Ignition0o/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "668980d8657bd358b83f74e2f54f5e228f7393ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/668980d8657bd358b83f74e2f54f5e228f7393ed", "html_url": "https://github.com/rust-lang/rust/commit/668980d8657bd358b83f74e2f54f5e228f7393ed"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "738fd6f610cb6a1831511dee520241e81591fb8a", "filename": "crates/ra_project_model/src/cargo_workspace.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/331d1db3174853a435991c9341367c235e89eca4/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/331d1db3174853a435991c9341367c235e89eca4/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fcargo_workspace.rs?ref=331d1db3174853a435991c9341367c235e89eca4", "patch": "@@ -75,6 +75,7 @@ pub type Target = Idx<TargetData>;\n \n #[derive(Debug, Clone)]\n pub struct PackageData {\n+    pub id: String,\n     pub name: String,\n     pub manifest: PathBuf,\n     pub targets: Vec<Target>,\n@@ -180,6 +181,7 @@ impl CargoWorkspace {\n                 .with_context(|| format!(\"Failed to parse edition {}\", edition))?;\n             let pkg = packages.alloc(PackageData {\n                 name,\n+                id: id.to_string(),\n                 manifest: manifest_path,\n                 targets: Vec::new(),\n                 is_member,\n@@ -249,6 +251,18 @@ impl CargoWorkspace {\n     pub fn workspace_root(&self) -> &Path {\n         &self.workspace_root\n     }\n+\n+    pub fn package_flag(&self, package: &PackageData) -> String {\n+        if self.is_unique(&*package.name) {\n+            package.name.clone()\n+        } else {\n+            package.id.clone()\n+        }\n+    }\n+\n+    fn is_unique(&self, name: &str) -> bool {\n+        self.packages.iter().filter(|(_, v)| v.name == name).count() == 1\n+    }\n }\n \n #[derive(Debug, Clone, Default)]"}, {"sha": "942c303287cff1221e3beed7a0ad7eae1065a091", "filename": "crates/rust-analyzer/src/cargo_target_spec.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/331d1db3174853a435991c9341367c235e89eca4/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/331d1db3174853a435991c9341367c235e89eca4/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcargo_target_spec.rs?ref=331d1db3174853a435991c9341367c235e89eca4", "patch": "@@ -77,7 +77,7 @@ impl CargoTargetSpec {\n             ProjectWorkspace::Cargo { cargo, .. } => {\n                 let tgt = cargo.target_by_root(&path)?;\n                 Some(CargoTargetSpec {\n-                    package: cargo[cargo[tgt].package].name.clone(),\n+                    package: cargo.package_flag(&cargo[cargo[tgt].package]),\n                     target: cargo[tgt].name.clone(),\n                     target_kind: cargo[tgt].kind,\n                 })"}]}