{"sha": "e7709b3d44da921a65c009eb52492830141d330a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU3NzA5YjNkNDRkYTkyMWE2NWMwMDllYjUyNDkyODMwMTQxZDMzMGE=", "commit": {"author": {"name": "Kornel", "email": "kornel@geekhood.net", "date": "2018-08-19T18:46:05Z"}, "committer": {"name": "Kornel", "email": "kornel@geekhood.net", "date": "2018-08-23T14:01:28Z"}, "message": "Discourage overuse of mem::forget", "tree": {"sha": "c6d951fdd4fb339f1626153f9fc36a832f59eacc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6d951fdd4fb339f1626153f9fc36a832f59eacc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e7709b3d44da921a65c009eb52492830141d330a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e7709b3d44da921a65c009eb52492830141d330a", "html_url": "https://github.com/rust-lang/rust/commit/e7709b3d44da921a65c009eb52492830141d330a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e7709b3d44da921a65c009eb52492830141d330a/comments", "author": {"login": "kornelski", "id": 72159, "node_id": "MDQ6VXNlcjcyMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kornelski", "html_url": "https://github.com/kornelski", "followers_url": "https://api.github.com/users/kornelski/followers", "following_url": "https://api.github.com/users/kornelski/following{/other_user}", "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}", "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions", "organizations_url": "https://api.github.com/users/kornelski/orgs", "repos_url": "https://api.github.com/users/kornelski/repos", "events_url": "https://api.github.com/users/kornelski/events{/privacy}", "received_events_url": "https://api.github.com/users/kornelski/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kornelski", "id": 72159, "node_id": "MDQ6VXNlcjcyMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kornelski", "html_url": "https://github.com/kornelski", "followers_url": "https://api.github.com/users/kornelski/followers", "following_url": "https://api.github.com/users/kornelski/following{/other_user}", "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}", "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions", "organizations_url": "https://api.github.com/users/kornelski/orgs", "repos_url": "https://api.github.com/users/kornelski/repos", "events_url": "https://api.github.com/users/kornelski/events{/privacy}", "received_events_url": "https://api.github.com/users/kornelski/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35bf1ae25799a4e62131159f052e0a3cbd27c960", "url": "https://api.github.com/repos/rust-lang/rust/commits/35bf1ae25799a4e62131159f052e0a3cbd27c960", "html_url": "https://github.com/rust-lang/rust/commit/35bf1ae25799a4e62131159f052e0a3cbd27c960"}], "stats": {"total": 46, "additions": 7, "deletions": 39}, "files": [{"sha": "67cceb9d5360590d420374229a6bb943101b55e5", "filename": "src/libcore/mem.rs", "status": "modified", "additions": 7, "deletions": 39, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/e7709b3d44da921a65c009eb52492830141d330a/src%2Flibcore%2Fmem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e7709b3d44da921a65c009eb52492830141d330a/src%2Flibcore%2Fmem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmem.rs?ref=e7709b3d44da921a65c009eb52492830141d330a", "patch": "@@ -29,13 +29,15 @@ use ops::{Deref, DerefMut, CoerceUnsized};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n pub use intrinsics::transmute;\n \n-/// Leaks a value: takes ownership and \"forgets\" about the value **without running\n-/// its destructor**.\n+/// Takes ownership and \"forgets\" about the value **without running its destructor**.\n ///\n /// Any resources the value manages, such as heap memory or a file handle, will linger\n-/// forever in an unreachable state.\n+/// forever in an unreachable state. However, it does not guarantee that pointers\n+/// to this memory will remain valid.\n ///\n-/// If you want to dispose of a value properly, running its destructor, see\n+/// * If you want to leak memory, see [`Box::leak`][leak].\n+/// * If you want to obtain a raw pointer to the memory, see [`Box::into_raw`][into_raw].\n+/// * If you want to dispose of a value properly, running its destructor, see\n /// [`mem::drop`][drop].\n ///\n /// # Safety\n@@ -59,15 +61,6 @@ pub use intrinsics::transmute;\n ///\n /// # Examples\n ///\n-/// Leak some heap memory by never deallocating it:\n-///\n-/// ```\n-/// use std::mem;\n-///\n-/// let heap_memory = Box::new(3);\n-/// mem::forget(heap_memory);\n-/// ```\n-///\n /// Leak an I/O object, never closing the file:\n ///\n /// ```no_run\n@@ -137,38 +130,13 @@ pub use intrinsics::transmute;\n /// }\n /// ```\n ///\n-/// ## Use case 3\n-///\n-/// You are transferring ownership across a [FFI] boundary to code written in\n-/// another language. You need to `forget` the value on the Rust side because Rust\n-/// code is no longer responsible for it.\n-///\n-/// ```no_run\n-/// use std::mem;\n-///\n-/// extern \"C\" {\n-///     fn my_c_function(x: *const u32);\n-/// }\n-///\n-/// let x: Box<u32> = Box::new(3);\n-///\n-/// // Transfer ownership into C code.\n-/// unsafe {\n-///     my_c_function(&*x);\n-/// }\n-/// mem::forget(x);\n-/// ```\n-///\n-/// In this case, C code must call back into Rust to free the object. Calling C's `free`\n-/// function on a [`Box`][box] is *not* safe! Also, `Box` provides an [`into_raw`][into_raw]\n-/// method which is the preferred way to do this in practice.\n-///\n /// [drop]: fn.drop.html\n /// [uninit]: fn.uninitialized.html\n /// [clone]: ../clone/trait.Clone.html\n /// [swap]: fn.swap.html\n /// [FFI]: ../../book/first-edition/ffi.html\n /// [box]: ../../std/boxed/struct.Box.html\n+/// [leak]: ../../std/boxed/struct.Box.html#method.leak\n /// [into_raw]: ../../std/boxed/struct.Box.html#method.into_raw\n /// [ub]: ../../reference/behavior-considered-undefined.html\n #[inline]"}]}