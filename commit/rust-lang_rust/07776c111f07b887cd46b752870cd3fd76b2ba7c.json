{"sha": "07776c111f07b887cd46b752870cd3fd76b2ba7c", "node_id": "C_kwDOAAsO6NoAKDA3Nzc2YzExMWYwN2I4ODdjZDQ2Yjc1Mjg3MGNkM2ZkNzZiMmJhN2M", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-27T23:05:14Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-03-27T23:10:02Z"}, "message": "do not suggest enum tuple variant for named field variant", "tree": {"sha": "09a146c0ec67f7cc9dc35bcfc9650b7b1a7c1ae7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09a146c0ec67f7cc9dc35bcfc9650b7b1a7c1ae7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07776c111f07b887cd46b752870cd3fd76b2ba7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07776c111f07b887cd46b752870cd3fd76b2ba7c", "html_url": "https://github.com/rust-lang/rust/commit/07776c111f07b887cd46b752870cd3fd76b2ba7c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07776c111f07b887cd46b752870cd3fd76b2ba7c/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd6683fcda991536c54d419a6ecc710f21226225", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd6683fcda991536c54d419a6ecc710f21226225", "html_url": "https://github.com/rust-lang/rust/commit/dd6683fcda991536c54d419a6ecc710f21226225"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "17b08fe1e403942da6273e7d30f9d16c3bba1986", "filename": "compiler/rustc_typeck/src/check/demand.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/07776c111f07b887cd46b752870cd3fd76b2ba7c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07776c111f07b887cd46b752870cd3fd76b2ba7c/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fdemand.rs?ref=07776c111f07b887cd46b752870cd3fd76b2ba7c", "patch": "@@ -336,7 +336,9 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             let compatible_variants: Vec<String> = expected_adt\n                 .variants()\n                 .iter()\n-                .filter(|variant| variant.fields.len() == 1)\n+                .filter(|variant| {\n+                    variant.fields.len() == 1 && variant.ctor_kind == hir::def::CtorKind::Fn\n+                })\n                 .filter_map(|variant| {\n                     let sole_field = &variant.fields[0];\n                     let sole_field_ty = sole_field.ty(self.tcx, substs);"}, {"sha": "d9457cf5e3251d50e440c08ab90ae336454480af", "filename": "src/test/ui/did_you_mean/compatible-variants.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/07776c111f07b887cd46b752870cd3fd76b2ba7c/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07776c111f07b887cd46b752870cd3fd76b2ba7c/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.rs?ref=07776c111f07b887cd46b752870cd3fd76b2ba7c", "patch": "@@ -64,3 +64,18 @@ fn main() {\n     //~^ ERROR mismatched types\n     //~| HELP try wrapping\n }\n+\n+enum A {\n+    B { b: B},\n+}\n+\n+enum B {\n+    Fst,\n+    Snd,\n+}\n+\n+fn foo() {\n+    // We don't want to suggest `A::B(B::Fst)` here.\n+    let a: A = B::Fst;\n+    //~^ ERROR mismatched types\n+}\n\\ No newline at end of file"}, {"sha": "6224af3976b91f383eaaf22c46625ac5bb1f7176", "filename": "src/test/ui/did_you_mean/compatible-variants.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/07776c111f07b887cd46b752870cd3fd76b2ba7c/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/07776c111f07b887cd46b752870cd3fd76b2ba7c/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdid_you_mean%2Fcompatible-variants.stderr?ref=07776c111f07b887cd46b752870cd3fd76b2ba7c", "patch": "@@ -190,6 +190,14 @@ help: try wrapping the expression in `Some`\n LL |     let _ = Foo { bar: Some(bar) };\n    |                   ++++++++++   +\n \n-error: aborting due to 11 previous errors\n+error[E0308]: mismatched types\n+  --> $DIR/compatible-variants.rs:79:16\n+   |\n+LL |     let a: A = B::Fst;\n+   |            -   ^^^^^^ expected enum `A`, found enum `B`\n+   |            |\n+   |            expected due to this\n+\n+error: aborting due to 12 previous errors\n \n For more information about this error, try `rustc --explain E0308`."}]}