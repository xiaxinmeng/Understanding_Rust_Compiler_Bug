{"sha": "ea22d245b671f97b820cf761108251c6292c3152", "node_id": "C_kwDOAAsO6NoAKGVhMjJkMjQ1YjY3MWY5N2I4MjBjZjc2MTEwODI1MWM2MjkyYzMxNTI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-05T20:42:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-05T20:42:55Z"}, "message": "Auto merge of #14499 - DropDemBits:drive-by-fixmes, r=Veykril\n\nminor: Fix some simple FIXMEs\n\nEach FIXME fix has been split into its own commit, since they're all pretty independent changes.\n\n(Forgot to open a PR for this a few days ago, oops)", "tree": {"sha": "44d7c9817c5736c76287c41f265d1dd91cb0f680", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44d7c9817c5736c76287c41f265d1dd91cb0f680"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea22d245b671f97b820cf761108251c6292c3152", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea22d245b671f97b820cf761108251c6292c3152", "html_url": "https://github.com/rust-lang/rust/commit/ea22d245b671f97b820cf761108251c6292c3152", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea22d245b671f97b820cf761108251c6292c3152/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec803031fd4389fc5031e73c68df6570587ca1c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec803031fd4389fc5031e73c68df6570587ca1c5", "html_url": "https://github.com/rust-lang/rust/commit/ec803031fd4389fc5031e73c68df6570587ca1c5"}, {"sha": "0a144f7fffda62e2d4fe52dca41a8c39a96cce36", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a144f7fffda62e2d4fe52dca41a8c39a96cce36", "html_url": "https://github.com/rust-lang/rust/commit/0a144f7fffda62e2d4fe52dca41a8c39a96cce36"}], "stats": {"total": 34, "additions": 14, "deletions": 20}, "files": [{"sha": "3da90e9052f2f29b80f321b94df3ea152b8e2966", "filename": "crates/ide-assists/src/tests/sourcegen.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fide-assists%2Fsrc%2Ftests%2Fsourcegen.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fide-assists%2Fsrc%2Ftests%2Fsourcegen.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-assists%2Fsrc%2Ftests%2Fsourcegen.rs?ref=ea22d245b671f97b820cf761108251c6292c3152", "patch": "@@ -90,8 +90,6 @@ impl Assist {\n             let comment_blocks = sourcegen::CommentBlock::extract(\"Assist\", &text);\n \n             for block in comment_blocks {\n-                // FIXME: doesn't support blank lines yet, need to tweak\n-                // `extract_comment_blocks` for that.\n                 let id = block.id;\n                 assert!(\n                     id.chars().all(|it| it.is_ascii_lowercase() || it == '_'),"}, {"sha": "936362914aec068aeacff47a85f47f5e5af81084", "filename": "crates/ide/src/syntax_highlighting/highlight.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs?ref=ea22d245b671f97b820cf761108251c6292c3152", "patch": "@@ -675,14 +675,12 @@ fn is_consumed_lvalue(node: &SyntaxNode, local: &hir::Local, db: &RootDatabase)\n \n /// Returns true if the parent nodes of `node` all match the `SyntaxKind`s in `kinds` exactly.\n fn parents_match(mut node: NodeOrToken<SyntaxNode, SyntaxToken>, mut kinds: &[SyntaxKind]) -> bool {\n-    while let (Some(parent), [kind, rest @ ..]) = (&node.parent(), kinds) {\n+    while let (Some(parent), [kind, rest @ ..]) = (node.parent(), kinds) {\n         if parent.kind() != *kind {\n             return false;\n         }\n \n-        // FIXME: Would be nice to get parent out of the match, but binding by-move and by-value\n-        // in the same pattern is unstable: rust-lang/rust#68354.\n-        node = node.parent().unwrap().into();\n+        node = parent.into();\n         kinds = rest;\n     }\n "}, {"sha": "c5da6ceb4d1980c45c78d162e201886aee8542a9", "filename": "crates/sourcegen/src/lib.rs", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fsourcegen%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea22d245b671f97b820cf761108251c6292c3152/crates%2Fsourcegen%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsourcegen%2Fsrc%2Flib.rs?ref=ea22d245b671f97b820cf761108251c6292c3152", "patch": "@@ -58,21 +58,19 @@ impl CommentBlock {\n         assert!(tag.starts_with(char::is_uppercase));\n \n         let tag = format!(\"{tag}:\");\n-        // Would be nice if we had `.retain_mut` here!\n-        CommentBlock::extract_untagged(text)\n-            .into_iter()\n-            .filter_map(|mut block| {\n-                let first = block.contents.remove(0);\n-                first.strip_prefix(&tag).map(|id| {\n-                    if block.is_doc {\n-                        panic!(\"Use plain (non-doc) comments with tags like {tag}:\\n    {first}\");\n-                    }\n+        let mut blocks = CommentBlock::extract_untagged(text);\n+        blocks.retain_mut(|block| {\n+            let first = block.contents.remove(0);\n+            let Some(id) = first.strip_prefix(&tag) else { return false; };\n+\n+            if block.is_doc {\n+                panic!(\"Use plain (non-doc) comments with tags like {tag}:\\n    {first}\");\n+            }\n \n-                    block.id = id.trim().to_string();\n-                    block\n-                })\n-            })\n-            .collect()\n+            block.id = id.trim().to_string();\n+            true\n+        });\n+        blocks\n     }\n \n     pub fn extract_untagged(text: &str) -> Vec<CommentBlock> {"}]}