{"sha": "08e561ae70bc42b755b3831b3ce880745228892c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4ZTU2MWFlNzBiYzQyYjc1NWIzODMxYjNjZTg4MDc0NTIyODg5MmM=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-05-15T21:01:54Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-05-23T04:57:02Z"}, "message": "librustc: Disable borrow check debugging even when rustc is compiled with -O0.\n\nThis improves -O0 compile times dramatically.", "tree": {"sha": "77ded3b004e4d6ec219a04d376889a6007a083de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77ded3b004e4d6ec219a04d376889a6007a083de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/08e561ae70bc42b755b3831b3ce880745228892c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/08e561ae70bc42b755b3831b3ce880745228892c", "html_url": "https://github.com/rust-lang/rust/commit/08e561ae70bc42b755b3831b3ce880745228892c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/08e561ae70bc42b755b3831b3ce880745228892c/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca9bb2d9ace2bf085dc276e241f6707e0402093f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca9bb2d9ace2bf085dc276e241f6707e0402093f", "html_url": "https://github.com/rust-lang/rust/commit/ca9bb2d9ace2bf085dc276e241f6707e0402093f"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "9b59c46e5e831690ffa886bd248541f02001c852", "filename": "Makefile.in", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/08e561ae70bc42b755b3831b3ce880745228892c/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/08e561ae70bc42b755b3831b3ce880745228892c/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=08e561ae70bc42b755b3831b3ce880745228892c", "patch": "@@ -122,6 +122,10 @@ endif\n ifdef TRACE\n   CFG_RUSTC_FLAGS += -Z trace\n endif\n+ifndef DEBUG_BORROWS\n+  RUSTFLAGS_STAGE1 += -Z no-debug-borrows\n+  RUSTFLAGS_STAGE2 += -Z no-debug-borrows\n+endif\n \n # platform-specific auto-configuration\n include $(CFG_SRC_DIR)mk/platform.mk"}, {"sha": "a340422d02311b70c122eb0c391cca7beb7908e5", "filename": "src/librustc/driver/session.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/08e561ae70bc42b755b3831b3ce880745228892c/src%2Flibrustc%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08e561ae70bc42b755b3831b3ce880745228892c/src%2Flibrustc%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fsession.rs?ref=08e561ae70bc42b755b3831b3ce880745228892c", "patch": "@@ -66,6 +66,7 @@ pub static debug_info: uint = 1 << 20;\n pub static extra_debug_info: uint = 1 << 21;\n pub static statik: uint = 1 << 22;\n pub static print_link_args: uint = 1 << 23;\n+pub static no_debug_borrows: uint = 1 << 24;\n \n pub fn debugging_opts_map() -> ~[(~str, ~str, uint)] {\n     ~[(~\"verbose\", ~\"in general, enable more debug printouts\", verbose),\n@@ -100,7 +101,10 @@ pub fn debugging_opts_map() -> ~[(~str, ~str, uint)] {\n       extra_debug_info),\n      (~\"debug-info\", ~\"Produce debug info (experimental)\", debug_info),\n      (~\"static\", ~\"Use or produce static libraries or binaries \" +\n-      \"(experimental)\", statik)\n+      \"(experimental)\", statik),\n+     (~\"no-debug-borrows\",\n+      ~\"do not show where borrow checks fail\",\n+      no_debug_borrows),\n     ]\n }\n \n@@ -141,7 +145,7 @@ pub struct options {\n     parse_only: bool,\n     no_trans: bool,\n     debugging_opts: uint,\n-    android_cross_path: Option<~str>\n+    android_cross_path: Option<~str>,\n }\n \n pub struct crate_metadata {\n@@ -271,6 +275,9 @@ pub impl Session_ {\n     fn no_monomorphic_collapse(@self) -> bool {\n         self.debugging_opt(no_monomorphic_collapse)\n     }\n+    fn debug_borrows(@self) -> bool {\n+        self.opts.optimize == No && !self.debugging_opt(no_debug_borrows)\n+    }\n \n     fn str_of(@self, id: ast::ident) -> @~str {\n         self.parse_sess.interner.get(id)\n@@ -308,7 +315,7 @@ pub fn basic_options() -> @options {\n         parse_only: false,\n         no_trans: false,\n         debugging_opts: 0u,\n-        android_cross_path: None\n+        android_cross_path: None,\n     }\n }\n "}, {"sha": "0d13d27b6536792fa951e3e7dc30815e5a390a6a", "filename": "src/librustc/middle/trans/write_guard.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/08e561ae70bc42b755b3831b3ce880745228892c/src%2Flibrustc%2Fmiddle%2Ftrans%2Fwrite_guard.rs", "raw_url": "https://github.com/rust-lang/rust/raw/08e561ae70bc42b755b3831b3ce880745228892c/src%2Flibrustc%2Fmiddle%2Ftrans%2Fwrite_guard.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fwrite_guard.rs?ref=08e561ae70bc42b755b3831b3ce880745228892c", "patch": "@@ -74,7 +74,7 @@ pub fn return_to_mut(mut bcx: block,\n     let bits_val =\n         Load(bcx, bits_val_ref);\n \n-    if bcx.tcx().sess.opts.optimize == session::No {\n+    if bcx.tcx().sess.debug_borrows() {\n         bcx = callee::trans_lang_call(\n             bcx,\n             bcx.tcx().lang_items.unrecord_borrow_fn(),\n@@ -160,7 +160,7 @@ fn root(datum: &Datum,\n                 ],\n                 expr::SaveIn(scratch_bits.val));\n \n-            if bcx.tcx().sess.opts.optimize == session::No {\n+            if bcx.tcx().sess.debug_borrows() {\n                 bcx = callee::trans_lang_call(\n                     bcx,\n                     bcx.tcx().lang_items.record_borrow_fn(),"}]}