{"sha": "b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5YTI2YmY0YjFiOThiZWVhYWY0ZGFlMTZjNGI1OTBhZWM4N2I1NGI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-02T17:22:18Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-02T17:22:18Z"}, "message": "rollup merge of #20334: nagisa/ffi-llvm\n\nFixes #20313\n\nr? @huonw", "tree": {"sha": "b01e699db5029ad17f0b18dd42095bc33bc90369", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b01e699db5029ad17f0b18dd42095bc33bc90369"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "html_url": "https://github.com/rust-lang/rust/commit/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "656d5bbb92a7f811c0ab172b2bda484b1c890924", "url": "https://api.github.com/repos/rust-lang/rust/commits/656d5bbb92a7f811c0ab172b2bda484b1c890924", "html_url": "https://github.com/rust-lang/rust/commit/656d5bbb92a7f811c0ab172b2bda484b1c890924"}, {"sha": "f1b64017d044018c649492b75708429749408ed0", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1b64017d044018c649492b75708429749408ed0", "html_url": "https://github.com/rust-lang/rust/commit/f1b64017d044018c649492b75708429749408ed0"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "ec44dc20386b48fb05ecb19122efd5105c1932e3", "filename": "src/doc/reference.md", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Fdoc%2Freference.md", "raw_url": "https://github.com/rust-lang/rust/raw/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Fdoc%2Freference.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Freference.md?ref=b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "patch": "@@ -2561,6 +2561,9 @@ The currently implemented features of the reference compiler are:\n                 if the system linker is not used then specifying custom flags\n                 doesn't have much meaning.\n \n+* `link_llvm_intrinsics` \u2013 Allows linking to LLVM intrinsics via\n+                           `#[link_name=\"llvm.*\"]`.\n+\n * `linkage` - Allows use of the `linkage` attribute, which is not portable.\n \n * `log_syntax` - Allows use of the `log_syntax` macro attribute, which is a"}, {"sha": "035b748a7db47b48eb60e36de46121b06d69b067", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "patch": "@@ -56,6 +56,7 @@ static KNOWN_FEATURES: &'static [(&'static str, Status)] = &[\n     (\"simd\", Active),\n     (\"default_type_params\", Active),\n     (\"quote\", Active),\n+    (\"link_llvm_intrinsics\", Active),\n     (\"linkage\", Active),\n     (\"struct_inherit\", Removed),\n \n@@ -327,6 +328,16 @@ impl<'a, 'v> Visitor<'v> for PostExpansionVisitor<'a> {\n                               \"the `linkage` attribute is experimental \\\n                                and not portable across platforms\")\n         }\n+\n+        let links_to_llvm = match attr::first_attr_value_str_by_name(i.attrs[], \"link_name\") {\n+            Some(val) => val.get().starts_with(\"llvm.\"),\n+            _ => false\n+        };\n+        if links_to_llvm {\n+            self.gate_feature(\"link_llvm_intrinsics\", i.span,\n+                              \"linking to LLVM intrinsics is experimental\");\n+        }\n+\n         visit::walk_foreign_item(self, i)\n     }\n "}, {"sha": "dfb23c050368937aef083806596d86cc1288f74f", "filename": "src/test/compile-fail/issue-20313.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Ftest%2Fcompile-fail%2Fissue-20313.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Ftest%2Fcompile-fail%2Fissue-20313.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-20313.rs?ref=b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+extern {\n+    #[link_name = \"llvm.sqrt.f32\"]\n+    fn sqrt(x: f32) -> f32; //~ ERROR linking to LLVM intrinsics is experimental\n+}\n+\n+fn main(){\n+}"}, {"sha": "47791ceecb67d3144850b758c6001cb9970e2335", "filename": "src/test/run-pass/issue-20313.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Ftest%2Frun-pass%2Fissue-20313.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b/src%2Ftest%2Frun-pass%2Fissue-20313.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-20313.rs?ref=b9a26bf4b1b98beeaaf4dae16c4b590aec87b54b", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+#![feature(link_llvm_intrinsics)]\n+\n+extern {\n+    #[link_name = \"llvm.sqrt.f32\"]\n+    fn sqrt(x: f32) -> f32;\n+}\n+\n+fn main(){\n+}"}]}