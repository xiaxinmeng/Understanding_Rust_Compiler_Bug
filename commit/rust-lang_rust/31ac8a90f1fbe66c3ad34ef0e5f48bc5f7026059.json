{"sha": "31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxYWM4YTkwZjFmYmU2NmMzYWQzNGVmMGU1ZjQ4YmM1ZjcwMjYwNTk=", "commit": {"author": {"name": "Aaron Turon", "email": "aturon@mozilla.com", "date": "2014-07-23T22:43:03Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-07-24T14:26:17Z"}, "message": "rustdoc: make table of contents optional\n\nrustdoc currently determines whether to produce a table of\ncontents (along with numbered sections) from the input type: yes for\nmarkdown input, no for Rust input. This commit adds a flag to disable\nthe table of contents for markdown input, which is useful for embedding\nthe output in a larger context.", "tree": {"sha": "771f0dfaee63a99ce9d69736b0bb43f10a7a98cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/771f0dfaee63a99ce9d69736b0bb43f10a7a98cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "html_url": "https://github.com/rust-lang/rust/commit/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059/comments", "author": {"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62bddfa0a5bf7753f835aa9c299232eb75c7bdaa", "url": "https://api.github.com/repos/rust-lang/rust/commits/62bddfa0a5bf7753f835aa9c299232eb75c7bdaa", "html_url": "https://github.com/rust-lang/rust/commit/62bddfa0a5bf7753f835aa9c299232eb75c7bdaa"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "70dc230b54169590ece550429742a0b1afd18e80", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "patch": "@@ -131,7 +131,8 @@ pub fn opts() -> Vec<getopts::OptGroup> {\n                  Markdown file or generated documentation\",\n                  \"FILES\"),\n         optopt(\"\", \"markdown-playground-url\",\n-               \"URL to send code snippets to\", \"URL\")\n+               \"URL to send code snippets to\", \"URL\"),\n+        optflag(\"\", \"markdown-no-toc\", \"don't include table of contents\")\n     )\n }\n \n@@ -220,7 +221,8 @@ pub fn main_args(args: &[String]) -> int {\n             return test::run(input, cfgs, libs, externs, test_args)\n         }\n         (false, true) => return markdown::render(input, output.unwrap_or(Path::new(\"doc\")),\n-                                                 &matches, &external_html),\n+                                                 &matches, &external_html,\n+                                                 !matches.opt_present(\"markdown-no-toc\")),\n         (false, false) => {}\n     }\n "}, {"sha": "29da9462c7f57163fa6b9802d7add6bb2ca9e278", "filename": "src/librustdoc/markdown.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059/src%2Flibrustdoc%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059/src%2Flibrustdoc%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fmarkdown.rs?ref=31ac8a90f1fbe66c3ad34ef0e5f48bc5f7026059", "patch": "@@ -20,7 +20,7 @@ use externalfiles::ExternalHtml;\n \n use html::escape::Escape;\n use html::markdown;\n-use html::markdown::{MarkdownWithToc, find_testable_code, reset_headers};\n+use html::markdown::{Markdown, MarkdownWithToc, find_testable_code, reset_headers};\n use test::Collector;\n \n /// Separate any lines at the start of the file that begin with `%`.\n@@ -42,7 +42,7 @@ fn extract_leading_metadata<'a>(s: &'a str) -> (Vec<&'a str>, &'a str) {\n /// Render `input` (e.g. \"foo.md\") into an HTML file in `output`\n /// (e.g. output = \"bar\" => \"bar/foo.html\").\n pub fn render(input: &str, mut output: Path, matches: &getopts::Matches,\n-              external_html: &ExternalHtml) -> int {\n+              external_html: &ExternalHtml, include_toc: bool) -> int {\n     let input_p = Path::new(input);\n     output.push(input_p.filestem().unwrap());\n     output.set_extension(\"html\");\n@@ -80,6 +80,12 @@ pub fn render(input: &str, mut output: Path, matches: &getopts::Matches,\n \n     reset_headers();\n \n+    let rendered = if include_toc {\n+        format!(\"{}\", MarkdownWithToc(text))\n+    } else {\n+        format!(\"{}\", Markdown(text))\n+    };\n+\n     let err = write!(\n         &mut out,\n         r#\"<!DOCTYPE html>\n@@ -113,7 +119,7 @@ pub fn render(input: &str, mut output: Path, matches: &getopts::Matches,\n         css = css,\n         in_header = external_html.in_header,\n         before_content = external_html.before_content,\n-        text = MarkdownWithToc(text),\n+        text = rendered,\n         after_content = external_html.after_content,\n         playground = playground,\n         );"}]}