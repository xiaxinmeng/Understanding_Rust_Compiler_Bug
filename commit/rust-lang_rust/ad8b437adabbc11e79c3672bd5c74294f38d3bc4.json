{"sha": "ad8b437adabbc11e79c3672bd5c74294f38d3bc4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkOGI0MzdhZGFiYmMxMWU3OWMzNjcyYmQ1Yzc0Mjk0ZjM4ZDNiYzQ=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2013-02-12T22:39:11Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2013-02-16T13:01:10Z"}, "message": "Make 'foo use font-lock-builtin-face, like module names, and make capitalized identifiers optionally use font-lock-type-face", "tree": {"sha": "0e69b45f7e752973d585acebd99bec4aba3b7958", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e69b45f7e752973d585acebd99bec4aba3b7958"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad8b437adabbc11e79c3672bd5c74294f38d3bc4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad8b437adabbc11e79c3672bd5c74294f38d3bc4", "html_url": "https://github.com/rust-lang/rust/commit/ad8b437adabbc11e79c3672bd5c74294f38d3bc4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad8b437adabbc11e79c3672bd5c74294f38d3bc4/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ef8c48a204ad215310f38a239a898ee38d9bf8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ef8c48a204ad215310f38a239a898ee38d9bf8e", "html_url": "https://github.com/rust-lang/rust/commit/1ef8c48a204ad215310f38a239a898ee38d9bf8e"}], "stats": {"total": 32, "additions": 23, "deletions": 9}, "files": [{"sha": "5fbd2ab67c29d45adfedf3dbcb63902b23889de8", "filename": "src/etc/emacs/rust-mode.el", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/ad8b437adabbc11e79c3672bd5c74294f38d3bc4/src%2Fetc%2Femacs%2Frust-mode.el", "raw_url": "https://github.com/rust-lang/rust/raw/ad8b437adabbc11e79c3672bd5c74294f38d3bc4/src%2Fetc%2Femacs%2Frust-mode.el", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Femacs%2Frust-mode.el?ref=ad8b437adabbc11e79c3672bd5c74294f38d3bc4", "patch": "@@ -7,7 +7,6 @@\n \n (require 'cm-mode)\n (require 'cc-mode)\n-(eval-when-compile (require 'cl))\n \n (defun rust-electric-brace (arg)\n   (interactive \"*P\")\n@@ -17,6 +16,12 @@\n                           '(font-lock-comment-face font-lock-string-face))))\n     (cm-indent)))\n \n+(defcustom rust-capitalized-idents-are-types t\n+  \"If non-nil, capitalized identifiers will be treated as types for the purposes of font-lock mode\"\n+  :type 'boolean\n+  :require 'rust-mode\n+  :group 'rust-mode)\n+\n (defvar rust-indent-unit 4)\n (defvar rust-syntax-table (let ((table (make-syntax-table)))\n                             (c-populate-syntax-table table)\n@@ -115,12 +120,7 @@\n                  ((rust-eat-re \"[a-z_]+\") (setf rust-tcat 'macro)))\n            'font-lock-preprocessor-face)\n       (def ((?a . ?z) (?A . ?Z) ?_)\n-           (rust-eat-re \"[a-zA-Z_][a-zA-Z0-9_]*\")\n-           (setf rust-tcat 'ident)\n-           (if (and (eq (char-after) ?:) (eq (char-after (+ (point) 1)) ?:)\n-                    (not (eq (char-after (+ (point) 2)) ?:)))\n-               (progn (forward-char 2) 'font-lock-builtin-face)\n-             (match-string 0)))\n+           (rust-token-identifier))\n       (def ((?0 . ?9))\n            (rust-eat-re \"0x[0-9a-fA-F_]+\\\\|0b[01_]+\\\\|[0-9_]+\\\\(\\\\.[0-9_]+\\\\)?\\\\(e[+\\\\-]?[0-9_]+\\\\)?\")\n            (setf rust-tcat 'atom)\n@@ -143,15 +143,23 @@\n            (setf rust-tcat 'op) nil)\n       table)))\n \n+(defun rust-token-identifier ()\n+  (rust-eat-re \"[a-zA-Z_][a-zA-Z0-9_]*\")\n+  (setf rust-tcat 'ident)\n+  (if (and (eq (char-after) ?:) (eq (char-after (+ (point) 1)) ?:)\n+           (not (eq (char-after (+ (point) 2)) ?:)))\n+      (progn (forward-char 2) 'font-lock-builtin-face)\n+    (match-string 0)))\n+\n (defun rust-single-quote ()\n   (forward-char)\n   (setf rust-tcat 'atom)\n   ; Is this a lifetime?\n   (if (or (looking-at \"[a-zA-Z_]$\")\n           (looking-at \"[a-zA-Z_][^']\"))\n-      ; If what we see is 'abc, use font-lock-type-face:\n+      ; If what we see is 'abc, use font-lock-builtin-face:\n       (progn (rust-eat-re \"[a-zA-Z_][a-zA-Z_0-9]*\")\n-             'font-lock-type-face)\n+             'font-lock-builtin-face)\n     ; Otherwise, handle as a character constant:\n     (let ((is-escape (eq (char-after) ?\\\\))\n           (start (point)))\n@@ -200,6 +208,10 @@\n   (dolist (cx (rust-state-context st))\n     (when (eq (rust-context-type cx) ?\\}) (return (rust-context-info cx)))))\n \n+(defun rust-is-capitalized (string)\n+  (let ((case-fold-search nil))\n+    (string-match-p \"[A-Z]\" string)))\n+\n (defun rust-token (st)\n   (let ((cx (car (rust-state-context st))))\n     (when (bolp)\n@@ -216,6 +228,8 @@\n         (setf tok (cond ((eq tok-id 'atom) 'font-lock-constant-face)\n                         (tok-id 'font-lock-keyword-face)\n                         ((equal (rust-state-last-token st) 'def) 'font-lock-function-name-face)\n+                        ((and rust-capitalized-idents-are-types\n+                              (rust-is-capitalized tok)) 'font-lock-type-face)\n                         (t nil))))\n       (when rust-tcat\n         (when (eq (rust-context-align cx) 'unset)"}]}