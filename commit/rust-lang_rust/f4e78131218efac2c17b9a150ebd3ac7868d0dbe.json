{"sha": "f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "node_id": "C_kwDOAAsO6NoAKGY0ZTc4MTMxMjE4ZWZhYzJjMTdiOWExNTBlYmQzYWM3ODY4ZDBkYmU", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2022-07-12T20:54:47Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2022-07-14T09:20:52Z"}, "message": "Fix spans for asm diagnostics\n\nLine spans were incorrect if the first line of an asm statement was an\nempty string.", "tree": {"sha": "77790749ed3a0f0fd43de326d4189a774e57adc3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77790749ed3a0f0fd43de326d4189a774e57adc3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "html_url": "https://github.com/rust-lang/rust/commit/f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50b00252aeb77b10db04d65dc9e12ce758def4b5", "url": "https://api.github.com/repos/rust-lang/rust/commits/50b00252aeb77b10db04d65dc9e12ce758def4b5", "html_url": "https://github.com/rust-lang/rust/commit/50b00252aeb77b10db04d65dc9e12ce758def4b5"}], "stats": {"total": 46, "additions": 42, "deletions": 4}, "files": [{"sha": "47fd62d084e1a15a876b20970084eff4996b5d35", "filename": "compiler/rustc_builtin_macros/src/asm.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fasm.rs?ref=f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "patch": "@@ -534,8 +534,8 @@ fn expand_preparsed_asm(ecx: &mut ExtCtxt<'_>, args: AsmArgs) -> Option<ast::Inl\n \n     let mut template_strs = Vec::with_capacity(args.templates.len());\n \n-    for template_expr in args.templates.into_iter() {\n-        if !template.is_empty() {\n+    for (i, template_expr) in args.templates.into_iter().enumerate() {\n+        if i != 0 {\n             template.push(ast::InlineAsmTemplatePiece::String(\"\\n\".to_string()));\n         }\n "}, {"sha": "dbb6cbb9437b573e99348794bb1f96354fbe2343", "filename": "src/test/ui/asm/aarch64/srcloc.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.rs?ref=f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "patch": "@@ -118,5 +118,12 @@ fn main() {\n         //~^^^^^^^^^^ ERROR: unrecognized instruction mnemonic\n         //~^^^^^^^ ERROR: unrecognized instruction mnemonic\n         //~^^^^^^^^ ERROR: unrecognized instruction mnemonic\n+\n+        asm!(\n+            \"\",\n+            \"\\n\",\n+            \"invalid_instruction\"\n+        );\n+        //~^^ ERROR: unrecognized instruction mnemonic\n     }\n }"}, {"sha": "2e17b60b912430b2f0b32f12e29a042a01a193d2", "filename": "src/test/ui/asm/aarch64/srcloc.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Faarch64%2Fsrcloc.stderr?ref=f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "patch": "@@ -274,5 +274,17 @@ note: instantiated into assembly here\n LL | invalid_instruction4\n    | ^\n \n-error: aborting due to 23 previous errors\n+error: unrecognized instruction mnemonic\n+  --> $DIR/srcloc.rs:125:14\n+   |\n+LL |             \"invalid_instruction\"\n+   |              ^\n+   |\n+note: instantiated into assembly here\n+  --> <inline asm>:4:1\n+   |\n+LL | invalid_instruction\n+   | ^\n+\n+error: aborting due to 24 previous errors\n "}, {"sha": "1135ad2e1c643b643fe7c695f8f095e7e9b7d7fe", "filename": "src/test/ui/asm/x86_64/srcloc.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.rs?ref=f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "patch": "@@ -120,5 +120,12 @@ fn main() {\n         //~^^^^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction2'\n         //~^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction3'\n         //~^^^^^^^^ ERROR: invalid instruction mnemonic 'invalid_instruction4'\n+\n+        asm!(\n+            \"\",\n+            \"\\n\",\n+            \"invalid_instruction\"\n+        );\n+        //~^^ ERROR: invalid instruction mnemonic 'invalid_instruction'\n     }\n }"}, {"sha": "8899c1b916bd02ecae61146b0ea3de6a972e7a07", "filename": "src/test/ui/asm/x86_64/srcloc.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4e78131218efac2c17b9a150ebd3ac7868d0dbe/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fx86_64%2Fsrcloc.stderr?ref=f4e78131218efac2c17b9a150ebd3ac7868d0dbe", "patch": "@@ -286,5 +286,17 @@ note: instantiated into assembly here\n LL | invalid_instruction4\n    | ^^^^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 23 previous errors; 1 warning emitted\n+error: invalid instruction mnemonic 'invalid_instruction'\n+  --> $DIR/srcloc.rs:127:14\n+   |\n+LL |             \"invalid_instruction\"\n+   |              ^\n+   |\n+note: instantiated into assembly here\n+  --> <inline asm>:5:1\n+   |\n+LL | invalid_instruction\n+   | ^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 24 previous errors; 1 warning emitted\n "}]}