{"sha": "c8835104797335818bc1d5b0df61ce9f5907cd16", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4ODM1MTA0Nzk3MzM1ODE4YmMxZDViMGRmNjFjZTlmNTkwN2NkMTY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-19T14:50:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-08-19T14:50:51Z"}, "message": "auto merge of #16588 : thestinger/rust/aslr, r=pcwalton\n\nCloses #16514", "tree": {"sha": "5d7bb89844c80a3501d9a71e5caef1fd8ad240cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5d7bb89844c80a3501d9a71e5caef1fd8ad240cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c8835104797335818bc1d5b0df61ce9f5907cd16", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c8835104797335818bc1d5b0df61ce9f5907cd16", "html_url": "https://github.com/rust-lang/rust/commit/c8835104797335818bc1d5b0df61ce9f5907cd16", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c8835104797335818bc1d5b0df61ce9f5907cd16/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef0d49d78f91d6e517af2e37ed89a3e3587b9f83", "url": "https://api.github.com/repos/rust-lang/rust/commits/ef0d49d78f91d6e517af2e37ed89a3e3587b9f83", "html_url": "https://github.com/rust-lang/rust/commit/ef0d49d78f91d6e517af2e37ed89a3e3587b9f83"}, {"sha": "96f5eba4f5603c612464d6b1e961677e9d7084d3", "url": "https://api.github.com/repos/rust-lang/rust/commits/96f5eba4f5603c612464d6b1e961677e9d7084d3", "html_url": "https://github.com/rust-lang/rust/commit/96f5eba4f5603c612464d6b1e961677e9d7084d3"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "e3dfd4f534dbc2e3634a77109910e859f70168a2", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c8835104797335818bc1d5b0df61ce9f5907cd16/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c8835104797335818bc1d5b0df61ce9f5907cd16/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=c8835104797335818bc1d5b0df61ce9f5907cd16", "patch": "@@ -87,7 +87,7 @@ use std::cell::{Cell, RefCell};\n use std::rc::Rc;\n use std::{i8, i16, i32, i64};\n use syntax::abi::{X86, X86_64, Arm, Mips, Mipsel, Rust, RustCall};\n-use syntax::abi::{RustIntrinsic, Abi};\n+use syntax::abi::{RustIntrinsic, Abi, OsWindows};\n use syntax::ast_util::{local_def, is_local};\n use syntax::attr::AttrMetaMethods;\n use syntax::attr;\n@@ -2446,6 +2446,13 @@ pub fn create_entry_wrapper(ccx: &CrateContext,\n                                &ccx.int_type);\n \n         let llfn = decl_cdecl_fn(ccx, \"main\", llfty, ty::mk_nil());\n+\n+        // FIXME: #16581: Marking a symbol in the executable with `dllexport`\n+        // linkage forces MinGW's linker to output a `.reloc` section for ASLR\n+        if ccx.sess().targ_cfg.os == OsWindows {\n+            unsafe { llvm::LLVMRustSetDLLExportStorageClass(llfn) }\n+        }\n+\n         let llbb = \"top\".with_c_str(|buf| {\n             unsafe {\n                 llvm::LLVMAppendBasicBlockInContext(ccx.llcx, llfn, buf)"}]}