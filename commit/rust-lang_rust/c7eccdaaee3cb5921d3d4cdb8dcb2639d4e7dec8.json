{"sha": "c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "node_id": "C_kwDOAAsO6NoAKGM3ZWNjZGFhZWUzY2I1OTIxZDNkNGNkYjhkY2IyNjM5ZDRlN2RlYzg", "commit": {"author": {"name": "Joshua Nelson", "email": "github@jyn.dev", "date": "2023-03-17T15:39:40Z"}, "committer": {"name": "Jynn Nelson", "email": "jyn.nelson@redjack.com", "date": "2023-03-17T15:52:51Z"}, "message": "Use python3.11 in CI to make sure toml is validated\n\nThis also fixes a regression from\nhttps://github.com/rust-lang/rust/pull/106085 which stopped testing that\nwe support python2 in PR CI.", "tree": {"sha": "7c62881df52ee54ce31c0a0bb0773f1144713b7c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c62881df52ee54ce31c0a0bb0773f1144713b7c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "html_url": "https://github.com/rust-lang/rust/commit/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d808bc296dc147ddf0d17e1816be7b84ba51675a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d808bc296dc147ddf0d17e1816be7b84ba51675a", "html_url": "https://github.com/rust-lang/rust/commit/d808bc296dc147ddf0d17e1816be7b84ba51675a"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "20bd71f06e918e1dfe1d1f8cb0e8839ba9d79161", "filename": "src/bootstrap/bootstrap_test.py", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fbootstrap%2Fbootstrap_test.py", "raw_url": "https://github.com/rust-lang/rust/raw/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fbootstrap%2Fbootstrap_test.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap_test.py?ref=c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "patch": "@@ -91,8 +91,7 @@ def serialize_and_parse(self, args):\n             # Verify this is actually valid TOML.\n             tomllib.loads(build.config_toml)\n         except ImportError:\n-            # too old a version of python\n-            pass\n+            print(\"warning: skipping TOML validation, need at least python 3.11\", file=sys.stderr)\n         return build\n \n     def test_no_args(self):"}, {"sha": "abd28b4005d0be6faa8a796f935496e15012b489", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "patch": "@@ -251,7 +251,7 @@ def parse_args(args):\n \n         if not found:\n             unknown_args.append(arg)\n-    \n+\n     # Note: here and a few other places, we use [-1] to apply the *last* value\n     # passed.  But if option-checking is enabled, then the known_args loop will\n     # also assert that options are only passed once."}, {"sha": "b5715024a8484533d8ecf55736e39f0b061084df", "filename": "src/ci/docker/host-x86_64/mingw-check-tidy/Dockerfile", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile?ref=c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "patch": "@@ -1,13 +1,16 @@\n FROM ubuntu:22.04\n \n ARG DEBIAN_FRONTEND=noninteractive\n+# NOTE: intentionally uses python2 for x.py so we can test it still works.\n+# validate-toolstate only runs in our CI, so it's ok for it to only support python3.\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   make \\\n   ninja-build \\\n   file \\\n   curl \\\n   ca-certificates \\\n+  python2.7 \\\n   python3 \\\n   python3-pip \\\n   python3-pkg-resources \\\n@@ -30,4 +33,4 @@ RUN pip3 install --no-deps --no-cache-dir --require-hashes -r /tmp/reuse-require\n COPY host-x86_64/mingw-check/validate-toolstate.sh /scripts/\n COPY host-x86_64/mingw-check/validate-error-codes.sh /scripts/\n \n-ENV SCRIPT python3 ../x.py test --stage 0 src/tools/tidy tidyselftest\n+ENV SCRIPT python2.7 ../x.py test --stage 0 src/tools/tidy tidyselftest"}, {"sha": "dc8a4aac76873e3fcb3feb1ea412f9ba70acdf4f", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-llvm-14/Dockerfile", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-14%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-14%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-llvm-14%2FDockerfile?ref=c7eccdaaee3cb5921d3d4cdb8dcb2639d4e7dec8", "patch": "@@ -2,7 +2,6 @@ FROM ubuntu:22.04\n \n ARG DEBIAN_FRONTEND=noninteractive\n \n-# NOTE: intentionally installs both python2 and python3 so we can test support for both.\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   gcc-multilib \\\n@@ -11,8 +10,7 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   file \\\n   curl \\\n   ca-certificates \\\n-  python2.7 \\\n-  python3 \\\n+  python3.11 \\\n   git \\\n   cmake \\\n   sudo \\"}]}