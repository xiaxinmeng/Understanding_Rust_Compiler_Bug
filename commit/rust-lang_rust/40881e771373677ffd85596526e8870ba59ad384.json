{"sha": "40881e771373677ffd85596526e8870ba59ad384", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwODgxZTc3MTM3MzY3N2ZmZDg1NTk2NTI2ZTg4NzBiYTU5YWQzODQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-12-23T06:00:54Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-12-23T06:00:54Z"}, "message": "Auto merge of #4941 - lzutao:utils-mod, r=phansch\n\na few small cleanups\n\nchangelog: none", "tree": {"sha": "c1fcc1c6d56fd1ddd4eb9c982eef9a30cee092c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c1fcc1c6d56fd1ddd4eb9c982eef9a30cee092c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40881e771373677ffd85596526e8870ba59ad384", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40881e771373677ffd85596526e8870ba59ad384", "html_url": "https://github.com/rust-lang/rust/commit/40881e771373677ffd85596526e8870ba59ad384", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40881e771373677ffd85596526e8870ba59ad384/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2a76cd82ffebe24c7be327a82e80a6cd2d3227d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/2a76cd82ffebe24c7be327a82e80a6cd2d3227d6", "html_url": "https://github.com/rust-lang/rust/commit/2a76cd82ffebe24c7be327a82e80a6cd2d3227d6"}, {"sha": "20a8befa1cace3260c2d81234ae499dc43f012a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/20a8befa1cace3260c2d81234ae499dc43f012a9", "html_url": "https://github.com/rust-lang/rust/commit/20a8befa1cace3260c2d81234ae499dc43f012a9"}], "stats": {"total": 100, "additions": 43, "deletions": 57}, "files": [{"sha": "22a2f2ca79c7e39a990a8f9459e356bedfb5ba7d", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -1,9 +1,5 @@\n #![cfg_attr(feature = \"deny-warnings\", deny(warnings))]\n \n-extern crate clap;\n-extern crate clippy_dev;\n-extern crate regex;\n-\n use clap::{App, Arg, SubCommand};\n use clippy_dev::*;\n "}, {"sha": "7b11795fafdc511e6e79e6cbffb9e155bea5901f", "filename": "clippy_dummy/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_dummy%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_dummy%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dummy%2FCargo.toml?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -14,4 +14,4 @@ keywords = [\"clippy\", \"lint\", \"plugin\"]\n categories = [\"development-tools\", \"development-tools::cargo-plugins\"]\n \n [build-dependencies]\n-term = \"0.5.1\"\n+term = \"0.6\""}, {"sha": "21af4f8244f44f93d5d2b73c5cde5af59162c8aa", "filename": "clippy_dummy/build.rs", "status": "modified", "additions": 27, "deletions": 27, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_dummy%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_dummy%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dummy%2Fbuild.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -1,42 +1,42 @@\n-extern crate term;\n+use term::color::{GREEN, RED, WHITE};\n+use term::{Attr, Error, Result};\n \n fn main() {\n-    if let Err(_) = foo() {\n-        eprintln!(\"error: Clippy is no longer available via crates.io\\n\");\n-        eprintln!(\"help: please run `rustup component add clippy` instead\");\n+    if foo().is_err() {\n+        eprintln!(\n+            \"error: Clippy is no longer available via crates.io\\n\\n\\\n+             help: please run `rustup component add clippy` instead\"\n+        );\n     }\n     std::process::exit(1);\n }\n \n-fn foo() -> Result<(), ()> {\n-    let mut t = term::stderr().ok_or(())?;\n+fn foo() -> Result<()> {\n+    let mut t = term::stderr().ok_or(Error::NotSupported)?;\n \n-    t.attr(term::Attr::Bold).map_err(|_| ())?;\n-    t.fg(term::color::RED).map_err(|_| ())?;\n-    write!(t, \"\\nerror: \").map_err(|_| ())?;\n+    t.attr(Attr::Bold)?;\n+    t.fg(RED)?;\n+    write!(t, \"\\nerror: \")?;\n \n+    t.reset()?;\n+    t.fg(WHITE)?;\n+    writeln!(t, \"Clippy is no longer available via crates.io\\n\")?;\n \n-    t.reset().map_err(|_| ())?;\n-    t.fg(term::color::WHITE).map_err(|_| ())?;\n-    writeln!(t, \"Clippy is no longer available via crates.io\\n\").map_err(|_| ())?;\n+    t.attr(Attr::Bold)?;\n+    t.fg(GREEN)?;\n+    write!(t, \"help: \")?;\n \n+    t.reset()?;\n+    t.fg(WHITE)?;\n+    write!(t, \"please run `\")?;\n \n-    t.attr(term::Attr::Bold).map_err(|_| ())?;\n-    t.fg(term::color::GREEN).map_err(|_| ())?;\n-    write!(t, \"help: \").map_err(|_| ())?;\n+    t.attr(Attr::Bold)?;\n+    write!(t, \"rustup component add clippy\")?;\n \n+    t.reset()?;\n+    t.fg(WHITE)?;\n+    writeln!(t, \"` instead\")?;\n \n-    t.reset().map_err(|_| ())?;\n-    t.fg(term::color::WHITE).map_err(|_| ())?;\n-    write!(t, \"please run `\").map_err(|_| ())?;\n-\n-    t.attr(term::Attr::Bold).map_err(|_| ())?;\n-    write!(t, \"rustup component add clippy\").map_err(|_| ())?;\n-\n-    t.reset().map_err(|_| ())?;\n-    t.fg(term::color::WHITE).map_err(|_| ())?;\n-    writeln!(t, \"` instead\").map_err(|_| ())?;\n-\n-    t.reset().map_err(|_| ())?;\n+    t.reset()?;\n     Ok(())\n }"}, {"sha": "d86766ee0a58365481e2279aa5fece59d6b7c587", "filename": "clippy_lints/src/consts.rs", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_lints%2Fsrc%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_lints%2Fsrc%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconsts.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -252,18 +252,11 @@ impl<'c, 'cc> ConstEvalLateContext<'c, 'cc> {\n                     if let ExprKind::Path(qpath) = &callee.kind;\n                     let res = self.tables.qpath_res(qpath, callee.hir_id);\n                     if let Some(def_id) = res.opt_def_id();\n-                    let get_def_path = self.lcx.get_def_path(def_id, );\n-                    let def_path = get_def_path\n-                        .iter()\n-                        .copied()\n-                        .map(Symbol::as_str)\n-                        .collect::<Vec<_>>();\n-                    if def_path[0] == \"core\";\n-                    if def_path[1] == \"num\";\n-                    if def_path[3] == \"max_value\";\n-                    if def_path.len() == 4;\n+                    let def_path: Vec<_> = self.lcx.get_def_path(def_id).into_iter().map(Symbol::as_str).collect();\n+                    let def_path: Vec<&str> = def_path.iter().map(|s| &**s).collect();\n+                    if let [\"core\", \"num\", int_impl, \"max_value\"] = *def_path;\n                     then {\n-                       let value = match &*def_path[2] {\n+                       let value = match int_impl {\n                            \"<impl i8>\" => i8::max_value() as u128,\n                            \"<impl i16>\" => i16::max_value() as u128,\n                            \"<impl i32>\" => i32::max_value() as u128,"}, {"sha": "552a78d2861e8fa5950f4d10cd7d0096bdb06cc3", "filename": "clippy_lints/src/utils/mod.rs", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_lints%2Fsrc%2Futils%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fmod.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -869,16 +869,11 @@ pub fn remove_blocks(expr: &Expr) -> &Expr {\n     if let ExprKind::Block(ref block, _) = expr.kind {\n         if block.stmts.is_empty() {\n             if let Some(ref expr) = block.expr {\n-                remove_blocks(expr)\n-            } else {\n-                expr\n+                return remove_blocks(expr);\n             }\n-        } else {\n-            expr\n         }\n-    } else {\n-        expr\n     }\n+    expr\n }\n \n pub fn is_self(slf: &Param) -> bool {\n@@ -1228,12 +1223,13 @@ pub fn if_sequence(mut expr: &Expr) -> (SmallVec<[&Expr; 1]>, SmallVec<[&Block;\n }\n \n pub fn parent_node_is_if_expr<'a, 'b>(expr: &Expr, cx: &LateContext<'a, 'b>) -> bool {\n-    let parent_id = cx.tcx.hir().get_parent_node(expr.hir_id);\n-    let parent_node = cx.tcx.hir().get(parent_id);\n+    let map = cx.tcx.hir();\n+    let parent_id = map.get_parent_node(expr.hir_id);\n+    let parent_node = map.get(parent_id);\n \n     match parent_node {\n-        rustc::hir::Node::Expr(e) => higher::if_block(&e).is_some(),\n-        rustc::hir::Node::Arm(e) => higher::if_block(&e.body).is_some(),\n+        Node::Expr(e) => higher::if_block(&e).is_some(),\n+        Node::Arm(e) => higher::if_block(&e.body).is_some(),\n         _ => false,\n     }\n }"}, {"sha": "b322eca1db51d2cf71da534d254f47be4213c6d1", "filename": "clippy_workspace_tests/src/main.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_workspace_tests%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_workspace_tests%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_workspace_tests%2Fsrc%2Fmain.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -1,4 +1,3 @@\n #![deny(rust_2018_idioms)]\n \n-fn main() {\n-}\n+fn main() {}"}, {"sha": "8b137891791fe96927ad78e64b0aad7bded08bdc", "filename": "clippy_workspace_tests/subcrate/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/clippy_workspace_tests%2Fsubcrate%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/clippy_workspace_tests%2Fsubcrate%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_workspace_tests%2Fsubcrate%2Fsrc%2Flib.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -0,0 +1 @@\n+"}, {"sha": "962425d955a79210fc98dc9db3418f151a0cc815", "filename": "tests/fmt.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40881e771373677ffd85596526e8870ba59ad384/tests%2Ffmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40881e771373677ffd85596526e8870ba59ad384/tests%2Ffmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ffmt.rs?ref=40881e771373677ffd85596526e8870ba59ad384", "patch": "@@ -1,3 +1,4 @@\n+use std::path::PathBuf;\n use std::process::Command;\n \n #[test]\n@@ -17,7 +18,7 @@ fn fmt() {\n         return;\n     }\n \n-    let root_dir = std::path::PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n+    let root_dir = PathBuf::from(env!(\"CARGO_MANIFEST_DIR\"));\n     let dev_dir = root_dir.join(\"clippy_dev\");\n     let target_dir = root_dir.join(\"target\");\n     let target_dir = target_dir.to_str().unwrap();"}]}