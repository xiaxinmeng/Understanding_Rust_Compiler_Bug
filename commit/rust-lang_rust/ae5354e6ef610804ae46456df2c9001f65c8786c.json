{"sha": "ae5354e6ef610804ae46456df2c9001f65c8786c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlNTM1NGU2ZWY2MTA4MDRhZTQ2NDU2ZGYyYzkwMDFmNjVjODc4NmM=", "commit": {"author": {"name": "Karim Snj", "email": "karim.snj@gmail.com", "date": "2018-03-07T17:24:36Z"}, "committer": {"name": "Karim SENHAJI", "email": "ksenhaji@ncelrnd0029.nce.amadeus.net", "date": "2018-03-07T17:25:09Z"}, "message": "lint: while immutable condition: do not lint constants", "tree": {"sha": "9dbb06908d8f19ced7eb1744a1f6ea515979a7a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9dbb06908d8f19ced7eb1744a1f6ea515979a7a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae5354e6ef610804ae46456df2c9001f65c8786c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae5354e6ef610804ae46456df2c9001f65c8786c", "html_url": "https://github.com/rust-lang/rust/commit/ae5354e6ef610804ae46456df2c9001f65c8786c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae5354e6ef610804ae46456df2c9001f65c8786c/comments", "author": {"login": "kimsnj", "id": 302132, "node_id": "MDQ6VXNlcjMwMjEzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/302132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kimsnj", "html_url": "https://github.com/kimsnj", "followers_url": "https://api.github.com/users/kimsnj/followers", "following_url": "https://api.github.com/users/kimsnj/following{/other_user}", "gists_url": "https://api.github.com/users/kimsnj/gists{/gist_id}", "starred_url": "https://api.github.com/users/kimsnj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kimsnj/subscriptions", "organizations_url": "https://api.github.com/users/kimsnj/orgs", "repos_url": "https://api.github.com/users/kimsnj/repos", "events_url": "https://api.github.com/users/kimsnj/events{/privacy}", "received_events_url": "https://api.github.com/users/kimsnj/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4cf02c7e1a4d94eb078851e4a24d3f8be4bd6a51", "url": "https://api.github.com/repos/rust-lang/rust/commits/4cf02c7e1a4d94eb078851e4a24d3f8be4bd6a51", "html_url": "https://github.com/rust-lang/rust/commit/4cf02c7e1a4d94eb078851e4a24d3f8be4bd6a51"}], "stats": {"total": 46, "additions": 35, "deletions": 11}, "files": [{"sha": "f476b960d889084c843f56e020c14007071e4018", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ae5354e6ef610804ae46456df2c9001f65c8786c/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae5354e6ef610804ae46456df2c9001f65c8786c/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=ae5354e6ef610804ae46456df2c9001f65c8786c", "patch": "@@ -22,6 +22,8 @@ use syntax::codemap::Span;\n use utils::sugg;\n use utils::const_to_u64;\n \n+use consts::constant;\n+\n use utils::{get_enclosing_block, get_parent_expr, higher, in_external_macro, is_integer_literal, is_refutable,\n             last_path_segment, match_trait_method, match_type, match_var, multispan_sugg, snippet, snippet_opt,\n             span_help_and_lint, span_lint, span_lint_and_sugg, span_lint_and_then};\n@@ -2142,6 +2144,11 @@ fn path_name(e: &Expr) -> Option<Name> {\n }\n \n fn check_infinite_loop<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, cond: &'tcx Expr, block: &'tcx Block, expr: &'tcx Expr) {\n+    if constant(cx, cond).is_some() {\n+        // A pure constant condition (e.g. while false) is not linted.\n+        return;\n+    }\n+\n     let mut mut_var_visitor = MutableVarsVisitor {\n         cx,\n         ids: HashMap::new(),\n@@ -2152,12 +2159,12 @@ fn check_infinite_loop<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, cond: &'tcx Expr, b\n         return;\n     }\n \n-    if mut_var_visitor.ids.len() == 0 {\n+    if mut_var_visitor.ids.is_empty() {\n         span_lint(\n             cx,\n             WHILE_IMMUTABLE_CONDITION,\n             cond.span,\n-            \"all variables in condition are immutable. This might lead to infinite loops.\",\n+            \"all variables in condition are immutable. This either leads to an infinite or to a never running loop.\",\n         );\n         return;\n     }\n@@ -2175,7 +2182,7 @@ fn check_infinite_loop<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, cond: &'tcx Expr, b\n             cx,\n             WHILE_IMMUTABLE_CONDITION,\n             expr.span,\n-            \"Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\",\n+            \"Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\",\n         );\n     }\n }"}, {"sha": "560400f359d291d07968c2a9f253007f3dcbbade", "filename": "tests/ui/infinite_loop.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ae5354e6ef610804ae46456df2c9001f65c8786c/tests%2Fui%2Finfinite_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae5354e6ef610804ae46456df2c9001f65c8786c/tests%2Fui%2Finfinite_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finfinite_loop.rs?ref=ae5354e6ef610804ae46456df2c9001f65c8786c", "patch": "@@ -94,6 +94,23 @@ fn used_immutable() {\n     }\n }\n \n+const N: i32 = 5;\n+const B: bool = false;\n+\n+fn consts() {\n+    while false {\n+        println!(\"Constants are not linted\");\n+    }\n+\n+    while B {\n+        println!(\"Constants are not linted\");\n+    }\n+\n+    while N > 0 {\n+        println!(\"Constants are not linted\");\n+    }\n+}\n+\n use std::cell::Cell;\n \n fn maybe_i_mutate(i: &Cell<bool>) { unimplemented!() }"}, {"sha": "2addd4819e6fac4b83f07c9feee720157ee7d7f6", "filename": "tests/ui/infinite_loop.stderr", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ae5354e6ef610804ae46456df2c9001f65c8786c/tests%2Fui%2Finfinite_loop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ae5354e6ef610804ae46456df2c9001f65c8786c/tests%2Fui%2Finfinite_loop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finfinite_loop.stderr?ref=ae5354e6ef610804ae46456df2c9001f65c8786c", "patch": "@@ -1,24 +1,24 @@\n-error: all variables in condition are immutable. This might lead to infinite loops.\n+error: all variables in condition are immutable. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:10:11\n    |\n 10 |     while y < 10 {\n    |           ^^^^^^\n    |\n    = note: `-D while-immutable-condition` implied by `-D warnings`\n \n-error: all variables in condition are immutable. This might lead to infinite loops.\n+error: all variables in condition are immutable. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:15:11\n    |\n 15 |     while y < 10 && x < 3 {\n    |           ^^^^^^^^^^^^^^^\n \n-error: all variables in condition are immutable. This might lead to infinite loops.\n+error: all variables in condition are immutable. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:22:11\n    |\n 22 |     while !cond {\n    |           ^^^^^\n \n-error: Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\n+error: Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:52:5\n    |\n 52 | /     while i < 3 {\n@@ -27,15 +27,15 @@ error: Variable in the condition are not mutated in the loop body. This might le\n 55 | |     }\n    | |_____^\n \n-error: Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\n+error: Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:57:5\n    |\n 57 | /     while i < 3 && j > 0 {\n 58 | |         println!(\"KO - i and j not mentionned\");\n 59 | |     }\n    | |_____^\n \n-error: Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\n+error: Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:61:5\n    |\n 61 | /     while i < 3 {\n@@ -45,7 +45,7 @@ error: Variable in the condition are not mutated in the loop body. This might le\n 65 | |     }\n    | |_____^\n \n-error: Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\n+error: Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:76:5\n    |\n 76 | /     while i < 3 {\n@@ -54,7 +54,7 @@ error: Variable in the condition are not mutated in the loop body. This might le\n 79 | |     }\n    | |_____^\n \n-error: Variable in the condition are not mutated in the loop body. This might lead to infinite loops.\n+error: Variable in the condition are not mutated in the loop body. This either leads to an infinite or to a never running loop.\n   --> $DIR/infinite_loop.rs:81:5\n    |\n 81 | /     while i < 3 {"}]}