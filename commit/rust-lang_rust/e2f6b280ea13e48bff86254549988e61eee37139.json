{"sha": "e2f6b280ea13e48bff86254549988e61eee37139", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyZjZiMjgwZWExM2U0OGJmZjg2MjU0NTQ5OTg4ZTYxZWVlMzcxMzk=", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2018-01-20T05:43:53Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2018-01-20T05:43:53Z"}, "message": "Update DW_OP_plus to DW_OP_plus_uconst\n\nLLVM <= 4.0 used a non-standard interpretation of `DW_OP_plus`.  In the\nDWARF standard, this adds two items on the expressions stack.  LLVM's\nbehavior was more like DWARF's `DW_OP_plus_uconst` -- adding a constant\nthat follows the op.  The patch series starting with [D33892] switched\nto the standard DWARF interpretation, so we need to follow.\n\n[D33892]: https://reviews.llvm.org/D33892", "tree": {"sha": "2e2ba3e290724c80b4b30444b4a15c0670df402a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e2ba3e290724c80b4b30444b4a15c0670df402a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e2f6b280ea13e48bff86254549988e61eee37139", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e2f6b280ea13e48bff86254549988e61eee37139", "html_url": "https://github.com/rust-lang/rust/commit/e2f6b280ea13e48bff86254549988e61eee37139", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e2f6b280ea13e48bff86254549988e61eee37139/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5965b790142eff7a8546e947914e7a8e00c61575", "url": "https://api.github.com/repos/rust-lang/rust/commits/5965b790142eff7a8546e947914e7a8e00c61575", "html_url": "https://github.com/rust-lang/rust/commit/5965b790142eff7a8546e947914e7a8e00c61575"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "f51e51a88b10f39a3583f0bcc701d2a4c7575d22", "filename": "src/librustc_llvm/ffi.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e2f6b280ea13e48bff86254549988e61eee37139/src%2Flibrustc_llvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e2f6b280ea13e48bff86254549988e61eee37139/src%2Flibrustc_llvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fffi.rs?ref=e2f6b280ea13e48bff86254549988e61eee37139", "patch": "@@ -1546,7 +1546,7 @@ extern \"C\" {\n                                                 InlinedAt: MetadataRef)\n                                                 -> ValueRef;\n     pub fn LLVMRustDIBuilderCreateOpDeref() -> i64;\n-    pub fn LLVMRustDIBuilderCreateOpPlus() -> i64;\n+    pub fn LLVMRustDIBuilderCreateOpPlusUconst() -> i64;\n \n     pub fn LLVMRustWriteTypeToString(Type: TypeRef, s: RustStringRef);\n     pub fn LLVMRustWriteValueToString(value_ref: ValueRef, s: RustStringRef);"}, {"sha": "b367eb6548d01f9d89a68bae3891992ef464cb63", "filename": "src/librustc_trans/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/e2f6b280ea13e48bff86254549988e61eee37139/src%2Flibrustc_trans%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e2f6b280ea13e48bff86254549988e61eee37139/src%2Flibrustc_trans%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fmir%2Fmod.rs?ref=e2f6b280ea13e48bff86254549988e61eee37139", "patch": "@@ -547,7 +547,7 @@ fn arg_local_refs<'a, 'tcx>(bx: &Builder<'a, 'tcx>,\n \n                 let ops = unsafe {\n                     [llvm::LLVMRustDIBuilderCreateOpDeref(),\n-                     llvm::LLVMRustDIBuilderCreateOpPlus(),\n+                     llvm::LLVMRustDIBuilderCreateOpPlusUconst(),\n                      byte_offset_of_var_in_env as i64,\n                      llvm::LLVMRustDIBuilderCreateOpDeref()]\n                 };"}, {"sha": "0fe533d447bc3e9dd8f6518afd00711881c609ea", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e2f6b280ea13e48bff86254549988e61eee37139/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/e2f6b280ea13e48bff86254549988e61eee37139/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=e2f6b280ea13e48bff86254549988e61eee37139", "patch": "@@ -866,7 +866,14 @@ extern \"C\" int64_t LLVMRustDIBuilderCreateOpDeref() {\n   return dwarf::DW_OP_deref;\n }\n \n-extern \"C\" int64_t LLVMRustDIBuilderCreateOpPlus() { return dwarf::DW_OP_plus; }\n+extern \"C\" int64_t LLVMRustDIBuilderCreateOpPlusUconst() {\n+#if LLVM_VERSION_GE(5, 0)\n+  return dwarf::DW_OP_plus_uconst;\n+#else\n+  // older LLVM used `plus` to behave like `plus_uconst`.\n+  return dwarf::DW_OP_plus;\n+#endif\n+}\n \n extern \"C\" void LLVMRustWriteTypeToString(LLVMTypeRef Ty, RustStringRef Str) {\n   RawRustStringOstream OS(Str);"}]}