{"sha": "2d9a0387c10a527731209338ab83817ece26ee05", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkOWEwMzg3YzEwYTUyNzczMTIwOTMzOGFiODM4MTdlY2UyNmVlMDU=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-07-12T23:54:32Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-12T23:54:32Z"}, "message": "Rollup merge of #87007 - ehuss:fix-rust-analyzer-install, r=Mark-Simulacrum\n\nFix rust-analyzer install when not available.\n\nThis changes it so that `x.py install` won't fail if rust-analyzer isn't available. This was changed in #86568 to handle the case where installing on stable/beta, and `extended=true`, to skip rust-analyzer. But I neglected to update the install part to also ignore it.\n\nFixes #86999", "tree": {"sha": "819a7c3b948bcc06a62dba619e4724f0783c439a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/819a7c3b948bcc06a62dba619e4724f0783c439a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d9a0387c10a527731209338ab83817ece26ee05", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg7NY5CRBK7hj4Ov3rIwAAfCMIAJ2bjkpPfiS6SGdm0CcWeb/G\nV2qv5hqfhGx1oAl3+uvwxFaFQ/ieGhEf2zmXjWYAjnqSeyFMfr6C1Y1AgPuUSKtG\nNHM4pRRCJhWJuZLXI8LOSS4j5idl89k1p6eTpfgLQJEW1YByUYl8eqKpfH+z3y9o\nzjSEhUMV89mo2PnvfReape9pyf4Q924baPtxJ4Eih8JvXtVRAKO3iZxDrigKCxMS\nQFl7f2l2qdimw26NdseW2vdtFzN3tD2yuPDIDAooJJMHdaKcAg04TPAp+0gtyjjI\n+cGQZtHFoCJxDcUK4KDP+z293huyPKW4QfbezjkVaZRQ3wjOlHZx7SQn6FqoeAw=\n=sBpt\n-----END PGP SIGNATURE-----\n", "payload": "tree 819a7c3b948bcc06a62dba619e4724f0783c439a\nparent a49927350f658c0f4ba517529fec59052b1eed1e\nparent 166c147c2727cd6d6ad4d39c40c51273b8a63c96\nauthor Yuki Okushi <jtitor@2k36.org> 1626134072 +0900\ncommitter GitHub <noreply@github.com> 1626134072 +0900\n\nRollup merge of #87007 - ehuss:fix-rust-analyzer-install, r=Mark-Simulacrum\n\nFix rust-analyzer install when not available.\n\nThis changes it so that `x.py install` won't fail if rust-analyzer isn't available. This was changed in #86568 to handle the case where installing on stable/beta, and `extended=true`, to skip rust-analyzer. But I neglected to update the install part to also ignore it.\n\nFixes #86999\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d9a0387c10a527731209338ab83817ece26ee05", "html_url": "https://github.com/rust-lang/rust/commit/2d9a0387c10a527731209338ab83817ece26ee05", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d9a0387c10a527731209338ab83817ece26ee05/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a49927350f658c0f4ba517529fec59052b1eed1e", "url": "https://api.github.com/repos/rust-lang/rust/commits/a49927350f658c0f4ba517529fec59052b1eed1e", "html_url": "https://github.com/rust-lang/rust/commit/a49927350f658c0f4ba517529fec59052b1eed1e"}, {"sha": "166c147c2727cd6d6ad4d39c40c51273b8a63c96", "url": "https://api.github.com/repos/rust-lang/rust/commits/166c147c2727cd6d6ad4d39c40c51273b8a63c96", "html_url": "https://github.com/rust-lang/rust/commit/166c147c2727cd6d6ad4d39c40c51273b8a63c96"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "8a1b6df0dafe34910e2631733e8cb4642c7ddb65", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/2d9a0387c10a527731209338ab83817ece26ee05/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d9a0387c10a527731209338ab83817ece26ee05/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=2d9a0387c10a527731209338ab83817ece26ee05", "patch": "@@ -139,11 +139,17 @@ macro_rules! install {\n \n install!((self, builder, _config),\n     Docs, \"src/doc\", _config.docs, only_hosts: false, {\n-        let tarball = builder.ensure(dist::Docs { host: self.target }).expect(\"missing docs\");\n-        install_sh(builder, \"docs\", self.compiler.stage, Some(self.target), &tarball);\n+        if let Some(tarball) = builder.ensure(dist::Docs { host: self.target }) {\n+            install_sh(builder, \"docs\", self.compiler.stage, Some(self.target), &tarball);\n+        } else {\n+            panic!(\"docs are not available to install, \\\n+                check that `build.docs` is true in `config.toml`\");\n+        }\n     };\n     Std, \"library/std\", true, only_hosts: false, {\n         for target in &builder.targets {\n+            // `expect` should be safe, only None when host != build, but this\n+            // only runs when host == build\n             let tarball = builder.ensure(dist::Std {\n                 compiler: self.compiler,\n                 target: *target\n@@ -165,10 +171,15 @@ install!((self, builder, _config),\n         }\n     };\n     RustAnalyzer, \"rust-analyzer\", Self::should_build(_config), only_hosts: true, {\n-        let tarball = builder\n-            .ensure(dist::RustAnalyzer { compiler: self.compiler, target: self.target })\n-            .expect(\"missing rust-analyzer\");\n-        install_sh(builder, \"rust-analyzer\", self.compiler.stage, Some(self.target), &tarball);\n+        if let Some(tarball) =\n+            builder.ensure(dist::RustAnalyzer { compiler: self.compiler, target: self.target })\n+        {\n+            install_sh(builder, \"rust-analyzer\", self.compiler.stage, Some(self.target), &tarball);\n+        } else {\n+            builder.info(\n+                &format!(\"skipping Install rust-analyzer stage{} ({})\", self.compiler.stage, self.target),\n+            );\n+        }\n     };\n     Clippy, \"clippy\", Self::should_build(_config), only_hosts: true, {\n         let tarball = builder.ensure(dist::Clippy { compiler: self.compiler, target: self.target });\n@@ -212,6 +223,8 @@ install!((self, builder, _config),\n         }\n     };\n     Analysis, \"analysis\", Self::should_build(_config), only_hosts: false, {\n+        // `expect` should be safe, only None with host != build, but this\n+        // only uses the `build` compiler\n         let tarball = builder.ensure(dist::Analysis {\n             // Find the actual compiler (handling the full bootstrap option) which\n             // produced the save-analysis data because that data isn't copied"}]}