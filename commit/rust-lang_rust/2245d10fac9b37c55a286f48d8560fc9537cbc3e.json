{"sha": "2245d10fac9b37c55a286f48d8560fc9537cbc3e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyNDVkMTBmYWM5YjM3YzU1YTI4NmY0OGQ4NTYwZmM5NTM3Y2JjM2U=", "commit": {"author": {"name": "Fabian Drinck", "email": "fabian.drinck@rwth-aachen.de", "date": "2019-03-16T16:38:12Z"}, "committer": {"name": "Fabian Drinck", "email": "fabian.drinck@rwth-aachen.de", "date": "2019-03-30T21:37:02Z"}, "message": "Improve warning", "tree": {"sha": "546db347fc4aa3e16639d5a0e206ef224c3a8514", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/546db347fc4aa3e16639d5a0e206ef224c3a8514"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2245d10fac9b37c55a286f48d8560fc9537cbc3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2245d10fac9b37c55a286f48d8560fc9537cbc3e", "html_url": "https://github.com/rust-lang/rust/commit/2245d10fac9b37c55a286f48d8560fc9537cbc3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2245d10fac9b37c55a286f48d8560fc9537cbc3e/comments", "author": {"login": "fabric-and-ink", "id": 13430670, "node_id": "MDQ6VXNlcjEzNDMwNjcw", "avatar_url": "https://avatars.githubusercontent.com/u/13430670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fabric-and-ink", "html_url": "https://github.com/fabric-and-ink", "followers_url": "https://api.github.com/users/fabric-and-ink/followers", "following_url": "https://api.github.com/users/fabric-and-ink/following{/other_user}", "gists_url": "https://api.github.com/users/fabric-and-ink/gists{/gist_id}", "starred_url": "https://api.github.com/users/fabric-and-ink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fabric-and-ink/subscriptions", "organizations_url": "https://api.github.com/users/fabric-and-ink/orgs", "repos_url": "https://api.github.com/users/fabric-and-ink/repos", "events_url": "https://api.github.com/users/fabric-and-ink/events{/privacy}", "received_events_url": "https://api.github.com/users/fabric-and-ink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fabric-and-ink", "id": 13430670, "node_id": "MDQ6VXNlcjEzNDMwNjcw", "avatar_url": "https://avatars.githubusercontent.com/u/13430670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fabric-and-ink", "html_url": "https://github.com/fabric-and-ink", "followers_url": "https://api.github.com/users/fabric-and-ink/followers", "following_url": "https://api.github.com/users/fabric-and-ink/following{/other_user}", "gists_url": "https://api.github.com/users/fabric-and-ink/gists{/gist_id}", "starred_url": "https://api.github.com/users/fabric-and-ink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fabric-and-ink/subscriptions", "organizations_url": "https://api.github.com/users/fabric-and-ink/orgs", "repos_url": "https://api.github.com/users/fabric-and-ink/repos", "events_url": "https://api.github.com/users/fabric-and-ink/events{/privacy}", "received_events_url": "https://api.github.com/users/fabric-and-ink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2cebbe25995f308fe6ed72a246f9d2ea633addf9", "url": "https://api.github.com/repos/rust-lang/rust/commits/2cebbe25995f308fe6ed72a246f9d2ea633addf9", "html_url": "https://github.com/rust-lang/rust/commit/2cebbe25995f308fe6ed72a246f9d2ea633addf9"}], "stats": {"total": 35, "additions": 18, "deletions": 17}, "files": [{"sha": "002ee599400597a007679af94595bf6946287daf", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=2245d10fac9b37c55a286f48d8560fc9537cbc3e", "patch": "@@ -489,6 +489,7 @@ pub enum BuiltinLintDiagnostics {\n     UnknownCrateTypes(Span, String, String),\n     UnusedImports(String, Vec<(Span, String)>),\n     NestedImplTrait { outer_impl_trait_span: Span, inner_impl_trait_span: Span },\n+    RedundantImport(Vec<Span>, ast::Ident),\n }\n \n impl BuiltinLintDiagnostics {\n@@ -585,6 +586,14 @@ impl BuiltinLintDiagnostics {\n                 db.span_label(outer_impl_trait_span, \"outer `impl Trait`\");\n                 db.span_label(inner_impl_trait_span, \"nested `impl Trait` here\");\n             }\n+            BuiltinLintDiagnostics::RedundantImport(spans, ident) => {\n+                for span in spans {\n+                    db.span_label(\n+                        span,\n+                        format!(\"the item `{}` was already imported here\", ident)\n+                    );\n+                }\n+            }\n         }\n     }\n }"}, {"sha": "cd018d8eb9e23adff0b389d228328f1b2521db9e", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=2245d10fac9b37c55a286f48d8560fc9537cbc3e", "patch": "@@ -1306,21 +1306,16 @@ impl<'a, 'b:'a> ImportResolver<'a, 'b> {\n         if !is_redundant.is_empty() &&\n             is_redundant.present_items().all(|is_redundant| is_redundant)\n         {\n-            self.session.buffer_lint(\n+            self.session.buffer_lint_with_diagnostic(\n                 REDUNDANT_IMPORT,\n                 directive.id,\n                 directive.span,\n                 &format!(\"the item `{}` is imported redundantly\", ident),\n+                BuiltinLintDiagnostics::RedundantImport(\n+                    redundant_span.present_items().collect(),\n+                    ident,\n+                ),\n             );\n-\n-            for span in redundant_span.present_items() {\n-                self.session.buffer_lint(\n-                    REDUNDANT_IMPORT,\n-                    directive.id,\n-                    span,\n-                    \"another import\"\n-                );\n-            }\n         }\n     }\n "}, {"sha": "c843ed160df08c6fcfcf03d15b2b06ccf853ff26", "filename": "src/test/ui/lint/use-redundant.stderr", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Ftest%2Fui%2Flint%2Fuse-redundant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2245d10fac9b37c55a286f48d8560fc9537cbc3e/src%2Ftest%2Fui%2Flint%2Fuse-redundant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fuse-redundant.stderr?ref=2245d10fac9b37c55a286f48d8560fc9537cbc3e", "patch": "@@ -1,14 +1,11 @@\n warning: the item `Bar` is imported redundantly\n   --> $DIR/use-redundant.rs:14:9\n    |\n-LL |     use crate::foo::Bar; //~ WARNING redundant import\n+LL | use crate::foo::Bar;\n+   |     --------------- the item `Bar` was already imported here\n+...\n+LL |     use crate::foo::Bar;\n    |         ^^^^^^^^^^^^^^^\n    |\n    = note: #[warn(redundant_import)] on by default\n \n-warning: another import\n-  --> $DIR/use-redundant.rs:3:5\n-   |\n-LL | use crate::foo::Bar; //~ WARNING first import\n-   |     ^^^^^^^^^^^^^^^\n-"}]}