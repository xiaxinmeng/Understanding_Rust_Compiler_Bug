{"sha": "7cd1d78a4769995546967e413dbbd672c11a153e", "node_id": "C_kwDOAAsO6NoAKDdjZDFkNzhhNDc2OTk5NTU0Njk2N2U0MTNkYmJkNjcyYzExYTE1M2U", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-21T13:30:09Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-07-21T13:30:09Z"}, "message": "only complain about runtime toolchain mismatch when there actually is a runtime toolchain", "tree": {"sha": "1636b8de05b598bc6c20255c78b0051fdc0d5ddf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1636b8de05b598bc6c20255c78b0051fdc0d5ddf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7cd1d78a4769995546967e413dbbd672c11a153e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7cd1d78a4769995546967e413dbbd672c11a153e", "html_url": "https://github.com/rust-lang/rust/commit/7cd1d78a4769995546967e413dbbd672c11a153e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7cd1d78a4769995546967e413dbbd672c11a153e/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "800273c1d9005c6433098735f663bd8e362ce69b", "url": "https://api.github.com/repos/rust-lang/rust/commits/800273c1d9005c6433098735f663bd8e362ce69b", "html_url": "https://github.com/rust-lang/rust/commit/800273c1d9005c6433098735f663bd8e362ce69b"}], "stats": {"total": 17, "additions": 9, "deletions": 8}, "files": [{"sha": "516c730e3fbdbff97f44a02a6f40e4e6d40a194e", "filename": "src/bin/miri.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/7cd1d78a4769995546967e413dbbd672c11a153e/src%2Fbin%2Fmiri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7cd1d78a4769995546967e413dbbd672c11a153e/src%2Fbin%2Fmiri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fmiri.rs?ref=7cd1d78a4769995546967e413dbbd672c11a153e", "patch": "@@ -220,16 +220,17 @@ fn compile_time_sysroot() -> Option<String> {\n     let toolchain = option_env!(\"RUSTUP_TOOLCHAIN\").or(option_env!(\"MULTIRUST_TOOLCHAIN\"));\n     Some(match (home, toolchain) {\n         (Some(home), Some(toolchain)) => {\n-            // Check that at runtime, we are still in this toolchain.\n-            let toolchain_runtime =\n-                env::var_os(\"RUSTUP_TOOLCHAIN\").or_else(|| env::var_os(\"MULTIRUST_TOOLCHAIN\"));\n-            if !matches!(toolchain_runtime, Some(r) if r == toolchain) {\n-                show_error(format!(\n-                    \"This Miri got built with local toolchain `{toolchain}`, but now is being run under a different toolchain. \\n\\\n+            // Check that at runtime, we are still in this toolchain (if there is any toolchain).\n+            if let Some(toolchain_runtime) =\n+                env::var_os(\"RUSTUP_TOOLCHAIN\").or_else(|| env::var_os(\"MULTIRUST_TOOLCHAIN\"))\n+            {\n+                if toolchain_runtime != toolchain {\n+                    show_error(format!(\n+                        \"This Miri got built with local toolchain `{toolchain}`, but now is being run under a different toolchain. \\n\\\n                     Make sure to run Miri in the toolchain it got built with, e.g. via `cargo +{toolchain} miri`.\"\n-                ));\n+                    ));\n+                }\n             }\n-\n             format!(\"{}/toolchains/{}\", home, toolchain)\n         }\n         _ => option_env!(\"RUST_SYSROOT\")"}]}