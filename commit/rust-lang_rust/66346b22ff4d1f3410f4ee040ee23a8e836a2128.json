{"sha": "66346b22ff4d1f3410f4ee040ee23a8e836a2128", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2MzQ2YjIyZmY0ZDFmMzQxMGY0ZWUwNDBlZTIzYThlODM2YTIxMjg=", "commit": {"author": {"name": "Oliver Schneider", "email": "oli-obk@users.noreply.github.com", "date": "2017-08-21T11:52:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-08-21T11:52:26Z"}, "message": "Merge pull request #1973 from rust-lang-nursery/fix-1920\n\nremove stars at the beginning of multiline comments", "tree": {"sha": "02a4b9a5c986aa9f643a1c708fd5a6eeea9e931c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/02a4b9a5c986aa9f643a1c708fd5a6eeea9e931c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/66346b22ff4d1f3410f4ee040ee23a8e836a2128", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/66346b22ff4d1f3410f4ee040ee23a8e836a2128", "html_url": "https://github.com/rust-lang/rust/commit/66346b22ff4d1f3410f4ee040ee23a8e836a2128", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/66346b22ff4d1f3410f4ee040ee23a8e836a2128/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1847f7a986716b0146e4f319f6f5fec8943500f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f1847f7a986716b0146e4f319f6f5fec8943500f", "html_url": "https://github.com/rust-lang/rust/commit/f1847f7a986716b0146e4f319f6f5fec8943500f"}, {"sha": "93c48a0977927fc3678600d0d79ef43e8f30761f", "url": "https://api.github.com/repos/rust-lang/rust/commits/93c48a0977927fc3678600d0d79ef43e8f30761f", "html_url": "https://github.com/rust-lang/rust/commit/93c48a0977927fc3678600d0d79ef43e8f30761f"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "6dbf2ea959e6a667f1be86e3a52079e48a3bf570", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/66346b22ff4d1f3410f4ee040ee23a8e836a2128/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66346b22ff4d1f3410f4ee040ee23a8e836a2128/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=66346b22ff4d1f3410f4ee040ee23a8e836a2128", "patch": "@@ -109,11 +109,11 @@ pub fn strip_doc_comment_decoration(comment: &str, span: Span) -> (String, Vec<(\n     if comment.starts_with(\"/*\") {\n         let doc = &comment[3..comment.len() - 2];\n         let mut sizes = vec![];\n-\n+        let mut contains_initial_stars = false;\n         for line in doc.lines() {\n             let offset = line.as_ptr() as usize - comment.as_ptr() as usize;\n             debug_assert_eq!(offset as u32 as usize, offset);\n-\n+            contains_initial_stars |= line.trim_left().starts_with('*');\n             // +1 for the newline\n             sizes.push((\n                 line.len() + 1,\n@@ -123,8 +123,25 @@ pub fn strip_doc_comment_decoration(comment: &str, span: Span) -> (String, Vec<(\n                 },\n             ));\n         }\n-\n-        return (doc.to_string(), sizes);\n+        if !contains_initial_stars {\n+            return (doc.to_string(), sizes);\n+        }\n+        // remove the initial '*'s if any\n+        let mut no_stars = String::with_capacity(doc.len());\n+        for line in doc.lines() {\n+            let mut chars = line.chars();\n+            while let Some(c) = chars.next() {\n+                if c.is_whitespace() {\n+                    no_stars.push(c);\n+                } else {\n+                    no_stars.push(if c == '*' { ' ' } else { c });\n+                    break;\n+                }\n+            }\n+            no_stars.push_str(chars.as_str());\n+            no_stars.push('\\n');\n+        }\n+        return (no_stars, sizes);\n     }\n \n     panic!(\"not a doc-comment: {}\", comment);"}, {"sha": "9e7b34e3ea50029ece8e5b967e4f52f11b0973fb", "filename": "tests/ui/doc.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/66346b22ff4d1f3410f4ee040ee23a8e836a2128/tests%2Fui%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66346b22ff4d1f3410f4ee040ee23a8e836a2128/tests%2Fui%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc.rs?ref=66346b22ff4d1f3410f4ee040ee23a8e836a2128", "patch": "@@ -153,3 +153,9 @@ fn issue_902_comment() {}\n /// }\n /// ```\n fn issue_1469() {}\n+\n+/**\n+ * This is a doc comment that should not be a list\n+ *This would also be an error under a strict common mark interpretation\n+ */\n+fn issue_1920() {}"}]}