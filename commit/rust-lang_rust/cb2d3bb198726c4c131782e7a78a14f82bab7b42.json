{"sha": "cb2d3bb198726c4c131782e7a78a14f82bab7b42", "node_id": "C_kwDOAAsO6NoAKGNiMmQzYmIxOTg3MjZjNGMxMzE3ODJlN2E3OGExNGY4MmJhYjdiNDI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-07-04T21:11:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-04T21:11:12Z"}, "message": "Rollup merge of #98878 - lcnr:more-rustc_pass_by_value, r=oli-obk\n\nadd more `rustc_pass_by_value`\n\nr? ```@oli-obk``` cc #98766", "tree": {"sha": "53dbcc5b1d8c568140230e085b1ec7108d3f7452", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/53dbcc5b1d8c568140230e085b1ec7108d3f7452"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cb2d3bb198726c4c131782e7a78a14f82bab7b42", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiw1dxCRBK7hj4Ov3rIwAAlZUIABqT85jVJHLR6ejzzImWYIHb\nKyX8ssRATJ3UkDaBmLB0oqQSxDbQy/62oIaog7P13CKTc3xdcUBEE5bw6QiiE7hM\nPfNxKw6qujeQuJLF3rllg2eP40Tu0xWlA5cKxMlwyeWzfEUH5DS0GsAP7ryqcKet\n3y8drluqk7PqE75f1YIBOtKf7lekdx6/zJ0eFCPVHeouvhOLGKQThyLrmtMcPQk8\nkOBW8qyPfXZNWRP/Remi2kA28BR3Gy+PlvbfCs8E44nfnFoxw1702isVtWLhTjD7\nLVfwFyMoWm6I2UCrYfem+cOvh+77oIE+1Adaqn5XYptiIcQVPX/PKYEBWp9C02c=\n=IZih\n-----END PGP SIGNATURE-----\n", "payload": "tree 53dbcc5b1d8c568140230e085b1ec7108d3f7452\nparent 9ad3ef13ac6b9a1c73f1129f0925740607a0961a\nparent 658b7f36525e7d6c915de45777b4fd5e7685ad17\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1656969072 +0200\ncommitter GitHub <noreply@github.com> 1656969072 +0200\n\nRollup merge of #98878 - lcnr:more-rustc_pass_by_value, r=oli-obk\n\nadd more `rustc_pass_by_value`\n\nr? ```@oli-obk``` cc #98766\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cb2d3bb198726c4c131782e7a78a14f82bab7b42", "html_url": "https://github.com/rust-lang/rust/commit/cb2d3bb198726c4c131782e7a78a14f82bab7b42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cb2d3bb198726c4c131782e7a78a14f82bab7b42/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ad3ef13ac6b9a1c73f1129f0925740607a0961a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ad3ef13ac6b9a1c73f1129f0925740607a0961a", "html_url": "https://github.com/rust-lang/rust/commit/9ad3ef13ac6b9a1c73f1129f0925740607a0961a"}, {"sha": "658b7f36525e7d6c915de45777b4fd5e7685ad17", "url": "https://api.github.com/repos/rust-lang/rust/commits/658b7f36525e7d6c915de45777b4fd5e7685ad17", "html_url": "https://github.com/rust-lang/rust/commit/658b7f36525e7d6c915de45777b4fd5e7685ad17"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "d34c6d9dee58d7e28b65ee6d900e36ccfe568ec9", "filename": "compiler/rustc_borrowck/src/constraint_generation.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_borrowck%2Fsrc%2Fconstraint_generation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_borrowck%2Fsrc%2Fconstraint_generation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fconstraint_generation.rs?ref=cb2d3bb198726c4c131782e7a78a14f82bab7b42", "patch": "@@ -149,7 +149,7 @@ impl<'cg, 'cx, 'tcx> Visitor<'tcx> for ConstraintGeneration<'cg, 'cx, 'tcx> {\n     fn visit_ascribe_user_ty(\n         &mut self,\n         _place: &Place<'tcx>,\n-        _variance: &ty::Variance,\n+        _variance: ty::Variance,\n         _user_ty: &UserTypeProjection,\n         _location: Location,\n     ) {"}, {"sha": "3b7eb820df87531d6a0b186347b8ac0bdfaa1d02", "filename": "compiler/rustc_middle/src/mir/syntax.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fsyntax.rs?ref=cb2d3bb198726c4c131782e7a78a14f82bab7b42", "patch": "@@ -311,6 +311,7 @@ pub enum StatementKind<'tcx> {\n \n /// Describes what kind of retag is to be performed.\n #[derive(Copy, Clone, TyEncodable, TyDecodable, Debug, PartialEq, Eq, Hash, HashStable)]\n+#[rustc_pass_by_value]\n pub enum RetagKind {\n     /// The initial retag when entering a function.\n     FnEntry,"}, {"sha": "d1477f9e2ae100bb99a430a420cfe68bc34f3e54", "filename": "compiler/rustc_middle/src/mir/visit.rs", "status": "modified", "additions": 12, "deletions": 13, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fvisit.rs?ref=cb2d3bb198726c4c131782e7a78a14f82bab7b42", "patch": "@@ -147,7 +147,7 @@ macro_rules! make_mir_visitor {\n             fn visit_ascribe_user_ty(\n                 &mut self,\n                 place: & $($mutability)? Place<'tcx>,\n-                variance: & $($mutability)? ty::Variance,\n+                variance: $(& $mutability)? ty::Variance,\n                 user_ty: & $($mutability)? UserTypeProjection,\n                 location: Location,\n             ) {\n@@ -164,7 +164,7 @@ macro_rules! make_mir_visitor {\n \n             fn visit_retag(\n                 &mut self,\n-                kind: & $($mutability)? RetagKind,\n+                kind: $(& $mutability)? RetagKind,\n                 place: & $($mutability)? Place<'tcx>,\n                 location: Location,\n             ) {\n@@ -425,7 +425,7 @@ macro_rules! make_mir_visitor {\n                 self.visit_source_info(source_info);\n                 match kind {\n                     StatementKind::Assign(\n-                        box(ref $($mutability)? place, ref $($mutability)? rvalue)\n+                        box (place, rvalue)\n                     ) => {\n                         self.visit_assign(place, rvalue, location);\n                     }\n@@ -465,13 +465,13 @@ macro_rules! make_mir_visitor {\n                         );\n                     }\n                     StatementKind::Retag(kind, place) => {\n-                        self.visit_retag(kind, place, location);\n+                        self.visit_retag($(& $mutability)? *kind, place, location);\n                     }\n                     StatementKind::AscribeUserType(\n-                        box(ref $($mutability)? place, ref $($mutability)? user_ty),\n+                        box (place, user_ty),\n                         variance\n                     ) => {\n-                        self.visit_ascribe_user_ty(place, variance, user_ty, location);\n+                        self.visit_ascribe_user_ty(place, $(& $mutability)? *variance, user_ty, location);\n                     }\n                     StatementKind::Coverage(coverage) => {\n                         self.visit_coverage(\n@@ -480,9 +480,9 @@ macro_rules! make_mir_visitor {\n                         )\n                     }\n                     StatementKind::CopyNonOverlapping(box crate::mir::CopyNonOverlapping{\n-                      ref $($mutability)? src,\n-                      ref $($mutability)? dst,\n-                      ref $($mutability)? count,\n+                        src,\n+                        dst,\n+                        count,\n                     }) => {\n                       self.visit_operand(src, location);\n                       self.visit_operand(dst, location);\n@@ -517,8 +517,7 @@ macro_rules! make_mir_visitor {\n                     TerminatorKind::GeneratorDrop |\n                     TerminatorKind::Unreachable |\n                     TerminatorKind::FalseEdge { .. } |\n-                    TerminatorKind::FalseUnwind { .. } => {\n-                    }\n+                    TerminatorKind::FalseUnwind { .. } => {}\n \n                     TerminatorKind::Return => {\n                         // `return` logically moves from the return place `_0`. Note that the place\n@@ -830,7 +829,7 @@ macro_rules! make_mir_visitor {\n \n             fn super_ascribe_user_ty(&mut self,\n                                      place: & $($mutability)? Place<'tcx>,\n-                                     _variance: & $($mutability)? ty::Variance,\n+                                     _variance: $(& $mutability)? ty::Variance,\n                                      user_ty: & $($mutability)? UserTypeProjection,\n                                      location: Location) {\n                 self.visit_place(\n@@ -847,7 +846,7 @@ macro_rules! make_mir_visitor {\n             }\n \n             fn super_retag(&mut self,\n-                           _kind: & $($mutability)? RetagKind,\n+                           _kind: $(& $mutability)? RetagKind,\n                            place: & $($mutability)? Place<'tcx>,\n                            location: Location) {\n                 self.visit_place("}, {"sha": "6744536338cbbc6bde9895194bc0b46e24eb8f92", "filename": "compiler/rustc_type_ir/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_type_ir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cb2d3bb198726c4c131782e7a78a14f82bab7b42/compiler%2Frustc_type_ir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_type_ir%2Fsrc%2Flib.rs?ref=cb2d3bb198726c4c131782e7a78a14f82bab7b42", "patch": "@@ -599,6 +599,7 @@ impl UnifyKey for FloatVid {\n }\n \n #[derive(Copy, Clone, PartialEq, Decodable, Encodable, Hash)]\n+#[rustc_pass_by_value]\n pub enum Variance {\n     Covariant,     // T<A> <: T<B> iff A <: B -- e.g., function return type\n     Invariant,     // T<A> <: T<B> iff B == A -- e.g., type of mutable cell"}]}