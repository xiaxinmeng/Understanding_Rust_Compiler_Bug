{"sha": "6196b928a44f469e37dc746a84a2175a560f09d4", "node_id": "C_kwDOAAsO6NoAKDYxOTZiOTI4YTQ0ZjQ2OWUzN2RjNzQ2YTg0YTIxNzVhNTYwZjA5ZDQ", "commit": {"author": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2021-11-18T08:12:29Z"}, "committer": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2021-11-18T08:24:24Z"}, "message": "Fix proc macro ABI version checks", "tree": {"sha": "e0d9b36eaca2229adca4a887990f20a335f4d36e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e0d9b36eaca2229adca4a887990f20a335f4d36e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6196b928a44f469e37dc746a84a2175a560f09d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6196b928a44f469e37dc746a84a2175a560f09d4", "html_url": "https://github.com/rust-lang/rust/commit/6196b928a44f469e37dc746a84a2175a560f09d4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6196b928a44f469e37dc746a84a2175a560f09d4/comments", "author": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "64a73dcfba277587843bd2548b0d6990dc4a4b16", "url": "https://api.github.com/repos/rust-lang/rust/commits/64a73dcfba277587843bd2548b0d6990dc4a4b16", "html_url": "https://github.com/rust-lang/rust/commit/64a73dcfba277587843bd2548b0d6990dc4a4b16"}], "stats": {"total": 36, "additions": 20, "deletions": 16}, "files": [{"sha": "0de15b48329a4d628a5ef71645343d58304f44bc", "filename": "crates/proc_macro_srv/src/abis/mod.rs", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/6196b928a44f469e37dc746a84a2175a560f09d4/crates%2Fproc_macro_srv%2Fsrc%2Fabis%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6196b928a44f469e37dc746a84a2175a560f09d4/crates%2Fproc_macro_srv%2Fsrc%2Fabis%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc_macro_srv%2Fsrc%2Fabis%2Fmod.rs?ref=6196b928a44f469e37dc746a84a2175a560f09d4", "patch": "@@ -69,22 +69,26 @@ impl Abi {\n         symbol_name: String,\n         info: RustCInfo,\n     ) -> Result<Abi, LoadProcMacroDylibError> {\n-        if info.version.0 != 1 {\n-            Err(LoadProcMacroDylibError::UnsupportedABI)\n-        } else if info.version.1 < 47 {\n-            Err(LoadProcMacroDylibError::UnsupportedABI)\n-        } else if info.version.1 < 54 {\n-            let inner = unsafe { Abi_1_47::from_lib(lib, symbol_name) }?;\n-            Ok(Abi::Abi1_47(inner))\n-        } else if info.version.1 < 56 {\n-            let inner = unsafe { Abi_1_55::from_lib(lib, symbol_name) }?;\n-            Ok(Abi::Abi1_55(inner))\n-        } else if info.version.1 < 57 {\n-            let inner = unsafe { Abi_1_56::from_lib(lib, symbol_name) }?;\n-            Ok(Abi::Abi1_56(inner))\n-        } else {\n-            let inner = unsafe { Abi_1_58::from_lib(lib, symbol_name) }?;\n-            Ok(Abi::Abi1_58(inner))\n+        // FIXME: this should use exclusive ranges when they're stable\n+        // https://github.com/rust-lang/rust/issues/37854\n+        match (info.version.0, info.version.1) {\n+            (1, 47..=54) => {\n+                let inner = unsafe { Abi_1_47::from_lib(lib, symbol_name) }?;\n+                Ok(Abi::Abi1_47(inner))\n+            }\n+            (1, 55..=55) => {\n+                let inner = unsafe { Abi_1_55::from_lib(lib, symbol_name) }?;\n+                Ok(Abi::Abi1_55(inner))\n+            }\n+            (1, 56..=57) => {\n+                let inner = unsafe { Abi_1_56::from_lib(lib, symbol_name) }?;\n+                Ok(Abi::Abi1_56(inner))\n+            }\n+            (1, 58..) => {\n+                let inner = unsafe { Abi_1_58::from_lib(lib, symbol_name) }?;\n+                Ok(Abi::Abi1_58(inner))\n+            }\n+            _ => Err(LoadProcMacroDylibError::UnsupportedABI),\n         }\n     }\n "}]}