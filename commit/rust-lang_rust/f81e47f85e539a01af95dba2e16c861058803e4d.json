{"sha": "f81e47f85e539a01af95dba2e16c861058803e4d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4MWU0N2Y4NWU1MzlhMDFhZjk1ZGJhMmUxNmM4NjEwNTg4MDNlNGQ=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-10-25T12:31:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-25T12:31:00Z"}, "message": "Rollup merge of #54977 - estebank:macro-arg-parse, r=pnkfelix\n\nAccept `Option<Box<$t:ty>>` in macro argument\n\nGiven the following code, compile successfuly:\n\n```\nmacro_rules! test {\n    (\n        fn fun() -> Option<Box<$t:ty>>;\n    ) => {\n        fn fun(x: $t) -> Option<Box<$t>>\n        { Some(Box::new(x)) }\n    }\n}\n\ntest! {\n    fn fun() -> Option<Box<i32>>;\n}\n```\n\nFix #25274.", "tree": {"sha": "b91c3f1f6d0a87812768a84a2da4d5a5ed38853c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b91c3f1f6d0a87812768a84a2da4d5a5ed38853c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f81e47f85e539a01af95dba2e16c861058803e4d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb0beECRBK7hj4Ov3rIwAAdHIIAGeiv4kv1Ly8wqNJdtuO6yO3\nPwksPiKBfFJlMqrHdxgbz6YlgD4B+AkuJakC+4dFThkCJcNT6NbVAipuweF6e/v3\nJ1oaNdIRUdpBg8Damf2C8DoGBKXHGbBb6e4TvaudNJEuYZEyYuMFgSC65v7K731i\nomLPZxA4g5cExWrhEuz+0VHANGomRRx4mZYj82oQuuSn90KpGCiBhh0QA14/4egK\n+m+eU5Vr2UnNA+YtuSxX0ZQzgqB2pelLQLeurcXhX4nzc4iHf52R/abO2CFbx5aY\nnmiWqK29qGCD/uQLoOmq/NKrCGpvp0e3dAZ/mi0ArkeiaHHNKDC6IcWCIJAHq/c=\n=m4I2\n-----END PGP SIGNATURE-----\n", "payload": "tree b91c3f1f6d0a87812768a84a2da4d5a5ed38853c\nparent 699f591a16181b6fa77411104ce609138dc5ce80\nparent c77a0cf5881e8e894d6fc15403cca002b9781d15\nauthor Pietro Albini <pietro@pietroalbini.org> 1540470660 +0200\ncommitter GitHub <noreply@github.com> 1540470660 +0200\n\nRollup merge of #54977 - estebank:macro-arg-parse, r=pnkfelix\n\nAccept `Option<Box<$t:ty>>` in macro argument\n\nGiven the following code, compile successfuly:\n\n```\nmacro_rules! test {\n    (\n        fn fun() -> Option<Box<$t:ty>>;\n    ) => {\n        fn fun(x: $t) -> Option<Box<$t>>\n        { Some(Box::new(x)) }\n    }\n}\n\ntest! {\n    fn fun() -> Option<Box<i32>>;\n}\n```\n\nFix #25274.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f81e47f85e539a01af95dba2e16c861058803e4d", "html_url": "https://github.com/rust-lang/rust/commit/f81e47f85e539a01af95dba2e16c861058803e4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f81e47f85e539a01af95dba2e16c861058803e4d/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "699f591a16181b6fa77411104ce609138dc5ce80", "url": "https://api.github.com/repos/rust-lang/rust/commits/699f591a16181b6fa77411104ce609138dc5ce80", "html_url": "https://github.com/rust-lang/rust/commit/699f591a16181b6fa77411104ce609138dc5ce80"}, {"sha": "c77a0cf5881e8e894d6fc15403cca002b9781d15", "url": "https://api.github.com/repos/rust-lang/rust/commits/c77a0cf5881e8e894d6fc15403cca002b9781d15", "html_url": "https://github.com/rust-lang/rust/commit/c77a0cf5881e8e894d6fc15403cca002b9781d15"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "805aa9bef227d1d1b524e41c0074a281c1a079d1", "filename": "src/libsyntax/ext/tt/macro_rules.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f81e47f85e539a01af95dba2e16c861058803e4d/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f81e47f85e539a01af95dba2e16c861058803e4d/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_rules.rs?ref=f81e47f85e539a01af95dba2e16c861058803e4d", "patch": "@@ -905,7 +905,8 @@ fn is_in_follow(tok: &quoted::TokenTree, frag: &str) -> Result<bool, (String, &'\n             \"path\" | \"ty\" => match *tok {\n                 TokenTree::Token(_, ref tok) => match *tok {\n                     OpenDelim(token::DelimToken::Brace) | OpenDelim(token::DelimToken::Bracket) |\n-                    Comma | FatArrow | Colon | Eq | Gt | Semi | BinOp(token::Or) => Ok(true),\n+                    Comma | FatArrow | Colon | Eq | Gt | BinOp(token::Shr) | Semi |\n+                    BinOp(token::Or) => Ok(true),\n                     Ident(i, false) if i.name == \"as\" || i.name == \"where\" => Ok(true),\n                     _ => Ok(false)\n                 },"}, {"sha": "e81b2c7a7233b197eb8112d698dfca596bae84d1", "filename": "src/test/run-pass/macros/issue-25274.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f81e47f85e539a01af95dba2e16c861058803e4d/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f81e47f85e539a01af95dba2e16c861058803e4d/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacros%2Fissue-25274.rs?ref=f81e47f85e539a01af95dba2e16c861058803e4d", "patch": "@@ -0,0 +1,16 @@\n+macro_rules! test {\n+    (\n+        fn fun() -> Option<Box<$t:ty>>;\n+    ) => {\n+        fn fun(x: $t) -> Option<Box<$t>>\n+        { Some(Box::new(x)) }\n+    }\n+}\n+\n+test! {\n+    fn fun() -> Option<Box<i32>>;\n+}\n+\n+fn main() {\n+    println!(\"{}\", fun(0).unwrap());\n+}"}]}