{"sha": "0b21ea2161923a87f65932b6abb5e7a94003ec3a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiMjFlYTIxNjE5MjNhODdmNjU5MzJiNmFiYjVlN2E5NDAwM2VjM2E=", "commit": {"author": {"name": "Ellen", "email": "supbscripter@gmail.com", "date": "2021-04-28T19:44:40Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2021-07-28T00:50:11Z"}, "message": "Unyeet const param defaults", "tree": {"sha": "d68e69691f7edabe5ca139c2ff4ae286f3e4dc3b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d68e69691f7edabe5ca139c2ff4ae286f3e4dc3b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0b21ea2161923a87f65932b6abb5e7a94003ec3a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0b21ea2161923a87f65932b6abb5e7a94003ec3a", "html_url": "https://github.com/rust-lang/rust/commit/0b21ea2161923a87f65932b6abb5e7a94003ec3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0b21ea2161923a87f65932b6abb5e7a94003ec3a/comments", "author": {"login": "BoxyUwU", "id": 21149742, "node_id": "MDQ6VXNlcjIxMTQ5NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/21149742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BoxyUwU", "html_url": "https://github.com/BoxyUwU", "followers_url": "https://api.github.com/users/BoxyUwU/followers", "following_url": "https://api.github.com/users/BoxyUwU/following{/other_user}", "gists_url": "https://api.github.com/users/BoxyUwU/gists{/gist_id}", "starred_url": "https://api.github.com/users/BoxyUwU/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BoxyUwU/subscriptions", "organizations_url": "https://api.github.com/users/BoxyUwU/orgs", "repos_url": "https://api.github.com/users/BoxyUwU/repos", "events_url": "https://api.github.com/users/BoxyUwU/events{/privacy}", "received_events_url": "https://api.github.com/users/BoxyUwU/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7fa07036fa3e87f536fa3bedd3daad51dfeaf16", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7fa07036fa3e87f536fa3bedd3daad51dfeaf16", "html_url": "https://github.com/rust-lang/rust/commit/e7fa07036fa3e87f536fa3bedd3daad51dfeaf16"}], "stats": {"total": 57, "additions": 56, "deletions": 1}, "files": [{"sha": "1d3f4669fcd6f1af8a6398c93888a8f3fd29916b", "filename": "src/types.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0b21ea2161923a87f65932b6abb5e7a94003ec3a/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b21ea2161923a87f65932b6abb5e7a94003ec3a/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=0b21ea2161923a87f65932b6abb5e7a94003ec3a", "patch": "@@ -571,13 +571,23 @@ impl Rewrite for ast::GenericParam {\n         if let ast::GenericParamKind::Const {\n             ref ty,\n             kw_span: _,\n-            default: _,\n+            default,\n         } = &self.kind\n         {\n             result.push_str(\"const \");\n             result.push_str(rewrite_ident(context, self.ident));\n             result.push_str(\": \");\n             result.push_str(&ty.rewrite(context, shape)?);\n+            if let Some(default) = default {\n+                let eq_str = match context.config.type_punctuation_density() {\n+                    TypeDensity::Compressed => \"=\",\n+                    TypeDensity::Wide => \" = \",\n+                };\n+                result.push_str(eq_str);\n+                let budget = shape.width.checked_sub(result.len())?;\n+                let rewrite = default.rewrite(context, Shape::legacy(budget, shape.indent))?;\n+                result.push_str(&rewrite);\n+            }\n         } else {\n             result.push_str(rewrite_ident(context, self.ident));\n         }"}, {"sha": "43d540c4a5d72441c5df11299ff0f074bf01d42d", "filename": "tests/source/issue-4816/lib.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/0b21ea2161923a87f65932b6abb5e7a94003ec3a/tests%2Fsource%2Fissue-4816%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b21ea2161923a87f65932b6abb5e7a94003ec3a/tests%2Fsource%2Fissue-4816%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-4816%2Flib.rs?ref=0b21ea2161923a87f65932b6abb5e7a94003ec3a", "patch": "@@ -0,0 +1,10 @@\n+#![feature(const_generics_defaults)]\n+struct Foo<const N: usize    =  1, const N2: usize =           2>;\n+struct Bar<const N: usize, const N2: usize = {      N + \n+1 }>;\n+struct Lots<const N1BlahFooUwU: usize = { 10 + 28 + 1872 / 10 * 3 },const N2SecondParamOhmyyy: usize = { N1BlahFooUwU / 2 + 10 * 2 },>;\n+struct NamesRHard<const N: usize = { 1 + 1 + 1 + 1 + 1 + 1 }>;\n+struct FooBar<\n+    const LessThan100ButClose: usize = {1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1}\n+>;\n+struct FooBarrrrrrrr<const N: usize        =           {13478234326456456444323871+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+1+1+1 + 1},>;"}, {"sha": "246e775e1febcf304b866155f0a4e64b863e903e", "filename": "tests/target/issue-4816/lib.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/0b21ea2161923a87f65932b6abb5e7a94003ec3a/tests%2Ftarget%2Fissue-4816%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0b21ea2161923a87f65932b6abb5e7a94003ec3a/tests%2Ftarget%2Fissue-4816%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-4816%2Flib.rs?ref=0b21ea2161923a87f65932b6abb5e7a94003ec3a", "patch": "@@ -0,0 +1,35 @@\n+#![feature(const_generics_defaults)]\n+struct Foo<const N: usize = 1, const N2: usize = 2>;\n+struct Bar<const N: usize, const N2: usize = { N + 1 }>;\n+struct Lots<\n+    const N1BlahFooUwU: usize = { 10 + 28 + 1872 / 10 * 3 },\n+    const N2SecondParamOhmyyy: usize = { N1BlahFooUwU / 2 + 10 * 2 },\n+>;\n+struct NamesRHard<const N: usize = { 1 + 1 + 1 + 1 + 1 + 1 }>;\n+struct FooBar<\n+    const LessThan100ButClose: usize = {\n+        1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1\n+    },\n+>;\n+struct FooBarrrrrrrr<\n+    const N: usize = {\n+        13478234326456456444323871\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+    },\n+>;"}]}