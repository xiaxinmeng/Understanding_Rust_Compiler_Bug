{"sha": "ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479", "node_id": "C_kwDOAAsO6NoAKGVhNDJmM2NmZDdkYWVmZjU5NmUyZTllYjNmMmE5NmFjYTNlZDM0Nzk", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-08-13T21:10:05Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-13T21:10:05Z"}, "message": "Rollup merge of #100407 - RalfJung:no-int2ptr, r=Mark-Simulacrum\n\navoid some int2ptr casts in thread_local_key tests", "tree": {"sha": "7fdb00165acaf828c0d0f7c1f1e3f1deb701a1f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7fdb00165acaf828c0d0f7c1f1e3f1deb701a1f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi+BMtCRBK7hj4Ov3rIwAALKQIAG5VmXoQ/fT1EMra8CZrCS/W\njYJVmosaQl5XUNQd7KJ1okfCT5a3Mwnxzx1VmBIogulyLsgyeVQxEdsRCbK45V40\n/dfn2yy2iMOQBPcwk6BHahYGLWmz8VDWcgQGRzr5shbVsDLSzvneHsvjuNxPFH6W\nHvtHLJuv6ZmeO6RnmO4BTo/f+FIFmMJoZS2zd8bsdsMiPYu2c3C84e4gLAr75OBg\nbL6HxblGL0GALbEd4GC0yAlQyejipzt2qOvNp9Unykj76Zfihe6tTnApCE4nNxU8\nRMP/3iWQ6aytuxJ/baJbfxaruUcXxDnDZhriu0CSTJPLnXGg5vxDdrttmLQR0Lo=\n=8qVh\n-----END PGP SIGNATURE-----\n", "payload": "tree 7fdb00165acaf828c0d0f7c1f1e3f1deb701a1f2\nparent 4b51df3df0e740016fd7f2fd1bba48fc5527316b\nparent b5786dcae6c5a300f146fcbf6dab509d2cd48ec8\nauthor Michael Goulet <michael@errs.io> 1660425005 -0700\ncommitter GitHub <noreply@github.com> 1660425005 -0700\n\nRollup merge of #100407 - RalfJung:no-int2ptr, r=Mark-Simulacrum\n\navoid some int2ptr casts in thread_local_key tests\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479", "html_url": "https://github.com/rust-lang/rust/commit/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b51df3df0e740016fd7f2fd1bba48fc5527316b", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b51df3df0e740016fd7f2fd1bba48fc5527316b", "html_url": "https://github.com/rust-lang/rust/commit/4b51df3df0e740016fd7f2fd1bba48fc5527316b"}, {"sha": "b5786dcae6c5a300f146fcbf6dab509d2cd48ec8", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5786dcae6c5a300f146fcbf6dab509d2cd48ec8", "html_url": "https://github.com/rust-lang/rust/commit/b5786dcae6c5a300f146fcbf6dab509d2cd48ec8"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "6f32b858f09666a2a22a4dadbf1c8e94d70c3b39", "filename": "library/std/src/sys_common/thread_local_key/tests.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_local_key%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_local_key%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_local_key%2Ftests.rs?ref=ea42f3cfd7daeff596e2e9eb3f2a96aca3ed3479", "patch": "@@ -1,4 +1,5 @@\n use super::{Key, StaticKey};\n+use core::ptr;\n \n fn assert_sync<T: Sync>() {}\n fn assert_send<T: Send>() {}\n@@ -12,8 +13,8 @@ fn smoke() {\n     let k2 = Key::new(None);\n     assert!(k1.get().is_null());\n     assert!(k2.get().is_null());\n-    k1.set(1 as *mut _);\n-    k2.set(2 as *mut _);\n+    k1.set(ptr::invalid_mut(1));\n+    k2.set(ptr::invalid_mut(2));\n     assert_eq!(k1.get() as usize, 1);\n     assert_eq!(k2.get() as usize, 2);\n }\n@@ -26,8 +27,8 @@ fn statik() {\n     unsafe {\n         assert!(K1.get().is_null());\n         assert!(K2.get().is_null());\n-        K1.set(1 as *mut _);\n-        K2.set(2 as *mut _);\n+        K1.set(ptr::invalid_mut(1));\n+        K2.set(ptr::invalid_mut(2));\n         assert_eq!(K1.get() as usize, 1);\n         assert_eq!(K2.get() as usize, 2);\n     }"}]}