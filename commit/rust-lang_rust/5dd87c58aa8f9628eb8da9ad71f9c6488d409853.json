{"sha": "5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "node_id": "C_kwDOAAsO6NoAKDVkZDg3YzU4YWE4Zjk2MjhlYjhkYTlhZDcxZjljNjQ4OGQ0MDk4NTM", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-01-23T17:44:01Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-01-23T22:08:33Z"}, "message": "rustdoc: simplify settings popover DOM\n\n* Changes the class names so that they all start with `setting-`.\n  That should make it harder to accidentally use a setting class outside\n  the settings popover, where loading the CSS might accidentally change\n  the styles of something unrelated.\n* Get rid of an unnecessary wrapper DIV around the radio button line.\n* Simplify CSS selectors by making the DOM easier and more intuitive\n  to target.", "tree": {"sha": "df7567853532bffd501f169f98c89475fd3dbbab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df7567853532bffd501f169f98c89475fd3dbbab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "html_url": "https://github.com/rust-lang/rust/commit/5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8e6a9e8b6251bbc8276cb78cabe1998deecbed7", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8e6a9e8b6251bbc8276cb78cabe1998deecbed7", "html_url": "https://github.com/rust-lang/rust/commit/c8e6a9e8b6251bbc8276cb78cabe1998deecbed7"}], "stats": {"total": 122, "additions": 60, "deletions": 62}, "files": [{"sha": "c28cefebc8bf5fccf3796a295959267f6a945810", "filename": "src/librustdoc/html/static/css/settings.css", "status": "modified", "additions": 12, "deletions": 16, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "raw_url": "https://github.com/rust-lang/rust/raw/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css?ref=5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "patch": "@@ -3,8 +3,7 @@\n \tposition: relative;\n }\n \n-.setting-line .radio-line input,\n-.setting-line .settings-toggle input {\n+.setting-radio input, .setting-check input {\n \tmargin-right: 0.3em;\n \theight: 1.2rem;\n \twidth: 1.2rem;\n@@ -14,21 +13,20 @@\n \t-webkit-appearance: none;\n \tcursor: pointer;\n }\n-.setting-line .radio-line input {\n+.setting-radio input {\n \tborder-radius: 50%;\n }\n-.setting-line .settings-toggle input:checked {\n+.setting-check input:checked {\n \tcontent: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 40 40\">\\\n \t\t<path d=\"M7,25L17,32L33,12\" fill=\"none\" stroke=\"black\" stroke-width=\"5\"/>\\\n \t\t<path d=\"M7,23L17,30L33,10\" fill=\"none\" stroke=\"white\" stroke-width=\"5\"/></svg>');\n }\n \n-.setting-line .radio-line input + span,\n-.setting-line .settings-toggle span {\n+.setting-radio span, .setting-check span {\n \tpadding-bottom: 1px;\n }\n \n-.radio-line .choice {\n+.setting-radio {\n \tmargin-top: 0.1em;\n \tmargin-bottom: 0.1em;\n \tmin-width: 3.8em;\n@@ -37,11 +35,11 @@\n \talign-items: center;\n \tcursor: pointer;\n }\n-.radio-line .choice + .choice {\n+.setting-radio + .setting-radio {\n \tmargin-left: 0.5em;\n }\n \n-.settings-toggle {\n+.setting-check {\n \tposition: relative;\n \twidth: 100%;\n \tmargin-right: 20px;\n@@ -50,23 +48,21 @@\n \tcursor: pointer;\n }\n \n-.setting-line .radio-line input:checked {\n+.setting-radio input:checked {\n \tbox-shadow: inset 0 0 0 3px var(--main-background-color);\n \tbackground-color: var(--settings-input-color);\n }\n-.setting-line .settings-toggle input:checked {\n+.setting-check input:checked {\n \tbackground-color: var(--settings-input-color);\n }\n-.setting-line .radio-line input:focus,\n-.setting-line .settings-toggle input:focus {\n+.setting-radio input:focus, .setting-check input:focus {\n \tbox-shadow: 0 0 1px 1px var(--settings-input-color);\n }\n /* In here we combine both `:focus` and `:checked` properties. */\n-.setting-line .radio-line input:checked:focus {\n+.setting-radio input:checked:focus {\n \tbox-shadow: inset 0 0 0 3px var(--main-background-color),\n \t\t0 0 2px 2px var(--settings-input-color);\n }\n-.setting-line .radio-line input:hover,\n-.setting-line .settings-toggle input:hover {\n+.setting-radio input:hover, .setting-check input:hover {\n \tborder-color: var(--settings-input-color) !important;\n }"}, {"sha": "fef856d5e2c2a0a13f3fbf5c1280029b72780a33", "filename": "src/librustdoc/html/static/js/settings.js", "status": "modified", "additions": 21, "deletions": 19, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "raw_url": "https://github.com/rust-lang/rust/raw/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js?ref=5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "patch": "@@ -48,13 +48,13 @@\n     }\n \n     function showLightAndDark() {\n-        removeClass(document.getElementById(\"preferred-light-theme\").parentElement, \"hidden\");\n-        removeClass(document.getElementById(\"preferred-dark-theme\").parentElement, \"hidden\");\n+        removeClass(document.getElementById(\"preferred-light-theme\"), \"hidden\");\n+        removeClass(document.getElementById(\"preferred-dark-theme\"), \"hidden\");\n     }\n \n     function hideLightAndDark() {\n-        addClass(document.getElementById(\"preferred-light-theme\").parentElement, \"hidden\");\n-        addClass(document.getElementById(\"preferred-dark-theme\").parentElement, \"hidden\");\n+        addClass(document.getElementById(\"preferred-light-theme\"), \"hidden\");\n+        addClass(document.getElementById(\"preferred-dark-theme\"), \"hidden\");\n     }\n \n     function updateLightAndDark() {\n@@ -127,38 +127,40 @@\n         let output = \"\";\n \n         for (const setting of settings) {\n-            output += \"<div class=\\\"setting-line\\\">\";\n             const js_data_name = setting[\"js_name\"];\n             const setting_name = setting[\"name\"];\n \n             if (setting[\"options\"] !== undefined) {\n                 // This is a select setting.\n                 output += `\\\n-<div class=\"radio-line\" id=\"${js_data_name}\">\n-    <div class=\"setting-name\">${setting_name}</div>\n-<div class=\"choices\">`;\n+<div class=\"setting-line\" id=\"${js_data_name}\">\n+    <div class=\"setting-radio-name\">${setting_name}</div>\n+    <div class=\"setting-radio-choices\">`;\n                 onEach(setting[\"options\"], option => {\n                     const checked = option === setting[\"default\"] ? \" checked\" : \"\";\n                     const full = `${js_data_name}-${option.replace(/ /g,\"-\")}`;\n \n                     output += `\\\n-<label for=\"${full}\" class=\"choice\">\n-    <input type=\"radio\" name=\"${js_data_name}\"\n-        id=\"${full}\" value=\"${option}\"${checked}>\n-    <span>${option}</span>\n-</label>`;\n+        <label for=\"${full}\" class=\"setting-radio\">\n+            <input type=\"radio\" name=\"${js_data_name}\"\n+                id=\"${full}\" value=\"${option}\"${checked}>\n+            <span>${option}</span>\n+        </label>`;\n                 });\n-                output += \"</div></div>\";\n+                output += `\\\n+    </div>\n+</div>`;\n             } else {\n                 // This is a checkbox toggle.\n                 const checked = setting[\"default\"] === true ? \" checked\" : \"\";\n                 output += `\\\n-<label class=\"settings-toggle\">\\\n-    <input type=\"checkbox\" id=\"${js_data_name}\"${checked}>\\\n-    <span class=\"label\">${setting_name}</span>\\\n-</label>`;\n+<div class=\"setting-line\">\\\n+    <label class=\"setting-check\">\\\n+        <input type=\"checkbox\" id=\"${js_data_name}\"${checked}>\\\n+        <span>${setting_name}</span>\\\n+    </label>\\\n+</div>`;\n             }\n-            output += \"</div>\";\n         }\n         return output;\n     }"}, {"sha": "3e444cbd6dc9985bcab38905b01d3e62f9fa6cb8", "filename": "tests/rustdoc-gui/mobile.goml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Fmobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Fmobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Fmobile.goml?ref=5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "patch": "@@ -28,7 +28,7 @@ goto: \"file://\" + |DOC_PATH| + \"/settings.html\"\n size: (400, 600)\n // Ignored for now https://github.com/rust-lang/rust/issues/93784.\n // compare-elements-position-near-false: (\n-//     \"#preferred-light-theme .setting-name\",\n-//     \"#preferred-light-theme .choice\",\n+//     \"#preferred-light-theme .setting-radio-name\",\n+//     \"#preferred-light-theme .setting-radio\",\n //     {\"y\": 16},\n // )"}, {"sha": "a84172885780856b3927b12a212ceb2666f9da68", "filename": "tests/rustdoc-gui/settings.goml", "status": "modified", "additions": 21, "deletions": 21, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Fsettings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Fsettings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Fsettings.goml?ref=5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "patch": "@@ -43,12 +43,12 @@ wait-for: \"#settings\"\n // We check that the \"Use system theme\" is disabled.\n assert-property: (\"#theme-system-preference\", {\"checked\": \"false\"})\n // Meaning that only the \"theme\" menu is showing up.\n-assert: \".setting-line:not(.hidden) #theme\"\n-assert: \".setting-line.hidden #preferred-dark-theme\"\n-assert: \".setting-line.hidden #preferred-light-theme\"\n+assert: \"#theme.setting-line:not(.hidden)\"\n+assert: \"#preferred-dark-theme.setting-line.hidden\"\n+assert: \"#preferred-light-theme.setting-line.hidden\"\n \n // We check that the correct theme is selected.\n-assert-property: (\"#theme .choices #theme-dark\", {\"checked\": \"true\"})\n+assert-property: (\"#theme .setting-radio-choices #theme-dark\", {\"checked\": \"true\"})\n \n // Some style checks...\n move-cursor-to: \"#settings-menu > a\"\n@@ -109,31 +109,31 @@ assert-css: (\n         \"box-shadow\": \"rgb(33, 150, 243) 0px 0px 1px 1px\",\n     },\n )\n-// Now we check the setting-name for radio buttons is on a different line than the label.\n+// Now we check the setting-radio-name is on a different line than the label.\n compare-elements-position-near: (\n-    \"#theme .setting-name\",\n-    \"#theme .choices\",\n+    \"#theme .setting-radio-name\",\n+    \"#theme .setting-radio-choices\",\n     {\"x\": 1}\n )\n compare-elements-position-near-false: (\n-    \"#theme .setting-name\",\n-    \"#theme .choices\",\n+    \"#theme .setting-radio-name\",\n+    \"#theme .setting-radio-choices\",\n     {\"y\": 1}\n )\n // Now we check that the label positions are all on the same line.\n compare-elements-position-near: (\n-    \"#theme .choices #theme-light\",\n-    \"#theme .choices #theme-dark\",\n+    \"#theme .setting-radio-choices #theme-light\",\n+    \"#theme .setting-radio-choices #theme-dark\",\n     {\"y\": 1}\n )\n compare-elements-position-near: (\n-    \"#theme .choices #theme-dark\",\n-    \"#theme .choices #theme-ayu\",\n+    \"#theme .setting-radio-choices #theme-dark\",\n+    \"#theme .setting-radio-choices #theme-ayu\",\n     {\"y\": 1}\n )\n compare-elements-position-near: (\n-    \"#theme .choices #theme-ayu\",\n-    \"#theme .choices #theme-system-preference\",\n+    \"#theme .setting-radio-choices #theme-ayu\",\n+    \"#theme .setting-radio-choices #theme-system-preference\",\n     {\"y\": 1}\n )\n \n@@ -180,17 +180,17 @@ assert-css: (\n // We now switch the display.\n click: \"#theme-system-preference\"\n // Wait for the hidden element to show up.\n-wait-for: \".setting-line:not(.hidden) #preferred-dark-theme\"\n-assert: \".setting-line:not(.hidden) #preferred-light-theme\"\n+wait-for: \"#preferred-dark-theme.setting-line:not(.hidden)\"\n+assert: \"#preferred-light-theme.setting-line:not(.hidden)\"\n \n // We check their text as well.\n-assert-text: (\"#preferred-dark-theme .setting-name\", \"Preferred dark theme\")\n-assert-text: (\"#preferred-light-theme .setting-name\", \"Preferred light theme\")\n+assert-text: (\"#preferred-dark-theme .setting-radio-name\", \"Preferred dark theme\")\n+assert-text: (\"#preferred-light-theme .setting-radio-name\", \"Preferred light theme\")\n \n // We now check that clicking on the toggles' text is like clicking on the checkbox.\n // To test it, we use the \"Disable keyboard shortcuts\".\n local-storage: {\"rustdoc-disable-shortcuts\": \"false\"}\n-click: \".setting-line:last-child .settings-toggle .label\"\n+click: \".setting-line:last-child .setting-check span\"\n assert-local-storage: {\"rustdoc-disable-shortcuts\": \"true\"}\n \n // Make sure that \"Disable keyboard shortcuts\" actually took effect.\n@@ -200,7 +200,7 @@ assert-false: \"#help-button .popover\"\n wait-for-css: (\"#settings-menu .popover\", {\"display\": \"block\"})\n \n // Now turn keyboard shortcuts back on, and see if they work.\n-click: \".setting-line:last-child .settings-toggle .label\"\n+click: \".setting-line:last-child .setting-check span\"\n assert-local-storage: {\"rustdoc-disable-shortcuts\": \"false\"}\n press-key: \"Escape\"\n press-key: \"?\""}, {"sha": "31c9d99aa832491b76ffc8af89b79c6ba91c76b5", "filename": "tests/rustdoc-gui/theme-change.goml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Ftheme-change.goml", "raw_url": "https://github.com/rust-lang/rust/raw/5dd87c58aa8f9628eb8da9ad71f9c6488d409853/tests%2Frustdoc-gui%2Ftheme-change.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Ftheme-change.goml?ref=5dd87c58aa8f9628eb8da9ad71f9c6488d409853", "patch": "@@ -43,7 +43,7 @@ assert-local-storage: { \"rustdoc-theme\": \"ayu\" }\n \n assert-local-storage-false: { \"rustdoc-use-system-theme\": \"true\" }\n click: \"#theme-system-preference\"\n-wait-for: \".setting-line:not(.hidden) #preferred-light-theme\"\n+wait-for: \"#preferred-light-theme.setting-line:not(.hidden)\"\n assert-local-storage: { \"rustdoc-use-system-theme\": \"true\" }\n // We click on both preferred light and dark themes to be sure that there is a change.\n click: \"#preferred-light-theme-dark\"\n@@ -52,16 +52,16 @@ wait-for-css: (\"body\", { \"background-color\": |background_dark| })\n \n reload:\n // Ensure that the \"preferred themes\" are still displayed.\n-wait-for: \".setting-line:not(.hidden) #preferred-light-theme\"\n+wait-for: \"#preferred-light-theme.setting-line:not(.hidden)\"\n click: \"#theme-light\"\n wait-for-css: (\"body\", { \"background-color\": |background_light| })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n // Ensure it's now hidden again\n-wait-for: \".setting-line.hidden #preferred-light-theme\"\n+wait-for: \"#preferred-light-theme.setting-line.hidden\"\n // And ensure the theme was rightly set.\n wait-for-css: (\"body\", { \"background-color\": |background_light| })\n assert-local-storage: { \"rustdoc-theme\": \"light\" }\n \n reload:\n wait-for: \"#settings\"\n-assert: \".setting-line.hidden #preferred-light-theme\"\n+assert: \"#preferred-light-theme.setting-line.hidden\""}]}