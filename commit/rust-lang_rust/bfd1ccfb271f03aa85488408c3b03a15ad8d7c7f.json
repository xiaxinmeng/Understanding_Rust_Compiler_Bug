{"sha": "bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmZDFjY2ZiMjcxZjAzYWE4NTQ4ODQwOGMzYjAzYTE1YWQ4ZDdjN2Y=", "commit": {"author": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-02-10T21:30:30Z"}, "committer": {"name": "Amanieu d'Antras", "email": "amanieu@gmail.com", "date": "2021-02-10T21:30:30Z"}, "message": "Seal the CommandExt, OsStrExt and OsStringExt traits", "tree": {"sha": "cf4ca3826bac096cfbab12f66881c9594dc4e5ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cf4ca3826bac096cfbab12f66881c9594dc4e5ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "html_url": "https://github.com/rust-lang/rust/commit/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/comments", "author": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07194ffcd25b0871ce560b9f702e52db27ac9f77", "url": "https://api.github.com/repos/rust-lang/rust/commits/07194ffcd25b0871ce560b9f702e52db27ac9f77", "html_url": "https://github.com/rust-lang/rust/commit/07194ffcd25b0871ce560b9f702e52db27ac9f77"}], "stats": {"total": 84, "additions": 54, "deletions": 30}, "files": [{"sha": "5bb3f6bdcfd7bddae10a6affa87d94339880c0d8", "filename": "library/std/src/ffi/os_str.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fffi%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fffi%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fffi%2Fos_str.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -76,6 +76,10 @@ pub struct OsString {\n     inner: Buf,\n }\n \n+/// Allows extension traits within `std`.\n+#[unstable(feature = \"sealed\", issue = \"none\")]\n+impl crate::sealed::Sealed for OsString {}\n+\n /// Borrowed reference to an OS string (see [`OsString`]).\n ///\n /// This type represents a borrowed reference to a string in the operating system's preferred\n@@ -100,6 +104,10 @@ pub struct OsStr {\n     inner: Slice,\n }\n \n+/// Allows extension traits within `std`.\n+#[unstable(feature = \"sealed\", issue = \"none\")]\n+impl crate::sealed::Sealed for OsStr {}\n+\n impl OsString {\n     /// Constructs a new empty `OsString`.\n     ///"}, {"sha": "d5e00ae4be659710619ea12709cdce813d5b4a9c", "filename": "library/std/src/lib.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flib.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -582,3 +582,11 @@ include!(\"keyword_docs.rs\");\n // is unconditional, so the unstable feature needs to be defined somewhere.\n #[unstable(feature = \"restricted_std\", issue = \"none\")]\n mod __restricted_std_workaround {}\n+\n+mod sealed {\n+    /// This trait being unreachable from outside the crate\n+    /// prevents outside implementations of our extension traits.\n+    /// This allows adding more trait methods in the future.\n+    #[unstable(feature = \"sealed\", issue = \"none\")]\n+    pub trait Sealed {}\n+}"}, {"sha": "6480e654c55f05b9fff3874a747205fbb3647b1e", "filename": "library/std/src/process.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fprocess.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -498,6 +498,10 @@ pub struct Command {\n     inner: imp::Command,\n }\n \n+/// Allows extension traits within `std`.\n+#[unstable(feature = \"sealed\", issue = \"none\")]\n+impl crate::sealed::Sealed for Command {}\n+\n impl Command {\n     /// Constructs a new `Command` for launching the program at\n     /// path `program`, with the following default configuration:\n@@ -1375,6 +1379,10 @@ impl From<fs::File> for Stdio {\n #[stable(feature = \"process\", since = \"1.0.0\")]\n pub struct ExitStatus(imp::ExitStatus);\n \n+/// Allows extension traits within `std`.\n+#[unstable(feature = \"sealed\", issue = \"none\")]\n+impl crate::sealed::Sealed for ExitStatus {}\n+\n impl ExitStatus {\n     /// Was termination successful? Signal termination is not considered a\n     /// success, and success is defined as a zero exit status."}, {"sha": "7559c1f1d9e290d41ef4be7d0baeca3896787a46", "filename": "library/std/src/sys/unix/ext/process.rs", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fext%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fext%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fext%2Fprocess.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -6,20 +6,16 @@ use crate::ffi::OsStr;\n use crate::io;\n use crate::os::unix::io::{AsRawFd, FromRawFd, IntoRawFd, RawFd};\n use crate::process;\n+use crate::sealed::Sealed;\n use crate::sys;\n use crate::sys_common::{AsInner, AsInnerMut, FromInner, IntoInner};\n \n-mod private {\n-    /// This trait being unreachable from outside the crate\n-    /// prevents other implementations of the `ExitStatusExt` trait,\n-    /// which allows potentially adding more trait methods in the future.\n-    #[stable(feature = \"none\", since = \"1.51.0\")]\n-    pub trait Sealed {}\n-}\n-\n /// Unix-specific extensions to the [`process::Command`] builder.\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait CommandExt {\n+pub trait CommandExt: Sealed {\n     /// Sets the child process's user ID. This translates to a\n     /// `setuid` call in the child process. Failure in the `setuid`\n     /// call will cause the spawn to fail.\n@@ -193,7 +189,7 @@ impl CommandExt for process::Command {\n /// This trait is sealed: it cannot be implemented outside the standard library.\n /// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait ExitStatusExt: private::Sealed {\n+pub trait ExitStatusExt: Sealed {\n     /// Creates a new `ExitStatus` from the raw underlying `i32` return value of\n     /// a process.\n     #[stable(feature = \"exit_status_from\", since = \"1.12.0\")]\n@@ -228,9 +224,6 @@ pub trait ExitStatusExt: private::Sealed {\n     fn into_raw(self) -> i32;\n }\n \n-#[stable(feature = \"none\", since = \"1.51.0\")]\n-impl private::Sealed for process::ExitStatus {}\n-\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl ExitStatusExt for process::ExitStatus {\n     fn from_raw(raw: i32) -> Self {"}, {"sha": "c89b9ff1efa6b98e892b510fcc0af2796bcda054", "filename": "library/std/src/sys/windows/ext/ffi.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fffi.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -53,6 +53,7 @@\n #![stable(feature = \"rust1\", since = \"1.0.0\")]\n \n use crate::ffi::{OsStr, OsString};\n+use crate::sealed::Sealed;\n use crate::sys::os_str::Buf;\n use crate::sys_common::wtf8::Wtf8Buf;\n use crate::sys_common::{AsInner, FromInner};\n@@ -61,8 +62,11 @@ use crate::sys_common::{AsInner, FromInner};\n pub use crate::sys_common::wtf8::EncodeWide;\n \n /// Windows-specific extensions to [`OsString`].\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait OsStringExt {\n+pub trait OsStringExt: Sealed {\n     /// Creates an `OsString` from a potentially ill-formed UTF-16 slice of\n     /// 16-bit code units.\n     ///\n@@ -92,8 +96,11 @@ impl OsStringExt for OsString {\n }\n \n /// Windows-specific extensions to [`OsStr`].\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait OsStrExt {\n+pub trait OsStrExt: Sealed {\n     /// Re-encodes an `OsStr` as a wide character sequence, i.e., potentially\n     /// ill-formed UTF-16.\n     ///"}, {"sha": "3d680a7f2d94fed6f01c9375bbcfea71034bd1f4", "filename": "library/std/src/sys/windows/ext/process.rs", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fext%2Fprocess.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -4,17 +4,10 @@\n \n use crate::os::windows::io::{AsRawHandle, FromRawHandle, IntoRawHandle, RawHandle};\n use crate::process;\n+use crate::sealed::Sealed;\n use crate::sys;\n use crate::sys_common::{AsInner, AsInnerMut, FromInner, IntoInner};\n \n-mod private {\n-    /// This trait being unreachable from outside the crate\n-    /// prevents other implementations of the `ExitStatusExt` trait,\n-    /// which allows potentially adding more trait methods in the future.\n-    #[stable(feature = \"none\", since = \"1.51.0\")]\n-    pub trait Sealed {}\n-}\n-\n #[stable(feature = \"process_extensions\", since = \"1.2.0\")]\n impl FromRawHandle for process::Stdio {\n     unsafe fn from_raw_handle(handle: RawHandle) -> process::Stdio {\n@@ -85,7 +78,7 @@ impl IntoRawHandle for process::ChildStderr {\n /// This trait is sealed: it cannot be implemented outside the standard library.\n /// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"exit_status_from\", since = \"1.12.0\")]\n-pub trait ExitStatusExt: private::Sealed {\n+pub trait ExitStatusExt: Sealed {\n     /// Creates a new `ExitStatus` from the raw underlying `u32` return value of\n     /// a process.\n     #[stable(feature = \"exit_status_from\", since = \"1.12.0\")]\n@@ -99,12 +92,12 @@ impl ExitStatusExt for process::ExitStatus {\n     }\n }\n \n-#[stable(feature = \"none\", since = \"1.51.0\")]\n-impl private::Sealed for process::ExitStatus {}\n-\n /// Windows-specific extensions to the [`process::Command`] builder.\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"windows_process_extensions\", since = \"1.16.0\")]\n-pub trait CommandExt {\n+pub trait CommandExt: Sealed {\n     /// Sets the [process creation flags][1] to be passed to `CreateProcess`.\n     ///\n     /// These will always be ORed with `CREATE_UNICODE_ENVIRONMENT`."}, {"sha": "302c519740717723dd12bed1e7e61a4b2d313b35", "filename": "library/std/src/sys_common/os_str_bytes.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys_common%2Fos_str_bytes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f/library%2Fstd%2Fsrc%2Fsys_common%2Fos_str_bytes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Fos_str_bytes.rs?ref=bfd1ccfb271f03aa85488408c3b03a15ad8d7c7f", "patch": "@@ -6,6 +6,7 @@ use crate::ffi::{OsStr, OsString};\n use crate::fmt;\n use crate::mem;\n use crate::rc::Rc;\n+use crate::sealed::Sealed;\n use crate::str;\n use crate::sync::Arc;\n use crate::sys_common::bytestring::debug_fmt_bytestring;\n@@ -232,8 +233,11 @@ impl Slice {\n }\n \n /// Platform-specific extensions to [`OsString`].\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait OsStringExt {\n+pub trait OsStringExt: Sealed {\n     /// Creates an [`OsString`] from a byte vector.\n     ///\n     /// See the module documentation for an example.\n@@ -258,8 +262,11 @@ impl OsStringExt for OsString {\n }\n \n /// Platform-specific extensions to [`OsStr`].\n+///\n+/// This trait is sealed: it cannot be implemented outside the standard library.\n+/// This is so that future additional methods are not breaking changes.\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-pub trait OsStrExt {\n+pub trait OsStrExt: Sealed {\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     /// Creates an [`OsStr`] from a byte slice.\n     ///"}]}