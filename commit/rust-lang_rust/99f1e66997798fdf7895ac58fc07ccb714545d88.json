{"sha": "99f1e66997798fdf7895ac58fc07ccb714545d88", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5ZjFlNjY5OTc3OThmZGY3ODk1YWM1OGZjMDdjY2I3MTQ1NDVkODg=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-08-28T22:45:55Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-08-28T23:11:29Z"}, "message": "Only report unique text ranges in highlight_related", "tree": {"sha": "fa6f6a89c88b709813b339abdc5bd4510ab6f1c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa6f6a89c88b709813b339abdc5bd4510ab6f1c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/99f1e66997798fdf7895ac58fc07ccb714545d88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/99f1e66997798fdf7895ac58fc07ccb714545d88", "html_url": "https://github.com/rust-lang/rust/commit/99f1e66997798fdf7895ac58fc07ccb714545d88", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/99f1e66997798fdf7895ac58fc07ccb714545d88/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "72bfbb0691d7d229c49b76afe6eeb82500a62806", "url": "https://api.github.com/repos/rust-lang/rust/commits/72bfbb0691d7d229c49b76afe6eeb82500a62806", "html_url": "https://github.com/rust-lang/rust/commit/72bfbb0691d7d229c49b76afe6eeb82500a62806"}], "stats": {"total": 18, "additions": 8, "deletions": 10}, "files": [{"sha": "a0859dd1ecc75afecf47dc3d6e61b934a39496bb", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=99f1e66997798fdf7895ac58fc07ccb714545d88", "patch": "@@ -538,6 +538,8 @@ impl<'db> SemanticsImpl<'db> {\n         res\n     }\n \n+    // Note this return type is deliberate as [`find_nodes_at_offset_with_descend`] wants to stop\n+    // traversing the inner iterator when it finds a node.\n     fn descend_node_at_offset(\n         &self,\n         node: &SyntaxNode,"}, {"sha": "67ad263fa238169d570941b2cc71e3b6c59f4997", "filename": "crates/ide/src/highlight_related.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fide%2Fsrc%2Fhighlight_related.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fide%2Fsrc%2Fhighlight_related.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhighlight_related.rs?ref=99f1e66997798fdf7895ac58fc07ccb714545d88", "patch": "@@ -6,14 +6,15 @@ use ide_db::{\n     search::{FileReference, ReferenceAccess, SearchScope},\n     RootDatabase,\n };\n-use itertools::Itertools;\n+use rustc_hash::FxHashSet;\n use syntax::{\n     ast::{self, LoopBodyOwner},\n     match_ast, AstNode, SyntaxNode, SyntaxToken, TextRange, TextSize, T,\n };\n \n use crate::{display::TryToNav, references, NavigationTarget};\n \n+#[derive(PartialEq, Eq, Hash)]\n pub struct HighlightedRange {\n     pub range: TextRange,\n     pub access: Option<ReferenceAccess>,\n@@ -100,11 +101,11 @@ fn highlight_references(\n         })\n     });\n \n-    let res: Vec<_> = declarations.chain(usages).collect();\n+    let res: FxHashSet<_> = declarations.chain(usages).collect();\n     if res.is_empty() {\n         None\n     } else {\n-        Some(res)\n+        Some(res.into_iter().collect())\n     }\n }\n \n@@ -276,7 +277,7 @@ fn find_defs(\n     sema: &Semantics<RootDatabase>,\n     syntax: &SyntaxNode,\n     offset: TextSize,\n-) -> Vec<Definition> {\n+) -> FxHashSet<Definition> {\n     sema.find_nodes_at_offset_with_descend(syntax, offset)\n         .flat_map(|name_like| {\n             Some(match name_like {\n@@ -309,7 +310,6 @@ fn find_defs(\n             })\n         })\n         .flatten()\n-        .unique()\n         .collect()\n }\n \n@@ -423,8 +423,6 @@ macro_rules! foo {\n \n foo!(bar$0);\n   // ^^^\n-  // ^^^\n-  // ^^^\n fn foo() {\n     let bar: bar = bar();\n           // ^^^\n@@ -443,7 +441,6 @@ macro_rules! foo {\n \n foo!(bar);\n   // ^^^\n-  // ^^^\n fn foo() {\n     let bar: bar$0 = bar();\n           // ^^^\n@@ -873,7 +870,6 @@ fn function(field: u32) {\n           //^^^^^\n     Struct { field$0 }\n            //^^^^^ read\n-           //^^^^^ read\n }\n \"#,\n         );"}, {"sha": "855675be421abeb05f5d35b9dec6825a1e103d20", "filename": "crates/ide_db/src/search.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fide_db%2Fsrc%2Fsearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99f1e66997798fdf7895ac58fc07ccb714545d88/crates%2Fide_db%2Fsrc%2Fsearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fsearch.rs?ref=99f1e66997798fdf7895ac58fc07ccb714545d88", "patch": "@@ -61,7 +61,7 @@ pub struct FileReference {\n     pub access: Option<ReferenceAccess>,\n }\n \n-#[derive(Debug, Copy, Clone, PartialEq)]\n+#[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n pub enum ReferenceAccess {\n     Read,\n     Write,"}]}