{"sha": "ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNhMTk5YjE2ZTVjMDZjMjhiM2QzNWRlNzlmZmFhZmY4MWJkMGQ0M2Y=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-03T13:43:04Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-03T13:43:04Z"}, "message": "Use char_indices() instead of chars() to prevent more than one-byte characters issue", "tree": {"sha": "569d4fbf0f229390128b8d307426dd5364ffcc28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/569d4fbf0f229390128b8d307426dd5364ffcc28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "html_url": "https://github.com/rust-lang/rust/commit/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5bc148957efc0bf4640d3d6b3e1824c00f1156e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/5bc148957efc0bf4640d3d6b3e1824c00f1156e8", "html_url": "https://github.com/rust-lang/rust/commit/5bc148957efc0bf4640d3d6b3e1824c00f1156e8"}], "stats": {"total": 91, "additions": 43, "deletions": 48}, "files": [{"sha": "4218717c4366cf7e31e50972d10b21a440146f53", "filename": "src/librustdoc/passes/html_tags.rs", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fhtml_tags.rs?ref=ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "patch": "@@ -46,9 +46,7 @@ fn drop_tag(\n     f: &impl Fn(&str, &Range<usize>),\n ) {\n     let tag_name_low = tag_name.to_lowercase();\n-    if let Some(pos) = tags.iter().rev().position(|(t, _)| t.to_lowercase() == tag_name_low) {\n-        // Because this is from a `rev` iterator, the position is reversed as well!\n-        let pos = tags.len() - 1 - pos;\n+    if let Some(pos) = tags.iter().rposition(|(t, _)| t.to_lowercase() == tag_name_low) {\n         // If the tag is nested inside a \"<script>\" or a \"<style>\" tag, no warning should\n         // be emitted.\n         let should_not_warn = tags.iter().take(pos + 1).any(|(at, _)| {\n@@ -83,9 +81,9 @@ fn extract_tag(\n     range: Range<usize>,\n     f: &impl Fn(&str, &Range<usize>),\n ) {\n-    let mut iter = text.chars().enumerate().peekable();\n+    let mut iter = text.char_indices().peekable();\n \n-    'top: while let Some((start_pos, c)) = iter.next() {\n+    while let Some((start_pos, c)) = iter.next() {\n         if c == '<' {\n             let mut tag_name = String::new();\n             let mut is_closing = false;\n@@ -118,20 +116,11 @@ fn extract_tag(\n                             tags.push((tag_name, r));\n                         }\n                     }\n-                    continue 'top;\n-                }\n-                // Some chars like \ud83d\udca9 are longer than 1 character, so we need to skip the other\n-                // bytes as well to prevent stopping \"in the middle\" of a char.\n-                for _ in 0..c.len_utf8() {\n-                    iter.next();\n+                    break;\n                 }\n+                iter.next();\n             }\n         }\n-        // Some chars like \ud83d\udca9 are longer than 1 character, so we need to skip the other\n-        // bytes as well to prevent stopping \"in the middle\" of a char.\n-        for _ in 0..c.len_utf8() - 1 {\n-            iter.next();\n-        }\n     }\n }\n "}, {"sha": "0278caf308776742e7f478dde6ec310a27b63997", "filename": "src/test/rustdoc-ui/intra-link-errors.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.rs?ref=ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "patch": "@@ -1,4 +1,3 @@\n-#![allow(invalid_html_tags)]\n #![deny(broken_intra_doc_links)]\n //~^ NOTE lint level is defined\n "}, {"sha": "b63f799535a1f99e917aa9e8648433634660eab3", "filename": "src/test/rustdoc-ui/intra-link-errors.stderr", "status": "modified", "additions": 21, "deletions": 21, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-link-errors.stderr?ref=ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "patch": "@@ -1,95 +1,95 @@\n error: unresolved link to `path::to::nonexistent::module`\n-  --> $DIR/intra-link-errors.rs:8:6\n+  --> $DIR/intra-link-errors.rs:7:6\n    |\n LL | /// [path::to::nonexistent::module]\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the module `intra_link_errors` contains no item named `path`\n    |\n note: the lint level is defined here\n-  --> $DIR/intra-link-errors.rs:2:9\n+  --> $DIR/intra-link-errors.rs:1:9\n    |\n LL | #![deny(broken_intra_doc_links)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^\n \n error: unresolved link to `path::to::nonexistent::macro`\n-  --> $DIR/intra-link-errors.rs:12:6\n+  --> $DIR/intra-link-errors.rs:11:6\n    |\n LL | /// [path::to::nonexistent::macro!]\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the module `intra_link_errors` contains no item named `path`\n \n error: unresolved link to `path::to::nonexistent::type`\n-  --> $DIR/intra-link-errors.rs:16:6\n+  --> $DIR/intra-link-errors.rs:15:6\n    |\n LL | /// [type@path::to::nonexistent::type]\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the module `intra_link_errors` contains no item named `path`\n \n error: unresolved link to `std::io::not::here`\n-  --> $DIR/intra-link-errors.rs:20:6\n+  --> $DIR/intra-link-errors.rs:19:6\n    |\n LL | /// [std::io::not::here]\n    |      ^^^^^^^^^^^^^^^^^^ the module `io` contains no item named `not`\n \n error: unresolved link to `std::io::not::here`\n-  --> $DIR/intra-link-errors.rs:24:6\n+  --> $DIR/intra-link-errors.rs:23:6\n    |\n LL | /// [type@std::io::not::here]\n    |      ^^^^^^^^^^^^^^^^^^^^^^^ the module `io` contains no item named `not`\n \n error: unresolved link to `std::io::Error::x`\n-  --> $DIR/intra-link-errors.rs:28:6\n+  --> $DIR/intra-link-errors.rs:27:6\n    |\n LL | /// [std::io::Error::x]\n    |      ^^^^^^^^^^^^^^^^^ the struct `Error` has no field or associated item named `x`\n \n error: unresolved link to `std::io::ErrorKind::x`\n-  --> $DIR/intra-link-errors.rs:32:6\n+  --> $DIR/intra-link-errors.rs:31:6\n    |\n LL | /// [std::io::ErrorKind::x]\n    |      ^^^^^^^^^^^^^^^^^^^^^ the enum `ErrorKind` has no variant or associated item named `x`\n \n error: unresolved link to `f::A`\n-  --> $DIR/intra-link-errors.rs:36:6\n+  --> $DIR/intra-link-errors.rs:35:6\n    |\n LL | /// [f::A]\n    |      ^^^^ `f` is a function, not a module or type, and cannot have associated items\n \n error: unresolved link to `f::A`\n-  --> $DIR/intra-link-errors.rs:40:6\n+  --> $DIR/intra-link-errors.rs:39:6\n    |\n LL | /// [f::A!]\n    |      ^^^^^ `f` is a function, not a module or type, and cannot have associated items\n \n error: unresolved link to `S::A`\n-  --> $DIR/intra-link-errors.rs:44:6\n+  --> $DIR/intra-link-errors.rs:43:6\n    |\n LL | /// [S::A]\n    |      ^^^^ the struct `S` has no field or associated item named `A`\n \n error: unresolved link to `S::fmt`\n-  --> $DIR/intra-link-errors.rs:48:6\n+  --> $DIR/intra-link-errors.rs:47:6\n    |\n LL | /// [S::fmt]\n    |      ^^^^^^ the struct `S` has no field or associated item named `fmt`\n \n error: unresolved link to `E::D`\n-  --> $DIR/intra-link-errors.rs:52:6\n+  --> $DIR/intra-link-errors.rs:51:6\n    |\n LL | /// [E::D]\n    |      ^^^^ the enum `E` has no variant or associated item named `D`\n \n error: unresolved link to `u8::not_found`\n-  --> $DIR/intra-link-errors.rs:56:6\n+  --> $DIR/intra-link-errors.rs:55:6\n    |\n LL | /// [u8::not_found]\n    |      ^^^^^^^^^^^^^ the builtin type `u8` has no associated item named `not_found`\n \n error: unresolved link to `std::primitive::u8::not_found`\n-  --> $DIR/intra-link-errors.rs:60:6\n+  --> $DIR/intra-link-errors.rs:59:6\n    |\n LL | /// [std::primitive::u8::not_found]\n    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the builtin type `u8` has no associated item named `not_found`\n \n error: unresolved link to `Vec::into_iter`\n-  --> $DIR/intra-link-errors.rs:64:6\n+  --> $DIR/intra-link-errors.rs:63:6\n    |\n LL | /// [type@Vec::into_iter]\n    |      ^^^^^^^^^^^^^^^^^^^\n@@ -98,7 +98,7 @@ LL | /// [type@Vec::into_iter]\n    |      help: to link to the associated function, add parentheses: `Vec::into_iter()`\n \n error: unresolved link to `S`\n-  --> $DIR/intra-link-errors.rs:69:6\n+  --> $DIR/intra-link-errors.rs:68:6\n    |\n LL | /// [S!]\n    |      ^^\n@@ -107,7 +107,7 @@ LL | /// [S!]\n    |      help: to link to the struct, prefix with `struct@`: `struct@S`\n \n error: unresolved link to `T::g`\n-  --> $DIR/intra-link-errors.rs:87:6\n+  --> $DIR/intra-link-errors.rs:86:6\n    |\n LL | /// [type@T::g]\n    |      ^^^^^^^^^\n@@ -116,13 +116,13 @@ LL | /// [type@T::g]\n    |      help: to link to the associated function, add parentheses: `T::g()`\n \n error: unresolved link to `T::h`\n-  --> $DIR/intra-link-errors.rs:92:6\n+  --> $DIR/intra-link-errors.rs:91:6\n    |\n LL | /// [T::h!]\n    |      ^^^^^ the trait `T` has no macro named `h`\n \n error: unresolved link to `S::h`\n-  --> $DIR/intra-link-errors.rs:79:6\n+  --> $DIR/intra-link-errors.rs:78:6\n    |\n LL | /// [type@S::h]\n    |      ^^^^^^^^^\n@@ -131,7 +131,7 @@ LL | /// [type@S::h]\n    |      help: to link to the associated function, add parentheses: `S::h()`\n \n error: unresolved link to `m`\n-  --> $DIR/intra-link-errors.rs:99:6\n+  --> $DIR/intra-link-errors.rs:98:6\n    |\n LL | /// [m()]\n    |      ^^^"}, {"sha": "db97ab4456cd0a902f454cf1a9a36490fa0ccfb4", "filename": "src/test/rustdoc-ui/invalid-html-tags.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.rs?ref=ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "patch": "@@ -2,6 +2,7 @@\n \n //! <p>\ud83d\udca9<p>\n //~^ ERROR unclosed HTML tag `p`\n+//~^^ ERROR unclosed HTML tag `p`\n \n /// <img><input>\n /// <script>"}, {"sha": "caa5dd124c18ff035addaa9333f8627128413f84", "filename": "src/test/rustdoc-ui/invalid-html-tags.stderr", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ca199b16e5c06c28b3d35de79ffaaff81bd0d43f/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Finvalid-html-tags.stderr?ref=ca199b16e5c06c28b3d35de79ffaaff81bd0d43f", "patch": "@@ -10,59 +10,65 @@ note: the lint level is defined here\n LL | #![deny(invalid_html_tags)]\n    |         ^^^^^^^^^^^^^^^^^\n \n+error: unclosed HTML tag `p`\n+  --> $DIR/invalid-html-tags.rs:3:9\n+   |\n+LL | //! <p>\ud83d\udca9<p>\n+   |          ^^^\n+\n error: unclosed HTML tag `unknown`\n-  --> $DIR/invalid-html-tags.rs:10:5\n+  --> $DIR/invalid-html-tags.rs:11:5\n    |\n LL | /// <unknown>\n    |     ^^^^^^^^^\n \n error: unclosed HTML tag `script`\n-  --> $DIR/invalid-html-tags.rs:13:5\n+  --> $DIR/invalid-html-tags.rs:14:5\n    |\n LL | /// <script>\n    |     ^^^^^^^^\n \n error: unclosed HTML tag `h2`\n-  --> $DIR/invalid-html-tags.rs:18:7\n+  --> $DIR/invalid-html-tags.rs:19:7\n    |\n LL | ///   <h2>\n    |       ^^^^\n \n error: unclosed HTML tag `h3`\n-  --> $DIR/invalid-html-tags.rs:20:9\n+  --> $DIR/invalid-html-tags.rs:21:9\n    |\n LL | ///     <h3>\n    |         ^^^^\n \n error: unopened HTML tag `hello`\n-  --> $DIR/invalid-html-tags.rs:23:5\n+  --> $DIR/invalid-html-tags.rs:24:5\n    |\n LL | /// </hello>\n    |     ^^^^^^^^\n \n error: unclosed HTML tag `p`\n-  --> $DIR/invalid-html-tags.rs:28:14\n+  --> $DIR/invalid-html-tags.rs:29:14\n    |\n LL | ///    <br/> <p>\n    |              ^^^\n \n error: unclosed HTML tag `div`\n-  --> $DIR/invalid-html-tags.rs:40:5\n+  --> $DIR/invalid-html-tags.rs:41:5\n    |\n LL | /// <div style=\"hello\">\n    |     ^^^^\n \n error: unclosed HTML tag `h3`\n-  --> $DIR/invalid-html-tags.rs:42:7\n+  --> $DIR/invalid-html-tags.rs:43:7\n    |\n LL | ///   <h3>\n    |       ^^^^\n \n error: unclosed HTML tag `script`\n-  --> $DIR/invalid-html-tags.rs:44:5\n+  --> $DIR/invalid-html-tags.rs:45:5\n    |\n LL | /// <script\n    |     ^^^^^^\n \n-error: aborting due to 10 previous errors\n+error: aborting due to 11 previous errors\n "}]}