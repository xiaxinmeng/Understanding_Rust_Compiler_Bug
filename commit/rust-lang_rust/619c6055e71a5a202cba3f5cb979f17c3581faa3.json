{"sha": "619c6055e71a5a202cba3f5cb979f17c3581faa3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxOWM2MDU1ZTcxYTVhMjAyY2JhM2Y1Y2I5NzlmMTdjMzU4MWZhYTM=", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2020-05-08T16:25:18Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2020-05-08T16:25:44Z"}, "message": "Fix debug assertion in error code", "tree": {"sha": "9fac4cd761395314d02aad02a36ece464c8ff1c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9fac4cd761395314d02aad02a36ece464c8ff1c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/619c6055e71a5a202cba3f5cb979f17c3581faa3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/619c6055e71a5a202cba3f5cb979f17c3581faa3", "html_url": "https://github.com/rust-lang/rust/commit/619c6055e71a5a202cba3f5cb979f17c3581faa3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/619c6055e71a5a202cba3f5cb979f17c3581faa3/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "649b6323cd20d4a454264798c189107fd1eda33f", "url": "https://api.github.com/repos/rust-lang/rust/commits/649b6323cd20d4a454264798c189107fd1eda33f", "html_url": "https://github.com/rust-lang/rust/commit/649b6323cd20d4a454264798c189107fd1eda33f"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "3c8aa08bdca950f35e5d7daf90ab93545cb2376a", "filename": "src/librustc_trait_selection/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trait_selection%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=619c6055e71a5a202cba3f5cb979f17c3581faa3", "patch": "@@ -691,6 +691,15 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n             }\n \n             if let ty::Ref(region, t_type, mutability) = trait_ref.skip_binder().self_ty().kind {\n+                if region.is_late_bound() || t_type.has_escaping_bound_vars() {\n+                    // Avoid debug assertion in `mk_obligation_for_def_id`.\n+                    //\n+                    // If the self type has escaping bound vars then it's not\n+                    // going to be the type of an expression, so the suggestion\n+                    // probably won't apply anyway.\n+                    return;\n+                }\n+\n                 let trait_type = match mutability {\n                     hir::Mutability::Mut => self.tcx.mk_imm_ref(region, t_type),\n                     hir::Mutability::Not => self.tcx.mk_mut_ref(region, t_type),"}, {"sha": "319789c4ec28296534a6025cc64d9938f2ada5af", "filename": "src/test/ui/suggestions/imm-ref-trait-object-literal-bound-regions.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.rs?ref=619c6055e71a5a202cba3f5cb979f17c3581faa3", "patch": "@@ -0,0 +1,18 @@\n+// Regression test for #70813 (this used to trigger a debug assertion)\n+\n+trait Trait {}\n+\n+struct S;\n+\n+impl<'a> Trait for &'a mut S {}\n+\n+fn foo<X>(_: X)\n+where\n+    for<'b> &'b X: Trait,\n+{\n+}\n+\n+fn main() {\n+    let s = S;\n+    foo::<S>(s); //~ ERROR the trait bound `for<'b> &'b S: Trait` is not satisfied\n+}"}, {"sha": "83de3c4cfe0a52db7e16cc3ffac280d14050e07d", "filename": "src/test/ui/suggestions/imm-ref-trait-object-literal-bound-regions.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/619c6055e71a5a202cba3f5cb979f17c3581faa3/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimm-ref-trait-object-literal-bound-regions.stderr?ref=619c6055e71a5a202cba3f5cb979f17c3581faa3", "patch": "@@ -0,0 +1,18 @@\n+error[E0277]: the trait bound `for<'b> &'b S: Trait` is not satisfied\n+  --> $DIR/imm-ref-trait-object-literal-bound-regions.rs:17:5\n+   |\n+LL | fn foo<X>(_: X)\n+   |    --- required by a bound in this\n+LL | where\n+LL |     for<'b> &'b X: Trait,\n+   |                    ----- required by this bound in `foo`\n+...\n+LL |     foo::<S>(s);\n+   |     ^^^^^^^^ the trait `for<'b> Trait` is not implemented for `&'b S`\n+   |\n+   = help: the following implementations were found:\n+             <&'a mut S as Trait>\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}]}