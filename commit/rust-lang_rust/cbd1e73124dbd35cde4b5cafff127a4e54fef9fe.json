{"sha": "cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiZDFlNzMxMjRkYmQzNWNkZTRiNWNhZmZmMTI3YTRlNTRmZWY5ZmU=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-12-16T13:52:50Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-12-19T03:44:42Z"}, "message": "Set release channel on non-dist builders\n\nToolstate publication only runs if the channel is \"nightly\" and\npreviously the toolstate builders did not know that the channel was\nnightly (since they are not dist builders).\n\nA look through bootstrap seems to indicate that nothing should directly\ndepend on the channel being set to `-dev` on the test builders, though\nthis may cause some problems with UI tests (if for some reason they're\ndumping the channel into stderr), but we cannot find evidence of such so\nhopefully this is fine.", "tree": {"sha": "31ffd00064634f93486c947375414771e17233f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/31ffd00064634f93486c947375414771e17233f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "html_url": "https://github.com/rust-lang/rust/commit/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a605441e049f0b6d5f7715b94b8ac4662fd7fcf6", "url": "https://api.github.com/repos/rust-lang/rust/commits/a605441e049f0b6d5f7715b94b8ac4662fd7fcf6", "html_url": "https://github.com/rust-lang/rust/commit/a605441e049f0b6d5f7715b94b8ac4662fd7fcf6"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "b5ebf835506b842ee946d4cf791dd57c9e55d495", "filename": "src/bootstrap/toolstate.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe/src%2Fbootstrap%2Ftoolstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe/src%2Fbootstrap%2Ftoolstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftoolstate.rs?ref=cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "patch": "@@ -13,13 +13,13 @@ use std::env;\n // Each cycle is 42 days long (6 weeks); the last week is 35..=42 then.\n const BETA_WEEK_START: u64 = 35;\n \n-#[cfg(linux)]\n+#[cfg(target_os = \"linux\")]\n const OS: Option<&str> = Some(\"linux\");\n \n #[cfg(windows)]\n const OS: Option<&str> = Some(\"windows\");\n \n-#[cfg(all(not(linux), not(windows)))]\n+#[cfg(all(not(target_os = \"linux\"), not(windows)))]\n const OS: Option<&str> = None;\n \n type ToolstateData = HashMap<Box<str>, ToolState>;\n@@ -379,7 +379,7 @@ fn change_toolstate(\n     let mut regressed = false;\n     for repo_state in old_toolstate {\n         let tool = &repo_state.tool;\n-        let state = if cfg!(linux) {\n+        let state = if cfg!(target_os = \"linux\") {\n             &repo_state.linux\n         } else if cfg!(windows) {\n             &repo_state.windows"}, {"sha": "73c3a964f53967d2578c5b543c70335b514a43fc", "filename": "src/ci/run.sh", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "patch": "@@ -44,8 +44,13 @@ fi\n # FIXME: need a scheme for changing this `nightly` value to `beta` and `stable`\n #        either automatically or manually.\n export RUST_RELEASE_CHANNEL=nightly\n+\n+# Always set the release channel for bootstrap; this is normally not important (i.e., only dist\n+# builds would seem to matter) but in practice bootstrap wants to know whether we're targeting\n+# master, beta, or stable with a build to determine whether to run some checks (notably toolstate).\n+RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n+\n if [ \"$DEPLOY$DEPLOY_ALT\" = \"1\" ]; then\n-  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-llvm-static-stdcpp\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --set rust.remap-debuginfo\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --debuginfo-level-std=1\""}]}