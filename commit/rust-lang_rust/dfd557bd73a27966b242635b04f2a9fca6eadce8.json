{"sha": "dfd557bd73a27966b242635b04f2a9fca6eadce8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmZDU1N2JkNzNhMjc5NjZiMjQyNjM1YjA0ZjJhOWZjYTZlYWRjZTg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-07T12:25:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-01-07T12:25:15Z"}, "message": "auto merge of #20606 : alexcrichton/rust/stabilize-libc, r=brson\n\nThis commit prepares the liblibc library to be moved to crates.io. Unlike the\r\nlog, serialize, term, etc crates, the source for this crate will *not* be\r\nduplicated out-of-tree. Instead a new rust-lang/libc repository will be created\r\nwith a submodule to this repository and it will use the source directly.\r\n\r\nIn order to compile within the stable ecosystem of Rust, this crate cannot link\r\nto libcore, and it also needs some tweaks for the other attributes that it has.\r\nAs a result this commit tweaks the source of the crate to link to libcore when\r\nbuilt in tree but link to libstd when built via cargo.\r\n\r\nNote that the rust-lang/libc crate isn't quite prepared just yet, there's a\r\nCargo bug or two that I'd like to iron out before publishing it. This is simply\r\npreparing the in-tree source.", "tree": {"sha": "44de29924c0b15bbf6af9056b0835baaf724d5b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44de29924c0b15bbf6af9056b0835baaf724d5b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dfd557bd73a27966b242635b04f2a9fca6eadce8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dfd557bd73a27966b242635b04f2a9fca6eadce8", "html_url": "https://github.com/rust-lang/rust/commit/dfd557bd73a27966b242635b04f2a9fca6eadce8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dfd557bd73a27966b242635b04f2a9fca6eadce8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3a16e9610aba6d4bb023721d1f8513fe260bd03", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3a16e9610aba6d4bb023721d1f8513fe260bd03", "html_url": "https://github.com/rust-lang/rust/commit/a3a16e9610aba6d4bb023721d1f8513fe260bd03"}, {"sha": "01ce6efd859ed6ce3d20d331ae6e035ebd0a7678", "url": "https://api.github.com/repos/rust-lang/rust/commits/01ce6efd859ed6ce3d20d331ae6e035ebd0a7678", "html_url": "https://github.com/rust-lang/rust/commit/01ce6efd859ed6ce3d20d331ae6e035ebd0a7678"}], "stats": {"total": 27, "additions": 6, "deletions": 21}, "files": [{"sha": "347a958076dff36706f82b14ddd57a45c0e74346", "filename": "src/liblibc/lib.rs", "status": "modified", "additions": 6, "deletions": 21, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/dfd557bd73a27966b242635b04f2a9fca6eadce8/src%2Fliblibc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dfd557bd73a27966b242635b04f2a9fca6eadce8/src%2Fliblibc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblibc%2Flib.rs?ref=dfd557bd73a27966b242635b04f2a9fca6eadce8", "patch": "@@ -9,10 +9,9 @@\n // except according to those terms.\n \n #![crate_name = \"libc\"]\n-#![experimental]\n-#![no_std] // we don't need std, and we can't have std, since it doesn't exist\n-           // yet. std depends on us.\n #![crate_type = \"rlib\"]\n+#![cfg_attr(not(feature = \"cargo-build\"), experimental)]\n+#![no_std]\n #![doc(html_logo_url = \"http://www.rust-lang.org/logos/rust-logo-128x128-blk-v2.png\",\n        html_favicon_url = \"http://www.rust-lang.org/favicon.ico\",\n        html_root_url = \"http://doc.rust-lang.org/nightly/\",\n@@ -70,20 +69,14 @@\n //! in multiple derived systems. This is the 4.4BSD r2 / 1995 release, the final\n //! one from Berkeley after the lawsuits died down and the CSRG dissolved.\n \n-#![allow(non_camel_case_types)]\n-#![allow(non_snake_case)]\n-#![allow(non_upper_case_globals)]\n-#![allow(missing_docs)]\n-#![allow(non_snake_case)]\n-#![allow(raw_pointer_derive)]\n+#![allow(bad_style, raw_pointer_derive)]\n \n-extern crate core;\n+#[cfg(feature = \"cargo-build\")] extern crate \"std\" as core;\n+#[cfg(not(feature = \"cargo-build\"))] extern crate core;\n \n #[cfg(test)] extern crate std;\n #[cfg(test)] extern crate test;\n \n-pub use self::Nullable::*;\n-\n // Explicit export lists for the intersection (provided here) mean that\n // you can write more-platform-agnostic code if you stick to just these\n // symbols.\n@@ -311,14 +304,6 @@ pub use types::os::arch::extra::{mach_timebase_info};\n #[link(name = \"m\")]\n extern {}\n \n-/// A wrapper for a nullable pointer. Don't use this except for interacting\n-/// with libc. Basically Option, but without the dependence on libstd.\n-// If/when libprim happens, this can be removed in favor of that\n-pub enum Nullable<T> {\n-    Null,\n-    NotNull(T)\n-}\n-\n pub mod types {\n \n     // Types tend to vary *per architecture* so we pull their definitions out\n@@ -4648,7 +4633,7 @@ pub mod funcs {\n             extern {\n                 pub fn glob(pattern: *const c_char,\n                             flags: c_int,\n-                            errfunc: ::Nullable<extern \"C\" fn(epath: *const c_char,\n+                            errfunc: ::core::option::Option<extern \"C\" fn(epath: *const c_char,\n                                                               errno: c_int) -> c_int>,\n                             pglob: *mut glob_t);\n                 pub fn globfree(pglob: *mut glob_t);"}]}