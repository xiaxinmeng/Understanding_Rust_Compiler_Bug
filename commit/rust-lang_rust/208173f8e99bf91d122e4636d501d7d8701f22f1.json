{"sha": "208173f8e99bf91d122e4636d501d7d8701f22f1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwODE3M2Y4ZTk5YmY5MWQxMjJlNDYzNmQ1MDFkN2Q4NzAxZjIyZjE=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-07-04T21:07:37Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-07-09T20:14:44Z"}, "message": "Fix project_deref() implementation\n\nI'm not really sure what is wrong here, but I was getting load\ntype mismatches in the debuginfo code (which is the only place\nusing this function).\n\nReplacing the project_deref() implementation with a generic\nload_operand + deref did the trick.", "tree": {"sha": "f45ef3432bd6ca3770b69c24c83468e847ac0509", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f45ef3432bd6ca3770b69c24c83468e847ac0509"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/208173f8e99bf91d122e4636d501d7d8701f22f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/208173f8e99bf91d122e4636d501d7d8701f22f1", "html_url": "https://github.com/rust-lang/rust/commit/208173f8e99bf91d122e4636d501d7d8701f22f1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/208173f8e99bf91d122e4636d501d7d8701f22f1/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4560efe46c476cf794fa0ce4efb8db5aa55a3351", "url": "https://api.github.com/repos/rust-lang/rust/commits/4560efe46c476cf794fa0ce4efb8db5aa55a3351", "html_url": "https://github.com/rust-lang/rust/commit/4560efe46c476cf794fa0ce4efb8db5aa55a3351"}], "stats": {"total": 14, "additions": 1, "deletions": 13}, "files": [{"sha": "c139f915e6cbb21932924f897e7a2822da161658", "filename": "compiler/rustc_codegen_ssa/src/mir/debuginfo.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/208173f8e99bf91d122e4636d501d7d8701f22f1/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208173f8e99bf91d122e4636d501d7d8701f22f1/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fdebuginfo.rs?ref=208173f8e99bf91d122e4636d501d7d8701f22f1", "patch": "@@ -274,7 +274,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                 match *elem {\n                     mir::ProjectionElem::Deref => {\n                         indirect_offsets.push(Size::ZERO);\n-                        place = place.project_deref(bx);\n+                        place = bx.load_operand(place).deref(bx.cx());\n                     }\n                     mir::ProjectionElem::Field(field, _) => {\n                         let i = field.index();"}, {"sha": "66d9d1a1e0c490ef2237a25e1602c92f8ceda921", "filename": "compiler/rustc_codegen_ssa/src/mir/place.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/208173f8e99bf91d122e4636d501d7d8701f22f1/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/208173f8e99bf91d122e4636d501d7d8701f22f1/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fmir%2Fplace.rs?ref=208173f8e99bf91d122e4636d501d7d8701f22f1", "patch": "@@ -402,18 +402,6 @@ impl<'a, 'tcx, V: CodegenObject> PlaceRef<'tcx, V> {\n         downcast\n     }\n \n-    pub fn project_deref<Bx: BuilderMethods<'a, 'tcx, Value = V>>(&self, bx: &mut Bx) -> Self {\n-        let target_ty = self.layout.ty.builtin_deref(true).expect(\"failed to deref\");\n-        let layout = bx.layout_of(target_ty.ty);\n-\n-        PlaceRef {\n-            llval: bx.load(bx.backend_type(layout), self.llval, self.align),\n-            llextra: None,\n-            layout,\n-            align: layout.align.abi,\n-        }\n-    }\n-\n     pub fn storage_live<Bx: BuilderMethods<'a, 'tcx, Value = V>>(&self, bx: &mut Bx) {\n         bx.lifetime_start(self.llval, self.layout.size);\n     }"}]}