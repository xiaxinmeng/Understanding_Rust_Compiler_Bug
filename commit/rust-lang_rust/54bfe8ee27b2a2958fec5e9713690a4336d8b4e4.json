{"sha": "54bfe8ee27b2a2958fec5e9713690a4336d8b4e4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0YmZlOGVlMjdiMmEyOTU4ZmVjNWU5NzEzNjkwYTQzMzZkOGI0ZTQ=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-05-03T16:25:59Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-05-03T16:25:59Z"}, "message": "Small fixes to snapshot script.", "tree": {"sha": "acf39329cb4a686670048f01f8e6639d44ea6ac9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/acf39329cb4a686670048f01f8e6639d44ea6ac9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4", "html_url": "https://github.com/rust-lang/rust/commit/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "561746238835f28e308cd8f8cf75bc8da707fd5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/561746238835f28e308cd8f8cf75bc8da707fd5f", "html_url": "https://github.com/rust-lang/rust/commit/561746238835f28e308cd8f8cf75bc8da707fd5f"}], "stats": {"total": 20, "additions": 11, "deletions": 9}, "files": [{"sha": "7dd963e8edadec645d29de4c906a4f7de167ebd7", "filename": "src/etc/snapshot.py", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4/src%2Fetc%2Fsnapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/54bfe8ee27b2a2958fec5e9713690a4336d8b4e4/src%2Fetc%2Fsnapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fsnapshot.py?ref=54bfe8ee27b2a2958fec5e9713690a4336d8b4e4", "patch": "@@ -1,6 +1,12 @@\n import re, os, sys, hashlib, tarfile, shutil, subprocess, tempfile\n \n-src_dir = os.getenv(\"CFG_SRC_DIR\")\n+def scrub(b):\n+  if sys.version_info >= (3,) and type(b) == bytes:\n+    return b.decode('ascii')\n+  else:\n+    return b\n+\n+src_dir = scrub(os.getenv(\"CFG_SRC_DIR\"))\n if not src_dir:\n   raise Exception(\"missing env var CFG_SRC_DIR\")\n \n@@ -63,11 +69,6 @@ def get_cpu():\n def get_platform():\n   return \"%s-%s\" % (get_kernel(), get_cpu())\n \n-def scrub(b):\n-  if sys.version_info >= (3,) and type(b) == bytes:\n-    return b.decode('ascii')\n-  else:\n-    return b\n \n def cmd_out(cmdline):\n     p = subprocess.Popen(cmdline,\n@@ -76,7 +77,8 @@ def cmd_out(cmdline):\n \n \n def local_rev_info(field):\n-    return cmd_out([\"git\", \"log\", \"-n\", \"1\",\n+    return cmd_out([\"git\", \"--git-dir=\" + os.path.join(src_dir, \".git\"),\n+                    \"log\", \"-n\", \"1\",\n                     \"--format=%%%s\" % field, \"HEAD\"])\n \n \n@@ -110,8 +112,8 @@ def make_snapshot():\n \n     tar = tarfile.open(file0, \"w:bz2\")\n     for name in snapshot_files[kernel]:\n-    tar.add(os.path.join(\"stage2\", name),\n-    os.path.join(\"rust-stage0\", name))\n+      tar.add(os.path.join(\"stage2\", name),\n+              os.path.join(\"rust-stage0\", name))\n     tar.close()\n \n     h = hash_file(file0)"}]}